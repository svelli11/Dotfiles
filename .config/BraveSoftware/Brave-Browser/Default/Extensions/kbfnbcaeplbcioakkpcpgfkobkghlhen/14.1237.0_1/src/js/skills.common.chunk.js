(self.webpackChunk=self.webpackChunk||[]).push([[6243],{53810:(e,t,s)=>{s.d(t,{K:()=>c});var i,n=s(42319);!function(e){e.postMessage="postMessage",e.setMessagePort="setMessagePort",e.setSource="setSource"}(i||(i={}));class r{constructor(e,t){this._didReceiveReadyMessage=!1,this._onMessageListeners=[],this._pendingOutgoingMessages=[],this._onMessageFromAnySource=e=>{null!=e.source&&e.source===this._iframe.contentWindow&&this._onMessage(e)},this._flushPendingOutgoingMessages=()=>{if(this._didReceiveReadyMessage&&0!==this._pendingOutgoingMessages.length&&null!=this._iframe.contentWindow){for(const e of this._pendingOutgoingMessages)this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin);this._pendingOutgoingMessages.length=0}},this._iframe=e,this._trustedSrcURL=t,self.addEventListener("message",this._onMessageFromAnySource)}setSrcURL(e){this._trustedSrcURL=e}get _iframeTargetOrigin(){const e=new URL(this._iframe.src,self.location.href).toString();if(!this._trustedSrcURL||!this._trustedSrcURL.startsWith(e))throw new Error("Invalid iframe target origin");return e}_onMessage(e){this._didReceiveReadyMessage=!0,this._onMessageListeners.forEach((t=>t(e.data))),this._flushPendingOutgoingMessages()}postMessage(e){null!=this._iframe.contentWindow&&this._didReceiveReadyMessage?(this._flushPendingOutgoingMessages(),this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin)):this._pendingOutgoingMessages.push(e)}onMessage(e){this._onMessageListeners.push(e)}dispose(){self.removeEventListener("message",this._onMessageFromAnySource),this._onMessageListeners.length=0,this._pendingOutgoingMessages.length=0}}class a extends r{_onMessage(e){if(!this._isMessagePortSet&&null!=this._iframe.contentWindow){const e={type:i.setMessagePort,port:this._channel.port2};this._isMessagePortSet=!0,this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin,[this._channel.port2])}return super._onMessage(e)}constructor(e,t){super(e,t),this._isMessagePortSet=!1,this._channel=new MessageChannel,this._channel.port1.onmessage=e=>{this._onMessage(e)}}dispose(){super.dispose(),this._channel.port1.close()}}class o{constructor(e,t){const s=null!=t?t:document.createElement("iframe"),i=e.baseUri+"src/gOS-sandbox.html";s.loading="eager",s.allow="clipboard-read *; clipboard-write *",s.src=i,s.width="100%",s.height="100%",s.style.border="none",s.setAttribute(n.MY,"applet-iframe"),this._frame=s,this._messenger=new a(s,i),this._shouldDetach=null==t}setSource(e){this._messenger.postMessage({type:i.setSource,url:e})}resize(e){}postMessage(e){this._messenger.postMessage({type:i.postMessage,data:e})}onMessage(e){this._messenger.onMessage(e)}dispose(){this._messenger.dispose(),this._shouldDetach&&this._frame.remove()}get frame(){return this._frame}}var l=s(45013);class c{constructor(e,t=(0,l.OB)().browserApi){this._usingFrame=e,this._api=t}createBackgroundSandbox(e,t){throw new Error("Not supported")}createUISandbox(e,t){return new o(this._api,this._usingFrame)}}},8045:(e,t,s)=>{s.d(t,{C:()=>R});var i=s(85997);var n=s(30646);class r extends n.Ic{constructor(e){super(),this._options=e,this.register({id:"assistant",kind:"ui",displayName:"Assistant",version:"0.0.0",entryPoint:"https://applet-bundles.grammarly.net/applets/assistant?responseType=redirect"})}get(e){const t=super.get(e);if(null!=t)return this._patchEntryPoint(t)}all(){return super.all().map((e=>this._patchEntryPoint(e)))}_patchEntryPoint(e){var t,s;const i=new URL(null!==(t="assistant"===e.id?this._getAssistantAppletUrl():null)&&void 0!==t?t:e.entryPoint);return i.searchParams.set("api",String(n.IS.version)),i.searchParams.set("channel",null!==(s=this._options.getChannel())&&void 0!==s?s:"stable"),{...e,entryPoint:i.toString()}}_getAssistantAppletUrl(){const e=this._options.getAssistantAppletUrl();if(null==e)return null;try{return new URL(e).toString()}catch(e){return null}}}var a=s(29148),o=s(99208),l=s(88305),c=s(47835),h=s(45013);class g extends o.X{constructor(){const e=l.iy.create();super(new a.rr(c.XI,(0,h.OB)().message,e)),this.id=e}}var d=s(95804),u=s(26585),p=s(32082);function _(e,t){const{bgRpc:s,experimentClient:i}=t,{buildInfo:n,bundleInfo:r}=t.config;let a=r.env.startsWith("dev")||!1;return e.get(["extensionSettings"]).then((({extensionSettings:e})=>{var t;a=null!==(t=null==e?void 0:e.common.gOSDebuggerEnabled)&&void 0!==t&&t})),{environment:m(r.env),async getContainerId(){var e;return null!==(e=await s.api.getContainerIdOrUndefined("gOS"))&&void 0!==e?e:""},async getUserId(){var t,s;return null!==(s=null===(t=(await e.get(["user"])).user)||void 0===t?void 0:t.id)&&void 0!==s?s:"-1"},clientName:r.extensionType,clientVersion:n.version,clientType:"extension",get isDebugMode(){return a},openURL(e){},makeLogger:e=>function(e,t,s){return{log(n,r,a,o,l,c,h){const g=l>0?`${r} (${h} at ${o}:${l}:${c})`:r;switch(n){case"debug":t.debug(g,a);break;case"info":t.info(g,a),i.isGateEnabled(d.K.GOSTelemetry)&&s.gOS.info(e,g,a);break;case"warn":t.warn(g,a),i.isGateEnabled(d.K.GOSTelemetry)&&s.gOS.warn(e,g,a);break;case"error":t.error(g,a),i.isGateEnabled(d.K.GOSTelemetry)&&s.gOS.error(e,g,a)}}}}(e,p.Y.create(`applet/${e}`),(0,u.Tb)()),makePerformanceTracker:()=>({})}}function m(e){return"dev-qa"===e||"qa"===e?"qa":"dev-preprod"===e?"preprod":"prod"}var v=s(8867),w=s(86819);function y(e,t){return JSON.stringify({clientId:e,instanceId:t})}class S extends w.S{constructor(e,t){super(new f(c.V,(0,h.OB)().message,e.id),{dispatchAction:({clientId:e},s,i,n)=>t.dispatchAction(y(e,s),i,n),dispose:({clientId:e},s)=>t.dispose(y(e,s))})}}class f{constructor(e,t,s){this._rpcMessageName=e,this._message=t,this._clientId=s,this.inbound=new v.y((e=>{const t=t=>{t.clientId===this._clientId&&e.next(t)};return this._message.on(this._rpcMessageName,t),()=>this._message.off(this._rpcMessageName,t)})),this.outbound=e=>{this._message.sendBackground(this._rpcMessageName,e)}}}class b{constructor(e){this._host=e}_getContainerFor(e){const t=this._host.getAppletContainer(e);if(null==t)throw new Error(`No applet container for context ${e}`);return t}async dispatchAction(e,t,s){const i=this._getContainerFor(e),n=t.split(".").slice(0,-1).join(".");return null==i.objects.get(n)?await i.rpc.call(t,s):await i.objects.execute(t,s)}async dispose(e){}}var x=s(53810);class O{constructor(e,t,s){this._container=e,this._delegates=t,this._logger=s}get _isResizable(){var e,t,s;return null===(s=null===(t=(e=this._delegates).canResize)||void 0===t?void 0:t.call(e))||void 0===s||s}async initialize(e){var t,s;const i=this._resize(e.initialSize),n=await this._container.createInitializeResponse(e);return null===(s=(t=this._delegates).onInit)||void 0===s||s.call(t,e),{...n,platform:"extension",frame:{...i,resizable:this._isResizable?"both":"none"}}}async visuallyReady(){var e,t;null===(t=(e=this._delegates).onVisuallyReady)||void 0===t||t.call(e)}async interactionReady(e){var t,s,i;null===(s=(t=this._delegates).onInteractionReady)||void 0===s||s.call(t,e.success,null!==(i=e.feature)&&void 0!==i?i:void 0)}async resizeFrame(e){this._isResizable&&this._resize(e)}async resize(e){return{frame:{...this._resize(e.size),resizable:this._isResizable?"both":"none"}}}_resize(e){var t,s,i,n,r,a,o;const{width:l,height:c}=null!==(i=null===(s=(t=this._delegates).handleResize)||void 0===s?void 0:s.call(t,e))&&void 0!==i?i:{width:Math.max(null!==(r=null===(n=this._container.view.frame.parentElement)||void 0===n?void 0:n.clientWidth)&&void 0!==r?r:0,e.width),height:0===e.height?null!==(o=null===(a=this._container.view.frame.parentElement)||void 0===a?void 0:a.clientHeight)&&void 0!==o?o:0:e.height};return this._container.view.resize({width:l,height:c}),{width:l,height:c}}async requestClose(){var e,t;this._container.manifest.id;null===(t=(e=this._delegates).onClose)||void 0===t||t.call(e),setTimeout((()=>{this._container.gracefullyUnloadApplet().finally((()=>{var e,t;return null===(t=(e=this._delegates).onTerminate)||void 0===t?void 0:t.call(e)}))})),this._container.view.frame.style.display="none"}async startDragMove(e){var t,s;await(null===(s=(t=this._delegates).onDragMove)||void 0===s?void 0:s.call(t,null==e?void 0:e.clickTarget))}async log(e){this._logger.log(e.level,e.message,e.data,"",-1,-1,"")}async openURL(e){if(null==self.open(e.url,"_blank","noopener"))throw new Error("Failed to open URL")}async triggerSettingsMenu(e){var t,s;null===(s=(t=this._delegates).onSettingsMenu)||void 0===s||s.call(t)}}class M{constructor(e,t,s){this.registry=s,this._nextInstanceId=0,this._running=new Map,this._logger=p.Y.create("GOSRuntimeHost"),this._root=new n._y(e,s).withContainerFactory(new x.K),this._background=t}createContext(){return new n._y(this._root)}getAppletContainer(e){return this._running.get(function(e){return JSON.parse(e)}(e).instanceId)}createUIAppletContainer(e,t={},s=this._root,i=!0){const r=this._nextInstanceId++;this._registerForwardingServices(s,((e,t)=>this._background.dispatchAction(r,e,t)));const a=s.createAppletView(e);this._running.set(r,a);const o=new n.GO(((e,t)=>a.rpc.call(e,t))),l=s.environment.makeLogger(e),c=new O(a,{...t,onVisuallyReady:()=>{var e;null===(e=t.onVisuallyReady)||void 0===e||e.call(t),i&&o.start({entryPoint:"ideation",entryPoint2:"ideation",assistantMode:"genAIAndRevision",theme:{flatUI:!0,logoVersion:"february2024"},partialPageModeEnabled:!1,showPartialPageModeNotification:!1}).catch((e=>this._logger.error(e)))}},l);return a.objects.register(n.xe.objectName,new n.xe(c)),a.onBeforeUnload((()=>{this._running.delete(r),this._background.dispose(r)})),{applet:a,host:c,start:async e=>await o.start(e)}}forceTerminate(e){this._logger.warn(`Force terminating applet: ${e.manifest.id}`),this._running.forEach(((t,s)=>{t===e&&this._running.delete(s)}));try{e.unloadApplet(),e.objects.dispose(),e.rpc.dispose()}catch(e){this._logger.error(`Failed to force terminate applet: ${e}`)}}_registerForwardingServices(e,t){e.registerObject(n.Wr.objectName,new n.Wr(new n.ik(t))),e.registerObject(n.Ng.objectName,new n.Ng(new n.c3(t))),e.registerObjectFactory(n.HF.objectName,(()=>new n.HF(new n._2(t))))}}class R{static get shared(){return null===this._instance&&(this._instance=new R(new i.h((0,h.OB)().browserApi.preferences))),this._instance}constructor(e){this.store=e,this._cache=null,this.onReady=e.get(["extensionSettings"]).then((({extensionSettings:e})=>{this._settings=e})).catch((()=>{}))}get _state(){return null===this._cache&&(this._cache=this._create()),this._cache}_create(){const e=new r({getChannel:()=>{var e,t;return null!==(t=null===(e=this._settings)||void 0===e?void 0:e.common.gOSAppletChannel)&&void 0!==t?t:"stable"},getAssistantAppletUrl:()=>{var e,t;return null!==(t=null===(e=this._settings)||void 0===e?void 0:e.common.gOSAssistantAppletUrl)&&void 0!==t?t:null}}),t=new g,s=new M(_(this.store,(0,h.OB)()),t.api,e);return{registry:e,client:t,host:s,server:new S(t,new b(s))}}get registry(){return this._state.registry}get host(){return this._state.host}dispose(){null!==this._cache&&(Object.values(this._cache).forEach((e=>"dispose"in e&&e.dispose())),this._cache=null)}}R._instance=null},80252:(e,t,s)=>{s.r(t),s.d(t,{SkillServiceFactory:()=>O});var i=s(64271),n=s(81446),r=s(59179),a=s(58303),o=s(84358),l=s(85111),c=s(44935),h=s(8045),g=s(71782),d=s(65391),u=s(30646),p=s(62552),_=s(72106),m=s(12518),v=s(29148),w=s(99208),y=s(32082),S=s(47835),f=s(53810),b=s(45013);class x{constructor({gOS:e,createEditSession:t,changes:s,domain:i}){this._logger=y.Y.create("SkillService"),this._defaultSkillRequestsValue={size:{width:416,height:245},close:!1},this._bg=new w.X(new v.rr(S.xh,(0,b.OB)().message)),this._running=null,this._requests=new p.X(this._defaultSkillRequestsValue),this._skills=new p.X([]),this._gOS=e,this._createEditSession=t,this._editorChanges=s.subscribe((({selection:e,document:t})=>{if(null==this._running)return;const s=new u.RS(this._running.rpc.call.bind(this._running.rpc));e&&s.selectionUpdated(null),t&&s.textUpdated(null)})),this._domain=i}dispose(){this._editorChanges.unsubscribe()}get skillRequests(){return this._requests.asObservable()}get skills(){return this._skills.asObservable()}getSkills(){return _.Y3((async()=>{try{const e=await this._bg.api.getSkills();return this._skills.next(e),e}catch(e){throw new Error(`Failed to get skills: ${e}`)}}),m.KC)}initSkill(e,t){return null!=this._running&&this._gOS.forceTerminate(this._running),this._bg.api.onSkillLaunch(e.id).catch((e=>{this._logger.error(`Failed to record skill accessed: ${e}`)})),_.Y3((()=>new Promise((s=>{const i={kind:"ui",id:`skill-${e.id}`,displayName:e.displayName,entryPoint:d.U.createUrlWithHashParams({...e,skillParams:{startupOptions:{domain:this._domain}}}),version:"1.0.0"};this._gOS.registry.register(i);const n=this._gOS.createContext().withContainerFactory(new f.K(t)).withEditSession(this._createEditSession(i.id)),{applet:r}=this._gOS.createUIAppletContainer((0,u.SP)(i),{onInit:e=>{this._requests.next({...this._requests.getValue(),size:e.initialSize}),s(e.initialSize)},handleResize:e=>(this._requests.next({...this._requests.getValue(),size:e}),e),onClose:()=>{this._requests.next({...this._requests.getValue(),close:!0})}},n);this._running=r,this._requests.next(this._defaultSkillRequestsValue)}))),m.KC)}terminateSkill(e){return _.Y3((async()=>{if(null==this._running)return;const t=(0,u.SP)({kind:"ui",id:`skill-${e.id}`});if((0,u.SP)(this._running.manifest)!==t)return;const s=this._running;this._running=null,await s.gracefullyUnloadApplet()}),m.KC)}}class O{constructor(e,t,s,i,n,r,a,o){this._state=e,this._domain=t,this._experimentClient=s,this._selectionOrCaretPosition=i,this._activeSelectionRange=n,this._replacementServiceInjector=r,this._textObserver=a,this._selectionService=o}create(){var e;let t;const s=a.ij(this._state.view("dynamicConfig","appActions").get()),d=a.ij(this._state.view("dynamicConfig","gOSCustomization").get());{const a=o.dH((e=>e.disableByDomain.some((e=>new RegExp(e).test(this._domain)))),!1)(s);if((0,c.V)(this._experimentClient)&&!a){const s=null===(e=o.dH((e=>{var t;return null!==(t=e.rules)&&void 0!==t?t:[]}),[])(d).find((e=>new RegExp(`${e.domainPattern}$`).test(this._domain))))||void 0===e?void 0:e.capabilities;this._selectionOrCaretPositionSubscribtion=this._selectionOrCaretPosition.subscribe(n.wW(this._activeSelectionRange));const a=this._activeSelectionRange.view();t=new x({gOS:h.C.shared.host,createEditSession:e=>(0,g.wr)({appletId:e,replacementService:this._replacementServiceInjector.create(l.P.gOsSkillApplet),textObserver:this._textObserver,selectionService:this._selectionService,selectionRange:a,capabilities:s}),changes:(0,i.T)(a.pipe(r.U((()=>({selection:!0,document:!1})))),this._textObserver.contentChanges.async.pipe(r.U((()=>({selection:!1,document:!0}))))),domain:this._domain})}}return t}dispose(){this._selectionOrCaretPositionSubscribtion.unsubscribe()}}},71782:(e,t,s)=>{s.d(t,{wr:()=>l});var i=s(90023),n=s(36807),r=s(84358),a=s(58303);class o{constructor(e){this._options=e}partialPageModeNotificationDismissed(e){return Promise.resolve()}async getCapabilities(){var e;const t=JSON.parse(JSON.stringify(null!==(e=this._options.capabilities)&&void 0!==e?e:{}));switch(this._options.type){case"plaintext":return{insertText:"yes",insertTextWithFormatting:"no",insertTextWithImages:"no",insertTextWithLinks:"no",...t,pasteImages:"no"};case"richtext":return{insertText:"yes",insertTextWithFormatting:"unknown",insertTextWithImages:"unknown",insertTextWithLinks:"unknown",...t,pasteImages:"no"};case"gDocs":return{insertText:"yes",insertTextWithFormatting:"yes",insertTextWithImages:"yes",insertTextWithLinks:"yes",...t,pasteImages:"no"}}}async setSelection({range:e}){this._options.setSelection(e)}async getDocumentState({withSelection:e}){var t;let s;e&&(s=null!==(t=this._options.getSelection().find(Boolean))&&void 0!==t?t:{start:0,end:0});return{doc:{ops:this._options.getText().ops},selection:s}}async pasteImage(e){throw new Error("Not supported")}async _copyToClipboard(e){const t={};["image/png","text/html","text/plain"].includes(e.type)?t[e.type]=e:(t[`web ${e.type}`]=e,e.type.startsWith("image/")&&(t["text/html"]=new Blob([`<img src="${URL.createObjectURL(e)}">`],{type:"text/html"}))),await navigator.clipboard.write([new ClipboardItem(t)])}async copyImage({data:e,format:t}){const s=await async function(e,t){if(!["png","gif","jpeg"].includes(e))throw new Error(`Unsupported format: ${e}`);const s=await fetch(`data:image/${e};base64,${t}`);return await s.blob()}(t,e);await this._copyToClipboard(s)}async copyText({text:e}){await navigator.clipboard.writeText(e)}async insertText({text:e}){await this._options.replaceText(e)}async insertAtCaret({delta:e}){"gDocs"===this._options.type?await this._options.insertAtCaret(new n.i(e.ops)):await this._options.replaceText(new n.i(e.ops))}async applyDelta({delta:e,range:t}){await this._options.replaceText(new n.i(e.ops),t)}}function l(e){var t;const s=null!==(t=e.capabilities)&&void 0!==t?t:{};return new o({type:e.replacementService.capabilities,capabilities:{insertText:c(s.insertText),insertTextWithFormatting:c(s.insertTextWithFormatting),insertTextWithImages:c(s.insertTextWithImages),insertTextWithLinks:c(s.insertTextWithLinks),pasteImages:c(s.pasteImages)},getSelection:()=>(0,i.zG)(e.selectionRange.get(),r.dH((e=>[e]),[])),setSelection:async t=>{if("setSelectionAsync"in e.selectionService){const s=await e.selectionService.setSelectionAsync(t);if("selectionError"===s.kind)throw new Error(s.reason)}else e.selectionService.setSelection(t)},getText:()=>e.textObserver.getTextSource().getRichText(),insertAtCaret:async t=>e.replacementService.insertAtCurrentSelection(t,void 0,{gOS:{appletId:e.appletId}}),replaceText:async(t,s)=>{await e.replacementService.performReplacement({pos:null!=s?s:(0,i.zG)(e.selectionRange.get(),a.fS((()=>({start:0,end:0})))),value:t},{gOS:{appletId:e.appletId}})}})}function c(e){if("yes"===e||"no"===e||"unknown"===e)return e}},47835:(e,t,s)=>{s.d(t,{V:()=>n,XI:()=>i,xh:()=>r});const i="gOS-bg-d5ccc5edf7e1",n="gOS-fg-d5ccc5edf7e1",r="skills-bg-d5ccc5edf7e1"},44935:(e,t,s)=>{s.d(t,{V:()=>r,X:()=>a});var i=s(95804),n=s(88657);function r(e){return e.isGateEnabled(i.K.GOSRollout)||"test"===e.getTreatment(n.p.GOSRollout)}function a(e){return!!r(e)&&(e.isGateEnabled(i.K.OggyOnGOS)||"test"===e.getTreatment(n.p.OggyOnGOS))}}}]);