import{p as d,h as S,l as f,m as b,w as D,a as h,X as E,q as k,g as v,o as x}from"./start-BFd-djfI.js";import{DocumentGroupToken as A}from"./index-DnatBlUk.js";import"./PluginModule-CRib3PLZ-B43Hjk20.js";import"./PluginDependency-Boc6-pxl-tjuTwLTj.js";var G=Object.defineProperty,w=r=>{throw TypeError(r)},M=(r,e,t)=>e in r?G(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,P=(r,e,t)=>M(r,e+"",t),C=(r,e,t)=>e.has(r)||w("Cannot "+t),m=(r,e,t)=>(C(r,e,"read from private field"),t?t.call(r):e.get(r)),R=(r,e,t)=>e.has(r)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),u;class O{constructor(e){R(this,u,new AsyncDisposableStack),P(this,"id"),this.id=e}use(e){return m(this,u).use(e)}async[Symbol.asyncDispose](){await m(this,u).disposeAsync()}}u=new WeakMap;var _=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),g=r=>{throw TypeError(r)},y=(r,e,t)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&g("Object expected");var o;t&&(o=e[_("asyncDispose")]),o===void 0&&(o=e[_("dispose")]),typeof o!="function"&&g("Object not disposable"),r.push([t,o,e])}else t&&r.push([t]);return e},T=(r,e,t)=>{var o=typeof SuppressedError=="function"?SuppressedError:function(a,p,n,s){return s=Error(n),s.name="SuppressedError",s.error=a,s.suppressed=p,s},c=a=>e=t?new o(a,e,"An error was suppressed during disposal"):(t=!0,a),i=a=>{for(;a=r.pop();)try{var p=a[1]&&a[1].call(a[2]);if(a[0])return Promise.resolve(p).then(i,n=>(c(n),i()))}catch(n){c(n)}if(t)throw e};return i()};const V=r=>d(r.getPlugin("monitoring"),S(e=>r.registerExecutionScopeReviver("document-group",(t,o,{groupId:c})=>(f.verbose('Reviving document group execution scope "'.concat(t.name,'"'),t),d(o.resolve(e.provides.Monitoring),b(i=>$(t,c,i)),D,h(()=>t.start()))))));async function $(r,e,t){var o=[];try{const p=y(o,t.duration("create_document_group_foreground")),n=y(o,new AsyncDisposableStack,!0),s=new O(e);return f.verbose({context:s.id},"Created a document group."),await d(r.register({token:A,useValue:s}),E.use(n),h(()=>r.start()),k(v(()=>s.use(n.move()))),x(v(l=>{p.close(l),f.error("Failed to create a document group:",l,{context:s.id})})))}catch(p){var c=p,i=!0}finally{var a=T(o,c,i);a&&await a}}export{V as activate};
//# sourceMappingURL=index-BM-moq3b.js.map
