import{p as d,h as S,l as f,m as b,w as D,a as h,a1 as E,q as k,d as v,o as x}from"./index-uVYElzgq.js";import{DocumentGroupToken as A}from"./index-BMGZtqT4.js";import"./PluginModule-CRib3PLZ-LTQDm_KX.js";import"./PluginDependency-Boc6-pxl-tjuTwLTj.js";var G=Object.defineProperty,w=r=>{throw TypeError(r)},M=(r,e,t)=>e in r?G(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,P=(r,e,t)=>M(r,e+"",t),C=(r,e,t)=>e.has(r)||w("Cannot "+t),m=(r,e,t)=>(C(r,e,"read from private field"),t?t.call(r):e.get(r)),R=(r,e,t)=>e.has(r)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),u;class O{constructor(e){R(this,u,new AsyncDisposableStack),P(this,"id"),this.id=e}use(e){return m(this,u).use(e)}async[Symbol.asyncDispose](){await m(this,u).disposeAsync()}}u=new WeakMap;var _=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),y=r=>{throw TypeError(r)},g=(r,e,t)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&y("Object expected");var a;t&&(a=e[_("asyncDispose")]),a===void 0&&(a=e[_("dispose")]),typeof a!="function"&&y("Object not disposable"),r.push([t,a,e])}else t&&r.push([t]);return e},T=(r,e,t)=>{var a=typeof SuppressedError=="function"?SuppressedError:function(o,p,n,s){return s=Error(n),s.name="SuppressedError",s.error=o,s.suppressed=p,s},c=o=>e=t?new a(o,e,"An error was suppressed during disposal"):(t=!0,o),i=o=>{for(;o=r.pop();)try{var p=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(p).then(i,n=>(c(n),i()))}catch(n){c(n)}if(t)throw e};return i()};const V=r=>d(r.getPlugin("monitoring"),S(e=>r.registerExecutionScopeReviver("document-group",(t,a,{groupId:c})=>(f.verbose('Reviving document group execution scope "'.concat(t.name,'"'),t),d(a.resolve(e.provides.Monitoring),b(i=>$(t,c,i)),D,h(()=>t.start()))))));async function $(r,e,t){var a=[];try{const p=g(a,t.duration("create_document_group_foreground")),n=g(a,new AsyncDisposableStack,!0),s=new O(e);return f.verbose({context:s.id},"Created a document group."),await d(r.register({token:A,useValue:s}),E.use(n),h(()=>r.start()),k(v(()=>s.use(n.move()))),x(v(l=>{p.close(l),f.error("Failed to create a document group:",l,{context:s.id})})))}catch(p){var c=p,i=!0}finally{var o=T(a,c,i);o&&await o}}export{V as activate};
//# sourceMappingURL=index-C-c2f2Oy.js.map
