(self.webpackChunk=self.webpackChunk||[]).push([[1196],{13319:(e,t,i)=>{i.r(t),i.d(t,{PlagiarismViewModelImpl:()=>g,createPlagiarismEntities:()=>m,createPlagiarismViewModels:()=>pe,setupSduiManagement:()=>Ie});var a=i(95922),s=i(90023),r=i(59179),l=i(58303),n=i(48302),o=i(30383),c=i(55013),d=i(39953),u=i(13391),p=i(84358);class g{constructor(e,t){this._plagiarismViewModelsFactory=e,this._wrapNotifyPayload=t,this.isShouldShowPlagiarismButton=u.h.create(!1),this.plagiarismButtonActions=u.h.create(l.YP),this.plagiarismEngine=u.h.create(l.YP)}setShowPlagiarismButton(e){this.isShouldShowPlagiarismButton.set(e)}setPlagiarismButtonActions(e){this.plagiarismButtonActions.set(l.G(e))}setPlagiarismEngine(e){this.plagiarismEngine.set(l.G(e))}openPlagiarismPage(){const e=this._plagiarismViewModelsFactory();this.setPlagiarismEngine(e),l.pC(this.plagiarismButtonActions.get())&&(0,d.zG)(this.plagiarismButtonActions.get(),p.MH,e.handleSduiAction)}closePlagiarismPage(){(0,d.zG)(this.plagiarismEngine.get(),p.bw((e=>e.handleSduiAction(this._wrapNotifyPayload([{type:"disablePlagiarismCheck"}],"")))))}}function m(e,t,i){const d=(e,t,i,a)=>a.forEach((a=>{switch(a.type){case"notify":return void t.sduiFeedbackService.sendUserAction(a.sourceId||i.sourceId,a.userAction);case"enablePlagiarismCheck":return void e.openPlagiarism();case"closePopover":return void t.sduiManager.popoverManager.removePopover(a.rootPopoverId);case"interactPopover":switch((0,s.zG)(t.sduiManager.popoverManager.getInteractionActions(a.rootPopoverId,a.popoverViewId,a.interaction),(a=>d(e,t,i,a))),a.interaction){case n.fP.Fulfill:case n.fP.Dismiss:t.sduiManager.popoverManager.removePopover(a.rootPopoverId)}return;default:return}})),u=t=>({handleGButtonPopoverAction:i=>{l.pC(e)&&d(t,e.value,i,i.actions)}});return(0,s.zG)(e,l.g_((()=>l.YP),(e=>{const s=t({sduiEngine:e,...i});return l.G({plagiarismVM:new g((0,a.of)(s),c.Zq),plagiarismButtonSub:e.sduiManager.state.pipe(r.U((e=>o.D1.GButton.getPlagiarismContent(e)))),popover:(n=e.sduiManager,n.popoverManager.activePopoverView.view(l.tS((e=>"component"===e.anchor.kind&&"gButton:plagiarism"===e.anchor.id?l.G(e):l.YP)))),popoverActionsHandler:u,trackPlagiarismAlertsEditing:s.trackPlagiarismAlertsEditing});var n})))}var h=i(25437),v=i(44755),f=i(57505),A=i(30962),b=i(27604),I=i(18402),P=i(4661),S=i(96885),C=i(23233),w=i(78804),y=i(42832),E=i(16730),M=i(83147),k=i(66337),R=i(9164),F=i(75440),B=i(9055),U=i(84722),L=i(69841),D=i(31491),G=i(68330),z=i(84714),T=i(84178),q=i(90517),x=i(63532),H=i(74822),O=i(36344),V=i(84308),W=i(954),j=i(78129),Q=i(68340),_=i(55341),Y=i(10883),Z=i(79451),K=i(72111),X=i(12518),N=i(59833),$=i(17572),J=i(88347),ee=i(98217),te=i(46011),ie=i(45796),ae=i(65246),se=i(98519),re=i(13217),le=i(18222),ne=i(55063),oe=i(90944),ce=i(6622),de=i(25645),ue=i(93249);const pe=({sduiEngine:e,engine:t,capiProxy:i,ded:a,showPlagiarismAlerts:n,environment:o})=>{const c=K.C8.Logging.getLogger("gDocs.PlagiarismEngine"),d=new G.w.Keeper,g=new ee._(e.sduiManager.state),m={features:new Set([C.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:M.j.Density.minimal,shouldAnimateAlertApply:C.IG.Default.shouldAnimateAlertApply,cardVisualMode:u.h.create(M.j.CardVisualMode.RegularLightMode)},E=(0,C.Ls)((()=>X.t$({kind:"default",error:new Error("should not use hydration to render sdui cards")})),t.alertsReader,m,(()=>z.of(l.YP)),l.YP),D=de.p.getCapabilities(E,t.alertsReader),Y=(0,s.a9)(s.yR),J=e=>Y,pe=b.t.create(b.t.defaultLensFilters,{...b.t.defaultTextFilters,[h.R.SpecialId.Closed]:s.jv,[h.R.SpecialId.AllAlerts]:v.bZ.belongsToAllAlerts}),he=u.h.create(f.A.defaultState),ve=new le.t(he.view("lenses"),pe,t.sessionModel.scoreStatus),fe={create:(e,t)=>R.v.WithSuccess.create(e,t,de.p.equatable.structEq,de.p.defaultOrd(D))},Ae=F.v.createWithExternalItems(fe,D),be=new I.F.Impl(t.alertsList.state,t.positionManager,t.alertsReader,pe.alertCanBeDisplayed),Ie=new U.oq(t.alertsList.state,t.alertsReader,he.view("lenses"),be,ve,((e,t,i,a,r)=>((e=>{(0,s.zG)(e,p.bw((e=>{d.push(g.feed.pipe(T.q(1),q.j("cards"),x.b((0,s.ls)(Z.vh.filter(s.jv,s.jv,(t=>t.alertIds.includes((0,s.MZ)(e.alert.id)))),Z.vh.foldMap(N.uZ())((0,s.a9)(N.cS),(0,s.a9)(N.cS),N.of),N.YM,p.bw((e=>{requestAnimationFrame((()=>{(0,s.zG)(g.focusCard(e.id),X.g_((e=>c.warn("Error on focusing SDUI item in a new lens",e)),s.Q1))}))}))))).subscribe())})))})(a),Ae(e,t,i,a,(0,s.zG)(r,l.hX((e=>h.R.isWithAlertsId(e.id))))))),J,D,pe),Pe=u.h.create(Ie.emptyState(h.R.SpecialId.Plagiarism).patch({alertSource:v.l$.sidebar})),Se=R.v.Items.getRemoveDisposedItemsTransformer(D),Ce=te.i.DisablePrevNextButtons.create(D),we=R.v.Items.getItemsPositionsUpdateTransformer(D),ye=S.Py.getDefaultBehavior(de.p.getActiveFocusableItem,D),Ee=u.h.create(!0),Me=u.h.create(h.R.SpecialId.AllAlerts),ke=(0,S.u0)((()=>a.getCursor().index),Ie),Re=(0,S.VC)(Ie,ke,Me,D,(()=>!1),(()=>!1)),Fe=S.sR.getStateTransformer(ye,Re,D,S.sR.getShouldAutoFocus(Ee,t.alertsReader,de.p.getActiveItemWithAlert),s.Q1,Me),Be=(0,s.ls)(Se,$.L9(Fe),$.L9(Ce),$.L9(we)),Ue=new P.Xx({flush:()=>a.flushChanges()},new H.x,E,t.alertsService,t.alertsReader,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,s.zG)(t.mutedAlertsCategoriesModel,l.UI((e=>({model:e,openSuggestionsManagement:()=>self.open((0,oe.Um)().suggestionsSettings)})))),l.YP,s.jv,de.p.getActiveFocusableItem,D,o,{bufferTransitions:!0,showGbPrompt:!1}),Le=new ie.q(e.sduiFeedbackService,D,Pe,e.sduiManager,g,t.alertsReader,{...e.capiClient,...t.writingExpertClient},Ue,o),De=(0,s.zG)(S.sR.focusFirstCardAfterBigCheck(Pe,u.h.create(i.checkingState),u.h.create(!0),{bigPaste:O.E}),(e=>S.sR.getSideEffect(e,D))),Ge=(0,ne.xl)(Pe,pe,z.of(),u.h.create(!1),u.h.create(!0)),ze=V.a([Ge,n]).pipe(r.U((([e,t])=>t?e:s.jv))),Te=new ne.o$(t.alertsList,t.alertsReader,t.positionManager,t.alertsService,a,Pe,ze,de.p.getActiveFocusableItem,u.h.create(!1),z.of(void 0),!1),qe=new w.o((()=>X.F2(void 0))),xe=(0,se.hp)(Pe,Te,qe,a,c),He=t.alertsReader,Oe=Pe.view(k.nL.getActiveAlertHighlight(de.p.getActiveFocusableItem)),Ve=new A.mN(a,Te,t.alertsReader,Oe,Pe.view((e=>e.currentLens.meta.filter))),We=[De,ae.P.SideEffects.createSDUIFeedSideEffect({...D,findNextAlert:(0,s.a9)(l.YP),selectItemByAlert:()=>s.yR},g.feed.pipe(r.U(l.G),W.O(l.YP),j.G(),r.U((([e,t])=>(0,s.zG)(p.gz(e,t),l.hX((([e,t])=>e.feedId===t.feedId)),l.UI((([,e])=>({...e,cards:(0,s.zG)(e.cards,Z.vh.filter(s.jv,s.W8,s.W8))}))),l.wp((()=>t))))),Q.oA),de.p.sduiToChecksFeedOrd(D),t.alertsReader),ge(g,D),...Le.getApplicatorEffects(),...Ue.getApplicatorEffects(),P.dv.changeAlertEffect(Pe,Ue,E,de.p.getActiveFocusableItem,t.alertsReader,l.G(xe),ke,c.getLogger("CardsViewModelEffects.changeAlertEffect")),y.R7(Pe,qe,D,(0,s.MZ)(Ue.actionEvents)),me(Le.sduiActionEvents,z.of(!0),D),(0,re.A7)(Ve,Pe,!0),L.EQ.focusMarkByActiveAlert(Pe,Te,He,de.p.getActiveFocusableItem,c.getLogger("MarksEffects.focusMarkByActiveAlert")),L.EQ.highlightMarkByHighlightedCard(Ue,Pe,Te,He,D,c.getLogger("MarksEffects.highlightMarkByHighlightedCard")),(je=Le.sduiActionEvents,Qe=ue.u,{id:"sduiCopyToClipboardEffect",when:h.R.isWithAlertsId,what:k.nL.Effect.Applicator.create(je.pipe(r.U((e=>t=>(e.actions.forEach((e=>{"copyToClipboard"===e.type&&(0,ce.vQ)(e.text).then((()=>Qe.enqueue("referenceCopied")))})),t)))))})];var je,Qe;const _e=new B.l(Pe,Ie,t.alertsReader,t.alertsService,We,de.p.getActiveFocusableItem,Be),Ye=new _.t;return{...e,checksFeedFlow:()=>de.p.createCardListFlow(Ue)(Ue,Pe.lens(k.nL.Prism.getLens()),Ye,z.of(!1),D,de.p.listItemOrd),sduiFeedManager:g,handleSduiAction:e=>{Le.sduiActionEvents.next(e)},capabilities:D,lensState:Pe,trackPlagiarismAlertsEditing:Te.getPlagiarismAlertsEditingTracker(),dispose:()=>{_e.dispose(),Ue.dispose(),Le.dispose(),d.dispose()}}};function ge(e,t){return{id:"SDUIItemRemoveSideEffect",when:h.R.isWithAlertsId,what:k.nL.Effect.Applicator.create(e.feed.pipe(r.U((e=>i=>{const a=(0,s.zG)(e.cards,Z.vh.reduce([],((e,a)=>(0,s.zG)(i.currentLens.items.get(a.id),l.UI((0,J.ei)("value")),l.hX((0,D.Kg)((0,s.ff)(E.o.isAnimatable),(0,s.ff)(E.o.isAnimatingRemoval))),l.UI(t.remove(s.W8,s.W8)),l.g_((()=>e),(t=>(e.push(t),e))))),s.yR,s.yR));if(a.length>0){const e=i.currentLens.items.add(a);return k.nL.Prism.getLens().compose(R.v.Prism.items).set(e,i)}return i}))))}}function me(e,t,i){return{id:"sduiFocusEffect",when:h.R.isWithAlertsId,what:k.nL.Effect.Applicator.create(e.pipe(Y.M(t),r.U((([{actions:e,cardId:t},a])=>r=>a&&Boolean(e.find((e=>"notify"===e.type&&"focus"===e.userAction)))&&k.nL.hasItems(r)?(0,s.zG)(k.In.getActiveItemOfType(de.p.isAlertRefSDUI)(r.currentLens),l.hX((e=>!["focused","removed"].includes(e.visualState.transition.type))),l.UI((()=>k.nL.Prism.getLensWithItems().modify(i.selectItemById((0,s.MZ)(t)),r))),l.fS((0,s.a9)(r))):r))))}}var he=i(9273),ve=i(20302),fe=i(76528),Ae=i(92484),be=i(25969);function Ie(e,t,i){const a=e.view((e=>(0,d.zG)(e,l.UI((e=>e.sduiBufferService.capiEvents.pipe(he.filter(ve.hX.is("sdui_add","sdui_remove","sdui_update")),he.filter(fe.e.isSduiEvent),he.map(Ae.al.fromSource(Ae.i5.CAPI))))),p.MH))).get(),s=new be.A(i,a,t),{sduiFeedbackService:r,capiClient:n}=e.view((e=>(0,d.zG)(e,l.UI((e=>({sduiFeedbackService:e.sduiFeedbackService,capiClient:e.capiClient}))),p.MH))).get();return{sduiFeedbackService:r,capiClient:n,sduiManager:s}}},25645:(e,t,i)=>{i.d(t,{p:()=>a});var a,s=i(24332),r=i(90023),l=i(39953),n=i(44755),o=i(51039),c=i(60812),d=i(16730),u=i(66337),p=i(9164),g=i(64297),m=i(31491),h=i(58303),v=i(14944),f=i(68338),A=i(65246),b=i(56241),I=i(8836),P=i(68945),S=i(30383);!function(e){const t=e=>(0,l.zG)(u.In.getActiveItemOfType(a)(e),h.tS(A.P.Capabilities.toAlertItem));function i(e){return u.nL.Items.mapper((e=>e.kind),{[A.P.Kind]:e})}function a(e){return e.kind===A.P.Kind}function C(){return{viewState:()=>e=>e.kind===A.P.Kind?{view:e,kind:"alertRefSDUI"}:{}}}e.isSelectableItem=a,e.getActiveItemWithAlert=t,e.getActiveFocusableItem=e=>t(e),e.checksFeedItemsMapper=i,e.isAlertRefSDUI=a,e.defaultOrd=t=>(0,s.g_)(v.iP())([(0,l.zG)(v.C2,v.Uz((0,m.ff)(A.P.Item.isBulkAcceptSDUI))),(0,l.zG)(v.C2,v.Uz(A.P.Item.isBulkDismissSDUI)),e.getByActiveAlertPositionOrd(t)]),e.sduiToChecksFeedOrd=function(t){return i=>v.Zt(((a,s)=>b.e.isSDUIItem(a)&&b.e.isSDUIItem(s)?b.e.getOrd(i).compare(a,s):e.getByActiveAlertPositionOrd(t).compare(a,s)))},e.getByActiveAlertPositionOrd=e=>(0,s.g_)(v.iP())([(0,l.zG)(n.h$.ordHRange,v.Uz((t=>(0,l.zG)(e.hasActiveAlert(t),h.UI((e=>e.alert)),h.fS((()=>({getHighlightRanges:()=>[{start:0,end:0}]})))))))]),e.item=()=>f.UI.Union.make("kind",{alertRefSDUI:I.p.SquashedListCard(),empty:P.Q.Empty}),e.viewState=C,e.createCardListFlow=e=>(0,o.sJ)((t=>{switch(t.key){case"empty":break;case"alertRefSDUI":e.actionEvents.next(t.action);break;default:(0,g.L0)(t)}})),e.listItemOrd=e=>v.Uz((e=>e.cell.item.view))(e).compare;const w={equals:(e,t)=>e.kind===t.kind&&c.s.eqById.equals(e,t)},y=e=>({equals:(t,i)=>{const a={[A.P.Kind]:e};return w.equals(t,i)&&(s=e=>e.kind,r=a,(e,t)=>r[s(e)].equals(e,t))(t,i);var s,r}});function E(){return{changePosition:e=>i(A.P.Capabilities.changePosition(e))}}function M(){return{completeTransition:e=>i(A.P.Capabilities.animatable.completeTransition(e)),transitionTo:e=>i(A.P.Capabilities.animatable.transitionTo(e)),changeVisualState:e=>i(A.P.Capabilities.animatable.changeVisualState(e))}}function k(){return{select:(e,t)=>i(A.P.Capabilities.select.select(e,t)),selectByAlert:(e,t,a)=>i(A.P.Capabilities.select.selectByAlert(e,t,a)),unselect:(e,t)=>i(A.P.Capabilities.select.unselect((0,r.MZ)(e),t))}}function R(){return{removeAlertFromItem:(e,t)=>i((i=>i.id===S.D1.SuccessReport.ID?i:A.P.Capabilities.removeAlert.removeAlertFromItem(e,t)(i)))}}function F(){return{remove:(e,t)=>i(A.P.Capabilities.remove.remove(e,t))}}function B(){return{updateWithAlerts:e=>i(r.yR)}}function U(){return{nextAlert:i((()=>h.YP)),prevAlert:i((()=>h.YP))}}function L(){return{updateUserInput:e=>i(r.yR)}}e.equatable={structEq:y(A.P.eq),idEq:y(w),visualStateEq:y(A.P.eq)},e.changePosition=E,e.disposable={isScheduledToDispose:i(A.P.Capabilities.disposable.isScheduledToDispose)},e.hidable={isHidden:i(d.o.isHidden)},e.animatableItem=M,e.hasAlertsQueries={isSelectableByAlert:e=>i(A.P.Capabilities.hasAlerts.isSelectableByAlert(e)),hasAlert:e=>i(A.P.Capabilities.hasAlerts.hasAlert(e)),hasActiveAlert:i(A.P.Capabilities.hasAlerts.hasActiveAlert)},e.changePositionStrategyQueries={useReferenceHeightOnRemove:i(r.jv)},e.select=k,e.removeAlert=R,e.remove=F,e.updateWithAlert=B,e.releaseAlert=()=>p.v.Capabilities.getAlertReleaser({...R(),...e.disposable}),e.unselectable=()=>p.v.Capabilities.getUnselectable(u.In.getActiveItem,{...k(),isScheduledToDispose:r.jv}),e.selectableByAlert=()=>p.v.Capabilities.getSelectableByAlert(u.In.getActiveItem,{...e.hasAlertsQueries,...k(),...p.v.Capabilities.getHasChecksFeed(),...e.disposable}),e.selectableById=()=>p.v.Capabilities.getSelectableById(u.In.getActiveItem,{...k(),isScheduledToDispose:r.jv}),e.updateMeta=()=>({updateMeta:p.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=e=>p.v.Capabilities.getAnimatable(e,{...R(),...M(),...p.v.Capabilities.getHasChecksFeed()}),e.alignable={isValidToAlign:i((t=>!e.disposable.isScheduledToDispose(t)))},e.alertIterator=U,e.itemReleaser=()=>p.v.Capabilities.getItemReleaser(),e.hasAlerts=p.v.Capabilities.getHasAlerts,e.hasUserInput=L,e.verifiable=()=>p.v.Capabilities.getVerifiable(e.disposable),e.cloneable=()=>({clone:i(c.s.Capabilities.getPojoCloneable().clone)});const D={getFeatures:i((e=>A.P.Item.isBulkDismissSDUI(e)?[A.P.Features.BulkDismiss]:A.P.Item.isBulkAcceptSDUI(e)?[A.P.Features.BulkAccept]:[]))};e.getCapabilities=function(t,i){return{...C(),...e.disposable,...e.hidable,...e.equatable,...L(),...e.cloneable(),...E(),...M(),...k(),...F(),...R(),...B(),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t),...e.unselectable(t),...e.selectableByAlert(t),...e.selectableById(t),...e.updateMeta(t),...e.animatableFeed(t),...e.itemReleaser(),...D,shouldAnimatePositionChange:()=>()=>!1,...e.verifiable(),...e.cloneable(),...e.hasAlerts(U(),i,(()=>e.isSelectableItem),{...e.hasAlertsQueries,...e.disposable})}}}(a||(a={}))},6622:(e,t,i)=>{if(i.d(t,{Sz:()=>r,vQ:()=>s}),6168!=i.j)var a=i(12518);async function s(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function r(e,t=self){return s(e,t).then((()=>a.F2(void 0))).catch((e=>a.t$(e instanceof Error?e:new Error(String(e)))))}}}]);