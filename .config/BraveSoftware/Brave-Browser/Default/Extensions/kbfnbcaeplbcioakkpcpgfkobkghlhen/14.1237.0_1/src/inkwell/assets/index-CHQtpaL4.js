import{B as w,H as F,p as r,s as A,x as R,k as u,z as m,y as z,a6 as I,r as h,R as C,L as P,i as W,q as M,aa as x,w as G,a as y}from"./index-uVYElzgq.js";import{A as N,T as $,a as B,b as L,c as O,d as H,e as V}from"./TextDocumentEntities-iE9yXSvn.js";import{DocumentSessionManagerToken as q,DocumentSessionToken as U,TextDocumentInfoToken as J}from"./index-Z7s1VMXC.js";import{d as K}from"./distinctUntilChanged-JrE1RNy_.js";import{D as Q}from"./Delta-D-dso3t3-DM06-Vr-.js";import{s as f,a as X,b as Y}from"./skip-DI4WBx6-.js";import{s as Z}from"./share-BO0c2DMx.js";import{m as j}from"./merge-BJiAq4u-.js";import{t as ee}from"./take-A312jYgg.js";import{b as te,d as l}from"./RemoteSubscribable-CanKOUL4-C6cenfHh.js";import"./RemoteEntity-CN-1WB86-yD3y8ldD.js";import"./PluginModule-CRib3PLZ-LTQDm_KX.js";import"./mergeAll-CSDR5lBs.js";var se=Object.defineProperty,E=t=>{throw TypeError(t)},ae=(t,e,s)=>e in t?se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,re=(t,e,s)=>ae(t,e+"",s),ie=(t,e,s)=>e.has(t)||E("Cannot "+s),d=(t,e,s)=>(ie(t,e,"read from private field"),s?s.call(t):e.get(t)),k=(t,e,s)=>e.has(t)?E("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),S,v;class b{constructor(){k(this,S,new DisposableStack),k(this,v,new w(null)),re(this,"activeDocumentId",F(d(this,v)))}setActiveDocumentIdSource(e){d(this,S).use(r(R(e),K(),A(d(this,v))))}[Symbol.dispose](){d(this,S).dispose()}}S=new WeakMap;v=new WeakMap;var oe=Object.defineProperty,ne=(t,e,s)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,o=(t,e,s)=>ne(t,typeof e!="symbol"?e+"":e,s);class ue{constructor({documentId:e,hasFocus:s,lastFocusAt:c,geometry:n,textChange:g,geometryWillChange:D,selection:_}){o(this,"id"),o(this,"hasFocus"),o(this,"lastFocusAt"),o(this,"geometryWillChange"),o(this,"geometry"),o(this,"textChange"),o(this,"text"),o(this,"selection"),this.id=e,this.hasFocus=r(m(s),f({bufferSize:1,refCount:!0}),u),this.lastFocusAt=r(m(c),f({bufferSize:1,refCount:!0}),u),this.geometryWillChange=r(m(D),Z(),u),this.geometry=r(m(n),f({bufferSize:1,refCount:!0}),u),this.selection=r(m(_),f({bufferSize:1,refCount:!0}),u);const p=r(m(g),h(a=>({revision:a.revision,change:new Q(a.change)})),X((a,{change:i,revision:T})=>a?{revision:T,change:i,content:a.content.compose(i)}:{revision:T,change:i,content:i},null),z(I),f({bufferSize:1,refCount:!0}));this.text=r(p,h(({revision:a,content:i})=>({revision:a,content:i})),u),this.textChange=r(j(r(p,ee(1),h(({revision:a,content:i})=>({revision:a,change:i}))),r(p,Y(1),h(({revision:a,change:i})=>({revision:a,change:i})))),u)}}const ye=t=>{const e=t.getExecutionScopeDefinition("document-group");return C.all([ce(t),e.register({token:b,useClass:b},{lifetime:P.Singleton}),e.register({token:q,useToken:b}),W(e.onStart(s=>r(x([G(s.resolve(b)),te(s.realm,N,null)]),M(([c,n])=>c.setActiveDocumentIdSource(n)))))])};function ce(t){return t.registerExecutionScopeReviver("document-session",(e,s,{documentId:c})=>r(x([l(e.realm,$),l(e.realm,B),l(e.realm,L),l(e.realm,O),l(e.realm,H),l(e.realm,V)]),y(async([n,g,D,_,p,a])=>C.all([e.register({token:U,useValue:{documentId:c,startedAt:performance.now()}}),e.register({token:J,useValue:new ue({documentId:c,hasFocus:n,lastFocusAt:g,geometry:D,textChange:_,selection:p,geometryWillChange:a})})])),y(n=>(e.use(n),e.start()))))}export{ye as activate};
//# sourceMappingURL=index-CHQtpaL4.js.map
