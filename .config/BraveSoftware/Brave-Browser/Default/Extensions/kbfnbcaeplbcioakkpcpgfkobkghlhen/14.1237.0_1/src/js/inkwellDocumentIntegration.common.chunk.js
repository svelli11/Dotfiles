(self.webpackChunk=self.webpackChunk||[]).push([[5643],{86300:(e,t,i)=>{i.d(t,{v:()=>C});var n=i(71497),s=i(88305),o=i(32082),r=i(49643),c=i(90023),a=i(13391),l=i(32073),u=i(59179),d=i(20161),p=i(84714),g=i(9273),h=i(954),m=i(24666),f=i(81446),v=i(58303),x=i(39363);const b=i(88030).E0;class _{constructor(e){this._params=e,this._subscription=new l.w0,this._selection=a.h.create(null),this.selection=this._selection.view(),this._subscription.add(e.selectionOrCaretPosition.pipe(u.U((e=>v.WG(e))),d.w((e=>e?p.of(e):g.timer(b).pipe(u.U((()=>this._getCurrentSelection())),h.O(this._getCurrentSelection()),m.x())))).subscribe(f.wW(this._selection)))}_getCurrentSelection(){return(0,c.zG)(this._params.selectionService.getCurrentSelection(),x.Ey)}setSelection(e){this._params.selectionService.setSelection(e)}dispose(){this._subscription.unsubscribe()}}var k=i(99120),y=i(3510);class S{constructor(e){this._params=e,this.getDocumentText=()=>this._params.getCurrentTextMap().getRichText(),this.getDocumentGeometry=()=>{const e=y.i.getVisibleTextRange(this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryProvider,this._params.geometryLayout),t=y.i.getTextFieldBoundingBox(this._params.textField,this._params.textFieldLayout);return e?{visibleTextRange:e,documentFrame:t}:{documentFrame:t}},this.getBoundingBoxesForTextRanges=e=>y.i.getBoundingBoxesForTextRanges(e,this._params.textField,this._params.originalTextField,this._params.doc,this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryLayout,this._params.geometryProvider),this.setDocumentSelectedTextRange=e=>this._params.selectionService.setSelection(e),this.applyChangesToDocument=e=>{const t=(0,k.g)(e,!0);return this._params.replacementService.performBatchReplacements(t).then((t=>({changes:e,status:t})))}}}class C{constructor(e){var t;this._log=o.Y.create("ConnectorDependenciesImpl"),this._disposableList=[];const i=(0,n.Me)(e.textField);this.target={documentID:s.iy.create(),documentUrl:i.location.href,textField:e.textField,originalTextField:e.originalTextField},this.textRevisionManager=r.X.create(e.textObserver,e.createTextRevisionManager),this.selectionService=new _({selectionService:e.selectionService,selectionOrCaretPosition:e.selectionOrCaretPosition});const c=null!==(t=e.geometryLayout)&&void 0!==t?t:e.integrationLayout.createGeometryLayout();this.connectorHandler=new S({doc:i,replacementService:e.replacementService,textRevisionManager:this.textRevisionManager,geometryLayout:c,selectionService:this.selectionService,textField:e.textField,textFieldLayout:e.integrationLayout.textField,originalTextField:e.originalTextField,geometryProvider:e.geometryProvider,getCurrentTextMap:()=>e.textObserver.getCurrentTextMap()}),this._disposableList.push(this.selectionService)}dispose(){(0,s.jD)(this._disposableList,this._log)}}},3510:(e,t,i)=>{i.d(t,{i:()=>n});var n,s=i(90023),o=i(46164),r=i(66016),c=i(85763),a=i(88305),l=i(24312);!function(e){function t(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function i(e){const t=e.rect.getCurrent();return{left:t.client.left,top:t.client.top,width:t.size.width,height:t.size.height}}function n(e){const t=e.visibleRect.getCurrent(),i=e.rect.getCurrent(),n=e.scroll.getCurrent(),s=(0,o.jg)(t,i);return s?(0,o.Li)(s,i,n):null}function u(e,t,i,n,s){var o;const c=n.create(e,t);return c?Array.from(null!==(o=n.getClientRects(c))&&void 0!==o?o:[]).filter((e=>e.height>0&&e.width>0)).map((e=>r.UL.setPosition(s.clientToRelative(e),e))).filter((e=>r.UL.contains(e,i))):[]}function d(e,t,i){return[[e.left,e.top+e.height],[e.left+e.width,e.top+e.height]].map((([e,i])=>t.elementFromPoint(e,i))).every((e=>i.some((t=>e===t||t.contains(e)))))}function p(e){return Object.fromEntries(Object.keys(e).map((e=>[e,[]])))}e.getZoomedBoundingBox=function(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}},e.getTextFieldBoundingBox=function(e,n){const s=i(n),o=(0,c.k6)(e);if(!o)return t(s);const a=r.UL.getIntersection(s,o);return t(a?{...a,top:s.top,height:s.height}:s)},e.getRelativeVisibleTextFieldRect=n,e.getVisibleRelativeRectsForTextRange=u,e.getVisibleTextRange=function(e,t,i,s){let o=null;const r=e.getPlainText(),c=n(t);if(!c||!r.length)return o;const a=s.getCurrentConversionContext();for(let t=0;t<r.length;t++){if(u({start:t,end:t+1},e,c,i,a).length>0)o={start:null===o?t:o.start,end:t+1};else if(o&&(0,l.qE)(r.substring(t,t+1)))break}return o},e.isRectElementOnDocumentTop=d,e.createEmptyBoundingBoxesForTextField=p,e.getBoundingBoxesForTextRanges=function(e,o,c,l,g,h,m,f){const v=n(h);if(!v)return p(e);const x=m.getCurrentConversionContext(),b=i(h),_=t(b),k=h.scroll.getCurrent(),y={left:b.left-k.left,top:b.top-k.top},S={left:_.x-k.left,top:_.y-k.top};return Object.fromEntries(Object.entries(e).map((([e,i])=>[e,u(i,g,v,f,x).filter((e=>d(r.UL.shift(e,y),l,[o,c].filter(a.fQ)))).map((e=>(0,s.zG)(r.UL.shift(e,S),t)))])))}}(n||(n={}))},49643:(e,t,i)=>{i.d(t,{X:()=>n});var n,s=i(90572),o=i(38286),r=i(18413);!function(e){e.create=function(e,t=o.n.create){const i=t({getTextSource:()=>e.getTextSource(),getCurrentTextMap:()=>e.getCurrentTextMap(),dispose:()=>e.dispose(),textMapChanged:e.textMapChanged,contentChanges:{async:e.contentChanges.async.pipe(s.h((e=>e.changes.length>0))),immediate:e.contentChanges.immediate.pipe(s.h((e=>e.changes.length>0)))}});return{revisionChanges:i.revisionChanges,getLatestVersionNumber:()=>r.Q.getRevisionNumber(i.getLatestRevision().id),dispose:()=>i.dispose()}}}(n||(n={}))},65336:(e,t,i)=>{i.r(t),i.d(t,{InkwellDocumentIntegrationImpl:()=>R});var n=i(49231),s=i(48546),o=i(32073),r=i(32734),c=i(20680),a=i(79256),l=i(50750),u=i(84308),d=i(90572),p=i(84178),g=i(20161),h=i(59179),m=i(24666),f=i(64271),v=i(84714),x=i(954),b=i(86300),_=i(18342);class k{constructor(e){this._shouldMeasure=e}rxMeasure(e,t){return this._shouldMeasure?_.d5.measure(this.callMeasure(e,t)):_.d5.doNothing}callMeasure(e,t){return i=>{if(this._shouldMeasure){const n=k._eventIndex++,s=performance.mark(`Ink_${e}${n}_start`);try{i()}finally{const i=performance.mark(`Ink_${e}${n}_end`),o=performance.measure(`Ink_${e}${n}_duration`,{start:s.name,end:i.name,detail:{devtools:{dataType:"track-entry",track:"Inkwell Extension",trackGroup:"Inkwell",color:"tertiary-dark",tooltipText:`Inkwell ${e}`}}});t&&t({eventName:e,start:s.startTime,end:i.startTime,duration:o.duration})}}else i()}}}k._eventIndex=0;var y=i(88305),S=i(48838),C=i(18413),T=i(32082),w=i(94207);class R{constructor(e){this._logger=T.Y.create(`Inkwell/${R.name}`),this._disposed=!1,this._subscriptions=new o.w0,this._disposables=[];const t=new k(e.measurePerformance),i=new b.v(e),n=e.inkwellPageDynamicService.getSingletonInstance(),g=this._getCAPIMessages(e.checkingService).pipe(r.B());let h=!0;const m=[];this._subscriptions.add(g.subscribe((e=>{h&&m.push(e)})));const f=c.z(a.P((()=>{const e=l.D([...m]);return h=!1,m.length=0,e})),g).pipe(t.rxMeasure("capiMessage")),v=u.a([(0,s.n)(e.checkingService.pipe(d.h(y.C_),p.q(1))),n]).pipe(t.rxMeasure("deps"));this._subscriptions.add(v.subscribe((([n,s])=>{this._disposables.push(s.connectDocument({connectorDependencies:i,capiMessages:f,checkingService:n,alertProcessor:e.alertProcessor,isFieldFocused:e.isFieldFocused,textFieldLayout:e.integrationLayout.textField,perf:t}))})))}getDecorationsUI(){return n.createElement("div",null)}dispose(e){this._disposed||(this._disposed=!0,(0,y.jD)(this._disposables,this._logger),this._subscriptions.unsubscribe())}_getCAPIMessages(e){return e.pipe(d.h(y.C_),g.w((e=>e.capiMessages.pipe(d.h((e=>"start"===e.action)),g.w((t=>{const i=t.sessionUuid,n=e.checkingRevisionInfo.pipe(h.U((e=>({kind:"capiTextRevision",sessionId:i,capiTextRevision:C.Q.getRevisionNumber(e.revision)}))),m.x(((e,t)=>e.capiTextRevision===t.capiTextRevision))),s=e.readyState.pipe(d.h((e=>e===S.kQ.disconnected)),h.U((()=>({kind:"capiDisconnected",sessionId:i}))));return f.T(c.z(v.of(t),e.capiMessages.pipe(d.h((e=>!w.j9.has(e.action))))).pipe(h.U((e=>({kind:"capiMessage",sessionId:i,message:e}))),x.O({kind:"capiConnected",sessionId:i})),n,s)}))))))}}},94207:(e,t,i)=>{i.d(t,{C2:()=>m,j9:()=>g,n7:()=>f,yU:()=>h});var n=i(64297),s=i(32073),o=i(50750),r=i(20161),c=i(8065),a=i(84714),l=i(59179),u=i(12518),d=i(32082),p=i(80533);const g=new Set(["sdui:add","sdui:update","sdui:remove"]);class h{constructor(e){this._params=e,this._log=d.Y.create(`Inkwell/${h.name}/dId[${this._params.documentID}]`),this._subs=new s.w0,this._subs.add(this._subscribeToCAPIMessages())}dispose(){this._subs.unsubscribe()}async sendCapiMessage(e){try{const t=await this._params.checkingService.sendMessage(e.message.action,e.message,!0)();if(u.nM(t))throw t.left}catch(e){this._log.error("Unexpected error calling checkingService.sendMessage",e)}}capiWebSocketOpened(e){return Promise.resolve()}capiWebSocketClosed(e){return Promise.resolve()}capiWebSocketMessage(e){return Promise.resolve()}capiWebSocketError(e){return Promise.resolve()}_subscribeToCAPIMessages(){return o.D(this._params.inkwellCapiAPI).pipe(r.w((e=>this._params.capiMessages.pipe(c.b((e=>"capiTextRevision"===e.kind?a.of(this._params.getTextRevision()).pipe(l.U((t=>({...e,documentTextRevision:t})))):a.of(e))),l.U((t=>({message:t,capiToInkwell:e}))))))).subscribe((({message:e,capiToInkwell:t})=>{switch(e.kind){case"capiConnected":this._logRejections((()=>t.capiConnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiConnected");break;case"capiDisconnected":this._logRejections((()=>t.capiDisconnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiDisconnected");break;case"capiTextRevision":this._logRejections((()=>t.capiTextRevision({sessionID:e.sessionId,documentRevision:e.documentTextRevision,capiRevision:e.capiTextRevision})),"Unexpected rejection from capiToInkwell.capiTextRevision");break;case"capiMessage":this._logRejections((()=>t.capiMessageReceived({sessionID:e.sessionId,message:e.message})),"Unexpected rejection from capiToInkwell.capiMessageReceived");break;default:(0,n.L0)(e)}}))}_logRejections(e,t){e().catch((e=>this._log.error(t,e)))}}function m(e,t){return{capiConnected:(0,p.i)(e,t.capiConnected),capiDisconnected:(0,p.i)(e,t.capiDisconnected),capiMessageReceived:(0,p.i)(e,t.capiMessageReceived),capiAlertRemoved:(0,p.i)(e,t.capiAlertRemoved),capiTextRevision:(0,p.i)(e,t.capiTextRevision),capiWebSocketCreate:(0,p.i)(e,t.capiWebSocketCreate),capiWebSocketClose:(0,p.i)(e,t.capiWebSocketClose),capiWebSocketConnect:(0,p.i)(e,t.capiWebSocketConnect),capiWebSocketSend:(0,p.i)(e,t.capiWebSocketSend)}}function f(e){return{sendCapiMessage:(0,p.O)((async t=>(await e(t)).sendCapiMessage)),capiWebSocketOpened:(0,p.O)((async t=>(await e(t)).capiWebSocketOpened)),capiWebSocketClosed:(0,p.O)((async t=>(await e(t)).capiWebSocketClosed)),capiWebSocketMessage:(0,p.O)((async t=>(await e(t)).capiWebSocketMessage)),capiWebSocketError:(0,p.O)((async t=>(await e(t)).capiWebSocketError))}}},80533:(e,t,i)=>{function n(e,t){return async i=>null===i?await t(null):await t({...i,documentID:e})}function s(e){return async t=>{const i=await e(t.documentID),n=await i(t);return{documentID:t.documentID,...n}}}i.d(t,{O:()=>s,i:()=>n})},85763:(e,t,i)=>{if(i.d(t,{LJ:()=>f,Nd:()=>c,Ov:()=>m,TW:()=>_,Ur:()=>a,Xs:()=>k,e$:()=>x,eg:()=>b,fN:()=>d,k6:()=>g,kh:()=>u,lW:()=>v,lz:()=>p,qg:()=>r,uj:()=>o,uz:()=>h}),3075==i.j)var n=i(3601);var s=i(671);function o(e){const t=(0,n.Cq)(e.querySelector(s.XG),"text buffer iframe");return(0,n.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function r(e){const t=c(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function c(e){return e.querySelector(s.Wp)}function a(e,t,i){return t?function(e,t){if(t&&l(t))return t;const i=e.querySelectorAll(s.Qy);for(const e of i)if(l(e))return e;return null}(e,i):e.querySelector(s.Qy)}const l=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function u(e){return e.querySelectorAll(s.gH)}function d(e){return e.querySelector(s.gH)}function p(e){return Boolean(e.querySelector(s.gH))}function g(e){let t=e.querySelector(s.os);return t||(t=document.querySelector(s.gH)),t?t.getBoundingClientRect():null}const h=e=>!!e.querySelector(s.Lq);function m(e){return e.querySelector(s.$x)}function f(e){return null==e?void 0:e.querySelector(s.y1)}function v(e){const t=e.querySelector(s.f);return!!t&&t.offsetHeight>0}function x(e){return!!e.querySelector(`${s.jW}, ${s.F8}`)}function b(){const e=document.querySelector(s.d0),t=(null==e?void 0:e.classList.contains(s.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(s._m))?"suggesting":void 0;return t||i||"other"}function _(e){return e.querySelector(s.QR)}function k(e){return e.querySelector(s.ij)}},671:(e,t,i)=>{i.d(t,{$x:()=>r,F8:()=>m,Go:()=>s,Kt:()=>k,Lq:()=>l,QR:()=>R,Qy:()=>v,Vk:()=>y,Wp:()=>n,XG:()=>o,_m:()=>p,d0:()=>u,f:()=>a,gH:()=>f,gL:()=>S,ij:()=>w,j5:()=>_,jW:()=>h,l$:()=>g,lO:()=>T,os:()=>b,rx:()=>C,uj:()=>d,y1:()=>c,yw:()=>x});const n=".kix-appview-editor",s=".docos-input",o=".docs-texteventtarget-iframe",r=".kix-cursor",c=".kix-cursor-caret",a="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',u="#docs-toolbar-mode-switcher",d="edit-mode",p="suggest-mode",g="titlebar-mode-indicator-container",h="#titlebar-mode-indicator-container .titlebar-request-access-button",m="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",v=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",x=".kix-page-paginated",b=".kix-page-paginated.canvas-first-page",_=".docs-horizontal-ruler",k=".docs-vertical-ruler",y="#fontSizeSelect input",S=".docs-ruler-background",C=".docs-ruler-background-inner",T=".docs-ruler-indent-first-line",w=".modal-dialog.docs-dialog .fatal-error-message",R='#docs-titlebar-share-client-button div[role="button"]'}}]);