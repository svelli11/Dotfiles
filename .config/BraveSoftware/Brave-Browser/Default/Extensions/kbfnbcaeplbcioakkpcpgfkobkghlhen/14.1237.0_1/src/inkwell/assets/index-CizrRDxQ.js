import{_ as tt,p as F,w as ft,a as mt,q as ut,v as dt,i as et,m as pt,z as gt,ad as z,x as xt,a1 as wt,s as ht,a5 as yt,l as X,ae as bt}from"./start-BFd-djfI.js";import{D as vt}from"./index-Dh6AtzXO.js";import{r as At,R as nt}from"./index-Bm4tEXCw.js";import{j as Y}from"./jsx-runtime-BtQ6Bsb4.js";import{c as St,t as G}from"./PixelFns-BIHP7Exp-Cxsb96Xk.js";import{InlineCardInteractionContextToken as it,InlineCardViewContainerToken as Ct}from"./index-Cu8JTHOu.js";import{d as U}from"./distinctUntilChanged-GMQNSCXg.js";import{s as Pt}from"./switchMap-BkKtxKb2.js";import{c as H}from"./ScreenPointFns-7sGy0XGN-DYTqdHzE.js";import{e as kt}from"./PointFns-Bd1JBOhL--ZyEh-AF.js";import"./PluginModule-CRib3PLZ-B43Hjk20.js";function Rt(t,e){return Math.abs(t.width-e.width)<Number.EPSILON&&Math.abs(t.height-e.height)<Number.EPSILON}const Et=Math.min,Ot=Math.max,Dt={left:"right",right:"left",bottom:"top",top:"bottom"},Mt={start:"end",end:"start"};function J(t,e,r){return Ot(t,Et(e,r))}function T(t,e){return typeof t=="function"?t(e):t}function P(t){return t.split("-")[0]}function V(t){return t.split("-")[1]}function ot(t){return t==="x"?"y":"x"}function rt(t){return t==="y"?"height":"width"}function R(t){return["top","bottom"].includes(P(t))?"y":"x"}function st(t){return ot(R(t))}function Tt(t,e,r){r===void 0&&(r=!1);const n=V(t),s=st(t),i=rt(s);let o=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=M(o)),[o,M(o)]}function Vt(t){const e=M(t);return[L(t),e,L(e)]}function L(t){return t.replace(/start|end/g,e=>Mt[e])}function jt(t,e,r){const n=["left","right"],s=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return r?e?s:n:e?n:s;case"left":case"right":return e?i:o;default:return[]}}function _t(t,e,r,n){const s=V(t);let i=jt(P(t),r==="start",n);return s&&(i=i.map(o=>o+"-"+s),e&&(i=i.concat(i.map(L)))),i}function M(t){return t.replace(/left|right|bottom|top/g,e=>Dt[e])}function Lt(t){return{top:0,right:0,bottom:0,left:0,...t}}function It(t){return typeof t!="number"?Lt(t):{top:t,right:t,bottom:t,left:t}}function K(t){const{x:e,y:r,width:n,height:s}=t;return{width:n,height:s,top:r,left:e,right:e+n,bottom:r+s,x:e,y:r}}function Q(t,e,r){let{reference:n,floating:s}=t;const i=R(e),o=st(e),a=rt(o),f=P(e),m=i==="y",u=n.x+n.width/2-s.width/2,c=n.y+n.height/2-s.height/2,d=n[a]/2-s[a]/2;let l;switch(f){case"top":l={x:u,y:n.y-s.height};break;case"bottom":l={x:u,y:n.y+n.height};break;case"right":l={x:n.x+n.width,y:c};break;case"left":l={x:n.x-s.width,y:c};break;default:l={x:n.x,y:n.y}}switch(V(e)){case"start":l[o]-=d*(r&&m?-1:1);break;case"end":l[o]+=d*(r&&m?-1:1);break}return l}const Ft=async(t,e,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:i=[],platform:o}=r,a=i.filter(Boolean),f=await(o.isRTL==null?void 0:o.isRTL(e));let m=await o.getElementRects({reference:t,floating:e,strategy:s}),{x:u,y:c}=Q(m,n,f),d=n,l={},p=0;for(let y=0;y<a.length;y++){const{name:x,fn:w}=a[y],{x:h,y:b,data:v,reset:g}=await w({x:u,y:c,initialPlacement:n,placement:d,strategy:s,middlewareData:l,rects:m,platform:o,elements:{reference:t,floating:e}});u=h!=null?h:u,c=b!=null?b:c,l={...l,[x]:{...l[x],...v}},g&&p<=50&&(p++,typeof g=="object"&&(g.placement&&(d=g.placement),g.rects&&(m=g.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:s}):g.rects),{x:u,y:c}=Q(m,d,f)),y=-1)}return{x:u,y:c,placement:d,strategy:s,middlewareData:l}};async function at(t,e){var r;e===void 0&&(e={});const{x:n,y:s,platform:i,rects:o,elements:a,strategy:f}=t,{boundary:m="clippingAncestors",rootBoundary:u="viewport",elementContext:c="floating",altBoundary:d=!1,padding:l=0}=T(e,t),p=It(l),x=a[d?c==="floating"?"reference":"floating":c],w=K(await i.getClippingRect({element:(r=await(i.isElement==null?void 0:i.isElement(x)))==null||r?x:x.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:m,rootBoundary:u,strategy:f})),h=c==="floating"?{x:n,y:s,width:o.floating.width,height:o.floating.height}:o.reference,b=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),v=await(i.isElement==null?void 0:i.isElement(b))?await(i.getScale==null?void 0:i.getScale(b))||{x:1,y:1}:{x:1,y:1},g=K(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:h,offsetParent:b,strategy:f}):h);return{top:(w.top-g.top+p.top)/v.y,bottom:(g.bottom-w.bottom+p.bottom)/v.y,left:(w.left-g.left+p.left)/v.x,right:(g.right-w.right+p.right)/v.x}}const Nt=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:s,middlewareData:i,rects:o,initialPlacement:a,platform:f,elements:m}=e,{mainAxis:u=!0,crossAxis:c=!0,fallbackPlacements:d,fallbackStrategy:l="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:y=!0,...x}=T(t,e);if((r=i.arrow)!=null&&r.alignmentOffset)return{};const w=P(s),h=R(a),b=P(a)===a,v=await(f.isRTL==null?void 0:f.isRTL(m.floating)),g=d||(b||!y?[M(a)]:Vt(a)),N=p!=="none";!d&&N&&g.push(..._t(a,y,p,v));const ct=[a,...g],j=await at(e,x),D=[];let E=((n=i.flip)==null?void 0:n.overflows)||[];if(u&&D.push(j[w]),c){const C=Tt(s,o,v);D.push(j[C[0]],j[C[1]])}if(E=[...E,{placement:s,overflows:D}],!D.every(C=>C<=0)){var $,B;const C=((($=i.flip)==null?void 0:$.index)||0)+1,q=ct[C];if(q)return{data:{index:C,overflows:E},reset:{placement:q}};let O=(B=E.filter(k=>k.overflows[0]<=0).sort((k,A)=>k.overflows[1]-A.overflows[1])[0])==null?void 0:B.placement;if(!O)switch(l){case"bestFit":{var W;const k=(W=E.filter(A=>{if(N){const S=R(A.placement);return S===h||S==="y"}return!0}).map(A=>[A.placement,A.overflows.filter(S=>S>0).reduce((S,lt)=>S+lt,0)]).sort((A,S)=>A[1]-S[1])[0])==null?void 0:W[0];k&&(O=k);break}case"initialPlacement":O=a;break}if(s!==O)return{reset:{placement:O}}}return{}}}};async function $t(t,e){const{placement:r,platform:n,elements:s}=t,i=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=P(r),a=V(r),f=R(r)==="y",m=["left","top"].includes(o)?-1:1,u=i&&f?-1:1,c=T(e,t);let{mainAxis:d,crossAxis:l,alignmentAxis:p}=typeof c=="number"?{mainAxis:c,crossAxis:0,alignmentAxis:null}:{mainAxis:c.mainAxis||0,crossAxis:c.crossAxis||0,alignmentAxis:c.alignmentAxis};return a&&typeof p=="number"&&(l=a==="end"?p*-1:p),f?{x:l*u,y:d*m}:{x:d*m,y:l*u}}const Bt=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:s,y:i,placement:o,middlewareData:a}=e,f=await $t(e,t);return o===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+f.x,y:i+f.y,data:{...f,placement:o}}}}},Wt=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:s}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:x=>{let{x:w,y:h}=x;return{x:w,y:h}}},...f}=T(t,e),m={x:r,y:n},u=await at(e,f),c=R(P(s)),d=ot(c);let l=m[d],p=m[c];if(i){const x=d==="y"?"top":"left",w=d==="y"?"bottom":"right",h=l+u[x],b=l-u[w];l=J(h,l,b)}if(o){const x=c==="y"?"top":"left",w=c==="y"?"bottom":"right",h=p+u[x],b=p-u[w];p=J(h,p,b)}const y=a.fn({...e,[d]:l,[c]:p});return{...y,data:{x:y.x-r,y:y.y-n,enabled:{[d]:i,[c]:o}}}}}},I=St(8),qt=({container:t})=>{var e;const r=At.useSyncExternalStore(t.subscribe,t.getSnapshot);return Y.jsx("div",{style:{padding:I,boxSizing:"border-box"},children:Y.jsx("div",{style:{backgroundColor:"white",borderRadius:4,width:"fit-content",height:"fit-content"},children:(e=r.default)==null?void 0:e.map(n=>nt.cloneElement(n.view,{key:n.key}))})})};var zt=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Z=t=>{throw TypeError(t)},Xt=(t,e,r)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&Z("Object expected");var n;n===void 0&&(n=e[zt("dispose")]),typeof n!="function"&&Z("Object not disposable"),t.push([r,n,e])}return e},Yt=(t,e,r)=>{var n=typeof SuppressedError=="function"?SuppressedError:function(o,a,f,m){return m=Error(f),m.name="SuppressedError",m.error=o,m.suppressed=a,m},s=o=>e=r?new n(o,e,"An error was suppressed during disposal"):(r=!0,o),i=o=>{for(;o=t.pop();)try{var a=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(a).then(i,f=>(s(f),i()))}catch(f){s(f)}if(r)throw e};return i()};const se=t=>tt(async e=>{var r=[];try{const i=Xt(r,new DisposableStack),o=t.getExecutionScopeDefinition("document-group"),a=t.getExecutionScopeDefinition("inline-card-interaction"),f=await e(t.getPlugin("window-management"));i.use(await e(t.registerExecutionScopeReviver("inline-card-interaction",(c,d,l)=>(c.register({token:it,useValue:l}),c.start()))));const m=await e(t.getPlugin("ui")),u=new vt;return i.use(await e(o.register({token:Ct,useValue:u}))),i.use(o.onStart(c=>Gt(c,m,u))),i.use(a.onStart(c=>Ut(c,f))),i.use(a.onStop(c=>(u.clear(),F(c.resolve(f.provides.CurrentWindow),ft,mt(d=>d.hide()),ut(dt))))),et(i.move())}catch(i){var n=i,s=!0}finally{Yt(r,n,s)}});async function Gt(t,e,r){return F(t.resolve(e.provides.MainViewContainer),pt(n=>n.add(()=>nt.createElement(qt,{container:r}),{slot:"default"})))}let _=0;async function Ut(t,e){return tt(async r=>{const n=await r(t.resolve(e.provides.CurrentWindow)),s=await r(t.resolve(it));return F(n.windowRect,gt,U(Rt),Pt(async i=>{const o=_=(_+1)%1e3,a=await Ft(s.geometryData.segmentRect,i,{platform:{getElementRects:z,getDimensions:z,getClippingRect:()=>n.screenBounds.getValue()},placement:"bottom-start",middleware:[Wt(),Nt(),Bt({alignmentAxis:-1*G(I),mainAxis:-1*G(I)})]});return o!==_?null:H(a)}),xt(wt),U(kt),ht(async i=>{const o=await yt([n.setPosition(H(i)),n.bringToFront(),n.show()]);o.ok||X.error("Failed to set the inline card window position",o.error,{delivery:!0})})),et(bt(async()=>{const i=await n.hide();i.ok||X.error("Failed to hide the inline card window",i.error,{delivery:!0})}))})}export{se as activate};
//# sourceMappingURL=index-CizrRDxQ.js.map
