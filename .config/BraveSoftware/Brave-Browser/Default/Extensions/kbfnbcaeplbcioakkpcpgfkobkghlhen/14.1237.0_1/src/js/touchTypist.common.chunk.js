(self.webpackChunk=self.webpackChunk||[]).push([[1824],{56939:(e,t,i)=>{i.r(t),i.d(t,{TouchTypistFeatureImpl:()=>yi,trackTooltipAppearingAndSkipping:()=>vi});var r=i(90023),a=i(32073),s=i(59179),n=i(10883),o=i(90572),c=i(29479),l=i(78129),u=i(58303),d=i(72106),p=i(49231),h=i(34527),m=i(64271),g=i(44071),y=i(13712),v=i(20161),b=i(84714),_=i(53976),f=i(73285),S=i(23934),E=i(19547),T=i(71564),k=i(47387),x=i(29227),w=i(33632),C=i(2680);const R={".":"Period",",":"Comma",";":"Semicolon",":":"Colon"," ":"Space","!":"Exclamation mark","?":"Question mark","'":"Apostrophe","-":"Hyphen","—":"Em dash","–":"En dash","(":"Left parenthesis",")":"Right parenthesis","[":"Left bracket","]":"Right bracket","{":"Left brace","}":"Right brace","/":"Slash","#":"Hash","@":"At sign","&":"Ampersand","*":"Asterisk","%":"Percent sign","^":"Caret","`":"Backtick","~":"Tilde"};var A=i(89701);const I=({caretPosition:e})=>{var t;const{bottom:i,right:r}=e,a=i+4,s=r,n=((null===(t=self.visualViewport)||void 0===t?void 0:t.width)||self.innerWidth)-s;return n>=480?{top:a,left:r}:s>=480?{top:a,right:n}:{top:a,left:10}},P=e=>"string"==typeof e||"number"==typeof e?String(e):Array.isArray(e)?e.map(P).join(""):p.isValidElement(e)?P(e.props.children):"",O=e=>e.split("").map((e=>R[e]?` ${R[e]} `:e));var M;!function(e){e.DELETE="DELETE",e.RETAIN="RETAIN",e.INSERT="INSERT"}(M||(M={}));const N=({word:e,marker:t,hasSpelling:i})=>{const r=O(e).join(""),a=O(e).join(" ");return(e=>1===e.length&&!!R[e])(e)?` ${t} "${R[e]}" `:i?` ${t} "${r} (spelling ${a})" `:` ${t} "${r}" `},D=({children:e})=>p.createElement(T.x,{as:"strong",variant:"text-xsmall"},e),L=({hotkey:e,accessibilityOnboardingAlertsCount:t})=>{const i=p.createElement(p.Fragment,null,`${(e=>{const t=at-e-1;return t>0?`This is an onboarding message that will be communicated ${t} more ${(0,x._6)(t,"time","times")}.`:"This is the last time this onboarding message will be communicated."})(t)} We will play a sound to let you\n      know that Grammarly has fixes for you. Press `,p.createElement(T.x,{as:"strong",variant:"text-xsmall"},"Return")," ","while in this window to hear the sound, or press"," ",p.createElement(T.x,{as:"strong",variant:"text-xsmall"},p.createElement(k.F.Fragment,null,e))," ","to review suggestions."),r=p.createElement(p.Fragment,null,"Configure the shortcut to apply suggestions in settings. Press ",p.createElement(D,null,"Escape")," to return to your text.");return p.createElement("div",{id:"a11yReadyOnboardingTextId"},p.createElement(T.x,{as:"p",variant:"text-xsmall","aria-label":P(i)},i),p.createElement(T.x,{as:"p",variant:"text-xsmall","aria-label":P(r)},r))};var F=i(98491),B=i(20515);const H=({accessibilitySoundService:e,hotkey:t,accessibilityOnboardingAlertsCount:i,incrementAccessibilityOnboardingAlertsCount:r,onA11yReadyOnboardingModalShown:a,stateManagerHandleEvent:s,textFieldElement:n})=>{const[c,l]=p.useState(!0);return p.useEffect((()=>{const t=g.R(document,"keydown",{capture:!0}).pipe(o.h((e=>"Enter"===e.key))).subscribe((t=>{t.preventDefault(),e.playReadyToApplySuggestionsSound()}));return a(),()=>{t.unsubscribe(),n.focus()}}),[]),p.createElement(f.u_,{width:"small",title:p.createElement("span",{id:"a11yReadyOnboardingModalTitleId","aria-labelledby":"a11yReadyOnboardingModalTitleId a11yReadyOnboardingTextId"},p.createElement(S.J,{icon:E.H,accessibilityLabel:"",size:"large",style:{width:"4rem",height:"4rem"}}),"Grammarly can fix errors in your text."),isOpen:c,onClose:()=>{l(!1),s({name:F.w.A11Y_ONBOARDING_MODAL_CLOSED}),r()},hasCloseButton:!1,className:B.a11yOnboardingModal,role:"alertdialog"},p.createElement(f.u_.Body,null,p.createElement(L,{hotkey:t,accessibilityOnboardingAlertsCount:i})))};var Q=i(81583),G=i(38635),U=i(23560),W=i(96762),z=i(84580),q=i(38367),Y=i(53610);function $(e={}){let{isReadOnly:t}=e,[i,r]=function(e,t,i){let[r,a]=(0,p.useState)(e||t),s=(0,p.useRef)(void 0!==e),n=void 0!==e;(0,p.useEffect)((()=>{let e=s.current;e!==n&&console.warn(`WARN: A component changed from ${e?"controlled":"uncontrolled"} to ${n?"controlled":"uncontrolled"}.`),s.current=n}),[n]);let o=n?e:r,c=(0,p.useCallback)(((e,...t)=>{let r=(e,...t)=>{i&&(Object.is(o,e)||i(e,...t)),n||(o=e)};"function"==typeof e?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),a(((i,...a)=>{let s=e(n?o:i,...a);return r(s,...t),n?i:s}))):(n||a(e),r(e,...t))}),[n,o,i]);return[o,c]}(e.isSelected,e.defaultSelected||!1,e.onChange);return{isSelected:i,setSelected:function(e){t||r(e)},toggle:function(){t||r(!i)}}}var V=i(42703),K=i(12734);function j(e,t,i){let{inputProps:r,isSelected:a,isPressed:s,isDisabled:n,isReadOnly:o}=function(e,t,i){let{isDisabled:r=!1,isRequired:a=!1,isReadOnly:s=!1,value:n,name:o,children:c,"aria-label":l,"aria-labelledby":u,validationState:d="valid"}=e;null!=c||null!=l||null!=u||console.warn("If you do not provide children, you must specify an aria-label for accessibility");let{pressProps:p,isPressed:h}=(0,K.r7)({isDisabled:r}),{focusableProps:m}=(0,V.kc)(e,i),g=(0,z.dG)(p,m),y=(0,z.zL)(e,{labelable:!0});return(0,z.y$)(i,t.isSelected,t.setSelected),{inputProps:(0,z.dG)(y,Object.assign(Object.assign(Object.assign({"aria-invalid":"invalid"===d||void 0,"aria-errormessage":e["aria-errormessage"],"aria-controls":e["aria-controls"],"aria-readonly":s||void 0,"aria-required":a||void 0,onChange:e=>{e.stopPropagation(),t.setSelected(e.target.checked)},disabled:r},null==n?{}:{value:n}),{name:o,type:"checkbox"}),g)),isSelected:t.isSelected,isPressed:h,isDisabled:r,isReadOnly:s}}(e,t,i),{isIndeterminate:c}=e;return(0,p.useEffect)((()=>{i.current&&(i.current.indeterminate=c)})),{inputProps:Object.assign(Object.assign({},r),{checked:a}),isSelected:a,isPressed:s,isDisabled:n,isReadOnly:o}}var X=i(5219),Z=i(58952),J=i(21686);const ee=p.forwardRef((function(e,t){var i;const{helperMessage:r,labelDisplay:a="visible",errorMessage:s,isOptional:n,isRequired:o,labelIndicatorForRequired:c="(Required)",labelIndicatorForOptional:l="(Optional)",className:u,style:d,size:h="medium"}=e,m=(0,z.Me)(e.id),g=(0,z.Me)(),y=$(e),v=(0,z.B3)(t),{inputProps:b}=j({...e,validationState:null!=e.errorMessage?"invalid":"valid"},y,v),[_,f]=p.useState(!1),S=!0===e.isDisabled,E=!0===e.isIndeterminate,T=null!=r?g:void 0,k={labelDisplay:a,isDisabled:S,isSelected:y.isSelected||E,isIndeterminate:E,errorMessage:s,size:h};return p.createElement("div",{className:(0,q.W)("gds-checkbox",`gds-checkbox-${h}`,_&&"gds-checkbox-focus-visible",S&&"gds-checkbox-disabled")},p.createElement(X.A,{label:e.children,labelDisplay:a,htmlFor:m,helperMessage:r,errorMessage:s,isOptional:n,isRequired:o,labelIndicatorForOptional:l,labelIndicatorForRequired:c,size:h},p.createElement(C.u,{style:{width:24,height:24}},p.createElement("input",{...null!=(i=e.__inputProps)?i:b,onFocus:()=>f(!0),onBlur:()=>f(!1),onKeyDown:function(e){e.key===Y.V.Space&&(e.preventDefault(),y.toggle())},id:m,ref:v,tabIndex:S?-1:0,"aria-describedby":null!=T?T:b["aria-describedby"],className:(0,q.W)("gds-checkbox-input",`gds-checkbox-input-${h}`,u),style:d})),p.createElement(te,{...k})),p.createElement(Z.f,{size:h,errorMessage:s,className:"gds-checkbox-label-margin"}))})),te=e=>{const{labelDisplay:t,isDisabled:i,isSelected:r,isIndeterminate:a,errorMessage:s,size:n="medium"}=e,o=null!=s?J.I.Border.Critical.Default:J.I.Border.Base.Default;return p.createElement("svg",{className:(0,q.W)("gds-checkbox-icon",`gds-checkbox-icon-${n}`,"visible"===t&&"gds-checkbox-icon-label",i&&"gds-checkbox-element-disabled"),viewBox:"0 0 16 16","aria-hidden":"true",style:{backgroundColor:r?J.I.Background.Brand.Default:void 0,border:`1px solid ${r?J.I.Background.Brand.Default:o}`}},r&&!a&&p.createElement("path",{transform:"translate(2 4)",strokeWidth:0,fill:"var(--color-icon-base-inverse)",d:"M11.7071 1.41421L4.49995 8.62132L0.292847 4.41421L1.70706 3L4.49995 5.79289L10.2928 0L11.7071 1.41421Z"}),a&&p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",transform:"translate(2.5 7)",d:"M10.5 2H0.5V0H10.5V2Z",fill:"white"}))};var ie=i(12518);const re=(e,t)=>{if(t<0||t>e.length)return ie.t$(new Error("Caret outside of the text boundaries."));let i=t,r=t;for(;i>0&&"\n"!==e.charAt(i-1);)i--;for(;r<e.length&&"\n"!==e.charAt(r);)r++;return ie.F2({start:i,end:r})},ae=({caretPosition:e,hotkey:t,textObserver:i,replacementInfo:a,stateManagerHandleEvent:s,textFieldElement:n,accessibilityOnboardingAlertsCount:c,incrementAccessibilityOnboardingAlertsCount:l,onA11yReviewCardShown:d})=>{const[h,m]=p.useState(!0),[y,v]=p.useState(!0),b=p.useRef(null);p.useEffect((()=>{var e;return null===(e=b.current)||void 0===e||e.focus(),d(),()=>{n.focus()}}),[]),p.useEffect((()=>{const e=g.R(document,"mousedown").pipe(o.h((e=>!!b.current&&!b.current.contains(e.target)))).subscribe((()=>{_()})),t=g.R(document,"keydown",{capture:!0}).pipe(o.h((e=>"Escape"===e.key))).subscribe((()=>{_()}));return()=>{e.unsubscribe(),t.unsubscribe()}}),[h]);const _=()=>{c<at&&l(),m(!1),s({name:F.w.A11Y_REVIEW_CARD_CLOSED})},f=()=>v(!y),S=(0,r.zG)(a,u.WG);if(!h||!S)return null;const{replacementTextRange:E,replacementText:x,delta:R}=S,P=i.getCurrentTextMap().getPlainText(),O=(0,r.zG)(re(P,E.start),ie.pF((()=>null)));if(!O)return null;const D=P.slice(O.start,O.end),L=P.substring(O.start,E.start)+x+P.substring(E.end,O.end),B=R.slice(O.start),{diffVisibleText:H,screenReaderText:z}=((e,t)=>{const i=(()=>{let e=0;return i=>{if(w.s.isDelete(i)){const r=i.delete,a=t.slice(e,e+r);return e+=r,{type:M.DELETE,displayText:a}}if(w.s.isRetain(i)){const r=i.retain,a=t.slice(e,e+r);return e+=r,{type:M.RETAIN,displayText:a}}const r=i.insert;return{type:M.INSERT,displayText:r}}})(),r=e=>e.type===M.INSERT,a=e=>e.type===M.DELETE,s=w.s.calcAffectedLength(e),n=t.length-s;return e.slice().retain(n).map(i).map(((e,t,i)=>{if(r(e)&&a(i[t+1])){const e=i[t+1];return{...e,displayText:[p.createElement(C.u,{key:`delete-marker-${t}`},"delete-marker"),p.createElement(T.x,{as:"span",className:A.a11yDeleteWord,key:`delta-${t}`},e.displayText)],screenReaderText:N({word:e.displayText,marker:M.DELETE,hasSpelling:!0})}}if(a(e)&&r(i[t-1])){const e=i[t-1];return{...e,displayText:[p.createElement(C.u,{key:`insert-marker-${t}`},"insert-marker"),p.createElement(T.x,{as:"span",className:A.a11yInsertWord,key:`delta-${t}`},e.displayText),p.createElement(C.u,{key:`end-insert-marker-${t}`},"end-insert-marker")],screenReaderText:N({word:e.displayText,marker:M.INSERT,hasSpelling:!0})}}if(r(e)){const i=e;return{...i,displayText:[p.createElement(C.u,{key:`insert-marker-${t}`},"insert-marker"),p.createElement(T.x,{as:"span",className:A.a11yInsertWord,key:`delta-${t}`},i.displayText),p.createElement(C.u,{key:`end-insert-marker-${t}`},"end-insert-marker")],screenReaderText:N({word:i.displayText,marker:M.INSERT,hasSpelling:!1})}}if(a(e)){const i=e;return{...i,displayText:[p.createElement(C.u,{key:`delete-marker-${t}`},"delete-marker"),p.createElement(T.x,{as:"span",className:A.a11yDeleteWord,key:`delta-${t}`},i.displayText),p.createElement(C.u,{key:`end-delete-marker-${t}`},"end-delete-marker")],screenReaderText:N({word:i.displayText,marker:M.DELETE,hasSpelling:!1})}}const s=e;return{...s,displayText:[p.createElement(T.x,{as:"span",className:A.a11yRetainWord,key:`delta-${t}`},s.displayText)],screenReaderText:s.displayText}})).reduce(((e,t)=>(e.diffVisibleText.push(...t.displayText),e.screenReaderText+=t.screenReaderText,e)),{diffVisibleText:[],screenReaderText:""})})(B,D),q=()=>p.createElement(T.x,{as:"strong",variant:"text-xsmall"},p.createElement(k.F.Fragment,null,t));return p.createElement(Q.x,{elevation:"medium",style:I({caretPosition:e}),className:A.a11yReviewCard},p.createElement(G.X,{as:"h2",className:A.a11yReviewCardTitle,id:"grammarly-a11y-review-title"},p.createElement(C.u,null,"Grammarly - Quick Fix. Press ",p.createElement(q,null),` to apply. ${y?z:L}`),p.createElement("span",{"aria-hidden":!0},"Quick Fix • Press ",p.createElement(q,null)," to apply")),p.createElement("section",{tabIndex:0,ref:b,className:A.a11yReviewCardBody,"data-testid":"section-diff","aria-labelledby":"grammarly-a11y-review-title",onClick:f},y?H:p.createElement(T.x,{as:"span",className:A.a11yRetainWord},L)),p.createElement(U.k,{gap:1,justify:"start",align:"center",className:A.a11yReviewCardFooter},p.createElement(W.z,{size:"small",variant:"secondary",onClick:()=>{m(!1),s({name:F.w.HOTKEY_PRESSED})}},"Apply"),p.createElement(W.z,{size:"small",variant:"tertiary",onClick:_},"Cancel"),p.createElement(ee,{isSelected:y,onChange:f},p.createElement(C.u,null,y?"Showing insertions and deletions":"Showing updated text"),p.createElement("span",{"aria-hidden":!0},"Show insertions and deletions"))))},se=({children:e})=>p.createElement(T.x,{as:"strong",variant:"text-xsmall"},e),ne=({accessibilityOnboardingAlertsCount:e})=>{const t=p.createElement(p.Fragment,null,`${(e=>{const t=at-e-1;return t>0?`This is an onboarding message that will be communicated ${t} more ${(0,x._6)(t,"time","times")}.`:"This is the last time this onboarding message will be communicated."})(e)} After that, we will play a sound to let you know that Grammarly has applied fixes for you.`),i=p.createElement(p.Fragment,null,"Press ",p.createElement(se,null,"Return")," while in this window to hear the sound or press"," ",p.createElement(se,null,"Escape")," to return to your text.");return p.createElement("div",{id:"a11ySuccessOnboardingTextId"},p.createElement(T.x,{as:"p",variant:"text-xsmall","aria-label":P(t)},t),p.createElement(T.x,{as:"p",variant:"text-xsmall","aria-label":P(i)},i))};var oe=i(30193);const ce=({accessibilitySoundService:e,numberOfFixes:t,accessibilityOnboardingAlertsCount:i,incrementAccessibilityOnboardingAlertsCount:r,onA11ySuccessOnboardingModalShown:a,textFieldElement:s})=>{const[n,c]=p.useState(!0);return p.useEffect((()=>{const t=g.R(document,"keydown",{capture:!0}).pipe(o.h((e=>"Enter"===e.key))).subscribe((t=>{t.preventDefault(),e.playSuggestionsAppliedSound()}));return a(),()=>{t.unsubscribe(),s.focus()}}),[]),p.createElement(f.u_,{width:"small",title:p.createElement("span",{id:"a11ySuccessOnboardingModalTitleId","aria-labelledby":"a11ySuccessOnboardingModalTitleId a11ySuccessOnboardingTextId"},p.createElement(S.J,{icon:E.H,accessibilityLabel:"",size:"large",style:{width:"4rem",height:"4rem"}}),`Grammarly fixed ${t} ${(0,x._6)(t,"error","errors")}.`),isOpen:n,onClose:()=>{r(),c(!1)},hasCloseButton:!1,className:oe.a11yOnboardingModal,role:"alertdialog"},p.createElement(f.u_.Body,null,p.createElement(ne,{accessibilityOnboardingAlertsCount:i})))};var le=i(33483),ue=i(28893),de=i(61378);const pe=({children:e,className:t,coords:i,tooltipWrapperRef:r,tooltipWrapperHandlers:a})=>p.createElement(U.k,{className:t,style:i,ref:r,"data-testid":"hotkeyWrapper",...a},p.createElement(U.k,{className:de.logoWrapper},p.createElement(S.J,{className:de.logoIcon,icon:ue.p,accessibilityLabel:"Grammarly logo",size:"small"})),p.createElement(U.k,{className:de.contentWrapper},e));var he,me=i(9273),ge=i(88030),ye=i(18799);!function(e){e.Initial="Initial",e.Transitional="Transitional",e.Off="Off"}(he||(he={})),function(e){e.getV2=function(t,i){const r=function(t){switch(t){case 0:return e.Initial;case 1:case 2:return e.Transitional;default:return e.Off}}(t);if(r===e.Off&&(0,ye.ix)(i)){const t=new Date,r=new Date(i);return(0,ye.wt)(r)(t)>=ge.an(3)?e.Initial:e.Off}return r}}(he||(he={}));const ve=({softOnboardingState:e=he.Off})=>{const[t,i]=p.useState(!1),r=e===he.Initial||e===he.Transitional&&!t;return p.useEffect((()=>{e===he.Transitional&&me.timer(ge.m9(4)).subscribe((()=>i(!0)))}),[]),r},be=({caretPosition:e,softOnboardingState:t=he.Off,expandedConstantly:i=!1})=>{const[r,a]=p.useState(!1),[s,n]=p.useState(!1),{isLeftAligned:o,coords:c}=(({caretPosition:e})=>{var t;const{bottom:i,right:r}=e,a=i+2,s=r,n=((null===(t=self.visualViewport)||void 0===t?void 0:t.width)||self.innerWidth)-r,o=n>200;return{isLeftAligned:o,coords:o?{top:a,left:s}:{top:a,right:n}}})({caretPosition:e}),l=ve({softOnboardingState:t}),u=i||l||r||s,d=p.useRef(null),h=p.useRef(null),m=p.useRef(null);return p.useEffect((()=>{((e,t,i,r)=>{const a=t.current,s=i.current,n=r.current;null==a||a.classList.toggle("tooltipWrapperExpanded",e),s&&(s.style.width=e?"0px":`${s.scrollWidth}px`),n&&(e?(n.style.removeProperty("justify-content"),n.style.width=`${n.scrollWidth}px`,n.style.justifyContent="flex-end"):n.style.width="0px")})(u,d,m,h)}),[u]),{isTooltipHovered:r,isQuickSettingsMenuOpen:s,isOnboardingActive:l,isLeftAligned:o,coords:c,errorsLabel:e=>e&&p.createElement(k.F.Fragment,null,e.view((e=>`${e} error${1===e?"":"s"}`))),setIsQuickSettingsMenuOpen:n,setIsTooltipHovered:a,tooltipWrapperRef:d,expandedContentRef:h,minimizedContentRef:m}};var _e=i(79117),fe=i(56131),Se=i(40612),Ee=i(61975);const Te=(0,Ee.I)("color",(({title:e,titleId:t,desc:i,descId:r,...a})=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceSnooze",stroke:"transparent","aria-labelledby":t,"aria-describedby":r,...a},i?p.createElement("desc",{id:r},i):null,e?p.createElement("title",{id:t},e):null,p.createElement("path",{stroke:"#646B81",strokeLinecap:"round",d:"M8 4v4h3.2M8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12Z"})))),ke=(0,Ee.I)("color",(({title:e,titleId:t,desc:i,descId:r,...a})=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceLogout",stroke:"transparent","aria-labelledby":t,"aria-describedby":r,...a},i?p.createElement("desc",{id:r},i):null,e?p.createElement("title",{id:t},e):null,p.createElement("path",{stroke:"#646B81",strokeLinecap:"round",d:"M8 2v6.316m2.139-5.239c1.975.863 3.361 2.884 3.361 5.239C13.5 11.456 11.038 14 8 14s-5.5-2.545-5.5-5.684c0-2.355 1.386-4.376 3.361-5.239"}))));var xe=i(37213),we=i(45013),Ce=i(88657);function Re(){return"red"===(0,we.OB)().experimentClient.getTreatment(Ce.p.TouchTypistProminentTooltip)}var Ae=i(31529),Ie=i(32184);const Pe=({keyName:e})=>p.createElement(T.x,{className:Ie.keyIcon,as:"span",variant:"text-xsmall",color:"base-subdued"},e),Oe=({className:e,quickFixKey:t,quickSettingsIcon:i=_e.D,onQuickSettingsMenuUnmount:r,onQuickSettingsButtonClick:a,onQuickSettingsShown:s,onChangeQuickFixKeyTextboxFocus:n,onChangeQuickFixKeyTextboxBlur:o,onTurnOffQuickFixClick:c,onSnoozeQuickFixClick:l})=>{const[u,d]=p.useState(!1),h=p.useRef(null);p.useEffect((()=>r),[]);const m=p.useCallback((()=>{d(!u),a(u)}),[u,a]),g=p.useCallback((e=>{e&&s()}),[s]),y=p.useCallback((e=>{e&&e.addEventListener("focus",n,!0)}),[]);return p.createElement(U.k,{className:Ie.quickSettingsMenuWrapper},p.createElement(fe.h,{...(0,xe.Sh)(e,Ie.quickSettingsMenuButton),size:"small",variant:"tertiary",icon:i,accessibilityLabel:"Quick Settings",onClick:m,"data-testid":"grammarly-touch-typist-hotkey-hint-quick-settings-button"}),u&&p.createElement(U.k,{ref:g,direction:"column",bgColor:"background-base-subdued",borderColor:"base-subdued",borderRadius:1,elevation:"low",className:Ie.quickSettingsMenu,"data-testid":"grammarly-touch-typist-hotkey-hint-quick-settings-menu"},p.createElement(U.k,{className:Ie.quickSettingsMenuChangeQuickFixKeySection,direction:"column",gap:2},p.createElement(T.x,{as:"p",variant:"text-xsmall",color:"base-subdued",onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.focus()}},"Change quick fix key"),p.createElement(k.F.Fragment,null,t.view((e=>p.createElement(Se.n,{ref:(0,Ae.l)([h,y]),value:e,labelDisplay:"hidden",label:"Change quick fix key",placeholder:"Enter shortcut",onBlur:o})))),p.createElement(T.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Try ",p.createElement(Pe,{keyName:"⇧"})," ",p.createElement(Pe,{keyName:"/"})," or ",p.createElement(Pe,{keyName:"->"}))),("snooze"===(0,we.OB)().experimentClient.getTreatment(Ce.p.TouchTypistProminentTooltip)||Re())&&p.createElement(U.k,{className:Ie.quickSettingsMenuRow},p.createElement(W.z,{className:Ie.quickSettingsMenuActionButton,variant:"tertiary",iconStart:Te,width:"full",text:"Snooze for 1 hour",onClick:l})),p.createElement(U.k,{className:Ie.quickSettingsMenuRow},p.createElement(W.z,{className:Ie.quickSettingsMenuActionButton,variant:"tertiary",iconStart:ke,width:"full",text:"Turn off quick fix",onClick:c}))))},Me=({caretPosition:e,softOnboardingState:t=he.Initial,errorsCount:i,quickFixKey:r,label:a,onQuickSettingsMenuUnmount:s,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:u,onSnoozeQuickFixClick:d})=>{const{isQuickSettingsMenuOpen:h,isLeftAligned:m,coords:g,errorsLabel:y,setIsQuickSettingsMenuOpen:v,setIsTooltipHovered:b,tooltipWrapperRef:_,expandedContentRef:f,minimizedContentRef:S}=be({caretPosition:e,softOnboardingState:t}),E=m?de.prominentHotkeyLeft:de.prominentHotkeyRight,x=[de.prominentHotkeyWrapperRed,E].join(" ");return p.createElement(pe,{className:x,coords:g,tooltipWrapperRef:_,tooltipWrapperHandlers:{onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1)}},p.createElement(U.k,{className:de.expandedContent,ref:f,gap:1,"data-testid":"expandedContent"},p.createElement(U.k,{className:de.hintTextWrapper,gap:1},p.createElement(T.x,{className:de.hintText,as:"span",variant:"text-xsmall"},m?p.createElement(p.Fragment,null,"To fix ",y(i),": Press"):p.createElement(p.Fragment,null,"Press")),p.createElement(U.k,{className:de.hintTagWrapper},p.createElement(T.x,{className:de.hintTagExpanded,as:"span",variant:"text-xsmall"},p.createElement(k.F.Fragment,null,a))),!m&&p.createElement(T.x,{className:de.hintText,as:"span",variant:"text-xsmall"},"to fix ",y(i))),p.createElement(U.k,{className:de.quickSettings},p.createElement(Oe,{className:de.quickSettingsButton,quickFixKey:r,quickSettingsIcon:le.a,onQuickSettingsMenuUnmount:()=>{f.current&&(f.current.style.overflow="hidden"),v(!1),s()},onQuickSettingsButtonClick:e=>{f.current&&(f.current.style.overflow=h?"hidden":"visible"),v(!h),n(e)},onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:u,onSnoozeQuickFixClick:d}))),p.createElement(U.k,{className:de.minimizedContent,ref:S,"data-testid":"minimizedContent"},p.createElement(T.x,{className:de.hintTagMinimized,as:"span",variant:"text-xsmall"},p.createElement(k.F.Fragment,null,a))))},Ne=({caretPosition:e,numberOfFixes:t,softOnboardingState:i=he.Initial})=>{const{isLeftAligned:r,coords:a,errorsLabel:s,tooltipWrapperRef:n,expandedContentRef:o}=be({caretPosition:e,softOnboardingState:i,expandedConstantly:!0}),[c,l]=p.useState(!1),u=r?de.prominentHotkeyLeft:de.prominentHotkeyRight,d=[de.prominentHotkeyWrapperGreen,u].join(" ");return p.useEffect((()=>{me.timer(ge.m9(4)).subscribe((()=>l(!0)))}),[]),c?null:p.createElement(pe,{className:d,coords:a,tooltipWrapperRef:n},p.createElement(U.k,{className:de.expandedContent,ref:o,gap:1,"data-testid":"expandedContent"},p.createElement(T.x,{className:de.hintText,as:"span",variant:"text-xsmall"},s(t)," fixed!")))};var De=i(82403);const Le=()=>p.createElement(U.k,{className:De.bubbleContainer},p.createElement("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:De.bubble},p.createElement("path",{d:"M0 7.00023C0 3.13372 3.13344 0 7.00035 0C10.8673 0 14 3.13372 14 7.00023C14 10.3829 11.6017 13.2049 8.41204 13.8581C7.95631 13.9515 7.48418 14 7.00246 14H0V7.00023Z",fill:"#027E6F"}),p.createElement("path",{d:"M3.92422 7.57649L5.8528 9.50507L10.3528 5.00507",stroke:"white",strokeWidth:"1.25",className:De.checkmark})));var Fe=i(55979);const Be=({label:e})=>p.createElement(U.k,{className:Fe.hotkeyHintTagContainer,bgColor:"background-base-default",borderColor:"base-default",borderRadius:1},p.createElement(T.x,{className:Fe.hotkeyHintTagLabel,as:"small",variant:"text-xsmall",weight:"semibold",color:"base-subdued"},p.createElement(k.F.div,null,e))),He=({show:e,children:t})=>{const[i,r]=p.useState(!1),[a,s]=p.useState(!1),n=(()=>{const e=p.useRef(!0);return p.useEffect((()=>{e.current=!1}),[]),e.current})();p.useEffect((()=>{if(n&&!e)return;let t;r(!0),e||(t=self.setTimeout((()=>r(!1)),300)),s(!e);const i=self.setTimeout((()=>s(e)),50);return()=>[t,i].forEach(clearTimeout)}),[e]);const o={opacity:a?1:0,transition:"opacity 250ms"};return i&&t?p.createElement("div",{style:o,"data-testid":"grammarly-touchtypist-fade-wrapper"},t):null},Qe=({label:e,errorsCount:t,softOnboardingState:i=he.Off,caretPosition:r,quickFixKey:a,onQuickSettingsMenuUnmount:s,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:u,onSnoozeQuickFixClick:d})=>{const h=p.useRef(null),[m,g]=p.useState(0),[y,v]=p.useState(!1),b=ve({softOnboardingState:i});p.useEffect((()=>{const e=new ResizeObserver((e=>{for(const t of e)t.target===h.current&&g(t.contentRect.width)}));return h.current&&e.observe(h.current),()=>{e.disconnect()}}),[]);const _=p.createElement(U.k,{ref:h,className:Ie.hotkeyHintTagWrapper,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),"data-testid":"grammarly-touch-typist-hotkey-hint"},p.createElement(Be,{label:e})),f=p.createElement(U.k,{className:Ie.hotkeyHintTagPlaceholder,style:{width:m}}),E=p.createElement(k.F.Fragment,null,t.view((e=>`${e} error${1===e?"":"s"}`))),x=p.createElement(U.k,{className:Ie.expandedHotkeyHint,bgColor:"background-base-subdued",borderRadius:2,align:"center",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),"data-testid":"grammarly-touch-typist-expanded-hotkey-hint"},p.createElement(S.J,{className:Ie.grammarlyLogo,size:"small",icon:ue.p,accessibilityLabel:"Grammarly logo"}),p.createElement(T.x,{className:Ie.expandedHotkeyHintText,as:"p",variant:"text-xsmall",color:"base-subdued"},"To fix ",E,", press"),f,p.createElement(Oe,{className:Ie.quickSettingsButton,quickFixKey:a,onQuickSettingsMenuUnmount:s,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:u,onSnoozeQuickFixClick:d})),w=p.createElement(U.k,{...(0,xe.Sh)(Ie.expandedHotkeyHint,Ie.leftAligned),bgColor:"background-base-subdued",borderRadius:2,align:"center",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),"data-testid":"grammarly-touch-typist-expanded-hotkey-hint"},p.createElement(S.J,{className:Ie.grammarlyLogo,size:"small",icon:ue.p,accessibilityLabel:"Grammarly logo"}),p.createElement(T.x,{className:Ie.expandedHotkeyHintText,as:"p",variant:"text-xsmall",color:"base-subdued"},"Press"),f,p.createElement(T.x,{className:Ie.expandedHotkeyHintText,as:"p",variant:"text-xsmall",color:"base-subdued"},"to fix ",E),p.createElement(Oe,{className:Ie.quickSettingsButton,quickFixKey:a,onQuickSettingsMenuUnmount:s,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:u,onSnoozeQuickFixClick:d})),{bottom:C,right:R}=r,A=C+6,I=R-m/2,P=I<160?w:x;return p.createElement(U.k,{className:Ie.hotkeyHintWrapper,style:{top:A,left:I}},_,p.createElement(He,{show:b||y},P))};var Ge=i(9324);const Ue=()=>p.createElement(U.k,{className:Ge.dotsContainer,"data-testid":"loading-dots"},p.createElement("div",{className:Ge.dot}),p.createElement("div",{className:Ge.dot}),p.createElement("div",{className:Ge.dot}));var We,ze,qe,Ye=i(36807),$e=i(64297),Ve=i(13391),Ke=i(36344),je=i(63532);!function(e){function t(e,t){const i=e.ops;if(0===t||0===i.length)return e;const r=i[0];return w.s.isRetain(r)?{...e,ops:[{retain:t+r.retain},...i.slice(1)]}:{...e,ops:[{retain:t},...i]}}e.offsetDelta=t,e.rebaseByAppliedPreview=function(e){const i=e.original,a=e.replacement.length-i.length;return 0===a?r.yR:i=>i.begin>=e.end?{...i,begin:i.begin+a,end:i.end+a,highlight:{...i.highlight,s:i.highlight.s+a,e:i.highlight.e+a},delta:t(i.delta,a),previewDelta:t(i.previewDelta,a)}:i},e.normalize=function(e){return i=>({...i,begin:e+i.begin,end:e+i.end,delta:t(i.delta,e),previewDelta:t(i.previewDelta,e),highlight:{s:e+i.highlight.s,e:e+i.highlight.e},reverseDelta:t(i.reverseDelta,e)})}}(We||(We={})),function(e){e.normalize=function(e){return t=>({...t,highlightBegin:e+t.highlightBegin,highlightEnd:e+t.highlightEnd})},e.findCorrespondingPreview=function(e){return(0,r.ls)((t=>e.find((e=>e.revertId===t.revertId))),u.ij)}}(ze||(ze={})),function(e){e.rebaseByDismissedPreview=function(e){const t=e.original,i=e.replacement.length-t.length;return 0===i?r.yR:t=>t.correspondingPreview.begin>=e.end?{...t,highlightBegin:t.highlightBegin-i,highlightEnd:t.highlightEnd-i}:t}}(qe||(qe={}));var Xe,Ze=i(6141),Je=i(45345),et=i(32082);!function(e){e.IDLE="idle",e.LOADING="loading",e.REPLACING="replacing",e.READY="ready",e.REVIEWING="reviewing",e.SUCCESS="success"}(Xe||(Xe={}));const tt={current:{previews:[],reverts:[],replacementInfo:u.YP},applied:{reverts:[]}},it={state:Xe.IDLE,context:tt};class rt{constructor(e){this._params=e,this._subs=new a.w0,this._state=Ve.h.create(this._params.state),this._newParagraphsSinceRevert=new WeakMap,this._logger=et.Y.create("TouchTypistStateManagerImpl"),this.state=this._state.view(),this._interrupted=()=>{const e=this._state.get(),{state:t,context:i}=e;t!==Xe.IDLE&&this._state.set({state:Xe.IDLE,context:{current:{previews:[],reverts:[],replacementInfo:u.YP},applied:{reverts:i.applied.reverts}}})},this._loading=()=>{const e=this._state.get(),{state:t,context:i}=e;t===Xe.IDLE&&this._state.set({state:Xe.LOADING,context:{current:{previews:[],reverts:[],replacementInfo:u.YP},applied:{reverts:i.applied.reverts}}})},this._responseReceived=({response:e,currentText:t})=>{var i;const r=this._state.get(),{state:a,context:s}=r;if(a!==Xe.LOADING)return;if(!(null===(i=e.previews)||void 0===i?void 0:i.length))return void this._interrupted();const n=We.normalize(e.textScope.begin),o=e.previews.map((i=>{const r=n(i);return{...r,touchTypistId:e.touchTypistId,original:t.slice(r.begin,r.end),highlight:{...r.highlight,text:t.slice(r.highlight.s,r.highlight.e)},relativeReverseDelta:i.reverseDelta}})),c=ze.findCorrespondingPreview(o),l=ze.normalize(e.textScope.begin),d=e.reverts.reduce(((t,i)=>{const r=c(i);return u.pC(r)&&t.push({...l(i),touchTypistId:e.touchTypistId,highlightText:e.text.slice(i.highlightBegin,i.highlightEnd),isRecent:!0,correspondingPreview:r.value}),t}),[]),p={current:{...s.current,previews:o,reverts:d,replacementInfo:u.G({replacementText:e.text,replacementTextRange:{start:e.textScope.begin,end:e.textScope.end},delta:(0,Ze.RZ)(We.offsetDelta(e.delta,e.textScope.begin))})},applied:{reverts:s.applied.reverts}};this._state.set({state:Xe.READY,context:p}),this._params.isEnhancedScreenReaderUXSupported.get()&&this._params.accessibilitySoundService.playReadyToApplySuggestionsSound()},this._hotkeyPressed=async()=>{const e=this._state.get(),{state:t}=e;t===Xe.READY&&await this._applyAllPreviews()},this._hotkeyPressedWithScreenReader=async()=>{const e=this._state.get(),{state:t,context:i}=e;t!==Xe.READY&&t!==Xe.REVIEWING||(t!==Xe.READY?(await this._applyAllPreviews(),this._params.accessibilitySoundService.playSuggestionsAppliedSound()):this._state.set({state:Xe.REVIEWING,context:i}))},this._applySinglePreviewClicked=async({previewId:e})=>{const t=this._state.get(),{state:i,context:a}=t;if(i!==Xe.READY)return;const s=a.current.previews,n=s.find((t=>t.id===e));if(!n){const t="Could not find preview with the provided ID in state.";return this._logger.warn(t,{previewId:e,previewsInState:s}),void this._params.touchTypistTelemetryService.warn({message:t,data:{previewId:e,previewsInState:s}})}await this._params.eventExecutor.applyPreview(n);const o=n,c=a.current.previews.filter((e=>e.id!==o.id)),l=a.current.reverts.filter((e=>e.correspondingPreview.id!==o.id)),d=We.rebaseByAppliedPreview(o),p=c.map(d),h=(0,r.zG)(a.current.replacementInfo,u.UI((e=>{const t=o.original,i=o.replacement.length-t.length;return{...e,replacementTextRange:{...e.replacementTextRange,end:e.replacementTextRange.end+i}}})));this._state.set({state:c.length>0?Xe.READY:Xe.IDLE,context:{...a,current:{...a.current,previews:p,reverts:l,replacementInfo:h}}})},this._previewDismissed=({previewId:e})=>{const t=this._state.get(),{state:i,context:a}=t;if(i!==Xe.READY)return;const s=a.current.previews.find((t=>t.id===e));if(!s){const t=`Received a "${F.w.SINGLE_PREVIEW_DISMISSED}" event, but the corresponding preview is missing from the state.`;return this._logger.warn(t,{previewIdInPayload:e,previewsInState:a.current.previews}),void this._params.touchTypistTelemetryService.warn({message:t,data:{previewIdInPayload:e,previewsInState:a.current.previews}})}const n=a.current.previews.filter((e=>e!==s)),o=a.current.reverts.find((t=>t.correspondingPreview.id===e)),c=a.current.reverts.filter((e=>e!==o)),l=qe.rebaseByDismissedPreview(s),d=c.map(l),p=(0,r.zG)(a.current.replacementInfo,u.UI((e=>{const t=(0,Je.l)(new Ye.i([...s.relativeReverseDelta.ops]),e.replacementText);return{...e,replacementText:t}})));this._state.set({state:0===n.length?Xe.IDLE:Xe.READY,context:{...a,current:{...a.current,previews:n,reverts:d,replacementInfo:p}}})},this._individualRevertApply=({revertId:e})=>{const t=this._state.get(),{context:i}=t,r=t=>t.filter((t=>t.revertId!==e)),a=r(i.applied.reverts);this._state.set({state:Xe.IDLE,context:{...i,current:{...i.current,reverts:r(i.current.reverts)},applied:{...i.applied,reverts:a}}})},this._userAddedOrRemovedNewlines=()=>{const e=this._state.get(),{context:t}=e,i=e=>e.filter((e=>{var t;const i=(null!==(t=this._newParagraphsSinceRevert.get(e))&&void 0!==t?t:0)+1;return 2!=i&&(this._newParagraphsSinceRevert.set(e,i),!0)})),r=i(t.current.reverts),a=i(t.applied.reverts);this._state.set({...e,context:{...t,current:{...t.current,reverts:r},applied:{...t.applied,reverts:a}}})},this._updateReverts=()=>{const e=this._state.get(),{context:t}=e,i=t.applied.reverts.map((e=>({...e,isRecent:!1})));this._state.set({...e,context:{...t,applied:{...t.current,reverts:i}}})},this._replacementStarted=()=>{const e=this._state.get(),{state:t}=e;t===Xe.READY&&this._state.set({...e,state:Xe.REPLACING})},this._replacementFinished=()=>{const e=this._state.get(),{state:t}=e;t===Xe.REPLACING&&this._state.set({...e,state:Xe.READY})},this._handleEvent=e=>{const{isEnhancedScreenReaderUXSupported:t}=this._params,i=e.name;switch(i){case F.w.TEXT_SELECTION_OR_CARET_POSITION_CHANGED:case F.w.CAPI_RESPONSE_TIMED_OUT:return this._interrupted();case F.w.SENDING_CAPI_REQUEST_STARTED:return this._loading();case F.w.SENDING_CAPI_REQUEST_FAILED:return this._interrupted();case F.w.CAPI_RESPONSE_RECEIVED:return this._responseReceived(e.payload);case F.w.CAPI_RESPONSE_WITH_UNEXPECTED_CORRELATION_ID_RECEIVED:return this._interrupted();case F.w.HOTKEY_PRESSED:return t.get()?this._hotkeyPressedWithScreenReader():this._hotkeyPressed();case F.w.A11Y_ONBOARDING_MODAL_CLOSED:case F.w.A11Y_REVIEW_CARD_CLOSED:return this._interrupted();case F.w.APPLY_SINGLE_PREVIEW_CLICKED:return this._applySinglePreviewClicked(e.payload);case F.w.SINGLE_PREVIEW_DISMISSED:return this._previewDismissed(e.payload);case F.w.SINGLE_REVERT_APPLIED:return this._individualRevertApply(e.payload);case F.w.NEWLINES_ADDED_OR_REMOVED_BY_USER:return this._userAddedOrRemovedNewlines();case F.w.TEXT_CHANGED_BY_USER:return(0,r.ls)(this._interrupted,this._updateReverts)();case F.w.TEXT_CHANGED_BY_NON_TOUCH_TYPIST_REPLACEMENT:return this._interrupted();case F.w.REPLACEMENT_STARTED:return this._replacementStarted();case F.w.REPLACEMENT_FINISHED:return this._replacementFinished();default:(0,$e.L0)(i)}},this.handleEvent=async e=>{const t=this.state.get();await this._handleEvent(e);const i=this.state.get();this._logger.debug("Event handled.",{event:e.name,oldState:t.state,newState:i.state})},this.getTouchTypistId=()=>{const e=this.state.get().context.current.previews;return 0===e.length?null:Number(e[0].touchTypistId)},this._subs.add(this._state.pipe(y.g("state"),v.w((e=>e.state===Xe.LOADING?me.timer(5e3):Ke.E)),je.b((()=>{this._logger.warn("Request timed out."),this._params.touchTypistTelemetryService.error({message:"Request timed out."}),this.handleEvent({name:F.w.CAPI_RESPONSE_TIMED_OUT})}))).subscribe()),this._logger.debug("Initialized.")}dispose(){this._subs.unsubscribe()}async _applyAllPreviews(){const e=this._state.get(),{context:t}=e,i=(0,r.zG)(t.current.replacementInfo,u.WG);if(!i){const e=`Received a "${F.w.HOTKEY_PRESSED}" event, but the replacement data is missing from the state.`;return this._logger.warn(e),this._params.touchTypistTelemetryService.warn({message:e}),void this._interrupted()}const a=await this._params.eventExecutor.applyAllPreviews(i);if(ie.nM(a)){const e="Failed to apply all previews.";return this._logger.warn(e,{replacementInfo:i}),this._params.touchTypistTelemetryService.warn({message:e,data:{replacementInfo:i}}),void this._interrupted()}this._state.set({state:Xe.SUCCESS,context:{...tt,applied:{reverts:[...t.applied.reverts,...t.current.reverts]}}})}}const at=3;const st=({children:e,caretPosition:t})=>p.createElement("div",{style:{position:"fixed",top:h.ux.px(t.bottom+6),left:t.right,transform:"translateX(calc(-50% + 1px))"}},e);var nt=i(24666),ot=i(954),ct=i(21147),lt=i(59833),ut=i(32949),dt=i(42722),pt=i(20128),ht=i(41048);class mt{constructor(e){var t;this._params=e,this._subs=new a.w0,this._previewEq=ct.f7(((e,t)=>e.id===t.id)),this._revertEq=ct.f7(((e,t)=>e.revertId===t.revertId)),this.alertFilter=(t=this._params.alertProcessor,t.alerts.state.view((e=>Object.values(e).filter(Boolean).filter(ut.u.is))).pipe(s.U((e=>t=>{if(0===e.length||pt.S.isTouchTypistAlert(t))return!0;const i=e.filter((e=>e.kind===ut.y.Preview)).flatMap((e=>e.highlightRanges));return!t.highlightRanges.some((e=>i.some((t=>ht.SV.intersects(e,t)))))})))),[this._createTouchTypistStatePreviewsSubscription(),this._createTouchTypistStateRevertsSubscription()].forEach((e=>this._subs.add(e)))}_createTouchTypistStatePreviewsSubscription(){return this._params.touchTypistState.pipe(s.U((({context:e})=>e.current.previews)),nt.x()).pipe(ot.O([]),l.G(),o.h((([e,t])=>lt.Od(e)||lt.Od(t))),s.U((([e,t])=>({previewsToRemove:lt.e5(this._previewEq)(t)(e),previewsToAdd:lt.e5(this._previewEq)(e)(t)})))).subscribe((({previewsToRemove:e,previewsToAdd:t})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(String(e.id),{_tag:dt.i.alertUpdate}))),t.forEach((e=>this._params.alertProcessor.addAlert(ut.u.fromPreview()(e))))}))}_createTouchTypistStateRevertsSubscription(){return this._params.touchTypistState.pipe(s.U((({context:e})=>e.applied.reverts)),nt.x()).pipe(ot.O([]),l.G(),o.h((([e,t])=>lt.Od(e)||lt.Od(t))),s.U((([e,t])=>({revertsToRemove:lt.e5(this._revertEq)(t)(e),revertsToUpdate:lt.jV(this._revertEq)(e.filter((e=>e.isRecent)))(t.filter((e=>!e.isRecent))),revertsToAdd:lt.e5(this._revertEq)(e)(t)})))).subscribe((({revertsToRemove:e,revertsToUpdate:t,revertsToAdd:i})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(String(e.revertId),{_tag:dt.i.alertUpdate}))),t.forEach((e=>{const t={id:String(e.revertId),kind:ut.y.Revert};this._params.alertProcessor.changeAlert(t)})),i.forEach((e=>this._params.alertProcessor.addAlert(ut.u.fromRevert()(e))))}))}_removeAllTouchTypistAlerts(){this._params.alertProcessor.removeAllAlertsBy(ut.u.is,{_tag:dt.i.reset})}dispose(){this._subs.unsubscribe(),this._removeAllTouchTypistAlerts()}}var gt=i(84358),yt=i(86399),vt=i(92135),bt=i(66016);var _t=i(5968),ft=i(29416);function St(e,t,i){return m.T(t.obs.pipe(c.h(null)),e).pipe(ot.O(null),l.G(),n.M(i.state.pipe(s.U((e=>e.state)))),o.h((([[e,t],i])=>[e,t].every((e=>null!==e))&&i!==Xe.REPLACING)),s.U((([[,e]])=>e)))}var Et,Tt,kt,xt=i(29196);!function(e){e.is=function(e){return 1===e.changes.length&&xt.q.isDel(e.changes[0])}}(Et||(Et={})),function(e){e.is=function(e){return 1===e.changes.length&&xt.q.isIns(e.changes[0])}}(Tt||(Tt={})),function(e){e.is=function(e){return[Tt.is,Et.is].some((t=>t(e)))}}(kt||(kt={}));var wt=i(85111);const Ct=e=>{if(xt.q.isIns(e)){return e.pos+e.text.length}if(xt.q.isDel(e)){return e.pos}(0,$e.L0)(e)};function Rt(e,t){const i=et.Y.create(`TouchTypist.${Rt.name}`),a=Ct(e.changes[0]),s=e.newText,n=(0,r.zG)(re(s,a),ie.g_((e=>(i.error("Failed to get paragraph range containing position.",e,{text:s,position:a}),t.error({message:"Failed to get paragraph range containing position.",error:e,data:{text:s,position:a}}),null)),r.yR));return!n||n.start===n.end?(i.debug("Paragraph containing text change is empty."),u.YP):u.G(n)}function At(e){return t=>t.pipe(s.U((t=>Rt(t,e))))}class It{constructor(e){this._params=e,this._subs=new a.w0,this._activeParagraphRange=Ve.h.create(u.YP),this._logger=et.Y.create("TouchTypistParagraphServiceImpl"),this.activeParagraphRange=this._activeParagraphRange.view();const t=(i=this._params.textChangesAsync,r=this._params.replacementListener,l=this._params.stateManager,St(i,r,l).pipe(je.b((()=>{l.handleEvent({name:F.w.TEXT_CHANGED_BY_USER})})),o.h((e=>kt.is(e))),ft.b(1e3))).pipe(At(this._params.touchTypistTelemetryService));var i,r,l;const d=function(e,t){return e.pipe(n.M(t.state.pipe(s.U((e=>e.state)))),o.h((([,e])=>e===Xe.READY||e===Xe.REPLACING||e===Xe.REVIEWING)),s.U((([e])=>e)))}(this._params.textChangesAsync,this._params.stateManager).pipe(At(this._params.touchTypistTelemetryService)),p=function(e,t){return e.obs.pipe(n.M(t.state.pipe(s.U((e=>e.state)))),o.h((([e])=>e.source!==wt.P.touchTypist)),je.b((([,e])=>{e===Xe.READY&&t.handleEvent({name:F.w.TEXT_CHANGED_BY_NON_TOUCH_TYPIST_REPLACEMENT})})),c.h(u.YP))}(this._params.replacementListener,this._params.stateManager);this._subs.add(m.T(t,d,p).pipe(me.skipBy(u.Eh(ht.SV.eq))).subscribe((e=>{this._activeParagraphRange.set(e)})))}getTextRangeLastLineClientRectangle(e){this._logger.debug("TouchTypistParagraphServiceImpl.getTextRangeLastLineClientRectangle invoked");const t=(0,r.zG)(e,u.UI((i=()=>this._params.textObserver.getCurrentTextMap(),a=this._params.geometryProvider,s=this._params.geometryLayout,e=>(0,r.zG)(u.ij(a.create(e,i(),!0)),u.tS((e=>u.ij(a.getClientRects(e,!0)))),u.tS(vt.nI),u.g_((()=>[]),yt.UI((e=>bt.UL.setPosition(s.getCurrentConversionContext().clientToRelative(e),e))))))),u.VS(lt.Z$),u.WG);var i,a,s;if(!t)return this._params.touchTypistTelemetryService.info({message:"Failed to get the position of text range's last line.",data:{textRange:e}}),this._logger.debug("Failed to get the position of text range's last line.",{textRange:gt.QP(e)}),u.YP;const n=(0,_t.Z)(t,this._params.textFieldLayout.rect.getCurrent().client,this._params.textFieldLayout.scroll.getCurrent());return u.G({...n})}dispose(){this._subs.unsubscribe()}}var Pt=i(90506),Ot=i(6745),Mt=i(96848),Nt=i(73734);class Dt{constructor(e){this._params=e,this._logger=et.Y.create("TouchTypistGDocsIntegration"),this._logger.info("TouchTypist integration for GDocs")}get eventsTargetElement(){const e=(0,Nt.CI)(document);return e||(this._params.telemetry.error({message:"Could not find the target element for text events in GDocs"}),this._logger.error("Could not find the target element for text events"),document.body)}getTextRangeLastLineClientRectangle(e){return this._params.paragraphService.getTextRangeLastLineClientRectangle(e)}}class Lt{constructor(e){this._params=e,this._logger=et.Y.create("TouchTypistGenericIntegration"),this._logger.info("TouchTypist integration for non-GDocs")}get eventsTargetElement(){return document.body}getTextRangeLastLineClientRectangle(e){return this._params.paragraphService.getTextRangeLastLineClientRectangle(e)}}var Ft=i(77816);class Bt{constructor(e){this._params=e,this._log=et.Y.create("TouchTypistAccessibilitySoundServiceImpl"),this._cache=new Map}playReadyToApplySuggestionsSound(){const e=this.ttUrlConfig.readyToApplySuggestionsAudio;return this._play(e)}playSuggestionsAppliedSound(){const e=this.ttUrlConfig.suggestionsAppliedAudio;return this._play(e)}get ttUrlConfig(){return Ft.Rd().appConfig.url.assets.touchTypist}async _play(e){try{if(!this._cache.has(e)){const t=await this._params.csToBgRpcClient.fetchFileAsByteArray(e);this._cache.set(e,t)}const t=new Uint8Array(this._cache.get(e)).buffer;await this._params.touchTypistAudioService.play(t)}catch(t){this._log.error("Error playing sound.",t,{audioFileUrl:e})}}}class Ht{constructor(e){this._params=e,this._log=et.Y.create("TouchTypistAudioServiceImpl")}async play(e){await this._resumeAudioContextIfSuspended();const t=await this._decodeAudioData(e);this._playDecodedAudioData(t)}async _resumeAudioContextIfSuspended(){if("suspended"===this._params.audioContext.state)try{await this._params.audioContext.resume()}catch(e){this._log.warn("Error resuming audio context.",e)}}async _decodeAudioData(e){try{return await this._params.audioContext.decodeAudioData(e)}catch(e){throw this._log.error("Error decoding audio data.",e),e}}_playDecodedAudioData(e){try{const t=this._params.audioContext.createBufferSource();t.buffer=e,t.connect(this._params.audioContext.destination),t.start(0)}catch(e){this._log.error("Error playing audio data.",e)}}}var Qt=i(74822),Gt=i(26156),Ut=i(84178),Wt=i(18595),zt=i(31789),qt=i(44045),Yt=i(98665),$t=i(6655),Vt=i(89977),Kt=i(95804),jt=i(75558);class Xt{constructor(e){this._params=e,this._logger=et.Y.create("TouchTypistCapiServiceImpl"),this._terminate=new Qt.x,this._correlationId=""}triggerTouchTypist(e){const t=this._params.getCheckingService();if(!t)return this._logger.error("Checking service is not available in TouchTypist"),Promise.reject(new Error("Checking service is not available in TouchTypist"));const i=(0,Vt.M8)(),a={action:"trigger_touch_typist",mode:"GEC_PROGRESSIVE_RECHECK",features:[Yt.zV.individualPreviewReverts],textScope:e,correlationId:i,id:1},n=this._params.textChangeBuffer.empty.pipe(o.h(r.yR),s.U((e=>u.YP))),l=(0,jt.OB)().experimentClient.isGateEnabled(Kt.K.TouchTypistPartialTrigger)?Gt.S(this._params.textChangeBuffer.pending.pipe(ft.b(100),o.h(this._areChangesAtTheEndOfParagraph(e))),n):n;return this._terminate.next(void 0),(0,jt.OB)().experimentClient.isGateEnabled(Kt.K.TouchTypistForcedBufferFlush)&&this._params.textChangeBuffer.flush(),(0,r.zG)(t.checkingRevisionInfo,ft.b(100),v.w((e=>l)),Ut.q(1),Wt.L(4e3,zt._((()=>{throw this._logger.error(`TouchTypist request couldn't be sent because latest revision wasn't emitted, correlation id: ${i}`),this._params.touchTypistTelemetryService.error({message:"TouchTypist request couldn't be sent because latest revision wasn't emitted",data:{textScope:e,correlationId:i}}),new Error(`TouchTypist request couldn't be sent because latest revision wasn't emitted, correlation id: ${i}`)}))),qt.R(this._terminate),s.U((e=>(0,r.zG)(e,u.UI((e=>this._compactRange(a.textScope,e))),u.fS((()=>a.textScope))))),o.h((e=>e.end-e.begin>0)),je.b((e=>{t.sendTouchTypistCommand({...a,textScope:e}),this._correlationId=i})),c.h(void 0)).toPromise()}onTouchTypistTriggerResponse(e){if(this._logger.debug("TouchTypist TriggerResponse received.",e),this._correlationId===e.correlationId){const t=this._params.textObserver.getTextSource().getPlainText();this._params.stateManager.handleEvent({name:F.w.CAPI_RESPONSE_RECEIVED,payload:{response:e,currentText:t}})}else this._params.touchTypistTelemetryService.warn({message:"The correlation id in the response does not match the correlation id in the request."}),this._logger.warn("The correlation id in the response does not match the correlation id in the request."),this._params.stateManager.handleEvent({name:F.w.CAPI_RESPONSE_WITH_UNEXPECTED_CORRELATION_ID_RECEIVED})}_compactRange(e,t){if(0===t.delta.length())return e;const i=((e,t)=>{const i=[" ","\n","\r"];if("retain"in t.delta.ops[0]){const a=t.delta.ops[0].retain;return(0,r.zG)(i,lt.f2((t=>{const i=e.lastIndexOf(t,a);return-1!==i?u.G(i):u.YP})),u.fS((()=>0)))}return 0})(this._params.textObserver.getCurrentTextMap().getPlainText(),t);return{begin:e.begin,end:e.begin+i}}_areChangesAtTheEndOfParagraph(e){return t=>(0,r.zG)(t,u.UI((t=>{const i=(0,r.zG)(t.delta.ops,lt.zT((e=>"retain"in e)),(({init:e,rest:t})=>lt.u4(0,((e,t)=>e+t.retain))(e)+("insert"in t[0]&&"string"==typeof t[0].insert?t[0].insert.length:0)));return e.end===i})),u.fS((()=>!0)))}_sendCommand(e,t=!0){const i=this._params.getCheckingService();if(!i)throw this._logger.error("Checking service is not available in TouchTypist"),new Error("Checking service is not available in TouchTypist");return t?i.sendTouchTypistCommand(e):(0,r.Q1)()}sendTouchTypistPreviewAction(e,t,i){try{this._sendCommand({actionType:e,previewId:i,touchTypistId:t,action:"touch_typist_action",id:1})}catch(t){this._logger.error(`Failed to send touch typist preview action: ${e} for preview id: ${i} with error: ${t}`)}}sendTouchTypistRevertAction(e,t){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:$t.XN.Revert,revertId:t,location:"REVERT_CARD"})}catch(e){this._logger.error(`Failed to send touch typist revert action for revert id: ${t} with an error ${e}`)}}sendTouchTypistApplyAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:$t.XN.Apply,location:"HOTKEY",hotkey:"TAB"})}catch(t){this._logger.error(`Failed to send touch typist apply action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistRevertLookAction(e,t){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:$t.XN.RevertLook,touchTypistId:e,revertId:t})}catch(e){this._logger.error(`Failed to send touch typist revert look action for revert id: ${t} with an error ${e}`)}}sendTouchTypistAppearAction(e){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:$t.XN.Appeared,touchTypistId:e})}catch(t){this._logger.error(`Failed to send touch typist appear action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistSkipAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:$t.XN.Skipped})}catch(t){this._logger.error(`Failed to send touch typist skip action for touch typist id: ${e} with an error ${t}`)}}}var Zt=i(46549);class Jt{constructor(e){this._params=e,this._subs=new a.w0}listeningToHotkeyApply(){this._subs.add(this._params.touchTypistStateValue.pipe(s.U((e=>e===Xe.READY||e===Xe.REVIEWING)),nt.x(),v.w((e=>e?m.T((0,Zt._w)(this._params.targetElement,this._params.isMac,this._params.hotkey),(0,Zt._w)(document.querySelector("grammarly-popups"),this._params.isMac,this._params.hotkey)):Ke.E)),o.h((({shortcut:e})=>e===this._params.hotkey.get())),je.b((({events:e})=>{e.forEach((e=>{e.preventDefault()}))}))).subscribe((()=>{this._params.onHotkeyPress()})))}dispose(){this._subs.unsubscribe()}}var ei=i(99120);class ti{constructor(e){this._params=e,this._logger=et.Y.create("TouchTypistPreviewApplicationServiceImpl")}async applyPreview(e){const{replacementService:t,telemetryService:i,capiService:r}=this._params,{id:a,begin:s,end:n,replacement:o,original:c,touchTypistId:l}=e;try{await t.performReplacement({pos:{start:s,end:n},value:o},c,!1,!1)()}catch(t){const r="Failed to apply preview.";this._logger.error(r,t,{preview:e}),i.error({message:r,error:t,data:{previewId:a}})}finally{r.sendTouchTypistPreviewAction($t.XN.IndividualPreviewApply,Number(l),a)}}async applyAllPreviews(e){const{textObserver:t,replacementService:i}=this._params,{replacementTextRange:a,replacementText:s,delta:n}=e,o=t.getCurrentTextMap().getPlainText().slice(a.start,a.end),c=(()=>{const e=t.getCurrentTextMap().getFormatHelper(),i=null==e?void 0:e.getInfo(a.start,a.end);if(!i)return!1;const{footnoteCount:r=0,hyperlinksCount:s=0,smartChipsCount:n=0}=i;return r>0||s>0||n>0})()?i.performBatchReplacements((0,ei.g)(n),{pos:a,value:s},o):i.performReplacement({pos:a,value:s},o,!0,!1),l=await c();return(0,r.zG)(l,ie.UI(r.Q1))}}var ii=i(62552),ri=i(49445);class ai{constructor(e){this._params=e,this._subs=new a.w0,this._textChangesObs=new ii.X({changes:[],prevText:"",newText:"",deltaChange:ri.RI.delta(new Ye.i)}),this.textChangesAsyncObs=this._textChangesObs.asObservable(),this._subs.add(this._params.textObserver.contentChanges.async.subscribe((e=>{0!==e.changes.length&&this._textChangesObs.next(e)})))}dispose(){this._subs.unsubscribe()}}class si{constructor(e){this._params=e}async trackOpenQuickSettingsButtonClicked(){await this._params.gnarClient.touchTypistOpenQuickSettingsButtonClick()}async trackQuickSettingsShown(){await this._params.gnarClient.touchTypistQuickSettingsShow()}async trackQuickSettingsEditHotkeyButtonClicked(){await this._params.gnarClient.touchTypistQuickSettingsEditHotkeyButtonClick()}async trackQuickSettingsTurnOffButtonClicked(){await this._params.gnarClient.touchTypistQuickSettingsTurnOffButtonClick()}async trackQuickSettingsSnoozeButtonClicked(){await this._params.gnarClient.touchTypistQuickSettingsSnoozeButtonClick()}async trackA11yOnboardingReadyPopupShown(){await this._params.gnarClient.touchTypistA11yOnboardingReadyPopupShow()}async trackA11yOnboardingSuccessPopupShown(){await this._params.gnarClient.touchTypistA11yOnboardingSuccessPopupShow()}async trackA11yReviewCardShown(){await this._params.gnarClient.touchTypistA11yReviewCardShow()}}var ni=i(81446),oi=i(8794),ci=i(98189),li=i(74057);const ui=(e,t,i,r)=>ht.SV.translate(ht.SV.rebase(ht.SV.translate(e,-r.start),xt.k.fromDiff(t,i)),r.start);class di{constructor(e){this._params=e,this._logger=et.Y.create("TouchTypistReplacementServiceImpl"),this._subs=new a.w0,this._selectionOrCaretPosition=Ve.h.create(null),this._subs.add(this._params.selectionOrCaretPosition.pipe(o.h(u.pC),s.U(gt.MH)).subscribe(ni.wW(this._selectionOrCaretPosition)))}canPerformReplacement(e,t){return this._params.replacementService.canPerformReplacement(e,t)}_getApplyType(e,t){return e?"hotkey":t?"individualRevert":"individualPreview"}performReplacement(e,t,i=!0,r=!1){const a=this._getApplyType(i,r),s=Ve.h.create(null),{pos:n,value:o}=e,c=this._selectionOrCaretPosition.get();if(this.canPerformReplacement({pos:n,oldValue:t,value:o})&&c)return this._params.stateManager.handleEvent({name:F.w.REPLACEMENT_STARTED}),this._logger.debug("Perform replacement",{range:n,newText:o,prevText:t,caretPosition:c}),d.Y3((async()=>{const r=ui(c,t,o,n),l=this._params.textChangesAsync.pipe(oi.T(1));this._subs.add(l.subscribe((e=>s.set(e))));const u=await this._params.replacementService.performReplacement(e,{preserveFormatting:!0,touchTypistApplyType:a});if(await s.pipe(ci.n((e=>null===e)),Ut.q(1),Wt.L(500,b.of(null))).toPromise()&&!i&&"gDocsCanvas"===this._params.integrationInfo.integrationName&&await this._params.selectionOrCaretPosition.pipe(ft.b(200),Ut.q(1)).toPromise(),(0,li.TW)(u)&&this._params.selectionService.setSelection({start:r.start,end:r.end}),this._params.stateManager.handleEvent({name:F.w.REPLACEMENT_FINISHED}),!s.get())throw this._params.touchTypistTelemetryService.error({message:"Text changes emission timed out",data:{replacement:e,prevText:t}}),new Error("Text changes emission timed out");return u}),(i=>(this._logger.error("Failed to perform a replacement",i),this._params.touchTypistTelemetryService.error({message:"Failed to perform a replacement",data:{replacement:e,prevText:t,error:String(i)}}),new Error(`Failed to perform a single replacement. ${String(i)}`))));throw this._params.touchTypistTelemetryService.error({message:"Can't perform replacement at this range",data:{replacement:e,prevText:t}}),new Error("Can't perform replacement at this range")}performBatchReplacements(e,t,i){const r=Ve.h.create(null),{pos:a,value:s}=t,n=this._selectionOrCaretPosition.get();if(this._logger.debug("Perform batch replacements",{newText:s,prevText:i,caretPosition:n}),this._params.stateManager.handleEvent({name:F.w.REPLACEMENT_STARTED}),n)return d.Y3((async()=>{const o=ui(n,i,s,a),c=this._params.textChangesAsync.pipe(oi.T(1));this._subs.add(c.subscribe((e=>r.set(e))));const l=await this._params.replacementService.performBatchReplacements(e,{preserveFormatting:!0,touchTypistApplyType:"hotkey"});if(await r.pipe(ci.n((e=>null===e)),Ut.q(1),Wt.L(500,b.of(null))).toPromise(),await this._params.selectionOrCaretPosition.pipe(ft.b(200),Ut.q(1)).toPromise(),this._params.selectionService.setSelection({start:o.start,end:o.end}),this._params.stateManager.handleEvent({name:F.w.REPLACEMENT_FINISHED}),!r.get())throw this._params.touchTypistTelemetryService.error({message:"Text changes emission timed out",data:{replacements:e,singleReplacement:t,prevText:i}}),new Error("Text changes emission timed out");return l}),(r=>(this._logger.error("Failed to perform a batch replacement",r),this._params.touchTypistTelemetryService.error({message:"Failed to perform a batch replacement",data:{replacements:e,singleReplacement:t,prevText:i,error:String(r)}}),new Error(`Failed to perform a batch replacement. ${String(r)}`))));throw this._params.touchTypistTelemetryService.error({message:"Can't perform batch replacement. Selection is null"}),new Error("Can't perform batch replacement at this range. Selection is null")}dispose(){this._subs.unsubscribe()}}var pi=i(84308),hi=i(84908),mi=i(7543);class gi{constructor(e){this._params=e,this._subs=new a.w0,this._hotkeyChangeManager=Ve.h.create(null),this._lastKnownSelectionOrCaretPosition=Ve.h.create(u.YP),this._restoreSelectionSubject=new Qt.x,this._listenToHotkeyChangeSubscription=null,this.hotkey=this._params.csPageState.view((e=>{var t;return(null!==(t=e.touchTypistSettings)&&void 0!==t?t:Pt.Y).hotkey})),this.numberOfErrors=this._params.stateManager.state.view((e=>e.context.current.previews.length)),this.numberOfFixes=this._params.stateManager.state.view((e=>e.context.applied.reverts.filter((e=>e.isRecent)).length)),this.softOnboardingState=this._params.csPageState.view((e=>{var t;const i=null!==(t=e.touchTypistState)&&void 0!==t?t:Pt.c;return he.getV2(i.userAcceptedCount,i.lastUserAcceptedAt)})),this.accessibilityOnboardingAlertsCount=this._params.csPageState.view((e=>{var t;return(null!==(t=e.touchTypistState)&&void 0!==t?t:Pt.c).accessibilityOnboardingAlertsCount})),this.displayedQuickFixKey=Ve.h.create(""),[this.createDisplayedQuickFixKeySubscription(),this.createLastKnownSelectionOrCaretPositionSubscription(),this.createRestoreSelectionSubscription()].forEach((e=>this._subs.add(e)))}initiateQuickFixKeyChange(){if(this.isQuickFixKeyChangeInitiated(this._hotkeyChangeManager.get()))return;const e=new mi.c("",Ve.h.create(!0));this._hotkeyChangeManager.set(e),this._listenToHotkeyChangeSubscription=e.listenToHotkeyChange(this._params.isEnvMac),e.onIsActiveHotkeyChange()}confirmQuickFixKeyChange(){var e;const t=this._hotkeyChangeManager.get();if(!this.isQuickFixKeyChangeInitiated(t))return;t.tmpHotkey.get()?t.onApplyHotkeyChange(this._params.csActions):t.onDismissHotkeyChange(),null===(e=this._listenToHotkeyChangeSubscription)||void 0===e||e.unsubscribe(),this._listenToHotkeyChangeSubscription=null,this._hotkeyChangeManager.set(null)}restoreSelection(){this._restoreSelectionSubject.next(void 0)}turnOffQuickFix(){this._params.csActions.toggleTouchTypist(!1)}snoozeQuickFix(){this._params.csActions.snoozeTouchTypist()}incrementAccessibilityOnboardingAlertsCount(){this._params.csActions.incrementAccessibilityOnboardingAlertsCount()}trackOpenQuickSettingsButtonClicked(){this._params.gnarTrackingService.trackOpenQuickSettingsButtonClicked()}trackQuickSettingsShown(){this._params.gnarTrackingService.trackQuickSettingsShown()}trackQuickSettingsEditHotkeyButtonClicked(){this._params.gnarTrackingService.trackQuickSettingsEditHotkeyButtonClicked()}trackQuickSettingsTurnOffButtonClicked(){this._params.gnarTrackingService.trackQuickSettingsTurnOffButtonClicked()}trackQuickSettingsSnoozeButtonClicked(){this._params.gnarTrackingService.trackQuickSettingsSnoozeButtonClicked()}trackA11yOnboardingReadyPopupShown(){this._params.gnarTrackingService.trackA11yOnboardingReadyPopupShown()}trackA11yOnboardingSuccessPopupShown(){this._params.gnarTrackingService.trackA11yOnboardingSuccessPopupShown()}trackA11yReviewCardShown(){this._params.gnarTrackingService.trackA11yReviewCardShown()}dispose(){this.confirmQuickFixKeyChange(),this._subs.unsubscribe()}createDisplayedQuickFixKeySubscription(){const e=this._hotkeyChangeManager.pipe(v.w((e=>{var t;return null!==(t=null==e?void 0:e.tmpHotkey)&&void 0!==t?t:b.of(null)})));return pi.a([this.hotkey,e]).subscribe((([e,t])=>{this.displayedQuickFixKey.set(null===t?e:t)}))}isQuickFixKeyChangeInitiated(e){return null!==e&&null!==this._listenToHotkeyChangeSubscription&&!this._listenToHotkeyChangeSubscription.closed}createLastKnownSelectionOrCaretPositionSubscription(){return this._params.selectionOrCaretPosition.subscribe(ni.wW(this._lastKnownSelectionOrCaretPosition))}createRestoreSelectionSubscription(){return this._restoreSelectionSubject.pipe(hi.p(250)).subscribe((()=>{const e=this._lastKnownSelectionOrCaretPosition.get();u.pC(e)&&this._params.selectionService.setSelection(e.value)}))}}class yi{constructor(e){var t,i;this._params=e,this._subs=new a.w0,this._disposables=[],this._logger=et.Y.create("TouchTypistFeatureImpl"),this._accessibilitySoundService=new Bt({touchTypistAudioService:new Ht({audioContext:new AudioContext}),csToBgRpcClient:this._params.csToBgRpcClient}),this._stateManager=new rt({state:it,eventExecutor:this,accessibilitySoundService:this._accessibilitySoundService,touchTypistTelemetryService:this._params.touchTypistTelemetryService,isEnhancedScreenReaderUXSupported:this._params.csPageState.view("isEnhancedScreenReaderUXSupported")}),this._textChangesService=new ai({geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,selectionOrCaretPosition:this._params.selectionOrCaretPosition}),this._paragraphService=new It({textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionOrCaretPosition:this._params.selectionOrCaretPosition,replacementListener:this._params.replacementListener,stateManager:this._stateManager,geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._integration="gDocsCanvas"===this._params.integrationInfo.integrationName?new Dt({paragraphService:this._paragraphService,telemetry:this._params.touchTypistTelemetryService}):new Lt({paragraphService:this._paragraphService,telemetry:this._params.touchTypistTelemetryService}),this._touchTypistCapiService=new Xt({getCheckingService:this._params.getCheckingService,textChangeBuffer:this._params.textChangeBuffer,touchTypistTelemetryService:this._params.touchTypistTelemetryService,stateManager:this._stateManager,textObserver:this._params.textObserver}),this._replacementService=new di({replacementService:this._params.replacementService,textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionService:this._params.selectionService,selectionOrCaretPosition:this._params.selectionOrCaretPosition,stateManager:this._stateManager,integrationInfo:this._params.integrationInfo,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._touchTypistHotkey=this._params.csPageState.view((e=>{var t;const i=e.touchTypistSettings;return null!==(t=null==i?void 0:i.hotkey)&&void 0!==t?t:Pt.Y.hotkey})),this._touchTypistHotkeyManager=new Jt({hotkey:this._touchTypistHotkey,touchTypistStateValue:this._stateManager.state.pipe(s.U((e=>e.state))),targetElement:this._integration.eventsTargetElement,isMac:this._params.isMac,onHotkeyPress:()=>{this._stateManager.handleEvent({name:F.w.HOTKEY_PRESSED})}}),this._touchTypistAlertService=new mt({alertProcessor:this._params.alertProcessor,touchTypistState:this._stateManager.state}),this._touchTypistGnarTrackingService=new si({gnarClient:this._params.gnarClient}),this._hotkeyHintViewModel=new gi({csPageState:this._params.csPageState,csActions:this._params.csActions,stateManager:this._stateManager,isEnvMac:this._params.isMac,selectionService:this._params.selectionService,selectionOrCaretPosition:this._params.selectionOrCaretPosition,gnarTrackingService:this._touchTypistGnarTrackingService}),this._previewApplicationService=new ti({replacementService:this._replacementService,telemetryService:this._params.touchTypistTelemetryService,capiService:this._touchTypistCapiService,textObserver:this._params.textObserver}),this.alertFilter=this._touchTypistAlertService.alertFilter,this._logger.info("Touch Typist feature is initialized",this._params.integrationInfo),this._disposables.push(this._paragraphService,this._replacementService,this._touchTypistAlertService),this._touchTypistHotkeyManager.listeningToHotkeyApply(),this._disposables.push(this._touchTypistHotkeyManager),this._subs.add(this._paragraphService.activeParagraphRange.pipe(n.M(this._stateManager.state)).pipe(s.U((([e,t])=>{const i=(0,r.zG)(e,u.g_(r.gn,r.yR));i&&t.state===Xe.IDLE&&(this._logger.info("Send touch typist trigger event",i),this._stateManager.handleEvent({name:F.w.SENDING_CAPI_REQUEST_STARTED}),d.Y3((async()=>await this._touchTypistCapiService.triggerTouchTypist({begin:i.start,end:i.end})),(()=>this._stateManager.handleEvent({name:F.w.SENDING_CAPI_REQUEST_FAILED})))())}))).subscribe()),this._subs.add(this._createUserAddedOrRemovedNewlinesSubscription()),this._subs.add(vi(this._stateManager.state,(()=>this._stateManager.getTouchTypistId()),(e=>this._touchTypistCapiService.sendTouchTypistAppearAction(e)),(e=>this._touchTypistCapiService.sendTouchTypistSkipAction(e)))),this._subs.add((t=this._params.selectionOrCaretPosition,i=this._stateManager,t.pipe(n.M(i.state.pipe(s.U((e=>e.state)))),o.h((([,e])=>e!==Xe.REPLACING)),je.b((([,e])=>{e===Xe.READY&&i.handleEvent({name:F.w.TEXT_SELECTION_OR_CARET_POSITION_CHANGED})})),c.h(u.YP))).subscribe())}dispose(){this._disposables.forEach((e=>e.dispose()))}get touchTypistUI(){return function(e,t,i,r,a,n,o,l,d,h){const f=m.T(t.scroll.changes,g.R(self,"scroll",{capture:!0})).pipe(c.h(void 0)),S=[Xe.LOADING,Xe.READY,Xe.REVIEWING,Xe.REPLACING,Xe.SUCCESS];return a.pipe(y.g("state"),v.w((({state:t,context:a})=>{if(!S.includes(t))return b.of(u.YP);const c=e.activeParagraphRange.pipe(s.U((e=>r.getTextRangeLastLineClientRectangle(e))),s.U(u.WG),s.U((e=>{if(!e)return u.YP;const r=d.get()&&o.accessibilityOnboardingAlertsCount.get()<at;if(t===Xe.LOADING)return u.G(p.createElement(st,{caretPosition:e},p.createElement(Ue,null)));if(t===Xe.READY||t===Xe.REPLACING){const t={caretPosition:e,label:o.hotkey,errorsCount:o.numberOfErrors,softOnboardingState:o.softOnboardingState.get(),quickFixKey:o.displayedQuickFixKey,onQuickSettingsMenuUnmount:()=>{o.confirmQuickFixKeyChange()},onQuickSettingsButtonClick:e=>{o.restoreSelection(),e||o.trackOpenQuickSettingsButtonClicked()},onQuickSettingsShown:()=>{o.trackQuickSettingsShown()},onChangeQuickFixKeyTextboxFocus:()=>{o.initiateQuickFixKeyChange(),o.trackQuickSettingsEditHotkeyButtonClicked()},onChangeQuickFixKeyTextboxBlur:()=>{o.confirmQuickFixKeyChange(),o.restoreSelection()},onTurnOffQuickFixClick:()=>{o.turnOffQuickFix(),o.trackQuickSettingsTurnOffButtonClicked()},onSnoozeQuickFixClick:()=>{o.snoozeQuickFix(),o.trackQuickSettingsSnoozeButtonClicked()}};return u.G(p.createElement(p.Fragment,null,r&&p.createElement(H,{accessibilityOnboardingAlertsCount:o.accessibilityOnboardingAlertsCount.get(),incrementAccessibilityOnboardingAlertsCount:()=>o.incrementAccessibilityOnboardingAlertsCount(),onA11yReadyOnboardingModalShown:()=>{o.trackA11yOnboardingReadyPopupShown()},hotkey:o.hotkey,accessibilitySoundService:h,stateManagerHandleEvent:n,textFieldElement:i}),Re()?p.createElement(Me,{...t}):p.createElement(Qe,{...t})))}if(t===Xe.REVIEWING&&d.get())return u.G(p.createElement(ae,{caretPosition:e,hotkey:o.hotkey,textObserver:l,replacementInfo:a.current.replacementInfo,stateManagerHandleEvent:n,textFieldElement:i,accessibilityOnboardingAlertsCount:o.accessibilityOnboardingAlertsCount.get(),incrementAccessibilityOnboardingAlertsCount:()=>o.incrementAccessibilityOnboardingAlertsCount(),onA11yReviewCardShown:()=>{o.trackA11yReviewCardShown()}}));if(t===Xe.SUCCESS){const t=o.softOnboardingState.get()!==he.Off;return u.G(p.createElement(p.Fragment,null,t&&Re()?p.createElement(Ne,{caretPosition:e,softOnboardingState:o.softOnboardingState.get(),numberOfFixes:o.numberOfFixes}):p.createElement(st,{caretPosition:e},p.createElement(Le,null)),r&&p.createElement(ce,{accessibilityOnboardingAlertsCount:o.accessibilityOnboardingAlertsCount.get(),incrementAccessibilityOnboardingAlertsCount:()=>o.incrementAccessibilityOnboardingAlertsCount(),onA11ySuccessOnboardingModalShown:()=>{o.trackA11yOnboardingSuccessPopupShown()},numberOfFixes:o.numberOfFixes.get(),accessibilitySoundService:h,textFieldElement:i})))}return u.YP})));return m.T(f.pipe(_.c(c)),c)})))}(this._paragraphService,this._params.textFieldLayout,this._params.textFieldElement,this._integration,this._stateManager.state,this._stateManager.handleEvent,this._hotkeyHintViewModel,this._params.textObserver,this._params.csPageState.view("isEnhancedScreenReaderUXSupported"),this._accessibilitySoundService)}onTouchTypistTriggerResponse(e){this._touchTypistCapiService.onTouchTypistTriggerResponse(e)}createPreviewInlineCardModel(e){return new Ot.p({alert:e,replacementService:this._replacementService,stateManager:this._stateManager,touchTypistCapiService:this._touchTypistCapiService,telemetry:this._params.touchTypistTelemetryService})}createRevertInlineCardModel(e){return new Mt.I(e,this._replacementService,this._stateManager,this._touchTypistCapiService)}async applyPreview(e){await this._previewApplicationService.applyPreview(e)}async applyAllPreviews(e){const t=await this._previewApplicationService.applyAllPreviews(e);this._params.csActions.incrementTouchTypistUserAcceptedCount();const i=this._stateManager.getTouchTypistId();return i&&this._touchTypistCapiService.sendTouchTypistApplyAction(i),t}_createUserAddedOrRemovedNewlinesSubscription(){return St(this._textChangesService.textChangesAsyncObs,this._params.replacementListener,this._stateManager).pipe(o.h((e=>e.changes.some((e=>e.text.includes("\n"))))),c.h(void 0)).subscribe((()=>{this._stateManager.handleEvent({name:F.w.NEWLINES_ADDED_OR_REMOVED_BY_USER})}))}}function vi(e,t,i,r){let a=null;return e.pipe(l.G()).subscribe((([e,s])=>{const n=t();(n||a)&&(n&&e.state===Xe.LOADING&&s.state===Xe.READY&&(a=n,i(n)),a&&e.state===Xe.READY&&s.state===Xe.IDLE&&r(a))}))}},7543:(e,t,i)=>{i.d(t,{c:()=>u});var r=i(13391),a=i(84308),s=i(59179),n=i(20161),o=i(36344),c=i(63532),l=i(46549);class u{constructor(e,t){this._lastSubmittedShortcutValue=e,this._isInputFocused=t,this._isActiveHotkeyChange=r.h.create(!1),this.onApplyHotkeyChange=e=>{e.setTouchTypistHotkey({hotkey:this._tmpHotkey.get()}),this._isActiveHotkeyChange.set(!1)},this.onDismissHotkeyChange=()=>{this._tmpHotkey.set(this._lastSubmittedShortcutValue),this._isActiveHotkeyChange.set(!1)},this.onIsActiveHotkeyChange=()=>{this._isActiveHotkeyChange.set(!0)},this._tmpHotkey=r.h.create(this._lastSubmittedShortcutValue)}listenToHotkeyChange(e){return a.a([this._isActiveHotkeyChange,this._isInputFocused]).pipe(s.U((([e,t])=>e&&t)),n.w((t=>t?(0,l.A8)(self,e):o.E)),c.b((({shortcut:e})=>{this._tmpHotkey.set(e)}))).subscribe()}get isActiveHotkeyChange(){return this._isActiveHotkeyChange}get tmpHotkey(){return this._tmpHotkey}}},46549:(e,t,i)=>{i.d(t,{A8:()=>v,_w:()=>b});var r=i(44071),a=i(13712),s=i(29416),n=i(63532),o=i(97092),c=i(59179),l=i(90572),u=i(64271);function d(e){const t=new Set;return e.filter((e=>{const i=e.code.toLowerCase();return!t.has(i)&&(t.add(i),!0)}))}function p(e,t){return"ControlLeft"===e.code||"ControlRight"===e.code?t?"⌃":"Ctrl":"ShiftLeft"===e.code||"ShiftRight"===e.code?"⇧":"AltLeft"===e.code||"AltRight"===e.code?t?"⌥":"Alt":"MetaLeft"===e.code||"MetaRight"===e.code?t?"⌘":"Win":"ArrowUp"===e.code?"↑":"ArrowDown"===e.code?"↓":"ArrowLeft"===e.code?"←":"ArrowRight"===e.code?"→":"Home"===e.code?"Home":"End"===e.code?"End":"PageUp"===e.code?"PageUp":"PageDown"===e.code?"PageDown":"Backspace"===e.code?"Backspace":"Delete"===e.code?"Delete":"Enter"===e.code?"Enter":"Tab"===e.code?"Tab":"Space"===e.code?"Space":e.code.startsWith("F")&&!isNaN(parseInt(e.code.substring(1),10))?e.code:"Escape"===e.code?"ESC":"CapsLock"===e.code?"CapsLock":"NumLock"===e.code?"NumLock":"ScrollLock"===e.code?"ScrollLock":"PrintScreen"===e.code?"PrintScreen":"Pause"===e.code?"Pause":"MediaPlayPause"===e.code?"MediaPlayPause":"VolumeUp"===e.code?"VolumeUp":"VolumeDown"===e.code?"VolumeDown":"AudioVolumeMute"===e.code?"Mute":e.code.startsWith("Digit")?e.code.slice(5):e.code.startsWith("Numpad")?e.code.slice(6):"Equal"===e.code?e.shiftKey?"plus":"=":"Minus"===e.code?"-":"NumpadAdd"===e.code?"plus":"NumpadSubtract"===e.code?"-":"NumpadEqual"===e.code?"=":null}function h(e){return function(t){return{shortcut:t.map((t=>{const i=p(t,e);return i||(t.code.toLowerCase().startsWith("key")?t.code.slice(3):t.code)})).join("")}}}function m(e,t,i){return e.map((e=>{const r=function(e,t,i){return["Tab","Enter","Backspace","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].some((r=>e===r&&t===p({code:e},i)))}(e.code,t.get(),i);return r&&(e.preventDefault(),e.stopImmediatePropagation()),e}))}function g(e){e.preventDefault(),e.stopImmediatePropagation()}function y(e){return e.sort(((e,t)=>t.code.length-e.code.length))}function v(e,t){const i=r.R(e,"keydown",{capture:!0}).pipe(a.g("code")),u=r.R(e,"keyup",{capture:!0}).pipe(s.b(50));return i.pipe(n.b(g),o.f(u),c.U(d),l.h((e=>e.length>0)),c.U(y),c.U(h(t)))}function b(e,t,i){const a=r.R(e,"keydown",{capture:!0}),s=r.R(e,"keyup",{capture:!0}),o=new Map;return u.T(a.pipe(n.b((e=>{o.set(e.code,e)}))),s.pipe(n.b((e=>{o.delete(e.code)})))).pipe(c.U((()=>[...o.values()])),n.b((e=>m(e,i,t))),c.U(y),c.U((e=>{const{shortcut:i}=h(t)(e);return{shortcut:i,events:e}})))}},74057:(e,t,i)=>{function r(e){return Boolean(e&&"function"==typeof(null==e?void 0:e[Symbol.iterator]))}function*a(e,t){for(const i of e)t(i)&&(yield i)}function*s(e,t){let i=0;for(const r of e)for(const e of t(r,i++))yield e}function n(e,t,i){let r=0;for(const i of e)if(t(i,r++))return i;return i}function o(e){for(const t of e)return t}function c(e,t){const i=e[Symbol.iterator]();let r=0;const a=t[Symbol.iterator]();let s=0,n=i.next(void 0),o=a.next(void 0);return[function*(){for(;!n.done||!o.done;)yield[n.done?null:n.value,o.done?null:o.value,r,s]}(),function(){n=i.next(void 0),r++},function(){o=a.next(void 0),s++}]}function*l(e){let t=e.length;for(;t--;)yield e[t]}i.d(t,{Em:()=>l,TW:()=>r,VS:()=>s,Xh:()=>o,fV:()=>c,hX:()=>a,sE:()=>n})},20515:e=>{e.exports={a11yOnboardingModal:"hoCGo"}},89701:e=>{e.exports={a11yReviewCard:"rVA2k",a11yReviewCardTitle:"LpiLI",a11yReviewCardFooter:"gLTZ0",a11yReviewCardBody:"Bdl_n",a11yInsertWord:"aP5qG",a11yDeleteWord:"liawa",a11yRetainWord:"KiSBI"}},30193:e=>{e.exports={a11yOnboardingModal:"xz4Fz"}},32184:e=>{e.exports={hotkeyHintWrapper:"iZ6ee",hotkeyHintTagWrapper:"IyPpR",expandedHotkeyHint:"X6JaN",leftAligned:"UuEaR",grammarlyLogo:"Z5RhC",expandedHotkeyHintText:"kckmf",hotkeyHintTagPlaceholder:"SMZN2",quickSettingsButton:"TkNlC",keyIcon:"VZ8FW",quickSettingsMenuWrapper:"zt9FP",quickSettingsMenuButton:"DSGTg",quickSettingsMenu:"B1fVo",quickSettingsMenuChangeQuickFixKeySection:"i0o98",quickSettingsMenuRow:"uqW10",quickSettingsMenuActionButton:"DsLIc"}},55979:e=>{e.exports={hotkeyHintTagContainer:"N3QjQ",hotkeyHintTagLabel:"t_VtO"}},9324:e=>{e.exports={dotsContainer:"mNIVY",dot:"KcZm9","dot-blink":"LxClj"}},61378:e=>{e.exports={prominentHotkeyWrapperRed:"M2gXg",prominentHotkeyWrapperGreen:"ztrXA",fadeIn:"woBOX",logoWrapper:"KLsi1",prominentHotkeyLeft:"ZsSap",prominentHotkeyRight:"uMznZ",expandedContent:"Uu48u",contentWrapper:"qW9CK",logoIcon:"FWOhe",minimizedContent:"pUU_s",hintText:"vXkkH",hintTextWrapper:"Im_QT",hintTagWrapper:"LtzvA",hintTagExpanded:"SalDJ",hintTagMinimized:"YUP33",quickSettings:"qrNJw",quickSettingsButton:"qc1j4"}},82403:e=>{e.exports={bubbleContainer:"C29Ys",bubble:"Z2bAs","bubble-scale":"L_Apf",checkmark:"cRf3w","draw-checkmark":"xcjpV"}},81583:(e,t,i)=>{i.d(t,{x:()=>n});var r=i(49231),a=i(38367),s=i(80309);const n=r.forwardRef((function(e,t){const{utility:i,other:a}=(0,s.a)(e),{accessibilityLabel:n,as:c,children:l,className:u,elevation:d,style:p={},...h}=a,m={...(0,s.f)(i),...p},g=null!=c?c:"div";return r.createElement(g,{ref:t,"aria-label":n,className:o({elevation:d,className:u}),style:m,...h},l)}));function o({elevation:e,className:t}){return(0,a.W)("gds-box",e&&`gds-box-elevation-${e}`,t)}},58952:(e,t,i)=>{i.d(t,{f:()=>d});var r=i(49231),a=i(38367),s=i(23560),n=i(95227),o=i(23934),c=i(71564);const l=(e,t)=>{let i;return i="VerificationCode"===t?{small:"medium",medium:"large",large:"large"}:{medium:"small",large:"medium",xlarge:"large"},i[e||"medium"]},u=(e,t)=>{let i;return i="VerificationCode"===t?{small:"text-small",medium:"text-medium",large:"text-medium"}:{medium:"text-xsmall",large:"text-small",xlarge:"text-medium"},i[e||"medium"]},d=({errorMessage:e,className:t,component:i,size:d="medium",color:p,...h})=>null==e||0==e.trim().length?null:r.createElement(s.k,{gap:1,align:"center",className:(0,a.W)("gds-input-error",t),...h},r.createElement(s.k,{flex:"0 1 auto"},r.createElement(o.J,{icon:n.E,accessibilityLabel:"Error",variant:"critical",size:l(d,i)})),r.createElement(c.x,{variant:u(d,i),className:"gds-input-error-message",color:"critical-default",as:"p"},e))},5219:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(49231),a=i(38367),s=i(23560),n=i(2680),o=i(71564);const c=({as:e="label",label:t,labelDisplay:i="visible",helperMessage:c,isRequired:p=!1,isOptional:h=!1,labelIndicatorForRequired:m="(Required)",labelIndicatorForOptional:g="(Optional)",errorMessage:y,children:v,size:b,..._})=>{if("hidden"===i){const i=0===r.Children.count(v)?{position:"absolute"}:void 0;return r.createElement(s.k,{as:e,style:i,..._},v,r.createElement(n.u,null,t,r.createElement(u,{errorMessage:y}),r.createElement(l,{message:c})))}const f="legend"===e?"semibold":"medium",S={small:"text-xsmall",medium:"text-small",large:"text-medium",xlarge:"text-large"};return r.createElement(s.k,{as:e,direction:"column",gap:1,color:"base-default",..._},r.createElement(s.k,{gap:2,align:"center",direction:"row"},v,r.createElement(o.x,{as:"span",variant:S[b||"medium"],weight:f,className:(0,a.W)("gds-input-label")},t),(!0===p||!0===h)&&r.createElement("div",{className:"gds-input-label-optionality",onClick:d},r.createElement("span",{"aria-hidden":!0===p?"true":void 0},r.createElement(n.u,null,": "),r.createElement(o.x,{as:"span",color:"base-subdued",variant:S[b||"medium"]},!0===p?m:g))),r.createElement(u,{errorMessage:y})),r.createElement(l,{message:c,size:b}))},l=e=>{const{message:t,size:i,...a}=e;if(null==t)return null;return r.createElement("div",{className:"gds-input-label-helper",onClick:d},r.createElement(n.u,null,":"),r.createElement(o.x,{as:"p",variant:{medium:"text-xsmall",large:"text-small",xlarge:"text-medium"}[i||"medium"],color:"base-subdued",...a},t))},u=e=>{const{errorMessage:t}=e;return null!=t?r.createElement(n.u,null," - error: ",t):null};function d(e){e.preventDefault()}},40612:(e,t,i)=>{i.d(t,{n:()=>h});var r=i(49231),a=i(38367),s=i(31169),n=i(69455),o=i(91809),c=i(53853),l=i(90399),u=i(5219),d=i(23934),p=i(58952);const h=r.forwardRef((function(e,t){var i;const{accessibilityLabelHidePassword:h="Hide password",accessibilityLabelShowPassword:m="Show password",accessibilityLivePasswordIsShowing:g="Your password is now showing",accessibilityLivePasswordIsHidden:y="Your password is now hidden",className:v,label:b,helperMessage:_,errorMessage:f,isRequired:S,isOptional:E,iconStart:T,placeholder:k,labelDisplay:x="visible",labelIndicatorForOptional:w,labelIndicatorForRequired:C,type:R="text",min:A,max:I,step:P,pattern:O,spellCheck:M,size:N="medium",style:D}=e,[L,F]=r.useState(R),B=r.useRef(null);r.useImperativeHandle(t,(()=>B.current));const{labelProps:H,inputProps:Q}=(0,n.h)({...e,validationState:null!=f?"invalid":"valid",type:L},B);(0,s.j)(Q,e);const G={min:A,max:I,step:P,pattern:O,spellCheck:M,style:D};"number"===R&&(G.inputMode=null!=(i=G.inputMode)?i:"numeric"),r.useEffect((()=>{F("number"===R?"text":R)}),[R]);const U="password"===L,W=U?y:g;return r.createElement("div",{className:(0,a.W)("gds-text-field",`gds-text-field-${N}`)},r.createElement(u.A,{label:b,labelDisplay:x,helperMessage:_,isRequired:S,isOptional:E,labelIndicatorForRequired:C,labelIndicatorForOptional:w,errorMessage:f,size:N,...H}),"password"===R&&r.createElement(o.T,{"aria-live":"polite"},W),r.createElement("div",{className:"gds-text-field-container "+("password"===R?"gds-text-field-container-password":"")},null!=T&&r.createElement("div",{className:"gds-text-field-icon-start"},r.createElement(d.J,{icon:T,accessibilityLabel:"",size:"medium"})),r.createElement("input",{className:(0,a.W)("gds-text-field-input",v),...Q,...G,placeholder:k,ref:B}),"password"===R&&r.createElement("button",{"aria-label":U?m:h,"aria-controls":null==Q?void 0:Q.id,onClick:()=>{F(U?"text":"password")},type:"button"},r.createElement(d.J,{icon:U?c.X:l.l,accessibilityLabel:"",size:"large"}))),r.createElement(p.f,{size:N,errorMessage:f}))}))},31169:(e,t,i)=>{function r(e,t){["aria-hidden","aria-controls"].forEach((i=>{const r=t[i];null!=r&&null==e[i]&&(e[i]=r)}))}i.d(t,{j:()=>r})},90399:(e,t,i)=>{i.d(t,{l:()=>a});var r=i(49231);const a=(0,i(61975).I)("color",(({title:e,titleId:t,desc:i,descId:a,...s})=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceHide",stroke:"transparent","aria-labelledby":t,"aria-describedby":a,...s},i?r.createElement("desc",{id:a},i):null,e?r.createElement("title",{id:t},e):null,r.createElement("path",{fill:"#646B81",fillRule:"evenodd",d:"M1.646 1.646a.5.5 0 0 1 .708 0l12.02 12.021a.5.5 0 0 1-.707.707L1.647 2.354a.5.5 0 0 1 0-.708M3.41 5.532A6.8 6.8 0 0 0 1.557 7.77a.5.5 0 0 0 0 .46c1.588 3.07 5.073 4.265 8.138 3.585l-.866-.865c-2.398.292-4.96-.691-6.259-2.95a5.8 5.8 0 0 1 1.557-1.753zm8.464 4.221A5.8 5.8 0 0 0 13.43 8c-1.298-2.259-3.86-3.242-6.258-2.95l-.866-.865c3.065-.68 6.55.515 8.138 3.585a.5.5 0 0 1 0 .46 6.8 6.8 0 0 1-1.855 2.238z",clipRule:"evenodd"}))))},33483:(e,t,i)=>{i.d(t,{a:()=>a});var r=i(49231);const a=(0,i(61975).I)("color",(({title:e,titleId:t,desc:i,descId:a,...s})=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceSettings",stroke:"transparent","aria-labelledby":t,"aria-describedby":a,...s},i?r.createElement("desc",{id:a},i):null,e?r.createElement("title",{id:t},e):null,r.createElement("path",{stroke:"#646B81",strokeLinejoin:"round",d:"m11.714 3.143-.028.029C10.642 4.215 8.857 3.476 8.857 2H7.143c0 1.476-1.785 2.215-2.829 1.172l-.028-.03-1.143 1.144.029.028C4.215 5.358 3.476 7.143 2 7.143v1.714c1.476 0 2.215 1.785 1.172 2.829l-.03.028 1.144 1.143.028-.029c1.044-1.043 2.829-.304 2.829 1.172h1.714c0-1.476 1.785-2.215 2.829-1.172l.028.03 1.143-1.144-.029-.028c-1.043-1.044-.304-2.829 1.172-2.829V7.143c-1.476 0-2.215-1.785-1.172-2.829l.03-.028z"}),r.createElement("path",{stroke:"#646B81",strokeLinejoin:"round",d:"M10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"}))))},53853:(e,t,i)=>{i.d(t,{X:()=>a});var r=i(49231);const a=(0,i(61975).I)("color",(({title:e,titleId:t,desc:i,descId:a,...s})=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceShow",stroke:"transparent","aria-labelledby":t,"aria-describedby":a,...s},i?r.createElement("desc",{id:a},i):null,e?r.createElement("title",{id:t},e):null,r.createElement("path",{fill:"#646B81",d:"M9 8c0 .5-.5 1-1 1s-1-.5-1-1 .5-1 1-1 1 .5 1 1"}),r.createElement("path",{stroke:"#646B81",d:"M13.43 8c-2.299 4-8.561 4-10.86 0 2.299-4 8.561-4 10.86 0ZM8.5 8a.5.5 0 0 1-.166.334A.5.5 0 0 1 8 8.5a.5.5 0 0 1-.334-.166A.5.5 0 0 1 7.5 8a.5.5 0 0 1 .166-.334A.5.5 0 0 1 8 7.5a.5.5 0 0 1 .334.166A.5.5 0 0 1 8.5 8ZM8 9.5c.413 0 .783-.201 1.041-.459s.459-.628.459-1.04-.201-.784-.459-1.042S8.413 6.5 8 6.5s-.783.201-1.041.459S6.5 7.587 6.5 8s.201.783.459 1.041S7.587 9.5 8 9.5Z"}))))},28893:(e,t,i)=>{i.d(t,{p:()=>a});var r=i(49231);const a=(0,i(61975).I)("nocolor",(({title:e,titleId:t,desc:i,descId:a,...s})=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:32,height:32,fill:"none",viewBox:"0 0 32 32","aria-hidden":"true","data-icon":"LogoLogomarkMonochromeDefault",stroke:"transparent","aria-labelledby":t,"aria-describedby":a,...s},i?r.createElement("desc",{id:a},i):null,e?r.createElement("title",{id:t},e):null,r.createElement("path",{fill:"var(--color-background-base-inverse)",d:"M0 16C0 7.163 7.162 0 16.001 0s16 7.163 16 16c0 7.732-5.482 14.183-12.773 15.676-1.042.213-2.121.324-3.222.324H0z"}),r.createElement("path",{fill:"var(--color-background-base-default)",d:"m19.876 14.484-1.788 2.94h6.02c-.93 5.116-6.62 8.599-12.304 5.653a6.7 6.7 0 0 1-2.861-2.834c-3.27-6.226 1.197-12.49 7.093-12.49a8.19 8.19 0 0 1 6.2 2.839l1.58-2.6a11.08 11.08 0 0 0-8.566-3.148c-5.562.384-10.071 4.994-10.342 10.56-.309 6.393 4.8 11.688 11.124 11.688s11.14-4.999 11.14-11.14c0-.5-.038-.989-.1-1.468z"}))))},46311:(e,t,i)=>{i.d(t,{U:()=>a});var r=i(84580);function a(e){let{description:t,errorMessage:i,validationState:a}=e,{labelProps:s,fieldProps:n}=function(e){let{id:t,label:i,"aria-labelledby":a,"aria-label":s,labelElementType:n="label"}=e;t=(0,r.Me)(t);let o=(0,r.Me)(),c={};return i?(a=a?`${o} ${a}`:o,c={id:o,htmlFor:"label"===n?t:void 0}):a||s||console.warn("If you do not provide a visible label, you must specify an aria-label or aria-labelledby attribute for accessibility"),{labelProps:c,fieldProps:(0,r.bE)({id:t,"aria-label":s,"aria-labelledby":a})}}(e),o=(0,r.mp)([Boolean(t),Boolean(i),a]),c=(0,r.mp)([Boolean(t),Boolean(i),a]);return n=(0,r.dG)(n,{"aria-describedby":[o,c,e["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:s,fieldProps:n,descriptionProps:{id:o},errorMessageProps:{id:c}}}},69455:(e,t,i)=>{i.d(t,{h:()=>n});var r=i(84580),a=i(46311),s=i(42703);i(49231);function n(e,t){let{inputElementType:i="input",isDisabled:n=!1,isRequired:o=!1,isReadOnly:c=!1,validationState:l,type:u="text",value:d,defaultValue:p,onChange:h=(()=>{})}=e,{focusableProps:m}=(0,s.kc)(e,t),{labelProps:g,fieldProps:y,descriptionProps:v,errorMessageProps:b}=(0,a.U)(e),_=(0,r.zL)(e,{labelable:!0});const f={type:u,pattern:e.pattern};var S;return(0,r.y$)(t,null!==(S=null!=d?d:p)&&void 0!==S?S:"",h),{labelProps:g,inputProps:(0,r.dG)(_,"input"===i&&f,Object.assign(Object.assign({disabled:n,readOnly:c,"aria-required":o||void 0,"aria-invalid":"invalid"===l||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],value:e.value,defaultValue:e.value?void 0:e.defaultValue,onChange:e=>h(e.target.value),autoComplete:e.autoComplete,maxLength:e.maxLength,minLength:e.minLength,name:e.name,placeholder:e.placeholder,inputMode:e.inputMode,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput},m),y)),descriptionProps:v,errorMessageProps:b}}},91809:(e,t,i)=>{i.d(t,{T:()=>c});var r=i(84580),a=i(49231),s=i(12734),n=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i};const o={border:0,clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"};function c(e){let{children:t,elementType:i="div",isFocusable:c,style:l}=e,u=n(e,["children","elementType","isFocusable","style"]),{visuallyHiddenProps:d}=function(e={}){let{style:t,isFocusable:i}=e,[r,n]=(0,a.useState)(!1),{focusWithinProps:c}=(0,s.L_)({isDisabled:!i,onFocusWithinChange:e=>n(e)}),l=(0,a.useMemo)((()=>r?t:t?Object.assign(Object.assign({},o),t):o),[r]);return{visuallyHiddenProps:Object.assign(Object.assign({},c),{style:l})}}(e);return a.createElement(i,(0,r.dG)(u,d),t)}}}]);