import{B as w,p as r,s as F,k as u,z as c,x as A,r as h,a1 as R,R as C,L as z,i as I,q as P,a5 as x,w as W,a as y}from"./start-BFd-djfI.js";import{A as M,T as G,a as N,b as $,c as B,d as L,e as O}from"./TextDocumentEntities-iE9yXSvn.js";import{DocumentSessionManagerToken as V,DocumentSessionToken as q,TextDocumentInfoToken as H}from"./index-DGeXO3oi.js";import{a as U,t as J}from"./subscribableState-Y8YW7N9Z-L1DO2Tta.js";import{d as K}from"./distinctUntilChanged-GMQNSCXg.js";import{D as Q}from"./Delta-D-dso3t3-DM06-Vr-.js";import{s as f,a as X,b as Y}from"./skip-wo5YLe13.js";import{s as Z}from"./share-CW4-5mF1.js";import{m as j}from"./merge-obdQTFL6.js";import{t as ee}from"./take-gJdc_Sb0.js";import{b as te,d as l}from"./RemoteSubscribable-CanKOUL4-CikZPXPx.js";import"./RemoteEntity-CN-1WB86-yD3y8ldD.js";import"./PluginModule-CRib3PLZ-B43Hjk20.js";import"./dateTimestampProvider-CV0dHcg-.js";import"./mergeAll-D275NTmK.js";var se=Object.defineProperty,E=t=>{throw TypeError(t)},ae=(t,e,s)=>e in t?se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,re=(t,e,s)=>ae(t,e+"",s),ie=(t,e,s)=>e.has(t)||E("Cannot "+s),d=(t,e,s)=>(ie(t,e,"read from private field"),s?s.call(t):e.get(t)),k=(t,e,s)=>e.has(t)?E("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),S,v;class b{constructor(){k(this,S,new DisposableStack),k(this,v,new w(null)),re(this,"activeDocumentId",U(d(this,v)))}setActiveDocumentIdSource(e){d(this,S).use(r(J(e),K(),F(d(this,v))))}[Symbol.dispose](){d(this,S).dispose()}}S=new WeakMap;v=new WeakMap;var oe=Object.defineProperty,ne=(t,e,s)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,o=(t,e,s)=>ne(t,typeof e!="symbol"?e+"":e,s);class ue{constructor({documentId:e,hasFocus:s,lastFocusAt:m,geometry:n,textChange:g,geometryWillChange:D,selection:_}){o(this,"id"),o(this,"hasFocus"),o(this,"lastFocusAt"),o(this,"geometryWillChange"),o(this,"geometry"),o(this,"textChange"),o(this,"text"),o(this,"selection"),this.id=e,this.hasFocus=r(c(s),f({bufferSize:1,refCount:!0}),u),this.lastFocusAt=r(c(m),f({bufferSize:1,refCount:!0}),u),this.geometryWillChange=r(c(D),Z(),u),this.geometry=r(c(n),f({bufferSize:1,refCount:!0}),u),this.selection=r(c(_),f({bufferSize:1,refCount:!0}),u);const p=r(c(g),h(a=>({revision:a.revision,change:new Q(a.change)})),X((a,{change:i,revision:T})=>a?{revision:T,change:i,content:a.content.compose(i)}:{revision:T,change:i,content:i},null),A(R),f({bufferSize:1,refCount:!0}));this.text=r(p,h(({revision:a,content:i})=>({revision:a,content:i})),u),this.textChange=r(j(r(p,ee(1),h(({revision:a,content:i})=>({revision:a,change:i}))),r(p,Y(1),h(({revision:a,change:i})=>({revision:a,change:i})))),u)}}const Ce=t=>{const e=t.getExecutionScopeDefinition("document-group");return C.all([me(t),e.register({token:b,useClass:b},{lifetime:z.Singleton}),e.register({token:V,useToken:b}),I(e.onStart(s=>r(x([W(s.resolve(b)),te(s.realm,M,null)]),P(([m,n])=>m.setActiveDocumentIdSource(n)))))])};function me(t){return t.registerExecutionScopeReviver("document-session",(e,s,{documentId:m})=>r(x([l(e.realm,G),l(e.realm,N),l(e.realm,$),l(e.realm,B),l(e.realm,L),l(e.realm,O)]),y(async([n,g,D,_,p,a])=>C.all([e.register({token:q,useValue:{documentId:m,startedAt:performance.now()}}),e.register({token:H,useValue:new ue({documentId:m,hasFocus:n,lastFocusAt:g,geometry:D,textChange:_,selection:p,geometryWillChange:a})})])),y(n=>(e.use(n),e.start()))))}export{Ce as activate};
//# sourceMappingURL=index-B1wx0KOp.js.map
