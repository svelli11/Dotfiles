!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="69185d4e-bba3-4bd6-86eb-3223d31c5f29",e._sentryDebugIdIdentifier="sentry-dbid-69185d4e-bba3-4bd6-86eb-3223d31c5f29")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"5.4.5"},(globalThis.webpackChunkfloccus=globalThis.webpackChunkfloccus||[]).push([[373],{50754:(e,t,o)=>{o.r(t),o.d(t,{OAuth2ClientPluginWeb:()=>a});var n=o(16546);class s{static getAppId(e){return this.getOverwritableValue(e,"appId")}static getOverwritableValue(e,t){let o=e[t];return e.web&&t in e.web&&(o=e.web[t]),o}static getAuthorizationUrl(e){let t=e.authorizationBaseUrl+"?client_id="+e.appId;if(t+="&response_type="+e.responseType,e.redirectUrl&&(t+="&redirect_uri="+e.redirectUrl),e.scope&&(t+="&scope="+e.scope),t+="&state="+e.state,e.additionalParameters)for(const o in e.additionalParameters)t+="&"+o+"="+e.additionalParameters[o];return e.pkceCodeChallenge&&(t+="&code_challenge="+e.pkceCodeChallenge,t+="&code_challenge_method="+e.pkceCodeChallengeMethod),encodeURI(t)}static getTokenEndpointData(e,t){let o="";return o+=encodeURIComponent("grant_type")+"="+encodeURIComponent("authorization_code")+"&",o+=encodeURIComponent("client_id")+"="+encodeURIComponent(e.appId)+"&",o+=encodeURIComponent("redirect_uri")+"="+encodeURIComponent(e.redirectUrl)+"&",o+=encodeURIComponent("code")+"="+encodeURIComponent(t)+"&",o+=encodeURIComponent("code_verifier")+"="+encodeURIComponent(e.pkceCodeVerifier),o}static getUrlParams(e){const t=`${null!=e?e:""}`.trim();if(0===t.length)return;const o=new URL(t);if(!o.search&&!o.hash)return;let n;return n=o.search?o.search.substr(1):o.hash.substr(1),n.split("&").reduce(((e,t)=>{const[o,n]=t.split("=");if(o&&o.length>0)return Object.assign(Object.assign({},e),{[o]:decodeURIComponent(n)})}),{})}static randomString(e=10){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";let o;if(window.crypto){let n=new Uint32Array(e);window.crypto.getRandomValues(n),n=n.map((e=>t.charCodeAt(e%64)));let s=[];n.forEach((e=>{s.push(t.charAt(e%64))})),o=s.join("")}else{o="";for(let n=0;n<e;n++)o+=t.charAt(Math.floor(64*Math.random()))}return o}static async buildWebOptions(e){const t=new r;t.appId=this.getAppId(e),t.authorizationBaseUrl=this.getOverwritableValue(e,"authorizationBaseUrl"),t.responseType=this.getOverwritableValue(e,"responseType"),t.responseType||(t.responseType="token"),t.redirectUrl=this.getOverwritableValue(e,"redirectUrl"),t.resourceUrl=this.getOverwritableValue(e,"resourceUrl"),t.accessTokenEndpoint=this.getOverwritableValue(e,"accessTokenEndpoint"),t.pkceEnabled=this.getOverwritableValue(e,"pkceEnabled"),t.pkceEnabled&&(t.pkceCodeVerifier=this.randomString(64),i.HAS_SUBTLE_CRYPTO?await i.deriveChallenge(t.pkceCodeVerifier).then((e=>{t.pkceCodeChallenge=e,t.pkceCodeChallengeMethod="S256"})):(t.pkceCodeChallenge=t.pkceCodeVerifier,t.pkceCodeChallengeMethod="plain")),t.scope=this.getOverwritableValue(e,"scope"),t.state=this.getOverwritableValue(e,"state"),t.state&&0!==t.state.length||(t.state=this.randomString(20));let o=this.getOverwritableValue(e,"additionalParameters");if(o){t.additionalParameters={};for(const e in o)if(e&&e.trim().length>0){let n=o[e];n&&n.trim().length>0&&(t.additionalParameters[e]=n)}}let n=this.getOverwritableValue(e,"additionalResourceHeaders");if(n){t.additionalResourceHeaders={};for(const e in n)if(e&&e.trim().length>0){let o=n[e];o&&o.trim().length>0&&(t.additionalResourceHeaders[e]=o)}}return t.logsEnabled=this.getOverwritableValue(e,"logsEnabled"),t}static buildWindowOptions(e){const t=new r;return e.web&&(e.web.windowOptions&&(t.windowOptions=e.web.windowOptions),e.web.windowTarget&&(t.windowTarget=e.web.windowTarget)),t}}class i{static toUint8Array(e){const t=new ArrayBuffer(e.length),o=new Uint8Array(t);for(let t=0;t<e.length;t++)o[t]=e.charCodeAt(t);return o}static toBase64Url(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static toBase64(e){let t=e.length,o="";for(let n=0;n<t;n+=3)o+=this.BASE64_CHARS[e[n]>>2],o+=this.BASE64_CHARS[(3&e[n])<<4|e[n+1]>>4],o+=this.BASE64_CHARS[(15&e[n+1])<<2|e[n+2]>>6],o+=this.BASE64_CHARS[63&e[n+2]];return t%3==2?o=o.substring(0,o.length-1)+"=":t%3==1&&(o=o.substring(0,o.length-2)+"=="),o}static deriveChallenge(e){return e.length<43||e.length>128?Promise.reject(new Error("ERR_PKCE_CODE_VERIFIER_INVALID_LENGTH")):i.HAS_SUBTLE_CRYPTO?new Promise(((t,o)=>{crypto.subtle.digest("SHA-256",this.toUint8Array(e)).then((e=>t(this.toBase64Url(this.toBase64(new Uint8Array(e))))),(e=>o(e)))})):Promise.reject(new Error("ERR_PKCE_CRYPTO_NOTSUPPORTED"))}}i.BASE64_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i.HAS_SUBTLE_CRYPTO="undefined"!=typeof window&&!!window.crypto&&!!window.crypto.subtle;class r{constructor(){this.windowTarget="_blank"}}class a extends n.WebPlugin{constructor(){super(...arguments),this.loopCount=2e3,this.intervalLength=100,this.MSG_RETURNED_TO_JS="Returned to JS:"}async refreshToken(e){return new Promise(((e,t)=>{t(new Error("Functionality not implemented for PWAs yet"))}))}async authenticate(e){const t=s.buildWindowOptions(e);return this.windowHandle=window.open("",t.windowTarget,t.windowOptions),this.webOptions=await s.buildWebOptions(e),new Promise(((e,t)=>{if(this.webOptions.appId&&0!=this.webOptions.appId.length)if(this.webOptions.authorizationBaseUrl&&0!=this.webOptions.authorizationBaseUrl.length)if(this.webOptions.redirectUrl&&0!=this.webOptions.redirectUrl.length)if(this.webOptions.responseType&&0!=this.webOptions.responseType.length){let o=this.loopCount;this.windowClosedByPlugin=!1;const n=s.getAuthorizationUrl(this.webOptions);this.webOptions.logsEnabled&&this.doLog("Authorization url: "+n),this.windowHandle&&(this.windowHandle.location.href=n),this.intervalId=window.setInterval((()=>{var n,i;if(o--<0)this.closeWindow();else if((null===(n=this.windowHandle)||void 0===n?void 0:n.closed)&&!this.windowClosedByPlugin)window.clearInterval(this.intervalId),t(new Error("USER_CANCELLED"));else{let o;try{o=null===(i=this.windowHandle)||void 0===i?void 0:i.location.href}catch(e){}if(null!=o&&o.indexOf(this.webOptions.redirectUrl)>=0){this.webOptions.logsEnabled&&this.doLog("Url from Provider: "+o);let n=s.getUrlParams(o);if(n)if(this.webOptions.logsEnabled&&this.doLog("Authorization response:",n),window.clearInterval(this.intervalId),n.state===this.webOptions.state)if(this.webOptions.accessTokenEndpoint){const o=this;let i=n.code;if(i){const r=new XMLHttpRequest;r.onload=function(){if(200===this.status){let s=JSON.parse(this.response);o.webOptions.logsEnabled&&o.doLog("Access token response:",s),o.requestResource(s.access_token,e,t,n,s)}},r.onerror=function(){o.doLog("ERR_GENERAL: See client logs. It might be CORS. Status text: "+this.statusText),t(new Error("ERR_GENERAL"))},r.open("POST",this.webOptions.accessTokenEndpoint,!0),r.setRequestHeader("accept","application/json"),r.setRequestHeader("cache-control","no-cache"),r.setRequestHeader("content-type","application/x-www-form-urlencoded"),r.send(s.getTokenEndpointData(this.webOptions,i))}else t(new Error("ERR_NO_AUTHORIZATION_CODE"));this.closeWindow()}else this.requestResource(n.access_token,e,t,n);else this.webOptions.logsEnabled&&(this.doLog("State from web options: "+this.webOptions.state),this.doLog("State returned from provider: "+n.state)),t(new Error("ERR_STATES_NOT_MATCH")),this.closeWindow()}}}),this.intervalLength)}else t(new Error("ERR_PARAM_NO_RESPONSE_TYPE"));else t(new Error("ERR_PARAM_NO_REDIRECT_URL"));else t(new Error("ERR_PARAM_NO_AUTHORIZATION_BASE_URL"));else t(new Error("ERR_PARAM_NO_APP_ID"))}))}requestResource(e,t,o,n,s=null){if(this.webOptions.resourceUrl){const i=this.webOptions.logsEnabled;if(i&&this.doLog("Resource url: "+this.webOptions.resourceUrl),e){i&&this.doLog("Access token:",e);const r=this,a=new XMLHttpRequest;if(a.onload=function(){if(200===this.status){let o=JSON.parse(this.response);i&&r.doLog("Resource response:",o),o&&r.assignResponses(o,e,n,s),i&&r.doLog(r.MSG_RETURNED_TO_JS,o),t(o)}else o(new Error(this.statusText));r.closeWindow()},a.onerror=function(){i&&r.doLog("ERR_GENERAL: "+this.statusText),o(new Error("ERR_GENERAL")),r.closeWindow()},a.open("GET",this.webOptions.resourceUrl,!0),a.setRequestHeader("Authorization",`Bearer ${e}`),this.webOptions.additionalResourceHeaders)for(const e in this.webOptions.additionalResourceHeaders)a.setRequestHeader(e,this.webOptions.additionalResourceHeaders[e]);a.send()}else i&&this.doLog("No accessToken was provided although you configured a resourceUrl. Remove the resourceUrl from the config."),o(new Error("ERR_NO_ACCESS_TOKEN")),this.closeWindow()}else{const o={};this.assignResponses(o,e,n,s),this.webOptions.logsEnabled&&this.doLog(this.MSG_RETURNED_TO_JS,o),t(o),this.closeWindow()}}assignResponses(e,t,o,n=null){o&&(e.authorization_response=o),n&&(e.access_token_response=n),e.access_token=t}async logout(e){return new Promise(((t,o)=>{localStorage.removeItem(s.getAppId(e)),t(!0)}))}closeWindow(){var e;window.clearInterval(this.intervalId),null===(e=this.windowHandle)||void 0===e||e.close(),this.windowClosedByPlugin=!0}doLog(e,t=null){console.log("I/Capacitor/OAuth2ClientPlugin: "+e,t)}}}}]);
//# sourceMappingURL=373.js.map