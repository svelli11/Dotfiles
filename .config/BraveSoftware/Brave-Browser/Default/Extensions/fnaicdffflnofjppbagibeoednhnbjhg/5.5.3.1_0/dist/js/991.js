!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="34cdf056-63f0-4e66-94ab-5419419a241b",e._sentryDebugIdIdentifier="sentry-dbid-34cdf056-63f0-4e66-94ab-5419419a241b")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"5.4.5"},(globalThis.webpackChunkfloccus=globalThis.webpackChunkfloccus||[]).push([[991],{2142:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.hydrate=t.Folder=t.Bookmark=t.ItemType=t.ItemLocation=void 0;var u=l(r(3363)),d=l(r(29242)),h=a(r(89185)),f=["data:","javascript:","about:","chrome:","file:"];t.ItemLocation={LOCAL:"Local",SERVER:"Server"},t.ItemType={FOLDER:"folder",BOOKMARK:"bookmark"};var p=function(){function e(e){var r=e.id,n=e.parentId,o=e.url,i=e.title,a=e.tags,s=e.location;if(this.type=t.ItemType.BOOKMARK,this.isRoot=!1,this.id=r,this.parentId=n,this.title=i,this.tags=a,this.location=s||t.ItemLocation.LOCAL,this.location!==t.ItemLocation.LOCAL&&this.location!==t.ItemLocation.SERVER)throw new Error("Location failed validation");try{if(f.some((function(e){return 0===o.indexOf(e)})))return void(this.url=o);var c=new URL(o);this.url=c.href}catch(e){d.default.log("Failed to normalize",o),this.url=o}}return e.prototype.canMergeWith=function(t){return t instanceof e&&this.url===t.url},e.prototype.childrenSimilarity=function(e){return 0},e.prototype.hash=function(){return s(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return this.hashValue?[3,2]:(e=this,[4,u.default.sha256(JSON.stringify({title:this.title,url:this.url}))]);case 1:e.hashValue=t.sent(),t.label=2;case 2:return[2,this.hashValue]}}))}))},e.prototype.clone=function(t){return new e(this)},e.prototype.cloneWithLocation=function(t,r){return new e(n(n({},this),{location:r}))},e.prototype.createIndex=function(){var e;return(e={})[this.id]=this,e},e.prototype.findItem=function(e,t){return"bookmark"===e&&String(t)===String(this.id)?this:null},e.prototype.findItemFilter=function(e,r,n){return void 0===n&&(n=function(){return 1}),e===t.ItemType.BOOKMARK&&r(this)?this:null},e.prototype.count=function(){return 1},e.prototype.inspect=function(e){return void 0===e&&(e=0),Array(e<0?0:e).fill("  ").join("")+"- #".concat(this.id,"[").concat(this.title,"](").concat(this.url,") parentId: ").concat(this.parentId)},e.prototype.visitCreate=function(e){return e.createBookmark(this)},e.prototype.visitUpdate=function(e){return e.updateBookmark(this)},e.prototype.visitRemove=function(e){return e.removeBookmark(this)},e.hydrate=function(t){return new e(t)},e}();t.Bookmark=p;var g=function(){function e(e){var r=e.id,o=e.parentId,i=e.title,a=e.children,s=e.hashValue,c=e.loaded,l=e.location,u=e.isRoot;if(this.type=t.ItemType.FOLDER,this.isRoot=!1,this.loaded=!0,this.id=r,this.parentId=o,this.title=i,this.children=a||[],this.hashValue=n({},s),this.loaded=!1!==c,this.isRoot=u,this.location=l||t.ItemLocation.LOCAL,this.location!==t.ItemLocation.LOCAL&&this.location!==t.ItemLocation.SERVER)throw new Error("Location failed validation")}return e.prototype.findItemFilter=function(e,t,r){return void 0===r&&(r=function(){return 1}),this.index||this.createIndex(),Object.values(this.index[e]).filter(t).sort((function(e,t){return r(e)-r(t)})).pop()},e.prototype.findFolder=function(t){return String(this.id)===String(t)?this:this.index?this.index.folder[t]:this.children.filter((function(t){return t instanceof e})).map((function(e){return e})).map((function(e){return e.findFolder(t)})).filter((function(e){return!!e}))[0]},e.prototype.findBookmark=function(t){return this.index?this.index.bookmark[t]:this.children.filter((function(e){return e instanceof p})).map((function(e){return e})).find((function(e){return String(e.id)===String(t)}))||this.children.filter((function(t){return t instanceof e})).map((function(e){return e})).map((function(e){return e.findBookmark(t)})).filter((function(e){return!!e}))[0]},e.prototype.findItem=function(e,r){return e===t.ItemType.FOLDER?this.findFolder(r):this.findBookmark(r)},e.prototype.traverse=function(e){return s(this,void 0,void 0,(function(){var t=this;return c(this,(function(r){switch(r.label){case 0:return[4,h.each(this.children,(function(r){return s(t,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,e(r,this)];case 1:return t.sent(),"folder"!==r.type?[3,4]:[4,Promise.resolve()];case 2:return t.sent(),[4,r.traverse(e)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))}),10)];case 1:return r.sent(),[2]}}))}))},e.prototype.canMergeWith=function(t){return t instanceof e&&this.title===t.title},e.prototype.childrenSimilarity=function(t){return t instanceof e?this.children.reduce((function(e,r){return t.children.find((function(e){return e.title===r.title}))?e+1:e}),0)/Math.max(this.children.length,t.children.length):0},e.prototype.hash=function(e){return void 0===e&&(e=!1),s(this,void 0,void 0,(function(){var t,r,n,o,i,a,s,l;return c(this,(function(c){switch(c.label){case 0:if(this.hashValue&&this.hashValue[String(e)])return[2,this.hashValue[String(e)]];if(!this.loaded)throw new Error("Trying to calculate hash of a folder that isn't loaded");return t=this.children.slice(),e||t.sort((function(e,t){return e.title<t.title?-1:t.title<e.title?1:0})),this.hashValue||(this.hashValue={}),r=this.hashValue,n=String(e),i=(o=u.default).sha256,s=(a=JSON).stringify,l={title:this.title},[4,h.map(this.children,(function(t){return t.hash(e)}),1)];case 1:return[4,i.apply(o,[s.apply(a,[(l.children=c.sent(),l)])])];case 2:return r[n]=c.sent(),[2,this.hashValue[String(e)]]}}))}))},e.prototype.clone=function(t){return new e(n(n(n({},this),!t&&{hashValue:{}}),{children:this.children.map((function(e){return e.clone(t)}))}))},e.prototype.cloneWithLocation=function(t,r){return new e(n(n(n(n({},this),{location:r}),!t&&{hashValue:{}}),{children:this.children.map((function(e){return e.cloneWithLocation(t,r)}))}))},e.prototype.count=function(){return this.index||this.createIndex(),Object.keys(this.index.bookmark).length},e.prototype.countFolders=function(){return this.index||this.createIndex(),Object.keys(this.index.folder).length},e.prototype.createIndex=function(){var t,r=this;return this.index={folder:(t={},t[this.id]=this,t),bookmark:this.children.filter((function(e){return e instanceof p})).reduce((function(e,t){return e[t.id]=t,e}),{})},this.children.filter((function(t){return t instanceof e})).map((function(e){return e.createIndex()})).forEach((function(e){Object.assign(r.index.folder,e.folder),Object.assign(r.index.bookmark,e.bookmark)})),this.index},e.prototype.inspect=function(e){return void 0===e&&(e=0),Array(e<0?0:e).fill("  ").join("")+"+ #".concat(this.id,"[").concat(this.title,"] parentId: ").concat(this.parentId,", hash: ").concat(this.hashValue[String(!0)]||this.hashValue[String(!1)],"\n")+this.children.map((function(t){return t&&t.inspect?t.inspect(e+1):String(t)})).join("\n")},e.prototype.visitCreate=function(e){return e.createFolder(this)},e.prototype.visitUpdate=function(e){return e.updateFolder(this)},e.prototype.visitRemove=function(e){return e.removeFolder(this)},e.hydrate=function(t){return new e(n(n({},t),{children:t.children?t.children.map((function(t){return"url"in t&&"string"==typeof t.url?p.hydrate(t):e.hydrate(t)})):null}))},e.getAncestorsOf=function(e,r){for(var n=[e],o=e;String(o.id)!==String(r.id);)if(n.push(o),!(o=r.findItem(t.ItemType.FOLDER,o.parentId)))throw new Error("Item is not a descendant of the tree passed");return n.reverse(),n},e}();t.Folder=g,t.hydrate=function(e){if(e.type===t.ItemType.FOLDER)return g.hydrate(e);if(e.type===t.ItemType.BOOKMARK)return p.hydrate(e);throw new Error("Cannot hydrate object ".concat(JSON.stringify(e)))}},3363:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(8127),a=function(){function e(){}return e.sha256=function(e){return n(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return t=(new TextEncoder).encode(e),[4,crypto.subtle.digest("SHA-256",t)];case 1:return r=n.sent(),[2,this.bufferToHexstr(new Uint8Array(r))]}}))}))},e.bufferToHexstr=function(e){return Array.from(new Uint8Array(e)).map((function(e){return("00"+e.toString(16)).slice(-2)})).join("")},e.hexstrToBuffer=function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t},e.prepareKey=function(t,r){return n(this,void 0,void 0,(function(){var n,i,a,s;return o(this,(function(o){switch(o.label){case 0:return n=new TextEncoder,i=n.encode(t),a=n.encode(r),[4,crypto.subtle.importKey("raw",i,"PBKDF2",!1,["deriveKey"])];case 1:return s=o.sent(),[2,crypto.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:a,iterations:e.iterations},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])]}}))}))},e.decryptAES=function(e,t,r){return n(this,void 0,void 0,(function(){var n,a,s,c,l;return o(this,(function(o){switch(o.label){case 0:return[4,this.prepareKey(e,r)];case 1:return n=o.sent(),a=(0,i.toUint8Array)(t),s=a.slice(0,this.ivLength),c=a.slice(this.ivLength),[4,crypto.subtle.decrypt({name:"AES-GCM",iv:s},n,c)];case 2:return l=o.sent(),[2,(new TextDecoder).decode(l)]}}))}))},e.encryptAES=function(e,t,r){return n(this,void 0,void 0,(function(){var n,a,s,c,l;return o(this,(function(o){switch(o.label){case 0:return n=this.getRandomBytes(this.ivLength),a=(new TextEncoder).encode(t),[4,this.prepareKey(e,r)];case 1:return s=o.sent(),[4,crypto.subtle.encrypt({name:"AES-GCM",iv:n},s,a)];case 2:return c=o.sent(),l=this.concatBytes(n,new Uint8Array(c)),[2,(0,i.fromUint8Array)(l)]}}))}))},e.concatBytes=function(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},e.getRandomBytes=function(e){var t=new Uint8Array(e);return crypto.getRandomValues(t),t},e.iterations=25e4,e.ivLength=16,e}();t.default=a},5e3:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=void 0;var a=i(r(74511)),s=i(r(18033)),c=r(21509),l=function(){function e(e){this.locale="en",this.locales=[e],this.defaultMessages=s.default,this.messages=s.default}return e.prototype.setLocales=function(e){this.locales=e},e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,i,a,s;return o(this,(function(o){switch(o.label){case 0:e=0,t=this.locales,o.label=1;case 1:if(!(e<t.length))return[3,9];r=t[e],o.label=2;case 2:return o.trys.push([2,4,,5]),i="./"+r.replace("-","_")+"/messages.json",[4,c(i)];case 3:return a=o.sent(),console.log(a),this.messages=a,this.locale=r,[3,9];case 4:return n=o.sent(),console.warn(n),[3,5];case 5:return o.trys.push([5,7,,8]),i="./"+r.split("-")[0]+"/messages.json",[4,c(i)];case 6:return a=o.sent(),console.log(a),this.messages=a,this.locale=r.split("-")[0],[3,9];case 7:return s=o.sent(),console.warn(s),[3,8];case 8:return e++,[3,1];case 9:return[2]}}))}))},e.prototype.getMessage=function(e,t,r){var n=this.doGetMessage(e);if(n){var o=new a.default(n.message,this.locale,r).format(t);return o?Array.isArray(o)?o.join(""):o:e}return e},e.prototype.getDefaultLocaleMessage=function(e){return Object.hasOwnProperty.call(this.defaultMessages,e)?this.defaultMessages[e]:(console.warn("WARN: No message found with name ".concat(e," in default locale en")),null)},e.prototype.doGetMessage=function(e){return this.messages&&Object.hasOwnProperty.call(this.messages,e)?this.messages[e]:(console.warn("No message found with name ".concat(e," in locale ").concat(this.locale,". Using default locale 'en'")),this.getDefaultLocaleMessage(e))},e}();t.default=l,t.i18n=new l("en")},6221:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(2142),d=l(r(29242)),h=a(r(64969)),f=l(r(84386)),p=a(r(89185)),g=r(94427),v=l(r(49845)),y=r(94780),m=l(r(90910)),b=l(r(43376)),w=12,k=function(){function e(e,t,r,n){this.localTreeRoot=null,this.serverTreeRoot=null,this.localScanResult=null,this.serverScanResult=null,this.actionsDone=0,this.actionsPlanned=0,this.staticContinuation=null,this.mappings=e,this.localTree=t,this.server=r,this.preserveOrder="orderFolder"in this.server,this.progressCb=(0,g.throttle)(500,!0,n),this.canceled=!1,this.isFirefox="moz-extension:"===self.location.protocol}return e.prototype.getMembersToPersist=function(){return["localScanResult","serverScanResult","localPlanStage1","serverPlanStage1","localPlanStage2","serverPlanStage2","localDonePlan","serverDonePlan","localReorders","serverReorders","localReorderPlan","serverReorderPlan"]},e.prototype.getMappingsInstance=function(){return this.mappings},e.prototype.setCacheTree=function(e){this.cacheTreeRoot=e},e.prototype.getTargetTree=function(e){return e===u.ItemLocation.SERVER?this.serverTreeRoot:this.localTreeRoot},e.prototype.cancel=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){return this.canceled=!0,this.server.cancel(),[2]}))}))},e.prototype.updateProgress=function(){void 0===this.actionsDone&&(this.actionsDone=0),this.actionsDone++,this.progressCb(Math.min(1,.5+this.actionsDone/(this.actionsPlanned+1)*.5),this.actionsDone),d.default.log("Executed ".concat(this.actionsDone," actions from ").concat(this.actionsPlanned," actions"))},e.prototype.setProgress=function(e){var t=e.actionsDone,r=e.actionsPlanned;this.actionsDone=t,this.actionsPlanned=r,this.progressCb(Math.min(1,.5+this.actionsDone/(this.actionsPlanned+1)*.5),this.actionsDone)},e.prototype.setDirection=function(e){throw new Error("Unsupported method")},e.prototype.sync=function(){return s(this,void 0,void 0,(function(){var e,t,r,n,o,i;return c(this,(function(a){switch(a.label){case 0:return this.progressCb(.15),this.masterLocation=u.ItemLocation.LOCAL,[4,this.prepareSync()];case 1:if(a.sent(),this.progressCb(.35),this.canceled)throw new y.CancelledSyncError;return d.default.log({localTreeRoot:this.localTreeRoot,serverTreeRoot:this.serverTreeRoot,cacheTreeRoot:this.cacheTreeRoot}),this.localScanResult||this.serverScanResult?[3,3]:[4,this.getDiffs()];case 2:e=a.sent(),t=e.localScanResult,r=e.serverScanResult,d.default.log({localScanResult:t,serverScanResult:r}),this.localScanResult=t,this.serverScanResult=r,this.progressCb(.45),a.label=3;case 3:if(this.canceled)throw new y.CancelledSyncError;return this.serverPlanStage1?[3,5]:(n=this,[4,this.reconcileDiffs(this.localScanResult,this.serverScanResult,u.ItemLocation.SERVER)]);case 4:n.serverPlanStage1=a.sent(),a.label=5;case 5:if(this.canceled)throw new y.CancelledSyncError;return this.localPlanStage1?[3,7]:(o=this,[4,this.reconcileDiffs(this.serverScanResult,this.localScanResult,u.ItemLocation.LOCAL)]);case 6:o.localPlanStage1=a.sent(),a.label=7;case 7:if(this.serverPlanStage2||(i=this.mappings.getSnapshot(),d.default.log("Mapping server plan"),this.serverPlanStage2={CREATE:this.serverPlanStage1.CREATE.map(i,u.ItemLocation.SERVER),UPDATE:this.serverPlanStage1.UPDATE.map(i,u.ItemLocation.SERVER),MOVE:this.serverPlanStage1.MOVE,REMOVE:this.serverPlanStage1.REMOVE.map(i,u.ItemLocation.SERVER),REORDER:this.serverPlanStage1.REORDER}),this.canceled)throw new y.CancelledSyncError;if(this.localPlanStage2||(i||(i=this.mappings.getSnapshot()),d.default.log("Mapping local plan"),this.localPlanStage2={CREATE:this.localPlanStage1.CREATE.map(i,u.ItemLocation.LOCAL),UPDATE:this.localPlanStage1.UPDATE.map(i,u.ItemLocation.LOCAL),MOVE:this.localPlanStage1.MOVE,REMOVE:this.localPlanStage1.REMOVE.map(i,u.ItemLocation.LOCAL),REORDER:this.localPlanStage1.REORDER}),this.canceled)throw new y.CancelledSyncError;return d.default.log({localPlan:this.localPlanStage2,serverPlan:this.serverPlanStage2}),this.applyFailsafe(this.localPlanStage2.REMOVE),this.localDonePlan||(this.localDonePlan={CREATE:new h.default,UPDATE:new h.default,MOVE:new h.default,REMOVE:new h.default,REORDER:new h.default},this.serverDonePlan={CREATE:new h.default,UPDATE:new h.default,MOVE:new h.default,REMOVE:new h.default,REORDER:new h.default}),this.localReorders||(this.localReorders=this.localPlanStage2.REORDER,this.serverReorders=this.serverPlanStage2.REORDER),this.actionsPlanned||(this.actionsPlanned=Object.values(this.serverPlanStage2).reduce((function(e,t){return t.getActions().length+e}),0)+Object.values(this.localPlanStage2).reduce((function(e,t){return t.getActions().length+e}),0)),d.default.log("Executing server plan"),[4,this.execute(this.server,this.serverPlanStage2,u.ItemLocation.SERVER,this.serverDonePlan,this.serverReorders)];case 8:if(a.sent(),this.canceled)throw new y.CancelledSyncError;return d.default.log("Executing local plan"),[4,this.execute(this.localTree,this.localPlanStage2,u.ItemLocation.LOCAL,this.localDonePlan,this.localReorders)];case 9:if(a.sent(),this.canceled)throw new y.CancelledSyncError;if("orderFolder"in this.server&&!this.localReordersFinal&&(i=this.mappings.getSnapshot(),this.localReordersFinal=this.reconcileReorderings(this.localReorders,this.serverDonePlan,u.ItemLocation.LOCAL,i),this.serverReorderFinal=this.reconcileReorderings(this.serverReorders,this.localDonePlan,u.ItemLocation.SERVER,i)),this.canceled)throw new y.CancelledSyncError;return"orderFolder"in this.server?(d.default.log("Executing reorderings"),[4,Promise.all([this.executeReorderings(this.server,this.serverReorderFinal),this.executeReorderings(this.localTree,this.localReordersFinal)])]):[3,11];case 10:a.sent(),a.label=11;case 11:return[2]}}))}))},e.prototype.prepareSync=function(){return s(this,void 0,void 0,(function(){var e,t,r;return c(this,(function(n){switch(n.label){case 0:return this.localTreeRoot?[3,4]:(d.default.log("Retrieving local tree"),[4,this.localTree.getBookmarksTree()]);case 1:return e=n.sent(),d.default.log("Filtering out unaccepted local bookmarks"),this.filterOutUnacceptedBookmarks(e),this.server instanceof m.default?(d.default.log("Filtering out duplicate bookmarks"),[4,this.filterOutDuplicatesInTheSameFolder(e)]):[3,3];case 2:n.sent(),n.label=3;case 3:this.localTreeRoot=e,n.label=4;case 4:if(this.cacheTreeRoot.id=this.localTreeRoot.id,this.canceled)throw new y.CancelledSyncError;return this.serverTreeRoot?[3,9]:(d.default.log("Retrieving server tree"),[4,this.server.getBookmarksTree()]);case 5:if(t=n.sent(),d.default.log("Filtering out invalid server bookmarks"),this.filterOutInvalidBookmarks(t),this.canceled)throw new y.CancelledSyncError;return[4,this.mappings.addFolder({localId:this.localTreeRoot.id,remoteId:t.id})];case 6:return n.sent(),r=this.mappings.getSnapshot(),"loadFolderChildren"in this.server?(d.default.log("Loading sparse tree as necessary"),[4,this.loadChildren(t,r,!0)]):[3,8];case 7:n.sent(),n.label=8;case 8:this.serverTreeRoot=t,n.label=9;case 9:return d.default.log("Generating indices for local tree"),this.localTreeRoot.createIndex(),d.default.log("Generating indices for cache tree"),this.cacheTreeRoot.createIndex(),d.default.log("Generating indices for server tree"),this.serverTreeRoot.createIndex(),[2]}}))}))},e.prototype.applyFailsafe=function(e){var t=this.localTreeRoot.count(),r=e.getActions().reduce((function(e,t){return e+t.payload.count()}),0);if(d.default.log("Checking failsafe: "+r+"/"+t+"="+r/t),t>5&&r/t>.5){var n=this.server.getData().failsafe;if(!1!==n||void 0===n)throw new y.FailsafeError(Math.ceil(r/t*100))}},e.prototype.filterOutUnacceptedBookmarks=function(e){var t=this;e.children=e.children.filter((function(e){return e instanceof u.Bookmark?t.server.acceptsBookmark(e):(t.filterOutUnacceptedBookmarks(e),!0)}))},e.prototype.filterOutInvalidBookmarks=function(e){var t=this;e.children=e.children.filter((function(e){if(e instanceof u.Bookmark){if(t.isFirefox&&e.url.startsWith("chrome"))return!1;if(null===e.url)return!1}else t.filterOutInvalidBookmarks(e);return!0}))},e.prototype.filterOutDuplicatesInTheSameFolder=function(e){return s(this,void 0,void 0,(function(){var t,r,n=this;return c(this,(function(o){return t={},r=[],e.children=e.children.filter((function(e){if(e.type===u.ItemType.BOOKMARK){if(t[e.url])return r.push(e),!1;t[e.url]=e}else n.filterOutDuplicatesInTheSameFolder(e);return!0})),r.length&&d.default.log("Filtered out the following duplicates before syncing",r),[2]}))}))},e.prototype.getDiffs=function(){return s(this,void 0,void 0,(function(){var e,t,r,n,o,i,a=this;return c(this,(function(s){switch(s.label){case 0:return e=this.mappings.getSnapshot(),t=[],"LocalTabs"===this.localTree.constructor.name?(r=new f.default(this.cacheTreeRoot,this.localTreeRoot,(function(t,r){return!(t.type!==r.type||"bookmark"===t.type&&"bookmark"===r.type&&t.url!==r.url||!v.default.mappable(e,t,r)&&("folder"!==t.type||!t.canMergeWith(r)))}),this.preserveOrder),n=new f.default(this.cacheTreeRoot,this.serverTreeRoot,(function(r,n){return r.type===n.type&&("bookmark"!==r.type||"bookmark"!==n.type||r.url===n.url)&&(v.default.mappable(e,r,n)||!!r.canMergeWith(n))&&(t.push([r,n]),!0)}),this.preserveOrder)):(r=new f.default(this.cacheTreeRoot,this.localTreeRoot,(function(t,r){return t.type===r.type&&("bookmark"!==t.type||"bookmark"!==r.type||t.url===r.url)&&!!v.default.mappable(e,t,r)}),this.preserveOrder),n=new f.default(this.cacheTreeRoot,this.serverTreeRoot,(function(r,n){return r.type===n.type&&("bookmark"!==r.type||"bookmark"!==n.type||r.url===n.url)&&(v.default.mappable(e,r,n)||!("bookmark"!==r.type||"bookmark"!==n.type||!r.canMergeWith(n)))&&(t.push([r,n]),!0)}),this.preserveOrder)),d.default.log("Calculating diffs for local and server trees relative to cache tree"),[4,r.run()];case 1:return o=s.sent(),[4,n.run()];case 2:return i=s.sent(),[4,p.map(t,(function(e){var t=e[0],r=e[1];return a.addMapping(a.server,t,r.id)}),10)];case 3:return s.sent(),[2,{localScanResult:o,serverScanResult:i}]}}))}))},e.prototype.reconcileDiffs=function(t,r,o){return s(this,void 0,void 0,(function(){var i,a,l,g,y,m,b,k,E,R,S,O,I,T,_=this;return c(this,(function(L){switch(L.label){case 0:return d.default.log("Reconciling diffs to prepare a plan for "+o),i=this.mappings.getSnapshot(),a=r.CREATE.getActions(),l=r.REMOVE.getActions(),g=r.MOVE.getActions(),y=r.UPDATE.getActions(),m=r.REORDER.getActions(),b=t.CREATE.getActions(),k=t.REMOVE.getActions(),E=t.MOVE.getActions(),R=o===u.ItemLocation.LOCAL?this.localTreeRoot:this.serverTreeRoot,S=o===u.ItemLocation.LOCAL?this.serverTreeRoot:this.localTreeRoot,O=t.CREATE.getActions().concat(t.MOVE.getActions()).concat(r.CREATE.getActions()).concat(r.MOVE.getActions()),I={},T={CREATE:new h.default,UPDATE:new h.default,MOVE:new h.default,REMOVE:new h.default,REORDER:new h.default},[4,p.each(t.REMOVE.getActions(),(function(e){return s(_,void 0,void 0,(function(){return c(this,(function(t){return l.find((function(t){return e.payload.type===t.payload.type&&v.default.mappable(i,e.payload,t.payload)||h.default.findChain(i,O,R,e.payload,t)}))||g.find((function(t){return e.payload.type===t.payload.type&&v.default.mappable(i,e.payload,t.payload)}))&&o===this.masterLocation||T.REMOVE.commit(e),[2]}))}))}),w)];case 1:return L.sent(),[4,p.each(t.CREATE.getActions(),(function(e){return s(_,void 0,void 0,(function(){var t,n,o=this;return c(this,(function(l){switch(l.label){case 0:return(t=a.find((function(t){return e.payload.parentId===v.default.mapParentId(i,t.payload,e.payload.location)&&e.payload.canMergeWith(t.payload)})))?(n=[],[4,new f.default(t.payload,e.payload,(function(e,t){return!(e.type!==t.type||!e.canMergeWith(t)||(n.push([e,t.id]),0))}),this.preserveOrder,!1).run()]):[3,3];case 1:return l.sent(),n.push([t.payload,e.payload.id]),[4,p.each(n,(function(t){var r=t[0],n=t[1];return s(o,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.addMapping(e.payload.location===u.ItemLocation.LOCAL?this.localTree:this.server,r,n)];case 1:return t.sent(),[2]}}))}))}),1)];case 2:return l.sent(),[2];case 3:return r.REMOVE.getActions().find((function(t){return h.default.findChain(i,O,S,e.payload,t)}))?(I[e.payload.parentId]=!0,[2]):(T.CREATE.commit(e),[2])}}))}))}),w)];case 2:return L.sent(),[4,p.each(t.MOVE.getActions(),(function(r){return s(_,void 0,void 0,(function(){var a,s,d,f,p,y,m;return c(this,(function(c){return o===this.masterLocation&&g.find((function(e){return r.payload.type===e.payload.type&&v.default.mappable(i,r.payload,e.payload)}))?[2]:(a=l.find((function(e){return h.default.findChain(i,O,S,r.payload,e)})),s=l.find((function(e){return r.payload.type===e.payload.type&&v.default.mappable(i,r.payload,e.payload)||h.default.findChain(i,O,S,r.oldItem,e)})),d=k.find((function(e){return h.default.findChain(i,O,R,r.oldItem,e)})),f=k.find((function(e){return h.default.findChain(i,O,new u.Folder({id:0,location:o}),r.payload,e)})),a?(s||d||(T.REMOVE.commit({type:h.ActionType.REMOVE,payload:r.oldItem,oldItem:null}),e.removeItemFromReorders(i,t.REORDER,r.oldItem),I[r.payload.id]=!0),[2]):f?(o!==this.masterLocation&&T.REMOVE.commit({type:h.ActionType.REMOVE,payload:r.oldItem,oldItem:null}),e.removeItemFromReorders(i,t.REORDER,r.oldItem),I[r.payload.id]=!0,[2]):s?(o!==this.masterLocation&&(p=b.find((function(e){return e.payload.findItem(u.ItemType.FOLDER,r.payload.parentId)})),(y=r.payload.clone()).type===u.ItemType.FOLDER&&y.traverse((function(e,t){var r=k.find((function(t){return v.default.mappable(i,e,t.payload)})),n=E.find((function(t){return v.default.mappable(i,e,t.payload)}));(r||n&&v.default.mapParentId(i,n.payload,e.location)!==e.parentId)&&t.children.splice(t.children.indexOf(e),1)})),p&&p.payload.type===u.ItemType.FOLDER?p.payload.findFolder(r.payload.parentId).children.splice(r.index,0,y):T.CREATE.commit({type:h.ActionType.CREATE,oldItem:null,payload:y})),[2]):(m=g.filter((function(e){return h.default.findChain(i,O,S,r.payload,e)&&h.default.findChain(i,O,R,e.payload,r)}))).length?(o!==this.masterLocation?(T.MOVE.commit(r),m.forEach((function(o){var a=o.oldItem.cloneWithLocation(!1,r.payload.location),s=o.payload.cloneWithLocation(!1,r.oldItem.location);s.id=v.default.mapId(i,o.payload,r.oldItem.location),s.parentId=v.default.mapParentId(i,o.payload,r.oldItem.location),T.MOVE.getActions().find((function(e){return String(e.payload.id)===String(a.id)}))||E.find((function(e){return String(e.payload.id)===String(a.id)}))||l.find((function(e){return h.default.findChain(i,O,S,r.payload,e)}))||k.find((function(e){return h.default.findChain(i,O,R,r.payload,e)}))||(T.MOVE.commit(n(n({},o),{payload:a,oldItem:s})),e.removeItemFromReorders(i,t.REORDER,a),e.removeItemFromReorders(i,t.REORDER,s))}))):(e.removeItemFromReorders(i,t.REORDER,r.oldItem),e.removeItemFromReorders(i,t.REORDER,r.payload)),[2]):(T.MOVE.commit(r),[2]))}))}))}),1)];case 3:return L.sent(),[4,p.each(t.UPDATE.getActions(),(function(e){return s(_,void 0,void 0,(function(){return c(this,(function(t){return y.find((function(t){return e.payload.type===t.payload.type&&v.default.mappable(i,e.payload,t.payload)}))&&o===this.masterLocation||l.find((function(t){return t.payload.findItem(e.payload.type,v.default.mapId(i,e.payload,t.payload.location))||t.payload.findItem(u.ItemType.FOLDER,v.default.mapParentId(i,e.payload,t.payload.location))}))||T.UPDATE.commit(e),[2]}))}))}))];case 4:return L.sent(),[4,p.each(t.REORDER.getActions(),(function(e){return s(_,void 0,void 0,(function(){return c(this,(function(t){return I[e.payload.id]||o===this.masterLocation&&m.find((function(t){return e.payload.type===t.payload.type&&v.default.mappable(i,e.payload,t.payload)}))||l.find((function(t){return t.payload.findItem("folder",e.payload.id)}))||T.REORDER.commit(e),[2]}))}))}))];case 5:return L.sent(),[2,T]}}))}))},e.prototype.execute=function(e,t,r,n,o){return s(this,void 0,void 0,(function(){var i,a,s,l,u=this;return c(this,(function(c){switch(c.label){case 0:d.default.log("Executing "+r+" plan for "),i=t.CREATE.getActions(),c.label=1;case 1:return i.length>0?(d.default.log(r+": executing CREATEs"),[4,p.each(i,(function(i){return u.executeCreate(e,i,r,t.CREATE,o,n)}),w)]):[3,3];case 2:return c.sent(),i=t.CREATE.getActions(),[3,1];case 3:if(this.canceled)throw new y.CancelledSyncError;return d.default.log(r+": executing CREATEs"),[4,p.each(t.UPDATE.getActions(),(function(o){return u.executeUpdate(e,o,r,t.UPDATE,n)}),w)];case 4:if(c.sent(),this.canceled)throw new y.CancelledSyncError;if(a=this.mappings.getSnapshot(),d.default.log(r+": mapping MOVEs"),s={CREATE:t.CREATE,UPDATE:t.UPDATE,MOVE:t.MOVE.map(a,r),REMOVE:t.REMOVE,REORDER:t.REORDER},this.canceled)throw new y.CancelledSyncError;if(l=h.default.sortMoves(s.MOVE.getActions(),this.getTargetTree(r)),this.canceled)throw new y.CancelledSyncError;return d.default.log(r+": executing MOVEs"),[4,p.each(l,(function(t){return p.each(t,(function(t){return u.executeUpdate(e,t,r,s.MOVE,n)}),w)}),1)];case 5:if(c.sent(),this.canceled)throw new y.CancelledSyncError;return d.default.log(r+": executing REMOVEs"),[4,p.each(s.REMOVE.getActions(),(function(t){return u.executeRemove(e,t,r,s.REMOVE,n)}),w)];case 6:return c.sent(),[2]}}))}))},e.prototype.executeCreate=function(e,t,r,n,o,i){return s(this,void 0,void 0,(function(){var a,l,g,m,w,k,E,R,S,O,I,T,_,L=this;return c(this,(function(P){switch(P.label){case 0:return[4,Promise.resolve()];case 1:if(P.sent(),d.default.log("Executing action ",t),this.canceled)throw new y.CancelledSyncError;return a=function(){n.retract(t),i.CREATE.commit(t),L.updateProgress()},[4,t.payload.visitCreate(e)];case 2:return void 0===(l=P.sent())?(a(),[2]):(t.payload.id=l,t.oldItem?[4,this.addMapping(e,t.oldItem,l)]:[3,4]);case 3:P.sent(),P.label=4;case 4:if(t.payload instanceof u.Folder&&!(t.oldItem instanceof u.Folder))throw new Error("Assertion failed: action.oldItem should be set");if(!(t.payload instanceof u.Folder&&t.payload.children.length&&t.oldItem instanceof u.Folder))return[3,19];if(t.payload.children.forEach((function(e){e.parentId=l})),!("bulkImportFolder"in e))return[3,18];if(!(t.payload.count()<75||this.server instanceof b.default))return[3,13];d.default.log("Attempting full bulk import"),P.label=5;case 5:return P.trys.push([5,11,,12]),[4,e.bulkImportFolder(l,t.oldItem.cloneWithLocation(!1,t.payload.location))];case 6:return g=P.sent(),m=[],[4,new f.default(t.oldItem,g,(function(e,t){return!(e.type!==t.type||!e.canMergeWith(t)||(m.push([e,t.id]),0))}),this.preserveOrder,!1).run()];case 7:return P.sent(),[4,p.each(m,(function(t){var r=t[0],n=t[1];return s(L,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.addMapping(e,r,n)];case 1:return t.sent(),[2]}}))}))}),10)];case 8:return P.sent(),"orderFolder"in e?(w=this.mappings.getSnapshot(),this.actionsPlanned++,o.commit({type:h.ActionType.REORDER,oldItem:g,payload:t.oldItem,order:t.oldItem.children.map((function(e){return{type:e.type,id:e.id}}))}),[4,t.oldItem.traverse((function(e){if(e instanceof u.Folder&&e.children.length>1){var t=g.findFolder(v.default.mapId(w,e,r));L.actionsPlanned++,o.commit({type:h.ActionType.REORDER,oldItem:t,payload:e,order:e.children.map((function(e){return{type:e.type,id:e.id}}))})}}))]):[3,10];case 9:P.sent(),P.label=10;case 10:return a(),[2];case 11:return k=P.sent(),d.default.log("Bulk import failed, continuing with normal creation",k),[3,12];case 12:return[3,18];case 13:P.trys.push([13,17,,18]),E=t.oldItem.cloneWithLocation(!1,t.payload.location),R=E.children.filter((function(e){return e instanceof u.Bookmark})),S=function(){var r,n;return c(this,(function(o){switch(o.label){case 0:return d.default.log("Attempting chunked bulk import"),E.children=R.splice(0,70),[4,e.bulkImportFolder(t.payload.id,E)];case 1:return r=o.sent(),n=[],[4,new f.default(E,r,(function(e,t){return!(e.type!==t.type||!e.canMergeWith(t)||(n.push([e,t.id]),0))}),O.preserveOrder,!1).run()];case 2:return o.sent(),[4,p.each(n,(function(t){var r=t[0],n=t[1];return s(L,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.addMapping(e,r,n)];case 1:return t.sent(),[2]}}))}))}),10)];case 3:return o.sent(),[2]}}))},O=this,P.label=14;case 14:return R.length>0?[5,S()]:[3,16];case 15:return P.sent(),[3,14];case 16:return I=this.mappings.getSnapshot(),t.payload.children.filter((function(e){return e instanceof u.Folder})).filter((function(e){return e})).forEach((function(e){var o=e;o.parentId=v.default.mapParentId(I,e,r);var i=t.oldItem.findItem(e.type,e.id),a={type:h.ActionType.CREATE,payload:o,oldItem:i};L.actionsPlanned++,n.commit(a)})),"orderFolder"in e&&(this.actionsPlanned++,o.commit({type:h.ActionType.REORDER,oldItem:t.payload,payload:t.oldItem,order:t.payload.children.map((function(e){return{type:e.type,id:e.id}}))})),a(),[2];case 17:return T=P.sent(),d.default.log("Bulk import failed, continuing with normal creation",T),[3,18];case 18:_=this.mappings.getSnapshot(),t.payload.children.forEach((function(e){e.parentId=v.default.mapParentId(_,e,r);var o=t.oldItem.findItem(e.type,e.id),i={type:h.ActionType.CREATE,payload:e,oldItem:o};L.actionsPlanned++,n.commit(i)})),"orderFolder"in e&&(this.actionsPlanned++,o.commit({type:h.ActionType.REORDER,oldItem:t.payload,payload:t.oldItem,order:t.oldItem.children.map((function(e){return{type:e.type,id:e.id}}))})),P.label=19;case 19:return a(),[2]}}))}))},e.prototype.executeRemove=function(e,t,r,n,o){return s(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,Promise.resolve()];case 1:if(r.sent(),d.default.log("Executing action ",t),this.canceled)throw new y.CancelledSyncError;return[4,t.payload.visitRemove(e)];case 2:return r.sent(),[4,this.removeMapping(e,t.payload)];case 3:return r.sent(),n.retract(t),o.REMOVE.commit(t),this.updateProgress(),[2]}}))}))},e.prototype.executeUpdate=function(e,t,r,n,o){return s(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,Promise.resolve()];case 1:if(r.sent(),d.default.log("Executing action ",t),this.canceled)throw new y.CancelledSyncError;return[4,t.payload.visitUpdate(e)];case 2:return r.sent(),[4,this.addMapping(e,t.oldItem,t.payload.id)];case 3:return r.sent(),n.retract(t),t.type===h.ActionType.UPDATE?o.UPDATE.commit(t):o.MOVE.commit(t),this.updateProgress(),[2]}}))}))},e.prototype.reconcileReorderings=function(e,t,r,o){d.default.log("Reconciling reorders to create a plan");var i=t.CREATE.getActions(),a=t.REMOVE.getActions(),s=t.MOVE.getActions(),c=new h.default;return e.getActions().forEach((function(e){var t=n(n({},e),{order:e.order.slice()});if(!a.filter((function(e){return e.payload.findItem(t.payload.type,e.payload.id)})).length){var r=s.filter((function(e){return String(t.payload.id)!==String(e.payload.parentId)&&t.order.find((function(t){return String(t.id)===String(e.payload.id)&&t.type===e.payload.type}))})),o=a.filter((function(e){return t.order.find((function(t){return String(t.id)===String(e.payload.id)&&t.type===e.payload.type}))}));t.order=t.order.filter((function(e){var n;return(n=r.find((function(t){return String(e.id)===String(t.payload.id)&&t.payload.type===e.type})))?(d.default.log("ReconcileReorders: Removing moved item from order",{move:n,reorder:t}),!1):!(n=o.find((function(t){return String(e.id)===String(t.payload.id)&&t.payload.type===e.type})))||(d.default.log("ReconcileReorders: Removing removed item from order",{item:e,reorder:t,removal:n}),!1)})),i.filter((function(e){return String(t.payload.id)===String(e.payload.parentId)})).forEach((function(e){d.default.log("ReconcileReorders: Inserting created item into order",{creation:e,reorder:t}),t.order.splice(e.index,0,{type:e.payload.type,id:e.payload.id})})),s.filter((function(e){return String(t.payload.id)===String(e.payload.parentId)&&!t.order.find((function(t){return String(t.id)===String(e.payload.id)&&t.type===e.payload.type}))})).forEach((function(e){d.default.log("ReconcileReorders: Inserting moved item into order",{move:e,reorder:t}),t.order.splice(e.index,0,{type:e.payload.type,id:e.payload.id})})),c.commit(t)}})),c.map(o,r)},e.prototype.executeReorderings=function(e,t){return s(this,void 0,void 0,(function(){var r=this;return c(this,(function(n){switch(n.label){case 0:return d.default.log("Executing reorderings"),d.default.log({reorderings:t}),[4,p.each(t.getActions(),(function(n){return s(r,void 0,void 0,(function(){var r,o,i;return c(this,(function(a){switch(a.label){case 0:if(d.default.log("Executing reorder action","".concat(n.type," Payload: #").concat(n.payload.id,"[").concat(n.payload.title,"]").concat("url"in n.payload?"(".concat(n.payload.url,")"):""," parentId: ").concat(n.payload.parentId)),r=n.payload,this.canceled)throw new y.CancelledSyncError;if(n.order.length<=1)return[2];o={},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.orderFolder(r.id,n.order.filter((function(e){return!o[e.type+""+e.id]&&(o[e.type+""+e.id]=!0,e.id)})))];case 2:return a.sent(),[3,4];case 3:return i=a.sent(),d.default.log("Failed to execute REORDER: "+i.message+"\nMoving on."),d.default.log(i),[3,4];case 4:return t.retract(n),this.updateProgress(),[2]}}))}))}),w)];case 1:return n.sent(),[2]}}))}))},e.prototype.addMapping=function(e,t,r){return s(this,void 0,void 0,(function(){var n,o;return c(this,(function(i){switch(i.label){case 0:return[4,Promise.resolve()];case 1:return i.sent(),e===this.server?(n=t.id,o=r):(n=r,o=t.id),"folder"!==t.type?[3,3]:[4,this.mappings.addFolder({localId:n,remoteId:o})];case 2:return i.sent(),[3,5];case 3:return[4,this.mappings.addBookmark({localId:n,remoteId:o})];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},e.prototype.removeMapping=function(e,t){return s(this,void 0,void 0,(function(){var r,n;return c(this,(function(o){switch(o.label){case 0:return e===this.server?n=t.id:r=t.id,"folder"!==t.type?[3,2]:[4,this.mappings.removeFolder({localId:r,remoteId:n})];case 1:return o.sent(),[3,4];case 2:return[4,this.mappings.removeBookmark({localId:r,remoteId:n})];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},e.prototype.loadChildren=function(e,t,r){return void 0===r&&(r=!1),s(this,void 0,void 0,(function(){var n,o,i,a,s,l=this;return c(this,(function(c){switch(c.label){case 0:if(this.canceled)throw new y.CancelledSyncError;return e instanceof u.Folder&&"loadFolderChildren"in this.server?(r?(n=this.localTreeRoot,o=this.cacheTreeRoot):(i=t.ServerToLocal.folder[e.id],n=this.localTreeRoot.findFolder(i),o=this.cacheTreeRoot.findFolder(i)),(a=n)?[4,this.folderHasChanged(n,o,e)]:[3,2]):[2];case 1:a=!c.sent(),c.label=2;case 2:return a?[2]:(d.default.log("LOADCHILDREN",e),[4,this.server.loadFolderChildren(e.id,!n)]);case 3:return(s=c.sent())?(e.children=s,e.loaded=!0,[4,p.each(e.children,(function(e){return l.loadChildren(e,t)}),10)]):[2];case 4:return c.sent(),[2]}}))}))},e.prototype.folderHasChanged=function(e,t,r){return s(this,void 0,void 0,(function(){var n,o,i,a,s,l,u,d,h,f;return c(this,(function(c){switch(c.label){case 0:return n=this.mappings.getSnapshot(),e?[4,e.hash(this.preserveOrder)]:[3,2];case 1:return i=c.sent(),[3,3];case 2:i=null,c.label=3;case 3:return o=i,t?[4,t.hash(this.preserveOrder)]:[3,5];case 4:return s=c.sent(),[3,6];case 5:s=null,c.label=6;case 6:return a=s,r?[4,r.hash(this.preserveOrder)]:[3,8];case 7:return u=c.sent(),[3,9];case 8:u=null,c.label=9;case 9:return l=u,d=!t,h=o!==a||t&&String(e.parentId)!==String(t.parentId),f=a!==l||t&&String(t.parentId)!==String(n.ServerToLocal.folder[r.parentId]),[2,h||f||d]}}))}))},e.prototype.filterOutUnmappedItems=function(e,t){var r=this;e.children=e.children.filter((function(e){return e instanceof u.Bookmark?e.id in t.LocalToServer.bookmark:e.id in t.LocalToServer.folder&&(r.filterOutUnmappedItems(e,t),!0)}))},e.removeItemFromReorders=function(e,t,r){var n=t.getActions().find((function(t){return v.default.mapId(e,t.payload,r.location)===r.parentId}));n&&(n.order=n.order.filter((function(t){return!(t.type===r.type&&v.default.mapId(e,r,n.payload.location)===t.id)})))},e.prototype.toJSON=function(){this.staticContinuation||(this.staticContinuation={localTreeRoot:this.localTreeRoot&&this.localTreeRoot.clone(!1),cacheTreeRoot:this.cacheTreeRoot&&this.cacheTreeRoot.clone(!1),serverTreeRoot:this.serverTreeRoot&&this.serverTreeRoot.clone(!1)});var e=this.getMembersToPersist();return n(n({strategy:"default"},this.staticContinuation),Object.fromEntries(Object.entries(this).filter((function(t){var r=t[0];return e.includes(r)}))))},e.fromJSON=function(t,n,o,i,l){return s(this,void 0,void 0,(function(){var s,d,f,p=this;return c(this,(function(c){switch(c.label){case 0:switch(l.strategy){case"default":return[3,1];case"merge":return[3,2];case"unidirectional":return[3,4]}return[3,6];case 1:return s=new e(t,n,o,i),[3,7];case 2:return[4,Promise.resolve().then((function(){return a(r(9872))}))];case 3:return d=c.sent().default,s=new d(t,n,o,i),[3,7];case 4:return[4,Promise.resolve().then((function(){return a(r(92444))}))];case 5:return f=c.sent().default,s=new f(t,n,o,i),[3,7];case 6:throw new Error("Unknown strategy: "+l.strategy);case 7:return s.setProgress(l),l.serverTreeRoot&&(s.serverTreeRoot=u.Folder.hydrate(l.serverTreeRoot)),l.localTreeRoot&&(s.localTreeRoot=u.Folder.hydrate(l.localTreeRoot)),l.cacheTreeRoot&&(s.cacheTreeRoot=u.Folder.hydrate(l.cacheTreeRoot)),s.getMembersToPersist().forEach((function(e){e in l&&(e.toLowerCase().includes("scanresult")||e.toLowerCase().includes("plan")?p[e]={CREATE:h.default.fromJSON(l[e].CREATE),UPDATE:h.default.fromJSON(l[e].UPDATE),MOVE:h.default.fromJSON(l[e].MOVE),REMOVE:h.default.fromJSON(l[e].REMOVE),REORDER:h.default.fromJSON(l[e].REORDER)}:e.toLowerCase().includes("reorders")?p[e]=h.default.fromJSON(l[e]):p[e]=l[e])})),[2,s]}}))}))},e}();t.default=k},7486:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=r(16546),l=function(){function e(e){this.worker=e}return e.getSingleton=function(){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.singleton?[3,3]:"web"!==c.Capacitor.getPlatform()?[3,1]:(this.singleton=new e,[3,3]);case 1:return t=this,[4,Promise.resolve().then((function(){return i(r(87319))}))];case 2:t.singleton=new(n.sent().default),n.label=3;case 3:return[2,this.singleton]}}))}))},e.prototype.getWorker=function(){var e;return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.worker?[2,Promise.resolve(this.worker)]:!navigator.userAgent.includes("Firefox")&&(null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)?[2,navigator.serviceWorker.ready.then((function(e){return{postMessage:function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return(t=e.active).postMessage.apply(t,r)},addEventListener:function(e){var t=function(t){return e(t.data)};return navigator.serviceWorker.addEventListener("message",t),function(){return navigator.serviceWorker.removeEventListener("message",t)}}}}))]:"web"!==c.Capacitor.getPlatform()?[3,2]:[4,Promise.resolve().then((function(){return i(r(7737))}))];case 1:return t=n.sent().default,[2,{postMessage:function(e){try{t.runtime.sendMessage(e)}catch(e){console.warn(e)}},addEventListener:function(e){try{t.runtime.onMessage.addListener(e)}catch(e){console.warn(e)}return function(){try{t.runtime.onMessage.removeListener(e)}catch(e){console.warn(e)}}}}];case 2:return[2]}}))}))},e.prototype.cancelSync=function(e,t){return a(this,void 0,void 0,(function(){var r,n;return s(this,(function(o){switch(o.label){case 0:return console.log("Waiting for service worker readiness"),[4,this.getWorker()];case 1:return r=o.sent(),n={type:"cancelSync",params:[e,t]},r.postMessage(n),console.log("Sending message to service worker: ",n),[2]}}))}))},e.prototype.onStatusChange=function(e){var t,r=function(t){"status:update"===t.type&&e()};return this.getWorker().then((function(e){t=e.addEventListener(r)})),function(){t&&t()}},e.prototype.scheduleSync=function(e,t){return a(this,void 0,void 0,(function(){var r,n;return s(this,(function(o){switch(o.label){case 0:return console.log("Waiting for service worker readiness"),[4,this.getWorker()];case 1:return r=o.sent(),n={type:"scheduleSync",params:[e,t]},r.postMessage(n),console.log("Sending message to service worker: ",n),[2]}}))}))},e.prototype.scheduleAll=function(){return a(this,void 0,void 0,(function(){var e,t;return s(this,(function(r){switch(r.label){case 0:return console.log("Waiting for service worker readiness"),[4,this.getWorker()];case 1:return e=r.sent(),t={type:"scheduleAll",params:[]},e.postMessage(t),console.log("Sending message to service worker: ",t),[2]}}))}))},e.prototype.setEnabled=function(e){return a(this,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:return[4,this.getWorker()];case 1:return t=n.sent(),r={type:"setEnabled",params:[e]},t.postMessage(r),console.log("Sending message to service worker: ",r),[2]}}))}))},e.prototype.syncAccount=function(e,t,r){return void 0===r&&(r=!1),a(this,void 0,void 0,(function(){var n,o;return s(this,(function(i){switch(i.label){case 0:return console.log("Waiting for service worker readiness"),[4,this.getWorker()];case 1:return n=i.sent(),o={type:"syncAccount",params:[e,t,r]},n.postMessage(o),console.log("Sending message to service worker: ",o),[2]}}))}))},e.prototype.unlock=function(e){return a(this,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:return console.log("Waiting for service worker readiness"),[4,this.getWorker()];case 1:return t=n.sent(),r={type:"unlock",params:[e]},t.postMessage(r),console.log("Sending message to service worker: ",r),[2]}}))}))},e.prototype.getUnlocked=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return console.log("Waiting for service worker readiness"),[4,this.getWorker()];case 1:return e=t.sent(),[2,new Promise((function(t){var r=e.addEventListener((function(e){"getUnlockedResponse"===e.type&&(t(e.params[0]),console.log("Message response received",e),r())})),n={type:"getUnlocked",params:[]};e.postMessage(n),console.log("Sending message to service worker: ",n)}))]}}))}))},e.prototype.onLoad=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e}();t.default=l},7737:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c}),r(3362);const n=(o="undefined"!=typeof window?window:self,i=Array.prototype.push,a=Object.prototype.hasOwnProperty,function e(t,r){t=t||o.chrome,r=r||o.Promise;var n=t.runtime;function s(e,t){return function(){var o=arguments;return new r((function(r,a){i.call(o,(function(){var e=n.lastError;e?a(e):r.apply(null,arguments)})),e.apply(t,o)}))}}!function t(r,n){for(var o in r)if(a.call(r,o)){var i=r[o],c=typeof i;"object"!==c||i instanceof e||0===o.indexOf("on")?n[o]="function"===c?s(i,r):i:(n[o]={},t(i,n[o]))}}(t,this)});var o,i,a;let s;"undefined"==typeof browser&&"undefined"!=typeof chrome?(s=new n(chrome,Promise),s.alarms=chrome.alarms,s.browserAction=chrome.browserAction,s.action=chrome.action,s.i18n=chrome.i18n):s=browser;const c=s},8330:e=>{"use strict";e.exports={rE:"5.4.5"}},9872:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t},l=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=r(2142),f=d(r(64969)),p=d(r(84386)),g=c(r(89185)),v=d(r(6221)),y=d(r(49845)),m=d(r(29242)),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.getDiffs=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o,i=this;return u(this,(function(a){switch(a.label){case 0:return e=[],t=new p.default(this.serverTreeRoot,this.localTreeRoot,(function(t,r){return!(r.type!==t.type||!t.canMergeWith(r)||(e.push([r,t]),0))}),this.preserveOrder,!1,!1),r=new p.default(this.localTreeRoot,this.serverTreeRoot,(function(t,r){return!(r.type!==t.type||!r.canMergeWith(t)||(e.push([t,r]),0))}),this.preserveOrder,!1,!1),[4,t.run()];case 1:return n=a.sent(),[4,r.run()];case 2:return o=a.sent(),[4,g.map(e,(function(e){var t=e[0],r=e[1];return i.addMapping(i.server,t,r.id)}),10)];case 3:return a.sent(),[2,{localScanResult:n,serverScanResult:o}]}}))}))},t.prototype.reconcileDiffs=function(e,t,r){return l(this,void 0,void 0,(function(){var n,o,a,s,c,d,v,m,b,w=this;return u(this,(function(k){switch(k.label){case 0:return n=this.mappings.getSnapshot(),o=t.CREATE.getActions(),a=t.MOVE.getActions(),s=e.MOVE.getActions(),c=e.UPDATE.getActions(),d=this.getTargetTree(r),v=this.getTargetTree(r===h.ItemLocation.LOCAL?h.ItemLocation.SERVER:h.ItemLocation.LOCAL),m=e.CREATE.getActions().concat(e.MOVE.getActions()).concat(t.CREATE.getActions()).concat(t.MOVE.getActions()),b={CREATE:new f.default,UPDATE:new f.default,MOVE:new f.default,REMOVE:new f.default,REORDER:new f.default},[4,g.each(e.CREATE.getActions(),(function(e){return l(w,void 0,void 0,(function(){var t,r,i=this;return u(this,(function(a){switch(a.label){case 0:return(t=o.find((function(t){return t.payload.parentId===y.default.mapParentId(n,e.payload,t.payload.location)&&e.payload.canMergeWith(t.payload)})))?(r=[],[4,new p.default(t.payload,e.payload,(function(e,t){return!(e.type!==t.type||!e.canMergeWith(t)||(r.push([e,t.id]),0))}),this.preserveOrder,!1,!1).run()]):[3,3];case 1:return a.sent(),r.push([t.payload,e.payload.id]),[4,g.each(r,(function(t){var r=t[0],n=t[1];return l(i,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.addMapping(e.payload.location===h.ItemLocation.LOCAL?this.localTree:this.server,r,n)];case 1:return t.sent(),[2]}}))}))}),1)];case 2:return a.sent(),[2];case 3:return b.CREATE.commit(e),[2]}}))}))}),12)];case 1:return k.sent(),[4,g.each(e.MOVE.getActions(),(function(e){return l(w,void 0,void 0,(function(){var t;return u(this,(function(o){return r===h.ItemLocation.LOCAL&&s.find((function(t){return e.payload.type===t.payload.type&&y.default.mappable(n,e.payload,t.payload)||"bookmark"===e.payload.type&&e.payload.canMergeWith(t.payload)}))?[2]:(t=a.filter((function(t){return f.default.findChain(n,m,v,e.payload,t)&&f.default.findChain(n,m,d,t.payload,e)}))).length?(r===h.ItemLocation.SERVER&&(t.forEach((function(t){var r=t.oldItem.cloneWithLocation(!1,e.payload.location),o=t.payload.cloneWithLocation(!1,e.oldItem.location);o.id=y.default.mapId(n,o,e.payload.location),o.parentId=y.default.mapParentId(n,o,e.payload.location),b.MOVE.getActions().find((function(e){return String(e.payload.id)===String(r.id)}))||s.find((function(e){return String(e.payload.id)===String(r.id)}))||b.MOVE.commit(i(i({},t),{payload:r,oldItem:o}))})),b.MOVE.commit(e)),[2]):(b.MOVE.commit(e),[2])}))}))}),12)];case 2:return k.sent(),[4,g.each(e.UPDATE.getActions(),(function(e){return l(w,void 0,void 0,(function(){return u(this,(function(t){return c.find((function(t){return e.payload.type===t.payload.type&&y.default.mappable(n,e.payload,t.payload)}))&&r===h.ItemLocation.LOCAL||b.UPDATE.commit(e),[2]}))}))}),12)];case 3:return k.sent(),[2,b]}}))}))},t.prototype.reconcileReorderings=function(t,r,n,o){return e.prototype.reconcileReorderings.call(this,t,r,n,o)},t.prototype.loadChildren=function(e){return l(this,void 0,void 0,(function(){var t;return u(this,(function(r){switch(r.label){case 0:return m.default.log("Merge strategy: Load complete tree from server"),t=e,[4,this.server.getBookmarksTree(!0)];case 1:return t.children=r.sent().children,[2]}}))}))},t.prototype.toJSON=function(){return i(i({},v.default.prototype.toJSON.apply(this)),{strategy:"merge"})},t}(v.default);t.default=b},10341:function(e,t){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.default={registry:{},register:function(e,t){this.registry[e]=t},factory:function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return"type"in e?[4,this.registry[e.type]()]:[3,2];case 1:return[2,new(t.sent())(e)];case 2:return[2]}}))}))},getDefaultValues:function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.registry[e]()];case 1:return t=n.sent(),[2,r(r({},t.getDefaultValues()),{enabled:!0})]}}))}))}}},15492:e=>{"use strict";e.exports=JSON.parse('{"web":{"client_id":"305459871054-4rr6n0jmsdvvprtjqbma5oeksshis2bn.apps.googleusercontent.com","project_id":"floccus-1613668481464","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_secret":"-2C9DALj2JYEGhZMZTvzN2ZE","redirect_uris":["https://mbepccofdnoepgicagpchfmafecckdam.chromiumapp.org/","https://76a380c4950986998208e7bb9dbd8fea94c91504.extensions.allizom.org/"]},"android":{"client_id":"305459871054-05e7kf9q9kkbeovaf380ldsb248psc2d.apps.googleusercontent.com","project_id":"floccus-1613668481464","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","redirect_uris":["urn:ietf:wg:oauth:2.0:oob","http://localhost"]},"ios":{"client_id":"305459871054-ovvunbhc8jf8g467gtpsbnap5el302gq.apps.googleusercontent.com"}}')},15879:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=l(r(10341)),d=l(r(29242)),h=r(2142),f=l(r(92444)),p=l(r(9872)),g=l(r(6221)),v=r(16546),y=r(47282),m=l(r(43376)),b=a(r(75186)),w=l(r(18465));u.default.register("linkwarden",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(58196))}))];case 1:return[2,e.sent().default]}}))}))})),u.default.register("nextcloud-folders",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(90910))}))];case 1:return[2,e.sent().default]}}))}))})),u.default.register("nextcloud-bookmarks",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(90910))}))];case 1:return[2,e.sent().default]}}))}))})),u.default.register("webdav",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(26452))}))];case 1:return[2,e.sent().default]}}))}))})),u.default.register("git",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(54765))}))];case 1:return[2,e.sent().default]}}))}))})),u.default.register("google-drive",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(42048))}))];case 1:return[2,e.sent().default]}}))}))})),u.default.register("fake",(function(){return s(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return a(r(89648))}))];case 1:return[2,e.sent().default]}}))}))}));var k=new w.default,E=function(){function e(e,t,r,n){this.server=r,this.id=e,this.storage=t,this.localTree=n,this.lockTimeout=72e5}return e.getAccountClass=function(){return s(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return this.singleton?[2,this.singleton]:"web"!==v.Capacitor.getPlatform()?[3,2]:(e=this,[4,Promise.resolve().then((function(){return a(r(28200))}))]);case 1:return e.singleton=n.sent().default,[3,4];case 2:return t=this,[4,Promise.resolve().then((function(){return a(r(23548))}))];case 3:t.singleton=n.sent().default,n.label=4;case 4:return[2,this.singleton]}}))}))},e.get=function(e){return s(this,void 0,void 0,(function(){var t;return c(this,(function(r){switch(r.label){case 0:return this.cache[e]?[4,this.cache[e].updateFromStorage()]:[3,2];case 1:return r.sent(),[2,this.cache[e]];case 2:return[4,this.getAccountClass()];case 3:return[4,r.sent().get(e)];case 4:return t=r.sent(),this.cache[e]=t,[2,t]}}))}))},e.create=function(e){return s(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.getAccountClass()];case 1:return[2,t.sent().create(e)]}}))}))},e.import=function(e){return s(this,void 0,void 0,(function(){var t,r,o;return c(this,(function(i){switch(i.label){case 0:t=0,r=e,i.label=1;case 1:return t<r.length?(o=r[t],[4,this.create(n(n({},o),{enabled:!1}))]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.export=function(t){return s(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,Promise.all(t.map((function(t){return e.get(t)})))];case 1:return[2,r.sent().map((function(e){return e.getData()}))]}}))}))},e.prototype.delete=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.storage.deleteAccountData()];case 1:return e.sent(),[2]}}))}))},e.prototype.getLabel=function(){return this.server.getLabel()},e.prototype.getData=function(){var e=n({localRoot:null,strategy:"default",syncInterval:15,nestedSync:!1,failsafe:!0,allowNetwork:!1,label:"",errorCount:0,clickCountEnabled:!1},this.server.getData());return"type"in e&&"nextcloud-folders"===e.type&&(e.type="nextcloud-bookmarks"),e},e.prototype.getResource=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.localTree]}))}))},e.prototype.getServer=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.server]}))}))},e.prototype.setData=function(e){return s(this,void 0,void 0,(function(){var t=this;return c(this,(function(r){switch(r.label){case 0:return[4,k.acquire(this.id,(function(){return s(t,void 0,void 0,(function(){var t;return c(this,(function(r){switch(r.label){case 0:return t=n(n({},this.server.getData()),e),[4,this.storage.setAccountData(t,null)];case 1:return r.sent(),this.server.setData(t),[2]}}))}))}))];case 1:return r.sent(),[2]}}))}))},e.prototype.updateFromStorage=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("Not implemented")}))}))},e.prototype.tracksBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r,n,o;return c(this,(function(i){switch(i.label){case 0:return[4,this.isInitialized()];case 1:return i.sent()?[4,this.storage.getMappings()]:[2,!1];case 2:return t=i.sent(),r=t.getSnapshot(),n=Object.keys(r.LocalToServer.bookmark).some((function(t){return String(e)===String(t)})),o=Object.keys(r.LocalToServer.folder).some((function(t){return String(e)===String(t)})),[2,n||o]}}))}))},e.prototype.init=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("Not implemented")}))}))},e.prototype.isInitialized=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){throw new Error("Not implemented")}))}))},e.prototype.sync=function(t,r){return void 0===r&&(r=!1),s(this,void 0,void 0,(function(){var o,i,a,l,u,v,m,w,k,E,S,O,I,T,_,L,P,A=this;return c(this,(function(C){switch(C.label){case 0:return C.trys.push([0,43,,52]),this.getData().syncing||this.syncing?[2]:[4,this.getResource()];case 1:return i=C.sent(),[4,this.server.isAvailable()];case 2:return(a=!C.sent())?[3,4]:[4,i.isAvailable()];case 3:a=!C.sent(),C.label=4;case 4:return a?[2]:(d.default.log("Starting sync process for account "+this.getLabel()),b.setUser({id:this.id}),this.syncing=!0,[4,this.setData({syncing:.05,scheduled:!1,error:null})]);case 5:return C.sent(),[4,this.isInitialized()];case 6:return C.sent()?[3,8]:[4,this.init()];case 7:C.sent(),C.label=8;case 8:if(!this.server.onSyncStart)return[3,21];l="slave"!==(t||this.getData().strategy),C.label=9;case 9:return C.trys.push([9,11,,19]),[4,this.server.onSyncStart(l,r)];case 10:return u=C.sent(),[3,19];case 11:return 37!==(v=C.sent()).code?[3,17]:this.getData().lastSync<Date.now()-this.lockTimeout||r?[4,this.server.onSyncStart(!1,!0)]:[3,13];case 12:return u=C.sent(),[3,16];case 13:return[4,this.setData({error:null,syncing:!1,scheduled:t||this.getData().strategy})];case 14:return C.sent(),this.syncing=!1,d.default.log("Resource is locked, trying again soon"),[4,d.default.persist()];case 15:return C.sent(),[2];case 16:return[3,18];case 17:throw v;case 18:return[3,19];case 19:return!1!==u?[3,21]:[4,this.init()];case 20:C.sent(),C.label=21;case 21:return[4,this.storage.getMappings()];case 22:return o=C.sent(),[4,this.storage.getCache()];case 23:return m=C.sent(),[4,this.storage.getCurrentContinuation()];case 24:if(null==(w=C.sent()))return[3,28];C.label=25;case 25:return C.trys.push([25,27,,28]),k=this,[4,g.default.fromJSON(o,i,this.server,(function(e,t){return s(A,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.progressCallback(e,t)];case 1:return r.sent(),[2]}}))}))}),w)];case 26:return k.syncProcess=C.sent(),[3,28];case 27:return C.sent(),w=null,d.default.log("Failed to load pending continuation. Continuing with normal sync"),[3,28];case 28:if(!(null==w||void 0!==t&&w.strategy!==t||Date.now()-w.createdAt>18e5))return[3,30];switch(E=void 0,S=void 0,t||this.getData().strategy){case"slave":d.default.log('Using "merge slave" strategy (no cache available)'),E=f.default,S=h.ItemLocation.LOCAL;break;case"overwrite":d.default.log('Using "merge overwrite" strategy (no cache available)'),E=f.default,S=h.ItemLocation.SERVER;break;default:m.children.length?(d.default.log('Using "default" strategy'),E=g.default):(d.default.log('Using "merge default" strategy (no cache available)'),E=p.default)}return this.syncProcess=new E(o,i,this.server,(function(e,t){return s(A,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.progressCallback(e,t)];case 1:return r.sent(),[2]}}))}))})),this.syncProcess.setCacheTree(m),S&&this.syncProcess.setDirection(S),[4,this.syncProcess.sync()];case 29:return C.sent(),[3,32];case 30:return d.default.log("Found existing persisted pending continuation. Resuming last sync"),[4,this.syncProcess.sync()];case 31:C.sent(),C.label=32;case 32:return[4,this.setData({scheduled:!1,syncing:1})];case 33:return C.sent(),[4,i.getBookmarksTree()];case 34:return O=C.sent().clone(!1),this.syncProcess.filterOutUnacceptedBookmarks(O),T=(I=this.syncProcess).filterOutUnmappedItems,_=[O],[4,o.getSnapshot()];case 35:return T.apply(I,_.concat([C.sent()])),[4,this.storage.setCache(O)];case 36:return C.sent(),this.server.onSyncComplete?[4,this.server.onSyncComplete()]:[3,38];case 37:C.sent(),C.label=38;case 38:return o?[4,o.persist()]:[3,40];case 39:C.sent(),C.label=40;case 40:return this.syncing=!1,[4,this.storage.setCurrentContinuation(null)];case 41:return C.sent(),[4,this.setData({error:null,errorCount:0,syncing:!1,scheduled:!1,lastSync:Date.now()})];case 42:return C.sent(),d.default.log("Successfully ended sync process for account "+this.getLabel()),[3,52];case 43:return L=C.sent(),console.log(L),[4,e.stringifyError(L)];case 44:return P=C.sent(),console.error("Syncing failed with",P),d.default.log("Syncing failed with",P),b.setContext("accountData",n(n({},this.getData()),{username:"SENSITIVEVALUEHIDDEN",password:"SENSITIVEVALUVALUEHIDDEN",passphrase:"SENSITIVEVALUVALUEHIDDEN"})),L.list?b.captureException(P):b.captureException(L),[4,this.setData({error:P,errorCount:this.getData().errorCount+1,syncing:!1,scheduled:!1})];case 45:return C.sent(),R(L,(function(e){return 27!==e.code&&(!y.isTest||26!==e.code)}))?[4,this.storage.setCurrentContinuation(null)]:[3,47];case 46:C.sent(),C.label=47;case 47:return this.syncing=!1,this.server.onSyncFail?[4,this.server.onSyncFail()]:[3,49];case 48:C.sent(),C.label=49;case 49:return R(L,(function(e){return 27!==e.code&&17!==e.code&&(!y.isTest||26!==e.code)}))?[4,this.init()]:[3,51];case 50:C.sent(),C.label=51;case 51:return[3,52];case 52:return[4,d.default.persist()];case 53:return C.sent(),[2]}}))}))},e.stringifyError=function(e){return s(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.getAccountClass()];case 1:return[2,t.sent().stringifyError(e)]}}))}))},e.prototype.cancelSync=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.syncing?(this.server.cancel(),this.syncProcess?[4,this.syncProcess.cancel()]:[3,2]):[2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.progressCallback=function(e,t){return s(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return this.syncing?[4,this.setData({syncing:e})]:[2];case 1:return r.sent(),this.syncProcess?!t||this.server instanceof m.default&&"onSyncComplete"in this.server?[3,4]:[4,this.storage.setCurrentContinuation(this.syncProcess.toJSON())]:[2];case 2:return r.sent(),[4,this.syncProcess.getMappingsInstance().persist()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.getAllAccounts=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this.getAccountClass()];case 1:return[2,e.sent().getAllAccounts()]}}))}))},e.getAccountsContainingLocalId=function(e,t,r){return s(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,this.getAccountClass()];case 1:return[2,n.sent().getAccountsContainingLocalId(e,t,r)]}}))}))},e.cache={},e}();function R(e,t){return t(e)&&e.list&&e.list.every((function(e){return R(e,t)}))}t.default=E},18033:e=>{"use strict";e.exports=JSON.parse('{"Error001":{"message":"E001: Folder to create in doesn\'t exist"},"Error002":{"message":"E002: Bookmark to update doesn\'t exist anymore"},"Error003":{"message":"E003: Folder to move out of doesn\'t exist. This is an anomaly. Congratulations."},"Error004":{"message":"E004: Folder to move into doesn\'t exist"},"Error005":{"message":"E005: Folder to create in doesn\'t exist"},"Error006":{"message":"E006: Folder to update doesn\'t exist"},"Error007":{"message":"E007: Folder to move doesn\'t exist"},"Error008":{"message":"E008: Folder to move out of doesn\'t exist"},"Error009":{"message":"E009: Folder to move into doesn\'t exist"},"Error010":{"message":"E010: Could not find folder to order"},"Error011":{"message":"E011: Item in folder ordering is not an actual child: {0}"},"Error012":{"message":"E012: Folder ordering is missing some of the folder\'s children"},"Error013":{"message":"E013: Folder to remove doesn\'t exist"},"Error014":{"message":"E014: Parent folder to remove folder from of doesn\'t exist"},"Error015":{"message":"E015: Unexpected response data from server"},"Error016":{"message":"E016: Request timed out. Check your server configuration"},"Error017":{"message":"E017: Network error: Check your network connection and your account details"},"Error018":{"message":"E018: Couldn\'t authenticate with the server."},"Error019":{"message":"E019: HTTP status {0}. Failed {1} request. Check your server configuration and log."},"Error020":{"message":"E020: Could not parse server response. Is the bookmarks app installed on your server?"},"Error021":{"message":"E021: Inconsistent server state. Folder is present in childorder list but not in folder tree"},"Error022":{"message":"E022: Folder {0} supposedly contains non-existent bookmark {1}"},"Error023":{"message":"E023: Unable to clear lock file, consider deleting {0} manually."},"Error024":{"message":"E024: HTTP status {0} while trying to determine status of lock file {1}"},"Error025":{"message":"E025: Bookmarks file setting mustn\'t begin with a slash: \'/\'"},"Error026":{"message":"E026: Sync process was cancelled"},"Error027":{"message":"E027: Sync process was interrupted"},"Error028":{"message":"E028: Couldn\'t authenticate with the server."},"Error029":{"message":"E029: Failsafe: The current sync run would delete {0}% of your bookmarks. Refusing to execute. Disable this failsafe in the account settings if you want to proceed anyway."},"Error030":{"message":"E030: Failed to decrypt bookmarks file. The passphrase may be wrong or the file may be corrupted."},"Error031":{"message":"E031: Could not authenticate with Google Drive. Please connect floccus with your Google account again."},"Error032":{"message":"E032: OAuth error. Token validation error. Please reconnect your Google Account."},"Error033":{"message":"E033: Redirect detected. Please make sure the server supports the selected sync method and URL you entered is correct doesn\'t redirect to a different location. If the redirect is part of your setup, you can disable this check in the settings."},"Error034":{"message":"E034: Remote bookmarks file is unreadable. Perhaps you forgot to set an encryption passphrase, or you set the wrong file format."},"Error035":{"message":"E035: Failed to create the following bookmark on the server: {0}"},"Error036":{"message":"E036: Missing permissions to access the sync server"},"Error037":{"message":"E037: Resource is locked"},"Error038":{"message":"E038: Could not find local folder"},"Error039":{"message":"E039: Failed to update the following bookmark on the server: {0}"},"Error040":{"message":"E040: Could not search for your file name in your Google Drive"},"LabelWebdavurl":{"message":"WebDAV URL"},"DescriptionWebdavurl":{"message":"e.g. with nextcloud: https://example.com/remote.php/webdav/"},"LabelNextcloudurl":{"message":"Nextcloud URL"},"LabelUsername":{"message":"Username"},"LabelPassword":{"message":"Password"},"LabelBookmarksfile":{"message":"Bookmarks file"},"DescriptionBookmarksfile":{"message":"a path to the bookmarks file relative to your WebDAV URL (all folders in the path must already exist). e.g. personal_stuff/bookmarks.xbel"},"DescriptionBookmarksfilegoogle":{"message":"the file name of the bookmarks file that will reside in your Google Drive. Do not enter the full file path, only the file name. Make sure this name is unique in your Drive."},"DescriptionBookmarksfilegit":{"message":"a path to the bookmarks file relative to your Git repository root (all folders in the path must already exist). e.g. personal_stuff/bookmarks.xbel"},"LabelServerfolder":{"message":"Server target"},"DescriptionServerfolder":{"message":"When syncing, your bookmarks in this browser will be stored as links under this path on the server. Note, that this path represents a folder in the Nextcloud Bookmarks app, not a folder in Nextcloud Files. Leave this empty to just put all links in the topmost folder on the server."},"DescriptionServerfolderlinkwarden":{"message":"When syncing, your bookmarks in this browser will be stored as links under this collection."},"LabelLocaltarget":{"message":"Local target"},"DescriptionLocaltarget":{"message":"Choose here, whether you want to sync browser bookmarks, or browser tabs."},"LabelLocalfolder":{"message":"Bookmarks folder"},"DescriptionLocalfolder":{"message":"Bookmarks in this bookmarks folder will be stored as links on the server and links on the server will be stored as bookmarks in this bookmarks folder in this browser."},"LabelRootfolder":{"message":"Root folder"},"LabelNewfolder":{"message":"Newly created folder"},"LabelOptions":{"message":"Options"},"LabelSyncnow":{"message":"Sync now"},"LabelCancelsync":{"message":"Cancel sync"},"LabelSyncall":{"message":"Sync all profiles"},"LabelAutosync":{"message":"Auto-sync"},"StatusLastsynced":{"message":"Last synchronized: {0} ago"},"StatusNeversynced":{"message":"Not synchronized, yet"},"StatusAllgood":{"message":"All good"},"StatusDisabled":{"message":"Disabled"},"StatusError":{"message":"Error"},"StatusSyncing":{"message":"Syncing"},"StatusScheduled":{"message":"Scheduled"},"LabelReset":{"message":"Reset"},"DescriptionReset":{"message":"Reset synchronized folder to create a new one"},"LabelChoosefolder":{"message":"Choose a folder"},"DescriptionChoosefolder":{"message":"Set an existing folder to sync"},"LabelRemoveaccount":{"message":"Remove profile"},"DescriptionRemoveaccount":{"message":"Delete this profile (this will not remove your bookmarks)"},"LabelSyncfromscratch":{"message":"Trigger sync from scratch"},"LabelResetCache":{"message":"Reset cache"},"DescriptionResetcache":{"message":"Click this button to reset the cache so that the next synchronization run is guaranteed not to delete any data and merely merges server and local bookmarks together"},"LabelParallelsync":{"message":"Speed up synchronization"},"DescriptionParallelsync":{"message":"Tick this box to process multiple folders in parallel in order to speed the synchronization. This feature is experimental and makes it harder to read the debug logs."},"LabelStrategy":{"message":"Synchronization strategy"},"DescriptionStrategy":{"message":"This option determines how to synchronize the bookmarks on different devices. Usually you will want to keep changes from all sides if they are compatible, but sometimes you might want to overwrite changes (including additions and deletions) from other browsers, or overwrite changes you made locally."},"LabelStrategydefault":{"message":"Always merge local changes with changes from other browsers (recommended)"},"LabelStrategyslave":{"message":"Always undo local changes and download changes from other browsers"},"LabelStrategyoverwrite":{"message":"Always upload local changes and undo changes from other browsers"},"LabelSave":{"message":"Save"},"LabelCancel":{"message":"Cancel"},"LabelAdd":{"message":"Add"},"LabelChange":{"message":"Change"},"LabelRemove":{"message":"Remove"},"LabelBack":{"message":"Back"},"LabelAdapternextcloudfolders":{"message":"Nextcloud Bookmarks"},"DescriptionAdapternextcloudfolders":{"message":"Sync your bookmarks with the open-source Bookmarks app for Nextcloud (an open-source collaboration platform that you can either self-host or get an account for an instance in the cloud from one of the various hosters). With Nextcloud Bookmarks you can only sync http, ftp and javascript bookmarks. Make sure you have installed the Bookmarks app from the Nextcloud app store in your Nextcloud. This option cannot make use of end-to-end encryption."},"LabelAdapternextcloud":{"message":"Nextcloud Bookmarks (legacy)"},"DescriptionAdapternextcloud":{"message":"The legacy option is compatible with at least version v0.11 of the Bookmarks app. It will emulate folders using tags containing the folder path. It is not recommended to use this for new profiles."},"LabelAdapterwebdav":{"message":"WebDAV share"},"DescriptionAdapterwebdav":{"message":"Sync your bookmarks by storing them in a file in the provided WebDAV share. There is no accompanying web UI for this option and you can use it with any WebDAV-compatible server, either selfhosted or in the cloud. It can sync http, ftp, data, file and javascript bookmarks. You can choose to use end-to-end encryption when using this option."},"LabelAddaccount":{"message":"Add profile"},"LabelOpenintab":{"message":"Open in tab"},"LabelDebuglogs":{"message":"Debug logs"},"LabelFunddevelopment":{"message":"💸 Fund development"},"DescriptionFunddevelopment":{"message":"Work on floccus is fuelled by a voluntary subscription model. If you think what I do is worthwhile, and if you can spare a few coins each month without hardship, please support my work. Also, please consider giving floccus a rating on the addon store of your choice. Thank you!💙"},"LabelSelect":{"message":"Select"},"LabelUntitledfolder":{"message":"Untitled folder"},"LabelSetkeybutton":{"message":"Set passphrase"},"LabelKey":{"message":"Enter your unlock passphrase"},"LabelKey2":{"message":"Enter your passphrase a second time"},"LabelUnlock":{"message":"Unlock floccus"},"LabelRemovekey":{"message":"Remove passphrase"},"LabelRemovedkey":{"message":"Passphrase removed"},"LabelSyncinterval":{"message":"Synchronization interval"},"DescriptionSyncinterval":{"message":"The timespan between two sync runs in minutes. Default is 15 minutes."},"LabelChooseadapter":{"message":"How do you want to sync?"},"LabelOptionsscreen":{"message":"{0} options","description":"Title of the options screen. The placeholder holds the profile type."},"LabelPaypal":{"message":"Paypal"},"DescriptionPaypal":{"message":"Make a one-time or regular donation via paypal to support the project"},"LabelOpencollective":{"message":"OpenCollective"},"DescriptionOpencollective":{"message":"Make a regular donation via OpenCollective to support the project"},"LabelLiberapay":{"message":"Liberapay"},"DescriptionLiberapay":{"message":"Make a regular donation via Liberapay to support the project"},"LabelGithubsponsors":{"message":"GitHub sponsors"},"DescriptionGithubsponsors":{"message":"Make a regular donation via GitHub sponsors to support the project"},"LabelPatreon":{"message":"Patreon"},"DescriptionPatreon":{"message":"Make a regular donation via Patreon to support the project"},"LabelKofi":{"message":"Kofi"},"DescriptionKofi":{"message":"Make a regular or one-time donation via Ko-fi to support the project"},"LegacyAdapterDeprecation":{"message":"This legacy profile type is deprecated and will soon be removed. Please switch to the new nextcloud sync method. Improved performance and accuracy await you."},"LabelUpdated":{"message":"⚡ Floccus was updated"},"DescriptionUpdated":{"message":"Congrats, the latest update of floccus has arrived on your machine!"},"LabelReleaseNotes":{"message":"Read release notes"},"LabelOptionsServerDetails":{"message":"Server details"},"LabelOptionsFolderMapping":{"message":"Folder mapping"},"LabelOptionsSyncBehavior":{"message":"Sync behavior"},"LabelOptionsDangerous":{"message":"Dangerous actions"},"LabelAccountDeleted":{"message":"Profile deleted"},"DescriptionAccountDeleted":{"message":"This profile was deleted"},"LabelNoAccount":{"message":"No profiles yet"},"DescriptionNoAccount":{"message":"Add new profiles, or import profiles from a file, then you can begin syncing."},"LabelLoginFlowStart":{"message":"Sign in with Nextcloud"},"LabelLoginFlowStop":{"message":"Abort Nextcloud login"},"LabelLoginFlowError":{"message":"Nextcloud login failed"},"LabelNewAccount":{"message":"Add Profile"},"LabelNewImport":{"message":"Import"},"LabelNestedSync":{"message":"Nested profiles"},"DescriptionNestedSync":{"message":"You can nest profiles so that a parent folder belongs to profile A and a sub folder to profile A and B. Do you want to allow other profiles to sync this profile\'s folder as well?"},"LabelNestedSyncNo":{"message":"No, ignore this profile\'s folder in other profiles"},"LabelNestedSyncYes":{"message":"Yes, include this profile\'s folder in other profiles"},"LabelImportExport":{"message":"Import/Export Profiles"},"LabelExport":{"message":"Export profiles"},"LabelImport":{"message":"Import profiles"},"DescriptionExport":{"message":"Select profiles below that you would like to export to a file, so you can easily re-create the same profiles on a different device or browser."},"DescriptionImport":{"message":"Import a file with exported profiles here to re-create profiles exported on a different device or browser. Please make sure to set the correct sync folders again after importing."},"LabelFolderNotFound":{"message":"Folder not found"},"LabelSyncTabs":{"message":"Browser tabs"},"DescriptionSyncTabs":{"message":"Links that are stored on the server will be opened as browser tabs in your browser and existing open browser tabs are stored as links on your server. Note that depending how many links are stored on the server, since they will all be opened as tabs on the next sync run, this may possibly overwhelm your browser."},"LabelTabs":{"message":"Tabs"},"LabelSyncDown":{"message":"Pull down"},"DescriptionSyncDown":{"message":"Download changes from other browsers & overwrite local changes"},"LabelSyncUp":{"message":"Push up"},"DescriptionSyncUp":{"message":"Upload local changes & overwrite changes from other browsers"},"LabelSyncDownOnce":{"message":"Pull down once"},"LabelSyncUpOnce":{"message":"Push up once"},"LabelSyncNormal":{"message":"Merge"},"DescriptionSyncNormal":{"message":"Merge local changes with changes from other browsers"},"DescriptionFilesPermission":{"message":"Make sure you give floccus permission to not only use the bookmarks app but the Nextcloud files app as well."},"DescriptionExtension":{"message":"Sync your bookmarks privately across browsers and devices"},"LabelFailsafe":{"message":"Failsafe"},"DescriptionFailsafe":{"message":"Sometimes configuration errors or software bugs can cause the unintended removal of data, which is then lost. To prevent that from happening, floccus will not delete more than 50% of your bookmarks in one go unless you disable this failsafe here."},"LabelFailsafeon":{"message":"Enabled. Don\'t delete more than 50% of my local bookmarks without asking me first. (Recommended)"},"LabelFailsafeoff":{"message":"Disabled. Allow the removal of more than 50% of my local bookmarks without confirming with me."},"StatusFailsafeoff":{"message":"Failsafe disabled. You are at risk for unintended data loss. It is recommended to enable the failsafe in the profile settings."},"LabelAdaptergoogledrive":{"message":"Google Drive"},"DescriptionAdaptergoogledrive":{"message":"Sync bookmarks via an (optionally encrypted) file that is stored in your Google Drive. It can sync http, ftp, data, file and javascript bookmarks. You can choose to use end-to-end encryption when using this option."},"LabelLogingoogle":{"message":"Login with Google"},"DescriptionLogingoogle":{"message":"Connect your Google account to store the bookmark sync file in your Google Drive."},"DescriptionLoggedingoogle":{"message":"You have connected your Google account to store the bookmark sync file in your Google Drive."},"LabelPassphrase":{"message":"Passphrase"},"DescriptionPassphrase":{"message":"Set a passphrase for encrypting your bookmarks file, if you set no passphrase, no encryption will be run."},"LabelClientcert":{"message":"Send client credentials"},"DescriptionClientcert":{"message":"Enable this option if your server requires a client certificate or cookies for authentication. This may cause unintended side effects, as floccus will share cookies with your normal browser sessions."},"LabelAllowredirects":{"message":"Allow redirects in Server URL"},"DescriptionAllowredirects":{"message":"Enable this option, if you get redirect errors during syncing, which you believe to be unwarranted."},"LabelSearch":{"message":"Search bookmarks"},"LabelSearchfolder":{"message":"Search {0}"},"LabelEdititem":{"message":"Edit"},"LabelDeleteitem":{"message":"Delete"},"DescriptionReallydeleteitem":{"message":"Do you really want to delete this item?"},"LabelNobookmarks":{"message":"No bookmarks here"},"LabelAddbookmark":{"message":"Add bookmark"},"LabelEditbookmark":{"message":"Edit bookmark"},"LabelAddfolder":{"message":"Add folder"},"LabelEditfolder":{"message":"Edit folder"},"LabelSlugline":{"message":"Private Bookmark Sync"},"LabelDownloadlogs":{"message":"Download logs"},"LabelDownloadfulllogs":{"message":"Full logs"},"LabelDownloadanonymizedlogs":{"message":"Redacted logs"},"DescriptionDownloadlogs":{"message":"Floccus logs all its actions in a log file that you can examine yourself or send to the developers for debugging purposes. In redacted logs, folder and bookmark names as well as URLs are irreversibly encoded using a cryptographic hashing function. When sending redacted logs, make sure to still check the downloaded file for sensitive data that might not have been caught by the anonymization process."},"ErrorFolderloopselected":{"message":"Cannot move a folder into itself"},"ErrorNofolderselected":{"message":"No folder selected"},"LabelAllownetwork":{"message":"Allow network usage"},"DescriptionAllownetwork":{"message":"Floccus can use the network apart from connecting to your sync server, to obtain additional information about your bookmarks (like icons, etc.). Here you can enable such network usage."},"LabelMobilesettings":{"message":"Mobile settings"},"LabelContinuefloccus":{"message":"Continue to floccus"},"LabelAbout":{"message":"About"},"LabelCurrentversion":{"message":"Current version"},"DescriptionCurrentversion":{"message":"Your currently installed version of floccus is:"},"LabelContributors":{"message":"Contributors"},"DescriptionContributors":{"message":"These people have helped make floccus possible"},"LabelSortcustom":{"message":"Custom"},"LabelSorturl":{"message":"Link"},"LabelSorttitle":{"message":"Title"},"LabelSyncmethod":{"message":"Sync method"},"LabelSyncserver":{"message":"Sync server"},"LabelSyncfolders":{"message":"Sync folders"},"LabelSyncbehavior":{"message":"Sync behavior"},"LabelContinue":{"message":"Continue"},"LabelDone":{"message":"Done"},"LabelConnect":{"message":"Connect"},"LabelServersetup":{"message":"Which server do you want to sync to?"},"LabelGoogledrivesetup":{"message":"Login to Google Drive"},"LabelSyncfoldersetup":{"message":"Which Folders do you want to sync?"},"LabelSyncbehaviorsetup":{"message":"How do you want syncing to work?"},"LabelAccountcreated":{"message":"Profile created"},"DescriptionAccountcreated":{"message":"Your profile has been created. You can close this tab now."},"DescriptionNonhttps":{"message":"You have entered a server that uses an insecure protocol. It is recommended to only use servers with support for HTTPS."},"LabelFiletype":{"message":"File format"},"DescriptionFiletype":{"message":"You can choose which file format you want to use to store bookmarks in the cloud."},"LabelFiletypehtml":{"message":"HTML, a widely supported, open format (experimental)"},"LabelFiletypexbel":{"message":"XBEL, a simple, open format"},"LabelImportbookmarks":{"message":"Import bookmarks"},"DescriptionImportbookmarks":{"message":"Import a HTML file containing bookmarks into the current folder"},"LabelExportBookmarks":{"message":"Export Bookmarks"},"DescriptionExportBookmarks":{"message":"You can export all bookmarks in this profile as a HTML file compatible with all major browsers."},"LabelShareitem":{"message":"Share"},"LabelImportsuccessful":{"message":"Successfully imported profile(s)"},"DescriptionSyncinprogress":{"message":"Synchronization in progress."},"DescriptionSyncscheduled":{"message":"This profile will be synced soon. We\'re either waiting for other devices of yours, or other profiles on this device, to finish syncing."},"LabelAdaptergit":{"message":"Git over HTTPS"},"DescriptionAdaptergit":{"message":"The Git option syncs your bookmarks by storing them in a file in the provided Git repository. There is no accompanying web UI for this option, but you can use it with any Git hosting server, like Github, Gitlab, Gitea, etc. It can sync http, ftp, data, file and javascript bookmarks. You can not make use of end-to-end encryption when using this option."},"LabelGiturl":{"message":"Repository URL using HTTP"},"LabelGitbranch":{"message":"Git branch"},"LabelTelemetry":{"message":"🐛 Automated Error Reporting"},"DescriptionTelemetry":{"message":"Floccus can automatically send error data to me, the developer. This is a tremendous help for discovering and resolving bugs in floccus more quickly and will help improve your experience with floccus in the long run. Even when error reporting is enabled, the floccus developers will never be able to see your bookmarks."},"LabelTelemetryenable":{"message":"Automatically send error data to floccus developers"},"LabelTelemetrydisable":{"message":"Do not send error data to floccus developers"},"LabelAccountlabel":{"message":"Profile label"},"DescriptionAccountlabel":{"message":"Give this profile a name so you can recognize it more easily"},"LabelClickcount":{"message":"Count clicks"},"DescriptionClickcount":{"message":"Send statistics about which bookmarks you visit the most to your Nextcloud server, so you can sort by number of clicks"},"DescriptionGoogleplayreview":{"message":"Write a review on Google Play"},"DescriptionAppstorereview":{"message":"Write a review on the App Store"},"DescriptionChromereview":{"message":"Write a review on the Chrome WebStore"},"DescriptionAlternativereview":{"message":"Write a review on AlternativeTo.net"},"DescriptionMozillareview":{"message":"Write a review on Mozilla Addons"},"DescriptionEdgereview":{"message":"Write a review on Edge Addons"},"LabelWritereview":{"message":"💙 Share the love!"},"DescriptionWritereview":{"message":"If you\'re excited about floccus, let the world know by leaving a rating on one of the platforms below."},"DescriptionDonateintervention":{"message":"Love Bookmark Syncing? Support me!"},"LabelDonate":{"message":"Donate"},"DescriptionDisabledaftererror":{"message":"Retried 10 times before disabling this profile"},"DescriptionBookmarkexists":{"message":"This bookmark exists already in the selected profile"},"LabelReportproblem":{"message":"Report problem"},"DescriptionReportproblem":{"message":"If you would like to directly contact the developers with a concrete issue, you can do so here:"},"LabelAdapterlinkwarden":{"message":"Linkwarden"},"DescriptionAdapterlinkwarden":{"message":"Sync your bookmarks with the open-source Linkwarden app, either hosted on your own server or in the cloud at cloud.linkwarden.app. It can only sync http, ftp and javascript bookmarks. This option cannot make use of end-to-end encryption."},"LabelLinkwardenurl":{"message":"The URL of your Linkwarden server"},"LabelAccesstoken":{"message":"Access token"},"LabelLinkwardenconnectionerror":{"message":"Failed to connect to your Linkwarden server"},"LabelSearchresultsotherfolders":{"message":"Results from other folders"},"LabelScheduledforcesync":{"message":"Force sync"},"DescriptionScheduledforcesync":{"message":"Do you really want to force sync? Syncing with two devices at the same time can have unforeseen consequences including corruption of your data. Make sure that no other device is syncing at the moment before confirming."},"DescriptionAutosync":{"message":"Turning on automatic sync will make sure a sync run is triggered regularly within a certain configurable interval as well as on demand a few seconds after you make changes. If you don\'t turn on automatic sync you will need to trigger sync runs manually by pressing the sync button."},"LabelOpeninnewtab":{"message":"Open this view in a new tab"}}')},21406:(e,t,r)=>{"use strict";r.d(t,{A:()=>n}),r(23792),r(3362),r(48140),r(28845),r(373),r(98992),r(81454),r(47350),r(91706),r(96847),r(23241),r(55871);class n{static async sha256(e){const t=new TextEncoder("utf-8").encode(e),r=await crypto.subtle.digest("SHA-256",t);return this.bufferToHexstr(r)}static bufferToHexstr(e){return Array.from(new Uint8Array(e)).map((e=>("00"+e.toString(16)).slice(-2))).join("")}static hexstrToBuffer(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t}static async prepareKey(e){const t=await crypto.subtle.digest("SHA-256",new TextEncoder("utf-8").encode(e));return await crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!1,["decrypt","encrypt"])}static async decryptAES(e,t,r){return(new TextDecoder).decode(await crypto.subtle.decrypt({name:"AES-CBC",iv:Uint8Array.from(n.iv)},await this.prepareKey(e),this.hexstrToBuffer(r)))}static async encryptAES(e,t,r){return this.bufferToHexstr(await crypto.subtle.encrypt({name:"AES-CBC",iv:Uint8Array.from(n.iv)},await this.prepareKey(e),(new TextEncoder).encode(r)))}static getRandomBytes(e){let t=new Int8Array(e);return crypto.getRandomValues(t),t}}n.iv=[58,14,9,204,174,93,77,98,12,248,11,160,143,24,119,20]},21509:(e,t,r)=>{var n={"./cs/messages.json":[25974,974],"./de/messages.json":[72805,805],"./en/messages.json":[18033],"./es/messages.json":[77772,772],"./fi/messages.json":[83283,283],"./fr/messages.json":[28488,488],"./gl/messages.json":[17925,925],"./ja/messages.json":[75591,591],"./ko_KR/messages.json":[89080,80],"./nl_NL/messages.json":[50165,165],"./pl/messages.json":[81024,24],"./pt/messages.json":[12120,120],"./pt_BR/messages.json":[88193,193],"./ru/messages.json":[18995,995],"./sv/messages.json":[50787,787],"./tr/messages.json":[1562,562],"./tr_TR/messages.json":[25457,457],"./zh/messages.json":[48214,214],"./zh_CN/messages.json":[52088,88],"./zh_TW/messages.json":[64624,624]};function o(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],o=t[0];return Promise.all(t.slice(1).map(r.e)).then((()=>r(o)))}o.keys=()=>Object.keys(n),o.id=21509,e.exports=o},23548:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=s(r(60563)),l=s(r(33023)),u=s(r(10341)),d=s(r(15879)),h=r(94780),f=s(r(29242)),p=r(5e3),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.get=function(e){return i(this,void 0,void 0,(function(){var r,n,o,i,s;return a(this,(function(a){switch(a.label){case 0:return[4,(r=new c.default(e)).getAccountData(null)];case 1:return n=a.sent(),[4,(o=new l.default(r)).load()];case 2:return a.sent(),i=t.bind,s=[void 0,e,r],[4,u.default.factory(n)];case 3:return[2,new(i.apply(t,s.concat([a.sent(),o])))]}}))}))},t.create=function(e){return i(this,void 0,void 0,(function(){var r,n,o,i;return a(this,(function(a){switch(a.label){case 0:return r=""+Date.now()+Math.random(),[4,u.default.factory(e)];case 1:return n=a.sent(),[4,(o=new c.default(r)).setAccountData(e,null)];case 2:return a.sent(),[4,(i=new l.default(o)).load()];case 3:return a.sent(),[2,new t(r,o,n,i)]}}))}))},t.prototype.init=function(){return i(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return console.log("initializing account "+this.id),[4,this.storage.initMappings()];case 1:return t.sent(),[4,this.storage.initCache()];case 2:return t.sent(),[4,(e=new l.default(this.storage)).load()];case 3:return t.sent(),this.localTree=e,[2]}}))}))},t.prototype.isInitialized=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){try{return[2,Boolean(c.default.getEntry("bookmarks[".concat(this.storage.accountId,"].mappings")))]}catch(e){return console.log("Apparently not initialized, because:",e),[2,!1]}return[2]}))}))},t.prototype.updateFromStorage=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},t.stringifyError=function(e){return i(this,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return e instanceof h.UnknownFolderItemOrderError||e instanceof h.MissingItemOrderError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.item])]:e instanceof h.HttpError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.status,e.method])]:e instanceof h.ParseResponseError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"))+"\n"+e.response]:e instanceof h.InconsistentBookmarksExistenceError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.folder,e.bookmark])]:e instanceof h.LockFileError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.status,e.lockFile])]:e instanceof h.FailsafeError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.percent])]:e instanceof h.CreateBookmarkError||e instanceof h.UpdateBookmarkError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.bookmark.inspect()])]:e instanceof h.FloccusError?[2,p.i18n.getMessage("Error"+String(e.code).padStart(3,"0"))]:e.list?[4,Promise.all(e.list.map((function(e){return f.default.log(e),t.stringifyError(e)})))]:[3,2];case 1:return[2,r.sent().join("\n")];case 2:return[2,e.message]}}))}))},t.getAllAccounts=function(){return i(this,void 0,void 0,(function(){var e,t;return a(this,(function(r){switch(r.label){case 0:return t=(e=Promise).all,[4,c.default.getAllAccounts()];case 1:return[2,t.apply(e,[r.sent().map((function(e){return d.default.get(e)}))])]}}))}))},t}(d.default);t.default=g},26452:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t},l=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=d(r(43376)),f=d(r(45387)),p=d(r(29242)),g=r(8127),v=d(r(3363)),y=r(94780),m=r(16546),b=r(16546),w=d(r(91557)),k=function(e){function t(t){var r=e.call(this,t)||this;return r.server=t,r.locked=!1,r.ended=!0,r.lockingInterval=null,r}return o(t,e),t.getDefaultValues=function(){return{type:"webdav",url:"https://example.org/",username:"bob",password:"s3cret",bookmark_file:"bookmarks.xbel",bookmark_file_type:"xbel",includeCredentials:!1,allowRedirects:!1,passphrase:"",allowNetwork:!1}},t.prototype.getData=function(){return i(i({},t.getDefaultValues()),this.server)},t.prototype.normalizeServerURL=function(e){var t=new URL(e);t.pathname||(t.pathname=""),t.search="",t.hash="";var r=t.toString();return r+("/"!==r[r.length-1]?"/":"")},t.prototype.cancel=function(){this.abortController.abort(),this.cancelCallback&&this.cancelCallback()},t.prototype.getBookmarkURL=function(){return this.normalizeServerURL(this.server.url)+this.server.bookmark_file},t.prototype.getBookmarkLockURL=function(){return this.getBookmarkURL()+".lock"},t.prototype.checkLock=function(){return l(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return e=this.getBookmarkLockURL(),p.default.log(e),[4,this.downloadFile(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.timeout=function(e){var t=this;return new Promise((function(r,n){setTimeout(r,e),t.cancelCallback=function(){return n(new y.CancelledSyncError)}}))},t.prototype.obtainLock=function(){return l(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.checkLock()];case 1:if(200===(e=t.sent()).status){if(!e.headers["Last-Modified"])throw new y.ResourceLockedError;if(new Date(e.headers["Last-Modified"]).valueOf()+9e5>Date.now())throw new y.ResourceLockedError}return 200!==e.status?[3,2]:(this.locked=!0,[3,5]);case 2:return 404!==e.status?[3,4]:[4,this.setLock()];case 3:return t.sent(),[3,5];case 4:throw new y.LockFileError(e.status,this.server.bookmark_file+".lock");case 5:return[2]}}))}))},t.prototype.setLock=function(){return l(this,void 0,void 0,(function(){var e,t;return u(this,(function(r){switch(r.label){case 0:e=this.getBookmarkLockURL(),p.default.log("Setting lock: "+e),this.lockingPromise=this.uploadFile(e,"text/html","<html><body>I am a lock file</body></html>"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.lockingPromise];case 2:return r.sent(),[3,4];case 3:if((t=r.sent())instanceof y.HttpError&&(423===t.status||409===t.status))throw this.locked=!1,new y.ResourceLockedError;throw t;case 4:return this.locked=!0,[2]}}))}))},t.prototype.freeLock=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o,a,s;return u(this,(function(c){switch(c.label){case 0:if(!this.lockingPromise)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.lockingPromise];case 2:return c.sent(),[3,4];case 3:return e=c.sent(),console.warn(e),[3,4];case 4:if(!this.locked)return[2];t=this.getBookmarkLockURL(),r=g.Base64.encode(this.server.username+":"+this.server.password),a=0,c.label=5;case 5:c.trys.push([5,15,,16]),c.label=6;case 6:return p.default.log("Freeing lock: "+t),"web"!==b.Capacitor.getPlatform()?[3,8]:[4,fetch(t,i({method:"DELETE",credentials:"omit",headers:{Authorization:"Basic "+r},signal:this.abortSignal},!this.server.allowRedirects&&{redirect:"manual"}))];case 7:return n=c.sent(),[3,10];case 8:return[4,m.CapacitorHttp.request({url:t,method:"DELETE",headers:{Authorization:"Basic "+r},webFetchExtra:{credentials:"omit"}})];case 9:n=c.sent(),c.label=10;case 10:return(o=200===n.status||204===n.status||404===n.status)?[3,12]:[4,this.timeout(1e3)];case 11:c.sent(),c.label=12;case 12:a++,c.label=13;case 13:if(!o&&a<10)return[3,6];c.label=14;case 14:return[2,o];case 15:return s=c.sent(),p.default.log("Error Caught"),p.default.log(s),[3,16];case 16:return[2]}}))}))},t.prototype.pullFromServer=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o,i,a,s,c,l;return u(this,(function(u){switch(u.label){case 0:return e=this.getBookmarkURL(),[4,this.downloadFile(e)];case 1:if(401===(t=u.sent()).status)throw new y.AuthenticationError;if(404===t.status)return this.resetCache(),[2,t];if(200!==t.status)return[3,10];if(r=t.data,!this.server.passphrase)return[3,9];u.label=2;case 2:u.trys.push([2,8,,9]),u.label=3;case 3:return u.trys.push([3,5,,7]),n=JSON.parse(r),[4,v.default.decryptAES(this.server.passphrase,n.ciphertext,n.salt)];case 4:return r=u.sent(),[3,7];case 5:return u.sent(),[4,v.default.decryptAES(this.server.passphrase,r,this.server.bookmark_file)];case 6:return r=u.sent(),[3,7];case 7:return[3,9];case 8:if(u.sent(),!r||!r.includes('<?xml version="1.0" encoding="UTF-8"?>')&&!r.includes("<!DOCTYPE NETSCAPE-Bookmark-file-1>"))throw new y.DecryptionError;return[3,9];case 9:if(!r||!r.includes('<?xml version="1.0" encoding="UTF-8"?>')&&!r.includes("<!DOCTYPE NETSCAPE-Bookmark-file-1>"))throw new y.FileUnreadableError;for(o=r.split("\n"),i=0,a=o;i<a.length;i++)if((s=a[i]).indexOf("\x3c!--- highestId :")>=0){c=s.indexOf(":")+1,l=s.lastIndexOf(":"),this.highestId=parseInt(s.substring(c,l));break}switch(this.server.bookmark_file_type){case"xbel":if(!r.includes('<?xml version="1.0" encoding="UTF-8"?>'))throw new y.FileUnreadableError;this.bookmarksCache=f.default.deserialize(r);break;case"html":if(!r.includes("<!DOCTYPE NETSCAPE-Bookmark-file-1>"))throw new y.FileUnreadableError;this.bookmarksCache=w.default.deserialize(r);break;default:throw new Error("Invalid bookmark file type")}u.label=10;case 10:return[2,t]}}))}))},t.prototype.onSyncStart=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n,o,i,a,s,l,d=this;return u(this,(function(u){switch(u.label){case 0:return p.default.log("onSyncStart: begin"),this.ended=!1,"web"!==b.Capacitor.getPlatform()?[3,6]:[4,Promise.resolve().then((function(){return c(r(7737))}))];case 1:n=u.sent().default,o=void 0,i=!1,u.label=2;case 2:return u.trys.push([2,4,,5]),[4,n.permissions.contains({origins:[this.server.url+"/"]})];case 3:return o=u.sent(),[3,5];case 4:return a=u.sent(),i=!0,console.warn(a),[3,5];case 5:if(!i&&!o)throw new y.MissingPermissionsError;u.label=6;case 6:if("/"===this.server.bookmark_file[0])throw new y.SlashError;return this.abortController=new AbortController,this.abortSignal=this.abortController.signal,t?[4,this.setLock()]:[3,8];case 7:return u.sent(),[3,10];case 8:return e?[4,this.obtainLock()]:[3,10];case 9:u.sent(),u.label=10;case 10:return[4,this.pullFromServer()];case 11:if(200!==(s=u.sent()).status&&404!==s.status)throw new y.HttpError(s.status,"GET");return l=this,[4,this.bookmarksCache.hash(!0)];case 12:return l.initialTreeHash=u.sent(),p.default.log("onSyncStart: completed"),this.lockingInterval&&clearInterval(this.lockingInterval),(e||t)&&(this.lockingInterval=setInterval((function(){return!d.ended&&d.setLock()}),12e4)),404===s.status?[2,!1]:[2]}}))}))},t.prototype.onSyncFail=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return p.default.log("onSyncFail"),this.ended=!0,clearInterval(this.lockingInterval),[4,this.freeLock()];case 1:return e.sent(),[2]}}))}))},t.prototype.onSyncComplete=function(){return l(this,void 0,void 0,(function(){var e,t,r,n;return u(this,(function(o){switch(o.label){case 0:return p.default.log("onSyncComplete"),this.ended=!0,clearInterval(this.lockingInterval),this.bookmarksCache=this.bookmarksCache.clone(),[4,this.bookmarksCache.hash(!0)];case 1:return o.sent()===this.initialTreeHash?[3,5]:(e=this.getBookmarkURL(),t="xbel"===this.server.bookmark_file_type?(i=this.bookmarksCache,a='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE xbel PUBLIC "+//IDN python.org//DTD XML Bookmark Exchange Language 1.0//EN//XML" "http://pyxml.sourceforge.net/topics/dtds/xbel.dtd">\n<xbel version="1.0">\n',a+="\x3c!--- highestId :"+this.highestId+": for Floccus bookmark sync browser extension --\x3e\n",a+=f.default.serialize(i),a+="\n</xbel>"):function(e,t){var r='<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">\n<TITLE>Bookmarks</TITLE>';return r+="\x3c!--- highestId :"+t+": for Floccus bookmark sync browser extension --\x3e\n",r+=w.default.serialize(e),r+="</html>"}(this.bookmarksCache,this.highestId),this.server.passphrase?(r=v.default.bufferToHexstr(v.default.getRandomBytes(64)),[4,v.default.encryptAES(this.server.passphrase,t,r)]):[3,3]);case 2:n=o.sent(),t=JSON.stringify({ciphertext:n,salt:r}),o.label=3;case 3:return[4,this.uploadFile(e,"xbel"===this.server.bookmark_file_type?"application/xml":"text/html",t)];case 4:return o.sent(),[3,6];case 5:p.default.log("No changes to the server version necessary"),o.label=6;case 6:return[4,this.freeLock()];case 7:return o.sent(),[2]}var i,a}))}))},t.prototype.uploadFile=function(e,t,r){return l(this,void 0,void 0,(function(){return u(this,(function(n){return"web"===b.Capacitor.getPlatform()?[2,this.uploadFileWeb(e,t,r)]:[2,this.uploadFileNative(e,t,r)]}))}))},t.prototype.uploadFileWeb=function(e,t,r){return l(this,void 0,void 0,(function(){var n,o,a;return u(this,(function(s){switch(s.label){case 0:n=g.Base64.encode(this.server.username+":"+this.server.password),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(e,i(i({method:"PUT",headers:{"Content-Type":t,Authorization:"Basic "+n},credentials:"omit",signal:this.abortSignal},!this.server.allowRedirects&&{redirect:"manual"}),{body:r}))];case 2:return o=s.sent(),[3,4];case 3:if(a=s.sent(),p.default.log("Error Caught"),p.default.log(a),this.abortSignal.aborted)throw new y.CancelledSyncError;throw new y.NetworkError;case 4:if(0===o.status&&!this.server.allowRedirects)throw new y.RedirectError;if(401===o.status||403===o.status)throw new y.AuthenticationError;if(o.status>=300)throw new y.HttpError(o.status,"PUT");return[2]}}))}))},t.prototype.uploadFileNative=function(e,t,r){return l(this,void 0,void 0,(function(){var n,o,i;return u(this,(function(a){switch(a.label){case 0:n=g.Base64.encode(this.server.username+":"+this.server.password),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,m.CapacitorHttp.request({url:e,method:"PUT",headers:{"Content-Type":t,Authorization:"Basic "+n},data:r})];case 2:return o=a.sent(),[3,4];case 3:throw i=a.sent(),p.default.log("Error Caught"),p.default.log(i),new y.NetworkError;case 4:if(401===o.status||403===o.status)throw new y.AuthenticationError;if(o.status>=300)throw new y.HttpError(o.status,"PUT");return[2]}}))}))},t.prototype.downloadFile=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){return"web"===b.Capacitor.getPlatform()?[2,this.downloadFileWeb(e)]:[2,this.downloadFileNative(e)]}))}))},t.prototype.downloadFileWeb=function(e){return l(this,void 0,void 0,(function(){var t,r,n,o;return u(this,(function(a){switch(a.label){case 0:t=g.Base64.encode(this.server.username+":"+this.server.password),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch(e,i({method:"GET",headers:{Authorization:"Basic "+t},cache:"no-store",credentials:"omit",signal:this.abortSignal},!this.server.allowRedirects&&{redirect:"manual"}))];case 2:return r=a.sent(),[3,4];case 3:if(n=a.sent(),p.default.log("Error Caught"),p.default.log(n),this.abortSignal.aborted)throw new y.CancelledSyncError;throw new y.NetworkError;case 4:if(0===r.status&&!this.server.allowRedirects)throw new y.RedirectError;if(401===r.status||403===r.status)throw new y.AuthenticationError;if(r.status>=300&&404!==r.status)throw new y.HttpError(r.status,"GET");return o={status:r.status},[4,r.text()];case 5:return[2,(o.data=a.sent(),o.headers=r.headers,o)]}}))}))},t.prototype.downloadFileNative=function(e){return l(this,void 0,void 0,(function(){var t,r,n;return u(this,(function(o){switch(o.label){case 0:r=g.Base64.encode(this.server.username+":"+this.server.password),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,m.CapacitorHttp.request({url:e,method:"GET",headers:{Authorization:"Basic "+r,Pragma:"no-cache","Cache-Control":"no-cache"},responseType:"text"})];case 2:return t=o.sent(),[3,4];case 3:throw n=o.sent(),p.default.log("Error Caught"),p.default.log(n),new y.NetworkError;case 4:if(401===t.status||403===t.status)throw new y.AuthenticationError;if(t.status>=300&&404!==t.status)throw new y.HttpError(t.status,"GET");return[2,t]}}))}))},t}(h.default);t.default=k},28200:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=u(r(9767)),h=u(r(67083)),f=u(r(7737)),p=u(r(10341)),g=u(r(15879)),v=r(94780),y=r(5e3),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.get=function(e){return c(this,void 0,void 0,(function(){var r,n,o,i,a;return l(this,(function(s){switch(s.label){case 0:return[4,(r=new d.default(e)).getAccountData(null)];case 1:return n=s.sent(),o=new h.default(r,n.localRoot),i=t.bind,a=[void 0,e,r],[4,p.default.factory(n)];case 2:return[2,new(i.apply(t,a.concat([s.sent(),o])))]}}))}))},t.create=function(e){return c(this,void 0,void 0,(function(){var r,n,o,i;return l(this,(function(a){switch(a.label){case 0:return r=""+Date.now()+Math.random(),[4,p.default.factory(e)];case 1:return n=a.sent(),[4,(o=new d.default(r)).setAccountData(e,null)];case 2:return a.sent(),i=new h.default(o,e.localRoot),[2,new t(r,o,n,i)]}}))}))},t.prototype.init=function(){return c(this,void 0,void 0,(function(){var e,t,r,n,o;return l(this,(function(i){switch(i.label){case 0:return console.log("initializing account "+this.id),e=this.getData(),[4,this.isInitialized()];case 1:return i.sent()||"tabs"===e.localRoot?[3,6]:[4,f.default.bookmarks.getTree()];case 2:return t=i.sent(),r=t[0].children[0],[4,f.default.bookmarks.create({title:"Floccus ("+this.getLabel()+")",parentId:r.id})];case 3:return n=i.sent(),e.localRoot=n.id,o=e,[4,h.default.getPathFromLocalId(n.id)];case 4:return o.rootPath=i.sent(),[4,this.setData(e)];case 5:i.sent(),i.label=6;case 6:return[4,this.storage.initMappings()];case 7:return i.sent(),[4,this.storage.initCache()];case 8:return i.sent(),this.localTree=new h.default(this.storage,e.localRoot),[2]}}))}))},t.prototype.isInitialized=function(){return c(this,void 0,void 0,(function(){var e,t;return l(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"tabs"===(e=this.getData().localRoot)?[2,!0]:[4,f.default.bookmarks.getSubTree(e)];case 1:return r.sent(),[2,!0];case 2:return t=r.sent(),console.log("Apparently not initialized, because:",t),[2,!1];case 3:return[2]}}))}))},t.prototype.getResource=function(){return c(this,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return"tabs"===this.getData().localRoot?[3,1]:[2,this.localTree];case 1:return[4,Promise.resolve().then((function(){return s(r(72119))}))];case 2:return e=t.sent().default,this.localTabs=new e(this.storage),[2,this.localTabs]}}))}))},t.prototype.updateFromStorage=function(){return c(this,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return[4,this.storage.getAccountData(null)];case 1:return e=t.sent(),this.server.setData(e),this.localTree=new h.default(this.storage,e.localRoot),[2]}}))}))},t.stringifyError=function(e){return c(this,void 0,void 0,(function(){var t=this;return l(this,(function(r){switch(r.label){case 0:return e instanceof v.UnknownFolderItemOrderError||e instanceof v.MissingItemOrderError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.item])]:e instanceof v.HttpError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.status,e.method])]:e instanceof v.ParseResponseError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"))+"\n"+e.response]:e instanceof v.InconsistentBookmarksExistenceError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.folder,e.bookmark])]:e instanceof v.LockFileError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.status,e.lockFile])]:e instanceof v.FailsafeError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.percent])]:e instanceof v.CreateBookmarkError||e instanceof v.UpdateBookmarkError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"),[e.bookmark.inspect()])]:e instanceof v.FloccusError?[2,y.i18n.getMessage("Error"+String(e.code).padStart(3,"0"))]:e.list?26===e.list[0].code?[2,this.stringifyError(e.list[0])]:[4,Promise.all(e.list.map((function(e){return t.stringifyError(e)})))]:[3,2];case 1:return[2,r.sent().join("\n")];case 2:return[2,e.message]}}))}))},t.getAllAccounts=function(){return c(this,void 0,void 0,(function(){var e,t;return l(this,(function(r){switch(r.label){case 0:return t=(e=Promise).all,[4,d.default.getAllAccounts()];case 1:return[2,t.apply(e,[r.sent().map((function(e){return g.default.get(e)}))])]}}))}))},t.getAccountsContainingLocalId=function(e,t,r,n){return void 0===n&&(n=!1),c(this,void 0,void 0,(function(){var o,i,a,s;return l(this,(function(c){switch(c.label){case 0:return(o=t)?[3,2]:[4,h.default.getIdPathFromLocalId(e)];case 1:o=c.sent(),c.label=2;case 2:return t=o,(i=r)?[3,4]:[4,this.getAllAccounts()];case 3:i=c.sent(),c.label=4;case 4:return a=(r=i).filter((function(e){return t.includes(e.getData().localRoot)})).sort((function(e,r){return t.indexOf(e.getData().localRoot)-t.indexOf(r.getData().localRoot)})).reverse(),n?[2,a]:(s=a.findIndex((function(e){return!e.getData().nestedSync})),[2,a.slice(0,Math.max(1,s))])}}))}))},t}(g.default);t.default=m},29242:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h}),r(23792),r(3362),r(27495),r(25440),r(98992),r(81454),r(62953),r(3296),r(27208),r(48408);var n=r(40537),o=r.n(n),i=r(89185),a=r(8330),s=r(3363),c=r.n(s),l=r(40962),u=r(85142),d=r(16546);class h{static log(){const e=[(new Date).toISOString(),...arguments];this.messages.push(o().format.apply(o(),e))}static async persist(){const e="web"===d.Capacitor.getPlatform()?await Promise.resolve().then(r.bind(r,9767)):await Promise.resolve().then(r.bind(r,60563));await e.default.changeEntry("logs",(e=>{const t=this.messages;return this.messages=[],t}),[])}static async getLogs(){return("web"===d.Capacitor.getPlatform()?await Promise.resolve().then(r.bind(r,9767)):await Promise.resolve().then(r.bind(r,60563))).default.getEntry("logs",[])}static async anonymizeLogs(e){const t=/\[(.*?)\]\((.*?)\)|\[(.*?)\]/g,r=await i.map(e,(async e=>h.replaceAsync(e,t,(async(e,t,r,n)=>t&&r?"["+await c().sha256(t)+"]("+await c().sha256(r)+")":n?"["+await c().sha256(n)+"]":void 0))),1),n=/url=https?%3A%2F%2F.*$|url=https?%3A%2F%2F[^ ]*/,o=/https?:\/\/[^ /]*\//;return r.map((e=>e.replace(n,"###url###").replace(o,"###server###")))}static async replaceAsync(e,t,r){const n=[];let o;e.replace(t,(function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];const a=r(e,...o);n.push(a)}));try{o=await Promise.all(n)}catch(e){console.error(e)}return e.replace(t,(()=>o.shift()))}static async downloadLogs(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=await this.getLogs();e&&(t=await h.anonymizeLogs(t));let r=new Blob([t.join("\n")],{type:"text/plain",endings:"native"});this.download("floccus-"+a.rE+"-"+(new Date).toISOString().slice(0,10)+"-"+(e?"redacted":"full")+".log",r)}static async download(e,t){if("web"===d.Capacitor.getPlatform()){const r=document.createElement("a");let n=URL.createObjectURL(t);r.setAttribute("href",n),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),URL.revokeObjectURL(n),document.body.removeChild(r)}else{const{uri:r}=await u.YA.writeFile({path:"Downloads/"+e,data:await t.text(),encoding:u.Wi.UTF8,directory:u.__.External,recursive:!0});await l.S.share({title:e,files:[r]})}}}h.messages=[]},30640:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.isVivaldi=void 0,t.isVivaldi=function(){return a(void 0,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return[4,Promise.resolve().then((function(){return i(r(7737))}))];case 1:return[4,n.sent().default.tabs.query({active:!0,currentWindow:!0})];case 2:return e=n.sent(),[2,Boolean(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.vivExtData)]}}))}))}},33023:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=r(39529),l=r(2142),u=function(e){function t(t){var r=e.call(this,{})||this;return r.location=l.ItemLocation.LOCAL,r.storage=t,r.accountId=r.storage.accountId,r}return o(t,e),t.prototype.load=function(){return i(this,void 0,void 0,(function(){var e,t,r,n,o;return a(this,(function(i){switch(i.label){case 0:return[4,c.Preferences.get({key:"bookmarks[".concat(this.accountId,"].tree")})];case 1:return e=i.sent().value,[4,c.Preferences.get({key:"bookmarks[".concat(this.accountId,"].highestId")})];case 2:return t=i.sent().value,e?(n=this.bookmarksCache)?[4,this.bookmarksCache.cloneWithLocation(!1,this.location).hash(!0)]:[3,4]:[3,6];case 3:n=i.sent(),i.label=4;case 4:return r=n,this.bookmarksCache=l.Folder.hydrate(JSON.parse(e)).clone(!1),[4,this.bookmarksCache.hash(!0)];case 5:return o=i.sent(),this.highestId=parseInt(t),[2,r&&r!==o];case 6:return[4,this.save()];case 7:return i.sent(),[2,!1]}}))}))},t.prototype.save=function(){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,c.Preferences.set({key:"bookmarks[".concat(this.accountId,"].tree"),value:JSON.stringify(this.bookmarksCache.cloneWithLocation(!0,l.ItemLocation.LOCAL))})];case 1:return e.sent(),[4,c.Preferences.set({key:"bookmarks[".concat(this.accountId,"].highestId"),value:this.highestId+""})];case 2:return e.sent(),[2]}}))}))},t.prototype.triggerSave=function(){var e=this;clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout((function(){e.save()}),500)},t.prototype.getBookmarksTree=function(){return i(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return[4,e.prototype.getBookmarksTree.call(this)];case 1:return(t=r.sent()).createIndex(),[2,t]}}))}))},t.prototype.createBookmark=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return this.triggerSave(),[2,e.prototype.createBookmark.call(this,t)]}))}))},t.prototype.updateBookmark=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return this.triggerSave(),[2,e.prototype.updateBookmark.call(this,t)]}))}))},t.prototype.removeBookmark=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return this.triggerSave(),[2,e.prototype.removeBookmark.call(this,t)]}))}))},t.prototype.createFolder=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return this.triggerSave(),[2,e.prototype.createFolder.call(this,t)]}))}))},t.prototype.orderFolder=function(t,r){return i(this,void 0,void 0,(function(){return a(this,(function(n){return this.triggerSave(),[2,e.prototype.orderFolder.call(this,t,r)]}))}))},t.prototype.updateFolder=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return this.triggerSave(),[2,e.prototype.updateFolder.call(this,t)]}))}))},t.prototype.removeFolder=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(r){return this.triggerSave(),[2,e.prototype.removeFolder.call(this,t)]}))}))},t.prototype.bulkImportFolder=function(t,r){return i(this,void 0,void 0,(function(){var n=this;return a(this,(function(o){switch(o.label){case 0:return[4,Promise.all(r.children.map((function(r){return i(n,void 0,void 0,(function(){var n;return a(this,(function(o){switch(o.label){case 0:return r.parentId=t,r instanceof l.Bookmark?[4,e.prototype.createBookmark.call(this,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return r instanceof l.Folder?[4,e.prototype.createFolder.call(this,r)]:[3,5];case 3:return n=o.sent(),[4,this.bulkImportFolder(n,r)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))})))];case 1:return o.sent(),[2,this.bookmarksCache.findFolder(t)]}}))}))},t.prototype.isAvailable=function(){return Promise.resolve(!0)},t}(s(r(43376)).default);t.default=u},41234:()=>{},42048:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t},l=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=d(r(43376)),f=d(r(29242)),p=d(r(45387)),g=d(r(3363)),v=d(r(15492)),y=r(94780),m=r(32436),b=r(16546),w={authorizationBaseUrl:"https://accounts.google.com/o/oauth2/auth",accessTokenEndpoint:"https://oauth2.googleapis.com/token",scope:"https://www.googleapis.com/auth/drive.file",resourceUrl:"https://www.googleapis.com/drive/v3/about?fields=user/displayName",logsEnabled:!0,android:{appId:v.default.android.client_id,responseType:"code",redirectUrl:"org.handmadeideas.floccus:/"},ios:{appId:v.default.ios.client_id,responseType:"code",redirectUrl:"org.handmadeideas.floccus:/"}},k=function(e){function t(t){var r=e.call(this,t)||this;return r.cancelCallback=null,r.alwaysUpload=!1,r.locked=!1,r.server=t,r}return o(t,e),t.authorize=function(e){return void 0===e&&(e=!0),l(this,void 0,void 0,(function(){var t,n,o,i,a,s,l,d,h,p,k,E,R,S,O,I,T,_,L,P,A,C,x,D,F,M;return u(this,(function(u){switch(u.label){case 0:return"web"===(t=b.Capacitor.getPlatform())?[3,2]:[4,m.OAuth2Client.authenticate(w)];case 1:return n=u.sent(),o=n.access_token_response.refresh_token,i=n.user.displayName,[2,{refresh_token:o,username:i}];case 2:return"web"!==t?[3,5]:[4,Promise.resolve().then((function(){return c(r(7737))}))];case 3:return a=u.sent().default,s=["https://oauth2.googleapis.com/","https://www.googleapis.com/"],[4,a.permissions.contains({origins:s})];case 4:if(!u.sent())throw new y.MissingPermissionsError;u.label=5;case 5:return h=(d=g.default).bufferToHexstr,[4,g.default.getRandomBytes(128)];case 6:return l=h.apply(d,[u.sent()]).substr(0,128),E=(k=g.default).bufferToHexstr,[4,g.default.getRandomBytes(128)];case 7:return p=E.apply(k,[u.sent()]).substr(0,64),R=chrome.identity.getRedirectURL(),S=["https://www.googleapis.com/auth/drive.file"],O="https://accounts.google.com/o/oauth2/auth",O+="?client_id=".concat(v.default.web.client_id),O+="&response_type=code",O+="&redirect_uri=".concat(encodeURIComponent(R)),O+="&scope=".concat(encodeURIComponent(S.join(" "))),O+="&approval_prompt=force&access_type=offline",O+="&code_challenge=".concat(l),O+="&state=".concat(p),[4,Promise.resolve().then((function(){return c(r(7737))}))];case 8:return[4,u.sent().default.identity.launchWebAuthFlow({interactive:e,url:O})];case 9:if(I=u.sent(),!(T=I.match(/[#?](.*)/))||T.length<1)return[2,null];if(_=new URLSearchParams(T[1].split("#")[0]),L=_.get("code"),P=_.get("state"),!L)throw new Error("Authorization failure");if(P!==p)throw new Error("Authorization failure: State param does not match");return[4,fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"code=".concat(L)+"&client_id=".concat(v.default.web.client_id)+"&client_secret=".concat(v.default.web.client_secret)+"&redirect_uri=".concat(encodeURIComponent(chrome.identity.getRedirectURL()))+"&code_verifier=".concat(l)+"&grant_type=authorization_code"})];case 10:return 200===(A=u.sent()).status?[3,12]:(x=(C=f.default).log,D="Failed to retrieve refresh token from Google API: ",[4,A.text()]);case 11:throw x.apply(C,[D+u.sent()]),new y.OAuthTokenError;case 12:return[4,A.json()];case 13:if(!(F=u.sent()).access_token||!F.refresh_token)throw f.default.log("Failed to retrieve refresh token from Google API: "+JSON.stringify(F)),new y.OAuthTokenError;return[4,fetch("https://www.googleapis.com/drive/v3/about?fields=user/displayName",{headers:{Authorization:"Bearer "+F.access_token}})];case 14:return[4,u.sent().json()];case 15:return M=u.sent(),[2,{refresh_token:F.refresh_token,username:M.user.displayName}]}}))}))},t.prototype.getAccessToken=function(e){return l(this,void 0,void 0,(function(){var t,r,n,o,a,s;return u(this,(function(c){switch(c.label){case 0:return t=b.Capacitor.getPlatform(),[4,this.request("POST","https://oauth2.googleapis.com/token",i(i({refresh_token:e,client_id:v.default[t].client_id},"web"===t&&{client_secret:v.default.web.client_secret}),{grant_type:"refresh_token"}),"application/x-www-form-urlencoded")];case 1:return 200===(r=c.sent()).status?[3,3]:(o=(n=f.default).log,a="Failed to retrieve access token from Google API: ",[4,r.text()]);case 2:throw o.apply(n,[a+c.sent()]),new y.GoogleDriveAuthenticationError;case 3:return[4,r.json()];case 4:if((s=c.sent()).access_token)return[2,s.access_token];throw new y.OAuthTokenError}}))}))},t.prototype.getLabel=function(){return this.server.label||"Google Drive: "+this.server.bookmark_file},t.getDefaultValues=function(){return{type:"google-drive",username:"",password:"",refreshToken:null,bookmark_file:"bookmarks.xbel",allowNetwork:!1}},t.prototype.getUrl=function(){return"https://www.googleapis.com/drive/v3"},t.prototype.timeout=function(e){var t=this;return new Promise((function(r,n){setTimeout(r,e),t.cancelCallback=function(){return n(new y.CancelledSyncError)}}))},t.prototype.onSyncStart=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n,o,i,a,s,l,d,h,v,m,w,k,E,R,S,O,I,T,_,L,P,A,C,x,D,F,M=this;return u(this,(function(u){switch(u.label){case 0:return f.default.log("onSyncStart: begin"),"web"!==b.Capacitor.getPlatform()?[3,6]:[4,Promise.resolve().then((function(){return c(r(7737))}))];case 1:n=u.sent().default,o=["https://oauth2.googleapis.com/","https://www.googleapis.com/"],i=void 0,a=!1,u.label=2;case 2:return u.trys.push([2,4,,5]),[4,n.permissions.contains({origins:o})];case 3:return i=u.sent(),[3,5];case 4:return s=u.sent(),a=!0,console.warn(s),[3,5];case 5:if(!a&&!i)throw new y.MissingPermissionsError;u.label=6;case 6:return l=this,[4,this.getAccessToken(this.server.refreshToken)];case 7:return l.accessToken=u.sent(),[4,this.listFiles("name = '".concat(this.server.bookmark_file,"'"),100)];case 8:if(!(d=u.sent()).files)throw new y.GoogleDriveSearchError;h=d.files.filter((function(e){return!e.trashed}))[0],v=d.files.filter((function(e){return!e.trashed})).slice(1),m=0,w=v,u.label=9;case 9:if(!(m<w.length))return[3,14];k=w[m],u.label=10;case 10:return u.trys.push([10,12,,13]),[4,this.deleteFile(k.id)];case 11:return u.sent(),[3,13];case 12:return E=u.sent(),f.default.log("Failed to delete superfluous file: "+E.message),[3,13];case 13:return m++,[3,9];case 14:return h?(this.fileId=h.id,t?(R=this,[4,this.setLock(this.fileId)]):[3,16]):[3,29];case 15:return R.locked=u.sent(),[3,19];case 16:return e?[4,this.getFileMetadata(h.id,"appProperties")]:[3,19];case 17:if((S=u.sent()).appProperties&&S.appProperties.locked&&(!0===S.appProperties.locked||JSON.parse(S.appProperties.locked))){if(O=JSON.parse(S.appProperties.locked),!Number.isInteger(O))throw new y.ResourceLockedError;if(Date.now()-O<9e5)throw new y.ResourceLockedError}return I=this,[4,this.setLock(this.fileId)];case 18:I.locked=u.sent(),u.label=19;case 19:return[4,this.downloadFile(this.fileId)];case 20:if(T=u.sent(),!this.server.password)return[3,28];u.label=21;case 21:u.trys.push([21,27,,28]),u.label=22;case 22:return u.trys.push([22,24,,26]),_=JSON.parse(T),[4,g.default.decryptAES(this.server.password,_.ciphertext,_.salt)];case 23:return T=u.sent(),[3,26];case 24:return u.sent(),[4,g.default.decryptAES(this.server.password,T,this.server.bookmark_file)];case 25:return T=u.sent(),[3,26];case 26:return[3,28];case 27:if(u.sent(),!T||!T.includes('<?xml version="1.0" encoding="UTF-8"?>'))throw new y.DecryptionError;return this.alwaysUpload=!0,[3,28];case 28:if(!T||!T.includes('<?xml version="1.0" encoding="UTF-8"?>'))throw new y.FileUnreadableError;for(L=T.split("\n"),P=0,A=L;P<A.length;P++)if((C=A[P]).indexOf("\x3c!--- highestId :")>=0){x=C.indexOf(":")+1,D=C.lastIndexOf(":"),this.highestId=parseInt(C.substring(x,D));break}return this.bookmarksCache=p.default.deserialize(T),this.lockingInterval&&clearInterval(this.lockingInterval),(e||t)&&(this.lockingInterval=setInterval((function(){return M.setLock(M.fileId)}),12e4)),[3,30];case 29:this.resetCache(),this.alwaysUpload=!0,u.label=30;case 30:return F=this,[4,this.bookmarksCache.hash(!0)];case 31:return F.initialTreeHash=u.sent(),f.default.log("onSyncStart: completed"),this.fileId?[2]:[2,!1]}}))}))},t.prototype.onSyncFail=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return f.default.log("onSyncFail"),this.fileId?(clearInterval(this.lockingInterval),this.locked?[4,this.freeLock(this.fileId)]:[3,2]):[3,2];case 1:e.sent(),e.label=2;case 2:return this.fileId=null,[2]}}))}))},t.prototype.onSyncComplete=function(){return l(this,void 0,void 0,(function(){var e,t,r,n;return u(this,(function(o){switch(o.label){case 0:return f.default.log("onSyncComplete"),clearInterval(this.lockingInterval),this.bookmarksCache=this.bookmarksCache.clone(),[4,this.bookmarksCache.hash(!0)];case 1:return e=o.sent(),i=this.bookmarksCache,a='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE xbel PUBLIC "+//IDN python.org//DTD XML Bookmark Exchange Language 1.0//EN//XML" "http://pyxml.sourceforge.net/topics/dtds/xbel.dtd">\n<xbel version="1.0">\n',a+="\x3c!--- highestId :"+this.highestId+": for Floccus bookmark sync browser extension --\x3e\n",a+=p.default.serialize(i),t=a+="\n</xbel>",this.server.password?(r=g.default.bufferToHexstr(g.default.getRandomBytes(64)),[4,g.default.encryptAES(this.server.password,t,r)]):[3,3];case 2:n=o.sent(),t=JSON.stringify({ciphertext:n,salt:r}),o.label=3;case 3:return this.fileId?[3,5]:[4,this.createFile(t)];case 4:return o.sent(),this.fileId=null,[2];case 5:return e!==this.initialTreeHash||this.alwaysUpload?[4,this.uploadFile(this.fileId,t)]:[3,7];case 6:return o.sent(),this.alwaysUpload=!1,[3,8];case 7:f.default.log("No changes to the server version necessary"),o.label=8;case 8:return[4,this.freeLock(this.fileId)];case 9:return o.sent(),this.fileId=null,[2]}var i,a}))}))},t.prototype.cancel=function(){this.cancelCallback&&this.cancelCallback()},t.prototype.request=function(e,t,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),l(this,void 0,void 0,(function(){return u(this,(function(o){return[2,this.requestNative(e,t,r,n)]}))}))},t.prototype.requestWeb=function(e,t,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),l(this,void 0,void 0,(function(){var o,a,s,c,l;return u(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,fetch(t,i({method:e,credentials:"omit",headers:i(i({},this.accessToken&&{Authorization:"Bearer "+this.accessToken}),n&&{"Content-type":n})},r&&{body:r}))];case 1:return o=u.sent(),[3,3];case 2:throw a=u.sent(),f.default.log("Error Caught"),f.default.log(a),new y.NetworkError;case 3:return 401!==o.status&&403!==o.status?[3,5]:(c=(s=f.default).log,l="Failed to authenticate to Google API: ",[4,o.text()]);case 4:throw c.apply(s,[l+u.sent()]),new y.AuthenticationError;case 5:return[2,o]}}))}))},t.prototype.requestNative=function(e,t,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),l(this,void 0,void 0,(function(){var o,a,s,c,l,d,h,p;return u(this,(function(u){switch(u.label){case 0:if("application/x-www-form-urlencoded"===n){for(a=new URLSearchParams,s=0,c=Object.entries(r||{});s<c.length;s++)l=c[s],d=l[0],h=l[1],a.set(d,h);r=a.toString()}u.label=1;case 1:return u.trys.push([1,3,,4]),[4,b.CapacitorHttp.request(i({url:t,method:e,headers:i(i({},this.accessToken&&{Authorization:"Bearer "+this.accessToken}),n&&{"Content-type":n}),responseType:"text"},r&&{data:r}))];case 2:return o=u.sent(),[3,4];case 3:throw p=u.sent(),f.default.log("Error Caught"),f.default.log(p),new y.NetworkError;case 4:if(401===o.status||403===o.status)throw f.default.log("Failed to authenticate to Google API: "+o.data),new y.AuthenticationError;if(o.status>=500)throw new y.HttpError(o.status,e);return[2,{status:o.status,json:function(){return Promise.resolve(o.data)},text:function(){return Promise.resolve(o.data)}}]}}))}))},t.prototype.listFiles=function(e,t){return void 0===t&&(t=1),l(this,void 0,void 0,(function(){return u(this,(function(r){switch(r.label){case 0:return[4,this.request("GET",this.getUrl()+"/files?corpora=user&q=".concat(encodeURIComponent(e),"&orderBy=modifiedTime%20desc&fields=files(id%2Cname%2Ctrashed)&pageSize=").concat(t))];case 1:return[2,r.sent().json()]}}))}))},t.prototype.getFileMetadata=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(r){switch(r.label){case 0:return[4,this.request("GET",this.getUrl()+"/files/"+e+(t?"?fields=".concat(encodeURIComponent(t)):""))];case 1:return[2,r.sent().json()]}}))}))},t.prototype.downloadFile=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.request("GET",this.getUrl()+"/files/"+e+"?alt=media")];case 1:return[2,t.sent().text()]}}))}))},t.prototype.deleteFile=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.request("DELETE",this.getUrl()+"/files/"+e)];case 1:return t.sent(),[2]}}))}))},t.prototype.freeLock=function(e){return l(this,void 0,void 0,(function(){var t,r,n;return u(this,(function(o){switch(o.label){case 0:return this.lockingPromise?[4,this.lockingPromise]:[3,2];case 1:o.sent(),o.label=2;case 2:r=0,o.label=3;case 3:return[4,this.request("PATCH",this.getUrl()+"/files/"+e,JSON.stringify({appProperties:{locked:JSON.stringify(!1)}}),"application/json")];case 4:return n=o.sent(),(t=200===n.status||204===n.status)?[3,6]:[4,this.timeout(1e3)];case 5:o.sent(),o.label=6;case 6:r++,o.label=7;case 7:if(!t&&r<10)return[3,3];o.label=8;case 8:return[2,t]}}))}))},t.prototype.setLock=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return this.lockingPromise=this.request("PATCH",this.getUrl()+"/files/"+e,JSON.stringify({appProperties:{locked:JSON.stringify(Date.now())}}),"application/json"),[4,this.lockingPromise];case 1:return[2,200===t.sent().status]}}))}))},t.prototype.createFile=function(e){return l(this,void 0,void 0,(function(){var t,r;return u(this,(function(n){switch(n.label){case 0:return[4,this.request("POST","https://www.googleapis.com/upload/drive/v3/files?uploadType=media",e,"application/xml")];case 1:return 200!==(t=n.sent()).status&&201!==t.status?[2,!1]:[4,t.json()];case 2:return r=n.sent(),this.fileId=r.id,[4,this.request("PATCH",this.getUrl()+"/files/"+this.fileId,JSON.stringify({name:this.server.bookmark_file}),"application/json")];case 3:return[2,200===(t=n.sent()).status]}}))}))},t.prototype.uploadFile=function(e,t){return l(this,void 0,void 0,(function(){return u(this,(function(r){switch(r.label){case 0:return[4,this.request("PATCH","https://www.googleapis.com/upload/drive/v3/files/"+e,t,"application/xml")];case 1:return[2,200===r.sent().status]}}))}))},t.SCOPES=["https://www.googleapis.com/auth/drive.metadata.readonly"],t}(h.default);t.default=k},43376:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=a(r(2142)),d=r(2142),h=l(r(29242)),f=l(r(66245)),p=r(94780),g=function(){function e(e){this.location=d.ItemLocation.SERVER,this.resetCache()}return e.prototype.resetCache=function(){this.highestId=0,this.bookmarksCache=new d.Folder({id:0,title:"root",location:this.location})},e.prototype.getLabel=function(){var e=this.getData();return e.label||e.username+"@"+new URL(e.url).hostname},e.prototype.getBookmarksTree=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.bookmarksCache.clone()]}))}))},e.prototype.acceptsBookmark=function(e){if("data:"===e.url)return!1;try{return Boolean(["https:","http:","ftp:","data:","javascript:","file:","chrome:","edge:"].includes(new URL(e.url).protocol))}catch(e){return!1}},e.prototype.createBookmark=function(e){return s(this,void 0,void 0,(function(){var t;return c(this,(function(r){if(h.default.log("CREATE",e),e.id=++this.highestId,!(t=this.bookmarksCache.findFolder(e.parentId)))throw new p.UnknownCreateTargetError;return t.children.push(e),this.bookmarksCache.createIndex(),[2,e.id]}))}))},e.prototype.updateBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r,n;return c(this,(function(o){if(h.default.log("UPDATE",e),!(t=this.bookmarksCache.findBookmark(e.id)))throw new p.UnknownBookmarkUpdateError;if(t.url=e.url,t.title=e.title,String(t.parentId)===String(e.parentId))return[2];if(!(r=this.bookmarksCache.findFolder(t.parentId)))throw new p.UnknownMoveOriginError;if(!(n=this.bookmarksCache.findFolder(e.parentId)))throw new p.UnknownMoveTargetError;return r.children.splice(r.children.indexOf(t),1),n.children.push(t),t.parentId=e.parentId,this.bookmarksCache.createIndex(),[2]}))}))},e.prototype.removeBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r,n;return c(this,(function(o){return h.default.log("REMOVE",{bookmark:e}),t=e.id,(r=this.bookmarksCache.findBookmark(t))&&(n=this.bookmarksCache.findFolder(r.parentId))?(n.children.splice(n.children.indexOf(r),1),this.bookmarksCache.createIndex(),[2]):[2]}))}))},e.prototype.createFolder=function(e){return s(this,void 0,void 0,(function(){var t,r;return c(this,(function(n){if(h.default.log("CREATEFOLDER",{folder:e}),t=new u.Folder({id:++this.highestId,parentId:e.parentId,title:e.title,location:this.location}),!(r=this.bookmarksCache.findFolder(t.parentId)))throw new p.UnknownCreateTargetError;return r.children.push(t),this.bookmarksCache.createIndex(),[2,t.id]}))}))},e.prototype.updateFolder=function(e){return s(this,void 0,void 0,(function(){var t,r,n,o;return c(this,(function(i){if(h.default.log("UPDATEFOLDER",{folder:e}),t=e.id,!(r=this.bookmarksCache.findFolder(t)))throw new p.UnknownFolderUpdateError;if(!(n=this.bookmarksCache.findFolder(r.parentId)))throw new p.UnknownMoveOriginError;if(!(o=this.bookmarksCache.findFolder(e.parentId)))throw new p.UnknownMoveTargetError;if(r.findFolder(o.id))throw new Error("Detected creation of folder loop: Moving "+t+" to "+e.parentId+", but it already contains the new parent node");return n.children.splice(n.children.indexOf(r),1),o.children.push(r),r.title=e.title,r.parentId=e.parentId,this.bookmarksCache.createIndex(),[2]}))}))},e.prototype.orderFolder=function(e,t){return s(this,void 0,void 0,(function(){var r,n,o;return c(this,(function(i){if(h.default.log("ORDERFOLDER",{id:e,order:t}),!(r=this.bookmarksCache.findFolder(e)))throw new p.UnknownFolderOrderError;if(t.forEach((function(t){var n=r.findItem(t.type,t.id);if(!n||String(n.parentId)!==String(r.id))throw new p.UnknownFolderItemOrderError(e+":"+JSON.stringify(t))})),r.children.forEach((function(r){if(!t.find((function(e){return e.type===r.type&&String(e.id)===String(r.id)})))throw new p.MissingItemOrderError(e+":"+r.inspect())})),t.length!==r.children.length)throw n=(0,f.default)(r.children.map((function(e){return e.id})),t.map((function(e){return e.id}))),new p.MissingItemOrderError(e+":"+JSON.stringify(n));return o=[],t.forEach((function(e){var t=r.findItem(e.type,e.id);o.push(t)})),r.children=o,[2]}))}))},e.prototype.removeFolder=function(e){return s(this,void 0,void 0,(function(){var t,r,n;return c(this,(function(o){return h.default.log("REMOVEFOLDER",{folder:e}),t=e.id,(r=this.bookmarksCache.findFolder(t))&&(n=this.bookmarksCache.findFolder(r.parentId))?(n.children.splice(n.children.indexOf(r),1),this.bookmarksCache.createIndex(),[2]):[2]}))}))},e.prototype.bulkImportFolder=function(e,t){return s(this,void 0,void 0,(function(){var r,n,o=this;return c(this,(function(i){switch(i.label){case 0:if(h.default.log("BULKIMPORT",{id:e,folder:t}),!(r=this.bookmarksCache.findFolder(e)))throw new p.UnknownCreateTargetError;return(n=t.clone()).id=e,[4,n.traverse((function(e,t){return s(o,void 0,void 0,(function(){return c(this,(function(r){return e.id=++this.highestId,e.parentId=t.id,[2]}))}))}))];case 1:return i.sent(),r.children=n.children,this.bookmarksCache.createIndex(),[2,n]}}))}))},e.prototype.setData=function(e){this.server=n({},e)},e.prototype.getData=function(){return n({},this.server)},e.prototype.onSyncStart=function(e){return void 0===e&&(e=!0),s(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onSyncFail=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.onSyncComplete=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.cancel=function(){},e.prototype.isAvailable=function(){return Promise.resolve(!0)},e}();t.default=g},45387:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2142),a=r(86454),s=function(){function e(){}return e.prototype.serialize=function(e){var t=this._serializeFolder(e);return new a.XMLBuilder({format:!0,preserveOrder:!0,ignoreAttributes:!1}).build(t)},e.prototype.deserialize=function(e){var t=new a.XMLParser({preserveOrder:!0,ignorePiTags:!0,ignoreAttributes:!1,parseTagValue:!1}).parse(e);if(!Array.isArray(t[0].xbel))throw new Error("Parse Error: "+e);var r=new i.Folder({id:0,title:"root",location:i.ItemLocation.SERVER});try{this._parseFolder(t[0].xbel,r)}catch(e){throw new Error("Parse Error: "+e.message)}return r},e.prototype._parseFolder=function(e,t){var r=this;e.forEach((function(e){var n,o,a,s,c,l,u,d,h,f,p,g,v,y,m,b,w,k;if(void 0!==e.bookmark)k=new i.Bookmark({id:parseInt(e[":@"]["@_id"]),parentId:t.id,url:e[":@"]["@_href"],title:""+(void 0!==(null===(s=null===(a=null===(o=null===(n=e.bookmark)||void 0===n?void 0:n[0])||void 0===o?void 0:o.title)||void 0===a?void 0:a[0])||void 0===s?void 0:s["#text"])?null===(d=null===(u=null===(l=null===(c=e.bookmark)||void 0===c?void 0:c[0])||void 0===l?void 0:l.title)||void 0===u?void 0:u[0])||void 0===d?void 0:d["#text"]:""),location:i.ItemLocation.SERVER});else{if(void 0===e.folder)return;k=new i.Folder({id:parseInt(null===(h=e[":@"])||void 0===h?void 0:h["@_id"]),title:""+(void 0!==(null===(v=null===(g=null===(p=null===(f=e.folder)||void 0===f?void 0:f[0])||void 0===p?void 0:p.title)||void 0===g?void 0:g[0])||void 0===v?void 0:v["#text"])?null===(w=null===(b=null===(m=null===(y=e.folder)||void 0===y?void 0:y[0])||void 0===m?void 0:m.title)||void 0===b?void 0:b[0])||void 0===w?void 0:w["#text"]:""),parentId:t.id,location:i.ItemLocation.SERVER}),r._parseFolder(e.folder,k)}t.children.push(k)}))},e.prototype._serializeFolder=function(e){var t=this;return e.children.map((function(e){return e instanceof i.Bookmark?{bookmark:[{title:[{"#text":e.title}]}],":@":{"@_href":e.url,"@_id":String(e.id)}}:e instanceof i.Folder?{folder:o([{title:[{"#text":e.title}]}],t._serializeFolder(e),!0),":@":n({},"id"in e&&{"@_id":String(e.id)})}:void 0}))},e}();t.default=new s},47282:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTest=void 0,t.isTest="undefined"!=typeof window&&new URL(window.location.href).pathname.includes("test")},49845:function(e,t){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.storage=e,this.folders=t.folders,this.bookmarks=t.bookmarks}return e.prototype.getSnapshot=function(){return{ServerToLocal:{bookmark:r({},this.bookmarks.ServerToLocal),folder:r({},this.folders.ServerToLocal)},LocalToServer:{bookmark:r({},this.bookmarks.LocalToServer),folder:r({},this.folders.LocalToServer)}}},e.prototype.addFolder=function(t){var r=t.localId,i=t.remoteId;return n(this,void 0,void 0,(function(){return o(this,(function(t){return e.add(this.folders,{localId:r,remoteId:i}),[2]}))}))},e.prototype.removeFolder=function(t){var r=t.localId,i=t.remoteId;return n(this,void 0,void 0,(function(){return o(this,(function(t){return e.remove(this.folders,{localId:r,remoteId:i}),[2]}))}))},e.prototype.addBookmark=function(t){var r=t.localId,i=t.remoteId;return n(this,void 0,void 0,(function(){return o(this,(function(t){return e.add(this.bookmarks,{localId:r,remoteId:i}),[2]}))}))},e.prototype.removeBookmark=function(t){var r=t.localId,i=t.remoteId;return n(this,void 0,void 0,(function(){return o(this,(function(t){return e.remove(this.bookmarks,{localId:r,remoteId:i}),[2]}))}))},e.prototype.persist=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.storage.setMappings({folders:this.folders,bookmarks:this.bookmarks})];case 1:return e.sent(),[2]}}))}))},e.add=function(e,t){var r=t.localId,n=t.remoteId;if(void 0===r||void 0===n)throw new Error("Cannot add empty mapping");e.LocalToServer[r]=n,e.ServerToLocal[n]=r},e.remove=function(e,t){var r=t.localId,n=t.remoteId;if(r&&n&&e.LocalToServer[r]!==n)return e=this.remove(e,{localId:r}),this.remove(e,{remoteId:n});void 0!==r?(delete e.ServerToLocal[e.LocalToServer[r]],delete e.LocalToServer[r]):(delete e.LocalToServer[e.ServerToLocal[n]],delete e.ServerToLocal[n])},e.mapId=function(e,t,r){return t.location===r?t.id:e[t.location+"To"+r][t.type][t.id]},e.mapParentId=function(e,t,r){return t.location===r?t.parentId:e[t.location+"To"+r].folder[t.parentId]},e.mappable=function(t,r,n){return e.mapId(t,r,n.location)===n.id||e.mapId(t,n,r.location)===r.id},e}();t.default=i},54765:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t},l=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=d(r(43376)),f=d(r(45387)),p=d(r(29242)),g=r(16546),v=c(r(65784)),y=d(r(6464)),m=d(r(68611)),b=d(r(91557)),w=r(94780),k=d(r(3363)),E=function(e){function t(t){var r=e.call(this,t)||this;return r.server=t,r.locked=[],r.lockingInterval=null,r}return o(t,e),t.getDefaultValues=function(){return{type:"git",url:"https://example.org/repo.git",username:"bob",password:"s3cret",branch:"main",bookmark_file:"bookmarks.xbel",bookmark_file_type:"xbel",includeCredentials:!1,allowRedirects:!1,allowNetwork:!1}},t.prototype.getLabel=function(){var e=this.getData(),t=new URL(e.url);return t.protocol="",e.label||e.username+"@"+t.hostname+":"+e.bookmark_file},t.prototype.getData=function(){return i(i({},t.getDefaultValues()),this.server)},t.prototype.cancel=function(){this.cancelCallback&&this.cancelCallback()},t.prototype.onSyncStart=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n,o,i,a,s,l,d,h,f,b=this;return u(this,(function(u){switch(u.label){case 0:return p.default.log("onSyncStart: begin"),n=this,[4,k.default.sha256(JSON.stringify(this.server))];case 1:return n.hash=u.sent()+Date.now(),this.dir="/"+this.hash+"/","web"!==g.Capacitor.getPlatform()?[3,7]:[4,Promise.resolve().then((function(){return c(r(7737))}))];case 2:o=u.sent().default,i=void 0,a=!1,u.label=3;case 3:return u.trys.push([3,5,,6]),[4,o.permissions.contains({origins:[this.server.url+"/"]})];case 4:return i=u.sent(),[3,6];case 5:return s=u.sent(),a=!0,console.warn(s),[3,6];case 6:if(!a&&!i)throw new w.MissingPermissionsError;u.label=7;case 7:return this.fs=new m.default(this.hash,{wipe:!0}),p.default.log("(git) init"),[4,v.init({fs:this.fs,dir:this.dir})];case 8:return u.sent(),[4,v.addRemote({fs:this.fs,dir:this.dir,url:this.server.url,remote:"origin",force:!0})];case 9:u.sent(),u.label=10;case 10:return u.trys.push([10,13,,23]),p.default.log("(git) fetch from remote"),[4,v.fetch({http:y.default,fs:this.fs,dir:this.dir,tags:!0,pruneTags:!0,remote:"origin",depth:10,onAuth:function(){return b.onAuth()}})];case 11:return u.sent(),p.default.log("(git) checkout branch "+this.server.branch),[4,v.checkout({fs:this.fs,dir:this.dir,ref:this.server.branch})];case 12:return u.sent(),[3,23];case 13:return!(l=u.sent())||l.code!==v.Errors.NotFoundError.code||"HEAD"!==l.data.what&&l.data.what!==this.server.branch&&l.data.what!=="origin/"+this.server.branch?[3,21]:(p.default.log("(git) writeFile "+this.dir+"/README.md"),[4,this.fs.promises.writeFile(this.dir+"/README.md","This repository is used to synchronize bookmarks via [floccus](https://floccus.org).",{mode:511,encoding:"utf8"})]);case 14:return u.sent(),p.default.log("(git) add ."),[4,v.add({fs:this.fs,dir:this.dir,filepath:"."})];case 15:return u.sent(),p.default.log("(git) commit"),[4,v.commit({fs:this.fs,dir:this.dir,message:"Floccus bookmarks update",author:{name:"Floccus bookmarks sync"}})];case 16:return u.sent(),[4,v.currentBranch({fs:this.fs,dir:this.dir})];case 17:return(d=u.sent())&&d!==this.server.branch?[4,v.renameBranch({fs:this.fs,dir:this.dir,ref:this.server.branch,oldref:d})]:[3,19];case 18:u.sent(),u.label=19;case 19:return p.default.log("(git) push"),[4,v.push({fs:this.fs,http:y.default,dir:this.dir,ref:this.server.branch,remoteRef:this.server.branch,remote:"origin",onAuth:function(){return b.onAuth()}})];case 20:return u.sent(),[3,22];case 21:throw l;case 22:return[3,23];case 23:if("/"===this.server.bookmark_file[0])throw new w.SlashError;return this.lockingInterval&&clearInterval(this.lockingInterval),t?[4,this.clearAllLocks()]:[3,26];case 24:return u.sent(),[4,this.setLock()];case 25:return u.sent(),[3,28];case 26:return e?[4,this.obtainLock()]:[3,28];case 27:u.sent(),u.label=28;case 28:return(e||t)&&(this.lockingInterval=setInterval((function(){return b.setLock()}),12e4)),[4,this.pullFromServer()];case 29:return h=u.sent(),f=this,[4,this.bookmarksCache.hash(!0)];case 30:return f.initialTreeHash=u.sent(),p.default.log("onSyncStart: completed"),[2,h]}}))}))},t.prototype.onSyncFail=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return p.default.log("onSyncFail"),clearInterval(this.lockingInterval),[4,this.freeLock()];case 1:return e.sent(),indexedDB.deleteDatabase(this.hash),[2]}}))}))},t.prototype.onSyncComplete=function(){return l(this,void 0,void 0,(function(){var e,t,r=this;return u(this,(function(n){switch(n.label){case 0:return p.default.log("onSyncComplete"),clearInterval(this.lockingInterval),this.bookmarksCache=this.bookmarksCache.clone(),[4,this.bookmarksCache.hash(!0)];case 1:return n.sent()===this.initialTreeHash?[3,11]:(e="xbel"===this.server.bookmark_file_type?(o=this.bookmarksCache,i='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE xbel PUBLIC "+//IDN python.org//DTD XML Bookmark Exchange Language 1.0//EN//XML" "http://pyxml.sourceforge.net/topics/dtds/xbel.dtd">\n<xbel version="1.0">\n',i+="\x3c!--- highestId :"+this.highestId+": for Floccus bookmark sync browser extension --\x3e\n",i+=f.default.serialize(o),i+="\n</xbel>"):function(e,t){var r='<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">\n<TITLE>Bookmarks</TITLE>';return r+="\x3c!--- highestId :"+t+": for Floccus bookmark sync browser extension --\x3e\n",r+=b.default.serialize(e),r+="</html>"}(this.bookmarksCache,this.highestId),p.default.log("(git) writeFile "+this.dir+"/"+this.server.bookmark_file),[4,this.fs.promises.writeFile(this.dir+"/"+this.server.bookmark_file,e,{mode:511,encoding:"utf8"})]);case 2:return n.sent(),p.default.log("(git) add ."),[4,v.add({fs:this.fs,dir:this.dir,filepath:"."})];case 3:return n.sent(),p.default.log("(git) commit"),[4,v.commit({fs:this.fs,dir:this.dir,message:"Floccus update: ".concat(this.getLabel()),author:{name:"Floccus bookmarks sync"}})];case 4:n.sent(),n.label=5;case 5:return n.trys.push([5,7,,10]),p.default.log("(git) push"),[4,v.push({fs:this.fs,http:y.default,dir:this.dir,remote:"origin",force:!0,onAuth:function(){return r.onAuth()}})];case 6:return n.sent(),[3,10];case 7:return(t=n.sent()).code&&t.code===v.Errors.PushRejectedError.code?[4,this.freeLock()]:[3,9];case 8:throw n.sent(),new w.ResourceLockedError;case 9:return[3,10];case 10:return[3,12];case 11:p.default.log("No changes to the server version necessary"),n.label=12;case 12:return[4,this.freeLock()];case 13:return n.sent(),indexedDB.deleteDatabase(this.hash),[2]}var o,i}))}))},t.prototype.obtainLock=function(){return l(this,void 0,void 0,(function(){var e,t,r;return u(this,(function(n){switch(n.label){case 0:return[4,v.listTags({fs:this.fs,dir:this.dir})];case 1:if(e=n.sent(),(t=e.sort().reverse().find((function(e){return e.startsWith("floccus-lock-")})))&&(r=Number(t.slice(13)),Date.now()-r<9e5))throw new w.ResourceLockedError;return[4,this.setLock()];case 2:return n.sent(),[2]}}))}))},t.prototype.setLock=function(){return l(this,void 0,void 0,(function(){var e=this;return u(this,(function(t){switch(t.label){case 0:return this.lockingPromise=l(e,void 0,void 0,(function(){var e,t=this;return u(this,(function(r){switch(r.label){case 0:return e="floccus-lock-"+Date.now(),p.default.log("(git) tag "+e),[4,v.tag({fs:this.fs,dir:this.dir,ref:e})];case 1:return r.sent(),p.default.log("(git) push tag "+e),[4,v.push({fs:this.fs,http:y.default,dir:this.dir,ref:e,onAuth:function(){return t.onAuth()}})];case 2:return r.sent(),this.locked.push(e),[2]}}))})),[4,this.lockingPromise];case 1:return t.sent(),[2]}}))}))},t.prototype.onAuth=function(){return l(this,void 0,void 0,(function(){return u(this,(function(e){return[2,{username:this.server.username,password:this.server.password}]}))}))},t.prototype.freeLock=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o=this;return u(this,(function(i){switch(i.label){case 0:return this.lockingPromise?[4,this.lockingPromise]:[3,2];case 1:i.sent(),i.label=2;case 2:if(!this.locked.length)return[2];i.label=3;case 3:i.trys.push([3,8,,9]),e=0,t=this.locked,i.label=4;case 4:return e<t.length?(r=t[e],p.default.log("(git) push: delete tag "+r),[4,v.push({fs:this.fs,http:y.default,dir:this.dir,ref:r,delete:!0,onAuth:function(){return o.onAuth()}})]):[3,7];case 5:i.sent(),i.label=6;case 6:return e++,[3,4];case 7:return this.locked=[],[2,!0];case 8:return n=i.sent(),p.default.log("Error Caught"),p.default.log(n),[2,!1];case 9:return[2]}}))}))},t.prototype.clearAllLocks=function(e){return void 0===e&&(e=null),l(this,void 0,void 0,(function(){var t,r,n,o,i,a=this;return u(this,(function(s){switch(s.label){case 0:return e=e||this.fs,[4,v.listTags({fs:e,dir:this.dir})];case 1:t=s.sent(),r=t.filter((function(e){return e.startsWith("floccus-lock-")})),n=0,o=r,s.label=2;case 2:return n<o.length?(i=o[n],[4,v.push({fs:e,http:y.default,dir:this.dir,ref:i,delete:!0,onAuth:function(){return a.onAuth()}})]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return[2]}}))}))},t.prototype.pullFromServer=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o,i;return u(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),p.default.log("(git) readFile"),[4,this.fs.promises.readFile(this.dir+"/"+this.server.bookmark_file,{encoding:"utf8"})];case 1:return e=a.sent(),[3,3];case 2:return a.sent(),this.resetCache(),[2,!1];case 3:if(!e||!e.includes('<?xml version="1.0" encoding="UTF-8"?>')&&!e.includes("<!DOCTYPE NETSCAPE-Bookmark-file-1>"))throw new w.FileUnreadableError;for(t=0,r=e.split("\n");t<r.length;t++)if((n=r[t]).indexOf("\x3c!--- highestId :")>=0){o=n.indexOf(":")+1,i=n.lastIndexOf(":"),this.highestId=parseInt(n.substring(o,i));break}switch(this.server.bookmark_file_type){case"xbel":p.default.log("(git) parse XBEL"),this.bookmarksCache=f.default.deserialize(e);break;case"html":p.default.log("(git) parse HTML"),this.bookmarksCache=b.default.deserialize(e);break;default:throw new Error("Invalid bookmark file type")}return[2,!0]}}))}))},t.prototype.clearServer=function(){return l(this,void 0,void 0,(function(){var e,t,r,n=this;return u(this,(function(o){switch(o.label){case 0:return[4,k.default.sha256(JSON.stringify(this.server))];case 1:return e=o.sent()+Date.now(),this.dir="/"+e+"/",t=new m.default(e,{wipe:!0}),p.default.log("(git) init"),[4,v.init({fs:t,dir:this.dir,defaultBranch:this.server.branch})];case 2:return o.sent(),[4,v.addRemote({fs:t,dir:this.dir,url:this.server.url,remote:"origin",force:!0})];case 3:return o.sent(),[4,t.promises.writeFile(this.dir+"/README.md","This repository is used to synchronize bookmarks via [floccus](https://floccus.org).",{mode:511,encoding:"utf8"})];case 4:return o.sent(),[4,v.add({fs:t,dir:this.dir,filepath:"."})];case 5:return o.sent(),[4,v.commit({fs:t,dir:this.dir,message:"Floccus bookmarks update",author:{name:"Floccus bookmarks sync"}})];case 6:return o.sent(),[4,v.currentBranch({fs:t,dir:this.dir})];case 7:return(r=o.sent())&&r!==this.server.branch?[4,v.renameBranch({fs:t,dir:this.dir,ref:this.server.branch,oldref:r})]:[3,9];case 8:o.sent(),o.label=9;case 9:return[4,v.push({fs:t,http:y.default,dir:this.dir,ref:this.server.branch,remoteRef:this.server.branch,remote:"origin",force:!0,onAuth:function(){return n.onAuth()}})];case 10:return o.sent(),[4,v.fetch({http:y.default,fs:t,dir:this.dir,tags:!0,pruneTags:!0,remote:"origin",depth:10,onAuth:function(){return n.onAuth()}})];case 11:return o.sent(),[4,this.clearAllLocks(t)];case 12:return o.sent(),[2]}}))}))},t}(h.default);t.default=E},58196:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(2142),c=a(r(60721)),l=a(r(29242)),u=r(94780),d=r(16546),h=3e5,f=function(){function e(e){this.server=e,this.fetchQueue=new c.default({concurrency:12}),this.abortController=new AbortController,this.abortSignal=this.abortController.signal}return e.getDefaultValues=function(){return{type:"linkwarden",url:"https://example.org",username:"bob",password:"s3cret",serverFolder:"Floccus",includeCredentials:!1,allowRedirects:!1,allowNetwork:!1}},e.prototype.acceptsBookmark=function(e){try{return["https:","http:","ftp:","javascript:"].includes(new URL(e.url).protocol)}catch(e){return!1}},e.prototype.cancel=function(){this.canceled=!0,this.abortController.abort()},e.prototype.setData=function(e){this.server=n({},e)},e.prototype.getData=function(){return n(n({},e.getDefaultValues()),this.server)},e.prototype.getLabel=function(){var e=this.getData();return e.label||(e.username.includes("@")?e.username+" on "+new URL(e.url).hostname:e.username+"@"+new URL(e.url).hostname)},e.prototype.onSyncComplete=function(){return Promise.resolve(void 0)},e.prototype.onSyncFail=function(){return Promise.resolve(void 0)},e.prototype.onSyncStart=function(e,t){return this.canceled=!1,Promise.resolve(void 0)},e.prototype.createBookmark=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return l.default.log("(linkwarden)CREATE",{bookmark:e}),[4,this.sendRequest("POST","/api/v1/links","application/json",{url:e.url,name:e.title,collection:{id:e.parentId}})];case 1:return[2,t.sent().response.id]}}))}))},e.prototype.updateBookmark=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return l.default.log("(linkwarden)UPDATE",{bookmark:e}),[4,this.sendRequest("GET","/api/v1/collections/".concat(e.parentId))];case 1:return t=r.sent().response,[4,this.sendRequest("PUT","/api/v1/links/".concat(e.id),"application/json",{id:e.id,url:e.url,name:e.title,tags:[],collection:{id:e.parentId,name:t.name,ownerId:t.ownerId}})];case 2:return r.sent(),[2]}}))}))},e.prototype.removeBookmark=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return l.default.log("(linkwarden)DELETE",{bookmark:e}),[4,this.sendRequest("DELETE","/api/v1/links/".concat(e.id))];case 1:return t.sent(),[2]}}))}))},e.prototype.createFolder=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return l.default.log("(linkwarden)CREATEFOLDER",{folder:e}),[4,this.sendRequest("POST","/api/v1/collections","application/json",{name:e.title,parentId:e.parentId})];case 1:return[2,t.sent().response.id]}}))}))},e.prototype.updateFolder=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return l.default.log("(linkwarden)UPDATEFOLDER",{folder:e}),[4,this.sendRequest("GET","/api/v1/collections/".concat(e.id))];case 1:return t=r.sent().response,[4,this.sendRequest("PUT","/api/v1/collections/".concat(e.id),"application/json",n(n({},t),{name:e.title,parentId:e.parentId}))];case 2:return r.sent(),[2]}}))}))},e.prototype.removeFolder=function(e){return o(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(o){switch(o.label){case 0:l.default.log("(linkwarden)DELETEFOLDER",{folder:e}),t=!1,r=0,o.label=1;case 1:return o.trys.push([1,3,,4]),r++,[4,this.sendRequest("DELETE","/api/v1/collections/".concat(e.id))];case 2:return o.sent(),t=!0,[3,4];case 3:if((n=o.sent())instanceof u.HttpError&&401===n.status)t=!0;else if(r>3)throw n;return[3,4];case 4:if(!t)return[3,1];o.label=5;case 5:return[2]}}))}))},e.prototype.getBookmarksTree=function(e){return o(this,void 0,void 0,(function(){var e,t,r,n,o,a=this;return i(this,(function(i){switch(i.label){case 0:e=[],i.label=1;case 1:return[4,this.sendRequest("GET","/api/v1/links?cursor=".concat(e.length?e[e.length-1].id:""))];case 2:t=i.sent().response,e.push.apply(e,t),i.label=3;case 3:if(0!==t.length)return[3,1];i.label=4;case 4:return[4,this.sendRequest("GET","/api/v1/collections")];case 5:return r=i.sent().response,(n=r.find((function(e){return e.name===a.server.serverFolder&&null===e.parentId})))?[3,7]:[4,this.sendRequest("POST","/api/v1/collections","application/json",{name:this.server.serverFolder})];case 6:n=i.sent().response,i.label=7;case 7:return[2,(o=function(t,n){return void 0===n&&(n=!1),new s.Folder({id:t.id,title:t.name,parentId:t.parentId,location:s.ItemLocation.SERVER,isRoot:n,children:r.filter((function(e){return e.parentId===t.id})).map(o).concat(e.filter((function(e){return e.collectionId===t.id})).map((function(e){return new s.Bookmark({id:e.id,title:e.name,parentId:e.collectionId,url:e.url,location:s.ItemLocation.SERVER})})))})})(n,!0)]}}))}))},e.prototype.isAvailable=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,!0]}))}))},e.prototype.sendRequest=function(e,t,r,a,s){return void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=!1),o(this,void 0,void 0,(function(){var o,c,f,p,g,v,y,m,b,w,k,E,R=this;return i(this,(function(i){switch(i.label){case 0:if(o=this.server.url+t,f=!1,r&&r.includes("application/json"))a=JSON.stringify(a);else if(r&&r.includes("application/x-www-form-urlencoded")){for(p=new URLSearchParams,g=0,v=Object.entries(a||{});g<v.length;g++)y=v[g],m=y[0],b=y[1],p.set(m,b);a=p.toString()}if(l.default.log("QUEUING ".concat(e," ").concat(o)),"web"!==d.Capacitor.getPlatform())return[2,this.sendRequestNative(e,o,r,a,s)];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.fetchQueue.add((function(){return l.default.log("FETCHING ".concat(e," ").concat(o)),Promise.race([fetch(o,n({method:e,credentials:R.server.includeCredentials?"include":"omit",headers:n(n({},r&&"multipart/form-data"!==r&&{"Content-type":r}),{Authorization:"Bearer "+R.server.password}),signal:R.abortSignal},a&&!["get","head"].includes(e.toLowerCase())&&{body:a})),new Promise((function(e,t){return setTimeout((function(){f=!0,t(new u.RequestTimeoutError)}),h)}))])}))];case 2:return c=i.sent(),[3,4];case 3:if(w=i.sent(),f)throw w;if(this.canceled)throw new u.CancelledSyncError;throw console.log(w),new u.NetworkError;case 4:if(l.default.log("Receiving response for ".concat(e," ").concat(o)),c.redirected&&!this.server.allowRedirects)throw new u.RedirectError;if(s)return[2,c];if(403===c.status)throw new u.AuthenticationError;if(503===c.status||c.status>=400)throw new u.HttpError(c.status,e);i.label=5;case 5:return i.trys.push([5,7,,8]),[4,c.json()];case 6:return k=i.sent(),[3,8];case 7:throw E=i.sent(),new u.ParseResponseError(E.message);case 8:return[2,k]}}))}))},e.prototype.sendRequestNative=function(e,t,r,a,s){return o(this,void 0,void 0,(function(){var o,c,f,p=this;return i(this,(function(i){switch(i.label){case 0:c=!1,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.fetchQueue.add((function(){return l.default.log("FETCHING ".concat(e," ").concat(t)),Promise.race([d.CapacitorHttp.request(n({url:t,method:e,disableRedirects:!p.server.allowRedirects,headers:n(n({},r&&"multipart/form-data"!==r&&{"Content-type":r}),{Authorization:"Bearer "+p.server.password}),responseType:"json"},a&&!["get","head"].includes(e.toLowerCase())&&{data:a})),new Promise((function(e,t){return setTimeout((function(){c=!0,t(new u.RequestTimeoutError)}),h)}))])}))];case 2:return o=i.sent(),[3,4];case 3:if(f=i.sent(),c)throw f;throw console.log(f),new u.NetworkError;case 4:if(l.default.log("Receiving response for ".concat(e," ").concat(t)),o.status<400&&o.status>=300)throw new u.RedirectError;if(s)return[2,o];if(401===o.status||403===o.status)throw new u.AuthenticationError;if(503===o.status||o.status>=400)throw new u.HttpError(o.status,e);return[2,o.data]}}))}))},e}();t.default=f},60563:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p}),r(33110),r(3362);var n=r(39529),o=r(3363),i=r.n(o),a=r(21406),s=r(49845),c=r.n(s),l=r(2142),u=r(18465),d=r.n(u),h=r(29242);const f=new(d());class p{constructor(e){this.accountId=e}static async changeEntry(e,t,r){await f.acquire(e,(async()=>{let o=await p.getEntry(e,r);o=t(o),await n.Preferences.set({key:e,value:JSON.stringify(o)})}))}static async getEntry(e,t){let r=await n.Preferences.get({key:e});try{if(r.value){for(;"string"==typeof r.value;)r.value=JSON.parse(r.value);return r.value}return t}catch(e){return h.default.log("Error while parsing NativeAccountStorage entry value "+e.message),console.error(e),t}}static deleteEntry(e){return n.Preferences.remove({key:e})}static async getAllAccounts(){let e=await p.getEntry("accounts",{});return Object.keys(e)}async getAccountData(e){let t=(await p.getEntry("accounts",{}))[this.accountId];return e&&(t.iv?(t.password=await a.A.decryptAES(e,t.iv,t.password),delete t.iv):(t.password=await i().decryptAES(e,t.password,t.username),t.passphrase&&(t.passphrase=await i().decryptAES(e,t.passphrase,t.username)))),t}async setAccountData(e,t){let r=e;return t&&(e.iv&&delete e.iv,r={...e,password:await i().encryptAES(t,e.password,e.username),...e.passphrase&&{passphrase:await i().encryptAES(t,e.passphrase,e.username)}}),p.changeEntry("accounts",(e=>(e[this.accountId]=r,e)),{})}async deleteAccountData(){await p.changeEntry("accounts",(e=>(delete e[this.accountId],e))),await this.deleteCache(),await this.deleteMappings()}async initCache(){await p.changeEntry(`bookmarks[${this.accountId}].cache`,(()=>({})))}async getCache(){const e=await p.getEntry(`bookmarks[${this.accountId}].cache`);return l.Folder.hydrate(e&&Object.keys(e).length?e:{location:l.ItemLocation.LOCAL})}async setCache(e){await p.changeEntry(`bookmarks[${this.accountId}].cache`,(()=>e))}async deleteCache(){await p.deleteEntry(`bookmarks[${this.accountId}].cache`)}async initMappings(){await p.changeEntry(`bookmarks[${this.accountId}].mappings`,(()=>({})))}async getMappings(){const e=await p.getEntry(`bookmarks[${this.accountId}].mappings`);return new(c())(this,e&&Object.keys(e).length?e:{bookmarks:{ServerToLocal:{},LocalToServer:{}},folders:{ServerToLocal:{},LocalToServer:{}}})}async setMappings(e){await p.changeEntry(`bookmarks[${this.accountId}].mappings`,(()=>e))}async deleteMappings(){await p.deleteEntry(`bookmarks[${this.accountId}].mappings`)}async getCurrentContinuation(){return p.getEntry(`bookmarks[${this.accountId}].continuation`)}async setCurrentContinuation(e){await p.changeEntry(`bookmarks[${this.accountId}].continuation`,(t=>e),null)}}},64969:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActionType=void 0;var a=r(2142),s=i(r(49845)),c=i(r(68697)),l=i(r(29242));t.ActionType={CREATE:"CREATE",UPDATE:"UPDATE",MOVE:"MOVE",REMOVE:"REMOVE",REORDER:"REORDER"};var u=function(){function e(){this.actions=[]}return e.prototype.clone=function(t){void 0===t&&(t=function(){return!0});var r=new e;return this.getActions().forEach((function(e){t(e)&&r.commit(e)})),r},e.prototype.commit=function(e){this.actions.push(n({},e))},e.prototype.retract=function(e){this.actions.splice(this.actions.indexOf(e),1)},e.prototype.getActions=function(){return[].concat(this.actions)},e.findChain=function(t,r,n,i,c,l){void 0===l&&(l=[]);var u=n.findFolder(s.default.mapId(t,c.payload,n.location));if(c.payload.findItem(a.ItemType.FOLDER,s.default.mapParentId(t,i,c.payload.location))||u&&u.findFolder(s.default.mapParentId(t,i,n.location)))return!0;var d=r.filter((function(e){return!l.includes(e)&&(e.payload.findItem(a.ItemType.FOLDER,s.default.mapParentId(t,i,e.payload.location))||n.findFolder(s.default.mapId(t,e.payload,n.location))&&n.findFolder(s.default.mapId(t,e.payload,n.location)).findFolder(s.default.mapParentId(t,i,n.location)))}));if(d.length)for(var h=0,f=d;h<f.length;h++){var p=f[h];if(e.findChain(t,r,n,p.payload,c,o(o([],l,!0),[p],!1)))return!0}return!1},e.sortMoves=function(e,t){var r,n=e.filter((function(e){return e.payload.type===a.ItemType.BOOKMARK})),o=e.filter((function(e){return e.payload.type===a.ItemType.FOLDER})),i=o.reduce((function(e,r){return e[r.payload.id]=o.filter((function(e){return r!==e&&String(r.payload.id)!==String(e.payload.id)&&t.findItem(r.payload.type,r.payload.id)&&t.findItem(r.payload.type,r.payload.id).findItem(e.payload.type,e.payload.id)})).map((function(e){return e.payload.id})),e}),{});try{r=(0,c.default)(i).map((function(e){return e.map((function(e){return o.find((function(t){return String(t.payload.id)===String(e)}))}))}))}catch(r){throw console.log({DAG:i,tree:t,actions:e}),r}return r.push(n),r.reverse(),r},e.prototype.map=function(r,o,i,c){void 0===i&&(i=function(){return!0}),void 0===c&&(c=!1);var u=new e;return this.getActions().map((function(e){return e})).forEach((function(d){var h;if(i(d)){var f=d.oldItem;if(f&&o!==a.ItemLocation.SERVER){var p=d.oldItem.id,g=d.payload.id;(h=n(n({},d),{payload:d.payload.cloneWithLocation(!1,o),oldItem:d.oldItem.cloneWithLocation(!1,d.payload.location)})).payload.id=p,h.oldItem.id=g}else(h=n(n({},d),{payload:d.payload.cloneWithLocation(!1,o),oldItem:d.payload.clone(!1)})).payload.id=s.default.mapId(r,d.payload,o);if(f&&o!==a.ItemLocation.SERVER&&d.type!==t.ActionType.MOVE)h.oldItem.parentId=d.payload.parentId,h.payload.parentId=s.default.mapParentId(r,d.oldItem,o);else if(h.oldItem.parentId=d.payload.parentId,h.payload.parentId=s.default.mapParentId(r,d.payload,o),void 0===h.payload.parentId&&void 0!==d.payload.parentId){if(c)return l.default.log("Failed to map parentId: "+d.payload.parentId),void l.default.log("Removing MOVE action from plan:",d);l.default.log("payload.location = "+d.payload.location+" | targetLocation = "+o);var v=new e;throw v.commit(d),l.default.log("Failed to map parentId of action "+v.inspect()),l.default.log(JSON.stringify(r,null,"\t")),new Error("Failed to map parentId to "+o+": "+d.payload.parentId)}d.type===t.ActionType.REORDER&&(h.oldOrder=d.order,h.order=d.order.map((function(e){return n(n({},e),{id:r[(o===a.ItemLocation.LOCAL?a.ItemLocation.SERVER:a.ItemLocation.LOCAL)+"To"+o][e.type][e.id]})}))),u.commit(h)}})),u},e.prototype.toJSON=function(){return this.getActions().map((function(e){return n(n({},e),{payload:e.payload.clone(!1),oldItem:e.oldItem&&e.oldItem.clone(!1)})}))},e.prototype.inspect=function(e){return void 0===e&&(e=0),"Diff\n"+this.getActions().map((function(e){return"\nAction: ".concat(e.type,"\nPayload: #").concat(e.payload.id,"[").concat(e.payload.title,"]").concat("url"in e.payload?"(".concat(e.payload.url,")"):""," parentId: ").concat(e.payload.parentId," ").concat("index"in e?"Index: ".concat(e.index,"\n"):"").concat("order"in e?"Order: ".concat(JSON.stringify(e.order,null,"\t")):"")})).join("\n")},e.fromJSON=function(t){var r=new e;return t.forEach((function(e){e.payload=(0,a.hydrate)(e.payload),e.oldItem=e.oldItem&&(0,a.hydrate)(e.oldItem),r.commit(e)})),r},e}();t.default=u},67083:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l,u=c(r(7737)),d=c(r(29242)),h=i(r(2142)),f=c(r(60721)),p=c(r(15879)),g=r(2142),v=c(r(534)),y=c(r(7391)),m=r(30640),b=r(94780),w=function(){function e(t,r){var n=this;this.rootId=r,this.storage=t,this.queue=new f.default({concurrency:10}),this.absoluteRootPromise=e.getAbsoluteRootFolder().then((function(e){n.absoluteRoot=e}))}return e.prototype.getBookmarksTree=function(){return a(this,void 0,void 0,(function(){var t,r,n,o,i=this;return s(this,(function(a){switch(a.label){case 0:return[4,(0,m.isVivaldi)()];case 1:t=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,u.default.bookmarks.getSubTree(this.rootId)];case 3:return r=a.sent()[0],[3,5];case 4:throw a.sent(),new b.LocalFolderNotFoundError;case 5:return[4,this.absoluteRootPromise];case 6:return a.sent(),[4,p.default.getAccountClass()];case 7:return[4,a.sent().getAllAccounts()];case 8:return n=a.sent(),[2,(o=function(r,a,s,c){if(!n.some((function(e){return e.getData().localRoot===r.id&&String(r.id)!==String(i.rootId)&&!e.getData().nestedSync}))){var l,u,f;if(r.parentId===i.absoluteRoot.id&&!t){switch(r.id){case"1":case"toolbar_____":l=e.TITLE_BOOKMARKS_BAR,f=!0;break;case"2":case"unfiled_____":l=e.TITLE_OTHER_BOOKMARKS;break;case"menu________":l=e.TITLE_BOOKMARKS_MENU;break;case"mobile______":l=e.TITLE_MOBILE_BOOKMARKS}l&&d.default.log("Overriding title of built-in node",r.id,r.title,"=>",l)}if(r.id===i.absoluteRoot.id&&(u=!0),r.children){var p=v.default.clone((0,y.default)(r.title)),m=new h.Folder({location:g.ItemLocation.LOCAL,id:r.id,parentId:a,title:a?l||r.title:void 0,children:r.children.map((function(e){return o(e,r.id,f,p)})).filter((function(e){return!!e}))});return m.isRoot=u,m}return"moz-extension:"===self.location.protocol&&"separator"===r.type?new h.Bookmark({location:g.ItemLocation.LOCAL,id:r.id,parentId:a,title:s?e.TITLE_SEPARATOR_VERT:e.TITLE_SEPARATOR_HORZ,url:"https://separator.floccus.org/"+(s?"vertical.html":"")+"?id=".concat(c.int(0,1e6))}):new h.Bookmark({location:g.ItemLocation.LOCAL,id:r.id,parentId:a,title:r.title,url:r.url})}})(r)]}}))}))},e.prototype.createBookmark=function(e){return a(this,void 0,void 0,(function(){var t,r=this;return s(this,(function(n){switch(n.label){case 0:if(d.default.log("(local)CREATE",e),e.parentId===this.absoluteRoot.id)return d.default.log("This action affects the absolute root. Skipping."),[2];n.label=1;case 1:return n.trys.push([1,5,,6]),"moz-extension:"!==self.location.protocol||"separator.floccus.org"!==new URL(e.url).hostname?[3,3]:[4,this.queue.add((function(){return a(r,void 0,void 0,(function(){return s(this,(function(t){return d.default.log("(local)CREATE: executing create ",e),[2,u.default.bookmarks.create({parentId:e.parentId.toString(),type:"separator"})]}))}))}))];case 2:return[2,n.sent().id];case 3:return[4,this.queue.add((function(){return a(r,void 0,void 0,(function(){return s(this,(function(t){return d.default.log("(local)CREATE: executing create ",e),[2,u.default.bookmarks.create({parentId:e.parentId.toString(),title:e.title,url:e.url})]}))}))}))];case 4:return[2,n.sent().id];case 5:throw t=n.sent(),new Error("Could not create "+e.inspect()+": "+t.message);case 6:return[2]}}))}))},e.prototype.updateBookmark=function(e){return a(this,void 0,void 0,(function(){var t,r=this;return s(this,(function(n){switch(n.label){case 0:if(d.default.log("(local)UPDATE",e),e.parentId===this.absoluteRoot.id)return d.default.log("This action affects the absolute root. Skipping."),[2];n.label=1;case 1:return n.trys.push([1,6,,7]),"moz-extension:"!==self.location.protocol||"separator.floccus.org"!==new URL(e.url).hostname?[3,2]:[3,4];case 2:return[4,this.queue.add((function(){return a(r,void 0,void 0,(function(){return s(this,(function(t){return d.default.log("(local)UPDATE: executing update ",e),[2,u.default.bookmarks.update(e.id,{title:e.title,url:e.url})]}))}))}))];case 3:n.sent(),n.label=4;case 4:return[4,this.queue.add((function(){return a(r,void 0,void 0,(function(){return s(this,(function(t){return d.default.log("(local)UPDATE: executing move ",e),[2,u.default.bookmarks.move(e.id,{parentId:e.parentId.toString()})]}))}))}))];case 5:return n.sent(),[3,7];case 6:throw t=n.sent(),new Error("Could not update "+e.inspect()+": "+t.message);case 7:return[2]}}))}))},e.prototype.removeBookmark=function(e){return a(this,void 0,void 0,(function(){var t,r,n=this;return s(this,(function(o){switch(o.label){case 0:if(e.parentId===this.absoluteRoot.id)return d.default.log("This action affects the absolute root. Skipping."),[2];t=e.id,d.default.log("(local)REMOVE",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.queue.add((function(){return a(n,void 0,void 0,(function(){return s(this,(function(r){return d.default.log("(local)REMOVE: executing remove ",e),[2,u.default.bookmarks.remove(t)]}))}))}))];case 2:return o.sent(),[3,4];case 3:return r=o.sent(),d.default.log("Could not remove "+e.inspect()+": "+r.message+"\n Moving on"),[3,4];case 4:return[2]}}))}))},e.prototype.createFolder=function(e){return a(this,void 0,void 0,(function(){var t,r,n,o=this;return s(this,(function(i){switch(i.label){case 0:if(t=e.parentId,r=e.title,d.default.log("(local)CREATEFOLDER",e),e.parentId===this.absoluteRoot.id)return d.default.log("This action affects the absolute root. Skipping."),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.queue.add((function(){return a(o,void 0,void 0,(function(){return s(this,(function(n){return d.default.log("(local)CREATEFOLDER: executing create ",e),[2,u.default.bookmarks.create({parentId:t.toString(),title:r})]}))}))}))];case 2:return[2,i.sent().id];case 3:throw n=i.sent(),new Error("Could not create "+e.inspect()+": "+n.message);case 4:return[2]}}))}))},e.prototype.orderFolder=function(e,t){return a(this,void 0,void 0,(function(){var r,n,o,i,a,c,l,h,f;return s(this,(function(s){switch(s.label){case 0:return d.default.log("(local)ORDERFOLDER",{id:e,order:t}),e===this.absoluteRoot.id?(d.default.log("This action affects the absolute root. Skipping."),[2]):[4,u.default.bookmarks.getSubTree(e)];case 1:r=s.sent()[0],s.label=2;case 2:s.trys.push([2,7,,8]),l=0,s.label=3;case 3:return l<t.length?[4,u.default.bookmarks.move(t[l].id,{parentId:e.toString(),index:l})]:[3,6];case 4:s.sent(),s.label=5;case 5:return l++,[3,3];case 6:return[3,8];case 7:throw n=s.sent(),new Error("Failed to reorder folder "+e+": "+n.message);case 8:if(r.children.length===t.length)return[3,15];o=r.children.map((function(e,t){return[t,e]})).filter((function(e){var r=e[1];return r.url?!t.some((function(e){return e.type===g.ItemType.BOOKMARK&&String(e.id)===String(r.id)})):!t.some((function(e){return e.type===g.ItemType.FOLDER&&String(e.id)===String(r.id)}))})),s.label=9;case 9:s.trys.push([9,14,,15]),d.default.log("Move untouched children back into place",{untouchedChildren:o.map((function(e){return[e[0],e[1].id]}))}),i=0,a=o,s.label=10;case 10:return i<a.length?(c=a[i],l=c[0],h=c[1],[4,u.default.bookmarks.move(h.id,{parentId:e.toString(),index:l})]):[3,13];case 11:s.sent(),s.label=12;case 12:return i++,[3,10];case 13:return[3,15];case 14:throw f=s.sent(),new Error("Failed to reorder folder "+e+": "+f.message);case 15:return[2]}}))}))},e.prototype.updateFolder=function(e){return a(this,void 0,void 0,(function(){var t,r,n,o,i,c,l=this;return s(this,(function(h){switch(h.label){case 0:if(t=e.id,r=e.title,n=e.parentId,d.default.log("(local)UPDATEFOLDER",e),e.parentId===this.absoluteRoot.id)return d.default.log("This action affects a root folder. Skipping."),[2];if(e.isRoot)return d.default.log("This is the absolute root folder. Skip."),[2];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.queue.add((function(){return a(l,void 0,void 0,(function(){return s(this,(function(n){return d.default.log("(local)UPDATEFOLDER: executing update ",e),[2,u.default.bookmarks.update(t.toString(),{title:r})]}))}))}))];case 2:return h.sent(),[3,4];case 3:throw o=h.sent(),new Error("Failed to rename folder "+t+": "+o.message);case 4:return[4,u.default.bookmarks.getSubTree(t)];case 5:if(i=h.sent()[0],g.Folder.hydrate(i).findFolder(n))throw new Error("Detected creation of folder loop. Moving "+t+" into its descendant "+n);h.label=6;case 6:return h.trys.push([6,8,,9]),[4,this.queue.add((function(){return a(l,void 0,void 0,(function(){return s(this,(function(r){return d.default.log("(local)CREATEFOLDER: executing move ",e),[2,u.default.bookmarks.move(t.toString(),{parentId:n})]}))}))}))];case 7:return h.sent(),[3,9];case 8:throw c=h.sent(),new Error("Failed to move folder "+t+": "+c.message);case 9:return[2]}}))}))},e.prototype.removeFolder=function(e){return a(this,void 0,void 0,(function(){var t,r,n=this;return s(this,(function(o){switch(o.label){case 0:if(t=e.id,d.default.log("(local)REMOVEFOLDER",t),e.parentId===this.absoluteRoot.id)return d.default.log("This action affects a root folder. Skipping."),[2];if(e.isRoot)return d.default.log("This is the root folder. Skip."),[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.queue.add((function(){return a(n,void 0,void 0,(function(){return s(this,(function(r){return d.default.log("(local)REMOVEFOLDER: executing remove ",e),[2,u.default.bookmarks.removeTree(t.toString())]}))}))}))];case 2:return o.sent(),[3,4];case 3:return r=o.sent(),d.default.log("Could not remove "+e.inspect()+": "+r.message+"\n Moving on."),[3,4];case 4:return[2]}}))}))},e.getPathFromLocalId=function(t,r,n){return a(this,void 0,void 0,(function(){var o,i=this;return s(this,(function(c){switch(c.label){case 0:if("tabs"===t)return[2,u.default.i18n.getMessage("LabelTabs")];c.label=1;case 1:return c.trys.push([1,5,,6]),(o=r)?[3,3]:[4,e.getIdPathFromLocalId(t)];case 2:o=c.sent(),c.label=3;case 3:return r=o,n&&(r=r.slice(r.indexOf(n)+1)),[4,Promise.all(r.map((function(e){return a(i,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,u.default.bookmarks.get(e)];case 1:return[2,t.sent()[0].title.replace(/[/]/g,"\\/")];case 2:return t.sent(),[2,"Error!"];case 3:return[2]}}))}))})))];case 4:return[2,c.sent().join("/")];case 5:return c.sent(),[2,u.default.i18n.getMessage("LabelFolderNotFound")];case 6:return[2]}}))}))},e.getIdPathFromLocalId=function(e,t){return void 0===t&&(t=[]),a(this,void 0,void 0,(function(){var r,n;return s(this,(function(o){switch(o.label){case 0:return void 0===e?[2,t]:(t.unshift(e),[4,u.default.bookmarks.get(e)]);case 1:return r=o.sent(),(n=r[0]).parentId===e?[2,t]:[2,this.getIdPathFromLocalId(n.parentId,t)]}}))}))},e.getAbsoluteRootFolder=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(l)return[3,9];e.label=1;case 1:return e.trys.push([1,3,,9]),[4,u.default.bookmarks.get("0")];case 2:return l=e.sent()[0],[3,9];case 3:e.sent(),e.label=4;case 4:return e.trys.push([4,6,,8]),[4,u.default.bookmarks.get("root________")];case 5:return l=e.sent()[0],[3,8];case 6:return e.sent(),[4,u.default.bookmarks.getTree()];case 7:return delete(l=e.sent()[0]).children,[3,8];case 8:return[3,9];case 9:return[2,l]}}))}))},e.prototype.isAvailable=function(){return Promise.resolve(!0)},e.TITLE_BOOKMARKS_BAR="Bookmarks Bar",e.TITLE_OTHER_BOOKMARKS="Other Bookmarks",e.TITLE_BOOKMARKS_MENU="Bookmarks Menu",e.TITLE_MOBILE_BOOKMARKS="Mobile Bookmarks",e.TITLE_SEPARATOR_HORZ="⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯",e.TITLE_SEPARATOR_VERT="",e}();t.default=w},72119:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=a(r(7737)),c=a(r(29242)),l=a(r(60721)),u=r(2142),d=a(r(63375)),h=function(){function e(e){this.storage=e,this.queue=new l.default({concurrency:10})}return e.prototype.getBookmarksTree=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,s.default.tabs.query({windowType:"normal"})];case 1:return e=(e=t.sent()).filter((function(e){return!e.incognito})),[2,new u.Folder({title:"",id:"tabs",location:u.ItemLocation.LOCAL,children:(0,d.default)(e.map((function(e){return e.windowId}))).map((function(t,r){return new u.Folder({title:"Window "+r,id:t,parentId:"tabs",location:u.ItemLocation.LOCAL,children:e.filter((function(e){return e.windowId===t})).sort((function(e,t){return e.index-t.index})).map((function(e){return new u.Bookmark({id:e.id,title:e.title,url:e.url,parentId:t,location:u.ItemLocation.LOCAL})}))})}))})]}}))}))},e.prototype.createBookmark=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return c.default.log("(tabs)CREATE",e),"tabs"===e.parentId?(c.default.log('Parent is "tabs", ignoring this one.'),[2]):"moz-extension:"===self.location.protocol&&"file:"===new URL(e.url).protocol?(c.default.log("URL is a file URL and we are on firefox, ignoring this one."),[2]):[4,this.queue.add((function(){return s.default.tabs.create(n(n({windowId:"string"==typeof e.parentId?parseInt(e.parentId):e.parentId,url:e.url},void 0!==s.default.BookmarkTreeNodeType&&{discarded:!0}),{active:!1}))}))];case 1:return t=r.sent(),[4,f()];case 2:return r.sent(),[2,t.id]}}))}))},e.prototype.updateBookmark=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return c.default.log("(tabs)UPDATE",e),"tabs"===e.parentId?(c.default.log('Parent is "tabs", ignoring this one.'),[2]):[4,this.queue.add((function(){return s.default.tabs.update(e.id,{url:e.url})}))];case 1:return t.sent(),[4,this.queue.add((function(){return s.default.tabs.move(e.id,{windowId:e.parentId,index:-1})}))];case 2:return t.sent(),[4,f()];case 3:return t.sent(),[2]}}))}))},e.prototype.removeBookmark=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return t=e.id,c.default.log("(tabs)REMOVE",e),"tabs"===e.parentId?(c.default.log('Parent is "tabs", ignoring this one.'),[2]):[4,this.queue.add((function(){return s.default.tabs.remove(t)}))];case 1:return r.sent(),[4,f()];case 2:return r.sent(),[2]}}))}))},e.prototype.createFolder=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return c.default.log("(tabs)CREATEFOLDER",e),[4,this.queue.add((function(){return s.default.windows.create()}))];case 1:return[2,t.sent().id]}}))}))},e.prototype.orderFolder=function(e,t){return o(this,void 0,void 0,(function(){var r,n,o,a,l,u,d,h,p;return i(this,(function(i){switch(i.label){case 0:return c.default.log("(tabs)ORDERFOLDER",{id:e,order:t}),[4,s.default.tabs.query({windowId:e})];case 1:r=i.sent(),i.label=2;case 2:i.trys.push([2,7,,8]),d=0,i.label=3;case 3:return d<t.length?[4,s.default.tabs.move(t[d].id,{index:d})]:[3,6];case 4:i.sent(),i.label=5;case 5:return d++,[3,3];case 6:return[3,8];case 7:throw n=i.sent(),new Error("Failed to reorder folder "+e+": "+n.message);case 8:if(r.length===t.length)return[3,15];o=r.map((function(e,t){return[t,e]})).filter((function(e){var r=e[1];return!t.some((function(e){return String(r.id)===String(e.id)}))})),i.label=9;case 9:i.trys.push([9,14,,15]),a=0,l=o,i.label=10;case 10:return a<l.length?(u=l[a],d=u[0],h=u[1],[4,s.default.tabs.move(h.id,{index:d})]):[3,13];case 11:i.sent(),i.label=12;case 12:return a++,[3,10];case 13:return[3,15];case 14:throw p=i.sent(),new Error("Failed to reorder folder "+e+": "+p.message);case 15:return[4,f()];case 16:return i.sent(),[2]}}))}))},e.prototype.updateFolder=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return c.default.log("(tabs)UPDATEFOLDER (noop)",e),[2]}))}))},e.prototype.removeFolder=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return t=e.id,c.default.log("(tabs)REMOVEFOLDER",t),[4,this.queue.add((function(){return s.default.window.remove(t)}))];case 1:return r.sent(),[2]}}))}))},e.prototype.isAvailable=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,s.default.tabs.query({windowType:"normal"})];case 1:return e=t.sent(),[2,Boolean(e.length)]}}))}))},e}();function f(){return Promise.race([new Promise((function(e){s.default.tabs.onUpdated.addListener((function t(){s.default.tabs.onUpdated.removeListener(t),setTimeout((function(){return e()}),100)}))})),new Promise((function(e){return setTimeout(e,300)}))])}t.default=h},84386:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=i(r(89185)),u=i(r(64969)),d=r(2142),h=c(r(29242)),f=function(){function e(e,t,r,n,o,i){void 0===o&&(o=!0),void 0===i&&(i=!0),this.oldTree=e,this.newTree=t,this.mergeable=r,this.preserveOrder=n,this.checkHashes=void 0===o||o,this.hasCache=i,this.result={CREATE:new u.default,UPDATE:new u.default,MOVE:new u.default,REMOVE:new u.default,REORDER:new u.default}}return e.prototype.getDiffs=function(){return this.result},e.prototype.run=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.diffItem(this.oldTree,this.newTree)];case 1:return e.sent(),[4,this.findMoves()];case 2:return e.sent(),[4,this.addReorders()];case 3:return e.sent(),[2,this.result]}}))}))},e.prototype.diffItem=function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,Promise.resolve()];case 1:if(r.sent(),h.default.log("Calculating diff for ",e,t),"folder"===e.type&&"folder"===t.type)return[2,this.diffFolder(e,t)];if("bookmark"===e.type&&"bookmark"===t.type)return[2,this.diffBookmark(e,t)];throw new Error("Mismatched diff items: "+e.type+", "+t.type)}}))}))},e.prototype.diffFolder=function(e,t){return a(this,void 0,void 0,(function(){var r,n=this;return s(this,(function(o){switch(o.label){case 0:return this.checkHashes?[4,this.folderHasChanged(e,t)]:[3,2];case 1:if(!o.sent())return[2];o.label=2;case 2:return e.title!==t.title&&void 0!==e.parentId&&void 0!==t.parentId&&this.result.UPDATE.commit({type:u.ActionType.UPDATE,payload:t,oldItem:e}),r=t.children.slice(0),[4,l.map(e.children,(function(e,o){return a(n,void 0,void 0,(function(){var n,i=this;return s(this,(function(a){switch(a.label){case 0:return(n=r.find((function(t){return e.type===t.type&&i.mergeable(e,t)})))?[4,this.diffItem(e,n)]:[3,2];case 1:return a.sent(),r.splice(r.indexOf(n),1),[2];case 2:return t.isRoot&&t.location===d.ItemLocation.LOCAL||this.result.REMOVE.commit({type:u.ActionType.REMOVE,payload:e,index:o}),[2]}}))}))}),1)];case 3:return o.sent(),[4,l.map(r,(function(t,r){return a(n,void 0,void 0,(function(){return s(this,(function(n){return e.isRoot&&e.location===d.ItemLocation.LOCAL||this.result.CREATE.commit({type:u.ActionType.CREATE,payload:t,index:r}),[2]}))}))}),1)];case 4:return o.sent(),t.children.length>1&&this.result.REORDER.commit({type:u.ActionType.REORDER,payload:t,order:t.children.map((function(e){return{type:e.type,id:e.id}}))}),[2]}}))}))},e.prototype.diffBookmark=function(e,t){return a(this,void 0,void 0,(function(){var r;return s(this,(function(n){switch(n.label){case 0:return this.checkHashes?[4,this.bookmarkHasChanged(e,t)]:[3,2];case 1:return r=n.sent(),[3,3];case 2:r=e.title!==t.title||e.url!==t.url,n.label=3;case 3:return r&&this.result.UPDATE.commit({type:u.ActionType.UPDATE,payload:t,oldItem:e}),[2]}}))}))},e.prototype.bookmarkHasChanged=function(e,t){return a(this,void 0,void 0,(function(){var r,n;return s(this,(function(o){switch(o.label){case 0:return[4,e.hash()];case 1:return r=o.sent(),[4,t.hash()];case 2:return n=o.sent(),[2,r!==n]}}))}))},e.prototype.folderHasChanged=function(e,t){return a(this,void 0,void 0,(function(){var r,n;return s(this,(function(o){switch(o.label){case 0:return[4,e.hash(this.preserveOrder)];case 1:return r=o.sent(),[4,t.hash(this.preserveOrder)];case 2:return n=o.sent(),[2,r!==n]}}))}))},e.prototype.findMoves=function(){return a(this,void 0,void 0,(function(){var e,t,r,n,o,i,a,c,l,f,p=this;return s(this,(function(g){switch(g.label){case 0:h.default.log("Scanner: Finding moves"),r=!0,g.label=1;case 1:if(!r)return[3,13];r=!1,n=void 0,o=void 0,e=this.result.CREATE.getActions(),g.label=2;case 2:return r||!(n=e.shift())?[3,9]:[4,Promise.resolve()];case 3:g.sent(),i=n.payload,t=this.result.REMOVE.getActions(),g.label=4;case 4:return r||!(o=t.shift())?[3,8]:[4,Promise.resolve()];case 5:return g.sent(),a=o.payload,this.mergeable(a,i)&&("folder"!==a.type||!this.hasCache&&a.childrenSimilarity(i)>.8)?(this.result.CREATE.retract(n),this.result.REMOVE.retract(o),this.result.MOVE.commit({type:u.ActionType.MOVE,payload:i,oldItem:a,index:n.index,oldIndex:o.index}),r=!0,[4,this.diffItem(a,i)]):[3,7];case 6:g.sent(),g.label=7;case 7:return[3,4];case 8:return[3,2];case 9:e=this.result.CREATE.getActions(),c=function(){var e,i;return s(this,(function(a){switch(a.label){case 0:return[4,Promise.resolve()];case 1:a.sent(),e=n.payload,t=l.result.REMOVE.getActions(),i=function(){var t,i,a,c,h,f,g,v,y,m,b;return s(this,(function(s){switch(s.label){case 0:return[4,Promise.resolve()];case 1:return s.sent(),t=o.payload,(i=t.findItemFilter(e.type,(function(t){return p.mergeable(t,e)}),(function(t){return t.childrenSimilarity(e)})))?(a=void 0,l.result.CREATE.retract(n),i===t?l.result.REMOVE.retract(o):(c=t.clone(!0),h=c.findItem(d.ItemType.FOLDER,i.parentId),f=c.findItem(i.type,i.id),a=h.children.indexOf(f),h.children.splice(a,1),o.payload=c,o.payload.createIndex()),l.result.MOVE.commit({type:u.ActionType.MOVE,payload:e,oldItem:i,index:n.index,oldIndex:a||o.index}),r=!0,i.type!==d.ItemType.FOLDER?[3,3]:[4,l.diffItem(i,e)]):[3,4];case 2:s.sent(),s.label=3;case 3:return[3,6];case 4:return g=e.findItemFilter(t.type,(function(e){return p.mergeable(t,e)}),(function(e){return e.childrenSimilarity(t)})),v=void 0,g?(l.result.REMOVE.retract(o),g===e?l.result.CREATE.retract(n):(y=e.clone(!0),m=y.findItem(d.ItemType.FOLDER,g.parentId),b=y.findItem(g.type,g.id),v=m.children.indexOf(b),m.children.splice(v,1),n.payload=y,n.payload.createIndex()),l.result.MOVE.commit({type:u.ActionType.MOVE,payload:g,oldItem:t,index:v||n.index,oldIndex:o.index}),r=!0,t.type!==d.ItemType.FOLDER?[3,6]:[4,l.diffItem(t,g)]):[3,6];case 5:s.sent(),s.label=6;case 6:return[2]}}))},a.label=2;case 2:return r||!(o=t.shift())?[3,4]:[5,i()];case 3:return a.sent(),[3,2];case 4:return[2]}}))},l=this,g.label=10;case 10:return r||!(n=e.shift())?[3,12]:[5,c()];case 11:return g.sent(),[3,10];case 12:return[3,1];case 13:return f=this.result.MOVE.getActions(),this.result.UPDATE.getActions().forEach((function(e){f.find((function(t){return String(t.payload.id)===String(e.payload.id)}))&&p.result.UPDATE.retract(e)})),[2]}}))}))},e.prototype.addReorders=function(){return a(this,void 0,void 0,(function(){var e,t,r,n,o,i,a,c=this;return s(this,(function(s){for(a in h.default.log("Scanner: Generate reorders"),e={},t={},this.result.CREATE.getActions().forEach((function(t){e[t.payload.parentId]=!0})),this.result.REMOVE.getActions().forEach((function(e){t[e.payload.parentId]=!0})),this.result.MOVE.getActions().forEach((function(r){e[r.payload.parentId]=!0,t[r.oldItem.parentId]=!0})),r=function(t){var r=n.oldTree.findItem(d.ItemType.FOLDER,t);if(!r)return"continue";var o=n.newTree.findItemFilter(d.ItemType.FOLDER,(function(e){return c.mergeable(r,e)}));o&&(e[o.id]=!0)},n=this,t)r(a);for(a in o=function(e){var t=i.newTree.findItem(d.ItemType.FOLDER,e),r=i.result.REORDER.getActions().find((function(e){return String(e.payload.id)===String(t.id)}));r&&i.result.REORDER.retract(r),i.result.REORDER.commit({type:u.ActionType.REORDER,payload:t,order:t.children.map((function(e){return{type:e.type,id:e.id}}))})},i=this,e)o(a);return[2]}))}))},e}();t.default=f},87319:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f}),r(23792),r(72712),r(3362),r(98992),r(23215),r(3949),r(81454),r(8872),r(62953);var n=r(39529),o=r(81849),i=r(3363),a=r.n(i),s=r(60563),c=r(15879),l=r.n(c),u=r(94557);const d=36e5;class h{constructor(e){this.ctl=e,this.backgroundSyncEnabled=!0,setInterval((()=>this.checkSync()),25e3),o.l.addListener("networkStatusChange",(e=>{e.connected?this.backgroundSyncEnabled=!0:this.backgroundSyncEnabled=!1}))}async checkSync(){if(!this.backgroundSyncEnabled)return;const e=await s.default.getAllAccounts();for(let t of e){const e=(await l().get(t)).getData(),r=e.lastSync||0,n=e.syncInterval||15;if(e.scheduled)this.ctl.scheduleSync(t);else if(e.error&&e.errorCount>1){if(Date.now()>this.getBackoffInterval(n,e.errorCount,r)+r){this.ctl.scheduleSync(t);continue}}else Date.now()>1e3*n*60+e.lastSync&&this.ctl.scheduleSync(t)}}getBackoffInterval(e,t,r){const n=Math.log2(d/(1e3*e*60));return t<n||r+d>Date.now()?Math.min(d,1e3*e*60*Math.pow(2,t)):d+d*(t-n)}}class f{constructor(){this.schedule={},this.listeners=[],this.alarms=new h(this),n.Preferences.get({key:"accountsLocked"}).then((async e=>{let{value:t}=e;this.setEnabled(!t),this.unlocked=!t,t&&(this.key=null)}))}setEnabled(e){this.enabled=e}async unlock(e){let t=await n.Preferences.get({key:"accountsLocked"});if(t){let r=await a().sha256(e);if(await a().decryptAES(e,t,"FLOCCUS")!==r)throw new Error("The provided key was wrong");this.key=e}this.unlocked=!0,this.setEnabled(!0)}getUnlocked(){return Promise.resolve(this.unlocked)}async scheduleAll(){const e=await l().getAllAccounts();for(const t of e)this.scheduleSync(t.id)}async scheduleSync(e,t){if(t)return this.schedule[e]&&clearTimeout(this.schedule[e]),void(this.schedule[e]=setTimeout((()=>this.scheduleSync(e)),7e3));let r=await l().get(e);r.getData().syncing||(r.getData().enabled||r.getData().scheduled)&&(await this.getStatus()!==u.$7?!0===r.getData().scheduled?await this.syncAccount(e):await this.syncAccount(e,r.getData().scheduled):await r.setData({scheduled:r.getData().scheduled||!0}))}async cancelSync(e,t){let r=await l().get(e);t||await r.setData({enabled:!1}),await r.cancelSync()}async syncAccount(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;let n=await l().get(e);if(!n.getData().syncing){setTimeout((()=>this.updateStatus()),500);try{await n.sync(t,r)}catch(e){console.error(e)}this.updateStatus()}}async updateStatus(){this.listeners.forEach((e=>e()))}async getStatus(){if(!this.unlocked)return u.uD;const e=await l().getAllAccounts();let t=e.reduce(((e,t)=>{const r=t.getData();return e===u.$7||r.syncing?u.$7:e===u.uD||r.error&&!r.syncing?u.uD:u.oe}),u.oe);return t===u.oe&&e.every((e=>!e.getData().enabled))&&(t=u.CQ),t}onStatusChange(e){this.listeners.push(e);let t=!1;return()=>{t||(this.listeners.splice(this.listeners.indexOf(e),1),t=!0)}}async onLoad(){const e=await l().getAllAccounts();await Promise.all(e.map((async e=>{e.getData().syncing&&await e.setData({syncing:!1,scheduled:!1})})))}}let p;f.getSingleton=function(){return p||(p=new f),p}},90910:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(16546),d=l(r(91557)),h=l(r(29242)),f=r(2142),p=r(8127),g=l(r(18465)),v=a(r(89185)),y=l(r(60721)),m=l(r(35970)),b=r(94780),w=3e5,k=function(){function e(e){this.hasFeatureBulkImport=null,this.canceled=!1,this.cancelCallback=null,this.ended=!1,this.locked=!1,this.hasFeatureJavascriptLinks=null,this.server=e,this.fetchQueue=new y.default({concurrency:12}),this.bookmarkLock=new g.default,this.abortController=new AbortController,this.abortSignal=this.abortController.signal}return e.getDefaultValues=function(){return{type:"nextcloud-bookmarks",url:"https://example.org",username:"bob",password:"s3cret",serverRoot:"",includeCredentials:!1,allowRedirects:!1,allowNetwork:!1}},e.prototype.setData=function(e){this.server=n({},e)},e.prototype.getData=function(){return n(n({},e.getDefaultValues()),this.server)},e.prototype.getLabel=function(){var e=this.getData();return e.label||(e.username.includes("@")?e.username+" on "+new URL(e.url).hostname:e.username+"@"+new URL(e.url).hostname)},e.prototype.acceptsBookmark=function(e){try{return Boolean(~["https:","http:","ftp:"].concat(this.hasFeatureJavascriptLinks?["javascript:"]:[]).indexOf(new URL(e.url).protocol))}catch(e){return!1}},e.prototype.normalizeServerURL=function(e){var t=new URL(e),r=t.pathname.indexOf("index.php");t.pathname||(t.pathname=""),t.search="",t.hash="",t.pathname=t.pathname.substring(0,~r?r:void 0);var n=t.toString();return n+("/"!==n[n.length-1]?"/":"")},e.prototype.onSyncStart=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=!1),s(this,void 0,void 0,(function(){var e,n,o,i,s,l=this;return c(this,(function(c){switch(c.label){case 0:return"web"!==u.Capacitor.getPlatform()?[3,6]:[4,Promise.resolve().then((function(){return a(r(7737))}))];case 1:e=c.sent().default,n=void 0,o=!1,c.label=2;case 2:return c.trys.push([2,4,,5]),[4,e.permissions.contains({origins:[this.server.url+"/"]})];case 3:return n=c.sent(),[3,5];case 4:return i=c.sent(),o=!0,console.warn(i),[3,5];case 5:if(!o&&!n)throw new b.MissingPermissionsError;c.label=6;case 6:return[4,this.checkFeatureJavascriptLinks()];case 7:return c.sent(),this.abortController=new AbortController,this.abortSignal=this.abortController.signal,this.lockingInterval&&clearInterval(this.lockingInterval),s=this,[4,this.acquireLock()];case 8:if(s.locked=c.sent(),t)this.locked=!0;else if(!this.locked)throw new b.ResourceLockedError;return this.lockingInterval=setInterval((function(){return!l.ended&&l.acquireLock()}),12e4),this.canceled=!1,this.ended=!1,[2]}}))}))},e.prototype.onSyncComplete=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.ended=!0,clearInterval(this.lockingInterval),[4,this.releaseLock()];case 1:return e.sent(),[2]}}))}))},e.prototype.onSyncFail=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.ended=!0,clearInterval(this.lockingInterval),[4,this.releaseLock()];case 1:return e.sent(),[2]}}))}))},e.prototype.cancel=function(){this.canceled=!0,this.fetchQueue.clear(),this.abortController.abort(),this.cancelCallback&&this.cancelCallback()},e.prototype.getBookmarksList=function(){return s(this,void 0,void 0,(function(){var e=this;return c(this,(function(t){return[2,this.bookmarkLock.acquire("list",(function(){return s(e,void 0,void 0,(function(){var e,t,r,o;return c(this,(function(i){switch(i.label){case 0:if(this.list)return[2,this.list];h.default.log("Fetching bookmarks"),e=0,t=[],i.label=1;case 1:return[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/bookmark?page=".concat(e,"&limit=").concat(300))];case 2:if(r=i.sent(),!Array.isArray(r.data))throw new b.UnexpectedServerResponseError;t=t.concat(r.data),e++,i.label=3;case 3:if(300===r.data.length)return[3,1];i.label=4;case 4:return o=(0,m.default)(t.map((function(e){var t={id:e.id,url:e.target||e.url,title:e.title,parentId:null,location:f.ItemLocation.SERVER};return e.folders.map((function(e){var r=n({},t);return r.parentId=e,new f.Bookmark(r)}))}))),h.default.log("Received bookmarks from server",o),this.list=o,[2,o]}}))}))}))]}))}))},e.prototype.getBookmarksTree=function(e){return void 0===e&&(e=!1),s(this,void 0,void 0,(function(){return c(this,(function(t){return this.list=null,e?[2,this.getCompleteBookmarksTree()]:[2,this.getSparseBookmarksTree()]}))}))},e.prototype._getChildFolders=function(e,t){return void 0===t&&(t=0),s(this,void 0,void 0,(function(){var r;return c(this,(function(n){switch(n.label){case 0:return[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/folder?root=".concat(e,"&layers=").concat(t))];case 1:if(r=n.sent(),!Array.isArray(r.data))throw new b.UnexpectedServerResponseError;return[2,r.data]}}))}))},e.prototype._findServerRoot=function(){return s(this,void 0,void 0,(function(){var e,t=this;return c(this,(function(r){switch(r.label){case 0:return e=new f.Folder({id:-1,location:f.ItemLocation.SERVER}),[4,v.each(this.server.serverRoot.split("/").slice(1),(function(r){return s(t,void 0,void 0,(function(){var t,n,o,i;return c(this,(function(a){switch(a.label){case 0:return e.children&&e.children.length?(t=e.children,[3,3]):[3,1];case 1:return[4,this._getChildFolders(e.id)];case 2:t=a.sent(),a.label=3;case 3:return(n=t.find((function(e){return e.title===r})))?[3,5]:(o={parent_folder:e.id,title:r},[4,this.sendRequest("POST","index.php/apps/bookmarks/public/rest/v2/folder","application/json",o)]);case 4:if("object"!=typeof(i=a.sent()).item)throw new b.UnexpectedServerResponseError;n={id:i.item.id,children:[],title:i.item.title},a.label=5;case 5:return e=new f.Folder({id:n.id,title:n.title,location:f.ItemLocation.SERVER}),[2]}}))}))}),1)];case 1:return r.sent(),[2,e]}}))}))},e.prototype.getCompleteBookmarksTree=function(){return s(this,void 0,void 0,(function(){var e,t;return c(this,(function(r){switch(r.label){case 0:return e=new f.Folder({id:-1,location:f.ItemLocation.SERVER}),this.server.serverRoot?[4,this._findServerRoot()]:[3,2];case 1:e=r.sent(),r.label=2;case 2:return t=e,[4,this._getChildren(e.id,-1)];case 3:return t.children=r.sent(),this.tree=e,[2,e.clone()]}}))}))},e.prototype.getSparseBookmarksTree=function(){return s(this,void 0,void 0,(function(){var e,t,r;return c(this,(function(n){switch(n.label){case 0:return e=new f.Folder({id:-1,location:f.ItemLocation.SERVER}),this.server.serverRoot?[4,this._findServerRoot()]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return this.list=null,e.loaded=!1,t=e,r={},[4,this._getFolderHash(e.id)];case 3:return t.hashValue=(r.true=n.sent(),r),this.tree=e.clone(!0),[2,e]}}))}))},e.prototype._getFolderHash=function(e){return s(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/folder/".concat(e,"/hash")).catch((function(){return{data:"0"}})).then((function(e){return e.data}))]}))}))},e.prototype._getChildren=function(e,t){return s(this,void 0,void 0,(function(){var r,n,o,i=this;return c(this,(function(a){switch(a.label){case 0:return[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/folder/".concat(e,"/children?layers=").concat(t))];case 1:return r=a.sent(),n=r.data,o=function(e,t){return t.map((function(t){if("bookmark"===t.type)return"target"in t&&null===i.hasFeatureJavascriptLinks&&(i.hasFeatureJavascriptLinks=!0),new f.Bookmark({id:t.id+";"+e,title:t.title,parentId:e,url:t.target||t.url,location:f.ItemLocation.SERVER});if("folder"===t.type){var r=new f.Folder({id:t.id,parentId:e,title:t.title,location:f.ItemLocation.SERVER});return r.loaded=Boolean(t.children),r.children=o(t.id,t.children||[]),r}}))},[2,o(e,n)]}}))}))},e.prototype.loadFolderChildren=function(e,t){return s(this,void 0,void 0,(function(){var r,n,o,i=this;return c(this,(function(a){switch(a.label){case 0:if(!(r=this.tree.findFolder(e)))throw new Error("Could not find folder for loadFolderChildren");return r.loaded?[2,r.clone(!0).children]:t?[4,this._getChildren(e,-1)]:[3,2];case 1:return n=a.sent(),[3,5];case 2:return[4,this._getChildren(e,1)];case 3:return n=a.sent(),o=function(e){return s(i,void 0,void 0,(function(){var t=this;return c(this,(function(r){return[2,v.each(e,(function(e){return s(t,void 0,void 0,(function(){var t;return c(this,(function(r){switch(r.label){case 0:return e instanceof f.Folder?e.loaded?[3,2]:[4,this._getFolderHash(e.id)]:[2];case 1:t=r.sent(),e.hashValue={true:t},r.label=2;case 2:return[4,o(e.children)];case 3:return r.sent(),[2]}}))}))}),5)]}))}))},[4,o(n)];case 4:a.sent(),a.label=5;case 5:return r.children=n,r.loaded=!0,this.tree.createIndex(),[2,r.clone(!0).children]}}))}))},e.prototype.createFolder=function(e){return s(this,void 0,void 0,(function(){var t,r,n,o,i;return c(this,(function(a){switch(a.label){case 0:if(h.default.log("(nextcloud-folders)CREATEFOLDER",{folder:e}),t=e.parentId,r=e.title,!(n=this.tree.findFolder(t)))throw new b.UnknownCreateTargetError;return o={parent_folder:t,title:r},[4,this.sendRequest("POST","index.php/apps/bookmarks/public/rest/v2/folder","application/json",o)];case 1:if("object"!=typeof(i=a.sent()).item)throw new b.UnexpectedServerResponseError;return n.children.push(new f.Folder({id:i.item.id,title:r,parentId:t,location:f.ItemLocation.SERVER})),this.tree.createIndex(),[2,i.item.id]}}))}))},e.prototype.bulkImportFolder=function(e,t){return s(this,void 0,void 0,(function(){var r,n,o,i,a,s,l;return c(this,(function(c){switch(c.label){case 0:if(!1===this.hasFeatureBulkImport)throw new Error("Current server does not support bulk import");if(t.count()>75)throw new Error("Refusing to bulk import more than 75 bookmarks");if(h.default.log("(nextcloud-folders)BULKIMPORT",{parentId:e,folder:t}),!(r=this.tree.findFolder(e)))throw new b.UnknownCreateTargetError;n=new Blob(["<!DOCTYPE NETSCAPE-Bookmark-file-1>\n",'<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">\n',d.default.serialize(t)],{type:"text/html"}),(o=new FormData).append("bm_import",n,"upload.html"),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.sendRequest("POST","index.php/apps/bookmarks/public/rest/v2/folder/".concat(e,"/import"),"multipart/form-data",o)];case 2:return i=c.sent(),[3,4];case 3:throw a=c.sent(),this.hasFeatureBulkImport=!1,a;case 4:return s=function(e,t,r,n){return new f.Folder({id:t,title:r,parentId:n,location:f.ItemLocation.SERVER,children:e.map((function(e){if("bookmark"===e.type)return new f.Bookmark({id:e.id+";"+t,title:e.title,url:e.target||e.url,parentId:t,location:f.ItemLocation.SERVER});if("folder"===e.type)return s(e.children,e.id,e.title,t);throw console.log("PEBCAK",e),new Error("PEBKAC")}))})},l=s(i.data,e,t.title,t.parentId),r.children=l.clone(!0).children,this.tree.createIndex(),[2,l]}}))}))},e.prototype.updateFolder=function(e){return s(this,void 0,void 0,(function(){var t,r,n,o,i;return c(this,(function(a){switch(a.label){case 0:if(h.default.log("(nextcloud-folders)UPDATEFOLDER",{folder:e}),t=e.id,!(r=this.tree.findFolder(e.id)))throw new b.UnknownFolderUpdateError;if(r.findFolder(e.parentId))throw new Error("Detected folder loop creation");return n={parent_folder:e.parentId,title:e.title},[4,this.sendRequest("PUT","index.php/apps/bookmarks/public/rest/v2/folder/".concat(t),"application/json",n)];case 1:if(a.sent(),!(o=this.tree.findFolder(r.parentId)))throw new b.UnknownFolderParentUpdateError;if(o.children=o.children.filter((function(e){return String(e.id)!==String(t)})),!(i=this.tree.findFolder(e.parentId)))throw new b.UnknownMoveTargetError;return i.children.push(r),r.title=e.title,r.parentId=e.parentId,this.tree.createIndex(),[2]}}))}))},e.prototype.orderFolder=function(e,t){return s(this,void 0,void 0,(function(){var r;return c(this,(function(n){switch(n.label){case 0:return h.default.log("(nextcloud-folders)ORDERFOLDER",{id:e,order:t}),r={data:t.map((function(e){return{id:String(e.id).split(";")[0],type:e.type}}))},[4,this.sendRequest("PATCH","index.php/apps/bookmarks/public/rest/v2/folder/".concat(e,"/childorder"),"application/json",r)];case 1:return n.sent(),[2]}}))}))},e.prototype.removeFolder=function(e){return s(this,void 0,void 0,(function(){var t,r,n;return c(this,(function(o){switch(o.label){case 0:return h.default.log("(nextcloud-folders)REMOVEFOLDER",{folder:e}),t=e.id,(r=this.tree.findFolder(t))?[4,this.sendRequest("DELETE","index.php/apps/bookmarks/public/rest/v2/folder/".concat(t))]:[2];case 1:return o.sent(),(n=this.tree.findFolder(r.parentId))&&(n.children=n.children.filter((function(e){return String(e.id)!==String(t)})),this.tree.createIndex()),[2]}}))}))},e.prototype._getBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r;return c(this,(function(n){switch(n.label){case 0:return h.default.log("Fetching single bookmark"),[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/bookmark/"+e)];case 1:if("object"!=typeof(t=n.sent()).item)throw new b.UnexpectedServerResponseError;return(r=t.item).folders.length||(r.folders=[null]),[2,r.folders.map((function(e){return new f.Bookmark({id:r.id+";"+e,url:r.target||r.url,title:r.title,parentId:e,tags:r.tags,location:f.ItemLocation.SERVER})}))]}}))}))},e.prototype.getExistingBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r,o;return c(this,(function(i){switch(i.label){case 0:return e.toLowerCase().startsWith("javascript:")?this.hasFeatureJavascriptLinks?[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/bookmark?page=-1&search[]=".concat(encodeURIComponent("javascript:")))]:[2,!1]:[3,2];case 1:return(t=i.sent()).data.length&&(r=t.data.find((function(t){return t.target===e})))?[2,n(n({},r),{parentId:r.folders[0],url:e})]:[2,!1];case 2:return[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/bookmark?url=".concat(encodeURIComponent(e)))];case 3:return(o=i.sent()).data.length?[2,n(n({},o.data[0]),{parentId:o.data[0].folders[0],url:e})]:[2,!1]}}))}))},e.prototype.createBookmark=function(e){return s(this,void 0,void 0,(function(){var t=this;return c(this,(function(r){return h.default.log("(nextcloud-folders)CREATE",e),[2,this.bookmarkLock.acquire(e.url,(function(){return s(t,void 0,void 0,(function(){var t,r,n,o,i,a,s;return c(this,(function(c){switch(c.label){case 0:if(this.tree&&!(t=this.tree.findFolder(e.parentId)))throw new b.UnknownCreateTargetError;return[4,this.getExistingBookmark(e.url)];case 1:return(r=c.sent())?(e.id=r.id+";"+e.parentId,(n=e.clone()).title=r.title,[4,this.updateBookmark(n)]):[3,3];case 2:return c.sent(),[3,8];case 3:o={url:e.url,title:e.title,folders:[e.parentId]},i=void 0,c.label=4;case 4:return c.trys.push([4,6,,7]),[4,this.sendRequest("POST","index.php/apps/bookmarks/public/rest/v2/bookmark","application/json",o)];case 5:return i=c.sent(),[3,7];case 6:if((a=c.sent())instanceof b.HttpError)throw new b.CreateBookmarkError(e);throw a;case 7:if("object"!=typeof i.item)throw new b.UnexpectedServerResponseError;e.id=i.item.id+";"+e.parentId,c.label=8;case 8:return(s=e.clone()).id=e.id.split(";")[0],this.list&&this.list.push(s),this.tree&&(t.children.push(s),this.tree.createIndex()),[2,e.id]}}))}))}))]}))}))},e.prototype.updateBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r,n,o=this;return c(this,(function(i){return h.default.log("(nextcloud-folders)UPDATE",e),t=String(e.id).split(";"),r=t[0],n=t[1],[2,this.bookmarkLock.acquire(r,(function(){return s(o,void 0,void 0,(function(){var t,o,i,a,s=this;return c(this,(function(c){switch(c.label){case 0:return[4,this._getBookmark(r)];case 1:if(t=c.sent(),!(o=this.tree.findFolder(e.parentId)))throw new b.UnknownCreateTargetError;i={url:e.url,title:e.title,folders:t.map((function(e){return e.parentId})).filter((function(t){return t&&String(t)!==String(n)&&(!s.tree.findFolder(t)||s.tree.findFolder(t).findItemFilter("bookmark",(function(t){return t.canMergeWith(e)}))||!s.tree.findFolder(t).loaded)})).concat([e.parentId]),tags:t[0].tags},c.label=2;case 2:return c.trys.push([2,4,,5]),[4,this.sendRequest("PUT","index.php/apps/bookmarks/public/rest/v2/bookmark/".concat(r),"application/json",i)];case 3:return c.sent(),[3,5];case 4:if((a=c.sent())instanceof b.HttpError)throw new b.UpdateBookmarkError(e);throw a;case 5:return o.children.find((function(t){return String(t.id)===String(e.id)&&"bookmark"===t.type}))||o.children.push(e),e.id=r+";"+e.parentId,this.tree.createIndex(),[2,e.id]}}))}))}))]}))}))},e.prototype.removeBookmark=function(e){return s(this,void 0,void 0,(function(){var t,r,n,o,i=this;return c(this,(function(a){return h.default.log("(nextcloud-folders)REMOVE",{bookmark:e}),t=e.id,r=String(t).split(";"),n=r[0],o=r[1],[2,this.bookmarkLock.acquire(n,(function(){return s(i,void 0,void 0,(function(){var e,t,r;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.sendRequest("DELETE","index.php/apps/bookmarks/public/rest/v2/folder/".concat(o,"/bookmarks/").concat(n))];case 1:return i.sent(),[4,this.getBookmarksList()];case 2:return e=i.sent(),t=e.findIndex((function(e){return String(e.id)===String(n)})),e.splice(t,1),[3,4];case 3:return r=i.sent(),h.default.log("Error removing bookmark from folder: "+r.message+"\n Moving on."),[3,4];case 4:return[2]}}))}))}))]}))}))},e.prototype.checkFeatureJavascriptLinks=function(){return s(this,void 0,void 0,(function(){var e,t;return c(this,(function(r){switch(r.label){case 0:if(null!==this.hasFeatureJavascriptLinks)return[2];r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this.sendRequest("GET","index.php/apps/bookmarks/public/rest/v2/bookmark?page=1&limit=1")];case 2:if((e=r.sent()).data.length)return[3,8];this.hasFeatureJavascriptLinks=!0,r.label=3;case 3:return r.trys.push([3,6,,7]),[4,this.createBookmark(new f.Bookmark({id:null,parentId:"-1",title:"floccus",url:"javascript:void(0)",location:f.ItemLocation.SERVER}))];case 4:return t=r.sent(),[4,this.removeBookmark(new f.Bookmark({id:t,parentId:"-1",title:"floccus",url:"javascript:void(0)",location:f.ItemLocation.SERVER}))];case 5:return r.sent(),[3,7];case 6:return r.sent(),this.hasFeatureJavascriptLinks=!1,[3,7];case 7:return[2];case 8:return this.hasFeatureJavascriptLinks="target"in e.data[0],[3,10];case 9:return r.sent(),this.hasFeatureJavascriptLinks=!1,[3,10];case 10:return[2]}}))}))},e.prototype.sendRequest=function(e,t,r,o,i){return void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=!1),s(this,void 0,void 0,(function(){var a,s,l,d,f,g,v,y,m,k,E,R,S,O,I,T,_=this;return c(this,(function(c){switch(c.label){case 0:if(a=this.normalizeServerURL(this.server.url)+t,l=!1,r&&r.includes("application/json"))o=JSON.stringify(o);else if(r&&r.includes("application/x-www-form-urlencoded")){for(d=new URLSearchParams,f=0,g=Object.entries(o||{});f<g.length;f++)v=g[f],y=v[0],m=v[1],d.set(y,m);o=d.toString()}if(h.default.log("QUEUING ".concat(e," ").concat(a)),"web"!==u.Capacitor.getPlatform())return[2,this.sendRequestNative(e,a,r,o,i)];k=p.Base64.encode(this.server.username+":"+this.server.password),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.fetchQueue.add((function(){return h.default.log("FETCHING ".concat(e," ").concat(a)),Promise.race([fetch(a,n({method:e,credentials:_.server.includeCredentials?"include":"omit",headers:n(n({},r&&"multipart/form-data"!==r&&{"Content-type":r}),{Authorization:"Basic "+k}),signal:_.abortSignal},o&&!["get","head"].includes(e.toLowerCase())&&{body:o})),new Promise((function(e,t){return setTimeout((function(){l=!0,t(new b.RequestTimeoutError)}),w)}))])}))];case 2:return s=c.sent(),[3,4];case 3:if(E=c.sent(),l)throw E;if(this.canceled)throw new b.CancelledSyncError;throw console.log(E),new b.NetworkError;case 4:if(h.default.log("Receiving response for ".concat(e," ").concat(a)),s.redirected&&!this.server.allowRedirects)throw new b.RedirectError;if(i)return[2,s];if(401===s.status||403===s.status)throw new b.AuthenticationError;return 503===s.status||s.status>=400?(S=(R=h.default).log,O="".concat(e," ").concat(a,": Server responded with ").concat(s.status,": "),[4,s.text()]):[3,6];case 5:throw S.apply(R,[O+c.sent().substring(0,250)]),new b.HttpError(s.status,e);case 6:return c.trys.push([6,8,,9]),[4,s.json()];case 7:return I=c.sent(),[3,9];case 8:throw T=c.sent(),new b.ParseResponseError(T.message);case 9:if("success"!==I.status)throw new Error("Nextcloud API error for request "+e+" "+t+" : \n"+JSON.stringify(I));return[2,I]}}))}))},e.prototype.acquireLock=function(){return s(this,void 0,void 0,(function(){var e=this;return c(this,(function(t){return this.lockingPromise=s(e,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.sendRequest("POST","index.php/apps/bookmarks/public/rest/v2/lock",null,null,!0)];case 1:if(401===(e=t.sent()).status||403===e.status)throw new b.AuthenticationError;if(200!==e.status&&405!==e.status&&423!==e.status)throw new b.HttpError(e.status,"POST");return[2,200===e.status||405===e.status]}}))})),[2,this.lockingPromise]}))}))},e.prototype.releaseLock=function(){return s(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return this.lockingPromise?[4,this.lockingPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.locked?[4,this.sendRequest("DELETE","index.php/apps/bookmarks/public/rest/v2/lock",null,null,!0)]:[2];case 3:return[2,200===e.sent().status]}}))}))},e.prototype.sendRequestNative=function(e,t,r,o,i){return s(this,void 0,void 0,(function(){var a,s,l,d,f,g=this;return c(this,(function(c){switch(c.label){case 0:s=!1,l=p.Base64.encode(this.server.username+":"+this.server.password),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.fetchQueue.add((function(){return h.default.log("FETCHING ".concat(e," ").concat(t)),Promise.race([u.CapacitorHttp.request(n({url:t,method:e,disableRedirects:!g.server.allowRedirects,headers:n(n({},r&&"multipart/form-data"!==r&&{"Content-type":r}),{Authorization:"Basic "+l}),responseType:"json"},o&&!["get","head"].includes(e.toLowerCase())&&{data:o})),new Promise((function(e,t){return setTimeout((function(){s=!0,t(new b.RequestTimeoutError)}),w)}))])}))];case 2:return a=c.sent(),[3,4];case 3:if(d=c.sent(),s)throw d;throw console.log(d),new b.NetworkError;case 4:if(h.default.log("Receiving response for ".concat(e," ").concat(t)),a.status<400&&a.status>=300)throw new b.RedirectError;if(i)return[2,a];if(401===a.status||403===a.status)throw new b.AuthenticationError;if(503===a.status||a.status>=400)throw new b.HttpError(a.status,e);if("success"!==(f=a.data).status)throw new Error("Nextcloud API error for request "+e+" "+t+" : \n"+JSON.stringify(f));return[2,f]}}))}))},e.prototype.isAvailable=function(){return Promise.resolve(!0)},e.prototype.countClick=function(e){return s(this,void 0,void 0,(function(){var t;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.sendRequest("POST","index.php/apps/bookmarks/public/rest/v2/bookmark/click","application/json",{url:e})];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),console.warn(t),[3,3];case 3:return[2]}}))}))},e}();t.default=k},91557:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.parseByString=t.getRootFolder=void 0;var a=r(2142),s=i(r(54010)),c=function(){function e(){}return e.prototype.serialize=function(e){return"<DL><p>\n".concat(this._serializeFolder(e,""),"</DL><p>\n")},e.prototype._htmlentities_encode=function(e){return e.replace(/[<>&"']/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))},e.prototype._serializeFolder=function(e,t){var r=this;return e.children.map((function(e){if(e instanceof a.Bookmark)return"".concat(t,'<DT><A HREF="').concat(r._htmlentities_encode(e.url),'" TAGS="').concat("",'" ID="').concat(e.id,'">').concat(r._htmlentities_encode(e.title),"</A>\n");if(e instanceof a.Folder){var n=t+"  ";return"".concat(t,'<DT><H3 ID="').concat(e.id,'">').concat(r._htmlentities_encode(e.title),"</H3>\n")+"".concat(t,"<DL><p>\n").concat(r._serializeFolder(e,n)).concat(t,"</DL><p>\n")}})).join("")},e.prototype.deserialize=function(e){var r=(0,t.parseByString)(e);return r.forEach((function(e){e.parentId="0"})),new a.Folder({id:"0",title:"root",children:r,location:a.ItemLocation.SERVER,isRoot:!0})},e}();t.default=new c,t.getRootFolder=function(e){var t=e.find("h3").first();return"string"==typeof t.attr("personal_toolbar_folder")?e.children("dl").first():"string"==typeof t.attr("folded")?e:("string"==typeof t.attr("item_id")||t.text(),e.children("dl").first())},t.parseByString=function(e){var r=s.load(e),n=r("body"),o=[],i=(0,t.getRootFolder)(n).children("dt"),c=function(e,t){var n=e.children().eq(0),o=void 0!==n.text()?n.text():"",i="",s=void 0!==n.attr("id")?n.attr("id"):"",l=[];switch(n[0].name){case"h3":return l=e.children("dl").first().children().toArray().map((function(e){return"dt"!==e.name?null:c(r(e),s)})).filter((function(e){return null!==e})),new a.Folder({id:s,title:o,parentId:t,children:l,location:a.ItemLocation.SERVER});case"a":return i=n.attr("href")||"",new a.Bookmark({id:s,title:o,url:i,parentId:t,location:a.ItemLocation.SERVER})}throw new Error("Failed to parse")};return i.each((function(e,t){var n=r(t),i=c(n);o.push(i)})),o}},92444:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t},l=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=d(r(6221)),f=c(r(64969)),p=c(r(89185)),g=d(r(49845)),v=r(2142),y=d(r(29242)),m=r(94780),b=d(r(84386)),w=d(r(6221)),k=12,E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.setDirection=function(e){this.direction=e},t.prototype.getMembersToPersist=function(){return["localScanResult","serverScanResult","revertPlan","revertDonePlan","revertReorders"]},t.prototype.getDiffs=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o,i,a=this;return u(this,(function(s){switch(s.label){case 0:return e=this.mappings.getSnapshot(),t=[],r=new b.default(this.serverTreeRoot,this.localTreeRoot,(function(r,n){return n.type===r.type&&("bookmark"!==r.type||"bookmark"!==n.type||r.url===n.url)&&(r.canMergeWith(n)||!!g.default.mappable(e,r,n))&&(t.push([n,r]),!0)}),this.preserveOrder,!1,!1),n=new b.default(this.localTreeRoot,this.serverTreeRoot,(function(r,n){return n.type===r.type&&("bookmark"!==n.type||"bookmark"!==r.type||n.url===r.url)&&(n.canMergeWith(r)||!!g.default.mappable(e,n,r))&&(t.push([r,n]),!0)}),this.preserveOrder,!1,!1),[4,r.run()];case 1:return o=s.sent(),[4,n.run()];case 2:return i=s.sent(),[4,p.map(t,(function(e){var t=e[0],r=e[1];return a.addMapping(a.server,t,r.id)}))];case 3:return s.sent(),[2,{localScanResult:o,serverScanResult:i}]}}))}))},t.prototype.loadChildren=function(e){return l(this,void 0,void 0,(function(){var t;return u(this,(function(r){switch(r.label){case 0:return y.default.log("Unidirectional: Loading whole tree"),t=e,[4,this.server.getBookmarksTree(!0)];case 1:return t.children=r.sent().children,[2]}}))}))},t.prototype.sync=function(){return l(this,void 0,void 0,(function(){var e,t,r,n,o,i,a,s;return u(this,(function(c){switch(c.label){case 0:return this.progressCb(.15),this.masterLocation=this.direction===v.ItemLocation.SERVER?v.ItemLocation.LOCAL:v.ItemLocation.SERVER,[4,this.prepareSync()];case 1:if(c.sent(),this.progressCb(.35),this.canceled)throw new m.CancelledSyncError;return y.default.log({localTreeRoot:this.localTreeRoot,serverTreeRoot:this.serverTreeRoot,cacheTreeRoot:this.cacheTreeRoot}),this.localScanResult||this.serverScanResult?[3,3]:[4,this.getDiffs()];case 2:e=c.sent(),t=e.localScanResult,r=e.serverScanResult,y.default.log({localScanResult:t,serverScanResult:r}),this.localScanResult=t,this.serverScanResult=r,this.progressCb(.45),c.label=3;case 3:if(this.canceled)throw new m.CancelledSyncError;return this.direction===v.ItemLocation.SERVER?(n=this.localScanResult,o=this.serverScanResult,i=this.server):(n=this.serverScanResult,o=this.localScanResult,i=this.localTree),this.revertPlan?[3,5]:(a=this,[4,this.revertDiff(o,n,this.direction)]);case 4:a.revertPlan=c.sent(),y.default.log({revertPlan:this.revertPlan}),c.label=5;case 5:if(this.canceled)throw new m.CancelledSyncError;if(this.actionsPlanned=Object.values(this.revertPlan).reduce((function(e,t){return t.getActions().length+e}),0),this.direction===v.ItemLocation.LOCAL&&this.applyFailsafe(this.revertPlan.REMOVE),this.canceled)throw new m.CancelledSyncError;return y.default.log("Executing "+this.direction+" revert plan"),this.revertDonePlan={CREATE:new f.default,UPDATE:new f.default,MOVE:new f.default,REMOVE:new f.default,REORDER:new f.default},[4,this.executeRevert(i,this.revertPlan,this.direction,this.revertDonePlan,n.REORDER)];case 6:return c.sent(),"orderFolder"in this.server&&!this.revertReorders&&(s=this.mappings.getSnapshot(),y.default.log("Mapping reorderings"),this.revertReorders=n.REORDER.map(s,this.direction)),"orderFolder"in this.server&&"orderFolder"in i?[4,this.executeReorderings(i,this.revertReorders)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[2]}}))}))},t.prototype.revertDiff=function(e,t,r){return l(this,void 0,void 0,(function(){var n,o,a=this;return u(this,(function(s){switch(s.label){case 0:return n=this.mappings.getSnapshot(),o={CREATE:new f.default,UPDATE:new f.default,MOVE:new f.default,REMOVE:new f.default,REORDER:e.REORDER.clone()},[4,p.each(t.CREATE.getActions(),(function(e){return l(a,void 0,void 0,(function(){var t,a;return u(this,(function(s){switch(s.label){case 0:return[4,this.translateCompleteItem(e.payload,n,r)];case 1:return t=s.sent(),a=e.payload,t.createIndex(),a.createIndex(),o.CREATE.commit(i(i({},e),{type:f.ActionType.CREATE,payload:t,oldItem:a})),[2]}}))}))}),k)];case 1:return s.sent(),[4,p.each(e.CREATE.getActions(),(function(e){return l(a,void 0,void 0,(function(){return u(this,(function(t){return o.REMOVE.commit(i(i({},e),{type:f.ActionType.REMOVE})),[2]}))}))}),k)];case 2:return s.sent(),[4,p.each(e.UPDATE.getActions(),(function(e){return l(a,void 0,void 0,(function(){var t,r;return u(this,(function(n){return(t=e.oldItem.cloneWithLocation(!1,e.payload.location)).id=e.payload.id,t.parentId=e.payload.parentId,(r=e.payload.cloneWithLocation(!1,e.oldItem.location)).id=e.oldItem.id,r.parentId=e.oldItem.parentId,o.UPDATE.commit({type:f.ActionType.UPDATE,payload:t,oldItem:r}),[2]}))}))}),k)];case 3:return s.sent(),[4,p.each(e.MOVE.getActions(),(function(e){return l(a,void 0,void 0,(function(){var t;return u(this,(function(r){return(t=e.payload.cloneWithLocation(!1,e.oldItem.location)).id=e.oldItem.id,t.parentId=e.oldItem.parentId,o.MOVE.commit({type:f.ActionType.MOVE,payload:t}),[2]}))}))}),k)];case 4:return s.sent(),[2,o]}}))}))},t.prototype.translateCompleteItem=function(e,t,r){return l(this,void 0,void 0,(function(){var n,o,i=this;return u(this,(function(a){switch(a.label){case 0:return(n=e.cloneWithLocation(!1,r)).id=g.default.mapId(t,e,r),n.parentId=g.default.mapParentId(t,e,r),n instanceof v.Folder?(o=[],[4,n.traverse((function(e,n){return l(i,void 0,void 0,(function(){return u(this,(function(i){return e.id=g.default.mapId(t,e,r),void 0===e.id&&o.push(e),e.parentId=n.id,[2]}))}))}))]):[3,2];case 1:return a.sent(),n.createIndex(),o.forEach((function(e){var t=n.findFolder(e.parentId);t.children=t.children.filter((function(e){return e.id}))})),[3,3];case 2:n.createIndex(),a.label=3;case 3:return[2,n]}}))}))},t.prototype.executeRevert=function(e,t,r,n,o){return l(this,void 0,void 0,(function(){var i,a,s,c,l=this;return u(this,(function(u){switch(u.label){case 0:y.default.log("Executing revert plan for "+r),i=t.CREATE.getActions(),u.label=1;case 1:return i.length>0?(y.default.log(r+": executing CREATEs"),[4,p.each(i,(function(i){return l.executeCreate(e,i,r,t.CREATE,o,n)}),k)]):[3,3];case 2:return u.sent(),i=t.CREATE.getActions(),[3,1];case 3:if(this.canceled)throw new m.CancelledSyncError;return y.default.log(r+": executing CREATEs"),[4,p.each(t.UPDATE.getActions(),(function(o){return l.executeUpdate(e,o,r,t.UPDATE,n)}),k)];case 4:if(u.sent(),this.canceled)throw new m.CancelledSyncError;if(a=this.mappings.getSnapshot(),s=t.MOVE.map(a,r),this.canceled)throw new m.CancelledSyncError;if(c=f.default.sortMoves(s.getActions(),this.getTargetTree(r)),this.canceled)throw new m.CancelledSyncError;return y.default.log(r+": executing MOVEs"),[4,p.each(c,(function(t){return p.each(t,(function(t){return l.executeUpdate(e,t,r,s,n)}),k)}),1)];case 5:if(u.sent(),this.canceled)throw new m.CancelledSyncError;return y.default.log(r+": executing REMOVEs"),[4,p.each(t.REMOVE.getActions(),(function(o){return l.executeRemove(e,o,r,t.REMOVE,n)}),k)];case 6:return u.sent(),[2]}}))}))},t.prototype.toJSON=function(){return i(i({},w.default.prototype.toJSON.apply(this)),{strategy:"unidirectional"})},t}(h.default);t.default=E},94557:(e,t)=>{"use strict";t.CQ=t.oe=t.$7=t.uD=void 0,t.uD=Symbol("error"),t.$7=Symbol("syncing"),t.oe=Symbol("allgood"),t.CQ=Symbol("disabled")},94780:function(e,t){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleDriveSearchError=t.UpdateBookmarkError=t.LocalFolderNotFoundError=t.ResourceLockedError=t.MissingPermissionsError=t.CreateBookmarkError=t.FileUnreadableError=t.RedirectError=t.OAuthTokenError=t.GoogleDriveAuthenticationError=t.DecryptionError=t.FailsafeError=t.InterruptedSyncError=t.CancelledSyncError=t.SlashError=t.LockFileError=t.UnclearedLockFileError=t.InconsistentBookmarksExistenceError=t.InconsistentServerStateError=t.ParseResponseError=t.HttpError=t.AuthenticationError=t.NetworkError=t.RequestTimeoutError=t.UnexpectedServerResponseError=t.UnknownFolderParentRemoveError=t.UnknownFolderRemoveError=t.MissingItemOrderError=t.UnknownFolderItemOrderError=t.UnknownFolderOrderError=t.UnknownFolderMoveError=t.UnknownFolderUpdateError=t.UnknownFolderParentUpdateError=t.UnknownMoveTargetError=t.UnknownMoveOriginError=t.UnknownBookmarkUpdateError=t.UnknownCreateTargetError=t.FloccusError=void 0;var o=function(e){function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(Error);t.FloccusError=o;var i=function(e){function t(){var r=e.call(this,"E001: Folder to create in doesn't exist")||this;return r.code=1,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownCreateTargetError=i;var a=function(e){function t(){var r=e.call(this,"E002: Bookmark to update doesn't exist anymore")||this;return r.code=2,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownBookmarkUpdateError=a;var s=function(e){function t(){var r=e.call(this,"E003: Folder to move out of doesn't exist")||this;return r.code=3,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownMoveOriginError=s;var c=function(e){function t(){var r=e.call(this,"E004: Folder to move into doesn't exist")||this;return r.code=4,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownMoveTargetError=c;var l=function(e){function t(){var r=e.call(this,"E006: Parent of folder to update doesn't exist")||this;return r.code=5,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownFolderParentUpdateError=l;var u=function(e){function t(){var r=e.call(this,"E006: Folder to update doesn't exist")||this;return r.code=6,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownFolderUpdateError=u;var d=function(e){function t(){var r=e.call(this,"E007: Folder to move doesn't exist")||this;return r.code=7,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownFolderMoveError=d;var h=function(e){function t(){var r=e.call(this,"E010: Could not find folder to order")||this;return r.code=10,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownFolderOrderError=h;var f=function(e){function t(r){var n=e.call(this,"E011: Item in folder ordering is not an actual child")||this;return n.code=11,n.item=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.UnknownFolderItemOrderError=f;var p=function(e){function t(r){var n=e.call(this,"E012: Folder ordering is missing some of the folder's children")||this;return n.code=12,n.item=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.MissingItemOrderError=p;var g=function(e){function t(){var r=e.call(this,"E013: Folder to remove doesn't exist")||this;return r.code=13,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownFolderRemoveError=g;var v=function(e){function t(){var r=e.call(this,"E014: Parent folder to remove folder from of doesn't exist")||this;return r.code=14,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnknownFolderParentRemoveError=v;var y=function(e){function t(){var r=e.call(this,"E015: Unexpected response data from server")||this;return r.code=15,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.UnexpectedServerResponseError=y;var m=function(e){function t(){var r=e.call(this,"E016: Request timed out.")||this;return r.code=16,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.RequestTimeoutError=m;var b=function(e){function t(){var r=e.call(this,"E017: Network error: Check your network connection and your profile details")||this;return r.code=17,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.NetworkError=b;var w=function(e){function t(){var r=e.call(this,"E018: Couldn't authenticate with the server.")||this;return r.code=18,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.AuthenticationError=w;var k=function(e){function t(r,n){var o=e.call(this,"E019: HTTP status ".concat(r,". Failed ").concat(n," request. Check your server configuration and log."))||this;return o.code=19,o.status=r,o.method=n,Object.setPrototypeOf(o,t.prototype),o}return n(t,e),t}(o);t.HttpError=k;var E=function(e){function t(r){var n=e.call(this,"E020: Could not parse server response. Is the bookmarks app installed on your server?")||this;return n.code=20,n.response=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.ParseResponseError=E;var R=function(e){function t(){var r=e.call(this,"E021: Inconsistent server state. Folder is present in childorder list but not in folder tree")||this;return r.code=21,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.InconsistentServerStateError=R;var S=function(e){function t(r,n){var o=e.call(this,"E022: Folder ".concat(r," supposedly contains non-existent bookmark ").concat(n))||this;return o.code=22,o.folder=r,o.bookmark=n,Object.setPrototypeOf(o,t.prototype),o}return n(t,e),t}(o);t.InconsistentBookmarksExistenceError=S;var O=function(e){function t(r){var n=e.call(this,"E023: Unable to clear lock file, consider deleting ".concat(r," manually."))||this;return n.code=23,n.lockFile=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.UnclearedLockFileError=O;var I=function(e){function t(r,n){var o=e.call(this,"E024: HTTP status ".concat(r," while trying to determine status of lock file ").concat(n))||this;return o.code=24,o.status=r,o.lockFile=n,Object.setPrototypeOf(o,t.prototype),o}return n(t,e),t}(o);t.LockFileError=I;var T=function(e){function t(){var r=e.call(this,"E025: Bookmarks file setting mustn't begin with a slash: '/'")||this;return r.code=25,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.SlashError=T;var _=function(e){function t(){var t=e.call(this,"E026: Sync process was cancelled")||this;return t.code=26,Object.setPrototypeOf(t,L.prototype),t}return n(t,e),t}(o);t.CancelledSyncError=_;var L=function(e){function t(){var r=e.call(this,"E027: Sync process was interrupted")||this;return r.code=27,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.InterruptedSyncError=L;var P=function(e){function t(r){var n=e.call(this,"E029: Failsafe: The current sync run would delete ".concat(r,"% of your bookmarks. Refusing to execute. Disable this failsafe in the profile settings if you want to proceed anyway."))||this;return n.code=29,n.percent=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.FailsafeError=P;var A=function(e){function t(){var r=e.call(this,"E030: Failed to decrypt bookmarks file. The passphrase may be wrong or the file may be corrupted.")||this;return r.code=30,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.DecryptionError=A;var C=function(e){function t(){var r=e.call(this,"E031: Could not authenticate with Google Drive. Please connect floccus with your google account again.")||this;return r.code=31,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.GoogleDriveAuthenticationError=C;var x=function(e){function t(){var r=e.call(this,"E032: OAuth error. Token validation error. Please reconnect your Google Account.")||this;return r.code=32,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.OAuthTokenError=x;var D=function(e){function t(){var r=e.call(this,"E033: Redirect detected. Please make sure the server supports the selected sync method and URL you entered is correct doesn't redirect to a different location.")||this;return r.code=33,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.RedirectError=D;var F=function(e){function t(){var r=e.call(this,"E034: Remote bookmarks file is unreadable. Perhaps you forgot to set an encryption passphrase, or you set the wrong file format.")||this;return r.code=34,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.FileUnreadableError=F;var M=function(e){function t(r){var n=e.call(this,"E035: Failed to create the following bookmark on the server: ".concat(r.inspect()))||this;return n.code=35,n.bookmark=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.CreateBookmarkError=M;var j=function(e){function t(){var r=e.call(this,"E036: Missing permissions to access the sync server")||this;return r.code=36,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.MissingPermissionsError=j;var U=function(e){function t(){var r=e.call(this,"E037: Resource is locked")||this;return r.code=37,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.ResourceLockedError=U;var B=function(e){function t(){var r=e.call(this,"E038: Could not find local folder")||this;return r.code=38,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.LocalFolderNotFoundError=B;var V=function(e){function t(r){var n=e.call(this,"E039: Failed to update the following bookmark on the server: ".concat(r.inspect()))||this;return n.code=39,n.bookmark=r,Object.setPrototypeOf(n,t.prototype),n}return n(t,e),t}(o);t.UpdateBookmarkError=V;var N=function(e){function t(){var r=e.call(this,"E040: Could not search for your file name in your Google Drive")||this;return r.code=40,Object.setPrototypeOf(r,t.prototype),r}return n(t,e),t}(o);t.GoogleDriveSearchError=N}}]);
//# sourceMappingURL=991.js.map