/*! For license information please see kitsu-script.js.LICENSE.txt */
(()=>{var t={50953:(t,e,n)=>{"use strict";n.d(e,{KR:()=>tt,Kh:()=>K});var a=n(90033);let s,i,r=0;function o(){r++}function l(){if(--r>0)return;if(i){let t=i;for(i=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let t;for(;s;){let e=s;for(s=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,1&e.flags)try{e.trigger()}catch(e){t||(t=e)}e=n}}if(t)throw t}let c=!0;const u=[];class h{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){}trigger(t){this.version++,this.notify(t)}notify(t){o();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{l()}}}const m=new WeakMap,p=Symbol(""),d=Symbol(""),g=Symbol("");function f(t,e,n){0}function y(t,e,n,s,i,r){const c=m.get(t);if(!c)return;const u=t=>{t&&t.trigger()};if(o(),"clear"===e)c.forEach(u);else{const i=(0,a.cy)(t),r=i&&(0,a.yI)(n);if(i&&"length"===n){const t=Number(s);c.forEach(((e,n)=>{("length"===n||n===g||!(0,a.Bm)(n)&&n>=t)&&u(e)}))}else switch((void 0!==n||c.has(void 0))&&u(c.get(n)),r&&u(c.get(g)),e){case"add":i?r&&u(c.get("length")):(u(c.get(p)),(0,a.CE)(t)&&u(c.get(d)));break;case"delete":i||(u(c.get(p)),(0,a.CE)(t)&&u(c.get(d)));break;case"set":(0,a.CE)(t)&&u(c.get(p))}}l()}function b(t){const e=Y(t);return e===t?e:(f(),X(t)?e:e.map(J))}function v(t){return f(t=Y(t)),t}const w={__proto__:null,[Symbol.iterator](){return _(this,Symbol.iterator,J)},concat(...t){return b(this).concat(...t.map((t=>(0,a.cy)(t)?b(t):t)))},entries(){return _(this,"entries",(t=>(t[1]=J(t[1]),t)))},every(t,e){return k(this,"every",t,e,void 0,arguments)},filter(t,e){return k(this,"filter",t,e,(t=>t.map(J)),arguments)},find(t,e){return k(this,"find",t,e,J,arguments)},findIndex(t,e){return k(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return k(this,"findLast",t,e,J,arguments)},findLastIndex(t,e){return k(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return k(this,"forEach",t,e,void 0,arguments)},includes(...t){return T(this,"includes",t)},indexOf(...t){return T(this,"indexOf",t)},join(t){return b(this).join(t)},lastIndexOf(...t){return T(this,"lastIndexOf",t)},map(t,e){return k(this,"map",t,e,void 0,arguments)},pop(){return I(this,"pop")},push(...t){return I(this,"push",t)},reduce(t,...e){return S(this,"reduce",t,e)},reduceRight(t,...e){return S(this,"reduceRight",t,e)},shift(){return I(this,"shift")},some(t,e){return k(this,"some",t,e,void 0,arguments)},splice(...t){return I(this,"splice",t)},toReversed(){return b(this).toReversed()},toSorted(t){return b(this).toSorted(t)},toSpliced(...t){return b(this).toSpliced(...t)},unshift(...t){return I(this,"unshift",t)},values(){return _(this,"values",J)}};function _(t,e,n){const a=v(t),s=a[e]();return a===t||X(t)||(s._next=s.next,s.next=()=>{const t=s._next();return t.value&&(t.value=n(t.value)),t}),s}const E=Array.prototype;function k(t,e,n,a,s,i){const r=v(t),o=r!==t&&!X(t),l=r[e];if(l!==E[e]){const e=l.apply(t,i);return o?J(e):e}let c=n;r!==t&&(o?c=function(e,a){return n.call(this,J(e),a,t)}:n.length>2&&(c=function(e,a){return n.call(this,e,a,t)}));const u=l.call(r,c,a);return o&&s?s(u):u}function S(t,e,n,a){const s=v(t);let i=n;return s!==t&&(X(t)?n.length>3&&(i=function(e,a,s){return n.call(this,e,a,s,t)}):i=function(e,a,s){return n.call(this,e,J(a),s,t)}),s[e](i,...a)}function T(t,e,n){const a=Y(t);f();const s=a[e](...n);return-1!==s&&!1!==s||!function(t){return!!t&&!!t.__v_raw}(n[0])?s:(n[0]=Y(n[0]),a[e](...n))}function I(t,e,n=[]){u.push(c),c=!1,o();const a=Y(t)[e].apply(t,n);return l(),function(){const t=u.pop();c=void 0===t||t}(),a}const x=(0,a.pD)("__proto__,__v_isRef,__isVue"),A=new Set(Object.getOwnPropertyNames(Symbol).filter((t=>"arguments"!==t&&"caller"!==t)).map((t=>Symbol[t])).filter(a.Bm));function N(t){(0,a.Bm)(t)||(t=String(t));const e=Y(this);return f(),e.hasOwnProperty(t)}class ${constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,n){if("__v_skip"===e)return t.__v_skip;const s=this._isReadonly,i=this._isShallow;if("__v_isReactive"===e)return!s;if("__v_isReadonly"===e)return s;if("__v_isShallow"===e)return i;if("__v_raw"===e)return n===(s?i?W:G:i?H:z).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const r=(0,a.cy)(t);if(!s){let t;if(r&&(t=w[e]))return t;if("hasOwnProperty"===e)return N}const o=Reflect.get(t,e,Q(t)?t:n);return((0,a.Bm)(e)?A.has(e):x(e))?o:(s||f(),i?o:Q(o)?r&&(0,a.yI)(e)?o:o.value:(0,a.Gv)(o)?s?B(o):K(o):o)}}class L extends ${constructor(t=!1){super(!1,t)}set(t,e,n,s){let i=t[e];if(!this._isShallow){const e=q(i);if(X(n)||q(n)||(i=Y(i),n=Y(n)),!(0,a.cy)(t)&&Q(i)&&!Q(n))return!e&&(i.value=n,!0)}const r=(0,a.cy)(t)&&(0,a.yI)(e)?Number(e)<t.length:(0,a.$3)(t,e),o=Reflect.set(t,e,n,Q(t)?t:s);return t===Y(s)&&(r?(0,a.$H)(n,i)&&y(t,"set",e,n):y(t,"add",e,n)),o}deleteProperty(t,e){const n=(0,a.$3)(t,e),s=(t[e],Reflect.deleteProperty(t,e));return s&&n&&y(t,"delete",e,void 0),s}has(t,e){const n=Reflect.has(t,e);return(0,a.Bm)(e)&&A.has(e)||f(),n}ownKeys(t){return f(0,0,(0,a.cy)(t)),Reflect.ownKeys(t)}}class R extends ${constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const O=new L,C=new R,P=t=>t,M=t=>Reflect.getPrototypeOf(t);function D(t){return function(...e){return"delete"!==t&&("clear"===t?void 0:this)}}function U(t,e){const n=function(t,e){const n={get(n){const s=this.__v_raw,i=Y(s),r=Y(n);t||((0,a.$H)(n,r)&&f(),f());const{has:o}=M(i),l=e?P:t?Z:J;return o.call(i,n)?l(s.get(n)):o.call(i,r)?l(s.get(r)):void(s!==i&&s.get(n))},get size(){const e=this.__v_raw;return!t&&f(Y(e)),Reflect.get(e,"size",e)},has(e){const n=this.__v_raw,s=(Y(n),Y(e));return t||((0,a.$H)(e,s)&&f(),f()),e===s?n.has(e):n.has(e)||n.has(s)},forEach(n,a){const s=this,i=s.__v_raw,r=(Y(i),e?P:t?Z:J);return!t&&f(),i.forEach(((t,e)=>n.call(a,r(t),r(e),s)))}};return(0,a.X$)(n,t?{add:D("add"),set:D("set"),delete:D("delete"),clear:D("clear")}:{add(t){e||X(t)||q(t)||(t=Y(t));const n=Y(this);return M(n).has.call(n,t)||(n.add(t),y(n,"add",t,t)),this},set(t,n){e||X(n)||q(n)||(n=Y(n));const s=Y(this),{has:i,get:r}=M(s);let o=i.call(s,t);o||(t=Y(t),o=i.call(s,t));const l=r.call(s,t);return s.set(t,n),o?(0,a.$H)(n,l)&&y(s,"set",t,n):y(s,"add",t,n),this},delete(t){const e=Y(this),{has:n,get:a}=M(e);let s=n.call(e,t);s||(t=Y(t),s=n.call(e,t)),a&&a.call(e,t);const i=e.delete(t);return s&&y(e,"delete",t,void 0),i},clear(){const t=Y(this),e=0!==t.size,n=t.clear();return e&&y(t,"clear",void 0,void 0),n}}),["keys","values","entries",Symbol.iterator].forEach((s=>{n[s]=function(t,e,n){return function(...s){const i=this.__v_raw,r=Y(i),o=(0,a.CE)(r),l="entries"===t||t===Symbol.iterator&&o,c=i[t](...s),u=n?P:e?Z:J;return!e&&f(),{next(){const{value:t,done:e}=c.next();return e?{value:t,done:e}:{value:l?[u(t[0]),u(t[1])]:u(t),done:e}},[Symbol.iterator](){return this}}}}(s,t,e)})),n}(t,e);return(e,s,i)=>"__v_isReactive"===s?!t:"__v_isReadonly"===s?t:"__v_raw"===s?e:Reflect.get((0,a.$3)(n,s)&&s in e?n:e,s,i)}const F={get:U(!1,!1)},j={get:U(!0,!1)},z=new WeakMap,H=new WeakMap,G=new WeakMap,W=new WeakMap;function K(t){return q(t)?t:V(t,!1,O,F,z)}function B(t){return V(t,!0,C,j,G)}function V(t,e,n,s,i){if(!(0,a.Gv)(t))return t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const r=i.get(t);if(r)return r;const o=function(t){return t.__v_skip||!Object.isExtensible(t)?0:function(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((0,a.Zf)(t))}(t);if(0===o)return t;const l=new Proxy(t,2===o?s:n);return i.set(t,l),l}function q(t){return!(!t||!t.__v_isReadonly)}function X(t){return!(!t||!t.__v_isShallow)}function Y(t){const e=t&&t.__v_raw;return e?Y(e):t}const J=t=>(0,a.Gv)(t)?K(t):t,Z=t=>(0,a.Gv)(t)?B(t):t;function Q(t){return!!t&&!0===t.__v_isRef}function tt(t){return n=!1,Q(e=t)?e:new et(e,n);var e,n}class et{constructor(t,e){this.dep=new h,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:Y(t),this._value=e?t:J(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,n=this.__v_isShallow||X(t)||q(t);t=n?t:Y(t),(0,a.$H)(t,e)&&(this._rawValue=t,this._value=n?t:J(t),this.dep.trigger())}}},90033:(t,e,n)=>{"use strict";function a(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return t=>t in e}n.d(e,{$3:()=>r,$H:()=>v,Bm:()=>c,CE:()=>l,Gv:()=>u,X$:()=>s,Zf:()=>p,cy:()=>o,pD:()=>a,yI:()=>d});const s=Object.assign,i=Object.prototype.hasOwnProperty,r=(t,e)=>i.call(t,e),o=Array.isArray,l=t=>"[object Map]"===m(t),c=t=>"symbol"==typeof t,u=t=>null!==t&&"object"==typeof t,h=Object.prototype.toString,m=t=>h.call(t),p=t=>m(t).slice(8,-1),d=t=>"string"==typeof t&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,g=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},f=/-(\w)/g,y=(g((t=>t.replace(f,((t,e)=>e?e.toUpperCase():"")))),/\B([A-Z])/g),b=(g((t=>t.replace(y,"-$1").toLowerCase())),g((t=>t.charAt(0).toUpperCase()+t.slice(1)))),v=(g((t=>t?`on${b(t)}`:"")),(t,e)=>!Object.is(t,e))},49730:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o});var a=n(71354),s=n.n(a),i=n(76314),r=n.n(i)()(s());r.push([t.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const o=r},76314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",a=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),a&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),a&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,a,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(a)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(r[l]=!0)}for(var c=0;c<t.length;c++){var u=[].concat(t[c]);a&&r[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),s&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=s):u[4]="".concat(s)),e.push(u))}},e}},71354:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),i="/*# ".concat(s," */");return[e].concat([i]).join("\n")}return[e].join("\n")}},53011:(t,e,n)=>{var a;!function(s){var i=Object.hasOwnProperty,r=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o="object"==typeof process&&"function"==typeof process.nextTick,l="function"==typeof Symbol,c="object"==typeof Reflect,u="function"==typeof setImmediate?setImmediate:setTimeout,h=l?c&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(t){var e=Object.getOwnPropertyNames(t);return e.push.apply(e,Object.getOwnPropertySymbols(t)),e}:Object.keys;function m(){this._events={},this._conf&&p.call(this,this._conf)}function p(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners!==s&&(this._maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this._newListener=t.newListener),t.removeListener&&(this._removeListener=t.removeListener),t.verboseMemoryLeak&&(this.verboseMemoryLeak=t.verboseMemoryLeak),t.ignoreErrors&&(this.ignoreErrors=t.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function d(t,e){var n="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+e+"."),"undefined"!=typeof process&&process.emitWarning){var a=new Error(n);a.name="MaxListenersExceededWarning",a.emitter=this,a.count=t,process.emitWarning(a)}else console.error(n),console.trace&&console.trace()}var g=function(t,e,n){var a=arguments.length;switch(a){case 0:return[];case 1:return[t];case 2:return[t,e];case 3:return[t,e,n];default:for(var s=new Array(a);a--;)s[a]=arguments[a];return s}};function f(t,e){for(var n={},a=t.length,i=e?value.length:0,r=0;r<a;r++)n[t[r]]=r<i?e[r]:s;return n}function y(t,e,n){var a,s;if(this._emitter=t,this._target=e,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(a=n.on,s=n.off),e.addEventListener?(a=e.addEventListener,s=e.removeEventListener):e.addListener?(a=e.addListener,s=e.removeListener):e.on&&(a=e.on,s=e.off),!a&&!s)throw Error("target does not implement any known event API");if("function"!=typeof a)throw TypeError("on method must be a function");if("function"!=typeof s)throw TypeError("off method must be a function");this._on=a,this._off=s;var i=t._observers;i?i.push(this):t._observers=[this]}function b(t,e,n,a){var r=Object.assign({},e);if(!t)return r;if("object"!=typeof t)throw TypeError("options must be an object");var o,l,c,u=Object.keys(t),h=u.length;function m(t){throw Error('Invalid "'+o+'" option value'+(t?". Reason: "+t:""))}for(var p=0;p<h;p++){if(o=u[p],!a&&!i.call(e,o))throw Error('Unknown "'+o+'" option');(l=t[o])!==s&&(c=n[o],r[o]=c?c(l,m):l)}return r}function v(t,e){return"function"==typeof t&&t.hasOwnProperty("prototype")||e("value must be a constructor"),t}function w(t){var e="value must be type of "+t.join("|"),n=t.length,a=t[0],s=t[1];return 1===n?function(t,n){if(typeof t===a)return t;n(e)}:2===n?function(t,n){var i=typeof t;if(i===a||i===s)return t;n(e)}:function(a,s){for(var i=typeof a,r=n;r-- >0;)if(i===t[r])return a;s(e)}}Object.assign(y.prototype,{subscribe:function(t,e,n){var a=this,s=this._target,i=this._emitter,r=this._listeners,o=function(){var a=g.apply(null,arguments),r={data:a,name:e,original:t};n?!1!==n.call(s,r)&&i.emit.apply(i,[r.name].concat(a)):i.emit.apply(i,[e].concat(a))};if(r[t])throw Error("Event '"+t+"' is already listening");this._listenersCount++,i._newListener&&i._removeListener&&!a._onNewListener?(this._onNewListener=function(n){n===e&&null===r[t]&&(r[t]=o,a._on.call(s,t,o))},i.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===e&&!i.hasListeners(n)&&r[t]&&(r[t]=null,a._off.call(s,t,o))},r[t]=null,i.on("removeListener",this._onRemoveListener)):(r[t]=o,a._on.call(s,t,o))},unsubscribe:function(t){var e,n,a,s=this,i=this._listeners,r=this._emitter,o=this._off,l=this._target;if(t&&"string"!=typeof t)throw TypeError("event must be a string");function c(){s._onNewListener&&(r.off("newListener",s._onNewListener),r.off("removeListener",s._onRemoveListener),s._onNewListener=null,s._onRemoveListener=null);var t=S.call(r,s);r._observers.splice(t,1)}if(t){if(!(e=i[t]))return;o.call(l,t,e),delete i[t],--this._listenersCount||c()}else{for(a=(n=h(i)).length;a-- >0;)t=n[a],o.call(l,t,i[t]);this._listeners={},this._listenersCount=0,c()}}});var _=w(["function"]),E=w(["object","function"]);function k(t,e,n){var a,s,i,r=0,o=new t((function(l,c,u){function h(){s&&(s=null),r&&(clearTimeout(r),r=0)}n=b(n,{timeout:0,overload:!1},{timeout:function(t,e){return("number"!=typeof(t*=1)||t<0||!Number.isFinite(t))&&e("timeout must be a positive number"),t}}),a=!n.overload&&"function"==typeof t.prototype.cancel&&"function"==typeof u;var m=function(t){h(),l(t)},p=function(t){h(),c(t)};a?e(m,p,u):(s=[function(t){p(t||Error("canceled"))}],e(m,p,(function(t){if(i)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof t)throw TypeError("onCancel callback must be a function");s.push(t)})),i=!0),n.timeout>0&&(r=setTimeout((function(){var t=Error("timeout");t.code="ETIMEDOUT",r=0,o.cancel(t),c(t)}),n.timeout))}));return a||(o.cancel=function(t){if(s){for(var e=s.length,n=1;n<e;n++)s[n](t);s[0](t),s=null}}),o}function S(t){var e=this._observers;if(!e)return-1;for(var n=e.length,a=0;a<n;a++)if(e[a]._target===t)return a;return-1}function T(t,e,n,a,s){if(!n)return null;if(0===a){var i=typeof e;if("string"===i){var r,o,l=0,c=0,u=this.delimiter,m=u.length;if(-1!==(o=e.indexOf(u))){r=new Array(5);do{r[l++]=e.slice(c,o),c=o+m}while(-1!==(o=e.indexOf(u,c)));r[l++]=e.slice(c),e=r,s=l}else e=[e],s=1}else"object"===i?s=e.length:(e=[e],s=1)}var p,d,g,f,y,b,v,w=null,_=e[a],E=e[a+1];if(a===s)n._listeners&&("function"==typeof n._listeners?(t&&t.push(n._listeners),w=[n]):(t&&t.push.apply(t,n._listeners),w=[n]));else{if("*"===_){for(o=(b=h(n)).length;o-- >0;)"_listeners"!==(p=b[o])&&(v=T(t,e,n[p],a+1,s))&&(w?w.push.apply(w,v):w=v);return w}if("**"===_){for((y=a+1===s||a+2===s&&"*"===E)&&n._listeners&&(w=T(t,e,n,s,s)),o=(b=h(n)).length;o-- >0;)"_listeners"!==(p=b[o])&&("*"===p||"**"===p?(n[p]._listeners&&!y&&(v=T(t,e,n[p],s,s))&&(w?w.push.apply(w,v):w=v),v=T(t,e,n[p],a,s)):v=T(t,e,n[p],p===E?a+2:a,s),v&&(w?w.push.apply(w,v):w=v));return w}n[_]&&(w=T(t,e,n[_],a+1,s))}if((d=n["*"])&&T(t,e,d,a+1,s),g=n["**"])if(a<s)for(g._listeners&&T(t,e,g,s,s),o=(b=h(g)).length;o-- >0;)"_listeners"!==(p=b[o])&&(p===E?T(t,e,g[p],a+2,s):p===_?T(t,e,g[p],a+1,s):((f={})[p]=g[p],T(t,e,{"**":f},a+1,s)));else g._listeners?T(t,e,g,s,s):g["*"]&&g["*"]._listeners&&T(t,e,g["*"],s,s);return w}function I(t,e,n){var a,s,i=0,r=0,o=this.delimiter,l=o.length;if("string"==typeof t)if(-1!==(a=t.indexOf(o))){s=new Array(5);do{s[i++]=t.slice(r,a),r=a+l}while(-1!==(a=t.indexOf(o,r)));s[i++]=t.slice(r)}else s=[t],i=1;else s=t,i=t.length;if(i>1)for(a=0;a+1<i;a++)if("**"===s[a]&&"**"===s[a+1])return;var c,u=this.listenerTree;for(a=0;a<i;a++)if(u=u[c=s[a]]||(u[c]={}),a===i-1)return u._listeners?("function"==typeof u._listeners&&(u._listeners=[u._listeners]),n?u._listeners.unshift(e):u._listeners.push(e),!u._listeners.warned&&this._maxListeners>0&&u._listeners.length>this._maxListeners&&(u._listeners.warned=!0,d.call(this,u._listeners.length,c))):u._listeners=e,!0;return!0}function x(t,e,n,a){for(var s,i,r,o,l=h(t),c=l.length,u=t._listeners;c-- >0;)s=t[i=l[c]],r="_listeners"===i?n:n?n.concat(i):[i],o=a||"symbol"==typeof i,u&&e.push(o?r:r.join(this.delimiter)),"object"==typeof s&&x.call(this,s,e,r,o);return e}function A(t){for(var e,n,a,s=h(t),i=s.length;i-- >0;)(e=t[n=s[i]])&&(a=!0,"_listeners"===n||A(e)||delete t[n]);return a}function N(t,e,n){this.emitter=t,this.event=e,this.listener=n}function $(t,e,n){if(!0===n)i=!0;else if(!1===n)a=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var a=n.async,i=n.promisify,r=n.nextTick,l=n.objectify}if(a||r||i){var c=e,h=e._origin||e;if(r&&!o)throw Error("process.nextTick is not supported");i===s&&(i="AsyncFunction"===e.constructor.name),e=function(){var t=arguments,e=this,n=this.event;return i?r?Promise.resolve():new Promise((function(t){u(t)})).then((function(){return e.event=n,c.apply(e,t)})):(r?process.nextTick:u)((function(){e.event=n,c.apply(e,t)}))},e._async=!0,e._origin=h}return[e,l?new N(this,t,e):this]}function L(t){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,p.call(this,t)}N.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},L.EventEmitter2=L,L.prototype.listenTo=function(t,e,n){if("object"!=typeof t)throw TypeError("target musts be an object");var a=this;function i(e){if("object"!=typeof e)throw TypeError("events must be an object");var s,i=n.reducers,r=S.call(a,t);s=-1===r?new y(a,t,n):a._observers[r];for(var o,l=h(e),c=l.length,u="function"==typeof i,m=0;m<c;m++)o=l[m],s.subscribe(o,e[o]||o,u?i:i&&i[o])}return n=b(n,{on:s,off:s,reducers:s},{on:_,off:_,reducers:E}),r(e)?i(f(e)):i("string"==typeof e?f(e.split(/\s+/)):e),this},L.prototype.stopListeningTo=function(t,e){var n=this._observers;if(!n)return!1;var a,s=n.length,i=!1;if(t&&"object"!=typeof t)throw TypeError("target should be an object");for(;s-- >0;)a=n[s],t&&a._target!==t||(a.unsubscribe(e),i=!0);return i},L.prototype.delimiter=".",L.prototype.setMaxListeners=function(t){t!==s&&(this._maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t)},L.prototype.getMaxListeners=function(){return this._maxListeners},L.prototype.event="",L.prototype.once=function(t,e,n){return this._once(t,e,!1,n)},L.prototype.prependOnceListener=function(t,e,n){return this._once(t,e,!0,n)},L.prototype._once=function(t,e,n,a){return this._many(t,1,e,n,a)},L.prototype.many=function(t,e,n,a){return this._many(t,e,n,!1,a)},L.prototype.prependMany=function(t,e,n,a){return this._many(t,e,n,!0,a)},L.prototype._many=function(t,e,n,a,s){var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function r(){return 0==--e&&i.off(t,r),n.apply(this,arguments)}return r._origin=n,this._on(t,r,a,s)},L.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||m.call(this);var t,e,n,a,s,i,r=arguments[0],o=this.wildcard;if("newListener"===r&&!this._newListener&&!this._events.newListener)return!1;if(o&&(t=r,"newListener"!==r&&"removeListener"!==r&&"object"==typeof r)){if(n=r.length,l)for(a=0;a<n;a++)if("symbol"==typeof r[a]){i=!0;break}i||(r=r.join(this.delimiter))}var c,u=arguments.length;if(this._all&&this._all.length)for(a=0,n=(c=this._all.slice()).length;a<n;a++)switch(this.event=r,u){case 1:c[a].call(this,r);break;case 2:c[a].call(this,r,arguments[1]);break;case 3:c[a].call(this,r,arguments[1],arguments[2]);break;default:c[a].apply(this,arguments)}if(o)c=[],T.call(this,c,t,this.listenerTree,0,n);else{if("function"==typeof(c=this._events[r])){switch(this.event=r,u){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=new Array(u-1),s=1;s<u;s++)e[s-1]=arguments[s];c.apply(this,e)}return!0}c&&(c=c.slice())}if(c&&c.length){if(u>3)for(e=new Array(u-1),s=1;s<u;s++)e[s-1]=arguments[s];for(a=0,n=c.length;a<n;a++)switch(this.event=r,u){case 1:c[a].call(this);break;case 2:c[a].call(this,arguments[1]);break;case 3:c[a].call(this,arguments[1],arguments[2]);break;default:c[a].apply(this,e)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===r)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},L.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||m.call(this);var t,e,n,a,s,i,r=arguments[0],o=this.wildcard;if("newListener"===r&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(t=r,"newListener"!==r&&"removeListener"!==r&&"object"==typeof r)){if(a=r.length,l)for(s=0;s<a;s++)if("symbol"==typeof r[s]){e=!0;break}e||(r=r.join(this.delimiter))}var c,u=[],h=arguments.length;if(this._all)for(s=0,a=this._all.length;s<a;s++)switch(this.event=r,h){case 1:u.push(this._all[s].call(this,r));break;case 2:u.push(this._all[s].call(this,r,arguments[1]));break;case 3:u.push(this._all[s].call(this,r,arguments[1],arguments[2]));break;default:u.push(this._all[s].apply(this,arguments))}if(o?(c=[],T.call(this,c,t,this.listenerTree,0)):c=this._events[r],"function"==typeof c)switch(this.event=r,h){case 1:u.push(c.call(this));break;case 2:u.push(c.call(this,arguments[1]));break;case 3:u.push(c.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(h-1),i=1;i<h;i++)n[i-1]=arguments[i];u.push(c.apply(this,n))}else if(c&&c.length){if(c=c.slice(),h>3)for(n=new Array(h-1),i=1;i<h;i++)n[i-1]=arguments[i];for(s=0,a=c.length;s<a;s++)switch(this.event=r,h){case 1:u.push(c[s].call(this));break;case 2:u.push(c[s].call(this,arguments[1]));break;case 3:u.push(c[s].call(this,arguments[1],arguments[2]));break;default:u.push(c[s].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===r)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(u)},L.prototype.on=function(t,e,n){return this._on(t,e,!1,n)},L.prototype.prependListener=function(t,e,n){return this._on(t,e,!0,n)},L.prototype.onAny=function(t){return this._onAny(t,!1)},L.prototype.prependAny=function(t){return this._onAny(t,!0)},L.prototype.addListener=L.prototype.on,L.prototype._onAny=function(t,e){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),e?this._all.unshift(t):this._all.push(t),this},L.prototype._on=function(t,e,n,a){if("function"==typeof t)return this._onAny(t,e),this;if("function"!=typeof e)throw new Error("on only accepts instances of Function");this._events||m.call(this);var i,r=this;return a!==s&&(e=(i=$.call(this,t,e,a))[0],r=i[1]),this._newListener&&this.emit("newListener",t,e),this.wildcard?(I.call(this,t,e,n),r):(this._events[t]?("function"==typeof this._events[t]&&(this._events[t]=[this._events[t]]),n?this._events[t].unshift(e):this._events[t].push(e),!this._events[t].warned&&this._maxListeners>0&&this._events[t].length>this._maxListeners&&(this._events[t].warned=!0,d.call(this,this._events[t].length,t))):this._events[t]=e,r)},L.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,a=[];if(this.wildcard){var s="string"==typeof t?t.split(this.delimiter):t.slice();if(!(a=T.call(this,null,s,this.listenerTree,0)))return this}else{if(!this._events[t])return this;n=this._events[t],a.push({_listeners:n})}for(var i=0;i<a.length;i++){var o=a[i];if(n=o._listeners,r(n)){for(var l=-1,c=0,u=n.length;c<u;c++)if(n[c]===e||n[c].listener&&n[c].listener===e||n[c]._origin&&n[c]._origin===e){l=c;break}if(l<0)continue;return this.wildcard?o._listeners.splice(l,1):this._events[t].splice(l,1),0===n.length&&(this.wildcard?delete o._listeners:delete this._events[t]),this._removeListener&&this.emit("removeListener",t,e),this}(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete o._listeners:delete this._events[t],this._removeListener&&this.emit("removeListener",t,e))}return this.listenerTree&&A(this.listenerTree),this},L.prototype.offAny=function(t){var e,n=0,a=0;if(t&&this._all&&this._all.length>0){for(n=0,a=(e=this._all).length;n<a;n++)if(t===e[n])return e.splice(n,1),this._removeListener&&this.emit("removeListenerAny",t),this}else{if(e=this._all,this._removeListener)for(n=0,a=e.length;n<a;n++)this.emit("removeListenerAny",e[n]);this._all=[]}return this},L.prototype.removeListener=L.prototype.off,L.prototype.removeAllListeners=function(t){if(t===s)return!this._events||m.call(this),this;if(this.wildcard){var e,n=T.call(this,null,t,this.listenerTree,0);if(!n)return this;for(e=0;e<n.length;e++)n[e]._listeners=null;this.listenerTree&&A(this.listenerTree)}else this._events&&(this._events[t]=null);return this},L.prototype.listeners=function(t){var e,n,a,i,r,o=this._events;if(t===s){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(i=(e=h(o)).length,a=[];i-- >0;)"function"==typeof(n=o[e[i]])?a.push(n):a.push.apply(a,n);return a}if(this.wildcard){if(!(r=this.listenerTree))return[];var l=[],c="string"==typeof t?t.split(this.delimiter):t.slice();return T.call(this,l,c,r,0),l}return o&&(n=o[t])?"function"==typeof n?[n]:n:[]},L.prototype.eventNames=function(t){var e=this._events;return this.wildcard?x.call(this,this.listenerTree,[],null,t):e?h(e):[]},L.prototype.listenerCount=function(t){return this.listeners(t).length},L.prototype.hasListeners=function(t){if(this.wildcard){var e=[],n="string"==typeof t?t.split(this.delimiter):t.slice();return T.call(this,e,n,this.listenerTree,0),e.length>0}var a=this._events,i=this._all;return!!(i&&i.length||a&&(t===s?h(a).length:a[t]))},L.prototype.listenersAny=function(){return this._all?this._all:[]},L.prototype.waitFor=function(t,e){var n=this,a=typeof e;return"number"===a?e={timeout:e}:"function"===a&&(e={filter:e}),k((e=b(e,{timeout:0,filter:s,handleError:!1,Promise,overload:!1},{filter:_,Promise:v})).Promise,(function(a,s,i){function r(){var i=e.filter;if(!i||i.apply(n,arguments))if(n.off(t,r),e.handleError){var o=arguments[0];o?s(o):a(g.apply(null,arguments).slice(1))}else a(g.apply(null,arguments))}i((function(){n.off(t,r)})),n._on(t,r,!1)}),{timeout:e.timeout,overload:e.overload})};var R=L.prototype;Object.defineProperties(L,{defaultMaxListeners:{get:function(){return R._maxListeners},set:function(t){if("number"!=typeof t||t<0||Number.isNaN(t))throw TypeError("n must be a non-negative number");R._maxListeners=t},enumerable:!0},once:{value:function(t,e,n){return k((n=b(n,{Promise,timeout:0,overload:!1},{Promise:v})).Promise,(function(n,a,s){var i;if("function"==typeof t.addEventListener)return i=function(){n(g.apply(null,arguments))},s((function(){t.removeEventListener(e,i)})),void t.addEventListener(e,i,{once:!0});var r,o=function(){r&&t.removeListener("error",r),n(g.apply(null,arguments))};"error"!==e&&(r=function(n){t.removeListener(e,o),a(n)},t.once("error",r)),s((function(){r&&t.removeListener("error",r),t.removeListener(e,o)})),t.once(e,o)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(R,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(a=function(){return L}.call(e,n,e,t))===s||(t.exports=a)}()},53908:(t,e,n)=>{const a=n(57272),{MAX_LENGTH:s,MAX_SAFE_INTEGER:i}=n(16874),{safeRe:r,safeSrc:o,t:l}=n(99718),c=n(98587),{compareIdentifiers:u}=n(61123);class h{constructor(t,e){if(e=c(e),t instanceof h){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>s)throw new TypeError(`version is longer than ${s} characters`);a("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const n=t.trim().match(e.loose?r[l.LOOSE]:r[l.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){const e=+t;if(e>=0&&e<i)return e}return t})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(a("SemVer.compare",this.version,this.options,t),!(t instanceof h)){if("string"==typeof t&&t===this.version)return 0;t=new h(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof h||(t=new h(t,this.options)),u(this.major,t.major)||u(this.minor,t.minor)||u(this.patch,t.patch)}comparePre(t){if(t instanceof h||(t=new h(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const n=this.prerelease[e],s=t.prerelease[e];if(a("prerelease compare",e,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return-1;if(n!==s)return u(n,s)}while(++e)}compareBuild(t){t instanceof h||(t=new h(t,this.options));let e=0;do{const n=this.build[e],s=t.build[e];if(a("build compare",e,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return-1;if(n!==s)return u(n,s)}while(++e)}inc(t,e,n){if(t.startsWith("pre")){if(!e&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(e){const t=new RegExp(`^${this.options.loose?o[l.PRERELEASELOOSE]:o[l.PRERELEASE]}$`),n=`-${e}`.match(t);if(!n||n[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,n),this.inc("pre",e,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e,n),this.inc("pre",e,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const t=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[t];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(e===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(t)}}if(e){let a=[e,t];!1===n&&(a=[e]),0===u(this.prerelease[0],e)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=h},50560:(t,e,n)=>{const a=n(53908);t.exports=(t,e,n)=>new a(t,n).compare(new a(e,n))},35580:(t,e,n)=>{const a=n(50560);t.exports=(t,e,n)=>a(t,e,n)>0},54089:(t,e,n)=>{const a=n(50560);t.exports=(t,e,n)=>a(t,e,n)>=0},16874:t=>{const e=Number.MAX_SAFE_INTEGER||9007199254740991;t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},57272:t=>{const e="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};t.exports=e},61123:t=>{const e=/^[0-9]+$/,n=(t,n)=>{const a=e.test(t),s=e.test(n);return a&&s&&(t=+t,n=+n),t===n?0:a&&!s?-1:s&&!a?1:t<n?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(t,e)=>n(e,t)}},98587:t=>{const e=Object.freeze({loose:!0}),n=Object.freeze({});t.exports=t=>t?"object"!=typeof t?e:t:n},99718:(t,e,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=n(16874),r=n(57272),o=(e=t.exports={}).re=[],l=e.safeRe=[],c=e.src=[],u=e.safeSrc=[],h=e.t={};let m=0;const p="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",i],[p,s]],g=(t,e,n)=>{const a=(t=>{for(const[e,n]of d)t=t.split(`${e}*`).join(`${e}{0,${n}}`).split(`${e}+`).join(`${e}{1,${n}}`);return t})(e),s=m++;r(t,s,e),h[t]=s,c[s]=e,u[s]=a,o[s]=new RegExp(e,n?"g":void 0),l[s]=new RegExp(a,n?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${c[h.NUMERICIDENTIFIER]})\\.(${c[h.NUMERICIDENTIFIER]})\\.(${c[h.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${c[h.NUMERICIDENTIFIERLOOSE]})\\.(${c[h.NUMERICIDENTIFIERLOOSE]})\\.(${c[h.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${c[h.NUMERICIDENTIFIER]}|${c[h.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${c[h.NUMERICIDENTIFIERLOOSE]}|${c[h.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${c[h.PRERELEASEIDENTIFIER]}(?:\\.${c[h.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${c[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[h.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${c[h.BUILDIDENTIFIER]}(?:\\.${c[h.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${c[h.MAINVERSION]}${c[h.PRERELEASE]}?${c[h.BUILD]}?`),g("FULL",`^${c[h.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${c[h.MAINVERSIONLOOSE]}${c[h.PRERELEASELOOSE]}?${c[h.BUILD]}?`),g("LOOSE",`^${c[h.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${c[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${c[h.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${c[h.XRANGEIDENTIFIER]})(?:\\.(${c[h.XRANGEIDENTIFIER]})(?:\\.(${c[h.XRANGEIDENTIFIER]})(?:${c[h.PRERELEASE]})?${c[h.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${c[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[h.XRANGEIDENTIFIERLOOSE]})(?:${c[h.PRERELEASELOOSE]})?${c[h.BUILD]}?)?)?`),g("XRANGE",`^${c[h.GTLT]}\\s*${c[h.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${c[h.GTLT]}\\s*${c[h.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),g("COERCE",`${c[h.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",c[h.COERCEPLAIN]+`(?:${c[h.PRERELEASE]})?`+`(?:${c[h.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",c[h.COERCE],!0),g("COERCERTLFULL",c[h.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${c[h.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",g("TILDE",`^${c[h.LONETILDE]}${c[h.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${c[h.LONETILDE]}${c[h.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${c[h.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",g("CARET",`^${c[h.LONECARET]}${c[h.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${c[h.LONECARET]}${c[h.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${c[h.GTLT]}\\s*(${c[h.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${c[h.GTLT]}\\s*(${c[h.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${c[h.GTLT]}\\s*(${c[h.LOOSEPLAIN]}|${c[h.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${c[h.XRANGEPLAIN]})\\s+-\\s+(${c[h.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${c[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[h.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},25382:(t,e,n)=>{var a=n(49730);a&&a.__esModule&&(a=a.default),t.exports="string"==typeof a?a:a.toString()},13647:(t,e,n)=>{"use strict";n.r(e),n.d(e,{request:()=>f,settings:()=>y,storage:()=>g,type:()=>b});var a=n(13647),s=n(78584),i=n(26017);const r={async set(t,e){const n={};return n[t]=e,new Promise(((e,a)=>{o(t).set(n,(function(){chrome.runtime.lastError?a(chrome.runtime.lastError):e()}))}))},get:async t=>new Promise(((e,n)=>{o(t).get(t,(function(a){chrome.runtime.lastError?n(chrome.runtime.lastError):e(a[t])}))})),remove:async t=>new Promise(((e,n)=>{o(t).remove(t,(function(){chrome.runtime.lastError?n(chrome.runtime.lastError):e()}))})),list:async(t="local")=>new Promise(((e,n)=>{"local"===t?chrome.storage.local.get(null,(function(t){e(t)})):chrome.storage.sync.get(null,(function(t){e(t)}))})),async addStyle(t){try{const e=document.createElement("style");e.textContent=t,(document.head||document.body||document.documentElement||document).appendChild(e)}catch(t){console.log(`Could not add css:${t}`)}},version:()=>chrome.runtime.getManifest().version,lang(t,e){if(a.settings.get("forceEn")&&"undefined"!=typeof i18n){let n=i18n[t];if(void 0!==e)for(let t=0;t<e.length;t++)n=n.replace(`$${t+1}`,e[t]);return n}return chrome.i18n.getMessage(t,e)},langDirection(){try{const t=chrome.i18n.getUILanguage();if(/^(ar)(-|$)/i.test(t)&&!a.settings.get("forceEn"))return"rtl"}catch(t){s.error(t)}return"ltr"},assetUrl:t=>chrome.runtime.getURL(`assets/${t}`),injectCssResource(t,e){alert("injectCssResource not supported in webextension")},injectjsResource(t,e){const n=document.createElement("script");n.src=chrome.runtime.getURL(`vendor/${t}`),n.onload=function(){this.remove()},e.get(0).appendChild(n)},addProxyScriptToTag:(t,e)=>(t.src=chrome.runtime.getURL(`/content/proxy/proxy_${e}.js`),t),updateDom(t){const e=document.createElement("script");e.text="\n        document.getElementsByTagName('head')[0].onclick = function(e){\n          try{\n            componentHandler.upgradeDom();\n          }catch(e){\n            console.log(e);\n            setTimeout(function(){\n              componentHandler.upgradeDom();\n            },500);\n          }\n        }",e.onload=function(){this.remove()},t.get(0).appendChild(e)},storageOnChanged(t){chrome.storage.onChanged.addListener(t)}};function o(t){return i.syncRegex.test(t)?chrome.storage.sync:chrome.storage.local}const l={async xhr(t,e){if(void 0!==l.sendMessage)return l.sendMessage({name:"xhr",method:t,url:e}).then((t=>{if(429===t.status)throw"Rate limit Timeout";if(0===t.status)throw t.responseText;return t}));throw"Could not send xhr"},sendMessage:async t=>new Promise(((e,n)=>{chrome.runtime.sendMessage(t,(function(t){e(t)}))})),notification(t){this.sendMessage({name:"notification",options:t})},database(t,e){return this.sendMessage({name:"database",options:{call:t,param:e}})}};var c=n(50953),u=n(40111),h=n(13647),m=n(78584),p=n(26017);const d={options:(0,c.Kh)({autoTrackingModeanime:"video",readerTracking:!0,askBefore:!0,autoTrackingModemanga:"instant",enablePages:{},forceEn:!1,forceEnglishTitles:!1,rpc:!0,presenceLargeImage:"cover",presenceShowButtons:!0,presenceShowMalsync:!1,userscriptModeButton:!1,syncMode:"MAL",syncModeSimkl:"MAL",localSync:!0,delay:0,videoDuration:85,malTags:!1,malContinue:!0,malResume:!0,usedPage:!0,epPredictions:!0,mangaCompletionPercentage:90,theme:"auto",themeSidebars:!0,themeColor:"#000000",themeOpacity:100,themeImage:"",minimalWindow:!1,posLeft:"left",miniMALonMal:!1,floatButtonStealth:!1,minimizeBigPopup:!1,floatButtonCorrection:!0,floatButtonHide:!1,autoCloseMinimal:!1,outWay:!0,miniMalWidth:"550px",miniMalHeight:"90%",malThumbnail:100,friendScore:!0,loadPTWForProgress:!1,quicklinks:["Crunchyroll","Gogoanime","Mangadex","MangaNato","MangaFox","MangaSee","MangaFire","HiAnime","Hulu","Netflix","Hidive","VIZ","MangaPlus","MangaReader","ComicK","WeebCentral","KickAssAnime","animepahe"],quicklinksPosition:"default",autofull:!1,autoresume:!1,autoNextEp:!1,highlightAllEp:!1,checkForFiller:!0,crashReport:!0,introSkip:85,introSkipFwd:[17,39],introSkipBwd:[17,37],nextEpShort:[],correctionShort:[67],syncShort:[],progressInterval:120,progressIntervalDefaultAnime:"en/sub",progressIntervalDefaultManga:"en/sub",progressNotificationsAnime:!0,progressNotificationsManga:!0,notificationsSticky:!0,bookMarksList:!1,bookMarksListManga:!1,customDomains:[],anilistUpdateUi:!0,anilistToken:"",anilistOptions:{displayAdultContent:!0,scoreFormat:"POINT_10"},kitsuToken:"",kitsuOptions:{titleLanguagePreference:"canonical",sfwFilter:!1,ratingSystem:"regular"},simklToken:"",malToken:"",malRefresh:"",shikiToken:"",shikiOptions:{locale:"ru"}}),debounceArray:{},chibiList:{},isInit:(0,c.KR)(!1),async init(){const t=[];for(const e in this.options){const n=await h.storage.get(`settings/${e}`);void 0!==n&&(this.options[e]=n,t[e]=/(token|refresh)/i.test(e)&&n?"********":n)}try{const t=await u.I.getInstance(!0).init();this.chibiList=t.getList()}catch(t){m.error("Error loading chibi repo",t)}let e;return m.log("Settings",t),h.storage.storageOnChanged(((t,n)=>{if("sync"===n)for(const e in t){const n=t[e];/^settings\//i.test(e)&&(this.options[e.replace("settings/","")]=n.newValue,m.info(`Update ${e} option to ${JSON.stringify(n.newValue,null,2)}`))}if("local"===n&&t.rateLimit)try{clearTimeout(e),t.rateLimit.newValue?(m.log("Rate limited"),$(".type-rate").length||p.flashm("Rate limited. Retrying in a moment",{error:!0,type:"rate",permanent:!0})):e=setTimeout((()=>{m.log("No Rate limited"),$(".type-rate").remove()}),5e3)}catch(t){m.error(t)}})),this.isInit.value=!0,this},get(t){if(!this.isInit.value)throw"Settings not initialized";return this.options[t]},set(t,e){if(!Object.prototype.hasOwnProperty.call(this.options,t)){const e=Error(`${t} is not a defined option`);throw m.error(e),e}return this.options[t]=e,h.storage.set(`settings/${t}`,e)},setDebounce(t,e){this.options[t]=e,clearTimeout(this.debounceArray[t]),this.debounceArray[t]=setTimeout((()=>{this.set(t,e),delete this.debounceArray[t]}),1e3)},async getAsync(t){const e=await h.storage.get(`settings/${t}`);return void 0===e&&void 0!==this.options[t]?this.options[t]:e},getStaticChibi(){if(!this.isInit.value)throw"Settings not initialized";return this.chibiList}},g=r,f=l,y=d,b="webextension"},40111:(t,e,n)=>{"use strict";n.d(e,{I:()=>i});var a=n(96789),s=n(13647);class i{static getInstance(t=!1){let e;return e="userscript"===s.type?["https://chibi.malsync.moe/config"]:[chrome.runtime.getURL("chibi"),"https://chibi.malsync.moe/config"],new i(e,t)}constructor(t,e=!1){this.pages=null,this.collections=t,this.useCache=e}async init(){const t=`chibiPages-${s.storage.version()}`,e=await s.storage.get(t)||{chibiPages:{},errors:{}};if(this.useCache&&e.chibiPages&&Object.keys(e.chibiPages).length>0)return this.pages=e.chibiPages,this;const n={},i=(await Promise.all(this.collections.map((t=>this.retrieveCollection(t).catch((e=>(n[t]=e,null))))))).filter((t=>t));return e.errors=n,i.forEach((t=>{Object.keys(t.pages).forEach((n=>{if(t.pages[n].minimumVersion&&(0,a.GT)(t.pages[n].minimumVersion))return;const s=e.chibiPages[n]&&e.chibiPages[n].version.hash!==t.pages[n].version.hash&&Number(e.chibiPages[n].version.timestamp)<Number(t.pages[n].version.timestamp);e.chibiPages[n]&&!s||(e.chibiPages[n]=t.pages[n])}))})),await s.storage.set(t,e),this.pages=e.chibiPages,this}async retrieveCollection(t){const e=await s.request.xhr("GET",`${t}/list.json`),n=JSON.parse(e.responseText);return Object.keys(n.pages).forEach((e=>{n.pages[e].root=t})),n}getList(){if(!this.pages)throw new Error("Pages not loaded");return this.pages}async getPage(t){if(!this.pages)throw new Error("Pages not loaded");const e=this.pages[t];if(!e)throw new Error(`Page ${t} not found`);const n=await s.request.xhr("GET",`${e.root}/pages/${t}.json?version=${e.version.hash}`);return JSON.parse(n.responseText)}getPermissions(){const t=this.getList();return Object.values(t).map((t=>t.urls.match.map((e=>({page:`${t.name} (chibi)`,domain:e,auto:!0,chibi:!0}))))).flat()}getPermissionsElements(){const t=this.getList();return Object.values(t).map((t=>({name:`${t.name} (chibi)`,match:t.urls.match})))}}},78584:(t,e,n)=>{"use strict";n.r(e),n.d(e,{debug:()=>r,error:()=>s,info:()=>i,log:()=>a,m:()=>o});const a=Function.prototype.bind.call(console.log,console,"%cMAL-Sync","background-color: #2e51a2; color: white; padding: 2px 10px; border-radius: 3px;"),s=Function.prototype.bind.call(console.error,console,"%cMAL-Sync","background-color: #8f0000; color: white; padding: 2px 10px; border-radius: 3px;"),i=Function.prototype.bind.call(console.info,console,"%cMAL-Sync","background-color: wheat; color: black; padding: 2px 10px; border-radius: 3px;"),r=Function.prototype.bind.call(console.debug,console,"%cMAL-Sync","background-color: steelblue; color: black; padding: 2px 10px; border-radius: 3px;"),o=(t,e="",n=[])=>{let a="white";e||(e=function(t){if(!t)return"#ffffff";t=String(t);let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);let n="#";for(let t=0;t<3;t++)n+=`00${(e>>8*t&255).toString(16)}`.substr(-2);return n}(t)),"#"===e[0]&&(a=parseInt(e.replace("#",""),16)>8388607.5?"#000":"#fff");const s=`background-color: ${e}; color: ${a}; padding: 2px 10px; border-radius: 3px; margin-left: -5px; border-left: 1px solid white;`;n.push({name:t,style:s});const i={m:(t,e="")=>o(t,e,[...n])},r=n.reduce(((t,e)=>`${t}%c${e.name}`),""),l=n.map((t=>t.style));return i.log=Function.prototype.bind.call(console.log,console,`%cM ${r}`,"background-color: #2e51a2; color: white; padding: 2px 10px; border-radius: 3px;",...l),i.error=Function.prototype.bind.call(console.error,console,`%cM ${r}`,"background-color: #8f0000; color: white; padding: 2px 10px; border-radius: 3px;",...l),i.info=Function.prototype.bind.call(console.info,console,`%cM ${r}`,"background-color: wheat; color: black; padding: 2px 10px; border-radius: 3px;",...l),i.debug=Function.prototype.bind.call(console.debug,console,`%cM ${r}`,"background-color: steelblue; color: black; padding: 2px 10px; border-radius: 3px;",...l),i}},26017:(t,e,n)=>{"use strict";n.r(e),n.d(e,{absoluteLink:()=>v,canHideTabs:()=>j,changeDetect:()=>k,checkDoubleExecution:()=>x,clearCache:()=>at,elementInViewport:()=>Y,episode:()=>d,favicon:()=>h,flashConfirm:()=>B,flashm:()=>K,fullUrlChangeDetect:()=>E,getAsyncWaitUntilTrue:()=>T,getBaseText:()=>u,getContinueWaching:()=>C,getEntrySettings:()=>M,getResumeWaching:()=>R,getStatusText:()=>H,getTooltip:()=>U,getUrlFromTags:()=>A,getselect:()=>b,handleMalImages:()=>D,htmlDecode:()=>tt,isDomainMatching:()=>it,isFirefox:()=>et,lazyload:()=>X,notifications:()=>G,pageUrl:()=>Z,parseHtml:()=>w,planTo:()=>p,rateLimitExclude:()=>f,returnYYYYMMDD:()=>Q,setContinueWaching:()=>O,setEntrySettings:()=>P,setResumeWaching:()=>L,setUrlInTags:()=>N,sortAlphabetically:()=>st,status:()=>y,statusTag:()=>z,syncRegex:()=>g,timeCache:()=>W,timeDiffToText:()=>F,upperCaseFirstLetter:()=>rt,urlChangeDetect:()=>_,urlParam:()=>c,urlPart:()=>o,urlStrip:()=>l,wait:()=>J,waitForPageToBeVisible:()=>nt,waitUntilTrue:()=>S,watching:()=>m});var a=n(7263),s=n(13647),i=n(78584),r=n(26017);function o(t,e){if(!t)return"";const n=t.split("/");return n[e]?n[e].replace(/[#?].*/,""):""}function l(t){return t.replace(/[#?].*/,"")}function c(t,e){const n=new RegExp(`[?&]${e}=([^&#]*)`).exec(t);return null===n?null:decodeURI(n[1])||0}function u(t){let e=t.text();return t.children().each((function(){e=e.replace(a.$(this).text(),"")})),e}function h(t){if(!t)return"";const e=t.match(/^(https?:\/\/)?[^/]+/);return e&&(t=e[0]),`https://favicon.malsync.moe/?domain=${t}`}function m(t){return"manga"===t?"Reading":"Watching"}function p(t){return"manga"===t?"Plan to Read":"Plan to Watch"}function d(t){return"manga"===t?s.storage.lang("UI_Chapter"):s.storage.lang("UI_Episode")}const g=/(^settings\/.*|^updateCheckTime$|^tempVersion$|^local:\/\/|^list-tagSettings$)/,f=/^https:\/\/api.malsync.moe\/(shark|mal\/|nc\/mal\/.*\/progress$)/i;var y;function b(t,e){let n=t.split(`name="${e}"`)[1].split("</select>")[0];if(n.indexOf('selected="selected"')>-1){n=n.split("<option");for(let t=0;t<n.length;++t)if(n[t].indexOf('selected="selected"')>-1)return n[t].split('value="')[1].split('"')[0]}return""}function v(t,e){return void 0===t||t.startsWith("http")||("/"!==t.charAt(0)&&(t=`/${t}`),t=e+t),t}function w(t){return(new DOMParser).parseFromString(`<!doctype html><body>${t}`,"text/html").body.textContent}function _(t){let e=window.location.href;return setInterval((function(){e!==window.location.href&&(e=window.location.href,t())}),100)}function E(t,e=!1){let n="";const a=setInterval((function(){const a=e?l(window.location.href):window.location.href;n!==a&&(n=a,t())}),100);return Number(a)}function k(t,e,n=!1){let a=e();const s=setInterval((function(){const n=e();void 0!==n&&a!==n&&(a=e(),t())}),500);return n&&t(),Number(s)}function S(t,e,n=100){let a=0;const s=setInterval((function(){a++;let r=!1;try{r=t()}catch(t){i.info("Error in waitUntilTrue",t)}if(r&&(clearInterval(s),e()),a>10){clearInterval(s);const a=Math.max(Math.min(2*n,15e3),500);S(t,e,a)}}),n);return s}function T(t,e=100){let n,a;const s=()=>{clearTimeout(n),a&&a("AsyncWait stopped")};return{asyncWaitUntilTrue:()=>(s(),new Promise(((s,i)=>{a=i,n=S(t,(()=>s()),e)}))),reset:s}}!function(t){t[t.watching=1]="watching",t[t.completed=2]="completed",t[t.onhold=3]="onhold",t[t.dropped=4]="dropped",t[t.planToWatch=6]="planToWatch"}(y||(y={}));const I=Math.random();function x(){$(".mal-sync-double-detect").length&&$(".mal-sync-double-detect").each((function(t){$(this).text()!==I.toString()&&alert("Double execution detected! Please run MAL-Sync once only.")})),$("body").after(a.html(`<div class="mal-sync-double-detect" style="display: none;">${I.toString()}</div>`))}function A(t){return/malSync::[\d\D]+::/.test(t)?e(t.split("malSync::")[1].split("::")[0]):/last::[\d\D]+::/.test(t)?e(t.split("last::")[1].split("::")[0]):void 0;function e(t){try{return atob(t)}catch(e){return t}}}function N(t,e){if(""===t)return e.replace(/,?(malSync|last)::[^ \n]+?::/,"");if(!s.settings.get("malTags"))return e;const n=`malSync::${btoa(t)}::`;return/(last|malSync)::[\d\D]+::/.test(e)?e.replace(/(last|malSync)::[^^]*?::/,n):`${e},${n}`}async function L(t,e,n,a){return s.storage.set(`resume/${n}/${a}`,{url:t,ep:e})}async function R(t,e){if(s.settings.get("malResume"))return s.storage.get(`resume/${t}/${e}`)}async function O(t,e,n,a){return s.storage.set(`continue/${n}/${a}`,{url:t,ep:e})}async function C(t,e){if(s.settings.get("malContinue"))return s.storage.get(`continue/${t}/${e}`)}async function P(t,e,n,a=""){const i={};if(n){for(const t in n)switch(t){case"u":case"p":i[t]=n[t]}s.settings.get("malTags")?a=N(JSON.stringify(i),a):await s.storage.set(`tagSettings/${t}/${e}`,JSON.stringify(i))}return Object.values(i).find((t=>Boolean(t)))||(a=N("",a),s.settings.get("malTags")||await s.storage.remove(`tagSettings/${t}/${e}`)),a}async function M(t,e,n=""){const a={u:null,c:null,r:null,p:""};if(s.settings.get("malTags")){const t=A(n);if(t)if("{"===t[0])try{const e=JSON.parse(t);for(const t in a)e[t]&&(a[t]=e[t])}catch(t){i.error(t)}else a.u=t}else{let n=await s.storage.get(`tagSettings/${t}/${e}`);if(n){n=JSON.parse(n);for(const t in a)n[t]&&(a[t]=n[t])}}const r=await C(t,e);r&&(a.c=r);const o=await R(t,e);return o&&(a.r=o),s.settings.get("usedPage")||(a.u=null),a}function D(t){return-1!==t.indexOf("questionmark")?s.storage.assetUrl("questionmark.gif"):t}function U(t,e="",n="top"){const a=Math.floor(1e3*Math.random()+1);return`<div id="tt${a}" class="icon material-icons" style="font-size:16px; line-height: 0; color: #7f7f7f; padding-bottom: 20px; padding-left: 3px; ${e}">contact_support</div>  <div class="mdl-tooltip mdl-tooltip--${n} mdl-tooltip--large" for="tt${a}">${t}</div>`}function F(t){let e="";t/=1e3;const n=Math.floor(t/31536e3);t-=31536e3*n,n&&(e+=`${n}y `);const a=Math.floor(t/86400);t-=86400*a,a&&(e+=`${a}d `);const s=Math.floor(t/3600)%24;t-=3600*s,s&&a<2&&(e+=`${s}h `);const i=Math.floor(t/60)%60;return t-=60*i,i&&!a&&s<3&&(e+=`${i}min `),e}function j(){return"undefined"!=typeof browser&&void 0!==browser.tabs.hide}function z(t,e,n){const a={anime:{1:{class:"watching",text:"CW",title:s.storage.lang(`UI_Status_watching_${e}`)},2:{class:"completed",text:"CMPL",title:s.storage.lang("UI_Status_Completed")},3:{class:"on-hold",text:"HOLD",title:s.storage.lang("UI_Status_OnHold")},4:{class:"dropped",text:"DROP",title:s.storage.lang("UI_Status_Dropped")},6:{class:"plantowatch",text:"PTW",title:s.storage.lang(`UI_Status_planTo_${e}`)},23:{class:"rewatching",text:"RE",title:s.storage.lang(`UI_Status_Rewatching_${e}`)}},manga:{1:{class:"reading",text:"CR",title:s.storage.lang(`UI_Status_watching_${e}`)},2:{class:"completed",text:"CMPL",title:s.storage.lang("UI_Status_Completed")},3:{class:"on-hold",text:"HOLD",title:s.storage.lang("UI_Status_OnHold")},4:{class:"dropped",text:"DROP",title:s.storage.lang("UI_Status_Dropped")},6:{class:"plantoread",text:"PTR",title:s.storage.lang(`UI_Status_planTo_${e}`)},23:{class:"rewatching",text:"RE",title:s.storage.lang(`UI_Status_Rewatching_${e}`)}}};if($.each([1,2,3,4,6,23],(function(t,e){a.anime[a.anime[e].title]=a.anime[e],a.manga[a.manga[e].title]=a.manga[e]})),t&&a[e][t]){const s=a[e][t];return` <a href="https://myanimelist.net/ownlist/${e}/${n}/edit?hideLayout=1" title="${s.title}" class="Lightbox_AddEdit button_edit ${s.class}">${s.text}</a>`}return!1}function H(t,e){switch(e){case 1:return s.storage.lang(`UI_Status_watching_${t}`);case 2:return s.storage.lang("UI_Status_Completed");case 3:return s.storage.lang("UI_Status_OnHold");case 4:return s.storage.lang("UI_Status_Dropped");case 6:return s.storage.lang(`UI_Status_planTo_${t}`);case 7:return s.storage.lang("UI_Status_All");case 23:return s.storage.lang(`UI_Status_Rewatching_${t}`);default:return""}}function G(t,e,n,a=""){const r={type:"basic",title:e,message:n,iconUrl:a};i.log("Notification",t,r),s.storage.get("notificationHistory").then((e=>{void 0===e&&(e=[]),"object"==typeof e&&(e.length>=10&&e.shift(),e.push({url:t,title:r.title,message:r.message,iconUrl:r.iconUrl,timestamp:Date.now()}),s.storage.set("notificationHistory",e))}));try{return chrome.notifications.create(t,r)}catch(t){i.error(t)}}async function W(t,e,n){const a=await s.storage.get(t);if("object"==typeof a&&(new Date).getTime()<a.timestamp)return a.data;const i=await e();return s.storage.set(t,{data:i,timestamp:(new Date).getTime()+n}).then((()=>i))}function K(t,e){a.$("#flash-div-top").length||function(){s.storage.addStyle('.flashinfo{\n                    transition: max-height 2s, opacity 2s 2s;\n                 }\n                 .mini-stealth .flashinfo{\n                    opacity: 0;\n                 }\n                  #flashinfo-div.hover.mini-stealth .flashinfo.type-update{\n                    opacity: 0.7;\n                 }\n                 #flashinfo-div.hover .flashinfo{\n                    opacity: 1;\n                 }\n                 .flashinfo:hover{\n                    max-height:5000px !important;\n                    z-index: 2147483647;\n                    opacity: 1;\n                    transition: max-height 2s;\n                 }\n                 .flashinfo .synopsis{\n                    transition: max-height 2s, max-width 2s ease 2s;\n                 }\n                 .flashinfo:hover .synopsis{\n                    max-height:9999px !important;\n                    max-width: 500px !important;\n                    transition: max-height 2s;\n                 }\n                 #flashinfo-div{\n                  z-index: 2;\n                  transition: 2s;\n                 }\n                 #flashinfo-div:hover, #flashinfo-div.hover{\n                  z-index: 2147483647;\n                 }\n                 #flashinfo-div.player-error {\n                   z-index: 2147483647;\n                 }\n                 #flashinfo-div.player-error .type-update{\n                  overflow: visible !important;\n                  opacity: 1 !important;\n                 }\n                 #flashinfo-div.player-error .player-error{\n                  display: block !important\n                 }\n                 #flashinfo-div.player-error-missing-permissions .player-error-missing-permissions{\n                  display: block !important\n                 }\n                 #flashinfo-div.player-error-missing-permissions .player-error-default{\n                  display: none !important\n                 }\n\n                 #flash-div-top, #flash-div-bottom, #flashinfo-div{\n                    font-family: "Helvetica","Arial",sans-serif;\n                    color: white;\n                    font-size: 14px;\n                    font-weight: 400;\n                    line-height: 17px;\n                 }\n                 #flash-div-top h2, #flash-div-bottom h2, #flashinfo-div h2{\n                    font-family: "Helvetica","Arial",sans-serif;\n                    color: white;\n                    font-size: 14px;\n                    font-weight: 700;\n                    line-height: 17px;\n                    padding: 0;\n                    margin: 0;\n                 }\n                 #flash-div-top a, #flash-div-bottom a, #flashinfo-div a{\n                    color: #DF6300;\n                 }');let t="";s.settings.get("floatButtonStealth")&&(t="mini-stealth"),a.$("body").after(a.html(`<div id="flash-div-top" dir="${s.storage.langDirection()}" style="text-align: center;pointer-events: none;position: fixed;top:-5px;width:100%;z-index: 2147483647;left: 0;"></div>        <div id="flash-div-bottom" dir="${s.storage.langDirection()}" style="text-align: center;pointer-events: none;position: fixed;bottom:0px;width:100%;z-index: 2147483647;left: 0;"><div id="flash" style="display:none;  background-color: red;padding: 20px; margin: 0 auto;max-width: 60%;          -webkit-border-radius: 20px;-moz-border-radius: 20px;border-radius: 20px;background:rgba(227,0,0,0.6);"></div></div>        <div id="flashinfo-div" dir="${s.storage.langDirection()}" class="${t}" style="text-align: center;pointer-events: none;position: fixed;bottom:0px;width:100%;left: 0;">`))}(),i.log("[Flash] Message:",t);let n="#323232";void 0!==e&&void 0!==e.error&&e.error&&(n="#3e0808");let r="#flash-div-bottom";void 0!==e&&void 0!==e.position&&e.position&&(r=`#flash-div-${e.position}`);let o="flash";if(void 0!==e&&void 0!==e.type&&e.type){const t=`type-${e.type}`;a.$(`${r} .${t}, #flashinfo-div .${t}`).removeClass(t).fadeOut({duration:1e3,queue:!1,complete(){a.$(this).remove()}}),o+=` ${t}`}let l,c=`<div class="${o}" style="display:none;">        <div style="display:table; pointer-events: all; padding: 14px 24px 14px 24px; margin: 0 auto; margin-top: 5px; max-width: 60%; -webkit-border-radius: 20px;-moz-border-radius: 20px;border-radius: 2px;color: white;background:${n}; ">          ${t}        </div>      </div>`;return void 0!==e&&void 0!==e.hoverInfo&&e.hoverInfo?(o+=" flashinfo",c=`<div class="${o}" style="display:none; max-height: 5000px; overflow: hidden;"><div style="display:table; pointer-events: all; margin: 0 auto; margin-top: -2px; max-width: 60%; -webkit-border-radius: 20px;-moz-border-radius: 20px;border-radius: 2px;color: white;background:${n}; position: relative;"><div style="max-height: 60vh; overflow-y: auto; padding: 14px 24px 14px 24px;">${t}</div></div></div>`,a.$("#flashinfo-div").addClass("hover"),l=a.$(a.html(c)).appendTo("#flashinfo-div"),void 0!==e&&void 0!==e.minimized&&e.minimized&&l.css("max-height","8px")):l=a.$(a.html(c)).appendTo(r),void 0!==e&&void 0!==e.permanent&&e.permanent?l.slideDown(800):void 0!==e&&void 0!==e.hoverInfo&&e.hoverInfo?l.slideDown(800).delay(4e3).queue((function(){a.$("#flashinfo-div").removeClass("hover"),l.css("max-height","8px")})):l.slideDown(800).delay(4e3).slideUp(800,(()=>{a.$(this).remove()})),l}async function B(t,e,n=()=>{},i=()=>{},r=!1){return new Promise((function(o,l){let c=s.storage.lang("Ok"),u=s.storage.lang("Cancel");r&&(c=s.storage.lang("Yes"),u=s.storage.lang("No"));const h=K(t=`<div style="text-align: center;">${t}</div><div style="display: flex; justify-content: space-around;"><button class="Yes" style="background-color: transparent; border: none; color: rgb(255,64,129);margin-top: 10px; cursor:pointer;">${c}</button><button class="Cancel" style="background-color: transparent; border: none; color: rgb(255,64,129);margin-top: 10px; cursor:pointer;">${u}</button></div>`,{permanent:!0,position:"top",type:e});h.find(".Yes").click((function(t){o(!0),a.$(t.target).parentsUntil(".flash").fadeOut(300,(function(){a.$(this).remove()})),n()})),h.find(".Cancel").click((function(t){o(!1),a.$(t.target).parentsUntil(".flash").fadeOut(300,(function(){a.$(this).remove()})),i()}))}))}let V=!1,q=[];function X(t,e=".mdl-layout__content"){function n(t,e){if(!a.$(t).is(":visible"))return!1;if(a.$(t).hasClass("lazyBack"))a.$(t).css("background-image",`url(${t.getAttribute("data-src")})`).removeClass("lazyBack");else{const n=new Image,a=t.getAttribute("data-src");n.onload=function(){t.parent?t.parent.replaceChild(n,t):t.src=a,e&&e()},n.src=a}}for(let t=0;t<q.length;t++)$(q[t]).addClass("init");q=[];const s=t.find("img.lazy.init, .lazyBack.init"),i=function(){for(let t=0;t<q.length;t++)r.elementInViewport(q[t],600)&&n(q[t],(function(){q.splice(t,t)})),$(q[t]).length||q.splice(t,t)};for(let t=0;t<s.length;t++)q.push(s[t]),$(s[t]).removeClass("init");i(),V||(V=!0,t.find(e).scroll((function(){i()})))}function Y(t,e=0){const n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.top-e<=(window.innerHeight||document.documentElement.clientHeight)}function J(t){return new Promise((e=>{setTimeout(e,t)}))}function Z(t,e,n){switch(t){case"mal":return`https://myanimelist.net/${e}/${n}`;case"anilist":return`https://anilist.co/${e}/${n}`;case"kitsu":return`https://kitsu.app/${e}/${n}`;case"simkl":return`https://simkl.com/${e}/${n}`;default:throw`${t} not a valid page`}}function Q(t=0){const e=new Date;e.setDate(e.getDate()+t);const n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${e.getFullYear()}-${n}-${a}`}function tt(t){return $("<textarea/>").html(a.html(t)).text()}function et(){return Boolean("undefined"!=typeof browser&&"undefined"!=typeof chrome)}function nt(){const t=()=>Boolean(!document.visibilityState||"visible"===document.visibilityState);if(t())return Promise.resolve();i.log("Page in background");const{asyncWaitUntilTrue:e}=T((()=>t()));return e().then((()=>{i.log("Page is visible")}))}async function at(){const t=await s.storage.list();let e=0;for(const n in t)r.syncRegex.test(n)||/(^tagSettings\/.*)/.test(n)||(s.storage.remove(n),e++);r.flashm(`Cache Cleared [${e}]`)}function st(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0}function it(t,e){const n=new URL(t),{host:a}=n;return a===e||a.endsWith(`.${e}`)}function rt(t){return!t||t.length<2?t:t.charAt(0).toUpperCase()+t.slice(1)}},7263:(t,e,n)=>{"use strict";n.r(e),n.d(e,{$:()=>s,html:()=>i});var a=n(99418);const s=jQuery;function i(t){return a.A.sanitize(t,{ALLOW_UNKNOWN_PROTOCOLS:!0,ADD_ATTR:["target"]})}},96789:(t,e,n)=>{"use strict";n.d(e,{GT:()=>o}),n(54089);var a=n(35580),s=n.n(a),i=n(13647);function r(){return i.storage.version()}function o(t){return s()(t,r())&&t!==r()}},99418:(t,e,n)=>{"use strict";n.d(e,{A:()=>nt});const{entries:a,setPrototypeOf:s,isFrozen:i,getPrototypeOf:r,getOwnPropertyDescriptor:o}=Object;let{freeze:l,seal:c,create:u}=Object,{apply:h,construct:m}="undefined"!=typeof Reflect&&Reflect;l||(l=function(t){return t}),c||(c=function(t){return t}),h||(h=function(t,e,n){return t.apply(e,n)}),m||(m=function(t,e){return new t(...e)});const p=A(Array.prototype.forEach),d=A(Array.prototype.lastIndexOf),g=A(Array.prototype.pop),f=A(Array.prototype.push),y=A(Array.prototype.splice),b=A(String.prototype.toLowerCase),v=A(String.prototype.toString),w=A(String.prototype.match),_=A(String.prototype.replace),E=A(String.prototype.indexOf),k=A(String.prototype.trim),S=A(Object.prototype.hasOwnProperty),T=A(RegExp.prototype.test),I=(x=TypeError,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return m(x,e)});var x;function A(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return h(t,e,a)}}function N(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b;s&&s(t,null);let a=e.length;for(;a--;){let s=e[a];if("string"==typeof s){const t=n(s);t!==s&&(i(e)||(e[a]=t),s=t)}t[s]=!0}return t}function $(t){for(let e=0;e<t.length;e++)S(t,e)||(t[e]=null);return t}function L(t){const e=u(null);for(const[n,s]of a(t))S(t,n)&&(Array.isArray(s)?e[n]=$(s):s&&"object"==typeof s&&s.constructor===Object?e[n]=L(s):e[n]=s);return e}function R(t,e){for(;null!==t;){const n=o(t,e);if(n){if(n.get)return A(n.get);if("function"==typeof n.value)return A(n.value)}t=r(t)}return function(){return null}}const O=l(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),C=l(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),P=l(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),M=l(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),D=l(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),U=l(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),F=l(["#text"]),j=l(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),z=l(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),H=l(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),G=l(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),W=c(/\{\{[\w\W]*|[\w\W]*\}\}/gm),K=c(/<%[\w\W]*|[\w\W]*%>/gm),B=c(/\$\{[\w\W]*/gm),V=c(/^data-[\-\w.\u00B7-\uFFFF]+$/),q=c(/^aria-[\-\w]+$/),X=c(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Y=c(/^(?:\w+script|data):/i),J=c(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Z=c(/^html$/i),Q=c(/^[a-z][.\w]*(-[.\w]+)+$/i);var tt=Object.freeze({__proto__:null,ARIA_ATTR:q,ATTR_WHITESPACE:J,CUSTOM_ELEMENT:Q,DATA_ATTR:V,DOCTYPE_NAME:Z,ERB_EXPR:K,IS_ALLOWED_URI:X,IS_SCRIPT_OR_DATA:Y,MUSTACHE_EXPR:W,TMPLIT_EXPR:B});const et=function(){return"undefined"==typeof window?null:window};var nt=function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et();const n=e=>t(e);if(n.version="3.2.5",n.removed=[],!e||!e.document||9!==e.document.nodeType||!e.Element)return n.isSupported=!1,n;let{document:s}=e;const i=s,r=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:c,Node:h,Element:m,NodeFilter:x,NamedNodeMap:A=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:$,DOMParser:W,trustedTypes:K}=e,B=m.prototype,V=R(B,"cloneNode"),q=R(B,"remove"),Y=R(B,"nextSibling"),J=R(B,"childNodes"),Q=R(B,"parentNode");if("function"==typeof c){const t=s.createElement("template");t.content&&t.content.ownerDocument&&(s=t.content.ownerDocument)}let nt,at="";const{implementation:st,createNodeIterator:it,createDocumentFragment:rt,getElementsByTagName:ot}=s,{importNode:lt}=i;let ct={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof a&&"function"==typeof Q&&st&&void 0!==st.createHTMLDocument;const{MUSTACHE_EXPR:ut,ERB_EXPR:ht,TMPLIT_EXPR:mt,DATA_ATTR:pt,ARIA_ATTR:dt,IS_SCRIPT_OR_DATA:gt,ATTR_WHITESPACE:ft,CUSTOM_ELEMENT:yt}=tt;let{IS_ALLOWED_URI:bt}=tt,vt=null;const wt=N({},[...O,...C,...P,...D,...F]);let _t=null;const Et=N({},[...j,...z,...H,...G]);let kt=Object.seal(u(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),St=null,Tt=null,It=!0,xt=!0,At=!1,Nt=!0,$t=!1,Lt=!0,Rt=!1,Ot=!1,Ct=!1,Pt=!1,Mt=!1,Dt=!1,Ut=!0,Ft=!1,jt=!0,zt=!1,Ht={},Gt=null;const Wt=N({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Kt=null;const Bt=N({},["audio","video","img","source","image","track"]);let Vt=null;const qt=N({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Xt="http://www.w3.org/1998/Math/MathML",Yt="http://www.w3.org/2000/svg",Jt="http://www.w3.org/1999/xhtml";let Zt=Jt,Qt=!1,te=null;const ee=N({},[Xt,Yt,Jt],v);let ne=N({},["mi","mo","mn","ms","mtext"]),ae=N({},["annotation-xml"]);const se=N({},["title","style","font","a","script"]);let ie=null;const re=["application/xhtml+xml","text/html"];let oe=null,le=null;const ce=s.createElement("form"),ue=function(t){return t instanceof RegExp||t instanceof Function},he=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!le||le!==t){if(t&&"object"==typeof t||(t={}),t=L(t),ie=-1===re.indexOf(t.PARSER_MEDIA_TYPE)?"text/html":t.PARSER_MEDIA_TYPE,oe="application/xhtml+xml"===ie?v:b,vt=S(t,"ALLOWED_TAGS")?N({},t.ALLOWED_TAGS,oe):wt,_t=S(t,"ALLOWED_ATTR")?N({},t.ALLOWED_ATTR,oe):Et,te=S(t,"ALLOWED_NAMESPACES")?N({},t.ALLOWED_NAMESPACES,v):ee,Vt=S(t,"ADD_URI_SAFE_ATTR")?N(L(qt),t.ADD_URI_SAFE_ATTR,oe):qt,Kt=S(t,"ADD_DATA_URI_TAGS")?N(L(Bt),t.ADD_DATA_URI_TAGS,oe):Bt,Gt=S(t,"FORBID_CONTENTS")?N({},t.FORBID_CONTENTS,oe):Wt,St=S(t,"FORBID_TAGS")?N({},t.FORBID_TAGS,oe):{},Tt=S(t,"FORBID_ATTR")?N({},t.FORBID_ATTR,oe):{},Ht=!!S(t,"USE_PROFILES")&&t.USE_PROFILES,It=!1!==t.ALLOW_ARIA_ATTR,xt=!1!==t.ALLOW_DATA_ATTR,At=t.ALLOW_UNKNOWN_PROTOCOLS||!1,Nt=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,$t=t.SAFE_FOR_TEMPLATES||!1,Lt=!1!==t.SAFE_FOR_XML,Rt=t.WHOLE_DOCUMENT||!1,Pt=t.RETURN_DOM||!1,Mt=t.RETURN_DOM_FRAGMENT||!1,Dt=t.RETURN_TRUSTED_TYPE||!1,Ct=t.FORCE_BODY||!1,Ut=!1!==t.SANITIZE_DOM,Ft=t.SANITIZE_NAMED_PROPS||!1,jt=!1!==t.KEEP_CONTENT,zt=t.IN_PLACE||!1,bt=t.ALLOWED_URI_REGEXP||X,Zt=t.NAMESPACE||Jt,ne=t.MATHML_TEXT_INTEGRATION_POINTS||ne,ae=t.HTML_INTEGRATION_POINTS||ae,kt=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&ue(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(kt.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&ue(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(kt.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(kt.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),$t&&(xt=!1),Mt&&(Pt=!0),Ht&&(vt=N({},F),_t=[],!0===Ht.html&&(N(vt,O),N(_t,j)),!0===Ht.svg&&(N(vt,C),N(_t,z),N(_t,G)),!0===Ht.svgFilters&&(N(vt,P),N(_t,z),N(_t,G)),!0===Ht.mathMl&&(N(vt,D),N(_t,H),N(_t,G))),t.ADD_TAGS&&(vt===wt&&(vt=L(vt)),N(vt,t.ADD_TAGS,oe)),t.ADD_ATTR&&(_t===Et&&(_t=L(_t)),N(_t,t.ADD_ATTR,oe)),t.ADD_URI_SAFE_ATTR&&N(Vt,t.ADD_URI_SAFE_ATTR,oe),t.FORBID_CONTENTS&&(Gt===Wt&&(Gt=L(Gt)),N(Gt,t.FORBID_CONTENTS,oe)),jt&&(vt["#text"]=!0),Rt&&N(vt,["html","head","body"]),vt.table&&(N(vt,["tbody"]),delete St.tbody),t.TRUSTED_TYPES_POLICY){if("function"!=typeof t.TRUSTED_TYPES_POLICY.createHTML)throw I('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof t.TRUSTED_TYPES_POLICY.createScriptURL)throw I('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');nt=t.TRUSTED_TYPES_POLICY,at=nt.createHTML("")}else void 0===nt&&(nt=function(t,e){if("object"!=typeof t||"function"!=typeof t.createPolicy)return null;let n=null;const a="data-tt-policy-suffix";e&&e.hasAttribute(a)&&(n=e.getAttribute(a));const s="dompurify"+(n?"#"+n:"");try{return t.createPolicy(s,{createHTML:t=>t,createScriptURL:t=>t})}catch(t){return console.warn("TrustedTypes policy "+s+" could not be created."),null}}(K,r)),null!==nt&&"string"==typeof at&&(at=nt.createHTML(""));l&&l(t),le=t}},me=N({},[...C,...P,...M]),pe=N({},[...D,...U]),de=function(t){f(n.removed,{element:t});try{Q(t).removeChild(t)}catch(e){q(t)}},ge=function(t,e){try{f(n.removed,{attribute:e.getAttributeNode(t),from:e})}catch(t){f(n.removed,{attribute:null,from:e})}if(e.removeAttribute(t),"is"===t)if(Pt||Mt)try{de(e)}catch(t){}else try{e.setAttribute(t,"")}catch(t){}},fe=function(t){let e=null,n=null;if(Ct)t="<remove></remove>"+t;else{const e=w(t,/^[\r\n\t ]+/);n=e&&e[0]}"application/xhtml+xml"===ie&&Zt===Jt&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");const a=nt?nt.createHTML(t):t;if(Zt===Jt)try{e=(new W).parseFromString(a,ie)}catch(t){}if(!e||!e.documentElement){e=st.createDocument(Zt,"template",null);try{e.documentElement.innerHTML=Qt?at:a}catch(t){}}const i=e.body||e.documentElement;return t&&n&&i.insertBefore(s.createTextNode(n),i.childNodes[0]||null),Zt===Jt?ot.call(e,Rt?"html":"body")[0]:Rt?e.documentElement:i},ye=function(t){return it.call(t.ownerDocument||t,t,x.SHOW_ELEMENT|x.SHOW_COMMENT|x.SHOW_TEXT|x.SHOW_PROCESSING_INSTRUCTION|x.SHOW_CDATA_SECTION,null)},be=function(t){return t instanceof $&&("string"!=typeof t.nodeName||"string"!=typeof t.textContent||"function"!=typeof t.removeChild||!(t.attributes instanceof A)||"function"!=typeof t.removeAttribute||"function"!=typeof t.setAttribute||"string"!=typeof t.namespaceURI||"function"!=typeof t.insertBefore||"function"!=typeof t.hasChildNodes)},ve=function(t){return"function"==typeof h&&t instanceof h};function we(t,e,a){p(t,(t=>{t.call(n,e,a,le)}))}const _e=function(t){let e=null;if(we(ct.beforeSanitizeElements,t,null),be(t))return de(t),!0;const a=oe(t.nodeName);if(we(ct.uponSanitizeElement,t,{tagName:a,allowedTags:vt}),t.hasChildNodes()&&!ve(t.firstElementChild)&&T(/<[/\w!]/g,t.innerHTML)&&T(/<[/\w!]/g,t.textContent))return de(t),!0;if(7===t.nodeType)return de(t),!0;if(Lt&&8===t.nodeType&&T(/<[/\w]/g,t.data))return de(t),!0;if(!vt[a]||St[a]){if(!St[a]&&ke(a)){if(kt.tagNameCheck instanceof RegExp&&T(kt.tagNameCheck,a))return!1;if(kt.tagNameCheck instanceof Function&&kt.tagNameCheck(a))return!1}if(jt&&!Gt[a]){const e=Q(t)||t.parentNode,n=J(t)||t.childNodes;if(n&&e)for(let a=n.length-1;a>=0;--a){const s=V(n[a],!0);s.__removalCount=(t.__removalCount||0)+1,e.insertBefore(s,Y(t))}}return de(t),!0}return t instanceof m&&!function(t){let e=Q(t);e&&e.tagName||(e={namespaceURI:Zt,tagName:"template"});const n=b(t.tagName),a=b(e.tagName);return!!te[t.namespaceURI]&&(t.namespaceURI===Yt?e.namespaceURI===Jt?"svg"===n:e.namespaceURI===Xt?"svg"===n&&("annotation-xml"===a||ne[a]):Boolean(me[n]):t.namespaceURI===Xt?e.namespaceURI===Jt?"math"===n:e.namespaceURI===Yt?"math"===n&&ae[a]:Boolean(pe[n]):t.namespaceURI===Jt?!(e.namespaceURI===Yt&&!ae[a])&&!(e.namespaceURI===Xt&&!ne[a])&&!pe[n]&&(se[n]||!me[n]):!("application/xhtml+xml"!==ie||!te[t.namespaceURI]))}(t)?(de(t),!0):"noscript"!==a&&"noembed"!==a&&"noframes"!==a||!T(/<\/no(script|embed|frames)/i,t.innerHTML)?($t&&3===t.nodeType&&(e=t.textContent,p([ut,ht,mt],(t=>{e=_(e,t," ")})),t.textContent!==e&&(f(n.removed,{element:t.cloneNode()}),t.textContent=e)),we(ct.afterSanitizeElements,t,null),!1):(de(t),!0)},Ee=function(t,e,n){if(Ut&&("id"===e||"name"===e)&&(n in s||n in ce))return!1;if(xt&&!Tt[e]&&T(pt,e));else if(It&&T(dt,e));else if(!_t[e]||Tt[e]){if(!(ke(t)&&(kt.tagNameCheck instanceof RegExp&&T(kt.tagNameCheck,t)||kt.tagNameCheck instanceof Function&&kt.tagNameCheck(t))&&(kt.attributeNameCheck instanceof RegExp&&T(kt.attributeNameCheck,e)||kt.attributeNameCheck instanceof Function&&kt.attributeNameCheck(e))||"is"===e&&kt.allowCustomizedBuiltInElements&&(kt.tagNameCheck instanceof RegExp&&T(kt.tagNameCheck,n)||kt.tagNameCheck instanceof Function&&kt.tagNameCheck(n))))return!1}else if(Vt[e]);else if(T(bt,_(n,ft,"")));else if("src"!==e&&"xlink:href"!==e&&"href"!==e||"script"===t||0!==E(n,"data:")||!Kt[t])if(At&&!T(gt,_(n,ft,"")));else if(n)return!1;return!0},ke=function(t){return"annotation-xml"!==t&&w(t,yt)},Se=function(t){we(ct.beforeSanitizeAttributes,t,null);const{attributes:e}=t;if(!e||be(t))return;const a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:_t,forceKeepAttr:void 0};let s=e.length;for(;s--;){const i=e[s],{name:r,namespaceURI:o,value:l}=i,c=oe(r);let u="value"===r?l:k(l);if(a.attrName=c,a.attrValue=u,a.keepAttr=!0,a.forceKeepAttr=void 0,we(ct.uponSanitizeAttribute,t,a),u=a.attrValue,!Ft||"id"!==c&&"name"!==c||(ge(r,t),u="user-content-"+u),Lt&&T(/((--!?|])>)|<\/(style|title)/i,u)){ge(r,t);continue}if(a.forceKeepAttr)continue;if(ge(r,t),!a.keepAttr)continue;if(!Nt&&T(/\/>/i,u)){ge(r,t);continue}$t&&p([ut,ht,mt],(t=>{u=_(u,t," ")}));const h=oe(t.nodeName);if(Ee(h,c,u)){if(nt&&"object"==typeof K&&"function"==typeof K.getAttributeType)if(o);else switch(K.getAttributeType(h,c)){case"TrustedHTML":u=nt.createHTML(u);break;case"TrustedScriptURL":u=nt.createScriptURL(u)}try{o?t.setAttributeNS(o,r,u):t.setAttribute(r,u),be(t)?de(t):g(n.removed)}catch(t){}}}we(ct.afterSanitizeAttributes,t,null)},Te=function t(e){let n=null;const a=ye(e);for(we(ct.beforeSanitizeShadowDOM,e,null);n=a.nextNode();)we(ct.uponSanitizeShadowNode,n,null),_e(n),Se(n),n.content instanceof o&&t(n.content);we(ct.afterSanitizeShadowDOM,e,null)};return n.sanitize=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null,s=null,r=null,l=null;if(Qt=!t,Qt&&(t="\x3c!--\x3e"),"string"!=typeof t&&!ve(t)){if("function"!=typeof t.toString)throw I("toString is not a function");if("string"!=typeof(t=t.toString()))throw I("dirty is not a string, aborting")}if(!n.isSupported)return t;if(Ot||he(e),n.removed=[],"string"==typeof t&&(zt=!1),zt){if(t.nodeName){const e=oe(t.nodeName);if(!vt[e]||St[e])throw I("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof h)a=fe("\x3c!----\x3e"),s=a.ownerDocument.importNode(t,!0),1===s.nodeType&&"BODY"===s.nodeName||"HTML"===s.nodeName?a=s:a.appendChild(s);else{if(!Pt&&!$t&&!Rt&&-1===t.indexOf("<"))return nt&&Dt?nt.createHTML(t):t;if(a=fe(t),!a)return Pt?null:Dt?at:""}a&&Ct&&de(a.firstChild);const c=ye(zt?t:a);for(;r=c.nextNode();)_e(r),Se(r),r.content instanceof o&&Te(r.content);if(zt)return t;if(Pt){if(Mt)for(l=rt.call(a.ownerDocument);a.firstChild;)l.appendChild(a.firstChild);else l=a;return(_t.shadowroot||_t.shadowrootmode)&&(l=lt.call(i,l,!0)),l}let u=Rt?a.outerHTML:a.innerHTML;return Rt&&vt["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&T(Z,a.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+u),$t&&p([ut,ht,mt],(t=>{u=_(u,t," ")})),nt&&Dt?nt.createHTML(u):u},n.setConfig=function(){he(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Ot=!0},n.clearConfig=function(){le=null,Ot=!1},n.isValidAttribute=function(t,e,n){le||he({});const a=oe(t),s=oe(e);return Ee(a,s,n)},n.addHook=function(t,e){"function"==typeof e&&f(ct[t],e)},n.removeHook=function(t,e){if(void 0!==e){const n=d(ct[t],e);return-1===n?void 0:y(ct[t],n,1)[0]}return g(ct[t])},n.removeHooks=function(t){ct[t]=[]},n.removeAllHooks=function(){ct={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}()},52163:t=>{"use strict";t.exports=JSON.parse('[{"key":"Crunchyroll","name":"Crunchyroll","domain":"https://www.crunchyroll.com","database":"Crunchyroll","search":{"anime":"https://www.crunchyroll.com/search?q={searchtermPlus}","manga":null}},{"key":"Mangadex","name":"Mangadex","domain":"https://www.mangadex.org","database":"Mangadex","search":{"anime":null,"manga":"https://mangadex.org/titles?q={searchterm}"}},{"key":"Gogoanime","name":"Gogoanime","domain":"https://gogoanime.tv","database":"Gogoanime","search":{"anime":"https://anitaku.pe/search.html?keyword={searchterm}","manga":null}},{"key":"TurkAnime","name":"TurkAnime","domain":"https://www.turkanime.co","database":null,"search":{"anime":"home","manga":null}},{"key":"animepahe","name":"animepahe","domain":"https://animepahe.com","database":"animepahe","search":{"anime":"home","manga":null}},{"key":"Netflix","name":"Netflix","domain":"https://www.netflix.com","database":"Netflix","search":{"anime":"https://www.netflix.com/search?q={searchterm}","manga":null}},{"key":"Animeflv","name":"Animeflv","domain":"https://animeflv.net","database":null,"search":{"anime":"https://www3.animeflv.net/browse?q={searchtermPlus}","manga":null}},{"key":"Jkanime","name":"Jkanime","domain":"https://jkanime.net","database":null,"search":{"anime":"https://jkanime.net/buscar/{searchterm}","manga":null}},{"key":"Proxer","name":"Proxer","domain":"https://proxer.me","database":null,"search":{"anime":"https://proxer.me/search?s=search&name={searchterm}&typ=all-anime&tags=&notags=#top","manga":"https://proxer.me/search?s=search&name={searchterm}&typ=all-manga&tags=&notags=#top"}},{"key":"Emby","name":"Emby","domain":"http://app.emby.media","database":null,"search":{"anime":"home","manga":null}},{"key":"Plex","name":"Plex","domain":"http://app.plex.tv","database":null,"search":{"anime":"home","manga":null}},{"key":"Aniflix","name":"Aniflix","domain":"https://aniflix.cc","database":null,"search":{"anime":"home","manga":null}},{"key":"KickAssAnime","name":"KickAssAnime","domain":"https://kickassanime.am","database":"KickAssAnime","search":{"anime":"https://kaas.am/search?q={searchterm}","manga":null}},{"key":"Shinden","name":"Shinden","domain":"https://shinden.pl","database":null,"search":{"anime":"https://shinden.pl/series?search={searchtermPlus}","manga":null}},{"key":"Voiranime","name":"Voiranime","domain":"https://voiranime.com","database":null,"search":{"anime":"https://voiranime.com/?s={searchtermPlus}","manga":null}},{"key":"VIZ","name":"VIZ","domain":"https://www.viz.com","database":"VIZ","search":{"anime":null,"manga":"https://www.viz.com/search?search={searchtermPlus}"}},{"key":"AnimeOdcinki","name":"AnimeOdcinki","domain":"https://anime-odcinki.pl","database":null,"search":{"anime":"https://anime-odcinki.pl/szukaj/{searchtermPlus}","manga":null}},{"key":"AnimeZone","name":"AnimeZone","domain":"https://www.animezone.pl","database":null,"search":{"anime":"https://www.animezone.pl/szukaj?q={searchtermPlus}","manga":null}},{"key":"serimanga","name":"serimanga","domain":"https://serimanga.com","database":null,"search":{"anime":null,"manga":"https://serimanga.com/mangalar?search={searchtermPlus}"}},{"key":"mangadenizi","name":"mangadenizi","domain":"https://www.mangadenizi.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"moeclip","name":"moeclip","domain":"https://moeclip.com","database":null,"search":{"anime":"https://moeclip.com/search/{searchtermPlus}","manga":null}},{"key":"mangalivre","name":"Mang Livre","domain":"https://mangalivre.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"tmofans","name":"tmofans","domain":"https://zonatmo.com","database":null,"search":{"anime":null,"manga":"https://zonatmo.com/library?_pg=1&title={searchtermPlus}"}},{"key":"MangaPlus","name":"MangaPlus","domain":"https://mangaplus.shueisha.co.jp","database":"MangaPlus","search":{"anime":null,"manga":"https://mangaplus.shueisha.co.jp/search_result?keyword={searchterm}"}},{"key":"JapScan","name":"JapScan","domain":"https://www.japscan.ws","database":null,"search":{"anime":null,"manga":"home"}},{"key":"Hulu","name":"Hulu","domain":"https://www.hulu.com","database":"Hulu","search":{"anime":"home","manga":null}},{"key":"Hidive","name":"Hidive","domain":"https://www.hidive.com","database":"Hidive","search":{"anime":"https://www.hidive.com/search?q={searchtermPlus}","manga":null}},{"key":"MangaKatana","name":"MangaKatana","domain":"http://mangakatana.com","database":null,"search":{"anime":null,"manga":"http://mangakatana.com/?search={searchtermPlus}&search_by=book_name"}},{"key":"manga4life","name":"manga4life","domain":"https://manga4life.com","database":null,"search":{"anime":null,"manga":"https://manga4life.com/search/?name={searchterm}"}},{"key":"bato","name":"bato","domain":"https://bato.to","database":null,"search":{"anime":null,"manga":"https://bato.to/search?word={searchtermPlus}"}},{"key":"MangaPark","name":"MangaPark","domain":"https://mangapark.net","database":null,"search":{"anime":null,"manga":"https://mangapark.net/search?word={searchterm}"}},{"key":"AnimeXin","name":"AnimeXin","domain":"https://animexin.vip","database":null,"search":{"anime":"https://animexin.vip/?s={searchtermPlus}","manga":null}},{"key":"MonosChinos","name":"MonosChinos","domain":"https://monoschinos2.com","database":null,"search":{"anime":"https://monoschinos2.com/buscar?q={searchtermPlus}","manga":null}},{"key":"Anime365","name":"Anime365","domain":"https://smotret-anime.org","database":null,"search":{"anime":"https://smotret-anime.net/catalog/search?q={searchtermPlus}","manga":null}},{"key":"AnimeFire","name":"AnimeFire","domain":"https://animefire.net","database":null,"search":{"anime":"home","manga":null}},{"key":"OtakuFR","name":"OtakuFR","domain":"https://otakufr.cc","database":null,"search":{"anime":"https://otakufr.cc/toute-la-liste-affiches/?q={searchtermPlus}","manga":null}},{"key":"mangatx","name":"mangatx","domain":"https://mangatx.com","database":null,"search":{"anime":null,"manga":"https://mangatx.com/?s={searchtermPlus}&post_type=wp-manga&post_type=wp-manga"}},{"key":"manhuafast","name":"manhuafast","domain":"https://manhuafast.com","database":null,"search":{"anime":null,"manga":"https://manhuafast.com/?s={searchtermPlus}&post_type=wp-manga&post_type=wp-manga"}},{"key":"TRanimeizle","name":"TRanimeizle","domain":"https://www.tranimeizle.net/","database":null,"search":{"anime":"home","manga":null}},{"key":"AnimeStreamingFR","name":"AnimeStreamingFR","domain":"https://beta.animestreamingfr.fr","database":null,"search":{"anime":"https://beta.animestreamingfr.fr/catalogue/search?query={searchtermPlus}","manga":null}},{"key":"Furyosociety","name":"Furyosociety","domain":"https://furyosociety.com/","database":null,"search":{"anime":null,"manga":"home"}},{"key":"AnimeId","name":"AnimeId","domain":"https://www.animeid.tv","database":null,"search":{"anime":"home","manga":null}},{"key":"MyAnimeListVideo","name":"MyAnimeList","domain":"https://myanimelist.net","database":null,"search":{"anime":"https://myanimelist.net/anime.php?q={searchterm}","manga":"https://myanimelist.net/manga.php?q={searchterm}"}},{"key":"AnimeUnity","name":"AnimeUnity","domain":"https://animeunity.it","database":null,"search":{"anime":"home","manga":null}},{"key":"MangaHere","name":"MangaHere","domain":"http://www.mangahere.cc","database":null,"search":{"anime":null,"manga":"http://www.mangahere.cc/search?title={searchtermPlus}"}},{"key":"MangaFox","name":"MangaFox","domain":"https://fanfox.net","database":"MangaFox","search":{"anime":null,"manga":"http://fanfox.net/search?title={searchtermPlus}"}},{"key":"DesuOnline","name":"DesuOnline","domain":"https://desu-online.pl","database":null,"search":{"anime":"https://desu-online.pl/?s={searchtermPlus}","manga":null}},{"key":"WuxiaWorld","name":"WuxiaWorld","domain":"https://wuxiaworld.site","database":null,"search":{"anime":null,"manga":"https://wuxiaworld.site/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"LeviatanScans","name":"LeviatanScans","domain":"https://lscomic.com","database":null,"search":{"anime":null,"manga":"https://lscomic.com/?s={searchtermPlus}"}},{"key":"ReaperScans","name":"ReaperScans","domain":"https://reaperscans.com","database":null,"search":{"anime":null,"manga":"home"}},{"key":"LynxScans","name":"LynxScans","domain":"https://lynxscans.com","database":null,"search":{"anime":null,"manga":"https://lynxscans.com/comics?query={searchtermPlus}"}},{"key":"ZeroScans","name":"ZeroScans","domain":"https://zeroscans.com","database":null,"search":{"anime":null,"manga":"home"}},{"key":"DeathTollScans","name":"DeathTollScans","domain":"https://reader.deathtollscans.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"ManhuaPlus","name":"ManhuaPlus","domain":"https://manhuaplus.com","database":null,"search":{"anime":null,"manga":"https://manhuaplus.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"Readm","name":"Readm","domain":"https://readm.today","database":null,"search":{"anime":null,"manga":"home"}},{"key":"tioanime","name":"tioanime","domain":"https://tioanime.com","database":null,"search":{"anime":"https://tioanime.com/directorio?q={searchtermPlus}","manga":null}},{"key":"MangaSee","name":"MangaSee","domain":"https://mangasee123.com","database":"MangaSee","search":{"anime":null,"manga":"https://mangasee123.com/search/?name={searchterm}"}},{"key":"Okanime","name":"Okanime","domain":"https://okanime.tv","database":null,"search":{"anime":"https://okanime.tv/search?search={searchtermPlus}","manga":null}},{"key":"BSTO","name":"bs.to","domain":"https://bs.to","database":null,"search":{"anime":"home","manga":null}},{"key":"AsuraScans","name":"AsuraScans","domain":"https://asuratoon.com","database":null,"search":{"anime":null,"manga":"https://asuracomics.com/?s={searchtermPlus}"}},{"key":"Jellyfin","name":"Jellyfin","domain":"https://jellyfin.org/","database":null,"search":{"anime":"home","manga":null}},{"key":"An1me","name":"An1me","domain":"https://an1me.to","database":null,"search":{"anime":"https://an1me.to/?s={searchtermPlus}&post_type=wp-manga","manga":null}},{"key":"MangaJar","name":"MangaJar","domain":"https://mangajar.pro","database":null,"search":{"anime":null,"manga":"https://mangajar.pro/search?q={searchtermPlus}"}},{"key":"Otakustv","name":"Otakustv","domain":"https://www.otakustv.com","database":null,"search":{"anime":"https://www.otakustv.com/buscador.php?buscador={searchterm}","manga":null}},{"key":"Komga","name":"Komga","domain":"https://komga.org","database":null,"search":{"anime":null,"manga":"home"}},{"key":"AnimeWho","name":"AnimeWho","domain":"https://animewho.com","database":null,"search":{"anime":"home","manga":null}},{"key":"Fumetsu","name":"Fumetsu","domain":"https://fumetsu.pl","database":null,"search":{"anime":"home","manga":null}},{"key":"FrixySubs","name":"FrixySubs","domain":"https://frixysubs.pl","database":null,"search":{"anime":"https://frixysubs.pl/anime-list?search={searchtermPlus}","manga":null}},{"key":"Guya","name":"Guya & Cubari","domain":"https://guya.moe","database":null,"search":{"anime":null,"manga":"home"}},{"key":"MangaHub","name":"MangaHub","domain":"https://mangahub.io","database":null,"search":{"anime":null,"manga":"https://mangahub.io/search?q={searchterm}"}},{"key":"ComicK","name":"ComicK","domain":"https://comick.io","database":"Comick","search":{"anime":null,"manga":"https://comick.io/search?q={searchterm}"}},{"key":"Bentomanga","name":"Bentomanga","domain":"https://bentomanga.com","database":null,"search":{"anime":null,"manga":"https://www.bentomanga.com/manga_list?search={searchterm}"}},{"key":"MangaSushi","name":"MangaSushi","domain":"https://mangasushi.net","database":null,"search":{"anime":null,"manga":"https://mangasushi.net/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"TritiniaScans","name":"TritiniaScans","domain":"https://tritinia.com","database":null,"search":{"anime":null,"manga":"https://tritinia.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"ReadManhua","name":"ReadManhua","domain":"https://readmanhua.net","database":null,"search":{"anime":null,"manga":"https://readmanhua.net/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"FlameScans","name":"FlameScans","domain":"https://flamecomics.xyz","database":null,"search":{"anime":null,"manga":"https://flamecomics.xyz/browse?search={searchterm}"}},{"key":"ImmortalUpdates","name":"ImmortalUpdates","domain":"https://immortalupdates.com","database":null,"search":{"anime":null,"manga":"https://immortalupdates.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"Zoro","name":"HiAnime","domain":"https://hianime.to","database":"Zoro","search":{"anime":"https://hianime.to/search?keyword={searchtermPlus}","manga":null}},{"key":"Kitsune","name":"Kitsune","domain":"https://beta.kitsune.tv","database":null,"search":{"anime":"https://kitsune.tv/shows?q={searchterm}","manga":null}},{"key":"LHTranslation","name":"LHTranslation","domain":"https://lhtranslation.net","database":null,"search":{"anime":null,"manga":"https://lhtranslation.net/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"MangasOrigines","name":"MangasOrigines","domain":"https://mangas-origines.fr/","database":null,"search":{"anime":null,"manga":"https://mangas-origines.fr/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"BlueSolo","name":"BlueSolo","domain":"https://www.bluesolo.org","database":null,"search":{"anime":null,"manga":"home"}},{"key":"DisasterScans","name":"DisasterScans","domain":"https://disasterscans.com","database":null,"search":{"anime":null,"manga":"https://disasterscans.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"DynastyScans","name":"DynastyScans","domain":"https://dynasty-scans.com","database":null,"search":{"anime":null,"manga":"https://dynasty-scans.com/search?q={searchtermPlus}"}},{"key":"Aniworld","name":"Aniworld","domain":"https://aniworld.to","database":null,"search":{"anime":"https://aniworld.to/search?q={searchterm}","manga":null}},{"key":"BetterAnime","name":"BetterAnime","domain":"https://betteranime.net","database":null,"search":{"anime":"https://betteranime.net/pesquisa?titulo={searchtermPlus}","manga":null}},{"key":"BilibiliComics","name":"BilibiliComics","domain":"https://manga.bilibili.com","database":null,"search":{"anime":null,"manga":"https://manga.bilibili.com/search?keyword={searchterm( )[noLowercase]}"}},{"key":"MangaReader","name":"MangaReader","domain":"https://mangareader.to","database":"MangaReader","search":{"anime":null,"manga":"https://mangareader.to/search?keyword={searchtermPlus}"}},{"key":"AnimeOnsen","name":"AnimeOnsen","domain":"https://animeonsen.xyz","database":null,"search":{"anime":"https://www.animeonsen.xyz/search/{searchterm}","manga":null}},{"key":"Animetoast","name":"Animetoast","domain":"https://www.animetoast.cc","database":null,"search":{"anime":"https://www.animetoast.cc/?s={searchterm}","manga":null}},{"key":"LuminousScans","name":"LuminousScans","domain":"https://luminous-scans.com","database":null,"search":{"anime":null,"manga":"https://luminous-scans.com/?s={searchtermPlus}"}},{"key":"Animeworld","name":"Animeworld","domain":"https://www.animeworld.tv","database":null,"search":{"anime":"home","manga":null}},{"key":"MangaBuddy","name":"MangaBuddy","domain":"https://mangabuddy.com","database":null,"search":{"anime":null,"manga":"https://mangabuddy.com/search?q={searchtermPlus}"}},{"key":"ToonAnime","name":"ToonAnime","domain":"https://vvww.toonanime.cc","database":null,"search":{"anime":"https://vvww.toonanime.cc/?story={searchtermPlus}&do=search&subaction=search","manga":null}},{"key":"ADKami","name":"ADKami","domain":"https://www.adkami.com/","database":null,"search":{"anime":"https://www.adkami.com/video?search={searchtermPlus}","manga":null}},{"key":"Kaguya","name":"Kaguya","domain":"https://kaguya.app","database":null,"search":{"anime":"https://kaguya.app/browse?keyword={searchtermPlus}","manga":null}},{"key":"Hdrezka","name":"Hdrezka","domain":"https://hdrezka.ag","database":null,"search":{"anime":"https://hdrezka.ag/search/?do=search&subaction=search&q={searchterm}","manga":null}},{"key":"SovetRomantica","name":"SovetRomantica","domain":"https://sovetromantica.com","database":null,"search":{"anime":"https://sovetromantica.com/anime?query={searchterm}","manga":null}},{"key":"ADN","name":"ADN","domain":"https://animationdigitalnetwork.com","database":null,"search":{"anime":"https://animationdigitalnetwork.fr/video?search={searchterm}","manga":null}},{"key":"Aniyan","name":"Aniyan","domain":"https://aniyan.net","database":null,"search":{"anime":"https://aniyan.net/?s={searchtermPlus}","manga":null}},{"key":"Docchi","name":"Docchi","domain":"https://docchi.pl","database":null,"search":{"anime":"home","manga":null}},{"key":"FRAnime","name":"FRAnime","domain":"https://franime.fr","database":null,"search":{"anime":"https://franime.fr/recherche?search={searchtermPlus}","manga":null}},{"key":"FMTeam","name":"FMTeam","domain":"https://fmteam.fr","database":null,"search":{"anime":null,"manga":"home"}},{"key":"Animelon","name":"Animelon","domain":"https://www.animelon.com","database":null,"search":{"anime":"https://www.animelon.com/search?searchTerm={searchTerm}","manga":null}},{"key":"AnimeNoSub","name":"AnimeNoSub","domain":"https://animenosub.to","database":null,"search":{"anime":"https://animenosub.to/?s={searchtermPlus}","manga":null}},{"key":"AnimeSama","name":"AnimeSama","domain":"https://anime-sama.fr","database":null,"search":{"anime":"https://anime-sama.fr/catalogue/","manga":null}},{"key":"MangaFire","name":"MangaFire","domain":"https://mangafire.to","database":"MangaFire","search":{"anime":null,"manga":"https://mangafire.to/filter?keyword={searchtermPlus}"}},{"key":"projectsuki","name":"projectsuki","domain":"https://projectsuki.com","database":null,"search":{"anime":null,"manga":"https://projectsuki.com/search?q={searchtermPlus}"}},{"key":"AnimeBuff","name":"AnimeBuff","domain":"https://animebuff.ru","database":null,"search":{"anime":"https://animebuff.ru/search?q={searchtermPlus}","manga":null}},{"key":"AnimeOnegai","name":"AnimeOnegai","domain":"https://www.animeonegai.com","database":null,"search":{"anime":"https://www.animeonegai.com/es/search?q={searchterm}","manga":null}},{"key":"AnimeKO","name":"AnimeKO","domain":"https://animeko.co","database":null,"search":{"anime":"https://animeko.co/anime?search={searchtermPlus}","manga":null}},{"key":"AnimeGO","name":"AnimeGO","domain":"https://animego.org","database":null,"search":{"anime":"https://animego.org/search/all?q={searchterm}","manga":null}},{"key":"LuciferDonghua","name":"Lucifer Donghua","domain":"https://luciferdonghua.in","database":null,"search":{"anime":"https://luciferdonghua.in/?s={searchterm}","manga":null}},{"key":"NeoxScans","name":"NeoxScans","domain":"https://neoxscans.com/","database":null,"search":{"anime":null,"manga":"https://neoxscans.com/?post_type=wp-manga&s={searchtermPlus}"}},{"key":"HinataSoul","name":"HinataSoul","domain":"https://hinatasoul.com","database":null,"search":{"anime":"https://www.hinatasoul.com/busca?busca={searchtermPlus}","manga":null}},{"key":"OgladajAnime","name":"OgladajAnime","domain":"https://ogladajanime.pl","database":null,"search":{"anime":"https://ogladajanime.pl/search/name/{searchtermPlus}","manga":null}},{"key":"hachi","name":"hachi","domain":"https://hachi.moe","database":null,"search":{"anime":null,"manga":"https://hachi.moe/search?query={searchterm}"}},{"key":"WitAnime","name":"WitAnime","domain":"https://witanime.pics","database":null,"search":{"anime":"https://witanime.pics/?search_param=animes&s={searchtermPlus}","manga":null}},{"key":"Suwayomi","name":"Suwayomi","domain":"https://suwayomi-webui-preview.github.io/","database":null,"search":{"anime":null,"manga":"https://suwayomi-webui-preview.github.io/sources/all/search/?query={searchtermPlus}"}},{"key":"ManhuaUS","name":"ManhuaUS","domain":"https://manhuaus.com","database":null,"search":{"anime":null,"manga":"https://manhuaus.com/?s={searchterm}&post_type=wp-manga&op=&author=&artist=&release=&adult="}},{"key":"Taiyo","name":"Taiyo","domain":"https://taiyo.moe","database":null,"search":{"anime":null,"manga":"home"}},{"key":"AnimesOnline","name":"Animes Online","domain":"https://animesonline.in","database":null,"search":{"anime":"https://www.animesonline.in/busca?s={searchtermPlus}","manga":null}},{"key":"Miruro","name":"Miruro","domain":"https://www.miruro.to","database":null,"search":{"anime":"https://www.miruro.tv/search?query={searchterm}&sort=POPULARITY_DESC","manga":null}},{"key":"Latanime","name":"Latanime","domain":"https://latanime.org","database":null,"search":{"anime":"https://latanime.org/buscar?q={searchtermPlus}","manga":null}},{"key":"MangaRead","name":"MangaRead","domain":"https://www.mangaread.org","database":null,"search":{"anime":null,"manga":"https://www.mangaread.org/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"Q1N","name":"Q1N","domain":"https://q1n.net","database":null,"search":{"anime":"https://q1n.net/?s={searchtermPlus}","manga":null}},{"key":"TempleScan","name":"TempleScan","domain":"https://templescan.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"ScyllaScans","name":"ScyllaScans","domain":"https://scyllacomics.xyz","database":null,"search":{"anime":null,"manga":"home"}},{"key":"VortexScans","name":"VortexScans","domain":"https://vortexscans.org","database":null,"search":{"anime":null,"manga":"home"}},{"key":"WeebCentral","name":"WeebCentral","domain":"https://weebcentral.com","database":"Weebcentral","search":{"anime":null,"manga":"https://weebcentral.com/search?text={searchterm}"}},{"key":"Kavita","name":"Kavita","domain":"https://demo.kavitareader.com","database":null,"search":{"anime":null,"manga":"home"}},{"key":"Rawkuma","name":"Rawkuma","domain":"https://rawkuma.com","database":null,"search":{"anime":null,"manga":"https://rawkuma.com/?s={searchtermPlus}"}},{"key":"Aninexus","name":"Aninexus","domain":"https://aninexus.to","database":null,"search":{"anime":"https://aninexus.to/search/{searchterm}","manga":null}},{"key":"AnimeKAI","name":"AnimeKAI","domain":"https://animekai.to","database":null,"search":{"anime":"https://animekai.to/browser?keyword={searchtermPlus}","manga":null}},{"key":"Hikari","name":"Hikari","domain":"https://watch.hikaritv.xyz","database":null,"search":{"anime":"https://watch.hikaritv.xyz/search?keyword={searchterm}","manga":null}},{"key":"AniDream","name":"AniDream","domain":"https://anidream.cc","database":null,"search":{"anime":"https://anidream.cc/archive/?title={searchtermPlus}","manga":null}}]')}},e={};function n(a){var s=e[a];if(void 0!==s)return s.exports;var i=e[a]={id:a,exports:{}};return t[a](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t,e,a;(e=t||(t={}))[e.NoState=0]="NoState",e[e.Watching=1]="Watching",e[e.Completed=2]="Completed",e[e.Onhold=3]="Onhold",e[e.Dropped=4]="Dropped",e[e.PlanToWatch=6]="PlanToWatch",e[e.All=7]="All",e[e.Rewatching=23]="Rewatching",function(t){t[t.NoScore=0]="NoScore",t[t.R1=1]="R1",t[t.R2=2]="R2",t[t.R3=3]="R3",t[t.R4=4]="R4",t[t.R5=5]="R5",t[t.R6=6]="R6",t[t.R7=7]="R7",t[t.R8=8]="R8",t[t.R9=9]="R9",t[t.R10=10]="R10"}(a||(a={}));var s=n(78584);let i;if(function(){try{return localStorage.getItem("x"),!0}catch(t){return s.info("Local storage is not available",t),!1}}())i=localStorage;else{let t={};i={getItem:e=>e in t?t[e]:null,setItem(e,n){t[e]=n},removeItem(e){e in t&&delete t[e]},clear(){t={}}}}const r=i;var o=n(13647);class l{constructor(t,e,n=!0,a=0){return this.key=t,this.ttl=e,this.localStorage=n,this.refetchTtl=a,this}containsValue(t){return null!=t}valueValid(t,e){return!(!t||!t.timestamp)&&(new Date).getTime()<t.timestamp+e}ttlValid(t){return this.valueValid(t,this.ttl)}refetchTtlValid(t){return this.valueValid(t,this.refetchTtl)}async hasValue(){const t=await this.getStorage();return!(!this.containsValue(t)||!this.ttlValid(t))}async hasValueAndIsNotEmpty(){const t=await this.getStorage();return!!(this.containsValue(t)&&void 0!==t.data&&null!==t.data&&Object.keys(t.data).length&&this.ttlValid(t))}async fullState(){const t=await this.getStorage(),e=this.containsValue(t)&&this.refetchTtlValid(t),n=this.ttlValid(t);return{value:t,hasValue:e,isValid:n,refetch:e&&!n}}async getValue(){return(await this.getStorage()).data}async setValue(t){const e={data:t,timestamp:(new Date).getTime()};return this.localStorage?r.setItem(this.key,JSON.stringify(e)):o.storage.set(this.key,e)}async clearValue(){return this.localStorage?r.removeItem(this.key):o.storage.remove(this.key)}async getStorage(){return this.localStorage?JSON.parse(r.getItem(this.key)):o.storage.get(this.key)}}var c=n(13647),u=n(26017),h=n(78584);async function m(t,e){if(!e)return{};const n=await c.request.xhr("GET",`https://api.malsync.moe/nc/mal/${t}/${e}/pr`);return JSON.parse(n.responseText)}var p=n(13647);const d={years:31536e6,months:2592e6,weeks:6048e5,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,milliseconds:1};class g{constructor(t=p.storage.lang("locale")){return this.isFallback=!Intl.DurationFormat,this.locale=t,this}setLocale(t){return this.locale=t,this}setDuration(t){return this.duration=t,this}setDurationFormatted(t,e="Duration"){const n=g.durationToMs(t);return this.setRelativeTime(n,"milliseconds",e),this}setRelativeTime(t,e,n="Duration"){const a=t*d[e];return this.duration=this.process(a,n),this}setTimestamp(t,e="Duration",n=Date.now()){const a=t-new Date(n).getTime();return this.setRelativeTime(a,"milliseconds",e),this}process(t,e){switch(e){case"Duration":return y(t,["seconds","minutes","hours","days"]).duration;case"Progress":if(!t)break;return function(t){let e=t.days||0;return t.years?t.years>1?t.days&&t.days>182?{years:t.years+1}:{years:t.years}:{years:t.years,days:t.days}:((t.months||t.weeks)&&(e+=t.months?30*t.months:0,e+=t.weeks?7*t.weeks:0),e?e>3?t.hours&&t.hours>11?{days:e+1}:{days:e}:{days:e,hours:t.hours}:t.hours?t.hours>5?t.minutes&&t.minutes>29?{hours:t.hours+1}:{hours:t.hours}:{hours:t.hours,minutes:t.minutes}:t.minutes&&t.minutes>14?{minutes:t.minutes}:{minutes:t.minutes||0,seconds:t.seconds||0})}(y(t,["seconds","minutes","hours","days","years"]).duration);case"M/H/D/Y":if(!t)break;return y(t,["minutes","hours","days","years"]).duration;default:return{}}return{}}static durationToMs(t){const e=Object.keys(t);let n=0;if(e.length<=0)return n;for(let a=0;a<e.length;a++){const s=e[a],i=t[s];n+=d[s]*i}return n||0}getRelativeText(t={style:"narrow"}){if(!this.duration)return"";if(this.isFallback)return function(t){let e="";return t.years&&(1===t.years?e+=` ${t.years} ${p.storage.lang("bookmarksItem_Year")}`:e+=` ${t.years} ${p.storage.lang("bookmarksItem_Years")}`),t.days&&(1===t.days?e+=` ${t.days} ${p.storage.lang("bookmarksItem_Day")}`:e+=` ${t.days} ${p.storage.lang("bookmarksItem_Days")}`),t.hours&&(1===t.hours?e+=` ${t.hours} ${p.storage.lang("bookmarksItem_Hour")}`:e+=` ${t.hours} ${p.storage.lang("bookmarksItem_Hours")}`),t.minutes&&(1===t.minutes?e+=` ${t.minutes} ${p.storage.lang("bookmarksItem_min")}`:e+=` ${t.minutes} ${p.storage.lang("bookmarksItem_mins")}`),t.seconds&&(1===t.seconds?e+=` ${t.seconds} ${p.storage.lang("bookmarksItem_sec")}`:e+=` ${t.seconds} ${p.storage.lang("bookmarksItem_secs")}`),e.trim()}(this.duration);const e=t;if("significantLongNarrow"===t.style){const t=Object.keys(d);for(let n=0;n<t.length;n++){const a=t[n];if(this.duration[a]){e[a]="long",e.style="narrow";break}}}return new Intl.DurationFormat(this.locale,e).format(this.duration)}getDuration(){return this.duration}getLocale(){return this.locale}}class f{constructor(t,e=p.storage.lang("locale")){if(this.locale=e,"string"==typeof t){const e=Number(t);if(!Number.isNaN(e))return this.date=new Date(e),this}return this.date=new Date(t),this}setDate(t){return this.date=new Date(t),this}setLocale(t){return this.locale=t,this}isValidDate(){return b(this.date)}isNow(){return function(t,e=Date.now(),n={seconds:30}){if(Number.isNaN(t))return!1;const a=new Date(e).getTime(),s=g.durationToMs(n);return!(Math.abs(t-a)>s)}(this.date.getTime())}isFuture(){return this.date.getTime()>Date.now()}getDate(){return this.date}getLocale(){return this.locale}getDateTimeText(t={dateStyle:"medium"}){return b(this.date)?new Intl.DateTimeFormat(this.locale,t).format(this.date):""}getRelativeNowText(t="Duration",e){if(!this.isValidDate())return"";const n=new g(this.locale);return n.setTimestamp(this.date.getTime(),t),n.getRelativeText(e)}getRelativeNowFriendlyText(t="Duration",e){if(!this.isValidDate())return"";if(this.isNow())return p.storage.lang("bookmarksItem_now");const n=this.getRelativeNowText(t,e);return this.isFuture()?n:p.storage.lang("bookmarksItem_ago",[n])}}function y(t,e=["minutes","hours","days","years"],n=0){const a={},s=new Date(n).getTime();let i=Math.abs(s-t);const r=t>s;for(const t in d){if(!e.includes(t))continue;const n=Math.floor(i/d[t]);a[t]=n}const o=Object.keys(a);for(let t=1;t<o.length;t++){const e=o[t-1],n=a[e],s=o[t];i-=d[e]*n;const r=Math.floor(i/d[s]);a[s]=r}return{duration:a,isFuture:r}}function b(t){if(!t)return!1;if("number"==typeof t)return!0;const e="string"==typeof t?new Date(t):t;return e instanceof Date&&!Number.isNaN(e.getTime())}var v=n(78584),w=n(13647);class _{constructor(t,e){return this.cacheKey=t,this.type=e,this.releaseItem=void 0,this.logger=v.m("progress").m(t.toString()),this}async initReleaseProgress(t){t&&await async function(t,e,n="default",a=h.m("release")){if(n||(n="default"),(a=a.m(t.uid.toString())).log(t.title,t.cacheKey,t.apiCacheKey,`Mode: ${n}`),!t.apiCacheKey)return void a.log("No Api Cache Id");if(!c.settings.get("epPredictions"))return void a.log("epPredictions disabled");const s=await c.storage.get(`release/${e}/${t.cacheKey}`);a.m("Load").log(s);let i,r=!1;if(s&&s.mode&&s.mode!==n&&(r=!0),s&&s.timestamp&&Date.now()-s.timestamp<12e4&&!r)return void a.log("Up to date");if(s&&s.finished&&s.timestamp&&Date.now()-s.timestamp<6048e5&&!r)return void a.log("Finished");if(s&&!s.value&&s.timestamp&&Date.now()-s.timestamp<864e5&&!r)return void a.log("Nulled");r&&a.log("Update forced"),"off"===n&&(a.log("Disabled"),t.xhr=[]),void 0!==t.xhr?i=t.xhr:(i=await m(e,t.apiCacheKey),await u.wait(500)),a.log(i);const o=function(t,e,n){const a={};if(!t.length)return null;let s;if("default"===e?(a.mainId="anime"===n?c.settings.get("progressIntervalDefaultAnime"):c.settings.get("progressIntervalDefaultManga"),a.fallback="en/sub"):a.mainId=e,a.fallbackPrediction="jp/dub",a.mainId){const e=t.find((t=>t.id===a.mainId));e&&(s=e)}if(a.fallback&&!s){const e=t.find((t=>t.id===a.fallback));e&&(s=e)}if(a.fallbackPrediction&&s&&!s.predicition&&s.lastEp&&s.lastEp.timestamp){const e=t.find((t=>t.id===a.fallbackPrediction)),n=s.lastEp.timestamp+6048e5;n&&e&&e.predicition&&(s.lastEp.total===e.lastEp.total?Math.abs(n-e.predicition.timestamp)<108e6&&(s.predicition={timestamp:n,probability:"medium"}):e.lastEp.total&&s.lastEp.total===e.lastEp.total-1&&Math.abs(n-(e.predicition.timestamp-6048e5))<108e6&&(s.predicition={timestamp:n,probability:"medium"}))}if(a.fallbackPrediction&&!s){const e=t.find((t=>t.id===a.fallbackPrediction));e&&e.lastEp&&e.predicition&&0===e.lastEp.total&&(s=e,s.predicition.probability="medium")}return s||null}(i,n,e);o||a.log("No value for the selected mode");let l=!1;o&&o.state&&"complete"===o.state&&(l=!0),a.m("Save").log(o),s&&s.value&&async function(t,e,n,a){try{if("anime"===a&&!c.settings.get("progressNotificationsAnime")||"manga"===a&&!c.settings.get("progressNotificationsManga"))return;if(t&&n&&n&&e.lastEp&&void 0!==e.lastEp.total&&n.lastEp&&n.lastEp.total&&e.lang===n.lang&&e.type===n.type&&e.lastEp.total<n.lastEp.total&&t.watchedEp+1===n.lastEp.total){let e;e=t.single?{title:t.title,text:c.storage.lang(`syncPage_malObj_nextEp_${a}`,[n.lastEp.total]),sticky:c.settings.get("notificationsSticky"),image:await t.single.getImage(),url:t.single.getStreamingUrl()?t.single.getStreamingUrl():t.single.getUrl()}:{title:t.title,text:c.storage.lang(`syncPage_malObj_nextEp_${a}`,[n.lastEp.total]),sticky:c.settings.get("notificationsSticky"),image:t.image,url:t.options&&t.options.u?t.options.u:t.url},c.request.notification(e)}}catch(t){h.error("Could not check notification Progress",t)}}(t,s.value,o,e),await c.storage.set(`release/${e}/${t.cacheKey}`,{timestamp:Date.now(),value:o,mode:n,finished:l})}(t,this.type,t.progressMode);const e=await w.storage.get(`release/${this.type}/${this.cacheKey}`);this.logger.m("Init Release").log(e),e&&(function(t){if(t&&t.timestamp){const e=(new Date).getTime()-t.timestamp;if(t.finished&&e<6048e5)return!1;if(!t.value&&e<864e5)return!1;if(e<864e5)return!1}return!0}(e)?this.logger.log("Too old"):this.releaseItem=e)}getProgressCurrentEpisode(){const t=this.releaseItem;return t&&t.value&&t.value.lastEp&&t.value.lastEp.total?t.value.lastEp.total:null}isProgressFinished(){const t=this.releaseItem;return!(!t||!t.finished)}getProgressPrediction(){const t=this.releaseItem;return t&&t.value&&t.value.predicition&&t.value.predicition.timestamp?t.value.predicition.timestamp:null}getProgressLastTimestamp(){const t=this.releaseItem;return t&&t.value&&t.value.lastEp&&t.value.lastEp.timestamp?t.value.lastEp.timestamp:null}async init(t=!1){return await Promise.all([this.initReleaseProgress(t)]),this}getCurrentEpisode(){return w.settings.get("epPredictions")?this.getProgressCurrentEpisode():null}isFinished(){return this.isProgressFinished()}isAiring(){return!this.isFinished()}getPredictionTimestamp(){return!this.getProgressPrediction()||(new Date).getTime()>this.getProgressPrediction()?NaN:this.getProgressPrediction()}getPrediction(){const t=Number(this.getPredictionTimestamp());return Number.isNaN(t)?"":new f(t).getRelativeNowFriendlyText("Progress",{style:"significantLongNarrow"})}getPredictionText(){const t=Number(this.getPredictionTimestamp());if(Number.isNaN(t))return"";const e=new f(Number(t)),n=e.getRelativeNowText("Progress",{style:"long"});return e.isValidDate()?e.isNow()?w.storage.lang("bookmarksItem_now"):w.storage.lang(`prediction_Episode_${this.type}`,[n]):""}getLastTimestamp(){return this.getProgressLastTimestamp()?this.getProgressLastTimestamp():NaN}getLast(){const t=Number(this.getLastTimestamp());return Number.isNaN(t)?"":new f(t).getRelativeNowFriendlyText("Progress",{style:"significantLongNarrow"})}getLastText(){const t=Number(this.getLastTimestamp());if(Number.isNaN(t))return"";const e=new f(Number(t)),n=e.getRelativeNowText("Progress",{style:"long"});return e.isValidDate()?e.isNow()?w.storage.lang("bookmarksItem_now"):w.storage.lang(`prediction_Last_${this.type}`,[n]):""}getAuto(){const t=this.getPrediction();if(t)return t;return this.getLast()||""}getAutoText(){const t=this.getPredictionText();if(t)return t;return this.getLastText()||""}getColor(){return"#f57c00"}getBars(t,e){const n=this.getCurrentEpisode(),a={totalWidth:100,epWidth:0,predWidth:0};if(!e)if(a.totalWidth=0,t&&(!n||t>=n))e=Math.ceil(1.2*t);else{if(!n||t&&!(t<n))return a;e=Math.ceil(1.2*n)}return t&&(a.epWidth=t/e*100,a.epWidth>100&&(a.epWidth=100)),n&&(a.predWidth=n/e*100,a.predWidth>100&&(a.predWidth=100)),a}}var E=n(53011),k=n(78584),S=n(13647);const T=Math.floor(1e9*Math.random()),I=new E.EventEmitter2({wildcard:!0});function x(t,...e){k.m("Global").m("Emit").debug(t,...e),I.emit(`${t}`,...e),void 0!==S&&S&&"webextension"===S.type&&chrome.runtime.sendMessage({name:"emitter",item:{event:t,params:e,id:T}})}void 0!==S&&S&&"webextension"===S.type&&(chrome.runtime.sendMessage({name:"registerEmitter"}),chrome.runtime.onMessage.addListener(((t,e,n)=>{t.name&&"emitter"===t.name&&(k.m("Global").m("Event").debug(t.item.id,t.item.event,t.item.params),t.item.id!==T&&I.emit(t.item.event,...t.item.params))}))),Error;class A extends Error{constructor(t){super(t),this.name="SafeError"}}Error,Error;var N=n(26017),L=n(13647);class R extends Error{constructor(t){super(t),this.name="NotAutenticatedError"}}class O extends Error{constructor(t){super(t),this.name="UrlNotSupportedError"}}class C extends Error{constructor(t){super(t),this.name="ServerOfflineError"}}class P extends Error{constructor(t){super(t),this.name="NotFoundError"}}class M extends Error{constructor(t){super(t),this.name="UnexpectedResponseError"}}function D(t,e){return t instanceof R?L.storage.lang("Error_Authenticate",[e]):t instanceof C?"Server Offline":t instanceof O?`Incorrect url provided [${t.message}]`:t instanceof P?"Could not find this entry":t.message}var U=n(13647);const F={ui:{module:"dropdown"},getOptions:()=>[{value:0,label:U.storage.lang("UI_Score_Not_Rated")},{value:100,label:U.storage.lang("UI_Score_Masterpiece")},{value:90,label:U.storage.lang("UI_Score_Great")},{value:80,label:U.storage.lang("UI_Score_VeryGood")},{value:70,label:U.storage.lang("UI_Score_Good")},{value:60,label:U.storage.lang("UI_Score_Fine")},{value:50,label:U.storage.lang("UI_Score_Average")},{value:40,label:U.storage.lang("UI_Score_Bad")},{value:30,label:U.storage.lang("UI_Score_VeryBad")},{value:20,label:U.storage.lang("UI_Score_Horrible")},{value:10,label:U.storage.lang("UI_Score_Appalling")}],valueToOptionValue:t=>t?t<10?10:10*Math.round(t/10):0,optionValueToValue:t=>t?Number(t):0};var j=n(78584),z=n(13647),H=n(26017),G=n(7263);Object.seal(I);class W{constructor(t){return this.url=t,this.type=null,this.syncMethod="normal",this.askCompleted=!1,this.rewatchingSupport=!0,this.datesSupport=!0,this.ids={mal:NaN,ani:NaN,kitsu:{id:NaN,slug:""},simkl:NaN},this.options=null,this.progress=!1,this.updateProgress=!1,this._onList=!1,this._authenticated=!1,this.handleUrl(t),this.logger=j.m("[S]","#348fff"),this}getType(){return this.type}getUrl(){return this.url}supportsRewatching(){return this.rewatchingSupport}supportsDates(){return this.datesSupport}getApiCacheKey(){return this.getKey(["ANILIST"])}getRulesCacheKey(){return this.getKey(["ANILIST","KITSU"],!1)}setStatus(t){return t=Number(t),this._setStatus(t),this}getStatus(){return this.isOnList()?this._getStatus():t.NoState}setStartDate(t){return this.supportsDates()&&this._setStartDate(t),this}getStartDate(){return this.supportsDates()?this._getStartDate():null}setFinishDate(t){return this.supportsDates()&&this._setFinishDate(t),this}getFinishDate(){return this.supportsDates()?this._getFinishDate():null}setRewatchCount(t){return this.supportsRewatching()&&this._setRewatchCount(t),this}getRewatchCount(){return this.supportsRewatching()?this._getRewatchCount():null}getScoreMode(){return F}setScore(t){return(t=parseInt(`${t}`))||(t=0),this._setScore(t),this}getScore(){return this._getScore()||0}setAbsoluteScore(t){return t=parseInt(`${t}`),this._setAbsoluteScore(t),this}getAbsoluteScore(){return this._getAbsoluteScore()||0}setEpisode(t){return t=parseInt(`${t}`),this.getTotalEpisodes()&&t>this.getTotalEpisodes()&&(t=this.getTotalEpisodes()),this._setEpisode(t),this}getEpisode(){return this._getEpisode()}setVolume(t){return this._setVolume(t),this}getVolume(){return this._getVolume()}setStreamingUrl(t){return this.options&&(this.options.u=t),this}getStreamingUrl(){if(this.options&&this.options.u)return this.options.u}cleanTags(){this.options=null}async initProgress(){const t=await m(this.getType(),this.getApiCacheKey());return new _(this.getCacheKey(),this.getType()).init({uid:this.getCacheKey(),apiCacheKey:this.getApiCacheKey(),title:this.getTitle(),cacheKey:this.getCacheKey(),progressMode:this.getProgressMode(),watchedEp:this.getEpisode(),single:this,xhr:t}).then((e=>{this.updateProgress=!1,this.progress=e,this.progressXhr=t}))}getProgress(){return!!this.progress&&this.progress}getProgressFormated(){const t=[],e=new Intl.DisplayNames("en",{type:"language"});return j.log(this.progressXhr),this.progressXhr&&Object.keys(this.progressXhr).length&&this.progressXhr.forEach((n=>{t.push({type:n.type,key:n.id,state:n.state,label:e.of(n.lang.replace(/^jp$/,"ja"))||n.lang,dropped:"dropped"===n.state||"discontinued"===n.state,episode:n.lastEp&&n.lastEp.total?n.lastEp.total:0,lastEp:n.lastEp,predicition:n.prediction})})),t}getProgressOptions(){return this.getProgressFormated().filter((t=>"complete"!==t.state))}getProgressCompleted(){return this.getProgressFormated().filter((t=>"complete"===t.state))}getProgressMode(){return this.options&&this.options.p?this.options.p:""}setProgressMode(t){this.options&&(this.options.p=t,this.updateProgress=!0),z.settings.get("malTags")||H.setEntrySettings(this.type,this.getCacheKey(),this.options,this._getTags()).then((()=>this.initProgress()))}getProgressKey(){let t=this.getProgressMode();if(t||(t="anime"===this.getType()?z.settings.get("progressIntervalDefaultAnime"):z.settings.get("progressIntervalDefaultManga")),!t)return null;const e=/^([^/]*)\/(.*)$/.exec(t);return e?{key:t,lang:e[1],type:e[2]}:null}getPageRelations(){const t=this.shortName,e=[];return this.ids.mal&&"MAL"!==t&&e.push({name:"MAL",icon:"https://cdn.myanimelist.net/images/favicon.ico",link:`https://myanimelist.net/${this.type}/${this.ids.mal}`}),this.ids.ani&&"AniList"!==t&&e.push({name:"AniList",icon:"https://anilist.co/img/icons/favicon-32x32.png",link:`https://anilist.co/${this.type}/${this.ids.ani}`}),this.ids.kitsu.id&&"Kitsu"!==t&&e.push({name:"Kitsu",icon:"https://kitsu.app/favicon-32x32-3e0ecb6fc5a6ae681e65dcbc2bdf1f17.png",link:`https://kitsu.app/${this.type}/${this.ids.kitsu.id}`}),this.ids.simkl&&"Simkl"!==t&&e.push({name:"Simkl",icon:"https://eu.simkl.in/img_favicon/v2/favicon-32x32.png",link:`https://simkl.com/${this.type}/${this.ids.simkl}`}),e}fillRelations(){return Promise.resolve()}update(){return this.logger.log("[SINGLE]","Update info",this.ids),this.lastError=null,this._update().catch((t=>{throw this.lastError=t,t})).then((()=>(this.persistanceState=this.getStateEl(),H.getEntrySettings(this.type,this.getCacheKey(),this._getTags())))).then((t=>{this.options=t,this.registerEvent(),this.emitUpdate("state")}))}async sync(){return this.logger.log("[SINGLE]","Sync",this.ids),this.lastError=null,this._setTags(await H.setEntrySettings(this.type,this.getCacheKey(),this.options,this._getTags())),this.fixDates(),this._sync().catch((t=>{throw this.lastError=t,t})).then((()=>{this.undoState=this.persistanceState,this.updateProgress&&this.initProgress(),this._onList=!0,this.emitUpdate()}))}emitUpdate(t="update"){x(`${t}.${this.getCacheKey()}`,{id:this.getPageId(),type:this.getType(),cacheKey:this.getCacheKey(),state:this.getStateEl(),meta:{title:this.getTitle(),image:this.getImage(),malId:this.getMalId(),totalEp:this.getTotalEpisodes(),url:this.getUrl()}})}async delete(){return this._delete().then((()=>{this._onList=!1,x(`delete.${this.getCacheKey()}`,{id:this.getPageId(),type:this.getType(),cacheKey:this.getCacheKey()})}))}registerEvent(){this.globalUpdateEvent||(this.globalUpdateEvent=I.on(`update.${this.getCacheKey()}`,(t=>this.updateEvent(t))))}updateEvent(t){this.isDirty()?this.logger.log("Ignore event"):t&&t.state&&(this.setStateEl(t.state),this.persistanceState=this.getStateEl(),I.emit("syncPage_fillUi"))}isDirty(){return JSON.stringify(this.persistanceState)!==JSON.stringify(this.getStateEl())||this.updateProgress}undo(){if(this.logger.log("[SINGLE]","Undo",this.undoState),!this.undoState)throw new A("No undo state found");if(!this.undoState.onList){if(void 0===this.delete)throw new Error("Deleting an entry is not supported");return this.delete().then((()=>{this.setStateEl(this.undoState),this.undoState=null}))}return this.setStateEl(this.undoState),this.sync().then((()=>{this.undoState=null}))}getTitle(t=!1){return this._getTitle(t)}getTotalEpisodes(){let t=this._getTotalEpisodes();return t||(t=0),t}getTotalVolumes(){return this._getTotalVolumes()}isOnList(){return this._onList}isAuthenticated(){return this._authenticated}getDisplayUrl(){return this._getDisplayUrl()}getMalUrl(){return Number.isNaN(this.ids.mal)?null:`https://myanimelist.net/${this.getType()}/${this.ids.mal}`}getMalId(){return Number.isNaN(this.ids.mal)?null:this.ids.mal}getIds(){return this.ids}getImage(){return this._getImage()}getRating(){return this._getRating().then((t=>t||"N/A"))}setResumeWatching(t,e){return H.setResumeWaching(t,e,this.type,this.getCacheKey())}getResumeWatching(){return this.options&&this.options.r?this.options.r:null}setContinueWatching(t,e){return H.setContinueWaching(t,e,this.type,this.getCacheKey())}getContinueWatching(){return this.options&&this.options.c?this.options.c:null}increaseRewatchCount(){}getStateEl(){return{onList:this.isOnList(),episode:this.getEpisode(),volume:this.getVolume(),status:this.getStatus(),startDate:this.getStartDate(),finishDate:this.getFinishDate(),rewatchCount:this.getRewatchCount(),score:this.getScore(),absoluteScore:this.getAbsoluteScore()}}setStateEl(t){this._onList=t.onList,this.setEpisode(t.episode),this.setVolume(t.volume),this.setStatus(t.status),this.setStartDate(t.startDate),this.setFinishDate(t.finishDate),this.setRewatchCount(t.rewatchCount),this.setScore(t.score),t.absoluteScore&&this.setAbsoluteScore(t.absoluteScore)}getStateDiff(){const t=this.getStateEl();if(t&&this.undoState){const e={};for(const n in t)t[n]!==this.undoState[n]&&(e[n]=t[n]);return e}}getSyncMethod(){return this.syncMethod}setSyncMethod(t){this.syncMethod=t}fixDates(){if(!this.supportsDates()||"listSync"===this.getSyncMethod())return;const e=(0,N.returnYYYYMMDD)();null===this.getStartDate()&&this._getStatus()===t.Watching&&this._getEpisode()>0&&this.setStartDate(e),null===this.getFinishDate()&&this._getStatus()===t.Completed&&(this.setFinishDate(e),null===this.getStartDate()&&this.setStartDate(e))}async lifeCycleHook(e){this.askCompleted&&("afterCheckSync"===e&&z.settings.get("askBefore")||"beforeSync"===e&&!z.settings.get("askBefore"))&&(this.askCompleted=!1,this.getStatus()===t.Rewatching?await this.finishRewatchingMessage():await this.finishWatchingMessage())}async checkSync(e,n){const a=this.getEpisode(),s=this.getStatus(),i=this.getVolume();return s===t.Completed?1===e&&this.startRewatchingMessage():!(a>=e&&!(void 0!==n&&(i||n>1||!e)&&n>i))&&(e&&e===this.getTotalEpisodes()?(this.askCompleted=!0,!0):s===t.Watching||s===t.Rewatching||this.startWatchingMessage())}async startWatchingMessage(){return H.flashConfirm(z.storage.lang(`syncPage_flashConfirm_start_${this.getType()}`),"add").then((e=>(e&&(this.setStatus(t.Watching),this.setStartDate((0,N.returnYYYYMMDD)())),e)))}async finishWatchingMessage(){const e=this.getScoreCheckboxValue();let n='<div><select id="finish_score" style="margin-top:5px; color:white; background-color:#4e4e4e; border: none;">';return this.getScoreCheckbox().forEach((t=>{n+=`<option value="${t.value}" ${e===t.value?"selected":""}>${t.label}</option>`})),n+="</select></div>",H.flashConfirm(z.storage.lang("syncPage_flashConfirm_complete")+n,"complete").then((e=>(e&&(this.setStatus(t.Completed),this.setFinishDate((0,N.returnYYYYMMDD)()),this.getStartDate()||this.setStartDate((0,N.returnYYYYMMDD)()),Number(G.$("#finish_score").val())>0&&(this.logger.log(`finish_score: ${G.$("#finish_score :selected").val()}`),this.handleScoreCheckbox(G.$("#finish_score :selected").val()))),e)))}async startRewatchingMessage(){return H.flashConfirm(z.storage.lang(`syncPage_flashConfirm_rewatch_start_${this.getType()}`),"add").then((e=>(e&&this.setStatus(t.Rewatching),e)))}async finishRewatchingMessage(){return H.flashConfirm(z.storage.lang(`syncPage_flashConfirm_rewatch_finish_${this.getType()}`),"complete").then((e=>(e&&(this.setStatus(t.Completed),this.increaseRewatchCount()),e)))}getScoreCheckbox(){return this.getScoreMode().getOptions()}getScoreCheckboxValue(){return this.getScoreMode().valueToOptionValue(this.getAbsoluteScore())}handleScoreCheckbox(t){this.setAbsoluteScore(this.getScoreMode().optionValueToValue(t))}getDisplayScoreCheckbox(){const t=this.getScoreCheckboxValue(),e=this.getScoreCheckbox().filter((e=>e.value===t));return e.length?e[0].label:""}getStatusCheckbox(){const e=[{value:t.Watching.toString(),label:z.storage.lang(`UI_Status_watching_${this.getType()}`)},{value:t.Completed.toString(),label:z.storage.lang("UI_Status_Completed")},{value:t.Onhold.toString(),label:z.storage.lang("UI_Status_OnHold")},{value:t.Dropped.toString(),label:z.storage.lang("UI_Status_Dropped")},{value:t.PlanToWatch.toString(),label:z.storage.lang(`UI_Status_planTo_${this.getType()}`)}];return this.supportsRewatching()&&e.push({value:t.Rewatching.toString(),label:z.storage.lang(`UI_Status_Rewatching_${this.getType()}`)}),e}handleStatusCheckbox(t){this.setStatus(t)}getStatusCheckboxValue(){return this.getStatus()}getKey(t,e=!0){return e&&this.ids.mal?this.ids.mal:this.ids.ani&&t.includes("ANILIST")?`anilist:${this.ids.ani}`:this.ids.kitsu.id&&t.includes("KITSU")?`kitsu:${this.ids.kitsu.id}`:this.ids.simkl&&t.includes("SIMKL")?`simkl:${this.ids.simkl}`:this.ids.mal}getLastError(){return this.lastError}getLastErrorMessage(){return this.errorMessage(this.getLastError())}flashmError(t){H.flashm(this.errorMessage(t),{error:!0,type:"error"})}errorMessage(t){return D(t,this.authenticationUrl)}}var K=n(78584),B=n(13647);const V=K.m("kitsu","#d65e43");function q(e,n=null){const a={current:t.Watching,planned:t.PlanToWatch,completed:t.Completed,dropped:t.Dropped,on_hold:t.Onhold};return null!==n?Object.keys(a).find((t=>a[t]===n)):a[e]}function X(t){return"string"!=typeof t?null:t.substring(0,10)}function Y(t){return"string"!=typeof t?null:`${t}T00:00:00.000Z`}function J(t,e){let n;switch(B.settings.get("kitsuOptions").titleLanguagePreference){case"english":n=t.en;break;case"romanized":n=t.en_jp;break;default:n=e}if(void 0!==n&&n||(n=t.en),void 0!==n&&n||(n=t.en_jp),void 0!==n&&n||(n=t.ja_jp),void 0===n||!n){const e=Object.keys(t);if(!e.length)return"No Title";n=t[e[0]]}return n}function Z(t,e){return Number.isNaN(t)||!t?`kitsu:${e}`:t}function Q(t,e,n={},a=!0){const s={"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"};return a&&(s.Authorization=`Bearer ${B.settings.get("kitsuToken")}`),B.request.xhr(t,{url:e,headers:s,data:"GET"!==t?JSON.stringify(n):void 0}).then((t=>{if(t.status>499&&t.status<600||0===t.status)throw new C(`Server Offline status: ${t.status}`);if(204===t.status)return{};const e=function(t){try{return JSON.parse(t)}catch(t){throw new M(t.message)}}(t.responseText);if(void 0!==e.errors&&e.errors.length){V.error("[SINGLE]","Error",e.errors);const t=e.errors[0];switch(parseInt(t.status)){case 401:case 403:throw new R(t.detail);case 404:throw new P(t.detail);default:throw new Error(t.detail)}}return e}))}var tt=n(13647);const et={ui:{module:"dropdown"},getOptions(){const t=[{value:0,label:tt.storage.lang("UI_Score_Not_Rated")}];for(let e=2;e<21;e++)t.push({value:5*e,label:(e/2).toFixed(1).toString()});return t},valueToOptionValue:t=>t?t<10?10:5*Math.round(Number(t)/5):0,optionValueToValue:t=>t?Number(t):0};var nt=n(13647);const at={ui:{module:"click",type:"smiley"},getOptions:()=>[{value:0,label:nt.storage.lang("UI_Score_Not_Rated")},{value:100,label:""},{value:70,label:""},{value:40,label:""},{value:10,label:""}],valueToOptionValue:t=>t?t<25?10:t<55?40:t<85?70:100:0,optionValueToValue:t=>t?Number(t):0};var st=n(13647);const it={ui:{module:"dropdown"},getOptions(){const t=[{value:0,label:st.storage.lang("UI_Score_Not_Rated")}];for(let e=1;e<11;e++)t.push({value:10*e,label:(e/2).toFixed(1).toString()});return t},valueToOptionValue:t=>t?t<10?10:10*Math.round(t/10):0,optionValueToValue:t=>t?Number(t):0};var rt=n(78584),ot=n(26017),lt=n(13647);class ct extends W{constructor(t){return super(t),this.url=t,this.shortName="Kitsu",this.authenticationUrl="https://kitsu.app/404?mal-sync=authentication",this.logger=rt.m(this.shortName,"#d65e43"),this}listI(){return this.animeInfo.data[0]}animeI(){return this.animeInfo.included[0]}handleUrl(t){if(t.match(/kitsu\.app\/(anime|manga)\/.*/i))return this.type="anime"===ot.urlPart(t,3)?"anime":"manga",void(this.ids.kitsu.slug=ot.urlPart(t,4));if(t.match(/myanimelist\.net\/(anime|manga)\/\d*/i))return this.type="anime"===ot.urlPart(t,3)?"anime":"manga",void(this.ids.mal=Number(ot.urlPart(t,4)));throw new O(t)}getCacheKey(){return this.getKey(["KITSU"])}getPageId(){return this.ids.kitsu.id}_getStatus(){return this.listI().attributes.reconsuming&&"current"===this.listI().attributes.status?t.Rewatching:parseInt(q(this.listI().attributes.status))}_setStatus(e){e===t.Rewatching?(e=t.Watching,this.listI().attributes.reconsuming=!0):this.listI().attributes.reconsuming=!1,this.listI().attributes.status=q(e,parseInt(e.toString()))}_getStartDate(){return X(this.listI().attributes.startedAt)}_setStartDate(t){this.listI().attributes.startedAt=Y(t)}_getFinishDate(){return X(this.listI().attributes.finishedAt)}_setFinishDate(t){this.listI().attributes.finishedAt=Y(t)}_getRewatchCount(){return this.listI().attributes.reconsumeCount}_setRewatchCount(t){this.listI().attributes.reconsumeCount=t}_getScore(){if(!this.listI().attributes.ratingHundred)return 0;const t=Math.round(this.listI().attributes.ratingHundred/10);return 0===t?1:t}_setScore(t){this.listI().attributes.ratingHundred=t?10*t:null}_getAbsoluteScore(){return Number(this.listI().attributes.ratingHundred)}_setAbsoluteScore(t){this.listI().attributes.ratingHundred=Number(t)}_getTwentyScore(){const t=this.listI().attributes.ratingHundred;return t?t<5?1:Math.round(t/5):null}_getEpisode(){return this.listI().attributes.progress}_setEpisode(t){this.listI().attributes.progress=parseInt(`${t}`)}_getVolume(){return this.listI().attributes.volumesOwned}_setVolume(t){this.listI().attributes.volumesOwned=t}_getTags(){let t=this.listI().attributes.notes;return null!==t&&"null"!==t||(t=""),t}_setTags(t){this.listI().attributes.notes=t}_getTitle(){try{return J(this.animeI().attributes.titles,this.animeI().attributes.canonicalTitle)}catch(t){return console.error("title",t),"Failed"}}_getTotalEpisodes(){const t=this.animeI().attributes.episodeCount?this.animeI().attributes.episodeCount:this.animeI().attributes.chapterCount;return null===t?0:t}_getTotalVolumes(){return this.animeI().attributes.volumeCount||0}_getDisplayUrl(){return`https://kitsu.app/${this.getType()}/${this.animeI().attributes.slug}`}_getImage(){return this.animeI().attributes.posterImage&&this.animeI().attributes.posterImage.large?this.animeI().attributes.posterImage.large:""}_getRating(){return null===this.animeI().attributes.averageRating?Promise.resolve(""):Promise.resolve(`${this.animeI().attributes.averageRating}%`)}async _update(){if(Number.isNaN(this.ids.mal)){var t=await this.kitsuSlugtoKitsu(this.ids.kitsu.slug,this.getType());try{this.ids.kitsu.id=Number(t.res.data[0].id),this.ids.mal=Number(t.malId)}catch(t){throw this._authenticated=!0,new P("Not found")}}if(Number.isNaN(this.ids.kitsu.id)){var e=await this.malToKitsu(this.ids.mal,this.getType());try{const t=e.data.find((t=>t.relationships.item.data.type===this.getType()));if(!t)throw new P("Not found");this.ids.kitsu.id=Number(t.relationships.item.data.id)}catch(t){throw this._authenticated=!0,new P(`No entry found for malId ${this.ids.mal}`)}}return this._authenticated=!0,this.userId().then((t=>this.apiCall("GET",`https://kitsu.app/api/edge/library-entries?filter[user_id]=${t}&filter[kind]=${this.getType()}&filter[${this.getType()}_id]=${this.ids.kitsu.id}&page[limit]=1&page[limit]=1&include=${this.getType()}&fields[${this.getType()}]=slug,titles,canonicalTitle,averageRating,posterImage,${"anime"===this.getType()?"episodeCount":"chapterCount,volumeCount"}`))).catch((t=>{if(t instanceof R)return this._authenticated=!1,{data:[],included:[]};throw t})).then((async n=>{const a=n;this._onList=!0,n.data.length||(this._onList=!1,a.data[0]={attributes:{notes:"",progress:0,volumesOwned:0,reconsuming:!1,reconsumeCount:0,ratingTwenty:null,status:"planned",startedAt:null,finishedAt:null}},void 0!==e?a.included=e.included:t?a.included=t.res.data:(e=await this.malToKitsu(this.ids.mal,this.getType()),a.included=e.included)),a.data[0].attributes.ratingHundred?a.data[0].attributes.ratingHundred=0:a.data[0].attributes.ratingHundred=Number(5*a.data[0].attributes.ratingTwenty),this.animeInfo=a;try{this.animeI()}catch(t){throw this.logger.error(t),new P("Not found")}if(!this._authenticated)throw new R("Not Authenticated")}))}async _sync(){const t={data:{attributes:{notes:this.listI().attributes.notes,progress:this.listI().attributes.progress,volumesOwned:this.listI().attributes.volumesOwned,reconsuming:this.listI().attributes.reconsuming,reconsumeCount:this.listI().attributes.reconsumeCount,ratingTwenty:this._getTwentyScore(),status:this.listI().attributes.status,startedAt:this.listI().attributes.startedAt,finishedAt:this.listI().attributes.finishedAt},type:"library-entries"}},e=this.getType();if(!e)return Promise.resolve();let n,a;return this.isOnList()?(n=`https://kitsu.app/api/edge/library-entries/${this.listI().id}`,t.data.id=this.listI().id,a="PATCH"):(n="https://kitsu.app/api/edge/library-entries/",t.data.relationships={[e]:{data:{type:e,id:this.ids.kitsu.id}},user:{data:{type:"users",id:await this.userId()}}},a="POST"),this.logger.log(a,t),this.apiCall(a,n,t).then((t=>(t&&t.data&&t.data.id&&(this.listI().id=t.data.id),t)))}apiCall(t,e,n={},a=!0){return Q(t,e,n,a).catch((t=>{if(t instanceof R)throw new R(t.message);throw t}))}kitsuSlugtoKitsu(t,e){return this.apiCall("GET",`https://kitsu.app/api/edge/${e}?filter[slug]=${t}&page[limit]=1&include=mappings`,{}).catch((n=>{if(n instanceof R)return this._authenticated=!1,this.apiCall("GET",`https://kitsu.app/api/edge/${e}?filter[slug]=${t}&page[limit]=1&include=mappings`,{},!1);throw n})).then((t=>{let n=NaN;if(void 0!==t&&void 0!==t.included)for(let a=0;a<t.included.length;a++){const s=t.included[a];if("mappings"===s.type){if(s.attributes.externalSite===`myanimelist/${e}`){n=Number(s.attributes.externalId),t.included.splice(a,1);break}s.attributes.externalSite===`anilist/${e}`&&(this.ids.ani=Number(s.attributes.externalId))}}return{res:t,malId:n}}))}malToKitsu(t,e){return this.apiCall("GET",`https://kitsu.app/api/edge/mappings?filter[externalSite]=myanimelist/${e}&filter[externalId]=${t}&include=item&fields[item]=id`,{}).catch((n=>{if(n instanceof R)return this._authenticated=!1,this.apiCall("GET",`https://kitsu.app/api/edge/mappings?filter[externalSite]=myanimelist/${e}&filter[externalId]=${t}&include=item&fields[item]=id`,{},!1);throw n})).then((t=>t))}async userId(){const t=await lt.storage.get("kitsuUserId");return void 0!==t&&t?t:this.apiCall("GET","https://kitsu.app/api/edge/users?filter[self]=true").then((t=>{if(void 0===t.data||!t.data.length||void 0===t.data[0])throw new R("Not Authenticated");return lt.storage.set("kitsuUserId",t.data[0].id),t.data[0].id}))}getScoreMode(){switch(lt.settings.get("kitsuOptions").ratingSystem){case"simple":return at;case"regular":return it;case"advanced":return et;default:return F}}_delete(){return this.apiCall("DELETE",`https://kitsu.app/api/edge/library-entries/${this.listI().id}`)}}var ut=n(13647),ht=n(78584),mt=n(26017);Object.seal(I);class pt{constructor(t=1,e="anime",n="default"){return this.status=t,this.listType=e,this.sort=n,this.done=!1,this.loading=!1,this.firstLoaded=!1,this.seperateRewatching=!1,this.modes={frontend:!1,sortAiring:!1,initProgress:!1,cached:!1},this.username="",this.offset=0,this.templist=[],this.api=ut,this.cacheObj=void 0,this.status=Number(this.status),this.logger=ht.m("[S]","#348fff"),this}setTemplist(t){return this.templist=t,this}getTemplist(){return this.templist}setSort(t){if(this.firstLoaded||this.loading)throw"To late to change sort";this.sort=t}isDone(){return this.done}isLoading(){return this.loading}isFirstLoaded(){return this.firstLoaded}async getCompleteList(){do{await this.getNext()}while(!this.done);return this.modes.sortAiring&&await this.sortAiringList(),this.modes.cached&&this.getCache().setValue(this.templist.slice(0,18)),this.firstLoaded=!0,this.templist}async getNextPage(){return this.done?this.templist:!this.modes.frontend||1!==this.status||"default"!==this.sort&&"unread"!==this.sort?(await this.getNext(),this.modes.cached&&this.getCache().setValue(this.templist.slice(0,24)),this.firstLoaded=!0,this.templist):(this.modes.sortAiring=!0,this.getCompleteList())}async getNext(){this.loading=!0;const t=await this.getPart();this.templist=this.templist.concat(t),this.loading=!1}async getCached(){if(await this.getCache().hasValue()){const t=await this.getCache().getValue();return t.forEach((t=>{(t=this.fn(t)).watchedEp="",t.score=""})),t}return[]}initFrontendMode(){this.modes.frontend=!0,this.updateListener=I.on("update.*",(t=>{if(ht.log("update",t),t.cacheKey){const e=this.templist.find((e=>e.cacheKey===t.cacheKey));ht.log(e),e&&t.state&&(e.watchedEp=t.state.episode,e.score=t.state.score,e.status=t.state.status)}}),{objectify:!0})}destroy(){this.updateListener&&this.updateListener.off()}getUsername(){return this.getUserObject().then((t=>t.username))}getSortingOptions(t=!1){const e=[{icon:"filter_list",title:ut.storage.lang("settings_progress_default"),value:"default"}];return 1===this.status&&"manga"===this.listType&&e.push({icon:"adjust",title:ut.storage.lang("list_sorting_unread"),value:"unread"}),this._getSortingOptions().forEach((n=>{if(!t){if(n.asc){const t={...n};delete t.asc,t.value+="_asc",t.title+=" Ascending",e.push(t)}delete n.asc}e.push(n)})),e}flashmError(t){mt.flashm(this.errorMessage(t),{error:!0,type:"error"})}errorMessage(t){return D(t,this.authenticationUrl)}async fn(t,e=""){let n=null;return t.fn={continueUrl:()=>null!==n?n:mt.getContinueWaching(t.type,t.cacheKey).then((e=>{const a=parseInt(t.watchedEp.toString());return void 0===e||e.ep!==a+1?"":(n=e.url,n)})),initProgress:()=>new _(t.cacheKey,t.type).init().then((e=>{t.fn.progress=e})),progress:!1},t.options=await mt.getEntrySettings(t.type,t.cacheKey,t.tags),e&&(t.options.u=e),(this.modes.sortAiring||this.modes.initProgress)&&await t.fn.initProgress(),t}async initProgress(){const t=[];this.templist.forEach((e=>{t.push(e.fn.initProgress())})),await Promise.all(t)}async sortAiringList(){if("unread"===this.sort)return void this.sortUnread();const t=[];let e=[],n=[];function a(t,e){let n=t.fn.progress.getPredictionTimestamp(),a=e.fn.progress.getPredictionTimestamp();return n||(n=999999999999),a||(a=n),n-a}this.templist.forEach((a=>{const s=a.fn.progress;"anime"===this.listType?s&&s.isAiring()&&s.getPredictionTimestamp()?a.watchedEp<s.getCurrentEpisode()?e.push(a):n.push(a):t.push(a):s&&s.isAiring()&&s.getCurrentEpisode()&&a.watchedEp&&a.watchedEp<s.getCurrentEpisode()&&a.watchedEp+6>s.getCurrentEpisode()?e.push(a):t.push(a)})),e=e.sort(a).reverse(),n=n.sort(a),this.templist=e.concat(n,t)}sortUnread(){this.templist=this.templist.sort((function(t,e){let n=1e4,a=1e4;if(t.fn.progress&&t.fn.progress.getCurrentEpisode()){const e=t.fn.progress.getCurrentEpisode()-t.watchedEp;e>0&&(n=e)}if(e.fn.progress&&e.fn.progress.getCurrentEpisode()){const t=e.fn.progress.getCurrentEpisode()-e.watchedEp;t>0&&(a=t)}return n-a}))}getCache(){return this.cacheObj||(this.cacheObj=new l(`list/${this.name}/${this.listType}/${this.status}/${this.sort}`,1728e5)),this.cacheObj}}var dt=n(13647),gt=n(78584);class ft extends pt{constructor(){super(...arguments),this.name="Kitsu",this.authenticationUrl="https://kitsu.app/404?mal-sync=authentication"}async getUserObject(){const t=await this.userRequest(),e=dt.settings.get("kitsuOptions");return e.titleLanguagePreference=t.attributes.titleLanguagePreference,e.sfwFilter=t.attributes.sfwFilter,e.ratingSystem=t.attributes.ratingSystem,dt.settings.set("kitsuOptions",e),{username:t.attributes.name,picture:t.attributes.avatar?.large||"",href:`https://kitsu.app/users/${t.attributes.slug||t.id}`}}async getUserId(){const t=await dt.storage.get("kitsuUserId");if(void 0!==t&&t)return t;const e=await this.userRequest();return dt.storage.set("kitsuUserId",e.id),e.id}userRequest(){return Q("GET","https://kitsu.app/api/edge/users?filter[self]=true").then((t=>{if(gt.log(t),void 0===t.data[0])throw new R("Not Authenticated");return t.data[0]}))}deauth(){return dt.settings.set("kitsuToken","").then((()=>dt.storage.set("kitsuUserId","")))}accessToken(){return dt.settings.get("kitsuToken")}_getSortingOptions(){return[{icon:"sort_by_alpha",title:dt.storage.lang("list_sorting_alpha"),value:"alpha",asc:!0},{icon:"history",title:dt.storage.lang("list_sorting_history"),value:"updated",asc:!0},{icon:"score",title:dt.storage.lang("list_sorting_score"),value:"score",asc:!0}]}getOrder(e){let n="";switch(e.endsWith("_asc")||(n="-"),e.replace("_asc","")){case"alpha":return n=n?"":"-",`${n}${this.listType}.titles.en`;case"updated":return`${n}progressed_at`;case"score":return`${n}rating`;default:return this.status===t.Watching||this.status===t.PlanToWatch?this.getOrder("updated"):this.getOrder("alpha")}}async getPart(){const e=await this.getUserId();let n="",a="";const s=this.getOrder(this.sort);return s&&(a=`&sort=${s}`),this.status!==t.All&&(n=`&filter[status]=${q(this.status,this.status)}`),gt.log("[UserList][Kitsu]",`user: ${e}`,`status: ${this.status}`,`offset: ${this.offset}`),Q("GET",`https://kitsu.app/api/edge/library-entries?filter[user_id]=${e}${n}&filter[kind]=${this.listType}&page[offset]=${this.offset}&page[limit]=50${a}&include=${this.listType},${this.listType}.mappings,${this.listType}.mappings.item&fields[${this.listType}]=slug,titles,canonicalTitle,averageRating,posterImage,coverImage,${"anime"===this.listType?"episodeCount":"chapterCount,volumeCount"}`).then((t=>(gt.log(t),this.offset+=50,t.meta.count>this.offset||(this.done=!0),this.prepareData(t,this.listType))))}async prepareData(t,e){const n=[];for(let a=0;a<t.data.length;a++){const s=t.data[a],i=t.included[a],r=J(i.attributes.titles,i.attributes.canonicalTitle);let o,l=NaN;for(let n=0;n<t.included.length;n++){const a=t.included[n];if("mappings"===a.type&&a.attributes.externalSite===`myanimelist/${e}`&&a.relationships.item.data.id===i.id){l=Number(a.attributes.externalId),t.included.splice(n,1);break}}o="anime"===e?await this.fn({malId:l,apiCacheKey:l,uid:Number(i.id),cacheKey:Z(l,i.id),kitsuSlug:i.attributes.slug,type:e,title:r,url:`https://kitsu.app/${e}/${i.attributes.slug}`,score:Math.round(s.attributes.ratingTwenty/2),watchedEp:s.attributes.progress,totalEp:i.attributes.episodeCount,status:q(s.attributes.status),startDate:X(s.attributes.startedAt),finishDate:X(s.attributes.finishedAt),rewatchCount:s.attributes.reconsumeCount,image:i.attributes.posterImage&&i.attributes.posterImage.small?i.attributes.posterImage.small:"",imageLarge:i.attributes.posterImage&&i.attributes.posterImage.original?i.attributes.posterImage.original:"",imageBanner:i.attributes.coverImage&&i.attributes.coverImage.large?i.attributes.coverImage.large:"",tags:s.attributes.notes,airingState:i.anime_airing_status}):await this.fn({malId:l,apiCacheKey:l,uid:Number(i.id),cacheKey:Z(l,i.id),kitsuSlug:i.attributes.slug,type:e,title:r,url:`https://kitsu.app/${e}/${i.attributes.slug}`,score:Math.round(s.attributes.ratingTwenty/2),watchedEp:s.attributes.progress,readVol:s.attributes.volumesOwned,totalEp:i.attributes.chapterCount,totalVol:i.attributes.volumeCount,status:q(s.attributes.status),startDate:X(s.attributes.startedAt),finishDate:X(s.attributes.finishedAt),rewatchCount:i.attributes.reconsumeCount,image:i.attributes.posterImage&&i.attributes.posterImage.small?i.attributes.posterImage.small:"",imageLarge:i.attributes.posterImage&&i.attributes.posterImage.original?i.attributes.posterImage.original:"",imageBanner:i.attributes.coverImage&&i.attributes.coverImage.large?i.attributes.coverImage.large:"",tags:s.attributes.notes,airingState:i.anime_airing_status}),null===o.totalEp&&(o.totalEp=0),n.push(o)}return n}}var yt=n(13647),bt=n(78584);const vt=n(52163);function wt(t,e,n){return function(t,e){let n=e.replace(/^\[l\]/i,"").trim(),a=[];const s=t.match(/{searchterm(\(.\))?(\[[^[\]]*\])?}/);if(!s)return t;const[i,r,o]=s;return o&&(a=o.substring(1,o.length-1).split(",")),a.includes("noLowercase")||(n=n.toLowerCase()),a.includes("noSpecial")?n=n.replace(/[^a-zA-Z\d ]/g,"").replace(/ +/g," ").trim():a.includes("specialReplace")&&(n=n.replace(/[^a-zA-Z\d ]/g," ").replace(/ +/g," ").trim()),n=a.includes("noEncode")?n.replace(/\//g," "):encodeURIComponent(n),r&&(n=n.replace(/(%20| )/g,r[1])),t.replace(i,n)}(t.replace("{searchtermPlus}","{searchterm(+)}").replace("{searchtermMinus}","{searchterm(-)}").replace("{searchtermUnderscore}","{searchterm(_)}").replace("{searchtermRaw}","{searchterm[noEncode,noLowercase]}").replace("{cacheId}",n),e)}let _t=null;function Et(){const t=yt.settings.get("quicklinks").map((t=>{return(e=t)?e.custom?e:function(){if(_t)return _t;const t=Object.values(yt.settings.getStaticChibi()).map((t=>({key:t.key,name:t.name,domain:"string"==typeof t.domain?t.domain:t.domain[0],database:t.database||null,search:"object"==typeof t.search?t.search:{anime:"anime"===t.type&&t.search||null,manga:"manga"===t.type&&t.search||null}})));return _t=[...vt,...t],_t}().find((t=>t.name===e)):null;var e})).filter((t=>t));return JSON.parse(JSON.stringify(t))}async function kt(t,e,n){let a=Et();if(e)try{a=await async function(t,e,n){const a=await async function(t,e){const n=`https://api.malsync.moe/mal/${t}/${e}`;return yt.request.xhr("GET",n).then((async t=>{if(bt.log("malSync response",t),400===t.status)return{};if(200===t.status){const e=JSON.parse(t.responseText);return e&&e.Sites?e.Sites:{}}throw new Error("malsync offline")}))}(e,n);return t.map((t=>(t.database&&a[t.database]&&(t.databaseLinks=a[t.database]),t)))}(a,t,e)}catch(t){bt.m("API Problem").error(t)}return function(t,e,n,a){return t.filter((t=>t.search&&t.search[e])).map((t=>{const s=[];let i;return t.databaseLinks?(i="link",Object.values(t.databaseLinks).forEach((t=>{s.push({name:t.title,url:t.url})}))):"home"===t.search[e]?(i="home",s.push({name:"Homepage",url:t.domain})):(i="search",s.push({name:"Quicksearch",url:wt(t.search[e],n,a),fn:n=>wt(t.search[e],n,a)})),{name:t.name,domain:t.domain,group:i,links:s}}))}(a,t,n,e)}var St=n(26017),Tt=n(13647),It=n(78584),xt=n(7263);class At{constructor(t){this.url=t,this.page=null,this.same=!1,this.authError=!1,this.tempAnimelist=null,this.tempMangalist=null;let e=window.location.href.split("/").slice(0,5).join("/");St.changeDetect((()=>{if(this.same=!1,null!==this.page&&"detail"===this.page.page){const t=window.location.href.split("/").slice(0,5).join("/");t===e&&(this.same=!0),e=t}this.url=window.location.href,this.init()}),(()=>null!==this.page&&"bookmarks"===this.page.page&&$(".library-content").length?$(".library-content").first().height():window.location.href)),$(document).ready((()=>{St.waitUntilTrue((function(){return $(".global-container").length}),(()=>{this.init()}))})),Tt.storage.addStyle(n(25382).toString())}async init(){await(0,N.waitForPageToBeVisible)(),this.url.indexOf("?mal-sync=authentication")>-1&&this.authentication();const t=St.urlPart(this.url,3);if(("anime"===t||"manga"===t)&&St.urlPart(this.url,4)){if(this.same&&void 0!==this.page&&"undefined"!==this.page.malObj)return this.streamingUI(),this.malToKiss(),void this.pageRelation();const e=new ct(this.url);await e.update(),this.page={page:"detail",id:e.getIds().kitsu.id,malid:e.getIds().mal,apiCacheKey:e.getApiCacheKey(),type:t,malObj:e},It.log("page",this.page),this.streamingUI(),this.malToKiss(),this.pageRelation()}if("library"===St.urlPart(this.url,5)){let t="anime";"manga"===St.urlParam(this.url,"media")&&(t="manga"),this.page={page:"bookmarks",type:t},It.log("page",this.page),this.bookmarks()}}authentication(){try{St.checkDoubleExecution()}catch(t){It.error(t)}$(document).ready((function(){$("body").after(xt.html(`\n        <div id="mal-sync-login" style="text-align: center; margin-top: 50px; background-color: white; border: 1px solid lightgrey; padding: 10px; max-width: 600px; margin-left: auto; margin-right: auto;">\n          <h1>MAL-Sync</h1>\n          <br>\n          <p style="text-align: left;">\n            ${Tt.storage.lang("kitsuClass_authentication_text")}\n          </p>\n          <div class="modal-content">\n            <input type="email" id="email" placeholder="Email" required>\n            <input type="password" id="pass" name="password" placeholder="${Tt.storage.lang("kitsuClass_authentication_Password")}" required>\n          </div>\n          <div class="form-cta" style="margin-top: 30px;">\n            <button class="btn button--primary" type="submit" id="mal-sync-button">\n              ${Tt.storage.lang("kitsuClass_authentication_Login")}\n            </button>\n          </div>\n        </div>\n      `)),$("#mal-sync-login #mal-sync-button").click((function(){$("#mal-sync-login #mal-sync-button").attr("disabled","disabled"),$.ajax({type:"POST",url:"https://kitsu.app/api/oauth/token",data:`grant_type=password&username=${encodeURIComponent(String($("#mal-sync-login #email").val()))}&password=${encodeURIComponent(String($("#mal-sync-login #pass").val()))}`,async success(t){const e=t.access_token;e&&(It.info("token",e),await Tt.settings.set("kitsuToken",e),$("#mal-sync-login").html(xt.html(`<h1>MAL-Sync</h1><br>${Tt.storage.lang("kitsuClass_authentication_Success")}`)))},error(t){try{if(It.error(t),$("#mal-sync-login #mal-sync-button").prop("disabled",!1),"invalid_grant"===t.responseJSON.error)return void St.flashm(Tt.storage.lang("kitsuClass_authentication_Wrong"));St.flashm(t.responseJSON.error_description)}catch(e){It.error(e),St.flashm(t.responseText)}}})})),St.waitUntilTrue((function(){return $("body h1").length}),(()=>{$("body h1").remove()}))}))}async getMalUrl(){return null!==this.page&&"detail"===this.page.page&&this.page.malid?`https://myanimelist.net/${this.page.type}/${this.page.malid}/${St.urlPart(this.url,5)}`:""}async streamingUI(){It.log("Streaming UI"),$("#mal-sync-stream-div").remove();const{malObj:t}=this.page,e=t.getStreamingUrl();e&&$(document).ready((async function(){$(".media--title h3").first().after(xt.html(`\n        <div class="data title progress" id="mal-sync-stream-div" style="display: inline-block; position: relative; top: -4px; display: inline;">\n          <a class="mal-sync-stream" title="${e.split("/")[2]}" target="_blank" style="margin: 0 0;" href="${e}">\n            <img src="${St.favicon(e.split("/")[2])}">\n          </a>\n        </div>`));const n=t.getResumeWatching(),a=t.getContinueWatching();It.log("Resume",n,"Continue",a),a&&a.ep===t.getEpisode()+1?$("#mal-sync-stream-div").append(xt.html(`<a class="nextStream" title="${Tt.storage.lang(`overview_Continue_${t.getType()}`)}" target="_blank" style="margin: 0 5px 0 0; color: #BABABA;" href="${a.url}">\n              <img src="${Tt.storage.assetUrl("double-arrow-16px.png")}" width="16" height="16">\n            </a>`)):n&&n.ep===t.getEpisode()&&$("#mal-sync-stream-div").append(xt.html(`<a class="resumeStream" title="${Tt.storage.lang(`overview_Resume_Episode_${t.getType()}`)}" target="_blank" style="margin: 0 5px 0 0; color: #BABABA;" href="${n.url}">\n              <img src="${Tt.storage.assetUrl("arrow-16px.png")}" width="16" height="16">\n            </a>`))}))}getImage(){return xt.$(".media-poster img").attr("src")||""}getTitle(){return $('meta[property="og:title"]').attr("content")||""}malToKiss(){$(document).ready((()=>{It.log("malToKiss"),$(".mal_links").remove();const t=this.getTitle();kt(this.page.type,this.page.apiCacheKey,t).then((t=>{let e="";t.forEach((t=>{let n="";t.links.forEach((t=>{n+=`\n              <div class="mal_links" style="margin-top: 5px;">\n                <a target="_blank" href="${t.url}">\n                  ${t.name}\n                </a>\n              </div>`})),e+=`\n            <div id="${t.name}Links" class="mal_links library-state with-header" style="\n              background: white;\n              margin-bottom: 15px;\n              border-radius: 3px;\n              display: block;\n              padding: 8px 12px;\n              width: 100%;\n              font-size: 12px;\n              word-break: break-all;\n            ">\n              <img src="${St.favicon(t.domain)}">\n              <span style="font-weight: 500; line-height: 16px; vertical-align: middle;">${t.name}</span>\n              <span title="${t.name}" class="remove-mal-sync" style="float: right; cursor: pointer;">x</span>\n              ${n}\n            </div>`})),$("#mal-sync-search-links").length?$("#mal-sync-search-links").first().after(xt.html(e)):$(".media-summary").first().after(xt.html(e)),$(".remove-mal-sync").click((function(){const t=$(this).attr("title");!function(t){const e=yt.settings.get("quicklinks");yt.settings.set("quicklinks",function(t,e){return e?t.filter((t=>!(!t||t===e||"object"==typeof t&&t.name===e))):t}(e,t))}(String(t)),window.location.reload()}))}))}))}async pageRelation(){$(".malsync-rel-link").remove(),await this.page.malObj.fillRelations(),$(".media-summary h5").first().append(xt.html('<div class="malsync-rel-link" style="display: inline-block; margin: 0 5px; vertical-align: bottom;"></div>')),this.page.malObj.getPageRelations().forEach((t=>{$(".malsync-rel-link").append(xt.html(`\n          <a href="${t.link}" target="_blank" title="${t.name}" class="link">\n            <img src="${t.icon}" width="16" height="16">\n          </a>\n\n        `))}))}bookmarks(){if(this.authError)return;const t=this;$(document).ready((()=>{if("anime"===this.page.type){if(null!==this.tempAnimelist)return void n(this.tempAnimelist)}else if(null!==this.tempMangalist)return void n(this.tempMangalist);const e=new ft(1,this.page.type);function n(e){let n=!0;$(".library-list tbody tr").length&&(n=!1),It.log(e),$.each(e,(async(e,a)=>{if(It.log("en",a),void 0!==a.malId&&null!==a.malId&&a.malId){const e=$(`.library-grid-popover:not(.malSyncDone2) a[href^="/${t.page.type}/${a.kitsuSlug}"], .library-list tbody tr:not(.malSyncDone2) a[href^="/${t.page.type}/${a.kitsuSlug}"]`).first().parent().parent().parent();It.log(e),e.addClass("malSyncDone2"),a.options&&a.options.u&&(It.log(a.options.u),n?e.prepend(xt.html(`\n                  <a class="mal-sync-stream mal-rem" title="${a.options.u.split("/")[2]}" target="_blank" style="margin: 0 0; z-index: 22; position:absolute; left: 0px; top: 0px; background-color: #ffffff5c; padding: 0 5px 3px 5px;" href="${a.options.u}">\n                    <img src="${St.favicon(a.options.u.split("/")[2])}">\n                  </a>`)):e.find(".title-wrapper").append(xt.html(`\n                  <a class="mal-sync-stream mal-rem" title="${a.options.u.split("/")[2]}" target="_blank" style="padding: 0 5px;" href="${a.options.u}">\n                    <img src="${St.favicon(a.options.u.split("/")[2])}">\n                  </a>`)));const s=a.options.r,i=a.options.c,r=a.watchedEp;It.log("Resume",s,"Continue",i),i&&i.ep===r+1?n?e.prepend(xt.html(`<a class="nextStream mal-rem" title="Continue watching" target="_blank" style="color: #BABABA; z-index: 22; position:absolute; top: 0px; left: 26px; background-color: #ffffff5c; padding: 0 5px 3px 5px;" href="${i.url}">\n                    <img src="${Tt.storage.assetUrl("double-arrow-16px.png")}" width="16" height="16">\n                  </a>`)):e.find(".title-wrapper").append(xt.html(`<a class="nextStream mal-rem" title="Continue watching" target="_blank" style="padding: 0;" href="${i.url}">\n                    <img src="${Tt.storage.assetUrl("double-arrow-16px.png")}" width="16" height="16">\n                  </a>`)):s&&s.ep===r&&(n?e.prepend(xt.html(`<a class="resumeStream mal-rem" title="Resume watching" target="_blank" style="color: #BABABA; z-index: 22; position:absolute; top: 0px; left: 26px; background-color: #ffffff5c; padding: 0 5px 3px 5px;" href="${s.url}">\n                    <img src="${Tt.storage.assetUrl("arrow-16px.png")}" width="16" height="16">\n                  </a>`)):e.find(".title-wrapper").append(xt.html(`<a class="resumeStream mal-rem" title="Resume watching" target="_blank" style="padding: 0;" href="${s.url}">\n                    <img src="${Tt.storage.assetUrl("arrow-16px.png")}" width="16" height="16">\n                  </a>`))),await a.fn.initProgress(),a.fn.progress&&a.fn.progress.isAiring()&&a.fn.progress.getCurrentEpisode()&&e.parent().find(".entry-unit, .progress-cell > span:last-of-type").first().append(xt.html(` <span class="mal-sync-ep-pre" title="${a.fn.progress.getAutoText()}">[<span style="border-bottom: 1px dotted ${a.fn.progress.getColor()};">${a.fn.progress.getCurrentEpisode()}</span>]</span>`))}}))}e.getCompleteList().then((t=>{"anime"===this.page.type?this.tempAnimelist=t:this.tempMangalist=t,n(t)})).catch((t=>{t instanceof R&&(this.authError=!0),It.error(t),e.flashmError(t)}))}))}}var Nt=n(13647),$t=n(7263),Lt=n(78584),Rt=n(26017);async function Ot(){const t=await Nt.storage.get("timestampUpdate/firebaseNotification");(void 0===t||$t.$.now()-t>6e5)&&(await Ct(),Nt.storage.set("timestampUpdate/firebaseNotification",$t.$.now()))}async function Ct(){Lt.log("checkNotifications");const t=await Nt.request.xhr("GET","https://kissanimelist.firebaseio.com/Data2/Notification/Current.json"),e=parseInt(JSON.parse(t.responseText));Number.isNaN(e)&&Lt.error("Could not read current Notification number"),Lt.log("Current Notification",e);const n=parseInt(await Nt.storage.get("firebaseNotification")),a=n+1;if(void 0===n||Number.isNaN(n))return void Nt.storage.set("firebaseNotification",e);if(e<a)return void Lt.log("No new notifications");const s=`https://kissanimelist.firebaseio.com/Data2/Notification/list/N${a}.json`,i=await Nt.request.xhr("GET",s);if(!i)return;const r=JSON.parse(i.responseText);if(!r)return Lt.info("Notification empty",i.responseText),void Nt.storage.set("firebaseNotification",a).then((function(){Ct()}));$t.$(document).ready((function(){const t=Rt.flashm(`<div style="text-align: left;">${r}</div><button class="okChangelog" style="background-color: transparent; border: none; color: rgb(255,64,129);margin-top: 10px;cursor: pointer;">Close</button>`,{permanent:!0,position:"top"});t.find(".okChangelog").click((function(){t.remove(),Nt.storage.set("firebaseNotification",a).then((function(){Ct()}))}))}))}var Pt=n(13647),Mt=n(78584);let Dt;console.log("%cMAL-Sync","font-size: 40px; padding-bottom: 3px; color: white; text-shadow: -1px -1px #2e51a2, 1px -1px #2e51a2, -1px 1px #2e51a2, 1px 1px #2e51a2, 2px 2px #2e51a2, 3px 3px #2e51a2;",`Version: ${Pt.storage.version()}`),Pt.settings.init().then((()=>{!function(){if(Pt.settings.get("userscriptModeButton"))throw"Userscript mode";var t;t=new At(window.location.href),chrome.runtime.onMessage.addListener((function(e,n,a){return"TabMalUrl"===e.action&&Date.now()-Dt<3e3&&(Mt.info("miniMAL"),t.getMalUrl().then((e=>{const n={url:e,image:t.getImage(),title:t.getTitle()};e||"KITSU"!==Pt.settings.get("syncMode")||(n.url=t.url),a(n)})),!0)})),Ot(),$(window).blur((function(){Dt=Date.now()}))}()}))})()})();
//# sourceMappingURL=kitsu-script.js.map