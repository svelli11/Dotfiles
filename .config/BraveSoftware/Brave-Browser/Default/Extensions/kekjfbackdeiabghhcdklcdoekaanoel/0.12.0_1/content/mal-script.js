/*! For license information please see mal-script.js.LICENSE.txt */
(()=>{var e={50953:(e,t,n)=>{"use strict";n.d(t,{KR:()=>ee,Kh:()=>B});var a=n(90033);let s,i,r=0;function o(){r++}function l(){if(--r>0)return;if(i){let e=i;for(i=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;for(;s;){let t=s;for(s=void 0;t;){const n=t.next;if(t.next=void 0,t.flags&=-9,1&t.flags)try{t.trigger()}catch(t){e||(e=t)}t=n}}if(e)throw e}let c=!0;const h=[];class u{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){o();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{l()}}}const m=new WeakMap,p=Symbol(""),d=Symbol(""),g=Symbol("");function f(e,t,n){0}function y(e,t,n,s,i,r){const c=m.get(e);if(!c)return;const h=e=>{e&&e.trigger()};if(o(),"clear"===t)c.forEach(h);else{const i=(0,a.cy)(e),r=i&&(0,a.yI)(n);if(i&&"length"===n){const e=Number(s);c.forEach(((t,n)=>{("length"===n||n===g||!(0,a.Bm)(n)&&n>=e)&&h(t)}))}else switch((void 0!==n||c.has(void 0))&&h(c.get(n)),r&&h(c.get(g)),t){case"add":i?r&&h(c.get("length")):(h(c.get(p)),(0,a.CE)(e)&&h(c.get(d)));break;case"delete":i||(h(c.get(p)),(0,a.CE)(e)&&h(c.get(d)));break;case"set":(0,a.CE)(e)&&h(c.get(p))}}l()}function _(e){const t=Y(e);return t===e?t:(f(),X(e)?t:t.map(J))}function b(e){return f(e=Y(e)),e}const w={__proto__:null,[Symbol.iterator](){return v(this,Symbol.iterator,J)},concat(...e){return _(this).concat(...e.map((e=>(0,a.cy)(e)?_(e):e)))},entries(){return v(this,"entries",(e=>(e[1]=J(e[1]),e)))},every(e,t){return k(this,"every",e,t,void 0,arguments)},filter(e,t){return k(this,"filter",e,t,(e=>e.map(J)),arguments)},find(e,t){return k(this,"find",e,t,J,arguments)},findIndex(e,t){return k(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return k(this,"findLast",e,t,J,arguments)},findLastIndex(e,t){return k(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return k(this,"forEach",e,t,void 0,arguments)},includes(...e){return T(this,"includes",e)},indexOf(...e){return T(this,"indexOf",e)},join(e){return _(this).join(e)},lastIndexOf(...e){return T(this,"lastIndexOf",e)},map(e,t){return k(this,"map",e,t,void 0,arguments)},pop(){return x(this,"pop")},push(...e){return x(this,"push",e)},reduce(e,...t){return S(this,"reduce",e,t)},reduceRight(e,...t){return S(this,"reduceRight",e,t)},shift(){return x(this,"shift")},some(e,t){return k(this,"some",e,t,void 0,arguments)},splice(...e){return x(this,"splice",e)},toReversed(){return _(this).toReversed()},toSorted(e){return _(this).toSorted(e)},toSpliced(...e){return _(this).toSpliced(...e)},unshift(...e){return x(this,"unshift",e)},values(){return v(this,"values",J)}};function v(e,t,n){const a=b(e),s=a[t]();return a===e||X(e)||(s._next=s.next,s.next=()=>{const e=s._next();return e.value&&(e.value=n(e.value)),e}),s}const E=Array.prototype;function k(e,t,n,a,s,i){const r=b(e),o=r!==e&&!X(e),l=r[t];if(l!==E[t]){const t=l.apply(e,i);return o?J(t):t}let c=n;r!==e&&(o?c=function(t,a){return n.call(this,J(t),a,e)}:n.length>2&&(c=function(t,a){return n.call(this,t,a,e)}));const h=l.call(r,c,a);return o&&s?s(h):h}function S(e,t,n,a){const s=b(e);let i=n;return s!==e&&(X(e)?n.length>3&&(i=function(t,a,s){return n.call(this,t,a,s,e)}):i=function(t,a,s){return n.call(this,t,J(a),s,e)}),s[t](i,...a)}function T(e,t,n){const a=Y(e);f();const s=a[t](...n);return-1!==s&&!1!==s||!function(e){return!!e&&!!e.__v_raw}(n[0])?s:(n[0]=Y(n[0]),a[t](...n))}function x(e,t,n=[]){h.push(c),c=!1,o();const a=Y(e)[t].apply(e,n);return l(),function(){const e=h.pop();c=void 0===e||e}(),a}const I=(0,a.pD)("__proto__,__v_isRef,__isVue"),A=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(a.Bm));function $(e){(0,a.Bm)(e)||(e=String(e));const t=Y(this);return f(),t.hasOwnProperty(e)}class L{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if("__v_skip"===t)return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if("__v_isReactive"===t)return!s;if("__v_isReadonly"===t)return s;if("__v_isShallow"===t)return i;if("__v_raw"===t)return n===(s?i?G:H:i?W:z).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const r=(0,a.cy)(e);if(!s){let e;if(r&&(e=w[t]))return e;if("hasOwnProperty"===t)return $}const o=Reflect.get(e,t,Q(e)?e:n);return((0,a.Bm)(t)?A.has(t):I(t))?o:(s||f(),i?o:Q(o)?r&&(0,a.yI)(t)?o:o.value:(0,a.Gv)(o)?s?K(o):B(o):o)}}class N extends L{constructor(e=!1){super(!1,e)}set(e,t,n,s){let i=e[t];if(!this._isShallow){const t=q(i);if(X(n)||q(n)||(i=Y(i),n=Y(n)),!(0,a.cy)(e)&&Q(i)&&!Q(n))return!t&&(i.value=n,!0)}const r=(0,a.cy)(e)&&(0,a.yI)(t)?Number(t)<e.length:(0,a.$3)(e,t),o=Reflect.set(e,t,n,Q(e)?e:s);return e===Y(s)&&(r?(0,a.$H)(n,i)&&y(e,"set",t,n):y(e,"add",t,n)),o}deleteProperty(e,t){const n=(0,a.$3)(e,t),s=(e[t],Reflect.deleteProperty(e,t));return s&&n&&y(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(0,a.Bm)(t)&&A.has(t)||f(),n}ownKeys(e){return f(0,0,(0,a.cy)(e)),Reflect.ownKeys(e)}}class R extends L{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const P=new N,O=new R,C=e=>e,M=e=>Reflect.getPrototypeOf(e);function D(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function U(e,t){const n=function(e,t){const n={get(n){const s=this.__v_raw,i=Y(s),r=Y(n);e||((0,a.$H)(n,r)&&f(),f());const{has:o}=M(i),l=t?C:e?Z:J;return o.call(i,n)?l(s.get(n)):o.call(i,r)?l(s.get(r)):void(s!==i&&s.get(n))},get size(){const t=this.__v_raw;return!e&&f(Y(t)),Reflect.get(t,"size",t)},has(t){const n=this.__v_raw,s=(Y(n),Y(t));return e||((0,a.$H)(t,s)&&f(),f()),t===s?n.has(t):n.has(t)||n.has(s)},forEach(n,a){const s=this,i=s.__v_raw,r=(Y(i),t?C:e?Z:J);return!e&&f(),i.forEach(((e,t)=>n.call(a,r(e),r(t),s)))}};return(0,a.X$)(n,e?{add:D("add"),set:D("set"),delete:D("delete"),clear:D("clear")}:{add(e){t||X(e)||q(e)||(e=Y(e));const n=Y(this);return M(n).has.call(n,e)||(n.add(e),y(n,"add",e,e)),this},set(e,n){t||X(n)||q(n)||(n=Y(n));const s=Y(this),{has:i,get:r}=M(s);let o=i.call(s,e);o||(e=Y(e),o=i.call(s,e));const l=r.call(s,e);return s.set(e,n),o?(0,a.$H)(n,l)&&y(s,"set",e,n):y(s,"add",e,n),this},delete(e){const t=Y(this),{has:n,get:a}=M(t);let s=n.call(t,e);s||(e=Y(e),s=n.call(t,e)),a&&a.call(t,e);const i=t.delete(e);return s&&y(t,"delete",e,void 0),i},clear(){const e=Y(this),t=0!==e.size,n=e.clear();return t&&y(e,"clear",void 0,void 0),n}}),["keys","values","entries",Symbol.iterator].forEach((s=>{n[s]=function(e,t,n){return function(...s){const i=this.__v_raw,r=Y(i),o=(0,a.CE)(r),l="entries"===e||e===Symbol.iterator&&o,c=i[e](...s),h=n?C:t?Z:J;return!t&&f(),{next(){const{value:e,done:t}=c.next();return t?{value:e,done:t}:{value:l?[h(e[0]),h(e[1])]:h(e),done:t}},[Symbol.iterator](){return this}}}}(s,e,t)})),n}(e,t);return(t,s,i)=>"__v_isReactive"===s?!e:"__v_isReadonly"===s?e:"__v_raw"===s?t:Reflect.get((0,a.$3)(n,s)&&s in t?n:t,s,i)}const F={get:U(!1,!1)},j={get:U(!0,!1)},z=new WeakMap,W=new WeakMap,H=new WeakMap,G=new WeakMap;function B(e){return q(e)?e:V(e,!1,P,F,z)}function K(e){return V(e,!0,O,j,H)}function V(e,t,n,s,i){if(!(0,a.Gv)(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const r=i.get(e);if(r)return r;const o=function(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((0,a.Zf)(e))}(e);if(0===o)return e;const l=new Proxy(e,2===o?s:n);return i.set(e,l),l}function q(e){return!(!e||!e.__v_isReadonly)}function X(e){return!(!e||!e.__v_isShallow)}function Y(e){const t=e&&e.__v_raw;return t?Y(t):e}const J=e=>(0,a.Gv)(e)?B(e):e,Z=e=>(0,a.Gv)(e)?K(e):e;function Q(e){return!!e&&!0===e.__v_isRef}function ee(e){return n=!1,Q(t=e)?t:new te(t,n);var t,n}class te{constructor(e,t){this.dep=new u,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Y(e),this._value=t?e:J(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||X(e)||q(e);e=n?e:Y(e),(0,a.$H)(e,t)&&(this._rawValue=e,this._value=n?e:J(e),this.dep.trigger())}}},90033:(e,t,n)=>{"use strict";function a(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return e=>e in t}n.d(t,{$3:()=>r,$H:()=>b,Bm:()=>c,CE:()=>l,Gv:()=>h,X$:()=>s,Zf:()=>p,cy:()=>o,pD:()=>a,yI:()=>d});const s=Object.assign,i=Object.prototype.hasOwnProperty,r=(e,t)=>i.call(e,t),o=Array.isArray,l=e=>"[object Map]"===m(e),c=e=>"symbol"==typeof e,h=e=>null!==e&&"object"==typeof e,u=Object.prototype.toString,m=e=>u.call(e),p=e=>m(e).slice(8,-1),d=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,g=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},f=/-(\w)/g,y=(g((e=>e.replace(f,((e,t)=>t?t.toUpperCase():"")))),/\B([A-Z])/g),_=(g((e=>e.replace(y,"-$1").toLowerCase())),g((e=>e.charAt(0).toUpperCase()+e.slice(1)))),b=(g((e=>e?`on${_(e)}`:"")),(e,t)=>!Object.is(e,t))},53011:(e,t,n)=>{var a;!function(s){var i=Object.hasOwnProperty,r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o="object"==typeof process&&"function"==typeof process.nextTick,l="function"==typeof Symbol,c="object"==typeof Reflect,h="function"==typeof setImmediate?setImmediate:setTimeout,u=l?c&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function m(){this._events={},this._conf&&p.call(this,this._conf)}function p(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==s&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function d(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var a=new Error(n);a.name="MaxListenersExceededWarning",a.emitter=this,a.count=e,process.emitWarning(a)}else console.error(n),console.trace&&console.trace()}var g=function(e,t,n){var a=arguments.length;switch(a){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var s=new Array(a);a--;)s[a]=arguments[a];return s}};function f(e,t){for(var n={},a=e.length,i=t?value.length:0,r=0;r<a;r++)n[e[r]]=r<i?t[r]:s;return n}function y(e,t,n){var a,s;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(a=n.on,s=n.off),t.addEventListener?(a=t.addEventListener,s=t.removeEventListener):t.addListener?(a=t.addListener,s=t.removeListener):t.on&&(a=t.on,s=t.off),!a&&!s)throw Error("target does not implement any known event API");if("function"!=typeof a)throw TypeError("on method must be a function");if("function"!=typeof s)throw TypeError("off method must be a function");this._on=a,this._off=s;var i=e._observers;i?i.push(this):e._observers=[this]}function _(e,t,n,a){var r=Object.assign({},t);if(!e)return r;if("object"!=typeof e)throw TypeError("options must be an object");var o,l,c,h=Object.keys(e),u=h.length;function m(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<u;p++){if(o=h[p],!a&&!i.call(t,o))throw Error('Unknown "'+o+'" option');(l=e[o])!==s&&(c=n[o],r[o]=c?c(l,m):l)}return r}function b(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function w(e){var t="value must be type of "+e.join("|"),n=e.length,a=e[0],s=e[1];return 1===n?function(e,n){if(typeof e===a)return e;n(t)}:2===n?function(e,n){var i=typeof e;if(i===a||i===s)return e;n(t)}:function(a,s){for(var i=typeof a,r=n;r-- >0;)if(i===e[r])return a;s(t)}}Object.assign(y.prototype,{subscribe:function(e,t,n){var a=this,s=this._target,i=this._emitter,r=this._listeners,o=function(){var a=g.apply(null,arguments),r={data:a,name:t,original:e};n?!1!==n.call(s,r)&&i.emit.apply(i,[r.name].concat(a)):i.emit.apply(i,[t].concat(a))};if(r[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,i._newListener&&i._removeListener&&!a._onNewListener?(this._onNewListener=function(n){n===t&&null===r[e]&&(r[e]=o,a._on.call(s,e,o))},i.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!i.hasListeners(n)&&r[e]&&(r[e]=null,a._off.call(s,e,o))},r[e]=null,i.on("removeListener",this._onRemoveListener)):(r[e]=o,a._on.call(s,e,o))},unsubscribe:function(e){var t,n,a,s=this,i=this._listeners,r=this._emitter,o=this._off,l=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function c(){s._onNewListener&&(r.off("newListener",s._onNewListener),r.off("removeListener",s._onRemoveListener),s._onNewListener=null,s._onRemoveListener=null);var e=S.call(r,s);r._observers.splice(e,1)}if(e){if(!(t=i[e]))return;o.call(l,e,t),delete i[e],--this._listenersCount||c()}else{for(a=(n=u(i)).length;a-- >0;)e=n[a],o.call(l,e,i[e]);this._listeners={},this._listenersCount=0,c()}}});var v=w(["function"]),E=w(["object","function"]);function k(e,t,n){var a,s,i,r=0,o=new e((function(l,c,h){function u(){s&&(s=null),r&&(clearTimeout(r),r=0)}n=_(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),a=!n.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof h;var m=function(e){u(),l(e)},p=function(e){u(),c(e)};a?t(m,p,h):(s=[function(e){p(e||Error("canceled"))}],t(m,p,(function(e){if(i)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");s.push(e)})),i=!0),n.timeout>0&&(r=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",r=0,o.cancel(e),c(e)}),n.timeout))}));return a||(o.cancel=function(e){if(s){for(var t=s.length,n=1;n<t;n++)s[n](e);s[0](e),s=null}}),o}function S(e){var t=this._observers;if(!t)return-1;for(var n=t.length,a=0;a<n;a++)if(t[a]._target===e)return a;return-1}function T(e,t,n,a,s){if(!n)return null;if(0===a){var i=typeof t;if("string"===i){var r,o,l=0,c=0,h=this.delimiter,m=h.length;if(-1!==(o=t.indexOf(h))){r=new Array(5);do{r[l++]=t.slice(c,o),c=o+m}while(-1!==(o=t.indexOf(h,c)));r[l++]=t.slice(c),t=r,s=l}else t=[t],s=1}else"object"===i?s=t.length:(t=[t],s=1)}var p,d,g,f,y,_,b,w=null,v=t[a],E=t[a+1];if(a===s)n._listeners&&("function"==typeof n._listeners?(e&&e.push(n._listeners),w=[n]):(e&&e.push.apply(e,n._listeners),w=[n]));else{if("*"===v){for(o=(_=u(n)).length;o-- >0;)"_listeners"!==(p=_[o])&&(b=T(e,t,n[p],a+1,s))&&(w?w.push.apply(w,b):w=b);return w}if("**"===v){for((y=a+1===s||a+2===s&&"*"===E)&&n._listeners&&(w=T(e,t,n,s,s)),o=(_=u(n)).length;o-- >0;)"_listeners"!==(p=_[o])&&("*"===p||"**"===p?(n[p]._listeners&&!y&&(b=T(e,t,n[p],s,s))&&(w?w.push.apply(w,b):w=b),b=T(e,t,n[p],a,s)):b=T(e,t,n[p],p===E?a+2:a,s),b&&(w?w.push.apply(w,b):w=b));return w}n[v]&&(w=T(e,t,n[v],a+1,s))}if((d=n["*"])&&T(e,t,d,a+1,s),g=n["**"])if(a<s)for(g._listeners&&T(e,t,g,s,s),o=(_=u(g)).length;o-- >0;)"_listeners"!==(p=_[o])&&(p===E?T(e,t,g[p],a+2,s):p===v?T(e,t,g[p],a+1,s):((f={})[p]=g[p],T(e,t,{"**":f},a+1,s)));else g._listeners?T(e,t,g,s,s):g["*"]&&g["*"]._listeners&&T(e,t,g["*"],s,s);return w}function x(e,t,n){var a,s,i=0,r=0,o=this.delimiter,l=o.length;if("string"==typeof e)if(-1!==(a=e.indexOf(o))){s=new Array(5);do{s[i++]=e.slice(r,a),r=a+l}while(-1!==(a=e.indexOf(o,r)));s[i++]=e.slice(r)}else s=[e],i=1;else s=e,i=e.length;if(i>1)for(a=0;a+1<i;a++)if("**"===s[a]&&"**"===s[a+1])return;var c,h=this.listenerTree;for(a=0;a<i;a++)if(h=h[c=s[a]]||(h[c]={}),a===i-1)return h._listeners?("function"==typeof h._listeners&&(h._listeners=[h._listeners]),n?h._listeners.unshift(t):h._listeners.push(t),!h._listeners.warned&&this._maxListeners>0&&h._listeners.length>this._maxListeners&&(h._listeners.warned=!0,d.call(this,h._listeners.length,c))):h._listeners=t,!0;return!0}function I(e,t,n,a){for(var s,i,r,o,l=u(e),c=l.length,h=e._listeners;c-- >0;)s=e[i=l[c]],r="_listeners"===i?n:n?n.concat(i):[i],o=a||"symbol"==typeof i,h&&t.push(o?r:r.join(this.delimiter)),"object"==typeof s&&I.call(this,s,t,r,o);return t}function A(e){for(var t,n,a,s=u(e),i=s.length;i-- >0;)(t=e[n=s[i]])&&(a=!0,"_listeners"===n||A(t)||delete e[n]);return a}function $(e,t,n){this.emitter=e,this.event=t,this.listener=n}function L(e,t,n){if(!0===n)i=!0;else if(!1===n)a=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var a=n.async,i=n.promisify,r=n.nextTick,l=n.objectify}if(a||r||i){var c=t,u=t._origin||t;if(r&&!o)throw Error("process.nextTick is not supported");i===s&&(i="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,n=this.event;return i?r?Promise.resolve():new Promise((function(e){h(e)})).then((function(){return t.event=n,c.apply(t,e)})):(r?process.nextTick:h)((function(){t.event=n,c.apply(t,e)}))},t._async=!0,t._origin=u}return[t,l?new $(this,e,t):this]}function N(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,p.call(this,e)}$.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},N.EventEmitter2=N,N.prototype.listenTo=function(e,t,n){if("object"!=typeof e)throw TypeError("target musts be an object");var a=this;function i(t){if("object"!=typeof t)throw TypeError("events must be an object");var s,i=n.reducers,r=S.call(a,e);s=-1===r?new y(a,e,n):a._observers[r];for(var o,l=u(t),c=l.length,h="function"==typeof i,m=0;m<c;m++)o=l[m],s.subscribe(o,t[o]||o,h?i:i&&i[o])}return n=_(n,{on:s,off:s,reducers:s},{on:v,off:v,reducers:E}),r(t)?i(f(t)):i("string"==typeof t?f(t.split(/\s+/)):t),this},N.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var a,s=n.length,i=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;s-- >0;)a=n[s],e&&a._target!==e||(a.unsubscribe(t),i=!0);return i},N.prototype.delimiter=".",N.prototype.setMaxListeners=function(e){e!==s&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},N.prototype.getMaxListeners=function(){return this._maxListeners},N.prototype.event="",N.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},N.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},N.prototype._once=function(e,t,n,a){return this._many(e,1,t,n,a)},N.prototype.many=function(e,t,n,a){return this._many(e,t,n,!1,a)},N.prototype.prependMany=function(e,t,n,a){return this._many(e,t,n,!0,a)},N.prototype._many=function(e,t,n,a,s){var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function r(){return 0==--t&&i.off(e,r),n.apply(this,arguments)}return r._origin=n,this._on(e,r,a,s)},N.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||m.call(this);var e,t,n,a,s,i,r=arguments[0],o=this.wildcard;if("newListener"===r&&!this._newListener&&!this._events.newListener)return!1;if(o&&(e=r,"newListener"!==r&&"removeListener"!==r&&"object"==typeof r)){if(n=r.length,l)for(a=0;a<n;a++)if("symbol"==typeof r[a]){i=!0;break}i||(r=r.join(this.delimiter))}var c,h=arguments.length;if(this._all&&this._all.length)for(a=0,n=(c=this._all.slice()).length;a<n;a++)switch(this.event=r,h){case 1:c[a].call(this,r);break;case 2:c[a].call(this,r,arguments[1]);break;case 3:c[a].call(this,r,arguments[1],arguments[2]);break;default:c[a].apply(this,arguments)}if(o)c=[],T.call(this,c,e,this.listenerTree,0,n);else{if("function"==typeof(c=this._events[r])){switch(this.event=r,h){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(h-1),s=1;s<h;s++)t[s-1]=arguments[s];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(h>3)for(t=new Array(h-1),s=1;s<h;s++)t[s-1]=arguments[s];for(a=0,n=c.length;a<n;a++)switch(this.event=r,h){case 1:c[a].call(this);break;case 2:c[a].call(this,arguments[1]);break;case 3:c[a].call(this,arguments[1],arguments[2]);break;default:c[a].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===r)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},N.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||m.call(this);var e,t,n,a,s,i,r=arguments[0],o=this.wildcard;if("newListener"===r&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(e=r,"newListener"!==r&&"removeListener"!==r&&"object"==typeof r)){if(a=r.length,l)for(s=0;s<a;s++)if("symbol"==typeof r[s]){t=!0;break}t||(r=r.join(this.delimiter))}var c,h=[],u=arguments.length;if(this._all)for(s=0,a=this._all.length;s<a;s++)switch(this.event=r,u){case 1:h.push(this._all[s].call(this,r));break;case 2:h.push(this._all[s].call(this,r,arguments[1]));break;case 3:h.push(this._all[s].call(this,r,arguments[1],arguments[2]));break;default:h.push(this._all[s].apply(this,arguments))}if(o?(c=[],T.call(this,c,e,this.listenerTree,0)):c=this._events[r],"function"==typeof c)switch(this.event=r,u){case 1:h.push(c.call(this));break;case 2:h.push(c.call(this,arguments[1]));break;case 3:h.push(c.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(u-1),i=1;i<u;i++)n[i-1]=arguments[i];h.push(c.apply(this,n))}else if(c&&c.length){if(c=c.slice(),u>3)for(n=new Array(u-1),i=1;i<u;i++)n[i-1]=arguments[i];for(s=0,a=c.length;s<a;s++)switch(this.event=r,u){case 1:h.push(c[s].call(this));break;case 2:h.push(c[s].call(this,arguments[1]));break;case 3:h.push(c[s].call(this,arguments[1],arguments[2]));break;default:h.push(c[s].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===r)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(h)},N.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},N.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},N.prototype.onAny=function(e){return this._onAny(e,!1)},N.prototype.prependAny=function(e){return this._onAny(e,!0)},N.prototype.addListener=N.prototype.on,N.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},N.prototype._on=function(e,t,n,a){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");this._events||m.call(this);var i,r=this;return a!==s&&(t=(i=L.call(this,e,t,a))[0],r=i[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(x.call(this,e,t,n),r):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,d.call(this,this._events[e].length,e))):this._events[e]=t,r)},N.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,a=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();if(!(a=T.call(this,null,s,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],a.push({_listeners:n})}for(var i=0;i<a.length;i++){var o=a[i];if(n=o._listeners,r(n)){for(var l=-1,c=0,h=n.length;c<h;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){l=c;break}if(l<0)continue;return this.wildcard?o._listeners.splice(l,1):this._events[e].splice(l,1),0===n.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&A(this.listenerTree),this},N.prototype.offAny=function(e){var t,n=0,a=0;if(e&&this._all&&this._all.length>0){for(n=0,a=(t=this._all).length;n<a;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,a=t.length;n<a;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},N.prototype.removeListener=N.prototype.off,N.prototype.removeAllListeners=function(e){if(e===s)return!this._events||m.call(this),this;if(this.wildcard){var t,n=T.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&A(this.listenerTree)}else this._events&&(this._events[e]=null);return this},N.prototype.listeners=function(e){var t,n,a,i,r,o=this._events;if(e===s){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(i=(t=u(o)).length,a=[];i-- >0;)"function"==typeof(n=o[t[i]])?a.push(n):a.push.apply(a,n);return a}if(this.wildcard){if(!(r=this.listenerTree))return[];var l=[],c="string"==typeof e?e.split(this.delimiter):e.slice();return T.call(this,l,c,r,0),l}return o&&(n=o[e])?"function"==typeof n?[n]:n:[]},N.prototype.eventNames=function(e){var t=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,e):t?u(t):[]},N.prototype.listenerCount=function(e){return this.listeners(e).length},N.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return T.call(this,t,n,this.listenerTree,0),t.length>0}var a=this._events,i=this._all;return!!(i&&i.length||a&&(e===s?u(a).length:a[e]))},N.prototype.listenersAny=function(){return this._all?this._all:[]},N.prototype.waitFor=function(e,t){var n=this,a=typeof t;return"number"===a?t={timeout:t}:"function"===a&&(t={filter:t}),k((t=_(t,{timeout:0,filter:s,handleError:!1,Promise,overload:!1},{filter:v,Promise:b})).Promise,(function(a,s,i){function r(){var i=t.filter;if(!i||i.apply(n,arguments))if(n.off(e,r),t.handleError){var o=arguments[0];o?s(o):a(g.apply(null,arguments).slice(1))}else a(g.apply(null,arguments))}i((function(){n.off(e,r)})),n._on(e,r,!1)}),{timeout:t.timeout,overload:t.overload})};var R=N.prototype;Object.defineProperties(N,{defaultMaxListeners:{get:function(){return R._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");R._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return k((n=_(n,{Promise,timeout:0,overload:!1},{Promise:b})).Promise,(function(n,a,s){var i;if("function"==typeof e.addEventListener)return i=function(){n(g.apply(null,arguments))},s((function(){e.removeEventListener(t,i)})),void e.addEventListener(t,i,{once:!0});var r,o=function(){r&&e.removeListener("error",r),n(g.apply(null,arguments))};"error"!==t&&(r=function(n){e.removeListener(t,o),a(n)},e.once("error",r)),s((function(){r&&e.removeListener("error",r),e.removeListener(t,o)})),e.once(t,o)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(R,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(a=function(){return N}.call(t,n,t,e))===s||(e.exports=a)}()},53908:(e,t,n)=>{const a=n(57272),{MAX_LENGTH:s,MAX_SAFE_INTEGER:i}=n(16874),{safeRe:r,safeSrc:o,t:l}=n(99718),c=n(98587),{compareIdentifiers:h}=n(61123);class u{constructor(e,t){if(t=c(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>s)throw new TypeError(`version is longer than ${s} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?r[l.LOOSE]:r[l.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),h(this.major,e.major)||h(this.minor,e.minor)||h(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],s=e.prerelease[t];if(a("prerelease compare",t,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return-1;if(n!==s)return h(n,s)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const n=this.build[t],s=e.build[t];if(a("build compare",t,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return-1;if(n!==s)return h(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=new RegExp(`^${this.options.loose?o[l.PRERELEASELOOSE]:o[l.PRERELEASE]}$`),n=`-${t}`.match(e);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===n&&(a=[t]),0===h(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},50560:(e,t,n)=>{const a=n(53908);e.exports=(e,t,n)=>new a(e,n).compare(new a(t,n))},35580:(e,t,n)=>{const a=n(50560);e.exports=(e,t,n)=>a(e,t,n)>0},54089:(e,t,n)=>{const a=n(50560);e.exports=(e,t,n)=>a(e,t,n)>=0},16874:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},57272:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},61123:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const a=t.test(e),s=t.test(n);return a&&s&&(e=+e,n=+n),e===n?0:a&&!s?-1:s&&!a?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},98587:e=>{const t=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:n},99718:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=n(16874),r=n(57272),o=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],h=t.safeSrc=[],u=t.t={};let m=0;const p="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",i],[p,s]],g=(e,t,n)=>{const a=(e=>{for(const[t,n]of d)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),s=m++;r(e,s,t),u[e]=s,c[s]=t,h[s]=a,o[s]=new RegExp(t,n?"g":void 0),l[s]=new RegExp(a,n?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),g("FULL",`^${c[u.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),g("LOOSE",`^${c[u.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),g("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),g("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",c[u.COERCE],!0),g("COERCERTLFULL",c[u.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},13647:(e,t,n)=>{"use strict";n.r(t),n.d(t,{request:()=>f,settings:()=>y,storage:()=>g,type:()=>_});var a=n(13647),s=n(78584),i=n(26017);const r={async set(e,t){const n={};return n[e]=t,new Promise(((t,a)=>{o(e).set(n,(function(){chrome.runtime.lastError?a(chrome.runtime.lastError):t()}))}))},get:async e=>new Promise(((t,n)=>{o(e).get(e,(function(a){chrome.runtime.lastError?n(chrome.runtime.lastError):t(a[e])}))})),remove:async e=>new Promise(((t,n)=>{o(e).remove(e,(function(){chrome.runtime.lastError?n(chrome.runtime.lastError):t()}))})),list:async(e="local")=>new Promise(((t,n)=>{"local"===e?chrome.storage.local.get(null,(function(e){t(e)})):chrome.storage.sync.get(null,(function(e){t(e)}))})),async addStyle(e){try{const t=document.createElement("style");t.textContent=e,(document.head||document.body||document.documentElement||document).appendChild(t)}catch(e){console.log(`Could not add css:${e}`)}},version:()=>chrome.runtime.getManifest().version,lang(e,t){if(a.settings.get("forceEn")&&"undefined"!=typeof i18n){let n=i18n[e];if(void 0!==t)for(let e=0;e<t.length;e++)n=n.replace(`$${e+1}`,t[e]);return n}return chrome.i18n.getMessage(e,t)},langDirection(){try{const e=chrome.i18n.getUILanguage();if(/^(ar)(-|$)/i.test(e)&&!a.settings.get("forceEn"))return"rtl"}catch(e){s.error(e)}return"ltr"},assetUrl:e=>chrome.runtime.getURL(`assets/${e}`),injectCssResource(e,t){alert("injectCssResource not supported in webextension")},injectjsResource(e,t){const n=document.createElement("script");n.src=chrome.runtime.getURL(`vendor/${e}`),n.onload=function(){this.remove()},t.get(0).appendChild(n)},addProxyScriptToTag:(e,t)=>(e.src=chrome.runtime.getURL(`/content/proxy/proxy_${t}.js`),e),updateDom(e){const t=document.createElement("script");t.text="\n        document.getElementsByTagName('head')[0].onclick = function(e){\n          try{\n            componentHandler.upgradeDom();\n          }catch(e){\n            console.log(e);\n            setTimeout(function(){\n              componentHandler.upgradeDom();\n            },500);\n          }\n        }",t.onload=function(){this.remove()},e.get(0).appendChild(t)},storageOnChanged(e){chrome.storage.onChanged.addListener(e)}};function o(e){return i.syncRegex.test(e)?chrome.storage.sync:chrome.storage.local}const l={async xhr(e,t){if(void 0!==l.sendMessage)return l.sendMessage({name:"xhr",method:e,url:t}).then((e=>{if(429===e.status)throw"Rate limit Timeout";if(0===e.status)throw e.responseText;return e}));throw"Could not send xhr"},sendMessage:async e=>new Promise(((t,n)=>{chrome.runtime.sendMessage(e,(function(e){t(e)}))})),notification(e){this.sendMessage({name:"notification",options:e})},database(e,t){return this.sendMessage({name:"database",options:{call:e,param:t}})}};var c=n(50953),h=n(40111),u=n(13647),m=n(78584),p=n(26017);const d={options:(0,c.Kh)({autoTrackingModeanime:"video",readerTracking:!0,askBefore:!0,autoTrackingModemanga:"instant",enablePages:{},forceEn:!1,forceEnglishTitles:!1,rpc:!0,presenceLargeImage:"cover",presenceShowButtons:!0,presenceShowMalsync:!1,userscriptModeButton:!1,syncMode:"MAL",syncModeSimkl:"MAL",localSync:!0,delay:0,videoDuration:85,malTags:!1,malContinue:!0,malResume:!0,usedPage:!0,epPredictions:!0,mangaCompletionPercentage:90,theme:"auto",themeSidebars:!0,themeColor:"#000000",themeOpacity:100,themeImage:"",minimalWindow:!1,posLeft:"left",miniMALonMal:!1,floatButtonStealth:!1,minimizeBigPopup:!1,floatButtonCorrection:!0,floatButtonHide:!1,autoCloseMinimal:!1,outWay:!0,miniMalWidth:"550px",miniMalHeight:"90%",malThumbnail:100,friendScore:!0,loadPTWForProgress:!1,quicklinks:["Crunchyroll","Gogoanime","Mangadex","MangaNato","MangaFox","MangaSee","MangaFire","HiAnime","Hulu","Netflix","Hidive","VIZ","MangaPlus","MangaReader","ComicK","WeebCentral","KickAssAnime","animepahe"],quicklinksPosition:"default",autofull:!1,autoresume:!1,autoNextEp:!1,highlightAllEp:!1,checkForFiller:!0,crashReport:!0,introSkip:85,introSkipFwd:[17,39],introSkipBwd:[17,37],nextEpShort:[],correctionShort:[67],syncShort:[],progressInterval:120,progressIntervalDefaultAnime:"en/sub",progressIntervalDefaultManga:"en/sub",progressNotificationsAnime:!0,progressNotificationsManga:!0,notificationsSticky:!0,bookMarksList:!1,bookMarksListManga:!1,customDomains:[],anilistUpdateUi:!0,anilistToken:"",anilistOptions:{displayAdultContent:!0,scoreFormat:"POINT_10"},kitsuToken:"",kitsuOptions:{titleLanguagePreference:"canonical",sfwFilter:!1,ratingSystem:"regular"},simklToken:"",malToken:"",malRefresh:"",shikiToken:"",shikiOptions:{locale:"ru"}}),debounceArray:{},chibiList:{},isInit:(0,c.KR)(!1),async init(){const e=[];for(const t in this.options){const n=await u.storage.get(`settings/${t}`);void 0!==n&&(this.options[t]=n,e[t]=/(token|refresh)/i.test(t)&&n?"********":n)}try{const e=await h.I.getInstance(!0).init();this.chibiList=e.getList()}catch(e){m.error("Error loading chibi repo",e)}let t;return m.log("Settings",e),u.storage.storageOnChanged(((e,n)=>{if("sync"===n)for(const t in e){const n=e[t];/^settings\//i.test(t)&&(this.options[t.replace("settings/","")]=n.newValue,m.info(`Update ${t} option to ${JSON.stringify(n.newValue,null,2)}`))}if("local"===n&&e.rateLimit)try{clearTimeout(t),e.rateLimit.newValue?(m.log("Rate limited"),$(".type-rate").length||p.flashm("Rate limited. Retrying in a moment",{error:!0,type:"rate",permanent:!0})):t=setTimeout((()=>{m.log("No Rate limited"),$(".type-rate").remove()}),5e3)}catch(e){m.error(e)}})),this.isInit.value=!0,this},get(e){if(!this.isInit.value)throw"Settings not initialized";return this.options[e]},set(e,t){if(!Object.prototype.hasOwnProperty.call(this.options,e)){const t=Error(`${e} is not a defined option`);throw m.error(t),t}return this.options[e]=t,u.storage.set(`settings/${e}`,t)},setDebounce(e,t){this.options[e]=t,clearTimeout(this.debounceArray[e]),this.debounceArray[e]=setTimeout((()=>{this.set(e,t),delete this.debounceArray[e]}),1e3)},async getAsync(e){const t=await u.storage.get(`settings/${e}`);return void 0===t&&void 0!==this.options[e]?this.options[e]:t},getStaticChibi(){if(!this.isInit.value)throw"Settings not initialized";return this.chibiList}},g=r,f=l,y=d,_="webextension"},40111:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});var a=n(96789),s=n(13647);class i{static getInstance(e=!1){let t;return t="userscript"===s.type?["https://chibi.malsync.moe/config"]:[chrome.runtime.getURL("chibi"),"https://chibi.malsync.moe/config"],new i(t,e)}constructor(e,t=!1){this.pages=null,this.collections=e,this.useCache=t}async init(){const e=`chibiPages-${s.storage.version()}`,t=await s.storage.get(e)||{chibiPages:{},errors:{}};if(this.useCache&&t.chibiPages&&Object.keys(t.chibiPages).length>0)return this.pages=t.chibiPages,this;const n={},i=(await Promise.all(this.collections.map((e=>this.retrieveCollection(e).catch((t=>(n[e]=t,null))))))).filter((e=>e));return t.errors=n,i.forEach((e=>{Object.keys(e.pages).forEach((n=>{if(e.pages[n].minimumVersion&&(0,a.GT)(e.pages[n].minimumVersion))return;const s=t.chibiPages[n]&&t.chibiPages[n].version.hash!==e.pages[n].version.hash&&Number(t.chibiPages[n].version.timestamp)<Number(e.pages[n].version.timestamp);t.chibiPages[n]&&!s||(t.chibiPages[n]=e.pages[n])}))})),await s.storage.set(e,t),this.pages=t.chibiPages,this}async retrieveCollection(e){const t=await s.request.xhr("GET",`${e}/list.json`),n=JSON.parse(t.responseText);return Object.keys(n.pages).forEach((t=>{n.pages[t].root=e})),n}getList(){if(!this.pages)throw new Error("Pages not loaded");return this.pages}async getPage(e){if(!this.pages)throw new Error("Pages not loaded");const t=this.pages[e];if(!t)throw new Error(`Page ${e} not found`);const n=await s.request.xhr("GET",`${t.root}/pages/${e}.json?version=${t.version.hash}`);return JSON.parse(n.responseText)}getPermissions(){const e=this.getList();return Object.values(e).map((e=>e.urls.match.map((t=>({page:`${e.name} (chibi)`,domain:t,auto:!0,chibi:!0}))))).flat()}getPermissionsElements(){const e=this.getList();return Object.values(e).map((e=>({name:`${e.name} (chibi)`,match:e.urls.match})))}}},78584:(e,t,n)=>{"use strict";n.r(t),n.d(t,{debug:()=>r,error:()=>s,info:()=>i,log:()=>a,m:()=>o});const a=Function.prototype.bind.call(console.log,console,"%cMAL-Sync","background-color: #2e51a2; color: white; padding: 2px 10px; border-radius: 3px;"),s=Function.prototype.bind.call(console.error,console,"%cMAL-Sync","background-color: #8f0000; color: white; padding: 2px 10px; border-radius: 3px;"),i=Function.prototype.bind.call(console.info,console,"%cMAL-Sync","background-color: wheat; color: black; padding: 2px 10px; border-radius: 3px;"),r=Function.prototype.bind.call(console.debug,console,"%cMAL-Sync","background-color: steelblue; color: black; padding: 2px 10px; border-radius: 3px;"),o=(e,t="",n=[])=>{let a="white";t||(t=function(e){if(!e)return"#ffffff";e=String(e);let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);let n="#";for(let e=0;e<3;e++)n+=`00${(t>>8*e&255).toString(16)}`.substr(-2);return n}(e)),"#"===t[0]&&(a=parseInt(t.replace("#",""),16)>8388607.5?"#000":"#fff");const s=`background-color: ${t}; color: ${a}; padding: 2px 10px; border-radius: 3px; margin-left: -5px; border-left: 1px solid white;`;n.push({name:e,style:s});const i={m:(e,t="")=>o(e,t,[...n])},r=n.reduce(((e,t)=>`${e}%c${t.name}`),""),l=n.map((e=>e.style));return i.log=Function.prototype.bind.call(console.log,console,`%cM ${r}`,"background-color: #2e51a2; color: white; padding: 2px 10px; border-radius: 3px;",...l),i.error=Function.prototype.bind.call(console.error,console,`%cM ${r}`,"background-color: #8f0000; color: white; padding: 2px 10px; border-radius: 3px;",...l),i.info=Function.prototype.bind.call(console.info,console,`%cM ${r}`,"background-color: wheat; color: black; padding: 2px 10px; border-radius: 3px;",...l),i.debug=Function.prototype.bind.call(console.debug,console,`%cM ${r}`,"background-color: steelblue; color: black; padding: 2px 10px; border-radius: 3px;",...l),i}},26017:(e,t,n)=>{"use strict";n.r(t),n.d(t,{absoluteLink:()=>b,canHideTabs:()=>j,changeDetect:()=>k,checkDoubleExecution:()=>I,clearCache:()=>ae,elementInViewport:()=>Y,episode:()=>d,favicon:()=>u,flashConfirm:()=>K,flashm:()=>B,fullUrlChangeDetect:()=>E,getAsyncWaitUntilTrue:()=>T,getBaseText:()=>h,getContinueWaching:()=>O,getEntrySettings:()=>M,getResumeWaching:()=>R,getStatusText:()=>W,getTooltip:()=>U,getUrlFromTags:()=>A,getselect:()=>_,handleMalImages:()=>D,htmlDecode:()=>ee,isDomainMatching:()=>ie,isFirefox:()=>te,lazyload:()=>X,notifications:()=>H,pageUrl:()=>Z,parseHtml:()=>w,planTo:()=>p,rateLimitExclude:()=>f,returnYYYYMMDD:()=>Q,setContinueWaching:()=>P,setEntrySettings:()=>C,setResumeWaching:()=>N,setUrlInTags:()=>L,sortAlphabetically:()=>se,status:()=>y,statusTag:()=>z,syncRegex:()=>g,timeCache:()=>G,timeDiffToText:()=>F,upperCaseFirstLetter:()=>re,urlChangeDetect:()=>v,urlParam:()=>c,urlPart:()=>o,urlStrip:()=>l,wait:()=>J,waitForPageToBeVisible:()=>ne,waitUntilTrue:()=>S,watching:()=>m});var a=n(7263),s=n(13647),i=n(78584),r=n(26017);function o(e,t){if(!e)return"";const n=e.split("/");return n[t]?n[t].replace(/[#?].*/,""):""}function l(e){return e.replace(/[#?].*/,"")}function c(e,t){const n=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===n?null:decodeURI(n[1])||0}function h(e){let t=e.text();return e.children().each((function(){t=t.replace(a.$(this).text(),"")})),t}function u(e){if(!e)return"";const t=e.match(/^(https?:\/\/)?[^/]+/);return t&&(e=t[0]),`https://favicon.malsync.moe/?domain=${e}`}function m(e){return"manga"===e?"Reading":"Watching"}function p(e){return"manga"===e?"Plan to Read":"Plan to Watch"}function d(e){return"manga"===e?s.storage.lang("UI_Chapter"):s.storage.lang("UI_Episode")}const g=/(^settings\/.*|^updateCheckTime$|^tempVersion$|^local:\/\/|^list-tagSettings$)/,f=/^https:\/\/api.malsync.moe\/(shark|mal\/|nc\/mal\/.*\/progress$)/i;var y;function _(e,t){let n=e.split(`name="${t}"`)[1].split("</select>")[0];if(n.indexOf('selected="selected"')>-1){n=n.split("<option");for(let e=0;e<n.length;++e)if(n[e].indexOf('selected="selected"')>-1)return n[e].split('value="')[1].split('"')[0]}return""}function b(e,t){return void 0===e||e.startsWith("http")||("/"!==e.charAt(0)&&(e=`/${e}`),e=t+e),e}function w(e){return(new DOMParser).parseFromString(`<!doctype html><body>${e}`,"text/html").body.textContent}function v(e){let t=window.location.href;return setInterval((function(){t!==window.location.href&&(t=window.location.href,e())}),100)}function E(e,t=!1){let n="";const a=setInterval((function(){const a=t?l(window.location.href):window.location.href;n!==a&&(n=a,e())}),100);return Number(a)}function k(e,t,n=!1){let a=t();const s=setInterval((function(){const n=t();void 0!==n&&a!==n&&(a=t(),e())}),500);return n&&e(),Number(s)}function S(e,t,n=100){let a=0;const s=setInterval((function(){a++;let r=!1;try{r=e()}catch(e){i.info("Error in waitUntilTrue",e)}if(r&&(clearInterval(s),t()),a>10){clearInterval(s);const a=Math.max(Math.min(2*n,15e3),500);S(e,t,a)}}),n);return s}function T(e,t=100){let n,a;const s=()=>{clearTimeout(n),a&&a("AsyncWait stopped")};return{asyncWaitUntilTrue:()=>(s(),new Promise(((s,i)=>{a=i,n=S(e,(()=>s()),t)}))),reset:s}}!function(e){e[e.watching=1]="watching",e[e.completed=2]="completed",e[e.onhold=3]="onhold",e[e.dropped=4]="dropped",e[e.planToWatch=6]="planToWatch"}(y||(y={}));const x=Math.random();function I(){$(".mal-sync-double-detect").length&&$(".mal-sync-double-detect").each((function(e){$(this).text()!==x.toString()&&alert("Double execution detected! Please run MAL-Sync once only.")})),$("body").after(a.html(`<div class="mal-sync-double-detect" style="display: none;">${x.toString()}</div>`))}function A(e){return/malSync::[\d\D]+::/.test(e)?t(e.split("malSync::")[1].split("::")[0]):/last::[\d\D]+::/.test(e)?t(e.split("last::")[1].split("::")[0]):void 0;function t(e){try{return atob(e)}catch(t){return e}}}function L(e,t){if(""===e)return t.replace(/,?(malSync|last)::[^ \n]+?::/,"");if(!s.settings.get("malTags"))return t;const n=`malSync::${btoa(e)}::`;return/(last|malSync)::[\d\D]+::/.test(t)?t.replace(/(last|malSync)::[^^]*?::/,n):`${t},${n}`}async function N(e,t,n,a){return s.storage.set(`resume/${n}/${a}`,{url:e,ep:t})}async function R(e,t){if(s.settings.get("malResume"))return s.storage.get(`resume/${e}/${t}`)}async function P(e,t,n,a){return s.storage.set(`continue/${n}/${a}`,{url:e,ep:t})}async function O(e,t){if(s.settings.get("malContinue"))return s.storage.get(`continue/${e}/${t}`)}async function C(e,t,n,a=""){const i={};if(n){for(const e in n)switch(e){case"u":case"p":i[e]=n[e]}s.settings.get("malTags")?a=L(JSON.stringify(i),a):await s.storage.set(`tagSettings/${e}/${t}`,JSON.stringify(i))}return Object.values(i).find((e=>Boolean(e)))||(a=L("",a),s.settings.get("malTags")||await s.storage.remove(`tagSettings/${e}/${t}`)),a}async function M(e,t,n=""){const a={u:null,c:null,r:null,p:""};if(s.settings.get("malTags")){const e=A(n);if(e)if("{"===e[0])try{const t=JSON.parse(e);for(const e in a)t[e]&&(a[e]=t[e])}catch(e){i.error(e)}else a.u=e}else{let n=await s.storage.get(`tagSettings/${e}/${t}`);if(n){n=JSON.parse(n);for(const e in a)n[e]&&(a[e]=n[e])}}const r=await O(e,t);r&&(a.c=r);const o=await R(e,t);return o&&(a.r=o),s.settings.get("usedPage")||(a.u=null),a}function D(e){return-1!==e.indexOf("questionmark")?s.storage.assetUrl("questionmark.gif"):e}function U(e,t="",n="top"){const a=Math.floor(1e3*Math.random()+1);return`<div id="tt${a}" class="icon material-icons" style="font-size:16px; line-height: 0; color: #7f7f7f; padding-bottom: 20px; padding-left: 3px; ${t}">contact_support</div>  <div class="mdl-tooltip mdl-tooltip--${n} mdl-tooltip--large" for="tt${a}">${e}</div>`}function F(e){let t="";e/=1e3;const n=Math.floor(e/31536e3);e-=31536e3*n,n&&(t+=`${n}y `);const a=Math.floor(e/86400);e-=86400*a,a&&(t+=`${a}d `);const s=Math.floor(e/3600)%24;e-=3600*s,s&&a<2&&(t+=`${s}h `);const i=Math.floor(e/60)%60;return e-=60*i,i&&!a&&s<3&&(t+=`${i}min `),t}function j(){return"undefined"!=typeof browser&&void 0!==browser.tabs.hide}function z(e,t,n){const a={anime:{1:{class:"watching",text:"CW",title:s.storage.lang(`UI_Status_watching_${t}`)},2:{class:"completed",text:"CMPL",title:s.storage.lang("UI_Status_Completed")},3:{class:"on-hold",text:"HOLD",title:s.storage.lang("UI_Status_OnHold")},4:{class:"dropped",text:"DROP",title:s.storage.lang("UI_Status_Dropped")},6:{class:"plantowatch",text:"PTW",title:s.storage.lang(`UI_Status_planTo_${t}`)},23:{class:"rewatching",text:"RE",title:s.storage.lang(`UI_Status_Rewatching_${t}`)}},manga:{1:{class:"reading",text:"CR",title:s.storage.lang(`UI_Status_watching_${t}`)},2:{class:"completed",text:"CMPL",title:s.storage.lang("UI_Status_Completed")},3:{class:"on-hold",text:"HOLD",title:s.storage.lang("UI_Status_OnHold")},4:{class:"dropped",text:"DROP",title:s.storage.lang("UI_Status_Dropped")},6:{class:"plantoread",text:"PTR",title:s.storage.lang(`UI_Status_planTo_${t}`)},23:{class:"rewatching",text:"RE",title:s.storage.lang(`UI_Status_Rewatching_${t}`)}}};if($.each([1,2,3,4,6,23],(function(e,t){a.anime[a.anime[t].title]=a.anime[t],a.manga[a.manga[t].title]=a.manga[t]})),e&&a[t][e]){const s=a[t][e];return` <a href="https://myanimelist.net/ownlist/${t}/${n}/edit?hideLayout=1" title="${s.title}" class="Lightbox_AddEdit button_edit ${s.class}">${s.text}</a>`}return!1}function W(e,t){switch(t){case 1:return s.storage.lang(`UI_Status_watching_${e}`);case 2:return s.storage.lang("UI_Status_Completed");case 3:return s.storage.lang("UI_Status_OnHold");case 4:return s.storage.lang("UI_Status_Dropped");case 6:return s.storage.lang(`UI_Status_planTo_${e}`);case 7:return s.storage.lang("UI_Status_All");case 23:return s.storage.lang(`UI_Status_Rewatching_${e}`);default:return""}}function H(e,t,n,a=""){const r={type:"basic",title:t,message:n,iconUrl:a};i.log("Notification",e,r),s.storage.get("notificationHistory").then((t=>{void 0===t&&(t=[]),"object"==typeof t&&(t.length>=10&&t.shift(),t.push({url:e,title:r.title,message:r.message,iconUrl:r.iconUrl,timestamp:Date.now()}),s.storage.set("notificationHistory",t))}));try{return chrome.notifications.create(e,r)}catch(e){i.error(e)}}async function G(e,t,n){const a=await s.storage.get(e);if("object"==typeof a&&(new Date).getTime()<a.timestamp)return a.data;const i=await t();return s.storage.set(e,{data:i,timestamp:(new Date).getTime()+n}).then((()=>i))}function B(e,t){a.$("#flash-div-top").length||function(){s.storage.addStyle('.flashinfo{\n                    transition: max-height 2s, opacity 2s 2s;\n                 }\n                 .mini-stealth .flashinfo{\n                    opacity: 0;\n                 }\n                  #flashinfo-div.hover.mini-stealth .flashinfo.type-update{\n                    opacity: 0.7;\n                 }\n                 #flashinfo-div.hover .flashinfo{\n                    opacity: 1;\n                 }\n                 .flashinfo:hover{\n                    max-height:5000px !important;\n                    z-index: 2147483647;\n                    opacity: 1;\n                    transition: max-height 2s;\n                 }\n                 .flashinfo .synopsis{\n                    transition: max-height 2s, max-width 2s ease 2s;\n                 }\n                 .flashinfo:hover .synopsis{\n                    max-height:9999px !important;\n                    max-width: 500px !important;\n                    transition: max-height 2s;\n                 }\n                 #flashinfo-div{\n                  z-index: 2;\n                  transition: 2s;\n                 }\n                 #flashinfo-div:hover, #flashinfo-div.hover{\n                  z-index: 2147483647;\n                 }\n                 #flashinfo-div.player-error {\n                   z-index: 2147483647;\n                 }\n                 #flashinfo-div.player-error .type-update{\n                  overflow: visible !important;\n                  opacity: 1 !important;\n                 }\n                 #flashinfo-div.player-error .player-error{\n                  display: block !important\n                 }\n                 #flashinfo-div.player-error-missing-permissions .player-error-missing-permissions{\n                  display: block !important\n                 }\n                 #flashinfo-div.player-error-missing-permissions .player-error-default{\n                  display: none !important\n                 }\n\n                 #flash-div-top, #flash-div-bottom, #flashinfo-div{\n                    font-family: "Helvetica","Arial",sans-serif;\n                    color: white;\n                    font-size: 14px;\n                    font-weight: 400;\n                    line-height: 17px;\n                 }\n                 #flash-div-top h2, #flash-div-bottom h2, #flashinfo-div h2{\n                    font-family: "Helvetica","Arial",sans-serif;\n                    color: white;\n                    font-size: 14px;\n                    font-weight: 700;\n                    line-height: 17px;\n                    padding: 0;\n                    margin: 0;\n                 }\n                 #flash-div-top a, #flash-div-bottom a, #flashinfo-div a{\n                    color: #DF6300;\n                 }');let e="";s.settings.get("floatButtonStealth")&&(e="mini-stealth"),a.$("body").after(a.html(`<div id="flash-div-top" dir="${s.storage.langDirection()}" style="text-align: center;pointer-events: none;position: fixed;top:-5px;width:100%;z-index: 2147483647;left: 0;"></div>        <div id="flash-div-bottom" dir="${s.storage.langDirection()}" style="text-align: center;pointer-events: none;position: fixed;bottom:0px;width:100%;z-index: 2147483647;left: 0;"><div id="flash" style="display:none;  background-color: red;padding: 20px; margin: 0 auto;max-width: 60%;          -webkit-border-radius: 20px;-moz-border-radius: 20px;border-radius: 20px;background:rgba(227,0,0,0.6);"></div></div>        <div id="flashinfo-div" dir="${s.storage.langDirection()}" class="${e}" style="text-align: center;pointer-events: none;position: fixed;bottom:0px;width:100%;left: 0;">`))}(),i.log("[Flash] Message:",e);let n="#323232";void 0!==t&&void 0!==t.error&&t.error&&(n="#3e0808");let r="#flash-div-bottom";void 0!==t&&void 0!==t.position&&t.position&&(r=`#flash-div-${t.position}`);let o="flash";if(void 0!==t&&void 0!==t.type&&t.type){const e=`type-${t.type}`;a.$(`${r} .${e}, #flashinfo-div .${e}`).removeClass(e).fadeOut({duration:1e3,queue:!1,complete(){a.$(this).remove()}}),o+=` ${e}`}let l,c=`<div class="${o}" style="display:none;">        <div style="display:table; pointer-events: all; padding: 14px 24px 14px 24px; margin: 0 auto; margin-top: 5px; max-width: 60%; -webkit-border-radius: 20px;-moz-border-radius: 20px;border-radius: 2px;color: white;background:${n}; ">          ${e}        </div>      </div>`;return void 0!==t&&void 0!==t.hoverInfo&&t.hoverInfo?(o+=" flashinfo",c=`<div class="${o}" style="display:none; max-height: 5000px; overflow: hidden;"><div style="display:table; pointer-events: all; margin: 0 auto; margin-top: -2px; max-width: 60%; -webkit-border-radius: 20px;-moz-border-radius: 20px;border-radius: 2px;color: white;background:${n}; position: relative;"><div style="max-height: 60vh; overflow-y: auto; padding: 14px 24px 14px 24px;">${e}</div></div></div>`,a.$("#flashinfo-div").addClass("hover"),l=a.$(a.html(c)).appendTo("#flashinfo-div"),void 0!==t&&void 0!==t.minimized&&t.minimized&&l.css("max-height","8px")):l=a.$(a.html(c)).appendTo(r),void 0!==t&&void 0!==t.permanent&&t.permanent?l.slideDown(800):void 0!==t&&void 0!==t.hoverInfo&&t.hoverInfo?l.slideDown(800).delay(4e3).queue((function(){a.$("#flashinfo-div").removeClass("hover"),l.css("max-height","8px")})):l.slideDown(800).delay(4e3).slideUp(800,(()=>{a.$(this).remove()})),l}async function K(e,t,n=()=>{},i=()=>{},r=!1){return new Promise((function(o,l){let c=s.storage.lang("Ok"),h=s.storage.lang("Cancel");r&&(c=s.storage.lang("Yes"),h=s.storage.lang("No"));const u=B(e=`<div style="text-align: center;">${e}</div><div style="display: flex; justify-content: space-around;"><button class="Yes" style="background-color: transparent; border: none; color: rgb(255,64,129);margin-top: 10px; cursor:pointer;">${c}</button><button class="Cancel" style="background-color: transparent; border: none; color: rgb(255,64,129);margin-top: 10px; cursor:pointer;">${h}</button></div>`,{permanent:!0,position:"top",type:t});u.find(".Yes").click((function(e){o(!0),a.$(e.target).parentsUntil(".flash").fadeOut(300,(function(){a.$(this).remove()})),n()})),u.find(".Cancel").click((function(e){o(!1),a.$(e.target).parentsUntil(".flash").fadeOut(300,(function(){a.$(this).remove()})),i()}))}))}let V=!1,q=[];function X(e,t=".mdl-layout__content"){function n(e,t){if(!a.$(e).is(":visible"))return!1;if(a.$(e).hasClass("lazyBack"))a.$(e).css("background-image",`url(${e.getAttribute("data-src")})`).removeClass("lazyBack");else{const n=new Image,a=e.getAttribute("data-src");n.onload=function(){e.parent?e.parent.replaceChild(n,e):e.src=a,t&&t()},n.src=a}}for(let e=0;e<q.length;e++)$(q[e]).addClass("init");q=[];const s=e.find("img.lazy.init, .lazyBack.init"),i=function(){for(let e=0;e<q.length;e++)r.elementInViewport(q[e],600)&&n(q[e],(function(){q.splice(e,e)})),$(q[e]).length||q.splice(e,e)};for(let e=0;e<s.length;e++)q.push(s[e]),$(s[e]).removeClass("init");i(),V||(V=!0,e.find(t).scroll((function(){i()})))}function Y(e,t=0){const n=e.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.top-t<=(window.innerHeight||document.documentElement.clientHeight)}function J(e){return new Promise((t=>{setTimeout(t,e)}))}function Z(e,t,n){switch(e){case"mal":return`https://myanimelist.net/${t}/${n}`;case"anilist":return`https://anilist.co/${t}/${n}`;case"kitsu":return`https://kitsu.app/${t}/${n}`;case"simkl":return`https://simkl.com/${t}/${n}`;default:throw`${e} not a valid page`}}function Q(e=0){const t=new Date;t.setDate(t.getDate()+e);const n=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0");return`${t.getFullYear()}-${n}-${a}`}function ee(e){return $("<textarea/>").html(a.html(e)).text()}function te(){return Boolean("undefined"!=typeof browser&&"undefined"!=typeof chrome)}function ne(){const e=()=>Boolean(!document.visibilityState||"visible"===document.visibilityState);if(e())return Promise.resolve();i.log("Page in background");const{asyncWaitUntilTrue:t}=T((()=>e()));return t().then((()=>{i.log("Page is visible")}))}async function ae(){const e=await s.storage.list();let t=0;for(const n in e)r.syncRegex.test(n)||/(^tagSettings\/.*)/.test(n)||(s.storage.remove(n),t++);r.flashm(`Cache Cleared [${t}]`)}function se(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0}function ie(e,t){const n=new URL(e),{host:a}=n;return a===t||a.endsWith(`.${t}`)}function re(e){return!e||e.length<2?e:e.charAt(0).toUpperCase()+e.slice(1)}},7263:(e,t,n)=>{"use strict";n.r(t),n.d(t,{$:()=>s,html:()=>i});var a=n(99418);const s=jQuery;function i(e){return a.A.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,ADD_ATTR:["target"]})}},96789:(e,t,n)=>{"use strict";n.d(t,{GT:()=>o}),n(54089);var a=n(35580),s=n.n(a),i=n(13647);function r(){return i.storage.version()}function o(e){return s()(e,r())&&e!==r()}},99418:(e,t,n)=>{"use strict";n.d(t,{A:()=>ne});const{entries:a,setPrototypeOf:s,isFrozen:i,getPrototypeOf:r,getOwnPropertyDescriptor:o}=Object;let{freeze:l,seal:c,create:h}=Object,{apply:u,construct:m}="undefined"!=typeof Reflect&&Reflect;l||(l=function(e){return e}),c||(c=function(e){return e}),u||(u=function(e,t,n){return e.apply(t,n)}),m||(m=function(e,t){return new e(...t)});const p=A(Array.prototype.forEach),d=A(Array.prototype.lastIndexOf),g=A(Array.prototype.pop),f=A(Array.prototype.push),y=A(Array.prototype.splice),_=A(String.prototype.toLowerCase),b=A(String.prototype.toString),w=A(String.prototype.match),v=A(String.prototype.replace),E=A(String.prototype.indexOf),k=A(String.prototype.trim),S=A(Object.prototype.hasOwnProperty),T=A(RegExp.prototype.test),x=(I=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return m(I,t)});var I;function A(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return u(e,t,a)}}function $(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_;s&&s(e,null);let a=t.length;for(;a--;){let s=t[a];if("string"==typeof s){const e=n(s);e!==s&&(i(t)||(t[a]=e),s=e)}e[s]=!0}return e}function L(e){for(let t=0;t<e.length;t++)S(e,t)||(e[t]=null);return e}function N(e){const t=h(null);for(const[n,s]of a(e))S(e,n)&&(Array.isArray(s)?t[n]=L(s):s&&"object"==typeof s&&s.constructor===Object?t[n]=N(s):t[n]=s);return t}function R(e,t){for(;null!==e;){const n=o(e,t);if(n){if(n.get)return A(n.get);if("function"==typeof n.value)return A(n.value)}e=r(e)}return function(){return null}}const P=l(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),O=l(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),C=l(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),M=l(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),D=l(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),U=l(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),F=l(["#text"]),j=l(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),z=l(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),W=l(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H=l(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),G=c(/\{\{[\w\W]*|[\w\W]*\}\}/gm),B=c(/<%[\w\W]*|[\w\W]*%>/gm),K=c(/\$\{[\w\W]*/gm),V=c(/^data-[\-\w.\u00B7-\uFFFF]+$/),q=c(/^aria-[\-\w]+$/),X=c(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Y=c(/^(?:\w+script|data):/i),J=c(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Z=c(/^html$/i),Q=c(/^[a-z][.\w]*(-[.\w]+)+$/i);var ee=Object.freeze({__proto__:null,ARIA_ATTR:q,ATTR_WHITESPACE:J,CUSTOM_ELEMENT:Q,DATA_ATTR:V,DOCTYPE_NAME:Z,ERB_EXPR:B,IS_ALLOWED_URI:X,IS_SCRIPT_OR_DATA:Y,MUSTACHE_EXPR:G,TMPLIT_EXPR:K});const te=function(){return"undefined"==typeof window?null:window};var ne=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te();const n=t=>e(t);if(n.version="3.2.5",n.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return n.isSupported=!1,n;let{document:s}=t;const i=s,r=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:c,Node:u,Element:m,NodeFilter:I,NamedNodeMap:A=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:L,DOMParser:G,trustedTypes:B}=t,K=m.prototype,V=R(K,"cloneNode"),q=R(K,"remove"),Y=R(K,"nextSibling"),J=R(K,"childNodes"),Q=R(K,"parentNode");if("function"==typeof c){const e=s.createElement("template");e.content&&e.content.ownerDocument&&(s=e.content.ownerDocument)}let ne,ae="";const{implementation:se,createNodeIterator:ie,createDocumentFragment:re,getElementsByTagName:oe}=s,{importNode:le}=i;let ce={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof a&&"function"==typeof Q&&se&&void 0!==se.createHTMLDocument;const{MUSTACHE_EXPR:he,ERB_EXPR:ue,TMPLIT_EXPR:me,DATA_ATTR:pe,ARIA_ATTR:de,IS_SCRIPT_OR_DATA:ge,ATTR_WHITESPACE:fe,CUSTOM_ELEMENT:ye}=ee;let{IS_ALLOWED_URI:_e}=ee,be=null;const we=$({},[...P,...O,...C,...D,...F]);let ve=null;const Ee=$({},[...j,...z,...W,...H]);let ke=Object.seal(h(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Se=null,Te=null,xe=!0,Ie=!0,Ae=!1,$e=!0,Le=!1,Ne=!0,Re=!1,Pe=!1,Oe=!1,Ce=!1,Me=!1,De=!1,Ue=!0,Fe=!1,je=!0,ze=!1,We={},He=null;const Ge=$({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Be=null;const Ke=$({},["audio","video","img","source","image","track"]);let Ve=null;const qe=$({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Xe="http://www.w3.org/1998/Math/MathML",Ye="http://www.w3.org/2000/svg",Je="http://www.w3.org/1999/xhtml";let Ze=Je,Qe=!1,et=null;const tt=$({},[Xe,Ye,Je],b);let nt=$({},["mi","mo","mn","ms","mtext"]),at=$({},["annotation-xml"]);const st=$({},["title","style","font","a","script"]);let it=null;const rt=["application/xhtml+xml","text/html"];let ot=null,lt=null;const ct=s.createElement("form"),ht=function(e){return e instanceof RegExp||e instanceof Function},ut=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!lt||lt!==e){if(e&&"object"==typeof e||(e={}),e=N(e),it=-1===rt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ot="application/xhtml+xml"===it?b:_,be=S(e,"ALLOWED_TAGS")?$({},e.ALLOWED_TAGS,ot):we,ve=S(e,"ALLOWED_ATTR")?$({},e.ALLOWED_ATTR,ot):Ee,et=S(e,"ALLOWED_NAMESPACES")?$({},e.ALLOWED_NAMESPACES,b):tt,Ve=S(e,"ADD_URI_SAFE_ATTR")?$(N(qe),e.ADD_URI_SAFE_ATTR,ot):qe,Be=S(e,"ADD_DATA_URI_TAGS")?$(N(Ke),e.ADD_DATA_URI_TAGS,ot):Ke,He=S(e,"FORBID_CONTENTS")?$({},e.FORBID_CONTENTS,ot):Ge,Se=S(e,"FORBID_TAGS")?$({},e.FORBID_TAGS,ot):{},Te=S(e,"FORBID_ATTR")?$({},e.FORBID_ATTR,ot):{},We=!!S(e,"USE_PROFILES")&&e.USE_PROFILES,xe=!1!==e.ALLOW_ARIA_ATTR,Ie=!1!==e.ALLOW_DATA_ATTR,Ae=e.ALLOW_UNKNOWN_PROTOCOLS||!1,$e=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Le=e.SAFE_FOR_TEMPLATES||!1,Ne=!1!==e.SAFE_FOR_XML,Re=e.WHOLE_DOCUMENT||!1,Ce=e.RETURN_DOM||!1,Me=e.RETURN_DOM_FRAGMENT||!1,De=e.RETURN_TRUSTED_TYPE||!1,Oe=e.FORCE_BODY||!1,Ue=!1!==e.SANITIZE_DOM,Fe=e.SANITIZE_NAMED_PROPS||!1,je=!1!==e.KEEP_CONTENT,ze=e.IN_PLACE||!1,_e=e.ALLOWED_URI_REGEXP||X,Ze=e.NAMESPACE||Je,nt=e.MATHML_TEXT_INTEGRATION_POINTS||nt,at=e.HTML_INTEGRATION_POINTS||at,ke=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ht(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ke.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ht(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ke.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(ke.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Le&&(Ie=!1),Me&&(Ce=!0),We&&(be=$({},F),ve=[],!0===We.html&&($(be,P),$(ve,j)),!0===We.svg&&($(be,O),$(ve,z),$(ve,H)),!0===We.svgFilters&&($(be,C),$(ve,z),$(ve,H)),!0===We.mathMl&&($(be,D),$(ve,W),$(ve,H))),e.ADD_TAGS&&(be===we&&(be=N(be)),$(be,e.ADD_TAGS,ot)),e.ADD_ATTR&&(ve===Ee&&(ve=N(ve)),$(ve,e.ADD_ATTR,ot)),e.ADD_URI_SAFE_ATTR&&$(Ve,e.ADD_URI_SAFE_ATTR,ot),e.FORBID_CONTENTS&&(He===Ge&&(He=N(He)),$(He,e.FORBID_CONTENTS,ot)),je&&(be["#text"]=!0),Re&&$(be,["html","head","body"]),be.table&&($(be,["tbody"]),delete Se.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw x('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw x('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ne=e.TRUSTED_TYPES_POLICY,ae=ne.createHTML("")}else void 0===ne&&(ne=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const a="data-tt-policy-suffix";t&&t.hasAttribute(a)&&(n=t.getAttribute(a));const s="dompurify"+(n?"#"+n:"");try{return e.createPolicy(s,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+s+" could not be created."),null}}(B,r)),null!==ne&&"string"==typeof ae&&(ae=ne.createHTML(""));l&&l(e),lt=e}},mt=$({},[...O,...C,...M]),pt=$({},[...D,...U]),dt=function(e){f(n.removed,{element:e});try{Q(e).removeChild(e)}catch(t){q(e)}},gt=function(e,t){try{f(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){f(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(Ce||Me)try{dt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},ft=function(e){let t=null,n=null;if(Oe)e="<remove></remove>"+e;else{const t=w(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===it&&Ze===Je&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const a=ne?ne.createHTML(e):e;if(Ze===Je)try{t=(new G).parseFromString(a,it)}catch(e){}if(!t||!t.documentElement){t=se.createDocument(Ze,"template",null);try{t.documentElement.innerHTML=Qe?ae:a}catch(e){}}const i=t.body||t.documentElement;return e&&n&&i.insertBefore(s.createTextNode(n),i.childNodes[0]||null),Ze===Je?oe.call(t,Re?"html":"body")[0]:Re?t.documentElement:i},yt=function(e){return ie.call(e.ownerDocument||e,e,I.SHOW_ELEMENT|I.SHOW_COMMENT|I.SHOW_TEXT|I.SHOW_PROCESSING_INSTRUCTION|I.SHOW_CDATA_SECTION,null)},_t=function(e){return e instanceof L&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof A)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},bt=function(e){return"function"==typeof u&&e instanceof u};function wt(e,t,a){p(e,(e=>{e.call(n,t,a,lt)}))}const vt=function(e){let t=null;if(wt(ce.beforeSanitizeElements,e,null),_t(e))return dt(e),!0;const a=ot(e.nodeName);if(wt(ce.uponSanitizeElement,e,{tagName:a,allowedTags:be}),e.hasChildNodes()&&!bt(e.firstElementChild)&&T(/<[/\w!]/g,e.innerHTML)&&T(/<[/\w!]/g,e.textContent))return dt(e),!0;if(7===e.nodeType)return dt(e),!0;if(Ne&&8===e.nodeType&&T(/<[/\w]/g,e.data))return dt(e),!0;if(!be[a]||Se[a]){if(!Se[a]&&kt(a)){if(ke.tagNameCheck instanceof RegExp&&T(ke.tagNameCheck,a))return!1;if(ke.tagNameCheck instanceof Function&&ke.tagNameCheck(a))return!1}if(je&&!He[a]){const t=Q(e)||e.parentNode,n=J(e)||e.childNodes;if(n&&t)for(let a=n.length-1;a>=0;--a){const s=V(n[a],!0);s.__removalCount=(e.__removalCount||0)+1,t.insertBefore(s,Y(e))}}return dt(e),!0}return e instanceof m&&!function(e){let t=Q(e);t&&t.tagName||(t={namespaceURI:Ze,tagName:"template"});const n=_(e.tagName),a=_(t.tagName);return!!et[e.namespaceURI]&&(e.namespaceURI===Ye?t.namespaceURI===Je?"svg"===n:t.namespaceURI===Xe?"svg"===n&&("annotation-xml"===a||nt[a]):Boolean(mt[n]):e.namespaceURI===Xe?t.namespaceURI===Je?"math"===n:t.namespaceURI===Ye?"math"===n&&at[a]:Boolean(pt[n]):e.namespaceURI===Je?!(t.namespaceURI===Ye&&!at[a])&&!(t.namespaceURI===Xe&&!nt[a])&&!pt[n]&&(st[n]||!mt[n]):!("application/xhtml+xml"!==it||!et[e.namespaceURI]))}(e)?(dt(e),!0):"noscript"!==a&&"noembed"!==a&&"noframes"!==a||!T(/<\/no(script|embed|frames)/i,e.innerHTML)?(Le&&3===e.nodeType&&(t=e.textContent,p([he,ue,me],(e=>{t=v(t,e," ")})),e.textContent!==t&&(f(n.removed,{element:e.cloneNode()}),e.textContent=t)),wt(ce.afterSanitizeElements,e,null),!1):(dt(e),!0)},Et=function(e,t,n){if(Ue&&("id"===t||"name"===t)&&(n in s||n in ct))return!1;if(Ie&&!Te[t]&&T(pe,t));else if(xe&&T(de,t));else if(!ve[t]||Te[t]){if(!(kt(e)&&(ke.tagNameCheck instanceof RegExp&&T(ke.tagNameCheck,e)||ke.tagNameCheck instanceof Function&&ke.tagNameCheck(e))&&(ke.attributeNameCheck instanceof RegExp&&T(ke.attributeNameCheck,t)||ke.attributeNameCheck instanceof Function&&ke.attributeNameCheck(t))||"is"===t&&ke.allowCustomizedBuiltInElements&&(ke.tagNameCheck instanceof RegExp&&T(ke.tagNameCheck,n)||ke.tagNameCheck instanceof Function&&ke.tagNameCheck(n))))return!1}else if(Ve[t]);else if(T(_e,v(n,fe,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==E(n,"data:")||!Be[e])if(Ae&&!T(ge,v(n,fe,"")));else if(n)return!1;return!0},kt=function(e){return"annotation-xml"!==e&&w(e,ye)},St=function(e){wt(ce.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||_t(e))return;const a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ve,forceKeepAttr:void 0};let s=t.length;for(;s--;){const i=t[s],{name:r,namespaceURI:o,value:l}=i,c=ot(r);let h="value"===r?l:k(l);if(a.attrName=c,a.attrValue=h,a.keepAttr=!0,a.forceKeepAttr=void 0,wt(ce.uponSanitizeAttribute,e,a),h=a.attrValue,!Fe||"id"!==c&&"name"!==c||(gt(r,e),h="user-content-"+h),Ne&&T(/((--!?|])>)|<\/(style|title)/i,h)){gt(r,e);continue}if(a.forceKeepAttr)continue;if(gt(r,e),!a.keepAttr)continue;if(!$e&&T(/\/>/i,h)){gt(r,e);continue}Le&&p([he,ue,me],(e=>{h=v(h,e," ")}));const u=ot(e.nodeName);if(Et(u,c,h)){if(ne&&"object"==typeof B&&"function"==typeof B.getAttributeType)if(o);else switch(B.getAttributeType(u,c)){case"TrustedHTML":h=ne.createHTML(h);break;case"TrustedScriptURL":h=ne.createScriptURL(h)}try{o?e.setAttributeNS(o,r,h):e.setAttribute(r,h),_t(e)?dt(e):g(n.removed)}catch(e){}}}wt(ce.afterSanitizeAttributes,e,null)},Tt=function e(t){let n=null;const a=yt(t);for(wt(ce.beforeSanitizeShadowDOM,t,null);n=a.nextNode();)wt(ce.uponSanitizeShadowNode,n,null),vt(n),St(n),n.content instanceof o&&e(n.content);wt(ce.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null,s=null,r=null,l=null;if(Qe=!e,Qe&&(e="\x3c!--\x3e"),"string"!=typeof e&&!bt(e)){if("function"!=typeof e.toString)throw x("toString is not a function");if("string"!=typeof(e=e.toString()))throw x("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Pe||ut(t),n.removed=[],"string"==typeof e&&(ze=!1),ze){if(e.nodeName){const t=ot(e.nodeName);if(!be[t]||Se[t])throw x("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof u)a=ft("\x3c!----\x3e"),s=a.ownerDocument.importNode(e,!0),1===s.nodeType&&"BODY"===s.nodeName||"HTML"===s.nodeName?a=s:a.appendChild(s);else{if(!Ce&&!Le&&!Re&&-1===e.indexOf("<"))return ne&&De?ne.createHTML(e):e;if(a=ft(e),!a)return Ce?null:De?ae:""}a&&Oe&&dt(a.firstChild);const c=yt(ze?e:a);for(;r=c.nextNode();)vt(r),St(r),r.content instanceof o&&Tt(r.content);if(ze)return e;if(Ce){if(Me)for(l=re.call(a.ownerDocument);a.firstChild;)l.appendChild(a.firstChild);else l=a;return(ve.shadowroot||ve.shadowrootmode)&&(l=le.call(i,l,!0)),l}let h=Re?a.outerHTML:a.innerHTML;return Re&&be["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&T(Z,a.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+h),Le&&p([he,ue,me],(e=>{h=v(h,e," ")})),ne&&De?ne.createHTML(h):h},n.setConfig=function(){ut(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Pe=!0},n.clearConfig=function(){lt=null,Pe=!1},n.isValidAttribute=function(e,t,n){lt||ut({});const a=ot(e),s=ot(t);return Et(a,s,n)},n.addHook=function(e,t){"function"==typeof t&&f(ce[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=d(ce[e],t);return-1===n?void 0:y(ce[e],n,1)[0]}return g(ce[e])},n.removeHooks=function(e){ce[e]=[]},n.removeAllHooks=function(){ce={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}()},52163:e=>{"use strict";e.exports=JSON.parse('[{"key":"Crunchyroll","name":"Crunchyroll","domain":"https://www.crunchyroll.com","database":"Crunchyroll","search":{"anime":"https://www.crunchyroll.com/search?q={searchtermPlus}","manga":null}},{"key":"Mangadex","name":"Mangadex","domain":"https://www.mangadex.org","database":"Mangadex","search":{"anime":null,"manga":"https://mangadex.org/titles?q={searchterm}"}},{"key":"Gogoanime","name":"Gogoanime","domain":"https://gogoanime.tv","database":"Gogoanime","search":{"anime":"https://anitaku.pe/search.html?keyword={searchterm}","manga":null}},{"key":"TurkAnime","name":"TurkAnime","domain":"https://www.turkanime.co","database":null,"search":{"anime":"home","manga":null}},{"key":"animepahe","name":"animepahe","domain":"https://animepahe.com","database":"animepahe","search":{"anime":"home","manga":null}},{"key":"Netflix","name":"Netflix","domain":"https://www.netflix.com","database":"Netflix","search":{"anime":"https://www.netflix.com/search?q={searchterm}","manga":null}},{"key":"Animeflv","name":"Animeflv","domain":"https://animeflv.net","database":null,"search":{"anime":"https://www3.animeflv.net/browse?q={searchtermPlus}","manga":null}},{"key":"Jkanime","name":"Jkanime","domain":"https://jkanime.net","database":null,"search":{"anime":"https://jkanime.net/buscar/{searchterm}","manga":null}},{"key":"Proxer","name":"Proxer","domain":"https://proxer.me","database":null,"search":{"anime":"https://proxer.me/search?s=search&name={searchterm}&typ=all-anime&tags=&notags=#top","manga":"https://proxer.me/search?s=search&name={searchterm}&typ=all-manga&tags=&notags=#top"}},{"key":"Emby","name":"Emby","domain":"http://app.emby.media","database":null,"search":{"anime":"home","manga":null}},{"key":"Plex","name":"Plex","domain":"http://app.plex.tv","database":null,"search":{"anime":"home","manga":null}},{"key":"Aniflix","name":"Aniflix","domain":"https://aniflix.cc","database":null,"search":{"anime":"home","manga":null}},{"key":"KickAssAnime","name":"KickAssAnime","domain":"https://kickassanime.am","database":"KickAssAnime","search":{"anime":"https://kaas.am/search?q={searchterm}","manga":null}},{"key":"Shinden","name":"Shinden","domain":"https://shinden.pl","database":null,"search":{"anime":"https://shinden.pl/series?search={searchtermPlus}","manga":null}},{"key":"Voiranime","name":"Voiranime","domain":"https://voiranime.com","database":null,"search":{"anime":"https://voiranime.com/?s={searchtermPlus}","manga":null}},{"key":"VIZ","name":"VIZ","domain":"https://www.viz.com","database":"VIZ","search":{"anime":null,"manga":"https://www.viz.com/search?search={searchtermPlus}"}},{"key":"AnimeOdcinki","name":"AnimeOdcinki","domain":"https://anime-odcinki.pl","database":null,"search":{"anime":"https://anime-odcinki.pl/szukaj/{searchtermPlus}","manga":null}},{"key":"AnimeZone","name":"AnimeZone","domain":"https://www.animezone.pl","database":null,"search":{"anime":"https://www.animezone.pl/szukaj?q={searchtermPlus}","manga":null}},{"key":"serimanga","name":"serimanga","domain":"https://serimanga.com","database":null,"search":{"anime":null,"manga":"https://serimanga.com/mangalar?search={searchtermPlus}"}},{"key":"mangadenizi","name":"mangadenizi","domain":"https://www.mangadenizi.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"moeclip","name":"moeclip","domain":"https://moeclip.com","database":null,"search":{"anime":"https://moeclip.com/search/{searchtermPlus}","manga":null}},{"key":"mangalivre","name":"Mangá Livre","domain":"https://mangalivre.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"tmofans","name":"tmofans","domain":"https://zonatmo.com","database":null,"search":{"anime":null,"manga":"https://zonatmo.com/library?_pg=1&title={searchtermPlus}"}},{"key":"MangaPlus","name":"MangaPlus","domain":"https://mangaplus.shueisha.co.jp","database":"MangaPlus","search":{"anime":null,"manga":"https://mangaplus.shueisha.co.jp/search_result?keyword={searchterm}"}},{"key":"JapScan","name":"JapScan","domain":"https://www.japscan.ws","database":null,"search":{"anime":null,"manga":"home"}},{"key":"Hulu","name":"Hulu","domain":"https://www.hulu.com","database":"Hulu","search":{"anime":"home","manga":null}},{"key":"Hidive","name":"Hidive","domain":"https://www.hidive.com","database":"Hidive","search":{"anime":"https://www.hidive.com/search?q={searchtermPlus}","manga":null}},{"key":"MangaKatana","name":"MangaKatana","domain":"http://mangakatana.com","database":null,"search":{"anime":null,"manga":"http://mangakatana.com/?search={searchtermPlus}&search_by=book_name"}},{"key":"manga4life","name":"manga4life","domain":"https://manga4life.com","database":null,"search":{"anime":null,"manga":"https://manga4life.com/search/?name={searchterm}"}},{"key":"bato","name":"bato","domain":"https://bato.to","database":null,"search":{"anime":null,"manga":"https://bato.to/search?word={searchtermPlus}"}},{"key":"MangaPark","name":"MangaPark","domain":"https://mangapark.net","database":null,"search":{"anime":null,"manga":"https://mangapark.net/search?word={searchterm}"}},{"key":"AnimeXin","name":"AnimeXin","domain":"https://animexin.vip","database":null,"search":{"anime":"https://animexin.vip/?s={searchtermPlus}","manga":null}},{"key":"MonosChinos","name":"MonosChinos","domain":"https://monoschinos2.com","database":null,"search":{"anime":"https://monoschinos2.com/buscar?q={searchtermPlus}","manga":null}},{"key":"Anime365","name":"Anime365","domain":"https://smotret-anime.org","database":null,"search":{"anime":"https://smotret-anime.net/catalog/search?q={searchtermPlus}","manga":null}},{"key":"AnimeFire","name":"AnimeFire","domain":"https://animefire.net","database":null,"search":{"anime":"home","manga":null}},{"key":"OtakuFR","name":"OtakuFR","domain":"https://otakufr.cc","database":null,"search":{"anime":"https://otakufr.cc/toute-la-liste-affiches/?q={searchtermPlus}","manga":null}},{"key":"mangatx","name":"mangatx","domain":"https://mangatx.com","database":null,"search":{"anime":null,"manga":"https://mangatx.com/?s={searchtermPlus}&post_type=wp-manga&post_type=wp-manga"}},{"key":"manhuafast","name":"manhuafast","domain":"https://manhuafast.com","database":null,"search":{"anime":null,"manga":"https://manhuafast.com/?s={searchtermPlus}&post_type=wp-manga&post_type=wp-manga"}},{"key":"TRanimeizle","name":"TRanimeizle","domain":"https://www.tranimeizle.net/","database":null,"search":{"anime":"home","manga":null}},{"key":"AnimeStreamingFR","name":"AnimeStreamingFR","domain":"https://beta.animestreamingfr.fr","database":null,"search":{"anime":"https://beta.animestreamingfr.fr/catalogue/search?query={searchtermPlus}","manga":null}},{"key":"Furyosociety","name":"Furyosociety","domain":"https://furyosociety.com/","database":null,"search":{"anime":null,"manga":"home"}},{"key":"AnimeId","name":"AnimeId","domain":"https://www.animeid.tv","database":null,"search":{"anime":"home","manga":null}},{"key":"MyAnimeListVideo","name":"MyAnimeList","domain":"https://myanimelist.net","database":null,"search":{"anime":"https://myanimelist.net/anime.php?q={searchterm}","manga":"https://myanimelist.net/manga.php?q={searchterm}"}},{"key":"AnimeUnity","name":"AnimeUnity","domain":"https://animeunity.it","database":null,"search":{"anime":"home","manga":null}},{"key":"MangaHere","name":"MangaHere","domain":"http://www.mangahere.cc","database":null,"search":{"anime":null,"manga":"http://www.mangahere.cc/search?title={searchtermPlus}"}},{"key":"MangaFox","name":"MangaFox","domain":"https://fanfox.net","database":"MangaFox","search":{"anime":null,"manga":"http://fanfox.net/search?title={searchtermPlus}"}},{"key":"DesuOnline","name":"DesuOnline","domain":"https://desu-online.pl","database":null,"search":{"anime":"https://desu-online.pl/?s={searchtermPlus}","manga":null}},{"key":"WuxiaWorld","name":"WuxiaWorld","domain":"https://wuxiaworld.site","database":null,"search":{"anime":null,"manga":"https://wuxiaworld.site/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"LeviatanScans","name":"LeviatanScans","domain":"https://lscomic.com","database":null,"search":{"anime":null,"manga":"https://lscomic.com/?s={searchtermPlus}"}},{"key":"ReaperScans","name":"ReaperScans","domain":"https://reaperscans.com","database":null,"search":{"anime":null,"manga":"home"}},{"key":"LynxScans","name":"LynxScans","domain":"https://lynxscans.com","database":null,"search":{"anime":null,"manga":"https://lynxscans.com/comics?query={searchtermPlus}"}},{"key":"ZeroScans","name":"ZeroScans","domain":"https://zeroscans.com","database":null,"search":{"anime":null,"manga":"home"}},{"key":"DeathTollScans","name":"DeathTollScans","domain":"https://reader.deathtollscans.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"ManhuaPlus","name":"ManhuaPlus","domain":"https://manhuaplus.com","database":null,"search":{"anime":null,"manga":"https://manhuaplus.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"Readm","name":"Readm","domain":"https://readm.today","database":null,"search":{"anime":null,"manga":"home"}},{"key":"tioanime","name":"tioanime","domain":"https://tioanime.com","database":null,"search":{"anime":"https://tioanime.com/directorio?q={searchtermPlus}","manga":null}},{"key":"MangaSee","name":"MangaSee","domain":"https://mangasee123.com","database":"MangaSee","search":{"anime":null,"manga":"https://mangasee123.com/search/?name={searchterm}"}},{"key":"Okanime","name":"Okanime","domain":"https://okanime.tv","database":null,"search":{"anime":"https://okanime.tv/search?search={searchtermPlus}","manga":null}},{"key":"BSTO","name":"bs.to","domain":"https://bs.to","database":null,"search":{"anime":"home","manga":null}},{"key":"AsuraScans","name":"AsuraScans","domain":"https://asuratoon.com","database":null,"search":{"anime":null,"manga":"https://asuracomics.com/?s={searchtermPlus}"}},{"key":"Jellyfin","name":"Jellyfin","domain":"https://jellyfin.org/","database":null,"search":{"anime":"home","manga":null}},{"key":"An1me","name":"An1me","domain":"https://an1me.to","database":null,"search":{"anime":"https://an1me.to/?s={searchtermPlus}&post_type=wp-manga","manga":null}},{"key":"MangaJar","name":"MangaJar","domain":"https://mangajar.pro","database":null,"search":{"anime":null,"manga":"https://mangajar.pro/search?q={searchtermPlus}"}},{"key":"Otakustv","name":"Otakustv","domain":"https://www.otakustv.com","database":null,"search":{"anime":"https://www.otakustv.com/buscador.php?buscador={searchterm}","manga":null}},{"key":"Komga","name":"Komga","domain":"https://komga.org","database":null,"search":{"anime":null,"manga":"home"}},{"key":"AnimeWho","name":"AnimeWho","domain":"https://animewho.com","database":null,"search":{"anime":"home","manga":null}},{"key":"Fumetsu","name":"Fumetsu","domain":"https://fumetsu.pl","database":null,"search":{"anime":"home","manga":null}},{"key":"FrixySubs","name":"FrixySubs","domain":"https://frixysubs.pl","database":null,"search":{"anime":"https://frixysubs.pl/anime-list?search={searchtermPlus}","manga":null}},{"key":"Guya","name":"Guya & Cubari","domain":"https://guya.moe","database":null,"search":{"anime":null,"manga":"home"}},{"key":"MangaHub","name":"MangaHub","domain":"https://mangahub.io","database":null,"search":{"anime":null,"manga":"https://mangahub.io/search?q={searchterm}"}},{"key":"ComicK","name":"ComicK","domain":"https://comick.io","database":"Comick","search":{"anime":null,"manga":"https://comick.io/search?q={searchterm}"}},{"key":"Bentomanga","name":"Bentomanga","domain":"https://bentomanga.com","database":null,"search":{"anime":null,"manga":"https://www.bentomanga.com/manga_list?search={searchterm}"}},{"key":"MangaSushi","name":"MangaSushi","domain":"https://mangasushi.net","database":null,"search":{"anime":null,"manga":"https://mangasushi.net/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"TritiniaScans","name":"TritiniaScans","domain":"https://tritinia.com","database":null,"search":{"anime":null,"manga":"https://tritinia.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"ReadManhua","name":"ReadManhua","domain":"https://readmanhua.net","database":null,"search":{"anime":null,"manga":"https://readmanhua.net/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"FlameScans","name":"FlameScans","domain":"https://flamecomics.xyz","database":null,"search":{"anime":null,"manga":"https://flamecomics.xyz/browse?search={searchterm}"}},{"key":"ImmortalUpdates","name":"ImmortalUpdates","domain":"https://immortalupdates.com","database":null,"search":{"anime":null,"manga":"https://immortalupdates.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"Zoro","name":"HiAnime","domain":"https://hianime.to","database":"Zoro","search":{"anime":"https://hianime.to/search?keyword={searchtermPlus}","manga":null}},{"key":"Kitsune","name":"Kitsune","domain":"https://beta.kitsune.tv","database":null,"search":{"anime":"https://kitsune.tv/shows?q={searchterm}","manga":null}},{"key":"LHTranslation","name":"LHTranslation","domain":"https://lhtranslation.net","database":null,"search":{"anime":null,"manga":"https://lhtranslation.net/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"MangasOrigines","name":"MangasOrigines","domain":"https://mangas-origines.fr/","database":null,"search":{"anime":null,"manga":"https://mangas-origines.fr/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"BlueSolo","name":"BlueSolo","domain":"https://www.bluesolo.org","database":null,"search":{"anime":null,"manga":"home"}},{"key":"DisasterScans","name":"DisasterScans","domain":"https://disasterscans.com","database":null,"search":{"anime":null,"manga":"https://disasterscans.com/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"DynastyScans","name":"DynastyScans","domain":"https://dynasty-scans.com","database":null,"search":{"anime":null,"manga":"https://dynasty-scans.com/search?q={searchtermPlus}"}},{"key":"Aniworld","name":"Aniworld","domain":"https://aniworld.to","database":null,"search":{"anime":"https://aniworld.to/search?q={searchterm}","manga":null}},{"key":"BetterAnime","name":"BetterAnime","domain":"https://betteranime.net","database":null,"search":{"anime":"https://betteranime.net/pesquisa?titulo={searchtermPlus}","manga":null}},{"key":"BilibiliComics","name":"BilibiliComics","domain":"https://manga.bilibili.com","database":null,"search":{"anime":null,"manga":"https://manga.bilibili.com/search?keyword={searchterm( )[noLowercase]}"}},{"key":"MangaReader","name":"MangaReader","domain":"https://mangareader.to","database":"MangaReader","search":{"anime":null,"manga":"https://mangareader.to/search?keyword={searchtermPlus}"}},{"key":"AnimeOnsen","name":"AnimeOnsen","domain":"https://animeonsen.xyz","database":null,"search":{"anime":"https://www.animeonsen.xyz/search/{searchterm}","manga":null}},{"key":"Animetoast","name":"Animetoast","domain":"https://www.animetoast.cc","database":null,"search":{"anime":"https://www.animetoast.cc/?s={searchterm}","manga":null}},{"key":"LuminousScans","name":"LuminousScans","domain":"https://luminous-scans.com","database":null,"search":{"anime":null,"manga":"https://luminous-scans.com/?s={searchtermPlus}"}},{"key":"Animeworld","name":"Animeworld","domain":"https://www.animeworld.tv","database":null,"search":{"anime":"home","manga":null}},{"key":"MangaBuddy","name":"MangaBuddy","domain":"https://mangabuddy.com","database":null,"search":{"anime":null,"manga":"https://mangabuddy.com/search?q={searchtermPlus}"}},{"key":"ToonAnime","name":"ToonAnime","domain":"https://vvww.toonanime.cc","database":null,"search":{"anime":"https://vvww.toonanime.cc/?story={searchtermPlus}&do=search&subaction=search","manga":null}},{"key":"ADKami","name":"ADKami","domain":"https://www.adkami.com/","database":null,"search":{"anime":"https://www.adkami.com/video?search={searchtermPlus}","manga":null}},{"key":"Kaguya","name":"Kaguya","domain":"https://kaguya.app","database":null,"search":{"anime":"https://kaguya.app/browse?keyword={searchtermPlus}","manga":null}},{"key":"Hdrezka","name":"Hdrezka","domain":"https://hdrezka.ag","database":null,"search":{"anime":"https://hdrezka.ag/search/?do=search&subaction=search&q={searchterm}","manga":null}},{"key":"SovetRomantica","name":"SovetRomantica","domain":"https://sovetromantica.com","database":null,"search":{"anime":"https://sovetromantica.com/anime?query={searchterm}","manga":null}},{"key":"ADN","name":"ADN","domain":"https://animationdigitalnetwork.com","database":null,"search":{"anime":"https://animationdigitalnetwork.fr/video?search={searchterm}","manga":null}},{"key":"Aniyan","name":"Aniyan","domain":"https://aniyan.net","database":null,"search":{"anime":"https://aniyan.net/?s={searchtermPlus}","manga":null}},{"key":"Docchi","name":"Docchi","domain":"https://docchi.pl","database":null,"search":{"anime":"home","manga":null}},{"key":"FRAnime","name":"FRAnime","domain":"https://franime.fr","database":null,"search":{"anime":"https://franime.fr/recherche?search={searchtermPlus}","manga":null}},{"key":"FMTeam","name":"FMTeam","domain":"https://fmteam.fr","database":null,"search":{"anime":null,"manga":"home"}},{"key":"Animelon","name":"Animelon","domain":"https://www.animelon.com","database":null,"search":{"anime":"https://www.animelon.com/search?searchTerm={searchTerm}","manga":null}},{"key":"AnimeNoSub","name":"AnimeNoSub","domain":"https://animenosub.to","database":null,"search":{"anime":"https://animenosub.to/?s={searchtermPlus}","manga":null}},{"key":"AnimeSama","name":"AnimeSama","domain":"https://anime-sama.fr","database":null,"search":{"anime":"https://anime-sama.fr/catalogue/","manga":null}},{"key":"MangaFire","name":"MangaFire","domain":"https://mangafire.to","database":"MangaFire","search":{"anime":null,"manga":"https://mangafire.to/filter?keyword={searchtermPlus}"}},{"key":"projectsuki","name":"projectsuki","domain":"https://projectsuki.com","database":null,"search":{"anime":null,"manga":"https://projectsuki.com/search?q={searchtermPlus}"}},{"key":"AnimeBuff","name":"AnimeBuff","domain":"https://animebuff.ru","database":null,"search":{"anime":"https://animebuff.ru/search?q={searchtermPlus}","manga":null}},{"key":"AnimeOnegai","name":"AnimeOnegai","domain":"https://www.animeonegai.com","database":null,"search":{"anime":"https://www.animeonegai.com/es/search?q={searchterm}","manga":null}},{"key":"AnimeKO","name":"AnimeKO","domain":"https://animeko.co","database":null,"search":{"anime":"https://animeko.co/anime?search={searchtermPlus}","manga":null}},{"key":"AnimeGO","name":"AnimeGO","domain":"https://animego.org","database":null,"search":{"anime":"https://animego.org/search/all?q={searchterm}","manga":null}},{"key":"LuciferDonghua","name":"Lucifer Donghua","domain":"https://luciferdonghua.in","database":null,"search":{"anime":"https://luciferdonghua.in/?s={searchterm}","manga":null}},{"key":"NeoxScans","name":"NeoxScans","domain":"https://neoxscans.com/","database":null,"search":{"anime":null,"manga":"https://neoxscans.com/?post_type=wp-manga&s={searchtermPlus}"}},{"key":"HinataSoul","name":"HinataSoul","domain":"https://hinatasoul.com","database":null,"search":{"anime":"https://www.hinatasoul.com/busca?busca={searchtermPlus}","manga":null}},{"key":"OgladajAnime","name":"OgladajAnime","domain":"https://ogladajanime.pl","database":null,"search":{"anime":"https://ogladajanime.pl/search/name/{searchtermPlus}","manga":null}},{"key":"hachi","name":"hachi","domain":"https://hachi.moe","database":null,"search":{"anime":null,"manga":"https://hachi.moe/search?query={searchterm}"}},{"key":"WitAnime","name":"WitAnime","domain":"https://witanime.pics","database":null,"search":{"anime":"https://witanime.pics/?search_param=animes&s={searchtermPlus}","manga":null}},{"key":"Suwayomi","name":"Suwayomi","domain":"https://suwayomi-webui-preview.github.io/","database":null,"search":{"anime":null,"manga":"https://suwayomi-webui-preview.github.io/sources/all/search/?query={searchtermPlus}"}},{"key":"ManhuaUS","name":"ManhuaUS","domain":"https://manhuaus.com","database":null,"search":{"anime":null,"manga":"https://manhuaus.com/?s={searchterm}&post_type=wp-manga&op=&author=&artist=&release=&adult="}},{"key":"Taiyo","name":"Taiyo","domain":"https://taiyo.moe","database":null,"search":{"anime":null,"manga":"home"}},{"key":"AnimesOnline","name":"Animes Online","domain":"https://animesonline.in","database":null,"search":{"anime":"https://www.animesonline.in/busca?s={searchtermPlus}","manga":null}},{"key":"Miruro","name":"Miruro","domain":"https://www.miruro.to","database":null,"search":{"anime":"https://www.miruro.tv/search?query={searchterm}&sort=POPULARITY_DESC","manga":null}},{"key":"Latanime","name":"Latanime","domain":"https://latanime.org","database":null,"search":{"anime":"https://latanime.org/buscar?q={searchtermPlus}","manga":null}},{"key":"MangaRead","name":"MangaRead","domain":"https://www.mangaread.org","database":null,"search":{"anime":null,"manga":"https://www.mangaread.org/?s={searchtermPlus}&post_type=wp-manga"}},{"key":"Q1N","name":"Q1N","domain":"https://q1n.net","database":null,"search":{"anime":"https://q1n.net/?s={searchtermPlus}","manga":null}},{"key":"TempleScan","name":"TempleScan","domain":"https://templescan.net","database":null,"search":{"anime":null,"manga":"home"}},{"key":"ScyllaScans","name":"ScyllaScans","domain":"https://scyllacomics.xyz","database":null,"search":{"anime":null,"manga":"home"}},{"key":"VortexScans","name":"VortexScans","domain":"https://vortexscans.org","database":null,"search":{"anime":null,"manga":"home"}},{"key":"WeebCentral","name":"WeebCentral","domain":"https://weebcentral.com","database":"Weebcentral","search":{"anime":null,"manga":"https://weebcentral.com/search?text={searchterm}"}},{"key":"Kavita","name":"Kavita","domain":"https://demo.kavitareader.com","database":null,"search":{"anime":null,"manga":"home"}},{"key":"Rawkuma","name":"Rawkuma","domain":"https://rawkuma.com","database":null,"search":{"anime":null,"manga":"https://rawkuma.com/?s={searchtermPlus}"}},{"key":"Aninexus","name":"Aninexus","domain":"https://aninexus.to","database":null,"search":{"anime":"https://aninexus.to/search/{searchterm}","manga":null}},{"key":"AnimeKAI","name":"AnimeKAI","domain":"https://animekai.to","database":null,"search":{"anime":"https://animekai.to/browser?keyword={searchtermPlus}","manga":null}},{"key":"Hikari","name":"Hikari","domain":"https://watch.hikaritv.xyz","database":null,"search":{"anime":"https://watch.hikaritv.xyz/search?keyword={searchterm}","manga":null}},{"key":"AniDream","name":"AniDream","domain":"https://anidream.cc","database":null,"search":{"anime":"https://anidream.cc/archive/?title={searchtermPlus}","manga":null}}]')}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t,a;(a=e||(e={}))[a.NoState=0]="NoState",a[a.Watching=1]="Watching",a[a.Completed=2]="Completed",a[a.Onhold=3]="Onhold",a[a.Dropped=4]="Dropped",a[a.PlanToWatch=6]="PlanToWatch",a[a.All=7]="All",a[a.Rewatching=23]="Rewatching",function(e){e[e.NoScore=0]="NoScore",e[e.R1=1]="R1",e[e.R2=2]="R2",e[e.R3=3]="R3",e[e.R4=4]="R4",e[e.R5=5]="R5",e[e.R6=6]="R6",e[e.R7=7]="R7",e[e.R8=8]="R8",e[e.R9=9]="R9",e[e.R10=10]="R10"}(t||(t={}));var s=n(78584);let i;if(function(){try{return localStorage.getItem("x"),!0}catch(e){return s.info("Local storage is not available",e),!1}}())i=localStorage;else{let e={};i={getItem:t=>t in e?e[t]:null,setItem(t,n){e[t]=n},removeItem(t){t in e&&delete e[t]},clear(){e={}}}}const r=i;var o=n(13647);class l{constructor(e,t,n=!0,a=0){return this.key=e,this.ttl=t,this.localStorage=n,this.refetchTtl=a,this}containsValue(e){return null!=e}valueValid(e,t){return!(!e||!e.timestamp)&&(new Date).getTime()<e.timestamp+t}ttlValid(e){return this.valueValid(e,this.ttl)}refetchTtlValid(e){return this.valueValid(e,this.refetchTtl)}async hasValue(){const e=await this.getStorage();return!(!this.containsValue(e)||!this.ttlValid(e))}async hasValueAndIsNotEmpty(){const e=await this.getStorage();return!!(this.containsValue(e)&&void 0!==e.data&&null!==e.data&&Object.keys(e.data).length&&this.ttlValid(e))}async fullState(){const e=await this.getStorage(),t=this.containsValue(e)&&this.refetchTtlValid(e),n=this.ttlValid(e);return{value:e,hasValue:t,isValid:n,refetch:t&&!n}}async getValue(){return(await this.getStorage()).data}async setValue(e){const t={data:e,timestamp:(new Date).getTime()};return this.localStorage?r.setItem(this.key,JSON.stringify(t)):o.storage.set(this.key,t)}async clearValue(){return this.localStorage?r.removeItem(this.key):o.storage.remove(this.key)}async getStorage(){return this.localStorage?JSON.parse(r.getItem(this.key)):o.storage.get(this.key)}}var c=n(13647),h=n(26017),u=n(78584);async function m(e,t){if(!t)return{};const n=await c.request.xhr("GET",`https://api.malsync.moe/nc/mal/${e}/${t}/pr`);return JSON.parse(n.responseText)}var p=n(13647);const d={years:31536e6,months:2592e6,weeks:6048e5,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,milliseconds:1};class g{constructor(e=p.storage.lang("locale")){return this.isFallback=!Intl.DurationFormat,this.locale=e,this}setLocale(e){return this.locale=e,this}setDuration(e){return this.duration=e,this}setDurationFormatted(e,t="Duration"){const n=g.durationToMs(e);return this.setRelativeTime(n,"milliseconds",t),this}setRelativeTime(e,t,n="Duration"){const a=e*d[t];return this.duration=this.process(a,n),this}setTimestamp(e,t="Duration",n=Date.now()){const a=e-new Date(n).getTime();return this.setRelativeTime(a,"milliseconds",t),this}process(e,t){switch(t){case"Duration":return y(e,["seconds","minutes","hours","days"]).duration;case"Progress":if(!e)break;return function(e){let t=e.days||0;return e.years?e.years>1?e.days&&e.days>182?{years:e.years+1}:{years:e.years}:{years:e.years,days:e.days}:((e.months||e.weeks)&&(t+=e.months?30*e.months:0,t+=e.weeks?7*e.weeks:0),t?t>3?e.hours&&e.hours>11?{days:t+1}:{days:t}:{days:t,hours:e.hours}:e.hours?e.hours>5?e.minutes&&e.minutes>29?{hours:e.hours+1}:{hours:e.hours}:{hours:e.hours,minutes:e.minutes}:e.minutes&&e.minutes>14?{minutes:e.minutes}:{minutes:e.minutes||0,seconds:e.seconds||0})}(y(e,["seconds","minutes","hours","days","years"]).duration);case"M/H/D/Y":if(!e)break;return y(e,["minutes","hours","days","years"]).duration;default:return{}}return{}}static durationToMs(e){const t=Object.keys(e);let n=0;if(t.length<=0)return n;for(let a=0;a<t.length;a++){const s=t[a],i=e[s];n+=d[s]*i}return n||0}getRelativeText(e={style:"narrow"}){if(!this.duration)return"";if(this.isFallback)return function(e){let t="";return e.years&&(1===e.years?t+=` ${e.years} ${p.storage.lang("bookmarksItem_Year")}`:t+=` ${e.years} ${p.storage.lang("bookmarksItem_Years")}`),e.days&&(1===e.days?t+=` ${e.days} ${p.storage.lang("bookmarksItem_Day")}`:t+=` ${e.days} ${p.storage.lang("bookmarksItem_Days")}`),e.hours&&(1===e.hours?t+=` ${e.hours} ${p.storage.lang("bookmarksItem_Hour")}`:t+=` ${e.hours} ${p.storage.lang("bookmarksItem_Hours")}`),e.minutes&&(1===e.minutes?t+=` ${e.minutes} ${p.storage.lang("bookmarksItem_min")}`:t+=` ${e.minutes} ${p.storage.lang("bookmarksItem_mins")}`),e.seconds&&(1===e.seconds?t+=` ${e.seconds} ${p.storage.lang("bookmarksItem_sec")}`:t+=` ${e.seconds} ${p.storage.lang("bookmarksItem_secs")}`),t.trim()}(this.duration);const t=e;if("significantLongNarrow"===e.style){const e=Object.keys(d);for(let n=0;n<e.length;n++){const a=e[n];if(this.duration[a]){t[a]="long",t.style="narrow";break}}}return new Intl.DurationFormat(this.locale,t).format(this.duration)}getDuration(){return this.duration}getLocale(){return this.locale}}class f{constructor(e,t=p.storage.lang("locale")){if(this.locale=t,"string"==typeof e){const t=Number(e);if(!Number.isNaN(t))return this.date=new Date(t),this}return this.date=new Date(e),this}setDate(e){return this.date=new Date(e),this}setLocale(e){return this.locale=e,this}isValidDate(){return _(this.date)}isNow(){return function(e,t=Date.now(),n={seconds:30}){if(Number.isNaN(e))return!1;const a=new Date(t).getTime(),s=g.durationToMs(n);return!(Math.abs(e-a)>s)}(this.date.getTime())}isFuture(){return this.date.getTime()>Date.now()}getDate(){return this.date}getLocale(){return this.locale}getDateTimeText(e={dateStyle:"medium"}){return _(this.date)?new Intl.DateTimeFormat(this.locale,e).format(this.date):""}getRelativeNowText(e="Duration",t){if(!this.isValidDate())return"";const n=new g(this.locale);return n.setTimestamp(this.date.getTime(),e),n.getRelativeText(t)}getRelativeNowFriendlyText(e="Duration",t){if(!this.isValidDate())return"";if(this.isNow())return p.storage.lang("bookmarksItem_now");const n=this.getRelativeNowText(e,t);return this.isFuture()?n:p.storage.lang("bookmarksItem_ago",[n])}}function y(e,t=["minutes","hours","days","years"],n=0){const a={},s=new Date(n).getTime();let i=Math.abs(s-e);const r=e>s;for(const e in d){if(!t.includes(e))continue;const n=Math.floor(i/d[e]);a[e]=n}const o=Object.keys(a);for(let e=1;e<o.length;e++){const t=o[e-1],n=a[t],s=o[e];i-=d[t]*n;const r=Math.floor(i/d[s]);a[s]=r}return{duration:a,isFuture:r}}function _(e){if(!e)return!1;if("number"==typeof e)return!0;const t="string"==typeof e?new Date(e):e;return t instanceof Date&&!Number.isNaN(t.getTime())}var b=n(78584),w=n(13647);class v{constructor(e,t){return this.cacheKey=e,this.type=t,this.releaseItem=void 0,this.logger=b.m("progress").m(e.toString()),this}async initReleaseProgress(e){e&&await async function(e,t,n="default",a=u.m("release")){if(n||(n="default"),(a=a.m(e.uid.toString())).log(e.title,e.cacheKey,e.apiCacheKey,`Mode: ${n}`),!e.apiCacheKey)return void a.log("No Api Cache Id");if(!c.settings.get("epPredictions"))return void a.log("epPredictions disabled");const s=await c.storage.get(`release/${t}/${e.cacheKey}`);a.m("Load").log(s);let i,r=!1;if(s&&s.mode&&s.mode!==n&&(r=!0),s&&s.timestamp&&Date.now()-s.timestamp<12e4&&!r)return void a.log("Up to date");if(s&&s.finished&&s.timestamp&&Date.now()-s.timestamp<6048e5&&!r)return void a.log("Finished");if(s&&!s.value&&s.timestamp&&Date.now()-s.timestamp<864e5&&!r)return void a.log("Nulled");r&&a.log("Update forced"),"off"===n&&(a.log("Disabled"),e.xhr=[]),void 0!==e.xhr?i=e.xhr:(i=await m(t,e.apiCacheKey),await h.wait(500)),a.log(i);const o=function(e,t,n){const a={};if(!e.length)return null;let s;if("default"===t?(a.mainId="anime"===n?c.settings.get("progressIntervalDefaultAnime"):c.settings.get("progressIntervalDefaultManga"),a.fallback="en/sub"):a.mainId=t,a.fallbackPrediction="jp/dub",a.mainId){const t=e.find((e=>e.id===a.mainId));t&&(s=t)}if(a.fallback&&!s){const t=e.find((e=>e.id===a.fallback));t&&(s=t)}if(a.fallbackPrediction&&s&&!s.predicition&&s.lastEp&&s.lastEp.timestamp){const t=e.find((e=>e.id===a.fallbackPrediction)),n=s.lastEp.timestamp+6048e5;n&&t&&t.predicition&&(s.lastEp.total===t.lastEp.total?Math.abs(n-t.predicition.timestamp)<108e6&&(s.predicition={timestamp:n,probability:"medium"}):t.lastEp.total&&s.lastEp.total===t.lastEp.total-1&&Math.abs(n-(t.predicition.timestamp-6048e5))<108e6&&(s.predicition={timestamp:n,probability:"medium"}))}if(a.fallbackPrediction&&!s){const t=e.find((e=>e.id===a.fallbackPrediction));t&&t.lastEp&&t.predicition&&0===t.lastEp.total&&(s=t,s.predicition.probability="medium")}return s||null}(i,n,t);o||a.log("No value for the selected mode");let l=!1;o&&o.state&&"complete"===o.state&&(l=!0),a.m("Save").log(o),s&&s.value&&async function(e,t,n,a){try{if("anime"===a&&!c.settings.get("progressNotificationsAnime")||"manga"===a&&!c.settings.get("progressNotificationsManga"))return;if(e&&n&&n&&t.lastEp&&void 0!==t.lastEp.total&&n.lastEp&&n.lastEp.total&&t.lang===n.lang&&t.type===n.type&&t.lastEp.total<n.lastEp.total&&e.watchedEp+1===n.lastEp.total){let t;t=e.single?{title:e.title,text:c.storage.lang(`syncPage_malObj_nextEp_${a}`,[n.lastEp.total]),sticky:c.settings.get("notificationsSticky"),image:await e.single.getImage(),url:e.single.getStreamingUrl()?e.single.getStreamingUrl():e.single.getUrl()}:{title:e.title,text:c.storage.lang(`syncPage_malObj_nextEp_${a}`,[n.lastEp.total]),sticky:c.settings.get("notificationsSticky"),image:e.image,url:e.options&&e.options.u?e.options.u:e.url},c.request.notification(t)}}catch(e){u.error("Could not check notification Progress",e)}}(e,s.value,o,t),await c.storage.set(`release/${t}/${e.cacheKey}`,{timestamp:Date.now(),value:o,mode:n,finished:l})}(e,this.type,e.progressMode);const t=await w.storage.get(`release/${this.type}/${this.cacheKey}`);this.logger.m("Init Release").log(t),t&&(function(e){if(e&&e.timestamp){const t=(new Date).getTime()-e.timestamp;if(e.finished&&t<6048e5)return!1;if(!e.value&&t<864e5)return!1;if(t<864e5)return!1}return!0}(t)?this.logger.log("Too old"):this.releaseItem=t)}getProgressCurrentEpisode(){const e=this.releaseItem;return e&&e.value&&e.value.lastEp&&e.value.lastEp.total?e.value.lastEp.total:null}isProgressFinished(){const e=this.releaseItem;return!(!e||!e.finished)}getProgressPrediction(){const e=this.releaseItem;return e&&e.value&&e.value.predicition&&e.value.predicition.timestamp?e.value.predicition.timestamp:null}getProgressLastTimestamp(){const e=this.releaseItem;return e&&e.value&&e.value.lastEp&&e.value.lastEp.timestamp?e.value.lastEp.timestamp:null}async init(e=!1){return await Promise.all([this.initReleaseProgress(e)]),this}getCurrentEpisode(){return w.settings.get("epPredictions")?this.getProgressCurrentEpisode():null}isFinished(){return this.isProgressFinished()}isAiring(){return!this.isFinished()}getPredictionTimestamp(){return!this.getProgressPrediction()||(new Date).getTime()>this.getProgressPrediction()?NaN:this.getProgressPrediction()}getPrediction(){const e=Number(this.getPredictionTimestamp());return Number.isNaN(e)?"":new f(e).getRelativeNowFriendlyText("Progress",{style:"significantLongNarrow"})}getPredictionText(){const e=Number(this.getPredictionTimestamp());if(Number.isNaN(e))return"";const t=new f(Number(e)),n=t.getRelativeNowText("Progress",{style:"long"});return t.isValidDate()?t.isNow()?w.storage.lang("bookmarksItem_now"):w.storage.lang(`prediction_Episode_${this.type}`,[n]):""}getLastTimestamp(){return this.getProgressLastTimestamp()?this.getProgressLastTimestamp():NaN}getLast(){const e=Number(this.getLastTimestamp());return Number.isNaN(e)?"":new f(e).getRelativeNowFriendlyText("Progress",{style:"significantLongNarrow"})}getLastText(){const e=Number(this.getLastTimestamp());if(Number.isNaN(e))return"";const t=new f(Number(e)),n=t.getRelativeNowText("Progress",{style:"long"});return t.isValidDate()?t.isNow()?w.storage.lang("bookmarksItem_now"):w.storage.lang(`prediction_Last_${this.type}`,[n]):""}getAuto(){const e=this.getPrediction();if(e)return e;return this.getLast()||""}getAutoText(){const e=this.getPredictionText();if(e)return e;return this.getLastText()||""}getColor(){return"#f57c00"}getBars(e,t){const n=this.getCurrentEpisode(),a={totalWidth:100,epWidth:0,predWidth:0};if(!t)if(a.totalWidth=0,e&&(!n||e>=n))t=Math.ceil(1.2*e);else{if(!n||e&&!(e<n))return a;t=Math.ceil(1.2*n)}return e&&(a.epWidth=e/t*100,a.epWidth>100&&(a.epWidth=100)),n&&(a.predWidth=n/t*100,a.predWidth>100&&(a.predWidth=100)),a}}var E=n(53011),k=n(78584),S=n(13647);const T=Math.floor(1e9*Math.random()),x=new E.EventEmitter2({wildcard:!0});function I(e,...t){k.m("Global").m("Emit").debug(e,...t),x.emit(`${e}`,...t),void 0!==S&&S&&"webextension"===S.type&&chrome.runtime.sendMessage({name:"emitter",item:{event:e,params:t,id:T}})}void 0!==S&&S&&"webextension"===S.type&&(chrome.runtime.sendMessage({name:"registerEmitter"}),chrome.runtime.onMessage.addListener(((e,t,n)=>{e.name&&"emitter"===e.name&&(k.m("Global").m("Event").debug(e.item.id,e.item.event,e.item.params),e.item.id!==T&&x.emit(e.item.event,...e.item.params))}))),Error;class A extends Error{constructor(e){super(e),this.name="SafeError"}}Error,Error;var L=n(26017),N=n(13647);class R extends Error{constructor(e){super(e),this.name="NotAutenticatedError"}}class P extends Error{constructor(e){super(e),this.name="UrlNotSupportedError"}}class O extends Error{constructor(e){super(e),this.name="ServerOfflineError"}}class C extends Error{constructor(e){super(e),this.name="NotFoundError"}}class M extends Error{constructor(e){super(e),this.name="UnexpectedResponseError"}}function D(e){try{return JSON.parse(e)}catch(e){throw new M(e.message)}}function U(e,t){return e instanceof R?N.storage.lang("Error_Authenticate",[t]):e instanceof O?"Server Offline":e instanceof P?`Incorrect url provided [${e.message}]`:e instanceof C?"Could not find this entry":e.message}var F=n(13647);const j={ui:{module:"dropdown"},getOptions:()=>[{value:0,label:F.storage.lang("UI_Score_Not_Rated")},{value:100,label:F.storage.lang("UI_Score_Masterpiece")},{value:90,label:F.storage.lang("UI_Score_Great")},{value:80,label:F.storage.lang("UI_Score_VeryGood")},{value:70,label:F.storage.lang("UI_Score_Good")},{value:60,label:F.storage.lang("UI_Score_Fine")},{value:50,label:F.storage.lang("UI_Score_Average")},{value:40,label:F.storage.lang("UI_Score_Bad")},{value:30,label:F.storage.lang("UI_Score_VeryBad")},{value:20,label:F.storage.lang("UI_Score_Horrible")},{value:10,label:F.storage.lang("UI_Score_Appalling")}],valueToOptionValue:e=>e?e<10?10:10*Math.round(e/10):0,optionValueToValue:e=>e?Number(e):0};var z=n(78584),W=n(13647),H=n(26017),G=n(7263);Object.seal(x);class B{constructor(e){return this.url=e,this.type=null,this.syncMethod="normal",this.askCompleted=!1,this.rewatchingSupport=!0,this.datesSupport=!0,this.ids={mal:NaN,ani:NaN,kitsu:{id:NaN,slug:""},simkl:NaN},this.options=null,this.progress=!1,this.updateProgress=!1,this._onList=!1,this._authenticated=!1,this.handleUrl(e),this.logger=z.m("[S]","#348fff"),this}getType(){return this.type}getUrl(){return this.url}supportsRewatching(){return this.rewatchingSupport}supportsDates(){return this.datesSupport}getApiCacheKey(){return this.getKey(["ANILIST"])}getRulesCacheKey(){return this.getKey(["ANILIST","KITSU"],!1)}setStatus(e){return e=Number(e),this._setStatus(e),this}getStatus(){return this.isOnList()?this._getStatus():e.NoState}setStartDate(e){return this.supportsDates()&&this._setStartDate(e),this}getStartDate(){return this.supportsDates()?this._getStartDate():null}setFinishDate(e){return this.supportsDates()&&this._setFinishDate(e),this}getFinishDate(){return this.supportsDates()?this._getFinishDate():null}setRewatchCount(e){return this.supportsRewatching()&&this._setRewatchCount(e),this}getRewatchCount(){return this.supportsRewatching()?this._getRewatchCount():null}getScoreMode(){return j}setScore(e){return(e=parseInt(`${e}`))||(e=0),this._setScore(e),this}getScore(){return this._getScore()||0}setAbsoluteScore(e){return e=parseInt(`${e}`),this._setAbsoluteScore(e),this}getAbsoluteScore(){return this._getAbsoluteScore()||0}setEpisode(e){return e=parseInt(`${e}`),this.getTotalEpisodes()&&e>this.getTotalEpisodes()&&(e=this.getTotalEpisodes()),this._setEpisode(e),this}getEpisode(){return this._getEpisode()}setVolume(e){return this._setVolume(e),this}getVolume(){return this._getVolume()}setStreamingUrl(e){return this.options&&(this.options.u=e),this}getStreamingUrl(){if(this.options&&this.options.u)return this.options.u}cleanTags(){this.options=null}async initProgress(){const e=await m(this.getType(),this.getApiCacheKey());return new v(this.getCacheKey(),this.getType()).init({uid:this.getCacheKey(),apiCacheKey:this.getApiCacheKey(),title:this.getTitle(),cacheKey:this.getCacheKey(),progressMode:this.getProgressMode(),watchedEp:this.getEpisode(),single:this,xhr:e}).then((t=>{this.updateProgress=!1,this.progress=t,this.progressXhr=e}))}getProgress(){return!!this.progress&&this.progress}getProgressFormated(){const e=[],t=new Intl.DisplayNames("en",{type:"language"});return z.log(this.progressXhr),this.progressXhr&&Object.keys(this.progressXhr).length&&this.progressXhr.forEach((n=>{e.push({type:n.type,key:n.id,state:n.state,label:t.of(n.lang.replace(/^jp$/,"ja"))||n.lang,dropped:"dropped"===n.state||"discontinued"===n.state,episode:n.lastEp&&n.lastEp.total?n.lastEp.total:0,lastEp:n.lastEp,predicition:n.prediction})})),e}getProgressOptions(){return this.getProgressFormated().filter((e=>"complete"!==e.state))}getProgressCompleted(){return this.getProgressFormated().filter((e=>"complete"===e.state))}getProgressMode(){return this.options&&this.options.p?this.options.p:""}setProgressMode(e){this.options&&(this.options.p=e,this.updateProgress=!0),W.settings.get("malTags")||H.setEntrySettings(this.type,this.getCacheKey(),this.options,this._getTags()).then((()=>this.initProgress()))}getProgressKey(){let e=this.getProgressMode();if(e||(e="anime"===this.getType()?W.settings.get("progressIntervalDefaultAnime"):W.settings.get("progressIntervalDefaultManga")),!e)return null;const t=/^([^/]*)\/(.*)$/.exec(e);return t?{key:e,lang:t[1],type:t[2]}:null}getPageRelations(){const e=this.shortName,t=[];return this.ids.mal&&"MAL"!==e&&t.push({name:"MAL",icon:"https://cdn.myanimelist.net/images/favicon.ico",link:`https://myanimelist.net/${this.type}/${this.ids.mal}`}),this.ids.ani&&"AniList"!==e&&t.push({name:"AniList",icon:"https://anilist.co/img/icons/favicon-32x32.png",link:`https://anilist.co/${this.type}/${this.ids.ani}`}),this.ids.kitsu.id&&"Kitsu"!==e&&t.push({name:"Kitsu",icon:"https://kitsu.app/favicon-32x32-3e0ecb6fc5a6ae681e65dcbc2bdf1f17.png",link:`https://kitsu.app/${this.type}/${this.ids.kitsu.id}`}),this.ids.simkl&&"Simkl"!==e&&t.push({name:"Simkl",icon:"https://eu.simkl.in/img_favicon/v2/favicon-32x32.png",link:`https://simkl.com/${this.type}/${this.ids.simkl}`}),t}fillRelations(){return Promise.resolve()}update(){return this.logger.log("[SINGLE]","Update info",this.ids),this.lastError=null,this._update().catch((e=>{throw this.lastError=e,e})).then((()=>(this.persistanceState=this.getStateEl(),H.getEntrySettings(this.type,this.getCacheKey(),this._getTags())))).then((e=>{this.options=e,this.registerEvent(),this.emitUpdate("state")}))}async sync(){return this.logger.log("[SINGLE]","Sync",this.ids),this.lastError=null,this._setTags(await H.setEntrySettings(this.type,this.getCacheKey(),this.options,this._getTags())),this.fixDates(),this._sync().catch((e=>{throw this.lastError=e,e})).then((()=>{this.undoState=this.persistanceState,this.updateProgress&&this.initProgress(),this._onList=!0,this.emitUpdate()}))}emitUpdate(e="update"){I(`${e}.${this.getCacheKey()}`,{id:this.getPageId(),type:this.getType(),cacheKey:this.getCacheKey(),state:this.getStateEl(),meta:{title:this.getTitle(),image:this.getImage(),malId:this.getMalId(),totalEp:this.getTotalEpisodes(),url:this.getUrl()}})}async delete(){return this._delete().then((()=>{this._onList=!1,I(`delete.${this.getCacheKey()}`,{id:this.getPageId(),type:this.getType(),cacheKey:this.getCacheKey()})}))}registerEvent(){this.globalUpdateEvent||(this.globalUpdateEvent=x.on(`update.${this.getCacheKey()}`,(e=>this.updateEvent(e))))}updateEvent(e){this.isDirty()?this.logger.log("Ignore event"):e&&e.state&&(this.setStateEl(e.state),this.persistanceState=this.getStateEl(),x.emit("syncPage_fillUi"))}isDirty(){return JSON.stringify(this.persistanceState)!==JSON.stringify(this.getStateEl())||this.updateProgress}undo(){if(this.logger.log("[SINGLE]","Undo",this.undoState),!this.undoState)throw new A("No undo state found");if(!this.undoState.onList){if(void 0===this.delete)throw new Error("Deleting an entry is not supported");return this.delete().then((()=>{this.setStateEl(this.undoState),this.undoState=null}))}return this.setStateEl(this.undoState),this.sync().then((()=>{this.undoState=null}))}getTitle(e=!1){return this._getTitle(e)}getTotalEpisodes(){let e=this._getTotalEpisodes();return e||(e=0),e}getTotalVolumes(){return this._getTotalVolumes()}isOnList(){return this._onList}isAuthenticated(){return this._authenticated}getDisplayUrl(){return this._getDisplayUrl()}getMalUrl(){return Number.isNaN(this.ids.mal)?null:`https://myanimelist.net/${this.getType()}/${this.ids.mal}`}getMalId(){return Number.isNaN(this.ids.mal)?null:this.ids.mal}getIds(){return this.ids}getImage(){return this._getImage()}getRating(){return this._getRating().then((e=>e||"N/A"))}setResumeWatching(e,t){return H.setResumeWaching(e,t,this.type,this.getCacheKey())}getResumeWatching(){return this.options&&this.options.r?this.options.r:null}setContinueWatching(e,t){return H.setContinueWaching(e,t,this.type,this.getCacheKey())}getContinueWatching(){return this.options&&this.options.c?this.options.c:null}increaseRewatchCount(){}getStateEl(){return{onList:this.isOnList(),episode:this.getEpisode(),volume:this.getVolume(),status:this.getStatus(),startDate:this.getStartDate(),finishDate:this.getFinishDate(),rewatchCount:this.getRewatchCount(),score:this.getScore(),absoluteScore:this.getAbsoluteScore()}}setStateEl(e){this._onList=e.onList,this.setEpisode(e.episode),this.setVolume(e.volume),this.setStatus(e.status),this.setStartDate(e.startDate),this.setFinishDate(e.finishDate),this.setRewatchCount(e.rewatchCount),this.setScore(e.score),e.absoluteScore&&this.setAbsoluteScore(e.absoluteScore)}getStateDiff(){const e=this.getStateEl();if(e&&this.undoState){const t={};for(const n in e)e[n]!==this.undoState[n]&&(t[n]=e[n]);return t}}getSyncMethod(){return this.syncMethod}setSyncMethod(e){this.syncMethod=e}fixDates(){if(!this.supportsDates()||"listSync"===this.getSyncMethod())return;const t=(0,L.returnYYYYMMDD)();null===this.getStartDate()&&this._getStatus()===e.Watching&&this._getEpisode()>0&&this.setStartDate(t),null===this.getFinishDate()&&this._getStatus()===e.Completed&&(this.setFinishDate(t),null===this.getStartDate()&&this.setStartDate(t))}async lifeCycleHook(t){this.askCompleted&&("afterCheckSync"===t&&W.settings.get("askBefore")||"beforeSync"===t&&!W.settings.get("askBefore"))&&(this.askCompleted=!1,this.getStatus()===e.Rewatching?await this.finishRewatchingMessage():await this.finishWatchingMessage())}async checkSync(t,n){const a=this.getEpisode(),s=this.getStatus(),i=this.getVolume();return s===e.Completed?1===t&&this.startRewatchingMessage():!(a>=t&&!(void 0!==n&&(i||n>1||!t)&&n>i))&&(t&&t===this.getTotalEpisodes()?(this.askCompleted=!0,!0):s===e.Watching||s===e.Rewatching||this.startWatchingMessage())}async startWatchingMessage(){return H.flashConfirm(W.storage.lang(`syncPage_flashConfirm_start_${this.getType()}`),"add").then((t=>(t&&(this.setStatus(e.Watching),this.setStartDate((0,L.returnYYYYMMDD)())),t)))}async finishWatchingMessage(){const t=this.getScoreCheckboxValue();let n='<div><select id="finish_score" style="margin-top:5px; color:white; background-color:#4e4e4e; border: none;">';return this.getScoreCheckbox().forEach((e=>{n+=`<option value="${e.value}" ${t===e.value?"selected":""}>${e.label}</option>`})),n+="</select></div>",H.flashConfirm(W.storage.lang("syncPage_flashConfirm_complete")+n,"complete").then((t=>(t&&(this.setStatus(e.Completed),this.setFinishDate((0,L.returnYYYYMMDD)()),this.getStartDate()||this.setStartDate((0,L.returnYYYYMMDD)()),Number(G.$("#finish_score").val())>0&&(this.logger.log(`finish_score: ${G.$("#finish_score :selected").val()}`),this.handleScoreCheckbox(G.$("#finish_score :selected").val()))),t)))}async startRewatchingMessage(){return H.flashConfirm(W.storage.lang(`syncPage_flashConfirm_rewatch_start_${this.getType()}`),"add").then((t=>(t&&this.setStatus(e.Rewatching),t)))}async finishRewatchingMessage(){return H.flashConfirm(W.storage.lang(`syncPage_flashConfirm_rewatch_finish_${this.getType()}`),"complete").then((t=>(t&&(this.setStatus(e.Completed),this.increaseRewatchCount()),t)))}getScoreCheckbox(){return this.getScoreMode().getOptions()}getScoreCheckboxValue(){return this.getScoreMode().valueToOptionValue(this.getAbsoluteScore())}handleScoreCheckbox(e){this.setAbsoluteScore(this.getScoreMode().optionValueToValue(e))}getDisplayScoreCheckbox(){const e=this.getScoreCheckboxValue(),t=this.getScoreCheckbox().filter((t=>t.value===e));return t.length?t[0].label:""}getStatusCheckbox(){const t=[{value:e.Watching.toString(),label:W.storage.lang(`UI_Status_watching_${this.getType()}`)},{value:e.Completed.toString(),label:W.storage.lang("UI_Status_Completed")},{value:e.Onhold.toString(),label:W.storage.lang("UI_Status_OnHold")},{value:e.Dropped.toString(),label:W.storage.lang("UI_Status_Dropped")},{value:e.PlanToWatch.toString(),label:W.storage.lang(`UI_Status_planTo_${this.getType()}`)}];return this.supportsRewatching()&&t.push({value:e.Rewatching.toString(),label:W.storage.lang(`UI_Status_Rewatching_${this.getType()}`)}),t}handleStatusCheckbox(e){this.setStatus(e)}getStatusCheckboxValue(){return this.getStatus()}getKey(e,t=!0){return t&&this.ids.mal?this.ids.mal:this.ids.ani&&e.includes("ANILIST")?`anilist:${this.ids.ani}`:this.ids.kitsu.id&&e.includes("KITSU")?`kitsu:${this.ids.kitsu.id}`:this.ids.simkl&&e.includes("SIMKL")?`simkl:${this.ids.simkl}`:this.ids.mal}getLastError(){return this.lastError}getLastErrorMessage(){return this.errorMessage(this.getLastError())}flashmError(e){H.flashm(this.errorMessage(e),{error:!0,type:"error"})}errorMessage(e){return U(e,this.authenticationUrl)}}n(7263),n(26017),n(13647);var K=n(13647);const V="https://malsync.moe/mal/oauth";async function q(e){let t="https://api.myanimelist.net/v2/"+e.path;e.fields&&e.fields.length&&(t+=t.includes("?")?"&":"?",t+=`fields=${e.fields.join(",")}`);const n={Authorization:`Bearer ${K.settings.get("malToken")}`,"Content-Type":"application/x-www-form-urlencoded"};let a="";if(e.dataObj){const t=[];for(const n in e.dataObj){const a=encodeURIComponent(n),s=encodeURIComponent(e.dataObj[n]);t.push(`${a}=${s}`)}a=t.join("&")}return K.request.xhr(e.type,{url:t,headers:n,data:a}).then((async t=>{if(t.status>499&&t.status<600||0===t.status)throw new O(`Server Offline status: ${t.status}`);let n;try{n=JSON.parse(t.responseText)}catch(e){if(X(t.responseText))throw new Error(K.storage.lang("Error_Blocked",["MyAnimeList"]));throw e}if(n&&n.error)switch(n.error){case"forbidden":case"invalid_token":if(await async function(e){const t=e.m("Refresh");t.log("Refresh Access Token");const n=K.settings.get("malRefresh");return!!n&&K.request.xhr("POST",{url:"https://myanimelist.net/v1/oauth2/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:`client_id=10093a3f9f0174b6b5577c40e9accdae&grant_type=refresh_token&refresh_token=${n}`}).then((e=>{try{return D(e.responseText)}catch(t){if(X(e.responseText))throw new Error(K.storage.lang("Error_Blocked",["MyAnimeList"]));throw t}})).then((e=>e&&e.refresh_token&&e.access_token?(K.settings.set("malToken",e.access_token),K.settings.set("malRefresh",e.refresh_token),!0):e&&e.error?(t.error(e.error,"|",e.message),K.settings.set("malRefresh",""),!1):(t.error("Something went wrong"),!1)))}(this.logger))return this.apiCall(e);throw new R(n.message??n.error);case"not_found":throw new C(n.message??n.error);case"invalid_content":throw new Error("This Entry is currently pending approval. It can´t be saved to mal for now");default:throw new Error(n.message??n.error)}if(400===t.status)throw new Error("Invalid Parameters");return n}))}function X(e){return Boolean(e.includes("Request blocked")||e.includes("your IP has been banned"))}var Y,J;function Z(e){if(!e||!/^\d{4}(?:-\d\d){0,2}$/.test(e))return null;const t=e.substring(0,4);let n=e.substring(5,7);2!==n.length&&(n="01");let a=e.substring(8,10);return 2!==a.length&&(a="01"),`${t}-${n}-${a}`}!function(t){t[t.watching=e.Watching]="watching",t[t.completed=e.Completed]="completed",t[t.on_hold=e.Onhold]="on_hold",t[t.dropped=e.Dropped]="dropped",t[t.plan_to_watch=e.PlanToWatch]="plan_to_watch"}(Y||(Y={})),function(t){t[t.reading=e.Watching]="reading",t[t.completed=e.Completed]="completed",t[t.on_hold=e.Onhold]="on_hold",t[t.dropped=e.Dropped]="dropped",t[t.plan_to_read=e.PlanToWatch]="plan_to_read"}(J||(J={}));var Q,ee=n(78584),te=n(13647);ee.m("anilist","#3db4f2"),function(t){t[t.CURRENT=e.Watching]="CURRENT",t[t.PLANNING=e.PlanToWatch]="PLANNING",t[t.COMPLETED=e.Completed]="COMPLETED",t[t.DROPPED=e.Dropped]="DROPPED",t[t.PAUSED=e.Onhold]="PAUSED",t[t.REPEATING=e.Rewatching]="REPEATING"}(Q||(Q={}));var ne=n(78584),ae=n(26017);const se=class extends B{constructor(e){return super(e),this.url=e,this.displayUrl="",this.pending=!1,this.shortName="MAL",this.authenticationUrl=V,this.apiCall=q,this.logger=ne.m(this.shortName,"#2e51a2"),this}handleUrl(e){if(e.match(/myanimelist\.net\/(anime|manga)\/\d*/i))return this.type="anime"===ae.urlPart(e,3)?"anime":"manga",void(this.ids.mal=Number(ae.urlPart(e,4)));throw new P(e)}getCacheKey(){return this.ids.mal}getPageId(){return this.ids.mal}_getStatus(){let t;return t="manga"===this.type?parseInt(J[this.animeInfo.my_list_status.status]):parseInt(Y[this.animeInfo.my_list_status.status]),this.getRewatching()&&t===e.Completed?e.Rewatching:t}_setStatus(t){t===e.Rewatching?(t=e.Completed,this.setRewatching(!0)):this.setRewatching(!1),"manga"!==this.type?this.animeInfo.my_list_status.status=Y[t]:this.animeInfo.my_list_status.status=J[t]}increaseRewatchCount(){"manga"===this.type?this.animeInfo.my_list_status.num_times_reread++:this.animeInfo.my_list_status.num_times_rewatched++}_getStartDate(){return Z(this.animeInfo.my_list_status.start_date)}_setStartDate(e){this.animeInfo.my_list_status.start_date=e}_getFinishDate(){return Z(this.animeInfo.my_list_status.finish_date)}_setFinishDate(e){this.animeInfo.my_list_status.finish_date=e}_getRewatchCount(){return"manga"===this.type?this.animeInfo.my_list_status.num_times_reread:this.animeInfo.my_list_status.num_times_rewatched}_setRewatchCount(e){"manga"===this.type?this.animeInfo.my_list_status.num_times_reread=e:this.animeInfo.my_list_status.num_times_rewatched=e}_getScore(){return this.animeInfo.my_list_status.score}_setScore(e){this.animeInfo.my_list_status.score=e}_getAbsoluteScore(){return 10*this.getScore()}_setAbsoluteScore(e){e?e<10?this.setScore(1):this.setScore(Math.round(e/10)):this.setScore(0)}_getEpisode(){return"manga"===this.type?this.animeInfo.my_list_status.num_chapters_read:this.animeInfo.my_list_status.num_watched_episodes}_setEpisode(e){e||(e=0),"manga"!==this.type?this.animeInfo.my_list_status.num_watched_episodes=e:this.animeInfo.my_list_status.num_chapters_read=e}_getVolume(){return"manga"===this.type?this.animeInfo.my_list_status.num_volumes_read:0}_setVolume(e){"manga"===this.type&&(this.animeInfo.my_list_status.num_volumes_read=e)}_getTags(){return this.animeInfo.my_list_status.tags.length?this.animeInfo.my_list_status.tags.join(","):""}_setTags(e){e&&","!==e.trim()?this.animeInfo.my_list_status.tags=e.split(","):this.animeInfo.my_list_status.tags=[]}getRewatching(){return"manga"===this.type?this.animeInfo.my_list_status.is_rereading:this.animeInfo.my_list_status.is_rewatching}setRewatching(e){"manga"!==this.type?this.animeInfo.my_list_status.is_rewatching=e:this.animeInfo.my_list_status.is_rereading=e}_getTitle(){return this.animeInfo.title}_getTotalEpisodes(){return"manga"===this.type?this.animeInfo.num_chapters:this.animeInfo.num_episodes}_getTotalVolumes(){return"manga"===this.type?this.animeInfo.num_volumes:0}_getDisplayUrl(){return this.url}_getImage(){return this.animeInfo.main_picture?.medium??""}_getRating(){return Promise.resolve(this.animeInfo.mean)}async _update(){return this.apiCall({type:"GET",path:`${this.type}/${this.ids.mal}`,fields:["my_list_status{tags,is_rewatching,is_rereading,num_times_rewatched,num_times_reread,start_date,finish_date}","num_episodes","mean","num_chapters","num_volumes"]}).catch((e=>{throw e instanceof R&&(this._authenticated=!1),e})).then((e=>{this.logger.m("Api").log(e),this._authenticated=!0,this.animeInfo=e,this._onList=!0,this.animeInfo.my_list_status||(this._onList=!1,"manga"===this.type?this.animeInfo.my_list_status={is_rereading:!1,num_chapters_read:0,num_volumes_read:0,num_times_reread:0,score:0,status:"plan_to_read",tags:[]}:this.animeInfo.my_list_status={is_rewatching:!1,num_watched_episodes:0,num_times_rewatched:0,score:0,status:"plan_to_watch",tags:[]}),this.animeInfo.my_list_status&&void 0!==this.animeInfo.my_list_status.num_episodes_watched&&(this.animeInfo.my_list_status.num_watched_episodes=this.animeInfo.my_list_status.num_episodes_watched,delete this.animeInfo.my_list_status.num_episodes_watched)}))}async _sync(){const e={};for(const t in this.animeInfo.my_list_status)switch(t){case"priority":case"num_watched_episodes":case"num_volumes_read":case"num_chapters_read":case"score":case"is_rewatching":case"is_rereading":case"num_times_rewatched":case"num_times_reread":case"rewatch_value":case"reread_value":case"tags":case"comments":case"status":e[t]=this.animeInfo.my_list_status[t];break;case"start_date":case"finish_date":e[t]=this.animeInfo.my_list_status[t]??""}return this.logger.m("Sync").log(this.ids.mal,e),this.apiCall({type:"PUT",path:`${this.type}/${this.ids.mal}/my_list_status`,dataObj:e}).then((e=>{this.logger.m("Sync").log("res",e)}))}_delete(){return this.apiCall({type:"DELETE",path:`${this.type}/${this.ids.mal}/my_list_status`})}async fillRelations(){const e=new l(`fillRelations/${this.ids.mal}/${this.getType()}`,6048e5);return e.hasValueAndIsNotEmpty().then((t=>t?e.getValue().then((e=>{e&&e.da&&parseInt(e.da)&&(this.ids.ani=parseInt(e.da))})):function(e,t){const n={id:e,type:t.toUpperCase()};return te.request.xhr("POST",{url:"https://graphql.anilist.co",headers:{"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify({query:"\n  query ($id: Int, $type: MediaType) {\n    Media (idMal: $id, type: $type) {\n      id\n      idMal\n    }\n  }\n  ",variables:n})}).then((e=>{if(404===e.status)return NaN;const t=D(e.responseText);return ee.log(t),t.data.Media.id}))}(this.ids.mal,this.getType()).then((t=>(t&&parseInt(t)&&(this.ids.ani=parseInt(t)),e.setValue({da:t}))))))}};var ie=n(13647),re=n(78584),oe=n(26017);Object.seal(x);class le{constructor(e=1,t="anime",n="default"){return this.status=e,this.listType=t,this.sort=n,this.done=!1,this.loading=!1,this.firstLoaded=!1,this.seperateRewatching=!1,this.modes={frontend:!1,sortAiring:!1,initProgress:!1,cached:!1},this.username="",this.offset=0,this.templist=[],this.api=ie,this.cacheObj=void 0,this.status=Number(this.status),this.logger=re.m("[S]","#348fff"),this}setTemplist(e){return this.templist=e,this}getTemplist(){return this.templist}setSort(e){if(this.firstLoaded||this.loading)throw"To late to change sort";this.sort=e}isDone(){return this.done}isLoading(){return this.loading}isFirstLoaded(){return this.firstLoaded}async getCompleteList(){do{await this.getNext()}while(!this.done);return this.modes.sortAiring&&await this.sortAiringList(),this.modes.cached&&this.getCache().setValue(this.templist.slice(0,18)),this.firstLoaded=!0,this.templist}async getNextPage(){return this.done?this.templist:!this.modes.frontend||1!==this.status||"default"!==this.sort&&"unread"!==this.sort?(await this.getNext(),this.modes.cached&&this.getCache().setValue(this.templist.slice(0,24)),this.firstLoaded=!0,this.templist):(this.modes.sortAiring=!0,this.getCompleteList())}async getNext(){this.loading=!0;const e=await this.getPart();this.templist=this.templist.concat(e),this.loading=!1}async getCached(){if(await this.getCache().hasValue()){const e=await this.getCache().getValue();return e.forEach((e=>{(e=this.fn(e)).watchedEp="",e.score=""})),e}return[]}initFrontendMode(){this.modes.frontend=!0,this.updateListener=x.on("update.*",(e=>{if(re.log("update",e),e.cacheKey){const t=this.templist.find((t=>t.cacheKey===e.cacheKey));re.log(t),t&&e.state&&(t.watchedEp=e.state.episode,t.score=e.state.score,t.status=e.state.status)}}),{objectify:!0})}destroy(){this.updateListener&&this.updateListener.off()}getUsername(){return this.getUserObject().then((e=>e.username))}getSortingOptions(e=!1){const t=[{icon:"filter_list",title:ie.storage.lang("settings_progress_default"),value:"default"}];return 1===this.status&&"manga"===this.listType&&t.push({icon:"adjust",title:ie.storage.lang("list_sorting_unread"),value:"unread"}),this._getSortingOptions().forEach((n=>{if(!e){if(n.asc){const e={...n};delete e.asc,e.value+="_asc",e.title+=" Ascending",t.push(e)}delete n.asc}t.push(n)})),t}flashmError(e){oe.flashm(this.errorMessage(e),{error:!0,type:"error"})}errorMessage(e){return U(e,this.authenticationUrl)}async fn(e,t=""){let n=null;return e.fn={continueUrl:()=>null!==n?n:oe.getContinueWaching(e.type,e.cacheKey).then((t=>{const a=parseInt(e.watchedEp.toString());return void 0===t||t.ep!==a+1?"":(n=t.url,n)})),initProgress:()=>new v(e.cacheKey,e.type).init().then((t=>{e.fn.progress=t})),progress:!1},e.options=await oe.getEntrySettings(e.type,e.cacheKey,e.tags),t&&(e.options.u=t),(this.modes.sortAiring||this.modes.initProgress)&&await e.fn.initProgress(),e}async initProgress(){const e=[];this.templist.forEach((t=>{e.push(t.fn.initProgress())})),await Promise.all(e)}async sortAiringList(){if("unread"===this.sort)return void this.sortUnread();const e=[];let t=[],n=[];function a(e,t){let n=e.fn.progress.getPredictionTimestamp(),a=t.fn.progress.getPredictionTimestamp();return n||(n=999999999999),a||(a=n),n-a}this.templist.forEach((a=>{const s=a.fn.progress;"anime"===this.listType?s&&s.isAiring()&&s.getPredictionTimestamp()?a.watchedEp<s.getCurrentEpisode()?t.push(a):n.push(a):e.push(a):s&&s.isAiring()&&s.getCurrentEpisode()&&a.watchedEp&&a.watchedEp<s.getCurrentEpisode()&&a.watchedEp+6>s.getCurrentEpisode()?t.push(a):e.push(a)})),t=t.sort(a).reverse(),n=n.sort(a),this.templist=t.concat(n,e)}sortUnread(){this.templist=this.templist.sort((function(e,t){let n=1e4,a=1e4;if(e.fn.progress&&e.fn.progress.getCurrentEpisode()){const t=e.fn.progress.getCurrentEpisode()-e.watchedEp;t>0&&(n=t)}if(t.fn.progress&&t.fn.progress.getCurrentEpisode()){const e=t.fn.progress.getCurrentEpisode()-t.watchedEp;e>0&&(a=e)}return n-a}))}getCache(){return this.cacheObj||(this.cacheObj=new l(`list/${this.name}/${this.listType}/${this.status}/${this.sort}`,1728e5)),this.cacheObj}}var ce=n(13647);class he extends le{constructor(){super(...arguments),this.name="MyAnimeList",this.authenticationUrl="https://myanimelist.net/login.php"}async getUserObject(){throw"no"}_getSortingOptions(){return[{icon:"sort_by_alpha",title:"Alphabetic",value:ce.storage.lang("list_sorting_alpha"),asc:!0},{icon:"history",title:ce.storage.lang("list_sorting_history"),value:"updated",asc:!0},{icon:"score",title:ce.storage.lang("list_sorting_score"),value:"score",asc:!0}]}getOrder(e){let t="";switch(e.endsWith("_asc")&&(t="-"),e.replace("_asc","")){case"alpha":return t+1;case"updated":return t+5;case"score":return t+4;default:return 1===this.status||6===this.status?this.getOrder("updated"):this.getOrder("alpha")}}async getPart(){throw"no"}async prepareData(e){const t=[];for(let n=0;n<e.length;n++){const a=e[n];"anime"===this.listType?t.push(await this.fn({uid:a.anime_id,malId:a.anime_id,apiCacheKey:a.anime_id,cacheKey:a.anime_id,type:this.listType,title:a.anime_title,url:`https://myanimelist.net${a.anime_url}`,watchedEp:a.num_watched_episodes,totalEp:a.anime_num_episodes,status:a.status,score:a.score,image:a.anime_image_path,tags:a.tags,airingState:a.anime_airing_status})):t.push(await this.fn({uid:a.manga_id,malId:a.manga_id,apiCacheKey:a.manga_id,cacheKey:a.manga_id,type:this.listType,title:a.manga_title,url:`https://myanimelist.net${a.manga_url}`,watchedEp:a.num_read_chapters,totalEp:a.manga_num_chapters,status:a.status,score:a.score,image:a.manga_image_path,tags:a.tags,airingState:a.anime_airing_status}))}return t}}var ue=n(13647),me=n(78584);const pe=class extends le{constructor(){super(...arguments),this.name="MyAnimeList",this.authenticationUrl=V,this.limit=100,this.apiCall=q}async getUserObject(){return this.apiCall({type:"GET",path:"users/@me"}).then((e=>({username:e.name,picture:e.picture,href:`https://myanimelist.net/profile/${e.name}`})))}deauth(){return ue.settings.set("malToken","").then((()=>ue.settings.set("malRefresh","")))}_getSortingOptions(){return[{icon:"sort_by_alpha",title:ue.storage.lang("list_sorting_alpha"),value:"alpha"},{icon:"history",title:ue.storage.lang("list_sorting_history"),value:"updated"},{icon:"score",title:ue.storage.lang("list_sorting_score"),value:"score"},{icon:"calendar_month",title:ue.storage.lang("list_sorting_airing_date"),value:"airing_date"}]}getOrder(t){switch(t){case"alpha":return`${this.listType}_title`;case"updated":return"list_updated_at";case"score":return"list_score";case"airing_date":return`${this.listType}_start_date`;default:return this.status===e.Watching||this.status===e.PlanToWatch?this.getOrder("updated"):this.getOrder("alpha")}}async getPart(){this.limit=100,this.modes.frontend&&(this.limit=24);const t=this.getOrder(this.sort);let n="";t&&(n=`&sort=${t}`),me.log("[UserList][MAL]",`username: ${this.username}`,`status: ${this.status}`,`offset: ${this.offset}`,`sorting: ${n}`);let a="";this.status!==e.All&&(a="manga"===this.listType?`&status=${J[this.status]}`:`&status=${Y[this.status]}`);const s=ue.settings.get("forceEnglishTitles");return this.apiCall({type:"GET",path:`users/@me/${this.listType}list?nsfw=true&limit=${this.limit}&offset=${this.offset}${a}${n}`,fields:["list_status{tags,is_rewatching,is_rereading,start_date,finish_date,num_times_rewatched,num_times_reread}","num_episodes","num_chapters","num_volumes",s?"alternative_titles":""]}).then((e=>(e.paging&&e.paging.next?this.offset+=this.limit:this.done=!0,this.prepareData(e.data))))}async prepareData(e){const t=[],n=ue.settings.get("forceEnglishTitles");for(let a=0;a<e.length;a++){const s=e[a];"anime"===this.listType?t.push(await this.fn({uid:s.node.id,malId:s.node.id,apiCacheKey:s.node.id,cacheKey:s.node.id,type:this.listType,title:n&&s.node.alternative_titles.en||s.node.title,url:`https://myanimelist.net/${this.listType}/${s.node.id}`,score:s.list_status.score,watchedEp:s.list_status.num_episodes_watched,totalEp:s.node.num_episodes,status:parseInt(Y[s.list_status.status]),startDate:Z(s.list_status.start_date),finishDate:Z(s.list_status.finish_date),rewatchCount:s.list_status.num_times_rewatched,image:s.node.main_picture?.medium??"",imageLarge:s.node.main_picture?.large||s.node.main_picture?.medium||"",tags:s.list_status.tags.length?s.list_status.tags.join(","):"",airingState:s.anime_airing_status})):t.push(await this.fn({uid:s.node.id,malId:s.node.id,apiCacheKey:s.node.id,cacheKey:s.node.id,type:this.listType,title:n&&s.node.alternative_titles.en||s.node.title,url:`https://myanimelist.net/${this.listType}/${s.node.id}`,score:s.list_status.score,watchedEp:s.list_status.num_chapters_read,readVol:s.list_status.num_volumes_read,totalEp:s.node.num_chapters,totalVol:s.node.num_volumes,status:parseInt(J[s.list_status.status]),startDate:Z(s.list_status.start_date),finishDate:Z(s.list_status.finish_date),rewatchCount:s.list_status.num_times_reread,image:s.node.main_picture?.medium??"",imageLarge:s.node.main_picture?.large||s.node.main_picture?.medium||"",tags:s.list_status.tags.length?s.list_status.tags.join(","):"",airingState:s.anime_airing_status}))}return t}};var de=n(13647),ge=n(78584);const fe=n(52163);function ye(e,t,n){return function(e,t){let n=t.replace(/^\[l\]/i,"").trim(),a=[];const s=e.match(/{searchterm(\(.\))?(\[[^[\]]*\])?}/);if(!s)return e;const[i,r,o]=s;return o&&(a=o.substring(1,o.length-1).split(",")),a.includes("noLowercase")||(n=n.toLowerCase()),a.includes("noSpecial")?n=n.replace(/[^a-zA-Z\d ]/g,"").replace(/ +/g," ").trim():a.includes("specialReplace")&&(n=n.replace(/[^a-zA-Z\d ]/g," ").replace(/ +/g," ").trim()),n=a.includes("noEncode")?n.replace(/\//g," "):encodeURIComponent(n),r&&(n=n.replace(/(%20| )/g,r[1])),e.replace(i,n)}(e.replace("{searchtermPlus}","{searchterm(+)}").replace("{searchtermMinus}","{searchterm(-)}").replace("{searchtermUnderscore}","{searchterm(_)}").replace("{searchtermRaw}","{searchterm[noEncode,noLowercase]}").replace("{cacheId}",n),t)}let _e=null;function be(){const e=de.settings.get("quicklinks").map((e=>{return(t=e)?t.custom?t:function(){if(_e)return _e;const e=Object.values(de.settings.getStaticChibi()).map((e=>({key:e.key,name:e.name,domain:"string"==typeof e.domain?e.domain:e.domain[0],database:e.database||null,search:"object"==typeof e.search?e.search:{anime:"anime"===e.type&&e.search||null,manga:"manga"===e.type&&e.search||null}})));return _e=[...fe,...e],_e}().find((e=>e.name===t)):null;var t})).filter((e=>e));return JSON.parse(JSON.stringify(e))}async function we(e,t,n){let a=be();if(t)try{a=await async function(e,t,n){const a=await async function(e,t){const n=`https://api.malsync.moe/mal/${e}/${t}`;return de.request.xhr("GET",n).then((async e=>{if(ge.log("malSync response",e),400===e.status)return{};if(200===e.status){const t=JSON.parse(e.responseText);return t&&t.Sites?t.Sites:{}}throw new Error("malsync offline")}))}(t,n);return e.map((e=>(e.database&&a[e.database]&&(e.databaseLinks=a[e.database]),e)))}(a,e,t)}catch(e){ge.m("API Problem").error(e)}return function(e,t,n,a){return e.filter((e=>e.search&&e.search[t])).map((e=>{const s=[];let i;return e.databaseLinks?(i="link",Object.values(e.databaseLinks).forEach((e=>{s.push({name:e.title,url:e.url})}))):"home"===e.search[t]?(i="home",s.push({name:"Homepage",url:e.domain})):(i="search",s.push({name:"Quicksearch",url:ye(e.search[t],n,a),fn:n=>ye(e.search[t],n,a)})),{name:e.name,domain:e.domain,group:i,links:s}}))}(a,e,n,t)}var ve=n(26017),Ee=n(78584),ke=n(13647),Se=n(7263);class Te{constructor(e){let t;this.url=e,this.page=null,this.id=null,this.type=null,this.username=null,e.indexOf("myanimelist.net/anime.php")>-1&&(t=`/anime/${ve.urlParam(this.url,"id")}`,window.history.replaceState(null,null,t),this.url=ve.absoluteLink(t,"https://myanimelist.net")),e.indexOf("myanimelist.net/manga.php")>-1&&(t=`/manga/${ve.urlParam(this.url,"id")}`,window.history.replaceState(null,null,t),this.url=ve.absoluteLink(t,"https://myanimelist.net"));const n=ve.urlPart(this.url,3);"anime"!==n&&"manga"!==n||(this.page="detail",this.id=Number(ve.urlPart(this.url,4)),this.type=n),"animelist"!==n&&"mangalist"!==n||(this.page="bookmarks",this.username=ve.urlPart(this.url,4),this.type="animelist"===n?"anime":"manga"),"character"===n&&(this.page="character"),"people"===n&&(this.page="people"),"search"===n&&(this.page="search")}async init(){switch(await(0,L.waitForPageToBeVisible)(),Ee.log(this),this.page){case"detail":this.thumbnails(),this.streamingUI(),this.malToKiss(),this.related(),this.friendScore(),this.relatedTag();break;case"bookmarks":$(document).ready((()=>{$("#mal_cs_powered").length?this.page="classic":this.page="modern",this.init()}));break;case"modern":case"classic":this.bookmarks();break;case"character":this.relatedTag();case"people":case"search":this.thumbnails();break;default:Ee.log("This page has no scipt")}}thumbnails(){if(Ee.log("Lazyloaded Images"),this.url.indexOf("/pics")>-1)return;if(this.url.indexOf("/pictures")>-1)return;if("0"===ke.settings.get("malThumbnail"))return;const e=parseInt(ke.settings.get("malThumbnail")),t=Math.floor(e/144*100),n=e+4,a=t+4;ke.storage.addStyle(`.picSurround img:not(.noKal){height: ${e}px !important; width: ${t}px !important;}`),ke.storage.addStyle(".picSurround img.lazyloaded.kal{width: auto !important;}"),ke.storage.addStyle(`.picSurround:not(.noKal) a{height: ${n}px; width: ${a}px; overflow: hidden; display: flex; justify-content: center;}`),ke.storage.addStyle(`.picSurround img[src*="userimages"]{max-width: ${t}px !important}`);let s=0;try{$(window).load((function(){i()}))}catch(e){Ee.info(e)}try{window.onload=function(){i()}}catch(e){Ee.info(e)}try{document.onload=function(){i()}}catch(e){Ee.info(e)}try{$(document).ready((function(){i()}))}catch(e){Ee.info(e)}function i(){if(s)return;s=1;const e=document.querySelectorAll(".picSurround img:not(.kal)");let t="";for(let n=0;n<e.length;n++){const a=/\/r\/\d*x\d*/g;t=e[n].hasAttribute("data-src")?e[n].getAttribute("data-src"):e[n].getAttribute("src"),a.test(t)||/voiceactors.*v.jpg$/g.test(t)||-1!==t.indexOf("questionmark")?(t=ve.handleMalImages(t),t.indexOf("100x140")>-1||(e[n].setAttribute("data-src",t),t=t.replace(/v.jpg$/g,".jpg"),e[n].setAttribute("data-srcset",t.replace(a,"")),e[n].classList.add("lazyload")),e[n].classList.add("kal")):(e[n].closest(".picSurround").classList.add("noKal"),e[n].classList.add("kal"),e[n].classList.add("noKal"))}}}bookmarksHDimages(){const e=document.querySelectorAll('img[src*="/96x136/"]');for(let t=0;t<e.length;t++){const n=/\/r\/\d*x\d*/g,a=e[t].getAttribute("src");e[t].setAttribute("src",a.replace(n,""))}}setEpPrediction(e){e&&e.isAiring()&&e.getCurrentEpisode()&&($(".mal-sync-pre-remove, .mal-sync-ep-pre").remove(),$("#addtolist").prev().before(Se.html(`<div class="mal-sync-pre-remove">${e.getAutoText()}</div>`)),$('[id="curEps"], [id="totalChaps"]').before(Se.html(`<span class="mal-sync-ep-pre" title="${e.getAutoText()}">[<span style="border-bottom: 1px dotted ${e.getColor()};">${e.getCurrentEpisode()}</span>]</span> `)))}getImage(){return $(".leftside img").first().attr("src")||""}getTitle(){return($('meta[property="og:title"]').first().attr("content").trim()||"").replace(/(^watch|episode \d*$)/gi,"").trim()}async malToKiss(){$(document).ready((()=>{Ee.log("malToKiss");const e=this.getTitle();we(this.type,this.id,e).then((e=>{let t="";e.forEach((e=>{let n="";e.links.forEach((e=>{n+=`<div class="mal_links" style="word-break: break-all;"><a target="_blank" href="${e.url}">${e.name}</a></div>`})),t+=`<h2 id="${e.name}Links" class="mal_links"><img src="${ve.favicon(e.domain)}"> ${e.name}<span title="${e.name}" class="remove-mal-sync" style="float: right; font-weight: 100; line-height: 2; cursor: pointer; color: grey;">x</span></h2>`,t+=n,t+='<br class="mal_links" />'})),"below"===ke.settings.get("quicklinksPosition")?$('h2:contains("External Links")').length?$('h2:contains("External Links")').before(Se.html(t)):$('h2:contains("Information")').parent().find("div.mt16").last().before(Se.html(t)):$('h2:contains("Information")').before(Se.html(t)),$(".remove-mal-sync").click((function(){const e=$(this).attr("title");!function(e){const t=de.settings.get("quicklinks");de.settings.set("quicklinks",function(e,t){return t?e.filter((e=>!(!e||e===t||"object"==typeof e&&e.name===t))):e}(t,e))}(String(e)),window.location.reload()}))}))}))}async streamingUI(){Ee.log("Streaming UI");const e=new se(this.url);try{await e.update()}catch(e){return void Ee.error("Could not get Single",e)}this.pageRelation(e);const t=e.getStreamingUrl();t&&$(document).ready((async function(){$(".breadcrumb").first().append(Se.html(`\n        <div class="data title progress" id="mal-sync-stream-div" style="padding-left: 5px; display: inline-block; position: relative; top: -12px; height: 0px;">\n          <a class="mal-sync-stream" title="${t?t.split("/")[2]:""}" target="_blank" style="margin: 0 0; display: inline-block; height: 0;" href="${t}">\n            <img style="display: block;" src="${ve.favicon(t?t.split("/")[2]:"")}">\n          </a>\n        </div>`));const n=e.getResumeWatching(),a=e.getContinueWatching();Ee.log("Resume",n,"Continue",a),a&&a.ep===e.getEpisode()+1?$("#mal-sync-stream-div").append(Se.html(`<a class="nextStream" title="${ke.storage.lang(`overview_Continue_${e.getType()}`)}" target="_blank" style="margin: 0 5px 0 0; color: #BABABA; display: inline-block; height: 0;" href="${a.url}">\n              <img style="display: block;" src="${ke.storage.assetUrl("double-arrow-16px.png")}" width="16" height="16">\n            </a>`)):n&&n.ep===e.getEpisode()&&$("#mal-sync-stream-div").append(Se.html(`<a class="resumeStream" title="${ke.storage.lang(`overview_Resume_Episode_${e.getType()}`)}" target="_blank" style="margin: 0 5px 0 0; color: #BABABA; display: inline-block; height: 0;" href="${n.url}">\n              <img style="display: block;" src="${ke.storage.assetUrl("arrow-16px.png")}" width="16" height="16">\n            </a>`))})),await e.initProgress(),this.setEpPrediction(e.getProgress()),setInterval((()=>{this.setEpPrediction(e.getProgress())}),6e4)}async pageRelation(e){await e.fillRelations(),e.getPageRelations().forEach((e=>{$("#horiznav_nav > ul").append(Se.html(`\n          <li style="position: relative; height: 12px; display: inline-block;">\n            <a href="${e.link}" target="_blank" title="${e.name}" class="link" style="position: absolute; bottom: -5px; width: 16px; text-align: center;">\n              <img src="${e.icon}" width="16" width="16">\n            </a>\n          </li>\n        `))}))}bookmarks(){Ee.log(`Bookmarks [${this.username}][${this.page}]`);const e=this,t=new pe(7,this.type),n=new he(7,this.type);let a;if("modern"===this.page)a={bookReady(t){ve.waitUntilTrue((function(){return"none"===$("#loading-spinner").css("display")}),(async function(){t(await n.prepareData($.parseJSON($(".list-table").attr("data-items")))),ve.changeDetect((()=>{$(".tags span a").each((function(t){if(void 0!==ve.getUrlFromTags($(this).text())){const t=$(this).parent().parent().parent().parent();$(this).parent().remove(),s(e.type,t.find(".title .link").first().attr("href"),$(this).text(),parseInt(t.find(".progress .link").first().text()),t.find(".title .link").first().attr("href").split("/")[1])}}))}),(()=>$(".list-table > *").length))}))},getElement:e=>$(`.list-item a[href^="${e}"]`).parent().parent(".list-table-data"),streamingSelector:".data.title .link",cleanTags(){$(".tags span a").each((function(e){void 0!==ve.getUrlFromTags($(this).text())&&$(this).parent().remove()}))},predictionPos(e,t){e.find(".data.progress span, .data.chapter span").first().after(Se.html(t))}};else{if("classic"!==this.page)return void Ee.error("Bookmark type unknown");a={bookReady(e){t.getCompleteList().then((t=>{e(t)})).catch((e=>{Ee.error(e),t.flashmError(e)}))},getElement:e=>$(`a[href^="${e}"]`),streamingSelector:"span",cleanTags(){$('span[id^="tagLinks"] a').each((function(e){void 0!==ve.getUrlFromTags($(this).text())&&$(this).remove()}))},predictionPos(e,t){e.parent().parent().find('span[id^="epText"] a span, span[id^="chap"]').first().after(Se.html(t))}}}async function s(e,t,n,s,i){const r=await ve.getEntrySettings(e,i,n);if(r&&r.u){const e=a.getElement(t);e.find(a.streamingSelector).after(Se.html(`\n          <a class="mal-sync-stream" title="${r.u.split("/")[2]}" target="_blank" style="margin: 0 0;" href="${r.u}">\n            <img src="${ve.favicon(r.u.split("/")[2])}">\n          </a>`));const n=r.r,i=r.c;Ee.log("Resume",n,"Continue",i),i&&i.ep===s+1?e.find(".mal-sync-stream").after(Se.html(`<a class="nextStream" title="Continue watching" target="_blank" style="margin: 0 5px 0 0; color: #BABABA;" href="${i.url}">\n              <img src="${ke.storage.assetUrl("double-arrow-16px.png")}" width="16" height="16">\n            </a>`)):n&&n.ep===s&&e.find(".mal-sync-stream").after(Se.html(`<a class="resumeStream" title="Resume watching" target="_blank" style="margin: 0 5px 0 0; color: #BABABA;" href="${n.url}">\n              <img src="${ke.storage.assetUrl("arrow-16px.png")}" width="16" height="16">\n            </a>`))}}a.bookReady((function(t){e.bookmarksHDimages(),$.each(t,(async function(e,t){const n=t.url.replace("https://myanimelist.net",""),{type:i}=t;if(s(i,n,t.tags,parseInt(t.watchedEp),t.cacheKey),await t.fn.initProgress(),t.fn.progress&&t.fn.progress.isAiring()&&t.fn.progress.getCurrentEpisode()){const e=a.getElement(n);a.predictionPos(e,`<span class="mal-sync-ep-pre" title="${t.fn.progress.getAutoText()}">[<span style="border-bottom: 1px dotted ${t.fn.progress.getColor()};">${t.fn.progress.getCurrentEpisode()}</span>]</span>`)}})),a.cleanTags()}))}related(){$(document).ready((function(){$(".related-entries .title a, .related-entries .entries a").each((function(){const e=$(this),t=ve.absoluteLink(e.attr("href"),"https://myanimelist.net");void 0!==t&&ke.request.database("entry",{id:Number(ve.urlPart(t,4)),type:ve.urlPart(t,3)}).then((t=>{if(t){const n=ve.statusTag(t.status,t.type,t.uid);n&&e.append(Se.html(n))}}))}))}))}relatedTag(){const e=this;$(document).ready((function(){$("a.button_edit").each((function(){const t=$(this),n=$(this).attr("href")||"",a=ve.urlPart(n,4),s=ve.urlPart(n,5),i=t.attr("title");if(void 0!==i&&i){const n=String(ve.statusTag(i,a,s));"detail"===e.page?t.parent().find("> a").first().after(Se.html(n)):t.parent().parent().find("> a").after(Se.html(n)),t.remove()}}))}))}friendScore(){ke.settings.get("friendScore")&&$(document).ready((function(){const e=$("h2:contains(Reviews)").prev();if(!e.length)return;const t=$("#horiznav_nav li a").first();if(!t.is("#horiznav_nav li a.horiznav_active"))return;let n=t.attr("href");void 0!==n&&n&&(n=ve.absoluteLink(n,"https://myanimelist.net"),ke.request.xhr("GET",`${n}/stats`).then((t=>{const n=$("a[name=members]",$(t.responseText).children());if(!n)return;const a=n.nextAll();let s="";a.each(((e,t)=>{s+=t.outerHTML})),a.length>1&&a.find('a:contains("All Members")').length&&(e.before(Se.html(n.html())).before(Se.html(s)).before(Se.html("<br>")),$('a:contains("All Members")').after(Se.html(' | <span id="mal-sync-removeFriends" title="remove" style="cursor: pointer; color: #1d439b;">X</span>')),$("#mal-sync-removeFriends").click((function(){ke.settings.set("friendScore",!1),window.location.reload()})))})))}))}}var xe=n(13647),Ie=n(7263),Ae=n(78584),$e=n(26017);async function Le(){const e=await xe.storage.get("timestampUpdate/firebaseNotification");(void 0===e||Ie.$.now()-e>6e5)&&(await Ne(),xe.storage.set("timestampUpdate/firebaseNotification",Ie.$.now()))}async function Ne(){Ae.log("checkNotifications");const e=await xe.request.xhr("GET","https://kissanimelist.firebaseio.com/Data2/Notification/Current.json"),t=parseInt(JSON.parse(e.responseText));Number.isNaN(t)&&Ae.error("Could not read current Notification number"),Ae.log("Current Notification",t);const n=parseInt(await xe.storage.get("firebaseNotification")),a=n+1;if(void 0===n||Number.isNaN(n))return void xe.storage.set("firebaseNotification",t);if(t<a)return void Ae.log("No new notifications");const s=`https://kissanimelist.firebaseio.com/Data2/Notification/list/N${a}.json`,i=await xe.request.xhr("GET",s);if(!i)return;const r=JSON.parse(i.responseText);if(!r)return Ae.info("Notification empty",i.responseText),void xe.storage.set("firebaseNotification",a).then((function(){Ne()}));Ie.$(document).ready((function(){const e=$e.flashm(`<div style="text-align: left;">${r}</div><button class="okChangelog" style="background-color: transparent; border: none; color: rgb(255,64,129);margin-top: 10px;cursor: pointer;">Close</button>`,{permanent:!0,position:"top"});e.find(".okChangelog").click((function(){e.remove(),xe.storage.set("firebaseNotification",a).then((function(){Ne()}))}))}))}var Re=n(13647),Pe=n(78584);let Oe;console.log("%cMAL-Sync","font-size: 40px; padding-bottom: 3px; color: white; text-shadow: -1px -1px #2e51a2, 1px -1px #2e51a2, -1px 1px #2e51a2, 1px 1px #2e51a2, 2px 2px #2e51a2, 3px 3px #2e51a2;",`Version: ${Re.storage.version()}`),Re.settings.init().then((()=>{!function(){if(Re.settings.get("userscriptModeButton"))throw"Userscript mode";const e=new Te(window.location.href);!function(e){const t=Pe.m("TabMalUrl");chrome.runtime.onMessage.addListener((function(n,a,s){Date.now()-Oe<3e3?"TabMalUrl"===n.action&&(t.log("Response",e.url),s({url:e.url,title:e.getTitle(),image:e.getImage()})):t.log("Focus timeout")}))}(e),e.init(),Le(),$(window).blur((function(){Oe=Date.now()}))}()}))})()})();
//# sourceMappingURL=mal-script.js.map