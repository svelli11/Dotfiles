(()=>{var m=Object.defineProperty;var y=(u,n)=>m(u,"name",{value:n,configurable:!0});(()=>{var u={};const{createElement:n}=FrankerFaceZ.utilities.dom,{isValidShortcut:p}=FrankerFaceZ.utilities.object,w=null,l=class l extends FrankerFaceZ.utilities.addon.Addon{constructor(...t){super(...t),this.inject("site.fine"),this.inject("site.player"),this.inject("site.web_munch"),this.inject("settings"),this.onShortcut=this.onShortcut.bind(this),this.settingsNamespace="addon.screenshotter",this.settings.add(`${this.settingsNamespace}.copy`,{default:!0,ui:{path:"Add-Ons > Screenshotter >> Behavior",title:"Copy to clipboard",description:"Enable this to copy the screenshot to the clipboard (if supported by your browser).",component:"setting-check-box"}}),this.settings.add(`${this.settingsNamespace}.download`,{default:!1,ui:{path:"Add-Ons > Screenshotter >> Behavior",title:"Save as file",description:"Enable this if you wish to download the screenshot as a file.",component:"setting-check-box"}}),this.settings.add(`${this.settingsNamespace}.shortcut`,{default:"ctrl+alt+shift+q",ui:{path:"Add-Ons > Screenshotter >> Behavior",title:"Shortcut Key",description:"This key sequence can be used to take a screenshot.",component:"setting-hotkey"},changed:()=>{this.updateShortcut(),this.updateButtons()}})}onEnable(){this.on("site.player:update-gui",this.updateButton,this),this.updateButtons(),this.updateShortcut(),this.createTooltip()}onDisable(){this.destroyButtons(),this.destroyTooltip()}createTooltip(){this.tooltip&&this.destroyTooltip(),this.tooltip=document.createElement("span"),this.tooltip.id="ffz-screenshotter-tooltip",this.tooltip.style=`
			color: var(--color-text-pill);
			background-color: var(--color-background-pill-subtle);
			display: inline-block;
			position: absolute;
			right: 15px;
			bottom: 45px;
			line-height: initial;
			text-align: center;
			white-space: nowrap;
			border-radius: 1000px;
			padding: 0.3rem 0.8em;
			font-weight: bold;
			opacity: 0;
			pointer-events: none;

			transition: opacity .1s;
		`,this.tooltip.textContent="Copied to clipboard!",document.querySelector("div.video-player").appendChild(this.tooltip)}showTooltip(){this.tooltip.style.opacity=1,setTimeout(()=>{this.tooltip.style.opacity=0},2e3)}destroyTooltip(){this.tooltip?.remove()}destroyButtons(){for(const t of this.player.Player.instances)this.destroyButton(t)}destroyButton(t){document.querySelector(".ffz--player-screenshotter")?.remove()}updateShortcut(){const t=this.Mousetrap=this.Mousetrap||this.web_munch.getModule("mousetrap")||window.Mousetrap;if(!t||!t.bind)return;this._shortcut_bound&&(t.unbind(this._shortcut_bound),this._shortcut_bound=null);const e=this.settings.get(`${this.settingsNamespace}.shortcut`);e&&p(e)&&(t.bind(e,this.onShortcut),this._shortcut_bound=e)}updateButtons(){for(const t of this.player.Player.instances)this.updateButton(t)}isClip(t){return t.src?.includes(".clips.twitchcdn")}updateButton(t){const e=t.props.containerRef||this.fine.getChildNode(t),o=e?.querySelector?.(this.player.RIGHT_CONTROLS||".video-player__default-player .player-controls__right-control-group"),s=o?.querySelector(".ffz--player-screenshotter"),i=e?.querySelector("video");if(!i||!o||(s&&s.remove(),this.isClip(i)))return;let r,f,g,h=o.querySelector(".ffz--player-screenshotter");h=n("div",{class:"ffz--player-screenshotter tw-inline-flex tw-relative ffz-il-tooltip__container"},g=n("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-screenshotter-button",onClick:this.onButtonClick.bind(this,t)},n("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},n("div",{class:"tw-button-icon__icon"},r=n("figure",{class:"ffz-fa-photo ffz-i-camera"})))),f=n("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const b=o.querySelector('button[data-a-target="player-fullscreen-button"]');b?o.insertBefore(h,b.parentElement):o.appendChild(h);let a="Take screenshot";const d=this.settings.get(`${this.settingsNamespace}.shortcut`);d&&p(d)&&(a=`${a} (${d})`),g.setAttribute("aria-label",a),f.textContent=a}onShortcut(){this.takeScreenshot()}onButtonClick(){this.takeScreenshot()}saveToClipboard(t){try{navigator.clipboard.write([new ClipboardItem({"image/png":t})]),this.showTooltip()}catch(e){this.log.error("Clipboard is not accessible, saving to file instead",e),this.saveToFile(t)}}saveToFile(t){try{const e=document.querySelector("h1.tw-title"),o=new Date,s=`${o.toDateString()}_${o.toLocaleTimeString()}`,i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=`${e.textContent??"stream"}_${s}.png`.replaceAll(" ","-"),i.click(),URL.revokeObjectURL(i.href)}catch(e){this.log.error("Save to file was unsuccessful",e)}}takeScreenshot(){const t=document.querySelector("video");if(!t||this.isClip(t))return;const e=document.createElement("canvas"),o=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,o.drawImage(t,0,0,e.width,e.height),e.toBlob(s=>{const i=this.settings.get(`${this.settingsNamespace}.download`),r=this.settings.get(`${this.settingsNamespace}.copy`);if(!i&&!r)return this.saveToClipboard(s);i&&this.saveToFile(s),r&&(i?setTimeout(()=>this.saveToClipboard(s),100):this.saveToClipboard(s))}),e.remove()}};y(l,"Screenshotter");let c=l;c.register("screenshotter",null,"1.2.2")})();})();

//# sourceMappingURL=script.js.map