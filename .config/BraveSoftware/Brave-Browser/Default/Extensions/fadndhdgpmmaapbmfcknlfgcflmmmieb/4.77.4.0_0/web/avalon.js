(()=>{var Nt=Object.defineProperty;var G=(Et,Ct)=>Nt(Et,"name",{value:Ct,configurable:!0});var It=[];(()=>{var Et={22923:(ae,J)=>{"use strict";const d=/\s/,W={OPEN:"{",CLOSE:"}",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSING:"/",SEP:",",SUB_VAR:"#",ESCAPE:"'"},L="subnumeric_types",B="submessage_types",I=Object.keys(W),U=Symbol("C"),D=J=ae.exports=G(function n(s){if(!(this instanceof n))return new n(s);this.opts=Object.assign({OFFSET:"offset:",[L]:["plural","selectordinal"],[B]:["plural","selectordinal","select"],allowTags:!0,requireOther:!0},W,s);for(let i=0;i<I.length;i++){const l=I[i],w=this.opts[l];if(typeof w!="string"||w.length!==1)throw new Error(`Option ${l} must be a 1-length string`);for(let b=i+1;b<I.length;b++){const r=I[b];if(this.opts[r]===w)throw new Error(`Option ${l} and ${r} cannot match`)}}},"Parser2"),v=D.prototype;v.parse=function(n){return this.parseAST({msg:String(n),i:0},null)},v.parseAST=function(n,s){const i=n.msg,l=this.opts,w=i.length,b=s&&l[L].includes(s.t),r=[];for(;n.i<w;){const e=n.i,a=i[e];if(a===l.CLOSE)if(!s)S(r,"}"),n.i++;else break;else if(a===l.OPEN||b&&a===l.SUB_VAR)S(r,this.parseElement(n,s));else if(l.allowTags&&a===l.TAG_OPEN&&!d.test(i[e+1])){const p=this.parseTag(n,s);if(p===U){s.closed=!0;break}else S(r,p)}else S(r,this.parseText(n,s));if(n.i===e)throw u(a,n.i)}return r},v.parseText=function(n,s,i=!0,l=!0,w=!1){const b=n.msg,r=this.opts,e=r.allowTags,a=b.length,p=s&&r[L].includes(s.t);let C="";for(;n.i<a;){const y=b[n.i];if(y===r.OPEN||y===r.CLOSE||e&&(y===r.TAG_OPEN||w&&(y===r.TAG_CLOSE||y===r.TAG_CLOSING))||!i&&y===r.SEP||!l&&d.test(y)||p&&y===r.SUB_VAR)break;if(y===r.ESCAPE){let z=b[++n.i];if(z===r.ESCAPE)C+=z,n.i++;else if(z===r.OPEN||z===r.CLOSE||e&&(z===r.TAG_OPEN||w&&(z===r.TAG_CLOSE||z===r.TAG_CLOSING))||p&&z===r.SUB_VAR||!l||!i)for(C+=z;++n.i<a;)if(z=b[n.i],z===r.ESCAPE)if(z=b[n.i+1],z===r.ESCAPE)C+=z,n.i++;else{n.i++;break}else C+=z;else C+=y}else n.i++,C+=y}return C},v.parseTag=function(n,s){const i=n.msg,l=n.i,w=this.opts;n.i++;let b=i[n.i],r=!1;if(b===w.TAG_CLOSING){if(!s||!s.n)throw u(b,n.i);r=!0,n.i++,g(n)}const e=this.parseText(n,null,!1,!1,!0);if(!e)return i.slice(l,n.i);if(g(n),b=i[n.i],r){if(b!==w.TAG_CLOSE)throw f(w.TAG_CLOSE,b,n.i);if(e!==s.n)throw u("tag mismatch",l);return n.i++,U}if(r=!1,b===w.TAG_CLOSING&&(r=!0,n.i++,b=i[n.i]),b!==w.TAG_CLOSE)return i.slice(l,n.i);n.i++;const a={n:e};if(r)return a;const p=this.parseAST(n,a);if(p&&p.length&&(a.c=p),!a.closed&&n.i>=i.length)throw f("closing tag",n);return delete a.closed,a},v.parseElement=function(n,s){const i=n.msg,l=this.opts,w=s&&l[L].includes(s.t);let b=i[n.i];if(w&&b===l.SUB_VAR)return n.i++,{v:s.v,t:"number"};n.i++,g(n);const r=this.parseText(n,null,!1,!1);if(!r)throw f("placeholder id",b,n.i);const e={v:r};if(g(n),b=i[n.i],b===l.CLOSE)return n.i++,e;if(b!==l.SEP)throw f(`${l.SEP} or ${l.CLOSE}`,b,n.i);n.i++,g(n);const a=this.parseText(n,null,!1,!1);if(!a)throw f("type",n);if(e.t=a,g(n),b=i[n.i],b===l.CLOSE){if(l[B].includes(e.t))throw f("sub-messages",n);return n.i++,e}else if(b!==l.SEP)throw f(`${l.SEP} or ${l.CLOSE}`,b,n.i);if(n.i++,g(n),l[L].includes(e.t)){const p=this.parseOffset(n);p&&(e.f=p,g(n))}if(l[B].includes(e.t)){const p=this.parseSubmessages(n,e),C=l.requireOther;if((Array.isArray(C)?C.includes(e.t):C)&&!p.other)throw f("other sub-message",n);e.o=p}else{const p=this.parseText(n,null,!0,!0);if(!p)throw f("format",n);e.f=p.trimRight()}if(g(n),b=i[n.i],b!==l.CLOSE)throw f(l.CLOSE,b,n.i);return n.i++,e},v.parseSubmessages=function(n,s){const i=n.msg,l=i.length,w={};for(;n.i<l&&i[n.i]!==this.opts.CLOSE;){const r=this.parseText(n,null,!0,!1);if(!r)throw f("sub-message selector",n);g(n),w[r]=this.parseSubmessage(n,s),g(n)}return w},v.parseSubmessage=function(n,s){const i=n.msg,l=this.opts;if(i[n.i]!==l.OPEN)throw f(l.OPEN,n);n.i++;const w=this.parseAST(n,s);if(i[n.i]!==l.CLOSE)throw f(l.CLOSE,n);return n.i++,w},v.parseOffset=function(n){const s=n.msg,i=this.opts.OFFSET,l=s.length;if(s.slice(n.i,n.i+i.length)!==i)return;n.i+=i.length,g(n);const w=n.i;for(;n.i<l&&/[-\d]/.test(s[n.i]);)n.i++;if(w===n.i)throw f("number",n);return+s.slice(w,n.i)};function f(n,s,i){return typeof s=="object"&&(i=s.i,s=s.msg[i]),new SyntaxError(`expected ${n} at position ${i} but found ${s||"eof"}`)}G(f,"expected");function u(n,s){return new SyntaxError(`unexpected ${n} at position ${s}`)}G(u,"unexpected");function g(n){const s=n.msg,i=s.length;for(;n.i<i&&d.test(s[n.i]);)n.i++}G(g,"skipSpace");function S(n,s){const i=n.length-1;typeof s=="string"&&typeof n[i]=="string"?n[i]+=s:n.push(s)}G(S,"mergePush")},5926:(ae,J,d)=>{"use strict";d.d(J,{kZ:()=>z});var W=d(57845),L=d(23111),B=d(61378),I=d(52319);function U(o){return{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}}G(U,"getHTMLElementScroll");function D(o){return o===(0,B.Z)(o)||!(0,I.Re)(o)?(0,L.Z)(o):U(o)}G(D,"getNodeScroll");var v=d(43332),f=d(61300),u=d(4377),g=d(10710),S=d(62079);function n(o){var c=o.getBoundingClientRect(),m=(0,S.NM)(c.width)/o.offsetWidth||1,A=(0,S.NM)(c.height)/o.offsetHeight||1;return m!==1||A!==1}G(n,"isElementScaled");function s(o,c,m){m===void 0&&(m=!1);var A=(0,I.Re)(c),h=(0,I.Re)(c)&&n(c),T=(0,u.Z)(c),R=(0,W.Z)(o,h,m),P={scrollLeft:0,scrollTop:0},O={x:0,y:0};return(A||!A&&!m)&&(((0,v.Z)(c)!=="body"||(0,g.Z)(T))&&(P=D(c)),(0,I.Re)(c)?(O=(0,W.Z)(c,!0),O.x+=c.clientLeft,O.y+=c.clientTop):T&&(O.x=(0,f.Z)(T))),{x:R.left+P.scrollLeft-O.x,y:R.top+P.scrollTop-O.y,width:R.width,height:R.height}}G(s,"getCompositeRect");var i=d(5618),l=d(26857),w=d(52839),b=d(49880);function r(o){var c=new Map,m=new Set,A=[];o.forEach(function(T){c.set(T.name,T)});function h(T){m.add(T.name);var R=[].concat(T.requires||[],T.requiresIfExists||[]);R.forEach(function(P){if(!m.has(P)){var O=c.get(P);O&&h(O)}}),A.push(T)}return G(h,"sort"),o.forEach(function(T){m.has(T.name)||h(T)}),A}G(r,"order");function e(o){var c=r(o);return b.xs.reduce(function(m,A){return m.concat(c.filter(function(h){return h.phase===A}))},[])}G(e,"orderModifiers");function a(o){var c;return function(){return c||(c=new Promise(function(m){Promise.resolve().then(function(){c=void 0,m(o())})})),c}}G(a,"debounce");function p(o){var c=o.reduce(function(m,A){var h=m[A.name];return m[A.name]=h?Object.assign({},h,A,{options:Object.assign({},h.options,A.options),data:Object.assign({},h.data,A.data)}):A,m},{});return Object.keys(c).map(function(m){return c[m]})}G(p,"mergeByName");var C={placement:"bottom",modifiers:[],strategy:"absolute"};function y(){for(var o=arguments.length,c=new Array(o),m=0;m<o;m++)c[m]=arguments[m];return!c.some(function(A){return!(A&&typeof A.getBoundingClientRect=="function")})}G(y,"areValidElements");function z(o){o===void 0&&(o={});var c=o,m=c.defaultModifiers,A=m===void 0?[]:m,h=c.defaultOptions,T=h===void 0?C:h;return G(function(P,O,M){M===void 0&&(M=T);var j={placement:"bottom",orderedModifiers:[],options:Object.assign({},C,T),modifiersData:{},elements:{reference:P,popper:O},attributes:{},styles:{}},Y=[],ee=!1,X={state:j,setOptions:G(function(fe){var re=typeof fe=="function"?fe(j.options):fe;te(),j.options=Object.assign({},T,j.options,re),j.scrollParents={reference:(0,I.kK)(P)?(0,l.Z)(P):P.contextElement?(0,l.Z)(P.contextElement):[],popper:(0,l.Z)(O)};var ue=e(p([].concat(A,j.options.modifiers)));return j.orderedModifiers=ue.filter(function(me){return me.enabled}),Q(),X.update()},"setOptions"),forceUpdate:G(function(){if(!ee){var fe=j.elements,re=fe.reference,ue=fe.popper;if(y(re,ue)){j.rects={reference:s(re,(0,w.Z)(ue),j.options.strategy==="fixed"),popper:(0,i.Z)(ue)},j.reset=!1,j.placement=j.options.placement,j.orderedModifiers.forEach(function(oe){return j.modifiersData[oe.name]=Object.assign({},oe.data)});for(var me=0;me<j.orderedModifiers.length;me++){if(j.reset===!0){j.reset=!1,me=-1;continue}var we=j.orderedModifiers[me],xe=we.fn,Te=we.options,Pe=Te===void 0?{}:Te,Se=we.name;typeof xe=="function"&&(j=xe({state:j,options:Pe,name:Se,instance:X})||j)}}}},"forceUpdate"),update:a(function(){return new Promise(function(ne){X.forceUpdate(),ne(j)})}),destroy:G(function(){te(),ee=!0},"destroy")};if(!y(P,O))return X;X.setOptions(M).then(function(ne){!ee&&M.onFirstUpdate&&M.onFirstUpdate(ne)});function Q(){j.orderedModifiers.forEach(function(ne){var fe=ne.name,re=ne.options,ue=re===void 0?{}:re,me=ne.effect;if(typeof me=="function"){var we=me({state:j,name:fe,instance:X,options:ue}),xe=G(function(){},"noopFn2");Y.push(we||xe)}})}G(Q,"runModifierEffects");function te(){Y.forEach(function(ne){return ne()}),Y=[]}return G(te,"cleanupModifierEffects"),X},"createPopper2")}G(z,"popperGenerator");var $=null},75865:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(52319);function L(B,I){var U=I.getRootNode&&I.getRootNode();if(B.contains(I))return!0;if(U&&(0,W.Zq)(U)){var D=I;do{if(D&&B.isSameNode(D))return!0;D=D.parentNode||D.host}while(D)}return!1}G(L,"contains")},57845:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(52319),L=d(62079),B=d(61378),I=d(16182);function U(D,v,f){v===void 0&&(v=!1),f===void 0&&(f=!1);var u=D.getBoundingClientRect(),g=1,S=1;v&&(0,W.Re)(D)&&(g=D.offsetWidth>0&&(0,L.NM)(u.width)/D.offsetWidth||1,S=D.offsetHeight>0&&(0,L.NM)(u.height)/D.offsetHeight||1);var n=(0,W.kK)(D)?(0,B.Z)(D):window,s=n.visualViewport,i=!(0,I.Z)()&&f,l=(u.left+(i&&s?s.offsetLeft:0))/g,w=(u.top+(i&&s?s.offsetTop:0))/S,b=u.width/g,r=u.height/S;return{width:b,height:r,top:w,right:l+b,bottom:w+r,left:l,x:l,y:w}}G(U,"getBoundingClientRect")},26302:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(61378);function L(B){return(0,W.Z)(B).getComputedStyle(B)}G(L,"getComputedStyle2")},4377:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(52319);function L(B){return(((0,W.kK)(B)?B.ownerDocument:B.document)||window.document).documentElement}G(L,"getDocumentElement")},5618:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(57845);function L(B){var I=(0,W.Z)(B),U=B.offsetWidth,D=B.offsetHeight;return Math.abs(I.width-U)<=1&&(U=I.width),Math.abs(I.height-D)<=1&&(D=I.height),{x:B.offsetLeft,y:B.offsetTop,width:U,height:D}}G(L,"getLayoutRect")},43332:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(L){return L?(L.nodeName||"").toLowerCase():null}G(W,"getNodeName")},52839:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>g});var W=d(61378),L=d(43332),B=d(26302),I=d(52319);function U(S){return["table","td","th"].indexOf((0,L.Z)(S))>=0}G(U,"isTableElement");var D=d(85564),v=d(3518);function f(S){return!(0,I.Re)(S)||(0,B.Z)(S).position==="fixed"?null:S.offsetParent}G(f,"getTrueOffsetParent");function u(S){var n=/firefox/i.test((0,v.Z)()),s=/Trident/i.test((0,v.Z)());if(s&&(0,I.Re)(S)){var i=(0,B.Z)(S);if(i.position==="fixed")return null}var l=(0,D.Z)(S);for((0,I.Zq)(l)&&(l=l.host);(0,I.Re)(l)&&["html","body"].indexOf((0,L.Z)(l))<0;){var w=(0,B.Z)(l);if(w.transform!=="none"||w.perspective!=="none"||w.contain==="paint"||["transform","perspective"].indexOf(w.willChange)!==-1||n&&w.willChange==="filter"||n&&w.filter&&w.filter!=="none")return l;l=l.parentNode}return null}G(u,"getContainingBlock");function g(S){for(var n=(0,W.Z)(S),s=f(S);s&&U(s)&&(0,B.Z)(s).position==="static";)s=f(s);return s&&((0,L.Z)(s)==="html"||(0,L.Z)(s)==="body"&&(0,B.Z)(s).position==="static")?n:s||u(S)||n}G(g,"getOffsetParent")},85564:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(43332),L=d(4377),B=d(52319);function I(U){return(0,W.Z)(U)==="html"?U:U.assignedSlot||U.parentNode||((0,B.Zq)(U)?U.host:null)||(0,L.Z)(U)}G(I,"getParentNode")},61378:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(L){if(L==null)return window;if(L.toString()!=="[object Window]"){var B=L.ownerDocument;return B&&B.defaultView||window}return L}G(W,"getWindow")},23111:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(61378);function L(B){var I=(0,W.Z)(B),U=I.pageXOffset,D=I.pageYOffset;return{scrollLeft:U,scrollTop:D}}G(L,"getWindowScroll")},61300:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(57845),L=d(4377),B=d(23111);function I(U){return(0,W.Z)((0,L.Z)(U)).left+(0,B.Z)(U).scrollLeft}G(I,"getWindowScrollBarX")},52319:(ae,J,d)=>{"use strict";d.d(J,{Re:()=>B,Zq:()=>I,kK:()=>L});var W=d(61378);function L(U){var D=(0,W.Z)(U).Element;return U instanceof D||U instanceof Element}G(L,"isElement");function B(U){var D=(0,W.Z)(U).HTMLElement;return U instanceof D||U instanceof HTMLElement}G(B,"isHTMLElement");function I(U){if(typeof ShadowRoot>"u")return!1;var D=(0,W.Z)(U).ShadowRoot;return U instanceof D||U instanceof ShadowRoot}G(I,"isShadowRoot")},16182:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(3518);function L(){return!/^((?!chrome|android).)*safari/i.test((0,W.Z)())}G(L,"isLayoutViewport")},10710:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(26302);function L(B){var I=(0,W.Z)(B),U=I.overflow,D=I.overflowX,v=I.overflowY;return/auto|scroll|overlay|hidden/.test(U+v+D)}G(L,"isScrollParent")},26857:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>v});var W=d(85564),L=d(10710),B=d(43332),I=d(52319);function U(f){return["html","body","#document"].indexOf((0,B.Z)(f))>=0?f.ownerDocument.body:(0,I.Re)(f)&&(0,L.Z)(f)?f:U((0,W.Z)(f))}G(U,"getScrollParent");var D=d(61378);function v(f,u){var g;u===void 0&&(u=[]);var S=U(f),n=S===((g=f.ownerDocument)==null?void 0:g.body),s=(0,D.Z)(S),i=n?[s].concat(s.visualViewport||[],(0,L.Z)(S)?S:[]):S,l=u.concat(i);return n?l:l.concat(v((0,W.Z)(i)))}G(v,"listScrollParents")},49880:(ae,J,d)=>{"use strict";d.d(J,{BL:()=>v,Ct:()=>i,F2:()=>B,I:()=>L,Pj:()=>g,YP:()=>n,bw:()=>s,d7:()=>U,k5:()=>S,mv:()=>D,t$:()=>I,ut:()=>f,we:()=>W,xs:()=>z,zV:()=>u});var W="top",L="bottom",B="right",I="left",U="auto",D=[W,L,B,I],v="start",f="end",u="clippingParents",g="viewport",S="popper",n="reference",s=D.reduce(function($,o){return $.concat([o+"-"+v,o+"-"+f])},[]),i=[].concat(D,[U]).reduce(function($,o){return $.concat([o,o+"-"+v,o+"-"+f])},[]),l="beforeRead",w="read",b="afterRead",r="beforeMain",e="main",a="afterMain",p="beforeWrite",C="write",y="afterWrite",z=[l,w,b,r,e,a,p,C,y]},32898:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(43332),L=d(52319);function B(D){var v=D.state;Object.keys(v.elements).forEach(function(f){var u=v.styles[f]||{},g=v.attributes[f]||{},S=v.elements[f];!(0,L.Re)(S)||!(0,W.Z)(S)||(Object.assign(S.style,u),Object.keys(g).forEach(function(n){var s=g[n];s===!1?S.removeAttribute(n):S.setAttribute(n,s===!0?"":s)}))})}G(B,"applyStyles");function I(D){var v=D.state,f={popper:{position:v.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(v.elements.popper.style,f.popper),v.styles=f,v.elements.arrow&&Object.assign(v.elements.arrow.style,f.arrow),function(){Object.keys(v.elements).forEach(function(u){var g=v.elements[u],S=v.attributes[u]||{},n=Object.keys(v.styles.hasOwnProperty(u)?v.styles[u]:f[u]),s=n.reduce(function(i,l){return i[l]="",i},{});!(0,L.Re)(g)||!(0,W.Z)(g)||(Object.assign(g.style,s),Object.keys(S).forEach(function(i){g.removeAttribute(i)}))})}}G(I,"effect");const U={name:"applyStyles",enabled:!0,phase:"write",fn:B,effect:I,requires:["computeStyles"]}},63454:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>s});var W=d(65352),L=d(5618),B=d(75865),I=d(52839),U=d(61919),D=d(72907),v=d(49534),f=d(62219),u=d(49880),g=G(function(l,w){return l=typeof l=="function"?l(Object.assign({},w.rects,{placement:w.placement})):l,(0,v.Z)(typeof l!="number"?l:(0,f.Z)(l,u.mv))},"toPaddingObject2");function S(i){var l,w=i.state,b=i.name,r=i.options,e=w.elements.arrow,a=w.modifiersData.popperOffsets,p=(0,W.Z)(w.placement),C=(0,U.Z)(p),y=[u.t$,u.F2].indexOf(p)>=0,z=y?"height":"width";if(!(!e||!a)){var $=g(r.padding,w),o=(0,L.Z)(e),c=C==="y"?u.we:u.t$,m=C==="y"?u.I:u.F2,A=w.rects.reference[z]+w.rects.reference[C]-a[C]-w.rects.popper[z],h=a[C]-w.rects.reference[C],T=(0,I.Z)(e),R=T?C==="y"?T.clientHeight||0:T.clientWidth||0:0,P=A/2-h/2,O=$[c],M=R-o[z]-$[m],j=R/2-o[z]/2+P,Y=(0,D.u)(O,j,M),ee=C;w.modifiersData[b]=(l={},l[ee]=Y,l.centerOffset=Y-j,l)}}G(S,"arrow");function n(i){var l=i.state,w=i.options,b=w.element,r=b===void 0?"[data-popper-arrow]":b;r!=null&&(typeof r=="string"&&(r=l.elements.popper.querySelector(r),!r)||(0,B.Z)(l.elements.popper,r)&&(l.elements.arrow=r))}G(n,"effect");const s={name:"arrow",enabled:!0,phase:"main",fn:S,effect:n,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]}},24502:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>s});var W=d(49880),L=d(52839),B=d(61378),I=d(4377),U=d(26302),D=d(65352),v=d(47408),f=d(62079),u={top:"auto",right:"auto",bottom:"auto",left:"auto"};function g(i,l){var w=i.x,b=i.y,r=l.devicePixelRatio||1;return{x:(0,f.NM)(w*r)/r||0,y:(0,f.NM)(b*r)/r||0}}G(g,"roundOffsetsByDPR");function S(i){var l,w=i.popper,b=i.popperRect,r=i.placement,e=i.variation,a=i.offsets,p=i.position,C=i.gpuAcceleration,y=i.adaptive,z=i.roundOffsets,$=i.isFixed,o=a.x,c=o===void 0?0:o,m=a.y,A=m===void 0?0:m,h=typeof z=="function"?z({x:c,y:A}):{x:c,y:A};c=h.x,A=h.y;var T=a.hasOwnProperty("x"),R=a.hasOwnProperty("y"),P=W.t$,O=W.we,M=window;if(y){var j=(0,L.Z)(w),Y="clientHeight",ee="clientWidth";if(j===(0,B.Z)(w)&&(j=(0,I.Z)(w),(0,U.Z)(j).position!=="static"&&p==="absolute"&&(Y="scrollHeight",ee="scrollWidth")),j=j,r===W.we||(r===W.t$||r===W.F2)&&e===W.ut){O=W.I;var X=$&&j===M&&M.visualViewport?M.visualViewport.height:j[Y];A-=X-b.height,A*=C?1:-1}if(r===W.t$||(r===W.we||r===W.I)&&e===W.ut){P=W.F2;var Q=$&&j===M&&M.visualViewport?M.visualViewport.width:j[ee];c-=Q-b.width,c*=C?1:-1}}var te=Object.assign({position:p},y&&u),ne=z===!0?g({x:c,y:A},(0,B.Z)(w)):{x:c,y:A};if(c=ne.x,A=ne.y,C){var fe;return Object.assign({},te,(fe={},fe[O]=R?"0":"",fe[P]=T?"0":"",fe.transform=(M.devicePixelRatio||1)<=1?"translate("+c+"px, "+A+"px)":"translate3d("+c+"px, "+A+"px, 0)",fe))}return Object.assign({},te,(l={},l[O]=R?A+"px":"",l[P]=T?c+"px":"",l.transform="",l))}G(S,"mapToStyles");function n(i){var l=i.state,w=i.options,b=w.gpuAcceleration,r=b===void 0?!0:b,e=w.adaptive,a=e===void 0?!0:e,p=w.roundOffsets,C=p===void 0?!0:p,y={placement:(0,D.Z)(l.placement),variation:(0,v.Z)(l.placement),popper:l.elements.popper,popperRect:l.rects.popper,gpuAcceleration:r,isFixed:l.options.strategy==="fixed"};l.modifiersData.popperOffsets!=null&&(l.styles.popper=Object.assign({},l.styles.popper,S(Object.assign({},y,{offsets:l.modifiersData.popperOffsets,position:l.options.strategy,adaptive:a,roundOffsets:C})))),l.modifiersData.arrow!=null&&(l.styles.arrow=Object.assign({},l.styles.arrow,S(Object.assign({},y,{offsets:l.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:C})))),l.attributes.popper=Object.assign({},l.attributes.popper,{"data-popper-placement":l.placement})}G(n,"computeStyles");const s={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:n,data:{}}},72582:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(61378),L={passive:!0};function B(U){var D=U.state,v=U.instance,f=U.options,u=f.scroll,g=u===void 0?!0:u,S=f.resize,n=S===void 0?!0:S,s=(0,W.Z)(D.elements.popper),i=[].concat(D.scrollParents.reference,D.scrollParents.popper);return g&&i.forEach(function(l){l.addEventListener("scroll",v.update,L)}),n&&s.addEventListener("resize",v.update,L),function(){g&&i.forEach(function(l){l.removeEventListener("scroll",v.update,L)}),n&&s.removeEventListener("resize",v.update,L)}}G(B,"effect");const I={name:"eventListeners",enabled:!0,phase:"write",fn:G(function(){},"fn"),effect:B,data:{}}},16087:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>n});var W={left:"right",right:"left",bottom:"top",top:"bottom"};function L(s){return s.replace(/left|right|bottom|top/g,function(i){return W[i]})}G(L,"getOppositePlacement");var B=d(65352),I={start:"end",end:"start"};function U(s){return s.replace(/start|end/g,function(i){return I[i]})}G(U,"getOppositeVariationPlacement");var D=d(24041),v=d(47408),f=d(49880);function u(s,i){i===void 0&&(i={});var l=i,w=l.placement,b=l.boundary,r=l.rootBoundary,e=l.padding,a=l.flipVariations,p=l.allowedAutoPlacements,C=p===void 0?f.Ct:p,y=(0,v.Z)(w),z=y?a?f.bw:f.bw.filter(function(c){return(0,v.Z)(c)===y}):f.mv,$=z.filter(function(c){return C.indexOf(c)>=0});$.length===0&&($=z);var o=$.reduce(function(c,m){return c[m]=(0,D.Z)(s,{placement:m,boundary:b,rootBoundary:r,padding:e})[(0,B.Z)(m)],c},{});return Object.keys(o).sort(function(c,m){return o[c]-o[m]})}G(u,"computeAutoPlacement");function g(s){if((0,B.Z)(s)===f.d7)return[];var i=L(s);return[U(s),i,U(i)]}G(g,"getExpandedFallbackPlacements");function S(s){var i=s.state,l=s.options,w=s.name;if(!i.modifiersData[w]._skip){for(var b=l.mainAxis,r=b===void 0?!0:b,e=l.altAxis,a=e===void 0?!0:e,p=l.fallbackPlacements,C=l.padding,y=l.boundary,z=l.rootBoundary,$=l.altBoundary,o=l.flipVariations,c=o===void 0?!0:o,m=l.allowedAutoPlacements,A=i.options.placement,h=(0,B.Z)(A),T=h===A,R=p||(T||!c?[L(A)]:g(A)),P=[A].concat(R).reduce(function(ie,pe){return ie.concat((0,B.Z)(pe)===f.d7?u(i,{placement:pe,boundary:y,rootBoundary:z,padding:C,flipVariations:c,allowedAutoPlacements:m}):pe)},[]),O=i.rects.reference,M=i.rects.popper,j=new Map,Y=!0,ee=P[0],X=0;X<P.length;X++){var Q=P[X],te=(0,B.Z)(Q),ne=(0,v.Z)(Q)===f.BL,fe=[f.we,f.I].indexOf(te)>=0,re=fe?"width":"height",ue=(0,D.Z)(i,{placement:Q,boundary:y,rootBoundary:z,altBoundary:$,padding:C}),me=fe?ne?f.F2:f.t$:ne?f.I:f.we;O[re]>M[re]&&(me=L(me));var we=L(me),xe=[];if(r&&xe.push(ue[te]<=0),a&&xe.push(ue[me]<=0,ue[we]<=0),xe.every(function(ie){return ie})){ee=Q,Y=!1;break}j.set(Q,xe)}if(Y)for(var Te=c?3:1,Pe=G(function(pe){var ge=P.find(function(ve){var Fe=j.get(ve);if(Fe)return Fe.slice(0,pe).every(function(De){return De})});if(ge)return ee=ge,"break"},"_loop2"),Se=Te;Se>0;Se--){var oe=Pe(Se);if(oe==="break")break}i.placement!==ee&&(i.modifiersData[w]._skip=!0,i.placement=ee,i.reset=!0)}}G(S,"flip");const n={name:"flip",enabled:!0,phase:"main",fn:S,requiresIfExists:["offset"],data:{_skip:!1}}},48051:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>D});var W=d(49880),L=d(24041);function B(v,f,u){return u===void 0&&(u={x:0,y:0}),{top:v.top-f.height-u.y,right:v.right-f.width+u.x,bottom:v.bottom-f.height+u.y,left:v.left-f.width-u.x}}G(B,"getSideOffsets");function I(v){return[W.we,W.F2,W.I,W.t$].some(function(f){return v[f]>=0})}G(I,"isAnySideFullyClipped");function U(v){var f=v.state,u=v.name,g=f.rects.reference,S=f.rects.popper,n=f.modifiersData.preventOverflow,s=(0,L.Z)(f,{elementContext:"reference"}),i=(0,L.Z)(f,{altBoundary:!0}),l=B(s,g),w=B(i,S,n),b=I(l),r=I(w);f.modifiersData[u]={referenceClippingOffsets:l,popperEscapeOffsets:w,isReferenceHidden:b,hasPopperEscaped:r},f.attributes.popper=Object.assign({},f.attributes.popper,{"data-popper-reference-hidden":b,"data-popper-escaped":r})}G(U,"hide");const D={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:U}},61150:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(65352),L=d(49880);function B(D,v,f){var u=(0,W.Z)(D),g=[L.t$,L.we].indexOf(u)>=0?-1:1,S=typeof f=="function"?f(Object.assign({},v,{placement:D})):f,n=S[0],s=S[1];return n=n||0,s=(s||0)*g,[L.t$,L.F2].indexOf(u)>=0?{x:s,y:n}:{x:n,y:s}}G(B,"distanceAndSkiddingToXY");function I(D){var v=D.state,f=D.options,u=D.name,g=f.offset,S=g===void 0?[0,0]:g,n=L.Ct.reduce(function(w,b){return w[b]=B(b,v.rects,S),w},{}),s=n[v.placement],i=s.x,l=s.y;v.modifiersData.popperOffsets!=null&&(v.modifiersData.popperOffsets.x+=i,v.modifiersData.popperOffsets.y+=l),v.modifiersData[u]=n}G(I,"offset");const U={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:I}},35772:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(47840);function L(I){var U=I.state,D=I.name;U.modifiersData[D]=(0,W.Z)({reference:U.rects.reference,element:U.rects.popper,strategy:"absolute",placement:U.placement})}G(L,"popperOffsets");const B={name:"popperOffsets",enabled:!0,phase:"read",fn:L,data:{}}},29228:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>s});var W=d(49880),L=d(65352),B=d(61919);function I(i){return i==="x"?"y":"x"}G(I,"getAltAxis");var U=d(72907),D=d(5618),v=d(52839),f=d(24041),u=d(47408),g=d(29852),S=d(62079);function n(i){var l=i.state,w=i.options,b=i.name,r=w.mainAxis,e=r===void 0?!0:r,a=w.altAxis,p=a===void 0?!1:a,C=w.boundary,y=w.rootBoundary,z=w.altBoundary,$=w.padding,o=w.tether,c=o===void 0?!0:o,m=w.tetherOffset,A=m===void 0?0:m,h=(0,f.Z)(l,{boundary:C,rootBoundary:y,padding:$,altBoundary:z}),T=(0,L.Z)(l.placement),R=(0,u.Z)(l.placement),P=!R,O=(0,B.Z)(T),M=I(O),j=l.modifiersData.popperOffsets,Y=l.rects.reference,ee=l.rects.popper,X=typeof A=="function"?A(Object.assign({},l.rects,{placement:l.placement})):A,Q=typeof X=="number"?{mainAxis:X,altAxis:X}:Object.assign({mainAxis:0,altAxis:0},X),te=l.modifiersData.offset?l.modifiersData.offset[l.placement]:null,ne={x:0,y:0};if(j){if(e){var fe,re=O==="y"?W.we:W.t$,ue=O==="y"?W.I:W.F2,me=O==="y"?"height":"width",we=j[O],xe=we+h[re],Te=we-h[ue],Pe=c?-ee[me]/2:0,Se=R===W.BL?Y[me]:ee[me],oe=R===W.BL?-ee[me]:-Y[me],ie=l.elements.arrow,pe=c&&ie?(0,D.Z)(ie):{width:0,height:0},ge=l.modifiersData["arrow#persistent"]?l.modifiersData["arrow#persistent"].padding:(0,g.Z)(),ve=ge[re],Fe=ge[ue],De=(0,U.u)(0,Y[me],pe[me]),Ie=P?Y[me]/2-Pe-De-ve-Q.mainAxis:Se-De-ve-Q.mainAxis,Xe=P?-Y[me]/2+Pe+De+Fe+Q.mainAxis:oe+De+Fe+Q.mainAxis,ct=l.elements.arrow&&(0,v.Z)(l.elements.arrow),Oe=ct?O==="y"?ct.clientTop||0:ct.clientLeft||0:0,_=(fe=te?.[O])!=null?fe:0,F=we+Ie-_-Oe,K=we+Xe-_,H=(0,U.u)(c?(0,S.VV)(xe,F):xe,we,c?(0,S.Fp)(Te,K):Te);j[O]=H,ne[O]=H-we}if(p){var V,E=O==="x"?W.we:W.t$,x=O==="x"?W.I:W.F2,k=j[M],N=M==="y"?"height":"width",Z=k+h[E],se=k-h[x],de=[W.we,W.t$].indexOf(T)!==-1,_e=(V=te?.[M])!=null?V:0,q=de?Z:k-Y[N]-ee[N]-_e+Q.altAxis,le=de?k+Y[N]+ee[N]-_e-Q.altAxis:se,he=c&&de?(0,U.q)(q,k,le):(0,U.u)(c?q:Z,k,c?le:se);j[M]=he,ne[M]=he-k}l.modifiersData[b]=ne}}G(n,"preventOverflow");const s={name:"preventOverflow",enabled:!0,phase:"main",fn:n,requiresIfExists:["offset"]}},78224:(ae,J,d)=>{"use strict";d.d(J,{fi:()=>n});var W=d(5926),L=d(72582),B=d(35772),I=d(24502),U=d(32898),D=d(61150),v=d(16087),f=d(29228),u=d(63454),g=d(48051),S=[L.Z,B.Z,I.Z,U.Z,D.Z,v.Z,f.Z,u.Z,g.Z],n=(0,W.kZ)({defaultModifiers:S})},47840:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(65352),L=d(47408),B=d(61919),I=d(49880);function U(D){var v=D.reference,f=D.element,u=D.placement,g=u?(0,W.Z)(u):null,S=u?(0,L.Z)(u):null,n=v.x+v.width/2-f.width/2,s=v.y+v.height/2-f.height/2,i;switch(g){case I.we:i={x:n,y:v.y-f.height};break;case I.I:i={x:n,y:v.y+v.height};break;case I.F2:i={x:v.x+v.width,y:s};break;case I.t$:i={x:v.x-f.width,y:s};break;default:i={x:v.x,y:v.y}}var l=g?(0,B.Z)(g):null;if(l!=null){var w=l==="y"?"height":"width";switch(S){case I.BL:i[l]=i[l]-(v[w]/2-f[w]/2);break;case I.ut:i[l]=i[l]+(v[w]/2-f[w]/2);break;default:}}return i}G(U,"computeOffsets")},24041:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>o});var W=d(49880),L=d(61378),B=d(4377),I=d(61300),U=d(16182);function D(c,m){var A=(0,L.Z)(c),h=(0,B.Z)(c),T=A.visualViewport,R=h.clientWidth,P=h.clientHeight,O=0,M=0;if(T){R=T.width,P=T.height;var j=(0,U.Z)();(j||!j&&m==="fixed")&&(O=T.offsetLeft,M=T.offsetTop)}return{width:R,height:P,x:O+(0,I.Z)(c),y:M}}G(D,"getViewportRect");var v=d(26302),f=d(23111),u=d(62079);function g(c){var m,A=(0,B.Z)(c),h=(0,f.Z)(c),T=(m=c.ownerDocument)==null?void 0:m.body,R=(0,u.Fp)(A.scrollWidth,A.clientWidth,T?T.scrollWidth:0,T?T.clientWidth:0),P=(0,u.Fp)(A.scrollHeight,A.clientHeight,T?T.scrollHeight:0,T?T.clientHeight:0),O=-h.scrollLeft+(0,I.Z)(c),M=-h.scrollTop;return(0,v.Z)(T||A).direction==="rtl"&&(O+=(0,u.Fp)(A.clientWidth,T?T.clientWidth:0)-R),{width:R,height:P,x:O,y:M}}G(g,"getDocumentRect");var S=d(26857),n=d(52839),s=d(52319),i=d(57845),l=d(85564),w=d(75865),b=d(43332);function r(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}G(r,"rectToClientRect");function e(c,m){var A=(0,i.Z)(c,!1,m==="fixed");return A.top=A.top+c.clientTop,A.left=A.left+c.clientLeft,A.bottom=A.top+c.clientHeight,A.right=A.left+c.clientWidth,A.width=c.clientWidth,A.height=c.clientHeight,A.x=A.left,A.y=A.top,A}G(e,"getInnerBoundingClientRect");function a(c,m,A){return m===W.Pj?r(D(c,A)):(0,s.kK)(m)?e(m,A):r(g((0,B.Z)(c)))}G(a,"getClientRectFromMixedType");function p(c){var m=(0,S.Z)((0,l.Z)(c)),A=["absolute","fixed"].indexOf((0,v.Z)(c).position)>=0,h=A&&(0,s.Re)(c)?(0,n.Z)(c):c;return(0,s.kK)(h)?m.filter(function(T){return(0,s.kK)(T)&&(0,w.Z)(T,h)&&(0,b.Z)(T)!=="body"}):[]}G(p,"getClippingParents");function C(c,m,A,h){var T=m==="clippingParents"?p(c):[].concat(m),R=[].concat(T,[A]),P=R[0],O=R.reduce(function(M,j){var Y=a(c,j,h);return M.top=(0,u.Fp)(Y.top,M.top),M.right=(0,u.VV)(Y.right,M.right),M.bottom=(0,u.VV)(Y.bottom,M.bottom),M.left=(0,u.Fp)(Y.left,M.left),M},a(c,P,h));return O.width=O.right-O.left,O.height=O.bottom-O.top,O.x=O.left,O.y=O.top,O}G(C,"getClippingRect");var y=d(47840),z=d(49534),$=d(62219);function o(c,m){m===void 0&&(m={});var A=m,h=A.placement,T=h===void 0?c.placement:h,R=A.strategy,P=R===void 0?c.strategy:R,O=A.boundary,M=O===void 0?W.zV:O,j=A.rootBoundary,Y=j===void 0?W.Pj:j,ee=A.elementContext,X=ee===void 0?W.k5:ee,Q=A.altBoundary,te=Q===void 0?!1:Q,ne=A.padding,fe=ne===void 0?0:ne,re=(0,z.Z)(typeof fe!="number"?fe:(0,$.Z)(fe,W.mv)),ue=X===W.k5?W.YP:W.k5,me=c.rects.popper,we=c.elements[te?ue:X],xe=C((0,s.kK)(we)?we:we.contextElement||(0,B.Z)(c.elements.popper),M,Y,P),Te=(0,i.Z)(c.elements.reference),Pe=(0,y.Z)({reference:Te,element:me,strategy:"absolute",placement:T}),Se=r(Object.assign({},me,Pe)),oe=X===W.k5?Se:Te,ie={top:xe.top-oe.top+re.top,bottom:oe.bottom-xe.bottom+re.bottom,left:xe.left-oe.left+re.left,right:oe.right-xe.right+re.right},pe=c.modifiersData.offset;if(X===W.k5&&pe){var ge=pe[T];Object.keys(ie).forEach(function(ve){var Fe=[W.F2,W.I].indexOf(ve)>=0?1:-1,De=[W.we,W.I].indexOf(ve)>=0?"y":"x";ie[ve]+=ge[De]*Fe})}return ie}G(o,"detectOverflow")},62219:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(L,B){return B.reduce(function(I,U){return I[U]=L,I},{})}G(W,"expandToHashMap")},65352:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(L){return L.split("-")[0]}G(W,"getBasePlacement")},29852:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(){return{top:0,right:0,bottom:0,left:0}}G(W,"getFreshSideObject")},61919:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(L){return["top","bottom"].indexOf(L)>=0?"x":"y"}G(W,"getMainAxisFromPlacement")},47408:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(L){return L.split("-")[1]}G(W,"getVariation")},62079:(ae,J,d)=>{"use strict";d.d(J,{Fp:()=>W,NM:()=>B,VV:()=>L});var W=Math.max,L=Math.min,B=Math.round},49534:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(29852);function L(B){return Object.assign({},(0,W.Z)(),B)}G(L,"mergePaddingObject")},3518:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>W});function W(){var L=navigator.userAgentData;return L!=null&&L.brands&&Array.isArray(L.brands)?L.brands.map(function(B){return B.brand+"/"+B.version}).join(" "):navigator.userAgent}G(W,"getUAString")},72907:(ae,J,d)=>{"use strict";d.d(J,{q:()=>B,u:()=>L});var W=d(62079);function L(I,U,D){return(0,W.Fp)(I,(0,W.VV)(U,D))}G(L,"within");function B(I,U,D){var v=L(I,U,D);return v>D?D:v}G(B,"withinMaxClamp")},41182:function(ae,J,d){(function(W,L){ae.exports=J=L()})(this,function(){var W=W||function(L,B){var I;if(typeof window<"u"&&window.crypto&&(I=window.crypto),typeof self<"u"&&self.crypto&&(I=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(I=globalThis.crypto),!I&&typeof window<"u"&&window.msCrypto&&(I=window.msCrypto),!I&&typeof global<"u"&&global.crypto&&(I=global.crypto),!I)try{I=d(91054)}catch{}var U=G(function(){if(I){if(typeof I.getRandomValues=="function")try{return I.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof I.randomBytes=="function")try{return I.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},"cryptoSecureRandomInt"),D=Object.create||function(){function r(){}return G(r,"F"),function(e){var a;return r.prototype=e,a=new r,r.prototype=null,a}}(),v={},f=v.lib={},u=f.Base=function(){return{extend:function(r){var e=D(this);return r&&e.mixIn(r),(!e.hasOwnProperty("init")||this.init===e.init)&&(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var e in r)r.hasOwnProperty(e)&&(this[e]=r[e]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=f.WordArray=u.extend({init:function(r,e){r=this.words=r||[],e!=B?this.sigBytes=e:this.sigBytes=r.length*4},toString:function(r){return(r||n).stringify(this)},concat:function(r){var e=this.words,a=r.words,p=this.sigBytes,C=r.sigBytes;if(this.clamp(),p%4)for(var y=0;y<C;y++){var z=a[y>>>2]>>>24-y%4*8&255;e[p+y>>>2]|=z<<24-(p+y)%4*8}else for(var $=0;$<C;$+=4)e[p+$>>>2]=a[$>>>2];return this.sigBytes+=C,this},clamp:function(){var r=this.words,e=this.sigBytes;r[e>>>2]&=4294967295<<32-e%4*8,r.length=L.ceil(e/4)},clone:function(){var r=u.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var e=[],a=0;a<r;a+=4)e.push(U());return new g.init(e,r)}}),S=v.enc={},n=S.Hex={stringify:function(r){for(var e=r.words,a=r.sigBytes,p=[],C=0;C<a;C++){var y=e[C>>>2]>>>24-C%4*8&255;p.push((y>>>4).toString(16)),p.push((y&15).toString(16))}return p.join("")},parse:function(r){for(var e=r.length,a=[],p=0;p<e;p+=2)a[p>>>3]|=parseInt(r.substr(p,2),16)<<24-p%8*4;return new g.init(a,e/2)}},s=S.Latin1={stringify:function(r){for(var e=r.words,a=r.sigBytes,p=[],C=0;C<a;C++){var y=e[C>>>2]>>>24-C%4*8&255;p.push(String.fromCharCode(y))}return p.join("")},parse:function(r){for(var e=r.length,a=[],p=0;p<e;p++)a[p>>>2]|=(r.charCodeAt(p)&255)<<24-p%4*8;return new g.init(a,e)}},i=S.Utf8={stringify:function(r){try{return decodeURIComponent(escape(s.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return s.parse(unescape(encodeURIComponent(r)))}},l=f.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=i.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var e,a=this._data,p=a.words,C=a.sigBytes,y=this.blockSize,z=y*4,$=C/z;r?$=L.ceil($):$=L.max(($|0)-this._minBufferSize,0);var o=$*y,c=L.min(o*4,C);if(o){for(var m=0;m<o;m+=y)this._doProcessBlock(p,m);e=p.splice(0,o),a.sigBytes-=c}return new g.init(e,c)},clone:function(){var r=u.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0}),w=f.Hasher=l.extend({cfg:u.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var e=this._doFinalize();return e},blockSize:512/32,_createHelper:function(r){return function(e,a){return new r.init(a).finalize(e)}},_createHmacHelper:function(r){return function(e,a){return new b.HMAC.init(r,a).finalize(e)}}}),b=v.algo={};return v}(Math);return W})},99968:function(ae,J,d){(function(W,L){ae.exports=J=L(d(41182))})(this,function(W){return function(){var L=W,B=L.lib,I=B.WordArray,U=B.Hasher,D=L.algo,v=[],f=D.SHA1=U.extend({_doReset:function(){this._hash=new I.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,g){for(var S=this._hash.words,n=S[0],s=S[1],i=S[2],l=S[3],w=S[4],b=0;b<80;b++){if(b<16)v[b]=u[g+b]|0;else{var r=v[b-3]^v[b-8]^v[b-14]^v[b-16];v[b]=r<<1|r>>>31}var e=(n<<5|n>>>27)+w+v[b];b<20?e+=(s&i|~s&l)+1518500249:b<40?e+=(s^i^l)+1859775393:b<60?e+=(s&i|s&l|i&l)-1894007588:e+=(s^i^l)-899497514,w=l,l=i,i=s<<30|s>>>2,s=n,n=e}S[0]=S[0]+n|0,S[1]=S[1]+s|0,S[2]=S[2]+i|0,S[3]=S[3]+l|0,S[4]=S[4]+w|0},_doFinalize:function(){var u=this._data,g=u.words,S=this._nDataBytes*8,n=u.sigBytes*8;return g[n>>>5]|=128<<24-n%32,g[(n+64>>>9<<4)+14]=Math.floor(S/4294967296),g[(n+64>>>9<<4)+15]=S,u.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var u=U.clone.call(this);return u._hash=this._hash.clone(),u}});L.SHA1=U._createHelper(f),L.HmacSHA1=U._createHmacHelper(f)}(),W.SHA1})},51722:function(ae){(function(J,d){ae.exports=d()})(this,function(){"use strict";var J=1e3,d=6e4,W=36e5,L="millisecond",B="second",I="minute",U="hour",D="day",v="week",f="month",u="quarter",g="year",S="date",n="Invalid Date",s=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,i=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},w=G(function(o,c,m){var A=String(o);return!A||A.length>=c?o:""+Array(c+1-A.length).join(m)+o},"m"),b={s:w,z:function(o){var c=-o.utcOffset(),m=Math.abs(c),A=Math.floor(m/60),h=m%60;return(c<=0?"+":"-")+w(A,2,"0")+":"+w(h,2,"0")},m:G(function o(c,m){if(c.date()<m.date())return-o(m,c);var A=12*(m.year()-c.year())+(m.month()-c.month()),h=c.clone().add(A,f),T=m-h<0,R=c.clone().add(A+(T?-1:1),f);return+(-(A+(m-h)/(T?h-R:R-h))||0)},"t3"),a:function(o){return o<0?Math.ceil(o)||0:Math.floor(o)},p:function(o){return{M:f,y:g,w:v,d:D,D:S,h:U,m:I,s:B,ms:L,Q:u}[o]||String(o||"").toLowerCase().replace(/s$/,"")},u:function(o){return o===void 0}},r="en",e={};e[r]=l;var a=G(function(o){return o instanceof z},"p"),p=G(function(o,c,m){var A;if(!o)return r;if(typeof o=="string")e[o]&&(A=o),c&&(e[o]=c,A=o);else{var h=o.name;e[h]=o,A=h}return!m&&A&&(r=A),A||!m&&r},"S"),C=G(function(o,c){if(a(o))return o.clone();var m=typeof c=="object"?c:{};return m.date=o,m.args=arguments,new z(m)},"w"),y=b;y.l=p,y.i=a,y.w=function(o,c){return C(o,{locale:c.$L,utc:c.$u,x:c.$x,$offset:c.$offset})};var z=function(){function o(m){this.$L=p(m.locale,null,!0),this.parse(m)}G(o,"M2");var c=o.prototype;return c.parse=function(m){this.$d=function(A){var h=A.date,T=A.utc;if(h===null)return new Date(NaN);if(y.u(h))return new Date;if(h instanceof Date)return new Date(h);if(typeof h=="string"&&!/Z$/i.test(h)){var R=h.match(s);if(R){var P=R[2]-1||0,O=(R[7]||"0").substring(0,3);return T?new Date(Date.UTC(R[1],P,R[3]||1,R[4]||0,R[5]||0,R[6]||0,O)):new Date(R[1],P,R[3]||1,R[4]||0,R[5]||0,R[6]||0,O)}}return new Date(h)}(m),this.$x=m.x||{},this.init()},c.init=function(){var m=this.$d;this.$y=m.getFullYear(),this.$M=m.getMonth(),this.$D=m.getDate(),this.$W=m.getDay(),this.$H=m.getHours(),this.$m=m.getMinutes(),this.$s=m.getSeconds(),this.$ms=m.getMilliseconds()},c.$utils=function(){return y},c.isValid=function(){return this.$d.toString()!==n},c.isSame=function(m,A){var h=C(m);return this.startOf(A)<=h&&h<=this.endOf(A)},c.isAfter=function(m,A){return C(m)<this.startOf(A)},c.isBefore=function(m,A){return this.endOf(A)<C(m)},c.$g=function(m,A,h){return y.u(m)?this[A]:this.set(h,m)},c.unix=function(){return Math.floor(this.valueOf()/1e3)},c.valueOf=function(){return this.$d.getTime()},c.startOf=function(m,A){var h=this,T=!!y.u(A)||A,R=y.p(m),P=G(function(te,ne){var fe=y.w(h.$u?Date.UTC(h.$y,ne,te):new Date(h.$y,ne,te),h);return T?fe:fe.endOf(D)},"$2"),O=G(function(te,ne){return y.w(h.toDate()[te].apply(h.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(ne)),h)},"l2"),M=this.$W,j=this.$M,Y=this.$D,ee="set"+(this.$u?"UTC":"");switch(R){case g:return T?P(1,0):P(31,11);case f:return T?P(1,j):P(0,j+1);case v:var X=this.$locale().weekStart||0,Q=(M<X?M+7:M)-X;return P(T?Y-Q:Y+(6-Q),j);case D:case S:return O(ee+"Hours",0);case U:return O(ee+"Minutes",1);case I:return O(ee+"Seconds",2);case B:return O(ee+"Milliseconds",3);default:return this.clone()}},c.endOf=function(m){return this.startOf(m,!1)},c.$set=function(m,A){var h,T=y.p(m),R="set"+(this.$u?"UTC":""),P=(h={},h[D]=R+"Date",h[S]=R+"Date",h[f]=R+"Month",h[g]=R+"FullYear",h[U]=R+"Hours",h[I]=R+"Minutes",h[B]=R+"Seconds",h[L]=R+"Milliseconds",h)[T],O=T===D?this.$D+(A-this.$W):A;if(T===f||T===g){var M=this.clone().set(S,1);M.$d[P](O),M.init(),this.$d=M.set(S,Math.min(this.$D,M.daysInMonth())).$d}else P&&this.$d[P](O);return this.init(),this},c.set=function(m,A){return this.clone().$set(m,A)},c.get=function(m){return this[y.p(m)]()},c.add=function(m,A){var h,T=this;m=Number(m);var R=y.p(A),P=G(function(j){var Y=C(T);return y.w(Y.date(Y.date()+Math.round(j*m)),T)},"y2");if(R===f)return this.set(f,this.$M+m);if(R===g)return this.set(g,this.$y+m);if(R===D)return P(1);if(R===v)return P(7);var O=(h={},h[I]=d,h[U]=W,h[B]=J,h)[R]||1,M=this.$d.getTime()+m*O;return y.w(M,this)},c.subtract=function(m,A){return this.add(-1*m,A)},c.format=function(m){var A=this,h=this.$locale();if(!this.isValid())return h.invalidDate||n;var T=m||"YYYY-MM-DDTHH:mm:ssZ",R=y.z(this),P=this.$H,O=this.$m,M=this.$M,j=h.weekdays,Y=h.months,ee=G(function(ne,fe,re,ue){return ne&&(ne[fe]||ne(A,T))||re[fe].substr(0,ue)},"h2"),X=G(function(ne){return y.s(P%12||12,ne,"0")},"c2"),Q=h.meridiem||function(ne,fe,re){var ue=ne<12?"AM":"PM";return re?ue.toLowerCase():ue},te={YY:String(this.$y).slice(-2),YYYY:this.$y,M:M+1,MM:y.s(M+1,2,"0"),MMM:ee(h.monthsShort,M,Y,3),MMMM:ee(Y,M),D:this.$D,DD:y.s(this.$D,2,"0"),d:String(this.$W),dd:ee(h.weekdaysMin,this.$W,j,2),ddd:ee(h.weekdaysShort,this.$W,j,3),dddd:j[this.$W],H:String(P),HH:y.s(P,2,"0"),h:X(1),hh:X(2),a:Q(P,O,!0),A:Q(P,O,!1),m:String(O),mm:y.s(O,2,"0"),s:String(this.$s),ss:y.s(this.$s,2,"0"),SSS:y.s(this.$ms,3,"0"),Z:R};return T.replace(i,function(ne,fe){return fe||te[ne]||R.replace(":","")})},c.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},c.diff=function(m,A,h){var T,R=y.p(A),P=C(m),O=(P.utcOffset()-this.utcOffset())*d,M=this-P,j=y.m(this,P);return j=(T={},T[g]=j/12,T[f]=j,T[u]=j/3,T[v]=(M-O)/6048e5,T[D]=(M-O)/864e5,T[U]=M/W,T[I]=M/d,T[B]=M/J,T)[R]||M,h?j:y.a(j)},c.daysInMonth=function(){return this.endOf(f).$D},c.$locale=function(){return e[this.$L]},c.locale=function(m,A){if(!m)return this.$L;var h=this.clone(),T=p(m,A,!0);return T&&(h.$L=T),h},c.clone=function(){return y.w(this.$d,this)},c.toDate=function(){return new Date(this.valueOf())},c.toJSON=function(){return this.isValid()?this.toISOString():null},c.toISOString=function(){return this.$d.toISOString()},c.toString=function(){return this.$d.toUTCString()},o}(),$=z.prototype;return C.prototype=$,[["$ms",L],["$s",B],["$m",I],["$H",U],["$W",D],["$M",f],["$y",g],["$D",S]].forEach(function(o){$[o[1]]=function(c){return this.$g(c,o[0],o[1])}}),C.extend=function(o,c){return o.$i||(o(c,z,C),o.$i=!0),C},C.locale=p,C.isDayjs=a,C.unix=function(o){return C(1e3*o)},C.en=e[r],C.Ls=e,C.p={},C})},92045:function(ae){(function(J,d){ae.exports=d()})(this,function(){"use strict";return function(J,d,W){J=J||{};var L=d.prototype,B={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function I(D,v,f,u){return L.fromToBase(D,v,f,u)}G(I,"i"),W.en.relativeTime=B,L.fromToBase=function(D,v,f,u,g){for(var S,n,s,i=f.$locale().relativeTime||B,l=J.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],w=l.length,b=0;b<w;b+=1){var r=l[b];r.d&&(S=u?W(D).diff(f,r.d,!0):f.diff(D,r.d,!0));var e=(J.rounding||Math.round)(Math.abs(S));if(s=S>0,e<=r.r||!r.r){e<=1&&b>0&&(r=l[b-1]);var a=i[r.l];g&&(e=g(""+e)),n=typeof a=="string"?a.replace("%d",e):a(e,v,r.l,s);break}}if(v)return n;var p=s?i.future:i.past;return typeof p=="function"?p(n):p.replace("%s",n)},L.to=function(D,v){return I(D,v,this,!0)},L.from=function(D,v){return I(D,v,this)};var U=G(function(D){return D.$u?W.utc():W()},"d");L.toNow=function(D){return this.to(U(this),D)},L.fromNow=function(D){return this.from(U(this),D)}}})},5199:ae=>{"use strict";ae.exports=()=>/\u{1F3F4}\u{E0067}\u{E0062}(?:\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074}|\u{E0065}\u{E006E}\u{E0067})\u{E007F}|(?:\u{1F9D1}\u{1F3FF}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FF}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FE}]|(?:\u{1F9D1}\u{1F3FE}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FE}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FD}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FD}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FC}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FC}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FB}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FC}-\u{1F3FF}]|\u{1F468}(?:\u{1F3FB}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u{1F91D}\u200D\u{1F468}[\u{1F3FC}-\u{1F3FF}]|[\u2695\u2696\u2708]\uFE0F|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]))?|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FE}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])\uFE0F|\u200D(?:[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC})?|(?:\u{1F469}(?:\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}]))|\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]\u200D\u{1F91D}\u200D\u{1F9D1})[\u{1F3FB}-\u{1F3FF}]|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F469}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F9D1}(?:\u200D(?:\u{1F91D}\u200D\u{1F9D1}|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F9D1}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F469}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F636}\u200D\u{1F32B}|\u{1F3F3}\uFE0F\u200D\u26A7|\u{1F43B}\u200D\u2744|(?:[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u{1F3F4}\u200D\u2620|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]\u200D[\u2640\u2642]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u2600-\u2604\u260E\u2611\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26B0\u26B1\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0\u26F1\u26F4\u26F7\u26F8\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u3030\u303D\u3297\u3299\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F202}\u{1F237}\u{1F321}\u{1F324}-\u{1F32C}\u{1F336}\u{1F37D}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}\u{1F39F}\u{1F3CD}\u{1F3CE}\u{1F3D4}-\u{1F3DF}\u{1F3F5}\u{1F3F7}\u{1F43F}\u{1F4FD}\u{1F549}\u{1F54A}\u{1F56F}\u{1F570}\u{1F573}\u{1F576}-\u{1F579}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}\u{1F6CB}\u{1F6CD}-\u{1F6CF}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6F0}\u{1F6F3}])\uFE0F|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F469}\u200D\u{1F467}|\u{1F469}\u200D\u{1F466}|\u{1F635}\u200D\u{1F4AB}|\u{1F62E}\u200D\u{1F4A8}|\u{1F415}\u200D\u{1F9BA}|\u{1F9D1}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F469}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F1FD}\u{1F1F0}|\u{1F1F6}\u{1F1E6}|\u{1F1F4}\u{1F1F2}|\u{1F408}\u200D\u2B1B|\u2764\uFE0F\u200D[\u{1F525}\u{1FA79}]|\u{1F441}\uFE0F|\u{1F3F3}\uFE0F|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|[#\*0-9]\uFE0F\u20E3|\u2764\uFE0F|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]|\u{1F3F4}|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270C\u270D\u{1F574}\u{1F590}][\uFE0F\u{1F3FB}-\u{1F3FF}]|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F408}\u{1F415}\u{1F43B}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F62E}\u{1F635}\u{1F636}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F384}\u{1F386}-\u{1F393}\u{1F3A0}-\u{1F3C1}\u{1F3C5}\u{1F3C6}\u{1F3C8}\u{1F3C9}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F8}-\u{1F407}\u{1F409}-\u{1F414}\u{1F416}-\u{1F43A}\u{1F43C}-\u{1F43E}\u{1F440}\u{1F444}\u{1F445}\u{1F451}-\u{1F465}\u{1F46A}\u{1F479}-\u{1F47B}\u{1F47D}-\u{1F480}\u{1F484}\u{1F488}-\u{1F48E}\u{1F490}\u{1F492}-\u{1F4A9}\u{1F4AB}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F5A4}\u{1F5FB}-\u{1F62D}\u{1F62F}-\u{1F634}\u{1F637}-\u{1F644}\u{1F648}-\u{1F64A}\u{1F680}-\u{1F6A2}\u{1F6A4}-\u{1F6B3}\u{1F6B7}-\u{1F6BF}\u{1F6C1}-\u{1F6C5}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90D}\u{1F90E}\u{1F910}-\u{1F917}\u{1F91D}\u{1F920}-\u{1F925}\u{1F927}-\u{1F92F}\u{1F93A}\u{1F93F}-\u{1F945}\u{1F947}-\u{1F976}\u{1F978}\u{1F97A}-\u{1F9B4}\u{1F9B7}\u{1F9BA}\u{1F9BC}-\u{1F9CB}\u{1F9D0}\u{1F9E0}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93C}-\u{1F93E}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9BB}\u{1F9CD}-\u{1F9CF}\u{1F9D1}-\u{1F9DD}]/gu},67392:(ae,J,d)=>{"use strict";d.d(J,{Tr:()=>a,ZP:()=>l});var W=d(24431),L=d(46949),B=d(83269),I=d(22527),U=d(2356);const D=G((C,y)=>fetch(C,y).then(z=>z.ok?z.json():null).catch(()=>null),"fetchJSON"),v=/\s*at\s+(.+?)\s+\((.+)\)$/,f=/^(.+):\/\/(.+?)(?:\?[a-zA-Z0-9]+)?:(\d+:\d+)$/,u={filter(C){return C.includes(".frankerfacez.com")||C.includes("localhost")},cacheGlobally:!0},g=["/src/i18n.js","/src/utilities/vue.js"],S=["(\u30FB`\u03C9\xB4\u30FB)",";;w;;","owo","ono","oAo","oxo","ovo;","UwU",">w<","^w^","> w >","v.v"],n=G((C,y)=>C.map(z=>{if(typeof z=="string")return y(z);if(typeof z=="object"&&z.o){const $=Object.assign(z,{o:{}});for(const o of Object.keys(z.o))$.o[o]=n(z.o[o],y)}return z}),"transformText"),s=G(C=>C.replace(/(?:r|l)/g,"w").replace(/(?:R|L)/g,"W").replace(/n([aeiou])/g,"ny$1").replace(/N([aeiou])/g,"Ny$1").replace(/N([AEIOU])/g,"NY$1").replace(/ove/g,"uv").replace(/!+/g,` ${(0,L.pick_random)(S)} `),"owo"),i={double:(C,y)=>[...y," ",...y],upper:(C,y)=>n(y,z=>z.toUpperCase()),lower:(C,y)=>n(y,z=>z.toLowerCase()),append_key:(C,y)=>[...y,` (${C})`],set_key:C=>[C],owo:(C,y)=>n(y,s)},p=class p extends I.default{constructor(...y){super(...y),this.inject("settings"),this._seen=new Set,this.availableLocales=["en"],this.chunks=["client"],this.localeData={en:{name:"English"}},this.loadLocales(),this.strings_loaded=!1,this.new_strings=0,this.changed_strings=0,this.capturing=!1,this.captured=new Map,this.settings.addUI("i18n.debug.open",{path:"Debugging > Localization >> Editing",component:"i18n-open",force_seen:!0}),this.settings.add("i18n.debug.capture",{default:null,process(z,$){return $===null?W.DEBUG:$},ui:{path:"Debugging > Localization >> General",title:"Enable message capture.",description:"Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.",component:"setting-check-box",force_seen:!0},changed:z=>{this.capturing=z}}),this.settings.add("i18n.debug.transform",{default:null,ui:{path:"Debugging > Localization >> General",title:"Transformation",description:"Transform all localized strings to test string coverage as well as length.",component:"setting-select-box",data:[{value:null,title:"Disabled"},{value:"upper",title:"Upper Case"},{value:"lower",title:"Lower Case"},{value:"append_key",title:"Append Key"},{value:"set_key",title:"Set to Key"},{value:"double",title:"Double"},{value:"owo",title:"owo what's this"}]},changed:z=>{this._.transformation=i[z],this.emit(":transform"),this.emit(":update")}}),this.settings.add("i18n.locale",{default:-1,process:(z,$)=>{if(($===-1||typeof $!="string")&&($=z.get("context.session.languageCode")||"en"),this.availableLocales.includes($))return $;if($==="no"&&this.availableLocales.includes("nb"))return"nb";const o=$.indexOf("-");return o===-1?"en":($=$.slice(0,o),this.availableLocales.includes($)?$:"en")},ui:{path:'Appearance > Localization >> General @{"sort":-100}',title:"Language",description:"FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.",component:"setting-select-box",data:(z,$)=>this.getLocaleOptions($)},changed:z=>this.locale=z}),this.settings.add("i18n.format.date",{default:"default",ui:{path:"Appearance > Localization >> Formatting",title:"Date Format",description:"The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"date",component:"format-preview"},data:()=>{const z=[],$=new Date;for(const[o,c]of Object.entries(this._.formats.date))z.push({value:o,title:`${this.formatDate($,o)} (${o})`});return z}},changed:z=>{this._.defaultDateFormat=z,this.emit(":update")}}),this.settings.add("i18n.format.time",{default:"short",ui:{path:"Appearance > Localization >> Formatting",title:"Time Format",description:"The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"time",component:"format-preview"},data:()=>{const z=[],$=new Date;for(const[o,c]of Object.entries(this._.formats.time))z.push({value:o,title:`${this.formatTime($,o)} (${o})`});return z}},changed:z=>{this._.defaultTimeFormat=z,this.emit(":update")}}),this.settings.add("i18n.format.datetime",{default:"medium",ui:{path:"Appearance > Localization >> Formatting",title:"Date-Time Format",description:"The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"datetime",component:"format-preview"},data:()=>{const z=[],$=new Date;for(const[o,c]of Object.entries(this._.formats.datetime))z.push({value:o,title:`${this.formatDateTime($,o)} (${o})`});return z}},changed:z=>{this._.defaultDateTimeFormat=z,this.emit(":update")}})}getLocaleOptions(y){y===void 0&&(y=this.settings.get("i18n.locale"));const z=[],$=[];for(const c of this.availableLocales){const m=this.localeData[c];let A=m?.native_name||m?.name||c;m?.coverage!=null&&m?.coverage<100&&(A=this.t("i18n.locale-coverage","{name} ({coverage,number,percent} Complete)",{name:A,coverage:m.coverage/100}));const h={selected:y===c,value:c,title:A};m?.joke?$.push(h):z.push(h)}z.sort((c,m)=>c.title.localeCompare(m.title)),$.sort((c,m)=>c.title.localeCompare(m.title));let o=[{selected:y===-1,value:-1,i18n_key:"setting.appearance.localization.general.language.twitch",title:"Use Twitch's Language"}];return z.length&&(o.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.languages",title:"Supported Languages"}),o=o.concat(z)),$.length&&(o.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.joke",title:"Joke Languages"}),o=o.concat($)),o}onEnable(){this.capturing=this.settings.get("i18n.debug.capture"),this.capturing&&this.loadStrings(),this._=new U.default({warn:(...y)=>this.log.warn(...y),defaultDateFormat:this.settings.get("i18n.format.date"),defaultTimeFormat:this.settings.get("i18n.format.time"),defaultDateTimeFormat:this.settings.get("i18n.format.datetime")}),window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-i18n")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._.transformation=i[this.settings.get("i18n.debug.transform")],this.locale=this.settings.get("i18n.locale")}async loadChunk(y){if(this.chunks.includes(y))return[];this.chunks.push(y);const z=this._.locale,$=await this.loadLocale(z,y),o=this._.extend($);return o.length&&(this.log.info(`Loaded Chunk: ${y} -- Phrases: ${o.length}`),this.emit(":loaded",o),this.emit(":update")),o}broadcast(y){this._broadcaster&&this._broadcaster.postMessage(y)}getKeys(){const y=[];for(const z of this.captured.values()){const $=(0,L.deep_copy)(z);$.translation=this._.phrases.get($.key)||$.phrase,y.push($)}return y}requestKeys(){this.broadcast({type:"request-keys"})}updatePhrase(y,z){this.broadcast({type:"update-key",key:y,phrase:z}),this._.extend({[y]:z}),this.emit(":loaded",[y]),this.emit(":update")}handleMessage(y){const z=y.data;if(z){if(z.type==="update-key")this._.extend({[z.key]:z.phrase}),this.emit(":loaded",[z.key]),this.emit(":update");else if(z.type==="request-keys")this.broadcast({type:"keys",data:Array.from(this.captured.values())});else if(z.type==="keys"&&Array.isArray(z.data)){for(const $ of z.data)this.captured.set($.key,$);this.emit(":got-keys")}}}openUI(y=!0){this.capturing||(this.capturing=!0,this.emit(":update"));const z=this.resolve("translation_ui");y?z.openPopout():z.enable()}get dayjsLocale(){return this._?._dayjs_locale}get locale(){return this._&&this._.locale}set locale(y){this.setLocale(y)}async loadStrings(y=!1){if(this.strings_loaded&&!y||this.strings_loading)return;this.strings_loading=!0;const z=await fetch(`${W.SERVER}/script/locale/strings.json?_=${(0,B.getBuster)(30)}`);let $;z.ok?$=await z.json():(this.log.warn(`Error Loading Strings -- Status: ${z.status}`),$=[]);for(const o of $){const c=o.id;let m=this.captured.get(c);if(m||(this.captured.set(c,m={key:c,phrase:o.default,hits:0,calls:[]}),o.source?.length&&m.calls.push(o.source)),!m.options&&o.context?.length)try{m.options=JSON.parse(o.context)}catch{}m.known=o.default,m.different=o.default!==m.phrase}this.new_strings=0,this.changed_strings=0;for(const o of this.captured.values())o.known||this.new_strings++,o.different&&this.changed_strings++;this.strings_loaded=!0,this.strings_loading=!1,this.log.info(`Loaded ${$.length} strings from the server.`),this.emit(":strings-loaded"),this.emit(":new-strings",this.new_strings),this.emit(":changed-strings",this.changed_strings)}see(y,z,$){if(!this.capturing)return;let o;try{o=new Error().stack}catch(m){try{o=m.stack}catch{}}let c=this.captured.get(y);c||(this.captured.set(y,c={key:y,phrase:z,hits:0,calls:[]}),this.strings_loaded&&(this.new_strings++,this.emit(":new-strings",this.new_strings))),z!==c.phrase&&(c.phrase=z,c.known&&z!==c.known&&!c.different&&(c.different=!0,this.changed_strings++,this.emit(":changed-strings",this.changed_strings))),c.options=this.pluckVariables(y,$),c.hits++,o&&(this.mapStackTrace?this.mapStackTrace(o,m=>this.recordCall(c,m),u):Promise.all([d.e(7852),d.e(1871)]).then(d.t.bind(d,58194,23)).then(m=>{this.mapStackTrace=m.mapStackTrace,this.mapStackTrace(o,A=>this.recordCall(c,A),u)}))}pluckVariables(y,z){const $=this._.cache.get(y);if(!$)return null;const o={};return this._doPluck($,z,o),Object.keys(o).length?o:null}_doPluck(y,z,$){if(Array.isArray(y)){for(const o of y)this._doPluck(o,z,$);return}if(typeof y=="object"&&y.v){const o=(0,L.get)(y.v,z);if(o&&o.$$typeof)return;$[y.v]=(0,L.shallow_copy)(o)}}recordCall(y,z){if(Array.isArray(z))for(const $ of z){const o=v.exec($);if(!o)continue;const c=f.exec(o[2]);if(!c||c[1]!=="webpack")continue;const m=c[2];if(m.includes("/node_modules/")||g.includes(m))continue;let A;if(o[1]==="MainMenu.getSettingsTree")A="FFZ Control Center";else{let h=o[1];(h==="Proxy.render"||h.startsWith("Proxy.push"))&&c[2].includes(".vue")&&(h="Vue Component"),A=`${h} (${c[2]}:${c[3]})`}y.calls.includes(A)||y.calls.push(A);return}}async loadLocales(){const y=await fetch(`${W.SERVER}/script/locale/locales.json?_=${(0,B.getBuster)(30)}`);let z;y.ok?z=await y.json():this.log.warn(`Error Populating Locales -- Status: ${y.status}`),(!Array.isArray(z)||!z.length)&&(z=[{id:"en",name:"English",coverage:100,rtl:!1,hashes:{}}]),this.localeData={},this.availableLocales=[];for(const $ of z){const o=$.id.toLowerCase();this.localeData[o]=$,this.availableLocales.push(o)}this.emit(":locales-loaded")}async loadLocale(y,z=null){if(y=y.toLowerCase(),y==="en")return{};const $=this.localeData[y]?.hashes;if(!$)return this.log.info(`Cannot Load Locale: ${y}`),{};z?Array.isArray(z)||(z=[z]):z=this.chunks;const o=this.localeData[y].id,c=[];for(const T of z){const R=$[T];R&&c.push(D(`https://cdn2.frankerfacez.com/static/locale/${o}/${T}.${R}.json`))}const m=await Promise.all(c),A={};let h=0;for(const T of m)if(T)for(const[R,P]of Object.entries(T))typeof P=="string"&&P.length>0?A[R]=P:h++;return h>0&&this.log.debug(`Ignored ${h} invalid values while loading ${y} chunks.`),A}async setLocale(y){y=y.toLowerCase();const z=this._.locale;if(y===z)return[];if(this._.locale=y,this._.clear(),this.log.info(`Changed Locale: ${y} -- Old: ${z}`),this.emit(":changed",y,z),this.emit(":update"),y==="en")return this.emit(":loaded",[]),this._._dayjs_locale="en",[];const $=this.localeData[y],o=await this.loadLocale($?.id||y);let c;try{c=$?.dayjs_override||y,await this.loadDayjsLocale(c)}catch{this.log.warn(`Unable to load DayJS locale for ${y}`),c="en"}if(this._.locale!==y)throw new Error("locale has changed since we started loading");this._._dayjs_locale=c;const m=this._.extend(o);return m.length&&(this.log.info(`Loaded Locale: ${y} -- Phrases: ${m.length}`),this.emit(":loaded",m),this.emit(":update")),m}async loadDayjsLocale(y){if(!(y==="en"||y==="en-arrr"))try{await d(73637)(`./${y}.js`)}catch(z){this.log.warn(`Unable to load day.js locale data for locale "${y}"`,z)}}has(y){return this._.has(y)}formatNode(...y){return this._.formatNode(...y)}toLocaleString(...y){return this._.toLocaleString(...y)}toRelativeTime(...y){return this._.formatRelativeTime(...y)}formatNumber(...y){return this._.formatNumber(...y)}formatCurrency(...y){return this._.formatCurrency(...y)}formatDuration(...y){return this._.formatDuration(...y)}formatDate(...y){return this._.formatDate(...y)}formatTime(...y){return this._.formatTime(...y)}formatDateTime(...y){return this._.formatDateTime(...y)}t(y,...z){return this.see(y,...z),this._.t(y,...z)}tList(y,...z){return this.see(y,...z),this._.tList(y,...z)}};G(p,"TranslationManager");let l=p;const w=/\$/g,b=String.prototype.replace,r=/^\s*([^(]+?)\s*(?:\(\s*([^)]+?)\s*\))?\s*$/;function e(C){if(!C||!C.length)return;const y=[];for(const z of C.split(/\|/g)){const $=r.exec(z);$&&y.push({fmt:$[1],extra:$[2]})}return y}G(e,"parseFormatters");function a(C,y,z,$,o){const c=Array.isArray(C);if(y==null)return c?C[0]:C;let m=C;const A=typeof y=="number"?{count:y}:y;return c&&(m=m[0]),typeof m=="string"&&(m=b.call(m,$,(h,T,R)=>{let P=(0,L.get)(T.trim(),A);if(P==null)return"";const O=e(R);let M=!1;if(O)for(const j of O){const Y=o[j.fmt];typeof Y=="function"&&(P=Y(P,z,A,j.extra),M=!0)}return!M&&typeof P=="string"&&(P=b.call(P,w,"$$")),P})),m}G(a,"transformPhrase")},29986:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>g});var W=d(24431),L=d(22527),B=d(46949),I=d(44589),U=d(8528),D=d(8242),v=d(2682),f=d(67392);const u=/\{\{(.*?)(?:\|(.*?))?\}\}/g,S=class S extends L.default{constructor(...s){super(...s),this.inject("settings"),this.inject("tooltips"),this.inject("i18n"),this.actions={},this.renderers={},this.filterAction=i=>i.appearance&&this.renderers[i.appearance.type]&&(!this.renderers[i.appearance.type].load||this.renderers[i.appearance.type].load(i.appearance))&&(!i.action||this.actions[i.action]),this.settings.add("chat.actions.size",{default:16,ui:{path:'Chat > Actions @{"always_list_pages": true} >> Appearance',title:"Action Size",description:"How tall actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.hover-size",{default:30,ui:{path:"Chat > Actions > Message Hover >> Appearance",title:"Action Size",description:"How tall hover actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.reasons",{default:[{v:{text:"One-Man Spam",i18n:"chat.reasons.spam"}},{v:{text:"Posting Bad Links",i18n:"chat.reasons.links"}},{v:{text:"Ban Evasion",i18n:"chat.reasons.evasion"}},{v:{text:"Threats / Personal Info",i18n:"chat.reasons.personal"}},{v:{text:"Hate / Harassment",i18n:"chat.reasons.hate"}},{v:{text:"Ignoring Broadcaster / Moderators",i18n:"chat.reason.ignore"}}],type:"array_merge",always_inherit:!0,process(i,l){if(Array.isArray(l))for(const w of l)w.i18n&&typeof w.i18n!="string"&&delete w.i18n;return l},ui:{path:"Chat > Actions > Reasons >> Custom Reasons",component:"chat-reasons"}}),this.settings.add("chat.actions.hover",{process:(i,l)=>l.filter(this.filterAction),default:[{v:{action:"pin",appearance:{type:"icon",icon:"ffz-i-pin"},options:{},display:{mod_icons:!0}}},{v:{action:"reply",appearance:{type:"dynamic"},options:{},display:{}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > Message Hover @{"description": "Here, you can define custom actions that will appear on top of messages in chat when you hover over them. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,hover_modifier:!1,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,B.deep_copy)(this.actions),renderers:(0,B.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.inline",{process:(i,l)=>l.filter(this.filterAction),default:[{v:{action:"ban",appearance:{type:"icon",icon:"ffz-i-block"},options:{},display:{mod:!0,mod_icons:!0,deleted:!1}}},{v:{action:"unban",appearance:{type:"icon",icon:"ffz-i-ok"},options:{},display:{mod:!0,mod_icons:!0,deleted:!0}}},{v:{action:"timeout",appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}},{v:{action:"msg_delete",appearance:{type:"icon",icon:"ffz-i-trash"},options:{},display:{mod:!0,mod_icons:!0}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > In-Line @{"description": "Here, you can define custom actions that will appear along messages in chat. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,B.deep_copy)(this.actions),renderers:(0,B.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.user-context",{process:(i,l)=>l.filter(w=>w.type||this.filterAction(w)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > User Context @{"description": "Here, you can define custom actions that will appear in a context menu when you right-click a username in chat."}',component:"chat-actions",context:["user","room","message"],mod_icons:!0,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,B.deep_copy)(this.actions),renderers:(0,B.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room",{process:(i,l)=>l.filter(w=>w.type||this.filterAction(w)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > Room @{"description": "Here, you can define custom actions that will appear above the chat input box."}',component:"chat-actions",context:["room","room-mode"],inline:!1,data:()=>{const i=this.resolve("site.chat");return{color:l=>i&&i.colors?i.colors.process(l):l,actions:(0,B.deep_copy)(this.actions),renderers:(0,B.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room-above",{default:!1,ui:{path:"Chat > Actions > Room >> General",component:"setting-check-box",title:"Display Room Actions above the chat input box."}}),this.settings.add("chat.actions.rules-as-reasons",{default:!0,ui:{path:"Chat > Actions > Reasons >> Rules",component:"setting-check-box",title:"Include the current room's rules in the list of reasons."}}),this.handleClick=this.handleClick.bind(this),this.handleContext=this.handleContext.bind(this),this.handleUserContext=this.handleUserContext.bind(this)}onEnable(){this.tooltips.types.action=(s,i)=>{const l=this.getData(s);return l?l.definition.tooltip?l.tip&&l.tip.length?this.replaceVariables(l.tip,l):(0,B.maybe_call)(l.definition.tooltip,this,l,s,i):`Error: The "${l.action}" action provider does not have tooltip support.`:this.i18n.t("chat.actions.unknown","Unknown Action Type")};for(const s in D)(0,B.has)(D,s)&&this.addAction(s,D[s]);for(const s in v)(0,B.has)(v,s)&&this.addRenderer(s,v[s]);this.on("addon:fully-unload",s=>{let i=0;for(const[l,w]of Object.entries(this.actions))w?.__source===s&&(i++,delete this.actions[l]);for(const[l,w]of Object.entries(this.renderers))w?.__source===s&&(i++,delete this.renderers[l]);i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,s),this._updateContexts())})}getAddonProxy(s,i,l){if(!s)return this;const w={},b={},r=W.DEBUG||i?.dev;return w.addAction=(e,a)=>(a&&(a.__source=s),r&&!e.includes(s)&&l.log.warn("[DEV-CHECK] Call to actions.addAction() did not include add-on ID in key:",e),this.addAction(e,a)),w.addRenderer=(e,a)=>(a&&(a.__source=s),r&&!e.includes(s)&&l.log.warn("[DEV-CHECK] Call to actions.addRenderer() did not include add-on ID in key:",e),this.addRenderer(e,a)),r&&(w.removeAction=(...e)=>{for(const a of e){const p=this.actions[a];p&&p.__source!==s&&l.log.warn("[DEV-CHECK] Removed un-owned action with actions.removeAction:",a," owner:",p.__source??"ffz")}return this.removeAction(...e)},w.removeRenderer=(...e)=>{for(const a of e){const p=this.renderers[a];p&&p.__source!==s&&l.log.warn("[DEV-CHECK] Removed un-owned renderer with actions.removeRenderer:",a," owner:",p.__source??"ffz")}return this.removeRenderer(...e)},b.actions="Please use addAction() or removeAction()",b.renderers="Please use addRenderer() or removeRenderer()"),(0,L.buildAddonProxy)(l,this,"actions",w,b)}_updateContexts(){for(const s of this.settings.__contexts)s.update("chat.actions.inline"),s.update("chat.actions.hover"),s.update("chat.actions.user-context"),s.update("chat.actions.room")}addAction(s,i){if((0,B.has)(this.actions,s))return this.log.warn(`Attempted to add action "${s}" which is already defined.`);this.actions[s]=i,this._updateContexts()}addRenderer(s,i){if((0,B.has)(this.renderers,s))return this.log.warn(`Attempted to add renderer "${s}" which is already defined.`);this.renderers[s]=i,this._updateContexts()}getActions(){return{...this.actions}}getAction(s){return this.actions[s]??null}getRenderer(s){return this.renderers[s]??null}getRenderers(){return{...this.renderers}}removeAction(...s){let i=!1;for(const l of s)(0,B.has)(this.actions,l)&&(delete this.actions[l],i=!0);i&&this._updateContexts()}removeRenderer(...s){let i=!1;for(const l of s){if(!(0,B.has)(this.renderers,l))return;delete this.renderers[l],i=!0}i&&this._updateContexts()}replaceVariables(s,i){return(0,f.Tr)(s,i,this.i18n.locale,u,{upper(l){return l.toString().toUpperCase()},uppercase(l){return l.toString().toUpperCase()},lower(l){return l.toString().toLowerCase()},lowercase(l){return l.toString().toLowerCase()},snakecase(l){return l.toString().toSnakeCase()},slugify(l,w,b,r){return l.toString().toSlug(r&&r.length?r:"-")},urlencode(l){return encodeURIComponent(l)},word(l,w,b,r){if(!r||!r.length)return l;let e,a;const p=r.split(",");try{if(e=parseInt(p[0],10),isNaN(e)||!isFinite(e))return l}catch{return this.log.warn("Invalid value for word(start)",p[0]),l}if(p.length>1)if(!p[1].trim().length)a=-1;else try{if(a=parseInt(p[1],10),isNaN(a)||!isFinite(a))return l}catch{return this.log.warn("Invalid value for word(end)",p[1]),l}const C=l.split(/\s+/);return e<0&&(e=C.length+e),e<0&&(e=0),e>=C.length&&(e=C.length-1),a!=null?(a<0&&(a=C.length+a),a<e&&(a=e),a>C.length&&(a=C.length),C.slice(e,a+1).join(" ")):C[e]}})}renderInlineReasons(s,i,l){const w=this.parent.context.get("chat.actions.reasons"),b=[],r=this.parent.context.get("chat.actions.rules-as-reasons")&&this.parent.getRoom(s.room.id,s.room.login,!0),e=r&&r.rules;if(!w&&!e)return l.hide(),null;const a=G(C=>y=>(l.hide(),s.definition.click.call(this,y,Object.assign({reason:C},s)),y.preventDefault(),!1),"click_fn");if(w&&w.length)for(const C of w){const y=this.replaceVariables(typeof C.i18n=="string"?this.i18n.t(C.i18n,C.text):C.text,s);b.push((0,I.createElement)("li",{class:"tw-full-width tw-relative"},(0,I.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:a(y)},y)))}if(e&&e.length){w&&w.length&&b.push((0,I.createElement)("div",{class:"tw-mg-y-05 tw-border-b"}));for(const C of e)b.push((0,I.createElement)("li",{class:"tw-full-width tw-relative"},(0,I.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:a(C)},C)))}let p;return s.definition.reason_text?p=s.definition.reason_text.call(this,s,i,l):p=this.i18n.t("chat.actions.select-reason","Please select a reason from the list below:"),(0,I.createElement)("div",{class:"ffz--inline-reasons"},p?(0,I.createElement)("div",{class:"tw-pd-05 tw-border-b"},p):null,(0,I.createElement)("div",{class:"scrollable-area","data-simplebar":!0},(0,I.createElement)("div",{class:"simplebar-scroll-content"},(0,I.createElement)("div",{class:"simplebar-content"},(0,I.createElement)("ul",null,b)))))}renderInlineContext(s,i){const l=i.definition;let w;if(l.context)w=G((b,r)=>l.context.call(this,i,b,r),"content");else if(l.uses_reason)w=G((b,r)=>this.renderInlineReasons(i,b,r),"content");else return;return this.renderPopup(s,w)}renderPopup(s,i){if(s._ffz_destroy)return s._ffz_destroy();const l=s._ffz_destroy=()=>{if(s._ffz_outside&&s._ffz_outside.destroy(),s._ffz_popup){const r=s._ffz_popup;s._ffz_popup=null,r.destroy()}s._ffz_on_destroy&&s._ffz_on_destroy(),s._ffz_destroy=s._ffz_outside=s._ffz_on_destroy=null},w=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(s._ffz_popup=new U.default(w,s,{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:w},flip:{behavior:["bottom","top","left","right"]}}},content:i,onShow:async(r,e)=>{await e.waitForDom(),s._ffz_outside=new I.ClickOutside(e.outer,l)},onMove:(r,e,a)=>{this.emit("tooltips:hover",r,e,a)},onLeave:(r,e,a)=>{this.emit("tooltips:leave",r,e,a)},onHide:l}))._enter(s)}getUserLevel(s,i){return!s||!i?0:s.id===i.id||s.login===i.login?5:i.moderator||i.type==="mod"||i.badges&&i.badges.moderator?3:0}renderRoom(s,i,l,w,b){const r=[],e=this.resolve("site.chat");let a=null;for(const z of this.parent.context.get("chat.actions.room")){if(!z)continue;z.ctx="room";const $=z.type;if($){$==="new-line"?a=null:$==="space"?(a||r.push(a=[]),a.push(b("div",{class:"tw-flex-grow-1"}))):$==="space-small"?(a||r.push(a=[]),a.push(b("div",{class:"tw-mg-x-1"}))):this.log.warn("Unknown action type",$);continue}if(!z.action||!z.appearance)continue;let o=z.appearance||{};const c=z.display||{},m=this.actions[z.action];if(!m||c.disabled||c.mod_icons!=null&&c.mod_icons!==!!s||c.mod!=null&&c.mod!==(i?!!i.mod:!1)||c.staff!=null&&c.staff!==(i?!!i.staff:!1)||c.emoteOnly!=null&&c.emoteOnly!==l.emoteOnly||c.slowMode!=null&&c.slowMode!==l.slowMode||c.subsMode!=null&&c.subsMode!==l.subsMode||c.r9kMode!=null&&c.r9kMode!==l.r9kMode||c.followersOnly!=null&&c.followersOnly!==l.followersOnly||(0,B.maybe_call)(m.hidden,this,z,null,l,i,s))continue;if(o.type==="dynamic"){const O=m.dynamicAppearance&&m.dynamicAppearance.call(this,Object.assign({},o),z,null,l,i,s);O&&(o=O)}if(m.override_appearance){const O=m.override_appearance.call(this,Object.assign({},o),z,null,l,i,s);O&&(o=O)}const A=this.renderers[o.type];if(!A)continue;const h=A.colored&&o.color,T=(0,B.maybe_call)(m.disabled,this,z,null,l,i,s)||!1,R=h&&(e&&e.colors?e.colors.process(o.color):o.color),P=A.render.call(this,o,b,R);a||r.push(a=[]),a.push(b("button",{class:`ffz-tooltip tw-pd-x-05 mod-icon ffz-mod-icon tw-c-text-alt-2${T?" disabled":""}${h?" colored":""}`,"data-tooltip-type":"action","data-action":z.action,"data-options":z.options?JSON.stringify(z.options):null,"data-tip":o.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},P))}if(!r.length)return null;const p=l&&JSON.stringify(l),C=r.length>1,y=C?r.map((z,$)=>b("div",{key:$,class:"tw-flex tw-full-width tw-flex-row tw-flex-wrap"},z)):r[0];return b("div",{class:`ffz--room-actions${C?" tw-flex-column":""} ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${w?"tw-pd-y-05 tw-border-t":"tw-mg-x-05"}`,"data-room":p},y)}renderUserContext(s,i){const l=this.resolve("site.fine"),w=this.resolve("site"),b=this.resolve("site.chat"),r=l&&l.searchParent(s,h=>h.props&&h.props.message),e=r?.props?.message;if(!e||!w||!b)return;let a=e.roomLogin?e.roomLogin:e.channel?e.channel.slice(1):void 0;if(!a&&r.props.channelID){const h=this.parent.getRoom(r.props.channelID,null,!0);h&&h.login&&(a=e.roomLogin=h.login)}const p=w.getUser(),C={id:r.props.channelID,login:a},y=!!(r.props.hasReply||r.props.reply||!r.props.replyRestrictedReason),z=y&&e.message&&!e.deleted&&!r.props.disableReplyClick,$=z&&(y||p&&p.login!==e.user?.login);e.roomId=C.id,p&&(p.moderator=r.props.isCurrentUserModerator,p.staff=r.props.isCurrentUserStaff,p.reply_mode=this.parent.context.get("chat.replies.style"),p.can_reply=$);const o=this.getUserLevel(C,p),c=this.getUserLevel(C,e.user);let m=r.props.showModerationIcons;o<3&&(m=!1);const A=r;return this.renderPopup(s,(h,T)=>{const R=[];let P=null;const O=G(j=>{this.handleClick(j,P),T.hide()},"handle_click");for(const j of i){if(!j)continue;if(j.ctx="user_context",j.type==="new-line"){P=null;continue}else if(j.type==="space-small"){P||R.push(P=[]),P.push((0,I.createElement)("div",{class:"tw-pd-x-1"}));continue}else if(j.type==="space"){P||R.push(P=[]),P.push((0,I.createElement)("div",{class:"tw-flex-grow-1"}));continue}else if(!j.action||!j.appearance)continue;let Y=j.appearance||{};const ee=j.display||{},X=this.actions[j.action];if(!X||ee.disabled||ee.mod_icons!=null&&ee.mod_icons!==!!m||ee.mod!=null&&ee.mod!==o>c||ee.staff!=null&&ee.staff!==(p?!!p.staff:!1)||ee.deleted!=null&&ee.deleted!==!!e.deleted||(0,B.maybe_call)(X.hidden,this,j,e,C,p,m,A))continue;if(Y.type==="dynamic"){const me=X.dynamicAppearance&&X.dynamicAppearance.call(this,Object.assign({},Y),j,e,C,p,m,A);me&&(Y=me)}if(X.override_appearance){const me=X.override_appearance.call(this,Object.assign({},Y),j,e,C,p,m,A);me&&(Y=me)}const Q=this.renderers[Y.type];if(!Q)continue;const te=Q.colored&&Y.color,ne=(0,B.maybe_call)(X.disabled,this,j,e,C,p,m,A)||!1,fe=te&&(b&&b.colors?b.colors.process(Y.color):Y.color),re=Q.render.call(this,Y,I.createElement,fe);P||R.push(P=[]);const ue=(0,I.createElement)("button",{class:`ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text${ne?" tw-button--disabled disabled":""}`,"data-tooltip-type":"action","data-action":j.action,"data-options":j.options?JSON.stringify(j.options):null,onClick:O,onContextMenu:this.handleContext},(0,I.createElement)("span",{class:"tw-button__text"},re));Y.tooltip&&(ue.dataset.tip=Y.tooltip),P.push(ue)}const M=(0,I.createElement)("div",{class:"ffz-action-data tw-pd-05","data-source":"msg"},(0,I.createElement)("div",{class:"tw-pd-b-05 tw-border-b"},(0,I.createElement)("strong",null,e.user.displayName||e.user.login),"..."),R.map(j=>!j||!j.length?null:(0,I.createElement)("div",{class:"tw-flex tw-flex-no-wrap"},j)));return M.ffz_message=e,M.ffz_line=A,M})}renderHover(s,i,l,w,b,r=null){const e=[],a=this.getUserLevel(w,l),p=this.getUserLevel(w,s.user),C=s.user&&l&&l.login===s.user.login;a<3&&(i=!1);const y=this.resolve("site.chat");let z=!1;for(const $ of this.parent.context.get("chat.actions.hover")){if(!$.action||!$.appearance)continue;$.ctx="hover";let o=$.appearance||{};const c=$.display||{},m=c.keys,A=this.actions[$.action];if(!A||c.disabled||c.mod_icons!=null&&c.mod_icons!==!!i||c.mod!=null&&c.mod!==a>p||c.staff!=null&&c.staff!==(l?!!l.staff:!1)||c.deleted!=null&&c.deleted!==!!s.deleted||C&&!A.can_self||(0,B.maybe_call)(A.hidden,this,$,s,w,l,i,r))continue;if(o.type==="dynamic"){const M=A.dynamicAppearance&&A.dynamicAppearance.call(this,Object.assign({},o),$,s,w,l,i,r);M&&(o=M)}if(A.override_appearance){const M=A.override_appearance.call(this,Object.assign({},o),$,s,w,l,i,r);M&&(o=M)}const h=this.renderers[o.type];if(!h)continue;const T=h.colored&&o.color,R=(0,B.maybe_call)(A.disabled,this,$,s,w,l,i,r)||!1,P=T&&(y&&y.colors?y.colors.process(o.color):o.color),O=h.render.call(this,o,b,P);z=!0,e.push(b("div",{class:`ffz-hover-action${m?` ffz-has-modifier ffz-modifier-${m}`:""}`},b("button",{class:`ffz-tooltip ffz-mod-icon tw-c-text-alt-2${R?" disabled":""}${T?" colored":""}`,"data-tooltip-type":"action","data-action":$.action,"data-options":$.options?JSON.stringify($.options):null,"data-tip":o.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},O)))}return z?b("div",{class:"ffz--hover-actions ffz-action-data tw-mg-r-05","data-source":"line"},e):null}renderInline(s,i,l,w,b,r=null){const e=[],a=this.getUserLevel(w,l),p=this.getUserLevel(w,s.user),C=s.user&&l&&l.login===s.user.login;a<3&&(i=!1);const y=this.resolve("site.chat"),z=[];let $=!1;for(const c of this.parent.context.get("chat.actions.inline")){if(!c.action||!c.appearance)continue;c.ctx="inline";let m=c.appearance||{};const A=c.display||{},h=A.keys,T=A.hover,R=this.actions[c.action];if(!R||A.disabled||A.mod_icons!=null&&A.mod_icons!==!!i||A.mod!=null&&A.mod!==a>p||A.staff!=null&&A.staff!==(l?!!l.staff:!1)||A.deleted!=null&&A.deleted!==!!s.deleted||C&&!R.can_self||(0,B.maybe_call)(R.hidden,this,c,s,w,l,i,r))continue;if(m.type==="dynamic"){const X=R.dynamicAppearance&&R.dynamicAppearance.call(this,Object.assign({},m),c,s,w,l,i,r);X&&(m=X)}if(R.override_appearance){const X=R.override_appearance.call(this,Object.assign({},m),c,s,w,l,i,r);X&&(m=X)}const P=this.renderers[m.type];if(!P)continue;const O=P.colored&&m.color,M=(0,B.maybe_call)(R.disabled,this,c,s,w,l,i,r)||!1,j=O&&(y&&y.colors?y.colors.process(m.color):m.color),Y=P.render.call(this,m,b,j);let ee=e;(h||T)&&(ee=z),$=!0,ee.push(b("button",{class:`ffz-tooltip mod-icon ffz-mod-icon tw-c-text-alt-2${M?" disabled":""}${O?" colored":""}${h?` ffz-modifier-${h}`:""}${T?" ffz-hover":""}`,"data-tooltip-type":"action","data-action":c.action,"data-options":c.options?JSON.stringify(c.options):null,"data-tip":m.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},Y))}if(!$)return null;let o=null;if(e.length&&(o=b("div",{class:"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05","data-source":"line"},e)),z.length){const c=b("div",{class:"ffz--inline-actions ffz--modifier-actions ffz-action-data","data-source":"line"},z);return o?[o,c]:c}return o}getData(s){const i=s.dataset,l=s.closest(".ffz-action-data"),w=l&&l.dataset,b=i&&i.action,r=this.actions[b];if(!r)return null;let e,a,p,C=!1,y;if(w){if(w.source==="msg"&&l.ffz_message){const $=l.ffz_message;y=l.ffz_line,C=!0,e=$.user?{color:$.user.color,id:$.user.id,login:$.user.login,displayName:$.user.displayName,type:$.user.type}:null,a={login:$.roomLogin,id:$.roomId},p={id:$.id,text:$.message}}else if(w.source==="line"){const $=this.resolve("site.fine");if(y=$&&$.searchParent(l,o=>o.props&&o.props.message),y&&y.props&&y.props.message){C=!0;const o=y.props.message;e=o.user?{color:o.user.color,id:o.user.id,login:o.user.login,displayName:o.user.displayName,type:o.user.type}:null,a={login:y.props.channelLogin,id:y.props.channelID},p={id:o.id,text:o.message}}}C||(e=w.user?JSON.parse(w.user):null,a=w.room?JSON.parse(w.room):null,p=w.message?JSON.parse(w.message):w.msgId?{id:w.msgId}:null)}const z={action:b,definition:r,tip:i.tip,options:i.options?JSON.parse(i.options):null,user:e,room:a,message:p,message_id:p?p.id:null,line:y};return r.defaults&&(z.options=Object.assign({},(0,B.maybe_call)(r.defaults,this,z,s),z.options)),z}handleClick(s){const i=s.target,l=this.getData(i);if(l&&!i.classList.contains("disabled"))return l.definition.click?(i._ffz_tooltip&&i._ffz_tooltip.hide(),l.definition.click.call(this,s,l)):l.definition.context?this.handleContext(s):this.log.warn(`No click handler for action provider "${l.action}"`)}handleContext(s){if(s.shiftKey)return;s.preventDefault();const i=s.target,l=this.getData(s.target);l&&(i.classList.contains("disabled")||(i._ffz_tooltip&&i._ffz_tooltip.hide(),!(!l.definition.context&&!l.definition.uses_reason)&&this.renderInlineContext(i,l)))}handleUserContext(s){if(s.shiftKey)return;const i=this.parent.context.get("chat.actions.user-context");if(!Array.isArray(i)||!i.length)return;s.preventDefault();const l=s.target;l._ffz_tooltip&&l._ffz_tooltip.hide(),this.renderUserContext(l,i)}pasteMessage(s,i){return this.resolve("site.chat.input").pasteMessage(s,i)}addNotice(s,i){return this.resolve("site.chat").addNotice(s,i)}sendMessage(s,i){return this.resolve("site.chat").sendMessage(s,i)}};G(S,"Actions");let g=S},2682:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{combo:()=>D,dynamic:()=>L,emote:()=>I,icon:()=>U,image:()=>v,text:()=>B});var W=d(61892);const L={title:"Dynamic",title_i18n:"setting.actions.appearance.dynamic",colored:!0,render(f,u,g){return u("figure",{style:{color:g},class:`${f.icon||"ffz-i-zreknarf"}`})}},B={title:"Text",title_i18n:"setting.actions.appearance.text",colored:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,74640)),component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,68185)),render(f,u,g){return u("span",{style:{color:g}},f.text)}},I={title:"Emote",title_i18n:"setting.actions.appearance.emote",editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,29668)),component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,25816)),render(f,u){return u("figure",{class:"mod-icon__image"},u("img",{src:f.src}))}},U={title:"Icon",title_i18n:"setting.actions.appearance.icon",colored:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,8684)),load(f){return f.icon&&f.icon.startsWith("ffz-fa")&&(0,W.load)(),!0},component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,92123)),render(f,u,g){return u("figure",{style:{color:g},class:`${f.icon||"ffz-i-zreknarf"}`})}},D={title:"Text and Icon",title_i18n:"setting.actions.appearance.combo",colored:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,56727)),load(f){return f.icon&&f.icon.startsWith("ffz-fa")&&(0,W.load)(),!0},component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,6234)),render(f,u,g){return u("span",{style:{color:g},class:f.icon},f.text)}},v={title:"Image",title_i18n:"setting.actions.appearance.image",editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,17816)),component:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,81725)),render(f,u){return u("figure",{class:"mod-icon__image"},u("img",{src:f.image}))}}},8242:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{ban:()=>g,chat:()=>f,copy_message:()=>D,edit_overrides:()=>U,mod:()=>i,msg_delete:()=>u,open_url:()=>v,pin:()=>B,reply:()=>I,timeout:()=>S,toggle_profile:()=>b,unban:()=>n,unmod:()=>l,untimeout:()=>s,whisper:()=>w});var W=d(46949),L=d(44589);const B={presets:[{appearance:{type:"icon",icon:"ffz-i-pin"}}],required_context:["message"],title:"Pin This Message",description:"Allows you to pin a chat message if you're a moderator.",can_self:!0,tooltip(r){return r.line?.props?.pinnedMessage?.message?.id===r.message_id?this.i18n.t("chat.actions.pin.already","This message is already pinned."):this.i18n.t("chat.actions.pin","Pin This Message")},disabled(r,e,a,p,C,y){return(y??r.line)?.props?.pinnedMessage?.message?.id===e.id&&e.id!=null},hidden(r,e,a,p,C,y){let z=y;if(!z||!z.props.isPinnable||!z.onPinMessageClick||!e.message||!e.message.length||e.deleted)return!0},click(r,e){let a=e.line;if(!a){const p=this.resolve("site.fine");a=p?p.searchParent(r.target,C=>C.setMessageTray&&C.props&&C.props.message):null}!a||!a.props.isPinnable||!a.onPinMessageClick||a.props.pinnedMessage?.message?.id!==e.message_id&&a.onPinMessageClick()}},I={presets:[{appearance:{type:"dynamic"}}],required_context:["message"],supports_dynamic:!0,title:"Reply to Message",description:"Allows you to directly reply to another user's message.",can_self:!0,dynamicAppearance(r,e,a,p,C,y,z){const $=z??e.line,o=$?.props;return{type:"icon",icon:o?.hasReply||o?.reply?"ffz-i-threads":"ffz-i-reply",color:r.color}},tooltip(r){const e=r.line?.props;return e?.hasReply||e?.reply?this.i18n.t("chat.actions.reply.thread","Open Thread"):this.i18n.t("chat.actions.reply","Reply to Message")},hidden(r,e,a,p){const C=e?.id;if(typeof C!="string"||!/^[0-9a-f]+-[0-9a-f]+/.test(C)||!p?.can_reply||p?.reply_mode===0||!e.message||e.deleted)return!0},click(r,e){let a=e.line;if(!a){const p=this.resolve("site.fine");a=p?p.searchParent(r.target,C=>C.setMessageTray&&C.props&&C.props.message):null}a&&a.ffzOpenReply()}},U={presets:[{appearance:{type:"icon",icon:"ffz-i-pencil"}}],required_context:["user"],title:"Change Name & Color",description:"Allows you to set local overrides for a user's name and color in chat.",can_self:!0,tooltip(){return this.i18n.t("chat.actions.edit_overrides","Change Name & Color")},click(r,e){this.resolve("chat.overrides").renderUserEditor(e.user,r.target)}},D={presets:[{appearance:{type:"icon",icon:"ffz-i-docs"}}],defaults:{format:"{{user.displayName}}: {{message.text}}"},editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,66038)),required_context:["user","message"],title:"Copy Message",description:"Allows you to quickly copy a chat message to your clipboard.",can_self:!0,tooltip(r){const e=this.replaceVariables(r.options.format,r);return[(0,L.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.copy_message","Copy Message")),(0,L.createElement)("div",{class:"tw-align-left"},e)]},click(r,e){const a=this.replaceVariables(e.options.format,e);navigator.clipboard.writeText(a)}},v={presets:[{appearance:{type:"icon",icon:"ffz-i-link-ext"}}],defaults:{url:"https://link.example/{{user.login}}"},editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,86773)),title:"Open URL",description(r){return r.options.url},description_i18n:null,can_self:!0,tooltip(r){const e=this.replaceVariables(r.options.url,r);return[(0,L.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.open_url","Open URL")),(0,L.createElement)("div",{class:"tw-align-left"},e)]},click(r,e){const a=this.replaceVariables(e.options.url,e),p=window.open();p&&(p.opener=null,p.location=a)}},f={presets:[{appearance:{type:"text",text:"C"}}],required_context:["room"],defaults:{command:"@{{user.login}} HeyGuys",paste:!1},title:"Chat Command",description(r){if(r.options.paste)return this.t("chat.actions.chat.desc.paste","Paste into chat: {cmd}",{cmd:r.options.command});const e=r.options.target??"";return this.t("chat.actions.chat.desc.target","Send in {target}: {cmd}",{cmd:r.options.command,target:/^\s*$/.test(e)?this.t("chat.actions.chat.desc.current","current channel"):e})},description_i18n:null,can_self:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,34727)),tooltip(r){const e=this.replaceVariables(r.options.command,r);let a=this.replaceVariables(r.options.target??"",r);return/^\s*$/.test(a)&&(a=null),[(0,L.createElement)("div",{class:"tw-border-b tw-mg-b-05"},a?this.i18n.t("chat.actions.chat.with-target","Chat Command in Channel: {target}",{target:a}):this.i18n.t("chat.actions.chat","Chat Command")),(0,L.createElement)("div",{class:"tw-align-left"},e)]},click(r,e){const a=this.replaceVariables(e.options.command,e);let p=this.replaceVariables(e.options.target??"",e);(e.options.paste||/^\s*$/.test(p))&&(p=e.room.login),e.options.paste?this.pasteMessage(p,a):this.sendMessage(p,a)}},u={presets:[{appearance:{type:"icon",icon:"ffz-i-trash"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user","message"],title:"Delete Message",tooltip(r){return this.i18n.t("chat.actions.delete.tooltip","Delete {user.login}'s message",{user:r.user})},click(r,e){return this.resolve("site.twitch_data").deleteChatMessage(e.room.id,e.message_id).catch(p=>{p instanceof W.TranslatableError&&this.addNotice(e.room.login,this.i18n.t(p.i18n_key,p.message,p.data))})}},g={presets:[{appearance:{type:"icon",icon:"ffz-i-block"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,93953)),title:"Ban User",reason_text(r){return this.i18n.t("chat.actions.ban-reason","Ban {user.login} for:",{user:r.user})},tooltip(r){return this.i18n.t("chat.actions.ban.tooltip","Ban {user.login}",{user:r.user})},click(r,e){let a=e.reason||e.options.reason||"";a.length&&(a=this.replaceVariables(a,e)),this.sendMessage(e.room.login,`/ban ${e.user.login} ${a}`)}},S={presets:[{appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}],defaults:{duration:600},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,69454)),title:"Timeout User",description:"{options.duration, plural, one {# second} other {# seconds}}",reason_text(r){return this.i18n.t("chat.actions.timeout-reason","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}} for:",{user:r.user,duration:r.options.duration})},tooltip(r){return this.i18n.t("chat.actions.timeout.tooltip","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}}",{user:r.user,duration:r.options.duration})},click(r,e){let a=e.reason||e.options.reason||"";a.length&&(a=this.replaceVariables(a,e)),this.sendMessage(e.room.login,`/timeout ${e.user.login} ${e.options.duration} ${a}`)}},n={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Unban User",tooltip(r){return this.i18n.t("chat.actions.unban.tooltip","Unban {user.login}",{user:r.user})},click(r,e){this.sendMessage(e.room.login,`/unban ${e.user.login}`)}},s={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Untimeout User",tooltip(r){return this.i18n.t("chat.actions.untimeout.tooltip","Untimeout {user.login}",{user:r.user})},click(r,e){this.sendMessage(e.room.login,`/untimeout ${e.user.login}`)}},i={presets:[{appearance:{type:"icon",icon:"ffz-i-mod"}}],required_context:["room","user"],title:"Mod User",tooltip(r){return this.i18n.t("chat.actions.mod.tooltip","Mod {user.login}",{user:r.user})},hidden(r,e,a,p,C,y){return e.user.type==="mod"||e.user.id===a.id?!0:a.id!==p.id},click(r,e){this.sendMessage(e.room.login,`/mod ${e.user.login}`)}},l={presets:[{appearance:{type:"icon",icon:"ffz-i-unmod"}}],required_context:["room","user"],title:"Un-Mod User",tooltip(r){return this.i18n.t("chat.actions.unmod.tooltip","Un-Mod {user.login}",{user:r.user})},hidden(r,e,a,p,C,y){return e.user.type!=="mod"?!0:e.user.id===p.id||e.user.id===a.id?!1:a.id!==p.id},click(r,e){this.sendMessage(e.room.login,`/unmod ${e.user.login}`)}},w={presets:[{appearance:{type:"text",text:"W"}}],required_context:["user"],title:"Whisper User",tooltip(r){return this.i18n.t("chat.actions.whisper.tooltip","Whisper {user.login}",r)},click(r,e){const a=this.resolve("site"),p=a&&a.getUser(),C=a&&a.store;if(!p||!C||!e.user||!e.user.id||p.id==e.user.id)return;const y=parseInt(p.id,10),z=parseInt(e.user.id,10),$=y<z?`${y}_${z}`:`${z}_${y}`;C.dispatch({type:"whispers.THREAD_OPENED",data:{threadID:$,collapsed:!1}})}},b={presets:[{appearance:{type:"dynamic"}}],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,12893)),required_context:[],supports_dynamic:!0,can_self:!0,title:"Toggle Settings Profile",description(r){const e=window.FrankerFaceZ.get(),a=e?.resolve("settings"),p=a?.profile(r.options?.uuid);return p?p.i18n_key?this.t(p.i18n_key,p.name):p.name:null},description_i18n:null,dynamicAppearance(r,e){const a=this.settings.profile(e.options?.uuid);return a?{type:"icon",icon:a.toggled?"ffz-i-ok":"ffz-i-cancel",color:r.color}:{type:"icon",icon:"ffz-i-attention",color:r.color}},tooltip(r){const e=this.settings.profile(r.options?.uuid);let a;return e?a=e.i18n_key?this.i18n.t(e.i18n_key,e.name):e.name:a="invalid",this.i18n.t("chat.actions.toggle_profile.tooltip","Toggle Profile: {name}",{name:a})},click(r,e){const a=this.settings.profile(e.options?.uuid);if(!a)return;const p=new Set;for(const C of["inline","hover","user-context","room"]){const y=`chat.actions.${C}`,z=this.parent.context.get(y);if(Array.isArray(z)){for(const $ of z)if($.action==="toggle_profile"&&$.options?.uuid===a.uuid){p.add(C),this.parent.context.once(`changed:${y}`,()=>p.delete(C));break}}}a.toggled=!a.toggled,requestAnimationFrame(()=>{for(const C of p)this.parent.context.update(`chat.actions.${C}`)})}}},12381:(ae,J,d)=>{"use strict";d.d(J,{QC:()=>r,ZP:()=>l,iV:()=>b});var W=d(24431),L=d(44589),B=d(46949),I=d(22527),U=d(14873),D=d(8528);const v={1:{staff:{1:{color:"#200f33",svg:!0,trans:{color:"#6441a5"}}},admin:{1:{color:"#faaf19",svg:!0}},global_mod:{1:{color:"#0c6f20",svg:!0}},broadcaster:{1:{color:"#e71818",svg:!0}},moderator:{1:{color:"#34ae0a",svg:!0}},twitchbot:{1:{color:"#34ae0a"}},partner:{1:{color:"transparent",trans:{image:!0,color:"#6441a5"}}},"clip-champ":{1:{color:"#6441a5"}},vip:{1:{color:"#b33ff0",trans:{color:"transparent",invert:!1}}},turbo:{1:{color:"#6441a5",svg:!0}},premium:{1:{color:"#009cdc"}},subscriber:{0:{color:"#6441a5"},1:{color:"#6441a5"}}},2:{staff:{1:{color:"#000"}},admin:{1:{color:"#DB7600"}},broadcaster:{1:{color:"#E91916"}},moderator:{1:{color:"#00AD03"}},global_mod:{1:{color:"#006441"}},twitchbot:{1:{color:"#00AD03"}},partner:{1:{color:"#9146FF"}},subscriber:{0:{color:"#8205B4"},1:{color:"#8205B4"}},vip:{1:{color:"#E005B9"}},turbo:{1:{color:"#59399A"}},premium:{1:{color:"#00A0D6"}},"anonymous-cheerer":{1:{color:"#4B367C"}},"clip-champ":{1:{color:"#9146FF"}},"artist-badge":{1:{color:"#1e69ff"}},no_audio:{1:{color:"#323239"}},no_video:{1:{color:"#323239"}}}},f={staff:-2,admin:-1,global_mod:-1,broadcaster:0,mod:1,moderator:1,twitchbot:1,vip:2,subscriber:25},u="background-repeat:no-repeat;background-position:center;",g=`${W.SERVER}/static/badges/twitch/`,S=W.IS_WEBKIT?"webkitMaskImage":"maskImage",n={0:a=>`${a.fore?`color:${a.fore};`:""}background:${a.image||""} ${a.color};background-size:${a.scale*1.8}rem;${a.svg?"":`background-image:${a.image_set};`}${u}`,1:a=>`${n[0](a)}border-radius:${a.scale*.2}rem;`,2:a=>`${n[0](a)}border-radius:${a.scale*.9}rem;background-size:${a.scale*1.6}rem;`,3:a=>`${a.fore?`color:${a.fore};`:""}background:${a.color};border-radius:${a.scale*.9}rem;`,4:a=>`${n[3](a)}height:${a.scale}rem;min-width:${a.scale}rem;`,5:a=>`background:${a.image};background-size:${a.scale*1.8}rem;${a.svg?"":`background-image:${a.image_set};`}${u}`,6:a=>`background:linear-gradient(${a.color},${a.color});${W.WEBKIT_CSS}mask-image:${a.image};${W.WEBKIT_CSS}mask-size:${a.scale*1.8}rem ${a.scale*1.8}rem;${a.svg?"":`${W.WEBKIT_CSS}mask-image:${a.image_set};`}`};function s(a,p){const C=a.urls||{1:a.image},y=`url("${C[1]}")`,z=`${W.WEBKIT_CSS}image-set(${y} 1x${C[2]?`, url("${C[2]}") 2x`:""}${C[4]?`, url("${C[4]}") 4x`:""})`;return p===3||p===4?"":p===6?`${W.WEBKIT_CSS}mask-image:${y} !important;${W.WEBKIT_CSS}mask-image:${z} !important;`:`background-image:${y} !important;background-image:${z} !important;`}G(s,"generateOverrideCSS");function i(a,p,C,y,z,$=2,o,c,m=1,A=!1){let h=C.color||"transparent",T=C.fore||z?"#fff":"#000",R=C.image||(C.addon?null:`${g}${$}/${a}${C.svg?".svg":`/${p}/`}`),P=!1,O=!1,M,j,Y;if(R&&y>4){const ee=C.trans||{};h=ee.color||h,ee.image&&(P=!0,ee.image!==!0&&(R=ee.image)),(0,B.has)(ee,"invert")?O=ee.invert&&!z:O=y===5&&!z}return(y===3||y===4)&&h==="transparent"&&C.trans&&(h=C.trans.color||h),h==="transparent"&&(y=0),R&&y!==3&&y!==4&&(M=R.endsWith(".svg"),C.urls?j=`url("${C.urls[m]}")`:j=`url("${M?R:`${R}${m}${P?"_trans":""}.png`}")`,C.urls&&m===1?Y=`${W.WEBKIT_CSS}image-set(${j} 1x${C.urls[2]?`, url("${C.urls[2]}") 2x`:""}${C.urls[4]?`, url("${C.urls[4]}") 4x`:""})`:C.urls&&m===2?Y=`${W.WEBKIT_CSS}image-set(${j} 1x${C.urls[4]?`, url("${C.urls[4]}") 2x`:""})`:!M&&m<4?m===1?Y=`${W.WEBKIT_CSS}image-set(${j} 1x, url("${R}2${P?"_trans":""}.png") 2x, url("${R}4${P?"_trans":""}.png") 4x)`:m===2&&(Y=`${W.WEBKIT_CSS}image-set(${j} 1x, url("${R}4${P?"_trans":""}.png") 2x)`):Y=j),o&&h&&h!=="transparent"&&(h=o.process(h)||h),c&&T&&T!=="transparent"&&h!=="transparent"&&(c.base=h,T=c.process(T)||T),R||(y>4?y=1:y>3&&(y=2)),`${A&&(C.click_handler||C.click_url||C.click_action)?"cursor:pointer;":""}${O?"filter:invert(100%);":""}${n[y]({scale:1,color:h,fore:T,image:j,image_set:Y,svg:M})}${C.css||""}`}G(i,"generateBadgeCSS");const e=class e extends I.default{constructor(...p){super(...p),this.inject("i18n"),this.inject("settings"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.style=new L.ManagedStyle("badges"),this.bulk=new Map,this._woofer_months={},this.badges={},this.twitch_badges={},W.IS_FIREFOX&&this.settings.add("chat.badges.media-queries",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use @media queries to support High-DPI Badge images in Mozilla Firefox.",description:"This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.",component:"setting-check-box"}}),this.settings.add("chat.badges.version",{default:2,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Version",component:"setting-select-box",data:[{value:1,title:"1 (Pre December 2019)"},{value:2,title:"2 (Current)"}]}}),this.settings.add("chat.badges.clickable",{default:2,process(C,y){return y===!0?2:y===!1?0:y},ui:{path:"Chat > Badges >> Behavior",title:"Allow clicking badges.",description:"Certain badges, such as Prime Gaming, act as links when this is enabled.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Legacy (Open URLs)"},{value:2,title:"Open Badge Card"}]}}),this.settings.add("chat.badges.fix-colors",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Adjust badge colors for visibility.",description:`Ensures that badges are visible against the current background.

**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.`,component:"setting-check-box"}}),this.settings.add("chat.badges.hidden",{default:{},type:"object_merge",ui:{path:"Chat > Badges >> tabs ~> Visibility",title:"Visibility",component:"badge-visibility",getBadges:C=>this.getSettingsBadges(!0,C)}}),this.settings.add("chat.badges.custom-mod",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom moderator badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.custom-vip",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom VIP badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.style",{default:1,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Style",component:"setting-select-box",data:[{value:0,title:"Square"},{value:1,title:"Rounded"},{value:2,title:"Circular"},{value:3,title:"Circular (Color Only)"},{value:4,title:"Circular (Color Only, Small)"},{value:5,title:"Transparent"},{value:6,title:"Transparent (Colored)"}]}}),this.handleClick=this.handleClick.bind(this)}getSettingsBadges(p,C){const y=[],z=[],$=[],o=[],c=[],m=[],A={},h=[];if(!Object.keys(this.twitch_badges).length&&C){const M=this.resolve("site.twitch_data");M&&M.getBadges().then(j=>{this.updateTwitchBadges(j),C()})}for(const M in this.twitch_badges)if((0,B.has)(this.twitch_badges,M)){const j=this.twitch_badges[M],Y=[];let ee=j&&(j[1]||j[0]);for(const X in j)if(X!=="__cat"&&(0,B.has)(j,X)){const Q=j[X];ee||(ee=Q),Q&&Q.image1x&&Y.push({version:X,name:Q.title,image:Q.image1x,styleImage:`url("${Q.image1x}")`})}if(ee){let X;j.__cat==="m-other"?X=z:j.__cat==="m-owl"?X=$:j.__cat==="m-tcon"?X=o:j.__cat==="m-game"?X=c:X=y,X.push({id:M,provider:"twitch",name:ee.title,color:"transparent",image:ee.image2x,versions:Y,styleImage:`url("${ee.image2x}")`})}}if(p){const M={};for(const[j,Y]of Object.entries(this.badges)){if(Y.no_visibility)continue;let ee=Y.urls?Y.urls[2]||Y.urls[1]:Y.image,X=Y.urls?.[1]||Y.image,Q=Y.color||"transparent";Y.addon||(ee=`//cdn.frankerfacez.com/badge/${Y.id}/2/rounded`,X=`//cdn.frankerfacez.com/badge/${Y.id}/1/rounded`,Q="transparent");let te;typeof Y.addon=="string"?te=A[Y.addon]=A[Y.addon]||[]:te=Y.addon?h:m;let ne=Y.title,fe;try{fe=(0,B.maybe_call)(Y.tooltipExtra,this,null,Y)}catch{fe=null}fe&&!(fe instanceof Promise)&&(ne=ne+fe);const re=Y.base_id??j,ue=re===j;let me=M[re];me?(me.versions||(me.versions=[{version:me.key,name:me.tipname,color:me.color,image:me.image1x,styleImage:`url("${me.image1x}")`}]),me.versions.push({version:j,name:ne,color:Q,image:X,styleImage:`url("${X}")`}),ue&&(me.name=Y.title,me.tipname=ne,me.color=Q,me.image=ee,me.styleImage=`url("${ee}")`)):(me={id:re,key:j,provider:"ffz",name:Y.title,tipname:ne,color:Q,image:ee,image1x:X,styleImage:`url("${ee}")`},Y.base_id&&(me.always_versions=!0,me.versions=[{version:me.key,name:me.tipname,color:me.color,image:me.image1x,styleImage:`url("${me.image1x}")`}]),M[re]=me,te.push(me))}}const R=[{title:"Twitch",id:"m-twitch",badges:y},{title:"Twitch: TwitchCon",id:"m-tcon",badges:o},{title:"Twitch: Other",id:"m-other",badges:z},{title:"Twitch: Overwatch League",id:"m-owl",badges:$},{title:"Twitch: Game",id:"m-game",key:"game",badges:c}];m.length&&R.push({title:"FrankerFaceZ",id:"m-ffz",badges:m});const P=this.resolve("addons"),O=[];for(const[M,j]of Object.entries(A)){const Y=P?.getAddon?.(M),ee=Y?.short_name??Y?.name??M;O.push({title:`Add-On: ${ee}`,id:`m-addon-${M}`,badges:j})}return O.sort((M,j)=>M.title.localeCompare(j.title)),R.push(...O),h.length&&R.push({title:"Add-on",id:"m-addon",badges:h}),R}onEnable(){this.parent.context.on("changed:chat.badges.custom-mod",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.custom-vip",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.style",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.is-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.tooltips-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.version",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.media-queries",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.fix-colors",this.rebuildColoredBadges,this),this.parent.context.on("changed:chat.badges.clickable",this.rebuildAllCSS,this),this.rebuildAllCSS(),this.loadGlobalBadges(),this.on("chat:reload-data",p=>{(!p||p.badges)&&this.loadGlobalBadges()}),this.on("addon:fully-unload",p=>{let C=0;for(const[y,z]of Object.entries(this.badges))z?.__source===p&&(C++,this.removeBadge(y,!1));C&&(this.log.debug(`Cleaned up ${C} entries when unloading addon:`,p),this.generateBadgeCSS())}),this.tooltips.types.badge=(p,C)=>{C.add_class="ffz__tooltip--badges";const y=this.parent.context.get("tooltip.badge-images"),z=this.getBadgeData(p);if(z.data==null)return D.NoContent;const $=[];let o=!1;for(const c of z.data){let m=null;c.room&&(m=this.resolve("site.chat")?.shared_room_data?.get(c.room)?.displayName,m&&(m=`

${m}`));const A=c.provider;if(A==="twitch"){const h=this.getTwitchBadge(c.badge,c.version,z.room_id,z.room_login),T=this.getTwitchBadge(c.badge,c.version,null,null,!0)||{};if(!h)continue;let R=h.title||T.title;const P=h.tier||T.tier;c.data&&(c.badge==="subscriber"?P>0?R=this.i18n.t("badges.subscriber.tier-months",`{title}
(Tier {tier}, {months, plural, one {# Month} other {# Months}})`,{title:R,tier:P,months:c.data}):R=this.i18n.t("badges.subscriber.months",`{title}
({count, plural, one {# Month} other {# Months}})`,{title:R,count:c.data}):c.badge==="founder"&&(R=this.i18n.t("badges.founder.months",`{title}
(Subscribed for {count, plural, one {# Month} other {# Months}})`,{title:R,count:c.data}))),$.push((0,L.createElement)("div",{class:"ffz-badge-tip"},y&&(0,L.createElement)("img",{class:"preview-image ffz-badge",src:h.image4x}),R,m))}else if(A==="ffz"){const h=this.badges[c.id],T=c.badge,R=(0,B.maybe_call)(T?.tooltipExtra??h?.tooltipExtra,this,z,T,p,C);R instanceof Promise?(o=!0,$.push(R.then(P=>(0,L.createElement)("div",{class:"ffz-badge-tip"},y&&c.image&&(0,L.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:c.color,backgroundImage:`url("${c.image}")`}}),c.title,P||"",m)))):$.push((0,L.createElement)("div",{class:"ffz-badge-tip"},y&&c.image&&(0,L.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:c.color,backgroundImage:`url("${c.image}")`}}),c.title,R||"",m))}}return o?Promise.all($):$}}getAddonProxy(p,C,y){if(!p)return this;const z=W.DEBUG||(C?.dev??!1),$=(0,B.makeAddonIdChecker)(p),o={},c={};return o.loadBadgeData=(m,A,...h)=>(A&&A.addon===void 0&&(A.addon=p),z&&!$.test(m)&&y.log.warn("[DEV-CHECK] Call to chat.badges.loadBadgeData() did not include addon ID in badge_id:",m),this.loadBadgeData(m,A,...h)),z&&(o.removeBadge=(m,...A)=>{const h=this.badges[m];return h&&h.addon!==p&&y.log.warn("[DEV-CHECK] Removed un-owned badge with chat.badges.removeBadge():",key," owner:",h.addon??"ffz"),this.removeBadge(m,...A)},o.setBulk=(m,...A)=>($.test(m)||y.log.warn("[DEV-CHECK] Call to chat.badges.setBulk() did not include addon ID in source:",m),this.setBulk(m,...A)),o.deleteBulk=(m,...A)=>($.test(m)||y.log.warn("[DEV-CHECK] Call to chat.badges.deleteBulk() did not include addon ID in source:",m),this.deleteBulk(m,...A)),o.extendBulk=(m,...A)=>($.test(m)||y.log.warn("[DEV-CHECK] Call to chat.badges.extendBulk() did not include addon ID in source:",m),this.extendBulk(m,...A)),c.badges="Please use loadBadgeData() or removeBadge()"),(0,I.buildAddonProxy)(y,this,"chat.badges",o,c)}getBadgeData(p){let C=p.parentElement?.parentElement;C?.dataset?.roomId||(C=p.closest("[data-room-id]"));const y=C?.dataset?.roomId,z=C?.dataset?.room,$=C?.dataset?.userId,o=C?.dataset?.user;let c;if(p.dataset.badgeData)c=JSON.parse(p.dataset.badgeData);else{const m=p.dataset.badgeIdx;let A;if(C.message)A=C.message;else{const h=this.resolve("site.fine");if(h){if(A=C[h.accessor]?.return?.stateNode?.props?.message,A||(A=h.searchParent(C,T=>T.props?.message)?.props?.message),!A&&this.root.flavor==="clips"){const T=this.resolve("site.chat.line"),R=h.searchParent(C,P=>P.props?.node)?.props?.node;T&&R&&(A=T.messages.get(R))}A||(A=h.searchParent(C,T=>T.props?.node)?.props?.node?._ffz_message),A||(A=h.searchParent(C,T=>T.props?.messageContext)?.props?.messageContext?.comment?._ffz_message),A||(A=h.searchParent(C,T=>T._ffzIdentityMsg,50)?._ffzIdentityMsg)}}A?._ffz_message&&(A=A._ffz_message),A&&(c=A.ffz_badge_cache?.[m]?.[1]?.badges)}return{room_id:y,room_login:z,user_id:$,user_login:o,data:c}}handleClick(p){const C=this.parent.context.get("chat.badges.clickable");if(!C)return;const y=p.target,z=this.getBadgeData(y);if(z.data==null)return;let $=null,o=null;for(const c of z.data){const m=c.provider;if(m==="twitch"){const A=this.getTwitchBadge(c.badge,c.version,z.room_id,z.room_login),h=this.getTwitchBadge(c.badge,c.version,null,null,!0)||{};if(!A)continue;C==1&&A.click_url?$=A.click_url:C==1&&h.click_url?$=h.click_url:C==1&&(A.click_action==="sub"||h.click_action==="sub")&&z.room_login?$=`https://www.twitch.tv/subs/${z.room_login}`:o=A;break}else if(m==="ffz"){const A=this.badges[y.dataset.badge];if(A?.click_handler){$=A.click_handler(z.user_id,z.user_login,z.room_id,z.room_login,z.data,p);break}if(A?.click_url){$=A.click_url;break}}}if(o){const c=this.resolve("site.fine");if(c){const m=c.searchParent(y,A=>A.openBadgeDetails&&A.props?.message);if(m){m.openBadgeDetails(o,p);return}}}$&&(0,L.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:$}).click(),p.preventDefault()}cacheBadges(p,C=!1){if(p.ffz_badge_cache)return p.ffz_badge_cache;const y=C?{}:this.parent.context.get("chat.badges.hidden")||{},z=this.parent.context.get("chat.badges.style"),$=this.parent.context.get("chat.badges.custom-mod"),o=this.parent.context.get("chat.badges.custom-vip"),c=z>5,m=z!==5,A=z!==3&&z!==4,h=this.twitch_badges,T=new Map,R=p.badges||{},P=p.badgeDynamicData||{},O=p.sourceRoomID?p.sourceRoomID:p.roomID,M=p.sourceRoomID?null:p.roomLogin,j=this.parent.getRoom(O,M,!0),Y=p.ffz_badges;let ee=50,X;for(const Q in R)if((0,B.has)(R,Q)){const te=R[Q],ne=y[Q],fe=h&&h[Q],re=fe&&fe.__cat||"m-twitch";if(!Q||ne||ne==null&&y[re])continue;(0,B.has)(f,Q)?X=f[Q]:X=ee++;const ue=P[Q]||Q==="founder"&&P.subscriber,me=Q==="moderator"&&$&&j&&j.data&&j.data.mod_urls,we=Q==="vip"&&o&&j&&j.data&&j.data.vip_badge,xe=[];if(me){const Te=this.getTwitchBadge(Q,te,O,M);xe.push({provider:"ffz",image:me[4]||me[2]||me[1],color:"#34ae0a",title:Te?Te.title:"Moderator",room:O,data:ue})}else if(we){const Te=this.getTwitchBadge(Q,te,O,M);xe.push({provider:"ffz",image:we[4]||we[2]||we[1],color:"transparent",title:Te?Te.title:"VIP",room:O,data:ue})}else xe.push({provider:"twitch",badge:Q,version:te,room:O,data:ue});T.set(X,{id:Q,props:{"data-provider":"twitch","data-badge":Q,"data-version":te,style:{}},badges:xe})}if(Array.isArray(Y)){const Q=new Set;for(const te of Y)if(te&&te.id!=null){if(Q.has(te.id))continue;Q.add(te.id);const ne=this.badges[te.id]||{},fe=typeof ne.addon=="string"?`m-addon-${ne.addon}`:ne.addon?"m-addon":"m-ffz",re=te.base_id??te.id,ue=y[re];if(ue||ue==null&&y[fe])continue;const me=(0,B.has)(te,"slot")?te.slot:ne.slot,we=T.get(me),xe=te.urls||(te.image?{1:te.image}:null),Te=te.color||ne.color||"transparent",Pe=te.no_invert,Se=Te!=="transparent"&&c,oe=xe||ne.urls||{1:ne.image},ie={provider:"ffz",id:te.id,badge:te,room:te.room,image:oe[4]||oe[2]||oe[1],color:te.color||ne.color,title:te.title||ne.title};ne.addon||(ie.image=`//cdn.frankerfacez.com/badge/${te.id}/4/rounded`,ie.color=null);let pe;if(we){we.badges.push(ie);const ge=(0,B.has)(te,"replaces")?te.replaces:ne.replaces,ve=te.replaces_type||ne.replaces_type;if(ge&&(!ve||ve===we.id))we.replaced=te.id,we.content=te.content||ne.content||we.content;else continue;pe=we.props.style}else{if(me==null)continue;{pe={};const ge={className:"ffz-tooltip ffz-badge","data-tooltip-type":"badge","data-provider":"ffz","data-badge":te.id,style:pe};T.set(me,{id:te.id,props:ge,badges:[ie],content:te.content||ne.content})}}if(Pe){const ge=T.get(me);ge.full_size=!0,ge.no_invert=!0,pe.background="unset",pe.backgroundSize="unset",pe[S]="unset"}if((A||Te==="transparent")&&xe){const ge=`url("${xe[1]}")`;let ve;(xe[2]||xe[4])&&(ve=`${W.WEBKIT_CSS}image-set(${ge} 1x${xe[2]?`, url("${xe[2]}") 2x`:""}${xe[4]?`, url("${xe[4]}") 4x`:""})`),pe[Se&&!Pe?S:"backgroundImage"]=ge,ve&&(pe[Se&&!Pe?S:"backgroundImage"]=ve)}m&&te.color&&(Se&&!Pe?pe.backgroundImage=`linear-gradient(${te.color},${te.color})`:pe.backgroundColor=te.color)}}return p.ffz_badge_cache=Array.from(T).sort((Q,te)=>Q[0]-te[0])}render(p,C,y=!1,z=!1){if(!p.badges&&!p.ffz_badges||(p.ffz_badge_cache||this.cacheBadges(p,y),!p.ffz_badge_cache.length))return null;const $=[];for(let o=0,c=p.ffz_badge_cache.length;o<c;o++){const m=p.ffz_badge_cache[o][1],A=m.props;let h=(0,B.maybe_call)(m.content,this,m,p,C);h&&!Array.isArray(h)&&(h=[h]),A.className=`ffz-tooltip ffz-badge${h?" tw-pd-x-05":""}${m.full_size?" ffz-full-size":""}${m.no_invert?" ffz-no-invert":""}`,A.key=`${A["data-provider"]}-${A["data-badge"]}`,A["data-tooltip-type"]="badge",A["data-badge-idx"]=o,z||(A.onClick=this.handleClick),m.replaced&&(A["data-replaced"]=m.replaced),$.push(C("span",A,h||void 0))}return $}rebuildColor(){this.parent.context.get("chat.badges.fix-colors")?(this.fg_fixer=new U.ColorAdjuster("#fff",1,4.5),this.color_fixer=new U.ColorAdjuster(this.parent.context.get("theme.is-dark")?"#181818":"#FFFFFF",1,2.5)):(this.fg_fixer=null,this.color_fixer=null)}rebuildColoredBadges(){this.rebuildColor(),this.buildBadgeCSS(),this.buildTwitchCSSBadgeCSS()}rebuildAllCSS(){this.rebuildColor();for(const p of this.parent.iterateRooms())p.buildBadgeCSS(),p.buildModBadgeCSS();this.buildBadgeCSS(),this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}getBadges(p,C,y,z){const $=this.parent.getRoom(y,z,!0),o=this.parent.getUser(p,C,!0);o&&(p=p??o.id,C=C??o.login);const c=$&&$.getUser(p,C,!0),m=(o?.badges?o.badges._cache:[]).concat(c?.badges?c.badges._cache.map(A=>({...A,room:y})):[]);if(this.bulk.size){const A=String(p);for(const[h,T]of this.bulk)T?._cache.has(A)&&m.push({id:h})}return m}setBulk(p,C,y){let z=this.bulk.get(C);z||this.bulk.set(C,z=new B.SourcedSet(!0)),z.set(p,y)}deleteBulk(p,C){const y=this.bulk.get(C);y&&y.delete(p)}extendBulk(p,C,y){let z=this.bulk.get(C);z||this.bulk.set(C,z=new B.SourcedSet(!0)),Array.isArray(y)||(y=[y]),z.extend(p,...y)}async loadGlobalBadges(p=0){this.load_tracker.schedule("chat-data","ffz-global-badges");let C,y;if(this.experiments.getAssignment("api_load")&&p<1)try{fetch(`${W.NEW_API}/v1/badges/ids`).catch(()=>{})}catch{}try{C=await fetch(`${this.staging.api}/v1/badges/ids`)}catch(o){return p++,p<10?setTimeout(()=>this.loadGlobalBadges(p),500*p):(this.log.error("Error loading global badge data.",o),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1)}if(!C.ok)return this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1;try{y=await C.json()}catch(o){return this.log.error("Error parsing global badge data.",o),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1}let z=0,$=0;if(y.badges)for(const o of y.badges)o&&o.id&&(this.loadBadgeData(o.id,o,!1),z++);if(y.users){for(const o in y.users)if((0,B.has)(y.users,o)){const c=this.badges[o],m=c?.name;let A=0;if(m==="supporter"||m==="subwoofer"||m==="bot")this.setBulk("ffz-global",o,y.users[o].map(h=>String(h))),A=y.users[o].length;else for(const h of y.users[o])this.parent.getUser(h,void 0).addBadge("ffz-global",o)&&(A++,$++);A>0&&this.log.info(`Added "${c?c.name:`#${o}`}" to ${A} users.`)}}this.log.info(`Loaded ${z} badges and assigned them to ${$} users.`),this.buildBadgeCSS(),this.load_tracker.notify("chat-data","ffz-global-badges")}getBadge(p){return this.badges[p]??null}removeBadge(p,C=!0){this.badges[p]&&(delete this.badges[p],C&&this.buildBadgeCSS())}loadBadgeData(p,C,y=!0){this.badges[p]=C,C&&(C.addon===void 0&&(C.addon=/^addon/.test(p)),C.replaces&&!C.replaces_type&&(C.replaces_type=C.replaces,C.replaces=!0),!C.addon&&(C.name==="developer"||C.name==="subwoofer"||C.name==="supporter")&&(C.click_url="https://www.frankerfacez.com/subscribe"),!C.addon&&C.name==="subwoofer"&&(C.base_id=C.id,C.tooltipExtra=z=>z?.user_id?this.getSubwooferMonths(z.user_id).then($=>{if($?.months)return $.lifetime?`
`+this.i18n.t("badges.subwoofer.lifetime","Lifetime Subwoofer"):`
`+this.i18n.t("badges.subwoofer.months","({count, plural, one {# Month} other {# Months}})",{count:$.months})}):null)),y&&this.buildBadgeCSS()}getSubwooferMonths(p){let C=this._woofer_months[p];if(C instanceof Promise)return C;const y=C?.expires;return y&&Date.now()>=y&&(C=this._woofer_months[p]=null),C?.value?Promise.resolve(C.value):this._woofer_months[p]=fetch(`https://api.frankerfacez.com/v1/_user/id/${p}`).then(z=>z.ok?z.json():null).then(z=>{let $=null;return z?.user?.sub_months&&($={months:z.user.sub_months,lifetime:z.user.sub_lifetime}),this._woofer_months[p]={expires:Date.now()+3e5,value:$},$}).catch(z=>(console.error("Error getting subwoofer data for user",p,z),this._woofer_months[p]={expires:Date.now()+6e4,value:null},null))}buildBadgeCSS(){const p=this.parent.context.get("chat.badges.style"),C=this.parent.context.get("theme.is-dark"),y=this.parent.context.get("chat.badges.clickable"),z=W.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),$=[];for(const o in this.badges)if((0,B.has)(this.badges,o)){const c=this.badges[o],m=`.ffz-badge[data-badge="${o}"]`;$.push(`.ffz-badge[data-replaced="${o}"]{${s(c,p,C)}}`),z?($.push(`@media (max-resolution: 99dpi) {${m}{${i(o,0,c,p,C,0,this.color_fixer,this.fg_fixer,1,y)}}}`),$.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${m}{${i(o,0,c,p,C,0,this.color_fixer,this.fg_fixer,2,y)}}}`),$.push(`@media (min-resolution: 200dpi) {${m}{${i(o,0,c,p,C,0,this.color_fixer,this.fg_fixer,4,y)}}}`)):$.push(`${m}{${i(o,0,c,p,C,0,this.color_fixer,this.fg_fixer,void 0,y)}}`)}this.style.set("ext-badges",$.join(`
`))}getTwitchBadge(p,C,y,z,$=!1){const o=this.parent.getRoom(y,z,!0);let c;if(o){const m=o.badges&&o.badges[p];c=m&&m[C]}if(!c){const m=this.twitch_badges&&this.twitch_badges[p];c=m&&m[C]}if(!c&&!$){const m=this.resolve("site.chat");m&&m.tryUpdateBadges&&m.tryUpdateBadges()}return c}getTwitchBadgeCount(){return this.twitch_badge_count||0}updateTwitchBadges(p){if(this.twitch_badge_count=0,!p)this.twitch_badges={};else if(!Array.isArray(p))this.twitch_badges=p;else{let C=null;if(p.length){C={};for(const y of p){const z=y.setID,$=C[z]=C[z]||{__cat:b(z)};this.twitch_badge_count++,$[y.version]=r(y)}}this.twitch_badges=C}this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}buildTwitchCSSBadgeCSS(){const p=this.parent.context.get("chat.badges.style"),C=this.parent.context.get("theme.is-dark"),y=this.parent.context.get("chat.badges.clickable"),z=W.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),$=this.parent.context.get("chat.badges.version"),o=v[$]||{},c=this.twitch_badges||{},m=[];for(const A in o)if((0,B.has)(o,A)){const h=o[A],T=c[A];for(const R in h)if((0,B.has)(h,R)){const P=h[R],O=T?.[R],M=`.ffz-badge[data-badge="${A}"][data-version="${R}"]`;O&&O.click_url&&(P.click_url=O.click_url),O&&O.click_action&&(P.click_action=O.click_action),z?(m.push(`@media (max-resolution: 99dpi) {${M}{${i(A,R,P,p,C,$,this.color_fixer,this.fg_fixer,1,y)}}}`),m.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${M}{${i(A,R,P,p,C,$,this.color_fixer,this.fg_fixer,2,y)}}}`),m.push(`@media (min-resolution: 200dpi) {${M}{${i(A,R,P,p,C,$,this.color_fixer,this.fg_fixer,4,y)}}}`)):m.push(`${M}{${i(A,R,P,p,C,$,this.color_fixer,this.fg_fixer,void 0,y)}}`)}}this.style.set("css-badges",m.join(`
`))}buildTwitchBadgeCSS(){this.twitch_badges||this.style.delete("twitch-badges");const p=this.parent.context.get("chat.badges.version"),C=W.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),y=this.parent.context.get("chat.badges.clickable"),z=v[p]||{},$=[];for(const o in this.twitch_badges)if((0,B.has)(this.twitch_badges,o)){if((0,B.has)(z,o))continue;const c=this.twitch_badges[o];for(const m in c)if((0,B.has)(c,m)){const A=c[m],h=`.ffz-badge[data-badge="${o}"][data-version="${m}"]`;$.push(`${h} {
			${y&&(A.click_action||A.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${W.WEBKIT_CSS}mask-image: none;
			background-size: 1.8rem;
			background-image: url("${A.image1x}");
			background-image: ${W.WEBKIT_CSS}image-set(
				url("${A.image1x}") 1x,
				url("${A.image2x}") 2x,
				url("${A.image4x}") 4x
			);
		}`),C&&($.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${h} {
								background-image: url("${A.image2x}");
							}}`),$.push(`@media (min-resolution: 200dpi) { ${h} {
								background-image: url("${A.image4x}");
							}}`))}}$.length?this.style.set("twitch-badges",$.join(`
`)):this.style.delete("twitch-badges")}};G(e,"Badges");let l=e;const w=["vga-champ-2017","warcraft","samusoffer_beta","power-rangers","bits-charity","glhf-pledge"];function b(a){return w.includes(a)?"m-other":a.startsWith("overwatch-league")?"m-owl":a.startsWith("twitchcon")||a.startsWith("glitchcon")?"m-tcon":/_\d+$/.test(a)?"m-game":"m-twitch"}G(b,"getBadgeCategory");function r(a){if(!a)return a;if(a={...a},!a.clickAction&&a.onClickAction&&(a.clickAction=a.onClickAction),a.clickAction==="VISIT_URL"&&a.clickURL&&(a.click_url=a.clickURL),a.clickAction==="TURBO"&&(a.click_url="https://www.twitch.tv/products/turbo?ref=chat_badge"),a.clickAction==="SUBSCRIBE"&&a.channelName?a.click_url=`https://www.twitch.tv/subs/${a.channelName}`:a.clickAction&&(a.click_action="sub"),a.setID==="subscriber"){const p=parseInt(a.version,10);!isNaN(p)&&isFinite(p)?(a.tier=(p-p%1e3)/1e3,a.tier<0&&(a.tier=0)):a.tier=0}return a}G(r,"fixBadgeData")},49276:(ae,J,d)=>{"use strict";d.d(J,{D3:()=>v,Dk:()=>s,Vf:()=>w,ZP:()=>r,aA:()=>f,of:()=>u});var W=d(22527),L=d(24431),B=d(46949),I=d(83269),U=d(5199),D=d.n(U);const v=["component"],f={"smileys-emotion":"Smileys & Emotions","people-body":"People",component:"Components","animals-nature":"Animals & Nature","food-drink":"Food & Drink","travel-places":"Travel & Places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"},u=Object.keys(f),g={1:"1f3fb",2:"1f3fc",3:"1f3fd",4:"1f3fe",5:"1f3ff"};let S=!0,n;try{n=new RegExp("(?<!\\u{E0002})\\u{E0002}","gu")}catch{S=!1,n=null}const s=n,i=/\u{200D}/gu,l="\u{E0002}",w={google:"noto",twitter:"twemoji",open:"openmoji",blob:"blob"};function b(p){let C=typeof p=="number"?p:parseInt(p,16);return C<65536?String.fromCharCode(C):(C-=65536,String.fromCharCode(55296+(C>>10),56320+(C&1023)))}G(b,"codepoint_to_emoji");const a=class a extends W.default{constructor(...C){super(...C),this.inject("..emotes"),this.inject("settings"),S?this.settings.add("chat.emoji.replace-joiner",{default:1,process(y,z){return z===2?1:z},ui:{path:"Chat > Behavior >> Emoji",title:"Emoji Joiner Workaround",description:"This feature is intended to allow the use of combined emoji in supported clients. This is required due to a bug in TMI that strips ZWJ characters from chat messages. [Visit the original issue](https://github.com/FrankerFaceZ/FrankerFaceZ/issues/1147) for more details.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Display Only"},{value:3,title:"Display and Send"}]}}):(this.log.warn('This browser does not support regexp lookbehind. The "Emoji Joiner Workaround" feature will be disabled.'),this.settings.add("chat.emoji.replace-joiner",{process(){return 0}})),this.settings.add("chat.emoji.style",{default:"twitter",process(y,z){return z!=0&&!w[z]?"twitter":z},ui:{path:"Chat > Appearance >> Emoji",title:"Emoji Style",component:"setting-select-box",data:[{value:"twitter",title:"Twitter (Twemoji)"},{value:"google",title:"Google (Noto)"},{value:"blob",title:"Blob"},{value:"open",title:"OpenMoji"},{value:0,title:"Native"}]}}),this.splitter=D()(),this.categories=f,this.emoji={},this.names={},this.chars=new Map}onEnable(){this.on("chat:pre-send-message",C=>{C.context.get("chat.emoji.replace-joiner")<2||(C.message=C.message.replace(i,l))}),this.loadEmojiData()}async loadEmojiData(C=0){let y;try{y=await fetch(`${L.SERVER}/script/emoji/v3.2.json?_${(0,I.getBuster)(60)}`).then(m=>m.ok?m.json():null)}catch(m){return C++,C<10?setTimeout(()=>this.loadEmojiData(C),500*C):(this.log.error("Error loading emoji data.",m),!1)}if(!y)return!1;const z=y.c,$={},o={},c=new Map;for(const m of y.e){const A=Object.assign(e(m.slice(4)),{category:z[m[0]],sort:m[1],names:m[2],name:m[3]});Array.isArray(A.names)||(A.names=[A.names]),A.name||(A.name=A.names[0].replace(/_/g," ")),$[A.code]=A,c.set(A.raw,[A.code,null]);for(const h of A.names)o[h]=A.code;if(m[7]){const h=A.variants={};for(const T of m[7]){if(Array.isArray(T[3])||!T[3]){const O=Object.assign(e(T),{category:z[m[0]],sort:m[1],names:T[5],hidden:!0});Array.isArray(O.names)||(O.names=[O.names]),O.name=O.names[0].replace(/_/g," "),$[O.code]=O,c.set(O.raw,[O.code,null]);for(const M of O.names)o[M]=O.code;continue}const R=g[T[3]];if(!R){console.warn("Unknown tone:",T[3],T,A);continue}const P=Object.assign(e(T),{key:R});h[R]=P,c.set(P.raw,[A.code,P.key])}}}return this.emoji=$,this.names=o,this.chars=c,this.log.info(`Loaded data about ${Object.keys($).length} emoji.`),this.emit(":populated"),!0}getFullImage(C,y){return y||(y=this.parent.context.get("chat.emoji.style")),(0,B.has)(w,y)||(y="twitter"),`${L.SERVER}/static/emoji/images/${w[y]}/${C}`}getFullImageSet(C,y){return y||(y=this.parent.context.get("chat.emoji.style")),(0,B.has)(w,y)||(y="twitter"),`${L.SERVER}/static/emoji/images/${w[y]}/${C} 72w`}};G(a,"Emoji");let r=a;function e(p){let C=p[0];return p[4]===0&&(C=`${C}-fe0f`),{code:C,image:`${p[0]}.png`,raw:C.split("-").map(b).join(""),sheet_x:p[1][0],sheet_y:p[1][1],has:{google:!!(8&p[2]),blob:!!(4&p[2])||!!(8&p[2]),twitter:!!(2&p[2]),open:!!(1&p[2])}}}G(e,"hydrate_emoji")},66866:(ae,J,d)=>{"use strict";d.d(J,{ZP:()=>p,z8:()=>s});var W=d(22527),L=d(44589),B=d(46949),I=d(24431),U=d(98750),D=d.n(U),v=d(60795),f=d.n(v);const u=Symbol("FFZ:Hover:RAF"),g=Symbol("FFZ:Hover:State"),S=I.IS_OSX?"metaKey":"ctrlKey",n=(0,B.make_enum_flags)("Hidden","FlipX","FlipY","GrowX","Slide","Appear","Leave","Rotate","Rotate90","Greyscale","Sepia","Rainbow","HyperRed","Shake","Cursed","Jam","Bounce","NoSpace"),s=n,i=Object.values(s).filter($=>typeof $=="number"),l=[[0,-18,0,0],[19.99,-18,0,0],[20,-18,.1,0],[25,-16,.2,.6],[30,-14,.3,-4],[35,-12,.4,.6],[40,-10,.5,-4],[45,-8,.6,2],[50,-6,.7,-3],[55,-4,.8,2],[60,-2,.9,-3],[65,0,1,0],[100,0,1,0]],w=[[0,0,1,0],[39.99,0,1,0],[40,0,-.9,.9,-3],[45,-2,-.8,.8,2],[50,-4,-.7,.7,-3],[55,-6,-.6,.6,2],[60,-8,-.5,.5,-4],[65,-10,-.4,.4,.6],[70,-12,-.3,.3,-4],[75,-14,-.2,.2,.6],[80,-16,-.1,.1,0],[85,-18,-.01,0,0],[100,-18,0,0,0]];function b($,o=1,c=0,m=!1){const A=[];for(const h of $){const T=h[0]*o+c;let R,P,O,M;if(R=m?"var(--ffz-effect-transforms) ":"",P=h[1]===0?"":`translateX(${h[1]}px) `,h.length===4)O=`scale(${h[2]})`,M=h[3]===0?"":` translateY(${h[3]}px)`;else{const j=h[2],Y=h[3];O=`scale(${j}, ${Y})`,M=h[4]===0?"":` translateY(${h[4]}px)`}A.push(`	${T}% { transform:${R}${P}${O}${M}; }`)}return A.join(`
`)}G(b,"appearLeaveToKeyframes");const r=[{setting:"FlipX",flags:n.FlipX,title:"Flip Horizontal",transform:"scaleX(-1)"},{setting:"FlipY",flags:n.FlipY,title:"Flip Vertical",transform:"scaleY(-1)"},{setting:"ShrinkX",flags:n.ShrinkX,title:"Squish Horizontal"},{setting:"GrowX",flags:n.GrowX,title:"Stretch Horizontal"},{setting:"Slide",flags:n.Slide,title:"Slide Animation",as_background:!0,animation:"ffz-effect-slide var(--ffz-speed-x) linear infinite",raw:`@keyframes ffz-effect-slide {
0% { background-position-x: 0; }
100% { background-position-x: calc(-1 * var(--ffz-width)); }
}`},{setting:"Appear",flags:n.Appear,not_flags:n.Leave,title:"Appear Animation",animation:"ffz-effect-appear 3s infinite linear",animationTransform:"ffz-effect-appear-transform 3s linear infinite",raw:`@keyframes ffz-effect-appear {
${b(l)}
}
@keyframes ffz-effect-appear-transform {
${b(l,1,0,!0)}
}`},{setting:"Leave",flags:n.Leave,not_flags:n.Appear,title:"Leave Animation",animation:"ffz-effect-leave 3s infinite linear",animationTransform:"ffz-effect-leave-transform 3s infinite linear",raw:`@keyframes ffz-effect-leave {
${b(w)}
}
@keyframes ffz-effect-leave-transform {
${b(w,1,0,!0)}
}`},{setting:["Appear","Leave"],flags:n.Appear|n.Leave,animation:"ffz-effect-in-out 6s infinite linear",animationTransform:"ffz-effect-in-out-transform 6s linear infinite",raw:`@keyframes ffz-effect-in-out {
${b(l,.5,0)}
${b(w,.5,50)}
}
@keyframes ffz-effect-in-out-transform {
${b(l,.5,0,!0)}
${b(w,.5,50,!0)}
}`},{setting:"Rotate",flags:n.Rotate,not_flags:n.Slide,title:"Rotate Animation",no_wide:!0,animation:"ffz-effect-rotate 1.5s infinite linear",animationTransform:"ffz-effect-rotate-transform 1.5s infinite linear",raw:`@keyframes ffz-effect-rotate {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
@keyframes ffz-effect-rotate-transform {
0% { transform: var(--ffz-effect-transforms) rotate(0deg); }
100% { transform: var(--ffz-effect-transforms) rotate(360deg); }
}`},{setting:"Rainbow",flags:n.Rainbow,title:"Rainbow Animation",animation:"ffz-effect-rainbow 2s linear infinite",animationFilter:"ffz-effect-rainbow-filter 2s linear infinite",raw:`@keyframes ffz-effect-rainbow {
	0% { filter: hue-rotate(0deg) }
	100% { filter: hue-rotate(360deg) }
}
@keyframes ffz-effect-rainbow-filter {
	0% { filter: var(--ffz-effect-filters) hue-rotate(0deg) }
	100% { filter: var(--ffz-effect-filters) hue-rotate(360deg) }
}`},{setting:"HyperRed",flags:n.HyperRed,title:"Hyper Red",filter:"brightness(0.2) sepia(1) brightness(2.2) contrast(3) saturate(8)"},{setting:"Shake",flags:n.Shake,title:"Hyper Shake Animation",animation:"ffz-effect-shake 0.1s linear infinite",animationTransform:"ffz-effect-shake-transform 0.1s linear infinite",raw:`@keyframes ffz-effect-shake-transform {
	0% { transform: var(--ffz-effect-transforms) translate(1px, 1px); }
	10% { transform: var(--ffz-effect-transforms) translate(-1px, -2px); }
	20% { transform: var(--ffz-effect-transforms) translate(-3px, 0px); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2px); }
	40% { transform: var(--ffz-effect-transforms) translate(1px, -1px); }
	50% { transform: var(--ffz-effect-transforms) translate(-1px, 2px); }
	60% { transform: var(--ffz-effect-transforms) translate(-3px, 1px); }
	70% { transform: var(--ffz-effect-transforms) translate(3px, 1px); }
	80% { transform: var(--ffz-effect-transforms) translate(-1px, -1px); }
	90% { transform: var(--ffz-effect-transforms) translate(1px, 2px); }
	100% { transform: var(--ffz-effect-transforms) translate(1px, -2px); }
}
@keyframes ffz-effect-shake {
	0% { transform: translate(1px, 1px); }
	10% { transform: translate(-1px, -2px); }
	20% { transform: translate(-3px, 0px); }
	30% { transform: translate(3px, 2px); }
	40% { transform: translate(1px, -1px); }
	50% { transform: translate(-1px, 2px); }
	60% { transform: translate(-3px, 1px); }
	70% { transform: translate(3px, 1px); }
	80% { transform: translate(-1px, -1px); }
	90% { transform: translate(1px, 2px); }
	100% { transform: translate(1px, -2px); }
}`},{setting:"Photocopy",flags:n.Cursed,title:"Cursed",filter:"grayscale(1) brightness(0.7) contrast(2.5)"},{setting:"Jam",flags:n.Jam,title:"Jam Animation",animation:"ffz-effect-jam 0.6s linear infinite",animationTransform:"ffz-effect-jam-transform 0.6s linear infinite",raw:`@keyframes ffz-effect-jam {
	0% { transform: translate(-2px, -2px) rotate(-6deg); }
	10% { transform: translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: translate(3px, 4px) rotate(-2deg); }
	50% { transform: translate(2px, 4px) rotate(3deg); }
	60% { transform: translate(1px, 4px) rotate(3deg); }
	70% { transform: translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: translate(-2px, -2px) rotate(-5deg); }
}
@keyframes ffz-effect-jam-transform {
	0% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-6deg); }
	10% { transform: var(--ffz-effect-transforms) translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: var(--ffz-effect-transforms) translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: var(--ffz-effect-transforms) translate(3px, 4px) rotate(-2deg); }
	50% { transform: var(--ffz-effect-transforms) translate(2px, 4px) rotate(3deg); }
	60% { transform: var(--ffz-effect-transforms) translate(1px, 4px) rotate(3deg); }
	70% { transform: var(--ffz-effect-transforms) translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: var(--ffz-effect-transforms) translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: var(--ffz-effect-transforms) translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-5deg); }
}`},{setting:"Bounce",flags:n.Bounce,animation:"ffz-effect-bounce 0.5s linear infinite",animationTransform:"ffz-effect-bounce-transform 0.5s linear infinite",transformOrigin:"bottom center",raw:`@keyframes ffz-effect-bounce {
	0% { transform: scale(0.8, 1); }
	10% { transform: scale(0.9, 0.8); }
	20% { transform: scale(1, 0.4); }
	25% { transform: scale(1.2, 0.3); }
	25.001% { transform: scale(-1.2, 0.3); }
	30% { transform: scale(-1, 0.4); }
	40% { transform: scale(-0.9, 0.8); }
	50% { transform: scale(-0.8, 1); }
	60% { transform: scale(-0.9, 0.8); }
	70% { transform: scale(-1, 0.4); }
	75% { transform: scale(-1.2, 0.3); }
	75.001% { transform: scale(1.2, 0.3); }
	80% { transform: scale(1, 0.4); }
	90% { transform: scale(0.9, 0.8); }
	100% { transform: scale(0.8, 1); }
}
@keyframes ffz-effect-bounce-transform {
	0% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
	10% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	20% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	25% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	25.001% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	30% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	40% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	50% { transform: scale(-0.8, 1) var(--ffz-effect-transforms); }
	60% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	70% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	75% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	75.001% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	80% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	90% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	100% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
}`},{setting:["Bounce","FlipY"],flags:n.Bounce|n.FlipY,transform:"translateY(100%)"}];function e(){const $=[`.modified-emote[data-effects] > .chat-line__message--emote {
	--ffz-effect-filters: none;
	--ffz-effect-transforms: initial;
	--ffz-effect-animations: initial;
}`];for(const o of r)o.raw&&$.push(o.raw);return $.join(`
`)}G(e,"generateBaseFilterCss");const a={59847:{modifier_offset:"0 15px 15px 0",modifier:!0},70852:{modifier:!0,modifier_offset:"0 5px 20px 0",extra_width:5,shrink_to_fit:!0},70854:{modifier:!0,modifier_offset:"30px 0 0"},147049:{modifier:!0,modifier_offset:"4px 1px 0 3px"},147011:{modifier:!0,modifier_offset:"0"},70864:{modifier:!0,modifier_offset:"0"},147038:{modifier:!0,modifier_offset:"0"}},z=class z extends W.default{constructor(...o){super(...o),this.EmoteTypes=I.EmoteTypes,this.ModifierFlags=s,this.filters={},this.__filters=[],this.inject("i18n"),this.inject("settings"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.twitch_inventory_sets=new Set,this.__twitch_emote_to_set={},this.__twitch_set_to_channel={},this.__twitch_emote_to_artist={},this.bulk=new Map,this.effects_enabled={},this.pending_effects=new Set,this.applyEffects=this.applyEffects.bind(this),this.sub_sets=new B.SourcedSet,this.default_sets=new B.SourcedSet,this.global_sets=new B.SourcedSet,this.providers=new Map,this.setProvider("ffz",{name:"FrankerFaceZ",font_icon:"ffz-i-zreknarf"}),this.emote_sets={},this._set_refs={},this._set_timers={},this.settings.add("chat.emotes.source-priorities",{default:null,ui:{path:"Chat > Emote Priorities",component:"emote-priorities",data:()=>(0,B.deep_copy)(this.providers)}}),this.settings.add("chat.emotes.enabled",{default:2,ui:{path:"Chat > Appearance >> Emotes",title:"Display Emotes",sort:-100,force_seen:!0,description:"If you do not wish to see emotes, you can disable them here.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Only"},{value:2,title:"Enabled"}]}}),this.settings.add("chat.emotes.2x",{default:0,process(c,m){return m===!0?1:m===!1?0:m},ui:{path:"Chat > Appearance >> Emotes",title:"Larger Emotes",description:"This setting will make emotes appear twice as large in chat. It's good for use with larger fonts or just if you really like emotes.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Emotes"},{value:2,title:"Emotes and Emoji"}]}}),this.settings.add("chat.emotes.limit-size",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Limit Native Emote Size",description:"Sometimes, really obnoxiously large emotes slip through the cracks and wind up on Twitch. This limits the size of Twitch emotes to mitigate the issue.",component:"setting-check-box"}}),this.settings.add("chat.emotes.allow-gigantify",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:'Allow "Gigantify an Emote" Power-Up',description:"How big is too big? Giant? Disable this and the emotes will be displayed normally.",component:"setting-check-box"}}),this.settings.add("chat.fix-bad-emotes",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Fix Bad Twitch Global Emotes",description:"Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.",component:"setting-check-box"}}),this.settings.add("chat.click-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information pages by Shift-Clicking them.",component:"setting-check-box"}}),this.settings.add("chat.sub-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open Twitch subscription pages by Shift-Clicking emotes when relevant.",component:"setting-check-box"}}),this.settings.add("chat.emote-dialogs",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information cards for Twitch emotes by clicking them.",component:"setting-check-box"}}),this.settings.add("chat.effects.enable",{default:!0,ui:{path:"Chat > Emote Effects >> General",title:"Enable the use of emote effects.",description:"Emote Effects are special effects that can be applied to some emotes using special modifiers.",component:"setting-check-box"}});for(const c of r){if(!c.setting||Array.isArray(c.setting))continue;const m={default:c.animation?null:!0,ui:{path:'Chat > Emote Effects >> Specific Effect @{"description": "**Note:** Animated effects are, by default, only enabled when [Animated Emotes](~chat.appearance.emotes) are enabled."}',title:`Enable the effect "${c.title??c.setting}".`,component:"setting-check-box",force_seen:!0}};c.animation&&(m.default=null,m.requires=["chat.emotes.animated"],m.process=function(A,h){return h??A.get("chat.emotes.animated")===1}),this.settings.add(`chat.effects.${c.setting}`,m)}this.handleClick=this.handleClick.bind(this),this.animHover=this.animHover.bind(this),this.animLeave=this.animLeave.bind(this)}getAddonProxy(o,c,m){if(!o)return this;const A=I.DEBUG||c?.dev,h=(0,B.makeAddonIdChecker)(o),T={},R={};return T.addFilter=P=>(P&&(P.__source=o),this.addFilter(P)),T.setProvider=(P,O)=>(A&&!h.test(P)&&m.log.warn("[DEV-CHECK] Call to emotes.setProvider did not include addon ID in provider:",P),O&&(O.__source=o),this.setProvider(P,O)),T.addDefaultSet=(P,O,M)=>(A&&!h.test(P)&&m.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet did not include addon ID in provider:",P),this.providers.has(P)||(this.inferProvider(P,o),A&&m.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet for provider that has not been registered with emotes.setProvider:",P)),M&&(A&&!h.test(O)&&m.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet loaded set data but did not include addon ID in set ID:",O),M.__source=o),this.addDefaultSet(P,O,M)),T.addSubSet=(P,O,M)=>(A&&!h.test(P)&&m.log.warn("[DEV-CHECK] Call to emotes.addSubSet did not include addon ID in provider:",P),this.providers.has(P)||(this.inferProvider(P,o),A&&m.log.warn("[DEV-CHECK] Call to emotes.addSubSet for provider that has not been registered with emotes.setProvider:",P)),M&&(A&&!h.test(O)&&m.log.warn("[DEV-CHECK] Call to emotes.addSubSet loaded set data but did not include addon ID in set ID:",O),M.__source=o),this.addSubSet(P,O,M)),T.loadSetData=(P,O,...M)=>(A&&!h.test(P)&&m.log.warn("[DEV-CHECK] Call to emotes.loadSetData did not include addon ID in set ID:",P),O&&(O.__source=o),this.loadSetData(P,O,...M)),A&&(T.removeFilter=P=>{let O;typeof P=="string"?O=P:O=P.type;const M=this.filters[O];return M&&M.__source!==o&&m.log.warn("[DEV-CHECK] Removed un-owned emote filter with emotes.removeFilter:",O," owner:",M.__source??"ffz"),this.removeFilter(P)},T.removeDefaultSet=(P,...O)=>(h.test(P)||m.log.warn("[DEV-CHECK] Call to emotes.removeDefaultSet did not include addon ID in provider:",P),this.removeDefaultSet(P,...O)),T.removeSubSet=(P,...O)=>(h.test(P)||m.log.warn("[DEV-CHECK] Call to emotes.removeSubSet did not include addon ID in provider:",P),this.removeSubSet(P,...O)),R.style=!0,R.effect_style=!0,R.emote_sets=!0,R.loadSetUserIds=R.loadSetUsers="This method is meant for internal use."),(0,W.buildAddonProxy)(m,this,"emotes",T,R)}onEnable(){this.style=new L.ManagedStyle("emotes"),this.effect_style=new L.ManagedStyle("effects"),this.base_effect_css=e(),this.parent.context.getChanges("chat.emotes.source-priorities",this.updatePriorities,this),this.parent.context.on("changed:chat.effects.enable",this.updateEffects,this);for(const m of r)m.setting&&!Array.isArray(m.setting)&&this.parent.context.on(`changed:chat.effects.${m.setting}`,this.updateEffects,this);this.updateEffects();const o=this.getFavorites("twitch");let c=!1;for(let m=0;m<o.length;m++)typeof o[m]=="number"&&(c=!0,o[m]=`${o[m]}`);if(c&&this.setFavorites("twitch",o),Object.keys(this.emote_sets).length){this.log.info("Generating CSS for existing emote sets.");for(const m in this.emote_sets)if((0,B.has)(this.emote_sets,m)){const A=this.emote_sets[m];A&&(A.pending_css||A.css)&&(this.style.set(`es--${m}`,(A.pending_css||"")+(A.css||"")),A.pending_css=null)}}this.on("pubsub:command:follow_sets",this.updateFollowSets,this),this.on("pubsub:command:add_emote",m=>{const A=m.set_id,h=m.emote,T=this.emote_sets[A];if(!T)return;const R=!!T.emotes?.[h.id]||!!T.disabled_emotes?.[h.id],P=this.addEmoteToSet(A,h);this.maybeNotifyChange(R?"modified":"added",A,P)}),this.on("pubsub:command:remove_emote",m=>{const A=m.set_id,h=m.emote_id;if(!this.emote_sets[A])return;const T=this.removeEmoteFromSet(A,h);T&&this.maybeNotifyChange("removed",A,T)}),this.on("chat:reload-data",m=>{(!m||m.emotes)&&this.loadGlobalSets()}),this.on("addon:fully-unload",m=>{let A=0;for(const[h,T]of Object.entries(this.emote_sets))T?.__source===m&&(A++,this.loadSetData(h,null,!0));for(const[h,T]of Object.entries(this.filters))T?.__source===m&&(A++,this.removeFilter(h));for(const[h,T]of this.providers.entries())T?.__source===m&&(A++,this.setProvider(h,null));A&&this.log.debug(`Cleaned up ${A} entries when unloading addon:`,m)}),this.loadGlobalSets()}updatePriorities(o){const c=o?.length;!c||c<=0?this.sourceSortFn=null:this.sourceSortFn=(m,A)=>{m.startsWith("ffz-")&&(m="ffz"),A.startsWith("ffz-")&&(A="ffz");let h=o.indexOf(m),T=o.indexOf(A);return h===-1&&(h=c),T===-1&&(T=c),h-T},this.default_sets.setSortFunction(this.sourceSortFn),this.emit(":update-priorities",this.sourceSortFn)}inferProvider(o,c){if(this.providers.has(o))return;const m=this.resolve("addons")?.getAddon(c);m&&this.setProvider(o,{name:m.name,i18n_key:m.name_i18n,icon:m.icon,description:o,__source:c})}setProvider(o,c){c?(c.id=o,this.providers.set(o,c)):this.providers.delete(o)}addFilter(o,c=!0){const m=o.type;if((0,B.has)(this.filters,m)){this.log.warn(`Tried adding emote filter of type '${m}' when one was already present.`);return}this.filters[m]=o,o.priority==null&&(o.priotiy=0),this.__filters.push(o),this.__filters.sort((A,h)=>A.priority>h.priority?-1:A.priority<h.priority?1:A.type<h.type),c&&this.updateFiltered()}removeFilter(o,c=!0){let m;if(typeof o=="string"?m=o:m=o.type,o=this.filters[m],!o)return null;delete this.filters[m];const A=this.__filters.indexOf(o);return A!==-1&&(this.__filters.splice(A,1),c&&this.updateFiltered()),o}shouldFilterEmote(o,c,m){for(const A of this.__filters)if(A.test(o,c,m))return!0;return!1}updateFiltered(){for(const o of Object.values(this.emote_sets)){const c={},m={};let A=0,h=0,T=!1;for(const P of Object.values(o.emotes))this.shouldFilterEmote(P,o,o.id)?(m[P.id]=P,h++,T=!0):(c[P.id]=P,A++);for(const P of Object.values(o.disabled_emotes))this.shouldFilterEmote(P,o,o.id)?(m[P.id]=P,h++):(c[P.id]=P,A++,T=!0);if(!T)continue;this.log.info(`Filtered emote set #${o.id}: ${o.title} (total: ${A+h}, old: ${o.disabled_count}, new: ${h})`),o.emotes=c,o.count=A,o.disabled_emotes=m,o.disabled_count=h;const R=[];for(const P of Object.values(c)){const O=this.generateEmoteCSS(P);O?.length&&R.push(O)}this.style&&(R.length||o.css)?this.style.set(`es--${o.id}`,R.join("")+(o.css||"")):R.length&&(o.pending_css=R.join("")),this.emit(":loaded",o.id,o)}}maybeNotifyChange(o,c,m){this._pending_notifications||(this._pending_notifications=[]),this._pending_notifications.push({action:o,set_id:c,emote:m}),this._pending_timer||(this._pending_timer=setTimeout(()=>this._handleNotifyChange(),1e3))}_handleNotifyChange(){clearTimeout(this._pending_timer),this._pending_timer=null;const o=this._pending_notifications;this._pending_notifications=null;const c=this.resolve("site.chat");if(!c?.addNotice)return;const m=this.resolve("site").getUser();if(!m?.id)return;let A=this.parent.context.get("context.channelID"),h=this.parent.context.get("context.channel");const T=this.getSetIDs(m.id,m.login,A,h),R={};for(const P of o){const O=`${P.set_id}`,M=P.action;if(T.includes(O)){const j=R[O]=R[O]||{},Y=j[M]=j[M]||[];if(Y.find(ee=>ee.id===P.emote.id))continue;Y.push(P.emote)}}for(const[P,O]of Object.entries(R)){const M=this.emote_sets[P];if(M)for(const[j,Y]of Object.entries(O)){const ee=Y.map(Q=>Q.name).join(", ");let X;j==="added"?X=this.i18n.t("emote-updates.added","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been added to {set}.",{count:Y.length,emotes:ee,set:M.title}):j==="modified"?X=this.i18n.t("emote-updates.modified","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been updated in {set}.",{count:Y.length,emotes:ee,set:M.title}):j==="removed"&&(X=this.i18n.t("emote-updates.removed","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been removed from {set}.",{count:Y.length,emotes:ee,set:M.title})),X&&c.addNotice("*",{icon:"ffz-i-zreknarf",message:X})}}}ensureEffect(o){this.effect_style.has(`${o}`)||(this.pending_effects.add(o),this._effect_timer||(this._effect_timer=requestAnimationFrame(this.applyEffects)))}applyEffects(){this._effect_timer=null;const o=this.pending_effects;this.pending_effects=new Set;for(const c of o){const m=this.generateFilterCss(c);this.effect_style.set(`${c}`,m??"")}}generateFilterCss(o){if(!this.parent.context.get("chat.effects.enable"))return null;let c,m,A,h,T=[];for(const R of this.activeEffectStyles)(o&R.flags)===R.flags&&(R.not_flags&&(o&R.not_flags)===R.not_flags||(R.animation&&T.push(R),R.filter&&(c=c?`${c} ${R.filter}`:R.filter),R.transformOrigin&&(m=R.transformOrigin),R.transform&&(A=A?`${A} ${R.transform}`:R.transform)));if(T.length)for(const R of T)c&&R.animationFilter?h=h?`${h}, ${R.animationFilter}`:R.animationFilter:A&&R.animationTransform?h=h?`${h}, ${R.animationTransform}`:R.animationTransform:h=h?`${h}, ${R.animation}`:R.animation;return!c&&!A&&!h?null:`.modified-emote[data-effects="${o}"] > .chat-line__message--emote {${c?`
	--ffz-effect-filters: ${c};
	filter: var(--ffz-effect-filters);`:""}${m?`
	transform-origin: ${m};`:""}${A?`
	--ffz-effect-transforms: ${A};
	transform: var(--ffz-effect-transforms);`:""}${h?`
	--ffz-effect-animations: ${h};
	animation: var(--ffz-effect-animations);`:""}
}`}updateEffects(){const o=this.parent.context.get("chat.effects.enable");this.effects_enabled={},this.activeEffectStyles=[],this.activeAsBackgroundMask=0,this.activeNoWideMask=0;for(const c of r)c.setting&&!Array.isArray(c.setting)&&(this.effects_enabled[c.setting]=this.parent.context.get(`chat.effects.${c.setting}`));for(const c of r){let m=!0;if(Array.isArray(c.setting)){for(const A of c.setting)if(!this.effects_enabled[A]){m=!1;break}}else c.setting&&(m=this.effects_enabled[c.setting]);m&&(this.activeEffectStyles.push(c),c.as_background&&(this.activeAsBackgroundMask=this.activeAsBackgroundMask|c.flags),c.no_wide&&(this.activeNoWideMask=this.activeNoWideMask|c.flags))}this.effect_style.clear(),!(!o||!this.activeEffectStyles.length)&&(this.effect_style.set("base",this.base_effect_css),this.emit(":update-effects"))}updateFollowSets(o){for(const c in o)if((0,B.has)(o,c)){const m=this.parent.getRoom(null,c,!0);if(!m||m.destroyed)continue;const A=o[c]||[],h=m.emote_sets,T=h&&h._sources;if(T&&T.has("ffz-featured"))for(const R of T.get("ffz-featured")){const P=A.indexOf(R);P===-1?m.removeSet("ffz-featured",R):A.splice(P,1)}for(const R of A)m.addSet("ffz-featured",R),this.emote_sets[R]||this.loadSet(R)}}toggleHidden(o,c,m=null){const A=`hidden-emotes.${o}`,h=this.settings.provider,T=h.get(A,[]),R=T.indexOf(c);if(m===null&&(m=R===-1),m&&R===-1)T.push(c);else if(!m&&R!==-1)T.splice(R,1);else return;T.length?h.set(A,T):h.delete(A),this.emit(":change-hidden",o,c,m)}isHidden(o,c){return this.getHidden(o).includes(c)}getHidden(o){return this.settings.provider.get(`hidden-emotes.${o}`)||[]}setHidden(o,c){const m=`hidden-emotes.${o}`;!Array.isArray(c)||!c.length?this.settings.provider.delete(m):this.settings.provider.set(m,c)}animHover(o){const c=o.currentTarget;c[g]||(c[u]&&cancelAnimationFrame(c[u]),c[u]=requestAnimationFrame(()=>{if(c[u]=null,c[g]||!c.matches(":hover"))return;c[g]=!0;const m=c.querySelectorAll(".ffz-hover-emote");for(const A of m){const h=A.dataset;h.normalSrc&&h.hoverSrc&&(A.src=h.hoverSrc,A.srcset&&(A.srcset=h.hoverSrcSet))}}))}animLeave(o){const c=o.currentTarget;c[g]&&(c[u]&&cancelAnimationFrame(c[u]),c[u]=requestAnimationFrame(()=>{if(c[u]=null,!c[g]||c.matches(":hover"))return;c[g]=!1;const m=c.querySelectorAll(".ffz-hover-emote");for(const A of m){const h=A.dataset;h.normalSrc&&(A.src=h.normalSrc,A.srcset&&(A.srcset=h.normalSrcSet))}}))}toggleFavorite(o,c,m=null){const A=`favorite-emotes.${o}`,h=this.settings.provider,T=h.get(A)||[],R=T.indexOf(c);if(m===null&&(m=R===-1),m&&R===-1)T.push(c);else if(!m&&R!==-1)T.splice(R,1);else return m;return T.length?h.set(A,T):h.delete(A),this.emit(":change-favorite",o,c,m),m}isFavorite(o,c){const m=this.settings.provider.get(`favorite-emotes.${o}`);return m&&m.includes(c)}getFavorites(o){return this.settings.provider.get(`favorite-emotes.${o}`)||[]}setFavorites(o,c){const m=`favorite-emotes.${o}`;!Array.isArray(c)||!c.length?this.settings.provider.delete(m):this.settings.provider.set(m,c)}handleClick(o,c=!1){const m=o.target,A=m&&m.dataset;if(!A)return;const h=A.provider,T=this.parent.context.get("chat.click-emotes"),R=this.parent.context.get("chat.sub-emotes");if(o.shiftKey&&(T||R)){let M;if(h==="twitch"){if(M=null,R){const j=this.resolve("site.apollo");if(j)return j.client.query({query:D(),variables:{id:A.id}}).then(Y=>{const ee=(0,B.get)("data.emote.subscriptionProduct",Y);if(ee&&ee.state==="ACTIVE"&&ee.owner&&ee.owner.login)M=`https://www.twitch.tv/subs/${ee.owner.login}`;else if(!T)return!1;if(M){const X=window.open();X&&(X.opener=null,X.location=M)}}),!0}}else if(h==="ffz"){const j=this.emote_sets[A.set],Y=j&&(j.emotes[A.id]||j.disabled_emotes?.[A.id]);if(!Y)return;Y.click_url?M=Y.click_url:j.source||(M=`https://www.frankerfacez.com/emoticons/${Y.id}`)}if(!T)return!1;if(M){const j=window.open();j&&(j.opener=null,j.location=M)}return!0}if(o[S]){let M,j;if(h==="twitch")M="twitch",j=A.id;else if(h==="ffz"){const ee=this.emote_sets[A.set],X=ee&&(ee.emotes[A.id]||ee.disabled_emotes?.[A.id]);if(!X)return;M=ee.source||"ffz",j=X.id}else if(h==="emoji")M="emoji",j=A.code;else return;this.toggleFavorite(M,j);const Y=m._ffz_tooltip;return Y&&Y.visible&&(Y.hide(),setTimeout(()=>document.contains(m)&&Y.show(),0)),!0}if(c)return!1;let P;try{P=JSON.parse(A.modifierInfo)}catch{}const O=this.makeEvent({provider:h,id:A.id,set:A.set,code:A.code,variant:A.variant,name:A.name||m.alt,modifiers:P,source:o});if(this.emit("chat.emotes:click",O),O.defaultPrevented)return!0;if(h==="twitch"&&this.parent.context.get("chat.emote-dialogs")){const M=this.resolve("site.fine");if(!M)return;const j=M.searchParent(m,X=>X.props&&X.props.message),Y=M.searchParent(m,X=>X.onShowEmoteCard,500);if(!j||!Y)return;const ee=m.getBoundingClientRect();return Y.onShowEmoteCard({channelID:j.props.channelID||"",channelLogin:j.props.channelLogin||"",emoteID:A.id,emoteCode:m.alt,sourceID:"chat",referrerID:"",initialTopOffset:ee.bottom,initialBottomOffset:ee.top}),!0}}getTargetEmote(){this.target_emote=null;const o=this.resolve("site").getUser(),c=o?this.resolve("site.chat.input"):null,m=c?c.getInput():null,A=this.resolve("site.chat.emote_menu")?.MenuWrapper?.first,h=A?.getAllSets?.(),T=h?h.map(R=>R.emotes).flat().filter(R=>!R.effects&&!R.locked):null;if(m&&T){const R={};for(let M=0;M<T.length;M++)R[T[M].name]||(R[T[M].name]=M);const P=m.split(" ");let O=P.length;for(;O--;){const M=P[O];if(R[M]!=null)return T[R[M]]}}if(T&&T.length){const R=Math.floor(Math.random()*T.length),P=T[R];return this.target_emote=P,P}return this.target_emote={provider:"ffz",set_id:3,id:149346,name:"LaterSooner",src:"https://cdn.frankerfacez.com/emote/149346/1",srcSet:"https://cdn.frankerfacez.com/emote/149346/1 1x, https://cdn.frankerfacez.com/emote/149346/2 2x, https://cdn.frankerfacez.com/emote/149346/4 4x",width:25,height:32}}getSetIDs(o,c,m,A){const h=this.parent.getRoom(m,A,!0),T=h&&h.getUser(o,c,!0),R=this.parent.getUser(o,c,!0);let P=(R?.emote_sets?R.emote_sets._cache:[]).concat(T?.emote_sets?T.emote_sets._cache:[],h?.emote_sets?h.emote_sets._cache:[],this.default_sets._cache);if(this.bulk.size){const O=String(o);for(const[M,j]of this.bulk)j?._cache.has(O)&&P.push(M)}if(h?.shared_chats?.size>0)for(const O of h.shared_chats){const M=this.parent.getRoom(O,null,!0),j=M&&M.getUser(o,c,!0);j?.emote_sets?._cache&&(P=P.concat(j.emote_sets._cache)),M?.emote_sets?._cache&&(P=P.concat(M.emote_sets._cache))}return P}getSets(o,c,m,A){return this.getSetIDs(o,c,m,A).map(h=>this.emote_sets[h])}_withSources(o,c,m,A=null){if(m?._sources){for(const[h,T]of m._sources)for(const R of T)c.has(R)||(o.push([R,h,A]),c.add(R));return o}}getRoomSetIDsWithSources(o,c,m,A){const h=this.parent.getRoom(m,A,!0),T=h&&h.getUser(o,c,!0);if(!h)return[];const R=[],P=new Set;if(this._withSources(R,P,h.emote_sets,h.id),T&&this._withSources(R,P,T.emote_sets,h.id),h?.shared_chats?.size>0)for(const O of h.shared_chats){const M=this.parent.getRoom(O,null,!0),j=M&&M.getUser(o,c,!0);j&&this._withSources(R,P,j.emote_sets,O),M&&this._withSources(R,P,M.emote_sets,O)}return R}getRoomSetsWithSources(o,c,m,A){return this.getRoomSetIDsWithSources(o,c,m,A).map(([h,T,R])=>[this.emote_sets[h],T,R])}getRoomSetIDs(o,c,m,A){const h=this.parent.getRoom(m,A,!0),T=h&&h.getUser(o,c,!0);let R;if(h?T?.emote_sets?h.emote_sets?R=T.emote_sets._cache.concat(h.emote_sets._cache):R=T.emote_sets._cache:R=h.emote_sets?h.emote_sets._cache:[]:R=[],h?.shared_chats?.size>0)for(const P of h.shared_chats){const O=this.parent.getRoom(P,null,!0),M=O&&O.getUser(o,c,!0);M?.emote_sets?._cache&&(R=R.concat(M.emote_sets._cache)),O?.emote_sets?._cache&&(R=R.concat(O.emote_sets._cache))}return R}getRoomSets(o,c,m,A){return this.getRoomSetIDs(o,c,m,A).map(h=>this.emote_sets[h])}getGlobalSetIDsWithSources(o,c){const m=this.parent.getUser(o,c,!0),A=[],h=new Set;if(this._withSources(A,h,this.default_sets),m&&this._withSources(A,h,m.emote_sets),this.bulk.size){const T=String(o);for(const[R,P]of this.bulk)if(!h.has(R)&&P?._cache.has(T)){for(const[O,M]of P._sources)if(M&&M.includes(T)){A.push([R,O,null]);break}}}return A}getGlobalSetsWithSources(o,c){return this.getGlobalSetIDsWithSources(o,c).map(([m,A])=>[this.emote_sets[m],A,null])}getSubSetIDsWithSources(){const o=[],c=new Set;return this._withSources(o,c,this.sub_sets),o}getSubSetsWithSources(){return this.getSubSetIDsWithSources().map(([o,c])=>[this.emote_sets[o],c,null])}getGlobalSetIDs(o,c){const m=this.parent.getUser(o,c,!0),A=(m?.emote_sets?m.emote_sets._cache:[]).concat(this.default_sets._cache);if(this.bulk.size){const h=String(o);for(const[T,R]of this.bulk)R?._cache.has(h)&&A.push(T)}return A}getGlobalSets(o,c){return this.getGlobalSetIDs(o,c).map(m=>this.emote_sets[m])}getEmotes(o,c,m,A){const h={};for(const T of this.getSets(o,c,m,A))if(T&&T.emotes)for(const R of Object.values(T.emotes))R&&!(0,B.has)(h,R.name)&&(h[R.name]=R);return h}setBulk(o,c,m){let A=this.bulk.get(c);A||this.bulk.set(c,A=new B.SourcedSet(!0));const h=A._cache.size;A.set(o,m);const T=A._cache.size;!h&&T&&this.refSet(c)}deleteBulk(o,c){const m=this.bulk.get(c);if(!m)return;const A=m._cache.size;m.delete(o);const h=m._cache.size;A&&!h&&this.unrefSet(c)}extendBulk(o,c,m){let A=this.bulk.get(c);A||this.bulk.set(c,A=new B.SourcedSet(!0)),Array.isArray(m)||(m=[m]);const h=A._cache.size;A.extend(o,...m);const T=A._cache.size;!h&&T&&this.refSet(c)}addDefaultSet(o,c,m){typeof c=="number"&&(c=`${c}`);let A=!1,h=!1;return this.default_sets.sourceIncludes(o,c)||(A=!this.default_sets.includes(c),this.default_sets.push(o,c),h=!0),m&&this.loadSetData(c,m),A&&(this.refSet(c),this.emit(":update-default-sets",o,c,!0)),h}removeDefaultSet(o,c){if(!c){const m=this.default_sets.get(o);if(m)for(const A of Array.from(m))this.removeDefaultSet(o,A);return}return typeof c=="number"&&(c=`${c}`),this.default_sets.sourceIncludes(o,c)?(this.default_sets.remove(o,c),this.default_sets.includes(c)||(this.unrefSet(c),this.emit(":update-default-sets",o,c,!1)),!0):!1}addSubSet(o,c,m){typeof c=="number"&&(c=`${c}`);let A=!1,h=!1;return this.sub_sets.sourceIncludes(o,c)||(A=!this.sub_sets.includes(c),this.sub_sets.push(o,c),h=!0),m&&this.loadSetData(c,m),A&&(this.refSet(c),this.emit(":update-sub-sets",o,c,!0)),h}removeSubSet(o,c){return typeof c=="number"&&(c=`${c}`),this.sub_sets.sourceIncludes(o,c)?(this.sub_sets.remove(o,c),this.sub_sets.includes(c)||(this.unrefSet(c),this.emit(":update-sub-sets",o,c,!1)),!0):!1}refSet(o){this._set_refs[o]=(this._set_refs[o]||0)+1,this._set_timers[o]&&(clearTimeout(this._set_timers[o]),this._set_timers[o]=null)}unrefSet(o){(this._set_refs[o]=(this._set_refs[o]||1)-1)<=0&&!this._set_timers[o]&&(this._set_timers[o]=setTimeout(()=>this.unloadSet(o),5e3))}async loadGlobalSets(o=0){this.load_tracker.schedule("chat-data","ffz-global");let c,m;if(this.experiments.getAssignment("api_load")&&o<1)try{fetch(`${I.NEW_API}/v1/set/global`).catch(()=>{})}catch{}try{c=await fetch(`${this.staging.api}/v1/set/global/ids`)}catch(h){return o++,o<10?setTimeout(()=>this.loadGlobalSets(o),500*o):(this.log.error("Error loading global emote sets.",h),this.load_tracker.notify("chat-data","ffz-global",!1),!1)}if(!c.ok)return this.load_tracker.notify("chat-data","ffz-global",!1),!1;try{m=await c.json()}catch(h){return this.log.error("Error parsing global emote data.",h),this.load_tracker.notify("chat-data","ffz-global",!1),!1}const A=m.sets||{};this.removeDefaultSet("ffz-global");for(const h of m.default_sets)this.addDefaultSet("ffz-global",h);for(const h in A)if((0,B.has)(A,h)){const T=A[h]?.id;this.loadSetData(h,A[h]),T&&!m.default_sets.includes(T)&&this.addSubSet("ffz-global",h)}return m.user_ids?this.loadSetUserIds(m.user_ids):m.users&&this.loadSetUsers(m.users),this.load_tracker.notify("chat-data","ffz-global"),!0}async loadSet(o,c=!1,m=0){const A=`ffz-${o}`;this.load_tracker.schedule("chat-data",A);let h,T;if(this.experiments.getAssignment("api_load"))try{fetch(`${I.NEW_API}/v1/set/${o}`).catch(()=>{})}catch{}try{h=await fetch(`${this.staging.api}/v1/set/${o}${this.staging.active?"/ids":""}`)}catch(P){return m++,m<10?setTimeout(()=>this.loadGlobalSets(m),500*m):(this.log.error(`Error loading data for set "${o}".`,P),this.load_tracker.notify("chat-data",A,!1),!1)}if(!h.ok)return this.load_tracker.notify("chat-data",A,!1),!1;try{T=await h.json()}catch(P){return this.log.error(`Error parsing data for set "${o}".`,P),this.load_tracker.notify("chat-data",A,!1),!1}const R=T.set;return R&&this.loadSetData(R.id,R,c),T.user_ids?this.loadSetUserIds(T.user_ids):T.users&&this.loadSetUsers(T.users),this.load_tracker.notify("chat-data",A,!0),!0}loadSetUserIds(o,c=!1){for(const m in o)if((0,B.has)(o,m)){const A=this.emote_sets[m],h=o[m];this.setBulk("ffz-global",m,h.map(T=>String(T))),c||this.log.info(`Added "${A?A.title:m}" emote set to ${h.length} users.`)}}loadSetUsers(o,c=!1){for(const m in o)if((0,B.has)(o,m)){const A=this.emote_sets[m],h=o[m];for(const T of h)this.parent.getUser(void 0,T).addSet("ffz-global",m);c||this.log.info(`Added "${A?A.title:m}" emote set to ${h.length} users.`)}}processEmote(o,c){return!o.id||!o.name||!o.urls?null:(o.set_id=c,o.src=o.urls[1],o.srcSet=`${o.urls[1]} 1x`,o.urls[2]&&(o.srcSet+=`, ${o.urls[2]} 2x`),o.urls[4]&&(o.srcSet+=`, ${o.urls[4]} 4x`),o.urls[2]&&(o.can_big=!0,o.src2=o.urls[2],o.srcSet2=`${o.urls[2]} 1x`,o.urls[4]&&(o.srcSet2+=`, ${o.urls[4]} 2x`)),o.animated?.[1]&&(o.animSrc=o.animated[1],o.animSrcSet=`${o.animated[1]} 1x`,o.animated[2]&&(o.animSrcSet+=`, ${o.animated[2]} 2x`,o.animSrc2=o.animated[2],o.animSrcSet2=`${o.animated[2]} 1x`,o.animated[4]&&(o.animSrcSet+=`, ${o.animated[4]} 4x`,o.animSrcSet2+=`, ${o.animated[4]} 2x`))),o.token={type:"emote",id:o.id,set:c,provider:"ffz",src:o.src,srcSet:o.srcSet,can_big:!!o.urls[2],src2:o.src2,srcSet2:o.srcSet2,animSrc:o.animSrc,animSrcSet:o.animSrcSet,animSrc2:o.animSrc2,animSrcSet2:o.animSrcSet2,masked:!!o.mask,mod:o.modifier,mod_prefix:o.modifier_prefix,mod_hidden:(o.modifier_flags&1)===1,text:o.hidden?"???":o.name,length:o.name.length,height:o.height,width:o.width,source_modifier_flags:o.modifier_flags??0},(0,B.has)(a,o.id)&&Object.assign(o,a[o.id]),o)}addEmoteToSet(o,c){const m=this.emote_sets[o];if(!m)throw new Error(`Invalid emote set "${o}"`);let A=this.processEmote(c,o);if(!A)throw new Error("Invalid emote data object.");const h=this.shouldFilterEmote(A,m,o);m.disabled_emotes[A.id]&&(delete m.disabled_emotes[A.id],m.disabled_count--);const R=m.emotes[A.id],P=R&&this.generateEmoteCSS(R);if(h)if(m.disabled_emotes[A.id]=A,m.disabled_count++,R){const M={};let j=0;for(const Y of Object.values(m.emotes))Y.id!=A.id&&(M[Y.id]=Y,j++);m.emotes=M,m.count=j}else return A;else m.emotes[A.id]=A,R||m.count++;const O=`es--${o}`;if(P&&P.length){const M=[];for(const j of Object.values(m.emotes)){const Y=this.generateEmoteCSS(j);Y&&Y.length&&M.push(Y)}this.style&&(M.length||m.css)?this.style.set(O,M.join("")+(m.css||"")):M.length&&(m.pending_css=M.join(""))}else if(!h){const M=this.generateEmoteCSS(A);M&&M.length&&(this.style?this.style.set(O,(this.style.get(O)||"")+M):m.pending_css=(m.pending_css||"")+M)}return this.emit(":loaded",o,m),A}removeEmoteFromSet(o,c){const m=this.emote_sets[o];if(!m)throw new Error(`Invalid emote set "${o}"`);c&&c.id&&(c=c.id);const A=m.disabled_emotes?.[c];if(A)return m.disabled_count--,delete m.disabled_emotes[c],A;const h=m.emotes[c];if(!h)return;const T=this.generateEmoteCSS(h),R=T&&T.length?[]:null,P={};let O=0;for(const M of Object.values(m.emotes))if(M.id!=c&&(P[M.id]=M,O++,R!=null)){const j=this.generateEmoteCSS(M);j&&j.length&&R.push(j)}if(m.emotes=P,m.count=O,R!=null){const M=`es--${o}`;this.style&&(R.length||m.css)?this.style.set(M,R.join("")+(m.css||"")):R.length&&(m.pending_css=R.join(""))}return this.emit(":loaded",o,m),h}loadSetData(o,c,m=!1){const A=this.emote_sets[o];if(!c){A&&(this.style&&this.style.delete(`es--${o}`),this.emote_sets[o]=null);return}this.emote_sets[o]=c;let h=0,T=0;const R=c.emotes||c.emoticons,P=c.emotes={},O=c.disabled_emotes={},M=[];c.id=o,c.emoticons=void 0;const j=[];for(const ee of R){let X=this.processEmote(ee,o);if(!X){j.push(ee);continue}if(this.shouldFilterEmote(X,c,o)){O[X.id]=X,T++;continue}const Q=this.generateEmoteCSS(X);Q&&M.push(Q),h++,P[X.id]=X}j.length&&this.log.warn(`Bad Emote Data for Set #${o}`,j),c.count=h,c.disabled_count=T,this.style&&(M.length||c.css)?this.style.set(`es--${o}`,M.join("")+(c.css||"")):M.length&&(c.pending_css=M.join("")),m||this.log.info(`Loaded emote set #${o}: ${c.title} (${h} emotes, ${T} filtered)`),this.emit(":loaded",o,c),(this._set_refs[o]||0)<=0&&!this._set_timers[o]&&(this._set_timers[o]=setTimeout(()=>this.unloadSet(o),5e3))}unloadSet(o,c=!1,m=!1){const A=this.emote_sets[o],h=this._set_refs[o]||0;if(A){if(h>0){if(!c)return this.log.warn(`Attempted to unload emote set #${o} with ${h} users.`);this.log.warn(`Unloading emote set ${o} with ${h} users.`)}m||this.log.info(`Unloaded emote set #${o}: ${A.title}`),this._set_timers[o]&&(clearTimeout(this._set_timers[o]),this._set_timers[o]=null),this.emit(":unloaded",o,A),this.emote_sets[o]=null}}generateEmoteCSS(o){if(!o.mask&&!o.margins&&(!o.modifier||!o.modifier_offset&&!o.extra_width&&!o.shrink_to_fit)&&!o.css)return"";let c="";if(o.modifier&&(o.modifier_offset||o.margins||o.extra_width||o.shrink_to_fit)){let m=o.modifier_offset||o.margins||"0";m=m.split(/\s+/).map(O=>parseInt(O,10)),m.length===3&&m.push(m[1]);const A=m.length,h=m[0%A],T=m[1%A],R=m[2%A],P=m[3%A];c=`.modified-emote span .ffz-emote[data-id="${o.id}"] {
	padding: ${h}px ${T}px ${R}px ${P}px;
	${o.shrink_to_fit?`max-width: calc(100% - ${40-P-T-(o.extra_width||0)}px);`:""}
	margin: 0 !important;
}`}return o.modifier&&o.mask?.[1]&&(c=(c||"")+`.modified-emote[data-modifiers~="${o.id}"] > .chat-line__message--emote {
	-webkit-mask-image: url("${o.mask[1]}");
	-webkit-mask-position: center center;
}`),`${c}.ffz-emote[data-id="${o.id}"] {
	${o.margins&&!o.modifier?`margin: ${o.margins} !important;`:""}
	${o.css||""}
}`}setTwitchEmoteSet(o,c){if(typeof o=="number"){if(isNaN(o)||!isFinite(o))return;o=`${o}`}if(typeof c=="number"){if(isNaN(c)||!isFinite(c))return;c=`${c}`}this.__twitch_emote_to_set[o]=c}setTwitchSetChannel(o,c){if(typeof o=="number"){if(isNaN(o)||!isFinite(o))return;o=`${o}`}this.__twitch_set_to_channel[o]=c}_getTwitchEmoteSet(o,c=!1){const m=this.__twitch_emote_to_set,A=this.__twitch_set_to_channel,h=this.__twitch_emote_to_artist;if(typeof o=="number"){if(isNaN(o)||!isFinite(o))return Promise.resolve(null);o=`${o}`}if((0,B.has)(m,o)&&(!c||(0,B.has)(h,o))){const R=m[o];return Array.isArray(R)?new Promise(P=>R.push(P)):Promise.resolve(R)}const T=this.resolve("site.apollo");return T?.client?new Promise(R=>{const P=[R];m[o]=P,(0,B.timeout)(T.client.query({query:D(),variables:{id:`${o}`}}),2e3).then(O=>{const M=O?.data?.emote;let j=null;if(M&&(j=M.setID,M.id&&!(0,B.has)(h,M.id)&&(h[M.id]=M.artist),j&&!(0,B.has)(A,j))){const Y=C(M);A[j]={id:j,type:Y,owner:M?.subscriptionProduct?.owner||M?.owner}}m[o]=j;for(const Y of P)Y(j)}).catch(()=>{m[o]=null;for(const O of P)O(null)})}):Promise.resolve(null)}getTwitchEmoteSet(o,c){const m=this._getTwitchEmoteSet(o);if(c)m.then(c);else return m}_getTwitchEmoteArtist(o){const c=this.__twitch_emote_to_artist;return(0,B.has)(c,o)?Promise.resolve(c[o]):this._getTwitchEmoteSet(o,!0).then(()=>c[o]).catch(()=>(c[o]=null,null))}getTwitchEmoteArtist(o,c){const m=this._getTwitchEmoteArtist(o);if(c)m.then(c);else return m}_getTwitchSetChannel(o){const c=this.__twitch_set_to_channel;if(typeof o=="number"){if(isNaN(o)||!isFinite(o))return Promise.resolve(null);o=`${o}`}if((0,B.has)(c,o)){const A=c[o];return Array.isArray(A)?new Promise(h=>A.push(h)):Promise.resolve(A)}const m=this.resolve("site.apollo");return m?.client?new Promise(A=>{const h=[A];c[o]=h,(0,B.timeout)(m.client.query({query:f(),variables:{id:`${o}`}}),2e3).then(T=>{const R=T?.data?.emoteSet;let P=null;R&&(P={id:o,type:y(R),owner:R.owner?{id:R.owner.id,login:R.owner.login,displayName:R.owner.displayName}:null}),c[o]=P;for(const O of h)O(P)}).catch(()=>{c[o]=null;for(const T of h)T(null)})}):Promise.resolve(null)}getTwitchSetChannel(o,c){const m=this._getTwitchSetChannel(o);if(c)m.then(c);else return m}};G(z,"Emotes");let p=z;function C($){const o=$.subscriptionProduct;if(o){if(o.id==12658)return I.EmoteTypes.Prime;if(o.id==324)return I.EmoteTypes.Turbo;const m=o.owner;if(m)return m.id==139075904||o.state==="INACTIVE"?I.EmoteTypes.LimitedTime:I.EmoteTypes.Subscription}if($.setID==300238151)return I.EmoteTypes.ChannelPoints;if($.setID==300374282)return I.EmoteTypes.TwoFactor;const c=parseInt($.setID,10);return!isNaN(c)&&isFinite(c)&&c>=5e8?I.EmoteTypes.BitsTier:I.EmoteTypes.Global}G(C,"determineEmoteType");function y($){const o=/^\d+$/.test($.id)?parseInt($.id,10):null;if(o&&I.TWITCH_GLOBAL_SETS.includes(o))return I.EmoteTypes.Global;if(o&&I.TWITCH_POINTS_SETS.includes(o))return I.EmoteTypes.ChannelPoints;if(o&&I.TWITCH_PRIME_SETS.includes(o))return I.EmoteTypes.Prime;if(o==300374282)return I.EmoteTypes.TwoFactor;const c=$.owner;if(c){if(c.id==139075904)return I.EmoteTypes.LimitedTime;let m;if(Array.isArray(c.subscriptionProducts)){for(const A of c.subscriptionProducts)if($.id==A.emoteSetID){m=A;break}}if(m){if(m.id==12658)return I.EmoteTypes.Prime;if(m.id==324)return I.EmoteTypes.Turbo;if(m.state==="INACTIVE")return I.EmoteTypes.LimitedTime}return I.EmoteTypes.Subscription}return o>=5e8?I.EmoteTypes.BitsTier:I.EmoteTypes.Global}G(y,"determineSetType")},89959:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>o});var W=d(51722),L=d.n(W),B=d(24431),I=d(22527),U=d(14873),D=d(44589),v=d(83342),f=d(46949),u=d(12381),g=d(66866),S=d(49276),n=d(83935),s=d(89711),i=d(22231),l=d(46328),w=d(88854),b=d(52970),r=d(29986);function e(A){return A.sort((h,T)=>h[0]<T[0]?1:h[0]>T[0]?-1:!h[1]&&T[1]?1:h[1]&&!T[1]?-1:0),A}G(e,"sortPriorityColorTerms");const a=["g","gi"],p=["filter_test"];function C(A){const h=[];for(let T=0;T<A.length;T++){const R=A[T];R[0].length&&R[1].push((0,f.addWordSeparators)(R[0].join("|"))),h.push(R[1].length?new RegExp(R[1].join("|"),a[T]||"gi"):null)}return h}G(C,"formatTerms");const y="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",z=/[ .,!]/,$=["gif emotes","gif emoticons","gifs"],m=class m extends I.default{constructor(...h){super(...h),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.inject(u.ZP),this.inject(g.ZP),this.inject(S.ZP),this.inject(r.Z),this.inject("overrides",n.Z),this._link_info={},this.clickToReveal=this.clickToReveal.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this),this.handleMentionClick=this.handleMentionClick.bind(this),this.handleReplyClick=this.handleReplyClick.bind(this),this.style=new D.ManagedStyle,this.context=this.settings.context({}),this.CommandPrefixes=new f.SourcedSet(!0),this.CommandPrefixes.set("ffz",["/","!"]),this.rooms={},this.users={},this.room_ids={},this.user_ids={},this.tokenizers={},this.__tokenizers=[],this.rich_providers={},this.__rich_providers=[],this.link_providers={},this.__link_providers=[],this._hl_reasons={},this.addHighlightReason("mention","Mentioned","Mention"),this.addHighlightReason("user","Highlight User","User"),this.addHighlightReason("badge","Highlight Badge","Badge"),this.addHighlightReason("term","Highlight Term","Term"),this.settings.add("debug.link-resolver.source",{process:(P,O)=>B.LINK_DATA_HOSTS[O]??B.LINK_DATA_HOSTS.Production,default:null,ui:{path:"Debugging > Data Sources >> Links",title:"Link Resolver",component:"setting-select-box",force_seen:!0,data:[{value:null,title:"Automatic"}].concat(Object.entries(B.LINK_DATA_HOSTS).map(P=>({value:P[0],title:P[1].title})))},changed:()=>this.clearLinkCache()}),this.settings.addUI("debug.link-resolver.test",{path:"Debugging > Data Sources >> Links",component:"link-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.timestamp-size",{default:null,ui:{path:"Chat > Appearance >> General",title:"Timestamp Font Size",description:"How large should timestamps be, in pixels. Defaults to Font Size if not set.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-size",{default:13,ui:{path:"Chat > Appearance >> General",title:"Font Size",description:"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-family",{default:"",ui:{path:"Chat > Appearance >> General",title:"Font Family",description:"Set the font used for displaying chat messages.",component:"setting-combo-box",data:()=>(0,v.R7)()}}),this.settings.add("chat.name-format",{default:0,ui:{path:"Chat > Appearance >> Usernames",title:"Display Style",description:"Change how usernames are displayed in chat when users have an international display name set.",component:"setting-select-box",data:[{value:0,title:"International Name (Username) <Default>"},{value:1,title:"International Name"},{value:2,title:"Username"}]}}),this.settings.add("chat.lines.emote-alignment",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Emote Alignment",description:"Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.",component:"setting-select-box",data:[{value:0,title:"Standard"},{value:1,title:"Padded"},{value:2,title:"Baseline (BTTV-Like)"}]}}),this.settings.add("chat.rich.enabled",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content in chat.",description:"This displays rich content blocks for things like linked clips and videos.",component:"setting-check-box"}}),this.settings.add("chat.rich.want-mid",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display larger rich content in chat.",description:`This enables the use of bigger rich content embeds in chat. This is **not** recommended for most users and/or chats.

**Note:** Enabling this may cause chat to scroll at inopportune times due to content loading. Moderators should not use this feature.`,component:"setting-check-box"}}),this.settings.add("chat.rich.hide-tokens",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Hide matching links for rich content.",component:"setting-check-box"}}),this.settings.add("chat.rich.all-links",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content embeds for all links.",description:"*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*",component:"setting-check-box",extra:{component:"chat-rich-example",getChat:()=>this}}}),this.settings.add("chat.rich.minimum-level",{default:0,ui:{path:"Chat > Appearance >> Rich Content",title:"Required User Level",description:"Only display rich content embeds on messages posted by users with this level or higher.",component:"setting-select-box",data:[{value:4,title:"Broadcaster"},{value:3,title:"Moderator"},{value:2,title:"VIP"},{value:1,title:"Subscriber"},{value:0,title:"Everyone"}]}}),this.settings.add("chat.scrollback-length",{default:150,ui:{path:"Chat > Behavior >> General",title:"Scrollback Length",description:"Keep up to this many lines in chat. Setting this too high will create lag.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.filtering.debug",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Display a list of highlight reasons on every chat message for debugging.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("chat.filtering.pad-bottom",{path:"Chat > Filtering > Highlight",sort:1e3,component:"setting-spacer",top:"30rem",force_seen:!0}),this.settings.add("chat.filtering.click-to-reveal",{default:!1,ui:{path:'Chat > Filtering > General @{"sort":-1} >> Behavior',title:"Click to reveal deleted terms.",component:"setting-check-box"}}),this.settings.add("chat.filtering.deleted-style",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Detailed Message Style",description:"This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.",component:"setting-select-box",data:[{value:0,title:"Faded"},{value:1,title:"Faded, Line Through"},{value:2,title:"Line Through"},{value:3,title:"No Change"}]}}),this.settings.add("chat.filtering.display-deleted",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",sort:-1,title:"Rendering Mode",description:"This, when set, overrides the `Deleted Messages` mode selected in Twitch chat settings, which is normally only accessible for moderators. Brief hides messages entirely and shows a notice in chat that a number of messages were hidden. Detailed shows the contents of the message. Legacy shows `<message deleted>` with click to reveal.",component:"setting-select-box",data:[{value:!1,title:"Do Not Override"},{value:"BRIEF",title:"Brief"},{value:"DETAILED",title:"Detailed"},{value:"LEGACY",title:"Legacy"}]}}),this.settings.add("chat.filtering.display-mod-action",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Display Reason",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"In Detailed Mode"},{value:2,title:"Always"}]}}),this.settings.add("chat.automod.delete-messages",{default:!0,ui:{path:'Chat > Filtering > General >> AutoMod Filters @{"description": "Extra configuration for Twitch\'s native `Chat Filters`."}',title:"Mark messages as deleted if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.remove-messages",{default:!0,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Remove messages entirely if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.run-as-mod",{default:!1,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Use Chat Filters as a moderator.",description:"By default, Twitch's Chat Filters feature does not function for moderators. This overrides that behavior.",component:"setting-check-box"}}),this.settings.add("chat.filtering.process-own",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Filter your own messages.",component:"setting-check-box"}}),this.settings.add("chat.filtering.ignore-clear",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Do not Clear Chat when commanded to.",component:"setting-check-box"}}),this.settings.add("chat.filtering.remove-deleted",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Remove deleted messages from chat.",description:"Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.",component:"setting-select-box",data:[{value:0,title:"Do Not Remove"},{value:1,title:"Remove Unseen (Default)"},{value:2,title:"Remove Unseen as Moderator"},{value:3,title:"Remove All"}]}}),this.settings.add("chat.delay",{default:-1,ui:{path:"Chat > Behavior >> General",title:"Artificial Chat Delay",description:"Delay the appearance of chat messages to allow for moderation before you see them.",component:"setting-select-box",data:[{value:-1,title:"Default Delay (Room Specific; Non-Mod Only)"},{value:0,title:"No Delay"},{value:300,title:"Minor (Bot Moderation; 0.3s)"},{value:1200,title:"Normal (Human Moderation; 1.2s)"},{value:5e3,title:"Large (Spoiler Removal / Slow Mods; 5s)"},{value:1e4,title:"Extra Large (10s)"},{value:15e3,title:"Extremely Large (15s)"},{value:2e4,title:"Mods Asleep; Delay Chat (20s)"},{value:3e4,title:"Half a Minute (30s)"},{value:6e4,title:"Why??? (1m)"},{value:7884e8,title:"The CBenni Option (Literally 25 Years)"}]}}),this.settings.add("chat.filtering.hidden-tokens",{default:[],type:"array_merge",always_inherit:!0,process(P,O){const M=new Set;for(const j of O)(j?.v||!p.includes(j.v))&&M.add(j.v);return M},ui:{path:'Chat > Appearance >> Hidden Token Types @{"description":"This filter allows you to prevent specific content token types from appearing chat messages, such as hiding all cheers or emotes."}',component:"blocked-types",getExtraTerms:()=>Object.keys(this.tokenizers).filter(P=>!p.includes(P)&&this.tokenizers[P]?.render),data:()=>Object.keys(this.tokenizers).filter(P=>!p.includes(P)&&this.tokenizers[P]?.render).sort()}}),this.settings.add("chat.filtering.highlight-basic-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight @{"description": "These settings allow you to highlight messages in chat based on their contents. Setting priorities on rules allows you to determine which highlight color should be applied if a message matches multiple rules. Rules with a higher priority take priority over rules with lower priorities.\\n\\nYou can also create a rule that removes highlights from messages, preventing lower priority rules from highlighting them, by setting a color with an alpha value of zero. Example: `#00000000`"} >> Users',component:"basic-terms",colored:!0,words:!1,priority:!0}}),this.settings.add("__filter:highlight-users",{requires:["chat.filtering.highlight-basic-users"],equals:"requirements",process(P){const O=P.get("chat.filtering.highlight-basic-users");if(!O||!O.length)return null;const M=new Map;for(const Y of O){const ee=Y.p||0,X=Y.t;let Q=Y.c||null,te=Y.v;if(X==="glob"?te=(0,f.glob_to_regex)(te):X!=="raw"&&(te=(0,f.escape_regex)(te)),!te||!te.length)continue;try{new RegExp(te)}catch{continue}let ne=M.get(ee);if(ne||(ne=new Map,M.set(ee,ne)),Q){const fe=U.Color.RGBA.fromCSS(Q);(!fe||!fe.a)&&(Q=!1)}ne.has(Q)?ne.get(Q).push(te):ne.set(Q,[te])}const j=[];for(const[Y,ee]of M)for(const[X,Q]of ee)j.push([Y,X,new RegExp(`^(?:${Q.join("|")})$`,"gi")]);return e(j)}}),this.settings.add("chat.filtering.highlight-basic-users-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Block >> Users",component:"basic-terms",removable:!0,words:!1}}),this.settings.add("__filter:block-users",{requires:["chat.filtering.highlight-basic-users-blocked"],equals:"requirements",process(P){const O=P.get("chat.filtering.highlight-basic-users-blocked");if(!O||!O.length)return null;const M=[[],[]];for(const j of O){const Y=j.t;let ee=j.v;Y==="glob"?ee=(0,f.glob_to_regex)(ee):Y!=="raw"&&(ee=(0,f.escape_regex)(ee)),!(!ee||!ee.length)&&M[j.remove?1:0].push(ee)}return M.map(j=>j.length?new RegExp(`^(?:${j.join("|")})$`,"i"):null)}}),this.settings.add("chat.filtering.highlight-basic-badges",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Highlight >> Badges",component:"badge-highlighting",colored:!0,priority:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:highlight-badges",{requires:["chat.filtering.highlight-basic-badges"],equals:"requirements",process(P){const O=P.get("chat.filtering.highlight-basic-badges");if(!O||!O.length)return null;const M=new Map;for(const j of O){let Y=j.c||null;const ee=j.p||0,X=j.v;if(Y){const te=U.Color.RGBA.fromCSS(Y);(!te||!te.a)&&(Y=!1)}const Q=M.get(X);(!Q||Q[0]<ee||Y&&!Q[1]&&Q[0]<=ee)&&M.set(X,[ee,Y])}return M}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Badges @{"description": "**Note:** This section is for filtering messages out of chat from users with specific badges. If you wish to hide a badge, go to [Chat > Badges >> Visibility](~chat.badges.tabs.visibility)."}',component:"badge-highlighting",removable:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:block-badges",{requires:["chat.filtering.highlight-basic-badges-blocked"],equals:"requirements",process(P){const O=P.get("chat.filtering.highlight-basic-badges-blocked");if(!O||!O.length)return null;const M=[[],[]];for(const j of O)j.v&&M[j.remove?1:0].push(j.v);return!M[0].length&&!M[1].length?null:M}}),this.settings.add("chat.filtering.highlight-basic-terms",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",colored:!0,priority:!0,highlight:!0}}),this.settings.add("__filter:highlight-terms",{requires:["chat.filtering.highlight-tokens","chat.filtering.highlight-basic-terms"],equals:"requirements",process(P){const O=P.get("chat.filtering.highlight-tokens"),M=P.get("chat.filtering.highlight-basic-terms");if(!M||!M.length)return null;const j=new Map;let Y=!1,ee=!1;for(const Q of M){const te=Q.p||0,ne=O&&((0,f.has)(Q,"h")?Q.h:!0),fe=Q.s,re=Q.t,ue=(0,f.has)(Q,"w")?Q.w:re!=="raw";let me=Q.c||null,we=Q.v;if(re==="glob"?we=(0,f.glob_to_regex)(we):re!=="regex"&&re!=="raw"&&(we=(0,f.escape_regex)(we)),!we||!we.length)continue;try{new RegExp(we)}catch{continue}ne?Y=!0:ee=!0;let xe=j.get(te);if(xe||(xe=new Map,j.set(te,xe)),me){const Pe=U.Color.RGBA.fromCSS(me);(!Pe||!Pe.a)&&(me=!1)}let Te=xe.get(me);Te||xe.set(me,Te=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]]),Te[ne?0:1][fe?0:1][ue?0:1].push(we)}if(!Y&&!ee)return null;const X={hl:Y?[]:null,non:ee?[]:null};for(const[Q,te]of j)for(const[ne,fe]of te){const re=C(fe[0]),ue=C(fe[1]);(re[0]||re[1])&&X.hl.push([Q,ne,re]),(ue[0]||ue[1])&&X.non.push([Q,ne,ue])}return Y&&e(X.hl),ee&&e(X.non),X}}),this.settings.add("chat.filtering.highlight-basic-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",removable:!0}}),this.settings.add("__filter:block-terms",{requires:["chat.filtering.highlight-basic-blocked"],equals:"requirements",process(P){const O=P.get("chat.filtering.highlight-basic-blocked");if(!O||!O.length)return null;const M=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]];let j=!1,Y=!1;for(const ee of O){const X=ee.t,Q=ee.s,te=(0,f.has)(ee,"w")?ee.w:X!=="raw";let ne=ee.v;X==="glob"?ne=(0,f.glob_to_regex)(ne):X!=="regex"&&X!=="raw"&&(ne=(0,f.escape_regex)(ne)),!(!ne||!ne.length)&&(ee.remove?j=!0:Y=!0,M[ee.remove?1:0][Q?0:1][te?0:1].push(ne))}return!j&&!Y?null:{remove:j?C(M[1]):null,non:Y?C(M[0]):null}}}),this.settings.add("chat.filtering.clickable-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Viewer Cards >> Behavior",title:"Enable opening viewer cards by clicking mentions in chat."}}),this.settings.add("chat.filtering.all-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions for all users without requiring an at sign (@).",description:"**Note**: This setting can increase memory usage and impact chat performance."}}),this.settings.add("chat.filtering.color-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with username colors.",description:"**Note:** Not compatible with color overrides as mentions do not include user IDs."}}),this.settings.add("chat.filtering.need-colors",{requires:["chat.filtering.all-mentions","chat.filtering.color-mentions"],process(P){return P.get("chat.filtering.all-mentions")||P.get("chat.filtering.color-mentions")}}),this.settings.add("chat.filtering.bold-mentions",{default:!0,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with a bold font."}}),this.settings.add("chat.filtering.mention-priority",{default:0,ui:{path:"Chat > Filtering > General >> Appearance",title:"Mention Priority",component:"setting-text-box",type:"number",process:"to_int",description:"Mentions of your name have this priority for the purpose of highlighting. See [Chat > Filtering > Highlight](~chat.filtering.highlight) for more details."}}),this.settings.add("chat.filtering.mention-color",{default:"",ui:{path:"Chat > Filtering > General >> Appearance",title:"Custom Highlight Color",component:"setting-color-box",description:"If this is set, highlighted messages with no default color set will use this color rather than red."}}),this.settings.add("chat.filtering.highlight-mentions",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight messages that mention you.",component:"setting-check-box"}}),this.settings.add("chat.filtering.highlight-tokens",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight matched words in chat.",component:"setting-check-box"}}),this.settings.add("tooltip.images",{default:!0,ui:{path:'Chat > Tooltips >> General @{"sort": -1}',title:"Display images in tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.badge-images",{default:!0,requires:["tooltip.images"],process(P,O){return P.get("tooltip.images")?O:!1},ui:{path:"Chat > Tooltips >> Badges",title:"Display large images of badges.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-sources",{default:!0,ui:{path:"Chat > Tooltips >> Emotes",title:"Display known sources.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-images",{default:!0,requires:["tooltip.images"],process(P,O){return P.get("tooltip.images")?O:!1},ui:{path:"Chat > Tooltips >> Emotes",title:"Display large images of emotes.",component:"setting-check-box"}}),this.settings.add("tooltip.rich-links",{default:!0,ui:{sort:-1,path:"Chat > Tooltips >> Links",title:"Display rich tooltips for links.",component:"setting-check-box",extra:{component:"chat-tooltip-example"}}}),this.settings.add("tooltip.link-interaction",{default:!0,ui:{path:"Chat > Tooltips >> Links",title:"Allow interaction with supported link tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.link-images",{default:!0,requires:["tooltip.images"],process(P,O){return P.get("tooltip.images")?O:!1},ui:{path:"Chat > Tooltips >> Links",title:"Display images for links.",component:"setting-check-box"}}),this.settings.add("tooltip.link-nsfw-images",{default:!1,ui:{path:"Chat > Tooltips >> Links",title:"Display potentially NSFW images.",description:"When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.",component:"setting-check-box"}});for(const[P,O]of Object.entries(B.RESOLVERS_REQUIRE_TOS))this.settings.addUI(`tooltip.tos.${P}`,{path:'Chat > Tooltips >> Terms of Service @{"description": "The following services require you to agree to their Terms of Service before we can show you information from their platforms."}',component:"tooltip-tos",item:P,override_setting:"agreed-tos",getChat:()=>this,data:(0,f.deep_copy)(O),onUIChange:()=>this.emit(":update-link-resolver")});this.settings.add("chat.adjustment-mode",{default:null,process(P,O){return O??(P.get("ls.useHighContrastColors")??!0?1:0)},requires:["ls.useHighContrastColors"],ui:{path:"Chat > Appearance >> Colors",title:"Adjustment",description:"Alter user colors to ensure that they remain readable.",default(P){return P.get("ls.useHighContrastColors")??!0?1:0},component:"setting-select-box",data:[{value:-1,title:"No Color"},{value:0,title:"Unchanged"},{value:1,title:"HSL Luma"},{value:2,title:"Luv Luma"},{value:3,title:"HSL Loop (BTTV-Like)"},{value:4,title:"RGB Loop (Deprecated)"}]}}),this.settings.add("chat.adjustment-contrast",{default:4.5,ui:{path:"Chat > Appearance >> Colors",title:"Minimum Contrast",description:"Set the minimum contrast ratio used by Luma adjustments when determining readability.",component:"setting-text-box",process:"to_float"}}),this.settings.add("chat.me-style",{default:2,ui:{path:"Chat > Appearance >> Chat Lines",title:"Action Style",description:"When someone uses `/me`, the message will be rendered in this style.",component:"setting-select-box",data:[{value:0,title:"No Style"},{value:1,title:"Colorized (Old Style)"},{value:2,title:"Italic (New Style)"},{value:3,title:"Colorized Italic"}]}}),this.settings.add("chat.bits.stack",{default:0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Cheer Stacking",description:"Collect all the cheers in a message into a single cheer at the start of the message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Grouped by Type"},{value:2,title:"All in One"}]}}),this.settings.add("chat.emotes.animated",{default:null,requires:["ls.emoteAnimationsEnabled"],process(P,O){return O??(P.get("ls.emoteAnimationsEnabled")??!0?1:0)},ui:{path:"Chat > Appearance >> Emotes",sort:-50,title:"Animated Emotes",default(P){return P.get("ls.emoteAnimationsEnabled")??!0?1:0},getExtraTerms:()=>$,description:"This controls whether or not animated emotes are allowed to play in chat. When this is `Disabled`, emotes will appear as static images. Setting this to `Enable on Hover` may cause performance issues.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enable on Hover"}]}}),this.settings.add("tooltip.emote-images.animated",{requires:["chat.emotes.animated"],default:null,process(P,O){return O==null&&(O=!!P.get("chat.emotes.animated")),O},ui:{path:"Chat > Tooltips >> Emotes",title:"Display animated images of emotes.",getExtraTerms:()=>$,description:"If this is not overridden, animated images are only shown in emote tool-tips if [Chat > Appearance >> Emotes > Animated Emotes](~chat.appearance.emotes) is not disabled.",component:"setting-check-box"}}),this.settings.add("chat.bits.animated",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display animated cheers.",component:"setting-check-box"}});const T=new Date(0).toLocaleTimeString().toUpperCase(),R=T.lastIndexOf("PM")===-1&&T.lastIndexOf("AM")===-1;this.settings.add("chat.timestamp-format",{default:R?"H:mm":"h:mm",ui:{path:"Chat > Appearance >> Chat Lines",title:"Timestamp Format",component:"setting-combo-box",description:"Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)",data:[{value:"h:mm",title:"12 Hour"},{value:"h:mm:ss",title:"12 Hour with Seconds"},{value:"H:mm",title:"24 Hour"},{value:"H:mm:ss",title:"24 Hour with Seconds"},{value:"hh:mm",title:"Padded"},{value:"hh:mm:ss",title:"Padded with Seconds"},{value:"HH:mm",title:"Padded 24 Hour"},{value:"HH:mm:ss",title:"Padded 24 Hour with Seconds"}]}}),this.context.on("changed:theme.is-dark",()=>{for(const P of this.iterateRooms())P.buildBitsCSS()}),this.context.on("changed:chat.bits.animated",()=>{for(const P of this.iterateRooms())P.buildBitsCSS()}),this.context.on("changed:chat.filtering.need-colors",async P=>{P?await this.createColorCache():this.color_cache=null,this.emit(":update-line-tokens")}),this.context.on("changed:chat.filtering.all-mentions",()=>this.emit(":update-line-tokens")),this.context.on("changed:chat.filtering.color-mentions",()=>this.emit(":update-line-tokens"))}async createColorCache(){const h=await d(4866);this.color_cache=new h(150)}generateLog(){const h=["chat settings","-------------------------------------------------------------------------------"];for(const[T,R]of this.context.__cache.entries())h.push(`${T}: ${JSON.stringify(R)}`);return h.join(`
`)}getAddonProxy(h,T,R){if(!h)return this;const P=B.DEBUG||T?.dev,O=(0,f.makeAddonIdChecker)(h),M={},j={},Y=(0,I.buildAddonProxy)(R,null,"getUser()",{addBadge:P?function(X,...Q){return O.test(X)||R.log.warn("[DEV-CHECK] Call to getUser().addBadge() did not include addon ID in provider:",X),this.addBadge(X,...Q)}:void 0,removeBadge:P?function(X,...Q){return O.test(X)||R.log.warn("[DEV-CHECK] Call to getUser().removeBadge() did not include addon ID in provider:",X),this.removeBadge(X,...Q)}:void 0,addSet(X,Q,te){return P&&!O.test(X)&&R.log.warn("[DEV-CHECK] Call to getUser().addSet() did not include addon ID in provider:",X),this.manager.emotes.providers.has(X)||(this.manager.emotes.inferProvider(X,h),P&&R.log.warn("[DEV-CHECK] Call to getUser().addSet() for provider that has not been registered with emotes.setProvider:",X)),te&&(P&&!O.test(Q)&&R.log.warn("[DEV-CHECK] Call to getUser().addSet() loaded set data but did not include addon ID in set ID:",Q),te.__source=h),this.addSet(X,Q,te)},removeAllSets:P?function(X){return O.test(X)||R.log.warn("[DEV-CHECK] Call to getUser().removeAllSets() did not include addon ID in provider:",X),this.removeAllSets(X)}:void 0,removeSet:P?function(X,...Q){return O.test(X)||R.log.warn("[DEV-CHECK] Call to getUser().removeSet() did not include addon ID in provider:",X),this.removeSet(X,...Q)}:void 0},P?{badges:"Please use addBadge(), getBadge(), or removeBadge()",emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",room:!0}:null,!0),ee=(0,I.buildAddonProxy)(R,null,"getRoom()",{getUser(...X){const Q=this.getUser(...X);if(Q)return new Proxy(Q,Y)},addSet(X,Q,te){return P&&!O.test(X)&&R.log.warn("[DEV-CHECK] Call to getRoom().addSet() did not include addon ID in provider:",X),this.manager.emotes.providers.has(X)||(this.manager.emotes.inferProvider(X,h),P&&R.log.warn("[DEV-CHECK] Call to getRoom().addSet() for provider that has not been registered with emotes.setProvider:",X)),te&&(P&&!O.test(Q)&&R.log.warn("[DEV-CHECK] Call to getRoom().addSet() loaded set data but did not include addon ID in set ID:",Q),te.__source=h),this.addSet(X,Q,te)},removeAllSets:P?function(X){return O.test(X)||R.log.warn("[DEV-CHECK] Call to getRoom().removeAllSets() did not include addon ID in provider:",X),this.removeAllSets(X)}:void 0,removeSet:P?function(X,...Q){return O.test(X)||R.log.warn("[DEV-CHECK] Call to getRoom().removeSet() did not include addon ID in provider:",X),this.removeSet(X,...Q)}:void 0},{badges:!0,load_data:!0,emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",refs:"Please use ref() or unref()",style:!0,users:"Please use getUser()",user_ids:"Please use getUser()"},!0);return M.iterateUsers=function*(){for(const X of this.iterateUsers())yield new Proxy(X,Y)},M.iterateRooms=function*(){for(const X of this.iterateRooms())yield new Proxy(X,ee)},M.iterateAllRoomsAndUsers=function*(){for(const X of this.iterateAllRoomsAndUsers())yield new Proxy(X,X instanceof s.Z?ee:Y)},M.addTabCommandPrefix=(X,Q=null)=>(Q==null&&(Q=h),P&&Q!==h&&R.log.warn("[DEV-CHECK] Used addTabCommandPrefix with incorrect provider."),this.addTabCommandPrefix(X,Q)),M.removeTabCommandPrefix=(X,Q=null)=>(Q==null&&(Q=h),P&&Q!==h&&R.log.warn("[DEV-CHECK] Used removeTabCommandPrefix with incorrect provider."),this.removeTabCommandPrefix(X,Q)),M.addTokenizer=X=>(X&&(X.__source=h),this.addTokenizer(X)),M.addLinkProvider=X=>(X&&(X.__source=h),this.addLinkProvider(X)),M.addRichProvider=X=>(X&&(X.__source=h),this.addRichProvider(X)),P&&(M.getUser=(...X)=>{let Q=this.getUser(...X);if(Q)return new Proxy(Q,Y)},M.getRoom=(...X)=>{let Q=this.getRoom(...X);if(Q)return new Proxy(Q,ee)},M.removeTokenizer=X=>{let Q;typeof X=="string"?Q=X:Q=X.type;const te=this.tokenizers[Q];return te&&te.__source!==h&&R.log.warn("[DEV-CHECK] Removed un-owned tokenizer with chat.removeTokenizer:",Q," owner:",te.__source??"ffz"),this.removeTokenizer(X)},M.removeLinkProvider=X=>{let Q;typeof X=="string"?Q=X:Q=X.type;const te=this.link_providers[Q];return te&&te.__source!==h&&R.log.warn("[DEV-CHECK] Removed un-owned link provider with chat.removeLinkProvider:",Q," owner:",te.__source??"ffz"),this.removeLinkProvider(X)},M.removeRichProvider=X=>{let Q;typeof X=="string"?Q=X:Q=X.type;const te=this.link_providers[Q];return te&&te.__source!==h&&R.log.warn("[DEV-CHECK] Removed un-owned rich provider with chat.removeRichProvider:",Q," owner:",te.__source??"ffz"),this.removeRichProvider(X)}),(0,I.buildAddonProxy)(R,this,"chat",M,j)}onEnable(){this.socket=this.resolve("socket"),this.pubsub=this.resolve("pubsub"),this.settings.provider.on("changed",this.onProviderChange,this),this.on("site.subpump:pubsub-message",this.onPubSub,this),this.on("chat.emotes:update-priorities",h=>{for(const T of this.iterateAllRoomsAndUsers())T.emote_sets&&T.emote_sets.setSortFunction(h)}),this.context.get("chat.filtering.need-colors")&&this.createColorCache().then(()=>this.emit(":update-line-tokens"));for(const h in l)(0,f.has)(l,h)&&this.addTokenizer(l[h]);for(const h in w)(0,f.has)(w,h)&&this.addRichProvider(w[h]);for(const h in b)(0,f.has)(b,h)&&this.addLinkProvider(b[h]);this.on("chat:reload-data",h=>{for(const T of this.iterateRooms())T.load_data()}),this.on("chat:get-tab-commands",h=>{h.commands.push({name:"ffz:reload",description:this.i18n.t("chat.command.reload","Reload FFZ and add-on chat data (emotes, badges, etc.)"),permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.triggered_reload=!1,this.on("chat:ffz-command:reload",h=>{if(this.triggered_reload)return;const T=this.resolve("site.chat");T?.addNotice&&T.addNotice("*",this.i18n.t("chat.command.reload.starting","FFZ is reloading data...")),this.triggered_reload=!0,this.emit("chat:reload-data")}),this.on("load_tracker:complete:chat-data",h=>{if(this.triggered_reload){const T=this.resolve("site.chat");T?.addNotice&&T.addNotice("*",this.i18n.t("chat.command.reload.done","FFZ has finished reloading data. (Sources: {list})",{list:h.join(", ")}))}this.triggered_reload=!1}),this.on("addon:fully-unload",h=>{let T=0;for(const[R,P]of Object.entries(this.link_providers))P?.__source===h&&(T++,this.removeLinkProvider(R));for(const[R,P]of Object.entries(this.rich_providers))P?.__source===h&&(T++,this.removeRichProvider(R));for(const[R,P]of Object.entries(this.tokenizers))P?.__source===h&&(T++,this.removeTokenizer(R));this.CommandPrefixes.delete(h);for(const R of this.iterateAllRoomsAndUsers())T+=R._unloadAddon(h)??0;T&&(this.log.debug(`Cleaned up ${T} entries when unloading addon:`,h),this.emit(":update-line-tokens"))})}onPubSub(h){if(h.prefix==="stream-chat-room-v1"&&h.message.type==="chat_rich_embed"){const T=h.message.data,R=T.request_url,P=this.__link_providers;if(this._link_info[R])return;for(const O of P){const M=O.test.call(this,R);if(M){const j=O.receive?O.receive.call(this,M,T):T;let Y=O.process.call(this,M,j);Y instanceof Promise||(Y=Promise.resolve(Y)),Y.then(ee=>{this._link_info[R]||(this._link_info[R]=[!0,Date.now()+12e4,ee])});return}}}}getUser(h,T,R,P,O=!1){let M;if(h&&typeof h=="number"&&(h=`${h}`),h&&this.user_ids[h]?M=this.user_ids[h]:T&&this.users[T]&&!P&&(M=this.users[T]),M&&M.destroyed&&(M=null),!M){if(R)return null;M=new i.Z(this,null,h,T)}if(h&&h!==M.id){if(M.id){if(this.log.warn(`Data mismatch for user #${h} -- Stored ID: ${M.id} -- Login: ${T} -- Stored Login: ${M.login}`),O)throw new Error("id mismatch");this.user_ids[M.id]===M&&(this.user_ids[M.id]=null)}M._id=h,this.user_ids[h]=M}if(T){const j=this.users[T];j?j!==M&&!P&&(j.id?this.users[T]=M:(M.merge(j),j.destroy(!0))):this.users[T]=M}return M}getRoom(h,T,R,P,O=!1){let M;if(h&&typeof h=="number"&&(h=`${h}`),h&&this.room_ids[h]?M=this.room_ids[h]:T&&this.rooms[T]&&!P&&(M=this.rooms[T]),M&&M.destroyed&&(M=null),!M){if(R)return null;M=new s.Z(this,h,T)}if(h&&h!==M.id){if(M.id){if(this.log.warn(`Data mismatch for room #${h} -- Stored ID: ${M.id} -- Login: ${T} -- Stored Login: ${M.login}`),O)throw new Error("id mismatch");this.room_ids[M.id]===M&&(this.room_ids[M.id]=null)}M._id=h,this.room_ids[h]=M}if(T){const j=this.rooms[T];j?j!==M&&!P&&(j.id?this.rooms[T]=M:(M.merge(j),j.destroy(!0))):this.rooms[T]=M}return M}*iterateAllRoomsAndUsers(){for(const h of this.iterateRooms()){yield h;for(const T of h.iterateUsers())yield T}for(const h of this.iterateUsers())yield h}*iterateUsers(){const h=new Set;for(const T of Object.values(this.user_ids))T&&!T.destroyed&&(h.add(T),yield T);for(const T of Object.values(this.users))T&&!T.destroyed&&(yield T)}*iterateRooms(){const h=new Set;for(const T of Object.values(this.room_ids))T&&!T.destroyed&&(h.add(T),yield T);for(const T of Object.values(this.rooms))T&&!T.destroyed&&!h.has(T)&&(yield T)}iterateMessages(h=!0,T=!0,R=!0){const P=[];return this.emit("chat:get-messages",h,T,R,P),this.emit("chat:get-messages-late",h,T,R,P),P}handleLinkClick(h){if(h.ctrlKey||h.shiftKey)return;const T=h.currentTarget,R=T?.dataset;if(!R)return;const P=this.makeEvent({url:R.url??T.href,source:h});if(this.emit("chat:click-link",P),P.defaultPrevented)return h.preventDefault(),h.stopPropagation(),!0}handleReplyClick(h){const T=h.target,R=this.resolve("site.fine");if(!T||!R)return;const P=R.searchParent(T,O=>O.props&&O.props.reply&&O.setOPCardTray);P&&P.setOPCardTray(P.props.reply)}handleMentionClick(h){if(!this.context.get("chat.filtering.clickable-mentions"))return;const T=h.target,R=T&&T.dataset;if(!R||!R.login)return;const P=this.resolve("site.fine");if(!P)return;const O=P.searchParent(T,M=>M.props&&M.props.onUsernameClick);O&&O.props.onUsernameClick(R.login,void 0,void 0,h.currentTarget.getBoundingClientRect().bottom)}clickToReveal(h){const T=h.target;if(T){if(T._ffz_visible)T.textContent="\xD7\xD7\xD7";else if(this.context.get("chat.filtering.click-to-reveal"))T.dataset&&(T.textContent=T.dataset.text);else return;T._ffz_visible=!T._ffz_visible}}standardizeWhisper(h){if(!h)return h;if(h._ffz_message)return h._ffz_message;const T={},R=h.content.startsWith("/me "),P=R?4:0,O=h._ffz_message={id:h.id,user:{...h.from},message:h.content.slice(P),is_action:R,ffz_emotes:T,timestamp:h.sentAt&&h.sentAt.getTime(),deleted:!1};if(O.user.color=O.user.chatColor,Array.isArray(h.emotes)&&h.emotes.length)for(const M of h.emotes){const j=M.emoteID;(T[j]=T[j]||[]).push({startIndex:M.from-P,endIndex:M.to-P})}return O}getUserLevel(h){return!h||!h.user?0:h.user.login===h.roomLogin||h.badges&&h.badges.broadcaster?4:h.badges?h.badges.moderator?3:h.badges.vip?2:h.badges.subscriber?1:0:0}tokenizeReply(h){return h?[{type:"reply",text:h.parentDisplayName,color:this.context.get("chat.filtering.color-mentions")&&this.color_cache?this.color_cache.get(h.parentUserLogin):null,recipient:h.parentUserLogin},{type:"text",text:" "}]:null}applyHighlight(h,T,R,P,O=!1){if(!h)return h;const M=h.mention_priority==null,j=M||T>=h.mention_priority,Y=M||T>h.mention_priority;if(h.filters&&h.filters.push(`${P}(${T})${j&&R===!1?":remove":R?`:${R}`:""}`),j){if(h.mention_priority=T,R===!1){Y&&(h.mentioned=!1,h.clear_priority=T,h.mention_color=h.highlights=null);return}h.mentioned=!0,h.highlights||(h.highlights=new Set)}h.mentioned&&(h.clear_priority==null||T>=h.clear_priority)&&(h.highlights.add(P),(R||O)&&(Y||!h.mention_color)&&(h.mention_color=R))}standardizeMessage(h){if(!h)return h;h.ffz_standardized=!0,h.sender&&!h.user&&(h.user=h.sender),h.from&&!h.user&&(h.user=h.from);let T=h.user;T||(T=h.user={});const R=h.extension||{};if(T.color=T.color||T.chatColor||R.chatColor||null,T.type=T.type||T.userType||null,T.id=T.id||T.userID||null,T.login=T.login||T.userLogin||null,T.displayName=T.displayName||T.userDisplayName||T.login||R.displayName,T.isIntl=T.login&&T.displayName&&T.displayName.trim().toLowerCase()!==T.login,this.color_cache&&T.color&&this.color_cache.set(T.login,T.color),!h.message&&h.messageParts&&this.detokenizeMessage(h),h.content&&!h.message&&(h.content.fragments?this.detokenizeContent(h):h.message=h.content.text),h.ffz_emotes||this.standardizeEmotes(h),!h.badges&&T.displayBadges){const P=h.badges={};for(const O of T.displayBadges)P[O.setID]=O.version}if(!h.badges&&R.displayBadges){const P=h.badges={};for(const O of R.displayBadges)P[O.setID]=O.version}return T.type==null&&h.badges&&h.badges.moderator&&(T.type="mod"),!h.timestamp&&h.sentAt&&(h.timestamp=new Date(h.sentAt).getTime()),h.deletedAt!==void 0&&(h.deleted=!!h.deletedAt),h.ffz_badges=h.sourceRoomID?this.badges.getBadges(T.id,T.login,h.sourceRoomID,null):this.badges.getBadges(T.id,T.login,h.roomID,h.roomLogin),h}standardizeEmotes(h){if(h.emotes&&h.message){const T={},R=(0,f.split_chars)(h.message);let P=0;h.message&&h.messageBody&&h.message!==h.messageBody&&(P=R.length-(0,f.split_chars)(h.messageBody).length);for(const O in h.emotes)if((0,f.has)(h.emotes,O)){const M=h.emotes[O];if(Array.isArray(M))return h.ffz_emotes=h.emotes;const j=T[M.id]=T[M.id]||[];let Y=M.startIndex+1+P;for(;Y<R.length&&!z.test(R[Y]);)Y++;j.push({startIndex:M.startIndex+P,endIndex:Y-1})}h.ffz_emotes=T;return}h.messageParts?this.detokenizeMessage(h,!0):h.content&&h.content.fragments&&this.detokenizeContent(h,!0)}detokenizeContent(h,T=!1){const R=[],P=h.content.fragments,O=P.length,M={};let j=0,Y,ee=!0;for(let X=0;X<O;X++){const Q=P[X],te=Q.content,ne=te&&te.__typename;if(Y=Q.text,ne==="Emote"){const fe=te.emoteID;(M[fe]=M[fe]||[]).push({startIndex:j,endIndex:j+Y.length-1})}Y&&Y.length&&(ee&&Y.startsWith("/me ")&&(h.is_action=!0,Y=Y.slice(4)),j+=(0,f.split_chars)(Y).length,R.push(Y)),ee=!1}return T||(h.message=R.join("")),h.ffz_emotes=M,h}detokenizeMessage(h,T=!1){const R=[],P=h.messageParts,O=P.length,M={};let j=0,Y,ee=null,X=0;for(let Q=0;Q<O;Q++){const te=P[Q],ne=te.ffz_content??te.content;if(ne){if(typeof ne=="string")Y=ne;else if(ne.recipient)Y=`@${ne.recipient}`;else if(ne.url)Y=ne.url;else if(ne.cheerAmount)X+=ne.cheerAmount,Y=`${ne.alt}${ne.cheerAmount}`;else if(ne.images){const fe=ne.images.themed?ne.images.dark:ne.images.sources;let re=ne.emoteID;if(!re){const ue=fe&&(/\/emoticons\/v1\/(\d+)\/[\d.]+$/.exec(fe["1x"])||/\/emoticons\/v2\/(\d+)\//.exec(fe["1x"]));re=ue&&ue[1]}if(Y=ne.alt,re){const ue=M[re]=M[re]||[],me=ee>0?1:0;ue.push({startIndex:j+me,endIndex:j+Y.length-1})}ee>0&&(Y=` ${Y}`)}else continue;Y&&(j+=(0,f.split_chars)(Y).length,ee=te.type,R.push(Y))}}return T||(h.message=R.join("")),h.bits=X,h.ffz_emotes=M,h}formatUser(h,T){const R=this.context.get("chat.name-format"),P=R===2&&h.isIntl?h.login:h.displayName||h.login,O=[T("span",{className:"chat-author__display-name"},P)];return R===0&&h.isIntl&&O.push(T("span",{className:"chat-author__intl-login"},` (${h.login})`)),O}formatTime(h){h instanceof Date||(h=new Date(h));const T=this.context.get("chat.timestamp-format"),R=L()(h);try{return R.locale(this.i18n.locale).format(T)}catch{return R.format(T)}}addHighlightReason(h,T,R){if(typeof h=="object"&&h.key?(T=h,h=T.key):typeof T=="string"&&(T={title:T}),typeof R=="string"&&R.length>0&&(T.label=R),T.value=T.key=h,T.i18n_key||(T.i18n_key=`hl-reason.${h}`),T.label&&!T.i18n_label&&(T.i18n_label=`${T.i18n_key}.label`),this._hl_reasons[h])throw new Error(`Highlight Reason already exists with key ${h}`);this._hl_reasons[h]=T}getHighlightReason(h){return this._hl_reasons[h]??null}getHighlightReasons(){return Object.values(this._hl_reasons)}addTabCommandPrefix(h,T="ffz"){Array.isArray(h)||(h=[h]);for(const R of h){if(typeof R!="string"||R.length!==1)throw new Error("Invalid command prefix. Must be string of length 1.");this.CommandPrefixes.push(T,R)}}removeTabCommandPrefix(h,T="ffz"){Array.isArray(h)||(h=[h]);for(const R of h)this.CommandPrefixes.remove(T,R)}addTokenizer(h){const T=h.type;if((0,f.has)(this.tokenizers,T)){this.log.warn(`Tried adding tokenizer of type '${T}' when one was already present.`);return}if(this.tokenizers[T]=h,h.priority==null&&(h.priority=0),h.tooltip){const R=h.tooltip,P=this.tooltips.types[T]=R.bind(this);for(const O of["interactive","delayShow","delayHide","onShow","onHide"])P[O]=typeof R[O]=="function"?R[O].bind(this):R[O]}this.__tokenizers.push(h),this.__tokenizers.sort((R,P)=>R.priority>P.priority?-1:R.priority<P.priority?1:R.type<P.type)}removeTokenizer(h){let T;if(typeof h=="string"?T=h:T=h.type,h=this.tokenizers[T],!h)return null;delete this.tokenizers[T],h.tooltip&&delete this.tooltips.types[T];const R=this.__tokenizers.indexOf(h);return R!==-1&&this.__tokenizers.splice(R,1),h}addLinkProvider(h){const T=h.type;if((0,f.has)(this.link_providers,T)){this.log.warn(`Tried adding link provider of type '${T}' when one was already present.`);return}this.link_providers[T]=h,h.priority==null&&(h.priority=0),this.__link_providers.push(h),this.__link_providers.sort((R,P)=>R.priority>P.priority?-1:R.priority<P.priority?1:R.type<P.type)}removeLinkProvider(h){let T;if(typeof h=="string"?T=h:T=h.type,h=this.link_providers[T],!h)return null;delete this.link_providers[T];const R=this.__link_providers.indexOf(h);return R!==-1&&this.__link_providers.splice(R,1),h}addRichProvider(h){const T=h.type;if((0,f.has)(this.rich_providers,T)){this.log.warn(`Tried adding rich provider of type '${T}' when one was already present.`);return}this.rich_providers[T]=h,h.priority==null&&(h.priority=0),this.__rich_providers.push(h),this.__rich_providers.sort((R,P)=>R.priority>P.priority?-1:R.priority<P.priority?1:R.type<P.type)}removeRichProvider(h){let T;if(typeof h=="string"?T=h:T=h.type,h=this.rich_providers[T],!h)return null;delete this.rich_providers[T];const R=this.__rich_providers.indexOf(h);return R!==-1&&this.__rich_providers.splice(R,1),h}tokenizeString(h,T,R,P=!1){let O=[{type:"text",text:h}];for(const M of this.__tokenizers){if(!M.process)continue;const j=M.process.call(this,O,T,R,P);if(j&&(O=j),P&&T.ffz_halt_tokens){T.ffz_halt_tokens=void 0;break}}return O}pluckLastEmote(h){if(!Array.isArray(h))return;let T=h.length;for(;T--;){const R=h[T];if(R.type==="emote"&&R.provider!=="emoji")return this.context.get("chat.emotes.allow-gigantify")?(R.gigantify=!0,R.hidden=!0,R):(R.gigantify&&(R.hidden=!1),null);if(R.hidden)continue}}pluckRichContent(h,T){if(!this.context.get("chat.rich.enabled")||this.context.get("chat.rich.minimum-level")>this.getUserLevel(T)||!Array.isArray(h))return;const R=this.__rich_providers,P=this.context.get("chat.rich.want-mid");for(const O of h)if(O.allow_rich??!0){for(const M of R)if(M.test.call(this,O,T))return O.hidden=M.can_hide_token&&(this.context.get("chat.rich.hide-tokens")||M.hide_token),M.process.call(this,O,P)}}tokenizeMessage(h,T,R=!1){if(h.content&&!h.message&&(h.message=h.content.text),h.sender&&!h.user&&(h.user=h.sender),!h.message)return[];let P=[{type:"text",text:h.message}];for(const O of this.__tokenizers){if(!O.process)continue;const M=O.process.call(this,P,h,T,R);if(M&&(P=M),R&&h.ffz_halt_tokens){h.ffz_halt_tokens=void 0;break}}return P||[]}renderGiantEmote(h,T){T||(T=D.createElement);const R=h.anim===1,P=h.anim===2;let O,M,j;if(h.provider==="twitch")O=(0,f.getTwitchEmoteURL)(h.id,4,R,!0),P&&(M=(0,f.getTwitchEmoteURL)(h.id,4,!0,!0)),j=112;else if(h.provider==="ffz"){const Y=this.emotes.emote_sets[h.set],ee=Y?.emotes?.[h.id];if(ee){let X=(R?ee.animated:null)??ee.urls,Q=c(X);if(!Q)return null;O=Q[0],j=ee.height*Q[1],P&&ee.animated&&(Q=c(ee.animated),Q&&(M=Q[0]))}}else O=null;return O?T("img",{className:`chat-image chat-line__message--emote ffz--pointer-events ffz-tooltip${M?" ffz-hover-emote":""}${h.provider==="twitch"?" twitch-emote":h.provider==="ffz"?" ffz-emote":h.provider==="emoji"?" ffz-emoji":""}`,src:O,height:`${j}px`,alt:h.text,"data-normal-src":O,"data-hover-src":M,"data-tooltip-type":"emote","data-provider":h.provider,"data-id":h.id,"data-set":h.set,"data-code":h.code,"data-variant":h.variant,onClick:this.emotes.handleClick}):null}renderTokens(h,T,R){T||(T=D.createElement);const P=[],O=this.tokenizers,M=h.length,j=this.context.get("chat.filtering.hidden-tokens");for(let Y=0;Y<M;Y++){const ee=h[Y],X=ee.type,Q=O[X];if(ee.hidden||j.has(X))continue;let te;R&&Y===0&&X==="mention"&&ee.recipient&&ee.recipient===R.parentUserLogin||(X==="text"?te=T("span",{className:"text-fragment","data-a-target":"chat-message-text"},ee.text):Q?te=Q.render.call(this,ee,T,R):te=T("em",{className:"ffz-unknown-token ffz-tooltip","data-tooltip-type":"json","data-data":JSON.stringify(ee,null,2)},`[unknown token: ${X}]`),te&&P.push(te))}return P}clearLinkCache(h){if(h){const R=this._link_info[h];if(!R[0])for(const P of R[2])P[1]();this._link_info[h]=null,this.emit(":update-link-resolver",h);return}const T=this._link_info;this._link_info={};for(const R of Object.values(T))if(!R[0])for(const P of R[2])P[1]();this.emit(":update-link-resolver")}get_link_info(h,T,R=!1){let P=this._link_info[h];const O=P&&P[1];if((P&&P[0]&&R||O&&Date.now()>O)&&(P=this._link_info[h]=null),P&&P[0]){const M=this.handleLinkToS(P[2]);return T?M:Promise.resolve(M)}return T?null:P?new Promise((M,j)=>P[2].push([M,j])):new Promise((M,j)=>{P=this._link_info[h]=[!1,null,[[M,j]]];const Y=G((X,Q)=>{Q=this.fixLinkInfo(Q);const te=!P[0]&&P[2];if(P[0]=!0,P[1]=Date.now()+12e4,P[2]=X?Q:null,Q=this.handleLinkToS(Q),te)for(const ne of te)ne[X?0:1](Q)},"handle");for(const X of this.__link_providers){const Q=X.test.call(this,h);if(Q){(0,f.timeout)(X.process.call(this,Q),15e3).then(te=>Y(!0,te)).catch(te=>Y(!1,te));return}}let ee=this.settings.get("debug.link-resolver.source").value;ee==="special:socket"&&!this.socket&&(ee=B.LINK_DATA_HOSTS.test.value),ee==="special:socket"?(0,f.timeout)(this.socket.call("get_link",h),15e3).then(X=>Y(!0,X)).catch(X=>Y(!1,X)):(0,f.timeout)(fetch(`${ee}?url=${encodeURIComponent(h)}`).then(X=>X.json()),15e3).then(X=>Y(!0,X)).catch(X=>Y(!1,X))})}handleLinkToS(h){if(!Array.isArray(h?.urls))return h;const T=this.settings.provider.get("agreed-tos",[]),R=this.settings.provider.get("declined-tos",[]),P=new Set(h.urls.map(O=>O.resolver).filter(O=>O));for(const[O,M]of Object.entries(B.RESOLVERS_REQUIRE_TOS))if(P.has(O)&&!T.includes(O)){const j=R.includes(O);return{...h,url:null,short:[{type:"box",content:[M.i18n_key?{type:"i18n",key:M.i18n_key,phrase:M.label}:M.label,j?null:" ",j?null:{type:"conditional",tooltip:!1,content:{type:"i18n",key:"embed.tos-open-settings",phrase:"{link} to open your settings.",content:{link:{type:"open_settings",item:"chat.tooltips",content:{type:"i18n",key:"embed.tos-open-settings.click",phrase:"Click here"}}}},alternative:{type:"i18n",key:"embed.tos-settings",phrase:"Open the FFZ Control Center and navigate to Chat > Tooltips to agree."}}]}],mid:null,full:null}}return h}agreeToTerms(h){const T=this.settings.provider.get("agreed-tos",[]);T.includes(h)||(this.settings.provider.set("agreed-tos",[...T,h]),this.emit(":update-link-resolver"))}declineTerms(h){const T=this.settings.provider.get("declined-tos",[]);T.includes(h)||(this.settings.provider.set("declined-tos",[...T,h]),this.emit(":update-link-resolver"))}hasAgreedToTerms(h){const T=this.settings.provider.get("agreed-tos");return T?T.includes(h):!1}hasDeclinedTerms(h){const T=this.settings.provider.get("declined-tos");return T?T.includes(h):!1}onProviderChange(h,T){h!=="agreed-tos"&&h!=="declined-tos"||this.emit(":update-link-resolver")}fixLinkInfo(h){if(!h)return h;if(h.error&&h.message&&(h.error=h.message),h.error&&(h={v:5,title:this.i18n.t("card.error","An error occurred."),description:h.error,short:{type:"header",image:{type:"image",url:y},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:h.error},unsafe:h.unsafe,urls:h.urls}),h.v<5&&!h.short&&!h.full&&(h.title||h.desc_1||h.desc_2)){const T=h.preview||h.image;h={v:5,short:{type:"header",image:T?{type:"image",url:T,sfw:h.image_safe??!1}:null,title:h.title,subtitle:h.desc_1,extra:h.desc_2}}}return h}};G(m,"Chat");let o=m;function c(A){return A?.[4]?[A[4],4]:A?.[3]?[A[3],3]:A?.[2]?[A[2],2]:A?.[1]?[A[1],1]:null}G(c,"getBiggestImage")},52970:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Clip:()=>g,User:()=>S,Video:()=>n});var W=d(36e3),L=d.n(W),B=d(87590),I=d.n(B);const U=/^(?:https?:\/\/)?clips\.twitch\.tv\/([a-z0-9-_=]+)(?:\/)?(\w+)?(?:\/edit)?/i,D=/^(?:https?:\/\/)?(?:(?:www|m)\.)?twitch\.tv\/\w+\/clip\/([a-z0-9-_=]+)/i,v=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/(?:\w+\/v|videos)\/(\w+)/,f=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/([^/]+)$/,u=["directory","_deck","p","downloads","jobs","turbo","settings","friends","subscriptions","inventory","wallet","store","drops","search","prime"],g={type:"clip",test(s){const i=U.exec(s)||D.exec(s);if(i&&i[1]&&i[1]!=="create")return i[1]},receive(s,i){const l=i?.twitch_metadata?.clip_metadata;if(l)return{id:l.id,slug:l.slug,title:i.title,thumbnailURL:i.thumbnail_url,curator:{id:l.curator_id,displayName:i.author_name},broadcaster:{id:l.broadcaster_id,displayName:l.channel_display_name},game:{displayName:l.game}}},async process(s,i){let l=i;if(!l){const y=this.resolve("site.apollo");if(!y)return null;l=(await y.client.query({query:L(),variables:{slug:s}}))?.data?.clip}if(!l||!l.broadcaster)return null;const w=l.game,b=w&&w.displayName;let r={type:"style",weight:"semibold",color:"alt-2",content:l.broadcaster.displayName};l.broadcaster.login&&(r={type:"link",url:`https://www.twitch.tv/${l.broadcaster.login}`,content:r});const e=b?{type:"i18n",key:"clip.desc.1.playing",phrase:"{user} playing {game}",content:{user:r,game:{type:"style",weight:"semibold",content:b}}}:{type:"i18n",key:"clip.desc.1",phrase:"Clip of {user}",content:{user:r}};let a=l.curator?{type:"style",color:"alt-2",content:l.curator.displayName}:{type:"i18n",key:"clip.unknown",phrase:"Unknown"};l.curator?.login&&(a={type:"link",url:`https://www.twitch.tv/${l.curator.login}`,content:a});let p;return l.viewCount>0?p={type:"i18n",key:"clip.desc.2",phrase:"Clipped by {curator} \u2014 {views, plural, one {# View} other {# Views}}",content:{curator:a,views:l.viewCount}}:p={type:"i18n",key:"clip.desc.no-views",phrase:"Clipped by {curator}",content:{curator:a}},{accent:"#6441a4",fragments:{header:{type:"header",image:{type:"image",url:l.thumbnailURL,sfw:!0,aspect:16/9},title:l.title,subtitle:e,extra:p}},short:{type:"ref",name:"header"},full:[{type:"ref",name:"header"},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"player",iframe:`https://clips.twitch.tv/embed?parent=twitch.tv&clip=${s}`,aspect:16/9,content:{type:"overlay",content:{type:"image",url:l.thumbnailURL,sfw:!0,aspect:16/9},center:{type:"style",size:"2",content:{type:"icon",name:"play"}}}}]}}]}}},S={type:"user",test(s){const i=f.exec(s);if(i&&!u.includes(i[1]))return i[1]},async process(s){const i=this.resolve("site.twitch_data"),l=i?await i.getUser(null,s):null;if(!l||!l.id)return null;const w=l.broadcastSettings?.game?.displayName,b=l.stream?.id,r={avatar:{type:"image",url:l.profileImageURL,rounding:-1,aspect:1},desc:l.description,title:[l.displayName]};b&&w&&(r.game={type:"style",weight:"semibold",content:w}),l.displayName.trim().toLowerCase()!==l.login&&r.title.push({type:"style",color:"alt-2",content:[" (",l.login,")"]}),l.roles?.isPartner&&r.title.push({type:"style",color:"link",content:{type:"icon",name:"verified"}});const e=[{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"}},{type:"box","mg-y":"small",wrap:"pre-wrap",lines:5,content:{type:"ref",name:"desc"}}];if(b&&w){const a=l.stream.previewImageURL?l.stream.previewImageURL.replace("{width}","320").replace("{height}","180"):null;e.push({type:"link",url:`https://www.twitch.tv/${l.login}`,embed:!0,interactive:!0,tooltip:!1,content:[{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"image",url:a,aspect:16/9}]}},{type:"box","mg-y":"small",lines:2,content:l.broadcastSettings.title},{type:"ref",name:"game"}]})}return e.push({type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch"]}),{v:5,accent:l.primaryColorHex?`#${l.primaryColorHex}`:null,fragments:r,short:{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"desc"},extra:b?{type:"i18n",key:"cards.user.streaming",phrase:"streaming {game}",content:{game:{type:"ref",name:"game"}}}:null},full:e}}},n={type:"video",test(s){const i=v.exec(s);if(i)return i[1]},async process(s){const i=this.resolve("site.apollo");if(!i)return null;const l=await i.client.query({query:I(),variables:{id:s}});if(!l||!l.data||!l.data.video||!l.data.video.owner)return null;const w=l.data.video,b=w.game,r=b&&b.displayName,e={title:w.title,thumbnail:{type:"image",url:w.previewThumbnailURL,aspect:16/9}},a={type:"link",url:`https://www.twitch.tv/${w.owner.login}`,content:{type:"style",weight:"semibold",color:"alt-2",content:w.owner.displayName}};e.subtitle=w.game?.displayName?{type:"i18n",key:"video.desc.1.playing",phrase:"Video of {user} playing {game}",content:{user:a,game:{type:"style",weight:"semibold",content:w.game.displayName}}}:{type:"i18n",key:"video.desc.1",phrase:"Video of {user}",content:{user:a}};let p=w.lengthSeconds;return{v:5,fragments:e,short:{type:"header",image:{type:"ref",name:"thumbnail"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"},extra:{type:"i18n",key:"video.desc.2",phrase:"{length,duration} \u2014 {views,number} Views \u2014 {date,datetime}",content:{length:p,views:w.viewCount,date:w.publishedAt}}},full:[{type:"header",image:{type:"image",url:w.owner.profileImageURL,rounding:-1,aspect:1},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"}},{type:"box","mg-y":"small",lines:5,wrap:"pre-wrap",content:w.description},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"overlay",content:{type:"ref",name:"thumbnail"},"top-left":{type:"format",format:"duration",value:p},"bottom-left":{type:"i18n",key:"video.views",phrase:"{views,number} views",content:{views:w.viewCount}}}]}},{type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch \u2022 ",{type:"format",format:"datetime",value:w.publishedAt}]}]}}}},88854:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Links:()=>W});const W={type:"link",can_hide_token:!0,priority:-10,test(L){if(L.type!=="link")return!1;const B=L.url;for(const I of this.__link_providers)if(I.test.call(this,B))return!0;return this.context.get("chat.rich.all-links")||L.force_rich},process(L,B){return{card_tooltip:!0,url:L.url,timeout:0,want_mid:B,getData:async(I=!1)=>{let U;try{U=await this.get_link_info(L.url,!1,I)}catch(D){return{url:L.url,error:String(D)}}return U?{...U,allow_media:this.context.get("tooltip.link-images"),allow_unsafe:this.context.get("tooltip.link-nsfw-images")}:{url:L.url}}}}}},89711:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>u});var W=d(22231),L=d(24431),B=d(44589),I=d(46949),U=d(12381),D=Object.defineProperty,v=G((S,n,s)=>n in S?D(S,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):S[n]=s,"__defNormalProp"),f=G((S,n,s)=>(v(S,typeof n!="symbol"?n+"":n,s),s),"__publicField");const g=class g{constructor(n,s,i){f(this,0),this._destroy_timer=null,this.refs=new Set,this.style=new B.ManagedStyle(`room--${i}`),this.emote_sets=null,this.badges=null,this.users={},this.user_ids={},this.shared_chats=new Set,this.manager=n,this._id=s,this.login=i,s&&(this.manager.room_ids[s]=this),s&&this.manager.pubsub&&this.manager.pubsub.subscribe(this,`twitch/${s}`),this.manager.emit(":room-add",this),this.load_data()}destroy(){if(clearTimeout(this._destroy_timer),this._destroy_timer=null,this.destroyed=!0,this.manager.emit(":room-remove",this),this.users)for(const n of Object.values(this.users))n&&n.destroy();if(this.user_ids)for(const n of Object.values(this.user_ids))n&&n.destroy();if(this.shared_chats=null,this.refs=null,this.users=null,this.user_ids=null,this.style&&(this.style.destroy(),this.style=null),this.emote_sets){for(const n of this.emote_sets._cache)this.manager.emotes.unrefSet(n);this.emote_sets=null}this._login&&(this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null),this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._id&&this.manager.pubsub&&this.manager.pubsub.unsubscribe(this,`twitch/${this._id}`),this.manager.room_ids[this._id]===this&&(this.manager.room_ids[this._id]=null)}merge(n){if(!this.login&&n.login&&(this.login=n.login),n.refs)for(const i of n.refs)this.ref(i);if(n.shared_chats)for(const i of n.shared_chats)this.shareChat(i);if(n.emote_sets&&n.emote_sets._sources)for(const[i,l]of n.emote_sets._sources.entries())for(const w of l)this.addSet(i,w);n.data&&!this.data&&(this.data=n.data,this.data.css?this.style.set("css",this.data.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS()),n.badges&&!this.badges&&(this.badges=n.badges,this.buildBadgeCSS()),n.bitsConfig&&!this.bitsConfig&&(this.bitsConfig=n.bitsConfig,this.buildBitsCSS());const s=new Set;if(n.users)for(const i of Object.values(n.users))!i.destroyed&&!s.has(i)&&(this.getUser(i.id,i.login).merge(i),s.add(i));if(n.user_ids)for(const i of Object.values(n.user_ids))!i.destroyed&&!s.has(i)&&(this.getUser(i.id,i.login).merge(i),s.add(i))}shareChat(n){this.shared_chats.add(n)}shareChats(n){this.shared_chats=new Set(n||[])}unshareChat(n){n?this.shared_chats.delete(n):this.shared_chats.clear()}_unloadAddon(n){return 0}get id(){return this._id}get login(){return this._login}set login(n){if(this._login===n||(this._login&&this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null,this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._login=n,!n))return;const s=this.manager.rooms[n];s&&s!==this&&(s.login=null),this._login=n,this.manager.rooms[n]=this,this.manager.socket&&this.manager.socket.subscribe(this,`room.${n}`),this.manager.emit(":room-update-login",this,n)}*iterateUsers(){const n=new Set;for(const s of Object.values(this.user_ids))s&&!s.destroyed&&(n.add(s),yield s);for(const s of Object.values(this.users))s&&!s.destroyed&&(yield s)}getUser(n,s,i,l,w=!1){if(this.destroyed)return null;let b;if(n&&typeof n=="number"&&(n=`${n}`),n&&this.user_ids[n]?b=this.user_ids[n]:s&&this.users[s]&&!l&&(b=this.users[s]),b&&b.destroyed&&(b=null),!b){if(i)return null;b=new W.Z(this.manager,this,n,s)}if(n&&n!==b.id){if(b.id){if(this.manager.log.warn(`Data mismatch for user #${n} -- Stored ID: ${b.id} -- Login: ${s} -- Stored Login: ${b.login}`),w)throw new Error("id mismatch");this.user_ids[b.id]===b&&(this.user_ids[b.id]=null)}b._id=n,this.user_ids[n]=b}if(s){const r=this.users[s];r?r!==b&&!l&&(r.id?this.users[s]=b:(b.merge(r),r.destroy())):this.users[s]=b}return b}async load_data(n=0){if(this.destroyed)return;const s=`ffz-room-${this.id?`id:${this.id}`:this.login}`;if(this.manager.load_tracker.schedule("chat-data",s),this.manager.experiments.getAssignment("api_load"))try{fetch(`${L.NEW_API}/v1/room/${this.id?`id/${this.id}`:this.login}`).catch(()=>{})}catch{}let i,l;try{i=await fetch(`${this.manager.staging.api}/v1/room/${this.id?`id/${this.id}`:this.login}`)}catch(a){return n++,n<10?setTimeout(()=>this.load_data(n),500*n):(this.manager.log.error(`Error loading room data for ${this.id}:${this.login}`,a),this.manager.load_tracker.notify("chat-data",s,!1),!1)}if(!i.ok)return this.manager.load_tracker.notify("chat-data",s,!1),!1;try{l=await i.json()}catch(a){return this.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`,a),this.manager.load_tracker.notify("chat-data",s,!1),!1}const w=this.data?.user_badge_ids;if(w){for(const a in w)if((0,I.has)(w,a))for(const p of w[a])this.getUser(p,void 0).removeBadge("ffz",a)}const b=l.room,r=`${b.twitch_id}`;if(!this._id)this._id=r,this.manager.room_ids[r]=this;else if(this._id!==r)return this.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${r}`),this.manager.load_tracker.notify("chat-data",s,!1),!1;if(this.login?this.login!==b.id&&this.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got "${b.id}" from FFZ's API.`):this.login=b.id,this.data=b,this.removeAllSets("ffz-main"),b.set&&this.addSet("ffz-main",b.set),l.sets)for(const a in l.sets)(0,I.has)(l.sets,a)&&this.manager.emotes.loadSetData(a,l.sets[a]);const e=b.user_badge_ids;if(e){for(const a in e)if((0,I.has)(e,a))for(const p of e[a])this.getUser(p,void 0).addBadge("ffz",a)}return b.css?this.style.set("css",b.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS(),this.manager.load_tracker.notify("chat-data",s),!0}addSet(n,s,i){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new I.SourcedSet(!1,this.manager.emotes.sourceSortFn)),typeof s=="number"&&(s=`${s}`);let l=!1,w=!1;return this.emote_sets.sourceIncludes(n,s)||(l=!this.emote_sets.includes(s),this.emote_sets.push(n,s),w=!0),i&&this.manager.emotes.loadSetData(s,i),l&&(this.manager.emotes.refSet(s),this.manager.emotes.emit(":update-room-sets",this,n,s,!0)),w}removeAllSets(n){if(this.destroyed||!this.emote_sets)return!1;const s=this.emote_sets.get(n);if(!Array.isArray(s)||!s.length)return!1;for(const i of s)this.removeSet(n,i);return!0}removeSet(n,s){if(!(this.destroyed||!this.emote_sets))return typeof s=="number"&&(s=`${s}`),this.emote_sets.sourceIncludes(n,s)?(this.emote_sets.remove(n,s),this.emote_sets.includes(s)||(this.manager.emotes.unrefSet(s),this.manager.emotes.emit(":update-room-sets",this,n,s,!1)),!0):!1}ref(n){if(!this.refs)throw new Error("Attempting to use destroyed Room");clearTimeout(this._destroy_timer),this._destroy_timer=null,this.refs.add(n)}unref(n){this.refs&&(this.refs.delete(n),!this.refs.size&&!this._destroy_timer&&(this._destroy_timer=setTimeout(()=>this.destroy(),5e3)))}badgeCount(){return this.badge_count||0}updateBadges(n){if(this.badge_count=0,n instanceof Map){const s={};for(const[i,l]of n.entries()){const w=s[i]=s[i]||{__cat:(0,U.iV)(i)};for(const[b,r]of l.entries())w[b]=(0,U.QC)(r),this.badge_count++}this.badges=s}else if(!Array.isArray(n))this.badges=n;else{const s={};for(const i of n){const l=i.setID,w=s[l]=s[l]||{__cat:(0,U.iV)(l)};w[i.version]=(0,U.QC)(i),this.badge_count++}this.badges=s}this.buildBadgeCSS()}buildVIPBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.vip_badge||!this.manager.context.get("chat.badges.custom-vip"))return this.style.delete("vip-badge");const n=this.data.vip_badge,s=`url("${n[1]}")`;let i;(n[2]||n[4])&&(i=`${L.WEBKIT_CSS}image-set(${s} 1x${n[2]?`, url("${n[2]}") 2x`:""}${n[4]?`, url("${n[4]}") 4x`:""})`),this.style.set("vip-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="vip"] {
			background-color: transparent;
			background-image: ${s};
			${i?`background-image: ${i};`:""}
			${L.WEBKIT_CSS}mask-image: unset;
		}`)}buildModBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.mod_urls||!this.manager.context.get("chat.badges.custom-mod"))return this.style.delete("mod-badge");const n=this.manager.context.get("chat.badges.style"),s=n>5?`${L.WEBKIT_CSS}mask`:"background";if(!(n!==3&&n!==4))return this.style.delete("mod-badge");const l=this.data.mod_urls,w=`url("${l[1]}")`;let b;(l[2]||l[4])&&(b=`${L.WEBKIT_CSS}image-set(${w} 1x${l[2]?`, url("${l[2]}") 2x`:""}${l[4]?`, url("${l[4]}") 4x`:""})`),this.style.set("mod-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="moderator"] {
			${s}-image: ${w};
			${b?`${s}-image: ${b};`:""}
		}`)}buildBadgeCSS(){if(this.destroyed)return;if(!this.badges)return this.style.delete("badges");const n=L.IS_FIREFOX&&this.manager.context.get("chat.badges.media-queries"),s=this.manager.context.get("chat.badges.clickable"),i=[],l=this.id;for(const w in this.badges)if((0,I.has)(this.badges,w)){const b=this.badges[w];for(const r in b)if((0,I.has)(b,r)){const e=b[r],a=`[data-room-id="${l}"] .ffz-badge[data-badge="${w}"][data-version="${r}"]`;i.push(`${a} {
			${s&&(e.click_action||e.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${L.WEBKIT_CSS}mask-image: none;
			height: 1.8rem;
			width: 1.8rem;
			background-size: 1.8rem;
			background-image: url("${e.image1x}");
			background-image: ${L.WEBKIT_CSS}image-set(
				url("${e.image1x}") 1x,
				url("${e.image2x}") 2x,
				url("${e.image4x}") 4x
			);
		}`),n&&(i.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${a} {
								background-image: url("${e.image2x}");
							}}`),i.push(`@media (min-resolution: 200dpi) { ${a} {
								background-image: url("${e.image4x}");
							}}`))}}this.style.set("badges",i.join(`
`))}updateBitsConfig(n,s){if(!s&&this.bitsConfig&&n){const i=new Set(Object.keys(this.bitsConfig)),l=new Set(Object.keys(n));if((0,I.set_equals)(i,l))return}this.bitsConfig=n,this.buildBitsCSS()}buildBitsCSS(){if(this.destroyed)return;if(!this.bitsConfig)return this.style.delete("bits");const n=this.manager.context.get("chat.bits.animated")?"animated":"static",s=this.manager.context.get("theme.is-dark")?"dark":"light",i=this.manager.context.get("theme.tooltips-dark")?"dark":"light",l=[];for(const w in this.bitsConfig)if((0,I.has)(this.bitsConfig,w)){const b=this.bitsConfig[w],r=b.prefix.toLowerCase(),e=b.tiers,a=e.length;for(let p=0;p<a;p++){const C=e[p].images[s][n],y=e[p].images[i][n];l.push(`.ffz-cheer[data-prefix="${r}"][data-tier="${p}"] {
	color: ${e[p].color||"inherit"};
	background-image: url("${C[1]}");
	background-image: ${L.WEBKIT_CSS}image-set(
		url("${C[1]}") 1x,
		url("${C[2]}") 2x,
		url("${C[4]}") 4x
	);
}
.ffz__tooltip .ffz-cheer[data-prefix="${r}"][data-tier="${p}"] {
	background-image: url("${y[1]}");
	background-image: ${L.WEBKIT_CSS}image-set(
		url("${y[1]}") 1x,
		url("${y[2]}") 2x,
		url("${y[4]}") 4x
	);
}
.ffz-cheer-preview[data-prefix="${r}"][data-tier="${p}"] {
	background-image: url("${y[4]}");
}`)}}this.style.set("bits",l.join(`
`))}};G(g,"Room");let u=g},46328:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{AddonEmotes:()=>h,AutomoddedTerms:()=>c,BadgeStuff:()=>C,BlockedTerms:()=>$,BlockedUsers:()=>a,CheerEmotes:()=>m,CustomHighlights:()=>y,Emoji:()=>T,FilterTester:()=>s,Links:()=>l,Mentions:()=>r,Replies:()=>w,TwitchEmotes:()=>R,UserHighlights:()=>e});var W=d(44589),L=d(46949),B=d(8528),I=d(24431),U=d(49276),D=d(66866);const v=D.z8.ShrinkX,f=D.z8.Slide,u=D.z8.GrowX,g="chat-image chat-line__message--emote",S=/(?:(https?:\/\/)?((?:[\w#%\-+=:~]+\.)+[a-z]{2,10}(?:\/[\w./#%&@()\-+=:?~]*[^\s\.!,?])?))/g,n=/^(['"*([{<\\/]*)(@)((?:[^\u0000-\u007F]|[\w-])+)(?:\b|$)/,s={type:"filter_test",priority:1e3,render(P,O){return P.msg.filters?.length?O("div",{class:"ffz-pill tw-mg-l-1"},P.msg.filters.join(", ")):null},process(P,O){if(!(!P||!P.length||!this.context.get("chat.filtering.debug")))return O.filters=[],P.push({type:"filter_test",msg:O}),P}};function i(P){return P==null?null:P==="true"}G(i,"datasetBool");const l={type:"link",priority:50,component:()=>d.e(9442).then(d.bind(d,12868)),render(P,O){return O("a",{class:"ffz-tooltip link-fragment","data-tooltip-type":"link","data-url":P.url,"data-is-mail":P.is_mail,rel:"noopener noreferrer",target:"_blank",href:P.url,onClick:this.handleLinkClick},P.text)},tooltip(P,O){if(!this.context.get("tooltip.rich-links")&&!P.dataset.forceTooltip)return B.NoContent;if(P.dataset.isMail==="true")return[this.i18n.t("tooltip.email-link","E-Mail {address}",{address:P.textContent})];const M=P.dataset.url||P.href,j=i(P.dataset.forceMedia)??this.context.get("tooltip.link-images"),Y=i(P.dataset.forceUnsafe)??this.context.get("tooltip.link-nsfw-images");return Promise.all([Promise.all([d.e(2009),d.e(208)]).then(d.bind(d,30642)),this.get_link_info(M)]).then(([ee,X])=>{if(!X||(X.v||1)>ee.VERSION)return"";const Q={tList:(...re)=>this.i18n.tList(...re),i18n:this.i18n,fragments:X.fragments,i18n_prefix:X.i18n_prefix,tooltip:!0,allow_media:j,allow_unsafe:Y,onload:()=>requestAnimationFrame(()=>O.update())};let te;if(O.element&&(O.element.classList.add("ffz-rich-tip"),O.element.classList.add("tw-align-left")),O.outer&&X.accent&&(O.outer.classList.add("ffz-accent-tip"),O.outer.style.setProperty("--ffz-color-accent",X.accent)),X.full?te=ee.renderTokens(X.full,W.createElement,Q):X.mid?te=ee.renderTokens(X.mid,W.createElement,Q):X.short?te=ee.renderTokens(X.short,W.createElement,Q):te=this.i18n.t("card.empty","No data was returned."),!X.urls)return te;const ne=[];for(let re=0;re<X.urls.length;re++){const ue=X.urls[re];ne.push((0,W.createElement)("tr",null,(0,W.createElement)("td",null,this.i18n.formatNumber(re+1),"."),(0,W.createElement)("td",{class:"tw-c-text-alt-2 tw-pd-x-05 tw-word-break-all"},ue.url),(0,W.createElement)("td",null,ue.flags?ue.flags.map(me=>(0,W.createElement)("span",{class:"ffz-pill"},me.toLowerCase())):null)))}let fe;if(X.unsafe){const re=Array.from(new Set(X.urls.map(ue=>ue.flags).flat())).join(", ");fe=(0,W.createElement)("div",{class:"ffz-i-attention"},this.i18n.tList("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:re.toLowerCase()}))}else X.urls.length>1&&(fe=this.i18n.t("tooltip.link-destination","Destination: {url}",{url:X.urls[X.urls.length-1].url}));return te=(0,W.createElement)("div",null,(0,W.createElement)("div",{class:"ffz--shift-hide"},te,fe?(0,W.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-align-center"},fe,(0,W.createElement)("div",{class:" tw-font-size-8"},this.i18n.t("tooltip.shift-detail","(Shift for Details)"))):null),(0,W.createElement)("div",{class:"ffz--shift-show tw-align-left"},(0,W.createElement)("div",{class:"tw-semibold tw-mg-b-05 tw-align-center"},this.i18n.t("tooltip.link.urls","Visited URLs")),(0,W.createElement)("table",null,ne))),te}).catch(ee=>(console.error(ee),(0,W.sanitize)(this.i18n.t("tooltip.error","An error occurred. ({error})",{error:ee}))))},process(P){if(!P||!P.length)return;const O=[];for(const M of P){if(M.type!=="text"){O.push(M);continue}S.lastIndex=0;const j=M.text;let Y=0,ee;for(;ee=S.exec(j);){const X=ee.index;Y!==X&&O.push({type:"text",text:j.slice(Y,X)});let Q=ee[0];if(Q.endsWith(")")){let te=1,ne=Q.length-1;for(;ne--;){const fe=Q[ne];if(fe===")"?te++:fe==="("&&te--,!te)break}te&&(Q=Q.slice(0,Q.length-1))}O.push({type:"link",url:`${ee[1]?"":"https://"}${Q}`,is_mail:!1,text:Q}),Y=X+Q.length}Y<j.length&&O.push({type:"text",text:j.slice(Y)})}return O}};l.tooltip.interactive=function(P){if(!this.context.get("tooltip.rich-links")||!this.context.get("tooltip.link-interaction")||P.dataset.isMail==="true")return!1;const O=this.get_link_info(P.dataset.url,!0);return O&&O.interactive},l.tooltip.delayHide=function(P){return!this.context.get("tooltip.rich-links")||P.dataset.isMail==="true"?0:64};const w={type:"reply",priority:0,component:()=>null,render(P,O){let M=P.color;if(M){const j=this.resolve("site.chat");M=j?j.colors.process(M):M}return O("strong",{class:`chat-line__message-mention ffz--pointer-events ffz-tooltip ffz--reply-mention ffz-i-threads${P.me?" ffz--mention-me":""}`,style:{color:M},"data-tooltip-type":"reply","data-login":P.recipient,onClick:this.handleReplyClick},P.text)},tooltip(P){const O=this.resolve("site.fine");if(!P||!O)return null;const M=O.searchParent(P,Y=>Y.props&&Y.props.reply&&Y.setOPCardTray),j=M?.props?.reply;return j?[(0,W.createElement)("strong",{},this.i18n.t("chat.reply-to","Replying To:")),`

`,(0,W.createElement)("div",{className:"tw-align-left"},[(0,W.createElement)("strong",{},j.parentDisplayName),": ",j.parentMessageBody])]:null}};function b(P,O,M,j){const Y=M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"),ee=this.context.get("chat.filtering.mention-priority");let X,Q,te=!1;M&&M.login&&!Y&&(X=M.login.toLowerCase(),Q=M.displayName&&M.displayName.toLowerCase(),Q===X&&(Q=null),te=!0);const ne=[];for(const fe of P){if(fe.type!=="text"){ne.push(fe);continue}let re=[];for(const ue of fe.text.split(/ +/)){const me=/^(@?)(\S+?)(?:\b|$)/.exec(ue);if(me){let we=me[2],xe=me[1]==="@",Te=!1;const Pe=we?we.toLowerCase():"",Se=this.color_cache?this.color_cache.get(Pe):null;(Pe===X||Pe===Q)&&(Te=!0),!xe&&!Se&&!Te?re.push(ue):(re.length&&(ne.push({type:"text",text:`${re.join(" ")} `}),re=[]),ne.push({type:"mention",text:me[0],me:Te,color:j?Se:null,recipient:Pe}),Te&&this.applyHighlight(O,ee,null,"mention",!0),re.push(ue.substr(me[0].length)))}else re.push(ue)}(re.length>1||re.length===1&&re[0]!=="")&&ne.push({type:"text",text:re.join(" ")})}return ne}G(b,"mention_processAll");const r={type:"mention",priority:0,component:()=>d.e(9442).then(d.bind(d,30884)),render(P,O){let M=P.color;if(M){const j=this.resolve("site.chat");M=j?j.colors.process(M):M}return O("strong",{class:`chat-line__message-mention${P.me?" ffz--mention-me":""} ffz--pointer-events`,style:{color:M},"data-login":P.recipient,onClick:this.handleMentionClick},P.text)},process(P,O,M){if(!P||!P.length)return;const j=this.context.get("chat.filtering.all-mentions"),Y=this.context.get("chat.filtering.color-mentions");if(j)return b.call(this,P,O,M,Y);const ee=M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"),X=this.context.get("chat.filtering.mention-priority");let Q,te,ne,fe=!1;M&&M.login&&!ee?(te=M.login.toLowerCase(),ne=M.displayName&&M.displayName.toLowerCase(),ne===te&&(ne=null),fe=!0,Q=new RegExp(`^(['"*([{<\\/]*)(?:(@?)(${M.login.toLowerCase()}${ne?`|${ne}`:""})|@((?:[^\0-\x7F]|[\\w-])+))(?:\\b|$)`,"i")):Q=n;const re=[];for(const ue of P){if(ue.type!=="text"){re.push(ue);continue}let me=[];for(const we of ue.text.split(/ +/)){const xe=Q.exec(we);if(xe){(me.length||xe[1])&&(re.push({type:"text",text:`${me.join(" ")} ${xe[1]||""}`}),me=[]);let Te,Pe=!1,Se=xe[2];xe[4]?(Te=xe[4],Se="@"):(Te=xe[3],Pe=fe);const oe=Te?Te.toLowerCase():"",ie=Y&&this.color_cache?this.color_cache.get(oe):null;re.push({type:"mention",text:`${Se}${Te}`,me:Pe,color:ie,recipient:oe}),Pe&&this.applyHighlight(O,X,null,"mention",!0),me.push(we.substr(xe[0].length))}else me.push(we)}(me.length>1||me.length===1&&me[0]!=="")&&re.push({type:"text",text:me.join(" ")})}return re}},e={type:"user_highlight",priority:90,process(P,O,M){if(M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const j=this.context.get("__filter:highlight-users");if(!j||!j.length)return;const Y=O.user;for(const[ee,X,Q]of j)(Q.test(Y.login)||Q.test(Y.displayName))&&this.applyHighlight(O,ee,X,"user")}},a={type:"user_block",priority:100,process(P,O,M,j){if(M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const Y=O.user,ee=this.context.get("__filter:block-users");ee&&(ee[1]&&(ee[1].test(Y.login)||ee[1].test(Y.displayName))?(O.deleted=!0,O.ffz_removed=!0,j&&(O.ffz_halt_tokens=!0)):!O.deleted&&ee[0]&&(ee[0].test(Y.login)||ee[0].test(Y.displayName))&&(O.deleted=!0))}};function p(P){let O=P.badges?Object.keys(P.badges):null;if(!P.ffz_badges)return O;O||(O=[]);for(const M of P.ffz_badges)M?.id&&O.push(M.id);return O}G(p,"getBadgeIDs");const C={type:"badge_stuff",priority:97,process(P,O,M,j){if(M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const Y=this.context.get("__filter:highlight-badges"),ee=this.context.get("__filter:block-badges");if(!Y&&!ee)return;const X=p(O);if(!(!X||!X.length))for(const Q of X){if(ee&&ee[1].includes(Q)){O.deleted=!0,O.ffz_removed=!0,j&&(O.ffz_halt_tokens=!0);return}if(ee&&!O.deleted&&ee[0].includes(Q)&&(O.deleted=!0),Y&&Y.has(Q)){const te=Y.get(Q);Array.isArray(te)&&te.length>1&&this.applyHighlight(O,te[0],te[1],"badge")}}}},y={type:"highlight",priority:35,component:()=>d.e(9442).then(d.bind(d,27778)),render(P,O){return O("strong",{class:"ffz--highlight"},P.text)},process(P,O,M){if(!P||!P.length||M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const j=this.context.get("__filter:highlight-terms");if(!j)return;let Y=!1;if(j.non)for(const[ee,X,Q]of j.non){if(Y&&O.mention_priority!=null&&O.mention_priority>ee)break;let te=!1;Q[0]&&(Q[0].lastIndex=0,te=Q[0].test(O.message)),!te&&Q[1]&&(Q[1].lastIndex=0,te=Q[1].test(O.message)),te&&(Y=!0,this.applyHighlight(O,ee,X,"term"))}if(!j.hl)return P;for(const[ee,X,Q]of j.hl){const te=[];for(const ne of P){if(ne.type!=="text"){te.push(ne);continue}const fe=ne.text;let re=0,ue;for(;re<fe.length;){Q[0]&&(Q[0].lastIndex=re),Q[1]&&(Q[1].lastIndex=re),ue=Q[0]?Q[0].exec(fe):null;const me=Q[1]?Q[1].exec(fe):null;if(me&&(!ue||ue.index>me.index)&&(ue=me),!ue)break;const we=ue.index,xe=ue[1]?ue[1].length:0,Te=we+xe;re!==Te&&te.push({type:"text",text:fe.slice(re,Te)}),this.applyHighlight(O,ee,X,"term"),te.push({type:"highlight",text:ue[0].slice(xe)}),re=we+ue[0].length}re<fe.length&&te.push({type:"text",text:fe.slice(re)})}P=te}return P}};function z(P,O,M,j,Y){const ee=[];for(const X of P){if(X.type!=="text"){ee.push(X);continue}const Q=X.text;let te=0,ne;for(;te<Q.length;){M[0]&&(M[0].lastIndex=te),M[1]&&(M[1].lastIndex=te),ne=M[0]?M[0].exec(Q):null;const fe=M[1]?M[1].exec(Q):null;if(fe&&(!ne||ne.index>fe.index)&&(ne=fe),!ne)break;const re=ne.index,ue=ne[1]?ne[1].length:0,me=re+ue;if(te!==me&&ee.push({type:"text",text:Q.slice(te,me)}),j&&(O.ffz_removed=!0,Y))return P;ee.push({type:"blocked",text:ne[0].slice(ue)}),te=re+ne[0].length}te<Q.length&&ee.push({type:"text",text:Q.slice(te)})}return ee}G(z,"blocked_process");const $={type:"blocked",priority:99,component:()=>d.e(9442).then(d.bind(d,87307)),render(P,O){return O("strong",{"data-text":P.text,"data-tooltip-type":"blocked",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(P){const O=P.dataset;return[(0,W.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.blocked-term","Blocked Term")),O.text]},process(P,O,M,j){if(!P||!P.length||M&&M.login&&M.login==O.user.login&&!this.context.get("chat.filtering.process-own"))return;const Y=this.context.get("__filter:block-terms");if(Y)return Y.remove&&(P=z(P,O,Y.remove,!0,j),j&&O.ffz_removed)?(O.ffz_halt_tokens=!0,P):(Y.non&&(P=z(P,O,Y.non,!1,j)),P)}},o={A:"Hostility",I:"Discrimination",P:"Profanity",S:"Sexually Explicit Language"},c={type:"amterm",priority:95,component:()=>d.e(9442).then(d.bind(d,61669)),render(P,O){return O("strong",{"data-text":P.text,"data-categories":JSON.stringify(P.categories),"data-tooltip-type":"amterm",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(P){const O=P.dataset,M=[];let j;try{j=JSON.parse(O.categories);for(const Y in j)j[Y]&&o[Y]&&M.push(this.i18n.t(`chat.filtering.automod.${Y}`,o[Y]))}catch{M.push("Parse Error")}return[(0,W.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.automod-term","AutoMod Blocked Term")),this.i18n.t("chat.filtering.automod-why","This was flagged as: "),M.join(", ")]},process(P,O,M,j){if(!P||!P.length||!O.flags||!Array.isArray(O.flags.list))return;const Y=O.flags.preferences,ee=O.flags.list.filter(ue=>{if(!ue||ue.startIndex==null||ue.endIndex==null)return!1;const me=ue.categories;if(!me)return!1;for(const we in me)if(me[we]&&Y[we])return!0}),X=ee.length;if(!X)return;const Q=[];let te=0,ne=0;const fe=this.context.get("chat.automod.remove-messages");if(this.context.get("chat.automod.delete-messages")&&(O.deleted=!0),fe){O.ffz_removed=!0,j&&(O.ffz_halt_tokens=!0);return}for(const ue of P){const me=ue.length||ue.text&&(0,L.split_chars)(ue.text).length||0,we=te,xe=te+me;if(ue.type!=="text"){Q.push(ue),te=xe;continue}const Te=(0,L.split_chars)(ue.text);for(;ne<X;){const Pe=ee[ne],Se=Pe.startIndex,oe=Pe.endIndex+1;if(oe<we){ne++;continue}if(Se>xe){Q.push(ue),te=xe;break}Se>te&&Q.push({type:"text",text:Te.slice(te-we,Se-we).join("")});let ie=Se-we;if(ie<0&&(ie=0),Q.push({type:"amterm",categories:Pe.categories,text:Te.slice(ie,oe-we).join("")}),oe>xe){te=xe;break}te=oe,ne++}te<xe&&(we===te?Q.push(ue):Q.push({type:"text",text:Te.slice(te-we).join("")}),te=xe)}return Q}},m={type:"cheer",priority:40,component:()=>d.e(9442).then(d.bind(d,93114)),render(P,O){return O("span",{class:"ffz-cheer ffz-tooltip ffz--pointer-events","data-tooltip-type":"cheer","data-prefix":P.prefix,"data-amount":this.i18n.formatNumber(P.amount),"data-tier":P.tier,"data-individuals":JSON.stringify(P.individuals||null),alt:P.text})},tooltip(P){const O=P.dataset,M=parseInt(O.amount.replace(/,/g,""),10),j=O.prefix,Y=O.tier,ee=O.individuals&&JSON.parse(O.individuals),X=ee&&ee.length,Q=[this.context.get("tooltip.emote-images")&&(0,W.createElement)("div",{class:"preview-image ffz-cheer-preview","data-prefix":j,"data-tier":Y}),this.i18n.t("tooltip.bits","{count,number} Bits",M)];if(X>1){Q.push((0,W.createElement)("br",null)),ee.sort(te=>-te[0]);for(let te=0;te<X&&te<12;te++){const[ne,fe,re]=ee[te];Q.push(this.tokenizers.cheer.render.call(this,{amount:ne,prefix:re,tier:fe},W.createElement))}X>12&&(Q.push((0,W.createElement)("br",null)),Q.push(this.i18n.t("tooltip.bits.more","(and {count, number} more)",X-12)))}return Q},process(P,O){if(!P||!P.length||!O.bits)return;const M=this.getRoom(O.roomID,O.roomLogin,!0),j=M&&M.bitsConfig;if(!j)return;const Y=new RegExp(`^(${Object.keys(j).join("|")})(\\d+)$`,"i"),ee=[],X={},Q=this.context.get("chat.bits.stack");for(const te of P){if(!te||te.type!=="text"){ee.push(te);continue}let ne=[];for(const fe of te.text.split(/ +/)){const re=Y.exec(fe);if(re){const ue=re[1].toLowerCase(),me=j[ue];if(!me){ne.push(fe);continue}const we=parseInt(re[2],10),xe=me.tiers;let Te,Pe;for(let Se=0,oe=xe.length;Se<oe;Se++)if(we>=xe[Se].amount){Te=Se;break}if(ne.length&&(ee.push({type:"text",text:`${ne.join(" ")} `}),ne=[]),ee.push(Pe={type:"cheer",prefix:ue,tier:Te,amount:we,text:re[0]}),Q){let Se=Q===2?"cheer":ue;j[Se]||(Se=ue);const oe=X[Se]=X[Se]||{total:0,individuals:[]};oe.total+=we,oe.individuals.push([we,Te,ue]),Pe.hidden=!0}ne.push("")}else ne.push(fe)}(ne.length>1||ne.length===1&&ne[0]!=="")&&ee.push({type:"text",text:ne.join(" ")})}if(Q){for(const te in X)if((0,L.has)(X,te)){const ne=X[te],fe=j[te],re=fe.tiers;let ue=0;for(let me=re.length;ue<me&&!(ne.total>=re[ue].amount);ue++);ee.unshift({type:"cheer",prefix:te,tier:ue,amount:ne.total,individuals:ne.individuals,length:0})}}return ee}},A=G((P,O,M)=>{const j=P.anim===2,Y=P.big&&P.can_big;let ee,X,Q,te,ne,fe;P.anim===1&&P.animSrc?(ee=Y?P.animSrc2:P.animSrc,X=Y?P.animSrcSet2:P.animSrcSet):(ee=Y?P.src2:P.src,X=Y?P.srcSet2:P.srcSet),j&&P.animSrc&&(ne=ee,fe=X,Q=Y?P.animSrc2:P.animSrc,te=Y?P.animSrcSet2:P.animSrcSet);const re=P.modifiers||[],ue=re.length,me=O("img",{class:`${g} ffz-tooltip${Q?" ffz-hover-emote":""}${P.provider==="twitch"?" twitch-emote":P.provider==="ffz"?" ffz-emote":P.provider==="emoji"?" ffz-emoji":""}`,attrs:{src:I.IS_FIREFOX&&X?.length?void 0:ee,srcSet:X,alt:P.text,height:P.big&&!P.can_big&&P.height?`${P.height*2}px`:void 0,"data-tooltip-type":"emote","data-provider":P.provider,"data-id":P.id,"data-set":P.set,"data-code":P.code,"data-variant":P.variant,"data-normal-src":ne,"data-normal-src-set":fe,"data-hover-src":Q,"data-hover-src-set":te,"data-modifiers":ue?re.map(we=>we.id).join(" "):null,"data-modifier-info":ue?JSON.stringify(re.map(we=>[we.set,we.id])):null}});return ue?O("div",{class:"ffz--inline modified-emote",attrs:{"data-test-selector":"emote-button","data-provider":P.provider,"data-id":P.id,"data-set":P.set,"data-modifiers":ue?re.map(we=>we.id).join(" "):null}},[me,re.map(we=>O("span",{key:we.text},A(we,O,!0)))]):M?me:O("div",{className:"ffz--inline",attrs:{"data-test-selector":"emote-button"}},[me])},"render_emote"),h={type:"emote",priority:10,component:{functional:!0,render(P,{props:O}){return A(O.token,P)}},render(P,O,M){const j=P.anim===2,Y=P.big&&P.can_big;let ee,X,Q,te,ne,fe;P.anim===1&&P.animSrc?(ee=Y?P.animSrc2:P.animSrc,X=Y?P.animSrcSet2:P.animSrcSet):(ee=Y?P.src2:P.src,X=Y?P.srcSet2:P.srcSet),j&&P.animSrc&&(ne=ee,fe=X,Q=Y?P.animSrc2:P.animSrc,te=Y?P.animSrcSet2:P.animSrcSet);let re,ue;const me=P.modifiers||[],we=me.length,xe=P.modifier_flags,Te=P.big&&!P.can_big&&P.height;let Pe=(this.emotes.activeAsBackgroundMask&xe)!==0,Se=(this.emotes.activeNoWideMask&xe)!==0;if(Se||xe||we){if(P.provider==="emoji"){const ie=P.big_emoji?2:1,pe=ie*1.5*(this.context.get("chat.font-size")??13);re={width:pe,height:pe},ue={width:pe,height:pe}}else{const ie=P.big?2:1;re={width:P.width*ie,height:P.height*ie},ue={width:re.width,height:re.height}}for(const ie of me)if(ie.effect_bg&&(Pe=!0),!ie.mod_hidden&&ie.set!=="info"){const pe=ie.big?2:1,ge=ie.width*pe,ve=ie.height*pe;ge>ue.width&&(ue.width=ge),ve>ue.height&&(ue.height=ve)}if(xe&&(this.emotes.ensureEffect(xe),(xe&v)===v&&this.emotes.effects_enabled?.ShrinkX&&(re.width*=.5),(xe&u)===u&&this.emotes.effects_enabled?.GrowX&&(re.width*=2),re.width=Math.min(re.width,P.big?256:128),re.height=Math.min(re.height,P.big?80:40)),Se){const ie=P.big?64:32;if(re.width>ie){const pe=ie/re.width;re.width*=pe,re.height*=pe}}re.width>ue.width&&(ue.width=re.width),re.height>ue.height&&(ue.height=re.height),re.width!==ue.width&&(re.marginLeft=(ue.width-re.width)/2),re.height!==ue.height&&(re.marginTop=(ue.height-re.height)/2),xe&&(xe&f)===f&&(re["--ffz-width"]=`${re.width}px`,re["--ffz-speed-x"]=`${.5*(re.width/(P.big?64:32))}s`)}let oe;return Pe?(re=re||{},re.backgroundImage=`url("${ee}")`,re.backgroundSize="100%",oe=O("div",{class:`${g} ffz--pointer-events ffz-tooltip${Q?" ffz-hover-emote":""}${P.provider==="twitch"?" twitch-emote":P.provider==="ffz"?" ffz-emote":P.provider==="emoji"?" ffz-emoji":""}`,style:re,"data-name":P.text,"data-tooltip-type":"emote","data-provider":P.provider,"data-id":P.id,"data-set":P.set,"data-code":P.code,"data-variant":P.variant,"data-normal-src":ne,"data-normal-src-set":fe,"data-hover-src":Q,"data-hover-src-set":te,"data-modifiers":we?me.map(ie=>ie.id).join(" "):null,"data-modifier-info":we?JSON.stringify(me.map(ie=>[ie.set,ie.id])):null,onClick:this.emotes.handleClick},O("div",{class:"ffz-alt-text"},P.text))):oe=O("img",{class:`${g} ffz--pointer-events ffz-tooltip${Q?" ffz-hover-emote":""}${P.provider==="twitch"?" twitch-emote":P.provider==="ffz"?" ffz-emote":P.provider==="emoji"?" ffz-emoji":""}`,src:I.IS_FIREFOX&&X?.length?void 0:ee,srcSet:X,style:re,height:re?void 0:Te?`${P.height*2}px`:void 0,alt:P.text,"data-tooltip-type":"emote","data-provider":P.provider,"data-id":P.id,"data-set":P.set,"data-code":P.code,"data-variant":P.variant,"data-normal-src":ne,"data-normal-src-set":fe,"data-hover-src":Q,"data-hover-src-set":te,"data-modifiers":we?me.map(ie=>ie.id).join(" "):null,"data-modifier-info":we?JSON.stringify(me.map(ie=>[ie.set,ie.id])):null,onClick:this.emotes.handleClick}),!we&&!P.modifier_flags?M?oe:O("div",{class:"ffz--inline","data-test-selector":"emote-button"},oe):O("div",{class:`ffz--inline ffz--pointer-events modified-emote${re?" scaled-modified-emote":""}`,"data-test-selector":"emote-button","data-provider":P.provider,"data-id":P.id,"data-set":P.set,style:ue,"data-modifiers":we?me.map(ie=>ie.id).join(" "):null,"data-effects":xe||void 0},oe,me.map(ie=>ie.set==="info"||(ie.source_modifier_flags&1)===1&&ie.text?null:O("span",{key:ie.text},this.tokenizers.emote.render.call(this,ie,O,!0))))},async tooltip(P,O){const M=P.dataset,j=M.provider,Y=M.modifierInfo;let ee,X,Q,te,ne,fe,re,ue,me,we=!1;const xe=M.noSource==="true";if(Y&&Y!=="null"&&(fe=JSON.parse(Y).map(([Pe,Se])=>{if(Pe==="info")return(0,W.createElement)("span",{class:"tw-mg-05"},Se?.icon?(0,W.createElement)("img",{class:"ffz__tooltip__mod-icon",src:Se.icon}):null,Se?.icon?` - ${Se?.label}`:Se?.label);const oe=this.emotes.emote_sets[Pe],ie=oe&&(oe.emotes[Se]||oe.disabled_emotes?.[Se]);if(ie)return(0,W.createElement)("span",{class:"tw-mg-05"},this.tokenizers.emote.render.call(this,ie.token,W.createElement),` - ${ie.hidden?"???":ie.name}`)})),j==="twitch"){ue=M.id;const Pe=xe?null:await this.emotes.getTwitchEmoteSet(ue),Se=Pe!=null&&await this.emotes.getTwitchSetChannel(Pe),oe=xe?null:await this.emotes.getTwitchEmoteArtist(ue);if(X=`${(0,L.getTwitchEmoteURL)(M.id,4,!0,!0)}?_=preview`,re="twitch",oe&&(te=oe.displayName||oe.login),Se){const ie=Se.type;ie===I.EmoteTypes.Global?Se.owner?.login?Q=this.i18n.t("tooltip.channel","Channel: {source}",{source:Se.owner.displayName||Se.owner.login}):Q=this.i18n.t("emote.global","Twitch Global"):ie===I.EmoteTypes.BitsTier?(Q=this.i18n.t("emote.bits","Twitch Bits Reward"),Se.owner?.login&&(Q=this.i18n.t("emote.bits-owner",`{source}
Channel: {channel}`,{source:Q,channel:Se.owner.displayName||Se.owner.login}))):ie===I.EmoteTypes.Prime||ie===I.EmoteTypes.Turbo?Q=this.i18n.t("emote.prime","Prime Gaming"):ie===I.EmoteTypes.TwoFactor?Q=this.i18n.t("emote.2fa","Twitch 2FA Emote"):ie===I.EmoteTypes.LimitedTime?Q=this.i18n.t("emote.limited","Limited-Time Only Emote"):ie===I.EmoteTypes.ChannelPoints?Q=this.i18n.t("emote.points","Channel Points Emote"):ie===I.EmoteTypes.Follower&&Se.owner?.login?Q=this.i18n.t("emote.follower","Follower Emote ({source})",{source:Se.owner.displayName||Se.owner.login}):ie===I.EmoteTypes.Subscription&&Se.owner?.login&&(Q=this.i18n.t("tooltip.channel","Channel: {source}",{source:Se.owner.displayName||Se.owner.login}))}}else if(j==="ffz"){const Pe=this.emotes.emote_sets[M.set],Se=Pe&&(Pe.emotes[M.id]||Pe.disabled_emotes?.[M.id]);if(Pe&&(Q=Pe.source_line||`${Pe.source||"FFZ"} ${Pe.title||"Global"}`,re=Pe.source||"ffz"),Se&&(ue=Se.id,Se.artist&&(te=Se.artist.display_name||Se.artist.name),Se.original_name&&Se.original_name!==Se.name&&(me=this.i18n.t("emote.original-name","Name: {name}",{name:Se.original_name})),Se.owner&&(ne=this.i18n.t("emote.owner","By: {owner}",{owner:Se.owner.display_name})),this.context.get("tooltip.emote-images.animated")&&Se.animated?.[1]?Se.animated[4]?X=Se.animated[4]:Se.animated[2]&&(X=Se.animated[2]):Se.urls[4]?X=Se.urls[4]:Se.urls[2]&&(X=Se.urls[2]),M.effects&&Se.modifier&&Se.modifier_flags)){ne=null;const ie=Se.modifier_flags;this.emotes.ensureEffect(ie);const pe=this.emotes.getTargetEmote();let ge={width:(pe.width??28)*2,height:(pe.height??28)*2},ve={width:ge.width,height:ge.height},Fe=(this.emotes.activeAsBackgroundMask&ie)!==0,De=(this.emotes.activeNoWideMask&ie)!==0,Ie=!1;if((ie&v)===v&&this.emotes.effects_enabled?.ShrinkX&&(ge.width*=.5,Ie=!0),(ie&u)===u&&this.emotes.effects_enabled?.GrowX&&(ge.width*=2,Ie=!0),Ie&&(ge.width>512&&(ge.width=512),ge.height>160&&(ge.height=160)),De&&ge.width>64){const ct=64/ge.width;ge.width*=ct,ge.height*=ct}ge.width>ve.width&&(ve.width=ge.width),ge.height>ve.height&&(ve.height=ge.height),ge.width!==ve.width&&(ge.marginLeft=(ve.width-ge.width)/2),ge.height!==ve.height&&(ge.marginTop=(ve.height-ge.height)/2),(ie&f)===f&&(ge["--ffz-width"]=`${ge.width}px`,ge["--ffz-speed-x"]=`${.5*ge.width/64}s`),ge.width=`${ge.width}px`,ge.height=`${ge.height}px`,ve.width=`${ve.width}px`,ve.height=`${ve.height}px`,Fe&&(ge.backgroundImage=`url("${pe.src}")`,ge.backgroundSize="100%"),X=(0,W.createElement)("div",{class:"ffz-effect-tip"},(0,W.createElement)("img",{src:pe.src,srcSet:pe.srcSet,width:(pe.width??28)*2,height:(pe.height??28)*2,onLoad:O.update}),(0,W.createElement)("span",{class:"ffz-i-right-open"}),(0,W.createElement)("div",{class:`ffz--inline ffz--pointer-events modified-emote${ge?" scaled-modified-emote":""}`,style:ve,"data-modifiers":Se.id,"data-effects":ie},Fe?(0,W.createElement)("div",{class:`${g} ffz--pointer-events ffz-tooltip ffz-emote`,style:ge}):(0,W.createElement)("img",{class:`${g} ffz--pointer-events ffz-tooltip ffz-emote`,src:pe.src,srcSet:pe.srcSet,style:ge,height:ge?void 0:`${pe.height*2}px`,onLoad:O.update})))}}else if(j==="emoji"){const Pe=this.emoji.emoji[M.code],Se=this.context.get("chat.emoji.style"),oe=M.variant?Pe.variants[M.variant]:Pe,ie=M.variant?this.emoji.emoji[M.variant]:null;re="emoji",ue=M.code,X=(0,W.createElement)("img",{class:"preview-image ffz-emoji",src:this.emoji.getFullImage(oe.image,Se),srcSet:this.emoji.getFullImageSet(oe.image,Se),onLoad:O.update}),we=!0,ee=`:${Pe.names[0]}:${ie?`:${ie.names[0]}:`:""}`;const pe=Pe.category?this.i18n.t(`emoji.category.${Pe.category.toSnakeCase()}`,U.aA[Pe.category]||Pe.category):null;Q=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:pe})}else return;ee||(ee=M.name||P.alt);const Te=re&&this.emotes.isFavorite(re,ue);return[X&&this.context.get("tooltip.emote-images")&&(typeof X=="string"?(0,W.createElement)("img",{class:"preview-image",src:X,onLoad:O.update}):X),we||xe&&!ne?ee:this.i18n.t("tooltip.emote","Emote: {name}",{name:ee}),!xe&&Q&&this.context.get("tooltip.emote-sources")&&(0,W.createElement)("div",{class:"tw-pd-t-05"},Q),me&&(0,W.createElement)("div",{class:"tw-pd-t-05"},me),ne&&this.context.get("tooltip.emote-sources")&&(0,W.createElement)("div",{class:"tw-pd-t-05"},ne),te&&this.context.get("tooltip.emote-sources")&&(0,W.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("emote.artist","Artist: {artist}",{artist:te})),M.sellout&&(0,W.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05"},M.sellout),fe&&(0,W.createElement)("div",{class:"tw-pd-t-1 tw-pd-b-05"},fe),Te&&(0,W.createElement)("figure",{class:"ffz--favorite ffz-i-star"})]},process(P,O){if(!P||!P.length||this.context.get("chat.emotes.enabled")!==2)return;const M=this.emotes.getEmotes(O.user.id,O.user.login,O.roomID,O.roomLogin);if(!M)return;const j=this.context.get("chat.emotes.2x")>0,Y=this.context.get("chat.emotes.animated"),ee=[];let X=!1,Q=!1,te,ne;const fe=this.emotes.ModifierFlags?.NoSpace;for(const re of P){if(!re)continue;if(re.type!=="text"){re.type==="emote"&&(re.modifiers||(re.modifiers=[],re.modifier_flags=0)),ee.push(re),te=re;continue}let ue=[];for(const me of re.text.split(/ +/))if((0,L.has)(M,me)){if(ne=M[me],ne.modifier&&ne.modifier_prefix)X=!0;else if(ne.modifier&&te&&te.modifiers&&(!ue.length||ue.length===1&&ue[0]==="")){te.modifiers.indexOf(ne.token)===-1&&(ne.modifier_flags&&(te.modifier_flags|=ne.modifier_flags,fe&&(ne.modifier_flags&fe)===fe&&(Q=!0)),te.modifiers.push(Object.assign({big:j,anim:Y},ne.token)));continue}if(ue.length){const xe={type:"text",text:`${ue.join(" ")} `};ee.push(xe),xe.text.trim().length&&(te=xe),ue=[]}const we=Object.assign({modifiers:[],modifier_flags:0,big:j,anim:Y},ne.token);ee.push(we),te=we,ue.push("")}else ue.push(me);if(ue.length>1||ue.length===1&&ue[0]!==""){const me={type:"text",text:ue.join(" ")};ee.push(me)}}if(X){let re,ue=!1,me=ee.length;for(;me--;){const we=ee[me];we.type==="emote"&&!we.mod?(re=we,ue=!1):re&&we.type==="emote"&&we.mod&&we.mod_prefix?(re.modifiers.push(we),we.source_modifier_flags&&(re.modifier_flags|=we.source_modifier_flags,fe&&(we.source_modifier_flags&fe)===fe&&(Q=!0)),ee.splice(me,ue?2:1),ue=!1):re&&!ue&&we.type==="text"&&we.text===" "?ue=!0:(re=null,ue=!1)}}if(Q){let re=!1,ue=ee.length;for(;ue--;){const me=ee[ue];me.type==="emote"&&(me.modifier_flags&fe)===fe?re=!0:(re&&me.type==="text"&&me.text===" "&&ee.splice(ue,1),re=!1)}}return ee}},T={type:"emoji",priority:15,process(P){if(!P||!P.length)return;const O=this.emoji.splitter,M=this.context.get("chat.emotes.2x")>1,j=this.context.get("chat.emoji.replace-joiner")>0,Y=this.context.get("chat.emoji.style");if(Y===0)return;const ee=[];for(const X of P){if(!X)continue;if(X.type!=="text"){ee.push(X);continue}const Q=j?X.text.replace(U.Dk,"\u200D"):X.text;O.lastIndex=0;let te=0,ne;for(;ne=O.exec(Q);){const fe=ne.index,re=this.emoji.chars.get(ne[0]);if(!re)continue;const ue=this.emoji.emoji[re[0]],me=re[1]?ue.variants[re[1]]:ue,we=(0,L.split_chars)(ne[0]).length;te!==fe&&ee.push({type:"text",text:Q.slice(te,fe)}),ee.push({type:"emote",provider:"emoji",code:re[0],variant:re[1],big_emoji:M,src:this.emoji.getFullImage(me.image,Y),srcSet:this.emoji.getFullImageSet(me.image,Y),text:ne[0],length:we,modifiers:[],modifier_flags:0}),te=fe+ne[0].length}te<Q.length&&ee.push({type:"text",text:Q.slice(te)})}return ee}},R={type:"twitch-emote",priority:20,process(P,O){if(!O.ffz_emotes||this.context.get("chat.emotes.enabled")<1)return;const M=O.ffz_emotes,j=this.context.get("chat.emotes.animated"),Y=this.context.get("chat.emotes.2x")>0,ee=this.context.get("chat.fix-bad-emotes"),X=[];for(const re in M)if((0,L.has)(M,re))for(const ue of M[re])X.push([re,ue.startIndex,ue.endIndex+1]);const Q=X.length;if(!Q)return;const te=[];X.sort((re,ue)=>re[1]!==ue[1]?re[1]-ue[1]:ue[0]-re[0]);let ne=0,fe=0;for(const re of P){const ue=re.length||re.text&&(0,L.split_chars)(re.text).length||0,me=ne,we=ne+ue;if(re.type!=="text"){te.push(re),ne=we;continue}const xe=(0,L.split_chars)(re.text);for(;fe<Q;){const[Te,Pe,Se]=X[fe];if(typeof Te=="string"&&(Te.startsWith("__FFZ__")||Te.startsWith("__BTTV__"))){fe++;continue}if(Pe>we||Se>we){me===ne?te.push(re):te.push({type:"text",text:xe.slice(ne-me).join("")}),Pe<we&&Se>we&&fe++,ne=we;break}if(Pe<ne){fe++;continue}Pe>ne&&te.push({type:"text",text:xe.slice(ne-me,Pe-me).join("")});let oe,ie,pe,ge,ve,Fe,De,Ie,Xe=!0;const ct=I.REPLACEMENTS[Te];ct&&ee?(oe=`${I.REPLACEMENT_BASE}${ct}`,ie="",Xe=!1):(oe=(0,L.getTwitchEmoteURL)(Te,1,!1),ie=(0,L.getTwitchEmoteSrcSet)(Te,!1),j>0&&(pe=(0,L.getTwitchEmoteURL)(Te,1,!0),ge=(0,L.getTwitchEmoteSrcSet)(Te,!0)),Y&&(ve=(0,L.getTwitchEmoteURL)(Te,2,!1),Fe=(0,L.getTwitchEmoteSrcSet)(Te,!1,!0,!0),j>0&&(De=(0,L.getTwitchEmoteURL)(Te,2,!0),Ie=(0,L.getTwitchEmoteSrcSet)(Te,!0,!0,!0))));const Oe=I.WEIRD_EMOTE_SIZES[Te],_=Oe?Oe[0]:28,F=Oe?Oe[1]:28;te.push({type:"emote",id:Te,provider:"twitch",src:oe,srcSet:ie,src2:ve,srcSet2:Fe,animSrc:pe,animSrc2:De,animSrcSet:ge,animSrcSet2:Ie,anim:j,big:Y,can_big:Xe,width:_,height:F,text:xe.slice(Pe-me,Se-me).join(""),modifiers:[],modifier_flags:0}),ne=Se,fe++}ne<we&&(me===ne?te.push(re):te.push({type:"text",text:xe.slice(ne-me).join("")}),ne=we)}return te}}},99733:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>g});var W=d(44589),L=d(94417),B=d(46949),I=d(24431),U=d(96883),D=d.n(U),v=d(22527);function f(n){return n==="SUBSCRIPTIONS"?I.EmoteTypes.Subscription:n==="FOLLOWER"?I.EmoteTypes.Follower:n==="GLOBALS"||n==="SMILIES"?I.EmoteTypes.Global:n==="LIMITED_TIME"||n==="MEGA_COMMERCE"?I.EmoteTypes.LimitedTime:n==="BITS_BADGE_TIERS"?I.EmoteTypes.BitsTier:n==="CHANNEL_POINTS"?I.EmoteTypes.ChannelPoints:n==="TWO_FACTOR"?I.EmoteTypes.TwoFactor:n==="PRIME"?I.EmoteTypes.Prime:n==="TURBO"?I.EmoteTypes.Turbo:I.EmoteTypes.Unknown}G(f,"getEmoteTypeFromTwitchType");function u(n){return n==="1000"||n==="prime"?1:n==="2000"?2:n==="3000"?3:1}G(u,"tierToNumber");const S=class S extends v.default{constructor(...s){super(...s),this.should_enable=!0,this.inject("i18n"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.apollo"),this.inject("site.twitch_data"),this.vue=this.resolve("vue"),this.open_cards={},this.last_card=null}onEnable(){this.on("chat.emotes:click",this.handleClick,this)}handleClick(s){this.chat.context.get("chat.emote-dialogs")&&(s.preventDefault(),this.openCard({provider:s.provider,code:s.code,variant:s.variant,name:s.name,set:s.set,id:s.id??`${s.code}::${s.variant}`},s.modifiers,s.source))}async loadVue(){if(this._vue_loaded)return;await this.vue.enable();const s=await d.e(6115).then(d.bind(d,81414));this.vue.component("emote-card",s.default),this._vue_loaded=!0}canReportTwitch(){const s=this.resolve("site"),i=s.getUser(),l=this.resolve("site.web_munch");let w;try{w=l.getModule("user-report")}catch{return!1}return!!w&&!!i?.id&&s?.store?.dispatch}reportTwitchEmote(s,i){const l=this.resolve("site"),w=l.getUser(),b=this.resolve("site.web_munch");let r;try{r=b.getModule("user-report")}catch{return!1}return!w?.id||!l?.store?.dispatch?!1:(l.store.dispatch({type:"core.modal.MODAL_SHOWN",modalComponent:r,modalProps:{reportContext:{contentID:String(s),contentMetadata:{channelID:String(w.id)},contentType:"EMOTE_REPORT",targetUserID:String(i),trackingContext:"emote_card"}}}),!0)}async loadData(s){if(s.provider==="twitch"){const b=this.resolve("site.apollo");if(!b)throw new Error("Unable to load emote data");const r=await b.client.query({query:D(),variables:{emoteID:s.id}});if(!r?.data?.emote)throw new Error("Unable to load emote data");const e=r.data.emote,a=(0,B.getTwitchEmoteURL)(e.id,2,!0,!0),p=`${a} 1x, ${(0,B.getTwitchEmoteURL)(e.id,4,!0,!0)} 2x`;let C,y,z,$=f(e.type),o;try{o=parseInt(e.setID,10)}catch{}if(I.TWITCH_GLOBAL_SETS.includes(o)?$=I.EmoteTypes.Global:I.TWITCH_POINTS_SETS.includes(o)?$=I.EmoteTypes.ChannelPoints:I.TWITCH_PRIME_SETS.includes(o)&&($=I.EmoteTypes.Prime),$===I.EmoteTypes.Subscription){const m=e.owner?.subscriptionProducts;if(Array.isArray(m)){for(const A of m)if(A.emotes.some(h=>h.id===e.id)){z=u(A.tier);break}}C=this.i18n.t("emote-card.sub","Tier {tier} Sub Emote ({source})",{tier:z,source:e.owner?.displayName||e.owner?.login}),y="twitch"}else $===I.EmoteTypes.Follower?(C=this.i18n.t("emote.follower","Follower Emote ({source})",{source:e.owner.displayName||e.owner.login}),y="twitch"):$===I.EmoteTypes.Global?C=this.i18n.t("emote.global","Twitch Global"):$===I.EmoteTypes.LimitedTime?C=this.i18n.t("emote.limited","Limited-Time Only Emote"):$===I.EmoteTypes.BitsTier?(C=this.i18n.t("emote-card.bits","{amount,number} Bits Reward ({source})",{amount:e.bitsBadgeTierSummary?.threshold,source:e.owner.displayName||e.owner.login}),y="twitch"):$===I.EmoteTypes.TwoFactor?C=this.i18n.t("emote.2fa","Twitch 2FA Emote"):$===I.EmoteTypes.ChannelPoints?(C=this.i18n.t("emote.points","Channel Points Emote"),y="twitch"):$===I.EmoteTypes.Prime||$===I.EmoteTypes.Turbo?C=this.i18n.t("emote.prime","Prime Gaming"):C=e.type;const c={id:e.id,fav_source:"twitch",channel_id:e.owner?.id,more:[],body:y,src:a,srcSet:p,name:e.token,source:C,artist:e.artist?e.artist.displayName||e.artist.login:null,artistLink:e.artist?`https://www.twitch.tv/${e.artist.login}`:null};if(e.owner?.id&&(c.channel_title=e.owner.displayName??e.owner.login,c.channel_login=e.owner.login,c.channel_live=!!e.owner.stream?.id,c.channel_followed=!!e.owner?.self?.follower?.followedAt,c.more.push({type:"link",icon:"ffz-i-link-ext",title:"View Channel on TwitchEmotes.com",href:`https://twitchemotes.com/channels/${e.owner.id}`}),this.canReportTwitch()&&c.more.push({type:"report-twitch",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),e.bitsBadgeTierSummary?.threshold)c.unlock_mode="bits",c.unlocked=e.bitsBadgeTierSummary.self?.isUnlocked,c.bits_amount=e.bitsBadgeTierSummary.threshold,c.bits_remain=e.bitsBadgeTierSummary.self?.numberOfBitsUntilUnlock??c.unlock_amount;else if($===I.EmoteTypes.Follower){c.unlock_mode="follow",c.unlocked=!1;const m=c.extra_emotes=[];if(!c.unlocked&&Array.isArray(e.owner?.channel?.localEmoteSets)){for(const A of e.owner.channel.localEmoteSets)if(Array.isArray(A.emotes))for(const h of A.emotes){const T=(0,B.getTwitchEmoteURL)(h.id,1,!0,!0),R=`${T} 1x, ${(0,B.getTwitchEmoteURL)(h.id,2,!0,!0)} 2x`;m.push({id:h.id,name:h.token,src:T,srcSet:R})}}}else if($===I.EmoteTypes.Subscription){c.unlock_mode="subscribe",c.unlocked=!1,c.unlock_tier=z,c.existing_tier=0;const m=e.owner?.self?.subscriptionBenefit;m?.tier&&(c.existing_tier=u(m.tier));const A=c.extra_emotes=[],h=c.existing_tier;if(h>=z)c.unlocked=!0;else if(Array.isArray(e.owner?.subscriptionProducts))for(const T of e.owner.subscriptionProducts){const R=u(T.tier);if(R===z&&(c.channel_product=T.name,T.priceInfo?.price&&T.priceInfo.currency)){const P=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:T.priceInfo.currency});c.product_price=P.format(T.priceInfo.price/100)}if(R>h&&R<=z&&Array.isArray(T.emotes))for(const P of T.emotes){const O=(0,B.getTwitchEmoteURL)(P.id,1,!0,!0),M=`${O} 1x, ${(0,B.getTwitchEmoteURL)(P.id,2,!0,!0)} 2x`;A.push({id:P.id,name:P.token,src:O,srcSet:M})}}}return c}if(s.provider==="emoji"){const b=this.emoji.emoji[s.code],r=this.chat.context.get("chat.emoji.style"),e=s.variant?b.variants[s.variant]:b,a=s.variant?this.emoji.emoji[s.variant]:null,p=b.category?this.i18n.t(`emoji.category.${b.category.toSnakeCase()}`,this.emoji.categories[b.category]||b.category):null;return{id:s.code,fav_source:"emoji",more:[],src:this.emoji.getFullImage(e.image,r),srcSet:this.emoji.getFullImageSet(e.image,r),width:18,height:18,name:`:${b.names[0]}:${a?`:${a.names[0]}:`:""}`,source:this.i18n.t("tooltip.emoji","Emoji - {category}",{category:p})}}if(s.provider!=="ffz")throw new Error("Invalid provider");const i=this.emotes.emote_sets[s.set],l=i?i.emotes?.[s.id]||i.disabled_emotes?.[s.id]:null;if(!l)throw new Error("Unable to load emote data");const w={id:l.id,fav_source:i.source??"ffz",more:[],src:l.animSrc2??l.src2,srcSet:l.animSrcSet2??l.srcSet2,width:l.width,height:l.height,name:l.name,originalName:l.original_name,source:i.source_line||`${i.source||"FFZ"} ${i.title||"Global Emotes"}`,owner:l.owner?l.owner.display_name||l.owner.name:null,ownerLink:l.owner&&!i.source?`https://www.frankerfacez.com/${l.owner.name}`:null,artist:l.artist?l.artist.display_name||l.artist.name:null,artistLink:l.artist&&!i.source?`https://www.frankerfacez.com/${l.artist.name}`:null};return i.source?l.click_url&&w.more.push({type:"link",title_i18n:"emote-card.view-external",title:"View on {source}",source:i.source,href:l.click_url}):(l.public&&(w.body="manage-ffz"),w.more.push({type:"link",title_i18n:"emote-card.view-on-ffz",title:"View on FrankerFaceZ",href:`https://www.frankerfacez.com/emoticon/${l.id}-`}),w.more.push({type:"report-ffz",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),w}async openCard(s,i,l){const w=`${s.provider}::${s.id}::${i??""}`,b=this.open_cards[w];if(b){b.$el.style.zIndex=(0,L.getDialogNextZ)(),b.focus();return}let r=l?l.clientX:window.innerWidth/2,e=l?l.clientY+15:window.innerHeight/2;if(this.last_card){const p=this.last_card;l||(r=p.$el.offsetLeft,e=p.$el.offsetTop),p.close()}const a=this.loadData(s);await this.loadVue(),this.last_card=this.open_cards[w]=this.buildCard(r,e,s,i,a)}buildCard(s,i,l,w,b){let r;const e=new this.vue.Vue({el:(0,W.createElement)("div"),render:C=>C("emote-card",{props:{raw_emote:(0,B.deep_copy)(l),raw_modifiers:w,data:b,getFFZ:()=>this,reportTwitchEmote:(...y)=>this.reportTwitchEmote(...y),getZ:L.getDialogNextZ},on:{emit:(y,...z)=>this.emit(y,...z),close:()=>{e.$el.remove(),e.$destroy(),this.last_card===r&&(this.last_card=null);const z=`${l.provider}::${l.id}::${w??""}`;this.open_cards[z]===r&&(this.open_cards[z]=null),this.emit("tooltips:cleanup")},pin:()=>{this.last_card===r&&(this.last_card=null)}}})});r=e.$children[0];const a=e.$el;return a.style.left=`${s}px`,a.style.top=`${i}px`,document.querySelector(this.site.constructor.DIALOG_SELECTOR??"#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height").appendChild(a),requestAnimationFrame(()=>r.constrain()),r}};G(S,"EmoteCard");let g=S},88082:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>U});var W=d(44589),L=d(94417),B=d(46949),I=d(22527);const D=class D extends I.default{constructor(...f){super(...f),this.should_enable=!0,this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("settings"),this.vue=this.resolve("vue"),this.settings.add("link-cards.enable",{default:!1,ui:{path:"Chat > Link Cards >> General",title:"Enable Link Cards.",description:"When this is enabled and you click a link in chat or whispers, a popup will open with information about the link. This provides the same data as rich link tooltips, but in a form that allows more interaction.",component:"setting-check-box"}}),this.settings.add("link-cards.use-destination",{default:!1,ui:{path:"Chat > Link Cards >> General",title:"Bypass Known Shorteners",description:'When clicking "Open Link" from a Link Card with this enabled, you will bypass known shorteners and tracking services and go directly to the destination URL.',component:"setting-check-box"}}),this.open_cards={},this.last_card=null}onEnable(){this.on("chat:click-link",this.handleClick,this)}handleClick(f){this.settings.get("link-cards.enable")&&(f.preventDefault(),this.openCard(f.url,f.source))}async loadVue(){if(this._vue_loaded)return;await this.vue.enable();const f=await d.e(6115).then(d.bind(d,47792));this.vue.component("link-card",f.default),this.vue.component("lc-url",{functional:!0,props:["url","show-protocol"],render(u,g){let S=g.props.url;S instanceof URL||(S=new URL(S));const n=[];g.props.showProtocol&&n.push(u("span",{class:"tw-c-text-alt-2"},`${S.protocol}//`)),n.push(u("span",S.host));let s=S.toString().slice(S.origin.length);return s.length&&s!=="/"&&n.push(u("span",{class:"tw-c-text-alt-2"},s)),u("span",n)}}),this._vue_loaded=!0}async openCard(f,u){const g=`${f}`,S=this.open_cards[g];if(S){S.$el.style.zIndex=(0,L.getDialogNextZ)(),S.focus();return}let n=u?u.clientX:window.innerWidth/2,s=u?u.clientY+15:window.innerHeight/2;const i=this.chat.get_link_info(f);await this.loadVue(),this.last_card=this.open_cards[g]=this.buildCard(n,s,f,i)}buildCard(f,u,g,S){let n;const s=new this.vue.Vue({el:(0,W.createElement)("div"),render:w=>w("link-card",{props:{url:g,data:S,use_dest:this.settings.get("link-cards.use-destination"),getFFZ:()=>this,getZ:L.getDialogNextZ},on:{emit:(b,...r)=>this.emit(b,...r),close:()=>{s.$el.remove(),s.$destroy(),this.last_card===n&&(this.last_card=null);const r=g;this.open_cards[r]===n&&(this.open_cards[r]=null),this.emit("tooltips:cleanup")},pin:()=>{this.last_card===n&&(this.last_card=null)}}})});n=s.$children[0];const i=s.$el;return i.style.left=`${f}px`,i.style.top=`${u}px`,document.querySelector(this.site.constructor.DIALOG_SELECTOR??"#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height").appendChild(i),requestAnimationFrame(()=>n.constrain()),n}};G(D,"LinkCard");let U=D},5624:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>u});var W=d(22527),L=d(44589),B=d(46949),I=d(94417),U=d(54643),D=d(90334),v=d(68069);function f(S){return typeof S!="string"?S:S.replace(/<[^>]*>/g,"").toLocaleLowerCase()}G(f,"format_term");const g=class g extends W.default{constructor(...n){super(...n),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.Mixin=this.SettingMixin=U.Z,this.ProviderMixin=D.Z,this.exclusive=!1,this.new_seen=!1,this._settings_tree=null,this._settings_count=0,this.dialog=new I.default(()=>this.buildDialog()),this.has_update=!1,this.opened=!1,this.showing=!1,this.context=this.settings.context(),this.settings.addUI("profiles",{path:'Data Management @{"sort": 1000, "profile_warning": false} > Profiles @{"profile_warning": false}',component:"profile-manager"}),this.settings.addUI("backup",{path:'Data Management > Backup and Restore @{"profile_warning": false}',component:"backup-restore",getExtraTerms:()=>["restore"],getFFZ:()=>this.resolve("core")}),this.settings.addUI("clear",{path:'Data Management > Storage @{"profile_warning": false} >> tabs ~> Clear',component:"clear-settings",getExtraTerms:()=>["reset"],force_seen:!0}),this.settings.addUI("provider",{path:"Data Management > Storage >> tabs ~> Provider",component:"provider",getExtraTerms:()=>["storage","local","indexeddb","localstorage"],force_seen:!0}),this.settings.addUI("home",{path:'Home @{"sort": -1000, "profile_warning": false}',component:"home-page",requestPage:s=>this.requestPage(s),getUnseen:()=>{if(!this.unseen?.size)return null;const s={},i=[];let l=0;for(const w of this.unseen){const b=this.settings.definitions.get(w)||this.settings.ui_structures.get(w);if(!b||!b.ui||!b.ui.path_tokens)continue;const r=b.ui.path,e=b.ui.title;if(l++,l>20)break;if(!s[r]){const a=b.ui.path_tokens.map(y=>y.key).join("."),p=[];let C=this._settings_tree[a];for(;C;)p.unshift({i18n:C.i18n_key,title:C.title}),C.parent&&(C.page||C.tab?p.unshift({title:">>"}):p.unshift({title:">"})),C=this._settings_tree[C.parent];i.push(s[r]={key:a,tokens:p,entries:[]})}!r||!e||s[r].entries.push({key:w,i18n:b.ui.i18n_key??`setting.entry.${w}`,title:e})}return i.length?i:null}}),this.settings.addUI("debug.graphql-test",{path:"Debugging > GraphQL >> Inspector",component:"graphql-inspect",getFFZ:()=>this.resolve("core"),force_seen:!0}),this.settings.addUI("faq",{path:'Home > FAQ @{"profile_warning": false}',component:"md-page",key:"faq"}),this.settings.addUI("chat.filtering.syntax-help",{path:'Chat > Filtering > Syntax Help @{"profile_warning": false}',component:"md-page",key:"term-syntax",force_seen:!0}),this.settings.addUI("feedback",{path:'Home > Feedback @{"profile_warning": false}',component:"md-page",key:"feedback"}),this.settings.addUI("feedback.log",{path:'Home > Feedback >> Log @{"sort": 1000}',component:"async-text",watch:["reports.error.include-user","reports.error.include-settings"],data:()=>this.resolve("core").generateLog()}),this.settings.addUI("changelog",{path:'Home > Changelog @{"profile_warning": false}',component:"changelog",getFFZ:()=>this}),this.settings.addUI("addon-changelog",{path:'Add-Ons > Changelog @{"sort": -1000, "profile_warning": false, "hide_children": true}',component:"changelog",force_seen:!0,addons:!0,getFFZ:()=>this}),this.settings.addUI("legal",{path:'Home > Legal @{"sort": 1000}',component:"md-page",key:"legal",force_seen:!0}),this.settings.add("ffz.search.matches-only",{default:!0,ui:{path:"Appearance > Control Center >> Search",title:"Hide items that do not match completely when searching.",component:"setting-check-box"}}),this.on("settings:added-definition",(s,i)=>{this._addDefinitionToTree(s,i),this.scheduleUpdate()}),this.on("settings:removed-definition",s=>{this._removeDefinitionFromTree(s),this.scheduleUpdate()}),this.on("pubsub:command:new_version",s=>{if(s===window.FrankerFaceZ.version_info.commit)return;this.log.info("New Version:",s),this.has_update=!0;const i=this.resolve("site.menu_button");i&&(i.has_update=!0),this._vue&&(this._vue.$children[0].context.has_update=!0)}),this.scheduleUpdate(),this.on(":open",s=>{const i=this.resolve("site.layout"),l=s?.item,w=s?.event;if(i&&i.is_minimal||w&&(w.ctrlKey||w.shiftKey)){!this.openPopout(l)&&s&&(s.errored=!0);return}l&&this.requestPage(l),!this.showing&&this.emit("site.menu_button:clicked")})}openPopout(n){const s=window.open(`https://twitch.tv/popout/frankerfacez/chat?ffz-settings${n?`=${encodeURIComponent(n)}`:""}`,"_blank","resizable=yes,scrollbars=yes,width=850,height=600");return s?(s.focus(),!0):(this.log.warn("Unable to open popout settings window."),!1)}async onLoad(){this.vue.component((await Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,63479))).default)}async onEnable(){await this.site.awaitElement(I.default.EXCLUSIVE),await this.i18n.loadChunk("settings"),this.on("addons:added",this.scheduleUpdate,this),this.on("experiments:enabled",this.scheduleUpdate,this),this.on("i18n:update",this.scheduleUpdate,this),this.dialog.on("show",()=>{this.dialog.maximized&&this.runFix(1),this.showing=!0,this.opened=!0,this.updateButtonUnseen(),this.emit("show")}),this.dialog.on("hide",()=>{this.dialog.maximized&&this.runFix(-1),this.showing=!1,this.emit("hide"),this.destroyDialog()}),this.dialog.on("resize",()=>{this.dialog.visible&&this.runFix(this.dialog.maximized?1:-1),this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)}),this.on("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog),this.dialog.show()}onDisable(){this.dialog.hide(),this.off("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog)}mdNavigate(n){const s=n?.dataset?.settingsLink;s&&(this.requestPage(s),this.showing||this.emit("site.menu_button:clicked"))}updateContext(n){n||(n=this._context),this._context=n,this.use_context?(this.context._updateContext||(this.context._updateContext=this.context.updateContext,this.context.updateContext=function(s){const i={};for(const l of v.eB)(0,B.has)(s,l)&&(i[l]=s[l]);this._updateContext(i)}),this.context._context={},this.context._updateContext({...n,can_proxy:n?.proxied||!1})):(this.context._updateContext&&(this.context.updateContext=this.context._updateContext,this.context._updateContext=null),this.context.setContext({can_proxy:n?.proxied||!1}))}openExclusive(){window.addEventListener("message",n=>{const s=n.data?.ffz_type;s==="context-update"?this.updateContext({...n.data.ctx,proxied:!0}):s==="context-gone"&&(this.log.info("Context proxy gone."),this.updateContext({proxied:!1}))});try{window.opener.postMessage({ffz_type:"request-context"},"*")}catch{this.log.info("Unable to request settings context from opener.")}this.exclusive=!0,this.dialog.exclusive=!0,this.enable().then(()=>this.dialog.show())}runFix(n){this.settings.updateContext({force_chat_fix:(this.settings.get("context.force_chat_fix")||0)+n})}requestPage(n){const s=(0,B.get)("_vue.$children.0",this);s&&s.navigate?s.navigate(n):this._wanted_page=n}getUnseen(){const n=this.getSettingsTree();if(!Array.isArray(n))return 0;let s=0;for(const i of n)i&&(s+=i.unseen||0);return s}buildDialog(){return this._menu?this._menu:(this._vue=new this.vue.Vue({el:(0,L.createElement)("div"),render:n=>n("main-menu",this.getData())}),this._menu=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._menu=this._vue=null}scheduleUpdate(){this._update_timer||(this._update_timer=setTimeout(()=>{this.i18n.enable().then(()=>this.updateLiveMenu())},250))}updateButtonUnseen(){const n=this.resolve("site.menu_button");n&&(n.new_settings=this.opened?0:this.getUnseen())}updateLiveMenu(){if(clearTimeout(this._update_timer),this._update_timer=null,this.updateButtonUnseen(),!this._vue||!this._vue.$children||!this._vue.$children[0])return;const n=this._vue.$children[0],s=n.currentItem,i=s&&s.full_key,l=!n.restoredItem,w=window.history.state,b=this.getSettingsTree();n.nav=b,n.navKeys=b.keys;let r,e=!0;if(this._wanted_page&&(r=b.keys[this._wanted_page]),!r&&l){if(w?.ffzcc&&(r=b.keys[w.ffzcc]),!r){const a=new URL(window.location).searchParams,p=a?.get("ffz-settings");r=p&&b.keys[p]}r||(e=!1)}r||(r=b.keys[i]),r||(r=this.has_update?b.keys["home.changelog"]:b.keys.home),n.currentItem=r,n.restoredItem=e,this._wanted_page=null}rebuildSettingsTree(){this._settings_tree={},this._settings_count=0;for(const[n,s]of this.settings.definitions)this._addDefinitionToTree(n,s);for(const[n,s]of this.settings.ui_structures)this._addDefinitionToTree(n,s)}_removeDefinitionFromTree(n){if(!this._settings_tree)return;let s;for(const i of Object.values(this._settings_tree))if(!(!i||!Array.isArray(i.settings))){for(let l=0;l<i.settings.length;l++){const w=i.settings[l];if(w&&w[0]===n){i.settings.splice(l,1),s=i;break}}if(s)break}s&&this._maybeDeleteSection(s)}_maybeDeleteSection(n){if(n.settings&&n.settings.length)return;const s=n.full_key;for(const i of Object.values(this._settings_tree))if(i.parent===s)return;if(delete this._settings_tree[s],n.parent){const i=this._settings_tree[n.parent];i&&this._maybeDeleteSection(i)}}_addDefinitionToTree(n,s){if(!s.ui||!this._settings_tree)return;if(!s.ui.path_tokens)if(s.ui.path)s.ui.path_tokens=(0,v.lm)(s.ui.path);else return;if(!s.ui||!s.ui.path_tokens||!this._settings_tree)return;const i=this._settings_tree,l=s.ui.path_tokens,w=l.length;let b=null,r;for(let e=0;e<w;e++){const a=l[e],p=b?`${b}.${a.key}`:a.key;r=i[p],r||(r=i[p]={full_key:p,sort:0,parent:b,expanded:b==null,i18n_key:`setting.${p}`,desc_i18n_key:`setting.${p}.description`}),Object.assign(r,a),b=p}r.settings=r.settings||[],r.settings.push([n,s]),this._settings_count++}getSettingsTree(){const n=performance.now();this._settings_tree||this.rebuildSettingsTree();const s=this._settings_tree,i=this.new_seen?null:this.settings.provider.get("cfg-seen"),l=i?new Set:null,w=i?null:[],b=this.settings.provider.get("cfg-collapsed"),r={},e={},a=new Set,p=new Set,C=this.i18n.locale!=="en";w&&(this.new_seen=!0);for(const z in s){if(!(0,B.has)(s,z))continue;const $=e[z]=e[z]||Object.assign({},s[z]),o=$.parent,c=o?e[o]=e[o]||Object.assign({},s[o]):r;if($.parent=o?c:null,$.page=$.page||c.page,b&&($.expanded=!b.includes($.full_key)),$.page&&!$.component&&p.add($),$.settings){const h=$.contents=$.contents||[];for(const[T,R]of $.settings)if(R.ui){const P=R.ui.i18n_key?R.ui.i18n_key:T?`setting.entry.${T}`:R.ui.key?`${$.i18n_key}.${R.ui.key}`:$.i18n_key,O=Object.assign({i18n_key:P,desc_i18n_key:`${P}.description`,sort:0},R.ui,{full_key:`setting:${T}`,setting:T,path_tokens:void 0,parent:$});(0,B.has)(R,"default")&&!(0,B.has)(O,"default")&&(typeof R.default==="object"?O.default=(0,B.deep_copy)(R.default):O.default=R.default);let M=[T];if(O.title&&(M.push(O.i18n_key?this.i18n.t(O.i18n_key,O.title,null,!0):O.title),C&&O.i18n_key&&this.i18n.has(O.i18n_key)&&M.push(this.i18n.t(O.i18n_key,O.title,null))),O.description&&(M.push(O.desc_i18n_key?this.i18n.t(O.desc_i18n_key,O.description,null,!0):O.description),C&&O.desc_i18n_key&&this.i18n.has(O.desc_i18n_key)&&M.push(this.i18n.t(O.desc_i18n_key,O.description,null))),O.getExtraTerms&&(M=M.concat(O.getExtraTerms())),O.search_terms=M.map(f).join(`
`),i){if(!i.includes(T)&&!O.force_seen){l.add(T);let j=O;for(;j;)j.unseen=(j.unseen||0)+1,j=j.parent}}else w&&w.push(T);h.push(O)}$.settings=void 0,h.length>1&&a.add(h)}if(!$.search_terms){const h=$.title&&($.i18n_key?this.i18n.t($.i18n_key,$.title,null,!0):$.title);let T=[$.key];h&&h.localeCompare($.key,void 0,{sensitivity:"base"})&&T.push(h),C&&$.i18n_key&&this.i18n.has($.i18n_key)&&T.push(this.i18n.t($.i18n_key,$.title,null)),$.description&&(T.push($.desc_i18n_key?this.i18n.t($.desc_i18n_key,$.description,null,!0):$.description),C&&$.desc_i18n_key&&this.i18n.has($.desc_i18n_key)&&T.push(this.i18n.t($.desc_i18n_key,$.description,null))),T=T.map(f);for(const P of["tabs","contents","items"])if($[P])for(const O of $[P])O.search_terms&&T.push(O.search_terms);T=$.search_terms=T.join(`
`);let R=c;for(;R&&R.search_terms;)R.search_terms+=`
${T}`,R=R.parent}const m=$.tab?"tabs":$.page?"contents":"items",A=c[m]=c[m]||[];A.push($),A.length>1&&a.add(A)}for(const z of p)z.component=z.tabs?"tab-container":z.contents?"menu-container":"setting-check-box";for(const z of a)z.sort(($,o)=>$.sort<o.sort?-1:$.sort>o.sort?1:$.key&&$.key.localeCompare(o.key));const y=r.items||[];if(y.keys=e,w&&this.settings.provider.set("cfg-seen",w),!b){const z=[];for(const $ of Object.keys(e)){const o=e[$];o&&o.items&&o.parent&&z.push($)}this.settings.provider.set("cfg-collapsed",z)}return(0,B.set_equals)(l,this.unseen)||(this.unseen=l,this.emit(":update-unseen")),this.log.info(`Built Tree in ${(performance.now()-n).toFixed(5)}ms with ${Object.keys(s).length} structure nodes and ${this._settings_count} settings nodes.`),y}getProfiles(n){const s=[],i={};n=n||this.context;for(const l of this.settings.__profiles)s.push(i[l.id]=this.getProfileProxy(l,n));return[s,i]}getProfileProxy(n,s){return{id:n.id,order:s.manager.__profiles.indexOf(n),live:s.__profiles.includes(n),toggled:n.toggled,title:n.name,i18n_key:n.i18n_key,ephemeral:n.ephemeral,description:n.description,desc_i18n_key:n.desc_i18n_key||n.i18n_key&&`${n.i18n_key}.description`,hotkey:n.hotkey,url:n.url,pause_updates:n.pause_updates,move:i=>s.manager.moveProfile(n.id,i),save:()=>n.save(),update:i=>{n.data=(0,B.deep_copy)(i),n.save()},toggle:()=>n.toggled=!n.toggled,getBackup:()=>(0,B.deep_copy)(n.getBackup()),context:(0,B.deep_copy)(n.context),get:i=>n.get(i),set:(i,l)=>n.set(i,l),delete:i=>n.delete(i),has:i=>n.has(i),on:(...i)=>n.on(...i),off:(...i)=>n.off(...i)}}getContext(){const n=this,s=this.vue.Vue,i=this.settings,l=i.provider,w=this.context,[b,r]=this.getProfiles(),e=window.history.state,a=e?.ffzccp;let p=r[0];if(a!=null&&(p=r[a]),!p){for(let y=b.length-1;y>=0;y--)if(b[y].live&&!b[y].ephemeral&&b[y].title&&!/7tv/i.test(b[y].title)){p=b[y];break}p||(p=b[0])}const C={profiles:b,profile_keys:r,currentProfile:p,exclusive:this.exclusive,can_proxy:w._context.can_proxy,proxied:w._context.proxied,has_update:this.has_update,matches_only:i.get("ffz.search.matches-only"),mod_icons:w.get("context.chat.showModIcons"),setProxied:y=>{this.use_context=y,this.updateContext()},createProfile:y=>{const z=i.createProfile(y);return n.getProfileProxy(z,w)},deleteProfile:y=>i.deleteProfile(y),getProcessor:y=>i.getProcessor(y),getValidator:y=>i.getValidator(y),getFFZ:()=>n.resolve("core"),provider:{unwrap:()=>l,get:(...y)=>l.get(...y),set:(...y)=>l.set(...y),delete:(...y)=>l.delete(...y),has:(...y)=>l.has(...y),on:(...y)=>l.on(...y),off:(...y)=>l.off(...y)},context:{_users:0,profiles:w.__profiles.map(y=>y.id),get:y=>w.get(y),uses:y=>w.uses(y),on:(...y)=>w.on(...y),off:(...y)=>w.off(...y),order:y=>w.order.indexOf(y),context:(0,B.deep_copy)(w._context),_update_profiles(y){const z=[],$=w.manager.__profiles;for(let o=0;o<$.length;o++){const c=r[$[o].id];c&&(c.order=o,z.push(c))}s.set(C,"profiles",z),y&&y.id===C.currentProfile.id&&(C.currentProfile=r[y.id])},_profile_created(y){s.set(r,y.id,n.getProfileProxy(y,w)),this._update_profiles()},_profile_changed(y){s.set(r,y.id,n.getProfileProxy(y,w)),this._update_profiles(y)},_profile_toggled(y,z){s.set(r[y.id],"toggled",z),this._update_profiles(y)},_profile_deleted(y){if(s.delete(r,y.id),this._update_profiles(),C.currentProfile.id===y.id&&(C.currentProfile=r[0],!C.currentProfile)){for(let z=C.profiles.length-1;z>=0;z--)if(C.profiles[z].live){C.currentProfile=C.profiles[z];break}C.currentProfile||(C.currentProfile=C.profiles[0])}},_context_changed(){this.context=(0,B.deep_copy)(w.__context);const y=w.manager.__profiles,z=this.profiles=w.__profiles.map($=>$.id);C.proxied=this.context.proxied,C.can_proxy=this.context.can_proxy,C.mod_icons=w.get("context.chat.showModIcons");for(let $=0;$<y.length;$++){const o=y[$].id,c=r[o];c.live=z.includes(o)}},_update_settings(){C.matches_only=i.get("ffz.search.matches-only")},_add_user(){this._users++,this._users===1&&(i.on(":changed:ffz.search.matches-only",this._update_settings,this),i.on(":profile-toggled",this._profile_toggled,this),i.on(":profile-created",this._profile_created,this),i.on(":profile-changed",this._profile_changed,this),i.on(":profile-deleted",this._profile_deleted,this),i.on(":profiles-reordered",this._update_profiles,this),w.on("context_changed",this._context_changed,this),w.on("profiles_changed",this._context_changed,this),this.profiles=w.__profiles.map(y=>y.id))},_remove_user(){this._users--,this._users===0&&(i.off(":changed:ffz.search.matches-only",this._update_settings,this),i.off(":profile-toggled",this._profile_toggled,this),i.off(":profile-created",this._profile_created,this),i.off(":profile-changed",this._profile_changed,this),i.off(":profile-deleted",this._profile_deleted,this),i.off(":profiles-reordered",this._update_profiles,this),w.off("context_changed",this._context_changed,this),w.off("profiles_changed",this._context_changed,this))}}};return C}markSeen(n,s){let i=!0,l=!1;if(s||(i=!1,s=this.settings.provider.get("cfg-seen",[])),Array.isArray(n.contents))for(const w of n.contents)l=w&&this.markSeen(w,s)||l;if(n.setting&&(this.unseen&&this.unseen.delete(n.setting),!s.includes(n.setting))){l=!0,s.push(n.setting);let w=n.parent;for(;w;)w.unseen=(w.unseen||1)-1,w=w.parent}return!i&&l&&(this.settings.provider.set("cfg-seen",s),this.emit(":update-unseen")),l}markAllSeen(n,s){let i=!0;if(s||(i=!1,s=this.settings.provider.get("cfg-seen",[])),Array.isArray(n))for(const l of n)l&&this.markAllSeen(l,s);if(Array.isArray(n.items))for(const l of n.items)this.markAllSeen(l,s);if(Array.isArray(n.contents))for(const l of n.contents)this.markAllSeen(l,s);if(Array.isArray(n.tabs))for(const l of n.tabs)this.markAllSeen(l,s);if(Array.isArray(n.settings))for(const l of n.settings)l&&this.markAllSeen(l[1],s);n.setting&&!s.includes(n.setting)&&s.push(n.setting),n.unseen&&(n.unseen=0),i||(this.settings.provider.set("cfg-seen",s),this.unseen=null,this.emit(":update-unseen"))}getData(){const n=this.getSettingsTree(),s=this.getContext(),i=window.history.state;let l,w=!0;if(this._wanted_page&&(l=n.keys[this._wanted_page]),!l&&i?.ffzcc&&(l=n.keys[i.ffzcc],l||(w=!1)),!l){const e=new URL(window.location).searchParams,a=e?.get("ffz-settings");l=a&&n.keys[a],l||(w=!1)}l||(l=this.has_update?n.keys["home.changelog"]:n.keys.home),this._wanted_page=null,this.markSeen(l);let b=!1;for(const e of n)if(e&&e.unseen){b=!0;break}const r={context:s,query:"",faded:!1,nav:n,currentItem:l,restoredItem:!0,navKeys:n.keys,has_unseen:b,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,markAllSeen:e=>this.markAllSeen(e),markSeen:e=>this.markSeen(e),markExpanded:e=>{const a=this.settings.provider.get("cfg-collapsed",[]),p=a.indexOf(e.full_key);if(e.expanded&&p!==-1)a.splice(p,1);else if(!e.expanded&&p===-1)a.push(e.full_key);else return;this.settings.provider.set("cfg-collapsed",a)},resize:e=>{this.dialog.exclusive||this.site?.router?.current_name==="squad"||this.site?.router?.current_name==="command-center"||this.settings.get("layout.is-theater-mode")||this.dialog.toggleSize(e)},close:e=>!this.dialog.exclusive&&this.dialog.toggleVisible(e),version:window.FrankerFaceZ.version_info};return r.popout=e=>{this.dialog.exclusive||(this.dialog.toggleVisible(e),this.openPopout(r.currentItem?.full_key)||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))},r}};G(g,"MainMenu");let u=g},90334:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(46949);const L={data(){return{value:void 0,has_value:!1,provider_key:this.item.override_setting??this.item.setting,_unseen:!1}},created(){const B=this.context.provider,I=this.provider_key;B.on("changed",this._providerChange,this),this.has_value=B.has(I),this.has_value?this.value=(0,W.deep_copy)(B.get(I)):this.value=this.default_value,this.item.unseen&&(this._unseen=!0,this.item.unseen=0)},destroyed(){this.context.provider.off("changed",this._providerChange,this),this.value=void 0,this.has_value=!1},computed:{data(){const B=this.item.data;return typeof B=="function"?B(this.value):B},unseen(){return this._unseen||this.item.unseen>0},default_value(){return typeof this.item.default=="function"?this.item.default(this.context):(0,W.deep_copy)(this.item.default)},isValid(){return this.isDefault||this.validate(this.value)},isDefault(){return!this.has_value}},methods:{_providerChange(B,I,U){B===this.provider_key&&(U?(this.has_value=!1,this.value=this.default_value):(this.has_value=!0,this.value=(0,W.deep_copy)(I)))},validate(B){let I=this.item.validator;if(!I&&typeof this.item.process=="string"&&(I=this.context.getValidator(`process_${this.item.process}`)),I){if(typeof I!="function"&&(I=this.context.getValidator(I)),typeof I=="function")return I(B,this.item,this);throw new Error(`Invalid Validator for ${this.provider_key}`)}return!0},set(B){const I=this.context.provider,U=this.provider_key;let D=this.item.process;if(D)if(typeof D!="function"&&(D=this.context.getProcessor(D)),typeof D=="function")B=D(B,this.default_value,this.item,this);else throw new Error(`Invalid processor for ${U}`);I.set(U,B),this.has_value=!0,this.value=(0,W.deep_copy)(B),this.item.onUIChange&&this.item.onUIChange(this.value,this)},clear(){const B=this.context.provider,I=this.provider_key;B.delete(I),this.value=this.default_value,this.has_value=!1,this.item.onUIChange&&this.item.onUIChange(this.value,this)}}}},54643:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(46949);const L={data(){return{value:void 0,has_value:!1,profile:null,_unseen:!1,source:null,source_value:void 0}},created(){const B=this.context.context,I=this.item.setting;B._add_user(),this._update_profile(),this._uses_changed(B.uses(I)),this.item.unseen&&(this._unseen=!0,this.item.unseen=0),B.on(`uses_changed:${I}`,this._uses_changed,this)},destroyed(){const B=this.context.context,I=this.item.setting;this.profile&&this.profile.off("changed",this._setting_changed,this),this.source&&this.source.off("changed",this._source_setting_changed,this),B.off(`uses_changed:${I}`,this._uses_changed,this),this.value=void 0,this.has_value=!1,this.profile=null,this.source_value=void 0,this.source=null,B._remove_user()},watch:{"context.currentProfile"(){this._update_profile()}},computed:{data(){const B=this.item.data;return typeof B=="function"?B(this.profile,this.value):B},unseen(){return this._unseen||this.item.unseen>0},default_value(){return typeof this.item.default=="function"?this.item.default(this.context.context):(0,W.deep_copy)(this.item.default)},isInherited(){return!this.has_value&&this.source&&this.sourceOrder>this.profileOrder},isDefault(){return!this.has_value&&!this.source},isOverridden(){return this.source&&this.sourceOrder<this.profileOrder},isValid(){return this.isDefault||this.validate(this.value)},isReadOnly(){return this.profile&&this.profile.ephemeral},sourceOrder(){return this.source?this.source.order:1/0},profileOrder(){return this.profile?this.profile.order:1/0},sourceTitle(){if(this.source)return this.source.i18n_key?this.t(this.source.i18n_key,this.source.title,this.source):this.source.title},sourceDisplay(){const B={title:this.sourceTitle};if(this.isInherited)return this.t("setting.inherited-from","Inherited From: {title}",B);if(this.isOverridden)return this.t("setting.overridden-by","Overridden By: {title}",B)}},methods:{_update_profile(){this.profile&&this.profile.off("changed",this._setting_changed,this);const B=this.profile=this.context.currentProfile,I=this.item.setting;B.on("changed",this._setting_changed,this),this.has_value=B.has(I),this.value=this.has_value?(0,W.deep_copy)(B.get(I)):this.isInherited?this.source_value:this.default_value},_setting_changed(B,I,U){B===this.item.setting&&(this.has_value=U!==!0,this.value=this.has_value?(0,W.deep_copy)(I):this.isInherited?this.source_value:this.default_value)},_source_setting_changed(B,I,U){B===this.item.setting&&(this.source_value=(0,W.deep_copy)(I),this.isInherited&&(this.value=U?this.default_value:I))},_uses_changed(B){this._uses_cb&&clearTimeout(this._uses_cb),this._uses_cb=setTimeout(()=>{this.source&&this.source.off("changed",this._source_setting_changed,this),B=B?B[0]:null;const I=this.source=B==null?null:this.context.profile_keys[B],U=this.item.setting;I?(I.on("changed",this._source_setting_changed,this),this.source_value=(0,W.deep_copy)(I.get(U))):this.source_value=void 0,this.has_value=this.profile&&this.profile.has(this.item.setting),this.has_value||(this.value=this.isInherited?this.source_value:this.default_value)},0)},validate(B){let I=this.item.validator;if(!I&&typeof this.item.process=="string"&&(I=this.context.getValidator(`process_${this.item.process}`)),I){if(typeof I!="function"&&(I=this.context.getValidator(I)),typeof I=="function")return I(B,this.item,this);throw new Error(`Invalid Validator for ${this.item.setting}`)}return!0},set(B){if(this.isReadOnly)return;let I=this.item.process;if(I)if(typeof I!="function"&&(I=this.context.getProcessor(I)),typeof I=="function")B=I(B,this.default_value,this.item,this);else throw new Error(`Invalid processor for ${this.item.setting}`);this.profile.set(this.item.setting,B),this.item.onUIChange&&this.item.onUIChange(B,this)},clear(){this.isReadOnly||(this.profile.delete(this.item.setting),this.item.onUIChange&&this.item.onUIChange(this.value,this))}}}},19745:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>I});var W=d(22527),L=d(94417),B=d(44589);const U=class U extends W.default{constructor(...v){super(...v),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.dialog=new L.default(()=>this.buildDialog())}openPopout(){const v=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-translate","_blank","resizable=yes,scrollbars=yes,width=850,height=600");return v?(v.focus(),!0):(this.log.warn("Unable to open popout translation window."),!1)}async onLoad(){this.vue.component((await Promise.all([d.e(7852),d.e(1871)]).then(d.bind(d,68088))).default)}async onEnable(){await this.site.awaitElement(L.default.EXCLUSIVE),this.on("i18n:seen",v=>{if(!this._vue)return;this._vue.$children[0].phrases.push(v)}),this.dialog.on("hide",this.destroyDialog,this),this.dialog.on("resize",()=>{this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)}),this.dialog.show()}onDisable(){this.dialog.hide()}buildDialog(){return this._dialog?this._dialog:(this._vue=new this.vue.Vue({el:(0,B.createElement)("div"),render:v=>v("translation-ui",this.getData())}),this._dialog=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._dialog=this._vue=null}getData(){return this.i18n.loadStrings(),{phrases:[],query:"",faded:!1,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,getI18n:()=>this.i18n,getKeys:()=>this.i18n.getKeys(),requestKeys:()=>this.i18n.requestKeys(),updatePhrase:(v,f)=>this.i18n.updatePhrase(v,f),listen:(v,f,u)=>this.on(v,f,u),unlisten:(v,f,u)=>this.off(v,f,u),resize:v=>!this.dialog.exclusive&&this.dialog.toggleSize(v),close:v=>!this.dialog.exclusive&&this.dialog.toggleVisible(v),popout:v=>{this.dialog.exclusive||(this.dialog.toggleVisible(v),this.openPopout()||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))}}}};G(U,"TranslationUI");let I=U},33612:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(22527);let L=0,B=0;const U=class U extends W.default{constructor(v,f){super(v,f),this._id=`_ffz$${L++}`,this.log.info(`Using: ${this.constructor.name}`)}getReact(){if(this._react)return this._react;let v;try{v=this.getCore?.()?.intl?.react}catch{}if(v?.Component&&v.createElement)return this._react=v;if(v=this.resolve("site.web_munch")?.getModule?.("react"),v?.Component&&v.createElement)return this._react=v}getReactDom(){if(this._reactDom)return this._reactDom;let v=this.resolve("site.web_munch")?.getModule?.("react-dom");if(v?.createPortal)return this._reactDom=v}findReact(){const v=this.getReact();if(v)return Promise.resolve(v);const f=this.resolve("site.web_munch");return f?f.findModule("react"):this.waitFor("site.web_munch:registered").then(()=>this.findReact())}awaitElement(v,f,u=6e4){f||(f=document.documentElement);const g=f.querySelector(v);return g?Promise.resolve(g):new Promise((S,n)=>{const s=`${this._id}$observer`,i=f[s],l=B++,w=u&&setTimeout(()=>{const r=f[s];if(!r)return;const[e,a]=r;for(let p=0;p<a.length;p++){const C=a[p];if(C[0]===l){a.splice(p,1),C[3]("Timed out");break}}a.length||(e.disconnect(),f[s]=null)},u);if(i){i[1].push([l,v,S,n,w]);return}const b=new MutationObserver(()=>{const r=f[s];if(!r){b.disconnect();return}const e=r[1];for(let a=0;a<e.length;a++){const p=e[a],C=f.querySelector(p[1]);C&&(e.splice(a,1),a--,p[4]&&clearTimeout(p[4]),p[2](C))}e.length||(b.disconnect(),f[s]=null)});f[s]=[b,[[l,v,S,n,w]]],b.observe(f,{childList:!0,attributes:!0,characterData:!0,subtree:!0})})}};G(U,"BaseSite");let I=U},10789:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>w});var W=d(22527),L=d(44589),B=d(46949),I=d(83342);const U=(0,L.createElement)("span"),D=".video-player__default-player .player-controls__left-control-group",v=".video-player__default-player .player-controls__right-control-group",f=window.AudioContext&&window.DynamicsCompressorNode!=null,u=f&&window.GainNode!=null,g="setting.entry.player.volume-scroll.values",S=[{value:!1,title:"Disabled",i18n_key:`${g}.false`},{value:!0,title:"Enabled",i18n_key:`${g}.true`},{value:2,title:"Enabled with Right-Click",i18n_key:`${g}.2`},{value:3,title:"Enabled with Alt",i18n_key:`${g}.3`},{value:4,title:"Enabled with Alt + Right-Click",i18n_key:`${g}.4`},{value:5,title:"Enabled with Shift",i18n_key:`${g}.5`},{value:6,title:"Enabled with Shift + Right-Click",i18n_key:`${g}.6`},{value:7,title:"Enabled with Ctrl",i18n_key:`${g}.7`},{value:8,title:"Enabled with Ctrl + Right-Click",i18n_key:`${g}.8`}];function n(r){return r.querySelector('button[aria-label*="alt+x"]')??r.querySelector('button[aria-label]:has(path[d="M8 9H6v2h2V9zm1 0h2v2H9V9zm5 0h-2v2h2V9z"]')}G(n,"getNativeClipButton");function s(r){return r===2||r===4||r===6||r===8}G(s,"wantsRMB");function i(r,e,a){return!(s(r)&&e.button!==2&&!a||!e.altKey&&(r===3||r===4)||!e.shiftKey&&(r===5||r===6)||!e.ctrlKey&&(r===7||r===8))}G(i,"matchesEvent");function l(r){const e=r.currentTarget,a=e&&e.querySelector("figure");!a||a.classList.contains("ffz-i-t-reset-clicked")||(a.classList.toggle("ffz-i-t-reset",!1),a.classList.toggle("ffz-i-t-reset-clicked",!0),setTimeout(()=>{a.classList.toggle("ffz-i-t-reset",!0),a.classList.toggle("ffz-i-t-reset-clicked",!1)},500))}G(l,"rotateButton");const b=class b extends W.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.onShortcut=this.onShortcut.bind(this),this.LEFT_CONTROLS=D,this.RIGHT_CONTROLS=v,this.registerSettings()}registerSettings(){this.settings.add("player.embed-metadata",{default:!0,ui:{path:"Player > General >> Embed and Popout",title:"Show metadata when mousing over the player.",component:"setting-check-box"}}),this.settings.add("player.cast-button.hide",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the Cast button."},changed:e=>this.css_tweaks.toggleHide("player-cast",e)}),this.settings.add("player.clip-button.hide-native",{default:null,requires:["player.clip-button.custom"],process:(e,a)=>a??e.get("player.clip-button.custom"),ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the native Clip button.",description:"By default, this is enabled when using the setting to add a custom Clip button."},changed:e=>this.css_tweaks.toggle("player-hide-native-clip",e)}),this.settings.add("player.clip-button.custom",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Display a custom Clip button.",description:"Add a custom Clip button to the player that better fits the style of the other buttons."},changed:()=>{for(const e of this.Player.instances)this.addClipButton(e)}}),this.settings.add("player.fade-pause-buffer",{default:!1,ui:{path:"Player > General >> Playback",title:"Fade the player when paused or buffering to make the UI easier to see.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-fade-paused",e)}),this.settings.add("player.disable-content-warnings",{default:!1,ui:{path:"Player > General >> General",title:"Do not display content warnings.",description:"When this is enabled, FFZ will automatically skip content warnings. This feature is intended for use by adults only.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.skipContentWarnings(e)}}),f&&(this.settings.add("player.compressor.enable",{default:!0,ui:{path:'Player > Compressor @{"description": "These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more."} >> General',title:"Enable the audio compressor and add an `Audio Compressor` button to the player controls.",sort:-1e3,component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addCompressorButton(e)}}),this.settings.add("player.compressor.default",{default:!1,ui:{path:"Player > Compressor >> General",title:"Enable the compressor by default.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.compressPlayer(e)}}),this.settings.add("player.compressor.force-legacy",{default:!1,ui:{path:"Player > Compressor >> Advanced",title:"Force use of legacy browser API.",description:"This setting forces FrankerFaceZ to attempt to use an older browser API to create the compressor. Please reset your player after changing this setting.",component:"setting-check-box",force_seen:!0}}),this.settings.add("player.compressor.shortcut",{default:null,requires:["player.compressor.enable"],process(e,a){return e.get("player.compressor.enable")?a:null},ui:{path:"Player > Compressor >> General",title:"Shortcut Key",description:"This key sequence can be used to toggle the compressor.",component:"setting-hotkey"},changed:()=>{this.updateShortcut();for(const e of this.Player.instances)this.addCompressorButton(e)}}),u&&(this.settings.add("player.gain.enable",{default:!1,ui:{sort:-1,path:'Player > Compressor >> Gain Control @{"sort": 50, "description": "Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses."}',title:"Enable gain control when the audio compressor is enabled.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.compressPlayer(e)}}),this.settings.add("player.gain.no-volume",{default:!1,requires:["player.gain.enable"],process(e,a){return e.get("player.gain.enable")?a:!1},ui:{path:"Player > Compressor >> Gain Control",title:"Force built-in volume to 100% when the audio compressor is enabled.",description:"With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.",component:"setting-check-box"},changed:e=>{this.css_tweaks.toggleHide("player-gain-volume",e);for(const a of this.Player.instances)this.updateGainVolume(a)}}),this.settings.add("player.gain.scroll",{default:!1,ui:{path:"Player > Compressor >> Gain Control",title:"Scroll Adjust",description:"Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:S}}),this.settings.add("player.gain.default",{default:100,requires:["player.gain.min","player.gain.max"],process(e,a){const p=e.get("player.gain.min"),C=e.get("player.gain.max");return a/=100,a<p&&(a=p),a>C&&(a=C),a},ui:{path:"Player > Compressor >> Gain Control",title:"Default Value",component:"setting-text-box",description:"The default value for gain control, when gain control is enabled. 100% means no change in volume.",process:"to_int",bounds:[0,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.min",{default:0,process:(e,a)=>a/100,ui:{path:"Player > Compressor >> Gain Control",title:"Minimum",component:"setting-text-box",description:`**Range:** 0 ~ 100

The minimum allowed value for gain control. 0% is effectively muted.`,process:"to_int",bounds:[0,!0,100,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.max",{default:200,process:(e,a)=>a/100,ui:{path:"Player > Compressor >> Gain Control",title:"Maximum",component:"setting-text-box",description:`**Range:** 100 ~ 1000

The maximum allowed value for gain control. 100% is no change. 200% is double the volume.`,process:"to_int",bounds:[100,!0,1e3,!0]},changed:()=>this.updateGains()})),this.settings.add("player.compressor.threshold",{default:-50,ui:{path:'Player > Compressor >> Advanced @{"sort": 1000}',title:"Threshold",sort:0,description:`**Range:** -100 ~ 0

The decibel value above which the compression will start taking effect.`,component:"setting-text-box",process:"to_int",bounds:[-100,!0,0,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.knee",{default:40,ui:{path:"Player > Compressor >> Advanced",title:"Knee",sort:5,description:`**Range:** 0 ~ 40

A decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,40,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.ratio",{default:12,ui:{path:"Player > Compressor >> Advanced",title:"Ratio",sort:10,description:`**Range:** 0 ~ 20

The amount of change, in dB, needed in the input for a 1 dB change in the output.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,20,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.attack",{default:0,ui:{path:"Player > Compressor >> Advanced",title:"Attack",sort:15,description:`**Range:** 0 ~ 1

The amount of time, in seconds, required to reduce the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.release",{default:.25,ui:{path:"Player > Compressor >> Advanced",title:"Release",sort:20,description:`**Range:** 0 ~ 1
The amount of time, in seconds, required to increase the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()})),this.settings.add("player.allow-catchup",{default:!0,ui:{path:'Player > General @{"sort": -1000} >> General',title:"Allow the player to speed up to reduce delay.",description:"Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.",component:"setting-check-box"},changed:()=>this.updatePlaybackRates()}),this.settings.add("player.mute-click",{default:!1,ui:{path:"Player > General >> Volume",title:"Mute or unmute the player by middle-clicking.",component:"setting-check-box"}}),this.settings.add("player.volume-scroll",{default:!1,ui:{path:"Player > General >> Volume",title:"Adjust volume by scrolling with the mouse wheel.",description:"*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:S}}),this.settings.add("player.button.reset",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Reset Player` button to the player controls.",description:"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addResetButton(e)}}),document.pictureInPictureEnabled&&this.settings.add("player.button.pip",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Picture-in-Picture` button to the player controls.",description:"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addPiPButton(e)}}),this.settings.add("player.volume-scroll-steps",{default:.1,ui:{path:"Player > General >> Volume",title:"Volume scroll amount",description:"How much the volume level is changed per individual scroll input.",component:"setting-select-box",data:[{value:.1,title:"10%"},{value:.05,title:"5%"},{value:.02,title:"2%"},{value:.01,title:"1%"}]}}),this.settings.add("player.captions.font-size",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Size",description:"How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.captions.font-family",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Family",description:"Override the font used for displaying Closed Captions.",component:"setting-combo-box",data:()=>(0,I.R7)()},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.ext-hide",{default:0,ui:{path:"Player > General >> Extensions",title:"Show Overlay Extensions",description:"**Note**: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security. To prevent extensions from loading entirely, we recommend using the [Disable Twitch Extensions browser extension](https://twitch-tools.rootonline.de/disable_twitch_extensions.php) by CommanderRoot.",component:"setting-select-box",data:[{value:2,title:"Never"},{value:1,title:"With Controls"},{value:0,title:"Always"}]},changed:e=>this.updateHideExtensions(e)}),this.settings.add("player.ext-interaction",{default:!0,ui:{path:"Player > General >> Extensions",title:"Allow mouse interaction with overlay extensions.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-ext-mouse",!e)}),this.settings.add("player.no-autoplay",{default:!1,ui:{path:"Player > General >> Playback",title:"Do not automatically start playing videos or streams.",description:"Note: This feature does not apply when navigating directly from channel to channel.",component:"setting-check-box"}}),this.settings.add("player.vod.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play the next recommended video after a video finishes.",component:"setting-check-box"}}),this.settings.add("player.volume-always-shown",{default:!1,ui:{path:"Player > General >> Volume",title:"Keep the volume slider expanded at all times.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-volume",e)}),this.settings.add("player.hide-mouse",{default:!0,ui:{path:"Player > General >> General",title:"Hide mouse when controls aren't visible.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-hide-mouse",e)}),this.settings.add("player.single-click-pause",{default:!1,ui:{path:"Player > General >> Playback",title:"Pause/Unpause the player by clicking.",component:"setting-check-box"}})}async onEnable(){await this.settings.awaitProvider(),await this.settings.provider.awaitReady(),this.css_tweaks.toggleHide("player-cast",this.settings.get("player.cast-button.hide")),this.css_tweaks.toggleHide("player-gain-volume",this.settings.get("player.gain.no-volume")),this.css_tweaks.toggle("player-hide-native-clip",this.settings.get("player.clip-button.hide-native")),this.css_tweaks.toggle("player-volume",this.settings.get("player.volume-always-shown")),this.css_tweaks.toggle("player-ext-mouse",!this.settings.get("player.ext-interaction")),this.css_tweaks.toggle("player-hide-mouse",this.settings.get("player.hide-mouse")),this.css_tweaks.toggle("player-fade-paused",this.settings.get("player.fade-pause-buffer")),this.installVisibilityHook(),this.updateHideExtensions(),this.updateCaptionsCSS(),this.updateShortcut(),this.on(":reset",this.resetAllPlayers,this),this.Player.ready((e,a)=>{this.modifyPlayerClass(e);for(const p of a){const C=p.props?.playerEvents;C&&((0,L.off)(C,"Playing",p.setPlayerActive),(0,L.off)(C,"PlayerSeekCompleted",p.setPlayerActive)),p.ffzMaybeRemoveNativeListeners(),p.maybeAttachDomEventListeners(),p.ffzScheduleState(),C&&((0,L.on)(C,"Playing",p.setPlayerActive),(0,L.on)(C,"PlayerSeekCompleted",p.setPlayerActive)),this.updateGUI(p),this.compressPlayer(p),this.updatePlaybackRate(p)}}),this.Player.on("mount",e=>{this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)}),this.Player.on("update",e=>{this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)}),this.Player.on("unmount",e=>{e.ffzUninstall()}),this.on("i18n:update",()=>{for(const e of this.Player.instances)this.updateGUI(e)})}updateShortcut(){const e=this.Mousetrap=this.Mousetrap||this.resolve("site.web_munch")?.getModule?.("mousetrap")||window.Mousetrap;if(!e||!e.bind)return;this._shortcut_bound&&(e.unbind(this._shortcut_bound),this._shortcut_bound=null);const a=this.settings.get("player.compressor.shortcut");f&&a&&(0,B.isValidShortcut)(a)&&(e.bind(a,this.onShortcut),this._shortcut_bound=a)}onShortcut(e){for(const a of this.Player.instances)this.compressPlayer(a,e)}modifyPlayerClass(e){const a=this,p=e.prototype.maybeAttachDomEventListeners;e.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0,this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffzErrorReset||(this._ffzErrorReset=a.addErrorResetButton.bind(a,this)),this._ffzReady||(this._ffzReady=this.ffzReady.bind(this));const C=this,y=this.setPlayerActive,z=this.setPlayerInactive;this.setPlayerActive=function(){return C.ffzScheduleState(),y.call(C)},this.setPlayerInactive=function(){return C.ffzScheduleState(),z.call(C)},this.ffzOnEnded=()=>{a.settings.get("player.vod.autoplay")||a.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||a.fine.getChildNode(this),1e3).then(o=>o.click())};const $=this.props.playerEvents;$&&((0,L.on)($,"Buffering",this._ffzUpdateState),(0,L.on)($,"Playing",this._ffzUpdateState),(0,L.on)($,"PlayerError",this._ffzUpdateState),(0,L.on)($,"PlayerError",this._ffzErrorReset),(0,L.on)($,"Ended",this._ffzUpdateState),(0,L.on)($,"Ended",this.ffzOnEnded),(0,L.on)($,"Ready",this._ffzReady),(0,L.on)($,"Idle",this._ffzUpdateState)),this.ffzStopAutoplay()},e.prototype.ffzUninstall=function(){this._ffz_state_raf&&cancelAnimationFrame(this._ffz_state_raf);const C=this.props.playerEvents;C&&this._ffzUpdateState&&((0,L.off)(C,"Playing",this._ffzUpdateState),(0,L.off)(C,"PlayerError",this._ffzUpdateState),(0,L.off)(C,"PlayerError",this._ffzErrorReset),(0,L.off)(C,"Ended",this._ffzUpdateState),(0,L.off)(C,"Ended",this.ffzOnEnded),(0,L.off)(C,"Ready",this._ffzReady),(0,L.off)(C,"Idle",this._ffzUpdateState)),this.ffzRemoveListeners(),this._ffz_state_raf=null,this._ffzUpdateState=null,this._ffzErrorReset=null,this._ffzReady=null,this.ffzOnEnded=null},e.prototype.ffzReady=function(){const C=this.props.containerRef;C&&requestAnimationFrame(()=>{const y=C.querySelectorAll(".ffz--player-reset figure");for(const z of y)z._ffz_unspin&&clearTimeout(z._ffz_unspin),z.classList.toggle("loading",!1)})},e.prototype.ffzStopAutoplay=function(){a.shouldStopAutoplay(this)&&a.stopPlayer(this.props.mediaPlayerInstance,this.props.playerEvents,this)},e.prototype.ffzScheduleState=function(){this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffz_state_raf||(this._ffz_state_raf=requestAnimationFrame(this._ffzUpdateState))},e.prototype.ffzUpdateState=function(){this._ffz_state_raf=null;const C=this.props.containerRef;if(!C)return;const y=C.dataset;y.controls=this.state?.active||!1;let z=this.props.mediaPlayerInstance;if(!z)return;z.core&&(z=z.core);const $=z.state?.state,o=z.mediaSinkManager?.video;$==="Playing"&&o?._ffz_maybe_compress&&(o._ffz_maybe_compress=!1,a.compressPlayer(this)),o&&o._ffz_compressed!=null&&(y.compressed=o._ffz_compressed),y.ended=$==="Ended",y.paused=$==="Idle",y.buffering=$==="Buffering"},e.prototype.ffzAttachListeners=function(){const C=this.props.containerRef;!C||this._ffz_listeners||(this._ffz_listeners=!0,this._ffz_scroll_handler||(this._ffz_scroll_handler=this.ffzScrollHandler.bind(this)),this._ffz_click_handler||(this._ffz_click_handler=this.ffzClickHandler.bind(this)),this._ffz_dblclick_handler||(this._ffz_dblclick_handler=this.ffzDblClickHandler.bind(this)),this._ffz_menu_handler||(this._ffz_menu_handler=this.ffzMenuHandler.bind(this)),(0,L.on)(C,"wheel",this._ffz_scroll_handler),(0,L.on)(C,"dblclick",this._ffz_dblclick_handler),(0,L.on)(C,"mousedown",this._ffz_click_handler),(0,L.on)(C,"contextmenu",this._ffz_menu_handler))},e.prototype.ffzRemoveListeners=function(){const C=this.props.containerRef;!C||!this._ffz_listeners||(this._ffz_scroll_handler&&((0,L.off)(C,"wheel",this._ffz_scroll_handler),this._ffz_scroll_handler=null),this._ffz_click_handler&&((0,L.off)(C,"mousedown",this._ffz_click_handler),this._ffz_click_handler=null),this._ffz_menu_handler&&((0,L.off)(C,"contextmenu",this._ffz_menu_handler),this._ffz_menu_handler=null),this._ffz_dblclick_handler&&((0,L.off)(C,"dblclick",this._ffz_dblclick_handler),this._ffz_dblclick_handler=null),this._ffz_listeners=!1)},e.prototype.ffzDelayPause=function(){this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer),(this.props?.mediaPlayerInstance).isPaused()||(this._ffz_pause_timer=setTimeout(()=>{const y=this.props?.mediaPlayerInstance;y.isPaused()||y.pause()},500))},e.prototype.ffzDblClickHandler=function(C){C&&this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer)},e.prototype.ffzClickHandler=function(C){if(!C)return;const y=a.settings.get("player.volume-scroll"),z=a.settings.get("player.gain.scroll"),$=a.settings.get("player.single-click-pause"),o=s(y)||s(z);if($&&C.button===0){if(!C.target||!C.target.classList.contains("click-handler"))return;this.ffzDelayPause()}if(o&&C.button===2&&(this.ffz_rmb=!0,this.ffz_scrolled=!1),!a.settings.get("player.mute-click")||C.button!==1)return;const c=this.props?.mediaPlayerInstance;if(!c?.isMuted)return;const m=!c.isMuted();return c.setMuted(m),localStorage.setItem("video-muted",JSON.stringify({default:m})),C.preventDefault(),!1},e.prototype.ffzMenuHandler=function(C){this.ffz_rmb=!1,this.ffz_scrolled&&(C.preventDefault(),C.stopPropagation())},e.prototype.ffzScrollHandler=function(C){const y=a.settings.get("player.volume-scroll"),z=a.settings.get("player.gain.scroll"),$=a.settings.get("player.gain.no-volume"),o=z&&i(z,C,this.ffz_rmb),c=y&&i(y,C,this.ffz_rmb);if(!o&&!c)return;const m=C.wheelDelta||-(C.deltaY||C.detail||0),A=this.props?.mediaPlayerInstance,h=A?.mediaSinkManager?.video||A?.core?.mediaSinkManager?.video,T=h?._ffz_compressed&&h?._ffz_gain!=null,R=T&&o;if(!A?.getVolume)return;s(R?z:y)&&(this.ffz_scrolled=!0);const P=a.settings.get("player.volume-scroll-steps");if(R){let O=h._ffz_gain_value;O==null&&(O=a.settings.get("player.gain.default"));const M=a.settings.get("player.gain.min"),j=a.settings.get("player.gain.max");m>0?O+=P:O-=P,O<M&&(O=M),O>j&&(O=j),h._ffz_gain_value=O,$&&O!==0&&(A.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),a.updateGain(this)}else if(c&&!(h._ffz_compressed&&$)){const O=h?.volume??A.getVolume(),M=Math.max(0,Math.min(1,O+(m>0?P:-P)));A.setVolume(M),localStorage.volume=M,M!==0&&(A.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1})))}return C.preventDefault(),!1},e.prototype.ffzMaybeRemoveNativeListeners=function(){const C=this.props.containerRef;C&&this.listenersAttached&&((0,L.off)(C,"mouseleave",this.setPlayerInactive),(0,L.off)(C,"mouseenter",this.setPlayerActive),(0,L.off)(C,"mousemove",this.onMouseMove),this.listenersAttached=!1)},e.prototype.maybeAttachDomEventListeners=function(){try{this.ffzInstall(),this.ffzAttachListeners()}catch(C){a.log.error("Error attaching event listener.",C)}return p.call(this)}}shouldStopAutoplay(){return!1}installVisibilityHook(){if(!document.pictureInPictureEnabled){this.log.info("Skipping visibility hooks. Picture-in-Picture is not available.");return}const e=this;document.addEventListener("fullscreenchange",()=>{const a=document.fullscreenElement,p=document.pictureInPictureElement;a&&p&&(a===p||a.contains(p))&&document.exitPictureInPicture();for(const C of this.Player.instances)this.addPiPButton(C)});try{Object.defineProperty(document,"hidden",{configurable:!0,get(){return document.pictureInPictureElement!=null||e.settings.get("player.force-visible")?!1:document.visibilityState==="hidden"}})}catch(a){this.log.warn("Unable to install document visibility hook.",a)}}stopPlayer(e,a,p){if(e&&e.pause&&(e.getState?.()||e.core?.getState?.())==="Playing")e.pause();else if(a&&!a._ffz_stopping){a._ffz_stopping=!0;const C=G(()=>{p.props.mediaPlayerInstance?.pause&&(p.props.mediaPlayerInstance.pause(),(0,L.off)(a,"Playing",C),a._ffz_stopping=!1)},"immediatePause");this.log.info("Unable to immediately pause. Listening for playing event."),(0,L.on)(a,"Playing",C)}}updateCaptionsCSS(){const e=[],a=this.settings.get("player.captions.font-size");let p=this.settings.get("player.captions.font-family");if(p&&p.length){const[C,y]=(0,I.jo)(p);p=C,this._font_unloader&&this._font_unloader(),this._font_unloader=y,p.indexOf(" ")!==-1&&p.indexOf(",")===-1&&p.indexOf('"')===-1&&p.indexOf("'")===-1&&(p=`"${p}"`),U.style.fontFamily="",U.style.fontFamily=p,U.style.fontFamily&&e.push(`font-family: ${U.style.fontFamily} !important;`)}U.style.fontSize="",U.style.fontSize=a,U.style.fontSize&&e.push(`font-size: ${U.style.fontSize} !important;`),e.length?this.css_tweaks.set("captions-font",`.player-captions-container__caption-line {
	${e.join(`
	`)}
}`):this.css_tweaks.delete("captions-font")}updateHideExtensions(e){e===void 0&&(e=this.settings.get("player.ext-hide")),this.css_tweaks.toggleHide("player-ext-hover",e===1),this.css_tweaks.toggleHide("player-ext",e===2)}skipContentWarnings(e){if(!this.settings.get("player.disable-content-warnings"))return;const a=this.fine.getHostNode(e),p=a&&a.querySelector('button[data-a-target="content-classification-gate-overlay-start-watching-button"]');p&&p.click()}updateGUI(e){this.skipContentWarnings(e),this.addPiPButton(e),this.addResetButton(e),this.addClipButton(e),this.addCompressorButton(e,!1),this.addGainSlider(e,!1),this.addMetadata(e),this.emit(":update-gui",e)}areControlsDisabled(e){return e._ffz_control_state||this.findControlState(e),e._ffz_control_state?e._ffz_control_state.props.disableControls:!1}findControlState(e){e._ffz_control_state||(e._ffz_control_state=this.fine.searchTree(e,a=>a.props&&(0,B.has)(a.props,"disableControls"),200))}addGainSlider(e,a,p=0){const C=e.props.containerRef||this.fine.getChildNode(e),y=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,z=C&&C.querySelector(D);let $=y!=null&&y._ffz_compressed&&y._ffz_gain;if(this.areControlsDisabled(e)&&($=null),!z)return y&&!$?void 0:p<5?setTimeout(this.addGainSlider.bind(this,e,a,(p||0)+1),250):void 0;const o=this.settings.get("player.gain.min"),c=this.settings.get("player.gain.max");(o>=c||c<=o)&&($=null);let m,A,h,T,R,P=z.querySelector(".ffz--player-gain");if(!$){P&&P.remove();return}if(P){if(a)return;h=P.querySelector("input"),R=P.querySelector(".ffz--gain-value"),A=P.querySelector(".ffz-il-tooltip"),m=P.querySelector(".ffz-il-tooltip .ffz--p-tip"),T=P.querySelector(".ffz-il-tooltip .ffz--p-value")}else{const Y=G(()=>{let ee=h.value/100;const X=this.settings.get("player.gain.min"),Q=this.settings.get("player.gain.max");if(ee<X&&(ee=X),ee>Q&&(ee=Q),ee==y._ffz_gain_value)return;const te=e.props.mediaPlayerInstance,ne=te.core||te;!this.areControlsDisabled(e)&&ee>0&&this.settings.get("player.gain.no-volume")&&ne?.isMuted?.()&&(ne.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),y._ffz_gain_value=ee,$.gain.value=ee;const fe=Q-X,re=(ee-X)/fe;R.style.width=`${re*100}%`,T.textContent=`${Math.round(ee*100)}%`},"on_change");P=(0,L.createElement)("div",{class:"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container"},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-full-height"},(0,L.createElement)("label",{class:"tw-hide-accessible"},this.i18n.t("player.gain.label","Gain Control")),(0,L.createElement)("div",{class:"tw-flex tw-full-width tw-relative tw-z-above"},h=(0,L.createElement)("input",{class:"ffz-range ffz-range--overlay",type:"range",min:"0",max:"100",step:"1","data-a-target":"player-gain-slider",value:"100"}),(0,L.createElement)("div",{class:"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below"},(0,L.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-container"},R=(0,L.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-value ffz--gain-value","data-test-selector":"ffz-range__fill-value-selector"}))))),A=(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},(0,L.createElement)("div",null,m=(0,L.createElement)("div",{class:"ffz--p-tip"}),T=(0,L.createElement)("div",{class:"tw-regular ffz--p-value"})))),h.addEventListener("input",Y),z.appendChild(P)}let O=y._ffz_gain_value;O==null&&(O=this.settings.get("player.gain.default")),h.min=o*100,h.max=c*100,h.value=O*100;const M=c-o,j=(O-o)/M;R.style.width=`${j*100}%`,m.textContent=this.i18n.t("player.gain.label","Gain Control"),T.textContent=`${Math.round(O*100)}%`}addCompressorButton(e,a,p=0){const C=e.props.containerRef||this.fine.getChildNode(e),y=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,z=C&&C.querySelector(D),$=f&&y!=null&&this.settings.get("player.compressor.enable");if(!z)return $&&p<5?setTimeout(this.addCompressorButton.bind(this,e,a,(p||0)+1),250):void 0;let o,c,m,A,h=z.querySelector(".ffz--player-comp");if(!$||this.areControlsDisabled(e)){h&&h.remove();return}if(!h)h=(0,L.createElement)("div",{class:"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container"},A=(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-comp-button",onClick:this.compressPlayer.bind(this,e)},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("div",{class:"tw-button-icon__icon"},o=(0,L.createElement)("figure",{class:"ffz-player-icon"})))),(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},(0,L.createElement)("div",null,c=(0,L.createElement)("div",{class:"ffz--p-tip"}),m=(0,L.createElement)("div",{class:"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain"})))),z.appendChild(h);else{if(a)return;o=h.querySelector("figure"),A=h.querySelector("button"),c=h.querySelector(".ffz-il-tooltip .ffz--p-tip"),m=h.querySelector(".ffz-il-tooltip .ffz--p-extra")}const T=y._ffz_compressed,R=this.canCompress(e);let P=R?T?this.i18n.t("player.comp_button.off","Disable Audio Compressor"):this.i18n.t("player.comp_button.on","Audio Compressor"):this.i18n.t("player.comp_button.disabled","Audio Compressor cannot be enabled when viewing Clips.");m.textContent=this.i18n.t("player.comp_button.help","See the FFZ Control Center for details. If audio breaks, please reset the player."),R&&this._shortcut_bound&&(P=`${P} (${this._shortcut_bound})`),o.classList.toggle("ffz-i-comp-on",T),o.classList.toggle("ffz-i-comp-off",!T),A.disabled=!R,A.setAttribute("aria-label",P),c.textContent=P}replaceVideoElement(e,a){const p=(0,L.createElement)("video"),C=a?._ffz_pregain_volume??a?.volume??e.getVolume(),y=e.isMuted();return p._ffz_gain_value=a._ffz_gain_value,p._ffz_state=a._ffz_state,p._ffz_toggled=a._ffz_toggled,p._ffz_maybe_compress=a._ffz_compressed,p.volume=C,y&&(p.muted=!0),p.playsInline=!0,this.installPlaybackRate(p),a.replaceWith(p),e.attachHTMLVideoElement(p),p}hookPlayerLoad(e){!e||e._ffz_load||(e._ffz_load=e.load,e.load=(...a)=>{try{const p=e.getHTMLVideoElement();p?._ffz_compressor&&e.attachHTMLVideoElement&&(this.log.info("Recreating video element due to player load with compressor installed."),this.replaceVideoElement(e,p))}catch(p){t.log.error("Error while handling player load.",p)}return e._ffz_load(...a)})}compressPlayer(e,a){const p=e.props.mediaPlayerInstance,C=p.core||p,y=C?.mediaSinkManager?.video;if(!y||!f)return;this.hookPlayerLoad(p),e._ffz_setSrc||(e._ffz_setSrc=e.setSrc,e.setSrc=async function(...R){console.log("setSrc",R);const P=e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;return P&&P._ffz_compressor&&await this.resetPlayer(e),e._ffz_setSrc(...R)}),C._ffz_setVolume||(C._ffz_setVolume=C.setVolume,C._ffz_fakeVolume=()=>{}),y._ffz_maybe_compress=!1;const z=y._ffz_compressed||!1;let $=y._ffz_toggled?y._ffz_state:this.settings.get("player.compressor.default");if(a!=null&&(a.preventDefault(),y._ffz_toggled=!0,$=!y._ffz_compressed,y._ffz_state=$),y._ffz_compressor){if(!y._ffz_comp_reset&&!this.canCompress(e)){y._ffz_comp_reset=!0,this.resetPlayer(e);return}}else{if(!$)return;this.createCompressor(e,y)}let o=y._ffz_gain;const c=u&&this.settings.get("player.gain.enable"),m=o!=null;if(($==z||a==null&&y._ffz_toggled)&&m==c)return;const A=y._ffz_context,h=y._ffz_compressor,T=y._ffz_source;if(!(!A||!h||!T)){if(c&&!o){let R=y._ffz_gain_value;R==null&&(R=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;o=y._ffz_gain=new GainNode(A,{gain:R})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),o=y._ffz_gain=A.createGain(),o.gain.value=R}h.connect(o),z&&(h.disconnect(A.destination),o.connect(A.destination))}else!c&&o&&(h.disconnect(o),z&&(o.disconnect(A.destination),h.connect(A.destination)),o=y._ffz_gain=null);$!=z&&($?(T.disconnect(A.destination),T.connect(h),o?(o.connect(A.destination),this.settings.get("player.gain.no-volume")&&(y._ffz_pregain_volume=C.getVolume(),C._ffz_setVolume(1),C.setVolume=C._ffz_fakeVolume)):h.connect(A.destination)):(T.disconnect(h),o?(o.disconnect(A.destination),y._ffz_pregain_volume!=null&&(C._ffz_setVolume(y._ffz_pregain_volume),C.setVolume=C._ffz_setVolume,y._ffz_pregain_volume=null)):h.disconnect(A.destination),T.connect(A.destination))),e.props.containerRef&&(e.props.containerRef.dataset.compressed=$),y._ffz_compressed=$,this.addCompressorButton(e),this.addGainSlider(e)}}updateGainVolume(e){const a=e.props.mediaPlayerInstance,p=a.core||a,C=p?.mediaSinkManager?.video;if(!C||!C._ffz_compressed)return;const y=this.settings.get("player.gain.no-volume");y&&C._ffz_pregain_volume==null?(C._ffz_pregain_volume=p.getVolume(),p._ffz_setVolume(1),p.setVolume=p._ffz_fakeVolume):!y&&C._ffz_pregain_volume!=null&&(p._ffz_setVolume(C._ffz_pregain_volume),p.setVolume=p._ffz_setVolume,C._ffz_pregain_volume=null)}canCompress(e){if(!f)return!1;const a=e.props?.mediaPlayerInstance;if(a==null)return!1;const p=a.mediaSinkManager?.video||a.core?.mediaSinkManager?.video;return!(!p||!p.src&&!p.srcObject||p.src&&new URL(p.src).protocol!=="blob:")}createCompressor(e,a,p){if(!this.canCompress(e))return;let C=a._ffz_compressor;if(!C){if(p=p||new AudioContext,p.state==="suspended"){let z;const $=G(()=>{if(clearTimeout(z),p.removeEventListener("statechange",$),p.state==="suspended"){this.log.debug("Aborting due to browser auto-play policy.");return}this.createCompressor(e,a,p)},"evt");this.log.debug("Attempting to resume suspended AudioContext."),z=setTimeout($,100);try{p.addEventListener("statechange",$),p.resume()}catch{}return}a._ffz_context=p;let y;try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;y=a._ffz_source=new MediaElementAudioSourceNode(p,{mediaElement:a})}catch{this.log.info("Unable to use new MediaElementAudioSourceNode. Falling back to old method."),y=a._ffz_source=p.createMediaElementSource(a)}y.connect(p.destination);try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;C=a._ffz_compressor=new DynamicsCompressorNode(p)}catch{this.log.info("Unable to use new DynamicsCompressorNode. Falling back to old method."),C=a._ffz_compressor=p.createDynamicsCompressor()}if(this.settings.get("player.gain.enable")){let z,$=a._ffz_gain_value;$==null&&($=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;z=a._ffz_gain=new GainNode(p,{gain:$})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),z=a._ffz_gain=p.createGain(),z.gain.value=$}C.connect(z)}a._ffz_compressed=!1}this.updateCompressor(null,C)}updateGains(){for(const e of this.Player.instances)this.updateGain(e)}updateGain(e,a,p,C=!0){if(p||(p=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video),a==null&&(a=p?._ffz_gain),!p||!a)return;let y=p._ffz_gain_value;y==null&&(y=this.settings.get("player.gain.default")),a.gain.value=y,C&&this.addGainSlider(e)}updateCompressors(){for(const e of this.Player.instances)this.updateCompressor(e)}updateCompressor(e,a){a==null&&(a=(e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video)?._ffz_compressor),a&&(a.threshold.value=this.settings.get("player.compressor.threshold"),a.knee.value=this.settings.get("player.compressor.knee"),a.ratio.value=this.settings.get("player.compressor.ratio"),a.attack.value=this.settings.get("player.compressor.attack"),a.release.value=this.settings.get("player.compressor.release"))}updatePlaybackRates(){for(const e of this.Player.instances)this.updatePlaybackRate(e)}updatePlaybackRate(e){const a=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;a.setFFZPlaybackRate||this.installPlaybackRate(a),a.setFFZPlaybackRate(a.playbackRate)}installPlaybackRate(e){if(e.setFFZPlaybackRate)return;let a=e.playbackRate;const p=this,C=G(()=>{p.settings.get("player.allow-catchup")||Object.defineProperty(e,"playbackRate",{configurable:!0,get(){return a},set(y){(y===1||y<1||y>=1.1)&&e.setFFZPlaybackRate(y)}})},"installProperty");e.setFFZPlaybackRate=y=>{delete e.playbackRate,a=y,e.playbackRate=y,C()}}addPiPButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,y=C&&document.fullscreenElement&&document.fullscreenElement.contains(C),z=p&&p.querySelector(v),$=document.pictureInPictureEnabled&&this.settings.get("player.button.pip");if(!z)return $&&a<5?setTimeout(this.addPiPButton.bind(this,e,(a||0)+1),250):void 0;let o,c,m,A=z.querySelector(".ffz--player-pip");if(!$){A&&A.remove();return}if(A)o=A.querySelector("figure"),m=A.querySelector("button"),c=A.querySelector(".ffz-il-tooltip");else{A=(0,L.createElement)("div",{class:"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container"},m=(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-pip-button",onClick:this.pipPlayer.bind(this,e)},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("div",{class:"tw-button-icon__icon"},o=(0,L.createElement)("figure",{class:"ffz-player-icon"})))),c=(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const P=z.querySelector('button[data-a-target="player-theatre-mode-button"]')||z.querySelector('button[aria-label*="Theat"]')||z.querySelector('button[data-a-target="player-fullscreen-button"]');P?z.insertBefore(A,P.parentElement):z.appendChild(A)}const h=!!document.pictureInPictureElement,T=!1,R=y?this.i18n.t("player.pip_button.fs","Cannot use Picture-in-Picture when Fullscreen"):T?this.i18n.t("player.pip_button.swap","Switch Picture-in-Picture"):h?this.i18n.t("player.pip_button.off","Exit Picture-in-Picture"):this.i18n.t("player.pip_button","Picture-in-Picture");o.classList.toggle("ffz-i-t-pip-inactive",!h||T),o.classList.toggle("ffz-i-t-pip-active",h&&!T),m.setAttribute("aria-label",R),c.textContent=R}pipPlayer(e,a){const p=e.props.mediaPlayerInstance?.mediaSinkManager?.video||e.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;!p||!document.pictureInPictureEnabled||(a&&a.preventDefault(),!(document.fullscreenElement&&document.fullscreenElement.contains(p))&&(p._ffz_pip_enter||(p.addEventListener("enterpictureinpicture",p._ffz_pip_enter=()=>{this.addPiPButton(e)}),p.addEventListener("leavepictureinpicture",p._ffz_pip_exit=()=>{this.addPiPButton(e)})),document.pictureInPictureElement?document.exitPictureInPicture():p.requestPictureInPicture()))}addClipButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(v),y=this.settings.get("player.clip-button.custom");if(!C)return y&&a<5?setTimeout(this.addClipButton.bind(this,e,(a||0)+1),250):void 0;let z,$,o=C.querySelector(".ffz--player-clip");if(!y){o&&o.remove();return}if((!C.ffz_native_clip||!C.contains(C.ffz_native_clip))&&(C.ffz_native_clip=n(C)),o)$=o.querySelector("button"),z=o.querySelector(".ffz-il-tooltip");else{const A=G(T=>{const R=n(C);R&&R.click()},"on_click");o=(0,L.createElement)("div",{class:"ffz--player-clip tw-inline-flex tw-relative ffz-il-tooltip__container"},$=(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-clip-button",onClick:A},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("div",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-player-icon ffz-i-clip"})))),z=(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const h=C.querySelector(".ffz--player-reset button")||C.querySelector(".ffz--player-pip button")||C.querySelector('button[data-a-target="player-theatre-mode-button"]')||C.querySelector('button[aria-label*="Theat"]')||C.querySelector('button[data-a-target="player-fullscreen-button"]');h?C.insertBefore(o,h.parentElement):C.appendChild(o)}const c=C.ffz_native_clip,m=c?c.disabled||c.ariaDisabled==="true":!1;$.disabled=m,$.setAttribute("aria-label",z.textContent=m?c.ariaLabel||this.i18n.t("player.clip-button.disabled","Clips are Disabled"):this.i18n.t("player.clip-button","Clip (Alt+X)"))}clickClip(e,a){console.log("clicked clip",e,a)}addResetButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(v),y=this.settings.get("player.button.reset");if(!C)return y&&a<5?setTimeout(this.addResetButton.bind(this,e,(a||0)+1),250):void 0;let z,$,o=C.querySelector(".ffz--player-reset");if(!y){o&&o.remove();return}if(o)$=o.querySelector("button"),z=o.querySelector(".ffz-il-tooltip");else{o=(0,L.createElement)("div",{class:"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container"},$=(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:l,onDblClick:this.resetPlayer.bind(this,e)},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("div",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),z=(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const c=C.querySelector(".ffz--player-pip button")||C.querySelector('button[data-a-target="player-theatre-mode-button"]')||C.querySelector('button[aria-label*="Theat"]')||C.querySelector('button[data-a-target="player-fullscreen-button"]');c?C.insertBefore(o,c.parentElement):C.appendChild(o)}$.setAttribute("aria-label",z.textContent=this.i18n.t("player.reset_button","Reset Player (Double-Click)"))}addErrorResetButton(e,a=0){const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(".content-overlay-gate"),y=this.settings.get("player.button.reset");if(!C){if(!y)return;a<2&&this.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||t.fine.getChildNode(this),1e3).then(()=>{this.addErrorResetButton(e,(a||0)+1)}).catch(()=>{this.log.warn("Unable to find container element for Error Reset button.")});return}let z,$,o=C.querySelector(".ffz--player-reset");if(!y){o&&o.remove();return}o?($=o.querySelector("button"),z=o.querySelector(".ffz-il-tooltip")):(o=(0,L.createElement)("div",{class:"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1"},$=(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:l,onDblClick:this.resetPlayer.bind(this,e)},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("div",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),z=(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"})),C.appendChild(o)),$.setAttribute("aria-label",z.textContent=this.i18n.t("player.reset_button","Double-Click to Reset Player"))}resetAllPlayers(){for(const e of this.Player.instances)this.resetPlayer(e)}async resetPlayer(e,a){const p=e?e.mediaSinkManager||e.core?.mediaSinkManager?e:e?.props?.mediaPlayerInstance:null;if(a){a.preventDefault();const o=a.currentTarget,c=o&&o.querySelector("figure");if(c){if(c.classList.contains("loading"))return;c.classList.toggle("ffz-i-t-reset",!0),c.classList.toggle("ffz-i-t-reset-clicked",!1),c.classList.toggle("loading",!0),c._ffz_unspin=setTimeout(()=>{c._ffz_unspin=null,c.classList.toggle("loading",!1)},1e4)}}const C=p.getDuration?.()??1/0;let y=-1;const z=p.core||p;z._ffz_setVolume&&(z.setVolume=z._ffz_setVolume),isFinite(C)&&!isNaN(C)&&C>0&&(y=p.getPosition());const $=p.mediaSinkManager?.video||p.core?.mediaSinkManager?.video;if($?._ffz_compressor&&p.attachHTMLVideoElement){const o=this.replaceVideoElement(p,$);o._ffz_maybe_compress=!0}this.PlayerSource.check();for(const o of this.PlayerSource.instances)(!p||p===o.props?.mediaPlayerInstance)&&await o.setSrc({isNewMediaPlayerInstance:!1});y>0&&setTimeout(()=>p.seekTo(y),250)}addMetadata(e){this.metadata&&(e._ffz_md_update||(e._ffz_md_update=(0,B.debounce)(()=>requestAnimationFrame(()=>this._updateMetadata(e)),1e3,2)),e._ffz_md_update())}wantsMetadata(){return!1}_updateMetadata(e){e._ffz_cont&&!document.contains(e._ffz_cont)&&(e._ffz_cont=null);const a=this.wantsMetadata(e);if(!e._ffz_cont){if(!a)return;const p=e.props.containerRef||this.fine.getChildNode(e),C=p&&p.querySelector(v);if(!C)return;e._ffz_cont=(0,L.createElement)("div",{class:"ffz--player-meta-tray"}),C.insertBefore(e._ffz_cont,C.firstElementChild)}if(!a){e._ffz_cont.remove(),e._ffz_cont=null;return}this.updateMetadata(e)}updateMetadata(e,a){const p=e._ffz_cont;if(!p||!document.contains(p))return;a?Array.isArray(a)||(a=[a]):a=this.metadata.keys;const C=this.getData(),y=C?.props?.data?.user,z=e._ffz_meta_timers=e._ffz_meta_timers||{},$=G(c=>this.updateMetadata(e,c),"refresh_fn"),o={channel:{id:y?.id,login:C?.props?.channelLogin,display_name:y?.displayName,live:y?.stream?.id!=null,live_since:y?.stream?.createdAt},inst:e,source:C,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>y?.id?this.getBroadcastID(e,y.id):null};for(const c of a)this.metadata.renderPlayer(c,o,p,z,$)}getUptime(e){let C=this.getData()?.props?.data?.user?.stream?.createdAt;return C?(C instanceof Date||(C=new Date(C)),(Date.now()-C.getTime())/1e3):null}getBroadcastID(e,a){if(!this.twitch_data)return Promise.resolve(null);const p=e._ffz_bcast_cache=e._ffz_bcast_cache||{};return a===p.channel_id&&Date.now()-p.saved<6e4?Promise.resolve(p.broadcast_id):new Promise(async(C,y)=>{if(p.updating){p.updating.push([C,y]);return}p.channel_id=a,p.updating=[[C,y]];let z,$;try{z=await this.twitch_data.getBroadcastID(a)}catch(c){z=null,$=c}const o=p.updating;if(p.updating=null,p.channel_id!==a){$=new Error("Outdated"),p.channel_id=null,p.broadcast_id=null,p.saved=0;for(const c of o)c[1]($);return}p.broadcast_id=z,p.saved=Date.now();for(const c of o)$?c[1]($):c[0](z)})}get playerUI(){return this.fine.searchTree(this.Player.first,a=>a.props&&a.props.uiContext,150)?.props?.uiContext}get current(){for(const e of this.Player.instances)if(e?.props?.mediaPlayerInstance)return e.props.mediaPlayerInstance;return null}};G(b,"PlayerBase");let w=b},43874:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>z});var W=d(33612),L=d(22527),B=d(46949),I=d(24431),U=(O=>(O[O.Unloaded=0]="Unloaded",O[O.Loaded=1]="Loaded",O[O.Ready=2]="Ready",O[O.Used=3]="Used",O))(U||{});const D={};function v(O){return D[O]?D[O]:D[O]=new RegExp(`\\b(?<!\\.)${O}\\(([0-9e_+]+)\\)`,"g")}G(v,"getRequireRegex");const f=["webpackJsonp","webpackChunktwitch_twilight","webpackChunktwitch_sunlight","webpackJsonp_N_E"],u=null;function g(O,M){let j=0;const Y={},ee={},X=[],Q={},te=[];function ne(fe){Y[fe]=j,ee[fe]=j,j++,X.push(fe),Q[fe]=!0;const re=O[fe];if(re.requires)for(const ue of re.requires)M.has(ue)&&(Y[ue]===void 0?(ne(ue),ee[fe]=Math.min(ee[fe],ee[ue])):Q[ue]&&(ee[fe]=Math.min(ee[fe],Y[ue])));if(ee[fe]===Y[fe]){const ue=[];let me;do me=X.pop(),Q[me]=!1,ue.push(me);while(me!==fe);te.push(ue)}}G(ne,"strongconnect");for(const fe of M)Y[fe]===void 0&&ne(fe);return te}G(g,"computeSCC");const m=class m extends L.default{constructor(M,j){super(M,j),this._processGraph=this._processGraph.bind(this),this.start_time=performance.now(),this._known_rules={},this._mod_cache={},this._require=null,this._chunk_names={},this._pending_ready_ids=new Set,this._loaded_ids=new Set,this._graph={},this.hookLoader(),this.getRequire()}waitForLoader(){return this._original_loader?Promise.resolve(this._original_loader):(this._load_waiter||(this._load_waiter=new Promise((M,j)=>{this._load_wait_fns=[M,j]})),this._load_waiter)}_resolveLoadWait(M){const j=this._load_wait_fns;this._load_waiter=null,this._load_wait_fns=null,j&&(M?j[0](M):j[1]())}hookLoader(M=0){if(this._original_loader){this.log.warn("Attempted to call hookLoader twice.");return}let j=null;for(const X of f)if(window[X]){j=X;break}if(!j){if(M>240){this.log.error("Unable to find webpack's loader after one minute.");try{const X=[];for(const Q of Object.keys(window))(0,B.has)(window,Q)&&typeof Q=="string"&&/webpack/i.test(Q)&&!/ffz/i.test(Q)&&X.push(Q);X.length?this.log.info("Possible Matches: ",X.join(", ")):this.log.info("No possible matches found.")}catch{}this._resolveLoadWait();return}setTimeout(this.hookLoader.bind(this,M+1),250);return}const Y=window[j];if(Array.isArray(Y)){this._original_store=Y,this._original_loader=Y.push,this._processAllModules();try{Y.push=this.webpackJsonpv4.bind(this)}catch{this.log.warn("Unable to wrap webpackJsonp due to write protection."),this._resolveLoadWait();return}}else{this.log.error("webpackJsonp is of an unknown value. Unable to wrap."),this._resolveLoadWait();return}this._resolveLoadWait(this._original_loader);const ee=performance.now();this.log.info(`Hooked webpack loader after ${Math.round(100*(ee-this.start_time))/100}ms`)}webpackJsonpv4(M,...j){const Y=M[0].map(te=>typeof te!="string"?`${te}`:te),ee=M[1],X=Array.isArray(Y)?Y.map(te=>this._chunk_names[te]??te):null;this.log.verbose(`Twitch Chunk Loaded: ${Y} (${X?.join(", ")})`),this.log.verbose(`Modules: ${Object.keys(ee)}`);const Q=this._original_loader.call(this._original_store,M,...j);return ee&&this._processModulesV4(ee),Q}getRequire(){return this._require?Promise.resolve(this._require):(this._require_waiter||(this._require_waiter=new Promise(async(M,j)=>{let Y=await this.waitForLoader();Y=Y.bind(this._original_store);const ee=`ffz-loader$${(0,B.generateUUID)()}`;Y([[ee],{[ee]:(X,Q,te)=>{this._require=te,this._loadChunkNames(),M(this._require);const ne=performance.now();this.log.info(`Hooked webpack require after ${Math.round(100*(ne-this.start_time))/100}ms`),this._processAllModules(),this._require_waiter=null}},X=>X(ee)])})),this._require_waiter)}_loadChunkNames(){let M=null;if(this._require?.u){const j=this._require.u.toString(),Y=/assets\/"\+\(?({\d+:.*?})/.exec(j),ee=Y?Y[1].replace(/([\de]+):/g,(X,Q)=>{if(/^\d+e\d+$/.test(Q)){const te=Q.split("e");Q=parseInt(te[0],10)*10**parseInt(te[1],10)}return`"${Q}":`}):null;if(ee)try{M=JSON.parse(ee)}catch(X){console.log(ee),console.log(X)}}M?(this._chunk_names=M,this.log.debug(`Loaded names for ${Object.keys(M).length} chunks from require().`)):this.log.warn("Unable to find chunk names in require().")}_getNode(M){let j=this._graph[M];return j||(j=this._graph[M]={id:M,state:0,requires:null,dependants:null}),j}_processAllModules(){if(!(!this._require?.m||!this._original_store||this._processed_all)){this._processed_all=!0;for(const M of this._original_store)M&&M[1]&&this._processModulesV4(M[1])}}_processModulesV4(M){const j=this._require;let Y=!1;for(const ee of Object.keys(M)){const X=this._getNode(ee),Q=j?.m?.[ee];X.state!==0||!Q||(X.state=1,this._loaded_ids.add(ee),X.requires==null&&this._detectRequirements(X,Q),X.requires===!1&&(X.state=2,this._loaded_ids.delete(ee),this._pending_ready_ids.add(ee)),X.dependants&&X.dependants.size>0&&(Y=!0))}(Y||this._pending_ready_ids.size>0)&&this.scheduleGraphUpdate()}_detectRequirements(M,j){const Y=j.toString(),ee=/^function\([^,)]+,[^,)]+,([^,)]+)/.exec(Y);if(ee){const X=v(ee[1]),Q=new Set;X.lastIndex=0;let te;for(;te=X.exec(Y);){let ne=te[1];if(ne==="e")continue;if(/^\d+e\d+$/.test(ne)){const re=ne.split("e");ne=`${parseInt(re[0],10)*10**parseInt(re[1],10)}`}Q.add(ne);const fe=this._getNode(ne);fe.dependants??(fe.dependants=new Set),fe.dependants.add(M.id)}M.requires=Q.size>0?Q:!1}else M.requires=!1}scheduleGraphUpdate(){this._graph_update_raf||(this._graph_update_raf=requestAnimationFrame(this._processGraph))}_processGraph(){this._graph_update_raf=null;const M=performance.now(),j=this._pending_ready_ids.size;let Y=!0;for(;Y&&(Y=!1,this._loaded_ids.size!==0);){const X=g(this._graph,this._loaded_ids);for(const Q of X){if(Q.length===0)continue;let te=!0;for(const ne of Q){const fe=this._graph[ne];if(fe.requires)for(const re of fe.requires){if(Q.includes(re))continue;const ue=this._graph[re];if(!ue||ue.state!==2&&ue.state!==3){te=!1;break}}if(!te)break}if(te){Y=!0;for(const ne of Q){const fe=this._graph[ne];fe.state===1&&(fe.state=2,this._loaded_ids.delete(ne),this._pending_ready_ids.add(ne))}}}}const ee=performance.now();if(this.log.debug(`Processed graph in ${Math.round(100*(ee-M))/100}ms, found ${this._pending_ready_ids.size-j} newly ready modules. There are ${this._loaded_ids.size} remaining Loaded modules.`),this._pending_ready_ids.size){const X=this._pending_ready_ids;this._pending_ready_ids=new Set,this.emit(":new-ready",X)}}known(M,j){if(typeof M=="object"){for(const Y of Object.keys(M))this.known(Y,M[Y]);return}this._known_rules[M]=j}async findModule(M,j){return this._require||await this.getRequire(),this.getModule(M,j)}findDeep(M,j,Y=!0){if(M&&!Array.isArray(M)&&(M=[M]),!this._require||!this._original_store)throw new Error("We do not have webpack");const ee=[],X=this._chunk_names;for(const[Q,te]of this._original_store)for(const ne of Object.keys(te)){const fe=this._getNode(ne);if(!(fe.state!==2&&fe.state!==3))try{fe.state=3;const re=this._require(ne);if(re){for(const[ue,me]of Object.entries(re))if(me&&j(me,re,ue)){if(this.log.info(`Found in key "${ue}" of module "${ne}" (${this.chunkNameForModule(ne)})`),!Y)return re;ee.push(re);break}}}catch(re){this.log.warn("Exception while deep scanning webpack.",re)}}return ee.length?ee:(this.log.info("Unable to find deep scan target."),null)}getModule(M,j){if(typeof M=="function"&&(j=M,M=null),M&&this._mod_cache[M])return this._mod_cache[M];if(!j&&M&&(j=this._known_rules[M]),!j)throw new Error(`no known predicate for locating ${M}`);const Y=this._require;return Y?.m?this._newGetModule(M,j,Y):null}_chunksForModule(M){if(!this._original_store)return null;const j=new Set;for(const[Y,ee]of this._original_store)if(ee[M])for(const X of Y)j.add(X);return[...j]}chunkNameForModule(M){const j=this._chunksForModule(M);if(!j)return null;for(const Y of j){const ee=this._chunk_names[Y];if(ee)return ee}return null}chunkNamesForModule(M){const j=this._chunksForModule(M);return j?j.map(Y=>this._chunk_names[Y]||Y):null}_newGetModule(M,j,Y){if(!Y)return null;let ee;if(this._original_store&&j.chunks&&this._chunk_names&&Object.keys(this._chunk_names).length){const Q=typeof j.chunks=="function";!Q&&!Array.isArray(j.chunks)&&(j.chunks=[j.chunks]);const te=j.chunks,ne=this._chunk_names;let fe=[];for(const[re,ue]of this._original_store){let me=!1;for(const we of re)if(Q?te(ne[we],we):te.includes(we)||te.includes(String(we))||ne[we]&&te.includes(ne[we])){me=!0;break}me&&(fe=[...fe,...Object.keys(ue)])}ee=new Set(fe)}else ee=new Set(Object.keys(this._graph));let X=0;for(const Q of ee)try{X++;const te=this._getNode(Q);if(te.state!==2&&te.state!==3)continue;te.state=3;const ne=Y(Q);if(ne){const fe=j(ne);if(fe){this.log.debug(`Located module "${M}" in module ${Q}${I.DEBUG?` (${this.chunkNameForModule(Q)})`:""} after ${X} tries`);const re=j.use_result?fe:ne;return M&&(this._mod_cache[M]=re),re}}}catch(te){this.log.warn(`Unexpected error trying to find module '${Q}':`,te)}return this.log.debug(`Unable to locate module "${M}" despite checking ${X} modules`),null}};G(m,"WebMunch");let S=m;var n=d(17159);const A=class A extends L.default{constructor(M,j){super(M,j),this._pruneLive=this._pruneLive.bind(this),this._wrappers=new Map,this._observer=null,this._watching=new Set,this._live_watching=null,this.scheduleCleaning()}onDisable(){this._stopWatching()}define(M,j,Y,ee=null,X=0,Q=5e3,te=!0){if(this._wrappers.has(M))return this._wrappers.get(M);if(!j||typeof j!="string"||!j.length)throw new Error("cannot find definition and no selector provided");const ne=new l(M,j,Y,ee,X,Q,te,this);return this._wrappers.set(M,ne),ne}route(M){this._route=M,this._timer=Date.now(),this._updateLiveWatching(),this.checkAll(),this.cleanAll()}scheduleCleaning(){this._clean_timeout&&clearTimeout(this._clean_timeout),this._clean_timeout=setTimeout(()=>{this._clean_timeout=null,this.cleanAll(),this.scheduleCleaning()},1e3)}cleanAll(){this._clean_all&&cancelAnimationFrame(this._clean_all),this._clean_all=requestAnimationFrame(()=>{this._clean_all=null;for(const M of this._wrappers.values())M.clean()})}checkAll(){if(this._watching)for(const M of this._watching)M.check()}updateTimeout(){this._timer=Date.now(),this._updateLiveWatching(),this.checkAll()}_isActive(M,j){return!(M.routes===!1||this._route&&M.routes.length&&!M.routes.includes(this._route)||M.timeout>0&&j-this._timer>M.timeout)}_updateLiveWatching(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);const M=this._live_watching=[],j=Date.now();let Y=Number.POSITIVE_INFINITY;if(this._watching)for(const ee of this._watching)this._isActive(ee,j)&&(ee.timeout>0&&ee.timeout<Y&&(Y=ee.timeout),M.push(ee));isFinite(Y)&&(this._timeout=setTimeout(this._pruneLive,Y)),M.length?this._observer||this._startWatching():this._stopWatching()}_pruneLive(){this._updateLiveWatching()}_checkWatchers(M){if(this._live_watching)for(const j of this._live_watching)j.checkElements(M)}_startWatching(){!this._observer&&this._live_watching&&this._live_watching.length&&(this.log.info("Installing MutationObserver."),this._observer=new MutationObserver(M=>this._checkWatchers(M.map(j=>j.target))),this._observer.observe(document.body,{childList:!0,subtree:!0}))}_stopWatching(){this._observer&&(this.log.info("Stopping MutationObserver."),this._observer.disconnect()),this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._live_watching=null,this._observer=null}listen(M,j=!0){this._watching.has(M)||!j||(j&&(this._timer=Date.now()),this._watching.add(M),this._updateLiveWatching())}unlisten(M){this._watching.has(M)&&(this._watching.delete(M),this._updateLiveWatching())}};G(A,"Elemental");let s=A,i=0;const h=class h extends n.EventEmitter{constructor(M,j,Y,ee,X,Q,te,ne){super(),this.id=i++,this.param=`_ffz$elemental$${this.id}`,this.remove_param=`_ffz$elemental_remove$${this.id}`,this._schedule=this._schedule.bind(this),this.name=M,this.selector=j,this.routes=Y??[],this.opts=ee,this.limit=X,this.timeout=Q,this.check_removal=te,this.opts&&!this.opts.childList&&!this.opts.attributes&&!this.opts.characterData&&(this.opts.attributes=!0),this.count=0,this.instances=new Set,this.elemental=ne,this.check(),this.schedule()}get atLimit(){return this.limit>0&&this.count>=this.limit}clean(){const M=Array.from(this.instances);let j=!1;for(const Y of M)document.contains(Y)||(this.remove(Y,!1),j=!0);j&&((this.limit===0||this.count<this.limit)&&this.check(),this.schedule())}schedule(){this._stimer||(this._stimer=setTimeout(this._schedule,0))}_schedule(){this._stimer&&clearTimeout(this._stimer),this._stimer=null,this.limit===0||this.count<this.limit?this.elemental.listen(this):this.elemental.unlisten(this)}check(){const M=document.querySelectorAll(this.selector);for(const j of M)this.add(j)}checkElements(M){if(this.atLimit)return this.schedule();for(const j of M){const Y=j.querySelectorAll(this.selector);for(const ee of Y)this.add(ee);if(this.atLimit)return}}get first(){for(const M of this.instances)return M;return null}toArray(){return Array.from(this.instances)}each(M){for(const j of this.instances)M(j)}add(M){if(!this.instances.has(M)){if(this.instances.add(M),this.count++,this.check_removal&&M.parentNode){const j=new MutationObserver(()=>{requestAnimationFrame(()=>{document.contains(M)||this.remove(M)})});j.observe(M.parentNode,{childList:!0}),M[this.remove_param]=j}if(this.opts){const j=new MutationObserver(Y=>{document.contains(M)?this.__running.size||this.emit("mutate",M,Y):this.remove(M)});j.observe(M,this.opts),M[this.param]=j}this.schedule(),this.emit("mount",M)}}remove(M,j=!0){const Y=M[this.param];Y&&(Y.disconnect(),M[this.param]=null);const ee=M[this.remove_param];ee&&(ee.disconnect(),M[this.remove_param]=null),this.instances.has(M)&&(this.instances.delete(M),this.count--,j&&this.schedule(),this.emit("unmount",M))}};G(h,"ElementalWrapper");let l=h;var w=d(98247),b=d(45866),r=d(29632),e=d(27040);const T=class T extends n.FFZEvent{constructor(M){super(M),this._obj=void 0,this._changed=!1}markChanged(){this._changed=!0}get topic(){return this.event.topic}get message(){return this._obj===void 0&&(this._obj=JSON.parse(this.event.message)??null),this._obj}set message(M){this._obj=M,this._changed=!0}};G(T,"PubSubEvent");let a=T;const R=class R extends L.default{constructor(M,j){super(M,j),this.instance=null}onEnable(M=0){const j=window.__twitch_pubsub_client;if(!j){M>10?this.log.warn("Unable to find PubSub."):new Promise(Y=>setTimeout(Y,50)).then(()=>this.onEnable(M+1));return}j&&(this.instance=j,this.hookClient(j)),this.instance||this.log.warn("Unable to find a PubSub instance.")}handleMessage(M){try{if(M.type==="MESSAGE"&&M.data?.topic){const j=M.data.topic,Y=j.indexOf("."),ee=Y===-1?j:j.slice(0,Y),X=Y===-1?"":j.slice(Y+1),Q=new a({prefix:ee,trail:X,event:M.data});if(this.emit(":pubsub-message",Q),Q.defaultPrevented)return!0;Q._changed&&(M.data.message=JSON.stringify(Q._obj))}}catch(j){this.log.error("Error processing PubSub event.",j)}return!1}hookClient(M){const j=this,Y=M.onMessage;M.connection.removeAllListeners("message"),M.onMessage=function(Q){if(!j.handleMessage(Q))return Y.call(this,Q)},M.connection.addListener("message",M.onMessage);const ee=M.listen,X=M.unlisten;M.ffz_original_listen=ee,M.ffz_original_unlisten=X,M.listen=function(Q,te,...ne){const fe=Q.topic,re=fe&&!!M.topicListeners?._events?.[fe],ue=ee.call(this,Q,te,...ne);return fe&&!re&&j.emit(":add-topic",fe),ue},M.unlisten=function(Q,te,...ne){const fe=!!M.topicListeners?._events?.[Q],re=X.call(this,Q,te,...ne);return fe&&!M.topicListeners?._events?.[Q]&&j.emit(":remove-topic",Q),re}}simulateMessage(M,j){if(!this.instance)throw new Error("No PubSub instance available");this.instance.simulateMessage(M,JSON.stringify(j))}get topics(){const M=this.instance?.topicListeners?._events;return M?Object.keys(M):[]}};G(R,"Subpump");let p=R;var C=d(44589);const y=d.p+"main.css",P=class P extends W.Z{constructor(...M){super(...M),this.inject(S),this.inject(w.Z),this.inject(s),this.inject("router",b.Z),this.inject(r.default,!1),this.inject(e.default),this.inject(p),this._dom_updates=[]}async populateModules(){const M=await d(41152),j=await this.loadFromContext(M,this.log);this.log.info(`Loaded descriptions of ${Object.keys(j).length} modules.`)}async onLoad(){await this.populateModules(),this.web_munch.known(P.KNOWN_MODULES),this.router.route(P.ROUTES),this.router.routeName(P.ROUTE_NAMES),this.router.route("user","/:userName",null,M=>M?.channelView!=="Home"),this.router.route("user-home","/:userName",null,M=>M?.channelView==="Home"),this.router.route(P.DASH_ROUTES,"dashboard.twitch.tv"),this.router.route(P.PLAYER_ROUTES,"player.twitch.tv"),this.router.route(P.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){this.settings=this.resolve("settings"),this.web_munch.findModule("simplebar").then(te=>{!window.ffzSimplebar&&te&&(window.ffzSimplebar=te)}).catch(()=>{});const M=this.fine.searchNode(null,te=>te?.pendingProps?.store?.getState),j=this.store=M?.pendingProps?.store;if(!j)return new Promise(te=>setTimeout(te,50)).then(()=>this.onEnable());this.on(":dom-update",(...te)=>{this._dom_updates.push(te),this._dom_frame||(this._dom_frame=requestAnimationFrame(()=>{const ne=this._dom_updates,fe=this.resolve("core");this._dom_updates=[],this._dom_frame=null;for(const[re,ue]of ne){const me=this.fine.getChildNode(ue);fe.emit("core:dom-update",re,me,ue)}}))});const Y=G(()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}}),"update_size");window.addEventListener("resize",Y),Y();const ee=G(()=>{this.settings.updateContext({fullscreen:!!document.fullscreenElement}),this.emit(":fullscreen")},"update_fullscreen");document.addEventListener("fullscreenchange",ee),this.settings.updateContext({fullscreen:!!document.fullscreenElement}),j.subscribe(()=>this.updateContext()),this.updateContext(),this.router.on(":route",(te,ne)=>{this.log.info("Navigation",te&&te.name,ne&&ne[0]),this.fine.route(te&&te.name),this.elemental.route(te&&te.name),this.settings.updateContext({route:te,route_data:ne})});const X=this.router.current;this.fine.route(X&&X.name),this.elemental.route(X&&X.name),this.settings.updateContext({route:X,route_data:this.router.match}),document.head.appendChild((0,C.createElement)("link",{href:y,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}));const Q=new URL(window.location).searchParams;if(Q&&(Q.has("ffz-settings")&&this.resolve("main_menu").openExclusive(),Q.has("ffz-translate"))){const te=this.resolve("translation_ui");te.dialog.exclusive=!0,te.enable()}}updateContext(){try{const M=this.store.getState(),j=this.router?.reactLocation;this.settings.updateContext({location:j,ui:M&&M.ui,session:M&&M.session,chat:M&&M.chat})}catch(M){this.log.error("Error updating context.",M)}}getSession(){const M=this.store&&this.store.getState();return M&&M.session}getUser(){if(this._user)return this._user;const M=this.getSession();return this._user=M&&M.user}getCore(){return this._core||(this._core=this.web_munch.getModule("core")),this._core}};G(P,"Twilight");let z=P;const $="_calculateChangedBits";z.KNOWN_MODULES={simplebar:O=>O.globalObserver&&O.initDOMLoadedElements,react:O=>O.Component&&O.createElement,"react-dom":O=>O.createRoot&&O.createPortal,core:O=>{if(O.x2?.experiments&&O.x2.intl)return O.x2;if(O.$6?.experiments)return O.$6;if(O.p?.experiments)return O.p;if(O.o?.experiments)return O.o;if(O.q?.experiments)return O.q},cookie:O=>O&&O.set&&O.get&&O.getJSON&&O.withConverter,"extension-service":O=>O.extensionService,"callout-types":O=>{if(O.o?.ClipLiveNudge&&O.o?.Drop&&O.o?.ShareResub)return O.o},"chat-types":O=>{if((0,B.has)(O.ZW,"Message")&&(0,B.has)(O.ZW,"RoomMods"))return{automod:O.sq,chat:O.ZW,message:O.IF,mod:O.RB};if((0,B.has)(O.b,"Message")&&(0,B.has)(O.b,"RoomMods"))return{automod:O.a,chat:O.b,message:O.c,mod:O.e};if((0,B.has)(O.SJ,"Message")&&(0,B.has)(O.SJ,"RoomMods"))return{automod:O.mT,chat:O.SJ,message:O.Ay,mod:O.Aw}},"gql-printer":O=>{if(O!==window){if(O.print&&O.print.toString().includes(".visit"))return O.print;if(O.S&&O.S.toString().includes(".visit"))return O.S}},"user-report":O=>O.Z?.displayName==="Loadable(ReportUserModal)"&&O.Z,"sub-form":O=>typeof O.T=="function"&&String(O.T).includes("CheckoutModal")&&O.T,mousetrap:O=>O.bindGlobal&&O.unbind&&O.handleKey,"algolia-search":O=>{if(O.a?.prototype?.queryTopResults&&O.a.prototype.queryForType)return O.a;if(O.w9?.prototype?.queryTopResults&&O.w9.prototype.queryForType)return O.w9},calloutstack:O=>{if((0,B.has)(O.at?._currentValue,"callouts")&&typeof O.at._currentValue.pinCallout=="function")return{stack:O.at}},highlightstack:O=>{if((0,B.has)(O.g$?._currentValue,"highlights")&&typeof O.SP?._currentValue=="function")return{stack:O.g$,dispatch:O.SP};if((0,B.has)(O.b,$)&&(0,B.has)(O.c,$))return{stack:O.b,dispatch:O.c};if((0,B.has)(O.fQ,$)&&(0,B.has)(O.vJ,$))return{stack:O.fQ,dispatch:O.vJ};if((0,B.has)(O.fQ?._currentValue,"highlights")&&typeof O.vJ?._currentValue=="function")return{stack:O.fQ,dispatch:O.vJ}}};const o=G(O=>!O||O.includes("vendor")||O.includes("core"),"VEND_CORE");z.KNOWN_MODULES.core.use_result=!0,z.KNOWN_MODULES.core.skip_cache=!0,z.KNOWN_MODULES.simplebar.chunks=o,z.KNOWN_MODULES.react.chunks=o,z.KNOWN_MODULES.cookie.chunks=o,z.KNOWN_MODULES["gql-printer"].use_result=!0,z.KNOWN_MODULES["gql-printer"].chunks=o,z.KNOWN_MODULES.mousetrap.chunks=o;const c=G(O=>!O||O.includes("chat"),"CHAT_CHUNK");z.KNOWN_MODULES["callout-types"].use_result=!0,z.KNOWN_MODULES["chat-types"].use_result=!0,z.KNOWN_MODULES["chat-types"].chunks=c,z.KNOWN_MODULES.calloutstack.use_result=!0,z.KNOWN_MODULES.highlightstack.use_result=!0,z.KNOWN_MODULES.highlightstack.chunks=c,z.KNOWN_MODULES["algolia-search"].use_result=!0,z.KNOWN_MODULES["algolia-search"].chunks="core",z.KNOWN_MODULES["user-report"].use_result=!0,z.KNOWN_MODULES["user-report"].chunks=O=>!O||O.includes("core")||O.includes("common"),z.KNOWN_MODULES["sub-form"].use_result=!0,z.KNOWN_MODULES["sub-form"].chunks="core",z.POPOUT_ROUTES=["embed-chat","popout","dash-popout-chat","mod-popout-chat"],z.CHAT_ROUTES=["collection","popout","dash-chat","video","user-video","user-home","user-clip","user-videos","user-clips","user-events","user-followers","user-following","user","dash","embed-chat","squad","command-center","dash-stream-manager","dash-popout-chat","mod-view","mod-popout-chat"],z.ROUTE_NAMES={dir:"Browse","dir-following":"Following","dir-all":"Browse Live Channels",dash:"Dashboard",popout:"Popout Chat","dash-popout-chat":"Dashboard Popout Chat","user-video":"Channel Video","popout-player":"Popout/Embed Player"},z.SUNLIGHT_ROUTES=["dash-stream-manager","dash-channel-analytics","dash-stream-summary","dash-achievements","dash-roles","dash-activity","dash-channel-points","dash-video-producer","dash-edit-video","dash-collections","dash-edit-collection","dash-clips","dash-settings-moderation","dash-settings-channel","dash-settings-revenue","dash-extensions","dash-streaming-tools"],z.PLAYER_ROUTES={"popout-player":"/"},z.CLIP_ROUTES={"clip-page":"/:slug"},z.DASH_ROUTES={"dash-stream-manager":"/u/:userName/stream-manager","dash-channel-analytics":"/u/:userName/channel-analytics","dash-stream-summary":"/u/:userName/stream-summary","dash-achievements":"/u/:userName/achievements","dash-roles":"/u/:userName/community/roles","dash-activity":"/u/:userName/community/activity","dash-channel-points":"/u/:userName/community/channel-points","dash-video-producer":"/u/:userName/content/video-producer","dash-edit-video":"/u/:userName/content/video-producer/edit/:videoID","dash-collections":"/u/:userName/content/collections","dash-edit-collection":"/u/:userName/content/collections/:collectionID","dash-clips":"/u/:userName/content/clips","dash-settings-moderation":"/u/:userName/settings/moderation","dash-settings-channel":"/u/:userName/settings/channel","dash-settings-revenue":"/u/:userName/settings/revenue","dash-extensions":"/u/:userName/extensions","dash-streaming-tools":"/u/:userName/broadcast","dash-popout-chat":"/popout/u/:userName/stream-manager/chat"},z.ROUTES={"front-page":"/",collection:"/directory/collection/:collectionID",dir:"/directory","dir-gaming":"/directory/gaming","dir-irl":"/directory/irl","dir-music":"/directory/music","dir-creative":"/directory/creative","dir-esports":"/directory/esports","dir-following":"/directory/following/:category?","dir-game-index":"/directory/category/:gameName","dir-game-clips":"/directory/category/:gameName/clips","dir-game-videos":"/directory/category/:gameName/videos/:filter","dir-all":"/directory/all/:filter?",dash:"/:userName/dashboard/:live?",event:"/event/:eventName",popout:"/popout/:userName/chat",video:"/videos/:videoID","user-video":"/:userName/video/:videoID","user-videos":"/:userName/videos/:filter?","user-clips":"/:userName/clips","user-clip":"/:userName/clip/:clipID","user-collections":"/:userName/collections","user-events":"/:userName/events","user-followers":"/:userName/followers","user-following":"/:userName/following",product:"/products/:productName",prime:"/prime",turbo:"/turbo",search:"/search",squad:"/:userName/squad","command-center":"/:userName/commandcenter","embed-chat":"/embed/:userName/chat","mod-view":"/moderator/:userName","mod-popout-chat":"/popout/moderator/:userName/chat","drops-inventory":"/drops/inventory","drops-campaigns":"/drops/campaigns"},z.DIALOG_EXCLUSIVE=".moderation-root,.sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root,#root",z.DIALOG_MAXIMIZED='.moderation-view-page > div[data-highlight-selector="main-grid"],.sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area,.teams-page-body__outer-container .scrollable-area',z.DIALOG_SELECTOR=".moderation-root,.sunlight-root,#root,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area"},24531:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>L});var W=d(22527);const B=class B extends W.default{constructor(...U){super(...U),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.settings.add("layout.display-bits-button",{requires:["chat.bits.show"],default:null,process(D,v){return v??D.get("chat.bits.show")},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the Get Bits button.",description:"By default, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering)",component:"setting-check-box"},changed:()=>this.BitsButton.forceUpdate()}),this.BitsButton=this.fine.define("bits-button",D=>D.toggleBalloon&&D.toggleShowTutorial)}onEnable(){this.BitsButton.ready(U=>{const D=this,v=U.prototype.render;U.prototype.render=function(){return D.settings.get("layout.display-bits-button")?v.call(this):null},this.BitsButton.forceUpdate()})}};G(B,"BitsButton");let L=B},11746:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>I});var W=d(46949),L=d(22527);const B=["chat-input"],U=class U extends L.default{constructor(...v){super(...v),this.inject("settings"),this.should_enable=!0}onEnable(){this.on("core:dom-update",this.handleDomUpdate,this),this.hookSettings()}awaitSettings(v=0){return window.BetterTTV?.settings?window.BetterTTV.settings:v>100?Promise.reject():(0,W.sleep)(50).then(()=>this.awaitSettings(v+1))}async hookSettings(){const v=await this.awaitSettings(),f=G(()=>this.updateContext(v),"waiter");if(v.on("changed.clickTwitchEmotes",f),v.on("changed.bttvGIFEmotes",f),f(),v.get("ffzEmotes")){if(this.settings.provider.get("bttv-ffz-notice"))return;const u=this.resolve("site.menu_button");u&&(u.addToast({icon:"ffz-i-zreknarf",text_i18n:"compat.bttv.emotes-on",text:`You have "FrankerFaceZ Emotes" turned on in BetterTTV's settings, but you also have FrankerFaceZ installed. Please disable "FrankerFaceZ Emotes" in BetterTTV's settings. It isn't necessary.`}),this.settings.provider.set("bttv-ffz-notice",!0))}}updateContext(v){this.settings.updateContext({bttv:{loaded:!0,emote_menu:v.get("clickTwitchEmotes"),gifs:v.get("bttvGIFEmotes")}})}handleDomUpdate(v){if(window.BetterTTV?.watcher?.emitLoad&&B.includes(v)){this.log.info("Sending chat reload event to BetterTTV.");try{window.BetterTTV.watcher.emitLoad("chat")}catch(f){this.log.error("An error occurred with BetterTTV:",f)}}}};G(U,"BTTVCompat");let I=U},74756:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>D});var W=d(22527),L=d(14873),B=d(46949),I=d(44589);const U=["user","user-home","user-about","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],v=class v extends W.default{constructor(...u){super(...u),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.inject("site.subpump"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.settings.add("channel.auto-click-off-featured",{default:!1,ui:{path:"Channel > Behavior >> General",title:`Automatically un-check "Featured Clips Only" when viewing a channel's clips.`,component:"setting-check-box"}}),this.settings.add("channel.panel-tips",{default:!1,ui:{path:"Channel > Behavior >> Panels",title:"Display rich tool-tips for links in channel panels.",component:"setting-check-box"},changed:g=>{this.updatePanelTips(),this.css_tweaks.toggle("panel-links",g)}}),this.settings.add("channel.auto-skip-trailer",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically skip channel trailers.",component:"setting-check-box"},changed:g=>{g&&this.ChannelTrailer.each(S=>this.maybeSkipTrailer(S))}}),this.settings.add("channel.auto-click-chat",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically open chat when opening an offline channel page.",component:"setting-check-box"}}),this.settings.add("channel.extra-links",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Add extra links to live channel pages, next to the streamer's name.",component:"setting-check-box"},changed:()=>this.updateLinks()}),this.ChannelPanels=this.fine.define("channel-panels",g=>g.layoutMasonry&&g.updatePanelOrder&&g.onExtensionPoppedOut,U),this.ChannelTrailer=this.elemental.define("channel-trailer",".channel-trailer-player__wrapper",U,{attributes:!0},1),this.ChannelRoot=this.elemental.define("channel-root",".channel-root",U,{attributes:!0},1),this.InfoBar=this.elemental.define("channel-info-bar","#live-channel-stream-information",U,{childNodes:!0,subtree:!0},1)}onEnable(){this.updateChannelColor(),this.css_tweaks.toggle("panel-links",this.settings.get("channel.panel-tips")),this.on("i18n:update",this.updateLinks,this),this.ChannelTrailer.on("mount",this.maybeSkipTrailer,this),this.ChannelTrailer.on("update",this.maybeSkipTrailer,this),this.ChannelTrailer.each(u=>this.maybeSkipTrailer(u)),this.ChannelPanels.on("mount",this.updatePanelTips,this),this.ChannelPanels.on("update",this.updatePanelTips,this),this.ChannelPanels.on("unmount",this.removePanelTips,this),this.ChannelPanels.ready((u,g)=>{for(const S of g)this.updatePanelTips(S)}),this.ChannelRoot.on("mount",this.updateRoot,this),this.ChannelRoot.on("mutate",this.updateRoot,this),this.ChannelRoot.on("unmount",this.removeRoot,this),this.ChannelRoot.each(u=>this.updateRoot(u)),this.InfoBar.on("mount",this.updateBar,this),this.InfoBar.on("mutate",this.updateBar,this),this.InfoBar.on("unmount",this.removeBar,this),this.InfoBar.each(u=>this.updateBar(u)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}maybeSkipTrailer(u){if(!this.settings.get("channel.auto-skip-trailer"))return;const g=this.fine.searchParent(u,S=>S.props&&S.props.onDismiss);g&&(this.log.info("Automatically skipping channel trailer."),g.props.onDismiss())}updatePanelTips(u){if(!u){for(const S of this.ChannelPanels.instances)S&&this.updatePanelTips(S);return}const g=this.fine.getChildNode(u);if(!g||!this.settings.get("channel.panel-tips"))return this.removePanelTips(u);if(u._ffz_tips&&u._ffz_tip_el!==g&&this.removePanelTips(u),!u._ffz_tips){const S=this.resolve("tooltips");S&&(u._ffz_tips=S._createInstance(g,"tw-link","link",S.getRoot()),u._ffz_tip_el=g)}}removePanelTips(u){u?._ffz_tips&&(u._ffz_tips.destroy(),u._ffz_tips=null,u._ffz_tip_el=null)}checkFeaturedClips(){this.router.current_name!=="user-clips"&&this.router.current_name!=="user-videos"||this._featured_waiting||!this.settings.get("channel.auto-click-off-featured")||(this._featured_waiting=this.parent.awaitElement("input#featured-clips-toggle").then(u=>{u.checked&&u.click(),this._featured_waiting=!1}).catch(()=>{this._featured_waiting=!1}))}checkNavigation(){this.checkFeaturedClips(),!(!this.settings.get("channel.auto-click-chat")||this.router.current_name!=="user-home")&&this.router.old_location!==this.router.location&&this.router.replace(this.router.location,{channelView:"Watch"})}updateLinks(){for(const u of this.InfoBar.instances)u._ffz_link_login=null,this.updateBar(u)}updateSubscription(u,g){this._subbed_login===g&&this._subbed_id===u||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),u&&(this.pubsub.subscribe(this,`twitch/${u}`),this._subbed_id=u),g&&(this.socket.subscribe(this,`channel.${g}`),this._subbed_login=g))}updateBar(u){u._ffz_update||(u._ffz_update=(0,B.debounce)(()=>requestAnimationFrame(()=>this._updateBar(u)),1e3,2)),u._ffz_update()}_updateBar(u){u._ffz_cont&&!document.contains(u._ffz_cont)&&(u._ffz_cont.classList.remove("ffz--meta-tray"),u._ffz_cont=null);const g=this.settings.get("channel.extra-links");u._ffz_links&&(!document.contains(u._ffz_links)||!g)&&(u._ffz_links.remove(),u._ffz_links=null,u._ffz_link_login=null);let S=u.querySelector(".ffz--native-viewers-container");if(!S){let r=0,e=u.querySelector('p[data-a-target="animated-channel-viewers-count"]');for(;e&&e!=u&&r<5;){if(e.querySelector("svg")){e.classList.add("ffz--native-viewers-container"),S=e;break}e=e.parentElement,r++}}if(!u._ffz_cont){let r=u.querySelector('.report-button,button[data-test-selector="video-options-button"],button[data-test-selector="clip-options-button"],button[data-a-target="report-button-more-button"]');!r&&S&&(r=S.parentElement);let e=r&&(r.closest(".tw-flex-wrap.tw-justify-content-end")||r.closest(".tw-justify-content-end"));!e&&r&&(e=r.parentElement?.parentElement,e&&e.parentElement?.childElementCount===2&&r.dataset.aTarget!=="report-button-more-button"&&(e=e.parentElement.firstElementChild)),e&&u.contains(e)?(u._ffz_cont=e,e.classList.add("ffz--meta-tray")):u._ffz_cont=null}if(!u._ffz_links&&g){const r=u.querySelector("a .tw-title"),e=r&&r.closest("a"),a=e&&e.closest("div");a&&u.contains(a)&&(u._ffz_links=(0,I.createElement)("div",{class:"ffz--links tw-mg-l-1"}),a.appendChild(u._ffz_links))}const n=this.fine.getReactInstance(u);let s=n?.child?.memoizedProps;s?.channelLogin||(s=s?.children?.props);const i=s?.watchPartyProps?.isShowingWatchPartyInMain;if(this.settings.updateContext({isWatchParty:i}),!u._ffz_cont||!s?.channelID){this.updateSubscription(null,null);return}if(u._ffz_links&&s.channelLogin!==u._ffz_link_login){const r=u._ffz_link_login=s.channelLogin;if(r){const e=G((a,p)=>{const C=(0,I.createElement)("a",{href:a,class:"tw-c-text-alt-2 tw-interactive tw-pd-x-1 tw-font-size-5"},p);return C.addEventListener("click",y=>{y.ctrlKey||y.shiftKey||y.altKey||(y.preventDefault(),this.router.push(a))}),C},"make_link");u._ffz_links.closest(".home-header-sticky")?u._ffz_links.innerHTML="":(0,I.setChildren)(u._ffz_links,[e(`/${r}/schedule`,this.i18n.t("channel.links.schedule","Schedule")),e(`/${r}/videos`,this.i18n.t("channel.links.videos","Videos")),e(`/${r}/clips`,this.i18n.t("channel.links.clips","Clips"))])}else u._ffz_links.innerHTML=""}let l=null;this.fine.searchNode(n,r=>{let e=r?.memoizedState,a=0;for(;e!=null&&l==null&&a<50;)l=e?.memoizedState?.current?.result?.data?.user??e?.memoizedState?.current?.previousData?.user,l?.lastBroadcast?.game||(l=null),l||(e=e?.next),a++;return l!=null});const w=l?.lastBroadcast?.game,b=l?.lastBroadcast?.title;(w?.id!==u._ffz_game_cache||b!==u._ffz_title_cache)&&this.settings.updateContext({category:w?.displayName,categoryID:w?.id,title:b}),this.updateSubscription(s.channelID,s.channelLogin),this.updateMetadata(u),this.emit(":update-bar",u,s,l)}removeBar(u){if(this.updateSubscription(null,null),u._ffz_cont&&u._ffz_cont.classList.remove("ffz--meta-tray"),u._ffz_cont=null,u._ffz_meta_timers){for(const g of Object.values(u._ffz_meta_timers))clearTimeout(g);u._ffz_meta_timers=null}u._ffz_update=null}updateMetadata(u,g){const S=u._ffz_cont;let s=this.fine.getReactInstance(u)?.memoizedProps?.children?.props;if(s&&!s.channelID&&(s=s.children?.props),!S||!document.contains(S)||!s||!s.channelID)return;g?Array.isArray(g)||(g=[g]):g=this.metadata.keys;const i=u._ffz_meta_timers=u._ffz_meta_timers||{},l=G(b=>this.updateMetadata(u,b),"refresh_fn"),w={channel:{id:s.channelID,login:s.channelLogin,display_name:s.displayName,live:s.isLive&&!s.videoID&&!s.clipSlug,video:!!(s.videoID||s.clipSlug),live_since:s.liveSince},props:s,el:u,getViewerCount:()=>{const b=S.querySelector('p[data-a-target="animated-channel-viewers-count"]'),r=b&&this.fine.getReactInstance(b),e=r?.memoizedProps?.children;if(typeof e=="string"&&/^[0-9,.]+$/.test(e))try{const p=parseInt(e.replace(/[\.,]+/,""),10);if(!isNaN(p)&&isFinite(p)&&p>0)return p}catch{}const a=e?.props;return a&&a.value!=null?a.value:0},getUserSelfImmediate:b=>{const r=this.getUserSelf(u,s.channelID,!0);return r&&r.then?(r.then(b),null):r},getUserSelf:()=>this.getUserSelf(u,s.channelID),getBroadcastID:()=>this.getBroadcastID(u,s.channelID)};for(const b of g)this.metadata.renderLegacy(b,w,S,i,l)}updateRoot(u){const g=this.fine.getReactInstance(u);let S=null,n=g,s=0,i=0;for(;n!=null&&S==null&&s<10;){let l=n?.memoizedState;for(i=0;l!=null&&S==null&&i<50;)S=l?.memoizedState?.current?.result?.data?.userOrError??l?.memoizedState?.current?.previousData?.userOrError,S||(l=l?.next),i++;n=n?.return,s++}S&&S.id?(this.updateChannelColor(S.primaryColorHex),this.settings.updateContext({channel:S.login,channelID:S.id,channelColor:S.primaryColorHex})):this.removeRoot()}removeRoot(){this.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateChannelColor(u){let g=u&&L.Color.RGBA.fromHex(u);g||(g=L.Color.RGBA.fromHex("9147FF")),g?(this.css_tweaks.setVariable("channel-color",g.toCSS()),this.css_tweaks.setVariable("channel-color-20",g._a(.2).toCSS()),this.css_tweaks.setVariable("channel-color-30",g._a(.3).toCSS())):(this.css_tweaks.deleteVariable("channel-color"),this.css_tweaks.deleteVariable("channel-color-20"),this.css_tweaks.deleteVariable("channel-color-30"))}getUserSelf(u,g,S){const n=u._ffz_self_cache=u._ffz_self_cache||{};return g===n.channel_id&&Date.now()-n.saved<6e4?S?n.data:Promise.resolve(n.data):new Promise(async(s,i)=>{if(n.updating){n.updating.push([s,i]);return}n.channel_id=g,n.updating=[[s,i]];let l,w;try{l=await this.twitch_data.getUserSelf(g)}catch(r){l=null,w=r}const b=n.updating;if(n.updating=null,n.channel_id!==g){w=new Error("Outdated"),n.channel_id=null,n.data=null,n.saved=0;for(const r of b)r[1](w);return}n.data=l,n.saved=Date.now();for(const r of b)w?r[1](w):r[0](l)})}getBroadcastID(u,g){const S=u._ffz_bcast_cache=u._ffz_bcast_cache||{};return g===S.channel_id&&Date.now()-S.saved<6e4?Promise.resolve(S.broadcast_id):new Promise(async(n,s)=>{if(S.updating){S.updating.push([n,s]);return}S.channel_id=g,S.updating=[[n,s]];let i,l;try{i=await this.twitch_data.getBroadcastID(g)}catch(b){i=null,l=b}const w=S.updating;if(S.updating=null,S.channel_id!==g){l=new Error("Outdated"),S.channel_id=null,S.broadcast_id=null,S.saved=0;for(const b of w)b[1](l);return}S.broadcast_id=i,S.saved=Date.now();for(const b of w)l?b[1](l):b[0](i)})}};G(v,"Channel");let D=v},6172:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>oe,formatBitsConfig:()=>ie});var W=d(14873),L=d(46949),B=d(24431),I=d(83342),U=d(6170),D=d(22527),v=d(43874);const f=["touchmove","scroll","wheel","mousewheel","DOMMouseScroll"];let u=0;const pe=class pe extends D.default{constructor(..._){super(..._),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject("site.web_munch"),this.ChatScroller=this.fine.define("chat-scroller",F=>F.saveScrollRef&&F.handleScrollEvent&&!F.renderLines&&F.resume,v.Z.CHAT_ROUTES),this.settings.add("chat.scroller.freeze",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Pause Chat Scrolling",description:`Automatically stop chat from scrolling when moving the mouse over it or holding a key.

**Note:** Scrolling up in chat will always prevent automatic scrolling, regardless of this setting.`,component:"setting-select-box",data:[{value:0,title:"Use Twitch Setting"},{value:1,title:"On Hover"},{value:2,title:"When Ctrl is Held"},{value:3,title:"When Meta is Held"},{value:4,title:"When Alt is Held"},{value:5,title:"When Shift is Held"},{value:6,title:"Ctrl or Hover"},{value:7,title:"Meta or Hover"},{value:8,title:"Alt or Hover"},{value:9,title:"Shift or Hover"}]}}),this.settings.add("chat.scroller.freeze-requires-hover",{default:!0,ui:{path:"Chat > Behavior >> Scrolling",title:"Require the mouse to be over chat to freeze with a hotkey.",component:"setting-check-box"}}),this.settings.add("chat.scroller.hover-delay",{default:750,ui:{path:"Chat > Behavior >> Scrolling",title:"Hover Timeout",description:"Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.",component:"setting-combo-box",data:[{value:250,title:"0.25 Seconds"},{value:500,title:"0.50 Seconds"},{value:750,title:"0.75 Seconds"},{value:1e3,title:"1 Second"},{value:2500,title:"2.5 Seconds"},{value:5e3,title:"5 Seconds"}]}}),this.settings.add("chat.scroller.smooth-scroll",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Smooth Scrolling",description:`**Note:** This may not behave well depending on your browser. Disable this if you encounter issues.

Smoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.`,component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Slow"},{value:2,title:"Medium"},{value:3,title:"Fast"},{value:4,title:"Very Fast"}]}})}updateUseKeys(){const _=this.use_keys;this.use_keys=!1;for(const F of this.chat.context.get("chat.actions.inline"))if(F&&F.display&&F.display.keys){this.use_keys=!0;break}for(const F of this.chat.context.get("chat.actions.hover"))if(F&&F.display&&F.display.keys){this.use_keys=!0;break}if(this.use_keys!==_)for(const F of this.ChatScroller.instances)F&&F.ffzUpdateKeys&&F.ffzUpdateKeys()}async onEnable(){this.on("i18n:update",()=>this.ChatScroller.forceUpdate()),this.chat.context.on("changed:chat.actions.inline",this.updateUseKeys,this),this.updateUseKeys(),this.pause_hover=this.chat.context.get("chat.scroller.freeze-requires-hover"),this.chat.context.on("changed:chat.scroller.freeze-requires-hover",H=>{this.pause_hover=H;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.pause_delay=this.chat.context.get("chat.scroller.hover-delay"),this.chat.context.on("changed:chat.scroller.hover-delay",H=>{this.pause_delay=H;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.pause=this.chat.context.get("chat.scroller.freeze"),this.chat.context.on("changed:chat.scroller.freeze",H=>{this.pause=H;for(const V of this.ChatScroller.instances)V.ffzMaybeUnpause()}),this.smooth_scroll=this.chat.context.get("chat.scroller.smooth-scroll"),this.chat.context.on("changed:chat.scroller.smooth-scroll",H=>{this.smooth_scroll=H;for(const V of this.ChatScroller.instances)V.ffzSetSmoothScroll(H)});const _=this,F=await this.site.findReact(),K=F?.createElement;if(!K)return _.log.warn("Unable to get React.");this.ChatScroller.ready((H,V)=>{const E=H.prototype.componentDidCatch,x=H.prototype.render;H.prototype.componentDidCatch=function(k,N){const Z=this.state.ffz_errors||0;if(Z<100&&(this.setState({ffz_errors:Z+1,ffz_total_errors:(this.state.ffz_total_errors||0)+1}),_.log.capture(k,{extra:N}),_.log.info("Error within Chat",k,N,Z)),E)return E.call(this,k,N)},H.prototype.ffzZeroErrors=function(){this.setState({ffz_errors:0})},H.prototype.render=function(){if(this.state.ffz_errors>0){let k;const N=this.state.ffz_total_errors<10,Z=G(()=>{clearTimeout(k),this.ffzZeroErrors()},"handler");return N&&(k=setTimeout(Z,250)),K?K("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},[K("div",{className:"tw-mg-b-1"},"There was an error displaying chat."),!N&&K("button",{className:"tw-button",onClick:Z},K("span",{className:"tw-button__text"},"Try Again"))]):null}else{const k=x.call(this);try{const N=k?.props?.children?.props?.children;N?.[2]?.type?.displayName==="ChatPausedFooter"&&(N[2]=this.ffzRenderFooter())}catch{}return k}},H.prototype.ffzInstallCleaner=function(){this._ffz_cleaner||(this._ffz_cleaner=this.ffzOnClean.bind(this),this._ffz_clean_timer=setInterval(this._ffz_cleaner,6e4))},H.prototype.ffzOnClean=function(){const k=_.fine.getChildNode(this);if(!k)return this.ffzRemoveCleaner();requestAnimationFrame(()=>_.cleanMessages(k.querySelector(".chat-scrollable-area__message-container")))},H.prototype.ffzRemoveCleaner=function(){this._ffz_clean_timer&&clearInterval(this._ffz_clean_timer),this._ffz_clean_timer=this._ffz_cleaner=null},H.prototype.ffzInstallHandler=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const k=this;k.ffz_oldScrollEvent=k.handleScrollEvent,k.ffz_oldScroll=k.scrollToBottom,k.ffz_acting=!1,k.ffz_outside=!0,k._ffz_accessor=`_ffz_contains_${u++}`,_.on("tooltips:hover",this.ffzTooltipHover,this),_.on("tooltips:leave",this.ffzTooltipLeave,this),k.scrollToBottom=function(){k._ffz_scroll_request||(k._ffz_scroll_request=requestAnimationFrame(k._scrollToBottom))},k._scrollToBottom=function(){k._ffz_scroll_request=null,k.state.isPaused||(k.ffz_smooth_scroll&&!k._ffz_one_fast_scroll?k.ffzSmoothScroll():(k._ffz_one_fast_scroll=!1,k.ffz_oldScroll()))},k.handleScrollEvent=function(_e){if(!k.scrollRef?.scrollContent||!(_e.which>0||_e.type==="mousewheel"||_e.type==="wheel"||_e.type==="touchmove"))return;const q=k.scrollRef.scrollContent,le=q.scrollHeight-q.scrollTop-q.offsetHeight,he=le>10;he!==k.state.ffz_scrolled_up&&k.setState({ffz_scrolled_up:he}),k.state.isPaused&&he&&k.setLoadMoreEnabled(!0),k.state.isPaused&&!he?k.ffzMaybeUnpause():!k.state.isPaused&&he&&k.pause()};const N=k.resume;k.ffzFastResume=function(){k._ffz_one_fast_scroll=!0,k.resume()},k.resume=function(){k.setState({ffz_scrolled_up:!1}),N.call(this)};const Z=_.web_munch.getModule("mousetrap")||window.Mousetrap;Z!=null&&(Z.unbind("alt","keydown"),Z.unbind("alt","keyup")),k.ffzHandleKey=k.ffzHandleKey.bind(k),window.addEventListener("keydown",k.ffzHandleKey),window.addEventListener("keyup",k.ffzHandleKey),k.hoverPause=k.ffzMouseMove.bind(k),k.hoverResume=k.ffzMouseLeave.bind(k);const se=_.fine.getChildNode(k);se&&se.addEventListener("mousemove",k.hoverPause);const de=this.scrollRef?.scrollContent;if(de)for(const _e of f)de.removeEventListener(_e,k.ffz_oldScrollEvent),de.addEventListener(_e,k.handleScrollEvent);k.forceUpdate(),_.emit("site:dom-update","chat-scroller",k)},H.prototype.ffzSmoothScroll=function(){this._ffz_smooth_animation&&cancelAnimationFrame(this._ffz_smooth_animation),this.ffz_is_smooth_scrolling=!0;let k=this.ffz_smooth_scroll,N=performance.now();const Z=this.scrollRef?.scrollContent;if(!Z)return;const se=Z.scrollHeight-Z.clientHeight,de=se-Z.scrollTop;de>Z.clientHeight?k=de:de>200&&(k+=k*Math.floor(de/200));const _e=G(()=>{if(this.state.isPaused)return this.ffz_is_smooth_scrolling=!1;const q=performance.now(),le=q-N,he=k*(le/10);if(he>=1){const be=Z.scrollTop,Ce=be+he,ze=Z.scrollHeight-Z.clientHeight;N=q,Ce<ze?(Z.scrollTop=be+he,this._ffz_smooth_animation=requestAnimationFrame(_e)):(Z.scrollTop=ze,this.ffz_is_smooth_scrolling=!1)}else this._ffz_smooth_animation=requestAnimationFrame(_e)},"smoothAnimation");_e()},H.prototype.ffzSetSmoothScroll=function(k){this.ffz_smooth_scroll=k,this.ffzMaybeUnpause()},H.prototype.ffzReadKeysFromEvent=function(k){return k.altKey===this.ffz_alt&&k.shiftKey===this.ffz_shift&&k.ctrlKey===this.ffz_ctrl&&k.metaKey===this.ffz_meta?!1:(this.ffz_alt=k.altKey,this.ffz_shift=k.shiftKey,this.ffz_ctrl=k.ctrlKey,this.ffz_meta=k.metaKey,!0)},H.prototype.ffzHandleKey=function(k){if(!this.ffzReadKeysFromEvent(k)||(this.ffzUpdateKeyTags(),_.pause_hover&&this.ffz_outside||this.ffzGetMode()<2))return;const N=this.ffzShouldBePaused();N!==this.state.isPaused&&(N?(this.pause(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},H.prototype.ffzInstallHoverTimer=function(){this._ffz_hover_timer||(this._ffz_hover_timer=setInterval(()=>{this.state.isPaused&&this.ffzShouldBePaused()||this.ffzMaybeUnpause()},50))},H.prototype.ffzMouseMove=function(k){this.ffz_last_move=Date.now();const N=this.ffz_outside;this.ffz_outside=!1,this._ffz_outside_timer&&(clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=null);const Z=this.ffzReadKeysFromEvent(k);if(!Z&&k.screenX===this.ffz_sx&&k.screenY===this.ffz_sy){N&&this.ffzUpdateKeyTags();return}this.ffz_sx=k.screenX,this.ffz_sy=k.screenY,(Z||N)&&this.ffzUpdateKeyTags();const se=this.ffzShouldBePaused();se!==this.state.isPaused&&(se?(this.pause(),this.ffzInstallHoverTimer(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},H.prototype.ffzMouseLeave=function(){this.ffz_outside=!0,this._ffz_outside_timer&&clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=setTimeout(()=>this.ffzMaybeUnpause(),64),this.ffzUpdateKeyTags()},H.prototype.ffzTooltipHover=function(k,N,Z){if(k[this._ffz_accessor]==null){const se=this.scrollRef?.scrollContent;k[this._ffz_accessor]=se?se.contains(k):!1}k[this._ffz_accessor]&&this.ffzMouseMove(Z)},H.prototype.ffzTooltipLeave=function(k){if(!this.ffz_outside){if(k[this._ffz_accessor]==null){const N=this.scrollRef?.scrollContent;k[this._ffz_accessor]=N?N.contains(k):!1}k[this._ffz_accessor]&&this.ffzMouseLeave()}},H.prototype.ffzUpdateActing=function(){this._ffz_key_frame_acting||(this._ffz_key_frame_acting=requestAnimationFrame(()=>this.ffz_updateActing()))},H.prototype.ffz_updateActing=function(){this._ffz_key_frame_acting=null,this.scrollRef?.root&&(this.scrollRef.root.dataset.acting=this.ffz_acting)},H.prototype.ffzUpdateKeyTags=function(){this._ffz_key_frame||(this._ffz_key_frame=requestAnimationFrame(()=>this.ffz_updateKeyTags()))},H.prototype.ffz_updateKeyTags=function(){if(this._ffz_key_frame=null,!_.use_keys&&this.ffz_use_keys===_.use_keys||!this.scrollRef?.root)return;this.ffz_use_keys=_.use_keys,this.scrollRef.root.classList.toggle("ffz--keys",_.use_keys);const k=this.scrollRef.root.dataset;_.use_keys?(k.alt=!this.ffz_outside&&this.ffz_alt,k.ctrl=!this.ffz_outside&&this.ffz_ctrl,k.shift=!this.ffz_outside&&this.ffz_shift,k.meta=!this.ffz_outside&&this.ffz_meta):(delete k.alt,delete k.ctrl,delete k.shift,delete k.meta)},H.prototype.ffzShouldBePaused=function(k){if(k==null&&(k=Date.now()-(this.ffz_last_move??Date.now())),this.state.ffz_scrolled_up)return!0;const N=this.ffzGetMode();return(!_.pause_hover||!this.ffz_outside)&&(this.ffz_acting||this.ffz_ctrl&&(N===2||N===6)||this.ffz_meta&&(N===3||N===7)||this.ffz_alt&&(N===4||N===8)||this.ffz_shift&&(N===5||N===9)||!this.ffz_outside&&k<_.pause_delay&&(N===1||N>5))},H.prototype.ffzGetMode=function(){let k=_.pause;if(k===0&&!this.props.mouseoverPausingDisabled){const N=this.props.pauseSetting;N==="MOUSEOVER_ALTKEY"?k=8:N==="MOUSEOVER"?k=1:N==="ALTKEY"&&(k=4)}return k},H.prototype.ffzMaybeUnpause=function(){this.state.isPaused&&!this._ffz_unpause_frame&&(this._ffz_unpause_frame=requestAnimationFrame(()=>{this._ffz_unpause_frame=null,this.state.isPaused&&!this.ffzShouldBePaused()&&this.resume()}))},H.prototype.ffzRenderFooter=function(){let k,N="";if(this.state.ffz_scrolled_up)k=_.i18n.t("chat.messages-below","Chat Paused Due to Scroll");else if(this.state.isPaused){const Z=this.ffzGetMode(),se=this.ffz_acting?_.i18n.t("chat.acting","Taking Action"):Z===2?_.i18n.t("key.ctrl","Ctrl Key"):Z===3?_.i18n.t("key.meta","Meta Key"):Z===4?_.i18n.t("key.alt","Alt Key"):Z===5?_.i18n.t("key.shift","Shift Key"):Z===6?_.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):Z===7?_.i18n.t("key.meta_mouse","Meta or Mouse"):Z===8?_.i18n.t("key.alt_mouse","Alt or Mouse"):Z===9?_.i18n.t("key.shift_mouse","Shift or Mouse"):_.i18n.t("key.mouse","Mouse Movement");k=_.i18n.t("chat.paused","Chat Paused Due to {reason}",{reason:se}),N="ffz--freeze-indicator"}else return K("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${N}`},null);return K("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${N}`},K("div",{className:"tw-absolute tw-border-radius-medium tw-bottom-0 tw-c-background-overlay tw-c-text-overlay tw-mg-b-1"},K("button",{className:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--overlay ffz-core-button--text tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","data-a-target":"chat-list-footer",onClick:this.ffzFastResume},K("div",{className:"tw-align-items-center ffz-core-button-label tw-flex tw-flex-grow-0"},K("div",{className:"tw-flex-grow-0"},k)))))};for(const k of V)this.onMount(k)}),this.ChatScroller.on("mount",this.onMount,this),this.ChatScroller.on("unmount",this.onUnmount,this)}onMount(_){_.ffzSetSmoothScroll(this.smooth_scroll),_.ffzInstallHandler(),_.ffzInstallCleaner()}onUnmount(_){this.off("tooltips:hover",_.ffzTooltipHover,_),this.off("tooltips:leave",_.ffzTooltipLeave,_),_._ffz_hover_timer&&(clearInterval(_._ffz_hover_timer),_._ffz_hover_timer=null),_._ffz_outside_timer&&(clearTimeout(_._ffz_outside_timer),_._ffz_outside_timer=null),_.ffzRemoveCleaner(),window.removeEventListener("keydown",_.ffzHandleKey),window.removeEventListener("keyup",_.ffzHandleKey)}cleanMessages(_){const F=ffz.site.fine.getReactInstance(_);if(!F||!Array.isArray(F.child?.memoizedProps))return;let K=null,H=F.child,V=0;for(;H&&V<10;){if(H.stateNode instanceof HTMLDivElement){K=H.stateNode;break}H=H.child,V++}if(!K||K.parentElement!==_)return;let E=K.previousElementSibling;for(V=0;E;){const x=E;E=E.previousElementSibling,x.remove(),V++}V>0&&this.log.debug(`Removed ${V} dead chat lines from`,_)}};G(pe,"Scroller");let g=pe;const S="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",ge=class ge extends D.default{constructor(..._){super(..._),this.inject("chat"),this.inject("i18n"),this.inject("site"),this.RichContent=null,this.has_tokenizer=!1}async loadTokenizer(){if(!this.has_tokenizer)return this.tokenizer=await Promise.all([d.e(2009),d.e(208)]).then(d.bind(d,30642)),this.has_tokenizer=!0,this.tokenizer}async onEnable(){var H;const _=this,F=await this.site.findReact();if(!F)return;const K=F.createElement;this.RichContent=(H=class extends F.Component{constructor(E){super(E),this.state={loaded:!1,error:!1,has_tokenizer:_.has_tokenizer},_.has_tokenizer||_.loadTokenizer().then(()=>this.setState({...this.state,has_tokenizer:!0}))}async load(E=!1){this.clearRefresh();try{let x=this.props.getData(E);if(x instanceof Promise){const k=(0,L.has)(this.props,"timeout")?this.props.timeout:1e3;k?x=await(0,L.timeout)(x,k):x=await x}if(x||(x={error:{type:"i18n",key:"card.empty",phrase:"No data was returned."}}),x.error&&(x={short:{type:"header",image:{type:"image",url:S},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:x.error}}),x.refresh)try{this.clearRefresh();const k=new Date(x.refresh).getTime(),N=k-Date.now();N>0&&(this._refresh_timer=setTimeout(()=>this.load(!0),N+100*Math.floor(Math.random()*100)))}catch{}this.setState(Object.assign({loaded:!0,url:this.props.url},x))}catch(x){x.message!=="timeout"&&_.log.capture(x),this.setState({has_tokenizer:_.has_tokenizer,loaded:!0,url:this.props.url,short:{type:"header",image:{type:"image",url:S},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:String(x)}})}}clearRefresh(){this._refresh_timer&&(clearTimeout(this._refresh_timer),this._refresh_timer=null)}checkReload(E){(!E||E&&this.props.url===E)&&this.reload()}reload(E=!1){this.clearRefresh(),this.setState({loaded:!1,error:!1,has_tokenizer:_.has_tokenizer},()=>this.load(E))}componentDidMount(){_.on("chat:update-link-resolver",this.checkReload,this),this.load()}componentWillUnmount(){_.off("chat:update-link-resolver",this.checkReload,this),this.clearRefresh()}renderCard(){return this.props.renderBody?this.props.renderBody(this.state,this,K):[this.renderUnsafe(),this.renderBody()]}renderUnsafe(){if(!this.state.unsafe)return null;const E=Array.from(new Set(this.state.urls.map(x=>x.flags).flat())).join(", ").toLowerCase();return K("div",{class:"ffz--corner-flag ffz--corner-flag__warn ffz-tooltip ffz-tooltip--no-mouse","data-title":_.i18n.t("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:E})},K("figure",{class:"ffz-i-attention"}))}renderBody(){let E;return(this.props.force_full===!0||this.props.force_full!==!1&&this.props.want_full&&this.state.full)&&(E=this.state.full),this.props.force_mid===!0||this.props.force_mid!==!1&&this.props.want_mid&&this.state.mid?E=this.state.mid:E=this.state.short,_.has_tokenizer&&this.state.v&&this.state.v>_.tokenizer.VERSION&&(E=null),_.has_tokenizer&&this.state.loaded&&E?K("div",{class:"ffz-card-rich tw-full-width tw-overflow-hidden tw-flex tw-flex-column"},_.tokenizer.renderTokens(E,K,{vue:!1,tList:(...x)=>_.i18n.tList(...x),i18n:_.i18n,last_player:0,player_state:this.state.player_state,togglePlayer:x=>{const k=this.state.player_state??{};k[x]=!k[x],this.setState({player_state:k})},link_click_handler:_.chat.handleLinkClick,fragments:this.state.fragments,i18n_prefix:this.state.i18n_prefix,allow_media:_.chat.context.get("tooltip.link-images"),allow_unsafe:_.chat.context.get("tooltip.link-nsfw-images")})):this.renderBasic()}renderBasic(){let E,x;return this.state.error?(E=_.i18n.t("card.error","An error occurred."),x=this.state.error):this.state.loaded&&this.state.has_tokenizer?(E=this.state.title,x=this.state.description):x=_.i18n.t("card.loading","Loading..."),!E&&!x&&(x=_.i18n.t("card.empty","No data was returned.")),x=x?x.split(/\n+/).slice(0,2).map(k=>K("div",{class:"tw-c-text-alt-2 tw-ellipsis tw-mg-x-05",title:k},k)):[],[K("div",{class:"ffz--header-image"}),K("div",{class:"ffz--card-text tw-full-width tw-overflow-hidden tw-flex tw-flex-column tw-justify-content-center"},E&&K("div",{class:"chat-card__title tw-ellipsis tw-mg-x-05"},K("span",{class:"tw-strong",title:E},E)),x)]}render(){let E=K("div",{class:"tw-flex tw-flex-nowrap tw-pd-05"},this.renderCard());const x=this.props.card_tooltip&&this.state.full&&!this.props.force_full;return this.state.url&&(E=K("a",{class:`${x?"ffz-tooltip ":""}${this.state.accent?"ffz-accent-card ":""}${this.state.error?"":"ffz-interactable--hover-enabled "}tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--default tw-interactive`,"data-tooltip-type":"link","data-url":this.state.url,"data-is-mail":!1,target:"_blank",rel:"noreferrer noopener",href:this.state.url,onClick:_.chat.handleLinkClick},E)),K("div",{class:`tw-border-radius-medium tw-elevation-1 ffz--chat-card tw-relative${this.state.unsafe?" ffz--unsafe":""}`,style:{"--ffz-color-accent":this.state.accent||null}},K("div",{class:"tw-border-radius-medium tw-c-background-alt tw-flex tw-full-width"},E))}},G(H,"RichContent"),H)}};G(ge,"RichContent");let n=ge;var s=d(83269),i=d(44615);const l={1e3:1,2e3:2,3e3:3},ve=class ve extends D.default{constructor(..._){super(..._),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject(n),this.inject("experiments"),this.inject("chat.actions"),this.inject("chat.overrides"),this.inject("chat.emotes"),this.line_types={},this.line_types.unknown={renderNotice:(F,K,H,V,E)=>`Unknown message type: ${F.ffz_type}`},this.line_types.notice={renderNotice:(F,K,H,V,E)=>{const x=F.ffz_data;let k=this.line_types.notice.renderContent(F,K,H,V,E);if(!x.icon)return k;if(typeof k=="string"&&(k=E("span",{},k)),typeof x.icon=="function")try{k.ffz_icon=x.icon(x,V,E)}catch(N){this.log.capture(N),this.log.error("Error using custom renderer for notice:",N)}else x.icon instanceof URL?k.ffz_icon=E("img",{className:"ffz-notice-icon tw-mg-r-05",src:x.icon.toString()}):k.ffz_icon=E("span",{className:`${x.icon} tw-mg-r-05`});return k},renderContent:(F,K,H,V,E)=>{const x=F.ffz_data;if(x.renderer)try{return x.renderer(x,V,E)}catch(N){return this.log.capture(N),this.log.error("Error using custom renderer for notice:",N),"Error rendering notice."}const k=x.i18n?this.i18n.t(x.i18n,x.messgae,x):x.message;if(x.markdown)return(0,U.e)()?E("span",{dangerouslySetInnerHTML:{__html:(0,U.e)().renderInline(k)}}):((0,U.Z)().then(()=>V.forceUpdate()),"Loading...");if(x.tokenize){const N=x.ffz_tokens=x.ffz_tokens||this.chat.tokenizeMessage({badges:{},message:k,id:F.id,user:F.user,roomLogin:F.roomLogin,roomID:F.roomID});return this.chat.renderTokens(N,E)}return k}},this.line_types.hype={renderNotice:(F,K,H,V,E)=>{if(this.chat.context.get("chat.hype.message-style")===0)return null;const k=F.user,N=F.ffz_tokens=F.ffz_tokens||this.chat.tokenizeMessage(F,K),Z=N.length>0;let se=F.hype_amount;const de=F.hype_exponent??0;de>0&&(se/=Math.pow(10,de));try{se=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:F.hype_currency,compactDisplay:"short",minimumFractionDigits:de,maximumFractionDigits:de}).format(se)}catch{se=`${F.hype_currency} ${se}`}return Z?this.i18n.tList("chat.hype-chat","Sent a Hype Chat for {amount}!",{amount:se}):this.i18n.tList("chat.hype-chat.user","{user} sent a Hype Chat for {amount}!",{amount:se,user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},k.displayName))})}},this.line_types.cheer={renderNotice:(F,K,H,V,E)=>this.i18n.tList("chat.bits-message","Cheered {count, plural, one {# Bit} other {# Bits}}",{count:F.bits||0})},this.line_types.points={getClass:F=>`ffz--points-line tw-pd-l-1 tw-pd-r-2 ${F.ffz_reward_highlight&&this.chat.context.get("chat.points.allow-highlight")===2?"ffz-custom-color ffz--points-highlight":""}`,renderNotice:(F,K,H,V,E)=>{if(!F.ffz_reward)return null;const x=F.user,k=(0,i.KC)(F.ffz_reward),N=F.ffz_tokens=F.ffz_tokens||this.chat.tokenizeMessage(F,K),Z=N.length>0,se=E("span",{className:"ffz--points-reward"},(0,i.yg)(F.ffz_reward,this.i18n)),de=E("span",{className:"ffz--points-cost"},[E("span",{className:k?"ffz-i-bits":"ffz--points-icon"}),this.i18n.formatNumber((0,i.at)(F.ffz_reward))]);return Z?this.i18n.tList("chat.points.redeemed","Redeemed {reward} {cost}",{reward:se,cost:de}):this.i18n.tList("chat.points.user-redeemed","{user} redeemed {reward} {cost}",{reward:se,cost:de,user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},x.displayName))})}},this.line_types.resub={getClass:()=>"ffz--subscribe-line tw-pd-r-2",renderNotice:(F,K,H,V,E)=>{const x=F.sub_cumulative||F.sub_months,k=this.chat.context.get("chat.subs.show");let N;if(k===1&&x>1&&(N=(F.ffz_tokens=F.ffz_tokens||this.chat.tokenizeMessage(F,K)).length>0),!(k===3||k===1&&N&&x>1||k===2&&x>1))return null;const Z=F.user,se=F.sub_plan||{},de=l[se.plan]||1,_e=F.sub_multi,q=(_e?.count??0)>1&&_e.tenure===0,le=this.i18n.tList(`chat.sub.main${q?"-multi":""}`,`{user} subscribed {plan}${q?" for {multi, plural, one {# month} other {# months}} in advance":""}. `,{user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},Z.displayName)),plan:se.prime?this.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):this.i18n.t("chat.sub.plan","at Tier {tier}",{tier:de}),multi:q?_e.count:1});return F.sub_share_streak&&F.sub_streak>1?le.push(this.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:F.sub_cumulative,streak:F.sub_streak})):x>1&&le.push(this.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:x})),this.chat.context.get("chat.subs.compact")||(le.ffz_icon=E("span",{className:`ffz-i-${se.prime?"crown":"star"} tw-mg-r-05`})),le}},this.line_types.ritual={getClass:()=>"ffz--ritual-line tw-pd-r-2",renderNotice:(F,K,H,V,E)=>{const x=F.user;if(F.ritual==="new_chatter")return this.i18n.tList("chat.ritual","{user} is new here. Say hello!",{user:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},x.displayName))})}},this.line_types.sub_gift={getClass:()=>"ffz--subscribe-line",renderNotice:(F,K,H,V,E)=>{const x=F.user,k=F.sub_plan||{},N=F.sub_months||1,Z=l[k.plan]||1;let se;const de={months:N,user:F.sub_anon||x.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},x.displayName)),plan:k.plan==="custom"?"":this.i18n.t("chat.sub.gift-plan","Tier {tier}",{tier:Z}),recipient:E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,"data-user":JSON.stringify(F.sub_recipient)},E("span",{className:"tw-c-text-base tw-strong"},F.sub_recipient.displayName))};return N<=1?se=this.i18n.tList("chat.sub.mystery","{user} gifted a {plan} Sub to {recipient}! ",de):se=this.i18n.tList("chat.sub.gift-months","{user} gifted {months, plural, one {# month} other {# months}} of {plan} Sub to {recipient}!",de),F.sub_total===1?se.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):F.sub_total>1&&se.push(this.i18n.t("chat.sub.gift-total","They've gifted {count,number} Subs in the channel!",{count:F.sub_total})),this.chat.context.get("chat.subs.compact")||(se.ffz_icon=E("span",{className:`ffz-i-${k.prime?"crown":"star"} tw-mg-r-05`})),se}},this.line_types.sub_mystery={getClass:()=>"ffz--subscribe-line",renderNotice:(F,K,H,V,E)=>{const x=F.mystery;x&&(x.line=V);const k=this.i18n.tList("chat.sub.gift","{user} is gifting {count, plural, one {# Tier {tier} Sub} other {# Tier {tier} Subs}} to {channel}'s community! ",{user:F.sub_anon||F.user.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):E("span",{role:"button",className:"chatter-name",onClick:V.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},E("span",{className:"tw-c-text-base tw-strong"},F.user.displayName)),count:F.sub_count,tier:l[F.sub_plan]||1,channel:F.roomLogin});F.sub_total===1?k.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):F.sub_total>1&&k.push(this.i18n.t("chat.sub.gift-total","They've gifted {count} Subs in the channel!",{count:F.sub_total})),V.ffz_click_expand||(V.ffz_click_expand=()=>{V.setState({ffz_expanded:!V.state.ffz_expanded})});const N=this.chat.context.get("chat.subs.merge-gifts-visibility")?!V.state.ffz_expanded:V.state.ffz_expanded;let Z=null;if(N&&x&&x.recipients&&x.recipients.length>0){const _e=[];for(const q of x.recipients)_e.length&&_e.push(", "),_e.push(E("span",{role:"button",className:"ffz--giftee-name",onClick:V.ffz_user_click_handler,"data-user":JSON.stringify(q)},E("span",{className:"tw-c-text-base tw-strong"},q.displayName)));Z=E("div",{className:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2"},_e)}const se=[k];x&&se.push(E("span",{className:`tw-pd-l-05 tw-font-size-4 ffz-i-${N?"down":"right"}-dir`}));const de=[E("div",{className:"tw-full-width tw-c-text-alt-2",onClick:V.ffz_click_expand},se),Z];return this.chat.context.get("chat.subs.compact")||(de.ffz_icon=E("span",{className:`ffz-i-star${F.sub_anon?"-empty":""} tw-mg-r-05`})),de.ffz_target=se,de}},this.ChatLine=this.fine.define("chat-line",F=>F.renderMessageBody&&F.props&&!F.onExtensionNameClick&&!(0,L.has)(F.props,"hasModPermissions"),v.Z.CHAT_ROUTES),this.ExtensionLine=this.fine.define("extension-line",F=>F.renderMessageBody&&F.onExtensionNameClick,v.Z.CHAT_ROUTES),this.WhisperLine=this.fine.define("whisper-line",F=>F.props&&F.props.message&&(0,L.has)(F.props,"reportOutgoingWhisperRendered"))}async onEnable(){this.on("chat.overrides:changed",V=>this.updateLinesByUser(V,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this),this.can_reprocess=!0,this.on("chat:reload-data",()=>this.can_reprocess=!0),this.on("chat:room-add",()=>this.can_reprocess=!0),this.on("load_tracker:complete:chat-data",()=>{!this.chat.context.get("chat.update-when-loaded")||!this.can_reprocess||(this.can_reprocess=!1,this.log.info("Reprocessing chat lines due to data loads."),this.updateLines())});for(const V of B.RERENDER_SETTINGS)this.chat.context.on(`changed:${V}`,this.rerenderLines,this);for(const V of B.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${V}`,this.updateLineTokens,this);for(const V of B.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${V}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-messages",(V,E,x,k)=>{if(V){for(const N of this.ChatLine.instances){const Z=N.props.message;Z&&k.push({message:Z,_instance:N,update:()=>N.forceUpdate()})}for(const N of this.ExtensionLine.instances){const Z=N.props.message;Z&&k.push({message:Z,_instance:N,update:()=>N.forceUpdate()})}}if(E)for(const N of this.WhisperLine.instances){const Z=N.props.message;Z&&Z._ffz_message&&k.push({message:Z._ffz_message,_instance:N,update:()=>N.forceUpdate()})}}),this.on("chat:get-tab-commands",V=>{this.experiments.getTwitchAssignmentByName("chat_replies")!=="control"&&V.commands.push({name:"reply",description:"Reply to a user's last message.",permissionLevel:0,ffz_group:"FrankerFaceZ",commandArgs:[{name:"username",isRequired:!0},{name:"message",isRequired:!1}]})}),this.on("chat:pre-send-message",V=>{if(this.experiments.getTwitchAssignmentByName("chat_replies")==="control")return;const E=V.message,x=this.parent.chat_types||{};let k,N;if(/^\/reply ?/i.test(E))k=E.slice(7).trim();else return;V.preventDefault();const Z=k.indexOf(" ");if(Z!==-1&&(N=k.slice(Z+1),k=k.slice(0,Z)),k.startsWith("@")&&(k=k.slice(1)),k&&k.length){k=k.toLowerCase();const se=Array.from(this.ChatLine.instances);let de=se.length;for(;de--;){const _e=se[de],q=_e?.props?.message,le=q?.user;if(le&&(le.login===k||le.displayName?.toLowerCase?.()===k)){N?V.sendMessage(N,{reply:{parentDeleted:q.deleted||!1,parentDisplayName:le.displayName,parentMessageBody:q.message,parentMsgId:q.id,parentUid:le.id,parentUserLogin:le.login}}):requestAnimationFrame(()=>_e.ffzOpenReply());return}}}V.addMessage({type:x.Notice,message:this.i18n.t("chat.reply.bad-user","Invalid user or no known message to reply to.")})});const _=this,F=await this.site.findReact();if(!F)return;const K=F.createElement,H=this.rich_content&&this.rich_content.RichContent;this.WhisperLine.ready(V=>{const E=V.prototype.render;V.prototype.render=function(){if(this._ffz_no_scan=!0,!this.props.message||!this.props.message.content||!this.props.message.from)return E.call(this);try{const x=_.chat.standardizeWhisper(this.props.message),k=x.is_action,N=k?_.chat.context.get("chat.me-style"):0,Z=N>=2,se=N===1||N===3,de=x.user,_e=_.overrides.getColor(de.id)||de.color,q=_.parent.colors.process(_e),le=x.ffz_tokens=x.ffz_tokens||_.chat.tokenizeMessage(x,null),he=_.chat.renderTokens(le,K),be=_.overrides.getName(de.id);return K("div",{className:"thread-message__message"},K("div",{className:"tw-pd-x-1 tw-pd-y-05"},[K("span",{className:`thread-message__message--user-name notranslate${be?" ffz--name-override":""}`,style:{color:q}},be||de.displayName),K("span",null,k?" ":": "),K("span",{className:`message${Z?" chat-line__message-body--italicized":""}`,style:{color:se&&q}},he)]))}catch(x){return _.log.error(x),_.log.capture(x,{extra:{props:this.props}}),E.call(this)}},setTimeout(()=>this.WhisperLine.forceUpdate())}),this.ChatLine.ready(V=>{const E=V.prototype.render;V.prototype.shouldComponentUpdate=function(x,k){const N=k&&k.alwaysShowMessage||!x.message.deleted,Z=this._ffz_show;return this._ffz_show=N,N!==Z||k&&this.state&&k.ffz_expanded!==this.state.ffz_expanded||x.deletedMessageDisplay!==this.props.deletedMessageDisplay||x.deletedCount!==this.props.deletedCount||x.message!==this.props.message||x.isCurrentUserModerator!==this.props.isCurrentUserModerator||x.showModerationIcons!==this.props.showModerationIcons||x.showTimestamps!==this.props.showTimestamps||x.pinnedMessage?.message?.id===x.message?.id!=(this.props.pinnedMessage?.message?.id===this.props.message?.id)},V.prototype.ffzOpenReply=function(){if(this.onMessageClick)return this.onMessageClick();if(this.props.reply){this.setOPCardTray(this.props.reply);return}if(this.props.hasReply){const N=this.props.message;if(N?.user){this.setOPCardTray({parentMsgId:N.id,parentUid:N.user.userID,parentUserLogin:N.user.userLogin,parentDeleted:N.deleted,parentDisplayName:N.user.userDisplayName,parentMessageBody:N.messageBody});return}}const x=this.renderMessageAuthor;this.renderMessageAuthor=()=>this.ffzReplyAuthor();const k=this.props.message?.ffz_tokens;k&&(this.setMessageTray(this.props.message,_.chat.renderTokens(k,K)),this.renderMessageAuthor=x)},V.prototype.ffzReplyAuthor=function(){const x=_.chat.standardizeMessage(this.props.message),k=x.user,N=_.overrides.getColor(k.id)||k.color,Z=_.parent.colors.process(N);let se=x.roomLogin?x.roomLogin:x.channel?x.channel.slice(1):void 0,de=x.roomId?x.roomId:this.props.channelID;if(!se&&de){const le=_.chat.getRoom(de,null,!0);le&&le.login&&(se=x.roomLogin=le.login)}if(!de&&se){const le=_.chat.getRoom(null,de,!0);le&&le.id&&(de=x.roomId=le.id)}const _e=_.chat.formatUser(k,K),q=_.overrides.getName(k.id);return K("span",{"data-room-id":de,"data-room":se,"data-user-id":k.userID,"data-user":k.userLogin&&k.userLogin.toLowerCase()},[K("span",{className:"chat-line__message--badges"},_.chat.badges.render(x,K)),K("span",{className:`chat-line__username notranslate${q?" ffz--name-override tw-relative ffz-il-tooltip__container":""}`,role:"button",style:{color:Z},onClick:this.ffz_user_click_handler,onContextMenu:_.actions.handleUserContext},q?[K("span",{className:"chat-author__display-name"},q),K("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},_e)]:_e)])},V.prototype.ffzRenderSharedChatPill=function(){let x=_.chat.context.get("chat.shared-chat.style");if(x==null&&(x=this.props.isCurrentUserModerator?2:0),x===0)return null;const k=this.props.message,N=k.sourceRoomID,Z=N&&this.props.sharedChatDataByChannelID?.get(N),se=!Z||N===(k.roomId??this.props.channelID);if(!Z)return null;const de=_.i18n.t("chat.sent-from-source","Sent from {source}",{source:Z.displayName??Z.login});return x===1?K("span",{className:`ffz-pill ffz-tooltip tw-mg-r-05 ${se?"ffz-pill--brand":""}`,"data-title":de},`${Z.displayName??Z.login}`):x===2?K("figure",{className:`ffz-tooltip ffz-tooltip--no-mouse ffz-shared-chat-badge ffz-avatar tw-border-radius-rounded ${se?"ffz-shared-chat-badge--active":""} tw-mg-r-05`,"data-title":_.i18n.t("chat.sent-from-source","Sent from {source}",{source:Z.displayName})},K("img",{className:"tw-block tw-border-radius-rounded tw-image",src:Z.profileImageURL,alt:Z.displayName})):null},V.prototype.ffzNewRender=function(){try{this._ffz_no_scan=!0;const x=_.chat.standardizeMessage(this.props.message),k=_.chat.context.get("chat.filtering.display-deleted");let N=this.props.deletedMessageDisplay;if(k?N=k:!this.props.isCurrentUserModerator&&N==="DETAILED"&&(N="LEGACY"),N==="BRIEF"&&x.deleted){const We=this.props.deletedCount;return We==null?null:K("div",{className:"chat-line__status"},_.i18n.t("chat.deleted-messages",`{count,plural,
one {One message was deleted by a moderator.}
other {# messages were deleted by a moderator.}
}`,{count:We}))}const Z=x.sourceRoomID,se=Z&&this.props.sharedChatDataByChannelID?.get(Z);let de=x.roomLogin?x.roomLogin:x.channel?x.channel.slice(1):void 0,_e=x.roomId?x.roomId:this.props.channelID;if(!de&&_e){const We=_.chat.getRoom(_e,null,!0);We&&We.login&&(de=x.roomLogin=We.login)}if(!_e&&de){const We=_.chat.getRoom(null,de,!0);We&&We.id&&(_e=x.roomId=We.id)}const q=_.site.getUser(),le={id:_e,login:de},he=!se||Z===_e,be=he?le:{id:Z,login:se.login},Ce=_.chat.context.get("chat.replies.style"),ze=this.props&&!!(this.props.hasReply||this.props.reply||!this.props.replyRestrictedReason),Me=ze&&x.message&&!x.deleted&&!this.props.disableReplyClick,ce=Me&&(ze||q&&q.login!==x.user?.login);q&&(q.moderator=this.props.isCurrentUserModerator,q.staff=this.props.isCurrentUserStaff,q.reply_mode=Ce,q.can_reply=ce),this.ffz_open_reply||(this.ffz_open_reply=this.ffzOpenReply.bind(this)),this.ffz_user_click_handler||(this.props.onUsernameClick?this.ffz_user_click_handler=We=>{if(this.isKeyboardEvent(We)&&We.keyCode!==B.KEYS.Space&&We.keyCode!==B.KEYS.Enter)return;const Ke=We.currentTarget,dt=Ke&&Ke.dataset;let rt=x.user;if(dt&&dt.user)try{rt=JSON.parse(dt.user)}catch{}const vt=_.makeEvent({inst:this,event:We,message:x,user:rt,room:le,source:be});_.emit("chat:user-click",vt),!vt.defaultPrevented&&this.props.onUsernameClick(rt.login,"chat_message",x.id,Ke.getBoundingClientRect().bottom)}:this.ffz_user_click_handler=this.openViewerCard||this.usernameClickHandler);let ye,Ee,Ae=null,$e=x.ffz_type&&_.line_types[x.ffz_type];if(!$e&&x.bits>0&&_.chat.context.get("chat.bits.cheer-notice")&&($e=_.line_types.cheer),!$e&&x.ffz_type&&($e=_.line_types.unknown),$e){if($e.render)return $e.render(x,q,le,this,K);$e.renderNotice&&(ye=$e.renderNotice(x,q,le,this,K)),$e.getClass&&(Ee=$e.getClass(x,q,le,this,K))}const Ne=x.user,tt=_.chat.context.get("chat.emotes.animated")===2;Ne&&!Ne.lowerLogin&&Ne.userLogin&&(Ne.lowerLogin=Ne.userLogin.toLowerCase()),Ee=Ee||"";let qe,ot,it=null;if(N==="BRIEF"?(qe=!0,ot=!1):N==="DETAILED"?(qe=!0,ot=x.deleted):(qe=this.state?.alwaysShowMessage||!x.deleted,ot=!1),x.deleted){const We=_.chat.context.get("chat.filtering.display-mod-action");if(We===2||We===1&&N==="DETAILED"){const Ke=x.modActionType;Ke==="timeout"?it=_.i18n.t("chat.mod-action.timeout","{duration} Timeout",{duration:(0,s.print_duration)(x.duration||1)}):Ke==="ban"?it=_.i18n.t("chat.mod-action.ban","Banned"):(Ke==="delete"||!Ke)&&(it=_.i18n.t("chat.mod-action.delete","Deleted")),it&&x.modLogin&&(it=_.i18n.t("chat.mod-action.by","{action} by {login}",{login:x.modLogin,action:it})),it&&(it=K("span",{className:"tw-pd-l-05","data-test-selector":"chat-deleted-message-attribution"},`(${it})`))}}let st=null;const pt=_.chat.context.get("chat.filtering.show-reasons");if(x.highlights?.size&&pt){st=[];for(const We of x.highlights){const Ke=_.chat._hl_reasons[We];let dt,rt;Ke&&(rt=Ke.i18n_key?_.i18n.t(Ke.i18n_key,Ke.title):Ke.title,dt=Ke.i18n_label?_.i18n.t(Ke.i18n_label,Ke.label):Ke.label,dt===rt&&(rt=null)),dt||(dt=We),st.push(K("span",{className:`ffz-pill ffz-highlight-tag${Ke?" ffz-tooltip":""}`,"data-title":rt},dt))}st.length>0?st=K("span",{className:`ffz-highlight-tags ${pt===1?"ffz-highlight-tags__above":"tw-mg-r-05"}`},st):st=null}const nt=x.ffz_tokens=x.ffz_tokens||_.chat.tokenizeMessage(x,q),yt=nt.length>0||!ye;let ht;if(yt){const We=Ce===2||Ce===1&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference!=="expanded"?x.ffz_reply=x.ffz_reply||_.chat.tokenizeReply(this.props.reply):null,Ke=_.parent.message_types&&_.parent.message_types.Action===x.messageType,dt=this.props.isLastEmoteGigantified||(0,i._x)(x.ffz_reward),rt=Ke?_.chat.context.get("chat.me-style"):0,vt=rt>=2,bt=rt===1||rt===3,wt=_.overrides.getColor(Ne.id)||Ne.color,Ue=_.parent.colors.process(wt),Be=qe&&H&&_.chat.pluckRichContent(nt,x),at=dt&&_.chat.pluckLastEmote(nt,x),lt=_.chat.formatUser(Ne,K),Qe=_.overrides.getName(Ne.id);let et=x.ffz_user_class;et instanceof Set?et=[...et].join(" "):Array.isArray(et)&&(et=et.join(" "));const Ze=se&&_.chat.context.get("chat.shared-chat.username-tooltip"),Re={className:`chat-line__username notranslate${Qe?" ffz--name-override":""}${Qe||Ze?" tw-relative ffz-il-tooltip__container":""} ${et??""}`,role:"button",style:{color:Ue},onClick:this.ffz_user_click_handler,onContextMenu:_.actions.handleUserContext};x.ffz_user_props&&Object.assign(Re,x.ffz_user_props),x.ffz_user_style&&Object.assign(Re.style,x.ffz_user_style);const je=K("span",Re,Qe?[K("span",{className:"chat-author__display-name"},Qe),K("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},[lt,Ze?K("div",{className:"tw-font-size-8 tw-mg-t-05"},_.i18n.t("chat.sent-from-source","Sent from {source}",{source:se.displayName??se.login})):null])]:Ze?[lt,K("span",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},_.i18n.t("chat.sent-from-source","Sent from {source}",{source:se.displayName??se.login}))]:lt),Ye=this.props.showTimestamps||this.props.isHistorical?K("span",{className:"chat-line__timestamp"},_.chat.formatTime(x.timestamp)):null,Ge=qe&&ze&&We?_.chat.renderTokens(We,K):null,Le=x.ffz_reward_highlight&&_.chat.context.get("chat.points.allow-highlight")===1;ht=[Ce===1&&this.props.reply&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference==="expanded"?this.renderReplyLine():null,se?this.ffzRenderSharedChatPill():null,Ye,x.ffz_no_actions?null:_.actions.renderInline(x,this.props.showModerationIcons,q,le,K,this),this.renderInlineHighlight?this.renderInlineHighlight():null,pt===2?st:null,K("span",{className:"chat-line__message--badges"},_.chat.badges.render(x,K)),je,K("span",{"aria-hidden":!0},Ke?" ":": "),Ge,qe?K("span",{className:`message ${vt?"chat-line__message-body--italicized":""} ${Le?"chat-line__message-body--highlighted":""}`,style:bt?{color:Ue}:null},_.chat.renderTokens(nt,K,Ce!==0&&ze?this.props.reply:null)):K("span",{className:"chat-line__message--deleted"},K("a",{href:"",onClick:this.alwaysShowMessage},_.i18n.t("chat.message-deleted","<message deleted>"))),it,Be?K(H,Be):null,at?K("div",{className:"chat-line__message--ffz-giant-emote"},_.chat.renderGiantEmote(at,K)):null]}let ut;if(ye){const We=Array.isArray(ye.ffz_target);if(ht)We?ye.ffz_icon&&ye.ffz_target.unshift(ye.ffz_icon):ye.ffz_icon&&(ye=[ye.ffz_icon,ye]),ht=K("div",{className:"chat-line--inline chat-line__message","data-room-id":be?.id??x.roomId??le.id,"data-room":be?.login??x.roomLogin,"data-user-id":Ne?.userID,"data-user":Ne?.lowerLogin},ht);else{const Ke=_.chat.context.get("chat.extra-timestamps"),dt=Ke&&(this.props.showTimestamps||this.props.isHistorical)?K("span",{className:"chat-line__timestamp"},_.chat.formatTime(x.timestamp)):null,rt=x.ffz_no_actions?null:_.actions.renderInline(x,this.props.showModerationIcons,q,le,K,this);We?ye.ffz_target.unshift(se?this.ffzRenderSharedChatPill():null,ye.ffz_icon??null,dt,rt,pt===2?st:null):ye=[se?this.ffzRenderSharedChatPill():null,ye.ffz_icon??null,dt,rt,pt===2?st:null,ye]}Ee=`${Ee} ffz-notice-line user-notice-line tw-pd-y-05`,We||(ye=K("div",{className:"tw-c-text-alt-2"},ye)),st&&pt===1?ut=[st,ye,ht??null]:ht?ut=[ye,ht]:ut=ye}else Ee=`${Ee} chat-line__message`,st&&pt===1?ut=[st,ht]:ut=ht;const He=Ne&&x.id&&!x.ffz_no_actions?_.actions.renderHover(x,this.props.showModerationIcons,q,le,K,this):null;return He&&(Ee=`${Ee} tw-relative`,ut=[K("div",{className:"chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0","data-test-selector":"chat-message-highlight"}),K("div",{className:"chat-line__message-container tw-relative"},ut),He]),Ae==null&&(Ae=x.mentioned&&x.mention_color?_.parent.inverse_colors.process(x.mention_color):null),K("div",{className:`${Ee}${ot?" ffz--deleted-message":""}${x.mentioned?" ffz-mentioned":""}${Ae?" ffz-custom-color":""}`,style:{backgroundColor:Ae},"data-room-id":be?.id??x.roomId??le.id,"data-room":be?.login??x.roomLogin,"data-user-id":Ne?.userID,"data-user":Ne?.lowerLogin,onMouseOver:tt?_.chat.emotes.animHover:null,onMouseOut:tt?_.chat.emotes.animLeave:null},ut)}catch(x){_.log.error(x),_.log.capture(x,{extra:{props:this.props}});try{return console.log("trying old 1"),E.call(this)}catch(k){return _.log.error("An error in Twitch shit.",k),_.log.capture(k,{extra:{props:this.props}}),"An error occurred rendering this chat line."}}},V.prototype.render=V.prototype.ffzNewRender,setTimeout(()=>this.ChatLine.forceUpdate())}),this.ExtensionLine.ready(V=>{const E=V.prototype.render;V.prototype.render=function(){try{if(this._ffz_no_scan=!0,!this.props.installedExtensions)return null;const x=_.chat.standardizeMessage(this.props.message),k=x&&x.extension;if(!k||!this.props.installedExtensions.some(he=>{const be=he.extension;return be&&(be.clientId||be.clientID)===(k.clientId||k.clientID)&&be.version===k.version}))return null;const N=_.parent.colors.process(k.chatColor);let Z=x.roomLogin?x.roomLogin:x.channel?x.channel.slice(1):void 0;if(!Z&&this.props.channelID){const he=_.chat.getRoom(this.props.channelID,null,!0);he&&he.login&&(Z=x.roomLogin=he.login)}const se=_.site.getUser(),de={id:this.props.channelID,login:Z},_e=x.ffz_tokens=x.ffz_tokens||_.chat.tokenizeMessage(x,se),q=H&&_.chat.pluckRichContent(_e,x),le=x.mentioned&&x.mention_color?_.parent.inverse_colors.process(x.mention_color):null;return _e.length?K("div",{className:`chat-line__message${x.mentioned?" ffz-mentioned":""}${le?" ffz-custom-color":""}`,style:{backgroundColor:le},"data-room-id":de.id,"data-room":de.login,"data-extension":k.clientID},[this.props.showTimestamps&&K("span",{className:"chat-line__timestamp"},_.chat.formatTime(x.timestamp)),K("span",{className:"chat-line__message--badges"},_.chat.badges.render(x,K)),K("span",{className:"chat-line__username notranslate",role:"button",style:{color:N},onClick:this.onExtensionNameClick},K("span",{className:"chat-author__display-name"},k.displayName)),K("span",null,": "),K("span",{className:"message"},_.chat.renderTokens(_e,K)),q&&K(H,q)]):null}catch(x){return _.log.info(x),_.log.capture(x,{extra:{props:this.props}}),E.call(this)}},setTimeout(()=>this.ExtensionLine.forceUpdate())})}checkEffects(){for(const _ of this.ChatLine.instances){const F=_.props.message,K=F?.ffz_tokens;if(K)for(const H of K)H.type==="emote"&&H.modifier_flags&&this.emotes.ensureEffect(H.modifier_flags)}for(const _ of this.WhisperLine.instances){const F=_.props.message?._ffz_message,K=F?.ffz_tokens;if(K)for(const H of K)H.type==="emote"&&H.modifier_flags&&this.emotes.ensureEffect(H.modifier_flags)}}updateLineById(_,F=!0,K=null){K==null&&(K=F);for(const H of this.ChatLine.instances){const V=H.props.message;if(V?.id===_){K&&(V.ffz_badges=V.ffz_badge_cache=null),F&&(V.ffz_tokens=null,V.ffz_reply=null,V.highlights=V.mentioned=V.mention_color=V.color_priority=null),H.forceUpdate();return}}for(const H of this.WhisperLine.instances){const V=H.props.message?._ffz_message;if(V?.id===_){(K||F)&&(V._ffz_message=null),H.forceUpdate();return}}}updateLinesByUser(_,F,K=!0,H=!0){for(const V of this.ChatLine.instances){const E=V.props.message,x=E?.user;x&&(_&&_==x.id||F&&F==x.login)&&(H&&(E.ffz_badges=E.ffz_badge_cache=null),K&&(E.ffz_tokens=null,E.ffz_reply=null,E.highlights=E.mentioned=E.mention_color=E.color_priority=null),V.forceUpdate())}for(const V of this.WhisperLine.instances){const E=V.props.message?._ffz_message,x=E?.user;x&&(_&&_==x.id||F&&F==x.login)&&(E._ffz_message=null,V.forceUpdate())}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){return this._updateLines(!1,!1)}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(_=!0,F=!0){for(const K of this.ChatLine.instances){const H=K.props.message;H&&(F&&(H.ffz_badge_cache=H.ffz_badges=null),_&&(H.ffz_tokens=null,H.ffz_reply=null,H.highlights=H.mentioned=H.mention_color=H.mention_priority=H.clear_priority=null))}for(const K of this.ExtensionLine.instances){const H=K.props.message;H&&(F&&(H.ffz_badge_cache=H.ffz_badges=null),_&&(H.ffz_tokens=null,H.ffz_reply=null,H.highlights=H.mentioned=H.mention_color=H.mention_priority=H.clear_priority=null))}for(const K of this.WhisperLine.instances){const H=K.props.message;H&&H._ffz_message&&(H._ffz_message=null)}this.ChatLine.forceUpdate(),this.ExtensionLine.forceUpdate(),this.WhisperLine.forceUpdate(),this.emit("chat:updated-lines")}};G(ve,"ChatLine");let w=ve;var b=d(44589),r=d(17159);const Fe=class Fe extends D.default{constructor(..._){super(..._),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("site.fine"),this.inject("site"),this.inject("site.css_tweaks"),this.settings.add("chat.input.hide-identity",{default:!1,ui:{path:"Chat > Input >> Appearance",title:'Display "Chat Identity" in the chat settings menu rather than the input box.',component:"setting-check-box"}}),this.SettingsMenu=this.fine.define("chat-settings",F=>F.renderUniversalOptions&&F.onBadgesChanged,v.Z.CHAT_ROUTES)}async onEnable(){this.on("i18n:update",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.scroller.freeze",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.input.hide-identity",H=>{this.css_tweaks.toggle("hide-chat-identity",H),this.SettingsMenu.forceUpdate()}),this.css_tweaks.toggle("hide-chat-identity",this.chat.context.get("chat.input.hide-identity"));const _=this,F=await this.site.findReact();if(!F)return;const K=F.createElement;this.SettingsMenu.ready(H=>{const V=H.prototype.render,E=H.prototype.renderUniversalOptions;H.prototype.renderUniversalOptions=function(){const x=E.call(this);return this.ffzSettingsClick||(this.ffzSettingsClick=k=>_.click(this,k)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),x.props.children.push(K("div",{class:"tw-full-width tw-relative"},K("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.ffzSettingsClick},K("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},K("div",{class:"tw-flex-grow-1"},_.i18n.t("site.menu_button","FrankerFaceZ Control Center")))),_.cant_window&&K("div",{class:"tw-mg-t-05 tw-c-text-alt-2"},K("span",{class:"ffz-i-attention"},_.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch."))))),x},H.prototype.ffzRenderIdentity=function(){if(!this.state||!this.props||this.state.moderatorMode||this.state.chatAppearance||this.state.chatPause||this.state.followerMode||this.state.recentRaids||this.state.repliesAppearance||this.state.slowMode||this.props.isShowingChatFilterSettings||this.props.isShowingDeletedMessageDisplaySettings||!this.props.isLoggedIn||!_.chat.context.get("chat.input.hide-identity"))return null;const x=this.props.data?.currentUser,k=this.props.data?.user?.self?.displayBadges;if(!x||!x.login||!Array.isArray(k))return null;const N=x.login&&x.displayName&&x.displayName.trim().toLowerCase()!==x.login,Z=_.parent.colors.process(x.chatColor),se={};for(const _e of k)_e?.setID&&_e.version&&(se[_e.setID]=_e.version);this._ffzIdentityClick||(this._ffzIdentityClick=()=>{document.querySelector('button[data-a-target="chat-badge-carousel-badge-icon"]').click(),this.props.onCloseSettings()});const de={user:x,badges:se,ffz_badges:_.badges.getBadges(x.id,x.login,this.props.channelID,this.props.channelLogin),roomID:this.props.channelID,roomLogin:this.props.channelLogin};return this._ffzIdentityMsg=de,K("div",{class:"ffz-identity"},K("div",{class:"tw-mg-y-05 tw-pd-x-05"},K("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},_.i18n.t("chat.identity-menu","Chat Identity"))),K("div",{class:"tw-full-width tw-relative"},K("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this._ffzIdentityClick},K("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},K("div",{class:"tw-flex-grow-1"},K("span",{class:"ffz--editor-name"},K("span",{class:"ffz--editor-badges","data-room-id":this.props.channelID,"data-room":this.props.channelLogin},_.badges.render(de,K,!0,!0)),K("span",{class:"tw-strong notranslate",style:{color:Z}},K("span",{class:"name-display__name"},x.displayName||x.login),N&&K("span",{class:"intl-name"}," (",x.login,") ")))),K("div",{class:"tw-align-items-center tw-flex tw-flex-shrink-0 tw-mg-l-05"},K("figure",{class:"ffz-i-right-open"}))))))},H.prototype.render=function(){const x=V.call(this);try{const k=x?.props?.children?.props?.children?.props?.children?.[1]?.props?.children?.props?.children;if(Array.isArray(k)){const N=this.ffzRenderIdentity();N&&k.unshift(N)}}catch(k){_.log.error("Error rendering chat settings menu.",k)}return x},this.SettingsMenu.forceUpdate()}),this.SettingsMenu.on("update",this.updateSettingsMenu,this),this.SettingsMenu.on("unmount",H=>{H.ffzSettingsClick=null})}updateSettingsMenu(_){const F=this.fine.getChildNode(_);if(!F||!document.contains(F))return;let K;if(_.props?.editAppearance){this.registerBadgePicker();const N=F.querySelector('span[data-a-target="edit-display-name"]');K=N&&N.closest(".tw-mg-t-1")}else K=F.querySelector('.name-display > div:not([data-test-selector="edit-appearance-button"])');if(!K||!F.contains(K))return;const H=_.props?.data?.currentUser,V=_.props?.data?.user?.self?.displayBadges;if(!H||!H.login||!Array.isArray(V))return;const E=H.login&&H.displayName&&H.displayName.trim().toLowerCase()!==H.login,x=this.parent.colors.process(H.chatColor),k={};for(const N of K.children)N?.classList&&(N.classList.contains("ffz--editor-name")?N.remove():N.classList.add("tw-hide"));for(const N of V)N?.setID&&N.version&&(k[N.setID]=N.version);K.appendChild((0,b.createElement)("span",{className:"ffz--editor-name"},[(0,b.createElement)("span",{className:"ffz--editor-badges","data-room-id":_.props.channelID,"data-room-login":_.props.channelLogin},this.badges.render({user:H,badges:k,ffz_badges:this.badges.getBadges(H.id,H.login,_.props.channelID,_.props.channelLogin),roomID:_.props.channelID,roomLogin:_.props.channelLogin},b.createElement,!0,!0)),(0,b.createElement)("span",{class:"tw-strong notranslate",style:{color:x}},(0,b.createElement)("span",{class:"name-display__name"},H.displayName||H.login),E&&(0,b.createElement)("span",{class:"intl-name"}," (",H.login,")"))]))}registerBadgePicker(){this.BadgePicker||(this.BadgePicker=this.fine.define("badge-picker",_=>_.onGlobalBadgeClicked&&_.onGlobalBadgeKeyPress,v.Z.CHAT_ROUTES),this.BadgePicker.on("mount",this.updateBadgePicker,this),this.BadgePicker.on("update",this.updateBadgePicker,this),this.BadgePicker.ready((_,F)=>{for(const K of F)this.updateBadgePicker(K)}))}updateBadgePicker(_){const F=this.fine.getChildNode(_);if(!F){_.props?.data?.loading===!1&&!_._ffz_try_again&&(_._ffz_try_again=requestAnimationFrame(()=>this.updateBadgePicker(_)));return}const K=F.querySelector(".tw-flex-column");if(!K)return;const H=this.badges.getBadges(_.props.userID,_.props.userLogin);let V;for(const N of H){const Z=this.badges.badges[N?.id];Z&&!Z.addon&&(V=Z)}const E=K.querySelector(".ffz--badge-selector");if(E){V||E.remove();return}else if(!V)return;const x=(0,b.createElement)("div",{class:"ffz--badge-selector tw-border-b tw-mg-b-1"},(0,b.createElement)("div",{class:"tw-mg-y-05 tw-pd-x-05"},(0,b.createElement)("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},this.i18n.t("chat.ffz-badge.title","FrankerFaceZ Badge"))),(0,b.createElement)("div",null,(0,b.createElement)("p",{class:"tw-mg-b-05 tw-pd-x-05"},this.i18n.tList("chat.ffz-badge.about","This badge appears globally for users with FrankerFaceZ. Please visit the {website} to change this badge.",{website:(0,b.createElement)("a",{href:"https://www.frankerfacez.com/subscribe",class:"ffz-link",rel:"noopener noreferrer",target:"_blank"},this.i18n.t("chat.ffz-badge.site-link","FrankerFaceZ website"))}))),(0,b.createElement)("div",{role:"radiogroup",class:"tw-align-items-center tw-flex tw-flex-wrap tw-mg-b-05 tw-mg-t-05 tw-pd-x-05"},(0,b.createElement)("div",{class:"tw-mg-r-1 tw-mg-y-05"},(0,b.createElement)("div",{class:"tw-inline-flex"},(0,b.createElement)("div",{class:"edit-appearance__badge-chooser edit-appearance__badge-chooser--selected tw-border-radius-small"},(0,b.createElement)("img",{alt:V.title,src:V.urls[2],srcset:`${V.urls[2]} 1x, ${V.urls[4]} 2x`,style:{backgroundColor:V.color||"transparent"},role:"radio","aria-checked":"true",class:"tw-full-height tw-full-width"})))))),k=K.querySelector('[data-test-selector="global-badges-test-selector"]')?.nextElementSibling;k?K.insertBefore(x,k):K.appendChild(x)}closeMenu(_){const F=this.fine.searchParent(_,H=>H.setChatInputRef&&H.setAutocompleteInputRef,100),K=F&&this.fine.searchTree(F,H=>H.props&&H.props.isSettingsOpen&&H.onClickSettings);K&&K.onClickSettings()}click(_,F){const K=F.currentTarget,H=K&&K.dataset&&K.dataset.page,V=new r.FFZEvent({item:H,event:F,errored:!1});if(this.emit("main_menu:open",V),V.errored){this.cant_window=!0,this.SettingsMenu.forceUpdate();return}this.closeMenu(_)}};G(Fe,"SettingsMenu");let e=Fe;var a=d(49276),p=d(90424),C=d.n(p);const y={1e3:"Tier 1",2e3:"Tier 2",3e3:"Tier 3"},z=["the_horns","raised_back_of_hand","ok_hand","+1","clap","fist","pinched_fingers","wave","pinch","victory","love_you_gesture"];function $(Oe,_){_||(_=Oe.closest(".simplebar-scroll-content")??Oe.parentElement);const F=_.offsetHeight,K=Oe.offsetHeight,H=Oe.offsetTop;if(K>=F){_.scrollTop=H;return}const V=H+K/2-F/2;_.scrollTop=V}G($,"scrollIntoView");function o(Oe){if(!Oe)return Oe;try{return new Date(Oe)}catch{return null}}G(o,"maybe_date");const c=window?.Intl?.Collator&&new Intl.Collator(void 0,{numeric:!0}),m=[G(function(_,F){return c?c.compare(_.id,F.id):_.id<F.id?-1:_.id>F.id?1:0},"id_asc"),G(function(_,F){return c?c.compare(F.id,_.id):_.id>F.id?-1:_.id<F.id?1:0},"id_desc"),G(function(_,F){const K=_.name.toLowerCase(),H=F.name.toLowerCase();return K<H?-1:K>H?1:c?c.compare(_.id,F.id):_.id<F.id?-1:_.id>F.id?1:0},"name_asc"),G(function(_,F){const K=_.name.toLowerCase(),H=F.name.toLowerCase();return K>H?-1:K<H?1:c?c.compare(F.id,_.id):_.id>F.id?-1:_.id<F.id?1:0},"name_desc"),G(function(_,F){if(_.order!=null||F.order!=null){if(_.order&&F.order==null)return-1;if(F.order&&_.order==null)return 1;if(_.order<F.order)return-1;if(_.order>F.order)return 1}return c?c.compare(_.id,F.id):_.id<F.id?-1:_.id>F.id?1:0},"native_asc"),G(function(_,F){if(_.order!=null||F.order!=null){if(_.order&&F.order==null)return 1;if(F.order&&_.order==null)return-1;if(_.order<F.order)return 1;if(_.order>F.order)return-1}return c?c.compare(_.id,F.id):_.id<F.id?1:_.id>F.id?-1:0},"native_desc")];function A(Oe,_){const F=Oe.sort_key,K=_.sort_key;if(F<K)return-1;if(K<F)return 1;const H=Oe.title.toLowerCase(),V=_.title.toLowerCase();return H<V?-1:V<H?1:0}G(A,"sort_sets");const De=class De extends D.default{constructor(..._){super(..._),this.inject("staging"),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.SUB_STATUS=C(),this.settings.add("chat.emote-menu.shortcut",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Use Ctrl+E to open the Emote Menu.",description:"When enabled and you press Ctrl+E with the chat input focused, the emote menu will open.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.modifiers",{default:0,ui:{path:"Chat > Emote Menu >> General",title:"Emote Modifiers",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"In-Line"}]}}),this.settings.add("chat.emote-menu.clear-search",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Reset search when closing the Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.enabled",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Use the FrankerFaceZ Emote Menu.",description:"The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.",component:"setting-check-box"},changed:()=>this.EmoteMenu.forceUpdate()}),this.settings.add("chat.emote-menu.icon",{requires:["chat.emote-menu.enabled","context.bttv.emote_menu"],default:!1,process(F,K){return F.get("chat.emote-menu.enabled")?F.get("context.bttv.emote_menu")||K:!1},ui:{path:"Chat > Emote Menu >> Appearance",title:"Replace the emote menu icon with the FFZ icon for that classic feel.",description:"**Note:** This setting may be forcibly enabled if other emote menus are detected, to ensure you can visually identify the FFZ Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-quick-nav",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show a quick navigation bar along the side of the menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tall",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use extra height for the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-heading",{default:1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show Headers",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Not Searching"}]}}),this.settings.add("chat.emote-menu.show-search",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show the search box.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.reduced-padding",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use reduced padding.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.default-tab",{default:"channel",ui:{path:"Chat > Emote Menu >> General",title:"Default Tab",component:"setting-select-box",data:[{value:"fav",title:"Favorites"},{value:"channel",title:"Channel"},{value:"effect",title:"Emote Effects"},{value:"all",title:"My Emotes"},{value:"emoji",title:"Emoji"}]}}),this.settings.add("chat.emote-menu.effect-tab",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display Emote Effects in their own tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tooltips",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Display emote preview tool-tips in the FFZ Emote Menu.",component:"setting-check-box",description:"You may wish to disable this for performance reasons."}}),this.settings.add("chat.emote-menu.show-emoji",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display emoji in the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.combine-tabs",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Display all emotes on one tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.stay-loaded",{requires:["chat.emote-menu.combine-tabs"],default:null,process(F,K){return K==null&&(K=F.get("chat.emote-menu.combine-tabs")),K},ui:{path:"Chat > Emote Menu >> General",title:"Stay loaded after opening.",component:"setting-check-box",description:"This causes the emote menu to stay in the DOM even when it's not visible. Enabling this may help the site perform better when opening the menu if it's slow. By default, this setting is enabled when using `Display all emotes on one tab.`"}}),this.settings.add("chat.emote-menu.sort-emotes",{default:4,ui:{path:"Chat > Emote Menu >> Sorting",title:"Sort Emotes By",component:"setting-select-box",data:[{value:4,title:"Native Order, Ascending"},{value:5,title:"Native Order, Descending"},{value:0,title:"Order Added (ID), Ascending"},{value:1,title:"Order Added (ID), Descending"},{value:2,title:"Name, Ascending"},{value:3,title:"Name, Descending"}]}}),this.settings.add("chat.emote-menu.sort-tiers-last",{default:!0,ui:{path:"Chat > Emote Menu >> Sorting",title:"List emotes from higher sub tiers last.",component:"setting-check-box"}}),this.EmoteMenu=this.fine.define("chat-emote-menu",F=>F.getAllEmoteSets&&F.getSortedChannelEmotes&&F.props?.emotePickerSource,v.Z.CHAT_ROUTES),this.MenuWrapper=this.fine.wrap("ffz-emote-menu")}async onEnable(){this.on("i18n:update",()=>this.EmoteMenu.forceUpdate()),this.on("chat.emotes:update-default-sets",this.maybeUpdate,this),this.on("chat.emotes:update-user-sets",this.maybeUpdate,this),this.on("chat.emotes:update-room-sets",this.maybeUpdate,this),this.on("chat.emotes:loaded",this.maybeUpdate,this),this.on("chat.emotes:change-favorite",this.maybeUpdate,this),this.on("chat.emotes:change-hidden",this.maybeUpdate,this),this.on("chat.emoji:populated",this.maybeUpdate,this),this.chat.context.on("changed:chat.emote-menu.enabled",()=>this.EmoteMenu.forceUpdate());const _=G(()=>{for(const V of this.MenuWrapper.instances)V.rebuildData()},"rebuild");this.chat.context.on("changed:chat.emotes.enabled",_),this.chat.context.on("changed:chat.emote-menu.modifiers",_),this.chat.context.on("changed:chat.emote-menu.show-emoji",_),this.chat.context.on("changed:chat.emote-menu.tooltips",_),this.chat.context.on("changed:chat.fix-bad-emotes",_),this.chat.context.on("changed:chat.emote-menu.effect-tab",_),this.chat.context.on("changed:chat.emote-menu.sort-emotes",_),this.chat.context.on("changed:chat.emote-menu.sort-tiers-last",_),this.chat.context.on("changed:chat.emoji.style",this.updateEmojiVariables,this),this.chat.context.getChanges("chat.emote-menu.icon",V=>this.css_tweaks.toggle("emote-menu",V)),this.updateEmojiVariables(),this.css_tweaks.setVariable("emoji-menu--sheet","//cdn.frankerfacez.com/static/emoji/images/sheet-twemoji-36.png"),this.css_tweaks.setVariable("emoji-menu--count",58),this.css_tweaks.setVariable("emoji-menu--size",36);const F=this,K=await this.site.findReact(),H=K&&K.createElement;if(!H)return F.log.warn("Unable to get React.");this.defineClasses(),this.EmoteMenu.ready(V=>{const E=V.prototype.render;V.prototype.render=function(){return this._ffz_no_scan=!1,!this.props||this.props.emotePickerSource==="bits-rewards"||!(0,L.has)(this.props,"channelID")||!F.chat.context.get("chat.emote-menu.enabled")?E.call(this):H(F.MenuErrorWrapper,{visible:this.props.visible},H(F.MenuComponent,{source:this.props.emotePickerSource,visible:this.props.visible,toggleVisibility:this.props.toggleVisibility,channel_data:this.props.channelData,emote_data:this.props.emoteSetsData,user_id:this.props.currentUserID,channel_id:this.props.channelID,loading:this.props.channelData?.loading||this.props.emoteSetsData?.loading,error:this.props.channelData?.error||this.props.emoteSetsData?.error,onClickToken:this.props.onClickToken}))},this.EmoteMenu.forceUpdate()})}updateEmojiVariables(){const _=this.chat.context.get("chat.emoji.style")||"twitter",F=`//cdn.frankerfacez.com/static/emoji/images/sheet-${a.Vf[_]||"twemoji"}-`,K=this.emoji_size=36,H=this.emoji_sheet_count=58,V=this.emoji_sheet_size=H*(K+2),E=this.emoji_sheet_pct=100*V/K;this.emoji_sheet_remain=V-K,this.css_tweaks.set("emoji-menu",`.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {
	background-size: ${E}% ${E}%;
	background-image: url("${F}36.png");
	background-image: ${B.WEBKIT_CSS}image-set(
		url("${F}18.png") 0.5x,
		url("${F}36.png") 1x,
		url("${F}72.png") 2x
	);
}`)}maybeUpdate(){if(this.chat.context.get("chat.emote-menu.enabled"))for(const _ of this.MenuWrapper.instances)_.rebuildData()}defineClasses(){var k,N,Z,se,de;const _=this,F=this.settings.provider,K=this.site.getReact(),H=K&&K.createElement;this.EmojiTonePicker=(k=class extends K.Component{constructor(q){super(q),this.onClick=()=>this.setState({open:!this.state.open}),this.onMouseEnter=()=>this.state.open||this.setState({emoji:this.pickRandomEmoji()}),this.onClickOutside=()=>this.state.open&&this.setState({open:!1}),this.clickTone=le=>{this.props.pickTone(le.currentTarget.dataset.tone),this.setState({open:!1})},this.element=null,this.saveRef=le=>this.element=le,this.state={open:!1,emoji:this.pickRandomEmoji(),tone:null}}componentDidMount(){this.element&&(this._clicker=new b.ClickOutside(this.element,this.onClickOutside))}componentWillUnmount(){this._clicker&&(this._clicker.destroy(),this._clicker=null)}pickRandomEmoji(){const q=this.props.choices,le=Math.floor(Math.random()*q.length);return q[le]}renderTone(q,le){return q?H("button",{key:q.code,"data-tone":le,class:"tw-interactive tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-y-05 tw-pd-x-2",onClick:this.clickTone},this.renderEmoji(q)):null}renderToneMenu(){if(!this.state.open)return null;const q=this.state.emoji;if(!q||!q.variants)return null;const le=Object.entries(q.variants).map(([he,be])=>this.renderTone(be,he));return H("div",{class:"tw-absolute ffz-balloon ffz-il-tooltip--up ffz-il-tooltip--align-right ffz-balloon tw-block"},H("div",{class:"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1"},this.renderTone(q,null),le))}renderEmoji(q){if(!q)return null;const le=q.sheet_x*(_.emoji_size+2)+1,he=q.sheet_y*(_.emoji_size+2)+1,be=100*le/_.emoji_sheet_remain,Ce=100*he/_.emoji_sheet_remain;return H("figure",{class:"ffz--emoji-tone-picker__emoji",style:{backgroundPosition:`${be}% ${Ce}%`}})}render(){const q=this.state.emoji,le=this.props.tone,he=le&&q.variants[le];return H("div",{ref:this.saveRef,class:"ffz--emoji-tone-picker tw-relative tw-mg-l-1"},H("button",{class:"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow",onClick:this.onClick,onMouseEnter:this.onMouseEnter},H("span",{class:"tw-button__text"},this.renderEmoji(he||q)),H("span",{class:"tw-button__icon tw-button__icon--right"},H("figure",{class:"ffz-i-down-dir"}))),this.renderToneMenu())}},G(k,"FFZEmojiTonePicker"),k),this.MenuSection=(N=class extends K.Component{constructor(q){super(q),this.ref=null,this.saveRef=be=>{this.ref&&this.props.stopObserving(this.ref),this.ref=be,be&&this.props.startObserving(this.ref,this)};const le=F.get("emote-menu.collapsed"),he=F.get("emote-menu.hidden-sets");this.state={active:!1,activeEmote:-1,hidden:he&&q.data&&he.includes(q.data.hide_key||q.data.key),collapsed:le&&q.data&&le.includes(q.data.key),intersecting:!window.IntersectionObserver},this.keyHeading=this.keyHeading.bind(this),this.clickHeading=this.clickHeading.bind(this),this.clickEmote=this.clickEmote.bind(this),this.mouseEnter=()=>this.state.intersecting||this.setState({intersecting:!0}),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.props.addSection(this),this.ref&&this.props.startObserving(this.ref,this)}componentWillUnmount(){this.props.removeSection(this),this.ref&&this.props.stopObserving(this.ref)}keyInteract(q){}clickEmote(q){if(this.props.visibility_control){const ze=q.currentTarget.dataset;let Me,ce=ze.id;if(ze.provider==="twitch")Me="twitch";else if(ze.provider==="ffz"){const ye=_.emotes.emote_sets[ze.set],Ee=ye&&ye.emotes[ce];if(!Ee)return;Me=ye.source||"ffz",ce=Ee.id}else return;_.emotes.toggleHidden(Me,ce);return}if(_.emotes.handleClick(q,!0))return;let le="",he="";const be=q.currentTarget.dataset.effects,Ce=q.currentTarget.dataset.effectPrefix==="true";be?.length>0&&be!="0"&&_.emotes.target_emote&&(Ce?he=` ${_.emotes.target_emote.name}`:le=`${_.emotes.target_emote.name} `),this.props.onClickToken(`${le}${q.currentTarget.dataset.name}${he}`)}keyHeading(q){(q.keyCode===B.KEYS.Enter||q.keyCode===B.KEYS.Space)&&this.clickHeading()}clickHeading(){if(this.props.visibility_control){const Ce=F.get("emote-menu.hidden-sets")||[],ze=this.props.data.hide_key||this.props.data.key,Me=Ce.indexOf(ze);if(ze==="twitch-current-channel")return;Me===-1?(Ce.push(ze),this.setState({hidden:!0})):(Ce.splice(Me,1),this.setState({hidden:!1})),F.set("emote-menu.hidden-sets",Ce),_.emit("chat.emotes:change-set-hidden",ze);return}if(this.props.filtered)return;const q=F.get("emote-menu.collapsed")||[],le=!this.state.collapsed,he=this.props.data.key,be=q.indexOf(he);if(this.setState({collapsed:le}),le&&be===-1)q.push(he);else if(!le&&be!==-1)q.splice(be,1);else return;F.set("emote-menu.collapsed",q)}onMouseEnter(q){const le=q.currentTarget.dataset.setId;this.setState({unlocked:le})}onMouseLeave(){this.setState({unlocked:null})}render(){const q=this.props.data,le=this.props.filtered,he=this.props.visibility_control;let be=!(q.is_favorites&&!this.props.combineTabs)&&this.props.showHeading;be===2?be=!le:be=!!be,he&&(be=!0);const Ce=he?this.state.hidden:!1,ze=he?Ce:be&&!le&&this.state.collapsed;if(!q)return null;let Me;q.image?Me=H("img",{class:`ffz--menu-badge${q.image_large?" ffz--menu-badge__large":""}`,src:q.image,srcSet:q.image_set}):Me=H("figure",{class:`ffz--menu-badge ffz-i-${q.icon||"zreknarf"}`});let ce;const ye=q.renews&&q.renews.getTime(),Ee=q.ends&&q.ends.getTime();ye>0?ce={icon:"calendar",message:_.i18n.t("emote-menu.sub-renews","This sub renews {seconds,humantime}.",{seconds:ye})}:Ee&&(q.prime?ce={icon:"crown",message:_.i18n.t("emote-menu.sub-prime",`This is your free sub with Prime Gaming.
It ends {seconds,humantime}.`,{seconds:Ee})}:q.gift?ce={icon:"gift",message:_.i18n.t("emote-menu.sub-gift-ends","This gifted sub ends {seconds,humantime}.",{seconds:Ee})}:ce={icon:"calendar-empty",message:_.i18n.t("emote-menu.sub-ends","This sub ends {seconds,humantime}.",{seconds:Ee})});let Ae=q.source_i18n?_.i18n.t(q.source_i18n,q.source):q.source;return Ae==null&&(Ae="FFZ"),H("section",{ref:this.saveRef,"data-key":q.key,class:le?"filtered":"",onMouseEnter:this.mouseEnter},be?H("heading",{tabindex:"0",class:"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap",onKeyDown:this.keyHeading,onClick:this.clickHeading},Me,H("div",{class:"tw-pd-l-05"},(q.i18n?_.i18n.t(q.i18n,q.title):q.title)||_.i18n.t("emote-menu.unknown","Unknown Source"),!he&&ce&&H("span",{class:`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${ce.icon}`,"data-tooltip-type":"html","data-title":ce.message})),H("div",{class:"tw-flex-grow-1"}),H("span",{class:!he&&q.channel_source?"ffz-tooltip":"","data-title":q.channel_source},he?Ce?_.i18n.t("emote-menu.visibility.hidden","Hidden"):_.i18n.t("emote-menu.visibility.visible","Visible"):Ae),!he&&le?"":H("figure",{class:`tw-pd-l-05 ffz-i-${ze?"left":"down"}-dir`})):null,ze||this.renderBody(be))}renderBody(q){const le=this.props.data,he=this.props.filtered,be=le.locks&&le.locks[this.state.unlocked],Ce=le.filtered_emotes&&le.filtered_emotes.map(ze=>{if(he&&ze.locked)return;const Me=ze.locked&&(!be||!be.emotes.has(ze.id)),ce=Me&&le.locks&&le.locks[ze.set_id];let ye="";return ce&&(ce.id==="subwoofer"?ye=_.i18n.t("emote-menu.emote-subwoofer","Become an FFZ Subwoofer to unlock this emote."):ce.id==="cheer"?ye=_.i18n.t("emote-menu.emote-cheer","Cheer an additional {bits_remaining, plural, one {# bit} other {# bits}} to unlock this emote.",ce):ce.id==="follower"?ye=_.i18n.t("emote-menu.emote-follower","Follow {user} to unlock this emote in their channel.",ce):le.all_locked?ye=_.i18n.t("emote-menu.emote-sub","Subscribe for {price} to unlock this emote.",ce):ye=_.i18n.t("emote-menu.emote-up","Upgrade your sub to {price} to unlock this emote.",ce)),this.renderEmote(ze,Me,q,ye)});return H("div",{class:"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center"},Ce,!this.props.visibility_control&&!he&&this.renderSellout())}renderEmote(q,le,he,be){if(!this.state.intersecting)return H("span",{key:q.id,class:"emote-picker__placeholder",style:{width:`${q.width||28}px`,height:`${q.height||28}px`}});const Ce=this.props.visibility_control,ze=this.props.emote_modifiers[q.id],Me=Array.isArray(ze)&&ze.length>0,ce=this.props.animated,ye=Ce&&q.hidden,Ee=_.chat.context.get("chat.emote-menu.tooltips");let Ae,$e;return ce&&q.animSrc?(Ae=q.animSrc,$e=q.animSrcSet):(Ae=q.src,$e=q.srcSet),H("button",{key:q.id,class:`${Ee?"ffz-tooltip ":""}emote-picker__emote-link${!Ce&&le?" locked":""}${ye?" emote-hidden":""}`,"data-tooltip-type":"emote","data-provider":q.provider,"data-id":q.id,"data-set":q.set_id,"data-code":q.code,"data-modifiers":ze,"data-effects":q.effects,"data-effect-prefix":q.effect_prefix,"data-variant":q.variant,"data-no-source":he,"data-name":q.name,"aria-label":q.name,"data-locked":q.locked,"data-sellout":be,onClick:(this.props.visibility_control||!q.locked)&&this.clickEmote},H("figure",{class:"emote-picker__emote-figure"},H("img",{class:`emote-picker__emote-image${q.emoji?" ffz-emoji":""}`,src:Ae,srcSet:$e,alt:q.name,height:q.height?`${q.height}px`:null,width:q.width?`${q.width}px`:null})),!Ce&&Me&&H("div",{class:"emote-button__options"}),!Ce&&q.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"}),!Ce&&le&&H("figure",{class:`ffz-i-${q.lock_icon||"lock"}`}),ye&&H("figure",{class:"ffz-i-eye-off"}))}renderSellout(){const q=this.props.data;if(!q.all_locked||!q.locks)return null;let le=q.locks[this.state.unlocked],he=Object.values(q.locks).filter(Ce=>Ce.id!=="cheer"),be=he.filter(Ce=>Ce.is_ffz).length>0;return!le&&q.locks.length===1&&(le=q.locks[0]),he.length?H("div",{class:"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0"},be?_.i18n.t("emote-menu.ffz-unlock","This feature is available to FFZ Subwoofers."):le?_.i18n.t("emote-menu.sub-unlock","Subscribe for {price} to unlock {count, plural, one {# emote} other {# emotes}}",{price:le.price,count:le.emotes.size}):_.i18n.t("emote-menu.sub-basic","Subscribe to unlock some emotes"),be&&this.props.ffz_sub_data?.has_free_sub?H("div",{class:"tw-pd-y-1"},_.i18n.t("emote-menu.free-sub.about","As thanks for supporting us in the past, you can get one month of FFZ Subwoofer for free.")):null,H("div",{class:"ffz--sub-buttons tw-mg-t-05"},he.map(Ce=>Ce.hide_button?null:H("a",{key:Ce.price,class:"tw-button tw-border-radius-none",href:Ce.url,target:"_blank",rel:"noopener noreferrer","data-set-id":Ce.set_id,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},H("span",{class:"tw-button__text"},be&&this.props.ffz_sub_data?.has_free_sub?_.i18n.t("emote-menu.free-sub","Use My Free Month"):Ce.price))))):null}},G(N,"FFZMenuSection"),N),this.fine.wrap("ffz-menu-section",this.MenuSection),this.EmojiSection=(Z=class extends this.MenuSection{renderEmote(q,le,he,be){const Ce=q.x*(_.emoji_size+2)+1,ze=q.y*(_.emoji_size+2)+1,Me=100*Ce/_.emoji_sheet_remain,ce=100*ze/_.emoji_sheet_remain,ye=_.chat.context.get("chat.emote-menu.tooltips");return H("button",{key:q.id,class:`${ye?"ffz-tooltip ":""}emote-picker__emote-link${le?" locked":""}${q.emoji?" emote-picker__emoji":""}`,"data-tooltip-type":"emote","data-provider":q.provider,"data-id":q.id,"data-set":q.set_id,"data-code":q.code,"data-variant":q.variant,"data-no-source":he,"data-name":q.name,"aria-label":q.name,"data-locked":q.locked,"data-sellout":be,onClick:!q.locked&&this.clickEmote},H("figure",{class:"emote-picker__emote-figure",style:{backgroundPosition:`${Me}% ${ce}%`}}),q.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"}),le&&H("figure",{class:`ffz-i-${q.lock_icon||"lock"}`}))}},G(Z,"FFZMenuEmojiSection"),Z);let V;const E=G(()=>requestAnimationFrame(()=>this.emit("tooltips:cleanup")),"doClear"),x=G(()=>{clearTimeout(V),setTimeout(E,100)},"clearTooltips");this.MenuErrorWrapper=(se=class extends K.Component{constructor(q){super(q),this.state={errored:!1,error:null}}static getDerivedStateFromError(q){return{errored:!0,error:q}}componentDidCatch(q){_.log.capture(q),_.log.error("Error rendering the FFZ Emote Menu."),this.setState({errored:!0,error:q})}render(){if(this.state.errored){if(!this.props.visible)return null;const q=_.chat.context.get("chat.emote-menu.reduced-padding");return H("div",{class:`ffz-balloon ffz-balloon--md ffz-il-tooltip--up ffz-il-tooltip--align-right tw-block tw-absolute ffz--emote-picker${q?" reduced-padding":""}`,"data-a-target":"emote-picker"},H("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},H("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},H("div",{class:"tw-align-center tw-pd-1"},H("div",{class:"tw-mg-b-1"},H("div",{class:"tw-mg-2"},H("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),_.i18n.t("emote-menu.error","There was an error rendering this menu."),H("br",null),_.settings.get("reports.error.enable")?_.i18n.t("emote-menu.error-report","An error report has been automatically submitted."):"",H("div",{class:"tw-mg-t-05 tw-border-t-1 tw-pd-t-05"},_.i18n.t("emote-menu.disable","As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.")))))))}return this.props.children}},G(se,"FFZEmoteMenuErrorWrapper"),se),this.MenuComponent=(de=class extends K.Component{constructor(q){super(q),this.nav_ref=null,this.saveNavRef=le=>{this.nav_ref=le},this.ref=null,this.saveScrollRef=le=>{this.ref=le,this.createObserver()},this.sections=[],this.activeSection=-1,this.state={tab:null,active_nav:null,stayLoaded:_.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:_.chat.context.get("chat.emote-menu.show-quick-nav"),animated:_.chat.context.get("chat.emotes.animated"),showHeading:_.chat.context.get("chat.emote-menu.show-heading"),tall:_.chat.context.get("chat.emote-menu.tall"),reducedPadding:_.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:_.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:_.chat.context.get("chat.emote-menu.show-search"),clearSearch:_.chat.context.get("chat.emote-menu.clear-search"),hasNewEffects:!1,unlockedEffects:_.settings.provider.get("unlocked-effects",[]),tone:_.settings.provider.get("emoji-tone",null)},q.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),this.rebuildData(),this.observing=new Map,this.addSection=le=>{this.sections.includes(le)||this.sections.push(le)},this.removeSection=le=>{const he=this.sections.indexOf(le);he!==-1&&(this.sections.splice(he),he===this.activeSection?this.activeSection=-1:he<this.activeSection&&this.activeSection--)},this.startObserving=this.startObserving.bind(this),this.stopObserving=this.stopObserving.bind(this),this.handleObserve=this.handleObserve.bind(this),this.pickTone=this.pickTone.bind(this),this.clickTab=this.clickTab.bind(this),this.clickSideNav=this.clickSideNav.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.toggleVisibilityControl=this.toggleVisibilityControl.bind(this)}createObserver(){if(this.observer){if(this._observed===this.ref)return;this.observer.disconnect(),this.observer=this._observed=null}if(!(!this.ref||!window.IntersectionObserver)){this._observed=this.ref,this.observer=new IntersectionObserver(this.handleObserve,{root:this.ref,rootMargin:"50px 0px",threshold:.01});for(const q of this.observing.keys())this.observer.observe(q);this.observeSoon()}}observeSoon(){requestAnimationFrame(()=>{this.observer&&this.handleObserve(this.observer.takeRecords())})}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=this._observed=null)}scrollNavIntoView(){requestAnimationFrame(()=>{const q=this.nav_ref?.querySelector?.(`button[data-key="${this.state.active_nav}"]`);q&&$(q)})}handleObserve(q){let le=!1,he=this.state.active_nav;for(const be of q){const Ce=this.observing.get(be.target),ze=be.isIntersecting;!Ce||Ce.state.intersecting===ze||(le=!0,Ce.setState({intersecting:ze}),ze&&(he=Ce.props?.data?.key))}le&&(requestAnimationFrame(x),!this.lock_active&&he!==this.state.active_nav&&this.setState({active_nav:he},()=>this.scrollNavIntoView()))}startObserving(q,le){const he=this.observing.get(q);le!==he&&(he&&this.stopObserving(q),this.observing.set(q,le),this.observer&&this.observer.observe(q),this.observeSoon())}stopObserving(q){this.observing.has(q)&&(this.observing.delete(q),this.observer&&this.observer.unobserve(q))}componentDidMount(){this.ref&&this.createObserver(),_.chat.context.on("changed:chat.emotes.animated",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.show-heading",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.show-search",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.clear-search",this.updateSettingState,this),_.chat.context.on("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu=this}componentWillUnmount(){this.destroyObserver(),_.chat.context.off("changed:chat.emotes.animated",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.show-heading",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.show-search",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.clear-search",this.updateSettingState,this),_.chat.context.off("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu===this&&(window.ffz_menu=null)}updateSettingState(){this.setState({stayLoaded:_.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:_.chat.context.get("chat.emote-menu.show-quick-nav"),animated:_.chat.context.get("chat.emotes.animated"),showHeading:_.chat.context.get("chat.emote-menu.show-heading"),reducedPadding:_.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:_.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:_.chat.context.get("chat.emote-menu.show-search"),clearSearch:_.chat.context.get("chat.emote-menu.clear-search"),tall:_.chat.context.get("chat.emote-menu.tall")})}seeEffects(){this.state.hasNewEffects&&(_.settings.provider.set("unlocked-effects",this.state.unlockedEffects),this.setState({hasNewEffects:!1}))}pickTone(q){q=q||null,_.settings.provider.set("emoji-tone",q),this.setState(this.filterState(this.state.filter,this.buildEmoji(Object.assign({},this.state,{tone:q}))))}clickSideNav(q){const le=q.currentTarget.dataset.key,he=this.ref?.querySelector?.(`section[data-key="${le}"]`);he&&(this.lock_active=!0,$(he),this.setState({active_nav:le}),setTimeout(()=>this.lock_active=!1,250))}clickTab(q){const le=q.currentTarget.dataset.tab;if(le==="effect"&&this.seeEffects(),this.state.combineTabs){let he;switch(le){case"fav":he=this.state.filtered_fav_sets;break;case"channel":he=this.state.filtered_channel_sets;break;case"effect":he=this.state.filtered_effect_sets;break;case"emoji":he=this.state.filtered_emoji_sets;break;case"all":default:he=this.state.filtered_all_sets;break}const be=he&&he[0],Ce=be&&this.ref?.querySelector?.(`section[data-key="${be.key}"]`);Ce&&$(Ce);return}this.setState({tab:le})}clickSettings(q){const le=new r.FFZEvent({item:"chat.emote_menu",event:q,errored:!1});_.emit("main_menu:open",le)}toggleVisibilityControl(){this.setState(this.filterState(this.state.filter,this.state,!this.state.visibility_control))}handleFilterChange(q){this.setState(this.filterState(q.target.value,this.state))}handleKeyDown(q){if(q.keyCode===B.KEYS.Escape)this.props.toggleVisibility();else return;q.preventDefault()}loadData(q=!1,le,he){if(he=he||this.state,!he)return!1;le=le||this.props;const be=le.emote_data&&le.emote_data.emoteSets,Ce=Array.isArray(be)?new Set(be.map(ze=>ze.id)):new Set;return q=q||he.set_data&&!(0,L.set_equals)(he.set_sets,Ce),he.set_data&&!q?!1:(this.setState({loading:!0},()=>{_.getData(Ce,q).then(ze=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{set_sets:Ce,set_data:ze,loading:!1}))))})}),!0)}loadFFZPlanData(q=!1,le,he){return he=he||this.state,!he||he.ffz_plan_loading||he.ffz_sub_data&&!q?!1:(this.setState({ffz_plan_loading:!0},()=>{_.getFFZSubPrices().then(be=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_plan_data:be,ffz_plan_loading:!1}))))})}),!0)}loadFFZSubData(q=!1,le,he){return he=he||this.state,!he||he.ffz_loading||he.ffz_sub_data&&!q?!1:(this.setState({ffz_loading:!0},()=>{_.getFFZSubData().then(be=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_sub_data:be,ffz_loading:!1}))))})}),!0)}filterState(q,le,he){const be=Object.assign({},le);return he!=null?be.visibility_control=he:he=be.visibility_control,be.filter=q,be.filtered=q&&q.length>0&&q!==":"||!1,be.filtered_channel_sets=this.filterSets(q,be.channel_sets,he),be.filtered_effect_sets=this.filterSets(q,be.effect_sets,he),be.filtered_all_sets=this.filterSets(q,be.all_sets,he),be.filtered_fav_sets=this.filterSets(q,be.fav_sets,he),be.filtered_emoji_sets=this.filterSets(q,be.emoji_sets,he),be.has_effect_tab=be.filtered_effect_sets.length>0,be}filterSets(q,le,he){const be=[];if(!le||!le.length)return be;const Ce=q&&q.length>0&&q!==":",ze=F.get("emote-menu.hidden-sets")||[];for(const Me of le){if(!he&&ze.includes(Me.key))continue;(Me.filtered_emotes=Me.emotes.filter(ye=>!he&&ye.hidden?!1:!Ce||!ye.locked&&this.doesEmoteMatch(q,ye))).length&&be.push(Me)}return be}doesEmoteMatch(q,le){if(!q||!q.length)return!0;const he=le.search||le.name,be=he.toLowerCase(),Ce=q.toLowerCase(),ze=q.startsWith(":"),Me=Ce.slice(1);if(Array.isArray(le.extra)){let ye=le.extra.length;for(;ye--;){if(!ze&&le.extra[ye].includes(Ce))return!0;if(ze&&le.extra[ye].startsWith(Me))return!0}}if(!ze)return be.includes(Ce);if(be.startsWith(Me))return!0;const ce=he.indexOf(q.charAt(1).toUpperCase());return ce!==-1?be.slice(ce+1).startsWith(Ce.slice(2)):!1}buildEmoji(q){const le=Object.assign({},q),he=le.emoji_sets=[],be=_.emotes.getFavorites("emoji"),Ce=le.favorites=(le.favorites||[]).filter(ye=>!ye.emoji),ze=le.tone=le.tone||null,Me=le.tone_emoji=[],ce={};if(_.chat.context.get("chat.emote-menu.show-emoji")){let ye=_.chat.context.get("chat.emoji.style")||"twitter";a.Vf[ye]||(ye="twitter");for(const Ee of Object.values(_.emoji.emoji)){if(!Ee||!Ee.has[ye]||a.D3.includes(Ee.category))continue;if(Ee.variants){for(const it of Ee.names)if(z.includes(it)){Me.push(Ee);break}}const Ae=be.includes(Ee.code),$e=Ee.variants&&Ee.variants[ze],Ne=$e&&$e.has[ye],tt=Ne?$e:Ee;let qe=ce[Ee.category];qe||(qe=ce[Ee.category]=[],he.push({key:`emoji-${Ee.category}`,sort_key:a.of.indexOf(Ee.category),emoji:!0,image:_.emoji.getFullImage(tt.image),i18n:`emoji.category.${Ee.category.toSnakeCase()}`,title:a.aA[Ee.category]||Ee.category,src:"emoji",source:"Emoji",source_i18n:"emote-menu.emoji",emotes:qe}));const ot={provider:"emoji",id:Ee.sort,emoji:!0,code:Ee.code,name:tt.raw,variant:Ne&&ze,hidden:Ee.hidden,search:Ee.names[0],extra:Ee.names.length>1?Ee.names.map(it=>it.toLowerCase()):null,height:18,width:18,x:tt.sheet_x,y:tt.sheet_y,favorite:Ae,src:_.emoji.getFullImage(tt.image),srcSet:_.emoji.getFullImageSet(tt.image)};qe.push(ot),Ae&&Ce.push(ot)}}return le.has_emoji_tab=he.length>0,le.fav_sets=[{key:"favorites",title:"Favorites",i18n:"emote-menu.favorites",icon:"star",source:"",is_favorites:!0,emotes:Ce}],Ce.sort(this.getSorter()),he.sort(A),le}getAllSets(){return[...this.state.channel_sets||[],...this.state.effect_sets||[],...this.state.all_sets||[]]}getSorter(){return m[_.chat.context.get("chat.emote-menu.sort-emotes")]||m[0]||(()=>0)}buildState(q,le){const he=Object.assign({},le),be=he.set_data||{},Ce=he.emote_modifiers={},ze=he.channel_sets=[],Me=he.all_sets=[],ce=he.effect_sets=[],ye=he.favorites=[];if(q.loading||q.error||he.loading||he.set_data&&this.loadData(!1,q,he))return he;const Ee=this.getSorter(),Ae=_.chat.context.get("chat.emote-menu.sort-tiers-last"),$e=G((Ue,Be)=>{if(Ue.misc||Be.misc)return Ee(Ue,Be);if(!Ue.locked&&Be.locked)return-1;if(Ue.locked&&!Be.locked)return 1;if(Ae||Ue.locked||Be.locked)if(Ue.bits||Be.bits){if(Be.bits){if(!Ue.bits)return-1}else return 1;const at=Ue.bit_value||0,lt=Be.bit_value||0;if(c){const Qe=c.compare(at,lt);if(Qe!=0)return Qe}else{if(at<lt)return-1;if(at>lt)return 1}}else if(c){const at=c.compare(Ue.set_id,Be.set_id);if(at!=0)return at}else{if(Ue.set_id<Be.set_id)return-1;if(Ue.set_id>Be.set_id)return 1}return Ee(Ue,Be)},"sort_emotes"),Ne=q.channel_data&&q.channel_data.user,tt=Ne&&Ne.subscriptionProducts,qe=Ne&&q.channel_data?.channel?.localEmoteSets,ot=Ne&&Ne.self?.follower!=null,it=!ot&&q.user_id&&Ne?.id!=q.user_id,st=Ne?.cheer?.badgeTierEmotes,pt=new Set;if(Array.isArray(qe))for(const Ue of qe)Ue?.id&&pt.add(Ue.id);const nt=q.emote_data&&q.emote_data.emoteSets,yt=q.emote_data&&q.emote_data.emoteMap,ht=_.emotes.getFavorites("twitch"),ut=_.emotes.getHidden("twitch"),He=new Set,We=[],Ke={},dt=new Set;if(Array.isArray(nt))for(const Ue of nt){if(!Ue||!Array.isArray(Ue.emotes))continue;const Be=Ue.id,at=parseInt(Be,10),lt=Ue.owner,Qe=pt.has(Be),et=!Qe&&at>5e8,Ze=B.TWITCH_POINTS_SETS.includes(at)||lt?.login==="channel_points",Re=Qe?Ne:Ze?null:lt,je=be[Be],Ye=et&&lt&&lt.id==Ne?.id;dt.add(Be);let Ge=`twitch-set-${Be}`,Le=0,Ve="twitch",Je=Re&&(Re.displayName||Re.login);if(Je?(Ge=`twitch-${Re?.id}`,Qe?_.emotes.setTwitchSetChannel(Be,{id:Be,type:B.EmoteTypes.Follower,owner:{id:Re.id,login:Re.login,displayName:Re.displayName}}):et?_.emotes.setTwitchSetChannel(Be,{id:Be,type:B.EmoteTypes.BitsTier,owner:{id:Re.id,login:Re.login,displayName:Re.displayName}}):_.emotes.setTwitchSetChannel(Be,{id:Be,type:B.EmoteTypes.Subscription,owner:{id:Re.id,login:Re.login,displayName:Re.displayName}})):Re?Je=_.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:Be}):Ze?(Je=_.i18n.t("emote-menu.points","Unlocked with Points"),Ge="twitch-points",Ve="channel-points",Le=45):B.TWITCH_GLOBAL_SETS.includes(at)?(Je=_.i18n.t("emote-menu.global","Global Emotes"),Ge="twitch-global",Le=100,_.emotes.setTwitchSetChannel(Be,{id:Be,type:B.EmoteTypes.Global,owner:null})):B.TWITCH_PRIME_SETS.includes(at)?(Je=_.i18n.t("emote_menu.prime","Prime"),Ge="twitch-prime",Ve="crown",Le=75,_.emotes.setTwitchSetChannel(Be,{id:Be,type:B.EmoteTypes.Prime,owner:null})):(Je=_.i18n.t("emote-menu.misc","Miscellaneous"),Ge="twitch-misc",Ve="inventory",Le=50),Qe)continue;let ft,mt;Ke[Ge]?(ft=Ke[Ge],mt=ft.emotes,je&&ft.bad&&(ft.bad=!1,ft.renews=je.renews,ft.ends=je.ends,ft.prime=je.prime,ft.gift=je.gift)):(mt=[],ft=Ke[Ge]={sort_key:Le,key:Ge,image:Re?.profileImageURL,image_large:!0,icon:Ve,title:Je,source:_.i18n.t("emote-menu.twitch","Twitch"),emotes:mt,renews:je?.renews,ends:je?.ends,prime:je?.prime,gift:je?.gift},je||(ft.bad=!0));let St=0;for(const gt of Ue.emotes){if(!gt||!gt.id||!gt.token)continue;const At=gt.id,Dt=B.KNOWN_CODES[gt.token]||gt.token,Ft=yt&&yt[Dt];Ze||_.emotes.setTwitchEmoteSet(At,Be);const Tt=[""];if(Array.isArray(gt.modifiers)&&gt.modifiers.length&&_.chat.context.get("chat.emote-menu.modifiers")===1)for(const xt of gt.modifiers)Tt.push(`_${xt.code}`);for(const xt of Tt){const _t=`${At}${xt}`,Lt=`${Dt}${xt}`,Pt=ht.includes(_t),$t=Ft&&Ft.id!=_t,Mt=B.REPLACEMENTS[_t];let kt,Ot,Bt,Rt;Mt&&_.chat.context.get("chat.fix-bad-emotes")?kt=`${B.REPLACEMENT_BASE}${Mt}`:(kt=(0,L.getTwitchEmoteURL)(_t,1,!1),Ot=(0,L.getTwitchEmoteSrcSet)(_t,!1),Bt=(0,L.getTwitchEmoteURL)(_t,1,!0),Rt=(0,L.getTwitchEmoteSrcSet)(_t,!0));const zt={provider:"twitch",id:_t,set_id:Be,name:Lt,src:kt,srcSet:Ot,animSrc:Bt,animSrcSet:Rt,order:St++,overridden:$t?Ft.id:null,misc:!Re,bits:et,hidden:ut.includes(_t),favorite:Pt};mt.push(zt),Ye&&We.push(zt),Pt&&!He.has(_t)&&ye.push(zt),He.add(_t)}}mt.length&&(mt.sort($e),Me.includes(ft)||Me.push(ft))}if(Array.isArray(qe)||Array.isArray(tt)||Array.isArray(st)){const Ue=_.badges.getTwitchBadge("subscriber","0",Ne.id,Ne.login),Be=[],at=new Set,lt={},Qe={sort_key:-10,key:"twitch-current-channel",hide_key:`twitch-${Ne.id}`,image:Ue&&Ue.image1x,image_set:Ue&&`${Ue.image1x} 1x, ${Ue.image2x} 2x, ${Ue.image4x} 4x`,icon:"twitch",title:_.i18n.t("emote-menu.main-set","Channel Emotes"),source:_.i18n.t("emote-menu.twitch","Twitch"),emotes:Be,locks:lt,all_locked:!0};if(Array.isArray(qe))for(const Ze of qe){if(!Ze||!Array.isArray(Ze.emotes))continue;const Re=Ze.id;let je;it&&(lt[Re]={set_id:Re,id:"follower",user:Ne?.displayName||Ne?.login,hide_button:!0,emotes:je=new Set});let Ye=0;for(const Ge of Ze.emotes){if(!Ge||!Ge.id||!Ge.token)continue;const Le=Ge.id,Ve=B.KNOWN_CODES[Ge.token]||Ge.token,Je=He.has(Le),ft=ht.includes(Le),mt={provider:"twitch",id:Le,set_id:Re,name:Ve,order:Ye++,src:(0,L.getTwitchEmoteURL)(Le,1,!1),srcSet:(0,L.getTwitchEmoteSrcSet)(Le,!1),animSrc:(0,L.getTwitchEmoteURL)(Le,1,!0),animSrcSet:(0,L.getTwitchEmoteSrcSet)(Le,!0),favorite:ft,hidden:ut.includes(Le),locked:it,lock_icon:"heart"};Be.push(mt),ft&&!Je&&ye.push(mt),He.add(Le),je&&je.add(Le)}}if(Array.isArray(tt))for(const Ze of tt){if(!Ze||!Array.isArray(Ze.emotes))continue;const Re=Ze.emoteSetID,je=be[Re],Ye=!dt.has(Re);let Ge;je&&(Qe.renews=je.renews,Qe.ends=je.ends,Qe.prime=je.prime,Qe.gift=je.gift&&je.gift.isGift),Ye?lt[Re]={set_id:Re,id:Ze.id,price:Ze.price||y[Ze.tier],url:Ze.url,emotes:Ge=new Set(at)}:Qe.all_locked=!1;let Le=0;for(const Ve of Ze.emotes){if(!Ve||!Ve.id||!Ve.token)continue;const Je=Ve.id,ft=B.KNOWN_CODES[Ve.token]||Ve.token,mt=He.has(Je),St=ht.includes(Je),gt={provider:"twitch",id:Je,set_id:Re,name:ft,order:Le++,locked:Ye&&!mt,src:(0,L.getTwitchEmoteURL)(Je,1,!1),srcSet:(0,L.getTwitchEmoteSrcSet)(Je,!1),animSrc:(0,L.getTwitchEmoteURL)(Je,1,!0),animSrcSet:(0,L.getTwitchEmoteSrcSet)(Je,!0),favorite:St,hidden:ut.includes(Je)};Be.push(gt),!Ye&&St&&!mt&&ye.push(gt),He.add(Je),Ge&&(at.add(Je),Ge.add(Je))}}const et=new Set;if(Array.isArray(st)){let Ze;for(const Re of st){if(!Re||!Re.id||!Re.bitsBadgeTierSummary)continue;const je=Re.id,Ye=Re.setID,Ge=Re.bitsBadgeTierSummary,Le=!He.has(je)&&!Ge.self?.isUnlocked;Le&&(lt[Ye]={set_id:Ye,id:"cheer",price:null,bits:Ge.threshold,bits_remaining:Ge.self?.numberOfBitsUntilUnlock??Ge.threshold,emotes:new Set([Re.id])});const Ve=ht.includes(je),Je={provider:"twitch",id:je,set_id:Ye,name:Re.token,locked:Le,order:Ze++,src:(0,L.getTwitchEmoteURL)(je,1,!1),srcSet:(0,L.getTwitchEmoteSrcSet)(je,!1),animSrc:(0,L.getTwitchEmoteURL)(je,1,!0),animSrcSet:(0,L.getTwitchEmoteSrcSet)(je,!0),bits:!0,bit_value:Ge.threshold,favorite:Ve,hidden:ut.includes(je)};Be.push(Je),!Le&&Ve&&!He.has(je)&&ye.push(Je),et.add(je),He.add(je)}}if(We.length)for(const Ze of We)et.has(Ze.id)||Be.push(Ze);Be.length&&(Be.sort($e),ze.push(Qe))}let rt=!1,vt=!1,bt=!1;const wt=[..._.settings.provider.get("unlocked-effects",[])];if(_.chat.context.get("chat.emotes.enabled")>1){const Ue=_.site.getUser(),Be=_.chat.context.get("chat.emote-menu.effect-tab"),at=_.emotes.getRoomSetsWithSources(Ue?.id,Ue?.login,q.channel_id,null),lt=_.emotes.getSubSetsWithSources(),Qe=_.emotes.getGlobalSetsWithSources(Ue?.id,Ue?.login),et=new Set,Ze={};let Re={};for(const[Ye,Ge,Le]of at){if(et.has(Ye))continue;et.add(Ye);const Ve=this.processFFZSet(Ye,Ge,ye,Ze,Re,!1,void 0,Le,q.channel_id);Ve&&(Ve.emotes.sort($e),ze.includes(Ve)||ze.push(Ve))}Re={};const je=Qe.map(Ye=>Ye?.[0]?.id);for(const[Ye,Ge]of lt){if(et.has(Ye))continue;et.add(Ye);const Le=!je.includes(Ye.id);rt=!0;const Ve=this.processFFZSet(Ye,Ge,ye,Ze,Re,Le,he);Ve&&(Ve.emotes.sort($e),Be&&!ce.includes(Ve)&&Ve.has_effects?(bt=this.checkNewEffects(Ve.emotes,wt)||bt,ce.push(Ve)):Me.includes(Ve)||Me.push(Ve))}Re={};for(const[Ye,Ge]of Qe){if(et.has(Ye))continue;et.add(Ye);const Le=this.processFFZSet(Ye,Ge,ye,Ze,Re);Le&&(Le.emotes.sort($e),Be&&!ce.includes(Le)&&Le.has_effects?(bt=this.checkNewEffects(Le.emotes,wt)||bt,ce.push(Le)):Me.includes(Le)||Me.push(Le),!ze.includes(Le)&&(0,L.maybe_call)(Le.force_global,this,Ye,q.channel_data&&q.channel_data.user,Ue)&&ze.push(Le))}}return he.wants_resub_info=rt,he.wants_plan_info=vt,this.props.visible&&(he.tab==="effects"&&(bt=!1),vt&&this.loadFFZPlanData(),rt&&this.loadFFZSubData()),ze.sort(A),ce.sort(A),Me.sort(A),he.has_channel_tab=ze.length>0,he.has_effect_tab=ce.length>0,he.hasNewEffects=ce.length>0&&bt,he.unlockedEffects=wt,this.buildEmoji(he)}checkNewEffects(q,le){let he=!1;for(const be of q)be&&!be.locked&&be.id&&be.provider==="ffz"&&!le.includes(be.id)&&(he=!0,le.push(be.id));return he}processFFZSet(q,le,he,be,Ce,ze=!1,Me,ce,ye=null){if(!q||!q.emotes)return null;let Ee;if(ce){const He=_.parent.shared_room_data?.get(ce);Ee=He?.displayName??He?.login}const Ae=q.source||"ffz",$e=_.emotes.getFavorites(Ae),Ne=_.emotes.getHidden(Ae),tt=be[Ae]=be[Ae]||new Set,qe=`${q.merge_source||Ae}-${q.merge_id||q.id}`,ot=_.emotes.providers.get(le),it=ot&&ot.menu_name?ot.menu_i18n_key?_.i18n.t(ot.menu_i18n_key,ot.menu_name,ot):ot.menu_name:q.source||"FFZ",st=le==="ffz-main"||q.title_is_channel?Ee?_.i18n.t("emote-menu.source-set","{channel}'s Emotes",{channel:Ee}):_.i18n.t("emote-menu.main-set","Channel Emotes"):q.title||_.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:q.id});let pt=ot&&ot.sort_key||q.sort;pt==null&&(pt=q.title.toLowerCase().includes("global")?100:0),ce&&ce!==ye&&(pt+=50);let nt,yt,ht;Ce[qe]?(nt=Ce[qe],yt=nt.emotes,qe===`${Ae}-${q.id}`&&Object.assign(nt,{sort_key:pt,image:q.icon,title:st,source:it,channel_source:Ee,force_global:q.force_global})):(yt=[],nt=Ce[qe]={sort_key:pt,key:qe,image:q.icon,icon:"zreknarf",title:st,source:it,channel_source:Ee,emotes:yt,force_global:q.force_global,all_locked:!0});const ut=(Me||this.state)?.ffz_sub_data?.sets?.[q.id];ut&&(nt.renews=ut.next_bill_date,nt.ends=ut.expires_at),ze?(nt.locks=nt.locks||{},nt.locks[q.id]={set_id:q.id,id:"subwoofer",is_ffz:!0,price:"More Info",url:"https://www.frankerfacez.com/subscribe",emotes:ht=new Set}):nt.all_locked=!1;for(const He of Object.values(q.emotes))if(!He.hidden){const We=$e.includes(He.id),Ke={provider:"ffz",id:He.id,set_id:q.id,src:He.src,srcSet:He.srcSet,animSrc:He.animSrc,animSrcSet:He.animSrcSet,effects:He.modifier?He.modifier_flags:0,effect_prefix:He.modifier?He.modifier_prefix:!1,name:He.name,favorite:We,locked:ze,hidden:Ne.includes(He.id),height:He.height,width:He.width};yt.push(Ke),!ze&&We&&!tt.has(He.id)&&(he.push(Ke),tt.add(He.id)),ze&&ht.add(He.id),He.modifier&&He.modifier_flags&&(nt.has_effects=!0)}if(yt.length)return nt}rebuildData(){const q=this.buildState(this.props,this.state);this.setState(this.filterState(q.filter,q))}componentDidUpdate(q){if(this.props.visible&&!q.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),!this.props.visible&&q.visible&&this.state.clearSearch){this.setState(this.filterState("",this.state));return}const le=this.props.channel_data,he=q.channel_data,be=le?.user!==he?.user||le?.channel!==he?.channel,Ce=this.props.emote_data,ze=q.emote_data,Me=!(0,L.deep_equals)(Ce?.emoteSets,ze?.emoteSets)||!(0,L.deep_equals)(Ce?.emoteMap,ze?.emoteMap);(be||Me||this.props.user_id!==q.user_id||this.props.channel_id!==q.channel_id||this.props.loading!==q.loading||this.props.error!==q.error)&&(_.log.debug("Updating emote menu data. cd",be,", ed",Me),this.rebuildData())}renderError(){return H("div",{class:"tw-align-center tw-pd-1"},H("div",{class:"tw-mg-b-1"},H("div",{class:"tw-mg-2"},H("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),_.i18n.t("emote-menu.error","There was an error rendering this menu.")),H("button",{class:"tw-button",onClick:this.forceUpdate},H("span",{class:"tw-button__text"},_.i18n.t("error.try-again","Try Again"))))}renderEmpty(){return H("div",{class:"tw-align-center tw-pd-1"},H("div",{class:"tw-mg-2"},H("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),this.state.filtered?_.i18n.t("emote-menu.empty-search","There are no matching emotes."):this.state.tab==="fav"?_.i18n.t("emote-menu.empty-favs","You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.",{hotkey:B.IS_OSX?"\u2318":"Ctrl"}):_.i18n.t("emote-menu.empty","There's nothing here."))}renderLoading(){return H("div",{class:"tw-align-center tw-pd-1"},H("h1",{class:"tw-mg-5 ffz-i-zreknarf loading"}),_.i18n.t("emote-menu.loading","Loading..."))}render(){if(!this.props.visible&&(!this.state.stayLoaded||!this.loadedOnce))return null;const q=this.state.loading||this.props.loading,le=this.state.reducedPadding,he=this.state.combineTabs;q||(this.loadedOnce=!0);let be,Ce,ze,Me,ce;if(he)Ce=[this.state.filtered_fav_sets,this.state.filtered_channel_sets,this.state.filtered_effect_sets,this.state.filtered_all_sets,this.state.filtered_emoji_sets].flat();else switch(be=this.state.tab||_.chat.context.get("chat.emote-menu.default-tab"),(be==="effect"&&!this.state.has_effect_tab||be==="channel"&&!this.state.has_channel_tab||be==="emoji"&&!this.state.has_emoji_tab)&&(be="all"),ze=be==="emoji",Me=be==="fav",ce=be==="effect",be){case"fav":Ce=this.state.filtered_fav_sets;break;case"channel":Ce=this.state.filtered_channel_sets;break;case"effect":Ce=this.state.filtered_effect_sets;break;case"emoji":Ce=this.state.filtered_emoji_sets;break;case"all":default:Ce=this.state.filtered_all_sets;break}const ye=this.state.visibility_control,Ee=this.props.source==="whisper";return H("div",{class:`tw-block${this.props.visible?"":" tw-hide"}`,style:{display:this.props.visible?null:"none !important"}},H("div",{class:"tw-absolute ffz-attached ffz-attached--right ffz-attached--up"},H("div",{class:`ffz-balloon ffz-balloon--auto tw-inline-block tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2 ffz--emote-picker${this.state.tall?" ffz--emote-picker__tall":""}${le?" reduced-padding":""}`,"data-a-target":"emote-picker",role:"dialog"},H("div",{class:`emote-picker${Ee?"__whisper":""}`},H("div",{class:"tw-flex"},H("div",{class:`emote-picker__tab-content${Ee?"-whisper":""} tw-full-width scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},H("div",{ref:this.saveScrollRef,class:"simplebar-scroll-content"},H("div",{class:"simplebar-content"},q&&this.renderLoading(),!q&&Ce&&Ce.map((Ae,$e)=>Ae&&(!ye||!Ae.emoji&&!Ae.is_favorites)&&H(Ae.emoji?_.EmojiSection:_.MenuSection,{key:Ae.key,idx:$e,data:Ae,ffz_sub_data:this.state.ffz_sub_data,emote_modifiers:this.state.emote_modifiers,animated:this.state.animated,combineTabs:this.state.combineTabs,showHeading:this.state.showHeading,filtered:this.state.filtered,visibility_control:ye,onClickToken:this.props.onClickToken,addSection:this.addSection,removeSection:this.removeSection,startObserving:this.startObserving,stopObserving:this.stopObserving})),!q&&(!Ce||!Ce.length)&&this.renderEmpty()))),!q&&this.state.quickNav&&!Me&&H("div",{class:`emote-picker__nav_content${Ee?"-whisper":""} tw-block tw-border-radius-none tw-c-background-alt-2`},H("div",{class:`emote-picker__nav-content-overflow${Ee?"-whisper":""} scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},H("div",{ref:this.saveNavRef,class:"simplebar-scroll-content"},H("div",{class:"simplebar-content"},!q&&Ce&&Ce.map(Ae=>{if(!Ae||ye&&(Ae.is_favorites||Ae.emoji))return null;const $e=this.state.active_nav===Ae.key;return H("button",{key:Ae.key,class:`${$e?"emote-picker-tab-item-wrapper__active ":""}${le?"tw-mg-y-05":"tw-mg-y-1"} tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse`,"data-key":Ae.key,"data-title":`${Ae.i18n?_.i18n.t(Ae.i18n,Ae.title):Ae.title}
${Ae.source_i18n?_.i18n.t(Ae.source_i18n,Ae.source):Ae.source}${Ae.channel_source?` (${Ae.channel_source})`:""}`,"data-tooltip-side":"left",onClick:this.clickSideNav},H("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${le?"":"tw-pd-x-05 "}tw-pd-y-05${$e?" emote-picker-tab-item-avatar__active tw-c-text-link":""}`},Ae.image?H("figure",{class:"ffz-avatar ffz-avatar--size-20"},H("img",{class:"tw-block tw-border-radius-rounded tw-img tw-image-avatar",src:Ae.image,srcSet:Ae.image_set})):H("figure",{class:`ffz-emote-picker--nav-icon ffz-i-${Ae.icon||"zreknarf"}`})))}),he&&H("div",{class:"tw-mg-y-1 tw-mg-x-05 tw-border-t"}),he&&H("button",{class:"tw-mg-y-1 tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse","data-title":_.i18n.t("emote-menu.settings","Open Settings"),"data-tooltip-side":"left",onClick:this.clickSettings},H("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${le?"":"tw-pd-x-05 "}tw-pd-y-05`},H("figure",{class:"ffz-emote-picker--nav-icon ffz-i-cog"})))))))),H("div",{class:"emote-picker__controls-container tw-relative"},(ze||this.state.showSearch)&&H("div",{class:"tw-border-t tw-pd-1"},H("div",{class:"tw-flex"},H("input",{type:"text",class:"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width ffz-input tw-pd-x-1 tw-pd-y-05",placeholder:ze?_.i18n.t("emote-menu.search-emoji","Search for Emoji"):_.i18n.t("emote-menu.search","Search for Emotes"),value:this.state.filter,autoFocus:!0,autoCapitalize:"off",autoCorrect:"off",onChange:this.handleFilterChange,onKeyDown:this.handleKeyDown}),(he||ze)&&!ye&&this.state.has_emoji_tab&&H(_.EmojiTonePicker,{tone:this.state.tone,choices:this.state.tone_emoji,pickTone:this.pickTone}),(he||!ze)&&H("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},H("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon--primary ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.state.visibility_control?" ffz-core-button--primary":" tw-button-icon"}`,onClick:this.toggleVisibilityControl},H("span",{class:"tw-button-icon__icon tw-mg-x-05"},H("figure",{class:this.state.visibility_control?"ffz-i-eye-off":"ffz-i-eye"}))),H("div",{class:"ffz-il-tooltip ffz-il-tooltip--up ffz-il-tooltip--align-right"},this.state.visibility_control?_.i18n.t("emote-menu.toggle-hide.on","Exit Emote Visibility Control"):_.i18n.t("emote-menu.toggle-hide.off","Emote Visibility Control"),H("div",{class:"tw-mg-t-1 ffz--tooltip-explain"},_.i18n.t("emote-menu.toggle-hide.info","Emote Visibility Control allows you to hide emotes from your emote menu, either individually or by set. With Emote Visibility Control enabled, just click an emote to hide or unhide it. Please note that you will still see the emotes in chat if someone uses them, but they won't appear in your emote menu.")))))),he&&this.state.quickNav?null:H("div",{class:"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt"},!ye&&H("div",{class:`emote-picker-tab-item${be==="fav"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="fav"?" ffz-interactable--selected":""}`,id:"emote-picker__fav","data-tab":"fav","data-tooltip-type":"html","data-title":_.i18n.t("emote-menu.favorites","Favorites"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-star"})))),this.state.has_channel_tab&&H("div",{class:`emote-picker-tab-item${be==="channel"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="channel"?" ffz-interactable--selected":""}`,id:"emote-picker__channel","data-tab":"channel","data-tooltip-type":"html","data-title":_.i18n.t("emote-menu.channel","Channel"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-camera"})))),this.state.has_effect_tab&&H("div",{class:`emote-picker-tab-item${be==="effect"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="effect"?" ffz-interactable--selected":""}`,id:"emote-picker__effect","data-tab":"effect","data-tooltip-type":"html","data-title":_.i18n.t("emote-menu.effects","Emote Effects"),onClick:this.clickTab},this.state.hasNewEffects&&H("div",{class:"ffz-new-indicator"}),H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-fx"})))),H("div",{class:`emote-picker-tab-item${be==="all"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="all"?" ffz-interactable--selected":""}`,id:"emote-picker__all","data-tab":"all","data-tooltip-type":"html","data-title":_.i18n.t("emote-menu.my-emotes","My Emotes"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-channels"})))),!ye&&this.state.has_emoji_tab&&H("div",{class:`emote-picker-tab-item${be==="emoji"?" emote-picker-tab-item--active":""} tw-relative`},H("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${be==="emoji"?" ffz-interactable--selected":""}`,id:"emote-picker__emoji","data-tab":"emoji","data-tooltip-type":"html","data-title":_.i18n.t("emote-menu.emoji","Emoji"),onClick:this.clickTab},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-smile"})))),H("div",{class:"tw-flex-grow-1"}),H("div",{class:"emote-picker-tab-item tw-relative"},H("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive","data-tooltip-type":"html","data-title":_.i18n.t("emote-menu.settings","Open Settings"),onClick:this.clickSettings},H("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},H("figure",{class:"ffz-i-cog"}))))))))))}},G(de,"FFZEmoteMenuComponent"),de),this.fine.wrap("ffz-emote-menu",this.MenuComponent)}async getFFZSubPrices(){let _;try{_=await fetch(`${this.staging.api}/payment/plans`).then(K=>K.ok?K.json():null)}catch(K){this.log.error("Unable to load subscription prices from server.",K),_=null}const F={sets:{}};for(const K of Object.values(_.plans)){if(!Array.isArray(K.temporary_collections))continue;let H;for(const V of Object.values(_.gateway_plans))if(V.plan_id===K.id&&V.months===1){H=V.prices;break}if(H)for(const V of K.temporary_collections)F.sets[V]={plan_id:K.id,prices:H}}return F}async getFFZSubData(){if(!this.resolve("site").getUser())return null;const F=await this.resolve("socket").getBareAPIToken();if(!F)return null;let K;try{K=await fetch(`${this.staging.api}/v2/subscription/status?include=plan`,{headers:{Authorization:`Bearer ${F}`}}).then(V=>V.ok?V.json():null)}catch(V){this.log.error("Unable to load subscription status from server.",V),K=null}if(!K)return{error:!0};const H={has_free_sub:K.user?.bonus_month_eligible??!1,sets:{}};if(K.user?.active_subs)for(const V of Object.values(K.user.active_subs)){const E=K.plans?.[V.id];if(Array.isArray(E?.temporary_collections))for(const x of E.temporary_collections)H.sets[x]={plan_id:V.id,expires_at:V.expires_at?new Date(V.expires_at):null,next_bill_date:V.next_bill_date?new Date(V.next_bill_date):null}}return H}async getData(_,F,K=null,H=[]){if(this._data){if(!F&&(0,L.set_equals)(_,this._data_sets))return this._data;this._data=null,this._data_sets=null}let V;try{V=await this.apollo.client.query({query:C(),variables:{first:75,after:K,criteria:{filter:"ALL"}},fetchPolicy:F?"network-only":"cache-first"})}catch(Z){return this.log.warn("Error fetching additional emote menu data.",Z),this._data=null}const E={},x=(0,L.get)("data.currentUser.subscriptionBenefits.edges.@each.node",V),k=(0,L.get)("data.currentUser.subscriptionBenefits.pageInfo.hasNextPage",V),N=(0,L.get)("data.currentUser.subscriptionBenefits.edges.@last.cursor",V);if(H=H.concat(x),k)return this.getData(_,F,N,H);if(H&&H.length)for(const Z of H){const se=Z&&Z.product,de=se&&se.emoteSetID;de&&(E[de]={ends:o(Z.endsAt),renews:o(Z.renewsAt),prime:Z.purchasedWithPrime,set_id:de,type:se.type,gift:Z.gift?.isGift})}return this._data_sets=_,this._data=E}};G(De,"EmoteMenu");let h=De;h.getData=(0,L.once)(h.getData),h.getFFZSubData=(0,L.once)(h.getFFZSubData),h.getFFZSubPrices=(0,L.once)(h.getFFZSubPrices);const T=Intl.Collator(),R=Intl.Collator(void 0,{sensitivity:"accent"}),P=0,O=1,M=2,j=3,Y=4;function ee(Oe){return Oe?Oe.type==="emote"?Oe.emoteName:Oe.type==="text"?Oe.text:Array.isArray(Oe.children)?Oe.children.map(ee).join(""):"":""}G(ee,"getNodeText");function X(Oe,_){let F=0,K=0,H=Oe;for(;K<_.length;){const V=_[K];for(let E=0;E<V;E++)F+=ee(H[E]).length;H=Array.isArray(H[V])?H[V]:H[V]?.children,K++}return F}G(X,"getNodeOffset");const Ie=class Ie extends D.default{constructor(..._){super(..._),this.inject("chat"),this.inject("chat.actions"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.settings.add("chat.hype.display-input",{default:!0,ui:{path:"Chat > Hype Chat >> Input",title:"Allow the Hype Chat button to appear in the chat input element.",component:"setting-check-box"}}),this.settings.add("chat.inline-preview.enabled",{default:!0,ui:{path:"Chat > Input >> Appearance",title:"Display in-line previews of FrankerFaceZ emotes when entering a chat message.",description:"**Note:** This feature is temperamental. It may not display all emotes, and emote effects and overlay emotes are not displayed correctly. Once this setting has been enabled, it cannot be reasonably disabled and will remain active until you refresh the page.",component:"setting-check-box"}}),this.settings.add("chat.mru.enabled",{default:!0,ui:{path:"Chat > Input >> Recent Messages",title:"Allow pressing up and down to recall previously sent chat messages.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.ffz-emotes",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of FrankerFaceZ emotes.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emoji",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emoji.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emotes-without-colon",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emotes without typing a colon. (:)",description:"This will prevent the tab-completion of usernames without the @ prefix.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.limit-results",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Limit tab-completion results to 25.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-favorites",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize favorite emotes at the top.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-prefix-matches",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize emotes that start with user input.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.matching",{default:1,ui:{path:"Chat > Input >> Tab Completion",title:"Emote Matching Type",description:"1: `ppa` would match `Kappa`\n\n2: `sip` would match `cohhSip` but not `Gossip`\n\n3: `pasta` would match `pastaThat` but not `HoldThat`",component:"setting-select-box",data:[{value:1,title:"1: Anything (Twitch style)"},{value:2,title:"2: Non-Prefix (Old FFZ style)"},{value:3,title:"3: Exact (Case-Insensitive)"}]}}),this.ChatInput=this.fine.define("chat-input",F=>F&&F.setLocalChatInputRef&&F.setLocalAutocompleteInputRef,v.Z.CHAT_ROUTES),this.EmoteSuggestions=this.fine.define("tab-emote-suggestions",F=>F&&F.getMatches&&F.autocompleteType==="emote",v.Z.CHAT_ROUTES),this.MentionSuggestions=this.fine.define("tab-mention-suggestions",F=>F&&F.getMentions&&F.renderMention,v.Z.CHAT_ROUTES),this.CommandSuggestions=this.fine.define("tab-cmd-suggestions",F=>F&&F.getMatches&&F.doesCommandMatchTerm,v.Z.CHAT_ROUTES),this.EmoteUsageCount={TriHard:196568036,Kappa:192158118,"4Head":155758710,PogChamp:151485090,cmonBruh:146352878,BibleThump:56472964,WutFace:45069031,Kreygasm:41387580,DansGame:38097659,SMOrc:34734484,KappaPride:34262839,VoHiYo:27886434,SwiftRage:24561900,ResidentSleeper:24438298,EleGiggle:19891526,FailFish:19118343,NotLikeThis:18802905,Keepo:18351415,BabyRage:18220906,MingLee:18026207,HeyGuys:14851569,ANELE:14648986,PJSalt:14438861}}async onEnable(){this.chat.context.on("changed:chat.hype.display-input",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room-above",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.tab-complete.emotes-without-colon",H=>{for(const V of this.EmoteSuggestions.instances)V.canBeTriggeredByTab=H;for(const V of this.MentionSuggestions.instances)V.canBeTriggeredByTab=!H}),this.use_previews=this.chat.context.get("chat.inline-preview.enabled"),this.chat.context.on("changed:chat.inline-preview.enabled",H=>{if(!this.use_previews&&(this.use_previews=H,H))for(const V of this.ChatInput.instances)this.installPreviewObserver(V),V.ffzInjectEmotes(),V.forceUpdate(),this.emit("site:dom-update","chat-input",V)});const _=await this.site.findReact(),F=_&&_.createElement;if(!F)return this.log.warn("Unable to get React.");const K=this;this.ChatInput.ready((H,V)=>{const E=H.prototype.render;H.prototype.render=function(){const x=E.call(this);try{if(!K.chat.context.get("chat.hype.display-input")){const he=(0,b.findReactFragment)(x,be=>be.key==="paidPinnedMessage");he&&(he.type=()=>null)}const N=K.chat.context.get("chat.actions.room-above"),Z=K.chat.context.get("context.chat_state")||{},se=N?(0,b.findReactFragment)(x,he=>he.props&&Array.isArray(he.props.children)):(0,b.findReactFragment)(x,he=>he.props&&he.props.className==="chat-input__buttons-container");if(!se||!se.props||!se.props.children)return x;const de=this.props;if(!de||!de.channelID)return x;const _e=de.sessionUser?{id:de.sessionUser.id,login:de.sessionUser.login,displayName:de.sessionUser.displayName,mod:de.isCurrentUserModerator,staff:de.isStaff}:null,q={id:de.channelID,login:de.channelLogin,displayName:de.channelDisplayName,emoteOnly:de.emoteOnlyMode,slowMode:de.slowMode,slowDuration:de.slowModeDuration,subsMode:de.subsOnlyMode,r9kMode:Z.r9k,followersOnly:Z.followersOnly,followersDuration:Z.followersOnlyRequirement},le=K.actions.renderRoom(K.chat.context.get("context.chat.showModIcons"),_e,q,N,F);N?se.props.children.unshift(le||null):se.props.children.splice(1,0,le||null)}catch(k){K.log.error(k),K.log.capture(k)}return x};for(const x of V)x.forceUpdate(),this.emit("site:dom-update","chat-input",x),this.updateEmoteCompletion(x),this.overrideChatInput(x),x.ffzInjectEmotes(),this.installPreviewObserver(x)}),this.EmoteSuggestions.ready((H,V)=>{for(const E of V)this.overrideEmoteMatcher(E)}),this.MentionSuggestions.ready((H,V)=>{for(const E of V)this.overrideMentionMatcher(E)}),this.CommandSuggestions.ready((H,V)=>{for(const E of V)this.overrideCommandMatcher(E)}),this.ChatInput.on("update",this.updateEmoteCompletion,this),this.ChatInput.on("mount",this.overrideChatInput,this),this.ChatInput.on("mount",this.installPreviewObserver,this),this.ChatInput.on("unmount",this.removePreviewObserver,this),this.EmoteSuggestions.on("mount",this.overrideEmoteMatcher,this),this.MentionSuggestions.on("mount",this.overrideMentionMatcher,this),this.CommandSuggestions.on("mount",this.overrideCommandMatcher,this),this.chat.context.on("changed:chat.emotes.animated",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.emotes.enabled",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.tab-complete.matching",this.uncacheTabCompletion,this),this.on("chat.emotes:change-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-set-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-favorite",this.uncacheTabCompletion,this),this.on("chat.emotes:update-default-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-user-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-room-sets",this.uncacheTabCompletion,this),this.on("site.css_tweaks:update-chat-css",this.resizeInput,this)}uncacheTabCompletion(){for(const _ of this.EmoteSuggestions.instances)_.ffz_ffz_cache=null,_.ffz_twitch_cache=null;if(this.use_previews)for(const _ of this.ChatInput.instances)_.ffzInjectEmotes(),_.forceUpdate(),this.emit("site:dom-update","chat-input",_)}updateInput(){for(const _ of this.ChatInput.instances)_&&(_.forceUpdate(),this.emit("site:dom-update","chat-input",_))}resizeInput(){this._resize_waiter&&cancelAnimationFrame(this._resize_waiter),this._resize_waiter=requestAnimationFrame(()=>this._resizeInput())}_resizeInput(){this._resize_waiter=null;for(const _ of this.ChatInput.instances)_.resizeInput()}installPreviewObserver(_){if(_._ffz_preview_observer||!window.MutationObserver||!this.use_previews)return;const F=this.fine.getHostNode(_),K=F&&F.querySelector(".chat-input__textarea");K&&(_._ffz_preview_observer=new MutationObserver(H=>{for(const V of H)for(const E of V.addedNodes)E instanceof Element&&this.checkForPreviews(_,E)}),_._ffz_preview_observer.observe(K,{childList:!0,subtree:!0}))}checkForPreviews(_,F){if(F.querySelector?.('span[data-a-target="chat-input-emote-preview"]'))for(const K of document.querySelectorAll(".tw-tooltip-layer img.chat-line__message--emote"))K&&K.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__")&&this.updatePreview(_,K);for(const K of F.querySelectorAll?.("img.chat-line__message--emote"))K&&(K.dataset.ffzId||K.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__"))&&this.updatePreview(_,K)}updatePreview(_,F){let K=F.dataset.ffzSet,H=F.dataset.ffzId;if(!H){const se=F.src.indexOf("__FFZ__",49),de=F.src.slice(49,se),_e=de.indexOf("::");if(_e===-1)return;K=de.slice(0,_e),H=de.slice(_e+2),F.dataset.ffzSet=K,F.dataset.ffzId=H}const V=this.emotes.emote_sets[K],E=V?.emotes?.[H];if(!E)return;const x=this.chat.context.get("chat.emotes.animated")>0;F.src=(x?E.animSrc:null)??E.src,F.srcset=(x?E.animSrcSet:null)??E.srcSet;const k=`${E.width}px`,N=`${E.height}px`;F.style.width=k,F.style.height=N;const Z=F.closest(".chat-image__container");if(Z){Z.style.width=k,Z.style.height=N;const se=Z.closest(".chat-line__message--emote-button");se&&(se.style.width=k,se.style.height=N,se._ffz_click_handler||(se._ffz_click_handler=this.previewClick.bind(this,E.id,V.id,E.name),se.addEventListener("click",se._ffz_click_handler)))}}previewClick(_,F,K,H){const V=this.makeEvent({provider:"ffz",id:_,set:F,name:K,source:H});this.emit("chat.emotes:click",V),V.defaultPrevented&&(H.preventDefault(),H.stopImmediatePropagation())}removePreviewObserver(_){_._ffz_preview_observer&&(_._ffz_preview_observer.disconnect(),_._ffz_preview_observer=null)}updateEmoteCompletion(_,F){F||(F=this.fine.searchTree(_,"tab-emote-suggestions",50)),F&&(F._ffz_user=_.props.sessionUser,F._ffz_channel_id=_.props.channelID,F._ffz_channel_login=_.props.channelLogin)}overrideChatInput(_){if(_._ffz_override)return;const F=this,K=_.onKeyDown,H=_.onMessageSend,V=_.resizeInput,E=_.componentDidUpdate;_.ffzInjectEmotes=function(){const x=this.props.emotes.findIndex(N=>N?.id==="FrankerFaceZWasHere"),k=F.createFakeEmoteSet(_);if(x===-1&&k)this.props.emotes.push(k);else if(x!==-1&&k)this.props.emotes.splice(x,1,k);else if(x!==-1&&!k)this.props.emotes.splice(x,1);else return},_.componentDidUpdate=function(x,...k){try{x.emotes!==this.props.emotes&&Array.isArray(this.props.emotes)&&_.ffzInjectEmotes()}catch(N){F.log.error("Error updating emote autocompletion data.",N)}E&&E.call(this,x,...k)},_.resizeInput=function(x,...k){try{if(x){if(_.chatInputRef instanceof Element){const N=getComputedStyle(_.chatInputRef),Z=N&&parseFloat(N.lineHeight||18)||18,se=Z*1+20.5,de=Math.ceil((_.chatInputRef.scrollHeight-se)/Z),_e=Math.min(1+de,4);_.setState({numInputRows:_e})}}else _.setState({numInputRows:1})}catch(N){return F.log.error("Error in resizeInput",N),V.call(this,x,...k)}},_.messageHistory=[],_.tempInput="",_.messageHistoryPos=-1,_.ffzGetValue=function(){return _.chatInputRef&&typeof _.chatInputRef.value=="string"?_.chatInputRef.value:_.state.value&&typeof _.state.value=="string"?_.state.value:""},_.ffzGetSelection=function(){if(typeof _.chatInputRef?.selectionEnd=="number")return[_.chatInputRef.selectionStart,_.chatInputRef.selectionEnd];if(_.chatInputRef?.state?.slateEditor){const x=_.chatInputRef.state.slateEditor,k=x.selection,N=x.children;if(!k?.anchor?.path||!k?.focus?.path)return[0,0];const Z=X(N,k.anchor.path)+k.anchor.offset,se=X(N,k.focus.path)+k.focus.offset;return Z<se?[Z,se]:[se,Z]}return[0,0]},_.ffzSetSelection=function(x,k){_.chatInputRef?.setSelectionRange&&_.chatInputRef.setSelectionRange(x,k)},_.onKeyDown=function(x){try{const k=x.charCode||x.keyCode;if(_.onEmotePickerToggle&&F.chat.context.get("chat.emote-menu.shortcut")&&x.key==="e"&&x.ctrlKey&&!x.altKey&&!x.shiftKey){_.onEmotePickerToggle(),x.preventDefault();return}const N=_.ffzGetValue();if(_.autocompleteInputRef&&_.chatInputRef&&F.chat.context.get("chat.mru.enabled")&&!x.shiftKey&&!x.ctrlKey&&!x.altKey){const Z=_.ffzGetSelection();if(k===38&&Z[0]===0&&Z[1]===0){if(!_.messageHistory.length)return;N&&_.messageHistoryPos===-1&&(_.tempInput=N),_.messageHistoryPos<_.messageHistory.length-1&&(_.messageHistoryPos++,_.autocompleteInputRef.setValue(_.messageHistory[_.messageHistoryPos]),_.ffzSetSelection(0));return}else if(k===40&&Z[0]>=N.length&&Z[1]===Z[0]){if(!_.messageHistory.length)return;_.messageHistoryPos>0?(_.messageHistoryPos--,_.autocompleteInputRef.setValue(_.messageHistory[_.messageHistoryPos]),_.ffzSetSelection(_.messageHistory[_.messageHistoryPos].length)):_.messageHistoryPos===0&&(_.autocompleteInputRef.setValue(_.tempInput),_.ffzSetSelection(_.tempInput.length),_.messageHistoryPos=-1);return}}k===B.KEYS.Escape&&!x.shiftKey&&!x.ctrlKey&&!x.altKey&&(_.props.isShowingEmotePicker?_.props.closeEmotePicker():_.props.tray&&(!_.state.value||!_.state.value.length)&&_.props.clearTray())}catch(k){F.log.capture(k),F.log.error(k)}K.call(this,x)},_.onMessageSend=function(x){try{if(F.chat.context.get("chat.mru.enabled")){const k=_.ffzGetValue();k&&k.length&&(!_.messageHistory.length||_.messageHistory[0]!==k)&&(_.messageHistory.unshift(k),_.messageHistory=_.messageHistory.slice(0,20)),_.messageHistoryPos=-1,_.tempInput=""}}catch(k){F.log.capture(k),F.log.error(k)}H.call(this,x)}}overrideMentionMatcher(_){_.canBeTriggeredByTab=!this.chat.context.get("chat.tab-complete.emotes-without-colon")}overrideCommandMatcher(_){if(_._ffz_override)return;_._ffz_override=!0,_.oldCommands=_.getCommands,_.oldMatches=_.getMatches,_.oldReplacement=_.determineReplacement;const F=this;_.getMatches=function(V,E,x){try{return x===0&&F.chat.CommandPrefixes.includes(V[0])?_.getCommands(V):null}catch(k){return F.log.error("Error getting matches from command handler.",k),_.oldCommands(V,E,x)}},_.getCommands=function(V){try{const E=_.props.getCommands(_.props.permissionLevel,{isEditor:_.props.isCurrentUserEditor}),x=F.fine.searchParent(_,_e=>_e?.props?.channelID&&_e?.props?.setTray,50),k=F.makeEvent({input:V,permissionLevel:_.props.permissionLevel,isEditor:_.props.isCurrentUserEditor,commands:E,__input:x,channel:x?{id:x.props.channelID,login:x.props.channelLogin}:null});if(F.emit("chat:get-tab-commands",k),!E||!E.length)return null;const N=V[0],Z=V.slice(1),se=E.filter(_e=>N===(_e.prefix??"/")&&_.doesCommandMatchTerm(_e,Z)).sort(_.sortCommands),de=[];for(const _e of se){const q=_e.commandArgs?.[0];let le;q?.isRequired&&(le=`[${q.name}]`),de.push({current:V,replacement:_.determineReplacement(_e),description:_e.description,element:_.renderCommandSuggestion(_e,Z),group:_e.ffz_group?Array.isArray(_e.ffz_group)?F.i18n.t(..._e.ffz_group):_e.ffz_group:_.determineGroup(_e),selection:le})}return N!=="/"&&!de.length?null:de}catch(E){return console.error(E),_.oldCommands(V)}},_.determineReplacement=function(V){const E=_.oldReplacement(V);return(V.prefix??"/")!=="/"&&E.startsWith("/")?V.prefix+E.slice(1):E};const K=this.site.getReact(),H=K?.createElement;H&&(_.renderCommandSuggestion=function(V,E){const x=Array.isArray(V?.commandArgs)?V.commandArgs.map(k=>H("div",{class:`tw-mg-r-05${k.isRequired?"":" tw-c-text-alt"}`},"[",k.name,"]")):null;return H("div",{class:"tw-pd-05"},H("div",{class:"tw-flex"},H("div",{class:"tw-mg-r-05"},H("span",null,V.prefix??"/"),H("span",{class:"tw-semibold"},V.name)),x),H("p",{class:"tw-c-text-alt-2 tw-font-size-7"},V.description))})}createFakeEmoteSet(_){if(!this.use_previews)return null;if(!_._ffz_channel_login){const k=this.fine.searchParent(_,"chat-input",50);k&&this.updateEmoteCompletion(k,_)}const F=_._ffz_user,K=_._ffz_channel_id,H=_._ffz_channel_login;if(!H)return null;const V=this.emotes.getSets(F?.id,F?.login,K,H);if(!V||!V.length)return null;const E=[],x=new Set;for(const k of V){if(!k||!k.emotes)continue;const N=k.source||"ffz";for(const Z of Object.values(k.emotes))!Z||!Z.id||!Z.name||x.has(Z.name)||(x.add(Z.name),E.push({id:`__FFZ__${k.id}::${Z.id}__FFZ__`,modifiers:null,setID:"FrankerFaceZWasHere",token:Z.name}))}return{__typename:"EmoteSet",emotes:E,id:"FrankerFaceZWasHere",owner:null}}overrideEmoteMatcher(_){if(_._ffz_override)return;const F=this;_.canBeTriggeredByTab=this.chat.context.get("chat.tab-complete.emotes-without-colon"),_.getMatches=function(V,E){return E?V.length<2?null:_.getMatchedEmotes(V):V.startsWith(":")?V.length<3?null:_.getMatchedEmotes(V):null},_.doesEmoteMatchTerm=function(V,E){const x=V.name||V.token;if(!x)return P;if(x.startsWith(E))return Y;let k=V.tokenLower;k||(k=x.toLowerCase());const N=E.toLowerCase();if(k.startsWith(N))return j;const Z=x.indexOf(E.charAt(0).toUpperCase());return Z!==-1&&k.slice(Z+1).startsWith(N.slice(1))?M:k.includes(N)?O:P},_.getMatchedEmotes=function(V){const E=F.chat.context.get("chat.emotes.enabled"),x=F.chat.context.get("chat.tab-complete.limit-results");let k=E?F.getTwitchEmoteSuggestions(V,this):[];if(E>1&&F.chat.context.get("chat.tab-complete.ffz-emotes")){const N=F.getEmoteSuggestions(V,this);Array.isArray(N)&&N.length&&(k=k.concat(N))}if(F.chat.context.get("chat.tab-complete.emoji")){const N=F.getEmojiSuggestions(V,this);Array.isArray(N)&&N.length&&(k=Array.isArray(k)?k.concat(N):N)}return k=F.sortEmotes(k),x&&k.length>25?k.slice(0,25):k};const K=this.site.getReact(),H=K?.createElement;_.renderFFZEmojiSuggestion=function(V){return H(K.Fragment,null,H("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:V.token,favorite:V.favorite},H("img",{class:"emote-autocomplete-provider__image ffz-emoji",src:V.src,srcSet:V.srcset}),V.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"})),H("div",{class:"tw-ellipsis",title:V.token},V.token))},_.renderEmoteSuggestion=function(V){return H(K.Fragment,null,H("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:V.token,favorite:V.favorite},H("img",{class:"emote-autocomplete-provider__image",srcSet:V.srcSet}),V.favorite&&H("figure",{class:"ffz--favorite ffz-i-star"})),H("div",{class:"tw-ellipsis",title:V.token},V.token))}}sortEmotes(_){const F=this.chat.context.get("chat.tab-complete.prioritize-favorites"),K=this.chat.context.get("chat.tab-complete.emotes-without-colon"),H=this.chat.context.get("chat.tab-complete.prioritize-prefix-matches");return _.sort((V,E)=>{const x=V.matched||V.replacement,k=E.matched||E.replacement;if(F&&V.favorite^E.favorite)return 0-V.favorite+E.favorite;if(H){const N=!!V.matched,Z=!!E.matched;if(N^Z)return K?0-N+Z:0-Z+N;const se=V.match_type===Y,de=E.match_type===Y;if(se&&de)return T.compare(x,k);if(se)return-1;if(de)return 1;const _e=V.match_type===j,q=E.match_type===j;return _e&&q?R.compare(x,k):_e?-1:q?1:T.compare(x,k)}return 0})}buildTwitchCache(_){if(!Array.isArray(_))return{emotes:[],length:0};const F=[],K=new Set,H=this.chat.context.get("chat.emotes.animated")>0,V=this.settings.provider.get("emote-menu.hidden-sets"),E=Array.isArray(V)&&V.length>0,x=this.emotes.getHidden("twitch"),k=this.emotes.getFavorites("twitch");for(const N of _){const Z=parseInt(N.id,10),se=N.owner,de=B.TWITCH_POINTS_SETS.includes(Z)||se?.login==="channel_points",_e=de?null:se;if(N.id==="FrankerFaceZWasHere")continue;let q=`twitch-set-${N.id}`,le=null;if(_e?.login?(q=`twitch-${_e.id}`,le=_e.displayName||_e.login):de?q="twitch-points":B.TWITCH_GLOBAL_SETS.includes(Z)?q="twitch-global":B.TWITCH_PRIME_SETS.includes(Z)?q="twitch-prime":q="twitch-misc",!(E&&V.includes(q)))for(const he of N.emotes){if(!he||!he.id||x.includes(he.id))continue;const be=he.id,Ce=B.KNOWN_CODES[he.token]||he.token;if(!Ce||K.has(Ce))continue;K.add(Ce);const ze=B.REPLACEMENTS[be];let Me;ze&&this.chat.context.get("chat.fix-bad-emotes")?Me=`${B.REPLACEMENT_BASE}${ze} 1x`:Me=(0,L.getTwitchEmoteSrcSet)(be,H),F.push({id:be,source:q,extra:le,setID:N.id,token:Ce,tokenLower:Ce.toLowerCase(),srcSet:Me,favorite:k.includes(be)})}}return{emotes:F,length:_.length}}getTwitchEmoteSuggestions(_,F){F.ffz_twitch_cache?.length!==F.props.emotes?.length&&(F.ffz_twitch_cache=this.buildTwitchCache(F.props.emotes));const K=this.chat.context.get("chat.tab-complete.matching"),H=F.ffz_twitch_cache.emotes;if(!H.length)return[];const V=[],E=[],x=[],k=_.startsWith(":")?_.slice(1):_;for(const N of H){const Z=F.doesEmoteMatchTerm(N,k);if(Z<K)continue;const se={current:_,emote:N,replacement:N.token,element:F.renderEmoteSuggestion(N),favorite:N.favorite,count:this.EmoteUsageCount[N.token]||0,match_type:Z};Z<K||(se.count>0?V.push(se):Z>M?E.push(se):x.push(se))}return V.sort((N,Z)=>Z.count-N.count),E.sort((N,Z)=>T.compare(N.replacement,Z.replacement)),x.sort((N,Z)=>T.compare(N.replacement,Z.replacement)),V.concat(E).concat(x)}getEmojiSuggestions(_,F){if(!_.startsWith(":"))return[];let K=_.slice(1).toLowerCase();const H=this.chat.context.get("chat.emoji.style"),V=this.settings.provider.get("emoji-tone",null),E=this.emotes.getFavorites("emoji"),x=[],k=K.endsWith(":");k&&(K=K.slice(0,-1));const N=new Set;for(const Z in this.emoji.names)if(k?Z===K:Z.startsWith(K)){const se=this.emoji.emoji[this.emoji.names[Z]],de=se.variants&&se.variants[V],_e=de||se;if(se&&(H===0||_e.has[H])&&!N.has(_e.raw)){N.add(_e.raw);const q=this.emoji.getFullImageSet(_e.image,H),le=`:${Z}:`,he=E.includes(se.code);x.push({current:_,emoji:_e,matched:le,srcSet:q,replacement:_e.raw,element:F.renderFFZEmojiSuggestion({token:le,id:`emoji-${se.code}`,src:this.emoji.getFullImage(_e.image,H),srcSet:q,favorite:he}),favorite:he})}}return x}buildFFZCache(_,F,K,H){const V=this.emotes.getSets(_,F,K,H);if(!V||!V.length)return{emotes:[],length:0,user_id:_,user_login:F,channel_id:K,channel_login:H};const E=[],x=this.chat.context.get("chat.emotes.animated")>0,k=this.settings.provider.get("emote-menu.hidden-sets"),N=Array.isArray(k)&&k.length>0,Z=new Set;for(const se of V){if(!se||!se.emotes)continue;const de=se.source||"ffz",_e=se.source_line||`${se.source||"FFZ"} ${se.title||"Global"}`,q=`${se.merge_source||de}-${se.merge_id||se.id}`;if(N&&k.includes(q))continue;const le=this.emotes.getHidden(de),he=this.emotes.getFavorites(de);for(const be of Object.values(se.emotes))!be||!be.id||be.hidden||le.includes(be.id)||Z.has(be.name)||be.name&&(Z.add(be.name),E.push({id:`${de}-${be.id}`,source:de,extra:_e,token:be.name,tokenLower:be.name.toLowerCase(),srcSet:x&&be.animSrcSet||be.srcSet,favorite:he.includes(be.id)}))}return{emotes:E,length:V.length}}getEmoteSuggestions(_,F){if(!F._ffz_channel_login){const se=this.fine.searchParent(F,"chat-input",50);se&&this.updateEmoteCompletion(se,F)}const K=this.chat.context.get("chat.tab-complete.matching"),H=F._ffz_user,V=F._ffz_channel_id,E=F._ffz_channel_login;if(!E)return[];let x=F.ffz_ffz_cache;(!x||x.user_id!==H?.id||x.user_login!==H?.login||x.channel_id!==V||x.channel_login!==E)&&(x=F.ffz_ffz_cache=this.buildFFZCache(H?.id,H?.login,V,E));const k=x.emotes;if(!k.length)return[];const N=_.startsWith(":")?_.slice(1):_,Z=[];for(const se of k){const de=F.doesEmoteMatchTerm(se,N);de<K||Z.push({current:_,emote:se,replacement:se.token,element:F.renderEmoteSuggestion(se),favorite:se.favorite,count:0,match_type:de})}return Z}getInput(){for(const _ of this.ChatInput.instances)if(!(!_.autocompleteInputRef||!_.state)&&_.state.value)return _.state.value;return null}pasteMessage(_,F){for(const K of this.ChatInput.instances)if(K?.props?.channelLogin===_){if(!K.autocompleteInputRef||!K.state)return;K.state.value&&(F=`${K.state.value} ${F}`),K.autocompleteInputRef.setValue(F),K.autocompleteInputRef.componentRef?.focus?.()}}};G(Ie,"Input");let Q=Ie;const Xe=class Xe extends D.default{constructor(..._){super(..._),this.inject("chat"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.last_login=null,this.settings.add("chat.viewer-cards.highlight-chat",{default:!1,ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight messages from users with open viewer cards.",component:"setting-check-box"}}),this.settings.add("chat.viewer-cards.color",{default:"",ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("chat.viewer-cards.use-color",{requires:["chat.viewer-cards.highlight-chat","chat.viewer-cards.color"],process(F){if(F.get("chat.viewer-cards.highlight-chat"))return F.get("chat.viewer-cards.color")}}),this.ViewerCard=this.fine.define("chat-viewer-card",F=>F.props?.targetLogin&&F.props?.hideViewerCard)}onEnable(){this.chat.context.on("changed:chat.viewer-cards.highlight-chat",this.refreshStyle,this),this.chat.context.on("changed:chat.viewer-cards.color",this.refreshStyle,this),this.on("..:update-colors",this.refreshStyle,this),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("update",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this)}refreshStyle(){this.updateStyle(this.last_login)}updateStyle(_){if(typeof _=="string"&&(_=_.toLowerCase()),this.last_login=_,_&&this.chat.context.get("chat.viewer-cards.highlight-chat")){let F=this.chat.context.get("chat.viewer-cards.color");F&&F.length?F=this.parent.inverse_colors.process(F):this.chat.context.get("theme.is-dark")?F="rgba(0,80,255,0.2)":F="rgba(128,170,255,0.2)",this.css_tweaks.set("viewer-card-highlight",`
body .chat-room .chat-scrollable-area__message-container > div:nth-child(1n+0) > .chat-line__message:not(.chat-line--inline):not(.something-nonexistent)[data-user="${_}"],
body .chat-room .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user="${_}"] {
	background-color: ${F} !important;
}`)}else this.css_tweaks.delete("viewer-card-highlight")}updateCard(_){this.updateStyle(_.props&&_.props.targetLogin)}unmountCard(){this.updateStyle()}};G(Xe,"ViewerCards");let te=Xe;const ne=(0,L.make_enum)("Post","Action"),fe=(0,L.make_enum)("Ban","Timeout","Delete"),re=(0,L.make_enum)("MessageRejectedPrompt","CheerMessageRejectedPrompt","MessageRejected","MessageAllowed","MessageDenied","CheerMessageDenied","CheerMessageTimeout","MessageModApproved","MessageModDenied"),ue=["Message","Notice","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","RoomMods","RoomState","BadgesUpdated"],me=(0,L.make_enum)("Message","ExtensionMessage","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","Subscription","Resubscription","GiftPaidUpgrade","AnonGiftPaidUpgrade","PrimePaidUpgrade","PrimeCommunityGiftReceivedEvent","ExtendSubscription","SubGift","AnonSubGift","Clear","RoomMods","RoomState","Raid","Unraid","Notice","Info","BadgesUpdated","Purchase","BitsCharity","CrateGift","RewardGift","SubMysteryGift","AnonSubMysteryGift","StandardPayForward","CommunityPayForward","FirstCheerMessage","FirstMessageHighlight","BitsBadgeTierMessage","InlinePrivateCallout","ChannelPointsReward","CommunityChallengeContribution","LiveMessageSeparator","RestrictedLowTrustUserMessage","CommunityIntroduction","Shoutout","AnnouncementMessage","CharityDonation","MessageIdUpdate","ViewerMilestone","GigantifiedEmote"),we=["Reconnect","RoomState","BadgesUpdated","Clear"],xe={pinned_re_sub:"share-resub",community_points_reward:"community-points-rewards",clip_live_nudge_chat_trigger:"clip-live-nudge",cheer_badge_grant:"bits-badge-tier"},Te={AppointedModerator:"appointed-moderator",BitsBadgeTier:"bits-badge-tier",BitsPowerUps:"bits-power-ups",ClipLiveNudge:"clip-live-nudge",CommunityMoment:"community-moment",CommunityPointsRewards:"community-points-rewards",CosmicAbyss:"cosmic-abyss",CreatorAnniversaries:"creator-anniversaries",Drop:"drop",EarnedSubBadge:"earned-sub-badge",FavoritedGuestCollab:"favorited-guest-collab",GiftBadgeExpiration:"gift-badge-expiration",GiftBadgeRestored:"gift-badge-restored",GiftBundleUpSell:"gift-bundle-up-sell",HypeTrainRewards:"hype-train-rewards",LapsedBitsUser:"lapsed-bits-user",PartnerPlusUpSellNudge:"partner-plus-up-sell-nudge",ReplyByKeyboard:"reply-by-keyboard",RequestToJoinAccepted:"request-to-join-accepted",STPromo:"st-promo",ShareResub:"share-resub",SubtemberPromoBits:"subtember-promo-bits",ThankSubGifter:"thank-sub-gifter",TurnOffAnimatedEmotes:"turn-off-animated-emotes",WalletDrop:"wallet-drop"},Pe=[],Se=["onBadgesUpdatedEvent"],ct=class ct extends D.default{constructor(..._){super(..._),this.should_enable=!0,this.shared_room_data=new Map,this.shared_rooms={},this.colors=new W.ColorAdjuster,this.inverse_colors=new W.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.inject("experiments"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("site.subpump"),this.inject("chat"),this.inject(g),this.inject(w),this.inject(e),this.inject(h),this.inject(Q),this.inject(te),this.ChatLeaderboard=this.fine.define("chat-leaderboard",F=>F.props?.topItems&&(0,L.has)(F.props,"forceMiniView")&&(0,L.has)(F.props,"leaderboardType"),v.Z.CHAT_ROUTES),this.ChatService=this.fine.define("chat-service",F=>F.join&&F.client&&F.props.setChatConnectionAPI,v.Z.CHAT_ROUTES),this.ChatBuffer=this.fine.define("chat-buffer",F=>F.updateHandlers&&F.delayedMessageBuffer&&F.handleMessage,v.Z.CHAT_ROUTES),this.ChatController=this.fine.define("chat-controller",F=>F.parseOutgoingMessage&&F.onRoomStateUpdated&&F.renderNotifications,v.Z.CHAT_ROUTES),this.ChatRenderer=this.fine.define("chat-renderer",F=>F.mapMessagesToChatLines&&F.reportChatRenderSent,v.Z.CHAT_ROUTES),this.ChatContainer=this.fine.define("chat-container",F=>F.closeViewersList&&F.onChatInputFocus,v.Z.CHAT_ROUTES),this.ChatBufferConnector=this.fine.define("chat-buffer-connector",F=>F.clearBufferHandle&&F.syncBufferedMessages,v.Z.CHAT_ROUTES),this.ChatRewardEventHandler=this.fine.define("chat-reward-event-handler",F=>F.unsubscribe&&F.handleMessage&&F.props?.messageHandlerAPI&&F.props?.rewardMap,v.Z.CHAT_ROUTES),this.joined_raids=new Set,this.RaidController=this.fine.define("raid-controller",F=>F.handleLeaveRaid&&F.handleJoinRaid,v.Z.CHAT_ROUTES),this.InlineCallout=this.fine.define("inline-callout",F=>F.showCTA&&F.toggleContextMenu&&F.actionClick,v.Z.CHAT_ROUTES),this.PinnedCallout=this.fine.define("pinned-callout",F=>F.getCalloutTitle&&F.buildCalloutProps&&F.pin,v.Z.CHAT_ROUTES),this.CalloutSelector=this.fine.define("callout-selector",F=>F.selectCalloutComponent&&F.props&&(0,L.has)(F.props,"callouts"),v.Z.CHAT_ROUTES),this.PointsButton=this.fine.define("points-button",F=>F.renderIcon&&F.renderFlame&&F.handleIconAnimationComplete,v.Z.CHAT_ROUTES),this.PointsClaimButton=this.fine.define("points-claim-button",F=>F.getClaim&&F.onClick&&F.props&&F.props.claimCommunityPoints,v.Z.CHAT_ROUTES),this.CommunityChestBanner=this.fine.define("community-chest-banner",F=>F.getLastGifterText&&F.getBannerText&&(0,L.has)(F,"finalCount"),v.Z.CHAT_ROUTES),this.PointsInfo=this.fine.define("points-info",F=>F.pointIcon!==void 0&&F.pointName!==void 0,v.Z.CHAT_ROUTES),this.GiftBanner=this.fine.define("gift-banner",F=>F.getBannerText&&F.onGiftMoreClick,v.Z.CHAT_ROUTES),this.settings.add("chat.subs.native",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices using Twitch's native UI.",component:"setting-check-box"}}),this.settings.add("chat.filtering.show-reasons",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Display Reasons",description:"If this is enabled, the reasons a given message was highlighted will be displayed alongside the message. This is a simple display. Enable the debugging option below in Behavior for more details, but be aware that the debugging option has a slight performance impact compared to this.",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:1,title:"Above Message"},{value:2,title:"Inline"}]}}),this.settings.add("chat.disable-handling",{default:null,requires:["context.disable-chat-processing"],process(F,K){return K!=null?!K:!!F.get("context.disable-chat-processing")},ui:{path:"Debugging > Chat >> Processing",title:"Enable processing of chat messages.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("debug.chat-test",{path:"Debugging > Chat >> Chat",component:"chat-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.filtering.blocked-callouts",{default:[],type:"array_merge",always_inherit:!0,process:(F,K)=>{const H=new Set,V=this.callout_types??Te;for(const E of K)E?.v&&V[E.v]&&!Pe.includes(E.v)&&H.add(V[E.v]);return H},ui:{path:'Chat > Filtering > Block >> Callout Types @{"description":"This filter allows you to remove callouts of specific types from Twitch chat. Callouts are special messages that can be pinned to the bottom of chat and often have associated actions, like claiming a drop or sharing your resubscription."}',component:"blocked-types",getExtraTerms:()=>Object.keys(this.callout_types).filter(F=>!Pe.includes(F)),data:()=>Object.keys(this.callout_types).filter(F=>!Pe.includes(F)).sort()}}),this.settings.add("chat.filtering.blocked-types",{default:[],type:"array_merge",always_inherit:!0,process(F,K){const H=new Set;for(const V of K)V?.v&&!ue.includes(V.v)&&H.add(V.v);return H},ui:{path:'Chat > Filtering > Block >> Message Types @{"description":"This filter allows you to remove all messages of a certain type from Twitch chat. It can be used to filter system messages, such as Hosts or Raids. Some types, such as moderation actions, cannot be blocked to prevent chat functionality from breaking."}',component:"blocked-types",getExtraTerms:()=>Object.keys(this.chat_types).filter(F=>!ue.includes(F)&&!/^\d+$/.test(F)),data:()=>Object.keys(this.chat_types).filter(F=>!ue.includes(F)&&!/^\d+$/.test(F)).sort()}}),this.settings.add("chat.replies.style",{default:1,ui:{path:"Chat > Appearance >> Replies",title:"Style",description:"Twitch's default style adds a floating button to the right and displays a notice above messages that are replies. FrankerFaceZ uses an In-Line Chat Action (that can be removed in [Chat > Actions > In-Line](~chat.actions.in_line)) and uses an in-line mention to denote replies.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch (Default)"},{value:2,title:"FrankerFaceZ"}]}}),this.settings.add("channel.raids.no-autojoin",{default:!1,ui:{path:"Channel > Behavior >> Raids",title:"Do not automatically join raids.",component:"setting-check-box"}}),this.settings.add("chat.powerup.effects",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow "Message Effects" messages to appear in chat.',component:"setting-check-box",description:"*Note*: Only affects messages sent after you change this setting. You can use your own chat for testing."}}),this.settings.add("channel.raids.blocked-channels",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Channel > Behavior >> Raids: Blocked Channels @{"description": "You will not automatically join raids to channels listed here."}',component:"basic-terms",words:!1}}),this.settings.add("__filter:channel.raids.blocked-channels",{requires:["channel.raids.blocked-channels"],equals:"requirements",process(F){const K=F.get("channel.raids.blocked-channels");if(!K||!K.length)return null;const H=[];for(const V of K){const E=V.t;let x=V.v;E==="glob"?x=(0,L.glob_to_regex)(x):E!=="raw"&&(x=(0,L.escape_regex)(x)),!(!x||!x.length)&&H.push(x)}return H.length?new RegExp(`^(?:${H.join("|")})$`,"gi"):null}}),this.settings.add("chat.hide-community-highlights",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide all Community Highlights from the top of chat.",component:"setting-check-box",description:"Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them."}}),this.settings.add("chat.subs.gift-banner",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display a banner at the top of chat when a mass gift sub happens.",component:"setting-check-box"}}),this.settings.add("chat.banners.last-events",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Support Activity Feed to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.charity",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the charity fundraiser progress to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.hide-appleplus",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide the drop notification for getting AppleTV+ when you buy a subscription.",component:"setting-check-box",description:`**Note:** Normally, I wouldn't add something that directly affects an advertisement like this, but Twitch broke the "Don't show again" checkbox, so it's up to us to fix it.`}}),this.settings.add("chat.banners.hype-train",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Hype Train to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.shared-chat",{default:!0,ui:{path:"Chat > Shared Chat >> Behavior",title:"Allow the Shared Chat notice to be displayed in chat when a Shared Chat is enabled.",component:"setting-check-box"}}),this.settings.add("chat.banners.pinned-message",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Pinned Messages to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.drops",{default:!0,ui:{path:"Chat > Drops >> Appearance",title:"Allow messages about Drops to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.polls",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Polls to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.prediction",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Predictions to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.callouts.clip",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow the "Chat seems active." clip suggestion to be displayed in chat.',component:"setting-check-box"}}),this.settings.add("chat.community-chest.show",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display the Community Gift Chest banner.",component:"setting-check-box"}}),this.settings.add("chat.points.allow-highlight",{default:2,ui:{path:"Chat > Channel Points >> Appearance",title:"Highlight the message in chat when someone redeems Highlight My Message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Style"},{value:2,title:"FFZ Style"}]}}),this.settings.add("chat.points.show-callouts",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display messages in chat about Channel Points rewards.",component:"setting-check-box"}}),this.settings.add("chat.points.show-button",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display Channel Points button beneath chat.",component:"setting-check-box"}}),this.settings.add("chat.points.show-rewards",{default:!0,requires:["layout.portrait-min-chat"],process(F,K){return F.get("layout.portrait-min-chat")?!1:K},ui:{path:"Chat > Channel Points >> Behavior",title:"Allow available rewards to appear next to the Channel Points button.",component:"setting-check-box"}}),this.settings.add("chat.points.auto-rewards",{default:!1,ui:{path:"Chat > Channel Points >> Behavior",title:"Automatically claim bonus rewards.",component:"setting-check-box",force_seen:!0}}),this.settings.add("chat.drops.auto-rewards",{default:!1,ui:{path:"Chat > Drops >> Behavior",title:"Automatically claim drops.",component:"setting-check-box"}}),this.settings.add("chat.pin-resubs",{default:!1,ui:{path:"Chat > Behavior >> General",title:"Automatically pin re-subscription messages in chat.",component:"setting-check-box"}}),this.settings.add("chat.shared-chat.style",{default:null,ui:{path:"Chat > Shared Chat >> Appearance",title:"Pill Style",component:"setting-select-box",description:"This controls the appearance of the pill at the left-side of chat messages when a message is part of a Shared Chat. By default, this is Avatar for moderators and broadcasters and Hidden for everyone else.",data:[{value:null,title:"Automatic"},{value:0,title:"Hidden"},{value:1,title:"Channel Name"},{value:2,title:"Avatar"}]}}),this.settings.add("chat.shared-chat.username-tooltip",{default:!0,ui:{path:"Chat > Shared Chat >> Appearance",component:"setting-check-box",title:"Display the source channel of a chat message when hovering over the poster's username."}}),this.settings.add("chat.width",{default:null,ui:{path:'Chat > Appearance >> General @{"sort": -1}',title:"Width",description:"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process(F){return F=parseInt(F,10),isNaN(F)||!isFinite(F)||F<=0?null:F}}}),this.settings.add("chat.effective-width",{requires:["chat.width","context.ui.rightColumnWidth"],process(F){const K=F.get("chat.width");return K??(F.get("context.ui.rightColumnWidth")||340)}}),this.settings.add("chat.use-width",{requires:["chat.width","context.ui.rightColumnExpanded","context.isWatchParty"],process(F){return!F.get("context.ui.rightColumnExpanded")||F.get("context.isWatchParty")?!1:F.get("chat.width")!=null}}),this.settings.add("chat.bits.show-pinned",{requires:["chat.bits.show"],default:null,process(F,K){return K??F.get("chat.bits.show")},ui:{path:"Chat > Appearance >> Community",title:"Display Leaderboard",description:`The leaderboard shows the top cheerers and sub gifters in a channel.

By default due to a previous implementation, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering).`,component:"setting-check-box"}}),this.settings.add("chat.bits.show-rewards",{requires:["chat.bits.show"],default:null,process(F,K){return K??F.get("chat.bits.show")},ui:{path:"Chat > Bits and Cheering >> Behavior",title:"Display messages when a cheer shares rewards to people in chat.",description:"By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.",component:"setting-check-box"}}),this.settings.add("chat.bits.cheer-notice",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display a notice on chat messages that include cheers.",description:"This feature is intended to prevent possible confusion from chatters using emotes to fake cheers in messages. When enabled, messages that contain real cheers will display a message above them, similar to how resubscription messages or point redemptions with messages function.",component:"setting-check-box"}}),this.settings.add("chat.rituals.show",{default:!0,ui:{path:"Chat > Filtering > General >> Rituals",title:'Display ritual messages such as "User is new here! Say Hello!".',component:"setting-check-box"}}),this.settings.add("chat.extra-timestamps",{default:!0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display timestamps on notices.",description:"When enabled, timestamps will be displayed on point redemptions, subscriptions, etc.",component:"setting-check-box"}}),this.settings.add("chat.hype.message-style",{default:1,ui:{path:"Chat > Hype Chat >> Appearance",title:"Hype Chat Style",component:"setting-select-box",description:"**Note**: Hype Chats that include messages will always have their messages displayed, regardless of setting. Changes made to this setting may not affect existing chat messages.",data:[{value:0,title:"Do Not Display"},{value:1,title:"Standard Twitch (Large, Colored, Limited FFZ Support)"},{value:2,title:"Minimal (Marked with System Message, No Colors)"}]}}),this.settings.add("chat.subs.show",{default:3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display Subs in Chat",component:"setting-select-box",description:'**Note**: Messages sent with re-subs will always be displayed. This only controls the special "X subscribed!" message.',data:[{value:0,title:"Do Not Display"},{value:1,title:"Re-Subs with Messages Only"},{value:2,title:"Re-Subs Only"},{value:3,title:"Display All"}]}}),this.settings.add("chat.subs.compact",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices in a more compact (classic style) form.",component:"setting-check-box"}}),this.settings.add("chat.subs.merge-gifts",{default:1e3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Merge Mass Sub Gifts",component:"setting-select-box",data:[{value:1e3,title:"Disabled"},{value:50,title:"More than 50"},{value:20,title:"More than 20"},{value:10,title:"More than 10"},{value:5,title:"More than 5"},{value:0,title:"Always"}],description:`Merge mass gift subscriptions into a single message, depending on the quantity.
**Note:** Only affects newly gifted subs.`}}),this.settings.add("chat.subs.merge-gifts-visibility",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Expand merged mass sub gift messages by default.",component:"setting-check-box"}}),this.settings.add("chat.lines.alternate",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display lines with alternating background colors.",component:"setting-check-box"}}),this.settings.add("chat.lines.padding",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Reduce padding around lines.",component:"setting-check-box"}}),this.settings.add("chat.lines.borders",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Separators",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Basic Line (1px Solid)"},{value:2,title:"3D Line (2px Groove)"},{value:3,title:"3D Line (2px Groove Inset)"},{value:4,title:"Wide Line (2px Solid)"}]}}),this.settings.add("chat.input.show-mod-view",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Mod View" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-highlight",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Chat Highlight Settings" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-shield",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Shield Mode" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-elevate-your-message",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Elevate Your Message" button to be displayed.',component:"setting-check-box"}})}get currentChat(){for(const _ of this.ChatController.instances)if(_&&_.chatService)return _;return null}updateColors(){const _=this.chat.context.get("theme.is-dark"),F=this.chat.context.get("chat.adjustment-mode"),K=this.chat.context.get("chat.adjustment-contrast"),H=this.colors,V=this.inverse_colors;let E=_,x=W.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-background")||this.chat.context.get("theme.color.background"));x&&(E=x.toHSLA().l<.5),x=E?"#191919":"#E0E0E0";let k=!E,N=W.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-text")||this.chat.context.get("theme.color.text"));N&&(k=N.toHSLA().l<.5),N=k?"#19171c":"#dad8de",H._base=x,H.mode=F,H.contrast=K,V._base=N,V.mode=F,V.contrast=K,this.chat_line.rerenderLines(),this.updateMentionCSS(),this.emit(":update-colors")}updateChatCSS(){this._update_css_waiter||(this._update_css_waiter=requestAnimationFrame(()=>this._updateChatCSS()))}_updateChatCSS(){cancelAnimationFrame(this._update_css_waiter),this._update_css_waiter=null;const _=this.chat.context.get("chat.effective-width"),F=this.chat.context.get("chat.actions.size"),K=this.chat.context.get("chat.actions.hover-size"),H=this.chat.context.get("chat.timestamp-size"),V=this.chat.context.get("chat.font-size"),E=this.chat.context.get("chat.lines.emote-alignment"),x=Math.round(20/12*V),k=Math.round(K*(2/3)),N=K-k;let Z=this.chat.context.get("chat.font-family")||"inherit";const[se,de]=(0,I.jo)(Z);Z=se,this._font_unloader&&this._font_unloader(),this._font_unloader=de,Z.indexOf(" ")!==-1&&Z.indexOf(",")===-1&&Z.indexOf('"')===-1&&Z.indexOf("'")===-1&&(Z=`"${Z}"`),H?this.css_tweaks.set("ts-size",`.chat-line__timestamp{font-size:${H/10}rem}`):this.css_tweaks.delete("ts-size"),this.css_tweaks.setVariable("chat-actions-size",`${F/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-size",`${k/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-padding",`${N/20}rem`),this.css_tweaks.setVariable("chat-font-size",`${V/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${x/10}rem`),this.css_tweaks.setVariable("chat-font-family",Z),this.css_tweaks.setVariable("chat-width",`${_/10}rem`),this.css_tweaks.setVariable("negative-chat-width",`${-_/10}rem`),this.css_tweaks.toggle("chat-font",V!==13||Z!=="inherit"),this.css_tweaks.toggle("chat-width",this.settings.get("chat.use-width")),this.css_tweaks.toggle("chat-fix--watch-party",this.settings.get("context.isWatchParty")),this.css_tweaks.toggle("emote-alignment-padded",E===1),this.css_tweaks.toggle("emote-alignment-baseline",E===2),this.emit(":update-chat-css"),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateLineBorders(){const _=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",_>0),this.css_tweaks.toggle("chat-borders-3d",_===2),this.css_tweaks.toggle("chat-borders-3d-inset",_===3),this.css_tweaks.toggle("chat-borders-wide",_===4)}updateMentionCSS(){const _=this.chat.context.get("chat.filtering.highlight-mentions");this.css_tweaks.toggle("chat-mention-token",this.chat.context.get("chat.filtering.highlight-tokens"));const F=this.chat.context.get("chat.filtering.mention-color");F?(this.css_tweaks.toggle("chat-mention-bg",!1),this.css_tweaks.toggle("chat-mention-bg-alt",!1),this.css_tweaks.toggle("chat-mention-bg-custom",!0),this.css_tweaks.setVariable("chat-mention-color",this.inverse_colors.process(F))):(this.css_tweaks.toggle("chat-mention-bg-custom",!1),this.css_tweaks.toggle("chat-mention-bg",_),this.css_tweaks.toggle("chat-mention-bg-alt",_&&this.chat.context.get("chat.lines.alternate")))}updatePointsInfo(_){const F=_?.pointIcon,K=_?.pointName;F?this.css_tweaks.set("points-icon",`.ffz--points-icon:before { display: none }
.ffz--points-icon:after {
	display: inline-block;
	margin: 0 0.5rem -0.6rem;
	background-image: url("${F.url}");
	background-image: ${B.WEBKIT_CSS}image-set(url("${F.url}") 1x, url("${F.url2x}") 2x, url("${F.url4x}") 4x);
}`):this.css_tweaks.delete("points-icon"),this.point_name=K||null}grabTypes(){if(this.types_loaded)return;const _=this.web_munch.getModule("chat-types"),F=this.web_munch.getModule("callout-types");if(this.callout_types=F||Te,this.automod_types=_?.automod||re,this.chat_types=_?.chat||me,this.message_types=_?.message||ne,this.mod_types=_?.mod||fe,!_)return;F&&this.chat.context.update("chat.filtering.blocked-callouts"),this.types_loaded=!0;const K=[];(0,L.shallow_object_equals)(this.callout_types,Te)||K.push("CALLOUT_TYPES"),(0,L.shallow_object_equals)(this.automod_types,re)||K.push("AUTOMOD_TYPES"),(0,L.shallow_object_equals)(this.chat_types,me)||K.push("CHAT_TYPES"),(0,L.shallow_object_equals)(this.message_types,ne)||K.push("MESSAGE_TYPES"),(0,L.shallow_object_equals)(this.mod_types,fe)||K.push("MOD_TYPES"),K.length&&this.log.info("Chat Types have changed from static mappings for categories:",K.join(" "))}updateDisableHandling(){this.disable_handling=this.chat.context.get("chat.disable-handling")}onEnable(){this.on("site.web_munch:new-ready",this.grabTypes),this.on("site.web_munch:new-ready",this.defineClasses),this.grabTypes(),this.defineClasses(),this.chat.context.on("changed:chat.callouts.clip",this.updateCallouts,this),this.chat.context.on("changed:chat.filtering.blocked-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-button",()=>this.PointsButton.forceUpdate()),this.chat.context.on("changed:chat.points.show-rewards",()=>{this.PointsButton.forceUpdate(),this.PointsClaimButton.forceUpdate()}),this.chat.context.on("changed:chat.bits.show",()=>{this.PointsButton.forceUpdate()}),this.chat.context.on("changed:chat.banners.hype-train",this.cleanHighlights,this),this.chat.context.on("changed:chat.subs.gift-banner",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.polls",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.prediction",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.drops",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.pinned-message",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.hide-appleplus",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.shared-chat",this.cleanHighlights,this),this.chat.context.on("changed:chat.disable-handling",this.updateDisableHandling,this),this.chat.context.on("changed:chat.banners.charity",()=>{this.ChatContainer.forceUpdate()}),this.chat.context.on("changed:chat.subs.gift-banner",()=>this.GiftBanner.forceUpdate(),this),this.chat.context.on("changed:chat.effective-width",this.updateChatCSS,this),this.settings.main_context.on("changed:chat.use-width",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.size",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.hover-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.timestamp-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.on("changed:theme.color.background",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-background",this.updateColors,this),this.chat.context.on("changed:theme.color.text",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-text",this.updateColors,this),this.chat.context.on("changed:chat.lines.borders",this.updateLineBorders,this),this.chat.context.on("changed:chat.filtering.highlight-mentions",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.highlight-tokens",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.mention-color",this.updateMentionCSS,this),this.chat.context.on("changed:chat.pin-resubs",F=>{F&&(this.updateInlineCallouts(),this.updatePinnedCallouts())},this),this.chat.context.on("changed:chat.community-chest.show",()=>{this.CommunityChestBanner.forceUpdate(),this.updateCallouts()},this),this.chat.context.getChanges("chat.emotes.2x",F=>{this.css_tweaks.toggle("big-emoji",F>1),this.toggleEmoteJail()}),this.chat.context.getChanges("chat.emotes.limit-size",()=>this.toggleEmoteJail()),this.chat.context.getChanges("chat.banners.last-events",F=>this.css_tweaks.toggleHide("last-x-events",!F)),this.chat.context.getChanges("chat.input.show-mod-view",F=>this.css_tweaks.toggleHide("ci-mod-view",!F)),this.chat.context.getChanges("chat.input.show-highlight",F=>this.css_tweaks.toggleHide("ci-highlight-settings",!F)),this.chat.context.getChanges("chat.input.show-shield",F=>this.css_tweaks.toggleHide("ci-shield-mode",!F)),this.chat.context.getChanges("chat.lines.padding",F=>this.css_tweaks.toggle("chat-padding",F)),this.chat.context.getChanges("chat.bits.show",F=>this.css_tweaks.toggle("hide-bits",!F)),this.chat.context.on("changed:chat.bits.show-pinned",()=>this.ChatLeaderboard.forceUpdate()),this.chat.context.getChanges("chat.filtering.deleted-style",F=>{this.css_tweaks.toggle("chat-deleted-strike",F===1||F===2),this.css_tweaks.toggle("chat-deleted-fade",F<2)}),this.chat.context.getChanges("chat.filtering.clickable-mentions",F=>this.css_tweaks.toggle("clickable-mentions",F)),this.chat.context.getChanges("chat.filtering.bold-mentions",F=>this.css_tweaks.toggle("chat-mention-no-bold",!F)),this.chat.context.getChanges("chat.hide-community-highlights",F=>this.css_tweaks.toggleHide("community-highlights",F)),this.chat.context.getChanges("chat.lines.alternate",F=>{this.css_tweaks.toggle("chat-rows",F),this.updateMentionCSS()}),this.chat.context.getChanges("chat.input.show-elevate-your-message",F=>this.css_tweaks.toggleHide("elevate-your-message",!F)),this.updateDisableHandling(),this.updateChatCSS(),this.updateColors(),this.updateLineBorders(),this.on("chat:get-messages-late",(F,K,H,V)=>{if(!F)return;const E=new Set(V.map(x=>x.message?.id));for(const x of this.ChatBuffer.instances){for(const k of x.buffer){const N=k?.id;!N||E.has(N)||!k.ffz_standardized||(E.add(N),V.push({message:k,_instance:null,update:()=>null}))}for(const k of x.delayedMessageBuffer){const N=k?.event,Z=N?.id;!Z||E.has(Z)||!N.ffz_standardized||(E.add(Z),V.push({message:N,_instance:null,update:()=>null}))}}}),this.on("chat:get-tab-commands",F=>{F.commands.push({name:"reconnect",description:"Force chat to reconnect.",permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.on("chat:pre-send-message",F=>{const K=F.message,H=F._inst;/^\/reconnect ?/i.test(K)&&(F.preventDefault(),H.client?.reconnect?(H.addMessage({type:_.chat_types.Notice,message:_.i18n.t("chat.reconnect","FFZ is forcing chat to reconnect...")}),H.client.reconnect()):H.addMessage({type:_.chat_types.Notice,message:_.i18n.t("chat.reconnect.unable","FFZ is unable to force chat to reconnect.")}))}),this.RaidController.on("mount",this.wrapRaidController,this),this.RaidController.on("update",this.noAutoRaids,this),this.RaidController.ready((F,K)=>{for(const H of K)this.wrapRaidController(H)}),this.InlineCallout.on("mount",this.onInlineCallout,this),this.InlineCallout.on("update",this.onInlineCallout,this),this.InlineCallout.ready(()=>this.updateInlineCallouts()),this.PinnedCallout.on("mount",this.onPinnedCallout,this),this.PinnedCallout.on("update",this.onPinnedCallout,this),this.PinnedCallout.ready(()=>this.updatePinnedCallouts());const _=this;this.PointsInfo.on("mount",this.updatePointsInfo,this),this.PointsInfo.on("update",this.updatePointsInfo,this),this.PointsInfo.on("unmount",()=>this.updatePointsInfo(null)),this.PointsInfo.ready(()=>this.updatePointsInfo(this.PointsInfo.first)),this.ChatLeaderboard.ready(F=>{const K=F.prototype.render;F.prototype.render=function(){return _.chat.context.get("chat.bits.show-pinned")?K.call(this):null},this.ChatLeaderboard.forceUpdate()}),this.GiftBanner.ready(F=>{const K=F.prototype.render;F.prototype.render=function(){return _.chat.context.get("chat.subs.gift-banner")?K.call(this):null},this.GiftBanner.forceUpdate()}),this.CommunityChestBanner.ready(F=>{const K=F.prototype.render;F.prototype.render=function(){try{if(!_.chat.context.get("chat.community-chest.show"))return null}catch(H){_.log.capture(H),_.log.error(H)}return K.call(this)},this.CommunityChestBanner.forceUpdate()}),this.PointsButton.ready(F=>{const K=F.prototype.render;F.prototype.render=function(){try{if(!_.chat.context.get("chat.points.show-button"))return null;const H=this.state.animationQueue,V=this.props.bitsEnabled;_.chat.context.get("chat.points.show-rewards")||(this.state.animationQueue=[]),_.chat.context.get("chat.bits.show")||(this.props.bitsEnabled=!1);const E=K.call(this);return this.state.animationQueue=H,this.props.bitsEnabled=V,E}catch(H){_.log.capture(H),_.log.error(H)}return K.call(this)},this.PointsButton.forceUpdate()}),this.PointsClaimButton.ready(F=>{F.prototype.ffzHasOffer=function(){return!this.props.hidden&&!this.state?.error&&this.getClaim()!=null};const K=F.prototype.render;F.prototype.render=function(){try{if(this.ffzHasOffer()&&!this._ffz_timer&&_.chat.context.get("chat.points.auto-rewards")&&(this._ffz_timer=setTimeout(()=>{this._ffz_timer=null,this.onClick&&this.ffzHasOffer()&&this.onClick()},1e3+Math.floor(Math.random()*5e3))),!_.chat.context.get("chat.points.show-rewards"))return null}catch(H){_.log.capture(H),_.log.error(H)}return K.call(this)},this.PointsClaimButton.forceUpdate()}),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatUnmounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatService.ready((F,K)=>{this.wrapChatService(F);for(const H of K){H.client.events.removeAll(),H._ffzInstall();const V=H.joinedChannel,E=H.client?.session?.channelstate?.[`#${V}`]?.roomState;E&&this.updateChatState(E),H.addEventListeners(),H.props.setChatConnectionAPI({sendMessage:H.sendMessage,_ffz_inst:H})}}),this.ChatBuffer.ready((F,K)=>{this.wrapChatBuffer(F);for(const H of K){const V=H.props.messageHandlerAPI;V&&V.removeMessageHandler(H.handleMessage),H._ffzInstall(),V&&V.addMessageHandler(H.handleMessage),H.props.setMessageBufferAPI({addUpdateHandler:H.addUpdateHandler,removeUpdateHandler:H.removeUpdateHandler,getUnreadCount:H.getUnreadCount,getMessages:H.getMessages,getMessagesForHighlight:H.getMessagesForHighlight,getMessagesForAllHighlights:H.getMessagesForAllHighlights,isPaused:H.isPaused,setPaused:H.setPaused,hasNewerLeft:H.hasNewerLeft,loadNewer:H.loadNewer,loadNewest:H.loadNewest,_ffz_inst:H})}}),this.ChatRewardEventHandler.ready((F,K)=>{const H=this,V=F.prototype.subscribe;F.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const E=this,x=this.handleMessage;this.handleMessage=function(k){if(H.disable_handling)return x.call(this,k);try{if(!E.props?.channelID||!k)return;H.insertChannelPointMessage(k);return}catch(N){return H.log.error("Error handling reward event:",N),x.call(this,k)}}},F.prototype.subscribe=function(...E){try{this.ffzInstall()}catch(x){H.log.error("Error in subscribe for RewardEventHandler:",x)}return V.call(this,...E)};for(const E of K)E.subscribe()}),this.ChatBufferConnector.on("mount",this.connectorMounted,this),this.ChatBufferConnector.on("update",this.connectorUpdated,this),this.ChatBufferConnector.on("unmount",this.connectorUnmounted,this),this.ChatBufferConnector.ready((F,K)=>{for(const H of K)this.connectorMounted(H)}),this.ChatController.ready((F,K)=>{const H=this,V=F.prototype.componentDidCatch,E=F.prototype.render;F.prototype.componentDidCatch=function(x,k){const N=this.state.ffz_errors||0;if(N<100&&(this.setState({ffz_errors:N+1}),H.log.info("Error within Chat",x,k,N)),V)return V.call(this,x,k)},F.prototype.render=function(){if(this.state.ffz_errors>0){const x=H.site.getReact(),k=x&&x.createElement;return k?k("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},"There was an error displaying chat."):null}return E.call(this)};for(const x of K)this.chatMounted(x)}),this.ChatRenderer.on("mount",this.rendererMounted,this),this.ChatRenderer.on("unmount",this.rendererUnmounted,this),this.ChatRenderer.on("update",this.rendererUpdated,this),this.ChatRenderer.ready((F,K)=>{for(const H of K)this.rendererMounted(H)}),this.ChatContainer.on("mount",this.containerMounted,this),this.ChatContainer.on("unmount",this.containerUnmounted,this),this.ChatContainer.on("update",this.containerUpdated,this),this.CalloutSelector.ready((F,K)=>{const H=this,V=F.prototype.render;F.prototype.render=function(){try{if(H.CalloutStackHandler){const E=H.site.getReact(),x=V.call(this),k=x?.props?.children;return Array.isArray(k)&&k.push(E.createElement(H.CalloutStackHandler)),x}}catch{}return V.call(this)};for(const E of K)E.forceUpdate()}),this.ChatContainer.ready((F,K)=>{const H=this,V=F.prototype.render,E=F.prototype.componentDidCatch;F.prototype.ffzRender=function(){if(H.chat.context.get("chat.banners.charity"))return V.call(this);const x=this.props.campaignData;this.props.campaignData=null;let k;try{k=V.call(this)}catch(N){throw this.props.campaignData=x,N}return this.props.campaignData=x,k},F.prototype.render=function(){try{if(H.CommunityStackHandler){const x=H.site.getReact(),k=this.ffzRender(),N=k?.props?.children?.props?.children;return x&&Array.isArray(N)&&N.push(x.createElement(H.CommunityStackHandler)),k}}catch{}return this.ffzRender()},F.prototype.componentDidCatch=function(x,k){const N=this.state.ffz_errors||0;if(N<100&&(this.setState({ffz_errors:N+1}),H.log.info("Error within Chat Container",x,k,N)),E)return E.call(this,x,k)};for(const x of K)this.containerMounted(x)}),this.subpump.on(":pubsub-message",F=>{if(F.prefix!=="community-points-channel-v1"||this.disable_handling)return;if(F.prefix==="pinned-chat-updates-v1"){this.log.debug("Pinned Chat",F);return}const K=this.ChatService.first,H=F.message,V=H?.data?.redemption;!H||!K||H.type!=="reward-redeemed"||K.props.channelID!=V?.channel_id||this.insertChannelPointMessage(H)})}insertChannelPointMessage(_){const F=this.ChatService.first,K=_?.data?.redemption,H=_?.type,V=H==="reward-redeemed",E=H==="automatic-reward-redeemed";if(!K?.reward||!F||!E&&!V||F.props.channelID!=K?.channel_id||V&&K.user_input||E&&K.reward.reward_type!=="celebration")return;let x;E?x=`${inst.props.channelID}:${K.reward.reward_type}`:x=K.reward.id;const k=F.props.rewardMap[x];k&&(this.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward")||this.last_points_redeem!==K.id&&(this.last_points_redeem=K.id,F.postMessageToCurrentChannel({},{id:K.id,type:this.chat_types.Message,ffz_type:"points",ffz_reward:k,ffz_reward_highlight:(0,i.ZH)(k),messageParts:[],user:{id:K.user.id,login:K.user.login,displayName:K.user.display_name},timestamp:new Date(_.data.timestamp||K.redeemed_at).getTime()})))}shouldHideCallout(_){if(!_)return;_=xe[_]??_.replace(/_/g,"-");const F=this.callout_types??Te,K=this.chat.context.get("chat.filtering.blocked-callouts");return!!(K&&K.has(_)||_===F.CommunityPointsRewards&&!this.chat.context.get("chat.points.show-callouts")||_===F.ClipLiveNudge&&!this.chat.context.get("chat.callouts.clip")||_==="prime_gift_bomb"&&!this.chat.context.get("chat.community-chest.show")||_==="megacheer_emote_recipient"&&!t.chat.context.get("chat.bits.show-rewards"))}updateCallouts(){this.updatePinnedCallouts(),this.updateInlineCallouts()}updatePinnedCallouts(){for(const _ of this.PinnedCallout.instances)this.onPinnedCallout(_)}onPinnedCallout(_){const F=_.props,K=F?.event,H=K?.type;this.shouldHideCallout(H)&&(_.props.pinned?_.unpin():_.hide()),H==="share-resub"&&!F.pinned&&this.chat.context.get("chat.pin-resubs")&&!_._ffz_pinned&&(this.log.info("Automatically pinning re-sub notice."),_._ffz_pinned=!0,_.pin()),H==="drop"&&this.autoClickDrop(_)}updateInlineCallouts(){for(const _ of this.InlineCallout.instances)this.onInlineCallout(_)}onInlineCallout(_){if(_.state.isHidden)return;const F=_.props?.event?.callout?.contextMenuProps,K=F?.event??_.props?.event,H=K?.type;if(this.shouldHideCallout(H)||this.shouldHideCallout(_.props?.event?.trackingType)){_.setState({isHidden:!0});return}if(H==="share-resub"&&this.chat.context.get("chat.pin-resubs")&&!_._ffz_pinned){const V=F?.onPin;V&&(this.log.info("Automatically pinning re-sub notice."),_._ffz_pinned=!0,_.hideOnContextMenuAction?_.hideOnContextMenuAction(V)():V())}H==="drop"&&this.autoClickDrop(_)}autoClickDrop(_){if((_.props?.event?.callout?.contextMenuProps?.event??_.props?.event)?.type!=="drop"||_._ffz_clicking||!this.chat.context.get("chat.drops.auto-rewards"))return;_._ffz_clicking=!0,this.resolve("site").awaitElement('button[data-a-target="chat-private-callout__primary-button"]',this.fine.getHostNode(_),1e4).then(V=>{_._ffz_clicking=!1,!((_.props?.event?.callout?.contextMenuProps?.event??_.props?.event)?.type!=="drop"||!this.chat.context.get("chat.drops.auto-rewards"))&&V.click()}).catch(()=>{_._ffz_clicking=!1})}wrapRaidController(_){if(_._ffz_wrapped)return this.noAutoRaids(_);_._ffz_wrapped=!0;const F=this,K=_.handleJoinRaid;_.handleJoinRaid=function(H,...V){const E=_.props&&_.props.raid&&_.props.raid.id;return H&&H.type&&E&&F.joined_raids.add(E),K.call(this,H,...V)},this.noAutoRaids(_)}noAutoRaids(_){_._ffz_no_raid||(_._ffz_no_raid=setTimeout(()=>{if(_._ffz_no_raid=null,_.props&&_.props.raid&&!_.isRaidCreator&&_.hasJoinedCurrentRaid){const F=_.props.raid.id;if(this.joined_raids.has(F))return;let K=this.settings.get("channel.raids.no-autojoin");if(!K){const H=this.settings.get("__filter:channel.raids.blocked-channels");if(H&&(_.props.raid.targetLogin&&H.test(_.props.raid.targetLogin)||_.props.raid.targetDisplayName&&H.test(_.props.raid.targetDisplayName))&&(K=!0),!K)return}this.log.info("Automatically leaving raid:",F),_.handleLeaveRaid()}}))}toggleEmoteJail(){const _=this.chat.context.get("chat.emotes.2x"),F=this.chat.context.get("chat.emotes.limit-size");this.css_tweaks.toggle("big-emote-jail",F&&!_),this.css_tweaks.toggle("bigger-emote-jail",F&&_)}cleanHighlights(){const _={community_sub_gift:this.chat.context.get("chat.subs.gift-banner"),megacheer:this.chat.context.get("chat.bits.show"),hype_train:this.chat.context.get("chat.banners.hype-train"),prediction:this.chat.context.get("chat.banners.prediction"),poll:this.chat.context.get("chat.banners.polls"),pinned_chat:this.chat.context.get("chat.banners.pinned-message"),"mw-drop-available":this.chat.context.get("chat.banners.drops"),shared_chat:this.chat.context.get("chat.banners.shared-chat")},F=this.community_stack?.highlights;if(Array.isArray(F))for(const K of F){if(!K||!K.event||!K.id)continue;const H=K.event.type;H&&(0,L.has)(_,H)&&!_[H]&&(this.log.info("Removing community highlight: ",H,"#",K.id),this.community_dispatch({type:"remove-highlight",id:K.id})),H==="mw-drop-available"&&K.event.detailsURL==="https://blog.twitch.tv/2024/07/26/sub-and-get-apple-tv/"&&this.chat.context.get("chat.banners.hide-appleplus")&&(this.log.info("Removing community highlight: ",H,"#",K.id),this.community_dispatch({type:"remove-highlight",id:K.id}))}}cleanCallouts(){const _=this.callout_stack;_?.pinnedCallout?.event?.type&&this.shouldHideCallout(_.pinnedCallout.event.type)&&_.unpinCallout(),_?.callouts?.[0]?.event?.type&&this.shouldHideCallout(_.callouts[0].event.type)&&_.clearCalloutType(_.callouts[0].event.type)}defineClasses(){if(this.CommunityStackHandler&&this.CalloutStackHandler)return!0;const _=this,F=this.site.getReact(),K=F?.createElement,H=this.web_munch.getModule("highlightstack"),V=this.web_munch.getModule("calloutstack");return K?(!this.CalloutStackHandler&&V&&(this.CalloutStackHandler=function(){const E=F.useContext(V.stack);return _.callout_stack=E,_.cleanCallouts(),null},this.CalloutSelector.forceUpdate()),!this.CommunityStackHandler&&H&&(this.CommunityStackHandler=function(){const E=F.useContext(H.stack),x=F.useContext(H.dispatch);return _.community_stack=E,_.community_dispatch=x,_.cleanHighlights(),null},this.ChatContainer.forceUpdate()),!0):!1}updateChatState(_){const F=this.chat.context.get("context.chat_state")||{};(0,L.deep_equals)(_,F)||(this.chat.context.updateContext({chat_state:_}),this.input.updateInput())}tryUpdateBadges(){this._badge_timer||(this._badge_timer=setTimeout(()=>this._tryUpdateBadges(),0))}_tryUpdateBadges(){this._badge_timer&&clearTimeout(this._badge_timer),this._badge_timer=null,this.log.info("Trying to update badge data from the chat container.");const _=this.ChatContainer.first;_&&this.containerUpdated(_,_.props)}wrapChatBuffer(_){if(_.prototype._ffz_was_here)return;const F=this,K=_.prototype.clear,H=_.prototype.flushRawMessages,V=_.prototype.componentDidMount;_.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const E=this,x=E.handleMessage,k=E.props.setMessageBufferAPI;E.props.setMessageBufferAPI=function(N){return N&&(N._ffz_inst=E),k(N)},E.handleMessage=function(N){if(N)try{const Z=F.chat_types||{},se=F.mod_types||{};if(F.chat.context.get("chat.filtering.blocked-types").has(Z[N.type])||N.type===Z.ChannelPointsReward&&!(0,i.zZ)(N.reward)||N.type===Z.RewardGift&&!F.chat.context.get("chat.bits.show-rewards"))return;if(N.type===Z.Message){const _e=F.chat.standardizeMessage(N),q=E._ffz_connector??E.ffzGetConnector();let le=_e.roomID=_e.roomID?_e.roomID:q?.props?.channelID,he=_e.roomLogin=_e.roomLogin?_e.roomLogin:_e.channel?_e.channel.slice(1):q?.props?.channelLogin;if(!he&&le){const Ce=F.chat.getRoom(le,null,!0);Ce&&Ce.login&&(he=_e.roomLogin=Ce.login)}if(!le&&he){const Ce=F.chat.getRoom(null,he,!0);Ce&&Ce.id&&(le=_e.roomID=Ce.id)}const be=F.site.getUser();if(be&&q&&(be.moderator=q.props.isCurrentUserModerator,be.staff=q.props.isStaff),_e.ffz_tokens=_e.ffz_tokens||F.chat.tokenizeMessage(_e,be,!0),_e.ffz_removed)return;if(F.hasListeners("chat:receive-message")){const Ce=F.makeEvent({message:_e,inst:E,channel:he,channelID:le});if(F.emit("chat:receive-message",Ce),Ce.defaultPrevented||_e.ffz_removed)return}}else if(N.type===Z.Moderation){if(F.emit("chat:mod-user",N.moderationType,N.userLogin,N.targetMessageID,N),!E.props.isCurrentUserModerator){const _e=N.moderationType,q=N.userLogin;let le;if(_e===se.Ban?le="ban":_e===se.Timeout?le="timeout":_e===se.Delete&&(le="delete"),le&&(N.moderationActionType=le),!E.moderatedUsers.has(q)&&_e!==se.Delete){E.moderateBuffers([E.buffer,E.delayedMessageBuffer.map(he=>he.event)],q,N),E.delayedMessageBuffer.push({event:N,time:Date.now(),shouldDelay:!1});return}}}else N.type===Z.Clear&&(F.chat.context.get("chat.filtering.ignore-clear")?N={type:Z.Info,message:F.i18n.t("chat.ignore-clear","An attempt by a moderator to clear chat was ignored.")}:F.emit("chat:clear-chat",N))}catch(Z){F.log.error("Error processing chat event.",Z),F.log.capture(Z,{extra:{msg:N}})}return x.call(E,N)},E.setPaused=function(N){E.paused!==N&&(E.paused=N,N||(E.slidingWindowEnd=Math.min(E.buffer.length,F.chat.context.get("chat.scrollback-length")),E.props.isBackground||E.notifySubscribers()))},E.loadNewer=function(){if(!E.hasNewerLeft())return;const N=Math.min(E.buffer.length,E.slidingWindowEnd+40),Z=Math.max(0,N-F.chat.context.get("chat.scrollback-length"));E.clear(E.buffer.length-Z),E.slidingWindowEnd=N-Z,E.props.isBackground||E.notifySubscribers()},E.loadNewest=function(){if(!E.hasNewerLeft())return;const N=F.chat.context.get("chat.scrollback-length");E.clear(N),E.slidingWindowEnd=Math.min(N,E.buffer.length),E.props.isBackground||E.notifySubscribers()},E.getMessages=function(){return E.buffer.slice(0,E.slidingWindowEnd+(E.ffz_extra||0))}},_.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(E){F.log.error("Error installing FFZ features onto chat buffer.",E)}return V.call(this)},_.prototype.clear=function(E){try{E==null&&(E=0);const x=F.chat.context.get("chat.scrollback-length");if(!this.isPaused()&&E>x&&(E=x),E<=0)this.ffz_extra=0,this.buffer=[],this.delayedMessageBuffer=[],this.paused=!1;else{const k=this.buffer,N=F.chat_types||me,Z=k.length-E;if(Z>0){let se=0,de;for(let _e=0;_e<Z;_e++)k[_e]&&!we.includes(N[k[_e].type])&&(se++,de=_e);this.buffer=k.slice(se%2!==0?Math.max(Z-4,de):Z),this.ffz_extra=k.length-E}else this.ffz_extra=0,this.buffer=this.buffer.slice(0);this.paused&&this.buffer.length>=900&&this.setPaused(!1)}}catch(x){return F.log.error("Error running clear",x),K.call(this,E)}},_.prototype.ffzGetConnector=function(){if(this._ffz_connector)return this._ffz_connector;const E=Date.now();if(E-(this._ffz_connect_tried||0)>5e3){this._ffz_connect_tried=E;const x=F.ChatBufferConnector.first;if(x?.props?.messageBufferAPI?._ffz_inst===this)return this._ffz_connector=x}},_.prototype.flushRawMessages=function(){try{const E=[],x=F.chat_types||me,k=Date.now(),N=F.chat.context.get("chat.delay"),Z=N===-1?this.delayDuration:N,se=k-Z,de=this.shouldSeeBlockedAndDeletedMessages||this.props&&this.props.shouldSeeBlockedAndDeletedMessages,_e=this.hasNewerLeft(),q=this.isPaused(),le=F.chat.context.get("chat.scrollback-length"),he=F.chat.context.get("chat.filtering.remove-deleted"),be=F.hasListeners("chat:buffer-message");let Ce=0,ze=this.slidingWindowEnd,Me=!1,ce;for(const ye of this.delayedMessageBuffer)if(ye.time<=se||!ye.shouldDelay){if(he!==0&&(he>1||!de)&&this.isDeletable(ye.event)&&ye.event.deleted)continue;if(be){if(ce)ce._reset();else{ce=F.makeEvent({inst:this,channel:void 0,channelID:void 0,message:void 0});const $e=this._ffz_connector??this.ffzGetConnector(),Ne=$e&&$e.props.channelID;if(ce.channelID=Ne,Ne){const tt=F.chat.getRoom(Ne,null,!0);tt&&tt.login&&(ce.channel=tt.login)}}if(ce.message=ye.event,F.emit("chat:buffer-message",ce),ce.defaultPrevented||ye.event.ffz_removed)continue}const Ee=this.buffer[this.buffer.length-1],Ae=Ee?.type;!this.props.isLoadingHistoricalMessages&&!this.props.historicalMessages||Ae!==x.Connected||ye.event.type===x.Connected||this.buffer.find($e=>$e.type===x.LiveMessageSeparator)||this.buffer.push({type:x.LiveMessageSeparator,id:"live-message-separator"}),this.buffer.push(ye.event),Me=!0,this.paused||(this.buffer.length>le?Ce++:ze++)}else E.push(ye);this.delayedMessageBuffer=E,Me&&(this.clear(Math.min(900,this.buffer.length-Ce)),Ce===0&&ze===this.slidingWindowEnd&&_e===this.hasNewerLeft()&&q===this.isPaused()||(this.slidingWindowEnd=ze,this.props.isBackground||this.notifySubscribers())),this.flushHighlightsBuffer&&this.flushHighlightsBuffer()}catch(E){return F.log.error("Error running flush.",E),H.call(this)}}}addNotice(_,F){if(!_)return!1;_.startsWith("#")&&(_=_.slice(1)),_=_.toLowerCase();for(const K of this.ChatService.instances)if(_==="*"||K.props.channelLogin.toLowerCase()===_){if(typeof F=="string")K.addMessage({type:(this.chat_types??me).Notice,message:F});else{const H=K.props,V=H.channelLogin,E=H.channelID;F.markdown&&((0,U.e)()||(0,U.Z)()),K.addMessage({type:(this.chat_types??me).Message,channel:`#${V}`,roomID:E,roomLogin:V,id:`ffz_notice_${(0,L.generateUUID)()}`,ffz_type:"notice",ffz_no_actions:!0,ffz_data:F,message:null,messageParts:[],timestamp:Date.now(),user:{userID:E,userLogin:V}})}return!0}return!1}sendMessage(_,F){const K=this.ChatService.first;if(!K||!_)return null;if(_.startsWith("#")&&(_=_.slice(1)),_.toLowerCase()!==K.props.channelLogin.toLowerCase())return K.client.sendCommand(_,F);K.sendMessage(F)}scheduleMystery(_){_.line&&(_._timer||(_._timer=setTimeout(()=>requestAnimationFrame(()=>{_._timer=null,_.line&&_.line.forceUpdate()}),250)))}wrapChatService(_){const F=this,K=_.prototype.componentDidMount,H=_.prototype.addEventListeners;_.prototype._ffz_was_here=!0,_.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const V=this,E=this.sendMessage,x=G((...N)=>V.addMessage(...N),"addMessage"),k=G((N,Z)=>V.sendMessage(N,Z),"sendMessage");V.sendMessage=function(N,Z){if(N=N.replace(/\s+/g," "),N.startsWith("/ffz:")){N=N.slice(5).trim();const de=N.indexOf(" ");let _e;de===-1?(_e=N,N=""):(_e=N.slice(0,de),N=N.slice(de+1).trimStart());const q=F.makeEvent({command:_e,message:N,extra:Z,context:F.chat.context,channel:V.props.channelLogin,_inst:V,addMessage:x,sendMessage:k}),le=`chat:ffz-command:${_e}`;return F.listeners(le)?.length>0?F.emit(le,q):V.addMessage({type:F.chat_types.Notice,message:F.i18n.t("chat.ffz-command.invalid","No such command: /ffz:{subcmd}",{subcmd:_e})}),!1}const se=F.makeEvent({message:N,extra:Z,context:F.chat.context,channel:V.props.channelLogin,_inst:V,addMessage:x,sendMessage:k});if(F.emit("chat:pre-send-message",se),!se.defaultPrevented)return E.call(this,se.message,se.extra)}},_.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(V){F.log.error("Error installing FFZ features onto chat service.",V)}return K.call(this)},_.prototype.addEventListeners=function(...V){if(!this._ffz_init){const E=this;for(const ce of Se){const ye=this[ce];ye&&(this[ce]=function(Ee,Ae){E._wrapped=Ee;const $e=ye.call(E,Ee,Ae);return E._wrapped=null,$e})}const x=this.onAnnouncementEvent;this.onAnnouncementEvent=function(ce){return x.call(this,ce)};const k=this.onSubscriptionEvent;this.onSubscriptionEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("Subscription"))return;if(F.disable_handling||F.chat.context.get("chat.subs.native"))return k.call(E,ce);if(F.chat.context.get("chat.subs.show")<3)return;ce.body="";const ye=E.convertMessage({message:ce});return ye.ffz_type="resub",ye.gift_theme=ce.giftTheme,ye.sharedChat=ce.sharedChat,ye.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,ye.sub_plan=ce.methods,ye.sub_multi=ce.multiMonthData?.multiMonthDuration?{count:ce.multiMonthData.multiMonthDuration,tenure:ce.multiMonthData.multiMonthTenure}:null,E.postMessageToCurrentChannel(ce,ye)}catch(ye){return F.log.capture(ye,{extra:ce}),k.call(E,ce)}};const N=this.onRoomStateEvent;this.onRoomStateEvent=function(ce){try{const ye=ce.channel,Ee=F.chat.context.get("context.channel");ye&&(ye===Ee||ye===`#${Ee}`)&&F.updateChatState(ce.state)}catch(ye){F.log.capture(ye,{extra:ce})}return N.call(E,ce)};const Z=this.onPinnedChatEvent;this.onPinnedChatEvent=function(ce){try{const ye=F.chat.context.get("chat.hype.message-style");if(ye!==1){if(ce.isSystemMessage&&ye===0)return;const Ee=E.convertMessage(ce);return Ee.ffz_type="hype",Ee.sharedChat=ce.sharedChat,Ee.hype_amount=ce.amount,Ee.hype_canonical_amount=ce.canonical_amount,Ee.hype_currency=ce.currency,Ee.hype_exponent=ce.exponent,Ee.hype_level=ce.level,ce.isSystemMessage&&(Ee.message="",Ee.messageBody="",Ee.messageParts=[],ce.message.body=""),E.postMessageToCurrentChannel(ce,Ee)}}catch(ye){F.log.capture(ye,{extra:ce})}return Z.call(E,ce)};const se=this.onResubscriptionEvent;this.onResubscriptionEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("Resubscription"))return;if(F.disable_handling||F.chat.context.get("chat.subs.native"))return se.call(E,ce);if(F.chat.context.get("chat.subs.show")<2&&!ce.body)return;const ye=E.convertMessage({message:ce});return ye.ffz_type="resub",ye.sharedChat=ce.sharedChat,ye.gift_theme=ce.giftTheme,ye.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,ye.sub_cumulative=ce.cumulativeMonths||0,ye.sub_streak=ce.streakMonths||0,ye.sub_share_streak=ce.shouldShareStreakTenure,ye.sub_months=ce.months,ye.sub_plan=ce.methods,ye.sub_multi=ce.multiMonthData?.multiMonthDuration?{count:ce.multiMonthData.multiMonthDuration,tenure:ce.multiMonthData.multiMonthTenure}:null,E.postMessageToCurrentChannel(ce,ye)}catch(ye){return F.log.capture(ye,{extra:ce}),se.call(E,ce)}};const de=this.ffz_mysteries={},_e=this.onSubscriptionGiftEvent;this.onSubscriptionGiftEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("SubGift"))return;if(F.disable_handling||F.chat.context.get("chat.subs.native"))return _e.call(E,ce);const ye=`${ce.channel}:${ce.user.userID}`,Ee=de[ye];if(Ee)if(Ee.expires<Date.now())de[ye]=null;else{Ee.recipients.push({id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName}),Ee.recipients.length>=Ee.size&&(de[ye]=null),Ee.line&&F.scheduleMystery(Ee);return}ce.body="";const Ae=E.convertMessage({message:ce});return Ae.ffz_type="sub_gift",Ae.sharedChat=ce.sharedChat,Ae.sub_recipient={id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName},Ae.gift_theme=ce.giftTheme,Ae.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,Ae.sub_months=ce.giftMonths,Ae.sub_plan=ce.methods,Ae.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,Ae)}catch(ye){return F.log.capture(ye,{extra:ce}),_e.call(E,ce)}};const q=this.onCommunityIntroductionEvent;this.onCommunityIntroductionEvent=function(ce){try{if(F.disable_handling)return q.call(this,ce);if(F.chat.context.get("chat.filtering.blocked-types").has("CommunityIntroduction")){const ye=E.convertMessage(ce);return ye.sharedChat=ce.sharedChat,E.postMessageToCurrentChannel(ce,ye)}}catch(ye){F.log.capture(ye,{extra:ce}),F.log.error(ye)}return q.call(this,ce)};const le=this.onAnonSubscriptionGiftEvent;this.onAnonSubscriptionGiftEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("AnonSubGift"))return;if(F.disable_handling||F.chat.context.get("chat.subs.native"))return le.call(E,ce);const ye=`${ce.channel}:ANON`,Ee=de[ye];if(Ee)if(Ee.expires<Date.now())de[ye]=null;else{Ee.recipients.push({id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName}),Ee.recipients.length>=Ee.size&&(de[ye]=null),Ee.line&&F.scheduleMystery(Ee);return}ce.body="";const Ae=E.convertMessage({message:ce});return Ae.ffz_type="sub_gift",Ae.sharedChat=ce.sharedChat,Ae.gift_theme=ce.giftTheme,Ae.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,Ae.sub_anon=!0,Ae.sub_recipient={id:ce.recipientID,login:ce.recipientLogin,displayName:ce.recipientName},Ae.sub_months=ce.giftMonths,Ae.sub_plan=ce.methods,Ae.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,Ae)}catch(ye){return F.log.capture(ye,{extra:ce}),le.call(E,ce)}};const he=this.onSubscriptionMysteryGiftEvent;this.onSubscriptionMysteryGiftEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("SubMysteryGift"))return;if(F.disable_handling||F.chat.context.get("chat.subs.native"))return he.call(E,ce);let ye=null;if(ce.massGiftCount>F.chat.context.get("chat.subs.merge-gifts")){const Ae=`${ce.channel}:${ce.user.userID}`;ye=de[Ae]={recipients:[],size:ce.massGiftCount,expires:Date.now()+3e4}}ce.body="";const Ee=E.convertMessage({message:ce});return Ee.ffz_type="sub_mystery",Ee.sharedChat=ce.sharedChat,Ee.gift_theme=ce.giftTheme,Ee.sub_goal=E.getGoalData?E.getGoalData(ce.goalData):null,Ee.mystery=ye,Ee.sub_plan=ce.plan,Ee.sub_count=ce.massGiftCount,Ee.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,Ee)}catch(ye){return F.log.capture(ye,{extra:ce}),he.call(E,ce)}};const be=this.onAnonSubscriptionMysteryGiftEvent;this.onAnonSubscriptionMysteryGiftEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("AnonSubMysteryGift"))return;if(F.disable_handling||F.chat.context.get("chat.subs.native"))return be.call(E,ce);let ye=null;if(ce.massGiftCount>F.chat.context.get("chat.subs.merge-gifts")){const Ae=`${ce.channel}:ANON`;ye=de[Ae]={recipients:[],size:ce.massGiftCount,expires:Date.now()+3e4}}ce.body="";const Ee=E.convertMessage({message:ce});return Ee.ffz_type="sub_mystery",Ee.sharedChat=ce.sharedChat,Ee.sub_anon=!0,Ee.mystery=ye,Ee.sub_plan=ce.plan,Ee.sub_count=ce.massGiftCount,Ee.sub_total=ce.senderCount,E.postMessageToCurrentChannel(ce,Ee)}catch(ye){return F.log.capture(ye,{extra:ce}),be.call(E,ce)}};const Ce=this.onRitualEvent;this.onRitualEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("Ritual"))return;if(F.disable_handling)return Ce.call(E,ce);const ye=E.convertMessage(ce);return ye.sharedChat=ce.sharedChat,ye.ffz_type="ritual",ye.ritual=ce.type,E.postMessageToCurrentChannel(ce,ye)}catch(ye){return F.log.capture(ye,{extra:ce}),Ce.call(E,ce)}};const ze=this.onChannelPointsRewardEvent;this.onChannelPointsRewardEvent=function(ce){try{if(F.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward"))return;if(F.disable_handling)return ze.call(E,ce);const ye=ce.rewardID&&(0,L.get)(ce.rewardID,E.props.rewardMap);if(ye){const Ee=E.convertMessage(ce);return F.chat.context.get("chat.powerup.effects")&&(0,i.zZ)(ye)&&ce.animationID?E.postMessageToCurrentChannel(ce,{type:F.chat_types.ChannelPointsReward,id:Ee.id,displayName:Ee.user.userDisplayName,login:Ee.user.userLogin,reward:ye,message:Ee,userID:Ee.user.userID,animationID:ce.animationID,sharedChat:ce.sharedChat}):(Ee.ffz_animation_id=ce.animationID,Ee.sharedChat=ce.sharedChat,Ee.ffz_type="points",Ee.ffz_reward=ye,Ee.ffz_reward_highlight=(0,i.ZH)(ye),E.postMessageToCurrentChannel(ce,Ee))}}catch(ye){F.log.error(ye),F.log.capture(ye,{extra:ce})}return ze.call(E,ce)};const Me=this.addMessage;this.addMessage=function(ce){const ye=E._wrapped;return ye&&!ce._ffz_checked?E.postMessageToCurrentChannel(ye,ce):Me.call(E,ce)},this._ffz_init=!0}return H.apply(this,...V)},_.prototype.postMessageToCurrentChannel=function(V,E){const x=E;if(E._ffz_checked=!0,(E.type===F.chat_types.ChannelPointsReward||E.type===F.chat_types.CommunityIntroduction||E.message?.user&E.message?.badgeDynamicData)&&(E=E.message),V.channel){let k=E.channel=V.channel.toLowerCase();if(k.startsWith("#")&&(k=k.slice(1)),k!==this.props.channelLogin.toLowerCase())return;E.roomLogin=k}if(E.ffz_first_msg=E.isFirstMsg||V.message?.isFirstMsg||!1,E.ffz_returning=V.message?.isReturningChatter||!1,V.message){const k=V.message.user,N=V.message.flags;if(k&&(E.emotes=k.emotes),N&&this.getFilterFlagOptions){const Z=this.props.isCurrentUserModerator&&F.chat.context.get("chat.automod.run-as-mod");Z&&(this.props.isCurrentUserModerator=!1),E.flags=this.getFilterFlagOptions(N),Z&&(this.props.isCurrentUserModerator=!0)}(!E.message||typeof E.message=="string")&&(typeof V.action=="string"?E.message=V.action:E.message=V.message.body)}this.addMessage(x)}}addRoom(_,F){if(F||(F=_.props),!F.channelID)return null;const K=_._ffz_room=this.chat.getRoom(F.channelID,F.channelLogin&&F.channelLogin.toLowerCase(),!1,!0);return K.ref(_),K}removeRoom(_){_._ffz_room&&(_._ffz_room.unref(_),_._ffz_room=null)}chatMounted(_,F){_.chatBuffer&&(_.chatBuffer.ffzController=_),F||(F=_.props),this.addRoom(_,F)&&(this.updateRoomBitsConfig(_,F.bitsConfig),this.settings.updateContext({moderator:F.isCurrentUserModerator,chatHidden:F.isHidden}),(F.isEmbedded||F.isPopout)&&this.settings.updateContext({channel:F.channelLogin&&F.channelLogin.toLowerCase(),channelID:F.channelID}),this.chat.context.updateContext({moderator:F.isCurrentUserModerator,channel:F.channelLogin&&F.channelLogin.toLowerCase(),channelID:F.channelID}))}chatUnmounted(_){_.chatBuffer&&_.chatBuffer.ffzController===this&&(_.chatBuffer.ffzController=null),(_.props.isEmbedded||_.props.isPopout)&&this.settings.updateContext({channel:null,channelID:null}),this.settings.updateContext({moderator:!1,chatHidden:!1}),this.chat.context.updateContext({moderator:!1,channel:null,channelID:null}),this.removeRoom(_)}chatUpdated(_,F){if(_.chatBuffer&&(_.chatBuffer.ffzController=_),!_._ffz_room||F.channelID!=_._ffz_room.id){this.removeRoom(_),_._ffz_mounted&&this.chatMounted(_);return}F.bitsConfig!==_.props.bitsConfig&&this.updateRoomBitsConfig(_,_.props.bitsConfig);let K=_.props.channelLogin;K&&(K=K.toLowerCase()),(_.props.isEmbedded||_.props.isPopout)&&this.settings.updateContext({channel:K,channelID:_.props.channelID}),this.settings.updateContext({moderator:_.props.isCurrentUserModerator,chatHidden:_.props.isHidden}),this.chat.context.updateContext({moderator:_.props.isCurrentUserModerator,channel:K,channelID:_.props.channelID})}updateRoomBitsConfig(_,F){const K=_._ffz_room;if(!K)return;let H=null;if(F&&Array.isArray(F.orderedActions)){H=new Set;for(const V of F.orderedActions)V&&V.prefix&&H.add(V.prefix)}!this._ffz_old_bits&&!H||(0,L.set_equals)(this._ffz_old_bits,H)||(this._ffz_old_bits=H,K.updateBitsConfig(ie(F)),this.chat_line.updateLineTokens())}connectorMounted(_){const F=_.props.messageBufferAPI;F&&F._ffz_inst&&F._ffz_inst._ffz_connector!==_&&(F._ffz_inst._ffz_connector=_)}connectorUpdated(_,F){const K=F.messageBufferAPI,H=_.props.messageBufferAPI;K!==H&&(K&&K._ffz_inst&&K._ffz_inst._ffz_connector===_&&(K._ffz_inst._ffz_connector=null),H&&H._ffz_inst&&H._ffz_inst._ffz_connector!==_&&(K._ffz_inst._ffz_connector=_))}connectorUnmounted(_){const F=_.props.messageBufferAPI;F&&F._ffz_inst&&F._ffz_inst._ffz_connector===_&&(F._ffz_inst._ffz_connector=null)}rendererMounted(_,F){F||(F=_.props),this.updateRendererSharedChats(_,F?.sharedChatDataByChannelID)}updateRendererSharedChats(_,F){if(F??(F=_.props.sharedChatDataByChannelID),_._ffz_cached_shared===F)return;this.shared_room_data=_._ffz_cached_shared=F,this.shared_rooms=_._ffz_shared_rooms=_._ffz_shared_rooms||{};const K=new Set(Object.keys(_._ffz_shared_rooms));let H=!1;if(F!=null)for(const[E,x]of F.entries()){K.delete(E);let k=_._ffz_shared_rooms[E];k||(k=this.chat.getRoom(E,x.login),k.ref(_),_._ffz_shared_rooms[E]=k);const N=x.badges?.channelsBySet;let Z=0;if(N)for(const se of N.values())for(const de of se.values())Z++;k.badgeCount()!==Z&&(H=!0,k.updateBadges(N))}for(const E of K){const x=_._ffz_shared_rooms[E];x&&x.unref(_),x.unshareChat(),delete _._ffz_shared_rooms[E]}const V=Object.keys(_._ffz_shared_rooms);for(const E of Object.values(_._ffz_shared_rooms))E.shareChats(V);V.length>0&&this.settings.provider.get("shared-chat-notice")!==1&&(this.settings.provider.set("shared-chat-notice",1),this.addNotice("*",{icon:"ffz-i-zreknarf",message:this.i18n.t("chat.shared-chat.welcome","FrankerFaceZ: This is a Shared Chat, a new feature from Twitch to combine multiple stream chats into one. FrankerFaceZ support is early, so some messages might not look correct. Sorry for any trouble!")})),H&&this.chat_line.updateLineBadges()}rendererUnmounted(_){if(_._ffz_shared_rooms)for(const F of Object.values(_._ffz_shared_rooms))F.unref(_);_._ffz_shared_rooms=null,_._ffz_cached_shared=null,this.shared_room_data=new Map,this.shared_rooms={}}rendererUpdated(_,F){this.updateRendererSharedChats(_,F?.sharedChatDataByChannelID)}get shouldUpdateChannel(){const _=this.router.current_name;return v.Z.POPOUT_ROUTES.includes(_)||v.Z.SUNLIGHT_ROUTES.includes(_)}containerMounted(_,F){if(F||(F=_.props),!!this.addRoom(_,F)&&(this.updateRoomBitsConfig(_,F.bitsConfig),F.globalBadgeData?.badges?this.chat.badges.updateTwitchBadges(F.globalBadgeData.badges):F.data?.badges&&this.chat.badges.updateTwitchBadges(F.data.badges),F.data)){if(this.shouldUpdateChannel){const K=F.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(K),this.settings.updateContext({channel:F.channelLogin,channelID:F.channelID,channelColor:K})}this.updateRoomBadges(_,F.data.user&&F.data.user.broadcastBadges),this.updateRoomRules(_,F.chatRules)}}containerUnmounted(_){this.shouldUpdateChannel&&(this.resolve("site.channel").updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})),this.removeRoom(_)}containerUpdated(_,F){if(!_._ffz_room||F.channelID!=_._ffz_room.id){this.removeRoom(_),_._ffz_mounted&&this.containerMounted(_,F);return}if(F.bitsConfig!==_.props.bitsConfig&&this.updateRoomBitsConfig(_,F.bitsConfig),F.data&&v.Z.POPOUT_ROUTES.includes(this.router.current_name)){const x=F.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(x),this.settings.updateContext({channel:F.channelLogin,channelID:F.channelID,channelColor:x})}const K=F.data?.user?.broadcastBadges??[],H=_.props.data?.user?.broadcastBadges??[],V=F.globalBadgeData?.badges??[],E=_.props.globalBadgeData?.badges??[];(this.chat.badges.getTwitchBadgeCount()!==V.length||V.length!==E.length)&&this.chat.badges.updateTwitchBadges(V),(_._ffz_room.badgeCount()!==K.length||K.length!==H.length)&&this.updateRoomBadges(_,K),this.updateRoomRules(_,F.chatRules)}hasRoomBadges(_){const F=_._ffz_room;return F?F.hasBadges():!1}updateRoomBadges(_,F){const K=_._ffz_room;K&&(K.updateBadges(F),this.chat_line.updateLineBadges())}updateRoomRules(_,F){const K=_._ffz_room;K&&(K.rules=F)}};G(ct,"ChatHook");let oe=ct;function ie(Oe){if(!Oe)return;const _={},F=Oe.indexedActions,K={};if(Array.isArray(Oe.tiers))for(const H of Oe.tiers)K[H.bits]=H.color;for(const H in F)if((0,L.has)(F,H)){const V=F[H],E=_[H]={id:V.id,prefix:V.prefix,tiers:[]};if(Oe?.getImage)for(const x of V.orderedTiers){const k={};for(const N of["light","dark"]){const Z=k[N]=k[N]||{},se=Z.static=Z.static||{},de=Z.animated=Z.animated||{};for(const _e of[1,2,4])se[_e]=Oe.getImage(V.prefix,N,"static",x.bits,_e,"png"),de[_e]=Oe.getImage(V.prefix,N,"animated",x.bits,_e,"gif")}E.tiers.push({amount:x.bits,color:x.color||K[x.bits]||"inherit",id:x.id,images:k})}else if(V.orderedTiers[0]?.images)for(const x of V.orderedTiers){const k={};for(const N of x.images){const Z=k[N.theme]=k[N.theme]||[],se=N.isAnimated?"animated":"static",de=Z[se]=Z[se]||{};de[N.dpiScale]=N.url}E.tiers.push({amount:x.bits,color:x.color||K[x.bits]||"inherit",id:x.id,images:k})}}return _}G(ie,"formatBitsConfig")},44615:(ae,J,d)=>{"use strict";d.d(J,{KC:()=>W,ZH:()=>I,_x:()=>U,at:()=>v,yg:()=>u,zZ:()=>D});function W(g){return g.pricingType==="BITS"}G(W,"doesRewardCostBits");function L(g){return g?.__typename==="CommunityPointsAutomaticReward"}G(L,"isAutomaticReward");function B(g){return g?.__typename==="CommunityPointsCustomReward"}G(B,"isCustomReward");function I(g){return L(g)&&g.type==="SEND_HIGHLIGHTED_MESSAGE"}G(I,"isHighlightedReward");function U(g){return g&&(g.title?.includes?.("FFZ:GE")||g.prompt?.includes?.("FFZ:GE"))}G(U,"isGiantEmoteReward");function D(g){return g?.type==="SEND_ANIMATED_MESSAGE"}G(D,"isMessageEffect");function v(g){const S=W(g);return L(g)?S?g.bitsCost||g.defaultBitsCost:g.cost||g.defaultCost:S?g.bitsCost:g.cost}G(v,"getRewardCost");function f(g){return L(g)?g.backgroundColor||g.defaultBackgroundColor:g.backgroundColor}G(f,"getRewardColor");function u(g,S){if(B(g))return g.title;switch(g.type){case"SEND_ANIMATED_MESSAGE":return S.t("chat.points.animated","Message Effects");case"SEND_HIGHLIGHTED_MESSAGE":return S.t("chat.points.highlighted","Highlight My Message");case"SINGLE_MESSAGE_BYPASS_SUB_MODE":return S.t("chat.points.bypass-sub","Send a Message in Sub-Only Mode");case"CHOSEN_SUB_EMOTE_UNLOCK":return S.t("chat.points.choose-emote","Choose an Emote to Unlock");case"RANDOM_SUB_EMOTE_UNLOCK":return S.t("chat.points.random-emote","Unlock a Random Sub Emote");case"CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK":return S.t("chat.points.modify-emote","Modify a Single Emote");default:return S.t("chat.points.reward","Reward")}}G(u,"getRewardTitle")},6325:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>B});var W=d(22527),L=d(46949);const I=class I extends W.default{constructor(...D){super(...D),this.should_enable=!0,this.inject("settings"),this.inject("site.chat"),this.inject("chat.emotes")}onEnable(){this.hookEmoteMenu()}async hookEmoteMenu(){const D=await this.findEmoteMenu();if(!D)return this.log.info("Emote Menu for Twitch was not found after 60 seconds.");D.registerEmoteGetter("FrankerFaceZ",()=>{const v=this.chat.ChatContainer.first,f=v&&v.props;if(!f)return;const u=this.emotes.getSets(f.userID,f.currentUserLogin,f.channelID,f.channelLogin),g=this.resolve("chat"),S=(g?.context||this.settings)?.get?.("chat.emotes.animated")>0,n=[];for(const s of u)if(!(!s||!s.emotes)){for(const i in s.emotes)if((0,L.has)(s.emotes,i)){const l=s.emotes[i];if(l.hidden)continue;n.push({text:l.name,url:S&&l.animated?.[1]||l.urls[1],channel:`${s.source||"FrankerFaceZ"} ${s.title}`,badge:s.icon||"//cdn.frankerfacez.com/script/devicon.png"})}}return n})}async findEmoteMenu(D=0){return window.emoteMenu&&emoteMenu.registerEmoteGetter?emoteMenu:D>=6e4?null:(await(0,L.sleep)(100),this.findEmoteMenu(D+100))}};G(I,"CompatEmoteMenu");let B=I},17103:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>v});var W=d(22527),L=d(44589),B=d(46949),I=d(83342);const U=document.createElement("span"),D={"side-nav":".side-nav,#sideNav","side-nav-viewers":".side-nav-card__live-status","side-rec-channels":".side-nav .recommended-channels,.side-nav .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-friends":".side-nav .online-friends","side-closed-friends":".side-nav--collapsed .online-friends","side-closed-rec-channels":".side-nav--collapsed .recommended-channels,.side-nav--collapsed .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-offline-channels":".ffz--side-nav-card-offline","side-rerun-channels":".side-nav .ffz--side-nav-card-rerun","modview-hide-info":".modview-player-widget__hide-stream-info","community-highlights":".community-highlight-stack__card","elevate-your-message":'.chat-input__input-icons button[aria-label="ElevatedMessage"]',"prime-offers":".top-nav__prime","discover-luna":'.top-nav__external-link[data-a-target="try-presto-link"]',subtember:".subtember-gradient","player-gain-volume":'.video-player__container[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__container[data-controls="false"] .extension-taskbar,.video-player__container[data-controls="false"] .extension-container,.video-player__container[data-controls="false"] .extensions-dock__layout,.video-player__container[data-controls="false"] .extensions-notifications,.video-player__container[data-controls="false"] .extensions-video-overlay-size-container',"player-cast":".video-player button:has(.tw-chromecast-button__icon)","player-event-bar":".channel-root .live-event-banner-ui__header","player-rerun-bar":'.channel-root__player-container div.tw-c-text-overlay:not([data-a-target="hosting-ui-header"])',"pinned-cheer":'.pinned-cheer,.pinned-cheer-v2,.channel-leaderboard,.channel-leaderboard-marquee,div[data-test-selector="channel-leaderboard-container"]',whispers:'body .whispers-open-threads,.tw-core-button[data-a-target="whisper-box-button"],.whispers__pill',"dir-live-ind":'.live-channel-card[data-ffz-type="live"] .tw-channel-status-text-indicator,article[data-ffz-type="live"] .tw-channel-status-text-indicator,.switcher-hopper__scroll-container .tw-tower a[data-ffz-type="live"] .tw-channel-status-text-indicator',"profile-hover":".preview-card .tw-relative:hover .ffz-channel-avatar","not-live-bar":'div[data-test-selector="non-live-video-banner-layout"]',"channel-live-ind":".channel-header__user .tw-channel-status-text-indicator,.channel-info-content .tw-halo__indicator",celebration:"body .celebration__overlay","last-x-events":".last-x-events_container","pinned-hype-chat":".paid-pinned-chat-message-list","side-stories":".side-nav__title + div[class*=storiesLeftNavSection]","ci-mod-view":'.chat-input__buttons-container a[href*="/moderator"]',"ci-highlight-settings":'.chat-input__buttons-container button[data-highlight-selector="chat-highlights-shortcut"]',"ci-shield-mode":'.chat-input__buttons-container > div:last-child button[class|="ScCoreButton"]:not([data-highlight-selector]):not([data-a-target])'},f=class f extends W.default{constructor(...g){super(...g),this.should_enable=!0,this.inject("settings"),this.style=new L.ManagedStyle,this.chunks={},this.chunks_loaded=!1,this._state={},this.settings.add("metadata.modview.hide-info",{default:!1,ui:{path:"Channel > Metadata >> Mod View",title:'Hide "Hide Stream Info Stripe" button.',component:"setting-check-box"},changed:S=>this.toggleHide("modview-hide-info",S)}),this.settings.add("metadata.viewers.no-native",{requires:["metadata.viewers"],default:null,process(S,n){return n??S.get("metadata.viewers")},changed:S=>this.toggle("hide-native-viewers",S),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Viewer Count.",description:"By default, this is enabled whenever FFZ's own Viewer Count display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("metadata.uptime.no-native",{requires:["metadata.uptime"],default:null,process(S,n){return n??S.get("metadata.uptime")!==0},changed:S=>this.toggle("hide-native-uptime",S),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Stream Uptime.",description:"By default, this is enabled whenever FFZ's own Stream Uptime display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("layout.use-chat-fix",{requires:["context.force_chat_fix","layout.swap-sidebars","layout.use-portrait","chat.use-width","context.isWatchParty"],process(S){return S.get("context.isWatchParty")?!1:S.get("context.force_chat_fix")||S.get("layout.swap-sidebars")||S.get("layout.use-portrait")||S.get("chat.use-width")},changed:S=>{S?this.toggle("chat-no-animate",!0):!S&&!this._no_anim_timer&&(this._no_anim_timer=requestAnimationFrame(()=>{this._no_anim_timer=null,this.settings.get("layout.use-chat-fix")||this.toggle("chat-no-animate",!1)})),this.toggle("chat-fix",S),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-stories",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Stories",component:"setting-check-box"}}),this.settings.add("layout.side-nav.show",{default:1,requires:["layout.use-portrait"],process(S,n){return n===2?!S.get("layout.use-portrait"):n},ui:{sort:-1,path:"Appearance > Layout >> Side Navigation",title:"Display Side Navigation",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"Hide in Portrait"}]},changed:S=>{this.toggle("hide-side-nav",!S),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-viewers",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Channel View Counts",component:"setting-check-box"},changed:S=>this.toggleHide("side-nav-viewers",S)}),this.settings.add("layout.side-nav.show-avatars",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Channel Avatars",component:"setting-check-box"},changed:S=>this.toggle("hide-side-nav-avatars",!S)}),this.settings.add("layout.side-nav.show-rec-channels",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended / Popular Channels",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:S=>{this.toggleHide("side-rec-channels",S===0),this.toggleHide("side-closed-rec-channels",S===2)}}),this.settings.add("layout.side-nav.show-friends",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Online Friends",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:S=>{this.toggleHide("side-friends",S===0),this.toggleHide("side-closed-friends",S===2)}}),this.settings.add("layout.side-nav.hide-offline",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Offline Channels",component:"setting-check-box"},changed:S=>this.toggleHide("side-offline-channels",S)}),this.settings.add("layout.side-nav.rerun-style",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Reruns",component:"setting-select-box",data:[{value:0,title:"Do Not Display"},{value:1,title:"Normally"},{value:2,title:"Faded (33% Opacity)"}]},changed:S=>{this.toggleHide("side-rerun-channels",S===0),this.toggle("side-rerun-opacity",S===2)}}),this.settings.add("layout.swap-sidebars",{default:!1,requires:["context.isWatchParty"],process(S,n){return S.get("context.isWatchParty")?!1:n},ui:{path:"Appearance > Layout >> Side Navigation",title:"Swap Sidebars",description:"Swap navigation and chat to the opposite sides of the window.",component:"setting-check-box"},changed:S=>{this.toggle("swap-sidebars",S),this.emit("site.layout:resize")}}),this.settings.add("layout.minimal-navigation",{requires:["layout.theatre-navigation","context.isWatchParty"],default:!1,process(S,n){return S.get("context.isWatchParty")?!1:S.get("layout.theatre-navigation")?!0:n},ui:{path:"Appearance > Layout >> Top Navigation",title:"Minimize Navigation",description:"Slide the site navigation bar up out of view when it isn't in use.",component:"setting-check-box"},changed:S=>{this.toggle("minimal-navigation",S),this.emit("site.layout:resize")}}),this.settings.add("layout.theatre-navigation",{requires:["layout.is-theater-mode"],default:!1,process(S,n){return S.get("layout.is-theater-mode")?n:!1},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the minimized navigation bar when in theatre mode.",component:"setting-check-box"},changed:S=>{this.toggle("theatre-nav",S),this.emit("site.layout:resize")}}),this.settings.add("layout.subtember",{default:!0,ui:{path:"Appearance > Layout >> Channel",title:"Allow the Subtember upsell banner to appear.",component:"setting-check-box"}}),this.settings.add("layout.turbo-cta",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Allow the Twitch Turbo button to appear.",component:"setting-check-box"}}),this.settings.add("layout.prime-offers",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Prime Gaming Loot.",component:"setting-check-box"},changed:S=>this.toggleHide("prime-offers",!S)}),this.settings.add("layout.hide-discover-luna",{default:!1,ui:{path:"Appearance > Layout >> Top Navigation",title:'Hide the "Discover Luna" link.',component:"setting-check-box"},changed:S=>this.toggleHide("discover-luna",S)}),this.settings.add("whispers.show",{default:!0,ui:{path:"Chat > Whispers >> General",title:"Display Whispers",component:"setting-check-box"},changed:S=>{this.toggleHide("whispers",!S),this.emit("site.layout:resize")}}),this.settings.add("chat.hype.show-pinned",{default:!0,ui:{path:"Chat > Hype Chat >> Appearance",title:"Allow Hype Chat messages to appear pinned at the top of chat.",component:"setting-check-box"},changed:S=>this.toggleHide("pinned-hype-chat",!S)}),this.settings.add("chat.bits.show",{default:!0,ui:{order:-1,path:"Chat > Bits and Cheering >> Appearance",title:"Display Bits",description:"Display UI associated with bits. Note: This will not hide cheering in chat messages.",component:"setting-check-box"},changed:S=>this.toggle("hide-bits",!S)}),this.settings.add("channel.show-celebrations",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow Celebrations to appear.",description:"Celebrations are animations that cover the entire Twitch page.",component:"setting-check-box"},changed:S=>this.toggleHide("celebration",!S)}),this.settings.add("layout.theme.global-font",{default:"",ui:{path:"Appearance > Theme >> Fonts",title:"Font Family",description:'Override the font used for the entire Twitch website. The old default font was: `"Helvetica Neue",Helvetica,Arial,sans-serif`\n\nAny font available via [Google Fonts](https://fonts.google.com/) can be loaded by prefixing the font name with `google:`.',component:"setting-combo-box",data:()=>(0,I.R7)()},changed:()=>this.updateFont()}),this.settings.add("channel.hide-unfollow",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Unfollow button.",component:"setting-check-box"},changed:S=>this.toggle("hide-unfollow-button",S)}),this.settings.add("channel.hide-live-indicator",{requires:["context.route.name"],process(S,n){return S.get("context.route.name")==="user"||S.get("context.route.name")==="user-home"?n:!1},default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "LIVE" indicator on live channel pages.',component:"setting-check-box"},changed:S=>this.toggleHide("channel-live-ind",S)}),this.settings.add("channel.round-avatars",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow avatar images to be rounded.",component:"setting-check-box"},changed:S=>this.toggle("square-avatars",!S)})}onEnable(){this.toggleHide("modview-hide-info",this.settings.get("metadata.modview.hide-info")),this.toggleHide("side-nav-viewers",this.settings.get("layout.side-nav.hide-viewers")),this.toggle("hide-native-uptime",this.settings.get("metadata.uptime.no-native")),this.toggle("hide-native-viewers",this.settings.get("metadata.viewers.no-native")),this.toggle("chat-fix",this.settings.get("layout.use-chat-fix")),this.toggle("swap-sidebars",this.settings.get("layout.swap-sidebars")),this.toggle("minimal-navigation",this.settings.get("layout.minimal-navigation")),this.toggle("theatre-nav",this.settings.get("layout.theatre-navigation")),this.toggle("hide-side-nav-avatars",!this.settings.get("layout.side-nav.show-avatars")),this.toggle("hide-side-nav",!this.settings.get("layout.side-nav.show")),this.toggleHide("side-offline-channels",this.settings.get("layout.side-nav.hide-offline")),this.toggleHide("discover-luna",this.settings.get("layout.hide-discover-luna")),this.toggleHide("prime-offers",!this.settings.get("layout.prime-offers")),this.toggle("hide-unfollow-button",this.settings.get("channel.hide-unfollow")),this.toggleHide("pinned-hype-chat",!this.settings.get("chat.hype.show-pinned")),this.toggle("square-avatars",!this.settings.get("channel.round-avatars")),this.toggleHide("channel-live-ind",this.settings.get("channel.hide-live-indicator"));const g=this.settings.get("layout.side-nav.rerun-style");this.toggleHide("side-rerun-channels",g===0),this.toggle("side-rerun-opacity",g===2);const S=this.settings.get("layout.side-nav.show-rec-channels");this.toggleHide("side-rec-channels",S===0),this.toggleHide("side-closed-rec-channels",S===2);const n=this.settings.get("layout.side-nav.show-friends");this.toggleHide("side-friends",n===0),this.toggleHide("side-closed-friends",n===2),this.toggleHide("whispers",!this.settings.get("whispers.show")),this.toggleHide("celebration",!this.settings.get("channel.show-celebrations")),this.settings.getChanges("layout.subtember",s=>this.toggleHide("subtember",!s)),this.settings.getChanges("layout.side-nav.hide-stories",s=>this.toggleHide("side-stories",s)),this.updateFont(),this.updateTopNav(),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateTopNav(){requestAnimationFrame(()=>this.emit("site.layout:update-nav"))}updateFont(){let g=this.settings.get("layout.theme.global-font");if(g&&g.length){const[S,n]=(0,I.jo)(g);if(g=S,this._font_unloader&&this._font_unloader(),this._font_unloader=n,g.indexOf(" ")!==-1&&g.indexOf(",")===-1&&g.indexOf('"')===-1&&g.indexOf("'")===-1&&(g=`"${g}"`),U.style.fontFamily="",U.style.fontFamily=g,U.style.fontFamily){this.setVariable("global-font",g),this.toggle("global-font",!0);return}}this.toggle("global-font",!1),this.deleteVariable("global-font")}toggleHide(g,S){const n=`hide--${g}`;if(!S){this.style.delete(n);return}if(!(0,B.has)(D,g))throw new Error(`cannot find class for "${g}"`);this.style.set(n,`${D[g]} { display: none !important }`)}toggle(g,S){S=!!S,(this._state[g]??!1)!==S&&(this._state[g]=S,this._apply(g))}_apply(g){if(!this._state[g]){this.style&&this.style.delete(g);return}if(!this.style.has(g)){if(!this.chunks_loaded)return this.loadFromContext().then(()=>this._apply(g));if(!(0,B.has)(this.chunks,g)){this.log.warn(`Unknown chunk name "${g}" for toggle()`);return}this.style.set(g,this.chunks[g])}}set(g,S){return this.style.set(g,S)}delete(g){return this.style.delete(g)}setVariable(g,S,n="body"){this.style.set(`var--${g}`,`${n} { --ffz-${g}: ${S}; }`)}deleteVariable(g){this.style.delete(`var--${g}`)}loadFromContext(){if(!this.chunks_loaded)return new Promise(async g=>{const S=(await d.e(2597).then(d.bind(d,96677))).default;for(const n of S.keys()){const s=n.slice(2,n.length-(n.endsWith(".scss")?5:4));this.chunks[s]=S(n).default}this.emit("site.layout:resize"),this.chunks_loaded=!0,g()})}};G(f,"CSSTweaks");let v=f},95778:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>I});var W=d(22527),L=d(46949),B=d(43874);const U=class U extends W.default{constructor(...v){super(...v),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.channel"),this.SunlightBroadcast=this.fine.define("sunlight-bcast",f=>f.getGame&&f.getTitle&&f.props?.data,B.Z.SUNLIGHT_ROUTES),this.SunlightManager=this.fine.define("sunlight-manager",f=>f.props?.channelID&&f.props.channelLogin&&(0,L.has)(f.props,"hostedChannel"),B.Z.SUNLIGHT_ROUTES)}onEnable(){this.SunlightManager.on("mount",this.updateSunlight,this),this.SunlightManager.on("update",this.updateSunlight,this),this.SunlightManager.on("unmount",this.removeSunlight,this),this.SunlightManager.ready((v,f)=>{for(const u of f)this.updateSunlight(u)}),this.SunlightBroadcast.on("mount",this.updateBroadcast,this),this.SunlightBroadcast.on("update",this.updateBroadcast,this),this.SunlightBroadcast.on("unmount",this.removeBroadcast,this),this.SunlightBroadcast.ready((v,f)=>{for(const u of f)this.updateBroadcast(u)})}updateSunlight(v){this.settings.updateContext({channel:(0,L.get)("props.channelLogin",v),channelID:(0,L.get)("props.channelID",v)})}removeSunlight(){this.settings.updateContext({channel:null,channelID:null})}updateBroadcast(v){const f=v.props?.data?.user?.broadcastSettings,u=f?.game;this.settings.updateContext({category:u?.name,categoryID:u?.id,title:f?.title})}removeBroadcast(){this.settings.updateContext({category:null,categoryID:null,title:null})}};G(U,"Dashboard");let I=U},96432:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{CARD_CONTEXTS:()=>D,CONTENT_FLAGS:()=>v,default:()=>g});var W=d(22527),L=d(83269),B=d(44589),I=d(46949);const S=class S extends W.default{constructor(...i){super(...i),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("settings"),this.GameHeader=this.fine.define("game-header",l=>l.props&&l.props.data&&l.getBannerImage&&l.getDirectoryCountAndTags,["dir-game-index","dir-community","dir-game-videos","dir-game-clips","dir-game-details"]),this.settings.addUI("directory.game.blocked-games",{path:`Directory > Categories @{"description": "Please note that due to limitations in Twitch's website, names here must be formatted exactly as displayed in your client. For best results, you can block or unblock categories directly from directory pages."} >> Blocked`,component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()}),this.settings.addUI("directory.game.hidden-thumbnails",{path:"Directory > Categories >> Hidden Thumbnails",component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()})}onEnable(){this.GameHeader.on("mount",this.updateGameHeader,this),this.GameHeader.on("update",this.updateGameHeader,this),this.GameHeader.on("unmount",()=>{this.settings.updateContext({category:null,categoryID:null})}),this.settings.provider.on("changed",i=>{if(i==="directory.game.blocked-games"||i==="directory.game.hidden-thumbnails"){this.parent.updateCards();for(const l of this.GameHeader.instances)this.updateGameHeader(l)}}),this.GameHeader.ready((i,l)=>{for(const w of l)this.updateGameHeader(w)}),this.on("site.router:route",i=>{i&&i.name==="dir-game-index"&&this.updateGameHeader()})}updateGameHeader(i){if(i===void 0){for(const w of this.GameHeader.instances)this.updateGameHeader(w);return}this.updateButtons(i);const l=i?.props?.data?.game;this.settings.updateContext({category:l?.name,categoryID:l?.id})}updateButtons(i){const l=this.fine.getChildNode(i);if((0,I.get)("data.game",i.props)==null||!l||!l.querySelector)return;const w=l.querySelector(".ffz-directory-buttons");w&&w.remove();const b=l.querySelector(".directory-header-new__info > div > div + div");if(!b)return;let r,e,a,p;const C=(0,I.get)("data.game.name",i.props)||i.props.directoryName,y=G(()=>{const $=this.settings.provider.get("directory.game.blocked-games",[]),o=$.includes(C);r.classList.toggle("active",o),e.textContent=o?this.i18n.t("directory.unblock","Unblock"):this.i18n.t("directory.block","Block")},"update_block"),z=G(()=>{const $=this.settings.provider.get("directory.game.hidden-thumbnails",[]),o=$.includes(C);a.classList.toggle("active",o),p.textContent=o?this.i18n.t("directory.show-thumbnails","Show Thumbnails"):this.i18n.t("directory.hide-thumbnails","Hide Thumbnails")},"update_hidden");r=(0,B.createElement)("button",{class:"tw-mg-r-1 tw-button ffz-directory-toggle-block",onClick:this.generateClickHandler("directory.game.blocked-games",C,y)},e=(0,B.createElement)("span",{class:"tw-button__text"})),y(),a=(0,B.createElement)("button",{class:"tw-button ffz-directory-toggle-thumbnail",onClick:this.generateClickHandler("directory.game.hidden-thumbnails",C,z)},p=(0,B.createElement)("span",{class:"tw-button__text"})),z(),b.appendChild((0,B.createElement)("div",{class:"tw-mg-t-1 ffz-directory-buttons"},r,a))}generateClickHandler(i,l,w){return b=>{b.preventDefault();const r=this.settings.provider.get(i)||[],e=r.indexOf(l);e===-1?r.push(l):r.splice(e,1),this.settings.provider.set(i,r),this.parent.updateCards(),w()}}};G(S,"Game");let U=S;const D=((s={})=>(s[s.SingleGameList=1]="SingleGameList",s[s.SingleChannelList=2]="SingleChannelList",s[s.MixedGameAndChannelList=3]="MixedGameAndChannelList",s))(),v=["DrugsIntoxication","Gambling","MatureGame","ProfanityVulgarity","SexualThemes","ViolentGraphic"];function f(s,i){return s[0].length&&s[1].push((0,I.addWordSeparators)(s[0].join("|"))),s[1].length?new RegExp(s[1].join("|"),i):null}G(f,"formatTerms");const u=["front-page","dir","dir-community","dir-community-index","dir-creative","dir-following","dir-game-index","dir-game-clips","dir-game-videos","dir-all","dir-category","user-videos","user-clips"],n=class n extends W.default{constructor(...i){super(...i),this.should_enable=!0,this.inject("site"),this.inject("site.elemental"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.css_tweaks"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("settings"),this.inject(U),this.DirectoryCard=this.elemental.define("directory-card",'article[data-a-target^="video-carousel-card-"],article[data-a-target^="followed-vod-"],article[data-a-target^="card-"],div[data-a-target^="video-tower-card-"] article,div[data-a-target^="clips-card-"] article,.shelf-card__impression-wrapper article,.tw-tower div article',u,null,0,0),this.DirectoryExperimentCard=this.elemental.define("directory-experiment-card",".switcher-hopper__scroll-container .tw-tower > div > a",u,null,0,0),this.DirectoryGameCard=this.elemental.define("directory-game-card",".game-card[data-a-id]",u,null,0,0),this.DirectoryShelf=this.fine.define("directory-shelf",l=>l.shouldRenderNode&&l.props&&l.props.shelf,u),this.DirectorySorter=this.fine.define("directory-sorter",l=>l.getSortOptionLink&&l.getSortOptionText&&l.getSortOptionOnClick&&l.getFilterIDs,u),this.settings.add("directory.hidden.style",{default:2,ui:{path:'Directory > Categories >> Hidden Thumbnail Style @{"sort": 100}',title:"Hidden Style",component:"setting-select-box",sort:100,data:[{value:0,title:"Replace Image"},{value:1,title:"Replace Image and Blur Title"},{value:2,title:"Blur Image"},{value:3,title:"Blur Image and Title"}]},changed:l=>{this.css_tweaks.toggle("dir-no-blur",l<2),this.css_tweaks.toggle("dir-blur-title",l===1||l===3)}}),this.settings.add("directory.hide-costream-border",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Hide border on streams with guest stars.",component:"setting-check-box",getExtraTerms:()=>["costream","co-stream"]}}),this.settings.add("directory.hidden.reveal",{default:!1,ui:{path:"Directory > Categories >> Hidden Thumbnail Style",title:"Reveal hidden entries on mouse hover.",component:"setting-check-box",sort:101},changed:l=>this.css_tweaks.toggle("dir-reveal",l)}),this.settings.add("directory.uptime",{default:1,ui:{path:"Directory > Channels >> Appearance",title:"Stream Uptime",description:"Display the stream uptime on the channel cards.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateCards()}),this.settings.add("directory.show-flags",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Display Content Flags on channel cards.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-live",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show the Live indicator on channels that are live.",component:"setting-check-box"},changed:l=>this.css_tweaks.toggleHide("dir-live-ind",l)}),this.settings.add("directory.hide-promoted",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show Promoted streams in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-vodcasts",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show reruns in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-recommended",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Recommended Live Channels` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryShelf.forceUpdate()}),this.settings.add("directory.block-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Username",component:"basic-terms",words:!1}}),this.settings.add("__filter:directory.block-users",{requires:["directory.block-users"],equals:"requirements",process(l){const w=l.get("directory.block-users");if(!w||!w.length)return null;const b=[[],[]];for(const r of w){const e=r.t;let a=r.v;e==="glob"?a=(0,I.glob_to_regex)(a):e!=="raw"&&(a=(0,I.escape_regex)(a)),!(!a||!a.length)&&b[r.s?0:1].push(a)}return[b[0].length?new RegExp(`^(?:${b[0].join("|")})$`):null,b[1].length?new RegExp(`^(?:${b[1].join("|")})$`,"i"):null]},changed:()=>this.updateCards()}),this.settings.add("directory.block-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.block-titles",{requires:["directory.block-titles"],equals:"requirements",process(l){const w=l.get("directory.block-titles");if(!w||!w.length)return null;const b=[[[],[]],[[],[]]];for(const r of w){const e=r.t;let a=r.v;e==="glob"?a=(0,I.glob_to_regex)(a):e!=="raw"&&(a=(0,I.escape_regex)(a)),!(!a||!a.length)&&b[r.s?0:1][r.w?0:1].push(a)}return[f(b[0],"g"),f(b[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blocked-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.blur-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.blur-titles",{requires:["directory.blur-titles"],equals:"requirements",process(l){const w=l.get("directory.blur-titles");if(!w||!w.length)return null;const b=[[[],[]],[[],[]]];for(const r of w){const e=r.t;let a=r.v;e==="glob"?a=(0,I.glob_to_regex)(a):e!=="raw"&&(a=(0,I.escape_regex)(a)),!(!a||!a.length)&&b[r.s?0:1][r.w?0:1].push(a)}return[f(b[0],"g"),f(b[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blur-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.wait-flags",{default:!0,ui:{path:"Directory > Channels >> Appearance",title:"Hide Thumbnails for all channels until Content Flags have been loaded.",description:"We need to load content flags with a separate query, so they aren't immediately available to determine if a given stream should be hidden, or have its thumbnail blurred. This setting will blur ALL thumbnails until after we've finished loading the necessary content flag information, ensuring you don't see a flash of anything you would rather not.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.block-flags",{default:[],type:"array_merge",always_inherit:!0,process(l,w){const b=new Set;for(const r of w){let e=r?.v;e==="ViolentGrpahic"&&(e="ViolentGraphic"),e&&b.add(e)}return b},ui:{path:"Directory > Channels >> Block by Flag",component:"blocked-types",getExtraTerms:()=>[...v],data:()=>[...v].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.blur-flags",{default:[],type:"array_merge",always_inherit:!0,process(l,w){const b=new Set;for(const r of w)r?.v&&b.add(r.v);return b},ui:{path:"Directory > Channels >> Hide Thumbnails by Flag",component:"blocked-types",getExtraTerms:()=>[...v],data:()=>[...v].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.default-sort",{default:!1,ui:{path:"Directory > General >> General",title:"Force Default Sorting",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:"RELEVANCE",title:"Recommended For You"},{value:"VIEWER_COUNT",title:"Viewers (High to Low)"},{value:"VIEWER_COUNT_ASC",title:"Viewers (Low to High)"},{value:"RECENT",title:"Recently Started"}]},changed:()=>this.updateSorting()}),this.routeClick=this.routeClick.bind(this)}onEnable(){this.css_tweaks.toggleHide("profile-hover",this.settings.get("directory.show-channel-avatars")===2),this.css_tweaks.toggleHide("dir-live-ind",this.settings.get("directory.hide-live")),this.css_tweaks.toggle("dir-reveal",this.settings.get("directory.hidden.reveal")),this.settings.getChanges("directory.hide-costream-border",w=>this.css_tweaks.toggle("hide-costream-border",w));const i=this.settings.get("directory.hidden.style");this.css_tweaks.toggle("dir-no-blur",i<2),this.css_tweaks.toggle("dir-blur-title",i===1||i===3),this.on("i18n:update",()=>this.updateCards()),this.DirectoryExperimentCard.on("mount",this.updateExpCard,this),this.DirectoryExperimentCard.on("mutate",this.updateExpCard,this),this.DirectoryExperimentCard.on("unmount",this.clearExpCard,this),this.DirectoryExperimentCard.each(w=>this.updateExpCard(w)),this.DirectoryCard.on("mount",this.updateCard,this),this.DirectoryCard.on("mutate",this.updateCard,this),this.DirectoryCard.on("unmount",this.clearCard,this),this.DirectoryCard.each(w=>this.updateCard(w)),this.DirectoryGameCard.on("mount",this.updateGameCard,this),this.DirectoryGameCard.on("mutate",this.updateGameCard,this),this.DirectoryGameCard.each(w=>this.updateGameCard(w)),this.DirectorySorter.on("mount",this.updateSorting,this),this.DirectorySorter.ready(()=>this.updateSorting());const l=this;this.DirectoryShelf.ready(w=>{const b=w.prototype.shouldRenderNode;w.prototype.shouldRenderNode=function(e,...a){try{let p;if(e.__typename==="Game"?p=e.name:e.game&&(p=e.game.name),p&&l.settings.provider.get("directory.game.blocked-games",[]).includes(p))return!1}catch(p){l.log.capture(p),l.log.error(p)}return b.call(this,e,...a)};const r=w.prototype.render;w.prototype.render=function(){try{if(l.settings.get("directory.hide-recommended")&&(0,I.get)("props.shelf.title.key",this)==="live_recs_following")return null}catch(e){l.log.capture(e)}return r.call(this)},this.DirectoryShelf.forceUpdate()})}updateSorting(i){if(!i){for(const b of this.DirectorySorter.instances)this.updateSorting(b);return}const l=this.settings.get("directory.default-sort");if(!l||l===i.state?.activeOption)return;const w=i.getSortOptionLink(l,!1,i.props);w?.props?.linkTo&&(w.props.onClick&&w.props.onClick(),this.router.push(w.props.linkTo))}updateGameCard(i){const l=this.fine.getReactInstance(i);if(!l)return;const w=l.return?.memoizedProps;if(!w?.trackingProps?.category)return;const b=w.trackingProps.category,r=w.tagListProps?.tags;let e=!1;if(Array.isArray(r)){const C=this.settings.get("directory.blocked-tags",[]);if(C.length){for(const y of r)if(y?.id&&C.includes(y.id)){e=!0;break}}}const a=e||this.settings.provider.get("directory.game.blocked-games",[]).includes(b);let p=i.closest(".tw-tower > div");p||(p=i),p.querySelectorAll('a[data-a-target="tw-box-art-card-link"]').length<2&&p.classList.toggle("tw-hide",a)}updateCards(){this.DirectoryCard.each(i=>this.updateCard(i)),this.DirectoryExperimentCard.each(i=>this.updateExpCard(i)),this.DirectoryGameCard.each(i=>this.updateGameCard(i)),this.DirectoryShelf.forceUpdate(),this.emit(":update-cards")}clearCard(i,l=!1){this.clearUptime(i),this.clearFlags(i);const w=this._getTopRightContainer(i,l);w&&w.remove(),i._ffz_top_right=null}clearExpCard(i){return this.clearCard(i,!0)}updateCard(i){const l=this.fine.searchParentNode(i,b=>b.memoizedProps?.channelLogin);if(!l)return;const w=l.memoizedProps;return this._updateCard(i,!1,w,w.trackingProps)}updateExpCard(i){const l=this.fine.searchParentNode(i,r=>r.memoizedProps?.item?.channelID);if(!l)return;const w=l.memoizedProps,b=w.item;return this._updateCard(i,!0,b,w.tracking)}_updateCard(i,l,w,b){const r=w.categoryName||w.gameTitle||b?.game||b?.categoryName||b?.category,e=w.tags??w.tagListProps?.freeformTags,a=this.settings.get("directory.wait-flags"),p=this.settings.get("directory.show-flags"),C=this.settings.get("directory.blur-flags",[]),y=this.settings.get("directory.block-flags",[]),z=C.size>0||y.size>0,$=p||z;i._ffz_flags===void 0&&$&&(i._ffz_flags=null,w.slug||w.type==="clips"?i._ffz_flags=[]:w.vodID||w.type==="videos"?i._ffz_flags=[]:this.twitch_data.getStreamFlags(w.channelID,w.channelID?null:w.channelLogin).then(R=>{i._ffz_flags=R??[],l?this.updateExpCard(i):this.updateCard(i)}));let o=!1,c=!1;if(Array.isArray(e)){const R=this.settings.get("directory.blocked-tags",[]),P=this.settings.get("directory.blur-tags",[]);if(R.length||P.length)for(const O of e){if(O?.name){const M=O.name.toLowerCase();R.includes(M)&&(o=!0),P.includes(M)&&(c=!0)}if((o||!R.length)&&(c||!P.length))break}}let m=c;if(a&&z&&i._ffz_flags==null&&(m=!0),m||(m=this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(r)),!m&&C.size&&i._ffz_flags){for(const R of i._ffz_flags)if(R?.id&&C.has(R.id)){m=!0;break}}if(!m){const R=this.settings.get("__filter:directory.blur-titles");R&&(R[0]&&(R[0].lastIndex=-1),R[1]&&(R[1].lastIndex=-1),(R[0]&&R[0].test(w.title)||R[1]&&R[1].test(w.title))&&(m=!0))}const A=w.type??w.streamType;i.classList.toggle("ffz-hide-thumbnail",m),i.dataset.ffzType=A;let h=!1;if(o)h=!0;else if(A==="rerun"&&this.settings.get("directory.hide-vodcasts"))h=!0;else if(w.context!=null&&w.context!==D.SingleGameList&&this.settings.provider.get("directory.game.blocked-games",[]).includes(r))h=!0;else if((w.isPromotion||w.sourceType==="COMMUNITY_BOOST"||w.sourceType==="PROMOTION"||w.sourceType==="SPONSORED")&&this.settings.get("directory.hide-promoted"))h=!0;else{if(y.size&&i._ffz_flags){for(const R of i._ffz_flags)if(R?.id&&y.has(R.id)){h=!0;break}}if(!h){const R=this.settings.get("__filter:directory.block-users");R&&(R[0]&&(R[0].lastIndex=-1),R[1]&&(R[1].lastIndex=-1),(R[0]&&R[0].test(w.channelLogin)||R[1]&&R[1].test(w.channelLogin))&&(h=!0))}if(!h){const R=this.settings.get("__filter:directory.block-titles");R&&(R[0]&&(R[0].lastIndex=-1),R[1]&&(R[1].lastIndex=-1),(R[0]&&R[0].test(w.title)||R[1]&&R[1].test(w.title))&&(h=!0))}}let T=i.closest(".tw-tower > div");T||(T=i),T.querySelectorAll(".tw-aspect .tw-image:not(.tw-image-avatar)").length<2&&T.classList.toggle("tw-hide",h),this.updateUptime(i,w,l),this.updateFlags(i,l)}updateFlags(i,l=!1){if(!document.contains(i))return this.clearFlags(i);if(!this.settings.get("directory.show-flags")||!i._ffz_flags?.length)return this.clearFlags(i);const b=this._getTopRightContainer(i,!0,l);if(!b)return this.clearFlags(i);i.ffz_flags_el?i.contains(i.ffz_flags_el)||b.appendChild(i.ffz_flags_el):b.appendChild(i.ffz_flags_el=(0,B.createElement)("div",{class:"tw-mg-y-05 ffz-flags-element tw-relative ffz-il-tooltip__container"},(0,B.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,B.createElement)("figure",{class:"ffz-i-flag"})),i.ffz_flags_tt=(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--pre ffz-il-tooltip--down ffz-il-tooltip--align-right"}))),i.ffz_flags_tt.textContent=this.i18n.t("metadata.flags.tooltip","Intended for certain audiences. May contain:")+`

`+i._ffz_flags.map(r=>r.localizedName).join(`
`)}clearFlags(i){i.ffz_flags_el&&(i.ffz_flags_el.remove(),i.ffz_flags_tt=null,i.ffz_flags_el=null)}_getTopRightContainer(i,l=!0,w=!1){let b=i._ffz_top_right??i.querySelector(".ffz-top-right");if(b||!l)return b;let r=w?i.querySelector(".tw-aspect .tw-image"):i.querySelector('a[data-a-target="preview-card-image-link"] > div');return r&&w&&(r=r.parentElement?.parentElement),r?(b=(0,B.createElement)("div",{"data-test-selector":"top-right-selector",class:"tw-absolute tw-mg-1 tw-right-0 tw-top-0 ffz-top-right tw-flex tw-flex-column tw-align-items-end"}),i._ffz_top_right=b,r.appendChild(b),b):null}updateUptime(i,l,w=!1){if(!document.contains(i))return this.clearUptime(i);const b=this.settings.get("directory.uptime"),r=this._getTopRightContainer(i,b>0,w);if(!r||b===0||l.viewCount||l.animatedImageProps||l.type==="videos"||l.type==="clips")return this.clearUptime(i);let e=l.createdAt;e||(i.ffz_stream_meta===void 0&&(i.ffz_stream_meta=null,this.twitch_data.getStreamMeta(null,l.channelLogin).then(y=>{i.ffz_stream_meta=y,this.updateUptime(i,l,w)})),e=i.ffz_stream_meta?.createdAt);const a=e&&new Date(e),p=a&&Math.floor((Date.now()-a)/1e3)||0;if(p<1)return this.clearUptime(i);const C=(0,L.duration_to_string)(p,!1,!1,!1,b===1);if(i.ffz_uptime_el||(i.ffz_uptime_el=r.querySelector(".ffz-uptime-element")),i.ffz_uptime_el?i.contains(i.ffz_uptime_el)||r.appendChild(i.ffz_uptime_el):r.appendChild(i.ffz_uptime_el=(0,B.createElement)("div",{class:"ffz-uptime-element tw-relative ffz-il-tooltip__container"},(0,B.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,B.createElement)("div",{class:"tw-flex tw-c-text-live"},(0,B.createElement)("figure",{class:"ffz-i-clock"})),i.ffz_uptime_span=(0,B.createElement)("p",null)),(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-right"},this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),i.ffz_uptime_tt=(0,B.createElement)("div",{class:"tw-pd-t-05"})))),i.ffz_uptime_span||(i.ffz_uptime_span=i.ffz_uptime_el.querySelector("p")),!i.ffz_uptime_span)return this.clearUptime(i);if(i.ffz_uptime_tt||(i.ffz_uptime_tt=i.ffz_uptime_el.querySelector(".ffz-il-tooltip > div")),!i.ffz_uptime_tt)return this.clearUptime(i);i.ffz_update_timer||(i.ffz_update_timer=setInterval(this.updateUptime.bind(this,i,l,w),1e3)),i.ffz_uptime_span.textContent=C,i.ffz_last_created_at!==e&&(i.ffz_uptime_tt.textContent=this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:a}),i.ffz_last_created_at=e)}clearUptime(i){i.ffz_update_timer&&(clearInterval(i.ffz_update_timer),i.ffz_update_timer=null),i.ffz_uptime_el&&(i.ffz_uptime_el.remove(),i.ffz_uptime_el=null,i.ffz_uptime_span=null,i.ffz_uptime_tt=null,i.ffz_last_created_at=null)}routeClick(i,l){if(i.preventDefault(),i.stopPropagation(),!l){const w=i.currentTarget;if(w){const b=w.dataset;b&&b.href?l=b.href:w.href&&(l=w.href)}}l&&this.router.push(l)}hijackUserClick(i,l,w=null){i.preventDefault(),i.stopPropagation(),w&&w(i,l),this.router.navigate("user",{userName:l})}};G(n,"Directory");let g=n},68318:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>D});var W=d(24431),L=d(22527),B=d(46949);const I=["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],U=["popout","embed-chat","dash-chat"],v=class v extends L.default{constructor(...u){super(...u),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.ResizeDetector=this.fine.define("resize-detector",g=>g.maybeDebounceOnScroll&&g.setGrowDivRef&&g.props.onResize),this.SideBar=this.elemental.define("sidebar",".side-bar-contents",null,{childNodes:!0,subtree:!0},1),this.settings.add("clips.layout.big",{default:!1,ui:{path:"Appearance > Layout >> Clips",title:"Allow the player to get larger on `clips.twitch.tv` pages.",description:"This only affects windows at least 1,200 pixels wide and attempts to make the player and chat replay as large as possible.",component:"setting-check-box"}}),this.settings.add("layout.portrait",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"Enable Portrait Mode",description:"In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.",component:"setting-check-box"}}),this.settings.add("layout.portrait-invert",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"When in portrait mode, place chat at the top.",component:"setting-check-box"},changed:g=>document.body.classList.toggle("ffz--portrait-invert",g)}),this.settings.add("layout.portrait-threshold",{default:1.25,ui:{path:"Appearance > Layout >> Channel",title:"Portrait Mode Threshold",description:"This is the Width to Height ratio at which point Portrait Mode will begin to activate.",component:"setting-text-box",process(g){return g=parseFloat(g,10),isNaN(g)||!isFinite(g)||g<=0?1.25:g}}}),this.settings.add("layout.portrait-min-chat",{default:!1,requires:["layout.use-portrait"],process(g,S){return g.get("layout.use-portrait")?S:!1},ui:{path:"Appearance > Layout >> Channel",title:"Use compact chat in Portrait Mode.",description:"When enabled, this minimizes the chat header and places the chat input box in line with the chat buttons in order to present a more compact chat able to display more lines with limited vertical space.",component:"setting-check-box"}}),this.settings.add("layout.use-portrait",{requires:["layout.portrait","layout.portrait-threshold","context.route.name","context.size","context.isWatchParty"],process(g){if(g.get("context.isWatchParty"))return!1;const S=g.get("context.size");return!S||!g.get("layout.portrait")||!I.includes(g.get("context.route.name"))?!1:S.width/S.height<=g.get("layout.portrait-threshold")},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.inject-portrait",{requires:["layout.use-portrait","context.ui.rightColumnExpanded"],process(g){return g.get("layout.use-portrait")&&g.get("context.ui.rightColumnExpanded")}}),this.settings.add("layout.fix-player-size",{requires:["layout.inject-portrait","chat.use-width","layout.swap-sidebars"],process(g){return g.get("layout.inject-portrait")||g.get("chat.use-width")||g.get("layout.swap-sidebars")}}),this.settings.add("layout.use-portrait-swapped",{requires:["layout.inject-portrait","layout.swap-sidebars"],process(g){return g.get("layout.inject-portrait")&&g.get("layout.swap-sidebars")}}),this.settings.add("layout.use-portrait-meta",{requires:["layout.inject-portrait","player.theatre.metadata"],process(g){return g.get("layout.inject-portrait")&&g.get("player.theatre.metadata")}}),this.settings.add("layout.use-portrait-meta-top",{requires:["layout.use-portrait-meta","layout.portrait-invert"],process(g){return g.get("layout.use-portrait-meta")&&!g.get("layout.portrait-invert")}}),this.settings.add("layout.is-theater-mode",{requires:["context.ui.theatreModeEnabled","context.fullscreen"],process(g){return g.get("context.fullscreen")?!1:g.get("context.ui.theatreModeEnabled")}}),this.settings.add("layout.show-portrait-chat",{requires:["layout.use-portrait","layout.portrait-extra-height","layout.portrait-extra-width"],process(){return!0},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.portrait-extra-height",{requires:["context.new_channel","context.squad_bar","layout.is-theater-mode","player.theatre.no-whispers","whispers.show","layout.minimal-navigation"],process(g){let S=0;return g.get("layout.is-theater-mode")?(g.get("layout.minimal-navigation")&&(S+=1),g.get("whispers.show")&&!g.get("player.theatre.no-whispers")&&(S+=4)):(S=g.get("layout.minimal-navigation")?1:5,g.get("whispers.show")&&(S+=4),g.get("context.squad_bar")&&(S+=6),S+=g.get("context.new_channel")?1:5),S}}),this.settings.add("layout.portrait-extra-width",{require:["layout.side-nav.show","layout.is-theater-mode","context.ui.sideNavExpanded"],process(g){return!g.get("layout.side-nav.show")||g.get("layout.is-theater-mode")?0:g.get("context.ui.sideNavExpanded")?24:5}}),this.settings.add("layout.is-minimal",{require:["context.route.name"],process(g){return U.includes(g.get("context.route.name"))}})}onEnable(){document.body.classList.toggle("ffz--portrait-invert",this.settings.get("layout.portrait-invert")),this.on(":update-nav",this.updateNavLinks,this),this.on(":resize",this.handleResize,this),this.settings.getChanges("layout.portrait-min-chat",u=>this.css_tweaks.toggle("portrait-chat",u)),this.settings.getChanges("layout.inject-portrait",u=>this.css_tweaks.toggle("portrait",u)),this.settings.getChanges("layout.use-portrait-swapped",u=>this.css_tweaks.toggle("portrait-swapped",u)),this.settings.getChanges("layout.use-portrait-meta",u=>this.css_tweaks.toggle("portrait-metadata",u)),this.settings.getChanges("layout.use-portrait-meta-top",u=>this.css_tweaks.toggle("portrait-metadata-top",u)),this.settings.getChanges("layout.portrait-extra-width",u=>this.css_tweaks.setVariable("portrait-extra-width",`${u}rem`)),this.settings.getChanges("layout.portrait-extra-height",u=>this.css_tweaks.setVariable("portrait-extra-height",`${u}rem`)),this.settings.getChanges("layout.fix-player-size",u=>this.css_tweaks.toggle("player-size",u)),this.on("site.directory:update-cards",()=>{this.SideBar.each(u=>this._updateSidebar(u))}),this.ResizeDetector.ready(()=>{this._needs_resize&&(this._needs_resize=!1,this.handleResize())}),this.SideBar.on("mount",this.updateSidebar,this),this.SideBar.on("mutate",this.updateSidebar,this),this.SideBar.each(u=>this.updateSidebar(u))}handleResize(){this._resize_timer||(this._resize_timer=setTimeout(()=>this._handleResize(),W.IS_FIREFOX?500:100))}_handleResize(){if(clearTimeout(this._resize_timer),this._resize_timer=null,!this.ResizeDetector.instances.size)this._needs_resize=!0;else{for(const u of this.ResizeDetector.instances)u?.onScroll?.();this.emit("site.player:fix-player")}}get is_minimal(){return this.settings.get("layout.is-minimal")}updateSidebar(u){u&&(u._ffz_update||(u._ffz_update=(0,B.debounce)(()=>requestAnimationFrame(()=>this._updateSidebar(u)),1e3,2)),u._ffz_update())}_updateSidebar(u){if(!u)return;const g=u.querySelectorAll(".side-nav-card"),S=this.settings.provider.get("directory.game.blocked-games",[]);for(const n of g){const s=this.fine.getReactInstance(n),i=s?.return?.return?.memoizedProps,l=i?.metadataRight?.props?.stream,w=l?.type==="rerun",b=l?.game?.displayName,r=i?.offline??!1;let e=!1;if(b&&S.includes(b)&&(e=!0),i?.isPromoted&&this.settings.get("directory.hide-promoted"))e=!0;else{if(!e){const a=this.settings.get("__filter:directory.block-users"),p=i?.userLogin;a&&p&&(a[0]&&(a[0].lastIndex=-1),a[1]&&(a[1].lastIndex=-1),(a[0]&&a[0].test(p)||a[1]&&a[1].test(p))&&(e=!0))}if(!e){const a=this.settings.get("__filter:directory.block-titles"),p=l?.broadcaster?.broadcastSettings?.title;a&&p&&(a[0]&&(a[0].lastIndex=-1),a[1]&&(a[1].lastIndex=-1),(a[0]&&a[0].test(p)||a[1]&&a[1].test(p))&&(e=!0))}}n.classList.toggle("ffz--side-nav-card-rerun",w),n.classList.toggle("ffz--side-nav-card-offline",r),n.classList.toggle("tw-hide",e)}}updateNavLinks(){}updatePortraitMode(){}};G(v,"Layout");let D=v},29333:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>D});var W=d(24431),L=d(22527),B=d(44589),I=d(43874),U=d(6170);const v=class v extends L.default{constructor(...u){super(...u),this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.elemental"),this.pauseToasts=this.pauseToasts.bind(this),this.unpauseToasts=this.unpauseToasts.bind(this),this.should_enable=!0,this._pill_content=null,this._has_update=!1,this._important_update=!1,this._new_settings=0,this._loading=!1,this.toasts=[],this.settings.add("ffz.show-new-settings",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.",component:"setting-check-box"},changed:()=>this.update()}),this.ModBar=this.fine.define("mod-view-bar",g=>g.actions&&g.updateRoot&&g.childContext,["mod-view"]),this.SunlightNav=this.elemental.define("sunlight-nav",".sunlight-top-nav > div > div > div > div:last-child > div",I.Z.SUNLIGHT_ROUTES,{attributes:!0},1),this.NavBar=this.fine.define("nav-bar",g=>g.renderOnsiteNotifications&&g.renderTwitchPrimeCrown),this.SquadBar=this.fine.define("squad-nav-bar",g=>g.exitSquadMode&&g.props&&g.props.squadID,["squad"]),this.MultiController=this.fine.define("multi-controller",g=>g.handleAddStream&&g.handleRemoveStream&&g.getInitialStreamLayout,["command-center"])}get loading(){return this._loading}set loading(u){u!==this._loading&&(this._loading=u,this.update())}get new_settings(){return this._new_settings}set new_settings(u){u!==this._new_settings&&(this._new_settings=u,this.update())}get has_new(){return this.settings.get("ffz.show-new-settings")&&this._new_settings>0}get important_update(){return this._important_update}set important_update(u){this._important_update=!1,this.update()}get has_update(){return this._has_update}get has_strings(){return this.i18n.new_strings>0||this.i18n.changed_strings>0}set has_update(u){u&&!this._has_update&&(this._important_update=!0),this._has_update=u,this.update()}get pill(){return this._pill_content}set pill(u){this._pill_content=u,this.update()}formatPill(){const u=this._pill_content;return typeof u=="number"?this.i18n.formatNumber(u):u==null&&this.has_new?this.i18n.formatNumber(this._new_settings):u}formatExtraPill(){if(this.has_update)return null;if(this.settings.disable_profiles)return(0,B.createElement)("figure",{class:"ffz-i-cog"});if(this.has_strings)return this.i18n.formatNumber(this.i18n.new_strings+this.i18n.changed_strings);const u=this.resolve("addons");return W.DEBUG&&u.has_dev?this.i18n.t("site.menu_button.dev","dev"):W.DEBUG&&!u.has_dev?this.i18n.t("site.menu_button.main-dev","m-dev"):!W.DEBUG&&u.has_dev?this.i18n.t("site.menu_button.addon-dev","a-dev"):null}updateToasts(){requestAnimationFrame(()=>this._updateToasts())}_updateToasts(){for(const u of this.NavBar.instances)this.updateButtonToast(u);for(const u of this.SquadBar.instances)this.updateButtonToast(u);for(const u of this.MultiController.instances)this.updateButtonToast(u);for(const u of this.SunlightNav.instances)this.updateButtonToast(null,u,!0);for(const u of this.ModBar.instances)this.updateButtonToast(u)}update(){requestAnimationFrame(()=>this._update())}_update(){for(const u of this.NavBar.instances)this.updateButton(u);for(const u of this.SquadBar.instances)this.updateButton(u);for(const u of this.MultiController.instances)this.updateButton(u);for(const u of this.SunlightNav.instances)this.updateButton(null,u,!0);for(const u of this.ModBar.instances)this.updateButton(u)}onEnable(){this.NavBar.ready(()=>this.update()),this.NavBar.on("mount",this.updateButton,this),this.NavBar.on("update",this.updateButton,this),this.SquadBar.ready(()=>this.update()),this.SquadBar.on("mount",this.updateButton,this),this.SquadBar.on("update",this.updateButton,this),this.MultiController.ready(()=>this.update()),this.MultiController.on("mount",this.updateButton,this),this.MultiController.on("update",this.updateButton,this),this.SunlightNav.on("mount",u=>this.updateButton(null,u,!0)),this.SunlightNav.on("mutate",u=>this.updateButton(null,u,!0)),this.SunlightNav.each(u=>this.updateButton(null,u,!0)),this.ModBar.ready(()=>this.update()),this.ModBar.on("mount",this.updateButton,this),this.ModBar.on("update",this.updateButton,this),this.on(":clicked",()=>this.important_update=!1),this.once(":clicked",this.loadMenu),this.on("i18n:new-strings",this.update),this.on("i18n:changed-strings",this.update),this.on("i18n:update",this.update),this.on("addons:data-loaded",this.update),this.once("settings:quota-exceeded",()=>{this.addError("site.menu_button.quota-exceeded","Your local storage space for this website is full, and settings cannot be saved. Please backup your settings and switch to a higher capacity provider in [Data Management > Storage >> Provider](~data_management.storage.tabs.provider).","ffz-i-attention",!0),this.update()}),this.on("settings:change-provider",()=>{this.addError("site.menu_button.changed","The FrankerFaceZ settings provider has changed. Please refresh this tab to avoid strange behavior."),this.update()})}addError(u,g,S="ffz-i-attention",n=!1){this.addToast({icon:S,text_i18n:u,text:g,markdown:n})}addToast(u){if(u.markdown&&!(0,U.e)())return(0,U.Z)().then(()=>this.addToast(u));this.toasts.push(u),!(this.toasts.length>5)&&this.updateToasts()}pauseToasts(){const u=Math.min(5,this.toasts.length),g=performance.now();this._toasts_paused=!0;for(let S=0;S<u;S++){const n=this.toasts[S];if(!n||!n.started)continue;n._timer&&(clearTimeout(n._timer),n._timer=null);const s=g-n.started,i=n.timeout-s;n.remaining=i,n.percentage=100*i/n.timeout,n.el&&n.el.replaceWith(this.renderToast(n))}}unpauseToasts(){const u=Math.min(5,this.toasts.length),g=performance.now();this._toasts_paused=!1;for(let S=0;S<u;S++){const n=this.toasts[S];if(!(!n||!n.started)){if(n.remaining){const s=n.timeout-n.remaining;n.started=g-s}n.el&&n.el.replaceWith(this.renderToast(n))}}}renderToasts(){const u=Math.min(5,this.toasts.length);if(!u)return null;const g=[];for(let S=0;S<u;S++)g.push(this.renderToast(this.toasts[S]));return g}renderToast(u){u._remove||(u._remove=()=>{u._timer&&(clearTimeout(u._timer),u._timer=null),u.el=null;const n=this.toasts.indexOf(u);n!==-1&&(this.toasts.splice(n,1),this.toasts.length||(this._toasts_paused=!1),this.updateToasts())});let g=null;const S=u.markdown?(0,U.e)():null;if(u.markdown&&!S)return null;if(u.timeout){const n=performance.now();u.started||(u.started=n);const s=n-u.started,i=u.timeout-s;let l;this._toasts_paused?l=u.percentage:u._timer||(u._timer=setTimeout(u._remove,i)),l==null&&(l=u.percentage=100*i/u.timeout),g=(0,B.createElement)("div",{class:"ffz-toast--progress tw-absolute tw-overflow-hidden tw-z-below"},(0,B.createElement)("div",{class:"tw-border-radius-rounded ffz-progress-bar ffz-progress-bar--countdown ffz-progress-bar--default ffz-progress-bar--mask",role:"progressbar","aria-valuenow":l,"aria-valuemin":"0","aria-valuemax":"100"},(0,B.createElement)("div",{class:"tw-block tw-border-bottom-left-radius-rounded tw-border-top-left-radius-rounded ffz-progress-bar__fill","data-a-target":"tw-progress-bar-animation",style:{width:`${l}%`,"animation-duration":`${i/1e3}s`}})))}return u.el=(0,B.createElement)("div",{class:`ffz-toast ffz-balloon ffz-balloon--lg tw-mg-y-1${this._toasts_paused?" ffz-toast--paused":""}`},(0,B.createElement)("div",{class:"tw-pd-1 tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-relative"},(0,B.createElement)("div",{class:"tw-flex tw-align-items-start"},u.icon&&(typeof u.icon=="string"?(0,B.createElement)("figure",{class:`tw-font-size-3 tw-pd-r-1 ${u.icon}`}):u.icon),u.render?u.render.call(this,u):null,u.title||u.text?(0,B.createElement)("div",{class:"tw-flex-grow-1"},u.title?(0,B.createElement)("header",{class:"tw-semibold tw-font-size-3 tw-pd-b-05"},u.title_i18n?this.i18n.tList(u.title_i18n,u.title,u):u.title):null,u.text?(0,B.createElement)("span",{class:`${u.lines?"ffz--line-clamp":""}`,style:{"--ffz-lines":u.lines}},u.markdown?(0,B.createElement)("span",{dangerouslySetInnerHTML:{__html:(0,U.e)().render(u.text_i18n?this.i18n.t(u.text_i18n,u.text,u):u.text)}}):null,u.markdown?null:u.text_i18n?this.i18n.tList(u.text_i18n,u.text,u):u.text):null):null,!u.unclosable&&(0,B.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:u._remove},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-cancel"})))),g)),u.el}updateButtonToast(u,g,S){const n=(u||g)._ffz_toast_el;if(n){n.innerHTML="",(0,B.setChildren)(n,this.renderToasts(),!1,!0);return}this.updateButton(u,g,S)}updateButton(u,g,S){const n=this.fine.getChildNode(u);let s=!1,i=!1;if(g||(g=n&&n.querySelector(".top-nav__menu")),g||(n&&n.classList.contains("squad-stream-top-bar__container")?g=n:g=n&&n.querySelector(".squad-stream-top-bar__container"),g&&(s=!0)),!g&&u.handleAddStream&&(g=this.fine.searchTree(u,p=>p.classList&&p.classList.contains("multiview-stream-page__header")),g&&(s=!0)),!g&&u.getIsAdsEnabled&&(g=n&&n.querySelector(".sunlight-top-nav > .tw-flex > .tw-flex > .tw-justify-content-end > .tw-flex"),g&&(S=!0)),!g&&u.childContext&&(g=n&&n.querySelector(".modview-dock > div:last-child"),g&&(i=!0)),!g)return;if(!s&&!i&&!S){let p=null;try{p=g.querySelector(":scope > .tw-justify-content-end:last-child")}catch{}p?g=p:g=g.lastElementChild}let l,w=g.querySelector(".ffz-top-nav");w&&w.remove();const b=this.resolve("addons"),r=this.renderToasts(),e=this.formatPill(),a=this.formatExtraPill();if(w=(0,B.createElement)("div",{class:`ffz-top-nav ${i?"ffz-mod-view-button tw-relative tw-mg-b-1":`tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative ${S?"tw-mg-l-05 tw-mg-r-2":"tw-mg-x-05"}`}`},(0,B.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},l=(0,B.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.loading?" loading":""}`,onClick:p=>this.handleClick(p,l),onContextMenu:p=>this.renderContext(p,l)},(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-zreknarf"})))),this.has_error&&(0,B.createElement)("div",{class:`tw-absolute ffz-balloon ffz-balloon--lg tw-block ${i?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},(0,B.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1"},(0,B.createElement)("div",{class:"tw-flex tw-align-items-center"},(0,B.createElement)("div",{class:"tw-flex-grow-1"},this.error.i18n?this.i18n.t(this.error.i18n,this.error.text):this.error.text),this.error.permanent?null:(0,B.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:()=>this.error=null},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-cancel"})))))),(0,B.createElement)("div",{class:`ffz-il-tooltip ${i?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},this.i18n.t("site.menu_button","FrankerFaceZ Control Center"),this.has_update&&(0,B.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.update-desc","There is an update available. Please refresh your page.")),this.settings.disable_profiles&&(0,B.createElement)("div",{class:"tw-mg-t-1"},this.i18n.tList("site.menu_button.no-settings",'Settings are disabled in this tab due to the inclusion of "{param}" in the URL.',{param:(0,B.createElement)("code",{class:"ffz-monospace"},"?ffz-no-settings")})),this._new_settings>0&&(0,B.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.new-desc","There {count,plural,one {is one new setting} other {are # new settings}}.",{count:this._new_settings})),this.has_strings&&(0,B.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.strings","There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.",{added:this.i18n.new_strings,changed:this.i18n.changed_strings})),W.DEBUG&&(0,B.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.main-dev-desc","You are running a developer build of FrankerFaceZ.")),b.has_dev&&(0,B.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.addon-dev-desc","You have loaded add-on data from a local development server.")))),(u||g)._ffz_toast_el=(0,B.createElement)("div",{class:`ffz-toast--container tw-absolute tw-block ${i?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`,onmouseenter:this.pauseToasts,onmouseleave:this.unpauseToasts},r),this.has_update&&(0,B.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,B.createElement)("div",{class:`tw-pill ${this.important_update?"tw-pill--notification":""}`},(0,B.createElement)("figure",{class:"ffz-i-arrows-cw"}))),a&&(0,B.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,B.createElement)("div",{class:"tw-pill"},a)),e&&(0,B.createElement)("div",{class:"ffz-menu__pill tw-absolute"},(0,B.createElement)("div",{class:"tw-pill"},e))),i)g.insertBefore(w,g.firstElementChild);else{let p=g.lastElementChild;p&&p.classList.contains("resize-detector")&&(p=p.previousElementSibling),p?g.insertBefore(w,p):g.appendChild(w)}this._ctx_open&&this.renderContext(null,l)}handleClick(u,g){if(u.shiftKey)return W.DEBUG&&u.ctrlKey?requestAnimationFrame(()=>this.i18n.openUI()):this.resolve("main_menu").openPopout();this.emit(":clicked",u,g)}renderButtonIcon(u){const g=this.settings.main_context.hasProfile(u);return(0,B.createElement)("figure",{class:`ffz--profile__icon ${g?"ffz-i-ok":u.toggled?"ffz-i-minus":"ffz-i-cancel"}`})}renderButtonTip(u){return u.toggled?this.settings.main_context.hasProfile(u)?this.i18n.t("setting.profiles.active","This profile is enabled and active."):this.i18n.t("setting.profiles.disabled.rules","This profile is enabled, but inactive due to its rules."):this.i18n.t("setting.profiles.disabled","This profile is disabled.")}renderContext(u,g){if(u){if(u.shiftKey||u.ctrlKey)return;u.preventDefault()}const S=g.parentElement.parentElement,n=S.classList.contains("ffz-mod-view-button");let s=S.querySelector(".ffz--menu-context");if(s)if(s._ffz_destroy)s._ffz_destroy();else return;const i=G(()=>{this._ctx_open=!1,s._ffz_outside&&s._ffz_outside.destroy(),s.remove()},"destroy"),l=[];for(const w of this.settings.__profiles){const b=(0,B.createElement)("button",{class:"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-title":this.renderButtonTip(w),onClick:e=>{w.toggled=!w.toggled,(0,B.setChildren)(b,this.renderButtonIcon(w)),b.dataset.title=this.renderButtonTip(w),b._ffz_tooltip?.rerender&&b._ffz_tooltip.rerender(),this.emit("tooltips:cleanup"),e.preventDefault(),e.stopPropagation()}},this.renderButtonIcon(w)),r=w.desc_i18n_key||w.i18n_key&&`${w.i18n_key}.description`;l.push((0,B.createElement)("div",{class:"tw-relative tw-border-b tw-pd-y-05 tw-pd-x-1 tw-flex"},b,(0,B.createElement)("div",null,(0,B.createElement)("h4",null,w.i18n_key?this.i18n.t(w.i18n_key,w.name,w):w.name,w.ephemeral&&(0,B.createElement)("div",{class:"tw-inline tw-mg-l-05 ffz-il-tooltip__container ffz--profile-row__icon ffz-i-user-secret tw-relative"},(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.ephemeral","This profile is ephemeral.")))),w.description&&(0,B.createElement)("div",{class:"description"},r?this.i18n.t(r,w.description,w):w.description))))}s=(0,B.createElement)("div",{class:`tw-absolute ffz-attached ${n?"ffz-attached--up ffz-attached--left":"ffz-attached--down ffz-attached--right"}`},(0,B.createElement)("div",{class:"ffz-balloon ffz-balloon--lg tw-block ffz--menu-context"},(0,B.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4"},(0,B.createElement)("div",{class:"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header"},(0,B.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left"},(0,B.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onDblClick:()=>{this.emit("site.player:reset"),i()}},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-t-reset"}))),(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-left"},this.i18n.t("player.reset_button.all","Reset All Players (Double-Click)")))),(0,B.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center"},(0,B.createElement)("h5",{class:"tw-align-center tw-c-text-alt tw-semibold"},this.i18n.t("site.menu_button.profiles","Profiles"))),(0,B.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,B.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onClick:w=>{this.openSettings(w,g),i()}},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-cog"}))),(0,B.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.configure","Configure")))),(0,B.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,B.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",onClick:i},(0,B.createElement)("span",{class:"tw-button-icon__icon"},(0,B.createElement)("figure",{class:"ffz-i-cancel"}))))),(0,B.createElement)("div",{class:"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},l)))),s._ffz_destroy=i,s._ffz_outside=new B.ClickOutside(s,i),S.appendChild(s),this._ctx_open=!0}openSettings(u,g){const S=this.resolve("main_menu");S&&(S.requestPage("data_management.profiles"),!S.showing&&this.emit(":clicked",u,g))}loadMenu(u,g,S){const n=this.resolve("main_menu");n&&(S&&n.requestPage(S),!n.showing&&(this.loading=!0,n.enable(u).then(()=>{this.loading=!1}).catch(s=>{this.log.capture(s),this.log.error("Error enabling main menu.",s),this.addError("site.menu_button.error","There was an error loading the FFZ Control Center. Please refresh and try again."),this.loading=!1,this.once(":clicked",this.loadMenu)})))}onDisable(){this.off("i18n:update",this.update),this.off(":clicked",this.loadMenu)}};G(v,"MenuButton");let D=v},94296:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>B});var W=d(22527),L=d(46949);const I=class I extends W.default{constructor(...D){super(...D),this.inject("i18n"),this.inject("settings"),this.inject("site.channel"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.inject("site.elemental"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.should_enable=!0,this._cached_color=null,this._cached_channel=null,this._cached_id=null,this.Root=this.elemental.define("mod-view-root",".moderation-view-page",["mod-view"],{attributes:!0},1),this.ModInfoBar=this.elemental.define("mod-info-bar",".modview-player-widget__stream-info .simplebar-content",["mod-view"],{childNodes:!0,subtree:!0},1,3e4,!1),this.checkRoot=(0,L.debounce)(this.checkRoot,250),this.checkBar=(0,L.debounce)(this.checkBar,250)}onEnable(){this.Root.on("mount",this.updateRoot,this),this.Root.on("mutate",this.updateRoot,this),this.Root.on("unmount",this.removeRoot,this),this.Root.each(D=>this.updateRoot(D)),this.ModInfoBar.on("mount",this.updateBar,this),this.ModInfoBar.on("mutate",this.updateBar,this),this.ModInfoBar.on("unmount",this.removeBar,this),this.ModInfoBar.each(D=>this.updateBar(D)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}updateSubscription(D,v){this._subbed_login===v&&this._subbed_id===D||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),D&&(this.pubsub.subscribe(this,`twitch/${D}`),this._subbed_id=D),v&&(this.socket.subscribe(this,`channel.${v}`),this._subbed_login=v))}checkNavigation(){this.router.current_name==="mod-view"&&(this.channel.updateChannelColor(this._cached_color),this.checkRoot())}checkBar(){this.ModInfoBar.clean()}checkRoot(){this.Root.each(D=>this.updateRoot(D))}updateRoot(D){const v=this.fine.getReactInstance(D);let f=null,u=this.fine.searchNode(v,g=>{let S=0,n=g.memoizedState;for(;n!=null&&f==null&&S<50;)f=n?.memoizedState?.current?.result?.data?.user??n?.memoizedState?.current?.previousData?.user,(!f?.id||!f?.login)&&(f=null),n=n?.next,S++;if(f)return!0});f?.id?this._cached_id!=f.id&&(this._cached_id=f.id,this._cached_channel=f,this._cached_color=null,this.updateSubscription(f.id,f.login),this.getChannelColor(D,f.id).then(g=>{this._cached_id==f.id&&(this._cached_color=g,this.channel.updateChannelColor(g),this.settings.updateContext({channelColor:g}))}).catch(()=>{this._cached_id==f.id&&(this._cached_color=null,this.channel.updateChannelColor(),this.settings.updateContext({channelColor:null}))}),this.settings.updateContext({channel:f.login,channelID:f.id})):this.removeRoot()}getChannelColor(D,v,f){const u=D._ffz_color_cache=D._ffz_color_cache||{};return v===u.channel_id&&Date.now()-u.saved<6e4?f?u.data:Promise.resolve(u.data):new Promise(async(g,S)=>{if(u.updating){u.updating.push([g,S]);return}u.channel_id=v,u.updating=[[g,S]];let n,s;try{n=await this.twitch_data.getChannelColor(v)}catch(l){n=null,s=l}const i=u.updating;if(u.updating=null,u.channel_id!==v){s=new Error("Outdated"),u.channel_id=null,u.data=null,u.saved=0;for(const l of i)l[1](s);return}u.data=n,u.saved=Date.now();for(const l of i)s?l[1](s):l[0](n)})}removeRoot(){this._cached_id=null,this._cached_channel=null,this._cached_color=null,this.updateSubscription(),this.channel.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateBar(D){const v=D.closest(".modview-player-widget__stream-info"),f=v&&this.fine.getReactInstance(v);let u=null,g=f?.return?.memoizedState,S=0;for(;g!=null&&u==null&&S<50;)u=g?.memoizedState?.current?.result?.data?.channel??g?.memoizedState?.current?.previousData?.channel,g=g?.next,S++;const n=u?.lastBroadcast,s=n?.title,i=n?.game;if(this._cached_bar_id!=u?.id&&(this._cached_bar_id=u?.id,this._cached_bar_channel=u),(s!=D._cached_title||i?.id!=D._cached_game)&&(D._cached_title=s,D._cached_game=i?.id,this.settings.updateContext({category:i?.name,categoryID:i?.id,title:s})),v){if(!v._ffz_cont){const l=v._ffz_cont=v.querySelector(".modview-player-widget__viewcount");l&&l.classList.add("ffz--mod-tray")}this.updateMetadata(v)}}removeBar(D){this.settings.updateContext({category:null,categoryID:null,title:null});const v=D.closest(".modview-player-widget__stream-info");if(v){if(v._ffz_cont&&v._ffz_cont.classList.remove("ffz--mod-tray"),v._ffz_cont=null,v._ffz_meta_timers){for(const f of Object.values(v._ffz_meta_timers))clearTimeout(f);v._ffz_meta_timers=null}v._ffz_update=null}}updateMetadata(D,v){const f=D._ffz_cont,u=this._cached_bar_channel;if(!f||!document.contains(f)){this.checkBar();return}if(!u?.id)return;v?Array.isArray(v)||(v=[v]):v=this.metadata.keys;const g=D._ffz_meta_timers=D._ffz_meta_timers||{},S=G(s=>this.updateMetadata(D,s),"refresh_fn"),n={channel:{id:u.id,login:u.login,display_name:u.displayName},el:D,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>null};for(const s of v)this.metadata.definitions[s].modview&&this.metadata.renderLegacy(s,n,f,g,S)}};G(I,"ModView");let B=I},63155:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{PLAYER_ROUTES:()=>L,default:()=>B});var W=d(10789);const L=["front-page","user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following","dash","squad","command-center","dash-stream-manager","mod-view","user-home"],I=class I extends W.Z{constructor(...D){super(...D),this.should_enable=!0,this.inject("site.router"),this.inject("metadata"),this.DataSource=this.fine.define("data-source",v=>v.consentMetadata&&v.onPlaying&&v.props&&v.props.data,L),this.Player=this.fine.define("highwind-player",v=>v.setPlayerActive&&v.props?.playerEvents&&v.props?.mediaPlayerInstance,L),this.TheatreHost=this.fine.define("theatre-host",v=>v.toggleTheatreMode&&v.props&&v.props.onTheatreModeEnabled,["user","user-home","video","user-video","user-clip"]),this.PlayerSource=this.fine.define("player-source",v=>v.setSrc&&v.setInitialPlaybackSettings,L)}repositionPlayer(){if(!this._mover){const D=document.querySelector(".channel-root__player");this._mover=this.fine.searchNode(D,v=>v.memoizedProps?.triggerPlayerReposition,50)}this._mover&&this._mover.memoizedProps.triggerPlayerReposition()}registerSettings(){super.registerSettings(),this.settings.add("player.home.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play featured broadcasters on the front page.",component:"setting-check-box"}}),this.settings.add("player.theatre.no-whispers",{default:!1,requires:["whispers.show"],process(D,v){return D.get("whispers.show")?v:!0},ui:{path:"Player > General >> Theatre Mode",title:"Hide whispers when Theatre Mode is enabled.",component:"setting-check-box"},changed:D=>this.css_tweaks.toggle("theatre-no-whispers",D)}),this.settings.add("player.theatre.metadata",{default:!1,requires:["context.route.name","layout.is-theater-mode"],process(D,v){return!D.get("layout.is-theater-mode")||D.get("context.route.name")==="video"?!1:v},ui:{path:"Player > General >> Theatre Mode",title:"Show metadata when mousing over the player.",component:"setting-check-box"},changed:D=>this.css_tweaks.toggle("theatre-metadata",D)}),this.settings.add("player.theatre.auto-enter",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Automatically open Theatre Mode when visiting a channel.",component:"setting-check-box"}}),this.settings.add("player.fullscreen.auto-chat",{default:!1,ui:{path:"Player > General >> Fullscreen",title:"Automatically expand chat when entering fullscreen mode.",component:"setting-check-box"}}),this.settings.add("player.hide-event-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Event Bar",description:"Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.",component:"setting-check-box"},changed:D=>{this.css_tweaks.toggleHide("player-event-bar",D),this.repositionPlayer()}})}async onEnable(){await super.onEnable(),this.css_tweaks.toggle("theatre-no-whispers",this.settings.get("player.theatre.no-whispers")),this.css_tweaks.toggle("theatre-metadata",this.settings.get("player.theatre.metadata")),this.css_tweaks.toggleHide("player-event-bar",this.settings.get("player.hide-event-bar")),this.on(":fix-player",this.repositionPlayer,this),this.on("site:fullscreen",this.maybeOpenChat,this),this.TheatreHost.on("mount",D=>{D._ffz_theater_start=Date.now(),this.tryTheatreMode(D)}),this.TheatreHost.on("update",this.tryTheatreMode,this),this.TheatreHost.ready((D,v)=>{const f=Date.now();for(const u of v)u._ffz_theater_start=f,this.tryTheatreMode(u)}),this.PlayerSource.on("mount",this.checkCarousel,this),this.PlayerSource.on("update",this.checkCarousel,this)}maybeOpenChat(){this.settings.get("player.fullscreen.auto-chat")&&this.parent.awaitElement(".right-column--collapsed .right-column__toggle-visibility button",document.fullscreenElement,1e3).then(D=>D.click())}shouldStopAutoplay(){return this.settings.get("player.no-autoplay")||!this.settings.get("player.home.autoplay")&&this.router.current?.name==="front-page"}checkCarousel(D){}getData(){return this.DataSource.first}tryTheatreMode(D){D._ffz_theater_timer||(D._ffz_theater_timer=setTimeout(()=>{D._ffz_theater_timer=null,!(!this.settings.get("player.theatre.auto-enter")||!D._ffz_mounted)&&this.router.current_name==="user"&&(D.props.channelHomeLive||D.props.channelHomeCarousel||D.props.theatreModeEnabled||Date.now()-(D._ffz_theater_start||0)>2e3||D.props.onTheatreModeEnabled&&D.props.onTheatreModeEnabled())},250))}repositionPlayer(){}updateSquadContext(){this.settings.updateContext({squad_bar:this.hasSquadBar})}get hasSquadBar(){return!1}};G(I,"Player");let B=I},24020:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>g});var W=d(22527),L=d(44589),B=d(14873);const I=d.p+"color_normalizer.css",U=["product","prime","turbo"],D=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],v=":root{color-scheme: only light}",f=":root{forced-color-adjust: none}",u={dark:{c:{"background-brand":11,"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":2,"background-toggle-handle-checked":10,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":15,"background-top-nav":7,"background-toggle-handle-checked":10,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}},S=class S extends W.default{constructor(...s){super(...s),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.should_enable=!0,this.settings.add("theme.high-contrast-tweaks",{default:null,requires:["context.is-forced-colors","theme.disable-high-contrast"],process(i,l){return l===null?i.get("theme.disable-high-contrast")?!1:i.get("context.is-forced-colors")??!1:l},ui:{path:"Appearance > Theme >> Tweaks",title:"Enable the use of High Contrast tweaks.",description:"This loads an additional set of styles when Forced Color / OS High Contrast mode is enabled to ensure page elements are displayed more appropriately.",component:"setting-check-box"}}),this.settings.add("theme.disable-high-contrast",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Disable Forced Color / OS High Contrast",component:"setting-check-box",description:"Enabling this will instruct your browser to not respect your operating system's High Contrast settings when displaying Twitch. You may need to refresh for this to take full effect."},changed:()=>this.updateCSS()}),this.settings.add("theme.disable-auto-dark",{default:!1,ui:{path:'Appearance > Theme >> Tweaks @{"sort": 10}',title:"Disable Auto Dark Theme",component:"setting-check-box",description:"Enabling this will attempt to disable a browser's built-in automatic dark theme conversion for websites, which is unnecessary on Twitch and can cause display issues. This may not apply depending on your web browser and settings."},changed:()=>this.updateCSS()}),this.settings.add("theme.legacy-dark-input",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Use old input element colors with dark theme.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("theme.font.size",{default:13,process(i,l){if(typeof l!="number")try{l=parseFloat(l)}catch{l=null}return(!l||l<1||isNaN(l)||!isFinite(l)||l>25)&&(l=13),l},ui:{path:'Appearance > Theme >> Fonts @{"sort": 2}',title:"Font Size",description:"**Minimum:** `1`, **Maximum:** `25`, *Old Default:* `12`\n\nHow large should normal text be, in pixels. This may be affected by your browser's zoom and font settings.",component:"setting-text-box",type:"number"},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",ui:{path:'Appearance > Theme >> Colors @{"sort": 0, "description": "This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection."}',title:"Background",description:"Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Background",description:"If not set, the tooltip settings will be automatically adjusted based on the brightness of the background.",component:"setting-color-box",alpha:!0,sort:10},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Text",component:"setting-color-box",sort:11},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",ui:{path:'Appearance > Theme >> Chat Colors @{"sort":1}',title:"Background",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process(i){return!U.includes(i.get("context.route.name"))}}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(i){const l=i.get("context.force-theme");return l??(i.get("context.route.name")==="embed-chat"?(i.get("context.location.search")||"").includes("dark"):i.get("context.ui.theatreModeEnabled")||i.get("theme.can-dark")&&i.get("context.ui.theme")===1)},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process(i){return!i.get("theme.is-dark")}}),this._style=null,this._normalizer=null}updateFont(){let s=this.settings.get("theme.font.size");if(typeof s=="string"&&/^[0-9.]+$/.test(s)?s=parseFloat(s):typeof s!="number"&&(s=null),!s||isNaN(s)||!isFinite(s)||s<1||s===13){this.css_tweaks.delete("font-size");return}s=s/10,this.css_tweaks.set("font-size",`html body {
	--font-size-1: ${4.153846153846154*s}rem;
	--font-size-2: ${2.769230769230769*s}rem;
	--font-size-3: ${1.8461538461538463*s}rem;
	--font-size-4: ${1.3846153846153846*s}rem;
	--font-size-5: ${1.0769230769230769*s}rem;
	--font-size-6: ${s}rem;
	--font-size-7: ${.9230769230769231*s}rem;
	--font-size-8: ${.9230769230769231*s}rem;
	--font-size-base: ${s}rem;
}
`)}generateBackgroundTextBlob(s){const i=s.toHSLA(),l=i.l,w=l<.5;return this.generateBackgroundBlob(s)+this.generateTextBlob(B.Color.RGBA.fromCSS(w?"#FFF":"#000"))}generateBackgroundBlob(s){const i=s.toHSLA(),l=i.l,w=l<.5;return[`--color-background-body:${s.toCSS()};`,`--color-background-input-focus:${s.toCSS()};`,`--color-background-base:${i._l(l+(w?.05:-.05)).toCSS()};`,`--color-background-alt:${i._l(l+(w?.1:-.1)).toCSS()};`,"--color-background-float:var(--color-background-alt);",`--color-background-alt-2:${i._l(l+(w?.15:-.15)).toCSS()};`].join("")}generateTextBlob(s){s.a<.4&&(s=s._a(.4));const i=s.a;return[`--color-text-base:${s.toCSS()};`,`--color-text-input:${s.toCSS()};`,`--color-text-label:${s.toCSS()};`,`--color-text-label-optional:${s._a(i-.4).toCSS()};`,`--color-text-alt:${s._a(i-.2).toCSS()};`,`--color-text-alt-2:${s._a(i-.4).toCSS()};`].join("")}generateAccentBlob(s,i){s.a<1&&(s=s._a(1));const l=s.toHSLA(),w=l.l,b=D.map(p=>p===0?s.toCSS():l._l(w+p).toCSS()),r=[],e=[];for(let p=0;p<b.length;p++)r.push(`--ffz-color-accent-${p+1}:${b[p]};`);let a=i?u.dark:u.light;for(const[p,C]of Object.entries(a.c))typeof C=="number"&&r.push(`--color-${p}:${b[C-1]};`);a=i?u.accent_dark:u.accent_light;for(const[p,C]of Object.entries(a.c))typeof C=="number"&&e.push(`--color-${p}:${b[C-1]} !important;`);return[r.join(""),e.join("")]}updateCSS(){if(this.settings.get("theme.disable-high-contrast")?this.css_tweaks.set("nofc",f):this.css_tweaks.delete("nofc"),this.settings.get("theme.disable-auto-dark")?this.css_tweaks.set("nodark",v):this.css_tweaks.delete("nodark"),this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark")){this.toggleNormalizer(!1),this.toggleAccentNormal(!0),this.css_tweaks.delete("colors");return}let s=this.settings.get("theme.is-dark");const i=[],l=[],w=B.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(w){w.a=1;const h=w.toHSLA();s=h.l<.5;try{const R=this.resolve("site").store,P=R.getState().ui.theme,O=s?1:0;P!==O&&R.dispatch({type:"core.ui.THEME_CHANGED",theme:O})}catch(R){this.log.warning("Unable to automatically set the Twitch Dark Theme state.",R)}i.push(this.generateBackgroundBlob(h)),s&&(i.push("--color-border-base: var(--color-opac-gl-2);"),i.push("--color-background-interactable-hover: var(--color-opac-gl-1);"),i.push("--color-background-interactable-active: var(--color-opac-gl-2);"),i.push("--color-background-button-text-hover: var(--color-opac-gl-1);"),i.push("--color-background-button-text-active: var(--color-opac-gl-2);"))}let b=B.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));!b&&w&&(b=B.Color.RGBA.fromCSS(s?"#FFF":"#000")),b&&i.push(this.generateTextBlob(b)),s&&this.settings.get("theme.legacy-dark-input")&&i.push(`--color-background-input: var(--color-opac-w-4);
--color-background-input-overlay: var(--color-opac-b-4);
--color-background-input-overlay-focus: var(--color-black);
--color-background-selectable: var(--color-opac-w-3);
--color-background-selectable-hover: var(--color-opac-w-4);
--color-border-input: var(--color-opac-w-4);
--color-border-input-hover: var(--color-opac-w-6);
--color-border-input-overlay: var(--color-opac-w-6);
--color-border-input-overlay-hover: var(--color-opac-w-8);
--color-border-input-checkbox: var(--color-opac-w-10);
--color-border-selectable: var(--color-opac-w-2);
--color-border-selectable-hover: var(--color-opac-w-3);`);const r=B.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!r),r){const h=this.generateAccentBlob(r,s);i.push(h[0]),l.push(h[1])}let e=B.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background")),a;!e&&w&&(e=B.Color.RGBA.fromCSS(s?"#FFF":"#000")),e?(i.push(`--color-background-tooltip: ${e.toCSS()};`),a=e.toHSLA().l<.5):a=!s;let p=B.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const C=p||e;if(p||(p=B.Color.RGBA.fromCSS(a?"#FFF":"#000")),p){C&&i.push(`--color-text-tooltip: ${p.toCSS()};`);const h=p.toHSLA(),T=h.a;i.push(`--color-text-tooltip-alt: ${h._a(T-.2).toCSS()};`),i.push(`--color-text-tooltip-alt-2: ${h._a(T-.4).toCSS()};`)}const y=[],z=B.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let $=s;if(z){z.a=1;const h=z.toHSLA();$=h.l<.5,y.push(this.generateBackgroundBlob(h))}let o=B.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));!o&&z&&(o=B.Color.RGBA.fromCSS($?"#FFF":"#000")),o&&y.push(this.generateTextBlob(o));const c=B.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),m=[];if(c){const h=this.generateAccentBlob(c,$);y.push(h[0]),m.push(h[1])}y.length?this.css_tweaks.set("chat-colors",`.moderation-view-page-widget .stream-chat,.chat-shell {${y.join(`
`)}}.moderation-view-page-widget .stream-chat .tw-accent-region,.chat-shell .tw-accent-region{${m.join(`
`)}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(y.length||i.length);const A=s?"":":not(.settings-menu-button-component--forced-dark-theme)";i.length?this.css_tweaks.set("colors",`body,body .tw-root--theme-light,body .tw-root--theme-dark${A} {${i.join(`
`)}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${l.join(`
`)}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(s){if(s){const i=[];for(let l=0;l<15;l++)i.push(`--ffz-color-accent-${l+1}:var(--color-twitch-purple-${l+1});`);this.css_tweaks.set("accent-normal",`body {${i.join(`
`)}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(s){if(this._normalizer){if(!s){this._normalizer.remove();return}}else{if(!s)return;this._normalizer=(0,L.createElement)("link",{rel:"stylesheet",type:"text/css",href:I})}document.head.contains(this._normalizer)||document.head.appendChild(this._normalizer)}onEnable(){let s;try{s=window.matchMedia("(forced-colors: active)")?.matches}catch{}this.settings.updateContext({"is-forced-colors":s??!1}),this.settings.getChanges("theme.high-contrast-tweaks",i=>{this.css_tweaks.toggle("hc-tweaks",i)}),this.updateCSS(),this.updateFont()}};G(S,"ThemeEngine");let g=S},4948:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>u});var W=d(46949),L=d(83269),B=d(6172),I=d(22527),U=d(24431);const D=/^([^\s]+) subscribed ([^.]+)\. They've subscribed for (\d+) months(?:[^!]+streak)?!/,v={1e3:1,2e3:2,3e3:3};function f(S){try{/^[\d-]+$/.test(S)&&(S=parseInt(S,10))}catch{}return(typeof S!="number"||isNaN(S)||!isFinite(S))&&(S=0),S}G(f,"parseParamInt");const g=class g extends I.default{constructor(...n){super(...n),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.overrides"),this.injectAs("site_chat","site.chat"),this.inject("site.chat.chat_line.rich_content"),this.VideoChatController=this.fine.define("video-chat-controller",s=>s.onError&&s.videoData&&s.props?.comments,["user-video","user-clip","video"]),this.VideoChatLine=this.fine.define("video-chat-line",s=>s.onTimestampClickHandler&&s.props?.messageContext,["user-video","user-clip","video"]),this.settings.add("chat.video-chat.timestamps",{default:!0,ui:{path:"Chat > Chat on Videos >> Appearance",title:"Display timestamps alongside chat messages.",component:"setting-check-box"}}),this.settings.add("chat.video-chat.enabled",{default:!0,ui:{path:'Chat > Chat on Videos @{"description": "This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos."} >> General',title:"Enable FrankerFaceZ features for Chat on Videos.",description:"Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.",component:"setting-check-box"}}),this.active_room=null}async onEnable(){var w;this.chat.context.on("changed:chat.video-chat.enabled",this.rerenderLines,this),this.chat.context.on("changed:chat.video-chat.timestamps",this.rerenderLines,this),this.on("chat.overrides:changed",b=>this.updateLinesByUser(b,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this);for(const b of U.RERENDER_SETTINGS)this.chat.context.on(`changed:${b}`,this.rerenderLines,this);for(const b of U.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${b}`,this.updateLineTokens,this);for(const b of U.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${b}`,this.updateLineBadges,this);this.on("chat:get-messages",(b,r,e,a)=>{if(e)for(const p of this.VideoChatLine.instances){const C=p.props.messageContext;C.comment?._ffz_message&&a.push({message:C.comment._ffz_message,_instance:p,update:()=>p.forceUpdate()})}}),this.VideoChatController.on("mount",this.chatMounted,this),this.VideoChatController.on("unmount",this.chatUnmounted,this),this.VideoChatController.on("receive-props",this.chatUpdated,this),this.VideoChatController.ready((b,r)=>{for(const e of r)this.chatMounted(e)});const n=this,s=await this.site.findReact();if(!s)return;const i=s.createElement,l=this.rich_content&&this.rich_content.RichContent;this.MenuContainer=(w=class extends s.Component{constructor(r){super(r),this.onBanUser=()=>{this.props.onBanUserClick({bannedUser:this.props.context.comment.commenter,targetChannel:this.props.context.comment.channelId,comment:this.props.context.comment})},this.onDeleteComment=()=>{this.props.onDeleteCommentClick(this.props.context.comment)},this.onOpen=()=>{this.props.onDisableSync(),this.setState({force:!0})},this.onClose=()=>{this.setState({force:!1})},this.state={force:!1}}render(){return null}},G(w,"FFZMenuContainer"),w),this.VideoChatLine.ready(b=>{const r=b.prototype.render;b.prototype.ffzRenderMessage=function(e,a){const p=e.is_action,C=p?n.chat.context.get("chat.me-style"):0,y=C>=2,z=C===1||C===3,$=e.user,o=n.overrides.getColor($.id)||$.color,c=n.site_chat.colors.process(o),m=n.site.getUser();m&&(m.moderator=this.props.isCurrentUserModerator,m.staff=m.roles&&m.roles.isStaff);let A;if(e.system_msg===!0){const ee=e.params||{};if(ee["msg-id"]==="resub"){const Q=n.chat.context.get("chat.subs.show"),te=f(ee["msg-param-months"]),ne=f(ee["msg-param-cumulative-months"]),fe=ne||te;if(n.log.info("resub-notice setting:",Q,"months:",fe,"cumulative:",ne,"raw:",te),n.log.info("-> params:",ee),Q===3||fe>1&&Q>0){const re=f(ee["msg-param-should-share-streak"])===1,ue=ee["msg-param-sub-plan"],me=ue==="Prime",we=v[ue]||1;n.log.info("-> share:",re,"plan:",ue,"tier:",we),A=n.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:i("span",{class:"tw-c-text-base tw-strong"},$.displayName),plan:me?n.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):n.i18n.t("chat.sub.plan","at Tier {tier}",{tier:we})}),re&&te>1?A.push(n.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:ne,streak:te})):fe>1&&A.push(n.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:fe}))}}}else e.system_msg&&(A=e.system_msg);const h=e.ffz_tokens=e.ffz_tokens||n.chat.tokenizeMessage(e,m),T=l&&n.chat.pluckRichContent(h,e),R=n.chat.formatUser($,i),P=n.overrides.getName($.id);let O=e.ffz_user_class;O instanceof Set?O=[...O].join(" "):Array.isArray(O)&&(O=O.join(" "));const M={className:`video-chat__message-author notranslate${P?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${O??""}`,"data-test-selector":"comment-author-selector",href:`/${$.login}`,rel:"noopener noreferrer",target:"_blank",style:{color:c}};e.ffz_user_props&&Object.assign(M,e.ffz_user_props),e.ffz_user_style&&Object.assign(M.style,e.ffz_user_style);const j=i("a",M,P?[i("span",{className:"chat-author__display-name"},P),i("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},R)]:R);let Y=i("div",{class:"tw-flex-grow-1","data-room-id":e.roomID,"data-room":e.roomLogin,"data-user-id":$.id,"data-user":$.login},i("span",{class:"chat-line__message--badges"},n.chat.badges.render(e,i)),j,i("div",{"data-test-selector":"comment-message-selector",class:"tw-inline video-chat__message"},i("span",null,p?" ":": "),i("span",{class:`message ${y?"chat-line__message-body--italicized":""}`,style:{color:z?c:null}},n.chat.renderTokens(h,i)),T&&i(l,T)));return A&&(Y=i("div",{class:"tw-flex-grow-1"},i("div",{class:"tw-flex tw-c-text-alt-2"},i("div",null,A)),Y)),i("div",{class:"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base"},Y,a?i(n.MenuContainer,{context:a,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.props.onBanUserClick,onDeleteCommentClick:this.props.onDeleteCommentClick,onDisableSync:this.props.onDisableSync,onReplyClick:this.onReplyClickHandler}):null)},b.prototype.ffzRenderExpanded=function(e){return e._reply_handler||(e._reply_handler=()=>this.onReplyClickHandler(e.user.login)),i("div",{class:"tw-align-items-center tw-flex tw-pd-t-05"},i("button",{class:"tw-button tw-button--text","data-test-selector":"parent-reply-button",onClick:e._reply_handler},i("span",{class:"tw-button__text tw-pd-0"},n.i18n.t("video-chat.reply","Reply"))),i("span",{class:"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative ffz-il-tooltip__container"},"\u2022 ",n.i18n.t("video-chat.time","{time,humantime} ago",{time:e.timestamp}),i("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},n.i18n.formatDateTime(e.timestamp,"full"))))},b.prototype.render=function(){try{if(this._ffz_no_scan=!0,this.state?.showReplyForm||!n.chat.context.get("chat.video-chat.enabled"))return r.call(this);const e=this.props.messageContext,a=n.standardizeMessage(e.comment,e.author),p=this.ffzRenderMessage(a,e),C=this.props.hideTimestamp||!n.chat.context.get("chat.video-chat.timestamps"),y=a.mentioned&&a.mention_color?n.site_chat.inverse_colors.process(a.mention_color):null;if(a.ffz_removed)return null;const z=!y&&a.highlight&&n.chat.context.get("chat.points.allow-highlight");return i("div",{"data-test-selector":"message-layout",class:`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${a.is_sub?" ffz-notice-line ffz--subscribe-line":""}${a.highlight?" ffz-notice-line ffz--points-line":""}${z?" ffz--points-highlight ffz-custom-color":""}${a.mentioned?" ffz-mentioned":""}${y?" ffz-custom-color":""}`,style:{backgroundColor:y}},C||i("div",{"data-test-selector":"message-timestamp",class:"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header"},i("div",{class:"tw-mg-r-05"},i("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},i("button",{class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.onTimestampClickHandler},i("div",{class:"tw-pd-x-05"},i("p",{class:"tw-font-size-7"},(0,L.print_duration)(e.comment.contentOffset)))),i("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},n.i18n.t("video-chat.jump","Jump to Video"))))),i("div",{class:"tw-full-width"},p,this.props.isExpandedLayout&&this.ffzRenderExpanded(a),e.replies&&e.replies.length>0&&i("div",{class:"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply"},e.comment.moreReplies&&i("div",{class:"tw-inline-block vod-message__show-more-replies"},i("button",{class:"tw-interactive tw-button tw-button--text",onClick:this.onLoadMoreRepliesClickHandler},i("span",{class:"tw-button__text","data-a-target":"tw-button-text"},n.i18n.t("video-chat.show-more","Show more replies...")))),i("ul",null,e.replies.map($=>i("li",{key:$.comment&&$.comment.id,class:"tw-mg-l-05"},this.ffzRenderMessage(n.standardizeMessage($.comment,$.author),$),this.props.isExpandedLayout&&this.ffzRenderExpanded(a)))))))}catch(e){return n.log.error("Problem rendering Chat",e),r.call(this)}},setTimeout(()=>this.VideoChatLine.forceUpdate())})}updateLines(){return this._updateLines()}rerenderLines(){this.VideoChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(n=!0,s=!0){for(const i of this.VideoChatLine.instances){const l=i.props.messageContext;if(l.comment&&(l.comment._ffz_message=null,Array.isArray(l.replies)))for(const w of l.replies)w.comment&&(w.comment._ffz_message=null)}this.VideoChatLine.forceUpdate()}updateLinesByUser(n,s){for(const i of this.VideoChatLine.instances){const l=i.props.messageContext;if(!l.comment)continue;const w=l.author;w&&(n&&n==w.id||s&&s==w.name)&&(l.comment._ffz_message=null,i.forceUpdate())}}updateLineById(n,s=!0,i=null){i==null&&(i=s);for(const l of this.VideoChatLine.instances){const w=l.props.messageContext;if(w.comment&&w.comment?.id===n){(s||i)&&(w.comment._ffz_message=null),l.forceUpdate();return}}}checkEffects(){for(const n of this.VideoChatLine.instances){const s=n.props.messageContext,i=s?.comment?._ffz_message,l=i?.ffz_tokens;if(l)for(const w of l)w.type==="emote"&&w.modifier_flags&&this.emotes.ensureEffect(w.modifier_flags)}}standardizeMessage(n,s){if(n._ffz_message)return n._ffz_message;const i=this.active_room||this.chat.getRoom(n.channelId,null,!0,!0),l=n.message.userNoticeParams,w=l&&l["msg-id"],b=n._ffz_message={id:n.id,user:{color:n.message.userColor,id:s.id,login:s.name,displayName:s.displayName,isIntl:s.name&&s.displayName&&s.displayName.trim().toLowerCase()!==s.name,type:s.type},roomLogin:i&&i.login,roomID:i&&i.id||n.channelId,ffz_badges:this.chat.badges.getBadges(s.id,s.login,i?.id,i?.login),badges:n.userBadges,messageParts:n.message.tokens,is_action:n.message.isAction,more_replies:n.moreReplies,timestamp:n.createdAt,ffz_context:"video",is_sub:w==="sub"||w==="resub",highlight:w==="highlighted-message",params:l};if(Array.isArray(b.messageParts)&&b.messageParts.length&&w==="resub"){let r=b.messageParts[0].content;if(typeof r=="string"){const e=D.exec(r);e&&(r=r.slice(e[0].length).trimLeft(),r.length&&(b.messageParts[0].ffz_content=r,b.system_msg=!0))}}return this.chat.detokenizeMessage(b),b}addRoom(n,s){s||(s=n.props);const i=(0,W.get)("data.video.owner",s);if(!i||!i.id)return null;const l=n._ffz_room=this.chat.getRoom(i.id,i.login&&i.login.toLowerCase(),!1,!0);return l.ref(n),l}removeRoom(n){n._ffz_room&&(n._ffz_room.unref(n),n._ffz_room=null)}chatMounted(n,s){s||(s=n.props),this.addRoom(n,s)&&(this.active_room=n._ffz_room,this.chat.badges.updateTwitchBadges((0,W.get)("data.badges",s)),this.updateRoomBadges(n,(0,W.get)("data.video.owner.broadcastBadges",s)),this.updateRoomBitsConfig(n,s.bitsConfig))}chatUpdated(n,s){if((0,W.get)("data.video.owner.id",s)!==(0,W.get)("data.video.owner.id",n.props)){this.removeRoom(n),this.chatMounted(n,s);return}const i=(0,W.get)("data.badges",s),l=(0,W.get)("data.badges",n.props),w=(0,W.get)("data.video.owner.broadcastBadges",s),b=(0,W.get)("data.video.owner.broadcastBadges",n.props);i!==l&&this.chat.badges.updateTwitchBadges(i),w!==b&&this.updateRoomBadges(n,w),s.bitsConfig!==n.props.bitsConfig&&this.updateRoomBitsConfig(n,s.bitsConfig);const r=(0,W.get)("data.video.owner",s);this.settings.updateContext({moderator:s.isCurrentUserModerator}),this.chat.context.updateContext({moderator:s.isCurrentUserModerator,channel:r?r.login:null,channelID:r?r.id:null})}chatUnmounted(n){this.active_room===n._ffz_room&&(this.active_room=null),this.removeRoom(n)}updateRoomBadges(n,s){const i=n._ffz_room;i&&i.updateBadges(s)}updateRoomBitsConfig(n,s){const i=n._ffz_room;i&&i.updateBitsConfig((0,B.formatBitsConfig)(s))}};G(g,"VideoChatHook");let u=g},29632:(ae,J,d)=>{"use strict";d.d(J,{default:()=>v});var W=d(22527),L=d(46949),B=d(5286),I=d(17159);const f=class f extends I.FFZEvent{constructor(n){super(n),this._changed=!1}markChanged(){return this._changed=!0,this}};G(f,"ApolloEvent");let U=f;const u=class u extends null{constructor(n){super(`${n.message}; Location: ${n.locations}`)}};G(u,"GQLError");let D=u;const g=class g extends W.default{constructor(...n){super(...n),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){if(this._gql_print)return this._gql_print;const n=this.resolve("site.web_munch");return this._gql_print=n?.getModule?.("gql-printer")}onEnable(){let n=this.client;if(!n){const b=this.fine.react;if(n=(b&&b.stateNode)?.props?.client,b&&!n){let e=0,a=b;for(;!n?.queryManager&&a&&e++<20;)n=a?.memoizedProps?.client,a=a?.child;if(!n){const p=this.fine.searchTree(null,C=>C.props?.client?.queryManager,500);p&&(n=p.props.client)}}this.client=n}if(!n)return new Promise(()=>this.onEnable(),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link){this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");return}this.hooked_query_init=!1;const s=this,i=this.client.queryManager.constructor.prototype,l=i.getCurrentQueryResult;if(i.getCurrentQueryResult=function(b,r=!0){const e=l.call(this,b,r);if(e&&e.partial)try{try{const a=b.getLastResult(),p=b.options;this.dataStore.getCache().read({query:p.query,variables:p.variables,previousResult:a?a.data:void 0,optimistic:r})}catch(a){if(a.toString().includes("Can't find field")&&b.lastResult&&!b.lastResult.loading&&!b.lastError&&Date.now()-(b._ffz_last_retry||0)>=12e4){const p=(0,L.get)("options.query.definitions.0.name",b),C=p&&p.kind==="Name"?p.value:`#${b.queryId}`;s.log.info("Forcing query to refetch due to missing field:",C),b._ffz_last_retry=Date.now(),b.refetch()}}}catch(a){s.log.capture(a)}return e},this.client.queryManager.queryStore){const b=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(r){const e=this.store[r.queryId];return e&&e.queryString!==r.queryString&&(e.queryString=r.queryString),b.call(this,r)}}const w=this.ApolloLink=this.client.link.constructor;this.link=new w((b,r)=>{if(!this.enabled)return r(b);let e=b.variables;Object.keys(e).length||(e=void 0);try{this.hooked_query_init&&this.apolloPreFlight(b)}catch(a){return this.log.capture(a,{tags:{operation:b.operationName},extra:{variables:e}}),this.log.error("Error running Pre-Flight",a,b),r(b)}return r(b).map(a=>{a.extensions&&a.extensions.operationName===b.operationName&&this.log.crumb({level:"info",category:"gql",message:`${b.operationName} [${a.extensions&&a.extensions.durationMilliseconds||"??"}ms]`,data:{variables:e}});try{this.apolloPostFlight(a)}catch(p){this.log.capture(p,{tags:{operation:b.operationName},extra:{variables:e}}),this.log.error("Error running Post-Flight",p,a)}return a})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=w.from([this.link,this.old_link]),this.client.queryManager.link=w.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(n){const s=n.operationName,i=this.modifiers[s],l=`:request.${s}`,w=this.hasListeners(l);if(!i&&!w)return;const b=this.client.queryManager,r=b&&b.queryIdsByName,e=b&&b.queries,a=r&&r[s],p=Array.isArray(a)?a[0]:a,C=e&&e.get(p);if(i)for(const z of i)typeof z=="function"?z(n):z[1]&&this.applyModifier(n,z[1]);let y=!!i;if(w){const z=new U({operation:s,request:n});this.emit(l,z),z._changed&&(y=!0)}if(y){const z=this.client.queryManager.queryStore.store[p],$=this.gqlPrint&&this.gqlPrint(n.query);z&&($?(z.queryString=$,n.query.loc.source.body=$,n.query.loc.end=$.length,C&&(C.document=n.query,C.observableQuery&&C.observableQuery.options&&(C.observableQuery.options.query=n.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",s),this.client.queryManager.queryStore.store[p]=null))}}apolloPostFlight(n){if(!n.extensions)return;const s=n.extensions.operationName,i=this.post_modifiers[s];if(i)for(const l of i)l(n);this.emit(`:response.${s}`,n.data)}applyModifier(n,s){n.query=(0,B.default)(n.query,s)}registerModifier(n,s,i=!0){if(typeof s!="function"){if(!i)throw new Error("post modifiers must be functions");s=[s,s]}(i?this.modifiers[n]=this.modifiers[n]||[]:this.post_modifiers[n]=this.post_modifiers[n]||[]).push(s)}unregisterModifier(n,s,i=!0){const l=i?this.modifiers[n]:this.post_modifiers[n];if(l){if(typeof s!="function")throw new Error("graphql modifiers cannot be removed");for(let w=0;w<l.length;w++){const b=l[w];if(typeof b=="function"?b===s:b[0]===s){l.splice(w,1);return}}}}getQuery(n){const s=this.client.queryManager?.queries;if(s)for(const i of s.values()){const l=i?.observableQuery;if(l?.queryName===n)return l}}maybeRefetch(n){const s=this.getQuery(n);!s||!s.lastResult||s.lastResult.stale||s.refetch()}ensureQuery(n,s,i=500,l=12e4){const w=this.getQuery(n);if(w){const b=w.lastResult;let r;b?b.loading?r=!0:typeof s=="function"?r=s(b):r=(0,L.get)(s,b)!==void 0:r=!1,!r&&Date.now()-(w._ffz_last_retry||0)>=l&&(w._ffz_last_retry=Date.now(),w.options.query=Object.assign({},w.options.query),i===0?w.refetch():i>0&&setTimeout(()=>{w.refetch()},i))}return w}getFromQuery(n,s,i=500,l=12e4){const w=this.getQuery(n),b=w&&w.lastResult;if(!w)return;let r;if(!(b&&(typeof s=="function"?r=s(b):r=(0,L.get)(s,b),b.loading)))return r===void 0&&Date.now()-(w._ffz_last_retry||0)>=l&&(w._ffz_last_retry=Date.now(),w.options.query=Object.assign({},w.options.query),i===0?w.refetch():i>0&&setTimeout(()=>w.refetch(),i)),r}};G(g,"Apollo");let v=g},6170:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>f,e:()=>u});var W=d(20857);let L,B,I,U;function D(){return L?Promise.resolve(L):new Promise((g,S)=>{if(I)return I.push([g,S]);I=[[g,S]],Promise.all([d.e(2009).then(d.t.bind(d,19404,23)),d.e(2009).then(d.t.bind(d,43496,23))]).then(n=>{L=n[0]?.default,B=n[1]?.default;const s=I;I=null;for(const i of s)i[0](L)}).catch(n=>{const s=I;I=null;for(const i of s)i[1](n)})})}G(D,"loadMD");function v(g){const S=g.renderer.rules.link_open||this.defaultRender;g.renderer.rules.link_open=function(n,s,i,l,w){const b=n[s];if(b&&b.type==="link_open"&&Array.isArray(b.attrs)){let r;for(const e of b.attrs)if(e[0]==="href"){r=e[1];break}if(r.startsWith("~")){let e;if(r==="~"){let a=s+1,p=[];for(;a<n.length;){const y=n[a],z=y?.type;if(z==="text")p.push(y);else if(z==="link_close")break;a++}p=p.map(y=>y.content).join(""),e=(0,W.Q)(p).map(y=>y.key).join(".")}else e=r.slice(1);if(e&&e.length){for(const a of b.attrs)if(a[0]==="class"){a[1]=a[1].replace(/ffz-tooltip/g,"");break}b.attrs.push(["data-settings-link",e]),b.attrs.push(["onclick",'FrankerFaceZ.get().resolve("main_menu").mdNavigate(this);return false'])}}}return S(n,s,i,l,w)}}G(v,"SettingsLinks"),v.defaultRender=function(g,S,n,s,i){return i.renderToken(g,S,n)};async function f(){if(!U){const g=await D();if(!g)return null;const S=U=new g({html:!1,linkify:!0});S.use(v),S.use(B,{attrs:{class:"ffz-tooltip",target:"_blank",rel:"noopener","data-tooltip-type":"link"}})}return U}G(f,"awaitMD");function u(g){if(U)return U;g&&f().then(S=>g(S))}G(u,"getMD")},83935:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(22527),L=d(44589),B=d(8528);const U=class U extends W.default{constructor(v,f){super(v,f),this.settings=null,this.inject("settings"),this.color_cache=null,this.name_cache=null}onEnable(){this.settings.provider.on("changed",this.onProviderChange,this)}renderUserEditor(v,f){let u,g,S;const n=G(()=>{const i=u,l=g,w=S;u=g=S=null,i&&i.destroy(),l&&l.destroy(),w&&w.$destroy()},"destroy"),s=document.fullscreenElement??document.body.querySelector("#root>div")??document.body;g=new B.default(s,[],{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,no_auto_remove:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"",arrowInner:"",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:s},flip:{behavior:["bottom","top","left","right"]}}},content:async(i,l)=>{const w=this.resolve("vue"),b=d.e(8586).then(d.bind(d,54337));if(!w)throw new Error("unable to load vue");const[,r]=await Promise.all([w.enable(),b]);return w.component("override-editor",r.default),S=new w.Vue({el:(0,L.createElement)("div"),render:e=>e("override-editor",{user:v,name:this.getName(v.id),color:this.getColor(v.id),originalName:v.displayName??v.login,originalColor:v.color,updateTip:()=>l.update(),setColor:a=>this.setColor(v.id,a),deleteColor:()=>this.deleteColor(v.id),setName:a=>this.setName(v.id,a),deleteName:()=>this.deleteName(v.id),close:()=>l.hide()})}),S.$el},onShow:async(i,l)=>{await l.waitForDom(),requestAnimationFrame(()=>{l.outer&&(u=new L.ClickOutside(l.outer,n))})},onMove:(i,l,w)=>{this.emit("tooltips:hover",i,l,w)},onLeave:(i,l,w)=>{this.emit("tooltips:leave",i,l,w)},onHide:n}),g._enter(f)}onProviderChange(v){v==="overrides.colors"&&this.color_cache?this.loadColors():v==="overrides.names"&&this.name_cache&&this.loadNames()}get colors(){return this.color_cache??this.loadColors()}get names(){return this.name_cache??this.loadNames()}loadColors(){let v,f=!0;this.color_cache?v=new Set(Object.keys(this.color_cache)):(f=!1,this.color_cache={},v=new Set);const u=this.settings.provider.get("overrides.colors");if(u)for(const[g,S]of Object.entries(u))v.delete(g),this.color_cache[g]!==S&&(this.color_cache[g]=S,f&&this.emit(":changed",g,"color",S));for(const g of v)this.color_cache[g]=void 0,f&&this.emit(":changed",g,"color",void 0);return this.color_cache}loadNames(){let v,f=!0;this.name_cache?v=new Set(Object.keys(this.name_cache)):(f=!1,this.name_cache={},v=new Set);const u=this.settings.provider.get("overrides.names");if(u)for(const[g,S]of Object.entries(u))v.delete(g),this.name_cache[g]!==S&&(this.name_cache[g]=S,f&&this.emit(":changed",g,"name",S));for(const g of v)this.name_cache[g]=void 0,f&&this.emit(":changed",g,"name",void 0);return this.name_cache}getColor(v){return this.colors[v]??null}getName(v){return this.names[v]??null}setColor(v,f){this.colors[v]!==f&&(this.colors[v]=f,this.settings.provider.set("overrides.colors",this.colors),this.emit(":changed",v,"color",f))}setName(v,f){this.names[v]!==f&&(this.names[v]=f,this.settings.provider.set("overrides.names",this.names),this.emit(":changed",v,"name",f))}deleteColor(v){this.setColor(v,void 0)}deleteName(v){this.setName(v,void 0)}};G(U,"Overrides");let I=U},22231:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>L});var W=d(46949);const B=class B{constructor(U,D,v,f){this.destroyed=!1,this._login=null,this.manager=U,this.room=D,this.emote_sets=null,this.badges=null,this._id=v,this.login=f,v&&((D??U).user_ids[v]=this)}destroy(){if(this.destroyed=!0,this.emote_sets){for(const D of this.emote_sets._cache)this.manager.emotes.unrefSet(D);this.emote_sets=null}this.badges&&(this.badges=null);const U=this.room||this.manager;U&&(this._login&&U.users&&U.users[this._login]===this&&(U.users[this._login]=null),U.user_ids&&U.user_ids[this._id]===this&&(U.user_ids[this._id]=null))}merge(U){if(!this.login&&U.login&&(this.login=U.login),U.emote_sets)for(const[D,v]of U.emote_sets.iterateSources())for(const f of v)this.addSet(D,f);if(U.badges)for(const[D,v]of U.badges.iterateSources())for(const f of v)this.addBadge(D,f.id,f)}_unloadAddon(U){return 0}get id(){return this._id}get login(){return this._login}set login(U){if(this._login===U)return;const D=this.room||this.manager;if(this._login&&D.users[this._login]===this&&(D.users[this._login]=null),this._login=U,!U)return;const v=D.users[U];v&&v!==this&&(v.login=null),this._login=U,D.users[U]=this}addBadge(U,D,v){if(this.destroyed)return!1;typeof D=="number"&&(D=`${D}`),v?v.id=D:v={id:D},this.badges||(this.badges=new W.SourcedSet(!1,this.manager.emotes.sourceSortFn));const f=this.badges.get(U);if(f){for(const u of f)if(u.id==D)return Object.assign(u,v),!1}return this.badges.push(U,v),!0}getBadges(){return this.badges?[...this.badges._cache]:[]}getBadge(U){if(this.badges){for(const D of this.badges._cache)if(D.id==U)return D}return null}removeBadge(U,D){if(!this.badges)return!1;const v=this.badges.get(U);if(v){for(const f of v)if(f.id==D)return this.badges.remove(U,f),!0}return!1}removeAllBadges(U){return!this.badges||!this.badges.has(U)?!1:(this.badges.delete(U),!0)}addSet(U,D,v){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new W.SourcedSet),typeof D=="number"&&(D=`${D}`);let f=!1,u=!1;return this.emote_sets.sourceIncludes(U,D)||(f=!this.emote_sets.includes(D),this.emote_sets.push(U,D),u=!0),v&&this.manager.emotes.loadSetData(D,v),f&&(this.manager.emotes.refSet(D),this.manager.emotes.emit(":update-user-sets",this,U,D,!0)),u}removeAllSets(U){if(!this.emote_sets)return!1;const D=this.emote_sets.get(U);if(!Array.isArray(D)||!D.length)return!1;for(const v of D)this.removeSet(U,v);return!0}removeSet(U,D){if(this.emote_sets)return typeof D=="number"&&(D=`${D}`),this.emote_sets.sourceIncludes(U,D)?(this.emote_sets.remove(U,D),this.emote_sets.includes(D)||(this.manager.emotes.unrefSet(D),this.manager.emotes.emit(":update-user-sets",this,U,D,!1)),!0):!1}};G(B,"User");let L=B},89817:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>f});var W=d(24431),L=d(44589),B=d(46949),I=d(22527),U=d(83269),D=d(8528);const v=/^https:\/\/[^/]+\.(?:twitch\.tv|twitchcdn\.net)\/.+?\.mp4(?:\?.*)?$/,u=class u extends I.default{constructor(S,n){super(S,n),this.settings=null,this.i18n=null,this.tooltips=null,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.should_enable=!0,this.definitions={},this.settings.add("metadata.clip-download",{default:!0,ui:{path:"Channel > Metadata >> Clips",title:"Add a Download button for editors to clip pages.",description:"This adds a download button beneath the player on clip pages (the main site, not on `clips.twitch.tv`) for broadcasters and their editors.",component:"setting-check-box"},changed:()=>this.updateMetadata("clip-download")}),this.settings.add("metadata.player-stats",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Playback Statistics",description:"Show the current stream delay, with playback rate and dropped frames in the tooltip.",component:"setting-check-box",getExtraTerms:()=>["latency","bitrate"]},changed:()=>this.updateMetadata("player-stats")}),this.settings.add("metadata.stream-delay-warning",{default:0,ui:{path:"Channel > Metadata >> Player",title:"Stream Delay Warning",description:"When the current stream delay exceeds this number of seconds, display the stream delay in a warning color to draw attention to the large delay. Set to zero to disable.",component:"setting-text-box",process:"to_float",bounds:[0,!0]}}),this.settings.add("metadata.uptime",{default:2,ui:{path:"Channel > Metadata >> Player",title:"Stream Uptime",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateMetadata("uptime")}),this.settings.add("metadata.viewers",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Alternative Viewer Count",description:"This displays the current channel's viewer count without an animation when it changes.",component:"setting-check-box"},changed:()=>this.updateMetadata("viewers")}),this.define("viewers",{refresh(){return this.settings.get("metadata.viewers")},setup(s){return{live:s.channel?.live&&s.channel?.live_since!=null,count:s.getViewerCount()}},order:1,icon:"ffz-i-viewers",label(s){return!this.settings.get("metadata.viewers")||!s.live?null:this.i18n.formatNumber(s.count)},tooltip(){return this.i18n.t("metadata.viewers","Viewer Count")},color:"var(--color-text-live)"}),this.define("uptime",{inherit:!0,no_arrow:!0,player:!0,refresh(){return this.settings.get("metadata.uptime")>0},setup(s){let i=s?.channel?.live_since;if(!i)return null;i instanceof Date||(i=new Date(i));const l=this.resolve("socket"),w=Date.now()-(l?._time_drift??0);return{created:i,uptime:i?Math.floor((w-i.getTime())/1e3):-1,getBroadcastID:s.getBroadcastID}},order:2,icon:"ffz-i-clock",label(s){const i=this.settings.get("metadata.uptime");return!i||!s?.created?null:(0,U.duration_to_string)(s.uptime,!1,!1,!1,i!==2)},tooltip(s){return s?.created?[this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),(0,L.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:s.created}))]:null},async popup(s,i){if(!s)return;const[l,w]=await Promise.all([navigator?.permissions?.query?.({name:"clipboard-write"}).then(a=>a?.state).catch(()=>null),s.getBroadcastID()?.catch(a=>null)]);if(!w)return(0,L.createElement)("div",null,this.i18n.t("metadata.uptime-no-id","Sorry, we couldn't find an archived video for the current broadcast."));const b=`https://www.twitch.tv/videos/${w}${s.uptime>0?`?t=${(0,U.durationForURL)(s.uptime)}`:""}`,r=l==="granted"||l==="prompt",e=r?a=>(navigator.clipboard.writeText(b),a.preventDefault(),!1):null;return i.element?.classList.add("ffz-balloon--lg"),(0,L.createElement)("div",null,(0,L.createElement)("div",{class:"tw-pd-b-1 tw-mg-b-1 tw-border-b tw-semibold"},this.i18n.t("metadata.uptime.link-to","Link to {time}",{time:(0,U.duration_to_string)(s.uptime,!1,!1,!1,!1)})),(0,L.createElement)("div",{class:"tw-flex tw-align-items-center"},(0,L.createElement)("input",{class:"tw-border-radius-medium tw-font-size-6 tw-pd-x-1 tw-pd-y-05 ffz-input tw-full-width",type:"text",value:b,onFocus:a=>a.target?.select()}),r&&(0,L.createElement)("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","aria-label":this.i18n.t("metadata.uptime.copy","Copy to Clipboard"),onClick:e},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-docs"})))),(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up"},this.i18n.t("metadata.uptime.copy","Copy to Clipboard")))))}}),this.define("clip-download",{button:!0,inherit:!0,setup(s){if(!this.settings.get("metadata.clip-download"))return;const i=this.resolve("site.player"),l=i.current;if(!l)return;const w=l.mediaSinkManager||l.core?.mediaSinkManager,b=w?.video?.src;if(!b||!v.test(b))return;if(this.settings.get("metadata.clip-download.force")||this.resolve("site").getUser?.()?.id==s.channel.id||s.getUserSelfImmediate(s.refresh)?.isEditor)return b},label(s){if(s)return this.i18n.t("metadata.clip-download","Download")},icon:"ffz-i-download",click(s){const l=(this.settings.get("context.title")||"Untitled").replace(/[\\/:"*?<>|]+/,"_")+".mp4",w=(0,L.createElement)("a",{target:"_blank",download:l,href:s,style:{display:"none"}});document.body.appendChild(w),w.click(),w.remove()}}),this.define("player-stats",{button:!0,inherit:!0,modview:!0,player:!0,refresh(){return this.settings.get("metadata.player-stats")},setup(s){const i=this.resolve("site.player"),l=this.resolve("socket"),w=i.current;let b;if(!w)b=null;else if(typeof w.getPlaybackStats=="function")b=w.getPlaybackStats();else if(typeof w.getVideoInfo=="function"){const a=w.getVideoInfo();b={backendVersion:(0,B.maybe_call)(w.getVersion,w),bufferSize:a.video_buffer_size,displayResolution:`${a.vid_display_width}x${a.vid_display_height}`,fps:a.current_fps,hlsLatencyBroadcaster:a.hls_latency_broadcaster/1e3,hlsLatencyEncoder:a.hls_latency_encoder/1e3,memoryUsage:`${a.totalMemoryNumber} MB`,rate:(0,B.maybe_call)(w.getPlaybackRate,w)||1,playbackRate:a.current_bitrate,skippedFrames:a.dropped_frames,videoResolution:`${a.vid_width}x${a.vid_height}`}}else{const a=(0,B.maybe_call)(w.getVideoHeight,w)||0,p=(0,B.maybe_call)(w.getVideoWidth,w)||0,C=(0,B.maybe_call)(w.getDisplayHeight,w)||0,y=(0,B.maybe_call)(w.getDisplayWidth,w)||0;b={backendVersion:(0,B.maybe_call)(w.getVersion,w),bufferSize:(0,B.maybe_call)(w.getBufferDuration,w),displayResolution:`${y}x${C}`,videoResolution:`${p}x${a}`,videoHeight:a,videoWidth:p,displayHeight:C,displayWidth:y,rate:(0,B.maybe_call)(w.getPlaybackRate,w),fps:Math.floor((0,B.maybe_call)(w.getVideoFrameRate,w)||0),hlsLatencyBroadcaster:(0,B.maybe_call)(w.getLiveLatency,w)||0,playbackRate:Math.floor(((0,B.maybe_call)(w.getVideoBitRate,w)||0)/1e3),skippedFrames:(0,B.maybe_call)(w.getDroppedFrames,w)}}if(b){const a=w&&(0,B.maybe_call)(w.getHTMLVideoElement,w);b.avOffset=0,a?._ffz_context&&(b.avOffset=(a._ffz_context_offset??0)+a._ffz_context.currentTime-a.currentTime)}let r=!1;try{const a=w.core.state.path;if(a.includes("/api/channel/hls/")){const p=JSON.parse(new URL(a).searchParams.get("token"));r=p&&p.player_type&&p.player_type!=="site"?p.player_type:!1}}catch{}if(!b||b.hlsLatencyBroadcaster<-100)return null;let e=0;return l&&l.connected&&(e=l._time_drift),{is_player:s.is_player,stats:b,drift:e,rate:b.rate==null?1:b.rate,delay:b.hlsLatencyBroadcaster,old:b.hlsLatencyBroadcaster>180,tampered:r}},order:3,icon(s){return s?.rate>1?"ffz-i-fast-fw":"ffz-i-gauge"},label(s){if(!this.settings.get("metadata.player-stats")||!s?.delay||s.old)return null;const i=s.drift>5e3?"(!) ":"";return s.old?`${i}${s.delay.toFixed(2)}s old`:`${i}${s.delay.toFixed(2)}s`},click(){const s=this.resolve("site.player"),i=this.resolve("site.fine"),l=s.Player?.first,w=i&&l&&i.searchTree(l,e=>e.props?.setStatsOverlay,200),b=w&&i.getChildNode(l),r=b&&b.querySelector('[data-a-target="player-overlay-video-stats"]');w&&w.props.setStatsOverlay(r?0:1)},color(s){const i=this.settings.get("metadata.stream-delay-warning");if(!(i===0||!s?.delay||s.old)){if(s.delay>i*2)return s.is_player?"#f9b6b6":"#ec1313";if(s.delay>i)return s.is_player?"#fcb896":"#fc7835"}},tooltip(s){if(!s)return null;const i=s.tampered?(0,L.createElement)("div",{class:"tw-border-t tw-mg-t-05 tw-pd-t-05"},this.i18n.t("metadata.player-stats.tampered","Your player has an unexpected player type ({type}), which may affect your viewing experience.",{type:s.tampered})):null,l=s.drift>5e3?(0,L.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.delay-warning","Your local clock seems to be off by roughly {count,number} seconds, which could make this inaccurate.",Math.round(s.drift/10)/100)):null,w=s.rate>1?(0,L.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.rate-warning","Playing at {rate,number}x speed to reduce delay.",{rate:s.rate.toFixed(2)})):null;if(!s.stats||!s.delay)return[l,w,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),i];const b=s.stats,r=this.i18n.t("metadata.player-stats.video-info",`Video: {videoResolution}p{fps}
Playback Rate: {playbackRate, number} Kbps
Dropped Frames: {skippedFrames, number}`,b),e=null,a=b.bufferSize>0?(0,L.createElement)("div",null,this.i18n.t("metadata.player-stats.buffered","Buffered: {buffered} seconds",{buffered:b.bufferSize.toFixed(2)})):null;return s.old?[l,this.i18n.t("metadata.player-stats.video-tip","Video Information"),(0,L.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.player-stats.broadcast-ago","Broadcast {count,number}s Ago",s.delay)),(0,L.createElement)("div",{class:"tw-pd-t-05"},r),e,a,i]:[l,w,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),(0,L.createElement)("div",{class:"tw-pd-t-05"},r),e,a,i]}})}getAddonProxy(S,n,s){if(!S)return this;const i={},l=W.DEBUG||n?.dev;return i.define=(w,b)=>(b&&(b.__source=S),this.define(w,b)),(0,I.buildAddonProxy)(s,this,"metadata",i)}onEnable(){const S=this.tooltips.types.metadata=n=>{let s=n;if(s._ffz_stat?s=s._ffz_stat:s.classList.contains("ffz-stat")||(s=n.closest(".ffz-stat"),n._ffz_stat=s),!s)return;const i=s.dataset.key,l=i?.length?this.definitions[i]:null;return(0,B.maybe_call)(l?.tooltip,this,s._ffz_data)};S.onShow=(n,s)=>{const i=n._ffz_stat||n;i.tip=s},S.onHide=n=>{const s=n._ffz_stat||n;s.tip=null,s.tip_content=null},S.popperConfig=(n,s,i)=>(i.placement="bottom",i.modifiers.flip={behavior:["bottom","top"]},i),this.on("addon:fully-unload",n=>{const s=new Set;for(const[i,l]of Object.entries(this.definitions))l?.__source===n&&(s.add(i),this.definitions[i]=void 0);s.size&&(this.log.debug(`Cleaned up ${s.size} entries when unloading addon:`,n),this.updateMetadata([...s]))})}get keys(){return Object.keys(this.definitions)}define(S,n){this.definitions[S]=n,this.updateMetadata(S)}updateMetadata(S){const n=this.resolve("site.channel");if(n)for(const i of n.InfoBar.instances)n.updateMetadata(i,S);const s=this.resolve("site.player");if(s)for(const i of s.Player.instances)s.updateMetadata(i,S)}async renderLegacy(S,n,s,i,l){i[S]&&clearTimeout(i[S]);let w=s.querySelector(`.ffz-stat[data-key="${S}"]`);const b=this.definitions[S],r=G(()=>{w&&(w._ffz_destroy&&w._ffz_destroy(),w._ffz_destroy=null,w.remove())},"destroy");if(!b)return r();try{const e=G(()=>l(S),"ref_fn");n={...n,is_player:!1,refresh:e},b.setup&&(n=await b.setup.call(this,n));const a=(0,B.maybe_call)(b.refresh,this,n);a&&(i[S]=setTimeout(e,typeof a=="number"?a:1e3)),w=s.querySelector(`.ffz-stat[data-key="${S}"]`);let p,C,y;const z=(0,B.maybe_call)(b.label,this,n);if(!z)return r();const $=(0,B.maybe_call)(b.order,this,n),o=(0,B.maybe_call)(b.color,this,n)||"";if(w){if(p=w.querySelector(".ffz-stat-text"),!p)return r();if(y=w.dataset.icon||"",C=w.dataset.color||"",w._ffz_order!==$&&(w.style.order=`${w._ffz_order=$}`),w.tip){const c=(0,B.maybe_call)(b.tooltip,this,n);w.tip_content!==c&&(w.tip_content=c,w.tip?.element&&(w.tip.element.innerHTML="",(0,L.setChildren)(w.tip.element,c)))}}else{let c=y=(0,B.maybe_call)(b.icon,this,n),m=!1;if(b.button!==!1&&(b.popup||b.click)){m=!0;let A,h;const T=(0,B.maybe_call)(b.border,this,n),R=(0,B.maybe_call)(b.inherit,this,n);typeof c=="string"&&(c=(0,L.createElement)("span",{class:"tw-mg-r-05"},(0,L.createElement)("figure",{class:c}))),b.popup&&b.click?w=(0,L.createElement)("div",{class:`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat ffz-stat--fix-padding ${T?"tw-mg-r-1":"tw-mg-r-05 ffz-mg-l--05"}`,"data-key":S,tip_content:null},A=(0,L.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium ffz-core-button ffz-core-button--padded ffz-core-button--text ${R?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${T?"tw-border-l tw-border-t tw-border-b":"tw-font-size-5 tw-regular"}${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata"},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center tw-pd-x-1"},c,p=(0,L.createElement)("span",{class:"ffz-stat-text"}))),h=(0,L.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${R?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${T?"tw-border":"tw-font-size-5 tw-regular"}${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata"},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},(0,L.createElement)("span",null,(0,L.createElement)("figure",{class:"ffz-i-down-dir"}))))):A=h=w=(0,L.createElement)("button",{class:`ffz-stat tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${R?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative tw-pd-x-05 ffz-stat--fix-padding ${T?"tw-border tw-mg-r-1":"tw-font-size-5 tw-regular tw-mg-r-05 ffz-mg-l--05"}${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata","data-key":S,tip_content:null},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},c,p=(0,L.createElement)("span",{class:"ffz-stat-text"}),b.popup&&!b.no_arrow&&(0,L.createElement)("span",{class:"tw-mg-l-05"},(0,L.createElement)("figure",{class:"ffz-i-down-dir"})))),b.click&&A.addEventListener("click",P=>!w||!A||A.disabled||A.classList.contains("disabled")||w.disabled||w.classList.contains("disabled")?!1:b.click?.call?.(this,w._ffz_data,P,()=>{l(S)})),b.popup&&h.addEventListener("click",()=>{if(!w||!h||h.disabled||h.classList.contains("disabled")||w.disabled||w.classList.contains("disabled"))return!1;if(w._ffz_popup&&w._ffz_destroy)return w._ffz_destroy();const P=[],O=G(ee=>{P.push(ee)},"add_close_listener"),M=w._ffz_destroy=()=>{for(const ee of P)try{ee()}catch(X){X instanceof Error&&this.log.capture(X,{tags:{metadata:S}}),this.log.error("Error when running a callback for pop-up destruction for metadata:",S,X)}if(w){if(w._ffz_outside&&w._ffz_outside.destroy(),w._ffz_popup){const ee=w._ffz_popup;w._ffz_popup=null,ee.destroy()}w._ffz_destroy=w._ffz_outside=null}},j=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(w._ffz_popup=new D.default(j,w,{logger:this.log,i18n:this.i18n,manual:!0,live:!1,html:!0,tooltipClass:"ffz-metadata-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute",innerClass:"tw-pd-1",popper:{placement:"top-end",modifiers:{preventOverflow:{boundariesElement:j},flip:{behavior:["top","bottom","left","right"]}}},content:(ee,X)=>b.popup?.call(this,w?._ffz_data,X,()=>l(S),O),onShow:(ee,X)=>setTimeout(()=>{w&&X.outer&&(w._ffz_outside=new L.ClickOutside(X.outer,M))}),onHide:M}))._enter(w)})}else typeof c=="string"&&(c=(0,L.createElement)("span",{class:"tw-stat__icon"},(0,L.createElement)("figure",{class:c}))),w=(0,L.createElement)("div",{class:`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat tw-mg-r-1${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata","data-key":S,tip_content:null},c,p=(0,L.createElement)("span",{class:`${c?"tw-mg-l-05 ":""}ffz-stat-text tw-stat__value`})),b.click&&w.addEventListener("click",A=>{if(!w||w.disabled||w.classList.contains("disabled"))return!1;b.click?.call?.(this,w._ffz_data,A,()=>l(S))});w._ffz_order=$,$!=null&&(w.style.order=`${$}`),s.appendChild(w)}if(typeof b.icon=="function"){const c=(0,B.maybe_call)(b.icon,this,n);if(typeof c=="string"&&c!==y){w.dataset.icon=c;const m=w.querySelector("figure");m&&(m.className=c)}}C!==o&&(w.dataset.color=o,w.style.setProperty("color",o,"important")),w._ffz_data=n,p.innerHTML="",(0,L.setChildren)(p,z),b.disabled!==void 0&&(w.disabled=(0,B.maybe_call)(b.disabled,this,n))}catch(e){return e instanceof Error&&this.log.capture(e,{tags:{metadata:S}}),this.log.error(`Error rendering metadata for ${S}`,e),r()}}};G(u,"Metadata");let f=u},45655:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>v});var W=d(44589),L=d(46949),B=d(8528),I=d(22527),U=d(6170),D=d(24431);const f=class f extends I.default{constructor(g,S){super(g,S),this.i18n=null,this.types={},this.inject("i18n"),this.should_enable=!0,this.types.json=n=>{const s=n.dataset.title;return[s&&(0,W.createElement)("strong",null,s),(0,W.createElement)("code",{className:`block${s?" pd-t-05 border-t mg-t-05":""}`,style:{fontFamily:"monospace",textAlign:"left"}},n.dataset.data)]},this.types.child=n=>{const s=n.querySelector(":scope > .ffz-tooltip-child");return s?(n._ffz_child=s,s.remove(),s.classList.remove("ffz-tooltip-child"),s):null},this.types.child.onHide=n=>{const s=n._ffz_child;s&&(n._ffz_child=null,s.remove(),n.querySelector(":scope > .ffz-tooltip-child")||(s.classList.add("ffz-tooltip-child"),n.appendChild(s)))},this.types.markdown=(n,s)=>{s.add_class="ffz-tooltip--markdown";const i=(0,U.e)();return i?i.render(n.dataset.title):(0,U.Z)().then(l=>l.render(n.dataset.title))},this.types.text=n=>(0,W.sanitize)(n.dataset.title??""),this.types.html=n=>n.dataset.title,this.onFSChange=this.onFSChange.bind(this)}getAddonProxy(g,S,n){if(!g)return this;const s={},i=D.DEBUG||S?.dev;let l;return s.define=(w,b)=>(b&&(b.__source=g),this.define(w,b)),i&&(s.cleanup=()=>(n.log.warn('[DEV-CHECK] Instead of calling tooltips.cleanup(), you can emit the event "tooltips:cleanup"'),this.cleanup()),l={types:"Please use tooltips.define()"}),(0,I.buildAddonProxy)(n,this,"tooltips",s,l)}onEnable(){const g=this.getRoot();window.addEventListener("fullscreenchange",this.onFSChange),this.container=g,this.tip_element=g,this.tips=this._createInstance(g),this.on(":cleanup",this.cleanup),this.on("addon:fully-unload",S=>{let n=0;for(const[s,i]of Object.entries(this.types))i?.__source===S&&(n++,this.types[s]=void 0);n&&(this.log.debug(`Cleaned up ${n} entries when unloading addon:`,S),this.cleanup())})}define(g,S){this.types[g]=S}getRoot(){return document.querySelector(".sunlight-root")||document.querySelector("#root")||document.querySelector(".clips-root")||document.body}_createInstance(g,S="ffz-tooltip",n="text",s){return new B.default(g,S,{html:!0,i18n:this.i18n,live:!0,check_modifiers:!0,container:s||g,delayHide:this.checkDelayHide.bind(this,n),delayShow:this.checkDelayShow.bind(this,n),content:this.process.bind(this,n),interactive:this.checkInteractive.bind(this,n),hover_events:this.checkHoverEvents.bind(this,n),onShow:this.delegateOnShow.bind(this,n),onHide:this.delegateOnHide.bind(this,n),popperConfig:this.delegatePopperConfig.bind(this,n),popper:{placement:"top",modifiers:{flip:{}}},onHover:(i,l,w)=>{this.emit(":hover",i,l,w)},onLeave:(i,l,w)=>{this.emit(":leave",i,l,w)}})}onFSChange(){this.container||(this.container=this.getRoot());let g=this.container;document.fullscreenElement instanceof HTMLElement&&(g=document.fullscreenElement),g!==this.tip_element&&(this.tip_element=g,this.tips&&(this.tips.destroy(),this.tips=this._createInstance(g)))}cleanup(){this.tips&&this.tips.cleanup()}delegatePopperConfig(g,S,n,s){const i=S.dataset.tooltipType||g,l=this.types[i];return S.dataset.tooltipSide&&(s.placement=S.dataset.tooltipSide),l&&l.popperConfig?l.popperConfig(S,n,s):s}delegateOnShow(g,S,n){const s=S.dataset.tooltipType||g,i=this.types[s];i&&i.onShow&&i.onShow(S,n)}delegateOnHide(g,S,n){const s=S.dataset.tooltipType||g,i=this.types[s];i&&i.onHide&&i.onHide(S,n)}checkDelayShow(g,S,n){const s=S.dataset.tooltipType||g,i=this.types[s];return i?.delayShow!=null?(0,L.maybe_call)(i.delayShow,null,S,n):0}checkDelayHide(g,S,n){const s=S.dataset.tooltipType||g,i=this.types[s];return i?.delayHide!=null?(0,L.maybe_call)(i.delayHide,null,S,n):0}checkInteractive(g,S,n){const s=S.dataset.tooltipType||g,i=this.types[s];return i?.interactive!=null?(0,L.maybe_call)(i.interactive,null,S,n):!1}checkHoverEvents(g,S,n){const s=S.dataset.tooltipType||g,i=this.types[s];return i?.hover_events!=null?(0,L.maybe_call)(i.hover_events,null,S,n):!1}process(g,S,n){const s=S.dataset.tooltipType||g||"text",i=S.dataset.tooltipAlign,l=this.types[s];return i&&(n.align=i),l?l(S,n):[(0,W.createElement)("strong",null,"Unhandled Tooltip Type"),(0,W.createElement)("code",{className:"tw-block pd-t-05 border-t mg-t-05",style:{fontFamily:"monospace",textAlign:"left"}},JSON.stringify(S.dataset,null,4))]}};G(f,"TooltipProvider");let v=f},30020:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Everything:()=>v,Experiments:()=>L,FavoriteEmotes:()=>I,HiddenEmotes:()=>B,Overrides:()=>U,Profiles:()=>D});var W=d(76393);const L={label:"Experiment Overrides",keys:["exp-lock","experiment-overrides"]},B={label:"Hidden Emotes",keys(f){const u=["emote-menu.hidden-sets"];for(const g of f.keys())g.startsWith("hidden-emotes.")&&u.push(g);return u}},I={label:"Favorited Emotes",keys(f){const u=[];for(const g of f.keys())g.startsWith("favorite-emotes.")&&u.push(g);return u}},U={label:"Name and Color Overrides",keys:["overrides.colors","overrides.names"]},D={label:"Profiles",clear(f,u){const g=["profiles"];for(const S of f.keys())/^p:\d+:/.test(S)&&g.push(S);for(const S of g)f.delete(S);u.loadProfiles()}},v={label:"Absolutely Everything",async clear(f,u){f.clear(),f.supportsBlobs&&f instanceof W.i9&&await f.clearBlobs(),u.loadProfiles()}}},47458:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(17159),L=d(46949),B=d(39602);function I(v,f,u){if(!v||!Array.isArray(v.requires))return!1;for(const g of v.requires){const S=u.get(g),n=f.get(g);if(typeof S!=typeof n)return!0;if(Array.isArray(S)&&Array.isArray(n)){if(!(0,L.array_equals)(n,S))return!0}else if(n instanceof Set&&S instanceof Set){if(!(0,L.set_equals)(n,S))return!0}else if(n instanceof Map&&S instanceof Map){if(!(0,L.map_equals)(n,S))return!0}else if(n!==S)return!0}return!1}G(I,"compare_requirements");const D=class D extends W.EventEmitter{constructor(f,u){super(),this.__context=null,f instanceof D?(this.parent=f,this.manager=f.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=f),this.manager.__contexts.push(this),this._context=u||{},this.__ls_listening=!1,this.__ls_wanted=new Map,this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const g of this.__profiles)g.off("changed",this._onChanged,this);const f=this.manager.__contexts,u=f.indexOf(this);u!==-1&&f.splice(u,1)}_watchLS(){this.__ls_listening||(this.__ls_listening=!0,this.manager.on(":ls-update",this._onLSUpdate,this))}_unwatchLS(){this.__ls_listening&&(this.__ls_listening=!1,this.manager.off(":ls-update",this._onLSUpdate,this))}_onLSUpdate(f){const u=this.__ls_wanted.get(`ls.${f}`);if(u)for(const g of u)this._update(g,g,[])}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const f=[],u=this.order=[];if(!this.manager.disable_profiles)for(const S of this.manager.__profiles)S.toggled&&S.matches(this.__context)&&(f.push(S),u.push(S.id));if((0,L.array_equals)(this.__profiles,f))return!1;const g=new Set;for(const S of this.__profiles)f.includes(S)||(S.off("changed",this._onChanged,this),g.add(S.id));for(const S of f)this.__profiles.includes(S)||(S.on("changed",this._onChanged,this),g.add(S.id));return this.__profiles=f,this.emit("profiles_changed"),this.rebuildCache(),!0}rebuildCache(){const f=this.__cache,u=this.__meta,g=this.__meta=new Map;this.__cache=new Map;for(const[S,n]of f){const s=this.get(S),i=g.get(S),l=u.get(S),w=i?i.uses:null,b=l?l.uses:null,r=this.manager.definitions.get(S);let e=!1;!Array.isArray(r)&&r?.equals?r.equals==="requirements"?e=I(r,this.__cache,f):typeof r.equals=="function"&&(e=!r.equals(s,n,this.__cache,f)):Array.isArray(s)&&Array.isArray(n)?e=!(0,L.array_equals)(s,n):s instanceof Set&&n instanceof Set?e=!(0,L.set_equals)(s,n):s instanceof Map&&n instanceof Map?e=!(0,L.map_equals)(s,n):s!==n&&(e=!0),e&&(this.emit("changed",S,s,n),this.emit(`changed:${S}`,s,n)),(0,L.array_equals)(w,b)||(this.emit("uses_changed",S,w,b),this.emit(`uses_changed:${S}`,w,b))}}context(f){return new D(this,f)}updateContext(f){let u=!1;for(const g in f)if((0,L.has)(f,g)){const S=f[g];try{if((0,L.deep_equals)(S,this._context[g]))continue}catch{}this._context[g]=S,u=!0}u&&this._rebuildContext()}setContext(f){this._context={},this.updateContext(f)}_onChanged(f){this._update(f,f,[])}_update(f,u,g){if(this.__cache.has(f)){if(g.includes(f))throw new Error(`cyclic dependent chain when updating setting "${u}"`)}else return;g.push(f);const S=this.__cache.get(f),n=this.__meta.get(f),s=this._get(f,f,[]),i=this.__meta.get(f),l=n?n.uses:null,w=i?i.uses:null;if((0,L.array_equals)(w,l)||(this.emit("uses_changed",f,w,l),this.emit(`uses_changed:${f}`,w,l)),S===s)return;this.emit("changed",f,s,S),this.emit(`changed:${f}`,s,S);const b=this.manager.definitions.get(f);if(!Array.isArray(b)&&b?.required_by)for(const r of b.required_by)!r.startsWith("context.")&&!r.startsWith("ls.")&&this._update(r,u,Array.from(g))}_get(f,u,g){if(g.includes(f))throw new Error(`cyclic dependency when resolving setting "${u}"`);g.push(f);const S=this.manager.definitions.get(f),n=!Array.isArray(S)&&S?.type,s=n?B.ZP[n]:B.ZP.basic;if(!s)throw new Error(`non-existent setting type "${n}"`);const i=this._getRaw(f,s),l={uses:i?i[1]:null};let w=i?i[0]:void 0;if(S){if(Array.isArray(S))throw new Error(`non-existent setting "${f}" required when resolving setting "${u}"`);if(l.uses===null){const b=S.default;typeof b=="function"?w=b(this):w=b,s.default&&(w=s.default(w,S,this.manager.log))}if(S.requires)for(const b of S.requires)if(b.startsWith("ls.")){this._watchLS();let r=this.__ls_wanted.get(b);r||this.__ls_wanted.set(b,r=new Set),r.add(f)}else!b.startsWith("context.")&&!this.__cache.has(b)&&this._get(b,u,Array.from(g));S.process&&(w=S.process(this,w,l))}return this.__cache.set(f,w),this.__meta.set(f,l),w}*profiles(){for(const f of this.__profiles)yield f}hasProfile(f){if(typeof f=="number"){for(const u of this.__profiles)if(u.id===f)return!0;return!1}return this.__profiles.includes(f)}_getRaw(f,u){if(!u)throw new Error(`non-existent type for ${f}`);return u.get(f,this.profiles(),this.manager.definitions.get(f),this.manager.log,this)}update(f){this._update(f,f,[])}get(f){return f.startsWith("ls.")?this.manager.getLS(f.slice(3)):f.startsWith("context.")?(0,L.get)(f.slice(8),this.__context):this.__cache.has(f)?this.__cache.get(f):this._get(f,f,[])}getChanges(f,u,g){this.onChange(f,u,g),u.call(g,this.get(f),void 0)}onChange(f,u,g){this.on(`changed:${f}`,u,g)}uses(f){return f.startsWith("ls.")||f.startsWith("context.")?null:(this.__meta.has(f)||this._get(f,f,[]),this.__meta.get(f)?.uses??null)}};G(D,"SettingsContext");let U=D},46162:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{AddonDebug:()=>e,And:()=>u,Category:()=>z,Channel:()=>y,Constant:()=>n,Debug:()=>r,Fullscreen:()=>w,If:()=>S,Invert:()=>f,Moderator:()=>b,Monitor:()=>o,NativeDarkTheme:()=>p,Or:()=>g,Page:()=>C,SquadMode:()=>a,TheaterMode:()=>l,Time:()=>i,Title:()=>$});var W=d(46949),L=d(37087),B=d(24431),I=d(68069);let U=null;function D(c){d.e(6530).then(d.t.bind(d,28820,23)).then(m=>{U=m.default,c&&c()})}G(D,"loadSafety");const v=G(()=>!1,"NeverMatch"),f={createTest(c,m,A){return(0,L.createTester)(c,m,!0,!1,A)},maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,9786))},u={createTest(c,m,A){return(0,L.createTester)(c,m,!1,!1,A)},childRules:!0,tall:!0,title:"And",i18n:"settings.filter.and",default:()=>[],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,9786))},g={createTest(c,m,A){return(0,L.createTester)(c,m,!1,!0,A)},childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,9786))},S={createTest(c,m,A){const h=(0,L.createTester)(c[0],m,!1,!1,A),T=(0,L.createTester)(c[1],m,!1,!1,A),R=(0,L.createTester)(c[2],m,!1,!1,A);return P=>h(P)?T(P):R(P)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,17907))},n={createTest(c){return c?()=>!0:v},title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))};function s(c){if(typeof c!="string"||!c.length)return null;const m=c.indexOf(":");if(m===-1)return null;let A,h;try{A=parseInt(c.slice(0,m),10),h=parseInt(c.slice(m+1),10)}catch{return null}return A*60+h}G(s,"parseTime");const i={_captured:new Set,createTest(c){const m=s(c[0]),A=s(c[1]);return m==null||A==null?v:m<=A?()=>{i._captured.add(m),i._captured.add(A+1);const h=new Date,T=h.getHours()*60+h.getMinutes();return T>=m&&T<=A}:()=>{i._captured.add(m+1),i._captured.add(A);const h=new Date,T=h.getHours()*60+h.getMinutes();return T>=m||T<=A}},captured:()=>{const c=Array.from(i._captured);return i._captured=new Set,c.sort((m,A)=>m-A),c},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,64e3))},l={createTest(c){return m=>m.fullscreen?c===!1:m.ui?.theatreModeEnabled===c},title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},w={createTest(c){return m=>m.fullscreen===c},title:"Fullscreen",i18n:"settings.filter.fullscreen",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},b={createTest(c){return m=>m.moderator===c},title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},r={createTest(c){return()=>B.DEBUG===c},title:"Is Developer Mode",i18n:"settings.filter.dev",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},e={createTest(c){return m=>m.addonDev==c},title:"Is Addon Developer Mode",i18n:"settings.filter.addon-dev",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},a={createTest(c){return m=>m.ui?.squadModeEnabled===c},title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},p={createTest(c){const m=c?1:0;return A=>A.ui?.theme===m},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))},C={createTest(c){if(!c)return v;const m=c.route,A=[];if(Object.keys(c.values).length){const h=window.FrankerFaceZ?.get(),T=h&&h.resolve("site.router");if(!T)return v;const R=T.getRoute(m);if(!R||!R.parts)return v;let P=1;for(const O of R.parts)if(typeof O=="object"){const M=c.values[O.name];M&&M.length&&A.push([P,M.toLowerCase()]),P++}}return h=>{if(!h.route||!h.route_data||h.route.name!==m)return!1;for(const[T,R]of A){let P=h.route_data[T];if(typeof P=="string"&&(P=P.toLowerCase()),P!==R)return!1}return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,38961))},y={createTest(c){const m=c?.login,A=c?.id;if(!A&&!m)return v;if(A){if(!m)return h=>h.channelID===A}else return h=>h.channel===m;return h=>h.channelID===A||h.channelID==null&&h.channel===m},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,69370))},z={createTest(c){const m=c?.name,A=c?.id;if(!A&&!m)return v;if(A){if(!m)return h=>h.categoryID===A}else return h=>h.category===m;return h=>h.categoryID===A||h.categoryID==null&&h.category===m},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,94344))},$={createTest(c,m,A){const h=c?.mode;let T=c?.title,R=!0;if(!T||!h)return v;if(h==="text")T=(0,W.escape_regex)(T),R=!1;else if(h==="glob")T=(0,W.glob_to_regex)(T);else if(h!=="raw")return v;if(R&&(U||D(A),!U||!U(T)))return v;let P;try{P=new RegExp(T,`g${c.sensitive?"":"i"}`)}catch{return v}return O=>(P.lastIndex=0,O.title?P.test(O.title):!1)},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,43922))};let o=null;window.getScreenDetails&&(o={_used:!1,details:void 0,used:()=>{const c=o._used;return o._used=!1,c},createTest(c,m,A){if(!c?.label)return v;if(o._used=!0,A&&o.details===void 0){const h=window.FrankerFaceZ??window.FFZBridge,T=h?.get(),R=T?.resolve("settings");R&&R.createMonitorUpdate().then(()=>{A()})}return()=>{o._used=!0;const h=o.details;if(!h)return!1;const T=h.screens;return(0,W.matchScreen)(T,c)===h.currentScreen}},default:()=>({label:null}),title:"Current Monitor",i18n:"settings.filter.monitor",editor:()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,57049))})},68069:(ae,J,d)=>{"use strict";d.d(J,{ZP:()=>i,eB:()=>s,lm:()=>I.Q});var W=d(24431),L=d(22527),B=d(46949),I=d(20857),U=d(81011),D=d(47458),v=d(33640),f=d(73617),u=d(46162),g=d(30020),S=d(76393);function n(b,r){try{return b.postMessage(r,"*"),!0}catch{return!1}}G(n,"postMessage");const s=["session"],w=class w extends L.default{constructor(r,e){super(r,e),this.provider=null,this._active_provider="local",this.disable_profiles=!1,this.providers={};for(const[a,p]of Object.entries(S.Cl))p.supported()&&(this.providers[a]=p);Object.seal(this.providers),this.updateSoon=(0,B.debounce)(()=>this.updateRoutes(),50,!1);try{const a=new URL(window.location).searchParams;a&&a.has("ffz-no-settings")&&(this.disable_profiles=!0)}catch{}this.__ls_scheduled=new Set,this.__ls_cache=new Map,this.__ls_hooked=!1,this._updateLS=this._updateLS.bind(this),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.__profile_uuids={},this.ui_structures=new Map,this.definitions=new Map,this.validators={};for(const a in f)(0,B.has)(f,a)&&(this.validators[a]=f[a]);this.processors={};for(const a in v)(0,B.has)(v,a)&&(this.processors[a]=v[a]);this.clearables={};for(const a in g)(0,B.has)(g,a)&&(this.clearables[a]=g[a]);this.filters={};for(const a in u)(0,B.has)(u,a)&&u[a]&&(this.filters[a]=u[a]);this._createProvider().then(a=>{this.provider=a,this.log.info(`Using Provider: ${a.constructor.name}`),a.on("changed",this._onProviderChange,this),a.on("quota-exceeded",p=>{this.emit(":quota-exceeded")}),a.on("change-provider",()=>{this.emit(":change-provider")}),this._provider_resolve&&this._provider_resolve(a)}),this.main_context=new D.Z(this),this.main_context.on("changed",(a,p,C)=>{this.emit(`:changed:${a}`,p,C)}),this.main_context.on("uses_changed",(a,p,C)=>{this.emit(`:uses_changed:${a}`,p,C)}),this.main_context.on("context_changed",()=>this._updateContextProxies()),this._context_proxies=new Set,window.addEventListener("message",a=>{const p=a.data?.ffz_type;p==="open-settings"?this.emit("main_menu:open"):p==="request-context"&&a.source&&(this._context_proxies.add(a.source),this._updateContextProxies(a.source))}),window.addEventListener("beforeunload",()=>{for(const a of this._context_proxies)n(a,{ffz_type:"context-gone"})}),this._start_time=performance.now(),this.enable()}_updateContextProxies(r){if(!r&&!this._context_proxies.size)return;const e=JSON.parse(JSON.stringify(this.main_context._context));for(const a of s)(0,B.has)(e,a)&&delete e[a];if(r)n(r,{ffz_type:"context-update",ctx:e});else for(const a of this._context_proxies)n(a,{ffz_type:"context-update",ctx:e})}addFilter(r,e){if(this.filters[r])return this.log.warn("Tried to add already existing filter",r);this.filters[r]=e,this.updateRoutes()}getFilterBasicEditor(){return()=>Promise.all([d.e(6530),d.e(6940),d.e(2086)]).then(d.bind(d,47178))}generateLog(){const r=[];for(const[e,a]of this.main_context.__cache.entries())r.push(`${e}: ${JSON.stringify(a)}`);return r.join(`
`)}awaitProvider(){return this.provider?Promise.resolve(this.provider):this._provider_waiter?this._provider_waiter:this._provider_waiter=new Promise((r,e)=>{this._provider_resolve=r}).finally(()=>{this._provider_waiter=null,this._provider_resolve=null})}async onEnable(){if(await this.awaitProvider(),!this.provider)throw new Error("did not get provider");await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const e of this.__contexts)e.selectProfiles();const r=performance.now()-this._start_time;this.log.info(`Initialization complete after ${r.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}async createMonitorUpdate(){const r=u?.Monitor;if(!(!r||r.details!==void 0)){r.details=null;try{window.getScreenDetails?(r.details=await window.getScreenDetails(),r.details.addEventListener("currentscreenchange",()=>{for(const e of this.__contexts)e.selectProfiles()})):r.details=!1}catch(e){this.log.error("Unable to get monitor details",e),r.details=!1}}}updateClock(){const r=u?.Time?.captured?.();if(!r?.length)return;this._time_timer&&clearTimeout(this._time_timer);const e=new Date,a=e.getHours()*60+e.getMinutes();let p=this._time_next!=null?this._time_next:null;for(const y of r)y<=a||(p==null||y<p)&&(p=y);p==null&&(p=r[0]+1440);const C=(p-a)*60*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout(()=>{for(const y of this.__contexts)y.selectProfiles();this.updateClock()},C)}_updateLSKey(r){(this.__ls_cache.has(r)||this.__ls_cache.has(`raw.${r}`))&&(this.__ls_scheduled.add(r),this.__ls_timer||(this.__ls_timer=setTimeout(this._updateLS,0)))}_hookLS(){if(this.__ls_hooked)return;this.__ls_hooked=!0;const r=localStorage.setItem,e=this;localStorage.setItem=function(a,...p){try{e._updateLSKey(a)}catch{}return r.call(this,a,...p)},this._handleLSEvent=this._handleLSEvent.bind(this),window.addEventListener("storage",this._handleLSEvent)}_handleLSEvent(r){r.key&&r.storageArea===localStorage&&this._updateLSKey(r.key)}_updateLS(){clearTimeout(this.__ls_timer),this.__ls_timer=null;const r=this.__ls_scheduled;this.__ls_scheduled=new Set;for(const e of r){const a=this.__ls_cache.has(e),p=`raw.${e}`,C=this.__ls_cache.has(p);if(!C&&!a)continue;const y=localStorage.getItem(e);if(C&&(this.__ls_cache.set(p,y),this.emit(":ls-update",p,y)),a){let z;if(y)try{z=JSON.parse(y)}catch($){this.log.warn(`Unable to parse localStorage value as JSON for "${e}"`,$)}this.__ls_cache.set(e,z),this.emit(":ls-update",e,z)}}}getLS(r){if(this.__ls_cache.has(r))return this.__ls_cache.get(r);this.__ls_hooked||this._hookLS();const e=r.startsWith("raw."),a=localStorage.getItem(e?r.slice(4):r);let p;if(e)p=a;else try{p=a?JSON.parse(a):null}catch(C){this.log.warn(`Unable to parse localStorage value as JSON for "${r}"`,C)}return this.__ls_cache.set(r,p),p}async generateBackupFile(){const r=new Date,e=`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`;if(await this._needsZipBackup()){const p=await this._getZipBackup();return new File([p],`ffz-settings (${e}).zip`,{type:"application/zip"})}const a=await this.getSettingsDump();return new File([JSON.stringify(a)],`ffz-settings (${e}).json`,{type:"application/json;charset=utf-8"})}async _needsZipBackup(){if(await this.awaitProvider(),!this.provider||(await this.provider.awaitReady(),!(this.provider instanceof S.i9)||!this.provider.supportsBlobs))return!1;const r=await this.provider.blobKeys();return Array.isArray(r)?r.length>0:!1}async _getZipBackup(){if(await this.awaitProvider(),!this.provider)throw new Error("provider not available");await this.provider.awaitReady();const r=(await d.e(935).then(d.t.bind(d,29597,23))).default,e=new r,a=await this.getSettingsDump();e.file("settings.json",JSON.stringify(a));const p={};if(this.provider instanceof S.i9&&this.provider.supportsBlobs){const C=await this.provider.blobKeys();for(const y of C){const z=encodeURIComponent(y),$=await this.provider.getBlob(y);if(!$)continue;const o={key:y};if($ instanceof File)o.type="file",o.name=$.name,o.modified=$.lastModified,o.mime=$.type;else if($ instanceof Blob)o.type="blob";else if($ instanceof ArrayBuffer)o.type="ab";else if($ instanceof Uint8Array)o.type="ui8";else continue;p[z]=o,e.file(`blobs/${z}`,$)}}return e.file("blobs.json",JSON.stringify(p)),e.generateAsync({type:"blob"})}async getSettingsDump(){if(await this.awaitProvider(),!this.provider)return null;await this.provider.awaitReady();const r={version:2,type:"full",values:{}};for(const[e,a]of this.provider.entries())r.values[e]=a;return r}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout(()=>this.checkUpdates(),5e3)}async checkUpdates(){if(await this.awaitProvider(),await this.provider?.awaitReady(),!this.provider?.shouldUpdate)return;const r=[];for(const p of this.__profiles){if(!p||!p.url||p.pause_updates)continue;const C=p.checkUpdate();r.push(C instanceof Promise?C:Promise.resolve(C))}const e=await Promise.all(r);let a=0;for(const p of e)p&&a++;this.log.info(`Successfully refreshed ${a} of ${e.length} profiles from remote URLs.`)}getProviders(){return this.providers}getActiveProvider(){return this._active_provider}async _createProvider(){let r=localStorage.ffzProviderv2;if(r==null&&(r=localStorage.ffzProviderv2=await this.sniffProvider()),this.providers[r]){const e=new this.providers[r](this);return this._active_provider=r,e}return this._active_provider="local",new S.PY(this)}async sniffProvider(){const r=Array.from(Object.entries(this.providers));r.sort((e,a)=>(a[1].priority??0)-(e[1].priority??0));for(const[e,a]of r)if(a.supported()&&await a.hasContent())return e;return"local"}async changeProvider(r,e){if(!this.providers[r]||!this.providers[r].supported())throw new Error(`Invalid provider: ${r}`);if(r===this._active_provider||!this.provider)return;const a=this.provider;if(this.provider=null,a.broadcastTransfer(),e){const p=new this.providers[r](this);if(await p.awaitReady(),p.allowTransfer&&a.allowTransfer){a.disableEvents(),p.clear(),p instanceof S.i9&&p.supportsBlobs&&await p.clearBlobs(),await p.flush();for(const[C,y]of a.entries())p.set(C,y);if(a instanceof S.i9&&a.supportsBlobs&&p instanceof S.i9&&p.supportsBlobs){for(const C of await a.blobKeys()){const y=await a.getBlob(C);y&&await p.setBlob(C,y)}await a.clearBlobs()}a.clear(),await a.flush(),await p.flush()}}localStorage.ffzProviderv2=r,location.reload()}_onProviderChange(r,e,a){if(r==="profiles")return this.loadProfiles();if(!r.startsWith("p:"))return;r=r.slice(2);const p=r.indexOf(":");if(p===-1)return;const C=this.__profile_ids[r.slice(0,p)],y=r.slice(p+1);C&&!C.ephemeral&&(y===":enabled"?C.emit("toggled",C,a?!0:e):C.emit("changed",y,e,a))}updateRoutes(){for(const r of this.__profiles)r.clearMatcher();for(const r of this.__contexts)r.selectProfiles();this.updateClock()}_onProfileToggled(r,e){for(const a of this.__contexts)a.selectProfiles();this.updateClock(),this.emit(":profile-toggled",r,e)}profile(r){return this.__profile_uuids[r]??this.__profile_ids[r]??null}loadProfiles(r=!1){const e=this.__profile_ids,a=this.__profile_uuids,p=this.__profiles,C=this.__profile_ids={},y=this.__profiles=[],z=this.__profile_uuids={},$=new Set(p.map(R=>R.id)),o=new Set,c=new Set;let m=this.provider?.get("profiles")??[U.Z.Moderation,U.Z.Default];m?.length||(this.provider?.delete("profiles"),m=[U.Z.Moderation,U.Z.Default]);let A=!1;for(const R of m)R.uuid||(A=!0,R.i18n_key===U.Z.Default.i18n_key?R.uuid=U.Z.Default.uuid:R.i18n_key===U.Z.Moderation.i18n_key?R.uuid=U.Z.Moderation.uuid:R.uuid=(0,B.generateUUID)());A&&this.provider?.set("profiles",m);let h=!1,T=!1;for(const R of p)R.off("toggled",this._onProfileToggled,this),R.hotkey_enabled=!1;for(const R of m){const P=R.id,O=y.length,M=e[P],j=M?p.indexOf(M):-1;if($.delete(P),j!==O&&(h=!0),M&&(0,B.deep_equals)(M.data,R,!0)){j!==O&&(T=!0),y.push(C[P]=M),z[M.uuid]=M;continue}const Y=C[P]=new U.Z(this,R);M?(M.transferListeners(Y),c.add(P)):o.add(P),y.push(Y),z[Y.uuid]=Y,T=!0}for(const R of y)R.on("toggled",this._onProfileToggled,this),R.hotkey_enabled=!0;if(!(!T&&!$.size||r)){for(const R of this.__contexts)R.selectProfiles();this.updateClock();for(const R of o)this.emit(":profile-created",C[R]);for(const R of c)this.emit(":profile-changed",C[R]);h&&this.emit(":profiles-reordered")}}createProfile(r={}){if(!this.enabled)throw new Error("Unable to create profile before settings have initialized. Please await enable()");if(r.id!==void 0)throw new Error("You cannot specify an ID when creating a profile.");let e=0;for(;this.__profile_ids[e];)r.ephemeral?e--:e++;r.id=e,r.uuid=(0,B.generateUUID)(),r.name||(r.name=`Unnamed Profile ${this.__profiles.length+1}`);const a=this.__profile_ids[e]=new U.Z(this,r);return this.__profile_uuids[r.uuid]=a,this.__profiles.unshift(a),a.on("toggled",this._onProfileToggled,this),a.hotkey_enabled=!0,a.ephemeral||this._saveProfiles(),this.emit(":profile-created",a),a}deleteProfile(r){if(!this.enabled)throw new Error("Unable to delete profile before settings have initialized. Please await enable()");if(typeof r=="object"&&typeof r.id=="number")r=r.id;else if(typeof r!="number")throw new Error("Invalid profile");const e=this.__profile_ids[r];if(!e)return;if(this.__profiles.length===1)throw new Error("cannot delete only profile");e.off("toggled",this._onProfileToggled,this),e.clear(),this.__profile_ids[r]=null,this.__profile_uuids[e.uuid]=null;const a=this.__profiles.indexOf(e);a!==-1&&this.__profiles.splice(a,1),e.ephemeral||this._saveProfiles(),this.emit(":profile-deleted",e)}moveProfile(r,e){if(!this.enabled)throw new Error("Unable to move profiles before settings have initialized. Please await enable()");if(typeof r=="object"&&typeof r.id=="number")r=r.id;else if(typeof r!="number")throw new Error("Invalid profile");const a=this.__profile_ids[r];if(!a)return;const p=this.__profiles,C=p.indexOf(a);C!==e&&(p.splice(e,0,...p.splice(C,1)),a.ephemeral||this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(r){if(!this.enabled)throw new Error("Unable to save profile before settings have initialized. Please await enable()");if(typeof r=="object"&&typeof r.id=="number")r=r.id;else if(typeof r!="number")throw new Error("Invalid profile");const e=this.__profile_ids[r];e&&(e.ephemeral||this._saveProfiles(),this.emit(":profile-changed",e))}_saveProfiles(){const r=this.__profiles.filter(e=>!e.ephemeral).map(e=>e.data);if(!r){this.createProfile({name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."});return}this.provider?.set("profiles",r);for(const e of this.__contexts)e.selectProfiles();this.updateClock()}context(r){return this.main_context.context(r)}get(r){return this.main_context.get(r)}getChanges(r,e,a){return this.main_context.getChanges(r,e,a)}onChange(r,e,a){return this.main_context.onChange(r,e,a)}uses(r){return this.main_context.uses(r)}update(r){return this.main_context.update(r)}updateContext(r){return this.main_context.updateContext(r)}setContext(r){return this.main_context.setContext(r)}getAddonProxy(r,e,a){if(!r)return this;const p={},C=W.DEBUG||e?.dev;return p.add=(y,z)=>this.add(y,z,r),p.addUI=(y,z)=>this.addUI(y,z,r),p.addClearable=(y,z)=>this.addClearable(y,z,r),(0,L.buildAddonProxy)(a,this,"settings",p)}add(r,e,a){const p=this.definitions.get(r),C=(Array.isArray(p)?p:p?.required_by)??[];e.required_by=C,e.requires=e.requires??[],e.__source=a;for(const y of e.requires){const z=this.definitions.get(y);Array.isArray(z)?z.push(r):z?z.required_by?.push(r):this.definitions.set(y,[r])}if(e.ui){const y=e.ui;if(y.path_tokens=y.path_tokens?l(y.path_tokens):y.path?(0,I.Q)(y.path):void 0,a&&y.path_tokens&&y.path_tokens.length>=2&&y.path_tokens[0].key==="add_ons"){const z=this.resolve("addons"),$=z?.getAddon(a);if($){const o=y.path_tokens[1],c=[];c.push(`add_ons.changelog.${a}`),$.short_name&&c.push(`add_ons.changelog.${$.short_name.toSnakeCase()}`),$.name&&c.push(`add_ons.changelog.${$.name.toSnakeCase()}`),o.header_links=[{navigate:c,i18n_key:"home.changelog",title:"Changelog"}]}}if(!y.key&&r&&(y.key=r),!y.key&&y.title&&(y.key=y.title.toSnakeCase()),(y.component==="setting-select-box"||y.component==="setting-combo-box")&&Array.isArray(y.data)&&!y.no_i18n){const z=`${y.i18n_key||`setting.entry.${r}`}.values`;for(const $ of y.data)$.i18n_key===void 0&&$.value!==void 0&&($.i18n_key=`${z}.${$.value}`)}}e.changed&&this.on(`:changed:${r}`,e.changed),this.definitions.set(r,e),(!p||Array.isArray(p))&&this.emit(":added-definition",r,e)}remove(r){const e=this.definitions.get(r);if(e&&!Array.isArray(e)){if(Array.isArray(e.required_by)&&e.required_by.length>0?this.definitions.set(r,e.required_by):this.definitions.delete(r),Array.isArray(e.requires))for(const a of e.requires){let p=this.definitions.get(a);if(Array.isArray(p)){const C=p.indexOf(r);C!==-1&&p.splice(C,1)}else p?.required_by&&(p=p.required_by)}e.changed&&this.off(`:changed:${r}`,e.changed),this.emit(":removed-definition",r,e)}}addUI(r,e,a){let p;e.ui?p=e:p={ui:e},p.__source=a;const C=p.ui;C.path_tokens=C.path_tokens?l(C.path_tokens):C.path?(0,I.Q)(C.path):void 0,!C.key&&C.title&&(C.key=C.title.toSnakeCase());const y=this.ui_structures.get(r);this.ui_structures.set(r,p),y||this.emit(":added-definition",r,p)}addClearable(r,e,a){if(typeof r=="object"){for(const[p,C]of Object.entries(r))this.addClearable(p,C,a);return}else if(typeof r!="string")throw new Error("invalid key");e&&(e.__source=a,this.clearables[r]=e)}getClearables(){return(0,B.deep_copy)(this.clearables)}addProcessor(r,e){if(typeof r=="object"){for(const[a,p]of Object.entries(r))this.addProcessor(a,p);return}else if(typeof r!="string")throw new Error("invalid key");e&&(this.processors[r]=e)}getProcessor(r){return this.processors[r]??null}getProcessors(){return(0,B.deep_copy)(this.processors)}addValidator(r,e){if(typeof r=="object"){for(const[a,p]of Object.entries(r))this.addValidator(a,p);return}else if(typeof r!="string")throw new Error("invalid key");e&&(this.validators[r]=e)}getValidator(r){return this.validators[r]??null}getValidators(){return(0,B.deep_copy)(this.validators)}};G(w,"SettingsManager");let i=w;function l(b){for(let r=0,e=b.length;r<e;r++){const a=b[r];if(typeof a=="string"){b[r]={key:a.toSnakeCase(),title:a};continue}a.key||(a.key=a.title.toSnakeCase())}return b}G(l,"format_path_tokens")},33640:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{to_float:()=>I,to_int:()=>B});const W=Symbol("BAD");function L(U,D,v){if((typeof U!="number"||isNaN(U)||!isFinite(U))&&(U=W),U!==W){const f=v.bounds;Array.isArray(f)&&(f.length>=3?((f[1]?U<f[0]:U<=f[0])||(f[3]?U>f[2]:U>=f[2]))&&(U=W):f.length===2?typeof f[1]=="boolean"?(f[1]?U<f[0]:U<=f[0])&&(U=W):(U<f[0]||U>f[1])&&(U=W):f.length===1&&U<f[0]&&(U=W))}return U===W?D:U}G(L,"do_number");const B=G((U,D,v)=>(typeof U=="string"&&/^-?\d+$/.test(U)?U=parseInt(U,10):typeof U!="number"&&(U=W),L(U,D,v)),"to_int"),I=G((U,D,v)=>(typeof U=="string"&&/^-?[\d.]+$/.test(U)?U=parseFloat(U):typeof U!="number"&&(U=W),L(U,D,v)),"to_float")},81011:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>I});var W=d(17159),L=d(46949),B=d(37087);const U=class U extends W.EventEmitter{constructor(v,f){super(),this._enabled=!1,this.ephemeral=!1,this.id=-1,this.uuid=null,this.name=null,this.pause_updates=!1,this.show_toggle=!1,this._hotkey_enabled=!1,this.onShortcut=this.onShortcut.bind(this),this._hotkey_enabled=!1,this.manager=v,this.provider=v.provider,this.data=f,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`,this.ephemeral&&(this._enabled=!0,this._storage=new Map)}get data(){return{id:this.id,uuid:this.uuid,name:this.name,i18n_key:this.i18n_key,hotkey:this.hotkey,pause_updates:this.pause_updates,ephemeral:this.ephemeral,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(v){if(typeof v!="object")throw new TypeError("data must be an object");this.clearMatcher(),v.ephemeral&&(this.ephemeral=!0);for(const[f,u]of Object.entries(v))this[f]=u}clearMatcher(){this.matcher=null}matches(v){return this.matcher||(this.matcher=(0,B.createTester)(this.context,this.manager.filters,!1,!1,()=>this.manager.updateSoon())),this.matcher(v)}save(){this.ephemeral||this.manager.saveProfile(this.id)}getBackup(){const v={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};delete v.profile.ephemeral;for(const[f,u]of this.entries())v.values[f]=u;return v}async checkUpdate(){if(!this.url||this.pause_updates)return!1;const v=await(0,L.fetchJSON)(this.url);if(!v||v.type!=="profile"||!v.profile||!v.values)return!1;delete v.profile.ephemeral,delete v.profile.id,delete v.profile.uuid,delete v.profile.name,delete v.profile.i18n_key,delete v.profile.hotkey,delete v.profile.description,delete v.profile.desc_i18n_key,delete v.profile.url,delete v.profile.pause_updates,this.data=v.profile;const f=new Set(this.keys());for(const[u,g]of Object.entries(v.values))f.delete(u),this.set(u,g);for(const u of f)this.delete(u);return!0}get hotkey(){return this._hotkey}set hotkey(v){v!==this._hotkey&&(this._hotkey=v,this._hotkey_enabled&&this._updateHotkey())}get hotkey_enabled(){return this._hotkey_enabled}set hotkey_enabled(v){this._hotkey_enabled=!!v,this._updateHotkey()}_updateHotkey(){const v=this.Mousetrap=this.Mousetrap||window.Mousetrap;if(!v)return;const f=this._hotkey;this._bound_key&&(this._bound_key!==f||!this._hotkey_enabled)&&(v.unbind(this._bound_key),this._bound_key=null),this._hotkey_enabled&&f&&(0,L.isValidShortcut)(f)&&(v.bind(f,this.onShortcut),this._bound_key=f)}onShortcut(v){this.toggled=!this.toggled,v&&(v.stopPropagation(),v.preventDefault())}get toggled(){return this.ephemeral?this._enabled:this.provider.get(this.enabled_key,!0)}set toggled(v){v!==this.toggled&&(this.ephemeral?this._enabled=v:this.provider.set(this.enabled_key,v),this.emit("toggled",this,v))}setContext(v){if(this.id===0)throw new Error("cannot set context of default profile");this.context=v,this.clearMatcher(),this.save()}get(v,f){return this.ephemeral?this._storage&&this._storage.has(v)?this._storage.get(v):f??null:this.provider.get(this.prefix+v,f)}set(v,f){this.ephemeral?this._storage&&this._storage.set(v,f):this.provider.set(this.prefix+v,f),this.emit("changed",v,f,!1)}delete(v){this.ephemeral?this._storage&&this._storage.delete(v):this.provider.delete(this.prefix+v),this.emit("changed",v,void 0,!0)}has(v){return this.ephemeral?this._storage?this._storage.has(v):!1:this.provider.has(this.prefix+v)}keys(){if(this.ephemeral)return this._storage?Array.from(this._storage.keys()):[];const v=[],f=this.prefix,u=f.length;for(const g of this.provider.keys())g.startsWith(f)&&g!==this.enabled_key&&v.push(g.slice(u));return v}clear(){if(this.ephemeral){if(this._storage){const u=this.keys();this._storage.clear();for(const g of u)this.emit("changed",g,void 0,!0)}return}const v=this.prefix,f=v.length;for(const u of this.provider.keys())u.startsWith(v)&&u!==this.enabled_key&&(this.provider.delete(u),this.emit("changed",u.slice(f),void 0,!0))}*entries(){if(this.ephemeral){if(this._storage)for(const v of this._storage.entries())yield v}else{const v=this.prefix,f=v.length;for(const u of this.provider.keys())u.startsWith(v)&&u!==this.enabled_key&&(yield[u.slice(f),this.provider.get(u)])}}get size(){if(this.ephemeral)return this._storage?this._storage.size:0;const v=this.prefix;let f=0;for(const u of this.provider.keys())u.startsWith(v)&&u!==this.enabled_key&&f++;return f}};G(U,"SettingsProfile");let I=U;I.Default={id:0,uuid:"ffz_profile_default",name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},I.Moderation={id:1,uuid:"ffz_profile_moderation",name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},76393:(ae,J,d)=>{var y,z;"use strict";d.d(J,{Cl:()=>b,PY:()=>S,i9:()=>u});var W=d(38626),L=d(17159),B=d(46949),I=d(24431);const U=1,D=window.location.host!=="www.twitch.tv",v=window.location.host!=="www.youtube.com",r=class r extends L.EventEmitter{constructor(o){super(),this.ready=!1,this.manager=o,this.disabled=!1}static supported(){return!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get allowTransfer(){return this.constructor.allowTransfer}get shouldUpdate(){return this.constructor.shouldUpdate}};G(r,"SettingsProvider");let f=r;f.priority=0,f.allowTransfer=!0,f.shouldUpdate=!0;const e=class e extends f{get supportsBlobs(){return!0}isValidBlob(o){return this.supportsBlobs&&(0,W.isValidBlob)(o)}};G(e,"AdvancedSettingsProvider");let u=e;const a=class a extends u{constructor(o){super(o),this._start_time=performance.now(),this._rpc=new Map,this._cached=new Map,this.resolved_ready=!1,this.ready=!1,this._ready_wait=null,this._blobs=null,this._last_id=0}get supportsBlobs(){return this._blobs??!1}broadcastTransfer(){}disableEvents(){}resolveReady(o,c){this.manager&&this.manager.log.info(`${this.constructor.name} ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.resolved_ready=!0,this.ready=o,o&&this._ready_wait_resolve?this._ready_wait_resolve():!o&&this._ready_wait_fail&&this._ready_wait_fail(c)}awaitReady(){return this.resolved_ready?this.ready?Promise.resolve():Promise.reject():this._ready_wait?this._ready_wait:this._ready_wait=new Promise((o,c)=>{this._ready_wait_resolve=o,this._ready_wait_fail=c}).finally(()=>{this._ready_wait=null,this._ready_wait_resolve=null,this._ready_wait_fail=null})}get(o,c){return this._cached.has(o)?this._cached.get(o):c}set(o,c){if(c===void 0){this.has(o)&&this.delete(o);return}this._cached.set(o,c),this.rpc({ffz_type:"set",key:o,value:c}).catch(m=>this.manager.log.error("Error setting value",m)),this.emit("set",o,c,!1)}delete(o){this._cached.delete(o),this.rpc({ffz_type:"delete",key:o}).catch(c=>this.manager.log.error("Error deleting value",c)),this.emit("set",o,void 0,!0)}clear(){const o=this._cached;this._cached=new Map;for(const c of o.keys())this.emit("changed",c,void 0,!0);this.rpc("clear").catch(c=>this.manager.log.error("Error clearing storage",c))}has(o){return this._cached.has(o)}keys(){return this._cached.keys()}entries(){return this._cached.entries()}get size(){return this._cached.size}async flush(){await this.rpc("flush")}async getBlob(o){const c=await this.rpc({ffz_type:"get-blob",key:o});return c?(0,W.deserializeBlob)(c):null}async setBlob(o,c){await this.rpc({ffz_type:"set-blob",key:o,value:await(0,W.serializeBlob)(c)})}async deleteBlob(o){await this.rpc({ffz_type:"delete-blob",key:o})}async hasBlob(o){return this.rpc({ffz_type:"has-blob",key:o})}async clearBlobs(){await this.rpc("clear-blobs")}async blobKeys(){return this.rpc("blob-keys")}rpc(o,c){const m=++this._last_id;return new Promise((A,h)=>{this._rpc.set(m,[A,h]);let T;typeof o=="string"?T={ffz_type:o}:T=o,T.id=m,this.send(T,c)})}handleMessage(o){o.ffz_type==="ready"?this.rpc("init-load").then(c=>{this._blobs=c.blobs;for(const[m,A]of Object.entries(c.values))this._cached.set(m,A);this.resolveReady(!0)}).catch(c=>{this.resolveReady(!1,c)}):o.ffz_type==="change"?this.onChange(o):o.ffz_type==="change-blob"?this.emit("changed-blob",o.key,o.deleted):o.ffz_type==="clear-blobs"?this.emit("clear-blobs"):o.ffz_type==="reply"||o.ffz_type==="reply-error"?this.onReply(o):this.manager.log.warn("Unknown Message",o.ffz_type,o)}onChange(o){const c=o.key,m=o.value;o.deleted?(this._cached.delete(c),this.emit("changed",c,void 0,!0)):(this._cached.set(c,m),this.emit("changed",c,m,!1))}onReply(o){const c=o.id,m=o.ffz_type==="reply",A=this._rpc.get(c);if(!A)return this.manager.log.warn("Received reply for unknown ID",c);this._rpc.delete(c),m?A[0](o.reply):A[1]()}};G(a,"RemoteSettingsProvider");let g=a;const p=class p extends f{constructor(o,c){super(o),this.prefix=c=c??"FFZ:setting:";const m=this._cached=new Map,A=c.length;for(const h in localStorage)if((0,B.has)(localStorage,h)&&h.startsWith(c)){const T=localStorage.getItem(h);if(T)try{m.set(h.slice(A),JSON.parse(T))}catch{this.manager.log.warn(`unable to parse value for ${h}`,T)}}this.ready=!0,window.BroadcastChannel?(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)):window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}static supported(){return!0}static hasContent(o){o||(o="FFZ:setting:");for(const c in localStorage)if(c.startsWith(o)&&(0,B.has)(localStorage,c))return!0;return!1}broadcastTransfer(){this.broadcast({type:"change-provider"})}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}destroy(){this.disable(),this._cached.clear()}disable(){this.removeListeners(),this.disabled=!0}flush(){}broadcast(o){this._broadcaster&&this._broadcaster.postMessage(o)}handleMessage(o){if(this.disabled||!o.isTrusted||!o.data)return;this.manager.log.debug("storage broadcast event",o.data);const{type:c,key:m}=o.data;if(c==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(c==="set"){const A=JSON.parse(localStorage.getItem(this.prefix+m)??"null");this._cached.set(m,A),this.emit("changed",m,A,!1)}else if(c==="delete")this._cached.delete(m),this.emit("changed",m,void 0,!0);else if(c==="clear"){const A=Array.from(this._cached.keys());this._cached.clear();for(const h of A)this.emit("changed",h,void 0,!0)}}handleStorage(o){if(!this.disabled&&(this.manager.log.debug("storage event",o),o.storageArea===localStorage&&o.key&&o.key.startsWith(this.prefix))){const c=o.key.slice(this.prefix.length);let m=o.newValue;m===null?(this._cached.delete(c),this.emit("changed",c,void 0,!0)):(m=JSON.parse(m),this._cached.set(c,m),this.emit("changed",c,m,!1))}}get(o,c){return this._cached.has(o)?this._cached.get(o):c}set(o,c){if(!this.disabled){if(c===void 0){this.has(o)&&this.delete(o);return}this._cached.set(o,c);try{localStorage.setItem(this.prefix+o,JSON.stringify(c))}catch(m){throw this.manager&&this.manager.log.error(`An error occurred while trying to save a value to localStorage for key "${this.prefix+o}"`),m&&/quota/i.test(m.toString())&&this.emit("quota-exceeded",m),m}this.broadcast({type:"set",key:o}),this.emit("set",o,c,!1)}}delete(o){this.disabled||(this._cached.delete(o),localStorage.removeItem(this.prefix+o),this.broadcast({type:"delete",key:o}),this.emit("set",o,void 0,!0))}has(o){return this._cached.has(o)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const o=this._cached;this._cached=new Map;for(const c of o.keys())localStorage.removeItem(this.prefix+c),this.emit("changed",c,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}};G(p,"LocalStorageProvider");let S=p;S.priority=-1e3,S.title="Local Storage",S.description="[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.";const C=class C extends u{constructor(o,c=!0){super(o),this._last_tx=0,this.getDB=(0,B.once)(this.getDB),this._start_time=performance.now(),this._pending=new Set,this._flush_wait=null,this._lock=new B.TicketLock,this._cached=new Map,this.ready=!1,this._ready_wait=null,c&&(window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._ready_wait=this.loadSettings().then(()=>{this.manager&&this.manager.log.info(`IDB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.ready=!0}).catch(m=>{this.manager&&this.manager.log.error(`IDB failed after ${(performance.now()-this._start_time).toFixed(5)}ms:`,m),this.ready=!1}).finally(()=>{this._ready_wait=null}))}static supported(){return window.indexedDB!=null}static hasContent(){return new Promise(o=>{const c=window.indexedDB.open("FFZ",U);c.onerror=()=>o(!1),c.onupgradeneeded=m=>{m.target instanceof IDBRequest&&m.target.transaction?.abort(),o(!1)},c.onsuccess=()=>{const m=c.result;let A;try{A=m.transaction(["settings"],"readonly").objectStore("settings")}catch{return o(!1)}const h=A.getAllKeys();h.onerror=()=>{m.close(),o(!1)},h.onsuccess=()=>{const T=Array.isArray(h.result)&&h.result.length>0;return m.close(),o(T)}}})}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this.removeListeners(),this.db&&(this.db.close(),this.db=null)}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null)}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}_onStart(o){this._pending||(this._pending=new Set),this._pending.add(o)}_onFinish(o){this._pending&&(this._pending.delete(o),this._pending.size)||this._flush_wait_resolve&&this._flush_wait_resolve()}flush(){return this._flush_wait?this._flush_wait:!this._pending||!this._pending.size?Promise.resolve():this._flush_wait=new Promise(o=>{this._flush_wait_resolve=o}).finally(()=>{this._flush_wait_resolve=null,this._flush_wait=null})}broadcast(o){this._broadcaster&&this._broadcaster.postMessage(o)}handleMessage(o){if(this.disabled||!o.isTrusted||!o.data)return;this.manager&&this.manager.log.debug("storage broadcast event",o.data);const{type:c,key:m}=o.data;if(c==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(c==="set")this._get(m).then(A=>{this._cached.set(m,A),this.emit("changed",m,A,!1)}).catch(A=>this.manager&&this.manager.log.error(`Error getting setting "${m}" from database`,A));else if(c==="delete")this._cached.delete(m),this.emit("changed",m,void 0,!0);else if(c==="clear"){const A=Array.from(this._cached.keys());this._cached.clear();for(const h of A)this.emit("changed",h,void 0,!0)}else c==="set-blob"?this.emit("changed-blob",m,!1):c==="delete-blob"?this.emit("changed-blob",m,!0):c==="clear-blobs"&&this.emit("clear-blobs")}awaitReady(){return this._ready_wait?this._ready_wait:this.ready?Promise.resolve():Promise.reject()}get(o,c){return this._cached.has(o)?this._cached.get(o):c}set(o,c){if(!this.disabled){if(c===void 0){this.has(o)&&this.delete(o);return}this._cached.set(o,c),this._set(o,c).then(()=>this.broadcast({type:"set",key:o})).catch(m=>this.manager&&this.manager.log.error(`Error saving setting "${o}" to database`,m)),this.emit("set",o,c,!1)}}delete(o){this.disabled||(this._cached.delete(o),this._delete(o).catch(c=>this.manager&&this.manager.log.error(`Error deleting setting "${o}" from database`,c)).then(()=>this.broadcast({type:"delete",key:o})),this.emit("set",o,void 0,!0))}has(o){return this._cached.has(o)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const o=this._cached;this._cached=new Map;for(const c of o.keys())this.emit("changed",c,void 0,!0);this._clear().catch(c=>this.manager&&this.manager.log.error("Error clearing database",c)).then(()=>this.broadcast({type:"clear"}))}entries(){return this._cached.entries()}get size(){return this._cached.size}getDB(o=!1){if(this.db)return Promise.resolve(this.db);if(this._db_wait)return this._db_wait;let c;return this._db_wait=c=new Promise((m,A)=>{const h=window.indexedDB.open("FFZ",U);this._onStart(h),h.onerror=T=>{this.manager&&this.manager.log.error("Error opening database.",T),A(T),this._onFinish(h)},h.onupgradeneeded=T=>{this.manager&&this.manager.log.info(`Upgrading database from version ${T.oldVersion} to ${U}`);const R=h.result;R.createObjectStore("settings",{keyPath:"k"}),R.createObjectStore("blobs")},h.onsuccess=()=>{this.manager&&this.manager.log.info(`Database opened. (After: ${(performance.now()-this._start_time).toFixed(5)}ms)`),this.db=h.result;try{const T=this.db.transaction(["settings","blobs"],"readonly");T.objectStore("settings"),T.objectStore("blobs")}catch(T){this.manager&&this.manager.log.error("Database in invalid state.",T);try{this.db.close()}catch{}if(this._onFinish(h),this.db=null,o)A(T);else{const R=window.indexedDB.deleteDatabase("FFZ");this._onStart(R),R.onerror=P=>{this.manager&&this.manager.log.error("Error deleting invalid database.",P),A(P),this._onFinish(R)},R.onsuccess=()=>{this.manager&&this.manager.log.info("Deleted invalid database."),this._onFinish(R),this._db_wait=null,this.getDB(!0).then(m).catch(A)}}return}m(this.db),this._onFinish(h)}}).finally(()=>{c===this._db_wait&&(this._db_wait=null)})}async loadSettings(){const o=await this.getDB(),c=o.transaction(["settings"],"readonly"),m=c.objectStore("settings"),A=this._last_tx++;return this._onStart(A),new Promise((h,T)=>{c.onabort=P=>{this.manager&&this.manager.log.error("Transaction aborted reading settings from database.",P),this._onFinish(A),T()};const R=m.getAll();R.onsuccess=()=>{for(const P of R.result)this._cached.set(P.k,P.v);this._onFinish(A),h()},R.onerror=P=>{this.manager&&this.manager.log.error("Error reading settings from database.",P),this._onFinish(A),T()}})}async _getKeys(){const o=await this.getDB(),c=o.transaction(["settings"],"readonly"),m=c.objectStore("settings"),A=this._last_tx++;return this._onStart(A),new Promise((h,T)=>{c.onabort=P=>{this.manager&&this.manager.log.error("Transaction aborted reading keys from database.",P),this._onFinish(A),T()};const R=m.getAllKeys();R.onsuccess=()=>{this._onFinish(A),h(R.result)},R.onerror=P=>{this.manager&&this.manager.log.error("Error reading keys from database.",P),this._onFinish(A),T()}})}async _get(o){const c=await this.getDB(),m=c.transaction(["settings"],"readonly"),A=m.objectStore("settings"),h=this._last_tx++;return this._onStart(h),new Promise((T,R)=>{m.onabort=O=>{this.manager&&this.manager.log.error("Transaction aborted reading value from database.",O),this._onFinish(h),R()};const P=A.get(o);P.onerror=O=>{this.manager&&this.manager.log.error("Error reading value from database.",O),this._onFinish(h),R()},P.onsuccess=()=>{this._onFinish(h),T(P.result.v)}})}async _set(o,c){if(this.disabled)return;const m=this._last_tx++;this._onStart(m);const A=await this._lock.wait(),h=await this.getDB(),T=h.transaction(["settings"],"readwrite"),R=T.objectStore("settings");return new Promise((P,O)=>{T.onabort=j=>{this.manager&&this.manager.log.error("Transaction aborted setting value to database.",j),A(),this._onFinish(m),O()};const M=R.put({k:o,v:c});M.onerror=j=>{this.manager&&this.manager.log.error("Error setting value to database.",j),A(),this._onFinish(m),O()},M.onsuccess=()=>{A(),this._onFinish(m),P()}})}async _delete(o){if(this.disabled)return;const c=this._last_tx++;this._onStart(c);const m=await this._lock.wait(),A=await this.getDB(),h=A.transaction(["settings"],"readwrite"),T=h.objectStore("settings");return new Promise((R,P)=>{h.onabort=M=>{this.manager&&this.manager.log.error("Transaction aborted deleting value from database.",M),m(),this._onFinish(c),P()};const O=T.delete(o);O.onerror=M=>{this.manager&&this.manager.log.error("Error deleting value from database.",M),m(),this._onFinish(c),P()},O.onsuccess=()=>{m(),this._onFinish(c),R()}})}async _clear(){if(this.disabled)return;const o=this._last_tx++;this._onStart(o);const c=await this._lock.wait(),m=await this.getDB(),A=m.transaction(["settings"],"readwrite"),h=A.objectStore("settings");return new Promise((T,R)=>{A.onabort=O=>{this.manager&&this.manager.log.error("Transaction aborted clearing database.",O),c(),this._onFinish(o),R()};const P=h.clear();P.onerror=O=>{this.manager&&this.manager.log.error("Error clearing database.",O),c(),this._onFinish(o),R()},P.onsuccess=()=>{c(),this._onFinish(o),T()}})}async getBlob(o){const c=await this.getDB(),m=c.transaction(["blobs"],"readonly"),A=m.objectStore("blobs");return new Promise((h,T)=>{const R=A.get(o);this._onStart(R),R.onerror=()=>{T(),this._onFinish(R)},R.onsuccess=P=>{(0,W.isValidBlob)(R.result)?h(R.result):T(),this._onFinish(R)}})}async setBlob(o,c){if(this.disabled)return;if(!this.isValidBlob(c))throw new Error("Invalid blob type");const m=await this.getDB(),A=m.transaction(["blobs"],"readwrite"),h=A.objectStore("blobs");return new Promise((T,R)=>{const P=h.put(c,o);this._onStart(P),P.onerror=()=>{R(),this._onFinish(P)},P.onsuccess=()=>{T(),this.broadcast({type:"set-blob",key:o}),this.emit("set-blob",o,c,!1),this._onFinish(P)}})}async deleteBlob(o){if(this.disabled)return;const c=await this.getDB(),m=c.transaction(["blobs"],"readwrite"),A=m.objectStore("blobs");return new Promise((h,T)=>{const R=A.delete(o);this._onStart(R),R.onerror=()=>{T(),this._onFinish(R)},R.onsuccess=()=>{h(),this.broadcast({type:"delete-blob",key:o}),this.emit("set-blob",o,void 0,!0),this._onFinish(R)}})}async hasBlob(o){return(await this.blobKeys()).includes(o)}async clearBlobs(){if(this.disabled)return;const o=await this.getDB(),c=o.transaction(["blobs"],"readwrite"),m=c.objectStore("blobs");return new Promise((A,h)=>{const T=m.clear();this._onStart(T),T.onerror=()=>{h(),this._onFinish(T)},T.onsuccess=()=>{A(),this.broadcast({type:"clear-blobs"}),this._onFinish(T)}})}async blobKeys(){const o=await this.getDB(),c=o.transaction(["blobs"],"readonly"),m=c.objectStore("blobs");return new Promise((A,h)=>{const T=m.getAllKeys();this._onStart(T),T.onerror=()=>{h(),this._onFinish(T)},T.onsuccess=()=>{Array.isArray(T.result)?A(T.result):h(),this._onFinish(T)}})}};G(C,"IndexedDBProvider");let n=C;n.priority=10,n.title="IndexedDB",n.description="[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.";const s=(y=class extends g{constructor(o){super(o);const c=this.frame=document.createElement("iframe");c.src=this.manager.root.host==="youtube"?"//www.youtube.com/__ffz_bridge/":"//www.twitch.tv/p/ffz_bridge/",c.id="ffz-settings-bridge",c.style.width="0",c.style.height="0",this.onMessage=this.onMessage.bind(this),window.addEventListener("message",this.onMessage),document.body.appendChild(c)}static supported(){return D&&v}static hasContent(){return y.supported()}broadcastTransfer(){}disableEvents(){}onMessage(o){const c=o.data;!c||!c.ffz_type||this.handleMessage(c)}send(o,c){typeof o=="string"&&(o={ffz_type:o});try{this.frame.contentWindow.postMessage(o,"*",c?Array.isArray(c)?c:[c]:void 0)}catch(m){this.manager.log.error("Error sending message to bridge.",m,o,c)}}},G(y,"_CrossOriginStorageBridge2"),y);s.priority=100,s.title="Cross-Origin Storage Bridge",s.description="This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don't want your settings to automatically synchronize for some reason.",s.allowTransfer=!1,s.shouldUpdate=!1;let i=s;const l=(z=class extends g{static supported(){return I.EXTENSION}static hasContent(){return z.supported()?new Promise(o=>{let c=!1,m=null;const A=G(T=>{if(T.source===window&&T.data&&T.data.type==="ffz_from_ext"){const R=T.data.data;R?.ffz_type==="has-keys"&&(c=!0,o(R.value),h())}},"listener"),h=G(()=>{c||(c=!0,o(!1)),m&&(clearTimeout(m),m=null),window.removeEventListener("message",A)},"cleanup");window.addEventListener("message",A),window.postMessage({type:"ffz_to_ext",data:{ffz_type:"check-has-keys"}},"*"),m=setTimeout(h,1e3)}):!1}constructor(o){super(o),this.onExtMessage=this.onExtMessage.bind(this),window.addEventListener("message",this.onExtMessage)}broadcastTransfer(){}disableEvents(){}onExtMessage(o){o.source===window&&o.data?.type==="ffz_from_ext"&&o.data.data?.ffz_type&&this.handleMessage(o.data.data)}send(o,c){typeof o=="string"&&(o={ffz_type:o});try{window.postMessage({type:"ffz_to_ext",data:o},"*",c?Array.isArray(c)?c:[c]:void 0)}catch(m){this.manager.log.error("Error sending message to extension.",m,o,c)}}},G(z,"_ExtensionProvider2"),z);l.priority=101,l.title="Browser Extension Storage",l.description="This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.",l.allowTransfer=!0,l.shouldUpdate=!0;let w=null;const b={local:S,idb:n,cosb:i}},39602:(ae,J,d)=>{"use strict";d.d(J,{ZP:()=>D});const W=Symbol("default"),D={basic:{get(v,f){for(const u of f)if(u.has(v))return[u.get(v),[u.id]]}},object_merge:{get(v,f,u,g){const S=[],n=[];for(const s of f)if(s.has(v)){const i=s.get(v);if(!i||typeof i!="object"){g.warn(`Profile #${s.id} has an invalid value for "${v}" of type ${typeof i}. Skipping.`);continue}n.push(s.id),S.unshift(i)}if(n.length)return[Object.assign({},...S),n]}},basic_array_merge:{get(v,f,u,g){const S=[],n=[];for(const s of f)if(s.has(v)){const i=s.get(v);if(!Array.isArray(i)){g.warn(`Profile #${s.id} has an invalid value for "${v}"`);continue}n.push(s.id);for(const l of i)S.push(l)}if(n.length)return[S,n]}},array_merge:{default(v){const f=[];for(const u of v)u.t!=="inherit"&&u.t!=="skip"&&u.v&&f.push(u.v);return f},get(v,f,u,g,S){const n=[],s=[];let i=[],l=!1,w=f;u.inherit_default&&(w=[...f,W]);for(const b of w){let r;if(b===W)r=u.default,typeof r=="function"&&(r=r(S));else if(b.has(v))r=b.get(v);else continue;if(!Array.isArray(r)){b!==W&&g.warn(`Profile #${b.id} has an invalid value for "${v}" of type ${typeof r}. Skipping.`);continue}const e=[];b!==W&&s.push(b.id);let a=!1;for(const p of r)if(l=!0,p.t==="inherit")a=!0;else{if(p.t==="skip")continue;a?e.push(p.v):n.push(p.v)}if(i=e.concat(i),!a&&!u.always_inherit)break}if(l)return[n.concat(i),s]}}}},73617:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{process_to_float:()=>B,process_to_int:()=>L});function W(I,U){if(typeof I!="number"||isNaN(I)||!isFinite(I))return!1;const D=U.bounds;if(Array.isArray(D)){if(D.length>=3){if((D[1]?I<D[0]:I<=D[0])||(D[3]?I>D[2]:I>=D[2]))return!1}else if(D.length===2){if(typeof D[1]=="boolean"){if(D[1]?I<D[0]:I<=D[0])return!1}else if(I<D[0]||I>D[1])return!1}else if(D.length===1&&I<D[0])return!1}return!0}G(W,"do_number");const L=G((I,U)=>{if(typeof I=="string"&&/^-?\d+$/.test(I))I=parseInt(I,10);else if(typeof I!="number")return!1;return W(I,U)},"process_to_int"),B=G((I,U)=>{if(typeof I=="string"&&/^-?[\d.]+$/.test(I))I=parseFloat(I);else if(typeof I!="number")return!1;return W(I,U)},"process_to_float")},34923:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>L});var W=d(22527);const B=class B extends W.default{constructor(U,D){super(U,D),this.settings=null,this.site=null,this.fine=null,this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.LoadableComponent=this.fine.define("loadable-component",v=>v.props?.component&&v.props.loader),this.ErrorBoundaryComponent=this.fine.define("error-boundary-component",v=>v.props?.name&&v.props?.onError&&v.props?.children&&v.onErrorBoundaryTestEmit),this.overrides=new Map}onEnable(){this.settings.getChanges("chat.hype.show-pinned",U=>{this.toggle("PaidPinnedChatMessageList",U)}),this.settings.getChanges("layout.turbo-cta",U=>{this.toggle("TopNav__TurboButton_Available",U)}),this.ErrorBoundaryComponent.ready((U,D)=>{this.log.debug("Found Error Boundary component wrapper.");const v=this,f=U.prototype,u=f.render;f._ffz_wrapped_render=u,f.render=function(){try{const g=this.props.name;if(v.overrides.has(g)&&!v.shouldRender(g))return null}catch(g){console.error(g)}return u.call(this)},this.ErrorBoundaryComponent.updateInstances()}),this.LoadableComponent.ready((U,D)=>{this.log.debug("Found Loadable component wrapper.");const v=this,f=U.prototype,u=f.render;f.render=function(){try{const g=this.props.component;if(v.overrides.has(g)&&this.state){let S=this.state.Component;if(typeof S=="function"&&!S.ffzWrapped){const n=v.site.getReact(),s=n&&n.createElement;if(s){if(!S.ffzWrapper){let i=G(function(w){return v.shouldRender(l.props.component)?s(S,w):null},"FFZWrapper");const l=this;i.ffzWrapped=!0,i.displayName=`FFZWrapper(${this.props.component})`,S.ffzWrapper=i}this.state.Component=S.ffzWrapper}}}}catch(g){console.error(g)}return u.call(this)},this.LoadableComponent.updateInstances()})}toggle(U,D=null){const v=this.overrides.get(U)??!0;D==null?D=!v:D=!!D,D!==v&&(this.overrides.set(U,D),this.update(U))}update(U){for(const D of this.LoadableComponent.instances){const v=D.props?.component;v&&v===U&&D.forceUpdate()}for(const D of this.ErrorBoundaryComponent.instances){const v=D.props?.name;v&&v===U&&D.forceUpdate()}}shouldRender(U){return this.overrides.get(U)??!0}};G(B,"Loadable");let L=B},70052:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{default:()=>B});var W=d(22527),L=d(44589);const I=class I extends W.default{constructor(D,v){super(D,v),this.i18n=null,this.fine=null,this.settings=null,this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.settings.add("sub-button.prime-notice",{default:!0,ui:{path:"Channel > Metadata >> Subscription",title:"Show Prime Reminder",description:"Display a crown on subscription buttons when your free channel sub with Prime is available.",component:"setting-check-box"},changed:()=>this.SubButton.forceUpdate()}),this.SubButton=this.fine.define("sub-button",f=>f.handleSubMenuAction&&f.openSubModal,["user","user-home","user-video","user-clip","video","user-videos","user-clips","user-collections","user-events","user-followers","user-following"])}onEnable(){this.settings.on(":changed:layout.swap-sidebars",()=>this.SubButton.forceUpdate()),this.SubButton.ready((D,v)=>{for(const f of v)this.updateSubButton(f)}),this.SubButton.on("mount",this.updateSubButton,this),this.SubButton.on("update",this.updateSubButton,this)}updateSubButton(D){const v=this.fine.getChildNode(D),f=v?.querySelector('button[data-a-target="subscribe-button"]');if(!f)return;const u=D.props,g=u.data&&u.data.user,S=g&&g.self,n=this.settings.get("sub-button.prime-notice")&&S&&S.canPrimeSubscribe&&!S.subscriptionBenefit,s=f.querySelector(".ffz--can-prime");if(n&&!s)f.insertBefore((0,L.createElement)("span",{class:"tw-button__icon tw-button__icon--left ffz--can-prime"},(0,L.createElement)("figure",{class:"ffz-i-crown ffz-tooltip","data-title":this.i18n.t("sub-button.prime","Your free channel sub with Prime is available.")})),f.firstElementChild),f.appendChild((0,L.createElement)("span",{class:"ffz--post-prime"}));else if(!n&&s){s.remove();const i=f.querySelector(".ffz--post-prime");i&&i.remove()}}};G(I,"SubButton");let B=I},38626:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{deserializeBlob:()=>B,isValidBlob:()=>W,serializeBlob:()=>L});function W(I){return I instanceof Blob||I instanceof File||I instanceof ArrayBuffer||I instanceof Uint8Array}G(W,"isValidBlob");async function L(I){if(!I)return null;if(I instanceof Blob)return{type:"blob",mime:I.type,buffer:await I.arrayBuffer()};if(I instanceof File)return{type:"file",mime:I.type,name:I.name,modified:I.lastModified,buffer:await I.arrayBuffer()};if(I instanceof ArrayBuffer)return{type:"ab",buffer:I};if(I instanceof Uint8Array)return{type:"u8",buffer:I.buffer};throw new TypeError("Invalid type")}G(L,"serializeBlob");function B(I){if(!I||!I.type)return null;if(I.type==="blob")return new Blob([I.buffer],{type:I.mime});if(I.type==="file")return new File([I.buffer],I.name,{type:I.mime,lastModified:I.modified});if(I.type==="ab")return I.buffer;if(I.type==="u8")return new Uint8Array(I.buffer);throw new TypeError("Invalid type")}G(B,"deserializeBlob")},14873:(ae,J,d)=>{var l;"use strict";d.r(J),d.d(J,{Color:()=>g,ColorAdjuster:()=>S,bit2linear:()=>L,hue2rgb:()=>W,linear2bit:()=>B});function W(r,e,a){return a<0&&(a+=1),a>1&&(a-=1),a<.16666666666666666?r+(e-r)*6*a:a<.5?e:a<.6666666666666666?r+(e-r)*(.6666666666666666-a)*6:r}G(W,"hue2rgb");function L(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}G(L,"bit2linear");function B(r){return r<=.0031308?r*12.92:Math.pow(1.055*r,.4166666666666667)-.055}G(B,"linear2bit");const n=class n{constructor(e,a,p,C){this.r=e||0,this.g=a||0,this.b=p||0,this.a=C||0}eq(e,a=!1){return e instanceof n?this.r===e.r&&this.g===e.g&&this.b===e.b&&(a||this.a===e.a):e?this.eq(e.toRGBA(),a):!1}_r(e){return new n(e,this.g,this.b,this.a)}_g(e){return new n(this.r,e,this.b,this.a)}_b(e){return new n(this.r,this.g,e,this.a)}_a(e){return new n(this.r,this.g,this.b,e)}static fromName(e){const a=g.getContext();a.clearRect(0,0,1,1),a.fillStyle=e,a.fillRect(0,0,1,1);const p=a.getImageData(0,0,1,1);return p?.data?.length!==4?null:new n(p.data[0],p.data[1],p.data[2],p.data[3]/255)}static fromCSS(e){return e=e&&e.trim(),e?.length?e.charAt(0)==="#"?n.fromHex(e):n.fromName(e):null}static fromHex(e){e.charAt(0)==="#"&&(e=e.slice(1));let a,p=255;return e.length===4?(p=parseInt(e[3],16)*17,e=e.slice(0,3)):e.length===8&&(p=parseInt(e.slice(6),16),e=e.slice(0,6)),e.length===3?a=(parseInt(e[0],16)*17<<16)+(parseInt(e[1],16)*17<<8)+parseInt(e[2],16)*17:a=parseInt(e,16),new n(a>>16,a>>8&255,a&255,p/255)}static fromHSVA(e,a,p,C){let y,z,$;const o=Math.floor(e*6),c=e*6-o,m=p*(1-a),A=p*(1-c*a),h=p*(1-(1-c)*a);switch(o%6){case 0:y=p,z=h,$=m;break;case 1:y=A,z=p,$=m;break;case 2:y=m,z=p,$=h;break;case 3:y=m,z=A,$=p;break;case 4:y=h,z=m,$=p;break;default:y=p,z=m,$=A}return new n(Math.round(Math.min(Math.max(0,y*255),255)),Math.round(Math.min(Math.max(0,z*255),255)),Math.round(Math.min(Math.max(0,$*255),255)),C===void 0?1:C)}static fromHSLA(e,a,p,C){if(a===0){const $=Math.round(Math.min(Math.max(0,255*p),255));return new n($,$,$,C===void 0?1:C)}const y=p<.5?p*(1+a):p+a-p*a,z=2*p-y;return new n(Math.round(Math.min(Math.max(0,255*W(z,y,e+.3333333333333333)),255)),Math.round(Math.min(Math.max(0,255*W(z,y,e)),255)),Math.round(Math.min(Math.max(0,255*W(z,y,e-.3333333333333333)),255)),C===void 0?1:C)}static fromXYZA(e,a,p,C){const y=3.240479*e-1.53715*a-.498535*p,z=-.969256*e+1.875992*a+.041556*p,$=.055648*e-.204043*a+1.057311*p;return new n(Math.max(0,Math.min(255,255*B(y))),Math.max(0,Math.min(255,255*B(z))),Math.max(0,Math.min(255,255*B($))),C===void 0?1:C)}toCSS(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:this.toHex()}toHex(){return`#${((Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)).toString(16).padStart(6,"0")}`}toRGBA(){return this}toHSVA(){return U.fromRGBA(this.r,this.g,this.b,this.a)}toHSLA(){return D.fromRGBA(this.r,this.g,this.b,this.a)}toXYZA(){return f.fromRGBA(this.r,this.g,this.b,this.a)}toLUVA(){return this.toXYZA().toLUVA()}get_Y(){return(.299*this.r+.587*this.g+.114*this.b)/255}luminance(){const e=L(this.r/255),a=L(this.g/255),p=L(this.b/255);return .2126*e+.7152*a+.0722*p}brighten(e){return e=typeof e=="number"?e:1,e=Math.round(255*(e/100)),new n(Math.max(0,Math.min(255,this.r+e)),Math.max(0,Math.min(255,this.g+e)),Math.max(0,Math.min(255,this.b+e)),this.a)}daltonize(e){let a;if(typeof e=="string")if(g.CVDMatrix.hasOwnProperty(e))a=g.CVDMatrix[e];else throw new Error("Invalid CVD matrix");else a=e;const p=a[0],C=a[1],y=a[2],z=a[3],$=a[4],o=a[5],c=a[6],m=a[7],A=a[8],h=17.8824*this.r+43.5161*this.g+4.11935*this.b,T=3.45565*this.r+27.1554*this.g+3.86714*this.b,R=.0299566*this.r+.184309*this.g+1.46709*this.b,P=p*h+C*T+y*R,O=z*h+$*T+o*R,M=c*h+m*T+A*R;let j=.0809444479*P+-.130504409*O+.116721066*M,Y=-.0102485335*P+.0540193266*O+-.113614708*M,ee=-.000365296938*P+-.00412161469*O+.693511405*M;j=this.r-j,Y=this.g-Y,ee=this.b-ee;const X=0*j+0*Y+0*ee,Q=.7*j+1*Y+0*ee,te=.7*j+0*Y+1*ee;return j=Math.min(Math.max(0,X+this.r),255),Y=Math.min(Math.max(0,Q+this.g),255),ee=Math.min(Math.max(0,te+this.b),255),new n(j,Y,ee,this.a)}};G(n,"RGBAColor");let I=n;const s=class s{constructor(e,a,p,C){this.h=e||0,this.s=a||0,this.v=p||0,this.a=C||0}eq(e,a=!1){return e instanceof s?this.h===e.h&&this.s===e.s&&this.v===e.v&&(a||this.a===e.a):e?this.eq(e.toHSVA(),a):!1}_h(e){return new s(e,this.s,this.v,this.a)}_s(e){return new s(this.h,e,this.v,this.a)}_v(e){return new s(this.h,this.s,e,this.a)}_a(e){return new s(this.h,this.s,this.v,e)}static fromRGBA(e,a,p,C){e/=255,a/=255,p/=255;const y=Math.max(e,a,p),z=Math.min(e,a,p),$=Math.min(Math.max(0,y-z),1),o=y===0?0:$/y,c=y;let m;if($===0)m=0;else{switch(y){case e:m=(a-p)/$+(a<p?6:0);break;case a:m=(p-e)/$+2;break;default:m=(e-a)/$+4}m/=6}return new s(m,o,c,C===void 0?1:C)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromHSVA(this.h,this.s,this.v,this.a)}toHSVA(){return this}toHSLA(){return this.toRGBA().toHSLA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}};G(s,"HSVAColor");let U=s;const i=class i{constructor(e,a,p,C){this.h=e||0,this.s=a||0,this.l=p||0,this.a=C||0}eq(e,a=!1){return e instanceof i?this.h===e.h&&this.s===e.s&&this.l===e.l&&(a||this.a===e.a):e?this.eq(e.toHSLA(),a):!1}_h(e){return new i(e,this.s,this.l,this.a)}_s(e){return new i(this.h,e,this.l,this.a)}_l(e){return new i(this.h,this.s,e,this.a)}_a(e){return new i(this.h,this.s,this.l,e)}static fromRGBA(e,a,p,C){e/=255,a/=255,p/=255;const y=Math.max(e,a,p),z=Math.min(e,a,p),$=Math.min(Math.max(0,(y+z)/2),1),o=Math.min(Math.max(0,y-z),1);let c,m;if(o===0)c=m=0;else{switch(m=$>.5?o/(2-y-z):o/(y+z),y){case e:c=(a-p)/o+(a<p?6:0);break;case a:c=(p-e)/o+2;break;default:c=(e-a)/o+4}c/=6}return new i(c,m,$,C===void 0?1:C)}toCSS(){const e=this.a;return`hsl${e!==1?"a":""}(${Math.round(this.h*360)},${Math.round(this.s*100)}%,${Math.round(this.l*100)}%${e!==1?`,${this.a}`:""})`}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromHSLA(this.h,this.s,this.l,this.a)}toHSLA(){return this}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}targetLuminance(e){let a=this.s,p=0,C=1;a*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;let y=(C-p)/2,z=p+y;for(;y>152587890625e-16;y/=2,z=p+y)I.fromHSLA(this.h,a,z,1).luminance()>e?C=z:p=z;return new i(this.h,a,z,this.a)}};G(i,"HSLAColor");let D=i;const v=(l=class{constructor(e,a,p,C){this.x=e||0,this.y=a||0,this.z=p||0,this.a=C||0}eq(e,a=!1){return e instanceof l?this.x===e.x&&this.y===e.y&&this.z===e.z&&(a||this.a===e.a):e?this.eq(e.toXYZA(),a):!1}_x(e){return new l(e,this.y,this.z,this.a)}_y(e){return new l(this.x,e,this.z,this.a)}_z(e){return new l(this.x,this.y,e,this.a)}_a(e){return new l(this.x,this.y,this.z,e)}static fromRGBA(e,a,p,C){const y=L(e/255),z=L(a/255),$=L(p/255);return new l(.412453*y+.35758*z+.180423*$,.212671*y+.71516*z+.072169*$,.019334*y+.119193*z+.950227*$,C===void 0?1:C)}static fromLUVA(e,a,p,C){const y=1/(l.WHITE.x+15*l.WHITE.y+3*l.WHITE.z),z=4*l.WHITE.x*y,$=9*l.WHITE.y*y,o=e>8?Math.pow((e+16)/116,3):e/l.KAPPA,c=1/3*(52*e/(a+13*e*z)-1),m=-5*o,A=-1/3,h=o*(39*e/(p+13*e*$)-5),T=(h-m)/(c-A),R=T*c+m;return new l(T,o,R,C===void 0?1:C)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromXYZA(this.x,this.y,this.z,this.a)}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this}toLUVA(){return u.fromXYZA(this.x,this.y,this.z,this.a)}},G(l,"_XYZAColor2"),l);v.EPSILON=Math.pow(.20689655172413793,3),v.KAPPA=Math.pow(9.666666666666666,3),v.WHITE=null;let f=v;f.WHITE=new I(255,255,255,1).toXYZA();const w=class w{constructor(e,a,p,C){this.l=e||0,this.u=a||0,this.v=p||0,this.a=C||0}eq(e,a=!1){return e instanceof w?this.l===e.l&&this.u===e.u&&this.v===e.v&&(a||this.a===e.a):e?this.eq(e.toLUVA(),a):!1}_l(e){return new w(e,this.u,this.v,this.a)}_u(e){return new w(this.l,e,this.v,this.a)}_v(e){return new w(this.l,this.u,e,this.a)}_a(e){return new w(this.l,this.u,this.v,e)}static fromXYZA(e,a,p,C){const y=1/(f.WHITE.x+15*f.WHITE.y+3*f.WHITE.z),z=4*f.WHITE.x*y,$=9*f.WHITE.y*y,o=a/f.WHITE.y;let c=e+15*a+3*p;c===0&&(c=1);const m=1/c,A=4*e*m,h=9*a*m,T=o>f.EPSILON?116*Math.pow(o,1/3)-16:f.KAPPA*o,R=13*T*(A-z),P=13*T*(h-$);return new w(T,R,P,C===void 0?1:C)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return this.toXYZA().toRGBA()}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return f.fromLUVA(this.l,this.u,this.v,this.a)}toLUVA(){return this}};G(w,"LUVAColor");let u=w;const g={CVDMatrix:{protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]},getCanvas(){return g._canvas||(g._canvas=document.createElement("canvas")),g._canvas},getContext:()=>(g._context||(g._context=g.getCanvas().getContext("2d")),g._context),RGBA:I,HSVA:U,HSLA:D,XYZA:f,LUVA:u,fromCSS(r){return I.fromCSS(r)}},b=class b{constructor(e="#232323",a=0,p=4.5){this._dark=!1,this._cache=new Map,this._luv=0,this._luma=0,this._contrast=p,this._base=e,this._mode=a,this.rebuildContrast()}get contrast(){return this._contrast}set contrast(e){this._contrast=e,this.rebuildContrast()}get base(){return this._base}set base(e){this._base=e,this.rebuildContrast()}get dark(){return this._dark}get mode(){return this._mode}set mode(e){this._mode=e,this.rebuildContrast()}rebuildContrast(){this._cache=new Map;const e=I.fromCSS(this._base);if(!e)throw new Error("Invalid base color");const a=e.luminance();(this._dark=a<.5)?(this._luv=new f(0,this._contrast*(e.toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luma=this._contrast*(e.luminance()+.05)-.05):(this._luv=new f(0,(e.toXYZA().y+.05)/this._contrast-.05,0,1).toLUVA().l,this._luma=(e.luminance()+.05)/this._contrast-.05)}process(e,a=!1){if(!e)return null;if(this._mode===-1)return"";if(typeof e!="string"&&(e=e.toCSS()),this._mode===0)return e;if(this._cache.has(e))return this._cache.get(e);let p;try{p=I.fromCSS(e)}catch(y){if(a)throw y;return null}if(!p)return null;if(this._mode===1){const y=p.luminance();(this._dark?y<this._luma:y>this._luma)&&(p=p.toHSLA().targetLuminance(this._luma).toRGBA())}else if(this._mode===2){const y=p.toLUVA();(this._dark?y.l<this._luv:y.l>this._luv)&&(p=y._l(this._luv).toRGBA())}else if(this._mode===3)if(this._dark)for(;p.get_Y()<.5;){const y=p.toHSLA();p=y._l(Math.min(Math.max(0,.1+.9*y.l),1)).toRGBA()}else for(;p.get_Y()>=.5;){const y=p.toHSLA();p=y._l(Math.min(Math.max(0,.9*y.l),1)).toRGBA()}else if(this._mode===4){let y=0;if(this._dark)for(;p.luminance()<.15&&y++<127;)p=p.brighten();else for(;p.luminance()>.3&&y++<127;)p=p.brighten(-1)}const C=p.toCSS();return this._cache.set(e,C),C}};G(b,"ColorAdjuster");let S=b},45866:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>U});var W=d(72167),L=d.n(W),B=d(22527),I=d(46949);const D=class D extends B.default{constructor(f,u){super(f,u),this.fine=null,this.inject("..fine"),this.__routes=[],this.routes={},this.route_names={},this.current=null,this.current_name=null,this.current_state=null,this.match=null,this.location=null}onEnable(f=0){const u=this.fine.searchTree(null,n=>n?.props?.history);if(this.history=u?.props?.history,this.history){this.history.listen(n=>{this.enabled&&this._navigateTo(n)}),this._navigateTo(this.history.location);return}const g=this.fine.searchNode(null,n=>n?.pendingProps?.router?.subscribe);this.router=g?.pendingProps?.router;const S=this.fine.searchNode(null,n=>n?.pendingProps?.navigator?.push);if(this.navigator=S?.pendingProps?.navigator,!this.router||!this.navigator)return f>100&&(this.log.warn("Finding React's router is taking a long time."),f=-500),(0,I.sleep)(50).then(()=>this.onEnable(f+1));this.router.subscribe(n=>{this.enabled&&n?.location&&this._navigateTo(n.location)}),this._navigateTo(this.router.router.state.location)}navigate(f,u,g,S){const n=this.getURL(f,u,g);this.push(n,S)}get reactLocation(){if(this.history)return this.history.location;if(this.router)return this.router.router.state.location}push(f,u){if(this.history)this.history.push(f,u);else if(this.navigator)this.navigator.push(f,u);else throw new Error("unable to push new route")}replace(f,u){if(this.history)this.history.replace(f,u);else if(this.navigator)this.navigator.replace(f,u);else throw new Error("unable to replace route")}_navigateTo(f){this.log.debug("New Location",f);const u=window.location.host,g=f.pathname,S=f.search,n=f.state;g===this.location&&u===this.domain&&S===this.search&&(0,I.deep_equals)(n,this.current_state)||(this.old_location=this.location,this.old_search=this.search,this.old_domain=this.domain,this.old_state=this.current_state,this.location=g,this.search=S,this.domain=u,this.current_state=n,this._pickRoute())}_pickRoute(){const f=this.location,u=this.domain;this.old_route=this.current,this.old_name=this.current_name,this.old_match=this.match;for(const g of this.__routes){if(g.domain&&g.domain!==u)continue;const S=g.regex.exec(f);if(S&&(!g.state_fn||g.state_fn(this.current_state))){this.log.debug("Matching Route",g,S),this.current=g,this.current_name=g.name,this.match=S,this.emit(":route",g,S);return}}this.current=this.current_name=this.match=null,this.emit(":route",null,null)}getURL(f,u,g,...S){const n=this.routes[f];if(!n)throw new Error(`unable to find route "${f}"`);if(typeof u!="object"){const s=[u,g,...S];u={};let i=0;for(const l of n.parts)if(l&&l.name&&(u[l.name]=s[i],i++,i>=s.length))break}return n.url(u,g)}getRoute(f){return this.routes[f]}getRoutes(){return this.routes}getRouteNames(){for(const f of Object.keys(this.getRoutes()))this.getRouteName(f);return this.route_names}getRouteName(f){return this.route_names[f]||(this.route_names[f]=f.replace(/^dash-([a-z])/,(u,g)=>`Dashboard: ${g.toLocaleUpperCase()}`).replace(/(^|-)([a-z])/g,(u,g,S)=>`${g?" ":""}${S.toLocaleUpperCase()}`)),this.route_names[f]}routeName(f,u,g=!0){if(typeof f=="object"){for(const S in f)(0,I.has)(f,S)&&this.routeName(S,f[S],!1);g&&this.emit(":updated-route-names");return}u&&(this.route_names[f]=u,g&&this.emit(":updated-route-names"))}route(f,u,g=null,S=null,n=!0){if(typeof f=="object"){g=u;for(const w in f)(0,I.has)(f,w)&&this.route(w,f[w],g,S,!1);n&&(this.__routes.sort((w,b)=>b.score-w.score),this.location&&this._pickRoute(),this.emit(":updated-routes"));return}const s=(0,W.parse)(u),i=s.reduce((w,b)=>w+(typeof b=="string"?b.split("/").length-1:0),0),l=this.routes[f]={name:f,parts:s,score:i,domain:g,state_fn:S,regex:(0,W.tokensToRegExp)(s),url:(0,W.tokensToFunction)(s)};this.__routes.push(l),n&&(this.__routes.sort((w,b)=>b.score-w.score),this.location&&this._pickRoute(),this.emit(":updated-routes"))}};G(D,"FineRouter");let U=D},98247:(ae,J,d)=>{"use strict";d.d(J,{Z:()=>B});var W=d(17159),L=d(22527);const D=class D extends L.default{constructor(u,g){super(u,g),this._route=null,this._wrappers=new Map,this._known_classes=new Map,this._observer=null,this._waiting=[],this._live_waiting=null}async onEnable(u=0){this.root_element||(this.root_element=await this.parent.awaitElement(this.selector||"body #root"));let g=this.root_element?._reactRootContainer;if(g?._internalRoot?.current&&(g=g?._internalRoot),g?.current){this.react_root=g,this.react=g?.current?.child;return}if(this.root_element&&!g){let S=D.findAccessor(this.root_element,"__reactContainer");if(S){this.react_root=null,this.react=this.root_element[S];return}}if(u>500)throw new Error("Unable to find React after 25 seconds");return this.root_element=null,new Promise(S=>setTimeout(S,50)).then(()=>this.onEnable(u+1))}onDisable(){this.react_root=this.root_element=this.react=this.accessor=null}static findAccessor(u,g){for(const S in u)if(g?S.startsWith(`${g}$`):S.startsWith("__reactInternalInstance$")||S.startsWith("__reactFiber$"))return S;return null}resolveNode(u){return!u&&this.react?this.react:u instanceof Node?this.getReactInstance(u):u?._reactInternals?u._reactInternals:u?._reactInternalFiber?u._reactInternalFiber:u||null}getReactInstance(u){return this.accessor||(this.accessor=D.findAccessor(u)),this.accessor?u[this.accessor]??u._reactRootContainer?._internalRoot?.current??u._reactRootContainer?.current??null:null}getOwner(u){return u=this.resolveNode(u),u?.return??null}getParentNode(u,g=100,S=!1){return this.searchParent(u,n=>n instanceof Node,g,0,S)}getChildNode(u,g=100,S=!1){return this.searchTree(u,n=>n instanceof Node,g,0,S)}getHostNode(u,g=100){return this.getChildNode(u,g)}getParent(u){return this.getOwner(u)}getFirstChild(u){return this.resolveNode(u)?.child??null}getChildren(u){const g=this.resolveNode(u);if(!g)return[];const S=[];let n=g.child;for(;n;)S.push(n),n=n.sibling;return S}searchParent(u,g,S=15,n=0,s=!0){if(n>S)return null;const i=this.resolveNode(u);if(!i)return null;if(typeof g=="string"){const w=this._wrappers.get(g);if(!w)throw new Error("invalid critera");if(!w.class)return null;g=G(b=>b&&b.constructor===w.class,"criteria")}const l=i.stateNode;if(l&&g(l,i))return l;if(i.return){const w=this.searchParent(i.return,g,S,n+1,s);if(w)return w}if(s&&l?.containerInfo){const w=l.containerInfo?.parentElement,b=w&&this.getReactInstance(w);if(b){const r=this.searchParent(b,g,S,n+1,s);if(r)return r}}return null}searchParentNode(u,g,S=15,n=0,s=!0){if(n>S)return null;const i=this.resolveNode(u);if(!i)return null;if(g(i))return i;if(i.return){const w=this.searchParentNode(i.return,g,S,n+1,s);if(w)return w}const l=i.stateNode;if(s&&l?.containerInfo){const w=l.containerInfo?.parentElement,b=w&&this.getReactInstance(w);if(b){const r=this.searchParentNode(b,g,S,n+1,s);if(r)return r}}return null}searchNode(u,g,S=15,n=0,s=!0){if(n>S)return null;const i=this.resolveNode(u);if(!i)return null;if(g(i))return i;if(i._ffz_no_scan||i.stateNode?._ffz_no_scan)return null;let l=i.child;for(;l;){const b=this.searchNode(l,g,S,n+1,s);if(b)return b;l=l.sibling}const w=i.stateNode;if(s&&w?.props?.root){const b=w.props.root._reactRootContainer;if(b){let r=b._internalRoot?.current||b.current;for(;r;){const e=this.searchNode(r,g,S,n+1,s);if(e)return e;r=r.sibling}}}return null}searchTree(u,g,S=15,n=0,s=!0,i){const l=this.resolveNode(u);if(i&&!(i instanceof Set)&&(i=new Set),!l||n>S)return i||null;if(typeof g=="string"){const r=this._wrappers.get(g);if(!r)throw new Error("invalid critera");if(!r.class)return i||null;g=G(e=>e&&e.constructor===r.class,"criteria")}const w=l.stateNode;if(w&&g(w,l))if(i)i.add(w);else return w;if(l._ffz_no_scan||l.stateNode?._ffz_no_scan)return i||null;let b=l.child;for(;b;){const r=this.searchTree(b,g,S,n+1,s,i);if(r&&!i)return r;b=b.sibling}if(s&&w?.props?.root){const r=w.props.root._reactRootContainer;if(r){let e=r._internalRoot?.current||r.current;for(;e;){const a=this.searchTree(e,g,S,n+1,s,i);if(a&&!i)return a;e=e.sibling}}}return i||null}findAllMatching(u,g,S=15,n=!0,s=!1,i=0,l=!0){const w=new Set;let b=G((r,e)=>!w.has(r)&&g(r,e),"crit");for(;;){const r=s?this.searchParent(u,b,S,i,l):this.searchTree(u,b,S,i,l);if(!r)break;if(n&&!w.size){const e=r.constructor;b=G((a,p)=>!w.has(a)&&a instanceof e&&g(a,p),"crit")}w.add(r)}return w}searchAll(u,g,S=15,n=0,s=null,i=!0){const l=this.resolveNode(u);if(s||(s={seen:new Set,classes:g.map(()=>null),out:g.map(()=>({cls:null,instances:new Set,depth:null})),max_depth:n}),!l||n>S)return s.out;n>s.max_depth&&(s.max_depth=n);const w=l.stateNode;if(w){const r=w.constructor,e=s.classes.indexOf(r);if(e!==-1)s.out[e].instances.add(w);else if(!s.seen.has(r)){let a=g.length;for(;a-- >0;)if(g[a](w,l)){s.classes[a]=s.out[a].cls=r,s.out[a].instances.add(w),s.out[a].depth=n;break}s.seen.add(r)}}if(l._ffz_no_scan||l.stateNode?._ffz_no_scan)return s.out;let b=l.child;for(;b;)this.searchAll(b,g,S,n+1,s,i),b=b.sibling;if(i&&w?.props?.root){const r=w.props.root._reactRootContainer;if(r){let e=r._internalRoot&&r._internalRoot.current||r.current;for(;e;)this.searchAll(e,g,S,n+1,s,i),e=e.sibling}}return s.out}route(u){this._route=u,this._updateLiveWaiting()}_updateLiveWaiting(){const u=this._live_waiting=[],g=this._waiting_crit=[],S=this._route;if(this._waiting)for(const n of this._waiting)n.routes===!1||!n.criteria||(!S||!n.routes?.length||n.routes.includes(S))&&(u.push(n),g.push(n.criteria));this._live_waiting.length?this._waiting_timer||this._startWaiting():this._stopWaiting()}define(u,g,S=null){if(this._wrappers.has(u))return this._wrappers.get(u);if(!g)throw new Error("cannot find definition and no criteria provided");const n=new U(u,g,S,this);this._wrappers.set(u,n);const s=this.react?this.searchAll(this.react,[g],1e3)[0]:null;return s?.cls?(n._set(s.cls,s.instances),this._known_classes.set(s.cls,n)):S!==!1&&(this._waiting.push(n),this._updateLiveWaiting()),n}wrap(u,g){let S;if(this._wrappers.has(u)?S=this._wrappers.get(u):(S=new U(u,null,null,this),this._wrappers.set(u,S)),g){if(S.class||S.criteria)throw new Error("tried setting a class on an already initialized FineWrapper");S._set(g,new Set),this._known_classes.set(g,S)}return S}_checkWaiters(u=null){if(this._live_waiting){Array.isArray(u)||(u=[u]);for(let g of u){if(!this._live_waiting.length||!this._waiting_crit)break;let S=null;if(!g&&this.react?S=this.react:g instanceof Node?S=this.getReactInstance(g):g?._reactInternals?S=g._reactInternals:g?._reactInternalFiber&&(S=g._reactInternalFiber),!S||S._ffz_no_scan||S.stateNode?._ffz_no_scan)continue;const n=this.searchAll(S,this._waiting_crit,1e3);let s=n.length;for(;s-- >0;)if(n[s].cls){const i=n[s],l=this._live_waiting.splice(s,1)[0];this._waiting_crit.splice(s,1);const w=this._waiting.indexOf(l);w!==-1&&this._waiting.splice(w,1),this.log.debug(`Found class for "${l.name}" at depth ${i.depth}`),l._set(i.cls,i.instances)}}this._live_waiting.length||this._stopWaiting()}}_startWaiting(){this.log.info("Installing MutationObserver."),this._waiting_timer=setInterval(()=>this._checkWaiters(),500),this._observer||(this._observer=new MutationObserver(u=>this._checkWaiters(u.map(g=>g.target)))),this._observer.observe(document.body,{childList:!0,subtree:!0})}_stopWaiting(){this.log.info("Stopping MutationObserver."),this._observer&&this._observer.disconnect(),this._waiting_timer&&clearInterval(this._waiting_timer),this._live_waiting=null,this._waiting_crit=null,this._waiting_timer=null}};G(D,"Fine");let B=D;const I={"will-mount":"UNSAFE_componentWillMount",mount:"componentDidMount",render:"render","receive-props":"UNSAFE_componentWillReceiveProps","should-update":"shouldComponentUpdate","will-update":"UNSAFE_componentWillUpdate",update:"componentDidUpdate",unmount:"componentWillUnmount"},v=class v extends W.EventEmitter{constructor(u,g,S,n){super(),this.name=u,this.criteria=g,this.fine=n,this.instances=new Set,this.routes=S??[],this._wrapped=new Map,this._class=null}get class(){return this._class}get first(){return this.toArray()[0]}__cleanListeners(){const u=super.__cleanListeners();for(const g of u){const S=I[g];if(S)try{this._unwrap(S)}catch{}}return u}toArray(){return Array.from(this.instances)}check(u=null,g=1e3){if(this._class||!this.criteria)return;const S=this.fine.findAllMatching(u,this.criteria,g);if(S.size){const n=Array.from(S);this._set(n[0].constructor,n)}}ready(u){this._class?u(this._class,this.instances):this.once("set",u)}each(u){for(const g of this.instances)u(g)}updateInstances(u=null,g=1e3){if(!this._class)return;const S=this.fine.findAllMatching(u,n=>n.constructor===this._class,g);for(const n of S)n._ffz_mounted=!0,this.instances.add(n)}_set(u,g){if(this._class)throw new Error("already have a class");this._class=u,u._ffz_wrapper=this;const S=this,n=this.instances,s=u.prototype,i=s.UNSAFE_componentWillMount,l=s.componentWillUnmount,w=s.UNSAFE_componentWillMount=i?function(...r){return this._ffz_mounted=!0,n.add(this),S.emit("will-mount",this,...r),i.apply(this,r)}:function(...r){this._ffz_mounted=!0,n.add(this),S.emit("will-mount",this,...r)},b=s.componentWillUnmount=l?function(...r){return S.emit("unmount",this,...r),n.delete(this),this._ffz_mounted=!1,l.apply(this,r)}:function(...r){S.emit("unmount",this,...r),n.delete(this),this._ffz_mounted=!1};this._wrapped.set("UNSAFE_componentWillMount",[w,i]),this._wrapped.set("componentWillUnmount",[b,l]);for(const r of this.events())this._maybeWrap(r);if(g)for(const r of g)r._ffz_mounted=!0,n.add(r);this.emit("set",u,n)}_add(u){for(const g of u)this.instances.add(g)}_maybeWrap(u){const g=I[u];!this._class||!g||this._wrapped.has(g)||this._wrap(u,g)}_wrap(u,g){if(this._wrapped.has(g)||!this._class)return;const S=this,n=this._class.prototype,s=n[g],i=n[g]=s?function(...l){return this._ffz_mounted||(this._ffz_mounted=!0,S.instances.add(this),S.emit("late-mount",this)),S.emit(u,this,...l),s.apply(this,l)}:g==="shouldComponentUpdate"?function(...l){return this._ffz_mounted||(this._ffz_mounted=!0,S.instances.add(this),S.emit("late-mount",this)),S.emit(u,this,...l),!0}:function(...l){this._ffz_mounted||(this._ffz_mounted=!0,S.instances.add(this),S.emit("late-mount",this)),S.emit(u,this,...l)};this._wrapped.set(g,[i,s])}_unwrap(u){const g=this._wrapped.get(u);if(!g||!this._class)return;const S=this._class.prototype,[n,s]=g;if(S[u]!==n)throw new Error("unable to unwrap -- prototype modified");S[u]=s,this._wrapped.delete(u)}forceUpdate(){for(const u of this.instances)try{u.forceUpdate(),this.fine.emit("site:dom-update",this.name,u)}catch(g){g instanceof Error&&this.fine.log.capture(g,{tags:{fine_wrapper:this.name}}),this.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`,g)}}on(u,g,S,n,s=!1){return this._maybeWrap(u),super.on(u,g,S,n,s)}once(u,g,S,n,s=!1){return this._maybeWrap(u),super.once(u,g,S,n,s)}many(u,g,S,n,s,i=!1){return this._maybeWrap(u),super.many(u,g,S,n,s,i)}waitFor(u,g,S,n=!1){return this._maybeWrap(u),super.waitFor(u,g,S,n)}};G(v,"FineWrapper");let U=v},24431:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{API_SERVER:()=>D,BAD_HOTKEYS:()=>s,DEBUG:()=>W,EMQX_SERVERS:()=>$,EXTENSION:()=>L,EmoteTypes:()=>O,IS_FIREFOX:()=>A,IS_OSX:()=>o,IS_WEBKIT:()=>m,IS_WIN:()=>c,KEYS:()=>b,KNOWN_CODES:()=>e,LINK_DATA_HOSTS:()=>y,NEW_API:()=>u,PUBSUB_CLUSTERS:()=>z,REPLACEMENTS:()=>p,REPLACEMENT_BASE:()=>a,RERENDER_SETTINGS:()=>i,RESOLVERS_REQUIRE_TOS:()=>M,SENTRY_ID:()=>g,SERVER:()=>B,SERVER_OR_EXT:()=>U,STAGING_API:()=>v,STAGING_CDN:()=>f,TWITCH_EMOTE_V2:()=>r,TWITCH_GLOBAL_SETS:()=>T,TWITCH_POINTS_SETS:()=>R,TWITCH_PRIME_SETS:()=>P,UPDATE_BADGE_SETTINGS:()=>l,UPDATE_TOKEN_SETTINGS:()=>w,WEBKIT_CSS:()=>h,WEIRD_EMOTE_SIZES:()=>n,WORD_SEPARATORS:()=>S,WS_CLUSTERS:()=>C});const W=localStorage.ffzDebugMode==="true"&&document.body.classList.contains("ffz-dev"),L=!0,B=W?"https://localhost:8000":"https://cdn2.frankerfacez.com";let I=`${B}/script`;L&&(I=d.p,I.endsWith("/")&&(I=I.slice(0,I.length-1)));const U=I,D="https://api.frankerfacez.com",v="https://api-staging.frankerfacez.com",f="https://cdn-staging.frankerfacez.com",u="https://api2.frankerfacez.com",g="https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2",S="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]",n={15:[21,27],16:[22,27],17:[20,27],18:[20,27],22:[19,27],25:[25,28],26:[20,27],28:[39,27],30:[29,27],32:[21,27],33:[25,32],34:[21,28],36:[36,30],40:[21,27],41:[19,27],46:[24,24],47:[24,24],50:[18,27],52:[32,32],65:[40,30],66:[20,27],69:[41,28],73:[21,30],74:[24,30],86:[36,30],87:[24,30],92:[23,30],244:[24,30],354:[20,30],357:[28,30],360:[22,30],483:[20,18],484:[20,22],485:[27,18],486:[21,32],487:[15,32],488:[29,24],489:[20,18],490:[20,18],491:[20,18],492:[20,18],493:[20,18],494:[20,18],495:[20,18],496:[20,18],497:[20,18],498:[20,18],499:[20,18],500:[20,18],501:[20,18],1896:[20,30],1898:[26,28],1899:[22,30],1900:[33,30],1901:[24,28],1902:[27,29],1904:[24,30],1906:[24,30]},s=["f","space","k","shift+up","shift+down","esc","m","?","alt+t","alt+x"],i=["chat.name-format","chat.me-style","chat.rituals.show","chat.subs.show","chat.subs.compact","chat.actions.inline","chat.actions.hover","chat.timestamp-format","chat.points.allow-highlight","chat.filtering.display-deleted","chat.filtering.display-mod-action","chat.replies.style","chat.bits.cheer-notice","chat.filtering.hidden-tokens","chat.hype.message-style","chat.filtering.show-reasons","chat.emotes.allow-gigantify","chat.shared-chat.username-tooltip","chat.shared-chat.style"],l=["chat.badges.style","chat.badges.hidden","chat.badges.custom-mod","chat.badges.custom-vip"],w=["chat.emotes.enabled","chat.emotes.2x","chat.emotes.animated","chat.emoji.style","chat.emoji.replace-joiner","chat.bits.stack","chat.rich.enabled","chat.rich.want-mid","chat.rich.hide-tokens","chat.rich.all-links","chat.rich.minimum-level","chat.filtering.process-own","chat.filtering.mention-priority","chat.filtering.debug","chat.fix-bad-emotes","__filter:highlight-terms","__filter:highlight-users","__filter:highlight-badges","__filter:block-terms","__filter:block-users","__filter:block-badges"],b={Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Meta:91,Context:93},r="//static-cdn.jtvnw.net/emoticons/v2",e={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},a=`${B}/static/replacements/`,p={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},C={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",.7],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1],["wss://ayaya.frankerfacez.com/",1],["wss://champ.frankerfacez.com/",1]],Development:[["ws://127.0.0.1:7999/",1]]},y={localhost:{title:"Local Dev Server (Port 8002)",value:"https://localhost:8002",has_sse:!0},"localhost-cf":{title:"Local Dev Worker (Wrangler, Port 8787)",value:"https://localhost:8787"},Production:{title:"Production",value:"https://link-service.workers.frankerfacez.com"}},z={Production:"https://pubsub.frankerfacez.com",Staging:"https://pubsub-staging-alt.frankerfacez.com",EMQXTest:"emqx-test",Development:"https://stendec.dev/ps/"},$=["biblethump.frankerfacez.com"],o=navigator.platform?navigator.platform.indexOf("Mac")!==-1:/OS X/.test(navigator.userAgent),c=navigator.platform?navigator.platform.indexOf("Win")!==-1:/Windows/.test(navigator.userAgent),m=navigator.userAgent.indexOf("AppleWebKit/")!==-1&&navigator.userAgent.indexOf("Edge/")===-1,A=navigator.userAgent.indexOf("Firefox/")!==-1,h=m?"-webkit-":"",T=[0,33,42],R=[300238151],P=[457,793,19151,19194];var O=(j=>(j[j.Unknown=0]="Unknown",j[j.Prime=1]="Prime",j[j.Turbo=2]="Turbo",j[j.LimitedTime=3]="LimitedTime",j[j.ChannelPoints=4]="ChannelPoints",j[j.Unavailable=5]="Unavailable",j[j.Subscription=6]="Subscription",j[j.BitsTier=7]="BitsTier",j[j.Global=8]="Global",j[j.TwoFactor=9]="TwoFactor",j[j.Follower=10]="Follower",j))(O||{});const M={YouTube:{label:"You must agree to the YouTube Terms of Service to view this embed.",i18n_key:"embed.warn.youtube",i18n_links:"embed.warn.youtube.links",links:`To view YouTube embeds, you must agree to YouTube's Terms of Service:
* [Terms of Service](https://www.youtube.com/t/terms)
* [Privacy Policy](https://policies.google.com/privacy)`,i18n_accept:"embed.warn.youtube.agree",accept:"Yes, I accept the YouTube Terms of Service."}}},94417:(ae,J,d)=>{var f;"use strict";d.r(J),d.d(J,{Dialog:()=>D,default:()=>v,getDialogNextZ:()=>I});var W=d(17159),L=d(43874);let B=9e3;function I(){return B++}G(I,"getDialogNextZ");const U=(f=class extends W.EventEmitter{constructor(g,S={}){super(),this.selectors={exclusive:f.EXCLUSIVE,maximized:f.MAXIMIZED,normal:f.SELECTOR},S.selectors&&(this.selectors=Object.assign(this.selectors,S.selectors)),this._maximized=S.maximized||!1,this._exclusive=S.exclusive||!1,this.prepend=S.prepend||!1,this._element=null,this._visible=!1,typeof g=="function"?this.factory=g:this.element=g}get maximized(){return this._exclusive||this._maximized}set maximized(g){g=!!g,g!==this._maximized&&(this._visible?this.toggleSize():this._maximized=g)}get visible(){return this._visible}set visible(g){g=!!g,g!==this._visible&&this.toggleVisible()}get exclusive(){return this._exclusive}set exclusive(g){if(this._visible)throw new Error("cannot set exclusive flag when dialog already visible");this._exclusive=g}get element(){return this._element}set element(g){if(this._visible)throw new Error("cannot change element when dialog already visible");if(!(g instanceof Node))throw new Error("element must be an instance of Node");this._element=g}show(){this.visible=!0}hide(){this.visible=!1}maximize(){this.maximized=!0}restore(){this.maximized=!1}getContainer(){return document.querySelector(this._exclusive?this.selectors.exclusive:this._maximized?this.selectors.maximized:this.selectors.normal)}toggleVisible(g){if(g&&g.button!==0)return;const S=this.maximized,n=this._visible=!this._visible,s=this.getContainer();if(S&&s&&s.classList.toggle("ffz-has-dialog",n),!n){this._element&&this._element.remove(),this.emit("hide"),this.factory&&(this._element=null);return}if(s){if(this.factory){const i=this.factory();if(i instanceof Promise){i.then(l=>{this._element=l,this.prepend?s.insertBefore(l,s.firstChild):s.appendChild(l),this.emit("show")}).catch(l=>{this.emit("error",l)});return}else this._element=i}this._element&&(this.prepend?s.insertBefore(this._element,s.firstChild):s.appendChild(this._element),this.emit("show"))}}toggleSize(g){if(!this._visible||g&&g.button!==0||!this._element)return;this._maximized=!this._maximized;const S=this.maximized,n=this.getContainer(),s=this._element.parentElement;n!==s&&(S?n&&n.classList.add("ffz-has-dialog"):s&&s.classList.remove("ffz-has-dialog"),this._element.remove(),n&&(this.prepend?n.insertBefore(this._element,n.firstChild):n.appendChild(this._element)),this.emit("resize"))}},G(f,"_Dialog2"),f);U.EXCLUSIVE=L.Z.DIALOG_EXCLUSIVE,U.MAXIMIZED=L.Z.DIALOG_MAXIMIZED,U.SELECTOR=L.Z.DIALOG_SELECTOR;let D=U;const v=D},44589:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{ClickOutside:()=>a,ManagedStyle:()=>e,createElement:()=>S,findReactFragment:()=>g,hasSharedParent:()=>s,highlightJson:()=>p,off:()=>u,on:()=>f,openFile:()=>i,readFile:()=>l,sanitize:()=>b,setChildren:()=>n});var W=d(46949),L=d(24431);const B=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","type","usemap","value","width","wrap"],I=["svg","animate","animateMotion","animateTransform","circle","clipPath","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font-face-format","font-face-name","font-face-src","font-face-uri","font-face","font","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","tref","tspan","use","view","vkern"],U=["controls","autoplay","loop"],D=document.createRange();function v(z){return z.replace(/[-_]\w/g,$=>$[1].toUpperCase())}G(v,"camelCase");function f(z,$,o,c){return z.addEventListener($,o,c)}G(f,"on");function u(z,$,o,c){return z.removeEventListener($,o,c)}G(u,"off");function g(z,$,o=25,c=0,m){if(!m)m=new Set;else if(m.has(z))return null;if($(z))return z;if(c>=o)return null;if(m.add(z),z?.props?.children)if(Array.isArray(z.props.children)){for(const A of z.props.children)if(A)if(Array.isArray(A))for(const h of A){const T=g(h,$,o,c+1,m);if(T)return T}else{const h=g(A,$,o,c+1,m);if(h)return h}}else{const A=g(z.props.children,$,o,c+1,m);if(A)return A}return null}G(g,"findReactFragment");function S(z,$,...o){const m=I.includes(z)?document.createElementNS("http://www.w3.org/2000/svg",z):document.createElement(z);if(o.length===0?o=null:o.length===1&&(o=o[0]),typeof $=="string")m.setAttribute("class",$);else if($){for(const A in $)if((0,W.has)($,A)){const h=A.toLowerCase(),T=$[A];if(A==="className")m.setAttribute("class",T);else if(h==="style")if(typeof T=="string")m.style.cssText=T;else if(T&&typeof T=="object")for(const[R,P]of Object.entries(T))(0,W.has)(m.style,R)||(0,W.has)(Object.getPrototypeOf(m.style),R)?m.style[R]=P:m.style.setProperty(R,T[R]);else L.DEBUG&&T!=null&&console.warn("unsupported style value",T);else if(h==="dataset")if(T&&typeof T=="object")for(const R in T)(0,W.has)(T,R)&&(m.dataset[v(R)]=T[R]);else L.DEBUG&&T!=null&&console.warn("unsupported dataset value",T);else A==="dangerouslySetInnerHTML"?T&&T.__html&&(m.innerHTML=T.__html):h.startsWith("on")?m.addEventListener(h.slice(2),T):h.startsWith("data-")?m.dataset[v(h.slice(5))]=T:U.includes(h)?T&&T!=="false"&&m.setAttribute(A,T):h.startsWith("aria-")||B.includes(h)||I.includes(z)?m.setAttribute(A,T):m[A]=T}}return o&&n(m,o),m}G(S,"createElement");function n(z,$,o=!1,c=!1){if(o&&window.FrankerFaceZ.get().log.warn("call to setChildren with no_sanitize set to true -- this is no longer supported"),$ instanceof Node)c||(z.innerHTML=""),z.appendChild($);else if(Array.isArray($)){c||(z.innerHTML="");for(const m of $)if(m instanceof Node)z.appendChild(m);else if(Array.isArray(m))n(z,m,o,!0);else if(m){const A=typeof m=="string"?m:String(m);z.appendChild(document.createTextNode(A))}}else if($){const m=typeof $=="string"?$:String($);z.appendChild(document.createTextNode(m))}}G(n,"setChildren");function s(z,$,o){for(;z;){if(z.contains($))return!0;z=z.parentElement,o&&(z=z instanceof Element?z.closest(o):null)}return!1}G(s,"hasSharedParent");function i(z,$){return new Promise(o=>{const c=document.createElement("input");c.type="file",c.accept=z,c.multiple=$;let m=!1;c.onchange=()=>{if(!m){m=!0;const A=Array.from(c.files??[]);o($?A:A[0])}},c.click()})}G(i,"openFile");function l(z,$="utf-8"){return new Promise((o,c)=>{const m=new FileReader;m.readAsText(z,$),m.onload=()=>o(m.result),m.onerror=A=>c(A)})}G(l,"readFile");const w=document.createElement("span");function b(z){w.textContent=z;const $=w.innerHTML;return w.textContent="",$}G(b,"sanitize");let r=0;const C=class C{constructor($){this.id=$||r++,this._blocks={},this._style=S("style",{type:"text/css",id:`ffz--managed-style--${this.id}`}),document.head.appendChild(this._style)}destroy(){this._style&&this._style.remove(),this._blocks=null,this._style=null}clear(){this._blocks={},this._style.innerHTML=""}get($){const o=this._blocks[$];if(o)return o.textContent}has($){return!!this._blocks[$]}set($,o,c=!1){const m=this._blocks[$];if(m){if(!c&&m.textContent===o)return;m.textContent=o}else this._style.appendChild(this._blocks[$]=document.createTextNode(o))}delete($){const o=this._blocks[$];o&&(this._style.contains(o)&&this._style.removeChild(o),this._blocks[$]=null)}};G(C,"ManagedStyle");let e=C;const y=class y{constructor($,o){this.el=$,this.cb=o,this._fn=this.handleClick.bind(this),document.documentElement.addEventListener("click",this._fn)}destroy(){this._fn&&document.documentElement.removeEventListener("click",this._fn),this.cb=this.el=this._fn=null}handleClick($){this.cb&&this.el&&!this.el.contains($.target)&&this.cb($)}};G(y,"ClickOutside");let a=y;function p(z,$=!1,o=1,c=30){let m="",A="";if($&&(m="    ".repeat(o-1),A="    ".repeat(o)),o>c)return'<span class="ffz-ct--obj-literal">&lt;nested&gt;</span>';if(z==null)return`<span class="ffz-ct--literal" depth="${o}">null</span>`;if(typeof z=="number"||typeof z=="boolean")return`<span class="ffz-ct--literal" depth="${o}">${z}</span>`;if(typeof z=="string")return`<span class=ffz-ct--string depth="${o}">${b(JSON.stringify(z))}</span>`;if(Array.isArray(z))return`<span class="ffz-ct--obj-open" depth="${o}">[</span>`+(z.length>0?z.map(T=>($?`
${A}`:"")+p(T,$,o+1,c)).join(`<span class="ffz-ct--obj-sep" depth="${o}">, </span>`)+($?`
${m}`:""):"")+`<span class="ffz-ct--obj-close" depth="${o}">]</span>`;const h=[];for(const[T,R]of Object.entries(z))h.length>0&&h.push(`<span class="ffz-ct--obj-sep" depth="${o}">, </span>`),$&&h.push(`
${A}`),h.push(`<span class="ffz-ct--obj-key" depth="${o}">${b(JSON.stringify(T))}</span><span class="ffz-ct--obj-key-sep" depth="${o}">: </span>`),h.push(p(R,$,o+1,c));return`<span class="ffz-ct--obj-open" depth="${o}">{</span>${h.join("")}${h.length&&$?`
${m}`:""}<span class="ffz-ct--obj-close" depth="${o}">}</span>`}G(p,"highlightJson")},17159:(ae,J,d)=>{var n;"use strict";d.r(J),d.d(J,{Detach:()=>W,EventEmitter:()=>v,FFZEvent:()=>f,FFZWaitableEvent:()=>u,HierarchicalEventEmitter:()=>g,StopPropagation:()=>L,default:()=>S});const W=Symbol("Detach"),L=Symbol("StopPropagation"),B=/([a-z])([A-Z])/g,I=/[ \t\W]/g,U=/^_+|_+$/g;String.prototype.toSlug=function(w="-"){let b=this;return b.normalize&&(b=b.normalize("NFD")),b.replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,w)},String.prototype.toSnakeCase=function(){let w=this;return w.normalize&&(w=w.normalize("NFD")),w.replace(/[\u0300-\u036f]/g,"").trim().replace(B,"$1_$2").replace(I,"_").replace(U,"").toLowerCase()};const D=(n=class{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return[];const b={},r=this.__listeners,e=[];for(const[a,p]of Object.entries(r))p?.length?b[a]=p:e.push(a);return this.__listeners=b,this.__dead_events=0,e}__sortListeners(b){if(this.__running.has(b))return;const r=this.__listeners[b];r&&r.sort((e,a)=>e[3]-a[3])}transferListeners(b){if(!(b instanceof n))throw new Error("other must also be EventEmitter");if(!(b.events().length+b.__running.size)){b.__listeners=this.__listeners,b.__dead_events=this.__dead_events,this.__listeners={},this.__dead_events=0;return}for(const[e,a]of Object.entries(this.__listeners)){if(!a||!a.length)continue;let p=b.__listeners[e];Array.isArray(p)?(p.push(...a),b.__sortListeners(e)):b.__listeners[e]=a}this.__listeners={},this.__dead_events=0}makeEvent(b){return f.makeEvent(b)}makeWaitableEvent(b){return u.makeEvent(b)}on(b,r,e,a,p=!1){if(typeof r!="function")throw new TypeError("fn must be a function");const C=[r,e,!1,a??0,p],y=this.__listeners[b];return y?(p?y.unshift(C):y.push(C),this.__sortListeners(b)):this.__listeners[b]=[C],this}once(b,r,e,a,p=!1){return this.many(b,1,r,e,a,p)}many(b,r,e,a,p,C=!1){if(typeof e!="function")throw new TypeError("fn must be a function");if(typeof r!="number"||isNaN(r)||!isFinite(r)||r<1)throw new TypeError("ttl must be a positive, finite number");const y=[e,a,r,p??0,C],z=this.__listeners[b];return z?(C?z.unshift(y):z.push(y),this.__sortListeners(b)):this.__listeners[b]=[y],this}waitFor(b,r,e,a=!1){return new Promise(p=>{const C=[(...z)=>p(z),r,1,e??0,a],y=this.__listeners[b];y?(a?y.unshift(C):y.push(C),this.__sortListeners(b)):this.__listeners[b]=[C]})}off(b,r,e){if(b==null){if(!r&&!e)throw new Error("you must provide at least one constraint when removing listeners");for(const p in Object.keys(this.__listeners))this.__running.has(p)||this.off(p,r,e);return this}if(this.__running.has(b))throw new Error("concurrent modification: tried removing event listener while event is running");let a=this.__listeners[b];return a?(!r&&!e?a=null:(a=a.filter(([p,C])=>!((!r||p===r)&&(!e||e===C))),a.length||(a=null)),this.__listeners[b]=a,a||this.__dead_events++,this):this}offContext(b,r){return this.off(b,void 0,r)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(b){const r=this.__listeners[b];return r?Array.from(r):[]}hasListeners(b){return!!this.__listeners[b]}emit(b,...r){let e=this.__listeners[b];if(!e)return;if(this.__running.has(b))throw new Error("concurrent access: tried to emit event while event is running");const a=new Set;this.__listeners[b]=null,this.__running.add(b);for(const y of e){const[z,$,o]=y;let c;try{c=z.apply($,r)}catch(m){this.log&&(this.log.capture(m,{tags:{event:b},extra:{args:r}}),this.log.error(m))}if(c===W?a.add(y):o!==!1&&(o<=1?a.add(y):y[2]=o-1),c instanceof Promise&&r[0]instanceof u&&r[0].waitFor(c),r[0]instanceof f&&r[0].propagationStopped||c===L)break}if(a.size)for(const y of a){const z=e.indexOf(y);z!==-1&&e.splice(z,1)}let p=!1;const C=this.__listeners[b];C&&(e=e.concat(C),p=!0),e.length?this.__listeners[b]=e:(this.__listeners[b]=null,this.__dead_events++),this.__running.delete(b),p&&this.__sortListeners(b)}},G(n,"_EventEmitter2"),n);D.Detach=W,D.StopPropagation=L;let v=D;const s=class s{static makeEvent(b){return new s(b)}constructor(b){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,b)}_reset(){this.defaultPrevented=!1,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}};G(s,"FFZEvent");let f=s;const i=class i extends f{constructor(){super(...arguments),this.__waiter_results=null}static makeEvent(b){return new i(b)}_wait(){if(this.__waiter)return this.__waiter;if(!this.__promises){const r=this.__waiter_results;return this.__waiter_results=null,r?Promise.resolve(r):null}const b=this.__promises;return this.__promises=null,this.__waiter=Promise.all(b).then(r=>(this.__waiter_results?this.__waiter_results.push(...r):this.__waiter_results=r,this.__waiter=null,this._wait()??[])).catch(r=>{throw this.__waiter=null,r})}_reset(){super._reset(),this.__waiter=null,this.__waiter_results=null,this.__promises=null}waitFor(b){this.__promises?this.__promises.push(b):this.__promises=[b]}};G(i,"FFZWaitableEvent");let u=i;const l=class l extends v{constructor(b,r){super(),this.name=b||(this.constructor.name||"").toSnakeCase(),this.parent=r,r?(this.root=r.root,this.__listeners=r.__listeners,this.__running=r.__running,this.__path=b&&r.__path?`${r.__path}.${b}`:b):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}transferListeners(b){if(!(b instanceof l&&b.root===this.root))throw new Error("Transfering listeners from a HierarchicalEventEmitter is not supported.")}abs_path(b){if(typeof b!="string"||!b.length)throw new TypeError("path must be a non-empty string");let r=0,e;const a=this.__path_parts,p=a.length;do{if(e=b.charAt(r),b.charAt(r)==="."){if(r>p)throw new Error("invalid path: reached top of stack");continue}break}while(++r<b.length);const C=e===":";if(r===0)return C&&this.__path?`${this.__path}${b}`:b;const y=a.slice(0,p-(r-1)).join("."),z=b.slice(r);if(y.length)if(z.length){if(C)return y+z}else return y;else return z;return`${y}.${z}`}on(b,r,e,a,p=!1){return super.on(this.abs_path(b),r,e,a,p)}once(b,r,e,a,p=!1){return super.once(this.abs_path(b),r,e,a,p)}many(b,r,e,a,p,C=!1){return super.many(this.abs_path(b),r,e,a,p,C)}waitFor(b,r,e,a=!1){return super.waitFor(this.abs_path(b),r,e,a)}off(b,r,e){return super.off(b&&this.abs_path(b),r,e)}listeners(b){return super.listeners(this.abs_path(b))}hasListeners(b){return super.hasListeners(this.abs_path(b))}emit(b,...r){return super.emit(this.abs_path(b),...r)}eventsWithChildren(){const b=super.events(),r=this.__path||"",e=r.length;return b.filter(a=>{const p=a.charAt(e);return a.startsWith(r)&&(p===""||p==="."||p===":")})}events(){const b=super.events(),r=this.__path||"",e=r.length;return b.filter(a=>{const p=a.charAt(e);return a.startsWith(r)&&(p===""||p===":")})}};G(l,"HierarchicalEventEmitter");let g=l;const S=g},37087:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{createTester:()=>W});function W(L,B,I=!1,U=!1,D){if(!Array.isArray(L)||!B)return I?()=>!1:()=>!0;const v=[],f=[];let u=0;for(const g of L){if(!g||!g.type)continue;const S=B[g.type];if(!S){u++,v.push(()=>!1),f.push(`f${u}`);continue}const n=S.createTest(g.data,B,D);n&&(u++,v.push(n),f.push(`f${u}`))}return v.length?v.length===1?I?g=>!v[0](g):v[0]:new Function(...f,"ctx",`return ${I?"!(":""}${f.map(g=>`${g}(ctx)`).join(U?" || ":" && ")}${I?")":""};`).bind(null,...v):I?()=>!1:()=>!0}G(W,"createTester")},61892:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{ALIASES:()=>B,ICONS:()=>I,load:()=>D,maybeLoad:()=>v});var W=d(44589);const L=d.p+"font-awesome.css",B={ban:["ban","block"],ok:["ok","unban","untimeout"],"clock-o":["clock-o","clock","timeout"],times:["remove","close","times"],cog:["gear","cog"],repeat:["rotate-right","repeat"],outdent:["dedent","outdent"],"picture-o":["photo","image","picture-o"],"pencil-square-o":["edit","pencil-square-o"],share:["mail-forward","share"],"exclamation-triangle":["warning","exclamation-triangle"],"bar-chart":["bar-chart-o","bar-chart"],cogs:["gears","cogs"],facebook:["facebook-f","facebook"],rss:["feed","rss"],users:["group","users"],link:["chain","link"],scissors:["cut","scissors"],"files-o":["copy","files-o"],"floppy-o":["save","floppy-o"],bars:["navicon","reorder","bars"],sort:["unsorted","sort"],"sort-desc":["sort-down","sort-desc"],"sort-asc":["sort-up","sort-asc"],undo:["rotate-left","undo"],gavel:["legal","gavel"],tachometer:["dashboard","tachometer"],bolt:["flash","bolt"],clipboard:["paste","clipboard"],mobile:["mobile-phone","mobile"],reply:["mail-reply","reply"],"reply-all":["mail-reply-all","reply-all"],"star-half-o":["star-half-empty","star-half-full","star-half-o"],"chain-broken":["unlink","chain-broken"],"caret-square-o-down":["toggle-down","caret-square-o-down"],"caret-square-o-up":["toggle-up","caret-square-o-up"],"caret-square-o-right":["toggle-right","caret-square-o-right"],eur:["euro","eur"],usd:["dollar","usd"],inr:["rupee","inr"],jpy:["cny","rmb","yen","jpy"],rub:["ruble","rouble","rub"],krw:["won","krw"],btc:["bitcoin","btc"],gratipay:["gittip","gratipay"],"caret-square-o-left":["toggle-left","caret-square-o-left"],try:["turkish-lira","try"],university:["institution","bank","university"],"graduation-cap":["mortar-board","graduation-cap"],car:["automobile","car"],taxi:["cab","taxi"],"file-image-o":["file-photo-o","file-picture-o","file-image-o"],"file-archive-o":["file-zip-o","file-archive-o"],"file-audio-o":["file-sound-o","file-audio-o"],"file-video-o":["file-movie-o","file-video-o"],"life-ring":["life-bouy","life-buoy","life-saver","support","life-ring"],rebel:["ra","resistance","rebel"],empire:["ge","empire"],"hacker-news":["y-combinator-square","yc-square","hacker-news"],weixin:["wechat","weixin"],"paper-plane":["send","paper-plane"],"paper-plane-o":["send-o","paper-plane-o"],"futbol-o":["soccer-ball-o","futbol-o"],ils:["shekel","sheqel","ils"],transgender:["intersex","transgender"],bed:["hotel","bed"],"y-combinator":["yc","y-combinator"],"battery-full":["battery-4","battery","battery-full"],"battery-three-quarters":["battery-3","battery-three-quarters"],"battery-half":["battery-2","battery-half"],"battery-quarter":["battery-1","battery-quarter"],"battery-empty":["battery-0","battery-empty"],"hourglass-start":["hourglass-1","hourglass-start"],"hourglass-half":["hourglass-2","hourglass-half"],"hourglass-end":["hourglass-3","hourglass-end"],"hand-rock-o":["hand-grab-o","hand-rock-o"],"hand-paper-o":["hand-stop-o","hand-paper-o"],television:["tv","television"],"american-sign-language-interpreting":["asl-interpreting","american-sign-language-interpreting"],deaf:["deafness","hard-of-hearing","deaf"],"sign-language":["signing","sign-language"],"google-plus-official":["google-plus-circle","google-plus-official"],"font-awesome":["fa","font-awesome"],"address-card":["vcard","address-card"],"address-card-o":["vcard-o","address-card-o"],"id-card":["drivers-license","id-card"],"id-card-o":["drivers-license-o","id-card-o"],"thermometer-full":["thermometer-4","thermometer","thermometer-full"],"thermometer-three-quarters":["thermometer-3","thermometer-three-quarters"],"thermometer-half":["thermometer-2","thermometer-half"],"thermometer-quarter":["thermometer-1","thermometer-quarter"],"thermometer-empty":["thermometer-0","thermometer-empty"],bath:["bathtub","s15","bath"],"window-close":["times-rectangle","window-close"],"window-close-o":["times-rectangle-o","window-close-o"]},I=["glass","music","search","envelope-o","heart","star","star-o","user","film","th-large","th","th-list","check","times","search-plus","search-minus","power-off","signal","cog","trash-o","home","file-o","clock-o","road","download","arrow-circle-o-down","arrow-circle-o-up","inbox","play-circle-o","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","outdent","indent","video-camera","picture-o","pencil","map-marker","adjust","tint","pencil-square-o","share-square-o","check-square-o","arrows","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-circle","minus-circle","times-circle","check-circle","question-circle","info-circle","crosshairs","times-circle-o","check-circle-o","ban","arrow-left","arrow-right","arrow-up","arrow-down","share","expand","compress","plus","minus","asterisk","exclamation-circle","gift","leaf","fire","eye","eye-slash","exclamation-triangle","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder","folder-open","arrows-v","arrows-h","bar-chart","twitter-square","facebook-square","camera-retro","key","cogs","comments","thumbs-o-up","thumbs-o-down","star-half","heart-o","sign-out","linkedin-square","thumb-tack","external-link","sign-in","trophy","github-square","upload","lemon-o","phone","square-o","bookmark-o","phone-square","twitter","facebook","github","unlock","credit-card","rss","hdd-o","bullhorn","bell","certificate","hand-o-right","hand-o-left","hand-o-up","hand-o-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-circle-down","globe","wrench","tasks","filter","briefcase","arrows-alt","users","link","cloud","flask","scissors","files-o","paperclip","floppy-o","square","bars","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-square","google-plus-square","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-desc","sort-asc","envelope","linkedin","undo","gavel","tachometer","comment-o","comments-o","bolt","sitemap","umbrella","clipboard","lightbulb-o","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-o","coffee","cutlery","file-text-o","building-o","hospital-o","ambulance","medkit","fighter-jet","beer","h-square","plus-square","angle-double-left","angle-double-right","angle-double-up","angle-double-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile","circle-o","quote-left","quote-right","spinner","circle","reply","github-alt","folder-o","folder-open-o","smile-o","frown-o","meh-o","gamepad","keyboard-o","flag-o","flag-checkered","terminal","code","reply-all","star-half-o","location-arrow","crop","code-fork","chain-broken","question","info","exclamation","superscript","subscript","eraser","puzzle-piece","microphone","microphone-slash","shield","calendar-o","fire-extinguisher","rocket","maxcdn","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-circle-down","html5","css3","anchor","unlock-alt","bullseye","ellipsis-h","ellipsis-v","rss-square","play-circle","ticket","minus-square","minus-square-o","level-up","level-down","check-square","pencil-square","external-link-square","share-square","compass","caret-square-o-down","caret-square-o-up","caret-square-o-right","eur","gbp","usd","inr","jpy","rub","krw","btc","file","file-text","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-numeric-asc","sort-numeric-desc","thumbs-up","thumbs-down","youtube-square","youtube","xing","xing-square","youtube-play","dropbox","stack-overflow","instagram","flickr","adn","bitbucket","bitbucket-square","tumblr","tumblr-square","long-arrow-down","long-arrow-up","long-arrow-left","long-arrow-right","apple","windows","android","linux","dribbble","skype","foursquare","trello","female","male","gratipay","sun-o","moon-o","archive","bug","vk","weibo","renren","pagelines","stack-exchange","arrow-circle-o-right","arrow-circle-o-left","caret-square-o-left","dot-circle-o","wheelchair","vimeo-square","try","plus-square-o","space-shuttle","slack","envelope-square","wordpress","openid","university","graduation-cap","yahoo","google","reddit","reddit-square","stumbleupon-circle","stumbleupon","delicious","digg","pied-piper-pp","pied-piper-alt","drupal","joomla","language","fax","building","child","paw","spoon","cube","cubes","behance","behance-square","steam","steam-square","recycle","car","taxi","tree","spotify","deviantart","soundcloud","database","file-pdf-o","file-word-o","file-excel-o","file-powerpoint-o","file-image-o","file-archive-o","file-audio-o","file-video-o","file-code-o","vine","codepen","jsfiddle","life-ring","circle-o-notch","rebel","empire","git-square","git","hacker-news","tencent-weibo","qq","weixin","paper-plane","paper-plane-o","history","circle-thin","header","paragraph","sliders","share-alt","share-alt-square","bomb","futbol-o","tty","binoculars","plug","slideshare","twitch","yelp","newspaper-o","wifi","calculator","paypal","google-wallet","cc-visa","cc-mastercard","cc-discover","cc-amex","cc-paypal","cc-stripe","bell-slash","bell-slash-o","trash","copyright","at","eyedropper","paint-brush","birthday-cake","area-chart","pie-chart","line-chart","lastfm","lastfm-square","toggle-off","toggle-on","bicycle","bus","ioxhost","angellist","cc","ils","meanpath","buysellads","connectdevelop","dashcube","forumbee","leanpub","sellsy","shirtsinbulk","simplybuilt","skyatlas","cart-plus","cart-arrow-down","diamond","ship","user-secret","motorcycle","street-view","heartbeat","venus","mars","mercury","transgender","transgender-alt","venus-double","mars-double","venus-mars","mars-stroke","mars-stroke-v","mars-stroke-h","neuter","genderless","facebook-official","pinterest-p","whatsapp","server","user-plus","user-times","bed","viacoin","train","subway","medium","y-combinator","optin-monster","opencart","expeditedssl","battery-full","battery-three-quarters","battery-half","battery-quarter","battery-empty","mouse-pointer","i-cursor","object-group","object-ungroup","sticky-note","sticky-note-o","cc-jcb","cc-diners-club","clone","balance-scale","hourglass-o","hourglass-start","hourglass-half","hourglass-end","hourglass","hand-rock-o","hand-paper-o","hand-scissors-o","hand-lizard-o","hand-spock-o","hand-pointer-o","hand-peace-o","trademark","registered","creative-commons","gg","gg-circle","tripadvisor","odnoklassniki","odnoklassniki-square","get-pocket","wikipedia-w","safari","chrome","firefox","opera","internet-explorer","television","contao","500px","amazon","calendar-plus-o","calendar-minus-o","calendar-times-o","calendar-check-o","industry","map-pin","map-signs","map-o","map","commenting","commenting-o","houzz","vimeo","black-tie","fonticons","reddit-alien","edge","credit-card-alt","codiepie","modx","fort-awesome","usb","product-hunt","mixcloud","scribd","pause-circle","pause-circle-o","stop-circle","stop-circle-o","shopping-bag","shopping-basket","hashtag","bluetooth","bluetooth-b","percent","gitlab","wpbeginner","wpforms","envira","universal-access","wheelchair-alt","question-circle-o","blind","audio-description","volume-control-phone","braille","assistive-listening-systems","american-sign-language-interpreting","deaf","glide","glide-g","sign-language","low-vision","viadeo","viadeo-square","snapchat","snapchat-ghost","snapchat-square","pied-piper","first-order","yoast","themeisle","google-plus-official","font-awesome","handshake-o","envelope-open","envelope-open-o","linode","address-book","address-book-o","address-card","address-card-o","user-circle","user-circle-o","user-o","id-badge","id-card","id-card-o","quora","free-code-camp","telegram","thermometer-full","thermometer-three-quarters","thermometer-half","thermometer-quarter","thermometer-empty","shower","bath","podcast","window-maximize","window-minimize","window-restore","window-close","window-close-o","bandcamp","grav","etsy","imdb","ravelry","eercast","microchip","snowflake-o","superpowers","wpexplorer","meetup"];let U=!1;const D=G(()=>{U||(U=!0,document.head.appendChild((0,W.createElement)("link",{href:L,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"})))},"load"),v=G(f=>{U||!String(f).startsWith("fa-")&&!String(f).startsWith("ffz-fa")||D()},"maybeLoad")},83342:(ae,J,d)=>{"use strict";d.d(J,{R7:()=>l,jo:()=>w});var W=d(44589);const L=d.p+"opendyslexic.css",B=["Roobert","Arial","Arial Black","Verdana","Helvetica","Tahoma","Trebuchet MS","Impact","Didot","American Typewriter","Lucida Console","Monaco","Bradley Hand","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT","Comic Sans MS"],I=document.fonts?.check?B.filter(b=>document.fonts.check(`16px ${b}`)).sort():B.sort(),U=["Roboto","Open Sans","Noto Sans JP","Lato","Montserrat","Roboto Condensed","Source Sans Pro","Oswald","Poppins","Noto Sans","Roboto Mono","Raleway","Ubuntu","Merriweather","Nunito","PT Sans","Roboto Slab","Playfair Display","Lora","Rubik","Mukta","Noto Sans KR","Work Sans","Nunito Sans","Nanum Gothic","Inter","Quicksand","PT Serif","Hind Siliguri","Titilium Web","Fira Sans","Noto Serif","Noto Sans TC","Karla"],D=new Map,v=new Map;function f(b){if(v.has(b))return;const r=encodeURIComponent(b),e=(0,W.createElement)("link",{id:`ffz-font-${r}`,rel:"stylesheet",href:`https://fonts.googleapis.com/css2?family=${r}`});v.set(b,e),document.head.appendChild(e)}G(f,"loadGoogleFont");function u(b){const r=v.get(b);r&&(v.delete(b),r.remove())}G(u,"unloadGoogleFont");const g=["OpenDyslexic","OpenDyslexicAlta","OpenDyslexicMono"];let S=0,n=null;function s(){n||(n=(0,W.createElement)("link",{id:"ffz-font-opendyslexic",rel:"stylesheet",type:"text/css",href:L}),document.head.appendChild(n))}G(s,"loadOpenDyslexic");function i(){n&&(n.remove(),n=null)}G(i,"unloadOpenDyslexic");function l(){const b=[{value:"",i18n_key:"setting.font.default",title:"Default"},{separator:!0,i18n_key:"setting.font.builtin",title:"Built-in Fonts"}];for(const r of I)b.push({value:r,title:r});b.push({separator:!0,i18n_key:"setting.font.dyslexic",title:"Dyslexia Fonts"});for(const r of g)b.push({value:r,title:r});b.push({separator:!0,i18n_key:"setting.font.google",title:"Google Fonts"});for(const r of U)b.push({value:`google:${r}`,title:r});return b}G(l,"getFontsList");function w(b){if(!b)return[b,null];if(g.includes(b)){S++,S===1&&s();let r=!1;return[b,G(()=>{r||(r=!0,S--,S||i())},"unloader")]}if(b.startsWith("google:")){const r=b.slice(7),e=(D.get(r)??0)+1;D.set(r,e),e===1&&f(r);let a=!1;return[r,G(()=>{if(!a){a=!0;const C=(D.get(r)??0)-1;C>0?D.set(r,C):(D.delete(r),u(r))}},"unloader")]}return[b,null]}G(w,"useFont")},5286:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{MERGE_METHODS:()=>W,default:()=>B,mergeList:()=>L});const W={Document:(I,U)=>(I.definitions&&U.definitions?I.definitions=L(I.definitions,U.definitions):U.definitions&&(I.definitions=U.definitions),I),Field:(I,U)=>(I.name&&(!U.name||U.name.value!==I.name.value)||(I.selectionSet&&U.selectionSet?I.selectionSet=B(I.selectionSet,U.selectionSet):U.selectionSet&&(I.selectionSet=U.selectionSet)),I),OperationDefinition:(I,U)=>(I.operation!==U.operation||(I.selectionSet&&U.selectionSet?I.selectionSet=B(I.selectionSet,U.selectionSet):U.selectionSet&&(I.selectionSet=U.selectionSet)),I),FragmentDefinition:(I,U)=>(I.typeCondition&&U.typeCondition&&(I.typeCondition.kind!==U.typeCondition.kind||I.typeCondition.name.value!=U.typeCondition.name.value)||(I.selectionSet&&U.selectionSet?I.selectionSet=B(I.selectionSet,U.selectionSet):U.selectionSet&&(I.selectionSet=U.selectionSet)),I),SelectionSet:(I,U)=>(I.selections&&U.selections?I.selections=L(I.selections,U.selections):U.selections&&(I.selections=U.selections),I)};function L(I,U){let D=!1;const v={};for(const f of I)!f||!f.name||f.name.kind!=="Name"||(f.operation&&(D=!0),v[f.name.value]=f);for(const f of U){if(!f||!f.name||f.name.kind!=="Name")continue;const u=f.name.value,g=v[u]?I.indexOf(v[u]):-1;if(g!==-1){if(I[g].operation&&f.operation&&I[g].operation!==f.operation)continue;I[g]=B(I[g],f),I[g].operation&&(D=!0)}else{if(D&&f.operation)continue;I.push(f)}}return I}G(L,"mergeList");function B(I,U){return I.kind!==U.kind?I:W[I.kind]?W[I.kind](I,U):I}G(B,"merge")},22527:(ae,J,d)=>{var s;"use strict";d.r(J),d.d(J,{CyclicDependencyError:()=>n,LoadState:()=>B,Module:()=>f,ModuleError:()=>S,State:()=>I,buildAddonProxy:()=>g,default:()=>u});var W=d(17159),L=d(46949),B=(w=>(w[w.Unloaded=0]="Unloaded",w[w.Loading=1]="Loading",w[w.Loaded=2]="Loaded",w[w.Unloading=3]="Unloading",w))(B||{}),I=(w=>(w[w.Disabled=0]="Disabled",w[w.Enabling=1]="Enabling",w[w.Enabled=2]="Enabled",w[w.Disabling=3]="Disabling",w))(I||{});const U=/^addon\.([^.]+)(?:\.|$)/i;function D(w){return U.exec(w)?.[1]}G(D,"extractAddonId");const v=(s=class extends W.default{constructor(b,r,e){if(!r&&b instanceof s&&(r=b,b=void 0),super(b,r),this.load_dependents=null,this.dependents=null,this.references=null,this.__modules=r?r.__modules:{},this.children={},r?.__addon_id)this.__addon_id=r.__addon_id,this.__addon_root=r.__addon_root;else if(e){const p=D(this.__path);p&&(this.__addon_id=p,this.__addon_root=this)}r&&!r.children[this.name]&&(r.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this);let a=!!this.onLoad;if(!a){const p=this.__get_load_requires();a=Array.isArray(p)&&p.length>0}this.__load_state=a?0:2,this.__state=a||this.onEnable?0:2,this._time("instance"),this.emit(":registered",this)}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===2}get loading(){return this.__load_state===1}get enabled(){return this.__state===2}get enabling(){return this.__state===1}get addon_id(){return this.__addon_id}get addon_root(){return this.__addon_root}get addon_manifest(){if(this.__addon_id)return this.resolve("addons")?.getAddon(this.__addon_id)??this.__addon_root?.constructor?.info??void 0}get log(){return this.__log||(this.__log=this.parent&&this.parent.log?.get?.(this.name)),this.__log}set log(b){this.__log=b}_time(b){this.root.timing&&(typeof b!="object"&&(b={event:b}),b.module=this.__path||"core",this.root.timing.addEvent(b))}load(){return this.__load(this.__path,[])}unload(){return this.__unload(this.__path,[])}enable(){return this.__enable(this.__path,[])}disable(){return this.__disable(this.__path,[])}canUnload(){return this.__canUnload(this.__path,[])}canDisable(){return this.__canDisable(this.__path,[])}__load(b,r){const e=this.__path||this.name,a=this.__load_state;if(r.includes(this))return Promise.reject(new n(`cyclic load requirements when loading ${b}`,[...r,this]));if(this.load_requires)for(const p of this.load_requires){const C=this.__resolve(p);if(C instanceof s&&r.includes(C))return Promise.reject(new n(`cyclic load requirements when loading ${b}`,[...r,this,C]))}return r.push(this),a===1?this.__load_promise:a===2?Promise.resolve():a===3?Promise.reject(new S(`attempted to load module ${e} while module is being unloaded`)):(this._time("load-start"),this.__load_state=1,this.__load_promise=(async()=>{if(this.load_requires){const p=[];for(const C of this.load_requires){const y=this.__resolve(C);if(!y||!(y instanceof s))throw new S(`cannot find required module ${C} when loading ${e}`);p.push(y.__enable(b,Array.from(r)))}await Promise.all(p)}if(this.onLoad)return this._time("load-self"),this.onLoad()})().then(p=>(this.__load_state=2,this.__load_promise=null,this._time("load-end"),this.emit(":loaded",this),p)).catch(p=>{throw this.__load_state=0,this.__load_promise=null,this._time("load-end"),p}))}__canUnload(b,r){const e=this.__path||this.name,a=this.__load_state;if(r.includes(this))throw new n(`cyclic load requirements when checking if can unload ${b}`,[...r,this]);if(this.load_dependents){r.push(this);for(const p of this.load_dependents){const C=this.__resolve(p);if(C instanceof s){if(r.includes(C))throw new n(`cyclic load requirements when checking if can unload ${b}`,[...r,this,C]);if(!C.__canUnload(b,Array.from(r)))return!1}}}return a===3||a===0?!0:this.onLoad&&!this.onUnload?!1:a!==1}__unload(b,r){const e=this.__path||this.name,a=this.__load_state;if(r.includes(this))return Promise.reject(new n(`cyclic load requirements when unloading ${b}`,[...r,this]));if(this.load_dependents)for(const p of this.load_dependents){const C=this.__resolve(p);if(C instanceof s&&r.includes(C))return Promise.reject(new n(`cyclic load requirements when unloading ${b}`,[...r,this,C]))}return r.push(this),a===3?this.__load_promise:a===0?Promise.resolve():this.onLoad&&!this.onUnload?Promise.reject(new S(`attempted to unload module ${e} but module cannot be unloaded`)):a===1?Promise.reject(new S(`attempted to unload module ${e} while module is being loaded`)):(this._time("unload-start"),this.__load_state=3,this.__load_promise=(async()=>{if(this.__state!==0&&await this.disable(),this.load_dependents){const p=[];for(const C of this.load_dependents){const y=this.__resolve(C);!y||!(y instanceof s)||p.push(y.__unload(b,Array.from(r)))}await Promise.all(p)}if(this._time("unload-self"),this.onUnload)return this.onUnload()})().then(p=>(this.__load_state=0,this.__load_promise=null,this._time("unload-end"),this.emit(":unloaded",this),p)).catch(p=>{throw this.__load_state=2,this.__load_promise=null,this._time("unload-end"),p}))}__enable(b,r){const e=this.__path||this.name,a=this.__state;if(r.includes(this))return Promise.reject(new n(`cyclic requirements when enabling ${b}`,[...r,this]));if(this.requires)for(const p of this.requires){const C=this.__resolve(p);if(C instanceof s&&r.includes(C))return Promise.reject(new n(`cyclic requirements when enabling ${b}`,[...r,this,C]))}return r.push(this),a===1?this.__state_promise:a===2?Promise.resolve():a===3?Promise.reject(new S(`attempted to enable module ${e} while module is being disabled`)):(this._time("enable-start"),this.__state=1,this.__state_promise=(async()=>{const p=[],C=this.requires,y=this.__load_state;if(y===3)throw new S(`attempted to load module ${e} while module is being unloaded`);if((y===1||y===0)&&p.push(this.load()),C)for(const z of C){const $=this.__resolve(z);if(!$||!($ instanceof s))throw new S(`cannot find required module ${z} when enabling ${e}`);p.push($.__enable(b,Array.from(r)))}if(await Promise.all(p),this.onEnable)return this._time("enable-self"),this.onEnable()})().then(p=>(this.__state=2,this.__state_promise=null,this._time("enable-end"),this.emit(":enabled",this),p)).catch(p=>{throw this.__state=0,this.__state_promise=null,this._time("enable-end"),p}))}__canDisable(b,r){const e=this.__path||this.name,a=this.__state;if(r.includes(this))throw new n(`cyclic load requirements when checking if can disable ${b}`,[...r,this]);if(this.dependents){r.push(this);for(const p of this.dependents){const C=this.__resolve(p);if(C&&C instanceof s){if(r.includes(C))throw new n(`cyclic load requirements when checking if can disable ${b}`,[...r,this,C]);if(!C.__canDisable(b,Array.from(r)))return!1}}}if(a===3||a===0)return!0;if(this.onDisable){if(a===1)return!1}else return!1;return!0}__disable(b,r){const e=this.__path||this.name,a=this.__state;if(r.includes(this))return Promise.reject(new n(`cyclic requirements when disabling ${b}`,[...r,this]));if(this.dependents)for(const p of this.dependents){const C=this.__resolve(p);if(C instanceof s&&r.includes(C))return Promise.reject(new n(`cyclic requirements when disabling ${b}`,[...r,this,C]))}if(r.push(this),a===3)return this.__state_promise;if(a===0)return Promise.resolve();if(this.onDisable){if(a===1)return Promise.reject(new S(`attempted to disable module ${e} but module is being enabled`))}else return Promise.reject(new S(`attempted to disable module ${e} but module cannot be disabled`));return this._time("disable-start"),this.__state=3,this.__state_promise=(async()=>{if(this.__load_state!==2)throw new S(`attempted to disable module ${e} but module is unloaded -- weird state`);if(this.dependents){const p=[];for(const C of this.dependents){const y=this.__resolve(C);!y||!(y instanceof s)||p.push(y.__disable(b,Array.from(r)))}await Promise.all(p)}if(this.onDisable)return this._time("disable-self"),this.onDisable()})().then(p=>(this.__state=0,this.__state_promise=null,this._time("disable-end"),this.emit(":disabled",this),p)).catch(p=>{throw this.__state=2,this.__state_promise=null,this._time("disable-end"),p})}on(b,r,e,a,p=!1){return super.on(b,r,e===void 0?this:e,a,p)}once(b,r,e,a,p=!1){return super.once(b,r,e===void 0?this:e,a,p)}many(b,r,e,a,p,C=!1){return super.many(b,r,e,a===void 0?this:a,p,C)}waitFor(b,r,e,a=!1){return super.waitFor(b,r===void 0?this:r,e,a)}off(b,r,e){return super.off(b,r,e===void 0?this:e)}__resolve(b){return b instanceof s?b:this.__modules[this.abs_path(b)]}resolve(b){let r=this.__resolve(b);return r instanceof s?(this.__processModule&&(r=this.__processModule(r)),r):null}hasModule(b){return this.__modules[this.abs_path(b)]instanceof s}__get_requires(){return(0,L.has)(this,"requires")?this.requires:(0,L.has)(this.constructor,"requires")?this.constructor.requires:null}__get_load_requires(){return(0,L.has)(this,"load_requires")?this.load_requires:(0,L.has)(this.constructor,"load_requires")?this.constructor.load_requires:null}__processModule(b){if(this.__addon_id&&b.getAddonProxy){const r=this.__addon_id;if(b.__proxies||(b.__proxies={}),b.__proxies[r])return b.__proxies[r];const e=this.__resolve("addons")?.getAddon?.(r),a=b.getAddonProxy(r,e,this.__addon_root??this,this);return a!==b&&(b.__proxies[r]=a),a}return b}inject(b,r,e=!0){(b instanceof s||b&&b.prototype instanceof s)&&(e=r??!0,r=b,b=null);const a=this.requires=this.__get_requires()||[];if(r instanceof s)b||(b=r.constructor.name.toSnakeCase());else if(r&&r.prototype instanceof s)b||(b=r.name.toSnakeCase()),r=this.register(b,r);else if(b){const p=b;if(b=b.replace(/^(?:[^.]*\.)+/,""),r=this.__resolve(p),!r||!(r instanceof s))return r?r[2].push([this.__path,b]):this.__modules[this.abs_path(p)]=[[],[],[[this.__path,b]]],a.push(this.abs_path(p)),this[b]=null}else throw new TypeError("must provide a valid module name or class");if(!r)throw new Error(`cannot find module ${b} or no module provided`);return e&&a.push(r.abs_path(".")),this.enabled&&!r.enabled&&r.enable(),r.references.push([this.__path,b]),r instanceof s&&this.__processModule&&(r=this.__processModule(r)),this[b]=r}injectAs(b,r,e,a=!0){(r instanceof s||r&&r.prototype instanceof s)&&(a=e??!0,e=r,r=null);const p=this.requires=this.__get_requires()||[];if(e instanceof s)r||(r=e.constructor.name.toSnakeCase());else if(e&&e.prototype instanceof s)r||(r=e.name.toSnakeCase()),e=this.register(r,e);else if(r){const C=r;if(r=r.replace(/^(?:[^.]*\.)+/,""),e=this.__resolve(C),!e||!(e instanceof s))return e?e[2].push([this.__path,b]):this.__modules[this.abs_path(C)]=[[],[],[[this.__path,b]]],p.push(this.abs_path(C)),this[b]=null}else throw new TypeError("must provide a valid module name or class");if(!e)throw new Error(`cannot find module ${r} or no module provided`);return a&&p.push(e.abs_path(".")),this.enabled&&!e.enabled&&e.enable(),e.references.push([this.__path,b]),this.__processModule&&(e=this.__processModule(e)),this[b]=e}register(b,r,e=!1){b.prototype instanceof s&&(e=r,r=b,b=r.name.toSnakeCase());const a=this.abs_path(`.${b}`),p=r.prototype,C=this.__modules[a];if(!(p instanceof s))throw new TypeError(`Module ${b} is not subclass of Module.`);if(C instanceof s)throw new S(`Name Collision for Module ${a}`);const y=C||[[],[],[]];let z=this.__modules[a]=new r(b,this);const $=z.requires=z.__get_requires()||[],o=z.load_requires=z.__get_load_requires()||[];z.dependents=y[0],z.load_dependents=y[1],z.references=y[2];for(const c of $){const m=z.abs_path(c),A=this.__modules[m];A?Array.isArray(A)?A[0].push(a):A.dependents.push(a):this.__modules[m]=[[a],[],[]]}for(const c of o){const m=z.abs_path(c),A=this.__modules[m];A?Array.isArray(A)?A[1].push(a):A.load_dependents.push(a):this.__modules[m]=[[],[a],[]]}for(const[c,m]of y[2]){const A=this.__resolve(c);A&&!Array.isArray(A)?A[m]=z:this.log.warn(`Unable to find module "${c}" that wanted "${m}".`)}return this.__processModule&&(z=this.__processModule(z)),e&&(this[b]=z),z}async loadFromContext(b,r){r=r??this.log;const e={};for(const a of b.keys()){const p=await b(a),C=p.module||p.default,y=a.lastIndexOf("."),z=y>2?a.slice(2,y):a,$=z.endsWith("/index")?z.slice(0,-6):z;try{e[$]=this.register($,C)}catch(o){r&&o instanceof Error&&(r.capture(o,{extra:{module:$,path:a}}),r.warn(o,`Skipping ${a}`))}}return e}},G(s,"_Module2"),s);v.buildAddonProxy=g;let f=v;const u=f;function g(w,b,r,e,a,p){const C={get(y,z,$){let o=e[z];if(o!==void 0)return typeof o=="function"?o.bind(y):o;const c=a&&a[z];return w?.log&&c&&w.log.warn(`[DEV-CHECK] Accessed ${r}.${z} directly. ${typeof c=="string"?c:""}`),o=y[z],typeof o=="function"?o.bind(y):w&&o instanceof f?w.resolve(o):Reflect.get(y,z,$)}};return p?C:new Proxy(b,C)}G(g,"buildAddonProxy");const i=class i extends Error{};G(i,"ModuleError");let S=i;const l=class l extends S{constructor(b,r){super(`${b} (${r.map(e=>e.path).join(" => ")})`),this.modules=r}};G(l,"CyclicDependencyError");let n=l},46949:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{Mutex:()=>b,SourcedSet:()=>ne,TicketLock:()=>w,TimeoutError:()=>i,TranslatableError:()=>v,addWordSeparators:()=>j,array_equals:()=>a,b64ToArrayBuffer:()=>fe,debounce:()=>r,deep_copy:()=>m,deep_equals:()=>p,escape_regex:()=>M,fetchJSON:()=>we,generateHex:()=>te,generateUUID:()=>D,get:()=>o,getTwitchEmoteSrcSet:()=>I,getTwitchEmoteURL:()=>B,glob_to_regex:()=>ee,has:()=>g,importRsaKey:()=>me,isValidShortcut:()=>U,makeAddonIdChecker:()=>h,make_enum:()=>n,make_enum_flags:()=>s,map_equals:()=>y,matchScreen:()=>u,maybe_call:()=>T,normalizeAddonIdForComparison:()=>A,once:()=>e,pick_random:()=>O,set_equals:()=>z,sha256:()=>f,shallow_copy:()=>c,shallow_object_equals:()=>C,sleep:()=>S,split_chars:()=>P,substr_count:()=>$,timeout:()=>l,truncate:()=>X});var W=d(24431);const L=Object.prototype.hasOwnProperty;function B(oe,ie,pe=!1,ge=!0){return`${W.TWITCH_EMOTE_V2}/${oe}/${pe?"default":"static"}/${ge?"dark":"light"}/${ie==4?3:ie}.0`}G(B,"getTwitchEmoteURL");function I(oe,ie=!1,pe=!0,ge=!1){return ge?`${B(oe,2,ie,pe)} 1x, ${B(oe,4,ie,pe)} 2x`:`${B(oe,1,ie,pe)} 1x, ${B(oe,2,ie,pe)} 2x, ${B(oe,4,ie,pe)} 4x`}G(I,"getTwitchEmoteSrcSet");function U(oe){return oe?(oe=oe.toLowerCase().trim(),!W.BAD_HOTKEYS.includes(oe)):!1}G(U,"isValidShortcut");const D=crypto.randomUUID?()=>crypto.randomUUID():G(function oe(ie){return ie?(ie^Math.random()*16>>ie/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,oe)},"generateUUID2"),xe=class xe extends Error{constructor(ie,pe,ge){super(ie),this.i18n_key=pe,this.data=ge}toString(){const ie=window.FrankerFaceZ?.get(),pe=ie?.resolve("i18n");return pe&&this.i18n_key?pe.t(this.i18n_key,this.message,this.data):this.message}};G(xe,"TranslatableError");let v=xe;async function f(oe){const ie=new TextEncoder().encode(oe),pe=await crypto.subtle.digest("SHA-256",ie);return Array.from(new Uint8Array(pe)).map(Fe=>Fe.toString(16).padStart(2,"0")).join("")}G(f,"sha256");function u(oe,ie){let pe,ge=0;for(let ve=0;ve<oe.length;ve++){const Fe=oe[ve];if(Fe.label!==ie.label)continue;let De=1;ie.left&&ie.left===Fe.left&&(De+=15),ie.top&&ie.top===Fe.top&&(De+=15),ie.width&&ie.width===Fe.width&&(De+=10),ie.height&&ie.height===Fe.height&&(De+=10),ie.index&&(De-=Math.abs(ie.index-ve)),De>ge&&(pe=Fe,ge=De)}return pe}G(u,"matchScreen");function g(oe,ie){return oe?L.call(oe,ie):!1}G(g,"has");function S(oe){return new Promise(ie=>setTimeout(ie,oe))}G(S,"sleep");function n(...oe){const ie={};for(let pe=0,ge=oe.length;pe<ge;pe++){const ve=oe[pe];ie[ve]=pe,ie[pe]=ve}return ie}G(n,"make_enum");function s(...oe){const ie={};ie.None=0,ie[0]="None";for(let pe=0,ge=oe.length;pe<ge;pe++){const ve=oe[pe],Fe=Math.pow(2,pe);ie[ve]=Fe,ie[Fe]=ve}return ie}G(s,"make_enum_flags");const Te=class Te extends Error{constructor(ie){super(ie??"timeout")}};G(Te,"TimeoutError");let i=Te;function l(oe,ie){return new Promise((pe,ge)=>{let ve=!1;const Fe=setTimeout(()=>{ve||(ve=!0,ge(new i))},ie);oe.then(De=>{ve||(ve=!0,clearTimeout(Fe),pe(De))}).catch(De=>{ve||(ve=!0,clearTimeout(Fe),ge(De))})})}G(l,"timeout");const Pe=class Pe{constructor(ie=1){this.limit=ie,this.__active=0,this.__waiting=[]}get available(){return this.__active<this.limit}__done(){for(this.__active--;this.__active<this.limit&&this.__waiting.length>0;){this.__active++;const ie=this.__waiting.shift();ie&&ie(this.__getTicket())}}__getTicket(){let ie=!0;return()=>{ie&&(ie=!1,this.__done())}}wait(){return this.__active<this.limit?(this.__active++,Promise.resolve(this.__getTicket())):new Promise(ie=>this.__waiting.push(ie))}};G(Pe,"TicketLock");let w=Pe;const b=w;function r(oe,ie,pe=!1){let ge;if(pe){const ve=G(()=>ge=null,"later");return pe===2?G(function(...De){ge?(clearTimeout(ge),ge=setTimeout(()=>{ge=null,oe.apply(this,De)},ie)):(oe.apply(this,De),ge=setTimeout(ve,ie))},"debouncedFunction"):function(...Fe){ge?clearTimeout(ge):oe.apply(this,Fe),ge=setTimeout(ve,ie)}}return function(...ve){ge&&clearTimeout(ge),ge=setTimeout(oe.bind(this,...ve),ie)}}G(r,"debounce");function e(oe){let ie;return G(function(...ge){if(ie)return ie;try{ie=Promise.resolve(oe.call(this,...ge))}catch(ve){return Promise.reject(ve)}return ie.finally(()=>ie=void 0)},"onceFunction")}G(e,"once");function a(oe,ie){if(!Array.isArray(oe)||!Array.isArray(ie)||oe.length!==ie.length)return!1;let pe=oe.length;for(;pe--;)if(oe[pe]!==ie[pe])return!1;return!0}G(a,"array_equals");function p(oe,ie,pe=!1,ge,ve){if(oe===ie)return!0;if(typeof oe!=typeof ie||typeof oe!="object"||oe===null!=(ie===null))return!1;if(ge||(ge=new Set),ve||(ve=new Set),ge.has(oe)||ve.has(ie))throw new Error("recursive structure detected");ge.add(oe),ve.add(ie);const Fe=Object.keys(oe),De=Object.keys(ie);if(!pe&&!z(new Set(Fe),new Set(De)))return!1;for(const Ie of Fe)if(!p(oe[Ie],ie[Ie],pe,new Set(ge),new Set(ve)))return!1;if(pe){for(const Ie of De)if(!Fe.includes(Ie)&&!p(oe[Ie],ie[Ie],pe,new Set(ge),new Set(ve)))return!1}return!0}G(p,"deep_equals");function C(oe,ie){if(typeof oe!="object"||typeof ie!="object")return!1;const pe=Object.keys(oe);if(!z(new Set(pe),new Set(Object.keys(ie))))return!1;for(const ge of pe)if(oe[ge]!==ie[ge])return!1;return!0}G(C,"shallow_object_equals");function y(oe,ie){if(!(oe instanceof Map)||!(ie instanceof Map)||oe.size!==ie.size)return!1;for(const[pe,ge]of oe)if(!ie.has(pe)||ie.get(pe)!==ge)return!1;return!0}G(y,"map_equals");function z(oe,ie){if(!(oe instanceof Set)||!(ie instanceof Set)||oe.size!==ie.size)return!1;for(const pe of oe)if(!ie.has(pe))return!1;return!0}G(z,"set_equals");function $(oe,ie){let pe=0,ge=0;for(;ge<oe.length;){const ve=oe.indexOf(ie,ge);if(ve===-1)break;pe++,ge=ve+1}return pe}G($,"substr_count");function o(oe,ie){let pe=oe;if(typeof pe=="string"){if(L.call(ie,pe))return ie[pe];pe=pe.split(".")}for(let ge=0,ve=pe.length;ge<ve;ge++){const Fe=pe[ge];if(Fe==="@each"){const De=pe.slice(ge+1);if(De.length)if(Array.isArray(ie))ie=ie.map(Ie=>o(De,Ie));else{const Ie={};for(const Xe in ie)L.call(ie,Xe)&&(Ie[Xe]=o(De,ie[Xe]));ie=Ie}break}else Fe==="@last"?ie=ie[ie.length-1]:ie=ie[Fe];if(!ie)break}return ie}G(o,"get");function c(oe,ie=2,pe){if(oe==null)return oe;if(oe instanceof Promise||typeof oe=="function")return null;if(typeof oe!="object")return oe;if(ie===0)return null;if(pe||(pe=new Set),pe.add(oe),Array.isArray(oe)){const ve=[];for(const Fe of oe)pe.has(Fe)||ve.push(c(Fe,ie-1,new Set(pe)));return ve}const ge={};for(const[ve,Fe]of Object.entries(oe))pe.has(Fe)||(ge[ve]=c(Fe,ie-1,new Set(pe)));return ge}G(c,"shallow_copy");function m(oe,ie){if(oe===null)return null;if(oe===void 0)return;if(oe instanceof Promise)return new Promise((ge,ve)=>oe.then(ge).catch(ve));if(typeof oe=="function")return function(...ge){return oe.apply(this,ge)};if(oe instanceof RegExp)return new RegExp(oe.source,oe.flags);if(oe instanceof Date)return new Date(oe);if(typeof oe!="object")return oe;if(ie||(ie=new Set),ie.has(oe))throw new Error("recursive structure detected");if(ie.add(oe),Array.isArray(oe))return oe.map(ge=>m(ge,new Set(ie)));if(oe instanceof Set){const ge=new Set;for(const ve of oe)typeof ve=="object"?ge.add(m(ve)):ge.add(ve);return ge}if(oe instanceof Map){const ge=new Map;for(const[ve,Fe]of oe.entries()){let De=typeof ve=="object"?m(ve):ve,Ie=typeof Fe=="object"?m(Fe):Fe;ge.set(De,Ie)}return ge}const pe={};for(const[ge,ve]of Object.entries(oe))typeof ve=="object"?pe[ge]=m(ve,new Set(ie)):pe[ge]=ve;return pe}G(m,"deep_copy");function A(oe){return oe.toLowerCase().replace(/[\.\_\-]+/,"-")}G(A,"normalizeAddonIdForComparison");function h(oe){return oe=M(A(oe)),oe=oe.replace(/-+/g,"[._-]+"),oe=oe.replace(/\bbttv\b/g,"(?:bttv|betterttv)"),oe=oe.replace(/\b7tv\b/g,"(?:7tv|seventv)"),oe=oe.replace(/\bpronouns\b/g,"(?:pronouns|addon-pn)"),new RegExp("\\b"+oe+"\\b","i")}G(h,"makeAddonIdChecker");function T(oe,ie,...pe){return typeof oe=="function"?ie?oe.call(ie,...pe):oe(...pe):oe}G(T,"maybe_call");const R=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function P(oe){return oe===""?[]:oe.match(R)}G(P,"split_chars");function O(oe){if(!oe)return null;if(!Array.isArray(oe)){const ie=Object.keys(oe);return oe[O(ie)]}return oe[Math.floor(Math.random()*oe.length)]}G(O,"pick_random");const M=G(function(ie){return ie.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},"escape_regex2");function j(oe){return`(^|.*?${W.WORD_SEPARATORS})(?:${oe})(?=$|${W.WORD_SEPARATORS})`}G(j,"addWordSeparators");const Y="/$^+.()=!|";function ee(oe){if(typeof oe!="string")throw new TypeError("input must be a string");let ie="",pe=0;for(let ge=0,ve=oe.length;ge<ve;ge++){const Fe=oe[ge];if(Y.includes(Fe))ie+=`\\${Fe}`;else if(Fe==="\\"){ge++;const De=oe[ge];De&&(Y.includes(De)?ie+=`\\${De}`:ie+=De)}else if(Fe==="?")ie+=".";else if(Fe==="[")ie+=Fe,oe[ge+1]==="!"&&(ge++,ie+="^");else if(Fe==="]")ie+=Fe;else if(Fe==="{")ie+="(?:",pe++;else if(Fe==="}")pe>0&&(ie+=")",pe--);else if(Fe===","&&pe>0)ie+="|";else if(Fe==="*"){let De=1;for(;oe[ge+1]==="*";)De++,ge++;De>1?ie+=".*?":ie+="[^\\s]*?"}else ie+=Fe}return ie}G(ee,"glob_to_regex");function X(oe,ie=100,pe=15,ge="\u2026",ve=!0,Fe=!0){if(!oe||!oe.length)return oe;Fe&&(oe=oe.trim());let De=ve?oe.indexOf(`
`):-1;if((De===-1||De>ie)&&(De=ie),oe.length<=De)return oe;let Ie=oe.slice(0,De).trimEnd();if(pe>0&&Ie.length>=De){let Xe=oe.slice(De).search(/\s+/);if(Xe===-1&&pe+De>oe.length&&(Xe=oe.length-De),Xe!==-1&&Xe<=pe){if(oe.length<=De+Xe)return oe;Ie=oe.slice(0,De+Xe)}}return Ie+ge}G(X,"truncate");function Q(oe){return oe.toString(16).padStart(2,"0")}G(Q,"decimalToHex");function te(oe=40){const ie=new Uint8Array(oe/2);return window.crypto.getRandomValues(ie),Array.from(ie,Q).join("")}G(te,"generateHex");const Se=class Se{constructor(ie=!1,pe){this._use_set=ie,this._cache=ie?new Set:[],this._sourceSortFn=pe}resortSources(){this._sorted_sources=null,this._sources&&this._sources.size>1&&this._rebuild()}setSortFunction(ie){this._sourceSortFn!==ie&&(this._sourceSortFn=ie,this.resortSources())}_sortSources(){if(!this._sources||this._sources.size===0){this._sorted_sources=[];return}if(this._sources.size===1||!this._sourceSortFn){this._sorted_sources=[...this._sources.values()];return}const ie=[...this._sources?.entries()];ie.sort((pe,ge)=>this._sourceSortFn(pe[0],ge[0])),this._sorted_sources=ie.map(pe=>pe[1])}_rebuild(){if(!this._sources)return;const ie=this._use_set,pe=this._cache=ie?new Set:[];this._sorted_sources||this._sortSources();for(const ge of this._sorted_sources)for(const ve of ge)ie?pe.add(ve):pe.includes(ve)||pe.push(ve)}get(ie){return this._sources&&this._sources.get(ie)}has(ie){return this._sources?this._sources.has(ie):!1}*iterateSources(){if(this._sources)for(const ie of this._sources)yield ie}sourceIncludes(ie,pe){const ge=this._sources&&this._sources.get(ie);return ge&&ge.includes(pe)}includes(ie){return this._use_set?this._cache.has(ie):this._cache.includes(ie)}delete(ie){this._sources&&this._sources.has(ie)&&(this._sources.delete(ie),this._sorted_sources=null,this._rebuild())}extend(ie,...pe){this._sources||(this._sources=new Map);const ge=this._sources.get(ie);if(ge)for(const Fe of pe)ge.includes(Fe)||ge.push(Fe);else this._sources.set(ie,pe),this._sorted_sources=null;if(this._sourceSortFn!=null&&this._sources.size>1)this._rebuild();else{const Fe=this._use_set,De=this._cache;for(const Ie of pe)Fe?De.add(Ie):De.includes(Ie)||De.push(Ie)}}set(ie,pe){if(Array.isArray(pe)||(pe=[pe]),!pe.length)return this.delete(ie);this._sources||(this._sources=new Map);const ge=this._sources.has(ie);this._sources.set(ie,pe),this._sorted_sources=null;const ve=this._sourceSortFn!=null&&this._sources.size>1;if(ge||ve)this._rebuild();else{const Fe=this._use_set,De=this._cache;for(const Ie of pe)Fe?De.add(Ie):De.includes(Ie)||De.push(Ie)}}push(ie,pe){if(!this._sources)return this.set(ie,pe);const ge=this._sources.get(ie);if(ge?.length){if(ge.includes(pe))return}else return this.set(ie,pe);ge.push(pe),this._sourceSortFn!=null&&this._sources.size>1?this._rebuild():this._use_set?this._cache.add(pe):this._cache.includes(pe)||this._cache.push(pe)}remove(ie,pe){if(!this._sources||!this._sources.has(ie))return;const ge=this._sources.get(ie),ve=ge?ge.indexOf(pe):-1;ve!==-1&&(ge.splice(ve,1),this._rebuild())}};G(Se,"SourcedSet");let ne=Se;function fe(oe){const ie=atob(oe),pe=ie.length,ge=new ArrayBuffer(pe),ve=new Uint8Array(ge);for(let Fe=0,De=ie.length;Fe<De;Fe++)ve[Fe]=ie.charCodeAt(Fe);return ge}G(fe,"b64ToArrayBuffer");const re=/-----BEGIN (.+?) KEY-----/,ue=/-----END (.+?) KEY-----/;function me(oe,ie=["verify"]){const pe=re.exec(oe),ge=ue.exec(oe);if(!pe||!ge||pe[1]!==ge[1])throw new Error("invalid key");const ve=/\bPRIVATE\b/i.test(pe[1]),Fe=pe.index+pe[0].length,De=ge.index,Ie=oe.slice(Fe,De).replace(/\n/g,"").trim(),Xe=fe(Ie);return crypto.subtle.importKey(ve?"pkcs8":"spki",Xe,{name:"RSA-PSS",hash:"SHA-256"},!0,ie)}G(me,"importRsaKey");function we(oe,ie,pe=null){return fetch(oe,ie).then(ge=>ge.ok?ge.json():null).catch(()=>pe)}G(we,"fetchJSON")},20857:(ae,J,d)=>{"use strict";d.d(J,{Q:()=>W});function W(I){return L({path:I,i:0})}G(W,"parse");function L(I){const U=I.path,D=U.length,v=[];let f=null,u=null,g=!1,S=!1;for(;I.i<D;){const n=I.i,s=U[n],i=U[n+1];if(f||(f={}),u||(u=""),s==="@"&&i==="{"){I.i++;const r=B(I);r&&Object.assign(f,r);continue}const l=s==="~"&&i===">",w=s===">"&&i===">";if(!(!w&&s===">")&&!w&&!l){u+=s,I.i++;continue}(l||w)&&I.i++,f.title=u.trim(),f.key=f.title.toSnakeCase(),f.page=S,f.tab=g,S=w,g=l,v.push(f),f=u=null,I.i++}return f&&u&&(f.title=u.trim(),f.key=f.title.toSnakeCase(),f.page=S,f.tab=g,v.push(f)),v}G(L,"parseAST");function B(I){const U=I.path,D=U.length,v=I.i;I.i++;const f=["{"];let u=!1;for(;I.i<D&&f.length;){const g=I.i,S=U[g];if(u){if(S==="\\"){I.i++;continue}(S==='"'||S==="'")&&S===u&&(f.pop(),u=!1)}else{if((S==='"'||S==="'")&&(u=S,f.push(S)),(S==="{"||S==="[")&&f.push(S),S==="]"&&f.pop()!=="[")throw new SyntaxError("Invalid JSON");if(S==="}"&&f.pop()!=="{")throw new SyntaxError("Invalid JSON")}I.i++}return JSON.parse(U.slice(v,I.i))}G(B,"parseJSON")},83269:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{durationForChat:()=>I,durationForURL:()=>U,duration_to_string:()=>L,getBuster:()=>W,print_duration:()=>B});function W(D=5){const v=Math.floor(Date.now()/1e3);return v-v%D}G(W,"getBuster");function L(D,v,f,u,g){const S=D%60;let n=Math.floor(D/60),s=Math.floor(n/60),i="";if(n=n%60,v){const w=Math.floor(s/24);if(s=s%24,f&&w>0)return`${i} days`;i=w>0?`${w} days, `:""}const l=u===!1||i?.length>0||s>0;return`${i}${l?`${i&&s<10?"0":""}${s}:`:""}${l&&n<10?"0":""}${n}${g?"":`:${S<10?"0":""}${S}`}`}G(L,"duration_to_string");function B(D){let v=Math.floor(D/60);const f=Math.floor(v/60);return v%=60,D%=60,`${f>0?`${f}:${v<10?"0":""}`:""}${v}:${D<10?"0":""}${D}`}G(B,"print_duration");function I(D){const v=D%60;let f=Math.floor(D/60),u=Math.floor(f/60);const g=Math.floor(u/24);return f=f%60,u=u%24,`${g>0?`${g}d`:""}${u>0?`${u}h`:""}${f>0?`${f}m`:""}${v>0?`${v}s`:""}`}G(I,"durationForChat");function U(D){const v=D%60;let f=Math.floor(D/60);const u=Math.floor(f/60);return f=f%60,`${u>0?`${u}h`:""}${f>0?`${f}m`:""}${v>0?`${v}s`:""}`}G(U,"durationForURL")},8528:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{DefaultOptions:()=>D,NoContent:()=>U,Tooltip:()=>v,default:()=>f,makeReference:()=>g,normalizeModifiers:()=>u});var W=d(44589),L=d(46949),B=d(78224);let I=0;const U=Symbol("NoContent"),D={html:!1,delayShow:0,delayHide:0,live:!0,tooltipClass:"ffz__tooltip",innerClass:"ffz__tooltip--inner",arrowClass:"ffz__tooltip--arrow"},n=class n{constructor(i,l,w){if(this.shift_state=!1,this.ctrl_state=!1,typeof i=="string"&&(i=document.querySelector(i)),!(i instanceof HTMLElement))throw new TypeError("invalid parent");if(this.options=Object.assign({},D,w),this.live=this.options.live,this.parent=i,this.container=this.options.container||this.parent,this.cls=l,this.options.check_modifiers&&this.installModifiers(),this.live)this.cls=l,this.elements=new Set;else{let b;if(typeof l=="string")b=Array.from(i.querySelectorAll(l));else if(Array.isArray(l))b=l;else if(l instanceof HTMLElement)b=[l];else throw new TypeError("invalid elements");this.elements=new Set(b)}if(this._accessor=`_ffz_tooltip$${I++}`,this._onMouseOut=b=>{const r=b.target;if(r&&r.dataset?.forceOpen!=="true")return this._exit(r)},!this.options.manual)if(this.live)this._onMouseOver=b=>{this.updateShift(b.shiftKey,b.ctrlKey);const r=b.target;r&&r.classList&&r.classList.contains(this.cls)&&r.dataset?.forceOpen!=="true"&&this._enter(r)},i.addEventListener("mouseover",this._onMouseOver),i.addEventListener("mouseout",this._onMouseOut);else if(this._onMouseOver=b=>{this.updateShift(b.shiftKey,b.ctrlKey);const r=b.target;this.elements.has(r)&&r.dataset.forceOpen!=="true"&&this._enter(r)},this.elements.size<=5)for(const b of this.elements)b.addEventListener("mouseenter",this._onMouseOver),b.addEventListener("mouseleave",this._onMouseOut);else i.addEventListener("mouseover",this._onMouseOver),i.addEventListener("mouseout",this._onMouseOut)}destroy(){if(this.removeModifiers(),!this.options.manual)if(this.live||this.elements.size>5)this._onMouseOver&&this.parent.removeEventListener("mouseover",this._onMouseOver),this.parent.removeEventListener("mouseout",this._onMouseOut);else for(const i of this.elements)this._onMouseOver&&i.removeEventListener("mouseenter",this._onMouseOver),i.removeEventListener("mouseleave",this._onMouseOut);for(const i of this.elements){const l=i[this._accessor];l&&l.visible&&this.hide(l),i[this._accessor]=null,i._ffz_tooltip=null}this.elements=null,this._onMouseOut=this._onMouseOver=null,this.container=null,this.parent=null}installModifiers(){this._keyUpdate||(this._keyUpdate=i=>this.updateShift(i.shiftKey,i.ctrlKey),window.addEventListener("keydown",this._keyUpdate),window.addEventListener("keyup",this._keyUpdate))}removeModifiers(){this._keyUpdate&&(window.removeEventListener("keydown",this._keyUpdate),window.removeEventListener("keyup",this._keyUpdate),this._keyUpdate=null)}updateShift(i,l){i===this.shift_state&&l===this.ctrl_state||(this.shift_state=i,this.ctrl_state=l,this._shift_af||(this._shift_af=requestAnimationFrame(()=>{if(this._shift_af=null,this.elements)for(const w of this.elements){const b=w[this._accessor];b&&b.outer&&(b.outer.dataset.shift=`${this.shift_state}`,b.outer.dataset.ctrl=`${this.ctrl_state}`,b.update())}})))}cleanup(){if(!(this.options.manual||!this.elements))for(const i of this.elements){const l=i[this._accessor];document.body.contains(i)||l&&l.visible&&this.hide(l)}}_enter(i){let l=i[this._accessor];if(l||(l=i[this._accessor]={target:i}),l.state=!0,l._show_timer&&(clearTimeout(l._show_timer),l._show_timer=null),l.visible)return;const w=(0,L.maybe_call)(this.options.delayShow,null,i,l);w===0?this.show(l):l._show_timer=setTimeout(()=>{l._show_timer=null,l.state&&this.show(l)},w)}_exit(i){const l=i[this._accessor];if(!l||(l.state=!1,l._show_timer&&(clearTimeout(l._show_timer),l._show_timer=null),!l.visible))return;const w=(0,L.maybe_call)(this.options.delayHide,null,i,l);w===0?this.hide(l):l._show_timer=setTimeout(()=>{l._show_timer=null,l.state||this.hide(l)},w)}show(i){const l=this.options,w=i.target;this.elements.add(w),w._ffz_tooltip=i,i._wait_promise=null,i.waitForDom=()=>i.element?Promise.resolve():(i._wait_promise||(i._wait_promise=new Promise(m=>i._waiter=m)),i._wait_promise),i.update=()=>i._update(),i.show=()=>{let m=w[this._accessor];m||(m=w[this._accessor]={target:w}),this.show(m)},i.hide=()=>this.hide(i),i.rerender=()=>{i.visible&&(i.hide(),i.show())};let b=(0,L.maybe_call)(l.content,null,w,i);if(b===void 0&&(b=i.target.title),i.visible||b===U||!b&&!l.onShow)return;const r=(0,W.createElement)("div",{className:l.arrowClass,"x-arrow":!0}),e=i.element=(0,W.createElement)("div",l.innerClass),a=i.outer=(0,W.createElement)("div",{className:l.tooltipClass,"data-shift":this.shift_state,"data-ctrl":this.ctrl_state},[e,r]);if(l.arrowInner&&r.appendChild((0,W.createElement)("div",l.arrowInner)),i.align&&e.classList.add(`${l.innerClass}--align-${i.align}`),i.add_class){for(const m of Array.isArray(i.add_class)?i.add_class:[i.add_class])e.classList.add(m);i.add_class=void 0}const p=(0,L.maybe_call)(l.interactive,null,w,i),C=(0,L.maybe_call)(l.hover_events,null,w,i);a.classList.toggle("interactive",p||!1),(!l.manual||C&&(l.onHover||l.onLeave||l.onMove))&&(C&&l.onMove&&a.addEventListener("mousemove",a._ffz_move_handler=m=>{this.updateShift(m.shiftKey,m.ctrlKey),l.onMove(w,i,m)}),a.addEventListener("mouseover",a._ffz_over_handler=m=>{!l.no_auto_remove&&!document.contains(w)&&this.hide(i),C&&l.onHover&&l.onHover(w,i,m),l.manual||((0,L.maybe_call)(l.interactive,null,w,i)?this._enter(w):w.dataset.forceOpen!=="true"&&this._exit(w))}),a.addEventListener("mouseout",a._ffz_out_handler=m=>{C&&l.onLeave&&l.onLeave(w,i,m),!l.manual&&w.dataset.forceOpen!=="true"&&this._exit(w)}));const y=(0,L.maybe_call)(l.html,null,w,i),z=y?"innerHTML":"textContent",$={flip:{behavior:["top","bottom","left","right"]},offset:{offset:[0,10]},arrow:{element:r}};let o=Object.assign({modifiers:$},l.popper);o.modifiers=Object.assign($,o.modifiers),l.popperConfig&&(o=l.popperConfig(w,i,o)??o),o.onUpdate=(0,L.debounce)(()=>{!l.no_auto_remove&&!document.contains(i.target)&&this.hide(i)},250);let c=w;l.no_update&&(c=g(w)),i._update=()=>{i.popper&&i.popper.forceUpdate()},i._waiter&&i._waiter(),i._waiter=null,i._wait_promise=null,b instanceof Promise?(e.innerHTML='<div class="ffz-i-zreknarf loader"></div>',b.then(m=>{if(!m)return this.hide(i);y&&(m instanceof Node||Array.isArray(m))?(e.innerHTML="",(0,W.setChildren)(e,m,l.sanitizeChildren)):e[z]=m,i._update()}).catch(m=>{this.options.logger&&this.options.logger.error("Error rendering tooltip content.",m),this.options.i18n?e.textContent=this.options.i18n.t("tooltip.render-error",`There was an error rendering this tooltip.
{err}`,{err:m}):e.textContent=`There was an error rendering this tooltip.
${m}`,i._update()})):b&&(y&&(b instanceof Node||Array.isArray(b))?(0,W.setChildren)(e,b,l.sanitizeChildren):e[z]=b),o.modifiers=u(o.modifiers),i.popper=(0,B.fi)(c,a,o),this.container.appendChild(a),i.visible=!0,l.onShow&&l.onShow(w,i)}hide(i){const l=this.options;if(l.onHide&&l.onHide(i.target,i),i.popper&&(i.popper.destroy(),i.popper=null),i.outer){const w=i.outer;w._ffz_over_handler&&w.removeEventListener("mouseover",w._ffz_over_handler),w._ffz_out_handler&&w.removeEventListener("mouseout",w._ffz_out_handler),w._ffz_move_handler&&w.removeEventListener("mousemove",w._ffz_move_handler),w.remove(),i.outer=w._ffz_out_handler=w._ffz_over_handler=null}this.live&&this.elements&&this.elements.delete(i.target),i.target._ffz_tooltip===i&&(i.target._ffz_tooltip=null),i.target[this._accessor]=null,i._update=i.rerender=i.update=S,i.element=null,i.visible=!1}};G(n,"Tooltip");let v=n;const f=v;function u(s){const i=[];for(const[l,w]of Object.entries(s)){const b={name:l};if(w&&typeof w=="object"&&!Array.isArray(w)){(0,L.has)(w,"enabled")&&(b.enabled=w.enabled);const r=Object.keys(w);(r.length>1||r.length===1&&r[0]!=="enabled")&&(b.options=w)}i.push(b)}return i}G(u,"normalizeModifiers");function g(s,i,l=0,w=0){let b;if(s instanceof HTMLElement){const e=s.getBoundingClientRect();b=e.x,i=e.y,l=e.height,w=e.width}else b=s;return{getBoundingClientRect:()=>({top:i,bottom:i+l,y:i,left:b,right:b+w,x:s,height:l,width:w}),clientWidth:w,clientHeight:l}}G(g,"makeReference");function S(){}G(S,"noop")},2356:(ae,J,d)=>{"use strict";d.r(J),d.d(J,{DEFAULT_FORMATS:()=>S,DEFAULT_TYPES:()=>g,TranslationCore:()=>n,default:()=>s,getCardinalName:()=>b,getOrdinalName:()=>a});var W=d(51722),L=d.n(W),B=d(92045),I=d.n(B),U=d(46949),D=d(83269),v=d(22923),f=d.n(v);L().extend(I());const u={allowTags:!1,requireOther:!1},g={tostring(C){return`${C}`},select(C,y,z,$,o,c){const m=y.o&&(y.o[C]||y.o.other);if(m)return this._processAST(m,c,z)},plural(C,y,z,$,o,c){const m=y.o&&(y.o[`=${C}`]||y.o[b(z,C)]||y.o.other);if(m)return this._processAST(m,c,z)},selectordinal(C,y,z,$,o,c){const m=y.o&&(y.o[`=${C}`]||y.o[a(z,C)]||y.o.other);if(m)return this._processAST(m,c,z)},number(C,y){if(typeof C!="number"){let z=parseFloat(C);if((isNaN(z)||!isFinite(z))&&(z=parseInt(C,10)),isNaN(z)||!isFinite(z))return C;C=z}return this.formatNumber(C,y.f)},currency(C,y){if(typeof C!="number"){let z=parseFloat(C);if((isNaN(z)||!isFinite(z))&&(z=parseInt(C,10)),isNaN(z)||!isFinite(z))return C;C=z}return this.formatCurrency(C,y.f)},date(C,y){return this.formatDate(C,y.f)},time(C,y){return this.formatTime(C,y.f)},datetime(C,y){return this.formatDateTime(C,y.f)},duration(C){return this.formatDuration(C)},localestring(C){return this.toLocaleString(C)},relativetime(C,y){return this.formatRelativeTime(C,y.f)},humantime(C,y){return this.formatRelativeTime(C,y.f)},en_plural:C=>C!==1?"s":""},S={number:{currency:{style:"currency"},percent:{style:"percent"},long_percent:{style:"percent",minimumFractionDigits:2}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},default:{},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},datetime:{short:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric"},medium:{},long:{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},p=class p{constructor(y){if(y=y||{},this.warn=y.warn,this._locale=y.locale||"en",this._dayjs_locale=y.dayjsLocale||"en",this.defaultLocale=y.defaultLocale||this._locale,this.transformation=null,this.defaultDateFormat=y.defaultDateFormat??"default",this.defaultTimeFormat=y.defaultTimeFormat??"short",this.defaultDateTimeFormat=y.defaultDateTimeFormat??"medium",this.phrases=new Map,this.cache=new Map,this.numberFormats=new Map,this.currencyFormats=new Map,this.formats=Object.assign({},S),y.formats){const z=Object.keys(y.formats);for(const $ of z)this.formats[$]=Object.assign({},this.formats[$],y.formats[$])}this.types=Object.assign({},g,y.types||{}),this.parser=new(f())(Object.assign({},u,y.parserOptions)),y.phrases&&this.extend(y.phrases)}get locale(){return this._locale}set locale(y){y!==this._locale&&(this._locale=y,this.numberFormats.clear(),this.currencyFormats.clear())}toLocaleString(y){return y?.toLocaleString?y.toLocaleString(this._locale):typeof y!="string"?`${y}`:y}formatRelativeTime(y,z){const $=L()(y),o=z==="plain";try{return $.locale(this._dayjs_locale).fromNow(o)}catch{return $.fromNow(o)}}formatCurrency(y,z){let $=this.currencyFormats.get(z);return $||($=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:z}),this.currencyFormats.set(z,$)),$.format(y)}formatNumber(y,z){let $=this.numberFormats.get(z);return $||(this.formats.number[z]?$=new Intl.NumberFormat(this.locale,this.formats.number[z]):typeof z=="number"?$=new Intl.NumberFormat(this.locale,{minimumFractionDigits:z,maximumFractionDigits:z}):$=new Intl.NumberFormat(this.locale),this.numberFormats.set(z,$)),$.format(y)}formatDuration(y){return(0,D.duration_to_string)(y)}formatDate(y,z){if(z||(z=this.defaultDateFormat),z&&!this.formats.date[z]){const $=L()(y);try{return $.locale(this._dayjs_locale).format(z)}catch{return $.format(z)}}return y instanceof Date||(y=new Date(y)),y.toLocaleDateString(this._locale,this.formats.date[z]||{})}formatTime(y,z){if(z||(z=this.defaultTimeFormat),z&&!this.formats.time[z]){const $=L()(y);try{return $.locale(this._dayjs_locale).format(z)}catch{return $.format(z)}}return y instanceof Date||(y=new Date(y)),y.toLocaleTimeString(this._locale,this.formats.time[z]||{})}formatDateTime(y,z){if(z||(z=this.defaultDateTimeFormat),z&&!this.formats.datetime[z]){const $=L()(y);try{return $.locale(this._dayjs_locale).format(z)}catch{return $.format(z)}}return y instanceof Date||(y=new Date(y)),y.toLocaleString(this._locale,this.formats.datetime[z]||{})}extend(y,z){const $=[];if(!y||typeof y!="object")return $;for(const o of Object.keys(y)){const c=z?o==="_"?z:`${z}.${o}`:o,m=y[o];if(typeof m=="object")$.push(...this.extend(m,c));else{let A;try{A=this.parser.parse(m)}catch(h){this.warn&&this.warn(`Error parsing i18n phrase for key "${c}": ${m}`,h);continue}this.phrases.set(c,m),this.cache.set(c,A),$.push(c)}}return $}unset(y,z){typeof y=="string"&&(y=[y]);const $=Array.isArray(y)?y:Object.keys(y);for(const o of $){const c=z?o==="_"?z:`${z}.${o}`:o;typeof y[o]=="object"?this.unset(y,c):(this.phrases.delete(c),this.cache.delete(c))}}has(y){return this.phrases.has(y)}set(y,z){const $=this.parser.parse(z);this.phrases.set(y,z),this.cache.set(y,$)}clear(){this.phrases.clear(),this.cache.clear()}replace(y){this.clear(),this.extend(y)}_preTransform(y,z,$,o={}){let c,m,A=$??{};if(typeof A=="number"&&(A={count:A}),!o.noCache&&this.phrases.has(y))c=this.cache.get(y)??[],m=this.locale;else if(!o.noCache&&this.cache.has(y))c=this.cache.get(y)??[],m=this.defaultLocale;else{let h=null;try{h=this.parser.parse(z)}catch(T){if(o.throwParse)throw T;!o.noWarn&&this.warn&&this.warn(`Error parsing i18n phrase for key "${y}": ${z}`,T),c=["parsing error"],m=this.defaultLocale}h?(c=h,m=this.locale,o.noCache||(this.locale===this.defaultLocale&&this.phrases.set(y,z),this.cache.set(y,h))):(c=[],m=this.defaultLocale)}return this.transformation&&(c=this.transformation(y,c)),[c,A,m]}t(y,z,$,o){return i(this.tList(y,z,$,o))}tList(y,z,$,o){return this._processAST(...this._preTransform(y,z,$,o))}formatNode(y,z,$,o,c){if(!y||typeof y!="object")return y;$==null&&($=this.locale);const m=(0,U.get)(y.v,z);if(m==null)return null;if(y.t){const A=this.types[y.t];if(A)return A.call(this,m,y,$,o,c,z);this.warn&&this.warn(`Encountered unknown type "${y.t}" when formatting node.`)}return m}_processAST(y,z,$){const o=[];for(const c of y){const m=this.formatNode(c,z,$,o,y);m!=null&&o.push(m)}return o}};G(p,"TranslationCore");let n=p;const s=n;function i(C){return Array.isArray(C)?C.map(i).join(""):`${C}`}G(i,"listToString");let l=null,w=null;function b(C,y){return(!l||C!==w)&&(l=new Intl.PluralRules(C,{type:"cardinal"}),w=C),l.select(y)}G(b,"getCardinalName");let r=null,e=null;function a(C,y){return(!r||C!==e)&&(r=new Intl.PluralRules(C,{type:"ordinal"}),e=C),r.select(y)}G(a,"getOrdinalName")},27040:(ae,J,d)=>{"use strict";d.d(J,{default:()=>B});var W=d(22527),L=d(46949);const I=class I extends W.default{constructor(D,v){super(D,v),this.apollo=null,this.site=null,this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this._waiting_flag_ids=new Map,this._waiting_flag_logins=new Map,this._loadStreams=(0,L.debounce)(this._loadStreams,50),this._loadStreamFlags=(0,L.debounce)(this._loadStreamFlags,50),this._loadUsers=(0,L.debounce)(this._loadUsers,50)}queryApollo(D,v,f){let u;return!v&&!f&&"query"in D&&D.query?u=D:(u={query:D,variables:v},f&&(u=Object.assign(u,f))),this.apollo.client.query(u)}mutate(D,v,f){let u;return!v&&!f&&"mutation"in D&&D.mutation?u=D:(u={mutation:D,variables:v},f&&(u=Object.assign(u,f))),this.apollo.client.mutate(u)}get languageCode(){const D=this.site.getSession();return D&&D.languageCode||"en"}get locale(){const D=this.site.getSession();return D&&D.locale||"en-US"}async getBadges(){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,68905,23))))?.data?.badges}async getMatchingCategories(D,v=15,f=null){const u=await this.queryApollo(await d.e(3224).then(d.t.bind(d,29817,23)),{query:D,first:v,cursor:f}),g=(0,L.get)("data.searchCategories.edges.@each.node",u)??[],S=D.toLowerCase();return Array.isArray(g)&&g.sort((n,s)=>{const i=n&&(n.name?.toLowerCase?.()===S||n?.displayName?.toLowerCase?.()===S),l=n&&(s.name?.toLowerCase?.()===S||s?.displayName?.toLowerCase?.()===S);return i&&!l?-1:!i&&l?1:0}),{cursor:(0,L.get)("data.searchCategories.edges.@last.cursor",u),items:g,finished:!(0,L.get)("data.searchCategories.pageInfo.hasNextPage",u),count:(0,L.get)("data.searchCategories.totalCount",u)||0}}async getCategory(D,v){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,95373,23)),{id:D,name:v}))?.data?.game}async deleteChatMessage(D,v){D=String(D);const f=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,4223,23)),variables:{input:{channelID:D,messageID:v}}}),u=f?.data?.deleteChatMessage?.responseCode;if(u==="TARGET_IS_BROADCASTER")throw new L.TranslatableError("You cannot delete the broadcaster's messages.","chat.delete.forbidden.broadcaster");if(u==="TARGET_IS_MODERATOR")throw new L.TranslatableError("You cannot delete messages from moderator {displayName}.","chat.delete.forbidden.moderator",(0,L.get)("data.deleteChatMessage.message.sender",f));if(u!=="SUCCESS")throw new L.TranslatableError("You don't have permission to delete messages.","chat.delete.forbidden");return!0}async getMatchingUsers(D,v=15,f=null){const u=await this.queryApollo(await d.e(3224).then(d.t.bind(d,4176,23)),{query:D,first:v,cursor:f}),g=(0,L.get)("data.searchUsers.edges.@each.node",u)??[],S=D.toLowerCase();return Array.isArray(g)&&g.sort((n,s)=>{const i=n&&(n.login?.toLowerCase?.()===S||n?.displayName?.toLowerCase?.()===S),l=n&&(s.login?.toLowerCase?.()===S||s?.displayName?.toLowerCase?.()===S);return i&&!l?-1:!i&&l?1:0}),{cursor:(0,L.get)("data.searchUsers.edges.@last.cursor",u),items:g,finished:!(0,L.get)("data.searchUsers.pageInfo.hasNextPage",u),count:(0,L.get)("data.searchUsers.totalCount",u)||0}}async getUser(D,v){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,2247,23)),{id:D,login:v}))?.data?.user}async getUserGame(D,v){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,34489,23)),{id:D,login:v}))?.data?.user?.broadcastSettings?.game}async getUserSelf(D,v){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,23333,23)),{id:D,login:v}))?.data?.user?.self}async getUserFollowed(D,v){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,70470,23)),{id:D,login:v}))?.data?.user?.self?.follower}async followUser(D,v=!1){D=String(D),v=!!v;const f=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,33886,23)),variables:{input:{targetID:D,disableNotifications:v}}});console.log("follow result",f);const u=f?.data?.followUser?.error;if(u?.code)throw new Error(u.code);return f?.data?.followUser?.follow}async unfollowUser(D){D=String(D);const v=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,65199,23)),variables:{input:{targetID:D}}});return console.log("unfollow result",v),v?.data?.unfollowUser?.follow}async getLastBroadcast(D,v){return(await this.queryApollo(await d.e(3224).then(d.t.bind(d,82042,23)),{id:D,login:v,type:"ARCHIVE",sort:"TIME",limit:1}))?.data?.user?.videos?.edges?.[0]?.node}getUserBasic(D,v){let f,u,g;if(D)f=this._waiting_user_ids,g=String(D);else if(v)f=this._waiting_user_logins,g=v;else return Promise.reject("id and login cannot both be null");let S=f.get(g);if(S)return S[0];let n,s;return u=new Promise((i,l)=>{n=i,s=l}),f.set(g,[u,n,s]),this._loading_users||this._loadUsers(),u}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const D=[...this._waiting_user_ids.keys()].slice(0,50),v=50-D.length,f=v>0?[...this._waiting_user_logins.keys()].slice(0,v):[];let u;try{u=(await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,59649,23)),variables:{ids:D.length?D:null,logins:f.length?f:null}}))?.data?.users??[]}catch(n){for(const s of D){const i=this._waiting_user_ids.get(s);this._waiting_user_ids.delete(s),i&&i[2](n)}for(const s of f){const i=this._waiting_user_logins.get(s);this._waiting_user_logins.delete(s),i&&i[2](n)}return}const g=new Set(D),S=new Set(f);if(Array.isArray(u))for(const n of u){if(!n||!n.id)continue;g.delete(n.id),S.delete(n.login);let s=this._waiting_user_ids.get(n.id);s&&(this._waiting_user_ids.delete(n.id),s[1](n)),s=this._waiting_user_logins.get(n.login),s&&(this._waiting_user_logins.delete(n.login),s[1](n))}for(const n of g){const s=this._waiting_user_ids.get(n);s&&(this._waiting_user_ids.delete(n),s[1](null))}for(const n of S){const s=this._waiting_user_logins.get(n);s&&(this._waiting_user_logins.delete(n),s[1](null))}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(D,v){return(await this.getLastBroadcast(D,v))?.id}async getChannelColor(D,v){return(await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,30252,23)),variables:{id:D,login:v}}))?.data?.user?.primaryColorHex}async getPoll(D){const v=await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,89218,23)),variables:{id:D}});return(0,L.get)("data.poll",v)}async createPoll(D,v,f,u={}){if(typeof v!="string")throw new TypeError("title must be string");if(!Array.isArray(f)||f.some(s=>typeof s!="string"))throw new TypeError("choices must be array of strings");let g=u.bits||0,S=u.duration||60;(typeof g!="number"||g<0)&&(g=0),(typeof S!="number"||S<0)&&(S=60);const n=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,31902,23)),variables:{input:{bitsCost:g,bitsVoting:g>0,choices:f.map(s=>({title:s})),durationSeconds:S,ownedBy:`${D}`,subscriberMultiplier:u.subscriberMultiplier||!1,subscriberOnly:u.subscriberOnly||!1,title:v}}});return(0,L.get)("data.createPoll.poll",n)}async archivePoll(D){const v=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,83852,23)),variables:{id:D}});return(0,L.get)("data.archivePoll.poll",v)}async terminatePoll(D){const v=await this.mutate({mutation:await d.e(3224).then(d.t.bind(d,20685,23)),variables:{id:D}});return(0,L.get)("data.terminatePoll.poll",v)}getStreamMeta(D,v){let f,u,g;if(D)f=this._waiting_stream_ids,g=String(D);else if(v)f=this._waiting_stream_logins,g=v;else return Promise.reject("id and login cannot both be null");let S=f.get(g);if(S)return S[0];let n,s;return u=new Promise((i,l)=>{n=i,s=l}),f.set(g,[u,n,s]),this._loading_streams||this._loadStreams(),u}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const D=[...this._waiting_stream_ids.keys()].slice(0,50),v=50-D.length,f=v>0?[...this._waiting_stream_logins.keys()].slice(0,v):[];let u;try{u=(await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,61421,23)),variables:{ids:D.length?D:null,logins:f.length?f:null}}))?.data?.users}catch(n){for(const s of D){const i=this._waiting_stream_ids.get(s);this._waiting_stream_ids.delete(s),i&&i[2](n)}for(const s of f){const i=this._waiting_stream_logins.get(s);this._waiting_stream_logins.delete(s),i&&i[2](n)}return}const g=new Set(D),S=new Set(f);if(Array.isArray(u))for(const n of u){if(!n||!n.id)continue;g.delete(n.id),S.delete(n.login);let s=this._waiting_stream_ids.get(n.id);s&&(this._waiting_stream_ids.delete(n.id),s[1](n.stream)),s=this._waiting_stream_logins.get(n.login),s&&(this._waiting_stream_logins.delete(n.login),s[1](n.stream))}for(const n of g){const s=this._waiting_stream_ids.get(n);s&&(this._waiting_stream_ids.delete(n),s[1](null))}for(const n of S){const s=this._waiting_stream_logins.get(n);s&&(this._waiting_stream_logins.delete(n),s[1](null))}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}getStreamFlags(D,v){let f,u,g;if(D)f=this._waiting_flag_ids,g=String(D);else if(v)f=this._waiting_flag_logins,g=v;else return Promise.reject("id and login cannot both be null");let S=f.get(g);if(S)return S[0];let n,s;return u=new Promise((i,l)=>{n=i,s=l}),f.set(g,[u,n,s]),this._loading_flags||this._loadStreamFlags(),u}async _loadStreamFlags(){if(this._loading_flags)return;this._loading_flags=!0;const D=[...this._waiting_flag_ids.keys()].slice(0,50),v=50-D.length,f=v>0?[...this._waiting_flag_logins.keys()].slice(0,v):[];let u;try{u=(await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,9808,23)),variables:{ids:D.length?D:null,logins:f.length?f:null}}))?.data?.users}catch(n){for(const s of D){const i=this._waiting_flag_ids.get(s);i&&(this._waiting_flag_ids.delete(s),i[2](n))}for(const s of f){const i=this._waiting_flag_logins.get(s);i&&(this._waiting_flag_logins.delete(s),i[2](n))}return}const g=new Set(D),S=new Set(f);if(Array.isArray(u))for(const n of u){if(!n||!n.id)continue;g.delete(n.id),S.delete(n.login);let s=this._waiting_flag_ids.get(n.id);s&&(this._waiting_flag_ids.delete(n.id),s[1](n.stream?.contentClassificationLabels??null)),s=this._waiting_flag_logins.get(n.login),s&&(this._waiting_flag_logins.delete(n.login),s[1](n.stream?.contentClassificationLabels??null))}for(const n of g){const s=this._waiting_flag_ids.get(n);s&&(this._waiting_flag_ids.delete(n),s[1](null))}for(const n of S){const s=this._waiting_flag_logins.get(n);s&&(this._waiting_flag_logins.delete(n),s[1](null))}this._loading_flags=!1,(this._waiting_flag_ids.size||this._waiting_flag_logins.size)&&this._loadStreamFlags()}async getMatchingTags(D){const f=(await this.queryApollo({query:await d.e(3224).then(d.t.bind(d,50873,23)),variables:{query:D,first:100}}))?.data?.searchFreeformTags?.edges;if(!Array.isArray(f)||!f.length)return[];const u=[];for(const g of f){const S=g?.node?.tagName;S&&u.push(S)}return u}};G(I,"TwitchData");let B=I},36e3:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetClipInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"curator"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"broadcaster"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:184}};J.loc.source={body:"query FFZ_GetClipInfo($slug:ID!){clip(slug:$slug){id curator{id login displayName}broadcaster{id login displayName}game{id displayName}title thumbnailURL(width:86 height:45)viewCount}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(D){return D.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function L(D,v){if(D.kind==="FragmentSpread")v.add(D.name.value);else if(D.kind==="VariableDefinition"){var f=D.type;f.kind==="NamedType"&&v.add(f.name.value)}D.selectionSet&&D.selectionSet.selections.forEach(function(u){L(u,v)}),D.variableDefinitions&&D.variableDefinitions.forEach(function(u){L(u,v)}),D.definitions&&D.definitions.forEach(function(u){L(u,v)})}G(L,"collectFragmentReferences");var B={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;L(v,f),B[v.name.value]=f}})},"extractReferences")();function I(D,v){for(var f=0;f<D.definitions.length;f++){var u=D.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(D,v){var f={kind:D.kind,definitions:[I(D,v)]};D.hasOwnProperty("loc")&&(f.loc=D.loc);var u=B[v]||new Set,g=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!g.has(s)){g.add(s);var i=B[s]||new Set;i.forEach(function(l){S.add(l)})}})}return g.forEach(function(s){var i=I(D,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetClipInfo=U(J,"FFZ_GetClipInfo")},98750:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:174}};J.loc.source={body:"query FFZ_GetEmoteInfo($id:ID!){emote(id:$id){id artist{id login displayName}owner{id login displayName}setID text subscriptionProduct{id state owner{id login displayName}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(D){return D.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function L(D,v){if(D.kind==="FragmentSpread")v.add(D.name.value);else if(D.kind==="VariableDefinition"){var f=D.type;f.kind==="NamedType"&&v.add(f.name.value)}D.selectionSet&&D.selectionSet.selections.forEach(function(u){L(u,v)}),D.variableDefinitions&&D.variableDefinitions.forEach(function(u){L(u,v)}),D.definitions&&D.definitions.forEach(function(u){L(u,v)})}G(L,"collectFragmentReferences");var B={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;L(v,f),B[v.name.value]=f}})},"extractReferences")();function I(D,v){for(var f=0;f<D.definitions.length;f++){var u=D.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(D,v){var f={kind:D.kind,definitions:[I(D,v)]};D.hasOwnProperty("loc")&&(f.loc=D.loc);var u=B[v]||new Set,g=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!g.has(s)){g.add(s);var i=B[s]||new Set;i.forEach(function(l){S.add(l)})}})}return g.forEach(function(s){var i=I(D,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetEmoteInfo=U(J,"FFZ_GetEmoteInfo")},60795:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteSetInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emoteSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:126}};J.loc.source={body:"query FFZ_GetEmoteSetInfo($id:ID!){emoteSet(id:$id){id owner{id login displayName subscriptionProducts{id emoteSetID state}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(D){return D.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function L(D,v){if(D.kind==="FragmentSpread")v.add(D.name.value);else if(D.kind==="VariableDefinition"){var f=D.type;f.kind==="NamedType"&&v.add(f.name.value)}D.selectionSet&&D.selectionSet.selections.forEach(function(u){L(u,v)}),D.variableDefinitions&&D.variableDefinitions.forEach(function(u){L(u,v)}),D.definitions&&D.definitions.forEach(function(u){L(u,v)})}G(L,"collectFragmentReferences");var B={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;L(v,f),B[v.name.value]=f}})},"extractReferences")();function I(D,v){for(var f=0;f<D.definitions.length;f++){var u=D.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(D,v){var f={kind:D.kind,definitions:[I(D,v)]};D.hasOwnProperty("loc")&&(f.loc=D.loc);var u=B[v]||new Set,g=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!g.has(s)){g.add(s);var i=B[s]||new Set;i.forEach(function(l){S.add(l)})}})}return g.forEach(function(s){var i=I(D,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetEmoteSetInfo=U(J,"FFZ_GetEmoteSetInfo")},87590:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"previewThumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"320"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"180"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"lengthSeconds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publishedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"50"}}],directives:[]}]}}]}}]}}],loc:{start:0,end:207}};J.loc.source={body:"query FFZ_GetVideoInfo($id:ID!){video(id:$id){id title previewThumbnailURL(width:320 height:180)lengthSeconds publishedAt viewCount game{id displayName}owner{id login displayName profileImageURL(width:50)}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(D){return D.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function L(D,v){if(D.kind==="FragmentSpread")v.add(D.name.value);else if(D.kind==="VariableDefinition"){var f=D.type;f.kind==="NamedType"&&v.add(f.name.value)}D.selectionSet&&D.selectionSet.selections.forEach(function(u){L(u,v)}),D.variableDefinitions&&D.variableDefinitions.forEach(function(u){L(u,v)}),D.definitions&&D.definitions.forEach(function(u){L(u,v)})}G(L,"collectFragmentReferences");var B={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;L(v,f),B[v.name.value]=f}})},"extractReferences")();function I(D,v){for(var f=0;f<D.definitions.length;f++){var u=D.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(D,v){var f={kind:D.kind,definitions:[I(D,v)]};D.hasOwnProperty("loc")&&(f.loc=D.loc);var u=B[v]||new Set,g=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!g.has(s)){g.add(s);var i=B[s]||new Set;i.forEach(function(l){S.add(l)})}})}return g.forEach(function(s){var i=I(D,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_GetVideoInfo=U(J,"FFZ_GetVideoInfo")},96883:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteCard"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emoteID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"emoteID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"channel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"localEmoteSets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"stream"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follower"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefit"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"priceInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currency"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"bitsBadgeTierSummary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threshold"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUnlocked"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numberOfBitsUntilUnlock"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:418}};J.loc.source={body:"query FFZ_EmoteCard($emoteID:ID!){emote(id:$emoteID){id type token setID artist{id login displayName}owner{id login displayName channel{id localEmoteSets{id emotes{id token}}}stream{id type}self{follower{followedAt}subscriptionBenefit{id tier}}subscriptionProducts{id displayName tier name url emotes{id token}priceInfo{id currency price}}}bitsBadgeTierSummary{threshold self{isUnlocked numberOfBitsUntilUnlock}}type}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(D){return D.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function L(D,v){if(D.kind==="FragmentSpread")v.add(D.name.value);else if(D.kind==="VariableDefinition"){var f=D.type;f.kind==="NamedType"&&v.add(f.name.value)}D.selectionSet&&D.selectionSet.selections.forEach(function(u){L(u,v)}),D.variableDefinitions&&D.variableDefinitions.forEach(function(u){L(u,v)}),D.definitions&&D.definitions.forEach(function(u){L(u,v)})}G(L,"collectFragmentReferences");var B={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;L(v,f),B[v.name.value]=f}})},"extractReferences")();function I(D,v){for(var f=0;f<D.definitions.length;f++){var u=D.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(D,v){var f={kind:D.kind,definitions:[I(D,v)]};D.hasOwnProperty("loc")&&(f.loc=D.loc);var u=B[v]||new Set,g=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!g.has(s)){g.add(s);var i=B[s]||new Set;i.forEach(function(l){S.add(l)})}})}return g.forEach(function(s){var i=I(D,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_EmoteCard=U(J,"FFZ_EmoteCard")},90424:ae=>{var J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteMenu_SubStatus"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"criteria"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SubscriptionBenefitCriteriaInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefits"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"criteria"},value:{kind:"Variable",name:{kind:"Name",value:"criteria"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gift"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isGift"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"purchasedWithPrime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"renewsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:296}};J.loc.source={body:"query FFZ_EmoteMenu_SubStatus($first:Int$after:Cursor$criteria:SubscriptionBenefitCriteriaInput!){currentUser{id subscriptionBenefits(first:$first after:$after criteria:$criteria){pageInfo{hasNextPage}edges{cursor node{id gift{isGift}purchasedWithPrime endsAt renewsAt product{id emoteSetID}}}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var d={};function W(D){return D.filter(function(v){if(v.kind!=="FragmentDefinition")return!0;var f=v.name.value;return d[f]?!1:(d[f]=!0,!0)})}G(W,"unique");function L(D,v){if(D.kind==="FragmentSpread")v.add(D.name.value);else if(D.kind==="VariableDefinition"){var f=D.type;f.kind==="NamedType"&&v.add(f.name.value)}D.selectionSet&&D.selectionSet.selections.forEach(function(u){L(u,v)}),D.variableDefinitions&&D.variableDefinitions.forEach(function(u){L(u,v)}),D.definitions&&D.definitions.forEach(function(u){L(u,v)})}G(L,"collectFragmentReferences");var B={};G(function(){J.definitions.forEach(function(v){if(v.name){var f=new Set;L(v,f),B[v.name.value]=f}})},"extractReferences")();function I(D,v){for(var f=0;f<D.definitions.length;f++){var u=D.definitions[f];if(u.name&&u.name.value==v)return u}}G(I,"findOperation");function U(D,v){var f={kind:D.kind,definitions:[I(D,v)]};D.hasOwnProperty("loc")&&(f.loc=D.loc);var u=B[v]||new Set,g=new Set,S=new Set;for(u.forEach(function(s){S.add(s)});S.size>0;){var n=S;S=new Set,n.forEach(function(s){if(!g.has(s)){g.add(s);var i=B[s]||new Set;i.forEach(function(l){S.add(l)})}})}return g.forEach(function(s){var i=I(D,s);i&&f.definitions.push(i)}),f}G(U,"oneQuery"),ae.exports=J,ae.exports.FFZ_EmoteMenu_SubStatus=U(J,"FFZ_EmoteMenu_SubStatus")},4866:(ae,J,d)=>{var W=d(89),L=d(49388),B=d(64311),I=d(45138);function U(D,v,f){if(arguments.length<2&&(f=D,D=null,v=null),this.capacity=f,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var u=B.getPointerArray(f);this.forward=new u(f),this.backward=new u(f),this.K=typeof D=="function"?new D(f):new Array(f),this.V=typeof v=="function"?new v(f):new Array(f),this.size=0,this.head=0,this.tail=0,this.items={}}G(U,"LRUCache"),U.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},U.prototype.splayOnTop=function(D){var v=this.head;if(this.head===D)return this;var f=this.backward[D],u=this.forward[D];return this.tail===D?this.tail=f:this.backward[u]=f,this.forward[f]=u,this.backward[v]=D,this.head=D,this.forward[D]=v,this},U.prototype.set=function(D,v){var f=this.items[D];if(typeof f<"u"){this.splayOnTop(f),this.V[f]=v;return}this.size<this.capacity?f=this.size++:(f=this.tail,this.tail=this.backward[f],delete this.items[this.K[f]]),this.items[D]=f,this.K[f]=D,this.V[f]=v,this.forward[f]=this.head,this.backward[this.head]=f,this.head=f},U.prototype.setpop=function(D,v){var f=null,u=null,g=this.items[D];return typeof g<"u"?(this.splayOnTop(g),f=this.V[g],this.V[g]=v,{evicted:!1,key:D,value:f}):(this.size<this.capacity?g=this.size++:(g=this.tail,this.tail=this.backward[g],f=this.V[g],u=this.K[g],delete this.items[this.K[g]]),this.items[D]=g,this.K[g]=D,this.V[g]=v,this.forward[g]=this.head,this.backward[this.head]=g,this.head=g,u?{evicted:!0,key:u,value:f}:null)},U.prototype.has=function(D){return D in this.items},U.prototype.get=function(D){var v=this.items[D];if(!(typeof v>"u"))return this.splayOnTop(v),this.V[v]},U.prototype.peek=function(D){var v=this.items[D];if(!(typeof v>"u"))return this.V[v]},U.prototype.forEach=function(D,v){v=arguments.length>1?v:this;for(var f=0,u=this.size,g=this.head,S=this.K,n=this.V,s=this.forward;f<u;)D.call(v,n[g],S[g],this),g=s[g],f++},U.prototype.keys=function(){var D=0,v=this.size,f=this.head,u=this.K,g=this.forward;return new W(function(){if(D>=v)return{done:!0};var S=u[f];return D++,D<v&&(f=g[f]),{done:!1,value:S}})},U.prototype.values=function(){var D=0,v=this.size,f=this.head,u=this.V,g=this.forward;return new W(function(){if(D>=v)return{done:!0};var S=u[f];return D++,D<v&&(f=g[f]),{done:!1,value:S}})},U.prototype.entries=function(){var D=0,v=this.size,f=this.head,u=this.K,g=this.V,S=this.forward;return new W(function(){if(D>=v)return{done:!0};var n=u[f],s=g[f];return D++,D<v&&(f=S[f]),{done:!1,value:[n,s]}})},typeof Symbol<"u"&&(U.prototype[Symbol.iterator]=U.prototype.entries),U.prototype.inspect=function(){for(var D=new Map,v=this.entries(),f;f=v.next(),!f.done;)D.set(f.value[0],f.value[1]);return Object.defineProperty(D,"constructor",{value:U,enumerable:!1}),D},typeof Symbol<"u"&&(U.prototype[Symbol.for("nodejs.util.inspect.custom")]=U.prototype.inspect),U.from=function(D,v,f,u){if(arguments.length<2){if(u=I.guessLength(D),typeof u!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(u=v,v=null,f=null);var g=new U(v,f,u);return L(D,function(S,n){g.set(n,S)}),g},ae.exports=U},45138:(ae,J,d)=>{var W=d(49388),L=d(64311);function B(v){return Array.isArray(v)||L.isTypedArray(v)}G(B,"isArrayLike");function I(v){if(typeof v.length=="number")return v.length;if(typeof v.size=="number")return v.size}G(I,"guessLength");function U(v){var f=I(v),u=typeof f=="number"?new Array(f):[],g=0;return W(v,function(S){u[g++]=S}),u}G(U,"toArray");function D(v){var f=I(v),u=typeof f=="number"?L.getPointerArray(f):Array,g=typeof f=="number"?new Array(f):[],S=typeof f=="number"?new u(f):[],n=0;return W(v,function(s){g[n]=s,S[n]=n++}),[g,S]}G(D,"toArrayWithIndices"),J.isArrayLike=B,J.guessLength=I,J.toArray=U,J.toArrayWithIndices=D},64311:(ae,J)=>{var d=Math.pow(2,8)-1,W=Math.pow(2,16)-1,L=Math.pow(2,32)-1,B=Math.pow(2,7)-1,I=Math.pow(2,15)-1,U=Math.pow(2,31)-1;J.getPointerArray=function(v){var f=v-1;if(f<=d)return Uint8Array;if(f<=W)return Uint16Array;if(f<=L)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},J.getSignedPointerArray=function(v){var f=v-1;return f<=B?Int8Array:f<=I?Int16Array:f<=U?Int32Array:Float64Array},J.getNumberType=function(v){return v===(v|0)?Math.sign(v)===-1?v<=127&&v>=-128?Int8Array:v<=32767&&v>=-32768?Int16Array:Int32Array:v<=255?Uint8Array:v<=65535?Uint16Array:Uint32Array:Float64Array};var D={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};J.getMinimalRepresentation=function(v,f){var u=null,g=0,S,n,s,i,l;for(i=0,l=v.length;i<l;i++)s=f?f(v[i]):v[i],n=J.getNumberType(s),S=D[n.name],S>g&&(g=S,u=n);return u},J.isTypedArray=function(v){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(v)},J.concat=function(){var v=0,f,u,g;for(f=0,g=arguments.length;f<g;f++)v+=arguments[f].length;var S=new arguments[0].constructor(v);for(f=0,u=0;f<g;f++)S.set(arguments[f],u),u+=arguments[f].length;return S},J.indices=function(v){for(var f=J.getPointerArray(v),u=new f(v),g=0;g<v;g++)u[g]=g;return u}},49388:(ae,J,d)=>{var W=d(18713),L=W.ARRAY_BUFFER_SUPPORT,B=W.SYMBOL_SUPPORT;ae.exports=G(function(U,D){var v,f,u,g,S;if(!U)throw new Error("obliterator/forEach: invalid iterable.");if(typeof D!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(U)||L&&ArrayBuffer.isView(U)||typeof U=="string"||U.toString()==="[object Arguments]"){for(u=0,g=U.length;u<g;u++)D(U[u],u);return}if(typeof U.forEach=="function"){U.forEach(D);return}if(B&&Symbol.iterator in U&&typeof U.next!="function"&&(U=U[Symbol.iterator]()),typeof U.next=="function"){for(v=U,u=0;S=v.next(),S.done!==!0;)D(S.value,u),u++;return}for(f in U)U.hasOwnProperty(f)&&D(U[f],f)},"forEach")},89:ae=>{function J(d){if(typeof d!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=d}G(J,"Iterator"),typeof Symbol<"u"&&(J.prototype[Symbol.iterator]=function(){return this}),J.of=function(){var d=arguments,W=d.length,L=0;return new J(function(){return L>=W?{done:!0}:{done:!1,value:d[L++]}})},J.empty=function(){var d=new J(function(){return{done:!0}});return d},J.fromSequence=function(d){var W=0,L=d.length;return new J(function(){return W>=L?{done:!0}:{done:!1,value:d[W++]}})},J.is=function(d){return d instanceof J?!0:typeof d=="object"&&d!==null&&typeof d.next=="function"},ae.exports=J},18713:(ae,J)=>{J.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",J.SYMBOL_SUPPORT=typeof Symbol<"u"},72167:ae=>{ae.exports=s,ae.exports.match=B,ae.exports.regexpToFunction=I,ae.exports.parse=W,ae.exports.compile=L,ae.exports.tokensToFunction=U,ae.exports.tokensToRegExp=n;var J="/",d=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function W(i,l){for(var w=[],b=0,r=0,e="",a=l&&l.delimiter||J,p=l&&l.whitelist||void 0,C=!1,y;(y=d.exec(i))!==null;){var z=y[0],$=y[1],o=y.index;if(e+=i.slice(r,o),r=o+z.length,$){e+=$[1],C=!0;continue}var c="",m=y[2],A=y[3],h=y[4],T=y[5];if(!C&&e.length){var R=e.length-1,P=e[R],O=p?p.indexOf(P)>-1:!0;O&&(c=P,e=e.slice(0,R))}e&&(w.push(e),e="",C=!1);var M=T==="+"||T==="*",j=T==="?"||T==="*",Y=A||h,ee=c||a;w.push({name:m||b++,prefix:c,delimiter:ee,optional:j,repeat:M,pattern:Y?v(Y):"[^"+D(ee===a?ee:ee+a)+"]+?"})}return(e||r<i.length)&&w.push(e+i.substr(r)),w}G(W,"parse");function L(i,l){return U(W(i,l),l)}G(L,"compile");function B(i,l){var w=[],b=s(i,w,l);return I(b,w)}G(B,"match");function I(i,l){return function(w,b){var r=i.exec(w);if(!r)return!1;for(var e=r[0],a=r.index,p={},C=b&&b.decode||decodeURIComponent,y=1;y<r.length;y++)if(r[y]!==void 0){var z=l[y-1];z.repeat?p[z.name]=r[y].split(z.delimiter).map(function($){return C($,z)}):p[z.name]=C(r[y],z)}return{path:e,index:a,params:p}}}G(I,"regexpToFunction");function U(i,l){for(var w=new Array(i.length),b=0;b<i.length;b++)typeof i[b]=="object"&&(w[b]=new RegExp("^(?:"+i[b].pattern+")$",f(l)));return function(r,e){for(var a="",p=e&&e.encode||encodeURIComponent,C=e?e.validate!==!1:!0,y=0;y<i.length;y++){var z=i[y];if(typeof z=="string"){a+=z;continue}var $=r?r[z.name]:void 0,o;if(Array.isArray($)){if(!z.repeat)throw new TypeError('Expected "'+z.name+'" to not repeat, but got array');if($.length===0){if(z.optional)continue;throw new TypeError('Expected "'+z.name+'" to not be empty')}for(var c=0;c<$.length;c++){if(o=p($[c],z),C&&!w[y].test(o))throw new TypeError('Expected all "'+z.name+'" to match "'+z.pattern+'"');a+=(c===0?z.prefix:z.delimiter)+o}continue}if(typeof $=="string"||typeof $=="number"||typeof $=="boolean"){if(o=p(String($),z),C&&!w[y].test(o))throw new TypeError('Expected "'+z.name+'" to match "'+z.pattern+'", but got "'+o+'"');a+=z.prefix+o;continue}if(!z.optional)throw new TypeError('Expected "'+z.name+'" to be '+(z.repeat?"an array":"a string"))}return a}}G(U,"tokensToFunction");function D(i){return i.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}G(D,"escapeString");function v(i){return i.replace(/([=!:$/()])/g,"\\$1")}G(v,"escapeGroup");function f(i){return i&&i.sensitive?"":"i"}G(f,"flags");function u(i,l){if(!l)return i;var w=i.source.match(/\((?!\?)/g);if(w)for(var b=0;b<w.length;b++)l.push({name:b,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return i}G(u,"regexpToRegexp");function g(i,l,w){for(var b=[],r=0;r<i.length;r++)b.push(s(i[r],l,w).source);return new RegExp("(?:"+b.join("|")+")",f(w))}G(g,"arrayToRegexp");function S(i,l,w){return n(W(i,w),l,w)}G(S,"stringToRegexp");function n(i,l,w){w=w||{};for(var b=w.strict,r=w.start!==!1,e=w.end!==!1,a=w.delimiter||J,p=[].concat(w.endsWith||[]).map(D).concat("$").join("|"),C=r?"^":"",y=0;y<i.length;y++){var z=i[y];if(typeof z=="string")C+=D(z);else{var $=z.repeat?"(?:"+z.pattern+")(?:"+D(z.delimiter)+"(?:"+z.pattern+"))*":z.pattern;l&&l.push(z),z.optional?z.prefix?C+="(?:"+D(z.prefix)+"("+$+"))?":C+="("+$+")?":C+=D(z.prefix)+"("+$+")"}}if(e)b||(C+="(?:"+D(a)+")?"),C+=p==="$"?"$":"(?="+p+")";else{var o=i[i.length-1],c=typeof o=="string"?o[o.length-1]===a:o===void 0;b||(C+="(?:"+D(a)+"(?="+p+"))?"),c||(C+="(?="+D(a)+"|"+p+")")}return new RegExp(C,f(w))}G(n,"tokensToRegExp");function s(i,l,w){return i instanceof RegExp?u(i,l):Array.isArray(i)?g(i,l,w):S(i,l,w)}G(s,"pathToRegexp")},73637:(ae,J,d)=>{var W={"./af.js":[20179,1081],"./am.js":[61783,5380],"./ar-dz.js":[98136,5215],"./ar-iq.js":[82690,789],"./ar-kw.js":[62009,5151],"./ar-ly.js":[49408,1722],"./ar-ma.js":[87330,909],"./ar-sa.js":[66575,5012],"./ar-tn.js":[5742,8757],"./ar.js":[46567,3030],"./az.js":[14319,8736],"./be.js":[41737,2244],"./bg.js":[86835,6757],"./bi.js":[50045,8111],"./bm.js":[65561,9082],"./bn.js":[57602,4667],"./bo.js":[92594,3134],"./br.js":[34467,3968],"./bs.js":[53169,9248],"./ca.js":[97569,4178],"./cs.js":[30625,5123],"./cv.js":[6326,4060],"./cy.js":[49268,3166],"./da.js":[11559,4103],"./de-at.js":[12369,5954],"./de-ch.js":[71107,7168],"./de.js":[24569,300],"./dv.js":[25427,5528],"./el.js":[90524,1784],"./en-au.js":[29061,4634],"./en-ca.js":[31304,2928],"./en-gb.js":[84252,627],"./en-ie.js":[48757,2730],"./en-il.js":[98038,9],"./en-in.js":[7282,6644],"./en-nz.js":[97960,485],"./en-sg.js":[435,3949],"./en-tt.js":[90954,5818],"./en.js":[22039,427],"./eo.js":[39399,3923],"./es-do.js":[47688,4026],"./es-mx.js":[81773,2972],"./es-pr.js":[66106,5624],"./es-us.js":[18541,187],"./es.js":[23607,172],"./et.js":[29776,9040],"./eu.js":[20166,6960],"./fa.js":[28288,6633],"./fi.js":[88189,5928],"./fo.js":[49697,9627],"./fr-ca.js":[15296,7007],"./fr-ch.js":[53415,7063],"./fr.js":[4938,3674],"./fy.js":[7811,8733],"./ga.js":[3368,6020],"./gd.js":[53560,3017],"./gl.js":[85222,4466],"./gom-latn.js":[38546,6099],"./gu.js":[78309,6993],"./he.js":[41436,9706],"./hi.js":[463,7409],"./hr.js":[27147,3793],"./ht.js":[95139,3104],"./hu.js":[18224,6994],"./hy-am.js":[25976,365],"./id.js":[74970,2698],"./is.js":[799,1087],"./it-ch.js":[6071,8302],"./it.js":[97727,8744],"./ja.js":[78117,9418],"./jv.js":[22281,3496],"./ka.js":[87931,3099],"./kk.js":[52334,1494],"./km.js":[35155,6169],"./kn.js":[72879,9701],"./ko.js":[62905,5929],"./ku.js":[34078,8555],"./ky.js":[24026,2819],"./lb.js":[62619,8124],"./lo.js":[29979,1462],"./lt.js":[75887,6903],"./lv.js":[35493,2437],"./me.js":[50532,4518],"./mi.js":[73059,3883],"./mk.js":[17450,3512],"./ml.js":[66422,8996],"./mn.js":[16428,8753],"./mr.js":[35778,3294],"./ms-my.js":[40583,2593],"./ms.js":[33650,6881],"./mt.js":[6045,4863],"./my.js":[74361,3741],"./nb.js":[10697,3148],"./ne.js":[16608,3868],"./nl-be.js":[11377,7953],"./nl.js":[6987,9724],"./nn.js":[8758,9663],"./oc-lnc.js":[68064,9495],"./pa-in.js":[16767,838],"./pl.js":[28012,8705],"./pt-br.js":[19978,3639],"./pt.js":[51357,7479],"./ro.js":[71948,3905],"./ru.js":[3381,8700],"./rw.js":[79914,3128],"./sd.js":[90126,7087],"./se.js":[46319,8723],"./si.js":[99008,9797],"./sk.js":[84600,6512],"./sl.js":[64955,3951],"./sq.js":[74716,3392],"./sr-cyrl.js":[55854,1532],"./sr.js":[23534,1907],"./ss.js":[19239,7003],"./sv-fi.js":[57972,9047],"./sv.js":[43032,8919],"./sw.js":[60125,4176],"./ta.js":[1565,9872],"./te.js":[92516,5825],"./tet.js":[26712,4984],"./tg.js":[39351,4653],"./th.js":[89225,5389],"./tk.js":[48485,2355],"./tl-ph.js":[17517,2343],"./tlh.js":[35984,3508],"./tr.js":[33092,2661],"./tzl.js":[69109,6199],"./tzm-latn.js":[13637,6782],"./tzm.js":[38063,1785],"./ug-cn.js":[98490,8256],"./uk.js":[65589,6190],"./ur.js":[85859,3199],"./uz-latn.js":[96588,3290],"./uz.js":[45589,9238],"./vi.js":[41191,357],"./x-pseudo.js":[59018,6858],"./yo.js":[14163,8898],"./zh-cn.js":[9073,5352],"./zh-hk.js":[74828,8638],"./zh-tw.js":[78141,4101],"./zh.js":[42882,5235]};function L(B){if(!d.o(W,B))return Promise.resolve().then(()=>{var D=new Error("Cannot find module '"+B+"'");throw D.code="MODULE_NOT_FOUND",D});var I=W[B],U=I[0];return d.e(I[1]).then(()=>d.t(U,23))}G(L,"webpackAsyncContext"),L.keys=()=>Object.keys(W),L.id=73637,ae.exports=L},10952:(ae,J,d)=>{var W={"./chat/index.js":89959,"./emote_card/index.jsx":99733,"./link_card/index.jsx":88082,"./main_menu/index.js":5624,"./metadata.tsx":89817,"./tooltips.ts":45655,"./translation_ui/index.js":19745};function L(I){var U=B(I);return d(U)}G(L,"webpackContext");function B(I){if(!d.o(W,I)){var U=new Error("Cannot find module '"+I+"'");throw U.code="MODULE_NOT_FOUND",U}return W[I]}G(B,"webpackContextResolve"),L.keys=G(function(){return Object.keys(W)},"webpackContextKeys"),L.resolve=B,ae.exports=L,L.id=10952},41152:(ae,J,d)=>{var W={"./bits_button.js":24531,"./bttv_compat.js":11746,"./channel.jsx":74756,"./chat/index.js":6172,"./compat_emote_menu.js":6325,"./css_tweaks/index.js":17103,"./dashboard.js":95778,"./directory/index.jsx":96432,"./layout.js":68318,"./loadable.tsx":34923,"./menu_button.jsx":29333,"./mod-view.jsx":94296,"./player.jsx":63155,"./sub_button.tsx":70052,"./theme/index.js":24020,"./video_chat/index.jsx":4948};function L(I){var U=B(I);return d(U)}G(L,"webpackContext");function B(I){if(!d.o(W,I)){var U=new Error("Cannot find module '"+I+"'");throw U.code="MODULE_NOT_FOUND",U}return W[I]}G(B,"webpackContextResolve"),L.keys=G(function(){return Object.keys(W)},"webpackContextKeys"),L.resolve=B,ae.exports=L,L.id=41152},77074:(ae,J,d)=>{"use strict";ae.exports=d.p+"experiments.json"},24290:ae=>{"use strict";ae.exports=ffzVue},91054:()=>{}},Ct={};function ke(ae){var J=Ct[ae];if(J!==void 0)return J.exports;var d=Ct[ae]={exports:{}};return Et[ae].call(d.exports,d,d.exports,ke),d.exports}G(ke,"__webpack_require__"),ke.m=Et,ke.n=ae=>{var J=ae&&ae.__esModule?()=>ae.default:()=>ae;return ke.d(J,{a:J}),J},(()=>{var ae=Object.getPrototypeOf?d=>Object.getPrototypeOf(d):d=>d.__proto__,J;ke.t=function(d,W){if(W&1&&(d=this(d)),W&8||typeof d=="object"&&d&&(W&4&&d.__esModule||W&16&&typeof d.then=="function"))return d;var L=Object.create(null);ke.r(L);var B={};J=J||[null,ae({}),ae([]),ae(ae)];for(var I=W&2&&d;typeof I=="object"&&!~J.indexOf(I);I=ae(I))Object.getOwnPropertyNames(I).forEach(U=>B[U]=()=>d[U]);return B.default=()=>d,ke.d(L,B),L}})(),ke.d=(ae,J)=>{for(var d in J)ke.o(J,d)&&!ke.o(ae,d)&&Object.defineProperty(ae,d,{enumerable:!0,get:J[d]})},ke.f={},ke.e=ae=>Promise.all(Object.keys(ke.f).reduce((J,d)=>(ke.f[d](ae,J),J),[])),ke.u=ae=>""+({9:"i18n-33",172:"i18n-44",187:"i18n-43",204:"menu-md4",208:"rich_tokens",300:"i18n-26",357:"i18n-134",365:"i18n-64",427:"i18n-38",485:"i18n-35",627:"i18n-31",789:"i18n-3",838:"i18n-98",909:"i18n-6",935:"zip",1081:"i18n-0",1087:"i18n-66",1462:"i18n-79",1494:"i18n-72",1532:"i18n-111",1722:"i18n-5",1784:"i18n-28",1785:"i18n-128",1871:"translation-ui",1907:"i18n-112",2009:"markdown",2086:"main-menu",2244:"i18n-11",2343:"i18n-123",2348:"chat",2355:"i18n-122",2437:"i18n-81",2593:"i18n-88",2597:"site-css-tweaks",2661:"i18n-125",2698:"i18n-65",2730:"i18n-32",2819:"i18n-77",2928:"i18n-30",2972:"i18n-41",3017:"i18n-55",3030:"i18n-9",3099:"i18n-71",3104:"i18n-62",3128:"i18n-104",3134:"i18n-16",3148:"i18n-92",3166:"i18n-22",3199:"i18n-131",3224:"queries",3290:"i18n-132",3294:"i18n-87",3392:"i18n-110",3496:"i18n-70",3508:"i18n-124",3512:"i18n-84",3639:"i18n-100",3674:"i18n-52",3741:"i18n-91",3793:"i18n-61",3868:"i18n-93",3883:"i18n-83",3905:"i18n-102",3923:"i18n-39",3949:"i18n-36",3951:"i18n-109",3968:"i18n-17",4026:"i18n-40",4060:"i18n-21",4101:"i18n-139",4103:"i18n-23",4164:"menu-md1",4176:"i18n-116",4178:"i18n-19",4466:"i18n-56",4518:"i18n-82",4634:"i18n-29",4653:"i18n-120",4667:"i18n-15",4863:"i18n-90",4984:"i18n-119",5012:"i18n-7",5123:"i18n-20",5151:"i18n-4",5215:"i18n-2",5235:"i18n-140",5352:"i18n-137",5380:"i18n-1",5389:"i18n-121",5528:"i18n-27",5624:"i18n-42",5818:"i18n-37",5825:"i18n-118",5928:"i18n-48",5929:"i18n-75",5954:"i18n-24",6020:"i18n-54",6099:"i18n-57",6115:"emote-cards",6169:"i18n-73",6190:"i18n-130",6199:"i18n-126",6512:"i18n-108",6530:"regex",6633:"i18n-47",6644:"i18n-34",6757:"i18n-12",6782:"i18n-127",6858:"i18n-135",6881:"i18n-89",6903:"i18n-80",6960:"i18n-46",6993:"i18n-58",6994:"i18n-63",7003:"i18n-113",7007:"i18n-50",7063:"i18n-51",7087:"i18n-105",7168:"i18n-25",7409:"i18n-60",7479:"i18n-101",7485:"vue",7629:"menu-md0",7953:"i18n-94",8111:"i18n-13",8124:"i18n-78",8163:"menu-md5",8256:"i18n-129",8302:"i18n-67",8555:"i18n-76",8586:"overrides",8638:"i18n-138",8700:"i18n-103",8705:"i18n-99",8723:"i18n-106",8733:"i18n-53",8736:"i18n-10",8744:"i18n-68",8753:"i18n-86",8757:"i18n-8",8898:"i18n-136",8919:"i18n-115",8996:"i18n-85",9040:"i18n-45",9047:"i18n-114",9082:"i18n-14",9238:"i18n-133",9248:"i18n-18",9418:"i18n-69",9442:"vue-chat",9495:"i18n-97",9627:"i18n-49",9663:"i18n-96",9701:"i18n-74",9706:"i18n-59",9724:"i18n-95",9797:"i18n-107",9872:"i18n-117"}[ae]||ae)+".js",ke.h=()=>"76313c69f0d0df3a2768",ke.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),ke.o=(ae,J)=>Object.prototype.hasOwnProperty.call(ae,J),(()=>{var ae={},J="frankerfacez:";ke.l=(d,W,L,B)=>{if(ae[d]){ae[d].push(W);return}var I,U;if(L!==void 0)for(var D=document.getElementsByTagName("script"),v=0;v<D.length;v++){var f=D[v];if(f.getAttribute("src")==d||f.getAttribute("data-webpack")==J+L){I=f;break}}I||(U=!0,I=document.createElement("script"),I.charset="utf-8",I.timeout=120,ke.nc&&I.setAttribute("nonce",ke.nc),I.setAttribute("data-webpack",J+L),I.src=d,I.src.indexOf(window.location.origin+"/")!==0&&(I.crossOrigin="anonymous")),ae[d]=[W];var u=G((S,n)=>{I.onerror=I.onload=null,clearTimeout(g);var s=ae[d];if(delete ae[d],I.parentNode&&I.parentNode.removeChild(I),s&&s.forEach(i=>i(n)),S)return S(n)},"onScriptComplete"),g=setTimeout(u.bind(null,void 0,{type:"timeout",target:I}),12e4);I.onerror=u.bind(null,I.onerror),I.onload=u.bind(null,I.onload),U&&document.head.appendChild(I)}})(),ke.r=ae=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ae,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ae,"__esModule",{value:!0})},ke.j=8363,(()=>{var ae;ke.g.importScripts&&(ae=ke.g.location+"");var J=ke.g.document;if(!ae&&J&&(J.currentScript&&(ae=J.currentScript.src),!ae)){var d=J.getElementsByTagName("script");if(d.length)for(var W=d.length-1;W>-1&&!ae;)ae=d[W--].src}if(!ae)throw new Error("Automatic publicPath is not supported in this browser");ae=ae.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),ke.p=ae})(),(()=>{var ae={8363:0,2682:0};ke.f.j=(W,L)=>{var B=ke.o(ae,W)?ae[W]:void 0;if(B!==0)if(B)L.push(B[2]);else{var I=new Promise((f,u)=>B=ae[W]=[f,u]);L.push(B[2]=I);var U=ke.p+ke.u(W),D=new Error,v=G(f=>{if(ke.o(ae,W)&&(B=ae[W],B!==0&&(ae[W]=void 0),B)){var u=f&&(f.type==="load"?"missing":f.type),g=f&&f.target&&f.target.src;D.message="Loading chunk "+W+` failed.
(`+u+": "+g+")",D.name="ChunkLoadError",D.type=u,D.request=g,B[1](D)}},"loadingEnded");ke.l(U,v,"chunk-"+W,W)}};var J=G((W,L)=>{var[B,I,U]=L,D,v,f=0;if(B.some(g=>ae[g]!==0)){for(D in I)ke.o(I,D)&&(ke.m[D]=I[D]);if(U)var u=U(ke)}for(W&&W(L);f<B.length;f++)v=B[f],ke.o(ae,v)&&ae[v]&&ae[v][0](),ae[v]=0},"webpackJsonpCallback"),d=globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[];d.forEach(J.bind(null,0)),d.push=J.bind(null,d.push.bind(d))})();var Ut={};(()=>{var ve,H;"use strict";var ae={};ke.r(ae),ke.d(ae,{LogLevel:()=>B,Logger:()=>D,default:()=>v});var J={};ke.r(J),ke.d(J,{Addon:()=>fe});var d=ke(51722),W=ke.n(d);const L={1:"debug",2:"info",4:"warn",8:"error"};var B=(V=>(V[V.Verbose=0]="Verbose",V[V.Debug=1]="Debug",V[V.Info=2]="Info",V[V.Warning=4]="Warning",V[V.Error=8]="Error",V[V.Off=99]="Off",V))(B||{});function I(){const V=localStorage.ffzLogLevel;if(!V)return null;const E=V.toUpperCase(),x=D[E];return typeof x=="number"?x:/^\d+$/.test(V)?parseInt(V,10):null}G(I,"readLSLevel");const U=(ve=class{constructor(E,x,k,N){this.root=E?E.root:this,this.parent=E,this.name=x,this.root==this&&(this.init=!1,this.captured_init=[],this.label="FFZ"),this.enabled=!0,this.level=k??(E&&E.level)??I()??ve.DEFAULT_LEVEL,this.raven=N||E&&E.raven,this.children={}}hi(E,x){const k=x??E.constructor?.version_info;this.info(`FrankerFaceZ v${k} (s:${E.host} f:${E.flavor} b:${k?.build} c:${k?.commit||"null"})`);try{const N=new URL(location.toString());N.search="",this.info(`Initial URL: ${N}`)}catch(N){this.warn("Unable to read location.",N)}}get(E,x){return this.children[E]||(this.children[E]=new ve(this,this.name?`${this.name}.${E}`:E,x)),this.children[E]}verbose(E,...x){return this.invoke(0,E,x)}verboseColor(E,x,...k){return this.invokeColor(ve.VERBOSE,E,x,k)}debug(E,...x){return this.invoke(ve.DEBUG,E,x)}debugColor(E,x,...k){return this.invokeColor(ve.DEBUG,E,x,k)}info(E,...x){return this.invoke(ve.INFO,E,x)}infoColor(E,x,...k){return this.invokeColor(ve.INFO,E,x,k)}warn(E,...x){return this.invoke(ve.WARN,E,x)}warnColor(E,x,...k){return this.invokeColor(ve.WARN,E,x,k)}warning(E,...x){return this.invoke(ve.WARN,E,x)}warningColor(E,x,...k){return this.invokeColor(ve.WARN,E,x,k)}error(E,...x){return this.invoke(ve.ERROR,E,x)}errorColor(E,x,...k){return this.invokeColor(ve.ERROR,E,x,k)}crumb(...E){if(this.raven)return this.raven.captureBreadcrumb(...E)}capture(E,x,...k){if(this.raven&&(x=x||{},x.logger||(x.logger=this.name),this.raven.captureException(E,x)),k.length){const N=k.shift();return this.error(N,...k)}}invokeColor(E,x,k,...N){if(!this.enabled||E<this.level)return;if(Array.isArray(k)||(k=[k]),E>0){let se=x;typeof se=="string"&&(se=se.replace(/%c/g,"")),N.length&&(se=`${se} ${N.join(" ")}`),this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:se,level:L[E]||E}),this.crumb({message:se,category:this.name,level:L[E]||E})}const Z=E<2?"color:#999999":"";this.name?(typeof x=="string"?x=`%c${this.root.label} [%c${this.name}%c]:%c ${x}`:(N.unshift(x),x=`%c${this.root.label} [%c${this.name}%c]:%c`),k.unshift("color:#755000; font-weight:bold",Z,"color:#755000; font-weight:bold",Z)):(typeof x=="string"?x=`%c${this.root.label}:%c ${x}`:(N.unshift(x),x=`%c${this.root.label}:%c`),k.unshift("color:#755000; font-weight:bold",Z)),E<2?console.debug(x,...k,...N):E<4?console.info(x,...k,...N):E<8?console.warn(x,...k,...N):E<99&&console.error(x,...k,...N)}invoke(E,x,k){if(!this.enabled||E<this.level||E>=99)return;const N=k?[x,...k]:[x];if(E>0){const de=N.join(" ");this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:de,level:L[E]||E}),this.crumb({message:de,category:this.name,level:L[E]||E})}const Z=E<2?"color:#999999":"";let se="";if(Z!=="")for(;N.length>0&&typeof N[0]=="string";)se+=" "+N.shift();this.name?N.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${se}`,"color:#755000; font-weight:bold",Z,"color:#755000; font-weight:bold",Z):N.unshift(`%c${this.root.label}:%c${se}`,"color:#755000; font-weight:bold",Z),E<2?console.debug(...N):E<4?console.info(...N):E<8?console.warn(...N):E<99&&console.error(...N)}},G(ve,"_Logger2"),ve);U.Levels=B,U.VERBOSE=0,U.DEBUG=1,U.INFO=2,U.WARN=4,U.WARNING=4,U.ERROR=8,U.OFF=99,U.DEFAULT_LEVEL=2;let D=U;const v=D;var f=ke(22527),u=ke(46949),g=ke(24431),S=ke(68069),n=ke(44589),s=ke(83269);const Fe=class Fe extends f.default{constructor(E,x){super(E,x),this.i18n=null,this.load_tracker=null,this.settings=null,this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("load_tracker"),this.load_requires=["settings"],this.target=this.parent.flavor||"unknown",this.has_dev=!1,this.reload_required=!1,this.addons={},this.enabled_addons=[],this.versions={},this.load_tracker.schedule("chat-data","addon-initial")}onLoad(){this._loader=this.loadAddonData()}onEnable(){this.settings.addUI("add-ons",{path:'Add-Ons @{"description": "Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.", "profile_warning": false}',component:"addon-list",title:"Add-Ons",no_filter:!0,getExtraTerms:()=>Object.values(this.addons).map(E=>E.search_terms),getFFZ:()=>this,isReady:()=>this.enabled,getAddons:()=>Object.values(this.addons),getVersions:()=>(0,u.deep_copy)(this.versions),hasAddon:E=>this.hasAddon(E),getVersion:E=>this.getVersion(E),doesAddonTarget:E=>this.doesAddonTarget(E),isAddonEnabled:E=>this.isAddonEnabled(E),isAddonExternal:E=>this.isAddonExternal(E),enableAddon:E=>this.enableAddon(E),disableAddon:E=>this.disableAddon(E),reloadAddon:E=>this.reloadAddon(E),canReloadAddon:E=>this.canReloadAddon(E),isReloadRequired:()=>this.reload_required,refresh:()=>window.location.reload(),on:(...E)=>this.on(...E),off:(...E)=>this.off(...E)}),g.EXTENSION||this.settings.add("addons.dev.server",{default:!1,ui:{path:"Add-Ons >> Development",title:"Use Local Development Server",description:"Attempt to load add-ons from local development server on port 8001.",component:"setting-check-box"}}),this.on("i18n:update",this.rebuildAddonSearch,this),this.settings.provider.on("changed",this.onProviderChange,this),this._loader?.then(()=>{this.enabled_addons=this.settings.provider.get("addons.enabled",[]);for(const E of this.enabled_addons)this.hasAddon(E)&&this.doesAddonTarget(E)&&this._enableAddon(E).catch(x=>{this.log.error(`An error occured while enabling the add-on "${E}":`,x),this.log.capture(x)});this.load_tracker.notify("chat-data","addon-initial"),this.emit(":ready")})}doesAddonTarget(E){const x=this.getAddon(E);if(!x)return!1;const k=x.targets??["main"];return Array.isArray(k)?k.includes(this.target):!1}generateLog(){const E=["Known"];for(const[x,k]of Object.entries(this.addons)){if(Array.isArray(k))continue;const N=this.versions[x];E.push(`${x} | ${this.isAddonEnabled(x)?"enabled":"disabled"} | ${N?`${N} | `:""}${k.dev?"dev | ":""}${this.isAddonExternal(x)?"external | ":""}${k.short_name} v${k.version}`)}E.push(""),E.push("Modules");for(const[x,k]of Object.entries(this.__modules))k&&E.push(`${k.loaded?"loaded  ":k.loading?"loading ":"unloaded"} | ${k.enabled?"enabled ":k.enabling?"enabling":"disabled"} | ${x}`);return E.join(`
`)}onProviderChange(E,x){if(E!="addons.enabled")return;const k=Array.isArray(x)?x:[],N=[...this.enabled_addons];for(const Z of N)k.includes(Z)||this.disableAddon(Z,!1);for(const Z of k)N.includes(Z)||this.enableAddon(Z,!1)}async loadAddonData(){const[E,x]=await Promise.all([(0,u.fetchJSON)(`${g.SERVER_OR_EXT}/addons.json?_=${(0,s.getBuster)(30)}`),!g.EXTENSION&&this.settings.get("addons.dev.server")?(0,u.fetchJSON)(`https://localhost:8001/script/addons.json?_=${(0,s.getBuster)()}`):null]);if(Array.isArray(E)){const k=`${g.SERVER_OR_EXT}/addons/`;for(const N of E)N.icon&&(N.icon=new URL(N.icon,k).toString()),this.addAddon(N,!1)}if(Array.isArray(x)){this.has_dev=!0;for(const k of x)this.addAddon(k,!0)}this.settings.updateContext({addonDev:this.has_dev}),this.rebuildAddonSearch(),this.emit(":data-loaded")}setVersion(E,x){this.versions[E]=x}addAddon(E,x=!1){let k=E;const N=this.addons[k.id];this.addons[k.id]=k,k.name=k.name??k.id,k.dev=x,k.requires=k.requires||[],k.required_by=Array.isArray(N)?N:N&&N.required_by||[],k.updated&&(k.updated=new Date(k.updated)),k.created&&(k.created=new Date(k.created)),k._search=k.search_terms;for(const Z of k.requires){const se=this.addons[Z];Array.isArray(se)?se.push(k.id):se?se.required_by.push(k.id):this.addons[Z]=[k.id]}(!N||Array.isArray(N))&&this.settings.addUI(`addon-changelog.${k.id}`,{path:`Add-Ons > Changelog > ${k.name}`,component:"changelog",force_seen:!0,addons:!0,addon:(0,u.deep_copy)(k),getFFZ:()=>this,getVersion:()=>this.versions[k.id]}),this.emit(":added",k.id,k)}rebuildAddonSearch(){for(const E of Object.values(this.addons)){if(Array.isArray(E))continue;const x=new Set([E._search,E.name,E.short_name,E.author,E.description]);this.i18n.locale!=="en"&&(E.name_i18n&&x.add(this.i18n.t(E.name_i18n,E.name)),E.short_name_i18n&&x.add(this.i18n.t(E.short_name_i18n,E.short_name)),E.author_i18n&&x.add(this.i18n.t(E.author_i18n,E.author)),E.maintainer_i18n&&x.add(this.i18n.t(E.maintainer_i18n,E.maintainer)),E.description_i18n&&x.add(this.i18n.t(E.description_i18n,E.description))),E.search_terms=[...x].map(k=>k?k.toLocaleLowerCase():"").join(`
`)}}isAddonEnabled(E){return this.isAddonExternal(E)?!0:this.enabled_addons.includes(E)}getAddon(E){const x=this.addons[E]??null;return Array.isArray(x)?null:x}hasAddon(E){return this.getAddon(E)!=null}getVersion(E){const x=this.getAddon(E);if(!x)throw new Error(`Unknown add-on id: ${E}`);const k=this.resolve(`addon.${E}`);if(k){if("version"in k)return k.version;if(k.constructor&&"version"in k.constructor)return k.constructor.version}return x.version}isAddonExternal(E){if(!this.hasAddon(E))throw new Error(`Unknown add-on id: ${E}`);const x=this.resolve(`addon.${E}`);return x?document.head.querySelector(`script#ffz-loaded-addon-${E}`)?x.external||x.constructor?.external:!0:!1}canReloadAddon(E){if(!this.hasAddon(E))throw new Error(`Unknown add-on id: ${E}`);let x=this.resolve(`addon.${E}`);if(!x||!x.canDisable()||!x.canUnload())return!1;if(x.children){for(const k of Object.values(x.children))if(!k.canDisable()||!k.canUnload())return!1}return!0}async fullyUnloadModule(E){if(!(!E||!E.addon_id)){if(E.children)for(const x of Object.values(E.children))await this.fullyUnloadModule(x);await E.disable(),await E.unload(),E.parent instanceof f.default&&E.parent.children[E.name]===E&&delete E.parent.children[E.name];for(const x of E.references){const k=this.resolve(x[0]),N=x[1];k[N]===E&&(k[N]=null)}this.emit(":fully-unload",E.addon_id),this.__modules[E.__path]===E&&delete this.__modules[E.__path],this.off(void 0,void 0,E);for(const x of this.settings.__contexts)x.off(void 0,void 0,E);for(const[x,k]of Array.from(this.settings.definitions.entries()))!Array.isArray(k)&&k?.__source===E.addon_id&&this.settings.remove(x);E.__log=null}}async reloadAddon(E){const x=this.getAddon(E),k=this.resolve("site.menu_button");if(!x)throw new Error(`Unknown add-on id: ${E}`);const N=performance.now();let Z=this.resolve(`addon.${E}`);if(Z)try{await this.fullyUnloadModule(Z)}catch(_e){throw k&&k.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.unload",text:`Unable to unload existing modules for add-on "{addon_id}":

{error}`,icon:"ffz-i-attention",addon_id:E,error:String(_e)}),_e}let se=document.querySelector(`script#ffz-loaded-addon-${x.id}`);se&&se.remove(),window.ffzAddonsWebpackJsonp&&(window.ffzAddonsWebpackJsonp=void 0);try{await this._enableAddon(E)}catch(_e){throw k&&k.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.reload",text:`Unable to load new module for add-on "{addon_id}":

{error}`,error:String(_e),icon:"ffz-i-attention",addon_id:E}),_e}const de=performance.now();k&&k.addToast({title_i18n:"addons.reload.toast",title:"Reloaded Add-On",text_i18n:"addons.reload.toast.text",text:'Successfully reloaded add-on "{addon_id}" in {duration}ms.',icon:"ffz-i-info",addon_id:E,timeout:5e3,duration:Math.round(100*(de-N))/100})}async _enableAddon(E){const x=this.getAddon(E);if(!x)throw new Error(`Unknown add-on id: ${E}`);if(Array.isArray(x.load_events))for(const N of x.load_events)this.load_tracker.schedule(N,`addon.${E}`);await this.loadAddon(E);const k=this.resolve(`addon.${E}`);if(k&&!k.enabled&&await k.enable(),Array.isArray(x.load_events))for(const N of x.load_events)this.load_tracker.notify(N,`addon.${E}`,!1)}async loadAddon(E){const x=this.getAddon(E);if(!x)throw new Error(`Unknown add-on id: ${E}`);await this.i18n.loadChunk(`addon.${E}`);let k=this.resolve(`addon.${E}`);if(k){k.loaded||await k.load(),this.emit(":addon-loaded",E);return}document.head.appendChild((0,n.createElement)("script",{id:`ffz-loaded-addon-${x.id}`,type:"text/javascript",src:x.src||`${x.dev?"https://localhost:8001/script":g.SERVER_OR_EXT}/addons/${x.id}/script.js?_=${(0,s.getBuster)(30)}`,crossorigin:"anonymous"})),await(0,u.timeout)(this.waitFor(`addon.${E}:registered`),6e4),k=this.resolve(`addon.${E}`),k&&!k.loaded&&await k.load(),this.emit(":addon-loaded",E)}unloadAddon(E){const x=this.resolve(`addon.${E}`);if(x)return x.unload()}enableAddon(E,x=!0){const k=this.getAddon(E);if(!k)throw new Error(`Unknown add-on id: ${E}`);if(!this.isAddonEnabled(E)){if(Array.isArray(k.requires))for(const N of k.requires){if(!this.hasAddon(N))throw new Error(`Unknown add-on id: ${N}`);this.enableAddon(N)}this.emit(":addon-enabled",E),this.enabled_addons.push(E),x&&this.settings.provider.set("addons.enabled",this.enabled_addons),this.doesAddonTarget(E)&&this._enableAddon(E).catch(N=>{this.log.error(`An error occured while enabling the add-on "${E}":`,N),this.log.capture(N)})}}async disableAddon(E,x=!0){const k=this.getAddon(E);if(!k)throw new Error(`Unknown add-on id: ${E}`);if(this.isAddonExternal(E))throw new Error(`Cannot disable external add-on with id: ${E}`);if(this.isAddonEnabled(E)){if(Array.isArray(k.required_by)){const N=[];for(const Z of k.required_by)N.push(this.disableAddon(Z));await Promise.all(N)}this.emit(":addon-disabled",E),this.enabled_addons.splice(this.enabled_addons.indexOf(E),1),x&&this.settings.provider.set("addons.enabled",this.enabled_addons);try{const N=this.resolve(`addon.${E}`);N&&await N.disable()}catch{this.reload_required=!0,this.emit(":reload-required")}}}};G(Fe,"AddonManager");let i=Fe;/*! js-cookie v3.0.5 | MIT */function l(V){for(var E=1;E<arguments.length;E++){var x=arguments[E];for(var k in x)V[k]=x[k]}return V}G(l,"js_cookie_assign");var w={read:function(V){return V[0]==='"'&&(V=V.slice(1,-1)),V.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(V){return encodeURIComponent(V).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function b(V,E){function x(N,Z,se){if(!(typeof document>"u")){se=l({},E,se),typeof se.expires=="number"&&(se.expires=new Date(Date.now()+se.expires*864e5)),se.expires&&(se.expires=se.expires.toUTCString()),N=encodeURIComponent(N).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var de="";for(var _e in se)se[_e]&&(de+="; "+_e,se[_e]!==!0&&(de+="="+se[_e].split(";")[0]));return document.cookie=N+"="+V.write(Z,N)+de}}G(x,"set");function k(N){if(!(typeof document>"u"||arguments.length&&!N)){for(var Z=document.cookie?document.cookie.split("; "):[],se={},de=0;de<Z.length;de++){var _e=Z[de].split("="),q=_e.slice(1).join("=");try{var le=decodeURIComponent(_e[0]);if(se[le]=V.read(q,le),N===le)break}catch{}}return N?se[N]:se}}return G(k,"get"),Object.create({set:x,get:k,remove:function(N,Z){x(N,"",l({},Z,{expires:-1}))},withAttributes:function(N){return b(this.converter,l({},this.attributes,N))},withConverter:function(N){return b(l({},this.converter,N),this.attributes)}},{attributes:{value:Object.freeze(E)},converter:{value:Object.freeze(V)}})}G(b,"init");var r=b(w,{path:"/"}),e=ke(99968),a=ke.n(e);const p="experiment_overrides",C={expires:7,domain:".twitch.tv"},y=ke(77074);var z=(V=>(V[V.Unknown=0]="Unknown",V[V.Device=1]="Device",V[V.User=2]="User",V[V.Channel=3]="Channel",V))(z||{});function $(V){return"t"in V}G($,"isTwitchExperiment");function o(V){return"description"in V}G(o,"isFFZExperiment");function c(V,E){return V.rarity<E.rarity?-1:V.rarity>E.rarity?1:V.name<E.name?-1:V.name>E.name?1:0}G(c,"sortExperimentLog");const De=class De extends f.default{constructor(E,x){super(E,x),this.settings=null,this.get=this.getAssignment,this.inject("settings"),this.settings.addUI("experiments",{path:"Debugging > Experiments",component:"experiments",no_filter:!0,getExtraTerms:()=>{const k=[];for(const[N,Z]of Object.entries(this.experiments))k.push(N),Z.name&&k.push(Z.name),Z.description&&k.push(Z.description);for(const[N,Z]of Object.entries(this.getTwitchExperiments()))k.push(N),Z.name&&k.push(Z.name);return k},is_locked:()=>this.getControlsLocked(),unlock:()=>this.unlockControls(),unique_id:()=>this.unique_id,ffz_data:()=>(0,u.deep_copy)(this.experiments),twitch_data:()=>(0,u.deep_copy)(this.getTwitchExperiments()),usingTwitchExperiment:k=>this.usingTwitchExperiment(k),getTwitchAssignment:k=>this.getTwitchAssignment(k),getTwitchType:k=>this.getTwitchType(k),hasTwitchOverride:k=>this.hasTwitchOverride(k),setTwitchOverride:(k,N)=>this.setTwitchOverride(k,N),deleteTwitchOverride:k=>this.deleteTwitchOverride(k),getAssignment:k=>this.getAssignment(k),hasOverride:k=>this.hasOverride(k),setOverride:(k,N)=>this.setOverride(k,N),deleteOverride:k=>this.deleteOverride(k),on:(...k)=>this.on(...k),off:(...k)=>this.off(...k)}),this.unique_id=r.get("unique_id"),this.Cookie=r,this.experiments={},this.cache=new Map}getControlsLocked(){if(g.DEBUG)return!1;const E=this.settings.provider.get("exp-lock",0);return isNaN(E)||!isFinite(E)?!0:Date.now()-E>=864e5}unlockControls(){this.settings.provider.set("exp-lock",Date.now())}async onLoad(){await this.loadExperiments()}async loadExperiments(){let E;try{E=await(0,u.fetchJSON)(g.DEBUG?y:`${g.SERVER}/script/experiments.json?_=${(0,s.getBuster)()}`)}catch(N){this.log.warn("Unable to load experiment data.",N);return}if(!E)return;this.experiments=E;const x=this.cache;this.cache=new Map;let k=0;for(const[N,Z]of x.entries()){const se=this.getAssignment(N);Z!==se&&(k++,this.emit(":changed",N,se,Z),this.emit(`:changed:${N}`,se,Z))}this.log.info(`Loaded information on ${Object.keys(E).length} experiments.${k>0?` ${k} values updated.`:""}`)}onEnable(){this.on("pubsub:command:reload_experiments",this.loadExperiments,this),this.on("pubsub:command:update_experiment",E=>{this.updateExperiment(E.key,E.data)},this)}updateExperiment(E,x){if(this.log.info(`Received updated data for experiment "${E}" via PubSub.`,x),Array.isArray(x)){const k=this.experiments[E];if(!k)return;k.groups=x}else x?.groups&&(this.experiments[E]=x);this._rebuildKey(E)}generateLog(){const E=[`Unique ID: ${this.unique_id}`,""],x=[];for(const[Z,se]of Object.entries(this.experiments)){const de=this.getAssignment(Z),_e=this.hasOverride(Z);let q=0,le=0;for(const he of se.groups)he.value===de&&(q=he.weight),le+=he.weight;!_e&&q===le||x.push({key:Z,name:se.name,value:de,override:_e,rarity:q/le})}x.sort(c);for(const Z of x)E.push(`FFZ | ${Z.name}: ${Z.value}${Z.override?" (Override)":""} (r:${Z.rarity})`);const k=[],N=this.settings.get("context.channel");for(const[Z,se]of Object.entries(this.getTwitchExperiments())){if(!this.usingTwitchExperiment(Z))continue;const de=this.getTwitchAssignment(Z),_e=this.hasTwitchOverride(Z);let q=0,le=0;for(const he of se.groups)he.value===de&&(q=he.weight),le+=he.weight;!_e&&q===le||k.push({key:Z,name:se.name,value:de,override:_e,type:this.getTwitchTypeByKey(Z),rarity:q/le})}k.sort(c);for(const Z of k)E.push(`Twitch | ${Z.name}: ${Z.value}${Z.override?" (Override)":""} (r:${Z.rarity}, t:${Z.type}${Z.type==="channel_id"?`, c:${N}`:""})`);return E.join(`
`)}getTwitchType(E){const x=this.resolve("site")?.getCore?.();return x?.experiments?.getExperimentType?x.experiments.getExperimentType(E):E===1?"device_id":E===2?"user_id":E===3?"channel_id":E}getTwitchTypeByKey(E){const x=this.getTwitchExperiments(),k=x?.[E];return k?.t?this.getTwitchType(k.t):null}getTwitchExperiments(){if(window.__twilightSettings)return window.__twilightSettings.experiments??{};const E=this.resolve("site")?.getCore?.();return E&&E.experiments.experiments||{}}usingTwitchExperiment(E){const x=this.resolve("site")?.getCore?.();return x&&(0,u.has)(x.experiments.assignments,E)}_getOverrideCookie(){const E=r.get(p);let x;try{x=E?JSON.parse(E):{}}catch{x={}}return x.experiments||(x.experiments={}),x.disabled||(x.disabled=[]),x}_saveOverrideCookie(E){E&&(!E.experiments||!Object.keys(E.experiments).length)&&(!E.disabled||!E.disabled.length)&&(E=void 0),E?r.set(p,JSON.stringify(E),C):r.remove(p,C)}_checkExternalAccess(){let E;try{E=new Error().stack}catch(k){try{E=k.stack}catch{}}if(!E)return;E=E.split(/\s*\n+\s*/g).filter(k=>k.startsWith("at "));let x=!1;for(const k of E)if(!k.includes(g.SERVER_OR_EXT)){x=!0;break}x&&this.log.warn("Detected access by external script.")}setTwitchOverride(E,x){const k=this._getOverrideCookie(),N=k.experiments,Z=k.disabled;this._checkExternalAccess(),N[E]=x;const se=Z.indexOf(E);se!=-1&&Z.splice(se,1),this._saveOverrideCookie(k);const de=this.resolve("site")?.getCore?.();de&&(de.experiments.overrides[E]=x),this._rebuildTwitchKey(E,!0,x)}deleteTwitchOverride(E){const x=this._getOverrideCookie(),k=x.experiments;if(this._checkExternalAccess(),!(0,u.has)(k,E))return;const N=k[E];delete k[E],this._saveOverrideCookie(x);const Z=this.resolve("site")?.getCore?.();Z&&delete Z.experiments.overrides[E],this._rebuildTwitchKey(E,!1,N)}hasTwitchOverride(E){const x=this._getOverrideCookie(),k=x.experiments;return(0,u.has)(k,E)}getTwitchAssignment(E,x=null){const k=this.resolve("site")?.getCore?.(),N=k&&k.experiments;if(!N)return null;if(!N.hasInitialized&&N.initialize)try{N.initialize()}catch(de){this.log.warn("Error attempting to initialize Twitch experiments tracker.",de)}if(N.overrides&&N.overrides[E])return N.overrides[E];const Z=N.experiments[E],se=this.getTwitchType(Z?.t??0);return se==="channel_id"?N.getAssignmentById(E,{bucketing:{type:1,value:x??this.settings.get("context.channelID")}}):N.assignments?.[E]?N.assignments[E]:se==="device_id"?N.selectTreatment(E,Z,this.unique_id):se==="user_id"?N.selectTreatment(E,Z,this.resolve("site")?.getUser?.()?.id):null}getTwitchKeyFromName(E){const x=this.getTwitchExperiments();if(x){E=E.toLowerCase();for(const k in x)if((0,u.has)(x,k)){const N=x[k];if(N&&N.name&&N.name.toLowerCase()===E)return k}}}getTwitchAssignmentByName(E,x=null){const k=this.getTwitchKeyFromName(E);return k?this.getTwitchAssignment(k,x):null}_rebuildTwitchKey(E,x,k){const N=this.resolve("site")?.getCore?.(),Z=N.experiments,se=(0,u.has)(Z.assignments,E)?Z.assignments[E]:null;if(se!==k){const de=x?k:se;this.emit(":twitch-changed",E,de,se),this.emit(`:twitch-changed:${E}`,de,se)}}setOverride(E,x){const k=this.settings.provider.get("experiment-overrides",{});k[E]=x,this.settings.provider.set("experiment-overrides",k),this._rebuildKey(E)}deleteOverride(E){const x=this.settings.provider.get("experiment-overrides");!x||!(0,u.has)(x,E)||(delete x[E],Object.keys(x).length?this.settings.provider.set("experiment-overrides",x):this.settings.provider.delete("experiment-overrides"),this._rebuildKey(E))}hasOverride(E){const x=this.settings.provider.get("experiment-overrides");return x?(0,u.has)(x,E):!1}getAssignment(E){if(this.cache.has(E))return this.cache.get(E);const x=this.experiments[E];if(!x)return this.log.warn(`Tried to get assignment for experiment "${E}" which is not known.`),null;const k=this.settings.provider.get("experiment-overrides"),N=k&&(0,u.has)(k,E)?k[E]:De.selectGroup(E,x,this.unique_id??"");return this.cache.set(E,N),N}_rebuildKey(E){if(!this.cache.has(E))return;const x=this.cache.get(E);this.cache.delete(E);const k=this.getAssignment(E);k!==x&&(this.emit(":changed",E,k,x),this.emit(`:changed:${E}`,k,x))}static selectGroup(E,x,k){const N=E+k+(x.seed||""),Z=x.groups.reduce((de,_e)=>de+_e.weight,0);let se=(a()(N).words[0]>>>0)/Math.pow(2,32);for(const de of x.groups)if(se-=de.weight/Z,se<=0)return de.value;return null}};G(De,"ExperimentManager");let m=De;var A=ke(67392);const h={DISCONNECTED:0,CONNECTING:1,CONNECTED:2},T="683b45e4-f853-4c45-bf96-7d799cc93e34",Ie=class Ie extends f.default{constructor(...E){super(...E),this.inject("settings"),this.inject("experiments"),this.settings.addUI("socket.info",{path:'Debugging > Socket >> Info @{"sort": -1000}',force_seen:!0,no_filter:!0,component:"socket-info",getSocket:()=>this}),this.settings.add("auth.mode",{default:"chat",ui:{path:"Data Management > Authentication >> General",title:"Authentication Provider",description:"Which method should the FrankerFaceZ client use to authenticate against the FFZ servers when necessary?",component:"setting-select-box",force_seen:!0,data:[{value:"chat",title:"Twitch Chat"},{value:!1,title:"Disabled (No Authentication)"}]},changed:()=>this._cached_token=null}),this.settings.add("socket.use-cluster",{default:"Production",ui:{path:'Debugging @{"expanded": false, "sort": 9999} > Socket >> General',title:"Server Cluster",description:"Which server cluster to connect to. Do not change this unless you are actually doing development work on the socket server backend. Doing so will break all features relying on the socket server, including emote information lookups, link tooltips, and live data updates.",component:"setting-select-box",data:[{value:null,title:"Disabled"}].concat(Object.keys(g.WS_CLUSTERS).map(x=>({value:x,title:x})))}}),this._want_connected=!1,this._topics=new Map,this._pending=[],this._awaiting=new Map,this._socket=null,this._state=0,this._last_id=1,this._delay=0,this._last_ping=null,this._time_drift=0,this._host_idx=-1,this._host_pool=-1,this.settings.on(":changed:socket.use-cluster",()=>{this._host=null,this.disconnected?this.connect():this.reconnect()}),this.on(":command:reconnect",this.reconnect,this),this.on(":command:do_authorize",x=>{const k=this.resolve("site.chat"),N=k&&k.ChatService.first,Z=N.client&&N.client.connection;Z&&Z.send&&Z.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${x}`)}),this.enable()}onEnable(){}onDisable(){this.disconnect()}get connected(){return this._state===h.CONNECTED}get connecting(){return this._state===h.CONNECTING}get disconnected(){return this._state===h.DISCONNECTED}getAPIToken(){return this.settings.get("auth.mode")==="chat"?this._getAPIToken_Chat():Promise.reject(new Error("The user has disabled authentication."))}_getAPIToken_Chat(){return this._cached_token&&this._cached_token.expires>Date.now()+15e3?Promise.resolve(this._cached_token):this._token_waiters?new Promise((E,x)=>this._token_waiters.push([E,x])):(this._token_waiters=[],new Promise((E,x)=>{this._token_waiters.push([E,x]);let k=!1,N=null;const Z=G(_e=>{if(k)return;clearTimeout(N),k=!0,this.log.error("Unable to get API token.",_e);const q=this._token_waiters;this._token_waiters=null;for(const le of q)le[1](_e)},"fail"),se=this.resolve("site")?.getUser?.();if(!se||!se.id)return Z(new Error("Unable to get current user or not logged in."));const de=new EventSource(`https://api.frankerfacez.com/auth/ext_verify/${se.id}`);(0,n.on)(de,"challenge",_e=>{const q=this.resolve("site.chat")?.ChatService?.first?.client?.connection;q&&q.send&&q.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${_e.data}`)}),(0,n.on)(de,"token",_e=>{if(k)return;clearTimeout(N);let q=null;try{q=JSON.parse(_e.data)}catch(he){Z(he);return}if(!q||!q.token){Z(new Error("Received empty token from server."));return}q.expires=new Date(q.expires).getTime(),this._cached_token=q,k=!0;const le=this._token_waiters;this._token_waiters=null;for(const he of le)he[0](q)}),(0,n.on)(de,"error",_e=>{Z(_e)}),(0,n.on)(de,"close",()=>{de.close(),k||Z(new Error("Connection closed unexpectedly."))}),N=setTimeout(()=>{Z(new Error("timeout"))},5e3)}))}async getBareAPIToken(){return(await this.getAPIToken())?.token}selectHost(){const E=this.settings.get("socket.use-cluster"),x=g.WS_CLUSTERS[E],k=x&&x.length;if(!k)return null;let N=0,Z=k;for(;Z-- >0;)N+=x[Z][1];let se=Math.random()*N;for(let de=0;de<k;de++)if(se-=x[de][1],se<=0)return x[de][0];return x[k-1][0]}_reconnect(){this._reconnect_timer||(this._delay<6e4?this._delay+=(Math.floor(Math.random()*15)+5)*1e3:this._delay=(Math.floor(Math.random()*60)+30)*1e3,this._reconnect_timer=setTimeout(()=>{this.connect()},this._delay))}reconnect(){this.disconnect(),this._reconnect()}connect(){if(this._want_connected=!0,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected)return;const E=this._host=this._host||this.selectHost();if(!E)return;this._state=h.CONNECTING,this._last_id=1,this._delay=0,this._last_ping=null,this.log.info(`Using Server: ${E}`);let x;try{x=this._socket=new WebSocket(E)}catch(k){this._state=h.DISCONNECTED,this._reconnect(),this.log.error("Unable to create WebSocket.",k);return}x.onopen=()=>{if(this._socket!==x)return this.log.warn("A socket connected that is not our primary socket."),x.close();this._state=h.CONNECTED,this._sent_user=!1,this.log.info("Connected."),this._ping_time=performance.now(),this._send("hello",[`ffz_${window.FrankerFaceZ.version_info}`,T],(Z,se)=>{if(!Z)return this.log.warn("Error Saying Hello",se);this._on_pong(!1,Z,se[1])});const k=this.resolve("site"),N=G(()=>{if(this._sent_user||!this.connected)return;const Z=k.getUser();Z&&Z.login?(this._sent_user=!0,this._send("setuser",Z.login)):k.enabled||this.once("site:enabled",N,this)},"send_user");N();for(const Z of this._topics.keys())this._send("sub",Z);for(const[Z,se,de]of this._pending)this._send(Z,se,de);this._pending=[],this._send("ready",this._offline_time||0),this._offline_time=null,this.emit(":connected")},x.onerror=()=>{x===this._socket&&(this._offline_time||(this._offline_time=Date.now()))},x.onclose=k=>{if(x!==this._socket)return;const N=this._state;this.log.info(`Disconnected. (${k.code}:${k.reason})`),this._state=h.DISCONNECTED;for(const[Z,se]of this._awaiting){const de=new Error("disconnected");try{typeof se=="function"?se(!1,de):se[1](de)}catch(_e){this.log.warn(`Callback Error #${Z}`,_e)}}this._awaiting.clear(),this._want_connected&&(this._offline_time||(this._offline_time=Date.now()),N!==h.CONNECTED&&(this._host=null),this._reconnect(),this.emit(":closed",k.code,k.reason))},x.onmessage=k=>{if(x!==this._socket)return;const N=k.data,Z=N.indexOf(" ");if(Z===-1)return this.log.warn("Malformed message from server.",k.data);const se=parseInt(N.slice(0,Z),10),de=N.indexOf(" ",Z+1),_e=N.slice(Z+1,de===-1?N.length:de),q=de===-1?void 0:JSON.parse(N.slice(de+1));if(se===-1)this.log.debug(`Received Command: ${_e}`,q),this.emit(`:command:${_e}`,q);else{const le=_e==="ok",he=this._awaiting.get(se);he?(this._awaiting.delete(se),typeof he=="function"?he(le,q):he[le?0:1](q)):(!le||g.DEBUG)&&this.log.info(`Received Reply #${se}:`,le?"OK":"Error",q)}}}disconnect(){if(this._want_connected=!1,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected){try{this._socket.close()}catch{}this._socket=null,this._state=h.DISCONNECTED,this.emit(":disconnected")}}_on_pong(E,x,k){const N=performance.now();if(!x)this._ping_time=null,E||this.log.warn("Error Pinging Server",k);else if(this._ping_time){const Z=Date.now(),se=N-this._ping_time,de=this._last_ping=se/2;this._ping_time=null;const _e=this._time_drift=Z-(k+de);E||(this.log.info("Server Time:",new Date(k).toISOString()),this.log.info(" Local Time:",new Date(Z).toISOString()),this.log.info(`  Est. Ping: ${de.toFixed(5)}ms`),this.log.info(`Time Offset: ${_e/1e3}`),Math.abs(_e)>3e5&&this.log.warn("Local time differs from server time by more than 5 minutes."))}this.emit(":pong")}ping(E){this._ping_time||!this.connected||(this._ping_time=performance.now(),this._send("ping",void 0,(x,k)=>this._on_pong(E,x,k)))}_send(E,x,k){if(!this.connected)return this.log.warn(`Tried sending command "${E}" while disconnected.`);const N=this._last_id++;k&&this._awaiting.set(N,k),this._socket.send(`${N} ${E}${x!==void 0?` ${JSON.stringify(x)}`:""}`)}send(E,...x){x.length===1?x=x[0]:x.length||(x=void 0),this.connected?this._send(E,x):this._pending.push([E,x])}call(E,...x){return x.length===1?x=x[0]:x.length||(x=void 0),new Promise((k,N)=>{this.connected?this._send(E,x,[k,N]):this._pending.push([E,x,[k,N]])})}subscribe(E,...x){const k=this._topics;let N=!1;for(const Z of x)k.has(Z)||(this.connected&&this._send("sub",Z),k.set(Z,new Set),N=!0),k.get(Z).add(E);N&&this.emit(":sub-change")}unsubscribe(E,...x){const k=this._topics;let N=!1;for(const Z of x){if(!k.has(Z))continue;const se=k.get(Z);se.delete(E),se.size||(N=!0,k.delete(Z),this.connected&&this._send("unsub",Z))}N&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}};G(Ie,"SocketClient");let R=Ie;R.State=h;var P=ke(17159),O=(V=>(V[V.Disconnected=0]="Disconnected",V[V.Connecting=1]="Connecting",V[V.Connected=2]="Connected",V))(O||{});function M(V){let E=V.length;const x=[V];for(;(E=V.lastIndexOf("/",E-1))!==-1;)x.push(`${V.slice(0,E)}/*`);return x.push("*"),x}G(M,"enumerateSubs");const Xe=class Xe extends P.EventEmitter{constructor(){super(),this._ws=null,this._topics=new Set,this._live_topics=new Set,this._want_connection=!1,this._state=0,this._reconnectTimer=null,this._failedConnections=0,this._performReconnect=this._performReconnect.bind(this)}_reconnect(E=!0){if(this._reconnectTimer)return;let x=250+(E?Math.floor(this._failedConnections*(Math.random()*5e3)+5e3):0);this._reconnectTimer=setTimeout(this._performReconnect,x)}_performReconnect(){if(this._reconnectTimer=null,this._ws&&(this._ws.close(),this._ws=null,this._state=0),this._live_topics=new Set(this._topics),!this._live_topics.size)return;this._state=1;const E=new URL("wss://pubsub.workers.frankerfacez.com/ws");if(this._live_topics.size>10)E.searchParams.append("t","*");else for(const k of this._live_topics)E.searchParams.append("t",k);const x=this._ws=new WebSocket(E.toString());x.addEventListener("open",k=>{this._state=2,this._failedConnections=0,this.emit("connect",k)}),x.addEventListener("error",k=>{this.emit("error",k)}),x.addEventListener("close",k=>{this._ws=null,this._state=0,this.emit("disconnect",k),this._want_connection&&this._reconnect()}),x.addEventListener("message",k=>{if(typeof k.data=="string"){let N;try{N=JSON.parse(k.data)}catch{return}if(!N.topic||typeof N.topic!="string")return;if(this._live_topics.size>10&&!this._live_topics.has(N.topic)){let Z=!1;for(const se of M(N.topic))if(this._live_topics.has(se)){Z=!0;break}if(!Z)return}this.emit("message",N)}})}get connected(){return this._state===2}get connecting(){return this._state===1}get disconnected(){return this._state===0}connect(){this._want_connection=!0,this._reconnect(!1)}disconnect(){this._want_connection=!1,this._failedConnections=0,this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._ws&&(this._ws.close(),this._ws=null,this._state=0,this.emit("disconnect",null))}subscribe(E){Array.isArray(E)||(E=[E]);for(const x of E)this._topics.add(x);this._want_connection&&!(0,u.set_equals)(this._topics,this._live_topics)&&this._reconnect()}unsubscribe(E){Array.isArray(E)||(E=[E]);for(const x of E)this._topics.delete(x);this._want_connection&&!(0,u.set_equals)(this._topics,this._live_topics)&&this._reconnect()}};G(Xe,"PubSubClient");let j=Xe;const ct=class ct extends f.default{constructor(E,x){super(E,x),this.experiments=null,this.settings=null,this.inject("settings"),this.inject("experiments"),this.settings.add("pubsub.enabled",{default:()=>this.experiments.getAssignment("worker_pubsub")??!1,ui:{path:'Debugging @{"expanded": false, "sort": 9999} > PubSub >> General',title:"Enable PubSub.",description:"Whether or not you want your client to connect to FrankerFaceZ's PubSub system. This is still in testing and should be left alone unless you know what you're doing.",force_seen:!0,component:"setting-check-box"},changed:k=>k?this.connect():this.disconnect()}),this._topics=new Map,this._client=null}onEnable(){this.subscribe(null,"global"),this.connect(),this.on("experiments:changed:worker_pubsub",this._updateSetting,this)}onDisable(){this.off("experiments:changed:worker_pubsub",this._updateSetting,this),this.disconnect(),this.unsubscribe(null,"global")}_updateSetting(){this.settings.update("pubsub.enabled")}get connected(){return this._client!=null}reconnect(){this.disconnect(),this.connect()}async connect(){if(this._client||!this.settings.get("pubsub.enabled"))return;const E=this._client=new j;E.on("connect",()=>{this.log.info("Connected to PubSub.")}),E.on("disconnect",()=>{this.log.info("Disconnected from PubSub.")}),E.on("error",k=>{this.log.error("Error in PubSub",k)}),E.on("message",k=>{const N=k.topic,Z=k.data;if(!Z?.cmd){this.log.debug(`Received message on topic "${N}":`,Z),this.emit(":message",N,Z);return}Z.topic=N,this.log.debug(`Received command on topic "${N}" for command "${Z.cmd}":`,Z.data),this.emit(`:command:${Z.cmd}`,Z.data,Z)});const x=[...this._topics.keys()];E.subscribe(x),await E.connect()}disconnect(){this._client&&(this._client.disconnect(),this._client=null)}subscribe(E,...x){const k=this._topics;let N=!1;for(const Z of x){let se=k.get(Z);se?se.add(E):(this._client&&this._client.subscribe(Z),se=new Set,se.add(E),k.set(Z,se),N=!0)}N&&this.emit(":sub-change")}unsubscribe(E,...x){const k=this._topics;let N=!1;for(const Z of x){const se=k.get(Z);se&&(se.delete(E),se.size||(N=!0,k.delete(Z),this._client&&this._client.unsubscribe(Z)))}N&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}};G(ct,"PubSub");let Y=ct;var ee=ke(43874);const Oe=class Oe extends f.default{constructor(E,x){super(E,x),this.Vue=null,this.i18n=null,this.key="ffz-stuff",this._components={},this.inject("i18n")}async onLoad(){const E=window.ffzVue=this.Vue=(await Promise.all([ke.e(4047),ke.e(7485)]).then(ke.bind(ke,35702))).default,x=this._components,[k,N,Z]=await Promise.all([Promise.all([ke.e(4047),ke.e(7485)]).then(ke.bind(ke,6108)),Promise.all([ke.e(4047),ke.e(7485)]).then(ke.t.bind(ke,59010,19)),Promise.all([ke.e(4047),ke.e(7485)]).then(ke.bind(ke,8222))]);this.component(Z.default),E.use(k),E.mixin(N.mixin);for(const se in x)(0,u.has)(x,se)&&E.component(se,x[se]);this._components=null,E.use(this)}component(E,x){if(typeof E=="function")for(const k of E.keys())this.component(k.slice(2,k.length-4),E(k).default);else if(typeof E=="object")for(const k in E)(0,u.has)(E,k)&&this.component(k,E[k]);else this.Vue?this.Vue.component(E,x):this._components&&(this._components[E]=x)}install(E){const x=this;this._vue_i18n||(this._vue_i18n=new E({data(){return{locale:x.i18n.locale,phrases:{}}},methods:{tNumber_(k,N){return this.locale,x.i18n.formatNumber(k,N)},tDate_(k,N){return this.locale,x.i18n.formatDate(k,N)},tTime_(k,N){return this.locale,x.i18n.formatTime(k,N)},tDateTime_(k,N){return this.locale,x.i18n.formatDateTime(k,N)},t_(k,N,Z){return this.locale&&this.phrases[k],x.i18n.t(k,N,Z)},tList_(k,N,Z){return this.locale&&this.phrases[k],x.i18n.tList(k,N,Z)},tNode_(k,N){return this.locale,x.i18n.formatNode(k,N)},setLocale(k){x.i18n.locale=k}}}),this.on("i18n:transform",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:changed",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:loaded",k=>{const N=this._vue_i18n,Z=N.phrases;for(const se of k)N.$set(Z,se,(Z[se]||0)+1)}),E.prototype.$i18n=this._vue_i18n),E.component("t-list",{props:{tag:{required:!1},phrase:{type:String,required:!0},default:{type:String,required:!0},data:{type:Object,required:!1}},render(k){return k(this.tag||"span",this.$i18n.tList_(this.phrase,this.default,Object.assign({},this.data,this.$scopedSlots)).map(N=>typeof N=="function"?N():N))}}),E.mixin({methods:{reactNavigate(k,N,Z){const se=x.resolve("site.router");se&&(N&&(N.preventDefault(),N.stopPropagation()),se.push(k,Z??void 0))},getReactURL(k,N,Z,...se){return x.resolve("site.router").getURL(k,N,Z,...se)},getI18n(){return x.i18n},t(k,N,Z){return this.$i18n.t_(k,N,Z)},tList(k,N,Z){return this.$i18n.tList_(k,N,Z)},tNode(k,N){return this.$i18n.tNode_(k,N)},tNumber(k,N){return this.$i18n.tNumber_(k,N)},tDate(k,N){return this.$i18n.tDate_(k,N)},tTime(k,N){return this.$i18n.tTime_(k,N)},tDateTime(k,N){return this.$i18n.tDateTime_(k,N)}}})}};G(Oe,"VueModule");let X=Oe;const Q=X,_=class _ extends f.default{constructor(E,x){super(E,x),this.settings=null,this.api=g.API_SERVER,this.cdn=g.SERVER,this.active=!1,this.inject("settings"),this.settings.add("data.use-staging",{default:!1,ui:{path:'Debugging > Data Sources >> Staging @{"sort": -1}',force_seen:!0,title:"Use staging as data source.",component:"setting-check-box"}}),this.updateStaging(!1)}onEnable(){this.settings.getChanges("data.use-staging",this.updateStaging,this)}updateStaging(E){this.active=E,this.api=E?g.STAGING_API:g.API_SERVER,this.cdn=E?g.STAGING_CDN:g.SERVER,this.emit(":updated",this.api,this.cdn)}};G(_,"StagingSelector");let te=_;const F=class F extends f.default{constructor(E,x){super(E,x),this.pending_loads=new Map,this.settings=null,this.should_enable=!0,this.inject("settings"),this.settings.add("chat.update-when-loaded",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Update existing chat messages when loading new data.",component:"setting-check-box",description:"This may cause elements in chat to move, so you may wish to disable this when performing moderation."}})}onEnable(){this.on(":schedule",this.schedule)}schedule(E,x){let k=this.pending_loads.get(E);(!k||!k.pending||!k.timers)&&(k={pending:new Set,timers:{},success:!1},this.pending_loads.set(E,k)),!k.pending.has(x)&&(k.pending.add(x),k.timers[x]=setTimeout(()=>this.notify(E,x,!1),15e3))}notify(E,x,k=!0){const N=this.pending_loads.get(E);if(!(!N||!N.pending||!N.timers)&&(N.timers[x]&&(clearTimeout(N.timers[x]),N.timers[x]=null),!!N.pending.has(x)&&(N.pending.delete(x),k&&(N.success=!0),!N.pending.size))){const Z=Object.keys(N.timers);this.log.debug("complete",E,Z),N.success&&this.emit(`:complete:${E}`,Z),this.pending_loads.delete(E)}}};G(F,"LoadTracker");let ne=F;const K=class K extends f.default{constructor(E,x){super(E,x,!0),this.i18n=null,this.settings=null,this.inject("i18n"),this.inject("settings")}populate(E,x){return this.log.warn("[DEV-CHECK] populate() has been renamed to loadFromContext(). The populate() name is deprecated."),this.loadFromContext(E,x)}static register(E,x,k){if(typeof E=="object"&&(x=E,E=x.id||void 0),!E)if(this.name)E=this.name.toSnakeCase();else throw new Error("Unable to register module without ID.");!x&&this.info&&(x=this.info),k&&(this.version=k);const N=window.FrankerFaceZ.get(),Z=N?.addons;Z&&(x?(x.id=E,Z.addAddon(x)):Z.hasAddon(E)||Z.addAddon({id:E}),k&&Z.setVersion(E,k));try{N.register(`addon.${E}`,this)}catch(se){if(se instanceof Error&&se.message&&se.message.includes("Name Collision for Module")){const de=N.resolve(`addon.${E}`);de&&(de.external=!0)}throw se}}};G(K,"Addon");let fe=K;var re=ke(38626),ue=ke(14873),me=ke(94417),we=ke(61892),xe=ke(5286),Te=ke(8528),Pe=ke(2356),Se=ke(37087);const oe=(H=class extends f.default{constructor(){super();const E=performance.now();H.instance=this,this.host="twitch",this.flavor="main",this.name="frankerfacez",this.__state=f.State.Disabled,this.__modules.core=this,this._time("instance"),this.log=new v(null,null,null),this.log.init=!0,this.core_log=this.log.get("core"),this.log.hi(this,H.version_info),this.inject("settings",S.ZP),this.inject("experiments",m),this.inject("i18n",A.ZP),this.inject("staging",te),this.inject("load_tracker",ne),this.inject("socket",R),this.inject("pubsub",Y),this.inject("site",ee.Z),this.inject("addons",i),this.register("vue",Q),this.discoverModules().then(()=>this.enable()).then(()=>this.enableInitialModules()).then(()=>{const x=performance.now()-E;this.core_log.info(`Initialization complete in ${x.toFixed(5)}ms.`),this.log.init=!1}).catch(x=>{this.core_log.error("An error occurred during initialization.",x),this.log.init=!1})}static get(){return H.instance}async generateLog(){const E=[];for(const[k,N]of Object.entries(this.__modules))N instanceof f.default&&N.generateLog&&N!=this&&E.push((async()=>{try{return[k,await(0,u.timeout)(Promise.resolve(N.generateLog()),5e3)]}catch(Z){return[k,`Error: ${Z}`]}})());const x=await Promise.all(E);if(this.log.captured_init&&this.log.captured_init.length>0){const k=[];for(const N of this.log.captured_init){const Z=W()(N.time).locale("en").format("H:mm:ss");k.push(`[${Z}] ${N.level} | ${N.category||"core"}: ${N.message}`)}x.unshift(["initialization",k.join(`
`)])}return x.map(k=>`${k[0]}
-------------------------------------------------------------------------------
${typeof k[1]=="string"?k[1]:JSON.stringify(k[1],null,4)}`).join(`

`)}async discoverModules(){const E=await ke(10952),x=this.loadFromContext(E,this.core_log);this.core_log.info(`Loaded descriptions of ${Object.keys(x).length} modules.`)}async enableInitialModules(){const E=[];for(const x of Object.values(this.__modules))x instanceof f.default&&x.should_enable&&E.push(x.enable());return Promise.all(E)}},G(H,"_FrankerFaceZ2"),H);oe.instance=null,oe.version_info=null,oe.Logger=v,oe.utilities={addon:J,blobs:re,color:ue,constants:g,dialog:me,dom:n,events:P,fontAwesome:we,graphql:xe,logging:ae,module:f,object:u,time:s,tooltip:Te,i18n:Pe,filtering:Se};let ie=oe;const pe=ie.version_info=Object.freeze({major:4,minor:77,revision:4,extra:It?.length&&It[0],commit:"b250075813ef4902b5a303fc7290d6429703feef",build:"0",hash:ke.h(),toString:()=>`${pe.major}.${pe.minor}.${pe.revision}${pe.build?`.${pe.build}`:""}${pe.extra||""}${g.DEBUG?"-dev":""}`}),ge=null;window.FrankerFaceZ=ie,window.ffz=new ie})()})();})();

//# sourceMappingURL=avalon.js.map