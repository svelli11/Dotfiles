(()=>{var d=Object.defineProperty;var h=(o,r)=>d(o,"name",{value:r,configurable:!0});(()=>{var o={},r=Object.defineProperty,l=h((i,t,e)=>t in i?r(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,"__defNormalProp"),_=h((i,t,e)=>(l(i,typeof t!="symbol"?t+"":t,e),e),"__publicField");const n=class n extends FrankerFaceZ.utilities.addon.Addon{constructor(...t){super(...t),_(this,"known_users",new Map),this.inject("chat"),this.inject("site"),this.settings.add("first_message_highlight.enabled",{default:!0,ui:{path:'Add-Ons > First Message Highlight >> Current Session >> Settings @{"sort": -1}',title:"Highlight first messages",description:"Highlight first messages from users for this session.",component:"setting-check-box",sort:-1}}),this.settings.add("first_message_highlight.only_moderated_channels",{default:!1,ui:{path:"Add-Ons > First Message Highlight >> Current Session >> Settings",title:"Highlight only when moderating",description:"Only highlight messages in chats where you are a moderator.",component:"setting-check-box",sort:-1}}),this.settings.add("first_message_highlight.forget_user_after",{default:0,ui:{path:"Add-Ons > First Message Highlight >> Current Session >> Settings",title:"Forget User After",description:"Forget a user after a specified amount of time so they can be highlighted again.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1e3*60*5,title:"5 Minutes"},{value:1e3*60*15,title:"15 Minutes"},{value:1e3*60*30,title:"30 Minutes"},{value:1e3*60*60,title:"60 Minutes"},{value:1e3*60*60*2,title:"2 Hours"},{value:1e3*60*60*3,title:"3 Hours"}]}}),this.settings.add("first_message_highlight.highlight_color",{default:"#3C1A1A",ui:{path:"Add-Ons > First Message Highlight >> Current Session >> Highlights",title:"Highlight Color",description:"Highlight color to add to the message",component:"setting-color-box"}}),this.settings.add("first_message_highlight.priority",{default:0,ui:{path:"Add-Ons > First Message Highlight >> Current Session >> Highlights",title:"Highlight Priority",description:"Priority of the highlight",component:"setting-text-box",type:"number",process:"to_int"}}),this.settings.add("first_message_highlight.highlight_historical",{default:!0,ui:{path:"Add-Ons > First Message Highlight >> Current Session >> Historical Messages",title:"Highlight logged historical messages",description:"Highlight messages from before you joined the chat.",component:"setting-check-box"}}),this.settings.add("first_message_highlight.first_time_chatter",{default:!1,ui:{path:'Add-Ons > First Message Highlight >> First Time Chatter @{"sort": 10}',title:"Highlight first time chatters",description:"Highlight messages from first time chatters.",component:"setting-check-box",sort:-1}}),this.settings.add("first_message_highlight.first_time_chatter_only_moderated_channels",{default:!1,ui:{path:"Add-Ons > First Message Highlight >> First Time Chatter",title:"Highlight only when moderating",description:"Only highlight messages in chats where you are a moderator.",component:"setting-check-box",sort:-1}}),this.settings.add("first_message_highlight.first_time_chatter_color",{default:"#C832C866",ui:{path:"Add-Ons > First Message Highlight >> First Time Chatter",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("first_message_highlight.first_time_chatter_priority",{default:0,ui:{path:"Add-Ons > First Message Highlight >> First Time Chatter",title:"Highlight Priority",description:"Priority of the highlight",component:"setting-text-box",type:"number",process:"to_int"}}),this.settings.add("first_message_highlight.returning_chatter",{default:!1,ui:{path:'Add-Ons > First Message Highlight >> Returning Chatter @{"sort": 11}',title:"Highlight returning chatters",description:"Highlight messages from returning chatters.",component:"setting-check-box",sort:-1}}),this.settings.add("first_message_highlight.returning_chatter_only_moderated_channels",{default:!1,ui:{path:"Add-Ons > First Message Highlight >> Returning Chatter",title:"Highlight only when moderating",description:"Only highlight messages in chats where you are a moderator.",component:"setting-check-box",sort:-1}}),this.settings.add("first_message_highlight.returning_chatter_color",{default:"#3296E666",ui:{path:"Add-Ons > First Message Highlight >> Returning Chatter",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("first_message_highlight.returning_chatter_priority",{default:0,ui:{path:"Add-Ons > First Message Highlight >> Returning Chatter",title:"Highlight Priority",description:"Priority of the highlight",component:"setting-text-box",type:"number",process:"to_int"}}),this.settings.addUI("first_message_highlight.pad-bottom",{path:"Add-Ons > First Message Highlight >> Returning Chatter",sort:1e3,component:"setting-spacer",top:"25rem",force_seen:!0}),this.chat.addHighlightReason("first-message","First message from a user during this session"),this.chat.addHighlightReason("first-time-chatter","First messages from a user new to the channel"),this.chat.addHighlightReason("returning-chatter","First messages from a user returning to the channel");const e=this;this.messageHighlighter={type:"message_highlighter",priority:0,process(s,a){e.highlightFirstTimeChatter(this,a),e.highlightReturningChatter(this,a),e.highlightMessage(this,a)}}}onEnable(){this.on("settings:changed:first_message_highlight.forget_user_after",this.clearChatLines,this),this.chat.addTokenizer(this.messageHighlighter),this.emit("chat:update-lines")}onDisable(){this.chat.removeTokenizer(this.messageHighlighter),this.known_users.clear(),this.emit("chat:update-lines")}clearChatLines(){for(const{message:t}of this.chat.iterateMessages())t.first_highlight=null;this.known_users.clear(),this.emit("chat:update-lines")}shouldHighlight(t){if(t.first_highlight!=null)return t.first_highlight;if(!t.user?.userID||t.user.userID==this.site.getUser()?.id)return!1;const e=this.known_users.get(t.user.userID)??0;if(e<t.timestamp){this.known_users.set(t.user.userID,t.timestamp);const s=this.settings.get("first_message_highlight.forget_user_after");if(e===0||s!==0&&t.timestamp-e>=s)return t.first_highlight=!0,!0}return t.first_highlight=!1,!1}highlightMessage(t,e){if(!this.settings.get("first_message_highlight.enabled")||this.settings.get("first_message_highlight.only_moderated_channels")&&!this.chat.context.get("context.moderator"))return;const s=this.shouldHighlight(e);if(e.isHistorical&&!this.settings.get("first_message_highlight.highlight_historical")){this.known_users.delete(e.user.userID);return}s&&t.applyHighlight(e,this.settings.get("first_message_highlight.priority"),this.settings.get("first_message_highlight.highlight_color"),"first-message")}highlightFirstTimeChatter(t,e){this.chat.context.get("first_message_highlight.first_time_chatter")&&(this.settings.get("first_message_highlight.first_time_chatter_only_moderated_channels")&&!this.chat.context.get("context.moderator")||e.ffz_first_msg&&t.applyHighlight(e,this.settings.get("first_message_highlight.first_time_chatter_priority"),this.settings.get("first_message_highlight.first_time_chatter_color"),"first-time-chatter"))}highlightReturningChatter(t,e){this.chat.context.get("first_message_highlight.returning_chatter")&&(this.settings.get("first_message_highlight.returning_chatter_only_moderated_channels")&&!this.chat.context.get("context.moderator")||e.ffz_returning&&t.applyHighlight(e,this.settings.get("first_message_highlight.returning_chatter_priority"),this.settings.get("first_message_highlight.returning_chatter_color"),"returning-chatter"))}};h(n,"FirstMessageHighlight");let g=n;g.register("first-message-highlighter",null,"1.1.3")})();})();

//# sourceMappingURL=script.js.map