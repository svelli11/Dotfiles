(()=>{var O=Object.defineProperty;var h=(o,u)=>O(o,"name",{value:u,configurable:!0});(()=>{"use strict";var o={};o.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),(()=>{var r;o.g.importScripts&&(r=o.g.location+"");var l=o.g.document;if(!r&&l&&(l.currentScript&&(r=l.currentScript.src),!r)){var s=l.getElementsByTagName("script");if(s.length)for(var i=s.length-1;i>-1&&!r;)r=s[i--].src}if(!r)throw new Error("Automatic publicPath is not supported in this browser");r=r.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=r+"../"})();var u={};const f=o.p+"ragnarok-database/styles.css",v=FrankerFaceZ.utilities.dom.createElement,R=FrankerFaceZ.utilities.dom.sanitize,d=class d extends FrankerFaceZ.utilities.addon.Addon{constructor(...l){super(...l),this.inject("chat"),this.settings.add("addon.rodb.server",{default:"iRO",ui:{path:"Add-Ons > Ragnarok Database >> Server",title:"Default Server",description:"Choose your default server where data should be displayed from. If the item doesn't exit on your server it will try iRO next and finally kRO.",component:"setting-select-box",multiple:!1,data:[{value:"aRO",title:"aRO"},{value:"bRO",title:"bRO"},{value:"fRO",title:"fRO"},{value:"idRO",title:"idRO"},{value:"iRO",title:"iRO"},{value:"jRO",title:"jRO"},{value:"kROM",title:"kROM"},{value:"kROZ",title:"kROZ"},{value:"kROZS",title:"kROZS"},{value:"GGH",title:"GGH"},{value:"ropEU",title:"ropEU"},{value:"ropRU",title:"ropRU"},{value:"thROG",title:"thROG"},{value:"twRO",title:"twRO"},{value:"cRO",title:"cRO"},{value:"iROC",title:"iROC"}]},changed:i=>{this.server=i,this.emit("chat:update-lines")}});var s=this;this.messageFilter={type:"rodb",priority:9,render(i,t){return t("div",{class:"dp-tooltip dp-tooltip-item"},t("div",{class:"dp-tooltip-head"},t("h3",null,t("a",{href:i.url,target:"_newFrame"},i.roname," (",i.roserver,")"))),t("div",{class:"dp-tooltip-body"},t("span",{class:"dp-icon dp-icon-item dp-icon-item-large dp-icon-item-white"},t("span",{class:"icon-item-inner icon-item-default",style:{backgroundImage:"url(https://static.divine-pride.net/images/items/collection/"+i.roid+".png)"}})),t("div",{class:"dp-item-properties"},t("ul",null,t("li",null,t("font",{color:"#000000",dangerouslySetInnerHTML:{__html:i.description}}))),t("span",{class:"clear"}))),t("div",{class:"dp-tooltip-foot"}))},process(i,t){var a=/.*divine-pride.net\/database\/([a-z]+)\/([0-9]+).*/;for(const e of i)if(e.type=="link"&&a.test(e.text)){var n=a.exec(e.text);s.fetchXHR(n[1],n[2],s.server,e,t)}return i}},this.rodbCSS=null,this.server=this.settings.get("addon.rodb.server")}onEnable(){this.rodbCSS==null&&(this.rodbCSS=document.head.appendChild(v("link",{href:f,id:"rodb-css",rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}))),this.log.info("Enabling support for divine-pride links."),this.chat.addTokenizer(this.messageFilter),this.emit("chat:update-lines")}onDisable(){this.rodbCSS!=null&&(document.getElementById("rodb-css").remove(),this.rodbCSS=null),this.chat.removeTokenizer(this.messageFilter),this.emit("chat:update-lines")}async fetchXHR(l,s,i,t,a){var n=new XMLHttpRequest;n.open("GET","https://www.divine-pride.net/api/database/"+l+"/"+s+"?apiKey=92f0c44ff2bded0973a905cfc928cd66&server="+i,!0),n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){const p=n.status;if(p===0||p>=200&&p<400){var e=JSON.parse(n.responseText);if(e.status!=null)return;e.description=e.description.replaceAll(/<a href.*?>/g,""),e.description=e.description.replaceAll("</a>",""),e.description=R(e.description),e.description=e.description.replaceAll(/(?:\r\n|\r|\n)/g,"<br>"),e.description=e.description.replaceAll("^000000","</font>"),e.description=e.description.replaceAll(/\^([0-9a-fA-F]{6})/g,'<font color="#$1">'),t.type="rodb",t.roname=e.name,t.description=e.description,t.roid=s,t.roserver=i,this.emit("chat:update-line",a.id,!1)}else{if(i=="kRO")return;if(i=="iRO"){this.fetchXHR(l,s,"kRO",t,a);return}this.fetchXHR(l,s,"iRO",t,a)}}},n.send()}};h(d,"RagnarokDatabase");let c=d;c.register("ragnarok-database",null,"1.0.1")})();})();

//# sourceMappingURL=script.js.map