(()=>{var S=Object.defineProperty;var _=(k,i)=>S(k,"name",{value:i,configurable:!0});(()=>{var k={};const{createElement:i}=FrankerFaceZ.utilities.dom,g=class g extends FrankerFaceZ.utilities.addon.Addon{constructor(...t){super(...t),this.notify_icon=document.querySelector('link[rel="icon"]')?.href,this.pinned_handler=void 0,this.inject("settings"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.badges"),this.inject("site"),this.injectAs("site_chat","site.chat"),this.inject("site.fine"),this.inject("site.router"),this.user=this.site.getUser(),this.onKeyDown=this.onKeyDown.bind(this),this.ModCardData={user:void 0,message_id:void 0},this.firstLoad=0,this.site.router.on(":route",(e,s)=>{s&&s[0]=="/directory/following"&&this.firstLoad===0&&(this.liveFollowing(),this.firstLoad=1)}),this.settings.add("smokemotes.pinned_mentions",{default:!0,ui:{sort:-1,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Pinned Mentions",description:"Enable to have mentions pinned to the top of chat.",component:"setting-check-box"}}),this.settings.add("smokemotes.pinned_reasons",{default:["mention"],type:"basic_array_merge",ui:{path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Pin Reasons",description:"Pin messages when a chat line is highlighted for one of the selected reasons.",component:"setting-select-box",multiple:!0,data:()=>this.chat.getHighlightReasons()}}),this.settings.add("smokemotes.pinned_messages_remove",{default:!0,ui:{sort:0,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Remove Oldest Pinned Mention If At Max Number",description:"Enable to remove the oldest pinned mention and add the latest mention, otherwise it will stop pinning messages if you have the maximum amount until there is more room.",component:"setting-check-box"}}),this.settings.add("smokemotes.pinned_messages_max",{default:6,ui:{sort:1,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Maximum Pinned Messages",description:"Maximum amount of pinned messages allowed to be in the pinned mentions section.",component:"setting-text-box",process(e){return e=parseFloat(e,10),isNaN(e)||!isFinite(e)||e<0?6:e}}}),this.settings.add("smokemotes.pinned_timer",{default:60,ui:{sort:2,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Auto Removal Timer",description:"Time in seconds to auto remove pinned messages. 0 To Disable.",component:"setting-text-box",process(e){return e=parseFloat(e,10),isNaN(e)||!isFinite(e)||e<0?60:e}}}),this.settings.add("smokemotes.pinned_border",{default:"#828282",ui:{sort:3,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Border Color",description:"Color to use for the border of pinned mentions.",component:"setting-color-box",alpha:!1,openUp:!0}}),this.settings.add("smokemotes.pinned_font_color",{default:"#dadada",ui:{sort:4,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Font Color",description:"Color to use for the font of pinned mentions.",component:"setting-color-box",alpha:!1,openUp:!0}}),this.settings.add("smokemotes.pinned_bg",{default:"#3e0b0b",ui:{sort:5,path:"Add-Ons > Smokey's Utilities >> Pinned Mentions",title:"Background Color",description:"Color to use for the background of pinned mentions.",component:"setting-color-box",alpha:!1,openUp:!0}}),this.settings.add("smokemotes.keep_hd_video",{default:!0,ui:{sort:-1,path:"Add-Ons > Smokey's Utilities >> Channel",title:"Maintain HD Quality",description:"Enable to keep the video player from automatically decreasing video quality when out of focus.",component:"setting-check-box"}}),this.settings.add("smokemotes.auto_live_follow_page",{default:!1,ui:{sort:0,path:"Add-Ons > Smokey's Utilities >> Following",title:"Auto go to Live channels on your Following Directory",description:"Enable to automatically go to the Live channel section on a fresh load of the following directory.",component:"setting-check-box"}}),this.settings.add("smokemotes.mod_keybinds",{default:!1,requires:["context.moderator"],process(e,s){return e.get("context.moderator")?s:!1},ui:{sort:1,path:"Add-Ons > Smokey's Utilities >> Mod Keybinds",title:"Toggle Mod Keybinds",description:"Enable to be able to use T/B/P/D for Timeout/Ban/Purge/Delete.",component:"setting-check-box"}}),this.settings.add("smokemotes.auto_exit_viewercard",{default:!0,ui:{sort:2,path:"Add-Ons > Smokey's Utilities >> Mod Keybinds",title:"Auto Close Viewer Card After Keybind Action",component:"setting-check-box"}}),this.chat.context.on("changed:smokemotes.keep_hd_video",this.keep_hd_video,this),this.chat.context.on("changed:smokemotes.mod_keybinds",this.mod_keybind_handler,this),this.ViewerCard=this.fine.define("chat-viewer-card",e=>e.trackViewerCardOpen&&e.onWhisperButtonClick),this.style_link=null,this.event_listener=!1,this.updateEventListener(),this.settings.on(":changed:smokemotes.pinned_mentions",this.updateEventListener,this)}onEnable(){document.readyState!="complete"?window.addEventListener("load",()=>{this.keep_hd_video()}):this.keep_hd_video(),this.mod_keybind_handler(),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this),this.log.debug("Smokey's Utilities module was enabled successfully.")}updateEventListener(){const t=this.settings.get("smokemotes.pinned_mentions");t&&!this.event_listener?this.on("chat:buffer-message",this.handlePin,this):!t&&this.event_listener&&this.off("chat:buffer-message",this.handlePin,this),this.event_listener=t}handlePin(t){const e=t.message;if(e.smokey_pinned||(e.smokey_pinned=!0,e.deleted||e.ffz_removed||!e.mentioned||e.isHistorical||!this.settings.get("smokemotes.pinned_mentions")))return;const s=e.highlights;if(!s?.size)return;const C=this.settings.get("smokemotes.pinned_reasons");let y=!1;for(const d of C)if(s.has(d)){y=!0;break}if(!y)return;let n=document.querySelector("#smokey_pinned_log");if(!n){const d=this.site_chat.ChatContainer.first,m=d?.state?.chatListElement;n=i("div",{id:"smokey_pinned_log",class:"pinned-highlight-log tw-absolute tw-top-0 tw-z-above tw-full-width tw-c-background-base",style:"z-order:99 !important;"}),m.parentNode.prepend(n)}if(n.style.color=this.settings.get("smokemotes.pinned_font_color"),n.childNodes.length>=this.settings.get("smokemotes.pinned_messages_max"))if(this.settings.get("smokemotes.pinned_messages_remove"))n.childNodes[0].remove();else return;let o=e.mention_color;o&&(o=this.site_chat.inverse_colors.process(o)),o||(o=this.site_chat.inverse_colors.process(this.settings.get("smokemotes.pinned_bg")));let r=e.user.color;r&&(r=this.site_chat.colors.process(r));const x=this.site_chat.message_types||{},b=e.messageType===x.Action,f=b?this.chat.context.get("chat.me-style"):0,M=f>=2,L=f===1||f===3;requestAnimationFrame(()=>{const d=Date.now()+Math.floor(Math.random()*101),m=e.ffz_tokens||null,D=this.settings.get("smokemotes.pinned_border");let h,u;const v=_(()=>{u&&clearTimeout(u),h&&h.remove(),h=u=null},"close_fn");let l=e.roomLogin?e.roomLogin:e.channel?e.channel.slice(1):void 0,c=e.roomId;if(!l&&c){const a=this.chat.getRoom(c,null,!0);a&&a.login&&(l=e.roomLogin=a.login)}if(!c&&l){const a=this.chat.getRoom(null,l,!0);a&&a.id&&(c=e.roomId=a.id)}h=i("div",{id:d,class:`chat-line__message${o?" ffz-custom-color":""}`,style:`border: 1px solid ${D} !important; border-top: none !important;${o?`background-color:${o};`:""}`,"data-room":l,"data-room-id":c,"data-user":e.user.login,"data-user-id":e.user.id},i("div",{style:"width: 14px; cursor: pointer; top: 5px; right: 5px; position: absolute",onclick:v},i("figure",{class:"ffz-i-cancel"})),i("span",{class:"chat-line__timestamp"},this.chat.formatTime(e.timestamp)),i("span",{class:"chat-line__message--badges"},this.chat.badges.render(e,i)),i("span",{class:"chat-line__username notranslate",role:"button"},i("span",{class:"chat-author__display-name"},i("a",{rel:"noopener noreferrer",target:"_blank",href:`https://twitch.tv/${e.user.login}`,style:{color:r}},e.user.displayName||e.user.login))),b?" ":": ",i("span",{class:`message ${M?"chat-line__message-body--italicized":""}`,style:{color:L?r:null}},m?this.chat.renderTokens(m):e.message)),n.appendChild(h),document.hidden&&(document.querySelector('link[rel="icon"]').href=this.notify_icon);const w=this.settings.get("smokemotes.pinned_timer");w>0&&(u=setTimeout(v,w*1e3))})}keep_hd_video(){if(this.chat.context.get("smokemotes.keep_hd_video"))try{document.addEventListener("visibilitychange",t=>{t.stopImmediatePropagation()},!0,!0)}catch(t){this.log.warn("Unable to install always HD document visibility hook.",t)}}liveFollowing(){if(this.chat.context.get("smokemotes.auto_live_follow_page"))try{document.querySelector('a[data-a-target="following-live-tab"]').click()}catch(t){this.log.warn("Failed going to Live tab from Overview.",t)}}onNotifyWindowFocus(){document.hidden||(document.querySelector('link[rel="icon"]').href=this.notify_icon_original)}checkExitViewerCard(t){t&&this.settings.get("smokemotes.auto_exit_viewercard")&&t.click()}onKeyDown(t){if(document.activeElement==document.querySelector('div[data-a-target="chat-input"]')||t.ctrlKey||t.metaKey||t.shiftKey||!this.ModCardData.user)return;const e=document.querySelector('button[data-test-selector="close-viewer-card-button"]');switch(t.keyCode||t.which){case 84:this.resolve("site.chat").ChatService.first.sendMessage(`/timeout ${this.ModCardData.user} 600`),this.updateLogin(),this.checkExitViewerCard(e);break;case 68:this.resolve("site.chat").ChatService.first.sendMessage(`/delete ${this.ModCardData.message_id}`),this.updateLogin(),this.checkExitViewerCard(e);break;case 66:this.resolve("site.chat").ChatService.first.sendMessage(`/ban ${this.ModCardData.user}`),this.updateLogin(),this.checkExitViewerCard(e);break;case 80:this.resolve("site.chat").ChatService.first.sendMessage(`/timeout ${this.ModCardData.user} 1`),this.updateLogin(),this.checkExitViewerCard(e);break;case 27:e&&e.click();break}}updateLogin(t,e){t&&e?(t=t.toLowerCase(),this.ModCardData.user=t,this.ModCardData.message_id=e):(this.ModCardData.user=void 0,this.ModCardData.message_id=void 0)}updateCard(t){this.updateLogin(t.props.targetLogin,t.props.sourceID)}unmountCard(){this.updateLogin()}mod_keybind_handler(){this.chat.context.get("smokemotes.mod_keybinds")?window.addEventListener("keydown",this.onKeyDown):window.removeEventListener("keydown",this.onKeyDown)}};_(g,"SmokeysUtils");let p=g;p.register("smokemotes",null,"1.2.3")})();})();

//# sourceMappingURL=script.js.map