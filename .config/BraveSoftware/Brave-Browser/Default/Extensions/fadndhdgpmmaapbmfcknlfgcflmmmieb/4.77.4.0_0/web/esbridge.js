(()=>{var p=Object.defineProperty;var b=(l,g)=>p(l,"name",{value:g,configurable:!0});var $=[];(()=>{var r;"use strict";var l={};l.h=()=>"76313c69f0d0df3a2768";var g={};const d={1:"debug",2:"info",4:"warn",8:"error"};var w=(o=>(o[o.Verbose=0]="Verbose",o[o.Debug=1]="Debug",o[o.Info=2]="Info",o[o.Warning=4]="Warning",o[o.Error=8]="Error",o[o.Off=99]="Off",o))(w||{});function v(){const o=localStorage.ffzLogLevel;if(!o)return null;const t=o.toUpperCase(),i=m[t];return typeof i=="number"?i:/^\d+$/.test(o)?parseInt(o,10):null}b(v,"readLSLevel");const h=(r=class{constructor(t,i,e,n){this.root=t?t.root:this,this.parent=t,this.name=i,this.root==this&&(this.init=!1,this.captured_init=[],this.label="FFZ"),this.enabled=!0,this.level=e??(t&&t.level)??v()??r.DEFAULT_LEVEL,this.raven=n||t&&t.raven,this.children={}}hi(t,i){const e=i??t.constructor?.version_info;this.info(`FrankerFaceZ v${e} (s:${t.host} f:${t.flavor} b:${e?.build} c:${e?.commit||"null"})`);try{const n=new URL(location.toString());n.search="",this.info(`Initial URL: ${n}`)}catch(n){this.warn("Unable to read location.",n)}}get(t,i){return this.children[t]||(this.children[t]=new r(this,this.name?`${this.name}.${t}`:t,i)),this.children[t]}verbose(t,...i){return this.invoke(0,t,i)}verboseColor(t,i,...e){return this.invokeColor(r.VERBOSE,t,i,e)}debug(t,...i){return this.invoke(r.DEBUG,t,i)}debugColor(t,i,...e){return this.invokeColor(r.DEBUG,t,i,e)}info(t,...i){return this.invoke(r.INFO,t,i)}infoColor(t,i,...e){return this.invokeColor(r.INFO,t,i,e)}warn(t,...i){return this.invoke(r.WARN,t,i)}warnColor(t,i,...e){return this.invokeColor(r.WARN,t,i,e)}warning(t,...i){return this.invoke(r.WARN,t,i)}warningColor(t,i,...e){return this.invokeColor(r.WARN,t,i,e)}error(t,...i){return this.invoke(r.ERROR,t,i)}errorColor(t,i,...e){return this.invokeColor(r.ERROR,t,i,e)}crumb(...t){if(this.raven)return this.raven.captureBreadcrumb(...t)}capture(t,i,...e){if(this.raven&&(i=i||{},i.logger||(i.logger=this.name),this.raven.captureException(t,i)),e.length){const n=e.shift();return this.error(n,...e)}}invokeColor(t,i,e,...n){if(!this.enabled||t<this.level)return;if(Array.isArray(e)||(e=[e]),t>0){let s=i;typeof s=="string"&&(s=s.replace(/%c/g,"")),n.length&&(s=`${s} ${n.join(" ")}`),this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:s,level:d[t]||t}),this.crumb({message:s,category:this.name,level:d[t]||t})}const c=t<2?"color:#999999":"";this.name?(typeof i=="string"?i=`%c${this.root.label} [%c${this.name}%c]:%c ${i}`:(n.unshift(i),i=`%c${this.root.label} [%c${this.name}%c]:%c`),e.unshift("color:#755000; font-weight:bold",c,"color:#755000; font-weight:bold",c)):(typeof i=="string"?i=`%c${this.root.label}:%c ${i}`:(n.unshift(i),i=`%c${this.root.label}:%c`),e.unshift("color:#755000; font-weight:bold",c)),t<2?console.debug(i,...e,...n):t<4?console.info(i,...e,...n):t<8?console.warn(i,...e,...n):t<99&&console.error(i,...e,...n)}invoke(t,i,e){if(!this.enabled||t<this.level||t>=99)return;const n=e?[i,...e]:[i];if(t>0){const E=n.join(" ");this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:E,level:d[t]||t}),this.crumb({message:E,category:this.name,level:d[t]||t})}const c=t<2?"color:#999999":"";let s="";if(c!=="")for(;n.length>0&&typeof n[0]=="string";)s+=" "+n.shift();this.name?n.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${s}`,"color:#755000; font-weight:bold",c,"color:#755000; font-weight:bold",c):n.unshift(`%c${this.root.label}:%c${s}`,"color:#755000; font-weight:bold",c),t<2?console.debug(...n):t<4?console.info(...n):t<8?console.warn(...n):t<99&&console.error(...n)}},b(r,"_Logger2"),r);h.Levels=w,h.VERBOSE=0,h.DEBUG=1,h.INFO=2,h.WARN=4,h.WARNING=4,h.ERROR=8,h.OFF=99,h.DEFAULT_LEVEL=2;let m=h;const R=m,u=class u{constructor(){u.instance=this,this.host="null",this.flavor="esbridge",this.log=new R(null,null,null),this.log.label="FFZESBridge",this.core_log=this.log.get("core"),this.log.hi(this),this.onWindowMessage=this.onWindowMessage.bind(this),this.onRuntimeDisconnect=this.onRuntimeDisconnect.bind(this),this.onRuntimeMessage=this.onRuntimeMessage.bind(this),window.addEventListener("message",this.onWindowMessage),document.addEventListener("readystatechange",t=>{document.documentElement&&(document.documentElement.dataset.ffzEsbridge=!0)})}static get(){return u.instance}windowSend(t,i){typeof t=="string"&&(t={ffz_esb_type:t});try{window.postMessage(t,location.origin,i?Array.isArray(i)?i:[i]:void 0)}catch(e){this.log.error("Error sending message to window.",e,t,i)}}onWindowMessage(t){if(t.origin!==location.origin)return;const i=t.data,e=i?.id,n=i?.ffz_esb_type;n&&(this.log.info("Received Message from Page",n,e,i),n==="init"&&(this.received_init=!0,this.active&&this.runtimeHeartbeat()),this.runtimeSend(i))}runtimeOpen(){if(this.active)return Promise.resolve();this.log.info("Connecting to worker."),this.port=(window.browser??window.chrome).runtime.connect({name:"esbridge"}),this.port.onMessage.addListener(this.onRuntimeMessage),this.port.onDisconnect.addListener(this.onRuntimeDisconnect),this.received_init&&this.runtimeHeartbeat()}onRuntimeMessage(t){this.windowSend(t)}onRuntimeDisconnect(...t){this.log.info("Disconnected from worker.",t),this.active=!1,this.port=null,this._heartbeat&&(clearInterval(this._heartbeat),this._heartbeat=null)}runtimeHeartbeat(){this._heartbeat||(this._heartbeat=setInterval(()=>{this.active&&this.runtimeSend("heartbeat")},3e4))}runtimeSend(t){typeof t=="string"&&(t={ffz_esb_type:t}),this.active||this.runtimeOpen(),this.port.postMessage(t)}};b(u,"FFZESBridge");let f=u;f.Logger=R;const a=f.version_info=Object.freeze({major:4,minor:77,revision:4,extra:$?.length&&$[0],commit:"b250075813ef4902b5a303fc7290d6429703feef",build:"0",hash:l.h(),toString:()=>`${a.major}.${a.minor}.${a.revision}${a.extra||""}${a.build?`+${a.build}`:""}`});window.FFZESBridge=f,window.ffz_esbridge=new f})();})();

//# sourceMappingURL=esbridge.js.map