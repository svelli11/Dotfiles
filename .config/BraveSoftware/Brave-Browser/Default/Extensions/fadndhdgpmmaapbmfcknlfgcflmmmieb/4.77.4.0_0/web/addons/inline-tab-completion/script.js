(()=>{var M=Object.defineProperty;var k=(m,I)=>M(m,"name",{value:I,configurable:!0});(()=>{"use strict";var m={};m.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),(()=>{var h;m.g.importScripts&&(h=m.g.location+"");var t=m.g.document;if(!h&&t&&(t.currentScript&&(h=t.currentScript.src),!h)){var e=t.getElementsByTagName("script");if(e.length)for(var i=e.length-1;i>-1&&!h;)h=e[i--].src}if(!h)throw new Error("Automatic publicPath is not supported in this browser");h=h.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),m.p=h+"../"})();var I={};const T=m.p+"inline-tab-completion/styles.css",{createElement:f,setChildren:C}=FrankerFaceZ.utilities.dom,{KEYS:z}=FrankerFaceZ.utilities.constants,{Tooltip:A}=FrankerFaceZ.utilities.tooltip,H={mention:"Mention",emoji:"Emoji",emote:"Emote",command:"Command"},b=Symbol("KeyHandler"),w=Symbol("FocusHandler"),v=class v extends FrankerFaceZ.utilities.addon.Addon{constructor(...t){super(...t),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.chat.input"),this.inject("tooltips"),this.inject("chat.emoji"),this.settings.add("addon.inlinetab.tips",{default:!0,ui:{path:"Add-Ons > Inline Tab >> Appearance",title:"Display a tooltip when using tab-completion.",component:"setting-check-box"},changed:e=>{e?this.createTooltip():this.destroyTooltip()}}),this.settings.add("addon.inlinetab.tip-count",{default:!1,ui:{path:"Add-Ons > Inline Tab >> Appearance",title:"Display multiple entries in the tab-completion tooltip.",component:"setting-check-box"}}),this.settings.add("addon.inlinetab.no_commands",{default:!0,ui:{path:'Add-Ons > Inline Tab >> Content @{"description": "Please note that the built-in Twitch tab-completion will be used for content that is not included in inline tab-completion."}',title:"Do not include commands in inline tab-completion.",component:"setting-check-box"},changed:()=>this.updateProviders()}),this.settings.add("addon.inlinetab.no_mentions",{default:!1,ui:{path:"Add-Ons > Inline Tab >> Content",title:"Do not include users in inline tab-completion.",component:"setting-check-box"},changed:()=>this.updateProviders()}),this.settings.add("addon.inlinetab.mention_prefix",{default:!0,ui:{path:"Add-Ons > Inline Tab >> General",title:"Always prefix mentions with `@` signs.",component:"setting-check-box"}})}onEnable(){this.input.ChatInput.on("mount",this.installInputHandler,this),this.input.ChatInput.on("update",this.updateInputHandler,this),this.input.ChatInput.ready((t,e)=>{for(const i of e)this.installInputHandler(i)}),this.createStyle(),this.createTooltip()}onDisable(){this.input.ChatInput.off("mount",this.installInputHandler,this),this.input.ChatInput.off("update",this.updateInputHandler,this);for(const t of this.input.ChatInput.instances)this.uninstallInputHandler(t);this.destroyStyle(),this.destroyTooltip()}destroyStyle(){this.style&&(this.style.remove(),this.style=null)}createStyle(){this.style||(this.style=f("link",{href:T,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}),document.head.appendChild(this.style))}destroyTooltip(){this.tt&&(this.tt.destroy(),this.tt=null)}createTooltip(){if(this.tt&&this.destroyTooltip(),!this.settings.get("addon.inlinetab.tips"))return;const t=this.tooltips.getRoot();t&&(this.tt=new A(t,[],{logger:this.log,i18n:this.i18n,manual:!0,live:!1,html:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute",innerClass:"",popper:{placement:"top-start",modifiers:{preventOverflow:{boundariesElement:t},flip:{behavior:["top","bottom","left","right"]}}},content:(e,i)=>this.renderTooltip(e._ffz_inst,i)}))}renderTooltip(t){if(!t)return null;const e=t.ffztc_suggestions,i=t.ffztc_position,u=e?.[i];if(!u||!e)return null;const r=e.length;if(!this.settings.get("addon.inlinetab.tip-count")||r===1)return this.renderItem(u,!0,!1,i+1,r);const a=[],l=Math.min(4,r-1);let o=Math.min(i,Math.ceil(l/2));const s=Math.min(r-(i+1),l-o),c=l-(o+s);c>0&&(o+=c);for(let n=0-o;n<=s;n++){const d=i+n;if(d>=0&&d<r){const p=d===i;a.push(this.renderItem(e[d],p,d===0,p?i+1:null,r))}}return f("div",{class:"tw-flex tw-flex-column"},a)}renderItem(t,e,i,u,r){const a=t.type;let l=t.label||t.text,o=null;a==="command"?o=t.text[0]:a==="mention"&&(o="@");const s=t.sel;if(s){const n=s[0],d=s[0]+s[1],p=l.slice(0,n),g=l.slice(n,d),_=l.slice(d);l=[p?f("span",{class:"tw-strong"},p):null,g?f("span",{class:"tw-c-text-alt"},g):null,_?f("span",{class:"tw-strong"},_):null]}let c=null;if(a==="command"&&t.source&&(c=this.i18n.t("addon.inlinetab.type.command-source","Command - {source}",{source:t.source})),a==="emoji"&&t.source){const n=this.emoji.categories?.[t.source];n&&(c=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:this.i18n.t(`emoji.category.${t.source.toSnakeCase()}`,n)}))}return c||(c=this.i18n.t(`addon.inlinetab.type.${a}`,H[a]||a)),f("div",{class:`ffztc-preview tw-flex${i?" ffztc-preview__first":""}${e?" ffztc-preview__current":""}`},f("div",{class:"tw-relative tw-flex-shrink-0 ffztc-preview__image tw-flex tw-align-items-center tw-justify-content-center tw-mg-r-05"},t.srcSet?f("img",{srcSet:t.srcSet}):o?f("figure",{class:"tw-c-text-alt-2 tw-strong tw-font-size-3"},o):null,t.fav&&f("figure",{class:"ffz--favorite ffz-i-star"})),f("div",{class:"tw-flex-grow-1 tw-overflow-hidden"},f("div",{class:"tw-ellipsis"},Array.isArray(l)?l:f("span",{class:"tw-strong"},l)),t.subtitle?f("div",{class:"tw-ellipsis tw-font-size-8 tw-c-text-alt-2"},t.subtitle):null,f("div",{class:"tw-flex tw-c-text-alt tw-font-size-8"},f("div",{class:"tw-flex-grow-1 tw-ellipsis"},c),u&&r?f("div",{class:"tw-flex-shrink-0 tw-mg-l-1"},this.i18n.t("addon.inlinetab.item","{pos,number} of {total,number}",{pos:u,total:r})):null)))}updateProviders(t){if(!t){for(const i of this.input.ChatInput.instances)this.updateProviders(i);return}const e=this.enabled||this.enabling;for(const i of t.autocompleteInputRef.providers){let u=e;if(e){const r=i.autocompleteType;r==="command"&&this.settings.get("addon.inlinetab.no_commands")&&(u=!1),r==="mention"&&this.settings.get("addon.inlinetab.no_mentions")&&(u=!1)}u?(i.ffztc_getMatches||(i.ffztc_getMatches=i.getMatches),i.getMatches=()=>null):i.ffztc_getMatches&&(i.getMatches=i.ffztc_getMatches)}}getElement(t){return t.chatInputRef instanceof Element?t.chatInputRef:this.fine.getChildNode(t)?.querySelector(".chat-wysiwyg-input__editor")}uninstallInputHandler(t,e=!0){const i=this.getElement(t);i&&(t[b]&&(i.removeEventListener("keydown",t[b]),t[b]=null),t[w]&&(i.removeEventListener("focus",t[w]),i.removeEventListener("blur",t[w]),t[w]=null),i[b]=!1,e&&(this.clearAutocomplete(t),this.updateProviders(t)))}installInputHandler(t){if(!(this.enabled||this.enabling))return;const e=this.getElement(t);if(e){if(!t[b]){const i=t[b]=this.handleKey.bind(this,t);e.addEventListener("keydown",i)}if(!t[w]){const i=t[w]=this.clearAutocomplete.bind(this,t);e.addEventListener("focus",i),e.addEventListener("blur",i)}t.ffztc_position==null&&(t.ffztc_position=-1,t.ffztc_parts=t.ffztc_suggestions=null),e[b]=!0,this.updateProviders(t)}}updateInputHandler(t){const e=this.getElement(t);e&&!e[b]&&(this.log.debug("Updating input handler."),this.uninstallInputHandler(t,!1),this.installInputHandler(t))}clearAutocomplete(t){const e=this.getElement(t);t.ffztc_position=-1,t.ffztc_parts=t.ffztc_suggestions=null,e&&(this.tt&&this.tt._exit(e),e._ffz_inst=null)}buildSuggestions(t,e,i,u=!1){const r=[];for(const a of t){let l=e,o="",s=a.autocompleteType;if(s==="command"&&this.settings.get("addon.inlinetab.no_commands"))continue;if(s==="mention"){if(this.settings.get("addon.inlinetab.no_mentions"))continue;(l[0]==="@"||!u&&this.settings.get("addon.inlinetab.mention_prefix"))&&(o="@"),l[0]==="@"&&(l=l.slice(1))}const c=a.ffztc_getMatches(l,!0,i);if(Array.isArray(c))for(const n of c){const d=n.replacement;let p,g=-1,_=0;n.selection&&(g=d.indexOf(n.selection),g!==-1&&(_=n.selection.length)),g!==-1&&(g+=o.length);let S=n.srcSet,y,E,j;s==="command"&&(E=n.description,y=n.group),n.emoji?(s="emoji",y=n.emoji.category,p=n.matched||`:${n.emoji.names[0]}:`):n.emote&&(S=n.emote.srcSet,y=n.emote.source,j=n.emote.extra),r.push({type:s,source:y,extra:j,label:p,subtitle:E,text:o+d,sel:g===-1?null:[g,_],fav:n.favorite,srcSet:S})}}return r}handleKey(t,e){if(e.ctrlKey||e.altKey)return;const i=this.getElement(t);if(!i)return;const u=e.charCode||e.keyCode,r=t.ffzGetValue();if(u===z.Tab&&r?.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=t.ffztc_position,l=t.ffztc_suggestions;if(a===-1){const o=t.ffzGetSelection(),s=o[0];if(s!==o[1])return;const c=/\S+$/.exec(r.slice(0,s))?.index??s,n=s+(/^\S+/.exec(r.slice(s))?.[0]?.length??0);if(t.ffztc_caret=s,t.ffztc_parts=[r.slice(0,c),r.slice(c,n),r.slice(n)],!t.ffztc_parts[1])return;t.ffztc_suggestions=l=this.buildSuggestions(t.autocompleteInputRef.providers,t.ffztc_parts[1],c,t.ffztc_parts[0][0]==="/")}if(l.length>0){a+=e.shiftKey?-1:1,a>=l.length?a=0:a<0&&(a=l.length-1),t.ffztc_position=a;const o=l[a];if(o){const s=t.ffztc_parts,c=s[2].trim()==="";let n=s[0].length,d;if(o.sel?(n+=o.sel[0],d=n+o.sel[1]):(n+=o.text.length+(c?1:0),d=n),t.autocompleteInputRef.setValue(s[0]+o.text+(c&&!o.sel?" ":s[2])),t.ffzSetSelection(n,d),this.tt){i._ffz_inst=t;const p=i[this.tt._accessor];p?(C(p.element,this.renderTooltip(t,p)),p.update()):this.tt._enter(i)}}}return}else if(u===z.Escape&&t.ffztc_position!==-1){t.autocompleteInputRef.setValue(t.ffztc_parts.join("")),t.ffzSetSelection(t.ffztc_caret,t.ffztc_caret),this.clearAutocomplete(t),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();return}u!==z.Shift&&this.clearAutocomplete(t)}};k(v,"InlineTab");let x=v;x.register("inline-tab-completion",null,"1.2.5")})();})();

//# sourceMappingURL=script.js.map