{"version":3,"file":"ragnarok-database/script.js","mappings":"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","sources":["webpack://ffz-addons/webpack/bootstrap","webpack://ffz-addons/webpack/runtime/global","webpack://ffz-addons/webpack/runtime/publicPath","webpack://ffz-addons/./src/ragnarok-database/styles.css","webpack://ffz-addons/./src/ragnarok-database/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl + \"../\";","export default __webpack_public_path__ + \"ragnarok-database/styles.css\";","'use strict';\r\n\r\nconst createElement = FrankerFaceZ.utilities.dom.createElement;\r\nconst sanitize = FrankerFaceZ.utilities.dom.sanitize;\r\n\r\nimport STYLE_RO from './styles.css';\r\n\r\nclass RagnarokDatabase extends Addon {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\tthis.inject('chat');\t\t\t\t\r\n\t\tthis.settings.add('addon.rodb.server',{\r\n\t\t\tdefault: 'iRO',\r\n\t\t\tui: {\r\n\t\t\t\t\tpath: \t\t'Add-Ons > Ragnarok Database >> Server',\r\n\t\t\t\t\ttitle: \t\t'Default Server',\r\n\t\t\t\t\tdescription:'Choose your default server where data should be displayed from. If the item doesn\\'t exit on your server it will try iRO next and finally kRO.',\r\n\t\t\t\t\tcomponent: \t'setting-select-box',\r\n\t\t\t\t\tmultiple:\tfalse,\r\n\t\t\t\t\tdata: \t\t[\r\n\t\t\t\t\t\t\t\t\t{ value: 'aRO', \ttitle: 'aRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'bRO', \ttitle: 'bRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'fRO', \ttitle: 'fRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'idRO', \ttitle: 'idRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'iRO', \ttitle: 'iRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'jRO', \ttitle: 'jRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'kROM', \ttitle: 'kROM' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'kROZ', \ttitle: 'kROZ' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'kROZS', \ttitle: 'kROZS' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'GGH', \ttitle: 'GGH' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'ropEU', \ttitle: 'ropEU' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'ropRU', \ttitle: 'ropRU' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'thROG', \ttitle: 'thROG' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'twRO', \ttitle: 'twRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'cRO', \ttitle: 'cRO' },\r\n\t\t\t\t\t\t\t\t\t{ value: 'iROC', \ttitle: 'iROC' }\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tchanged: (val) => {\r\n\t\t\t\t\tthis.server = val;\r\n\t\t\t\t\tthis.emit('chat:update-lines');\r\n\t\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tvar self = this;\r\n\r\n\t\tthis.messageFilter = {\r\n\t\t\ttype: 'rodb',\r\n\t\t\tpriority: 9,\r\n\r\n\t\t\trender(token, createElement){\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div class=\"dp-tooltip dp-tooltip-item\">\r\n\t\t\t\t\t\t<div class=\"dp-tooltip-head\">\r\n\t\t\t\t\t\t\t<h3><a href={token.url} target=\"_newFrame\">{token.roname} ({token.roserver})</a></h3>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"dp-tooltip-body\">\r\n\t\t\t\t\t\t\t<span class=\"dp-icon dp-icon-item dp-icon-item-large dp-icon-item-white\">\r\n\t\t\t\t\t\t\t\t<span class=\"icon-item-inner icon-item-default\" style={{backgroundImage: 'url(https://static.divine-pride.net/images/items/collection/'+token.roid+'.png)'}}>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<div class=\"dp-item-properties\">\r\n\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t<li><font color=\"#000000\" dangerouslySetInnerHTML={{ __html: token.description }}></font></li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t<span class=\"clear\"></span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"dp-tooltip-foot\"></div>\r\n\t\t\t\t\t</div>);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tprocess(tokens, msg) {\r\n\t\t\t\tvar regex = /.*divine-pride.net\\/database\\/([a-z]+)\\/([0-9]+).*/;\r\n\t\t\t\tfor(const token of tokens) {\r\n\t\t\t\t\tif (token.type == 'link' && regex.test(token.text)) {\r\n\t\t\t\t\t\tvar parsed = regex.exec(token.text);\r\n\t\t\t\t\t\tself.fetchXHR(parsed[1], parsed[2], self.server, token, msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn tokens;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.rodbCSS = null;\r\n\t\tthis.server = this.settings.get('addon.rodb.server');\r\n\t}\r\n\r\n\tonEnable() {\r\n\t\tif(this.rodbCSS == null){\r\n\t\t\tthis.rodbCSS = document.head.appendChild(createElement('link', {\r\n\t\t\t\thref: STYLE_RO,\r\n\t\t\t\tid: 'rodb-css',\r\n\t\t\t\trel: 'stylesheet',\r\n\t\t\t\ttype: 'text/css',\r\n\t\t\t\tcrossOrigin: 'anonymous'\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t\tthis.log.info('Enabling support for divine-pride links.');\r\n\t\tthis.chat.addTokenizer(this.messageFilter);\r\n\t\tthis.emit('chat:update-lines');\r\n\t}\r\n\r\n\tonDisable() {\r\n\t\tif(this.rodbCSS != null){\r\n\t\t\tdocument.getElementById(\"rodb-css\").remove();\r\n\t\t\tthis.rodbCSS = null;\r\n\t\t}\r\n\t\tthis.chat.removeTokenizer(this.messageFilter);\r\n\t\tthis.emit('chat:update-lines');\r\n\t}\r\n\t\r\n\tasync fetchXHR(from, id, server, token, message){\r\n\t\tvar xhr = new XMLHttpRequest();\t\r\n\t\txhr.open(\"GET\", \"https://www.divine-pride.net/api/database/\"+from+\"/\" + id + \"?apiKey=92f0c44ff2bded0973a905cfc928cd66&server=\"+server, true);\r\n\t\t\r\n\t\txhr.onreadystatechange = () => {\r\n\t\t\tif (xhr.readyState === XMLHttpRequest.DONE) {\r\n\t\t\t\tconst status = xhr.status;\r\n\t\t\t\tif (status === 0 || (status >= 200 && status < 400)) {\r\n\t\t\t\t\tvar parsed = JSON.parse(xhr.responseText);\t\t\t\t\t\r\n\t\t\t\t\tif(parsed[\"status\"] != null)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\r\n\t\t\t\t\tparsed[\"description\"] = parsed[\"description\"].replaceAll(/<a href.*?>/g, '');\r\n\t\t\t\t\tparsed[\"description\"] = parsed[\"description\"].replaceAll('</a>', '');\r\n\t\t\t\t\tparsed[\"description\"] = sanitize(parsed[\"description\"]);\r\n\t\t\t\t\tparsed[\"description\"] = parsed[\"description\"].replaceAll(/(?:\\r\\n|\\r|\\n)/g, '<br>');\r\n\t\t\t\t\tparsed[\"description\"] = parsed[\"description\"].replaceAll('^000000', '</font>');\r\n\t\t\t\t\tparsed[\"description\"] = parsed[\"description\"].replaceAll(/\\^([0-9a-fA-F]{6})/g, \"<font color=\\\"#$1\\\">\");\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoken.type = \"rodb\";\r\n\t\t\t\t\ttoken.roname = parsed[\"name\"];\r\n\t\t\t\t\ttoken.description = parsed[\"description\"];\r\n\t\t\t\t\ttoken.roid = id;\r\n\t\t\t\t\ttoken.roserver = server;\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.emit(\"chat:update-line\", message.id, false);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(server == \"kRO\")\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\tif(server == \"iRO\"){\r\n\t\t\t\t\t\tthis.fetchXHR(from, id, \"kRO\", token, message);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.fetchXHR(from, id, \"iRO\", token, message);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\t\t\r\n\t\txhr.send();\r\n\t}\r\n}\r\n\r\nRagnarokDatabase.register();\r\n"],"names":["__webpack_require__","scriptUrl","document","scripts","createElement","sanitize","args","val","self","token","tokens","msg","regex","parsed","from","id","server","message","xhr","status","RagnarokDatabase"],"sourceRoot":""}