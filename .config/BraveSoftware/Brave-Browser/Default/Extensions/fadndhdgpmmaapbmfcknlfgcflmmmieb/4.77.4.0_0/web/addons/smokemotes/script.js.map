{"version":3,"file":"smokemotes/script.js","mappings":"oGAAA,KAAM,CAAC,cAAAA,CAAa,EAAI,aAAa,UAAU,IAEzC,EAAN,MAAM,UAAqB,kCAAM,CAChC,eAAeC,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,YAAc,SAAS,cAAc,kBAAkB,GAAG,KAC/D,KAAK,eAAiB,OAEtB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,MAAM,EAClB,KAAK,SAAS,YAAa,WAAW,EACtC,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,aAAa,EAEzB,KAAK,KAAO,KAAK,KAAK,QAAQ,EAC9B,KAAK,UAAY,KAAK,UAAU,KAAK,IAAI,EACzC,KAAK,YAAc,CAClB,KAAM,OACN,WAAY,MACb,EAEA,KAAK,UAAY,EAEjB,KAAK,KAAK,OAAO,GAAG,SAAU,CAACC,EAAOC,IAAU,CAC3CA,GAASA,EAAM,CAAC,GAAK,wBAA0B,KAAK,YAAc,IACrE,KAAK,cAAc,EAEnB,KAAK,UAAY,EAEnB,CAAC,EAED,KAAK,SAAS,IAAI,6BAA8B,CAC/C,QAAS,GAET,GAAI,CACH,KAAM,GACN,KAAM,kDACN,MAAO,kBACP,YAAa,qDACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,CAAC,SAAS,EACnB,KAAM,oBACN,GAAI,CACH,KAAM,kDACN,MAAO,cACP,YAAa,gFACb,UAAW,qBACX,SAAU,GACV,KAAM,IAAM,KAAK,KAAK,oBAAoB,CAC3C,CACD,CAAC,EAED,KAAK,SAAS,IAAI,oCAAqC,CACtD,QAAS,GAET,GAAI,CACH,KAAM,EACN,KAAM,kDACN,MAAO,gDACP,YAAa,0KACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,QAAS,EAET,GAAI,CACH,KAAM,EACN,KAAM,kDACN,MAAO,0BACP,YAAa,kFACb,UAAW,mBACX,QAAQC,EAAK,CAEZ,OADAA,EAAM,WAAWA,EAAK,EAAE,EACpB,MAAMA,CAAG,GAAK,CAAC,SAASA,CAAG,GAAKA,EAAM,EAAU,EAE7CA,CACR,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GAET,GAAI,CACH,KAAM,EACN,KAAM,kDACN,MAAO,qBACP,YAAa,gEACb,UAAW,mBACX,QAAQA,EAAK,CAEZ,OADAA,EAAM,WAAWA,EAAK,EAAE,EACpB,MAAMA,CAAG,GAAK,CAAC,SAASA,CAAG,GAAKA,EAAM,EAAU,GAE7CA,CACR,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,UAET,GAAI,CACH,KAAM,EACN,KAAM,kDACN,MAAO,eACP,YAAa,kDACb,UAAW,oBACX,MAAO,GACP,OAAQ,EACT,CACD,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,UAET,GAAI,CACH,KAAM,EACN,KAAM,kDACN,MAAO,aACP,YAAa,gDACb,UAAW,oBACX,MAAO,GACP,OAAQ,EACT,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,UAET,GAAI,CACH,KAAM,EACN,KAAM,kDACN,MAAO,mBACP,YAAa,sDACb,UAAW,oBACX,MAAO,GACP,OAAQ,EACT,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GAET,GAAI,CACH,KAAM,GACN,KAAM,0CACN,MAAO,sBACP,YAAa,iGACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,mCAAoC,CACrD,QAAS,GAET,GAAI,CACH,KAAM,EACN,KAAM,4CACN,MAAO,uDACP,YAAa,qGACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,SAAU,CAAC,mBAAmB,EAC9B,QAAQC,EAAKD,EAAK,CACjB,OAAOC,EAAI,IAAI,mBAAmB,EAAID,EAAM,EAC7C,EACA,GAAI,CACH,KAAM,EACN,KAAM,+CACN,MAAO,sBACP,YAAa,iEACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,kCAAmC,CACpD,QAAS,GAET,GAAI,CACH,KAAM,EACN,KAAM,+CACN,MAAO,8CACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,KAAK,QAAQ,GACjB,mCACA,KAAK,cACL,IACD,EAEA,KAAK,KAAK,QAAQ,GACjB,kCACA,KAAK,oBACL,IACD,EAEA,KAAK,WAAa,KAAK,KAAK,OAC3B,mBACAE,GAAKA,EAAE,qBAAuBA,EAAE,oBACjC,EAEA,KAAK,WAAa,KAElB,KAAK,eAAiB,GAEtB,KAAK,oBAAoB,EACzB,KAAK,SAAS,GAAG,sCAAuC,KAAK,oBAAqB,IAAI,CACvF,CAEA,UAAW,CACN,SAAS,YAAc,WAC1B,OAAO,iBAAiB,OAAQ,IAAM,CACrC,KAAK,cAAc,CAClB,CAAC,EAEH,KAAK,cAAc,EAGpB,KAAK,oBAAoB,EAEzB,KAAK,WAAW,GAAG,QAAS,KAAK,WAAY,IAAI,EACjD,KAAK,WAAW,GAAG,UAAW,KAAK,YAAa,IAAI,EAEpD,KAAK,IAAI,MAAM,qDAAqD,CACrE,CAMA,qBAAsB,CACrB,MAAMC,EAAU,KAAK,SAAS,IAAI,4BAA4B,EACzDA,GAAW,CAAE,KAAK,eACtB,KAAK,GAAG,sBAAuB,KAAK,UAAW,IAAI,EAC1C,CAAEA,GAAW,KAAK,gBAC3B,KAAK,IAAI,sBAAuB,KAAK,UAAW,IAAI,EAErD,KAAK,eAAiBA,CACvB,CAEA,UAAUC,EAAO,CAChB,MAAMC,EAAMD,EAAM,QAKlB,GAJKC,EAAI,gBAGTA,EAAI,cAAgB,GACfA,EAAI,SAAWA,EAAI,aAAe,CAAEA,EAAI,WAAaA,EAAI,cAAgB,CAAE,KAAK,SAAS,IAAI,4BAA4B,GAC7H,OAED,MAAMC,EAAaD,EAAI,WACvB,GAAK,CAAEC,GAAY,KAClB,OAED,MAAMC,EAAQ,KAAK,SAAS,IAAI,2BAA2B,EAC3D,IAAIC,EAAU,GACd,UAAUC,KAAQF,EACjB,GAAKD,EAAW,IAAIG,CAAI,EAAI,CAC3BD,EAAU,GACV,KACD,CAED,GAAK,CAAEA,EACN,OAED,IAAIE,EAAa,SAAS,cAAc,oBAAoB,EAC5D,GAAK,CAAEA,EAAa,CACnB,MAAMC,EAAY,KAAK,UAAU,cAAc,MAC9CC,EAAKD,GAAW,OAAO,gBAExBD,EAAad,EAAc,MAAO,CACjC,GAAI,oBACJ,MAAO,0FACP,MAAO,wBACR,CAAC,EAEDgB,EAAG,WAAW,QAAQF,CAAU,CACjC,CAIA,GAFAA,EAAW,MAAM,MAAQ,KAAK,SAAS,IAAI,8BAA8B,EAEpEA,EAAW,WAAW,QAAU,KAAK,SAAS,IAAI,gCAAgC,EACtF,GAAK,KAAK,SAAS,IAAI,mCAAmC,EACzDA,EAAW,WAAW,CAAC,EAAE,OAAO,MAEhC,QAGF,IAAIG,EAAWR,EAAI,cACdQ,IACJA,EAAW,KAAK,UAAU,eAAe,QAAQA,CAAQ,GACnDA,IACNA,EAAW,KAAK,UAAU,eAAe,QAAQ,KAAK,SAAS,IAAI,sBAAsB,CAAC,GAE3F,IAAIC,EAAQT,EAAI,KAAK,MAChBS,IACJA,EAAQ,KAAK,UAAU,OAAO,QAAQA,CAAK,GAE5C,MAAMC,EAAY,KAAK,UAAU,eAAiB,CAAC,EAClDC,EAAYX,EAAI,cAAgBU,EAAU,OAC1CE,EAAeD,EAAY,KAAK,KAAK,QAAQ,IAAI,eAAe,EAAI,EACpEE,EAAgBD,GAAgB,EAChCE,EAAeF,IAAiB,GAAKA,IAAiB,EAEvD,sBAAsB,IAAM,CAC3B,MAAMG,EAAS,KAAK,IAAI,EAAI,KAAK,MAAM,KAAK,OAAO,EAAI,GAAG,EACzDC,EAAShB,EAAI,YAAc,KAC3BiB,EAAgB,KAAK,SAAS,IAAI,0BAA0B,EAE7D,IAAIC,EAAMC,EACV,MAAMC,EAAW,MAAM,CACtBD,GAAS,aAAaA,CAAK,EAC3BD,GAAQA,EAAK,OAAO,EACpBA,EAAOC,EAAQ,IAChB,EAJiB,YAMjB,IAAIE,EAAOrB,EAAI,UAAYA,EAAI,UAAYA,EAAI,QAAUA,EAAI,QAAQ,MAAM,CAAC,EAAI,OAC/EsB,EAAUtB,EAAI,OAEf,GAAK,CAAEqB,GAAQC,EAAU,CACxB,MAAMC,EAAI,KAAK,KAAK,QAAQD,EAAS,KAAM,EAAI,EAC1CC,GAAKA,EAAE,QACXF,EAAOrB,EAAI,UAAYuB,EAAE,MAC3B,CAEA,GAAK,CAAED,GAAWD,EAAO,CACxB,MAAME,EAAI,KAAK,KAAK,QAAQ,KAAMF,EAAM,EAAI,EACvCE,GAAKA,EAAE,KACXD,EAAUtB,EAAI,OAASuB,EAAE,GAC3B,CAEAL,EAAQ,EAAC,OACR,GAAIH,EACJ,MAAO,qBAAqBP,EAAW,oBAAsB,EAAE,GAC/D,MAAO,qBAAqBS,CAAa,4CAA4CT,EAAW,oBAAoBA,CAAQ,IAAM,EAAE,GACpI,YAAWa,EACX,eAAcC,EACd,YAAWtB,EAAI,KAAK,MACpB,eAAcA,EAAI,KAAK,IAEvB,EAAC,OACA,MAAM,yEAEN,QAASoB,CAAA,EAET,EAAC,UAAO,MAAM,cAAe,EAC9B,EACA,EAAC,QAAK,MAAM,wBACT,KAAK,KAAK,WAAWpB,EAAI,SAAS,CACrC,EACA,EAAC,QAAK,MAAM,8BACT,KAAK,KAAK,OAAO,OAAOA,EAAKT,CAAa,CAC7C,EACA,EAAC,QAAK,MAAM,kCAAkC,KAAK,UAClD,EAAC,QAAK,MAAM,6BACX,EAAC,KAAE,IAAI,sBAAsB,OAAO,SAAS,KAAM,qBAAqBS,EAAI,KAAK,KAAK,GAAI,MAAO,CAAC,MAAAS,CAAK,GACpGT,EAAI,KAAK,aAAeA,EAAI,KAAK,KACpC,CACD,CACD,EACCW,EAAY,IAAM,KACnB,EAAC,QACA,MAAO,WAAWE,EAAgB,sCAAwC,EAAE,GAC5E,MAAO,CAAC,MAAOC,EAAeL,EAAQ,IAAI,GAEzCO,EAAS,KAAK,KAAK,aAAaA,CAAM,EAAIhB,EAAI,OAChD,CACD,EAEAK,EAAW,YAAYa,CAAI,EAEvB,SAAS,SACZ,SAAS,cACR,kBACD,EAAE,KAAO,KAAK,aAEf,MAAMM,EAAU,KAAK,SAAS,IAAI,yBAAyB,EACtDA,EAAU,IACdL,EAAQ,WAAWC,EAAUI,EAAU,GAAI,EAE7C,CAAC,CACF,CAMA,eAAgB,CACf,GAAI,KAAK,KAAK,QAAQ,IAAI,0BAA0B,EACnD,GAAI,CACH,SAAS,iBACR,mBACAC,GAAK,CACJA,EAAE,yBAAyB,CAC5B,EACA,GACA,EACD,CACD,OAASC,EAAK,CACb,KAAK,IAAI,KAAK,wDAAyDA,CAAG,CAC3E,CAEF,CAEA,eAAgB,CACf,GAAI,KAAK,KAAK,QAAQ,IAAI,kCAAkC,EAC3D,GAAI,CACH,SAAS,cAAc,uCAAuC,EAAE,MAAM,CACvE,OAASC,EAAO,CACf,KAAK,IAAI,KAAK,0CAA2CA,CAAK,CAC/D,CAEF,CAEA,qBAAsB,CAChB,SAAS,SACb,SAAS,cACR,kBACD,EAAE,KAAO,KAAK,qBAChB,CAEA,oBAAoBC,EAAa,CAC5BA,GAAgB,KAAK,SAAS,IAAI,iCAAiC,GACtEA,EAAa,MAAM,CAErB,CAMA,UAAUH,EAAG,CAEZ,GACC,SAAS,eAAiB,SAAS,cAAc,iCAAiC,GAClFA,EAAE,SACFA,EAAE,SACFA,EAAE,UACF,CAAC,KAAK,YAAY,KAElB,OAED,MAAMG,EAAe,SAAS,cAAc,uDAAuD,EAInG,OAFgBH,EAAE,SAAWA,EAAE,MAEd,CAEhB,IAAK,IAEJ,KAAK,QAAQ,WAAW,EAAE,YAAY,MAAM,YAC3C,YAAY,KAAK,YAAY,IAAI,MAClC,EACA,KAAK,YAAY,EACjB,KAAK,oBAAoBG,CAAY,EAErC,MAGD,IAAK,IAEJ,KAAK,QAAQ,WAAW,EAAE,YAAY,MAAM,YAC3C,WAAW,KAAK,YAAY,UAAU,EACvC,EACA,KAAK,YAAY,EACjB,KAAK,oBAAoBA,CAAY,EAErC,MAGD,IAAK,IAEJ,KAAK,QAAQ,WAAW,EAAE,YAAY,MAAM,YAC3C,QAAQ,KAAK,YAAY,IAAI,EAC9B,EACA,KAAK,YAAY,EACjB,KAAK,oBAAoBA,CAAY,EAErC,MAGD,IAAK,IAEJ,KAAK,QAAQ,WAAW,EAAE,YAAY,MAAM,YAC3C,YAAY,KAAK,YAAY,IAAI,IAClC,EACA,KAAK,YAAY,EACjB,KAAK,oBAAoBA,CAAY,EAErC,MAGD,IAAK,IACAA,GACHA,EAAa,MAAM,EAGpB,KACF,CACD,CAEA,YAAYC,EAAOC,EAAQ,CACtBD,GAASC,GACZD,EAAQA,EAAM,YAAY,EAC1B,KAAK,YAAY,KAAOA,EACxB,KAAK,YAAY,WAAaC,IAE9B,KAAK,YAAY,KAAO,OACxB,KAAK,YAAY,WAAa,OAEhC,CAEA,WAAWC,EAAM,CAChB,KAAK,YAAYA,EAAK,MAAM,YAAaA,EAAK,MAAM,QAAQ,CAC7D,CAEA,aAAc,CACb,KAAK,YAAY,CAClB,CAEA,qBAAsB,CACjB,KAAK,KAAK,QAAQ,IAAI,yBAAyB,EAClD,OAAO,iBAAiB,UAAW,KAAK,SAAS,EAEjD,OAAO,oBAAoB,UAAW,KAAK,SAAS,CAEtD,CACD,EA5hBiC,oBAAjC,IAAMC,EAAN,EA8hBAA,EAAa,SAAS,0B","sources":["webpack://ffz-addons/./src/smokemotes/index.jsx"],"sourcesContent":["const {createElement} = FrankerFaceZ.utilities.dom;\n\nclass SmokeysUtils extends Addon {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.notify_icon = document.querySelector('link[rel=\"icon\"]')?.href;\n\t\tthis.pinned_handler = undefined;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('chat');\n\t\tthis.inject('chat.emotes');\n\t\tthis.inject('chat.badges');\n\t\tthis.inject('site');\n\t\tthis.injectAs('site_chat', 'site.chat');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.router');\n\n\t\tthis.user = this.site.getUser();\n\t\tthis.onKeyDown = this.onKeyDown.bind(this);\n\t\tthis.ModCardData = {\n\t\t\tuser: undefined,\n\t\t\tmessage_id: undefined,\n\t\t};\n\n\t\tthis.firstLoad = 0;\n\n\t\tthis.site.router.on(':route', (route, match) => {\n\t\t\tif (match && match[0] == '/directory/following' && this.firstLoad === 0){\n\t\t\t\tthis.liveFollowing();\n\t\t\t\t// do this just in case the user wants to go to Overview later for videos etc..\n\t\t\t\tthis.firstLoad = 1;\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_mentions', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tsort: -1,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Pinned Mentions',\n\t\t\t\tdescription: 'Enable to have mentions pinned to the top of chat.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_reasons', {\n\t\t\tdefault: ['mention'],\n\t\t\ttype: 'basic_array_merge',\n\t\t\tui: {\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Pin Reasons',\n\t\t\t\tdescription: 'Pin messages when a chat line is highlighted for one of the selected reasons.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tmultiple: true,\n\t\t\t\tdata: () => this.chat.getHighlightReasons()\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_messages_remove', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tsort: 0,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Remove Oldest Pinned Mention If At Max Number',\n\t\t\t\tdescription: 'Enable to remove the oldest pinned mention and add the latest mention, otherwise it will stop pinning messages if you have the maximum amount until there is more room.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_messages_max', {\n\t\t\tdefault: 6,\n\n\t\t\tui: {\n\t\t\t\tsort: 1,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Maximum Pinned Messages',\n\t\t\t\tdescription: 'Maximum amount of pinned messages allowed to be in the pinned mentions section.',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess(val) {\n\t\t\t\t\tval = parseFloat(val, 10);\n\t\t\t\t\tif (isNaN(val) || !isFinite(val) || val < 0) return 6;\n\n\t\t\t\t\treturn val;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_timer', {\n\t\t\tdefault: 60,\n\n\t\t\tui: {\n\t\t\t\tsort: 2,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Auto Removal Timer',\n\t\t\t\tdescription: 'Time in seconds to auto remove pinned messages. 0 To Disable.',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess(val) {\n\t\t\t\t\tval = parseFloat(val, 10);\n\t\t\t\t\tif (isNaN(val) || !isFinite(val) || val < 0) return 60;\n\n\t\t\t\t\treturn val;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_border', {\n\t\t\tdefault: '#828282',\n\n\t\t\tui: {\n\t\t\t\tsort: 3,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Border Color',\n\t\t\t\tdescription: 'Color to use for the border of pinned mentions.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\talpha: false,\n\t\t\t\topenUp: true,\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_font_color', {\n\t\t\tdefault: '#dadada',\n\n\t\t\tui: {\n\t\t\t\tsort: 4,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Font Color',\n\t\t\t\tdescription: 'Color to use for the font of pinned mentions.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\talpha: false,\n\t\t\t\topenUp: true,\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.pinned_bg', {\n\t\t\tdefault: '#3e0b0b',\n\n\t\t\tui: {\n\t\t\t\tsort: 5,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Pinned Mentions\",\n\t\t\t\ttitle: 'Background Color',\n\t\t\t\tdescription: 'Color to use for the background of pinned mentions.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\talpha: false,\n\t\t\t\topenUp: true,\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.keep_hd_video', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tsort: -1,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Channel\",\n\t\t\t\ttitle: 'Maintain HD Quality',\n\t\t\t\tdescription: 'Enable to keep the video player from automatically decreasing video quality when out of focus.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.auto_live_follow_page', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tsort: 0,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Following\",\n\t\t\t\ttitle: 'Auto go to Live channels on your Following Directory',\n\t\t\t\tdescription: 'Enable to automatically go to the Live channel section on a fresh load of the following directory.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.mod_keybinds', {\n\t\t\tdefault: false,\n\t\t\trequires: ['context.moderator'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn ctx.get('context.moderator') ? val : false;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tsort: 1,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Mod Keybinds\",\n\t\t\t\ttitle: 'Toggle Mod Keybinds',\n\t\t\t\tdescription: 'Enable to be able to use T/B/P/D for Timeout/Ban/Purge/Delete.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('smokemotes.auto_exit_viewercard', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tsort: 2,\n\t\t\t\tpath: \"Add-Ons > Smokey's Utilities >> Mod Keybinds\",\n\t\t\t\ttitle: 'Auto Close Viewer Card After Keybind Action',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\t\t});\n\n\t\tthis.chat.context.on(\n\t\t\t'changed:smokemotes.keep_hd_video',\n\t\t\tthis.keep_hd_video,\n\t\t\tthis\n\t\t);\n\n\t\tthis.chat.context.on(\n\t\t\t'changed:smokemotes.mod_keybinds',\n\t\t\tthis.mod_keybind_handler,\n\t\t\tthis\n\t\t);\n\n\t\tthis.ViewerCard = this.fine.define(\n\t\t\t'chat-viewer-card',\n\t\t\tn => n.trackViewerCardOpen && n.onWhisperButtonClick\n\t\t);\n\n\t\tthis.style_link = null;\n\n\t\tthis.event_listener = false;\n\n\t\tthis.updateEventListener();\n\t\tthis.settings.on(':changed:smokemotes.pinned_mentions', this.updateEventListener, this);\n\t}\n\n\tonEnable() {\n\t\tif (document.readyState != \"complete\") {\n\t\t\twindow.addEventListener('load', () => {\n\t\t\t\tthis.keep_hd_video();\n\t\t\t  });\n\t\t} else {\n\t\t\tthis.keep_hd_video();\n\t\t}\n\n\t\tthis.mod_keybind_handler();\n\n\t\tthis.ViewerCard.on('mount', this.updateCard, this);\n\t\tthis.ViewerCard.on('unmount', this.unmountCard, this);\n\n\t\tthis.log.debug(\"Smokey's Utilities module was enabled successfully.\");\n\t}\n\n\t/**\n\t * Handle new messages, see if they should be pinned and pin them.\n\t */\n\n\tupdateEventListener() {\n\t\tconst setting = this.settings.get('smokemotes.pinned_mentions');\n\t\tif ( setting && ! this.event_listener )\n\t\t\tthis.on('chat:buffer-message', this.handlePin, this);\n\t\telse if ( ! setting && this.event_listener )\n\t\t\tthis.off('chat:buffer-message', this.handlePin, this);\n\n\t\tthis.event_listener = setting;\n\t}\n\n\thandlePin(event) {\n\t\tconst msg = event.message;\n\t\tif ( msg.smokey_pinned )\n\t\t\treturn;\n\n\t\tmsg.smokey_pinned = true;\n\t\tif ( msg.deleted || msg.ffz_removed || ! msg.mentioned || msg.isHistorical || ! this.settings.get('smokemotes.pinned_mentions') )\n\t\t\treturn;\n\n\t\tconst highlights = msg.highlights;\n\t\tif ( ! highlights?.size )\n\t\t\treturn;\n\n\t\tconst types = this.settings.get('smokemotes.pinned_reasons');\n\t\tlet matched = false;\n\t\tfor(const type of types)\n\t\t\tif ( highlights.has(type) ) {\n\t\t\t\tmatched = true;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\tif ( ! matched )\n\t\t\treturn;\n\n\t\tlet pinned_log = document.querySelector('#smokey_pinned_log');\n\t\tif ( ! pinned_log ) {\n\t\t\tconst container = this.site_chat.ChatContainer.first,\n\t\t\t\tel = container?.state?.chatListElement;\n\n\t\t\tpinned_log = createElement('div', {\n\t\t\t\tid: 'smokey_pinned_log',\n\t\t\t\tclass: 'pinned-highlight-log tw-absolute tw-top-0 tw-z-above tw-full-width tw-c-background-base',\n\t\t\t\tstyle: 'z-order:99 !important;'\n\t\t\t});\n\n\t\t\tel.parentNode.prepend(pinned_log);\n\t\t}\n\n\t\tpinned_log.style.color = this.settings.get('smokemotes.pinned_font_color');\n\n\t\tif ( pinned_log.childNodes.length >= this.settings.get('smokemotes.pinned_messages_max') ) {\n\t\t\tif ( this.settings.get('smokemotes.pinned_messages_remove') )\n\t\t\t\tpinned_log.childNodes[0].remove();\n\t\t\telse\n\t\t\t\treturn;\n\t\t}\n\n\t\tlet bg_color = msg.mention_color;\n\t\tif ( bg_color )\n\t\t\tbg_color = this.site_chat.inverse_colors.process(bg_color);\n\t\tif ( ! bg_color )\n\t\t\tbg_color = this.site_chat.inverse_colors.process(this.settings.get('smokemotes.pinned_bg'));\n\n\t\tlet color = msg.user.color;\n\t\tif ( color )\n\t\t\tcolor = this.site_chat.colors.process(color);\n\n\t\tconst msg_types = this.site_chat.message_types || {},\n\t\t\tis_action = msg.messageType === msg_types.Action,\n\t\t\taction_style = is_action ? this.chat.context.get('chat.me-style') : 0,\n\t\t\taction_italic = action_style >= 2,\n\t\t\taction_color = action_style === 1 || action_style === 3;\n\n\t\trequestAnimationFrame(() => {\n\t\t\tconst pin_id = Date.now() + Math.floor(Math.random() * 101),\n\t\t\t\ttokens = msg.ffz_tokens || null,\n\t\t\t\tpinned_border = this.settings.get('smokemotes.pinned_border');\n\n\t\t\tlet line, timer;\n\t\t\tconst close_fn = () => {\n\t\t\t\ttimer && clearTimeout(timer);\n\t\t\t\tline && line.remove();\n\t\t\t\tline = timer = null;\n\t\t\t};\n\n\t\t\tlet room = msg.roomLogin ? msg.roomLogin : msg.channel ? msg.channel.slice(1) : undefined,\n\t\t\t\troom_id = msg.roomId;\n\n\t\t\tif ( ! room && room_id ) {\n\t\t\t\tconst r = this.chat.getRoom(room_id, null, true);\n\t\t\t\tif ( r && r.login )\n\t\t\t\t\troom = msg.roomLogin = r.login;\n\t\t\t}\n\n\t\t\tif ( ! room_id && room ) {\n\t\t\t\tconst r = this.chat.getRoom(null, room, true);\n\t\t\t\tif ( r && r.id )\n\t\t\t\t\troom_id = msg.roomId = r.id;\n\t\t\t}\n\n\t\t\tline = (<div\n\t\t\t\tid={pin_id}\n\t\t\t\tclass={`chat-line__message${bg_color ? ' ffz-custom-color' : ''}`}\n\t\t\t\tstyle={`border: 1px solid ${pinned_border} !important; border-top: none !important;${bg_color ? `background-color:${bg_color};` : ''}`}\n\t\t\t\tdata-room={room}\n\t\t\t\tdata-room-id={room_id}\n\t\t\t\tdata-user={msg.user.login}\n\t\t\t\tdata-user-id={msg.user.id}\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tstyle=\"width: 14px; cursor: pointer; top: 5px; right: 5px; position: absolute\"\n\t\t\t\t\t// eslint-disable-next-line react/jsx-no-bind\n\t\t\t\t\tonclick={close_fn}\n\t\t\t\t>\n\t\t\t\t\t<figure class=\"ffz-i-cancel\" />\n\t\t\t\t</div>\n\t\t\t\t<span class=\"chat-line__timestamp\">\n\t\t\t\t\t{ this.chat.formatTime(msg.timestamp) }\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chat-line__message--badges\">\n\t\t\t\t\t{ this.chat.badges.render(msg, createElement) }\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chat-line__username notranslate\" role=\"button\">\n\t\t\t\t\t<span class=\"chat-author__display-name\">\n\t\t\t\t\t\t<a rel=\"noopener noreferrer\" target=\"_blank\" href={`https://twitch.tv/${msg.user.login}`} style={{color}}>\n\t\t\t\t\t\t\t{ msg.user.displayName || msg.user.login }\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t{is_action ? ' ' : ': '}\n\t\t\t\t<span\n\t\t\t\t\tclass={`message ${action_italic ? 'chat-line__message-body--italicized' : ''}`}\n\t\t\t\t\tstyle={{color: action_color ? color : null}}\n\t\t\t\t>\n\t\t\t\t\t{tokens ? this.chat.renderTokens(tokens) : msg.message}\n\t\t\t\t</span>\n\t\t\t</div>);\n\n\t\t\tpinned_log.appendChild(line);\n\n\t\t\tif (document.hidden)\n\t\t\t\tdocument.querySelector(\n\t\t\t\t\t'link[rel=\"icon\"]'\n\t\t\t\t).href = this.notify_icon;\n\n\t\t\tconst timeout = this.settings.get('smokemotes.pinned_timer');\n\t\t\tif ( timeout > 0 ) {\n\t\t\t\ttimer = setTimeout(close_fn, timeout * 1000);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Actually does more than this now. Will keep video from falling behind as well as keep the video HD (in most cases).\n\t */\n\n\tkeep_hd_video() {\n\t\tif (this.chat.context.get('smokemotes.keep_hd_video')) {\n\t\t\ttry {\n\t\t\t\tdocument.addEventListener(\n\t\t\t\t\t'visibilitychange',\n\t\t\t\t\te => {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t},\n\t\t\t\t\ttrue,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t} catch (err) {\n\t\t\t\tthis.log.warn('Unable to install always HD document visibility hook.', err);\n\t\t\t}\n\t\t}\n\t}\n\n\tliveFollowing() {\n\t\tif (this.chat.context.get('smokemotes.auto_live_follow_page')) {\n\t\t\ttry {\n\t\t\t\tdocument.querySelector('a[data-a-target=\"following-live-tab\"]').click();\n\t\t\t} catch (error) {\n\t\t\t\tthis.log.warn('Failed going to Live tab from Overview.', error);\n\t\t\t}\n\t\t}\n\t}\n\n\tonNotifyWindowFocus() {\n\t\tif (!document.hidden)\n\t\t\tdocument.querySelector(\n\t\t\t\t'link[rel=\"icon\"]'\n\t\t\t).href = this.notify_icon_original;\n\t}\n\n\tcheckExitViewerCard(close_button){\n\t\tif (close_button && this.settings.get('smokemotes.auto_exit_viewercard')) {\n\t\t\tclose_button.click();\n\t\t}\n\t}\n\n\t/**\n\t * Moderator Keybinds\n\t */\n\n\tonKeyDown(e) {\n\n\t\tif (\n\t\t\tdocument.activeElement == document.querySelector('div[data-a-target=\"chat-input\"]') ||\n\t\t\te.ctrlKey ||\n\t\t\te.metaKey ||\n\t\t\te.shiftKey ||\n\t\t\t!this.ModCardData.user\n\t\t)\n\t\t\treturn;\n\n\t\tconst close_button = document.querySelector('button[data-test-selector=\"close-viewer-card-button\"]');\n\n\t\tconst keyCode = e.keyCode || e.which;\n\n\t\tswitch (keyCode) {\n\t\t\t// timeout\n\t\t\tcase 84:\n\n\t\t\t\tthis.resolve('site.chat').ChatService.first.sendMessage(\n\t\t\t\t\t`/timeout ${this.ModCardData.user} 600`\n\t\t\t\t);\n\t\t\t\tthis.updateLogin();\n\t\t\t\tthis.checkExitViewerCard(close_button);\n\n\t\t\t\tbreak;\n\n\t\t\t\t// delete message\n\t\t\tcase 68:\n\n\t\t\t\tthis.resolve('site.chat').ChatService.first.sendMessage(\n\t\t\t\t\t`/delete ${this.ModCardData.message_id}`\n\t\t\t\t);\n\t\t\t\tthis.updateLogin();\n\t\t\t\tthis.checkExitViewerCard(close_button);\n\n\t\t\t\tbreak;\n\n\t\t\t\t// ban\n\t\t\tcase 66:\n\n\t\t\t\tthis.resolve('site.chat').ChatService.first.sendMessage(\n\t\t\t\t\t`/ban ${this.ModCardData.user}`\n\t\t\t\t);\n\t\t\t\tthis.updateLogin();\n\t\t\t\tthis.checkExitViewerCard(close_button);\n\n\t\t\t\tbreak;\n\n\t\t\t\t// purge\n\t\t\tcase 80:\n\n\t\t\t\tthis.resolve('site.chat').ChatService.first.sendMessage(\n\t\t\t\t\t`/timeout ${this.ModCardData.user} 1`\n\t\t\t\t);\n\t\t\t\tthis.updateLogin();\n\t\t\t\tthis.checkExitViewerCard(close_button);\n\n\t\t\t\tbreak;\n\n\t\t\t\t// Esc key to close viewer card\n\t\t\tcase 27:\n\t\t\t\tif (close_button) {\n\t\t\t\t\tclose_button.click();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateLogin(login, msg_id) {\n\t\tif (login && msg_id) {\n\t\t\tlogin = login.toLowerCase();\n\t\t\tthis.ModCardData.user = login;\n\t\t\tthis.ModCardData.message_id = msg_id;\n\t\t} else {\n\t\t\tthis.ModCardData.user = undefined;\n\t\t\tthis.ModCardData.message_id = undefined;\n\t\t}\n\t}\n\n\tupdateCard(inst) {\n\t\tthis.updateLogin(inst.props.targetLogin, inst.props.sourceID);\n\t}\n\n\tunmountCard() {\n\t\tthis.updateLogin();\n\t}\n\n\tmod_keybind_handler() {\n\t\tif (this.chat.context.get('smokemotes.mod_keybinds')) {\n\t\t\twindow.addEventListener('keydown', this.onKeyDown);\n\t\t} else {\n\t\t\twindow.removeEventListener('keydown', this.onKeyDown);\n\t\t}\n\t}\n}\n\nSmokeysUtils.register();\n"],"names":["createElement","args","route","match","val","ctx","n","setting","event","msg","highlights","types","matched","type","pinned_log","container","el","bg_color","color","msg_types","is_action","action_style","action_italic","action_color","pin_id","tokens","pinned_border","line","timer","close_fn","room","room_id","r","timeout","e","err","error","close_button","login","msg_id","inst","SmokeysUtils"],"sourceRoot":""}