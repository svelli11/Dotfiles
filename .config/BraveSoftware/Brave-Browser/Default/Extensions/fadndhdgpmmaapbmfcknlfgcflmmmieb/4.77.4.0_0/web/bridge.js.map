{"version":3,"file":"bridge.js","mappings":"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","sources":["webpack://frankerfacez/<define:__version_prerelease__>","webpack://frankerfacez/./src/settings/profile.ts","webpack://frankerfacez/./src/utilities/constants.ts","webpack://frankerfacez/./src/utilities/events.ts","webpack://frankerfacez/./src/utilities/filtering.ts","webpack://frankerfacez/./src/utilities/module.ts","webpack://frankerfacez/./src/utilities/object.ts","webpack://frankerfacez/./src/utilities/path-parser.ts","webpack://frankerfacez/webpack/bootstrap","webpack://frankerfacez/webpack/runtime/compat get default export","webpack://frankerfacez/webpack/runtime/create fake namespace object","webpack://frankerfacez/webpack/runtime/define property getters","webpack://frankerfacez/webpack/runtime/ensure chunk","webpack://frankerfacez/webpack/runtime/get javascript chunk filename","webpack://frankerfacez/webpack/runtime/getFullHash","webpack://frankerfacez/webpack/runtime/global","webpack://frankerfacez/webpack/runtime/hasOwnProperty shorthand","webpack://frankerfacez/webpack/runtime/load script","webpack://frankerfacez/webpack/runtime/make namespace object","webpack://frankerfacez/webpack/runtime/runtimeId","webpack://frankerfacez/webpack/runtime/publicPath","webpack://frankerfacez/webpack/runtime/jsonp chunk loading","webpack://frankerfacez/./src/utilities/logging.ts","webpack://frankerfacez/./src/utilities/blobs.ts","webpack://frankerfacez/./src/settings/typehandlers.ts","webpack://frankerfacez/./src/settings/context.ts","webpack://frankerfacez/./src/settings/processors.ts","webpack://frankerfacez/./src/settings/validators.ts","webpack://frankerfacez/./src/settings/filters.ts","webpack://frankerfacez/./src/settings/providers.ts","webpack://frankerfacez/./src/settings/clearables.ts","webpack://frankerfacez/./src/settings/index.ts","webpack://frankerfacez/./src/bridge.js"],"sourcesContent":[null,"'use strict';\n\n// ============================================================================\n// Settings Profiles\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {isValidShortcut, fetchJSON} from 'utilities/object';\nimport {FilterData, createTester} from 'utilities/filtering';\nimport type SettingsManager from '.';\nimport type { SettingsProvider } from './providers';\nimport type { ContextData, ExportedSettingsProfile, SettingsProfileMetadata } from './types';\nimport type { Mousetrap } from '../utilities/types';\n\ndeclare global {\n\tinterface Window {\n\t\tMousetrap?: Mousetrap;\n\t}\n}\n\n\nexport type ProfileEvents = {\n\t'toggled': [profile: SettingsProfile, enabled: boolean];\n\t'changed': [key: string, value: unknown, deleted: boolean];\n}\n\n\n/**\n * Instances of SettingsProfile are used for getting and setting raw settings\n * values, enumeration, and emit events when the raw settings are changed.\n * @extends EventEmitter\n */\nexport default class SettingsProfile extends EventEmitter<ProfileEvents> {\n\n\tstatic Default: Partial<SettingsProfileMetadata> = {\n\t\tid: 0,\n\t\tuuid: 'ffz_profile_default',\n\t\tname: 'Default Profile',\n\t\ti18n_key: 'setting.profiles.default',\n\n\t\tdescription: 'Settings that apply everywhere on Twitch.'\n\t};\n\n\n\tstatic Moderation: Partial<SettingsProfileMetadata> = {\n\t\tid: 1,\n\t\tuuid: 'ffz_profile_moderation',\n\t\tname: 'Moderation',\n\t\ti18n_key: 'setting.profiles.moderation',\n\n\t\tdescription: 'Settings that apply when you are a moderator of the current channel.',\n\n\t\tcontext: [\n\t\t\t{\n\t\t\t\ttype: 'Moderator',\n\t\t\t\tdata: true\n\t\t\t}\n\t\t]\n\t};\n\n\n\tprivate manager: SettingsManager;\n\tprivate provider: SettingsProvider;\n\n\tprivate prefix: string;\n\tprivate enabled_key: string;\n\n\tprivate _enabled: boolean = false;\n\tprivate _storage?: Map<string, unknown>;\n\n\t/**\n\t * If this is true, the profile will not be persisted and the user will\n\t * not be able to edit it.\n\t */\n\tephemeral: boolean = false;\n\n\t/**\n\t * The ID number for this profile. ID numbers may be recycled as profiles\n\t * are deleted and created.\n\t */\n\tid: number = -1;\n\n\t/**\n\t * The unique ID for this profile. UUIDs should always be unique.\n\t */\n\tuuid: string = null as any;\n\n\t// Metadata\n\n\t/**\n\t * The name of this profile. A human-readable string that may be edited\n\t * by the user.\n\t */\n\tname: string = null as any;\n\n\t/**\n\t * The localization key for the name of this profile. If this is set,\n\t * the name will be localized. If this is not set, the name will be\n\t * displayed as-is. This value is cleared if the user edits the name.\n\t */\n\ti18n_key?: string | null;\n\n\t/**\n\t * The description of this profile. A human-readable string that may\n\t * be edited by the user.\n\t */\n\tdescription?: string | null;\n\n\t/**\n\t * The localization key for the description of this profile. If this\n\t * is set, the description will be localized. If this is not set, the\n\t * description will be displayed as-is. This value is cleared if\n\t * the user edits the description.\n\t */\n\tdesc_i18n_key?: string | null;\n\n\t/**\n\t * A URL for this profile. If this is set, the profile will potentially\n\t * be automatically updated from the URL.\n\t */\n\turl?: string | null;\n\n\t/**\n\t * Whether or not automatic updates should be processed. If this is\n\t * set to true, the profile will not be automatically updated.\n\t */\n\tpause_updates: boolean = false;\n\n\t// TODO: Document, check default value\n\tshow_toggle: boolean = false;\n\n\n\t// Profile Rules\n\n\tcontext?: FilterData[];\n\n\n\t// Hotkey Stuff\n\n\t/**\n\t * A user-set hotkey for toggling this profile on or off.\n\t * @see {@link hotkey}\n\t */\n\tprivate _hotkey?: string | null;\n\n\t/**\n\t * Whether or not the hotkey is currently enabled.\n\t * @see {@link hotkey_enabled}\n\t */\n\tprivate _hotkey_enabled?: boolean = false;\n\n\tprivate _bound_key?: string | null;\n\tprivate Mousetrap?: Mousetrap;\n\n\n\tprivate matcher?: ((ctx: ContextData) => boolean) | null;\n\n\n\tconstructor(manager: SettingsManager, data: Partial<SettingsProfileMetadata>) {\n\t\tsuper();\n\n\t\tthis.onShortcut = this.onShortcut.bind(this);\n\t\tthis._hotkey_enabled = false;\n\n\t\tthis.manager = manager;\n\t\tthis.provider = manager.provider;\n\n\t\tthis.data = data;\n\t\tthis.prefix = `p:${this.id}:`;\n\t\tthis.enabled_key = `${this.prefix}:enabled`;\n\n\t\tif ( this.ephemeral ) {\n\t\t\tthis._enabled = true;\n\t\t\tthis._storage = new Map;\n\t\t}\n\t}\n\n\tget data(): Partial<SettingsProfileMetadata> {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\t//parent: this.parent,\n\t\t\tuuid: this.uuid,\n\n\t\t\tname: this.name,\n\t\t\ti18n_key: this.i18n_key,\n\t\t\thotkey: this.hotkey,\n\t\t\tpause_updates: this.pause_updates,\n\n\t\t\tephemeral: this.ephemeral,\n\n\t\t\tdescription: this.description,\n\t\t\tdesc_i18n_key: this.desc_i18n_key,\n\n\t\t\turl: this.url,\n\t\t\tshow_toggle: this.show_toggle,\n\n\t\t\tcontext: this.context\n\t\t}\n\t}\n\n\tset data(val) {\n\t\tif ( typeof val !== 'object' )\n\t\t\tthrow new TypeError('data must be an object');\n\n\t\tthis.clearMatcher();\n\n\t\t// Make sure ephemeral is set first.\n\t\tif ( val.ephemeral )\n\t\t\tthis.ephemeral = true;\n\n\t\t// Copy the values to this profile.\n\t\tfor(const [key, value] of Object.entries(val))\n\t\t\t(this as any)[key] = value;\n\t}\n\n\n\tclearMatcher() {\n\t\tthis.matcher = null;\n\t}\n\n\n\tmatches(context: ContextData) {\n\t\tif ( ! this.matcher )\n\t\t\tthis.matcher = createTester(\n\t\t\t\tthis.context,\n\t\t\t\tthis.manager.filters,\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t\t() => this.manager.updateSoon()\n\t\t\t);\n\n\t\treturn this.matcher(context);\n\t}\n\n\n\tsave() {\n\t\tif ( ! this.ephemeral )\n\t\t\tthis.manager.saveProfile(this.id);\n\t}\n\n\n\tgetBackup(): ExportedSettingsProfile {\n\t\tconst out: ExportedSettingsProfile = {\n\t\t\tversion: 2,\n\t\t\ttype: 'profile',\n\t\t\tprofile: this.data,\n\t\t\ttoggled: this.toggled,\n\t\t\tvalues: {}\n\t\t};\n\n\t\tdelete out.profile.ephemeral;\n\n\t\tfor(const [key, value] of this.entries())\n\t\t\tout.values[key] = value;\n\n\t\treturn out;\n\t}\n\n\n\tasync checkUpdate() {\n\t\tif ( ! this.url || this.pause_updates )\n\t\t\treturn false;\n\n\t\tconst data = await fetchJSON<ExportedSettingsProfile>(this.url);\n\t\tif ( ! data || data.type !== 'profile' || ! data.profile || ! data.values )\n\t\t\treturn false;\n\n\t\t// We don't want to override general settings.\n\t\tdelete data.profile.ephemeral;\n\t\tdelete data.profile.id;\n\t\tdelete data.profile.uuid;\n\t\tdelete data.profile.name;\n\t\tdelete data.profile.i18n_key;\n\t\tdelete data.profile.hotkey;\n\t\tdelete data.profile.description;\n\t\tdelete data.profile.desc_i18n_key;\n\t\tdelete data.profile.url;\n\t\tdelete data.profile.pause_updates;\n\n\t\tthis.data = data.profile;\n\n\t\tconst old_keys = new Set(this.keys());\n\n\t\tfor(const [key, value] of Object.entries(data.values)) {\n\t\t\told_keys.delete(key);\n\t\t\tthis.set(key, value);\n\t\t}\n\n\t\tfor(const key of old_keys)\n\t\t\tthis.delete(key);\n\n\t\treturn true;\n\t}\n\n\n\t// ========================================================================\n\t// Hotkey\n\t// ========================================================================\n\n\tget hotkey() {\n\t\treturn this._hotkey;\n\t}\n\n\tset hotkey(key) {\n\t\tif ( key === this._hotkey )\n\t\t\treturn;\n\n\t\tthis._hotkey = key;\n\t\tif ( this._hotkey_enabled )\n\t\t\tthis._updateHotkey();\n\t}\n\n\tget hotkey_enabled() {\n\t\treturn this._hotkey_enabled;\n\t}\n\n\tset hotkey_enabled(val) {\n\t\tthis._hotkey_enabled = !! val;\n\t\tthis._updateHotkey();\n\t}\n\n\t_updateHotkey() {\n\t\tconst Mousetrap = this.Mousetrap = this.Mousetrap || window.Mousetrap;\n\t\tif ( ! Mousetrap )\n\t\t\treturn;\n\n\t\tconst key = this._hotkey;\n\n\t\tif ( this._bound_key && (this._bound_key !== key || ! this._hotkey_enabled) ) {\n\t\t\tMousetrap.unbind(this._bound_key);\n\t\t\tthis._bound_key = null;\n\t\t}\n\n\t\tif ( ! this._hotkey_enabled )\n\t\t\treturn;\n\n\t\tif ( key && isValidShortcut(key) ) {\n\t\t\tMousetrap.bind(key, this.onShortcut);\n\t\t\tthis._bound_key = key;\n\t\t}\n\t}\n\n\tonShortcut(event: KeyboardEvent) {\n\t\tthis.toggled = ! this.toggled;\n\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Toggled\n\t// ========================================================================\n\n\tget toggled() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._enabled;\n\t\treturn this.provider.get(this.enabled_key, true);\n\t}\n\n\tset toggled(val) {\n\t\tif ( val === this.toggled )\n\t\t\treturn;\n\n\t\tif ( this.ephemeral )\n\t\t\tthis._enabled = val;\n\t\telse\n\t\t\tthis.provider.set(this.enabled_key, val);\n\n\t\tthis.emit('toggled', this, val);\n\t}\n\n\n\t// ========================================================================\n\t// Context\n\t// ========================================================================\n\n\t// wtf is this method context is an array yo\n\t/*\n\tupdateContext(context) {\n\t\tif ( this.id === 0 )\n\t\t\tthrow new Error('cannot set context of default profile');\n\n\t\tthis.context = Object.assign(this.context || {}, context);\n\t\tthis.matcher = null;\n\t\tthis.save();\n\t}*/\n\n\tsetContext(context?: FilterData[]) {\n\t\tif ( this.id === 0 )\n\t\t\tthrow new Error('cannot set context of default profile');\n\n\t\tthis.context = context;\n\t\tthis.clearMatcher();\n\t\tthis.save();\n\t}\n\n\n\t// ========================================================================\n\t// Setting Access\n\t// ========================================================================\n\n\tget<T>(key: string, default_value: T): T;\n\tget<T>(key: string): T | null;\n\n\tget<T>(key: string, default_value?: T): T | null {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage && this._storage.has(key) )\n\t\t\t\treturn this._storage.get(key) as T;\n\n\t\t\treturn default_value ?? null;\n\t\t}\n\n\t\treturn this.provider.get<T>(this.prefix + key, default_value as T);\n\t}\n\n\tset(key: string, value: unknown) {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage )\n\t\t\t\tthis._storage.set(key, value);\n\t\t} else\n\t\t\tthis.provider.set(this.prefix + key, value);\n\n\t\tthis.emit('changed', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage )\n\t\t\t\tthis._storage.delete(key);\n\t\t} else\n\t\t\tthis.provider.delete(this.prefix + key);\n\t\tthis.emit('changed', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? this._storage.has(key): false;\n\t\treturn this.provider.has(this.prefix + key);\n\t}\n\n\tkeys() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? Array.from(this._storage.keys()) : [];\n\n\t\tconst out = [],\n\t\t\tp = this.prefix,\n\t\t\tlen = p.length;\n\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key )\n\t\t\t\tout.push(key.slice(len));\n\n\t\treturn out;\n\t}\n\n\tclear() {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage ) {\n\t\t\t\tconst keys = this.keys();\n\t\t\t\tthis._storage.clear();\n\t\t\t\tfor(const key of keys) {\n\t\t\t\t\tthis.emit('changed', key, undefined, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst p = this.prefix,\n\t\t\tlen = p.length;\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key ) {\n\t\t\t\tthis.provider.delete(key);\n\t\t\t\tthis.emit('changed', key.slice(len), undefined, true);\n\t\t\t}\n\t}\n\n\t*entries() {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage ) {\n\t\t\t\tfor(const entry of this._storage.entries())\n\t\t\t\t\tyield entry;\n\t\t\t}\n\n\t\t} else {\n\t\t\tconst p = this.prefix,\n\t\t\t\tlen = p.length;\n\n\t\t\tfor(const key of this.provider.keys())\n\t\t\t\tif ( key.startsWith(p) && key !== this.enabled_key ) {\n\t\t\t\t\tconst out: [string, unknown] = [key.slice(len), this.provider.get(key)];\n\t\t\t\t\tyield out;\n\t\t\t\t}\n\t\t}\n\t}\n\n\tget size() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? this._storage.size : 0;\n\n\t\tconst p = this.prefix;\n\t\tlet count = 0;\n\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key )\n\t\t\t\tcount++;\n\n\t\treturn count;\n\t}\n}\n","declare global {\n\tlet __extension__: string | undefined;\n}\n\n/** Whether or not FrankerFaceZ was loaded from a development server. */\nexport const DEBUG = localStorage.ffzDebugMode === 'true' && document.body.classList.contains('ffz-dev');\n\n/** Whether or not FrankerFaceZ was loaded as a packed web extension. */\nexport const EXTENSION = !!__extension__;\n\n/** The base URL of the FrankerFaceZ CDN. */\nexport const SERVER = DEBUG ? 'https://localhost:8000' : 'https://cdn2.frankerfacez.com';\n\nlet path = `${SERVER}/script`;\n\nif ( EXTENSION ) {\n\tpath = __webpack_public_path__;\n\tif ( path.endsWith('/') )\n\t\tpath = path.slice(0, path.length - 1);\n}\n\n/** Either the base URL of the FrankerFaceZ CDN or, if FFZ was loaded as a packed web extension, the base URL of the web extension's web accessible files. */\nexport const SERVER_OR_EXT = path;\n\n/** The base URL of the FrankerFaceZ API. */\nexport const API_SERVER = 'https://api.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ staging API. */\nexport const STAGING_API = 'https://api-staging.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ staging CDN. */\nexport const STAGING_CDN = 'https://cdn-staging.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ testing API used for load testing. */\nexport const NEW_API = 'https://api2.frankerfacez.com';\n\n/** The base URL provided to Sentry integrations for automatic error reporting. */\nexport const SENTRY_ID = 'https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2';\n\nexport const WORD_SEPARATORS = '[\\\\s`~<>!-#%-\\\\x2A,-/:;\\\\x3F@\\\\x5B-\\\\x5D_\\\\x7B}\\\\u00A1\\\\u00A7\\\\u00AB\\\\u00B6\\\\u00B7\\\\u00BB\\\\u00BF\\\\u037E\\\\u0387\\\\u055A-\\\\u055F\\\\u0589\\\\u058A\\\\u05BE\\\\u05C0\\\\u05C3\\\\u05C6\\\\u05F3\\\\u05F4\\\\u0609\\\\u060A\\\\u060C\\\\u060D\\\\u061B\\\\u061E\\\\u061F\\\\u066A-\\\\u066D\\\\u06D4\\\\u0700-\\\\u070D\\\\u07F7-\\\\u07F9\\\\u0830-\\\\u083E\\\\u085E\\\\u0964\\\\u0965\\\\u0970\\\\u0AF0\\\\u0DF4\\\\u0E4F\\\\u0E5A\\\\u0E5B\\\\u0F04-\\\\u0F12\\\\u0F14\\\\u0F3A-\\\\u0F3D\\\\u0F85\\\\u0FD0-\\\\u0FD4\\\\u0FD9\\\\u0FDA\\\\u104A-\\\\u104F\\\\u10FB\\\\u1360-\\\\u1368\\\\u1400\\\\u166D\\\\u166E\\\\u169B\\\\u169C\\\\u16EB-\\\\u16ED\\\\u1735\\\\u1736\\\\u17D4-\\\\u17D6\\\\u17D8-\\\\u17DA\\\\u1800-\\\\u180A\\\\u1944\\\\u1945\\\\u1A1E\\\\u1A1F\\\\u1AA0-\\\\u1AA6\\\\u1AA8-\\\\u1AAD\\\\u1B5A-\\\\u1B60\\\\u1BFC-\\\\u1BFF\\\\u1C3B-\\\\u1C3F\\\\u1C7E\\\\u1C7F\\\\u1CC0-\\\\u1CC7\\\\u1CD3\\\\u2010-\\\\u2027\\\\u2030-\\\\u2043\\\\u2045-\\\\u2051\\\\u2053-\\\\u205E\\\\u207D\\\\u207E\\\\u208D\\\\u208E\\\\u2329\\\\u232A\\\\u2768-\\\\u2775\\\\u27C5\\\\u27C6\\\\u27E6-\\\\u27EF\\\\u2983-\\\\u2998\\\\u29D8-\\\\u29DB\\\\u29FC\\\\u29FD\\\\u2CF9-\\\\u2CFC\\\\u2CFE\\\\u2CFF\\\\u2D70\\\\u2E00-\\\\u2E2E\\\\u2E30-\\\\u2E3B\\\\u3001-\\\\u3003\\\\u3008-\\\\u3011\\\\u3014-\\\\u301F\\\\u3030\\\\u303D\\\\u30A0\\\\u30FB\\\\uA4FE\\\\uA4FF\\\\uA60D-\\\\uA60F\\\\uA673\\\\uA67E\\\\uA6F2-\\\\uA6F7\\\\uA874-\\\\uA877\\\\uA8CE\\\\uA8CF\\\\uA8F8-\\\\uA8FA\\\\uA92E\\\\uA92F\\\\uA95F\\\\uA9C1-\\\\uA9CD\\\\uA9DE\\\\uA9DF\\\\uAA5C-\\\\uAA5F\\\\uAADE\\\\uAADF\\\\uAAF0\\\\uAAF1\\\\uABEB\\\\uFD3E\\\\uFD3F\\\\uFE10-\\\\uFE19\\\\uFE30-\\\\uFE52\\\\uFE54-\\\\uFE61\\\\uFE63\\\\uFE68\\\\uFE6A\\\\uFE6B\\\\uFF01-\\\\uFF03\\\\uFF05-\\\\uFF0A\\\\uFF0C-\\\\uFF0F\\\\uFF1A\\\\uFF1B\\\\uFF1F\\\\uFF20\\\\uFF3B-\\\\uFF3D\\\\uFF3F\\\\uFF5B\\\\uFF5D\\\\uFF5F-\\\\uFF65]';\n\n/**\n * A map of default Twitch emotes with non-standard sizes, so they can be displayed\n * more accurately in certain situations.\n */\nexport const WEIRD_EMOTE_SIZES: Record<string, [width: number, height: number]> = {\n\t15: [21,27],\n\t16: [22,27],\n\t17: [20,27],\n\t18: [20,27],\n\t22: [19,27],\n\t25: [25,28],\n\t26: [20,27],\n\t28: [39,27],\n\t30: [29,27],\n\t32: [21,27],\n\t33: [25,32],\n\t34: [21,28],\n\t36: [36,30],\n\t40: [21,27],\n\t41: [19,27],\n\t46: [24,24],\n\t47: [24,24],\n\t50: [18,27],\n\t52: [32,32],\n\t65: [40,30],\n\t66: [20,27],\n\t69: [41,28],\n\t73: [21,30],\n\t74: [24,30],\n\t86: [36,30],\n\t87: [24,30],\n\t92: [23,30],\n\t244: [24,30],\n\t354: [20,30],\n\t357: [28,30],\n\t360: [22,30],\n\t483: [20,18],\n\t484: [20,22],\n\t485: [27,18],\n\t486: [21,32],\n\t487: [15,32],\n\t488: [29,24],\n\t489: [20,18],\n\t490: [20,18],\n\t491: [20,18],\n\t492: [20,18],\n\t493: [20,18],\n\t494: [20,18],\n\t495: [20,18],\n\t496: [20,18],\n\t497: [20,18],\n\t498: [20,18],\n\t499: [20,18],\n\t500: [20,18],\n\t501: [20,18],\n\t1896: [20,30],\n\t1898: [26,28],\n\t1899: [22,30],\n\t1900: [33,30],\n\t1901: [24,28],\n\t1902: [27,29],\n\t1904: [24,30],\n\t1906: [24,30]\n};\n\n/** A list of hotkey combinations that are not valid for one reason or another. */\nexport const BAD_HOTKEYS = [\n\t'f',\n\t'space',\n\t'k',\n\t'shift+up',\n\t'shift+down',\n\t'esc',\n\t'm',\n\t'?',\n\t'alt+t',\n\t'alt+x'\n];\n\n/** A list of setting keys that, when changed, cause chat messages to re-render. */\nexport const RERENDER_SETTINGS = [\n\t'chat.name-format',\n\t'chat.me-style',\n\t'chat.rituals.show',\n\t'chat.subs.show',\n\t'chat.subs.compact',\n\t'chat.actions.inline',\n\t'chat.actions.hover',\n\t'chat.timestamp-format',\n\t'chat.points.allow-highlight',\n\t'chat.filtering.display-deleted',\n\t'chat.filtering.display-mod-action',\n\t'chat.replies.style',\n\t'chat.bits.cheer-notice',\n\t'chat.filtering.hidden-tokens',\n\t'chat.hype.message-style',\n\t'chat.filtering.show-reasons',\n\t'chat.emotes.allow-gigantify',\n\t'chat.shared-chat.username-tooltip',\n\t'chat.shared-chat.style'\n] as const;\n\n/**\n * A list of setting keys that, when changed, cause chat messages to first clear\n * their badge caches and then re-render.\n */\nexport const UPDATE_BADGE_SETTINGS = [\n\t'chat.badges.style',\n\t'chat.badges.hidden',\n\t'chat.badges.custom-mod',\n\t'chat.badges.custom-vip',\n] as const;\n\n/**\n * A list of setting keys that, when changed, cause chat messages to first clear\n * their cached token lists and then re-render.\n */\nexport const UPDATE_TOKEN_SETTINGS = [\n\t'chat.emotes.enabled',\n\t'chat.emotes.2x',\n\t'chat.emotes.animated',\n\t'chat.emoji.style',\n\t'chat.emoji.replace-joiner',\n\t'chat.bits.stack',\n\t'chat.rich.enabled',\n\t'chat.rich.want-mid',\n\t'chat.rich.hide-tokens',\n\t'chat.rich.all-links',\n\t'chat.rich.minimum-level',\n\t'chat.filtering.process-own',\n\t'chat.filtering.mention-priority',\n\t'chat.filtering.debug',\n\t'chat.fix-bad-emotes',\n\t'__filter:highlight-terms',\n\t'__filter:highlight-users',\n\t'__filter:highlight-badges',\n\t'__filter:block-terms',\n\t'__filter:block-users',\n\t'__filter:block-badges'\n] as const;\n\n/**\n * A list of keycodes for specific keys, for use with\n * {@link KeyboardEvent} events.\n */\nexport const KEYS = {\n\tTab: 9,\n\tEnter: 13,\n\tShift: 16,\n\tControl: 17,\n\tAlt: 18,\n\tEscape: 27,\n\tSpace: 32,\n\tPageUp: 33,\n\tPageDown: 34,\n\tEnd: 35,\n\tHome: 36,\n\tArrowLeft: 37,\n\tArrowUp: 38,\n\tArrowRight: 39,\n\tArrowDown: 40,\n\tMeta: 91,\n\tContext: 93\n} as const;\n\n/** The base URL for Twitch emote images. */\nexport const TWITCH_EMOTE_V2 = '//static-cdn.jtvnw.net/emoticons/v2';\n\n/**\n * A map of regex-style Twitch emote codes into normal,\n * human-readable strings for display in UI.\n */\nexport const KNOWN_CODES: Record<string, string> = {\n\t'#-?[\\\\\\\\/]': '#-/',\n\t':-?(?:7|L)': ':-7',\n\t'\\\\&lt\\\\;\\\\]': '<]',\n\t'\\\\:-?(S|s)': ':-S',\n\t'\\\\:-?\\\\\\\\': ':-\\\\',\n\t'\\\\:\\\\&gt\\\\;': ':>',\n\t'B-?\\\\)': 'B-)',\n\t'\\\\:-?[z|Z|\\\\|]': ':-Z',\n\t'\\\\:-?\\\\)': ':-)',\n\t'\\\\:-?\\\\(': ':-(',\n\t'\\\\:-?(p|P)': ':-P',\n\t'\\\\;-?(p|P)': ';-P',\n\t'\\\\&lt\\\\;3': '<3',\n\t'\\\\:-?[\\\\\\\\/]': ':-/',\n\t'\\\\;-?\\\\)': ';-)',\n\t'R-?\\\\)': 'R-)',\n\t'[oO](_|\\\\.)[oO]': 'O.o',\n\t'[o|O](_|\\\\.)[o|O]': 'O.o',\n\t'\\\\:-?D': ':-D',\n\t'\\\\:-?(o|O)': ':-O',\n\t'\\\\&gt\\\\;\\\\(': '>(',\n\t'Gr(a|e)yFace': 'GrayFace'\n};\n\n/** The base URL for replacement images used for specific Twitch emotes. */\nexport const REPLACEMENT_BASE = `${SERVER}/static/replacements/`;\n\n/** A map of specific Twitch emotes that should use replacement images. */\nexport const REPLACEMENTS: Record<string, string> = {\n\t15: '15-JKanStyle.png',\n\t16: '16-OptimizePrime.png',\n\t17: '17-StoneLightning.png',\n\t18: '18-TheRinger.png',\n\t//19: '19-PazPazowitz.png',\n\t//20: '20-EagleEye.png',\n\t//21: '21-CougarHunt.png',\n\t22: '22-RedCoat.png',\n\t26: '26-JonCarnage.png',\n\t//27: '27-PicoMause.png',\n\t30: '30-BCWarrior.png',\n\t33: '33-DansGame.png',\n\t36: '36-PJSalt.png'\n};\n\n/**\n * A map of WebSocket servers for the original FrankerFaceZ socket\n * system. @deprecated\n */\nexport const WS_CLUSTERS = {\n\tProduction: [\n\t\t['wss://catbag.frankerfacez.com/', 0.25],\n\t\t['wss://andknuckles.frankerfacez.com/', 0.8],\n\t\t['wss://tuturu.frankerfacez.com/', 0.7],\n\t\t['wss://lilz.frankerfacez.com/', 1],\n\t\t['wss://yoohoo.frankerfacez.com/', 1],\n\t\t['wss://pog.frankerfacez.com/', 1],\n\t\t['wss://ayaya.frankerfacez.com/', 1],\n\t\t['wss://champ.frankerfacez.com/', 1]\n\t],\n\n\tDevelopment: [\n\t\t['ws://127.0.0.1:7999/', 1]\n\t]\n}\n\n\nexport const LINK_DATA_HOSTS = {\n\t/*socket: {\n\t\ttitle: 'Socket Cluster (Deprecated)',\n\t\tvalue: 'special:socket'\n\t},*/\n\tlocalhost: {\n\t\ttitle: 'Local Dev Server (Port 8002)',\n\t\tvalue: 'https://localhost:8002',\n\t\thas_sse: true\n\t},\n\t'localhost-cf': {\n\t\ttitle: 'Local Dev Worker (Wrangler, Port 8787)',\n\t\tvalue: 'https://localhost:8787'\n\t},\n\t/*test: {\n\t\ttitle: 'API Test Server',\n\t\tvalue: 'https://api-test.frankerfacez.com/v2/link'\n\t},\n\t'test-cf': {\n\t\ttitle: 'Cloudflare Test Worker',\n\t\tvalue: 'https://link-service.workers.frankerfacez.com'\n\t},*/\n\tProduction: {\n\t\ttitle: 'Production',\n\t\tvalue: 'https://link-service.workers.frankerfacez.com'\n\t}\n};\n\n\nexport const PUBSUB_CLUSTERS = {\n\tProduction: `https://pubsub.frankerfacez.com`,\n\tStaging: `https://pubsub-staging-alt.frankerfacez.com`,\n\tEMQXTest: 'emqx-test',\n\tDevelopment: `https://stendec.dev/ps/`\n}\n\nexport const EMQX_SERVERS = [\n\t//'catbag.frankerfacez.com',\n\t//'pubsub-staging.frankerfacez.com',\n\t'biblethump.frankerfacez.com',\n\t/*'ayaya.frankerfacez.com',\n\t'champ.frankerfacez.com',\n\t'lilz.frankerfacez.com',\n\t'pog.frankerfacez.com',\n\t'yoohoo.frankerfacez.com',\n\t'andknuckles.frankerfacez.com'*/\n];\n\n\n/** Whether or not we're running on macOS */\nexport const IS_OSX = navigator.platform ? navigator.platform.indexOf('Mac') !== -1 : /OS X/.test(navigator.userAgent);\n\n/** Whether or not we're running on Windows */\nexport const IS_WIN = navigator.platform ? navigator.platform.indexOf('Win') !== -1 : /Windows/.test(navigator.userAgent);\n\n/** Whether or not we're running on a Webkit-based browser. */\nexport const IS_WEBKIT = navigator.userAgent.indexOf('AppleWebKit/') !== -1 && navigator.userAgent.indexOf('Edge/') === -1;\n\n/** Whether or not we're running on a Firefox-based browser. */\nexport const IS_FIREFOX = (navigator.userAgent.indexOf('Firefox/') !== -1);\n\n/**\n * A -webkit- CSS prefix, if we're running on a Webkit-based browser.\n * Hopefully we don't need this anymore.\n * @deprecated\n */\nexport const WEBKIT_CSS = IS_WEBKIT ? '-webkit-' : '';\n\n/** A list of Twitch emote sets that are globally available. */\nexport const TWITCH_GLOBAL_SETS = [0, 33, 42] as const;\n\n/** A list of Twitch emote sets that are for emotes unlocked with channel points. */\nexport const TWITCH_POINTS_SETS = [300238151] as const;\n\n/** A list of Twitch emote sets that are for Twitch Prime subscribers. */\nexport const TWITCH_PRIME_SETS = [457, 793, 19151, 19194] as const;\n\n/** An enum of all possible Twitch emote types. */\nexport enum EmoteTypes {\n\t/** What kind of weird emote are you dragging in here */\n\tUnknown,\n\t/** Emotes unlocked via Twitch Prime */\n\tPrime,\n\t/** Emotes unlocked via Twitch Turbo */\n\tTurbo,\n\t/** Emotes unlocked via arbitrary condition, permanently available. */\n\tLimitedTime,\n\t/** Emotes unlocked via channel points. */\n\tChannelPoints,\n\t/** Emote no longer available. */\n\tUnavailable,\n\t/** Emote unlocked via subscription to channel. */\n\tSubscription,\n\t/** Emote permanently unlocked via cheering in channel. */\n\tBitsTier,\n\t/** Globally available emote. */\n\tGlobal,\n\t/** Emote unlocked via enabling two-factor authentication. */\n\tTwoFactor,\n\t/** Emote unlocked via following a channel. */\n\tFollower\n};\n\n\nexport const RESOLVERS_REQUIRE_TOS = {\n\t'YouTube': {\n\t\tlabel: 'You must agree to the YouTube Terms of Service to view this embed.',\n\t\ti18n_key: 'embed.warn.youtube',\n\n\t\ti18n_links: 'embed.warn.youtube.links',\n\t\tlinks: `To view YouTube embeds, you must agree to YouTube's Terms of Service:\n* [Terms of Service](https://www.youtube.com/t/terms)\n* [Privacy Policy](https://policies.google.com/privacy)`,\n\n\t\ti18n_accept: 'embed.warn.youtube.agree',\n\t\taccept: 'Yes, I accept the YouTube Terms of Service.'\n\t},\n\n} as Record<string, any>;\n","// ============================================================================\n// EventEmitter\n// Homegrown for that lean feeling.\n// ============================================================================\n\n/**\n * A special value that, when returned from an event listener, will cause the\n * listener to be removed and no longer receive events.\n */\nexport const Detach = Symbol('Detach');\n\n/**\n * A special value that, when returned from an event listener, will stop\n * iteration and prevent any additional event listeners from receiving the\n * event themselves.\n */\nexport const StopPropagation = Symbol('StopPropagation');\n\ndeclare global {\n\tinterface String {\n\t\ttoSlug(separator: string): string;\n\t\ttoSnakeCase(): string;\n\t}\n}\n\nconst SNAKE_CAPS = /([a-z])([A-Z])/g,\n\tSNAKE_SPACE = /[ \\t\\W]/g,\n\tSNAKE_TRIM = /^_+|_+$/g;\n\nString.prototype.toSlug = function(this: string, separator: string = '-') {\n\tlet result = this;\n\tif (result.normalize)\n\t\tresult = result.normalize('NFD');\n\n\treturn result\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.trim()\n\t\t.toLowerCase()\n\t\t.replace(/[^a-z0-9 ]/g, '')\n\t\t.replace(/\\s+/g, separator);\n}\n\nString.prototype.toSnakeCase = function(this: string) {\n\tlet result = this;\n\tif (result.normalize)\n\t\tresult = result.normalize('NFD');\n\n\treturn result\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.trim()\n\t\t.replace(SNAKE_CAPS, '$1_$2')\n\t\t.replace(SNAKE_SPACE, '_')\n\t\t.replace(SNAKE_TRIM, '')\n\t\t.toLowerCase();\n}\n\n\nexport type ListenerReturnType = void | typeof Detach | typeof StopPropagation | Promise<void>;\n\nexport type EventListener<TArgs extends any[] = any[]> = (...args: TArgs) => ListenerReturnType;\n\nexport type ListenerInfo<TArgs extends any[] = any[]> = [\n\tlistener: EventListener<TArgs>,\n\tcontext: any,\n\tttl: number | false,\n\tpriority: number,\n\tprepend: boolean\n];\n\nexport interface EventMap {\n\t[event: string]: any[];\n};\n\nexport type EventKey<TEvent extends EventMap> = string & keyof TEvent;\n\nexport type AddEventKeyNamespace<\n\tTNamespace extends string,\n\tTKey extends string\n> = TKey extends `:${infer Rest}`\n\t? `${TNamespace}${TKey}`\n\t: TKey;\n\nexport type RemoveEventKeyNamespace<\n\tTNamespace extends string,\n\tTKey extends string\n> = TKey extends `${TNamespace}:${infer Rest}`\n\t? `:${Rest}`\n\t: TKey;\n\n\nexport type NamespacedEvents<TNamespace extends string, TEventMap extends EventMap> = {\n\t[K in keyof TEventMap & string as AddEventKeyNamespace<TNamespace, K>]: TEventMap[K]\n};\n\nexport type NamespacedEventKey<TNamespace extends string, TEventMap extends EventMap> =\n\tstring & keyof TEventMap | RemoveEventKeyNamespace<TNamespace, string & keyof TEventMap>;\n\n\nexport type NamespacedEventArgs<\n\tTKey extends string,\n\tTNamespace extends string,\n\tTEventMap extends EventMap\n> = TKey extends keyof TEventMap\n\t? TEventMap[TKey]\n\t: AddEventKeyNamespace<TNamespace, TKey> extends keyof TEventMap\n\t\t? TEventMap[AddEventKeyNamespace<TNamespace, TKey>]\n\t\t: never;\n\n\n/**\n * A custom event emitter implementation with support for priorities,\n * event listeners that only receive a certain number of events,\n * event listeners that can remove themselves by returning a special\n * symbol, and other useful behaviors.\n *\n * You'll likely not be using this class directly, instead relying\n * on {@link Module}s directly. Modules are subclasses of\n * {@link HierarchicalEventEmitter} which itself is a subclass of\n * this {@link EventEmitter}.\n */\nexport class EventEmitter<\n\tTEventMap extends EventMap = {},\n\tTNamespace extends string = ''\n> {\n\n\tstatic Detach = Detach;\n\tstatic StopPropagation = StopPropagation;\n\n\t/** @private */\n\tprotected __listeners: Record<string, ListenerInfo[] | null>;\n\tprotected __running: Set<string>;\n\tprivate __dead_events: number;\n\n\tconstructor() {\n\t\tthis.__listeners = {};\n\t\tthis.__running = new Set;\n\t\tthis.__dead_events = 0;\n\t}\n\n\tprotected __cleanListeners() {\n\t\tif ( ! this.__dead_events )\n\t\t\treturn [];\n\n\t\tconst new_listeners: Record<string, ListenerInfo[]> = {},\n\t\t\told_listeners = this.__listeners,\n\t\t\tremoved: string[] = [];\n\n\t\tfor(const [key, val] of Object.entries(old_listeners)) {\n\t\t\tif ( val?.length )\n\t\t\t\tnew_listeners[key] = val;\n\t\t\telse\n\t\t\t\tremoved.push(key);\n\t\t}\n\n\t\tthis.__listeners = new_listeners;\n\t\tthis.__dead_events = 0;\n\t\treturn removed;\n\t}\n\n\tprivate __sortListeners(event: string) {\n\t\t// Don't bother sorting while an event is running, since\n\t\t// we'll need to sort it at the end when the lists are\n\t\t// recombined.\n\t\tif ( this.__running.has(event) )\n\t\t\treturn;\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list )\n\t\t\tlist.sort((a, b) => a[3] - b[3]);\n\t}\n\n\n\t/**\n\t * Transfer all the event listeners from this EventEmitter to another\n\t * EventEmitter instance, removing them from this EventEmitter in\n\t * the process.\n\t *\n\t * @param other The EventEmitter to transfer our listeners to.\n\t */\n\ttransferListeners(other: EventEmitter<TEventMap, TNamespace>) {\n\t\tif ( !(other instanceof EventEmitter) )\n\t\t\tthrow new Error('other must also be EventEmitter');\n\n\t\t// If the existing listener has no live topics, we can just go ahead\n\t\t// and copy the listeners object directly.\n\t\tconst live_topics = other.events().length + other.__running.size;\n\t\tif ( ! live_topics ) {\n\t\t\tother.__listeners = this.__listeners;\n\t\t\tother.__dead_events = this.__dead_events;\n\t\t\tthis.__listeners = {};\n\t\t\tthis.__dead_events = 0;\n\t\t\treturn;\n\t\t}\n\n\t\t// Unfortuantely, since we got here, we'll need to do things the\n\t\t// old fashioned way.\n\t\tfor(const [key, val] of Object.entries(this.__listeners)) {\n\t\t\tif ( ! val || ! val.length )\n\t\t\t\tcontinue;\n\n\t\t\tlet other_val = other.__listeners[key];\n\t\t\tif ( Array.isArray(other_val) ) {\n\t\t\t\tother_val.push(...val);\n\t\t\t\tother.__sortListeners(key);\n\n\t\t\t} else\n\t\t\t\tother.__listeners[key] = val;\n\t\t}\n\n\t\t// Reset our state before we leave.\n\t\tthis.__listeners = {};\n\t\tthis.__dead_events = 0;\n\t}\n\n\n\t// ========================================================================\n\t// Public Methods\n\t// ========================================================================\n\n\t/**\n\t * Create a new {@link FFZEvent} instance. This is a convenience method that\n\t * wraps {@link FFZEvent.makeEvent}\n\t */\n\tmakeEvent<TData extends Record<string, any> = {}>(data: TData): TypedFFZEvent<TData> {\n\t\treturn FFZEvent.makeEvent(data);\n\t}\n\n\t/**\n\t * Create a new {@link FFZWaitableEvent} instance. This is a convenience\n\t * method that wraps {@link FFZWaitableEvent.makeEvent}\n\t */\n\tmakeWaitableEvent<TData extends Record<string, any> = {}, TReturn = void>(data: TData): TypedFFZWaitableEvent<TData, TReturn> {\n\t\treturn FFZWaitableEvent.makeEvent(data);\n\t}\n\n\t/**\n\t * Register an event listener for a given event.\n\t *\n\t * @param event The event to listen for.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\ton<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tif ( typeof fn !== 'function' )\n\t\t\tthrow new TypeError('fn must be a function');\n\n\t\tconst info: ListenerInfo = [\n\t\t\tfn as EventListener,\n\t\t\tctx,\n\t\t\tfalse,\n\t\t\tpriority ?? 0,\n\t\t\tprepend\n\t\t];\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list ) {\n\t\t\tif ( prepend )\n\t\t\t\tlist.unshift(info);\n\t\t\telse\n\t\t\t\tlist.push(info);\n\t\t\tthis.__sortListeners(event);\n\t\t} else\n\t\t\tthis.__listeners[event] = [info];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Register an event listener for a given event that will only fire\n\t * once before being automatically removed.\n\t *\n\t * @see {@link many}\n\t *\n\t * @param event The event to listen for.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\tonce<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn this.many(event, 1, fn, ctx, priority, prepend);\n\t}\n\n\t/**\n\t * Register an event listener for a given event that will only fire\n\t * a specific number of times before being automatically removed.\n\t *\n\t * @param event The event to listen for.\n\t * @param ttl The number of times the listener should fire.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\tmany<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tif ( typeof fn !== 'function' )\n\t\t\tthrow new TypeError('fn must be a function');\n\n\t\tif ( typeof ttl !== 'number' || isNaN(ttl) || ! isFinite(ttl) || ttl < 1 )\n\t\t\tthrow new TypeError('ttl must be a positive, finite number');\n\n\t\tconst info: ListenerInfo = [\n\t\t\tfn as EventListener,\n\t\t\tctx,\n\t\t\tttl,\n\t\t\tpriority ?? 0,\n\t\t\tprepend\n\t\t];\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list ) {\n\t\t\tif ( prepend )\n\t\t\t\tlist.unshift(info);\n\t\t\telse\n\t\t\t\tlist.push(info);\n\t\t\tthis.__sortListeners(event);\n\t\t} else\n\t\t\tthis.__listeners[event] = [info];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Wait for the given event to fire and return its value.\n\t *\n\t * Internally, this works by registering a temporary event listener\n\t * with a `ttl` of `1` that, when called, calls the `resolve` method\n\t * of the promise returned by this function.\n\t *\n\t * @param event The event to listen for.\n\t * @param ctx A context (aka `this`) to associate this with. While the\n\t * context is not used for calling any functions, it's used to track the\n\t * source of this event listener so that it can be removed easily by\n\t * context if necessary.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t * @returns A {@link Promise} that resolves with the first event of\n\t * this type to fire.\n\t */\n\twaitFor<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn new Promise<NamespacedEventArgs<K, TNamespace, TEventMap>>(resolve => {\n\t\t\tconst info: ListenerInfo = [\n\t\t\t\t((...args: NamespacedEventArgs<K, TNamespace, TEventMap>) => resolve(args)) as EventListener,\n\t\t\t\tctx,\n\t\t\t\t1,\n\t\t\t\tpriority ?? 0,\n\t\t\t\tprepend\n\t\t\t];\n\n\t\t\tconst list = this.__listeners[event];\n\t\t\tif ( list ) {\n\t\t\t\tif ( prepend )\n\t\t\t\t\tlist.unshift(info);\n\t\t\t\telse\n\t\t\t\t\tlist.push(info);\n\t\t\t\tthis.__sortListeners(event);\n\t\t\t} else\n\t\t\t\tthis.__listeners[event] = [info];\n\t\t});\n\t}\n\n\t/**\n\t * Remove one or more event listeners, across one or more events.\n\t * You must provide at least one of `event`, `fn`, and `ctx`. All\n\t * event listeners that match your provided criteria will be removed.\n\t *\n\t * This can be used to remove all event listeners for a given event\n\t * or to remove all event listeners registered by a given context,\n\t * in addition to the obvious ability to remove a specific\n\t * event listener.\n\t *\n\t * @param event Optional. The event to remove listener(s) of.\n\t * @param fn Optional. The event listener function to remove.\n\t * @param ctx Optional. The context to remove listeners of.\n\t */\n\toff<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent?: K,\n\t\tfn?: EventListener,\n\t\tctx?: any\n\t) {\n\t\tif ( event == null ) {\n\t\t\tif ( ! fn && ! ctx )\n\t\t\t\tthrow new Error('you must provide at least one constraint when removing listeners');\n\n\t\t\tfor(const evt in Object.keys(this.__listeners)) {\n\t\t\t\tif ( ! this.__running.has(evt) )\n\t\t\t\t\tthis.off(evt as any, fn, ctx);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif ( this.__running.has(event) )\n\t\t\tthrow new Error(`concurrent modification: tried removing event listener while event is running`);\n\n\t\tlet list = this.__listeners[event];\n\t\tif ( ! list )\n\t\t\treturn this;\n\n\t\t// If fn and ctx were both not provided, then clear the list.\n\t\tif ( ! fn && ! ctx )\n\t\t\tlist = null;\n\t\telse {\n\t\t\t// Remove any entries from the list where:\n\t\t\t// 1. fn and ctx both match if both were provided\n\t\t\t// 2. fn matches if only fn was provided\n\t\t\t// 3. ctx matches if only ctx was provided\n\t\t\tlist = list.filter(([f, c]) => !((! fn || f === fn) && (!ctx || ctx === c)));\n\t\t\tif ( ! list.length )\n\t\t\t\tlist = null;\n\t\t}\n\n\t\tthis.__listeners[event] = list;\n\n\t\t// We don't use delete since that triggers performance issues\n\t\t// when used on objects. Instead, we record that we have a\n\t\t// dead event so we can clean it up later.\n\t\tif ( ! list )\n\t\t\tthis.__dead_events++;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Remove all event listeners registered by a specific context.\n\t * This can now be handled by calling {@link off} directly and\n\t * it should be avoided.\n\t * @deprecated\n\t */\n\toffContext<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K, ctx?: any) {\n\t\treturn this.off(event, undefined, ctx);\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t */\n\tevents() {\n\t\tthis.__cleanListeners();\n\t\treturn Object.keys(this.__listeners);\n\t}\n\n\t/**\n\t * Return a list of all listeners for a given event. This\n\t * includes metadata including the listener's `ttl`.\n\t * @param event\n\t * @returns\n\t */\n\tlisteners<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K)\n\t: ListenerInfo<NamespacedEventArgs<K, TNamespace, TEventMap>> {\n\t\tconst list = this.__listeners[event];\n\t\treturn list ? Array.from(list) as any : [];\n\t}\n\n\t/**\n\t * Determine whether there are currently any listeners for\n\t * the specified event. */\n\thasListeners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn !! this.__listeners[event]\n\t}\n\n\t/**\n\t * Emit an event to all its listeners.\n\t *\n\t * This will call each listener of an event in order, and it handles\n\t * event listener lifetimes with `ttl` and `Detach`. It also supports\n\t * the `StopPropagation` return value or, if the event data is an\n\t * instance of {@link FFZEvent}, the {@link FFZEvent.propagationStopped}\n\t * property.\n\t *\n\t * If the event data is an instance of {@link FFZWaitableEvent} and\n\t * the event listener returns a {@link Promise}, that {@link Promise}\n\t * will automatically be waited for with {@link FFZWaitableEvent.waitFor}.\n\t *\n\t * @param event The event to emit.\n\t * @param data The data for the event. This will vary depending on\n\t * the event being emitted.\n\t */\n\temit<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\t...data: NamespacedEventArgs<K, TNamespace, TEventMap>\n\t) {\n\t\tlet list = this.__listeners[event];\n\t\tif ( ! list )\n\t\t\treturn;\n\n\t\tif ( this.__running.has(event) )\n\t\t\tthrow new Error(`concurrent access: tried to emit event while event is running`);\n\n\t\t// Track removals separately to make iteration over the event list\n\t\t// much, much simpler.\n\t\tconst removed = new Set<ListenerInfo>;\n\n\t\t// Set the current list of listeners to null because we don't want\n\t\t// to enter some kind of loop if a new listener is added as the result\n\t\t// of an existing listener.\n\t\tthis.__listeners[event] = null;\n\t\tthis.__running.add(event);\n\n\t\tfor(const item of list) {\n\t\t\tconst [fn, ctx, ttl] = item;\n\t\t\tlet ret: ListenerReturnType = undefined;\n\t\t\ttry {\n\t\t\t\tret = fn.apply(ctx, data);\n\t\t\t} catch(err) {\n\t\t\t\t// Abusing as any so we can have log as a getter/setter\n\t\t\t\t// on Module without complaint.\n\t\t\t\tif ( (this as any).log ) {\n\t\t\t\t\t(this as any).log.capture(err, {tags: {event}, extra:{args: data}});\n\t\t\t\t\t(this as any).log.error(err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ret === Detach )\n\t\t\t\tremoved.add(item);\n\t\t\telse if ( ttl !== false ) {\n\t\t\t\tif ( ttl <= 1 )\n\t\t\t\t\tremoved.add(item);\n\t\t\t\telse\n\t\t\t\t\titem[2] = ttl - 1;\n\t\t\t}\n\n\t\t\t// Automatically wait for a promise, if the return value is a promise\n\t\t\t// and we're dealing with a waitable event.\n\t\t\tif ( ret instanceof Promise ) {\n\t\t\t\tif ( (data[0] instanceof FFZWaitableEvent) )\n\t\t\t\t\tdata[0].waitFor(ret);\n\t\t\t}\n\n\t\t\tif ( (data[0] instanceof FFZEvent && data[0].propagationStopped) || ret === StopPropagation )\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Remove any dead listeners from the list.\n\t\tif ( removed.size ) {\n\t\t\tfor(const item of removed) {\n\t\t\t\tconst idx = list.indexOf(item);\n\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\tlist.splice(idx, 1);\n\t\t\t}\n\t\t}\n\n\t\tlet need_sort = false;\n\n\t\t// Were more listeners added while we were running? Just combine\n\t\t// the two lists if so.\n\t\tconst new_items = this.__listeners[event];\n\t\tif ( new_items ) {\n\t\t\tlist = list.concat(new_items);\n\t\t\tneed_sort = true;\n\t\t}\n\n\t\t// If we have items, store the list back. Otherwise, mark that we\n\t\t// have a dead listener.\n\t\tif ( list.length )\n\t\t\tthis.__listeners[event] = list;\n\t\telse {\n\t\t\tthis.__listeners[event] = null;\n\t\t\tthis.__dead_events++;\n\t\t}\n\n\t\tthis.__running.delete(event);\n\n\t\t// Finally, now that running is off, sort our listeners if we\n\t\t// have need.\n\t\tif ( need_sort )\n\t\t\tthis.__sortListeners(event);\n\t}\n\n}\n\n\n/**\n * FFZEvent is a convenience class for use when emitting events when you would\n * like to potentially receive feedback from event listeners. The event\n * object may be changed by event listeners, with the emitter checking the\n * event object for changes once the event is done.\n *\n * This also includes support for the standard {@link Event} interfaces of\n * {@link stopPropagation} and {@link preventDefault}.\n *\n * @param TData The custom data type the event should be constructed with.\n */\nexport class FFZEvent<TData> {\n\n\t/**\n\t * Create a new {@link FFZEvent} with proper type inheritence from the\n\t * supplied data. This should always be used to construct an event\n\t * instance, rather than creating the event manually.\n\t */\n\tstatic makeEvent<TData extends Record<string, any> = {}>(data: TData): TypedFFZEvent<TData> {\n\t\treturn new FFZEvent(data) as TypedFFZEvent<TData>;\n\t}\n\n\t/** Whether or not {@link preventDefault} has been called. */\n\tdefaultPrevented: boolean;\n\t/** Whether or not {@link stopPropagation} has been called. */\n\tpropagationStopped: boolean;\n\n\t/** Create a new FFZEvent instance with the provided data. */\n\tconstructor(data: TData) {\n\t\tthis.defaultPrevented = false;\n\t\tthis.propagationStopped = false;\n\n\t\tObject.assign(this, data);\n\t}\n\n\t/**\n\t * Intended for emitter use only.\n\t *\n\t * Reset this FFZEvent instance. This does not reset custom data,\n\t * but only returns {@link defaultPrevented} and {@link propagationStopped}\n\t * to their original values.\n\t *\n\t * Subclasses of FFZEvent may override this method to extend\n\t * its behavior.\n\t */\n\t_reset() {\n\t\tthis.defaultPrevented = false;\n\t\tthis.propagationStopped = false;\n\t}\n\n\t/**\n\t * Stop the propagation of this event, ensuring that no further\n\t * event listeners receive it.\n\t */\n\tstopPropagation() {\n\t\tthis.propagationStopped = true;\n\t}\n\n\t/**\n\t * Prevent whatever default behavior is associated with this event.\n\t */\n\tpreventDefault() {\n\t\tthis.defaultPrevented = true;\n\t}\n}\n\n/**\n * TypedFFZEvent is a convenience type returned by {@link FFZEvent.makeEvent}\n * so that custom data passed to the event can be accessed in a\n * type safe way.\n */\nexport type TypedFFZEvent<TData> = FFZEvent<TData> & {\n\t[K in keyof TData]: TData[K];\n}\n\n/**\n * TypedFFZWaitableEvent is a convenience type returned by {@link FFZWaitableEvent.makeEvent}\n * so that custom data passed to the event can be accessed in a\n * type safe way.\n */\nexport type TypedFFZWaitableEvent<TData, TReturn = void> = FFZWaitableEvent<TData, TReturn> & {\n\t[K in keyof TData]: TData[K];\n}\n\n/**\n * FFZWaitableEvent is a subclass of FFZEvent that adds a system for supporting\n * asynchronous return values.\n *\n * Event listeners may return a {@link Promise} or call {@link waitFor} directly\n * to register their promises, and the emitter is then responsible for calling\n * the {@link _wait} method after the event has been emitted.\n *\n * @param TData The custom data type the event should be constructed with.\n * @param TReturn The expected return type of {@link Promise}s used with\n * {@link waitFor} or by listeners returning {@link Promise}s.\n */\nexport class FFZWaitableEvent<TData, TReturn = void> extends FFZEvent<TData> {\n\n\t/**\n\t * Create a new {@link FFZWaitableEvent} with proper type inheritence from the\n\t * supplied data. This should always be used to construct an event\n\t * instance, rather than creating the event manually.\n\t */\n\tstatic makeEvent<TData extends Record<string, any> = {}, TReturn = void>(data: TData): TypedFFZWaitableEvent<TData, TReturn> {\n\t\treturn new FFZWaitableEvent<TData, TReturn>(data) as TypedFFZWaitableEvent<TData, TReturn>;\n\t}\n\n\tprivate __waiter?: Promise<Awaited<TReturn>[]> | null;\n\tprivate __waiter_results: Awaited<TReturn>[] | null = null;\n\tprivate __promises?: Promise<TReturn>[] | null;\n\n\t/**\n\t * Intended for emitter use only.\n\t *\n\t * Wait for all registered {@link Promise}s to return.\n\t *\n\t * @returns\n\t */\n\t_wait(): Promise<Awaited<TReturn>[]> | null {\n\t\t// If we're already waiting, keep on waiting.\n\t\tif ( this.__waiter )\n\t\t\treturn this.__waiter;\n\n\t\t// If we have no promises, just return\n\t\t// any pending results.\n\t\tif ( ! this.__promises ) {\n\t\t\tconst out = this.__waiter_results;\n\t\t\tthis.__waiter_results = null;\n\n\t\t\t// Make sure to return the results as a promise.\n\t\t\treturn out ? Promise.resolve(out) : null;\n\t\t}\n\n\t\t// We had promises, so we need to wait some more.\n\t\tconst promises = this.__promises;\n\t\tthis.__promises = null;\n\n\t\treturn this.__waiter = Promise.all(promises).then(results => {\n\t\t\t// Store the results for later return.\n\t\t\tif ( this.__waiter_results )\n\t\t\t\tthis.__waiter_results.push(...results);\n\t\t\telse\n\t\t\t\tthis.__waiter_results = results;\n\n\t\t\t// Now call _wait() again.\n\t\t\tthis.__waiter = null;\n\t\t\treturn this._wait() ?? [];\n\n\t\t}).catch(err => {\n\t\t\t// But if there was an error, oh no.\n\t\t\tthis.__waiter = null;\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\t/**\n\t * Reset the FFZWaitableEvent instance. In addition to calling\n\t * the super method {@link FFZEvent._reset}, this also clears\n\t * the Promise-related data stored on the event.\n\t */\n\t_reset() {\n\t\tsuper._reset();\n\t\tthis.__waiter = null;\n\t\tthis.__waiter_results = null;\n\t\tthis.__promises = null;\n\t}\n\n\t/**\n\t * Wait for a {@link Promise} to complete before considering the event\n\t * as completed.\n\t *\n\t * Event listeners should either call this method with their Promise\n\t * if performing asynchronous work, or else return the Promise directly\n\t * from their event listener.\n\t *\n\t * @param promise The Promise to wait for.\n\t */\n\twaitFor(promise: Promise<TReturn>) {\n\t\tif ( ! this.__promises )\n\t\t\tthis.__promises = [promise];\n\t\telse\n\t\t\tthis.__promises.push(promise);\n\t}\n\n}\n\n\n/**\n * HierarchicalEventEmitter is a subclass of {@link EventEmitter} that allows\n * you to create a tree of event emitters that all share the same pool of\n * event listeners.\n *\n * This is useful because the event emitter can then emit events using\n * a simplified name while other emitters can listen to that event using\n * its full name.\n *\n * For example, an emitter with the path `chat.emotes` could call {@link emit}\n * with the event key `:update-default-sets` while other emitters would then\n * have access to listen to that event with the full key\n * `chat.emotes:update-default-sets`.\n *\n * This behavior powers the {@link Module} system.\n */\nexport class HierarchicalEventEmitter<\n\tTNamespace extends string,\n\tTEventMap extends EventMap = {}\n> extends EventEmitter<TEventMap, TNamespace> {\n\t/** The local name of this event emitter, not including the names of its parents. */\n\tname: string;\n\n\t/** @private */\n\tprotected __path?: string;\n\tprivate __path_parts: string[];\n\n\t/** The parent of this event emitter, if it has one. */\n\tparent?: HierarchicalEventEmitter<any, any>;\n\t/** The root event emitter. */\n\troot: HierarchicalEventEmitter<any, any>;\n\n\tconstructor(name?: string, parent?: HierarchicalEventEmitter<any, any>) {\n\t\tsuper();\n\n\t\tthis.name = name || (this.constructor.name || '').toSnakeCase();\n\t\tthis.parent = parent;\n\n\t\tif ( parent ) {\n\t\t\tthis.root = parent.root;\n\t\t\tthis.__listeners = parent.__listeners;\n\t\t\tthis.__running = parent.__running;\n\t\t\tthis.__path = name && parent.__path ? `${parent.__path}.${name}` : name;\n\n\t\t} else {\n\t\t\tthis.root = this as any;\n\t\t\tthis.__path = undefined;\n\t\t}\n\n\t\tthis.__path_parts = this.__path ? this.__path.split('.') : [];\n\t}\n\n\n\t// ========================================================================\n\t// Public Properties\n\t// ========================================================================\n\n\t/**\n\t * The full path of this event emitter, including not just its own name\n\t * but its ancestors' names as well, separated by periods.\n\t */\n\tget path(): TNamespace {\n\t\treturn this.__path as TNamespace;\n\t}\n\n\n\t// ========================================================================\n\t// Public Methods\n\t// ========================================================================\n\n\ttransferListeners(other: EventEmitter<TEventMap, TNamespace>): void {\n\t\tif ( other instanceof HierarchicalEventEmitter && other.root === this.root )\n\t\t\treturn;\n\n\t\tthrow new Error('Transfering listeners from a HierarchicalEventEmitter is not supported.');\n\t}\n\n\t/**\n\t * Take an event path and convert it to an absolute path. For example,\n\t * if this emitter's path is `chat.emotes` and you call this with the\n\t * path `:update-default-sets` it will return `chat.emotes:update-default-sets`.\n\t *\n\t * You can also traverse to specific parents by using periods (`.`) at the\n\t * start of the path. A single period (`.`) is equal to the current emitter's\n\t * path, while each additional period moves up by one ancestor. For example,\n\t * to get this emitter's parent, you could use `..`. This can be combined\n\t * with other strings to access siblings, as well as events on ancestors\n\t * or siblings.\n\t *\n\t * For example, if this emitter's path is `chat.emotes` and you call this\n\t * with the path `..:update-line-tokens` it will return `chat:update-line-tokens`.\n\t *\n\t * As another example, assuming the same emitter path and you call this with\n\t * the path `..emoji:populated` it will return `chat.emoji:populated`.\n\t *\n\t * @param path The path to resolve.\n\t * @returns The resolved path.\n\t */\n\tabs_path(path: string): string {\n\t\tif ( typeof path !== 'string' || ! path.length )\n\t\t\tthrow new TypeError('path must be a non-empty string');\n\n\t\tlet i = 0, chr;\n\t\tconst parts = this.__path_parts,\n\t\t\tdepth = parts.length;\n\n\t\tdo {\n\t\t\tchr = path.charAt(i);\n\t\t\tif ( path.charAt(i) === '.' ) {\n\t\t\t\tif ( i > depth )\n\t\t\t\t\tthrow new Error('invalid path: reached top of stack');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbreak;\n\t\t} while ( ++i < path.length );\n\n\t\tconst event = chr === ':';\n\t\tif ( i === 0 )\n\t\t\treturn event && this.__path ? `${this.__path}${path}` : path;\n\n\t\tconst prefix = parts.slice(0, depth - (i-1)).join('.'),\n\t\t\tremain = path.slice(i);\n\n\t\tif ( ! prefix.length )\n\t\t\treturn remain;\n\n\t\telse if ( ! remain.length )\n\t\t\treturn prefix;\n\n\t\telse if ( event )\n\t\t\treturn prefix + remain;\n\n\t\treturn `${prefix}.${remain}`;\n\t}\n\n\ton<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.on(this.abs_path(event) as K, fn, ctx, priority, prepend);\n\t}\n\n\tonce<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.once(this.abs_path(event) as K, fn, ctx, priority, prepend);\n\t}\n\n\tmany<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.many(this.abs_path(event) as K, ttl, fn, ctx, priority, prepend);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.waitFor<K>(this.abs_path(event) as K, ctx, priority, prepend);\n\t}\n\n\toff<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent?: K, fn?: EventListener, ctx?: any\n\t) {\n\t\treturn super.off(event && this.abs_path(event) as K, fn, ctx);\n\t}\n\n\tlisteners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn super.listeners(this.abs_path(event) as K);\n\t}\n\n\thasListeners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn super.hasListeners(this.abs_path(event) as K);\n\t}\n\n\temit<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\t...args: NamespacedEventArgs<K, TNamespace, TEventMap>\n\t) {\n\t\treturn super.emit(this.abs_path(event) as K, ...args);\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t * This will only return events owned by this emitter, or by\n\t * descendents of this emitter.\n\t */\n\teventsWithChildren() {\n\t\tconst keys = super.events(),\n\t\t\tpath = this.__path || '',\n\t\t\tlen = path.length;\n\n\t\treturn keys.filter(x => {\n\t\t\tconst y = x.charAt(len);\n\t\t\treturn x.startsWith(path) && (y === '' || y === '.' || y === ':');\n\t\t});\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t * This will not return any events owned by other emitters.\n\t */\n\tevents() {\n\t\tconst keys = super.events(),\n\t\t\tpath = this.__path || '',\n\t\t\tlen = path.length;\n\n\t\treturn keys.filter(x => {\n\t\t\tconst y = x.charAt(len);\n\t\t\treturn x.startsWith(path) && (y === '' || y === ':');\n\t\t});\n\t}\n}\n\nexport default HierarchicalEventEmitter;\n","'use strict';\n\nimport type { OptionalPromise, OptionallyCallable } from \"./types\";\n\n// ============================================================================\n// Advanced Filter System\n// ============================================================================\n\ntype FilterMethod<TContext = unknown> = (ctx: TContext) => boolean;\n\nexport type FilterType<TConfig, TContext> = {\n\tcreateTest: (config: TConfig, filter_types: FilterTypeMap<TContext>, rebuild?: () => void) => FilterMethod<TContext>\n\n\tdefault: OptionallyCallable<[], TConfig>;\n\n\t// Editor Configuration\n\teditor?: OptionallyCallable<[], OptionalPromise<any>>;\n\n\ttitle: string;\n\ti18n?: string | null;\n\ttall?: boolean;\n\n\tmaxRules?: number;\n\tchildRules?: boolean;\n\n\n}\n\ntype FilterTypeMap<TContext> = {\n\t[key: string]: FilterType<any, TContext>;\n};\n\n\nexport type FilterData = {\n\tid?: string;\n\ttype: string;\n\tdata: any;\n}\n\n\nexport function createTester<TContext, Types extends FilterTypeMap<TContext>>(\n\trules: FilterData[] | null | undefined,\n\tfilter_types: Types,\n\tinverted: boolean = false,\n\tor: boolean = false,\n\trebuild?: () => void\n): (ctx: TContext) => boolean {\n\n\tif ( ! Array.isArray(rules) || ! filter_types )\n\t\treturn inverted ? () => false : () => true;\n\n\tconst tests: FilterMethod<TContext>[] = [],\n\t\tnames = [];\n\n\tlet i = 0;\n\tfor(const rule of rules) {\n\t\tif ( ! rule || ! rule.type )\n\t\t\tcontinue;\n\n\t\tconst type = filter_types[rule.type];\n\t\tif ( ! type ) {\n\t\t\t// Default to false if we cannot find a rule type.\n\t\t\t// Just to be safe.\n\t\t\ti++;\n\t\t\ttests.push(() => false);\n\t\t\tnames.push(`f${i}`);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Construct the test. If no test is returned, we skip this filter.\n\t\t// This can happen depending on configuration rendering a method\n\t\t// pointless.\n\t\tconst test = type.createTest(rule.data, filter_types, rebuild);\n\t\tif ( ! test )\n\t\t\tcontinue;\n\n\t\ti++;\n\t\ttests.push(test);\n\t\tnames.push(`f${i}`);\n\t}\n\n\tif ( ! tests.length )\n\t\treturn inverted ? () => false : () => true;\n\n\tif ( tests.length === 1 )\n\t\treturn inverted ? (ctx: TContext) => ! tests[0](ctx) : tests[0];\n\n\treturn new Function(...names, 'ctx',\n\t\t`return ${inverted ? `!(` : ''}${names.map(name => `${name}(ctx)`).join(or ? ' || ' : ' && ')}${inverted ? ')' : ''};`\n\t).bind(null, ...tests);\n}\n","'use strict';\n\n// ============================================================================\n// Module System\n// Modules are cool.\n// ============================================================================\n\nimport EventEmitter, { EventListener, EventMap, NamespacedEventArgs, NamespacedEventKey, NamespacedEvents } from 'utilities/events';\nimport {has} from 'utilities/object';\nimport type Logger from './logging';\nimport type { AddonInfo, KnownEvents, ModuleKeys, ModuleMap, OptionalPromise } from './types';\nimport type { Addon } from './addon';\n\n\n// ============================================================================\n// Module\n// ============================================================================\n\n/** Represents the loading state of a Module. */\nexport enum LoadState {\n\t/** The module is currently unloaded. */\n\tUnloaded,\n\t/**\n\t * The module is in the process of loading. It may be waiting for its\n\t * load dependencies to become available, or it may be waiting for its\n\t * own {@link Module.onLoad} method to return.\n\t */\n\tLoading,\n\t/** The module is currently loaded. */\n\tLoaded,\n\t/**\n\t * The module is in the process of unloading. It may be waiting for other\n\t * modules that depend on it to be disabled, or it may be waiting for its\n\t * own {@link Module.onUnload} method to return.\n\t */\n\tUnloading\n};\n\nexport enum State {\n\t/** The module is currently disabled. */\n\tDisabled,\n\t/**\n\t * The module is in the process of being enabled. It may be waiting for\n\t * its dependencies to become available, or it may be waiting for its\n\t * own {@link Module.onEnable} method to return.\n\t */\n\tEnabling,\n\t/** The module is currently enabled. */\n\tEnabled,\n\t/**\n\t * The module is in the process of being disabled. It may be waiting for\n\t * other modules that depend on it to be disabled, or it may be waiting\n\t * for its own {@link Module.onDisable} method to return.\n\t */\n\tDisabling\n};\n\nexport type ModuleEvents = {\n\t':registered': [module: GenericModule],\n\t':loaded': [module: GenericModule],\n\t':unloaded': [module: GenericModule],\n\t':enabled': [module: GenericModule],\n\t':disabled': [module: GenericModule]\n};\n\nexport type GenericModule = Module<any, any, any, any>;\n\ntype PendingModule = [\n\tstring[],\n\tstring[],\n\t[string, string][]\n];\n\nconst EXTRACTOR = /^addon\\.([^.]+)(?:\\.|$)/i;\n\nfunction extractAddonId(path: string) {\n\treturn EXTRACTOR.exec(path)?.[1];\n}\n\n\n/**\n * A Module represents a distinct logical component of FrankerFaceZ. Modules\n * can be loaded or unloaded at runtime, and they have a robust event system.\n * Every add-on consists of one or more Module. There are separate modules\n * for every system in FrankerFaceZ, such as localization, emotes, badges,\n * chat rendering, etc.\n *\n * If you are creating an add-on, you might use Module directly if you're\n * using more than one module. If your add-on only has one module, then it\n * should use the {@link Addon} subclass.\n *\n * @param TNamespace The absolute path where this module will be mounted in\n * the module tree. Providing this string allows relative events to be used.\n * @param TEventMap A map of all event types that you're expecting to use.\n * This may include events from other modules that you plan to use. You\n * should import the type objects used by those other modules.\n */\nexport class Module<\n\tTNamespace extends string = '',\n\tTEventMap extends EventMap = {},\n\tTExtraEvents extends EventMap = KnownEvents,\n\tTActualEvents extends EventMap = TExtraEvents & NamespacedEvents<TNamespace, TEventMap> & NamespacedEvents<TNamespace, ModuleEvents>\n> extends EventEmitter<TNamespace, TActualEvents> {\n\n\tstatic buildAddonProxy = buildAddonProxy;\n\n\t/**\n\t * Optional. This method is called when a module belonging to an\n\t * {@link Addon} attempts to {@link resolve} or {@link inject} this\n\t * module. This can be used to return a {@link Proxy} for the purpose\n\t * of adjusting API responses or record keeping.\n\t *\n\t * @param addon_id The ID of the add-on requesting the module.\n\t * @param addon The manifest of the add-on requesting the module.\n\t * @param root The root {@link Addon} module.\n\t * @param caller The specific {@link Module} making the request.\n\t */\n\tgetAddonProxy?(addon_id: string, addon: AddonInfo, root: GenericModule, caller: GenericModule): Module<TNamespace, TEventMap>;\n\n\t/**\n\t * Optional. This method may be called when generating a diagnostic\n\t * log, and it can return a string to be included in the log.\n\t */\n\tgenerateLog?(): OptionalPromise<string>;\n\n\t// Some generic stuff...\n\t/**\n\t * For use in modules that are direct children of \"core\" or \"site\". If this\n\t * is set to true, the module will be enabled when FrankerFaceZ\n\t * is initialized.\n\t */\n\tshould_enable?: boolean;\n\n\t// Tracking module inter-dependency\n\tload_requires?: string[];\n\trequires?: string[];\n\n\t// These are always initialized when a module is being set up, but not\n\t// in the constructor. Just trick the type system.\n\tload_dependents: string[] = null as any;\n\tdependents: string[] = null as any;\n\treferences: [string, string][] = null as any;\n\n\n\tprivate __modules: Record<string, PendingModule | GenericModule>;\n\tprivate __log?: Logger;\n\n\tprivate __proxies?: Record<string, GenericModule>;\n\n\tprivate __load_state: LoadState;\n\tprivate __state: State;\n\n\tprivate __load_promise?: Promise<void> | null;\n\tprivate __state_promise?: Promise<void> | null;\n\n\tchildren: Record<string, GenericModule>;\n\n\t// Addon Metadata\n\tprivate __addon_id?: string;\n\tprivate __addon_root?: GenericModule;\n\n\tconstructor(name?: string, parent?: GenericModule, addon?: boolean) {\n\t\tif ( ! parent && (name as any) instanceof Module ) {\n\t\t\tparent = name as any;\n\t\t\tname = undefined;\n\t\t}\n\n\t\tsuper(name, parent);\n\t\tthis.__modules = parent ? parent.__modules : {};\n\t\tthis.children = {};\n\n\t\tif ( parent?.__addon_id ) {\n\t\t\tthis.__addon_id = parent.__addon_id;\n\t\t\tthis.__addon_root = parent.__addon_root;\n\t\t} else if ( addon ) {\n\t\t\tconst addon_id = extractAddonId(this.__path as string);\n\t\t\tif ( addon_id ) {\n\t\t\t\tthis.__addon_id = addon_id;\n\t\t\t\tthis.__addon_root = this;\n\t\t\t}\n\t\t}\n\n\t\tif ( parent && ! parent.children[this.name] )\n\t\t\tparent.children[this.name] = this;\n\n\t\tif ( this.root === this )\n\t\t\tthis.__modules[this.__path || ''] = this;\n\n\t\tlet is_loadable = !! this.onLoad;\n\t\tif ( ! is_loadable ) {\n\t\t\tconst load_requires = this.__get_load_requires();\n\t\t\tis_loadable = Array.isArray(load_requires) && load_requires.length > 0;\n\t\t}\n\n\t\tthis.__load_state = is_loadable ? LoadState.Unloaded : LoadState.Loaded;\n\t\tthis.__state = is_loadable || this.onEnable ?\n\t\t\tState.Disabled : State.Enabled;\n\n\t\tthis._time('instance');\n\t\t(this as any).emit(':registered', this);\n\t}\n\n\n\t// ========================================================================\n\t// Public Properties\n\t// ========================================================================\n\n\t/** The current {@link State} of this module. */\n\tget state() { return this.__state }\n\n\t/** The current {@link LoadState} of this module. */\n\tget load_state() { return this.__load_state }\n\n\t/** Whether or not the module is {@link LoadState.Loaded}. */\n\tget loaded() { return this.__load_state === LoadState.Loaded }\n\t/** Whether or not the module is {@link LoadState.Loading}. */\n\tget loading() { return this.__load_state === LoadState.Loading }\n\n\t/** Whether or not the module is {@link State.Enabled}. */\n\tget enabled() { return this.__state === State.Enabled }\n\t/** Whether or not the module is {@link State.Enabling}. */\n\tget enabling() { return this.__state === State.Enabling }\n\n\t/** If this module is part of an add-on, the add-on's ID. */\n\tget addon_id() { return this.__addon_id }\n\t/** If this module is part of an add-on, the add-on's root module. */\n\tget addon_root() { return this.__addon_root }\n\t/** If this module is part of an add-on, the add-on's manifest. */\n\tget addon_manifest() {\n\t\tif (this.__addon_id)\n\t\t\treturn this.resolve('addons')?.getAddon(this.__addon_id!) ??\n\t\t\t\t(this.__addon_root?.constructor as typeof Addon)?.info ??\n\t\t\t\tundefined;\n\t}\n\n\t/** A Logger instance for this module. */\n\tget log(): Logger {\n\t\t// In theory, this could be undefined. In practice, we will always\n\t\t// have a Logger set up. Additionally, it would be way too annoying\n\t\t// to need to put conditional checks literally everywhere we use the\n\t\t// logger system. Just no.\n\t\tif ( ! this.__log )\n\t\t\tthis.__log = this.parent && (this.parent as GenericModule).log?.get?.(this.name);\n\t\treturn this.__log as Logger;\n\t}\n\n\tset log(log) {\n\t\tthis.__log = log;\n\t}\n\n\n\t// ========================================================================\n\t// Timing\n\t// ========================================================================\n\n\t/**\n\t * Record a timing event. The timing system is not yet finished.\n\t * @param event The timing event to record.\n\t */\n\tprotected _time(event: string | any) {\n\t\tif ( (this.root as any).timing ) {\n\t\t\tif ( typeof event !== 'object' )\n\t\t\t\tevent = {event};\n\t\t\tevent.module = this.__path || 'core';\n\t\t\t(this.root as any).timing.addEvent(event);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// State! Glorious State\n\t// ========================================================================\n\n\t/**\n\t * Load this module. If the module has no {@link onLoad} method and no\n\t * {@link load_requires} modules listed, then it will be considered\n\t * {@link LoadState.Loaded} immediately.\n\t *\n\t * All of the module's {@link load_requires} dependencies will be\n\t * enabled before the load state updates and this returns.\n\t *\n\t * Modules are automatically loaded before being enabled.\n\t */\n\tload() {\n\t\treturn this.__load(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being loaded. The module will not be set to {@link LoadState.Loaded}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that this module {@link load_requires}\n\t * will already be enabled and injected modules will have been injected.\n\t */\n\tprotected onLoad?(): void | Promise<void>;\n\n\t/**\n\t * Unload this module. If the module has no {@link onUnload} method,\n\t * but it has an {@link onLoad} method, then this will throw an error.\n\t *\n\t * When this is called, if this module is currently enabled, it will\n\t * be disabled first. As part of that, all modules that depend on\n\t * this module will also be disabled first. All modules that depend\n\t * on this module as a load dependency will be unloaded first.\n\t *\n\t * Please note that, if any of those dependencies cannot be unloaded or\n\t * disabled, this will fail.\n\t */\n\tunload() {\n\t\treturn this.__unload(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being unloaded. The module will not be set to {@link LoadState.Unloaded}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that depend on this module will\n\t * already have been disabled.\n\t */\n\tprotected onUnload?(): void | Promise<void>;\n\n\t/**\n\t * Enable this module. If the module has no {@link onEnable} method\n\t * and the module is considered {@link LoadState.Loaded} immediately,\n\t * then the module will be considered {@link State.Enabled} immediately.\n\t *\n\t * All of the module's {@link requires} dependencies will be\n\t * enabled before the state updates and this returns.\n\t *\n\t * Modules are automatically loaded before being enabled.\n\t */\n\tenable() {\n\t\treturn this.__enable(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being enabled. The module will not be set to {@link State.Enabled}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that this module {@link requires}\n\t * will already be enabled and injected modules will have been injected.\n\t */\n\tprotected onEnable?(): void | Promise<void>;\n\n\t/**\n\t * Disable this module. If the module has no {@link onDisable} method,\n\t * but it has an {@link onEnable} method, then this will throw an error.\n\t *\n\t * As part of disabling this module, all modules that depend on this\n\t * module will be disabled first. All modules that depend on this module\n\t * as a load dependency will be unloaded first.\n\t *\n\t * Please note that, if any of those dependencies cannot be unloaded or\n\t * disabled, this will fail.\n\t */\n\tdisable() {\n\t\treturn this.__disable(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being disabled. The module will not be set to {@link State.Disabled}\n\t * until after this method returns. Promises are supported.\n\t */\n\tprotected onDisable?(): void | Promise<void>;\n\n\t/**\n\t * Determine whether or not this module can be unloaded. This checks\n\t * not only this module's state, but the state of all modules that\n\t * depend on this module.\n\t */\n\tcanUnload() {\n\t\treturn this.__canUnload(this.__path, []);\n\t}\n\n\t/**\n\t * Determine whether or not this module can be disabled. This checks\n\t * not only this module's state, but the state of all modules that\n\t * depend on this module.\n\t */\n\tcanDisable() {\n\t\treturn this.__canDisable(this.__path, []);\n\t}\n\n\tprivate __load(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${initial}`, [...chain, this]));\n\t\telse if ( this.load_requires )\n\t\t\tfor(const name of this.load_requires) {\n\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\tif ( (module instanceof Module) && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === LoadState.Loading )\n\t\t\treturn this.__load_promise;\n\n\t\telse if ( state === LoadState.Loaded )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( state === LoadState.Unloading )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to load module ${path} while module is being unloaded`));\n\n\t\tthis._time('load-start');\n\t\tthis.__load_state = LoadState.Loading;\n\t\treturn this.__load_promise = (async () => {\n\t\t\tif ( this.load_requires ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.load_requires) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\tthrow new ModuleError(`cannot find required module ${name} when loading ${path}`);\n\n\t\t\t\t\tpromises.push(module.__enable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tif ( this.onLoad ) {\n\t\t\t\tthis._time('load-self');\n\t\t\t\treturn this.onLoad();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__load_state = LoadState.Loaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('load-end');\n\t\t\t(this as any).emit(':loaded', this);\n\t\t\treturn ret;\n\t\t}).catch(err => {\n\t\t\tthis.__load_state = LoadState.Unloaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('load-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\tprivate __canUnload(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can unload ${initial}`, [...chain, this]);\n\t\telse if ( this.load_dependents ) {\n\t\t\tchain.push(this);\n\n\t\t\tfor(const dep of this.load_dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module ) {\n\t\t\t\t\tif ( chain.includes(module) )\n\t\t\t\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can unload ${initial}`, [...chain, this, module]);\n\n\t\t\t\t\tif ( ! module.__canUnload(initial, Array.from(chain)) )\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( state === LoadState.Unloading )\n\t\t\treturn true;\n\n\t\telse if ( state === LoadState.Unloaded )\n\t\t\treturn true;\n\n\t\telse if ( this.onLoad && ! this.onUnload )\n\t\t\treturn false;\n\n\t\telse if ( state === LoadState.Loading )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate __unload(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${initial}`, [...chain, this]));\n\t\telse if ( this.load_dependents )\n\t\t\tfor(const dep of this.load_dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === LoadState.Unloading )\n\t\t\treturn this.__load_promise;\n\n\t\telse if ( state === LoadState.Unloaded )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( this.onLoad && ! this.onUnload )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to unload module ${path} but module cannot be unloaded`));\n\n\t\telse if ( state === LoadState.Loading )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to unload module ${path} while module is being loaded`));\n\n\t\tthis._time('unload-start');\n\t\tthis.__load_state = LoadState.Unloading;\n\t\treturn this.__load_promise = (async () => {\n\t\t\tif ( this.__state !== State.Disabled )\n\t\t\t\tawait this.disable();\n\n\t\t\tif ( this.load_dependents ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.load_dependents) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\t//throw new ModuleError(`cannot find depending module ${name} when unloading ${path}`);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tpromises.push(module.__unload(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tthis._time('unload-self');\n\t\t\tif ( this.onUnload )\n\t\t\t\treturn this.onUnload();\n\n\t\t})().then(ret => {\n\t\t\tthis.__load_state = LoadState.Unloaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('unload-end');\n\t\t\t(this as any).emit(':unloaded', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__load_state = LoadState.Loaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('unload-end');\n\t\t\tthrow err;\n\n\t\t});\n\t}\n\n\n\tprivate __enable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${initial}`, [...chain, this]));\n\t\telse if ( this.requires )\n\t\t\tfor(const name of this.requires) {\n\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === State.Enabling )\n\t\t\treturn this.__state_promise;\n\n\t\telse if ( state === State.Enabled )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( state === State.Disabling )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to enable module ${path} while module is being disabled`));\n\n\t\tthis._time('enable-start');\n\t\tthis.__state = State.Enabling;\n\t\treturn this.__state_promise = (async () => {\n\t\t\tconst promises = [],\n\t\t\t\trequires = this.requires,\n\t\t\t\tload_state = this.__load_state;\n\n\t\t\tif ( load_state === LoadState.Unloading )\n\t\t\t\t// We'd abort for this later to, but kill it now before we start\n\t\t\t\t// any unnecessary work.\n\t\t\t\tthrow new ModuleError(`attempted to load module ${path} while module is being unloaded`);\n\n\t\t\telse if ( load_state === LoadState.Loading || load_state === LoadState.Unloaded )\n\t\t\t\tpromises.push(this.load());\n\n\t\t\tif ( requires )\n\t\t\t\tfor(const name of requires) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\tthrow new ModuleError(`cannot find required module ${name} when enabling ${path}`);\n\n\t\t\t\t\tpromises.push(module.__enable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\tawait Promise.all(promises);\n\t\t\tif ( this.onEnable ) {\n\t\t\t\tthis._time('enable-self');\n\t\t\t\treturn this.onEnable();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__state = State.Enabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('enable-end');\n\t\t\t(this as any).emit(':enabled', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__state = State.Disabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('enable-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\tprivate __canDisable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can disable ${initial}`, [...chain, this]);\n\t\telse if ( this.dependents ) {\n\t\t\tchain.push(this);\n\n\t\t\tfor(const dep of this.dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module && (module instanceof Module) ) {\n\t\t\t\t\tif ( chain.includes(module) )\n\t\t\t\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can disable ${initial}`, [...chain, this, module]);\n\n\t\t\t\t\tif ( ! module.__canDisable(initial, Array.from(chain)) )\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( state === State.Disabling || state === State.Disabled )\n\t\t\treturn true;\n\n\t\telse if ( ! this.onDisable )\n\t\t\treturn false;\n\n\t\telse if ( state === State.Enabling )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate __disable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${initial}`, [...chain, this]));\n\t\telse if ( this.dependents )\n\t\t\tfor(const dep of this.dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === State.Disabling )\n\t\t\treturn this.__state_promise;\n\n\t\telse if ( state === State.Disabled )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( ! this.onDisable )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to disable module ${path} but module cannot be disabled`));\n\n\t\telse if ( state === State.Enabling )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to disable module ${path} but module is being enabled`));\n\n\t\tthis._time('disable-start');\n\t\tthis.__state = State.Disabling;\n\t\treturn this.__state_promise = (async () => {\n\t\t\tif ( this.__load_state !== LoadState.Loaded )\n\t\t\t\t// We'd abort for this later to, but kill it now before we start\n\t\t\t\t// any unnecessary work.\n\t\t\t\tthrow new ModuleError(`attempted to disable module ${path} but module is unloaded -- weird state`);\n\n\t\t\tif ( this.dependents ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.dependents) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\t// Assume a non-existent module isn't enabled.\n\t\t\t\t\t\t//throw new ModuleError(`cannot find depending module ${name} when disabling ${path}`);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tpromises.push(module.__disable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tif ( this.onDisable ) {\n\t\t\t\tthis._time('disable-self');\n\t\t\t\treturn this.onDisable();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__state = State.Disabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('disable-end');\n\t\t\t(this as any).emit(':disabled', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__state = State.Enabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('disable-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\t// ========================================================================\n\t// Slightly Easier Events\n\t// ========================================================================\n\n\ton<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.on(\n\t\t\tevent,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\tonce<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.once(\n\t\t\tevent,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\tmany<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.many(\n\t\t\tevent,\n\t\t\tttl,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.waitFor<K>(\n\t\t\tevent,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\toff<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent?: K, fn?: EventListener, ctx?: any\n\t) {\n\t\treturn super.off(event, fn, ctx === undefined ? this : ctx);\n\t}\n\n\n\t// ========================================================================\n\t// Module Management\n\t// ========================================================================\n\n\tprivate __resolve(name: string | Module): Module | PendingModule | undefined {\n\t\tif ( name instanceof Module )\n\t\t\treturn name;\n\n\t\treturn this.__modules[this.abs_path(name)];\n\t}\n\n\tresolve<\n\t\tTPath extends string,\n\t\tTReturn = TPath extends keyof ModuleMap\n\t\t\t? ModuleMap[TPath]\n\t\t\t: GenericModule\n\t>(name: TPath): TReturn | null {\n\t\tlet module = this.__resolve(name);\n\t\tif ( !(module instanceof Module) )\n\t\t\treturn null;\n\n\t\tif ( this.__processModule )\n\t\t\tmodule = this.__processModule(module);\n\n\t\treturn module as TReturn;\n\t}\n\n\n\thasModule(name: string) {\n\t\tconst module = this.__modules[this.abs_path(name)];\n\t\treturn module instanceof Module;\n\t}\n\n\n\tprivate __get_requires() {\n\t\tif ( has(this, 'requires') )\n\t\t\treturn this.requires;\n\t\tif ( has(this.constructor, 'requires') )\n\t\t\treturn (this.constructor as any).requires as string[];\n\t\treturn null;\n\t}\n\n\n\tprivate __get_load_requires() {\n\t\tif ( has(this, 'load_requires') )\n\t\t\treturn this.load_requires;\n\t\tif ( has(this.constructor, 'load_requires') )\n\t\t\treturn (this.constructor as any).load_requires as string[];\n\t\treturn null;\n\t}\n\n\n\tprivate __processModule<TModule extends Module>(module: TModule): TModule {\n\t\tif ( this.__addon_id && module.getAddonProxy ) {\n\t\t\tconst addon_id = this.__addon_id;\n\t\t\tif ( ! module.__proxies )\n\t\t\t\tmodule.__proxies = {};\n\n\t\t\tif ( module.__proxies[addon_id] )\n\t\t\t\treturn module.__proxies[addon_id] as TModule;\n\n\t\t\t// TODO: Typing for the addons module.\n\t\t\tconst addon = (this.__resolve('addons') as any)?.getAddon?.(addon_id),\n\t\t\t\tout = module.getAddonProxy(addon_id, addon, this.__addon_root ?? this, this);\n\n\t\t\tif ( out !== module )\n\t\t\t\tmodule.__proxies[addon_id] = out;\n\n\t\t\treturn out as TModule;\n\t\t}\n\n\t\treturn module;\n\t}\n\n\n\tinject(name: string | Module | null, module?: GenericModule | typeof Module<any, any> | null, require: boolean = true) {\n\t\tif ( name instanceof Module || (name && (name as any).prototype instanceof Module) ) {\n\t\t\trequire = module != null ? module as any : true;\n\t\t\tmodule = name as Module;\n\t\t\tname = null;\n\t\t}\n\n\t\tconst requires = this.requires = this.__get_requires() || [];\n\n\t\tif ( module instanceof Module ) {\n\t\t\t// Existing Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.constructor.name.toSnakeCase();\n\n\t\t} else if ( module && module.prototype instanceof Module ) {\n\t\t\t// New Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.name.toSnakeCase();\n\n\t\t\tmodule = this.register(name, module);\n\n\t\t} else if ( name ) {\n\t\t\t// Just a Name\n\t\t\tconst full_name = name;\n\t\t\tname = name.replace(/^(?:[^.]*\\.)+/, '');\n\t\t\tmodule = this.__resolve(full_name) as Module | undefined;\n\n\t\t\t// Allow injecting a module that doesn't exist yet?\n\n\t\t\tif ( ! module || !(module instanceof Module) ) {\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as PendingModule)[2].push([this.__path as string, name]);\n\t\t\t\telse\n\t\t\t\t\tthis.__modules[this.abs_path(full_name)] = [[], [], [[this.__path as string, name]]]\n\n\t\t\t\trequires.push(this.abs_path(full_name));\n\n\t\t\t\treturn (this as any)[name] = null;\n\t\t\t}\n\n\t\t} else\n\t\t\tthrow new TypeError(`must provide a valid module name or class`);\n\n\t\tif ( ! module )\n\t\t\tthrow new Error(`cannot find module ${name} or no module provided`);\n\n\t\tif ( require )\n\t\t\trequires.push((module as Module).abs_path('.'));\n\n\t\tif ( this.enabled && ! (module as Module).enabled )\n\t\t\t(module as Module).enable();\n\n\t\t(module as Module).references.push([this.__path as string, name]);\n\n\t\tif ( (module instanceof Module) && this.__processModule )\n\t\t\tmodule = this.__processModule(module);\n\n\t\treturn (this as any)[name] = module;\n\t}\n\n\n\tinjectAs(variable: string, name: string | Module | null, module?: GenericModule | typeof Module<any, any> | null, require: boolean = true) {\n\t\tif ( name instanceof Module || (name && (name as any).prototype instanceof Module) ) {\n\t\t\trequire = module != null ? module as any : true;\n\t\t\tmodule = name as Module;\n\t\t\tname = null;\n\t\t}\n\n\t\tconst requires = this.requires = this.__get_requires() || [];\n\n\t\tif ( module instanceof Module ) {\n\t\t\t// Existing Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.constructor.name.toSnakeCase();\n\n\t\t} else if ( module && module.prototype instanceof Module ) {\n\t\t\t// New Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.name.toSnakeCase();\n\n\t\t\tmodule = this.register(name, module);\n\n\t\t} else if ( name ) {\n\t\t\t// Just a Name\n\t\t\tconst full_name = name;\n\t\t\tname = name.replace(/^(?:[^.]*\\.)+/, '');\n\t\t\tmodule = this.__resolve(full_name) as Module | undefined;\n\n\t\t\t// Allow injecting a module that doesn't exist yet?\n\n\t\t\tif ( ! module || !(module instanceof Module) ) {\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as PendingModule)[2].push([this.__path as string, variable]);\n\t\t\t\telse\n\t\t\t\t\tthis.__modules[this.abs_path(full_name)] = [[], [], [[this.__path as string, variable]]]\n\n\t\t\t\trequires.push(this.abs_path(full_name));\n\n\t\t\t\treturn (this as any)[variable] = null;\n\t\t\t}\n\n\t\t} else\n\t\t\tthrow new TypeError(`must provide a valid module name or class`);\n\n\t\tif ( ! module )\n\t\t\tthrow new Error(`cannot find module ${name} or no module provided`);\n\n\t\tif ( require )\n\t\t\trequires.push((module as Module).abs_path('.'));\n\n\n\t\tif ( this.enabled && ! (module as Module).enabled )\n\t\t\t(module as Module).enable();\n\n\t\t(module as Module).references.push([this.__path as string, variable]);\n\n\t\tif ( this.__processModule )\n\t\t\tmodule = this.__processModule(module as Module);\n\n\t\treturn (this as any)[variable] = module;\n\t}\n\n\n\tregister(name: string, module: typeof Module<any, any>, inject_reference: boolean = false) {\n\t\tif ( (name as any).prototype instanceof Module ) {\n\t\t\tinject_reference = module as any;\n\t\t\tmodule = name as any;\n\t\t\tname = module.name.toSnakeCase();\n\t\t}\n\n\t\tconst path = this.abs_path(`.${name}`),\n\t\t\tproto = module.prototype,\n\t\t\told_val = this.__modules[path];\n\n\t\tif ( !(proto instanceof Module) )\n\t\t\tthrow new TypeError(`Module ${name} is not subclass of Module.`);\n\n\t\tif ( old_val instanceof Module )\n\t\t\tthrow new ModuleError(`Name Collision for Module ${path}`);\n\n\t\tconst dependents = old_val || [[], [], []];\n\t\tlet inst = this.__modules[path] = new module(name, this);\n\t\tconst requires = inst.requires = inst.__get_requires() || [],\n\t\t\tload_requires = inst.load_requires = inst.__get_load_requires() || [];\n\n\t\tinst.dependents = dependents[0];\n\t\tinst.load_dependents = dependents[1];\n\t\tinst.references = dependents[2];\n\n\t\tfor(const req_name of requires) {\n\t\t\tconst req_path = inst.abs_path(req_name),\n\t\t\t\treq_mod = this.__modules[req_path];\n\n\t\t\tif ( ! req_mod )\n\t\t\t\tthis.__modules[req_path] = [[path],[],[]];\n\t\t\telse if ( Array.isArray(req_mod) )\n\t\t\t\treq_mod[0].push(path);\n\t\t\telse\n\t\t\t\treq_mod.dependents.push(path);\n\t\t}\n\n\t\tfor(const req_name of load_requires) {\n\t\t\tconst req_path = inst.abs_path(req_name),\n\t\t\t\treq_mod = this.__modules[req_path];\n\n\t\t\tif ( ! req_mod )\n\t\t\t\tthis.__modules[req_path] = [[], [path], []];\n\t\t\telse if ( Array.isArray(req_mod) )\n\t\t\t\treq_mod[1].push(path);\n\t\t\telse\n\t\t\t\treq_mod.load_dependents.push(path);\n\t\t}\n\n\t\tfor(const [in_path, in_name] of dependents[2]) {\n\t\t\tconst in_mod = this.__resolve(in_path);\n\t\t\tif ( in_mod && ! Array.isArray(in_mod) )\n\t\t\t\t(in_mod as any)[in_name] = inst;\n\t\t\telse\n\t\t\t\tthis.log.warn(`Unable to find module \"${in_path}\" that wanted \"${in_name}\".`);\n\t\t}\n\n\t\tif ( this.__processModule )\n\t\t\tinst = this.__processModule(inst as GenericModule);\n\n\t\tif ( inject_reference )\n\t\t\t(this as any)[name] = inst;\n\n\t\treturn inst;\n\t}\n\n\n\t/**\n\t * Attempt to load a set of child modules from a {@link require.context}\n\t * object. This searches the default exports, as well as exports named\n\t * `module` specifically. Each discovered module will be registered\n\t * and injected onto this module.\n\t *\n\t * @param ctx The context to load from.\n\t * @param log A logger to use for logging errors. If not provided, this\n\t * will default to this module's default logger.\n\t * @returns A map of all loaded modules.\n\t */\n\tasync loadFromContext(ctx: __WebpackModuleApi.RequireContext, log?: Logger) {\n\t\tlog = log ?? this.log;\n\t\tconst added: Record<string, GenericModule> = {};\n\t\tfor(const raw_path of ctx.keys()) {\n\t\t\tconst raw_module = await ctx(raw_path), // eslint-disable-line no-await-in-loop\n\t\t\t\tmodule = raw_module.module || raw_module.default,\n\t\t\t\tlix = raw_path.lastIndexOf('.'),\n\t\t\t\ttrimmed = lix > 2 ? raw_path.slice(2, lix) : raw_path,\n\t\t\t\tname = trimmed.endsWith('/index') ? trimmed.slice(0, -6) : trimmed;\n\n\t\t\ttry {\n\t\t\t\tadded[name] = this.register(name, module);\n\t\t\t} catch(err) {\n\t\t\t\tif ( log && err instanceof Error ) {\n\t\t\t\t\tlog.capture(err, {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tmodule: name,\n\t\t\t\t\t\t\tpath: raw_path\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlog.warn(err, `Skipping ${raw_path}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn added;\n\t}\n\n}\n\nexport default Module;\n\nexport function buildAddonProxy<TObj extends object, TNoProxy extends boolean = false>(\n\taccessor: Module | null,\n\tthing: TObj,\n\tname: string,\n\toverrides: Record<string, any>,\n\taccess_warnings?: Record<string, string | boolean>,\n\tno_proxy?: TNoProxy\n): TNoProxy extends true ? ProxyHandler<TObj> : TObj {\n\n\tconst handler = {\n\t\tget(obj: any, prop: string, receiver: unknown) {\n\t\t\t// First, handle basic overrides behavior.\n\t\t\tlet value = overrides[prop];\n\t\t\tif ( value !== undefined ) {\n\t\t\t\t// Check for functions, and bind their this.\n\t\t\t\tif ( typeof value === 'function' )\n\t\t\t\t\treturn value.bind(obj);\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\t// Next, handle access warnings.\n\t\t\tconst warning = access_warnings && access_warnings[prop];\n\t\t\tif ( accessor?.log && warning )\n\t\t\t\taccessor.log.warn(`[DEV-CHECK] Accessed ${name}.${prop} directly. ${typeof warning === 'string' ? warning : ''}`)\n\n\t\t\t// Check for functions, and bind their this.\n\t\t\tvalue = obj[prop];\n\t\t\tif ( typeof value === 'function' )\n\t\t\t\treturn value.bind(obj);\n\n\t\t\t// Make sure all module access is proxied.\n\t\t\tif ( accessor && (value instanceof Module) )\n\t\t\t\t// TypeScript thinks this doesn't work. It technically does,\n\t\t\t\t// we just don't want to encourage it.\n\t\t\t\treturn accessor.resolve(value as any);\n\n\t\t\t// Return whatever it would be normally.\n\t\t\treturn Reflect.get(obj, prop, receiver);\n\t\t}\n\t};\n\n\treturn no_proxy ? handler : new Proxy<TObj>(thing, handler) as any;\n\n}\n\n\n// ============================================================================\n// Errors\n// ============================================================================\n\n/**\n * A subclass of {@link Error} for errors directly related to {@link Module}\n * state. These may be thrown when attempting to enable, disable, load, or\n * unload a module.\n *\n * @noInheritDoc\n */\nexport class ModuleError extends Error { }\n\n/**\n * A subclass of {@link ModuleError} thrown in specific cases when attempting\n * to enable, disable, load, or unload a {@link Module} results in a cycle.\n * This happens if a module depends on a module that, directly or indirectly,\n * depends on itself.\n */\nexport class CyclicDependencyError extends ModuleError {\n\n\t/** The list of modules encountered, in the order they were encountered. */\n\tmodules: GenericModule[];\n\n\t/**\n\t * Create a new instance of CyclicDependencyError.\n\t *\n\t * @param message The message to display with the error.\n\t * @param modules The list of modules at fault.\n\t */\n\tconstructor(message: string, modules: GenericModule[]) {\n\t\tsuper(`${message} (${modules.map(x => (x as Module).path).join(' => ')})`);\n\t\tthis.modules = modules;\n\t}\n\n}\n","\nimport {BAD_HOTKEYS, TWITCH_EMOTE_V2, WORD_SEPARATORS} from 'utilities/constants';\nimport type { ExtractSegments, ExtractType } from 'utilities/types';\n\nconst HOP = Object.prototype.hasOwnProperty;\n\n/**\n * Get the URL for a Twitch emote.\n *\n * @param id The emote's ID.\n * @param scale The scale.\n * @param animated Whether or not to allow animated images.\n * @param dark Whether or not the image is to be displayed on a dark background.\n * Twitch, continuing to innovate in being behind the times, uses GIFs for\n * their animated emotes so matteing is a concern.\n */\nexport function getTwitchEmoteURL(\n\tid: string,\n\tscale: 1 | 2 | 4,\n\tanimated: boolean = false,\n\tdark: boolean = true\n) {\n\treturn `${TWITCH_EMOTE_V2}/${id}/${animated ? 'default' : 'static'}/${dark ? 'dark' : 'light'}/${scale == 4 ? 3 : scale}.0`\n}\n\n/**\n * Get an `srcset` for a Twitch emote. This is intended for use with\n * an image element's `srcset` attribute.\n *\n * @param id The emote's ID.\n * @param animated Whether or not to allow animated images.\n * @param dark Whether or not the image is to be displayed on a dark background.\n * Twitch, continuing to innovate in being behind the times, uses GIFs for\n * their animated emotes so matteing is a concern.\n * @param big If this is true, the emote's 2x image will be used for 1x\n * size, and its 4x image will be used for 2x size.\n */\nexport function getTwitchEmoteSrcSet(\n\tid: string,\n\tanimated: boolean = false,\n\tdark: boolean = true,\n\tbig: boolean = false\n) {\n\tif ( big )\n\t\treturn `${getTwitchEmoteURL(id, 2, animated, dark)} 1x, ${getTwitchEmoteURL(id, 4, animated, dark)} 2x`;\n\n\treturn `${getTwitchEmoteURL(id, 1, animated, dark)} 1x, ${getTwitchEmoteURL(id, 2, animated, dark)} 2x, ${getTwitchEmoteURL(id, 4, animated, dark)} 4x`;\n}\n\n/** Check if the provided shortkey key is valid. */\nexport function isValidShortcut(key: string) {\n\tif ( ! key )\n\t\treturn false;\n\n\tkey = key.toLowerCase().trim();\n\treturn ! BAD_HOTKEYS.includes(key);\n}\n\n/**\n * Generate a random UUIDv4.\n *\n * This method has a fallback implementation for people using\n * ancient browsers without {@link crypto.randomUUID}.\n */\nexport const generateUUID = crypto.randomUUID\n\t? () => crypto.randomUUID()\n\t: function generateUUID(input?: any): string {\n\t\treturn input           // if the placeholder was passed, return\n\t\t\t? (              // a random number from 0 to 15\n\t\t\t\tinput ^            // unless b is 8,\n\t\t\t\tMath.random()  // in which case\n\t\t\t\t* 16           // a random number from\n\t\t\t\t>> input/4         // 8 to 11\n\t\t\t).toString(16) // in hexadecimal\n\t\t\t: (              // or otherwise a concatenated string:\n\t\t\t\t[1e7] as any +        // 10000000 +\n\t\t\t\t-1e3 +         // -1000 +\n\t\t\t\t-4e3 +         // -4000 +\n\t\t\t\t-8e3 +         // -80000000 +\n\t\t\t\t-1e11          // -100000000000,\n\t\t\t).replace(     // replacing\n\t\t\t\t/[018]/g,    // zeroes, ones, and eights with\n\t\t\t\tgenerateUUID            // random hex digits\n\t\t\t);\n\t};\n\n\n/**\n * An error that can be localized using the i18n module.\n */\nexport class TranslatableError extends Error {\n\n\ti18n_key: string;\n\tdata: any;\n\n\tconstructor(message: string, key: string, data?: any) {\n\t\tsuper(message);\n\t\tthis.i18n_key = key;\n\t\tthis.data = data;\n\t}\n\n\ttoString() {\n\t\tconst ffz = window.FrankerFaceZ?.get(),\n\t\t\ti18n = ffz?.resolve('i18n');\n\n\t\tif ( i18n && this.i18n_key )\n\t\t\treturn i18n.t(this.i18n_key, this.message, this.data);\n\n\t\treturn this.message;\n\t}\n}\n\n\n/**\n * Get a SHA-256 hash of a string. Uses {@link crypto.subtle.digest}\n *\n * @param message The string to hash.\n */\nexport async function sha256(message: string) {\n\t// encode as UTF-8\n\tconst msgBuffer = new TextEncoder().encode(message);\n\n\t// hash the message\n\tconst hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n\n\t// convert ArrayBuffer to Array\n\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\n\t// convert bytes to hex string\n\tconst hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\treturn hashHex;\n}\n\n\nexport type ScreenDimensions = {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\theight: number;\n\tlabel: string;\n};\n\nexport type ScreenOptions = {\n\tindex?: number;\n\ttop?: number;\n\tleft?: number;\n\twidth?: number;\n\theight?: number;\n\tlabel?: string | null;\n}\n\n/**\n * Determine which screen from the provided array is the closest match to\n * the provided options. This is used by the settings profile rule for\n * Current Monitor.\n *\n * @param screens The screens to choose between.\n * @param options The options to choose with.\n */\nexport function matchScreen(screens: ScreenDimensions[], options: ScreenOptions) {\n\tlet match = undefined;\n\tlet mscore = 0;\n\n\tfor(let i = 0; i < screens.length; i++) {\n\t\tconst mon = screens[i];\n\t\tif ( mon.label !== options.label )\n\t\t\tcontinue;\n\n\t\tlet score = 1;\n\t\tif ( options.left && options.left === mon.left )\n\t\t\tscore += 15;\n\t\tif ( options.top && options.top === mon.top )\n\t\t\tscore += 15;\n\n\t\tif ( options.width && options.width === mon.width )\n\t\t\tscore += 10;\n\n\t\tif ( options.height && options.height === mon.height )\n\t\t\tscore += 10;\n\n\t\tif ( options.index )\n\t\t\tscore -= Math.abs(options.index - i);\n\n\t\tif ( score > mscore ) {\n\t\t\tmatch = mon;\n\t\t\tmscore = score;\n\t\t}\n\t}\n\n\treturn match;\n}\n\n/**\n * Determine if the provided object has a key with the given name.\n *\n * @param object The object to check.\n * @param key The key to search for.\n */\nexport function has<T>(object: T, key: PropertyKey): key is keyof T {\n\treturn object ? HOP.call(object, key) : false;\n}\n\n\n/**\n * Return a {@link Promise} that resolves after a set delay.\n *\n * @param delay The amount of time to wait, in milliseconds.\n */\nexport function sleep(delay: number): Promise<void> {\n\treturn new Promise(resolve => setTimeout(resolve, delay));\n}\n\n\nexport type FakeEnum<T extends string> = {\n\t[K in T | number]: K extends number ? T : number;\n};\n\n/**\n * Create an enum-like object from an array of strings.\n *\n * @deprecated This should no longer be used, as we now have access to\n * TypeScript's enum types.\n */\nexport function make_enum<T extends string>(...input: T[]): FakeEnum<T> {\n\tconst out: any = {};\n\n\tfor(let i = 0, l = input.length; i < l; i++) {\n\t\tconst word = input[i];\n\t\tout[word] = i;\n\t\tout[i] = word;\n\t}\n\n\treturn out;\n}\n\nexport type FakeEnumFlags<T extends string> = FakeEnum<T> & {\n\tNone: 0;\n}\n\n/**\n * Create an enum-like object from an array of strings, such that every\n * value is a power of two so that they can be processed using binary\n * operators.\n *\n * @deprecated This should no longer be used, as we now have access to\n * TypeScript's enum types.\n */\nexport function make_enum_flags<T extends string>(...input: T[]): FakeEnumFlags<T> {\n\tconst out: any = {};\n\n\tout.None = 0;\n\tout[0] = 'None';\n\n\tfor(let i = 0, l = input.length; i < l; i++) {\n\t\tconst word = input[i],\n\t\t\tvalue = Math.pow(2, i);\n\t\tout[word] = value;\n\t\tout[value] = word;\n\t}\n\n\treturn out;\n}\n\n/**\n * A simple {@link Error} subclass thrown from {@link timeout} if and\n * when the Promise times out.\n *\n * @noInheritDoc\n */\nexport class TimeoutError extends Error {\n\tconstructor(message?: string) {\n\t\tsuper(message ?? 'timeout')\n\t}\n}\n\n/**\n * Wrap a {@link Promise} with another Promise that, if the original\n * Promise fails to resolve or reject within the provided delay, will\n * be rejected with a {@link TimeoutError}.\n *\n * @param promise The Promise to wrap\n * @param delay The length of time, in milliseconds, to wait before timing out.\n */\nexport function timeout<TReturn = unknown>(promise: Promise<TReturn>, delay: number) {\n\treturn new Promise<TReturn>((resolve, fail) => {\n\t\tlet resolved = false;\n\t\tconst timer = setTimeout(() => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tfail(new TimeoutError());\n\t\t\t}\n\t\t}, delay);\n\n\t\tpromise.then(result => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tresolve(result);\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tfail(err);\n\t\t\t}\n\t\t});\n\t});\n}\n\n\n/**\n * TicketLock is a simple class that implements a [Ticket Lock](https://en.wikipedia.org/wiki/Ticket_lock)\n * pattern for cooperative waiting. This can be used for, among other things,\n * limiting the number of concurrent API requests to avoid overloading\n * browser or server limits.\n *\n * @example Using TicketLock to limit access to an API.\n * ```typescript\n * // In your constructor.\n * this.api_tickets = new TicketLock(5); // allow up to 5 simultaneous requests\n *\n * // In a method accessing your API\n * const ticket = await this.api_tickets.wait();\n *\n * const request = await fetch(url).finally(ticket);\n * if ( request.ok )\n *     // ...\n * ```\n */\nexport class TicketLock {\n\tlimit: number;\n\n\tprivate __active: number;\n\tprivate __waiting: ((done: () => void) => void)[];\n\n\tconstructor(limit = 1) {\n\t\tthis.limit = limit;\n\t\tthis.__active = 0;\n\t\tthis.__waiting = [];\n\t}\n\n\t/** Whether or not there is a ticket available. */\n\tget available() { return this.__active < this.limit }\n\n\tprivate __done() {\n\t\tthis.__active--;\n\n\t\twhile(this.__active < this.limit && this.__waiting.length > 0) {\n\t\t\tthis.__active++;\n\t\t\tconst waiter = this.__waiting.shift();\n\t\t\tif ( waiter )\n\t\t\t\twaiter(this.__getTicket());\n\t\t}\n\t}\n\n\t/**\n\t * Get a ticket function. This ensures that a bad caller can't call\n\t * its function multiple times to mess up the active tickets count.\n\t */\n\tprivate __getTicket() {\n\t\tlet held = true;\n\t\treturn () => {\n\t\t\tif ( held ) {\n\t\t\t\theld = false;\n\t\t\t\tthis.__done();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Wait for a ticket to become available. Once a ticket is\n\t * available, returns a function that **must** be called\n\t * after you're done with the ticket to return the ticket\n\t * to the pool.\n\t */\n\twait() {\n\t\tif ( this.__active < this.limit) {\n\t\t\tthis.__active++;\n\t\t\treturn Promise.resolve(this.__getTicket());\n\t\t}\n\n\t\treturn new Promise<() => void>(resolve => this.__waiting.push(resolve));\n\t}\n}\n\n/**\n * @deprecated Renamed to TicketLock to be more accurate.\n */\nexport const Mutex = TicketLock;\n\n\ntype AnyFunction = (...args: any[]) => any;\n\n/**\n * Return a wrapper for a function that will only execute the function\n * a period of time after it has stopped being called.\n *\n * Alternatively, by setting `immediate` to true, you can have the\n * function run immediately, but then wait a period of time before\n * being able to run again.\n *\n * By setting immediate to `2`, you can have the function run\n * immediately and, after a period of time, run again as long\n * as it was called again.\n *\n * @param fn The function to wrap.\n * @param delay The time to wait, in milliseconds\n * @param immediate If immediate is true, trigger the function immediately rather than eventually.\n * @returns The wrapped function\n */\nexport function debounce<TFunc extends AnyFunction>(\n\tfn: TFunc,\n\tdelay: number,\n\timmediate: boolean | 2 = false\n) {\n\n\tlet timer: ReturnType<typeof setTimeout> | null;\n\n\tif ( immediate ) {\n\t\tconst later = () => timer = null;\n\t\tif ( immediate === 2 )\n\t\t\t// Special Mode! Run immediately OR later.\n\t\t\treturn function debouncedFunction(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\t\t\tif ( timer ) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\ttimer = null;\n\t\t\t\t\t\tfn.apply(this, args);\n\t\t\t\t\t}, delay);\n\t\t\t\t} else {\n\t\t\t\t\tfn.apply(this, args);\n\t\t\t\t\ttimer = setTimeout(later, delay);\n\t\t\t\t}\n\t\t\t}\n\n\t\treturn function(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\t\tif ( ! timer )\n\t\t\t\tfn.apply(this, args);\n\t\t\telse\n\t\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = setTimeout(later, delay);\n\t\t}\n\t}\n\n\treturn function(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\tif ( timer )\n\t\t\tclearTimeout(timer);\n\n\t\ttimer = setTimeout(fn.bind(this, ...args), delay) as any;\n\t}\n}\n\n\n/**\n * Make sure that a given asynchronous function is only called once\n * at a time.\n */\nexport function once<TFunc extends AnyFunction, TReturn = Awaited<ReturnType<TFunc>>>(fn: TFunc) {\n\tlet promise: Promise<TReturn> | undefined;\n\n\treturn function onceFunction(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>): Promise<TReturn> {\n\t\tif ( promise )\n\t\t\treturn promise;\n\n\t\ttry {\n\t\t\tpromise = Promise.resolve<TReturn>(fn.call(this, ...args));\n\t\t} catch(err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn promise.finally(() => promise = undefined);\n\t}\n}\n\n\n/**\n * Check that two arrays are the same length and that each array has the same\n * items in the same indices.\n * @param a The first array\n * @param b The second array\n * @returns Whether or not they match\n */\nexport function array_equals(a?: any[] | null, b?: any[] | null) {\n\tif ( ! Array.isArray(a) || ! Array.isArray(b) || a.length !== b.length )\n\t\treturn false;\n\n\tlet i = a.length;\n\twhile(i--)\n\t\tif ( a[i] !== b[i] )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/**\n * Determine if two objects are equal, deeply comparing their values. This\n * will recurse into the objects as necessary, and has protection against\n * recursive structures.\n *\n * @param first The first object.\n * @param second The second object.\n * @param ignore_undefined Whether or not a missing value on one object\n * should be considered equal to an `undefined` value on the other object.\n * @param first_seen For internal use.\n * @param second_seen For internal use.\n */\nexport function deep_equals(\n\tfirst: any,\n\tsecond: any,\n\tignore_undefined = false,\n\tfirst_seen?: Set<PropertyKey>,\n\tsecond_seen?: Set<PropertyKey>\n) {\n\tif ( first === second )\n\t\treturn true;\n\tif ( typeof first !== typeof second )\n\t\treturn false;\n\tif ( typeof first !== 'object' )\n\t\treturn false;\n\tif ( (first === null) !== (second === null) )\n\t\treturn false;\n\n\tif ( ! first_seen )\n\t\tfirst_seen = new Set;\n\n\tif ( ! second_seen )\n\t\tsecond_seen = new Set;\n\n\tif ( first_seen.has(first) || second_seen.has(second) )\n\t\tthrow new Error('recursive structure detected');\n\n\tfirst_seen.add(first);\n\tsecond_seen.add(second);\n\n\t// TODO: Special logic for Sets and Maps\n\n\tconst source_keys = Object.keys(first),\n\t\tdest_keys = Object.keys(second);\n\n\tif ( ! ignore_undefined && ! set_equals(new Set(source_keys), new Set(dest_keys)) )\n\t\treturn false;\n\n\tfor(const key of source_keys)\n\t\tif ( ! deep_equals(first[key], second[key], ignore_undefined, new Set(first_seen), new Set(second_seen)) )\n\t\t\treturn false;\n\n\tif ( ignore_undefined )\n\t\tfor(const key of dest_keys)\n\t\t\tif ( ! source_keys.includes(key) ) {\n\t\t\t\tif ( ! deep_equals(first[key], second[key], ignore_undefined, new Set(first_seen), new Set(second_seen)) )\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\treturn true;\n}\n\n/**\n * Determine if two objects are equal, shallowly comparing their values.\n *\n * @param first The first object\n * @param second The second object\n */\nexport function shallow_object_equals(first: any, second: any) {\n\tif ( typeof first !== 'object' || typeof second !== 'object' )\n\t\treturn false;\n\n\tconst keys = Object.keys(first);\n\tif ( ! set_equals(new Set(keys), new Set(Object.keys(second))) )\n\t\treturn false;\n\n\tfor(const key of keys)\n\t\tif ( first[key] !== second[key] )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/**\n * Determine if two Maps are equal, shallowly comparing stored values.\n * @param first The first Map\n * @param second The second Map\n */\nexport function map_equals(first: Map<any, any>, second: Map<any, any>) {\n\tif ( !(first instanceof Map) || !(second instanceof Map) || first.size !== second.size )\n\t\treturn false;\n\n\tfor(const [key, val] of first)\n\t\tif ( ! second.has(key) || second.get(key) !== val )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n/**\n * Determine if two Sets are equal, shallowly comparing stored values.\n *\n * @param first The first Set\n * @param second The second Set\n */\nexport function set_equals(first: Set<any>, second: Set<any>) {\n\tif ( !(first instanceof Set) || !(second instanceof Set) || first.size !== second.size )\n\t\treturn false;\n\n\tfor(const v of first)\n\t\tif ( ! second.has(v) )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/* **\n * Special logic to ensure that a target object is matched by a filter.\n * @param {object} filter The filter object\n * @param {object} target The object to check it against\n * @returns {boolean} Whether or not it matches\n /\nexport function filter_match(filter, target) {\n\tfor(const key in filter) {\n\t\tif ( HOP.call(filter, key) ) {\n\t\t\tconst filter_value = filter[key],\n\t\t\t\ttarget_value = target[key],\n\t\t\t\ttype = typeof filter_value;\n\n\t\t\tif ( type === 'function' ) {\n\t\t\t\tif ( ! filter_value(target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( Array.isArray(filter_value) ) {\n\t\t\t\tif ( Array.isArray(target_value) ) {\n\t\t\t\t\tfor(const val of filter_value)\n\t\t\t\t\t\tif ( ! target_value.includes(val) )\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t} else if ( ! filter_value.include(target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( typeof target_value !== type )\n\t\t\t\treturn false;\n\n\t\t\telse if ( type === 'object' ) {\n\t\t\t\tif ( ! filter_match(filter_value, target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( filter_value !== target_value )\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}*/\n\n/**\n * Return the number of times a substring is found within a string.\n * @param str The string to search within.\n * @param needle The substring to search for.\n * @returns The number of matches found.\n */\nexport function substr_count(str: string, needle: string) {\n\tlet i = 0, idx = 0;\n\twhile( idx < str.length ) {\n\t\tconst x = str.indexOf(needle, idx);\n\t\tif ( x === -1 )\n\t\t\tbreak;\n\n\t\ti++;\n\t\tidx = x + 1;\n\t}\n\n\treturn i;\n}\n\n\n// These types are all used by get()\n\n/**\n * Get a value from an object at a path.\n * @param path The path to follow, using periods to go down a level.\n * @param object The starting object.\n * @returns The value at that point in the path, or undefined if part of the path doesn't exist.\n */\nexport function get<TPath extends string, TValue = any, TReturn = ExtractType<TValue, ExtractSegments<TPath>>>(path: TPath, object: TValue): TReturn {\n\tlet segments: string | string[] = path;\n\tif ( typeof segments === 'string' ) {\n\t\tif ( HOP.call(object, segments) )\n\t\t\treturn (object as any)[segments] as TReturn;\n\n\t\tsegments = segments.split('.');\n\t}\n\n\tfor(let i=0, l = segments.length; i < l; i++) {\n\t\tconst part = segments[i];\n\t\tif ( part === '@each' ) {\n\t\t\tconst p = segments.slice(i + 1);\n\t\t\tif ( p.length ) {\n\t\t\t\tif ( Array.isArray(object) )\n\t\t\t\t\tobject = object.map(x => get(p as any, x)) as any;\n\t\t\t\telse {\n\t\t\t\t\tconst new_object: any = {};\n\t\t\t\t\tfor(const key in object)\n\t\t\t\t\t\tif ( HOP.call(object, key) )\n\t\t\t\t\t\t\tnew_object[key] = get(p as any, object[key]);\n\t\t\t\t\tobject = new_object;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\t} else if ( part === '@last' )\n\t\t\tobject = (object as any)[(object as any).length - 1] as any;\n\t\telse\n\t\t\tobject = (object as any)[part] as any;\n\n\t\tif ( ! object )\n\t\t\tbreak;\n\t}\n\n\treturn object as any;\n}\n\n\n/**\n * Copy an object so that it can be safely serialized. If an object\n * is not serializable, such as a promise, returns null.\n *\n * @export\n * @param {*} object The thing to copy.\n * @param {Number} [depth=2] The maximum depth to explore the object.\n * @param {Set} [seen=null] A Set of seen objects. Internal use only.\n * @returns {Object} The copy to safely store or use.\n */\nexport function shallow_copy<T>(object: T, depth: number = 2, seen?: Set<any>): T {\n\tif ( object == null )\n\t\treturn object;\n\n\tif ( object instanceof Promise || typeof object === 'function' )\n\t\treturn null as T;\n\n\tif ( typeof object !== 'object' )\n\t\treturn object;\n\n\tif ( depth === 0 )\n\t\treturn null as T;\n\n\tif ( ! seen )\n\t\tseen = new Set;\n\n\tseen.add(object);\n\n\tif ( Array.isArray(object) ) {\n\t\tconst out = [];\n\t\tfor(const val of object) {\n\t\t\tif ( seen.has(val) )\n\t\t\t\tcontinue;\n\n\t\t\tout.push(shallow_copy(val, depth - 1, new Set(seen)));\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tconst out = {} as Record<string, any>;\n\tfor(const [key, val] of Object.entries(object) ) {\n\t\tif ( seen.has(val) )\n\t\t\tcontinue;\n\n\t\tout[key] = shallow_copy(val, depth - 1, new Set(seen));\n\t}\n\n\treturn out as T;\n}\n\n\n/**\n * Make a clone of an object, recursing into the object to copy its\n * values as well.\n *\n * @deprecated This was written before {@link structuredClone}. We should\n * probably start using that instead for new code.\n *\n * @param object The object to clone.\n * @param seen For internal use only.\n * @returns A clone of the object.\n */\nexport function deep_copy<T>(object: T, seen?: Set<any>): T {\n\tif ( object === null )\n\t\treturn null as T;\n\telse if ( object === undefined )\n\t\treturn undefined as T;\n\n\t// Wrap the promise, just in case.\n\tif ( object instanceof Promise )\n\t\treturn new Promise((resolve, fail) => object.then(resolve).catch(fail)) as T;\n\n\t// Wrap the function, just in case.\n\tif ( typeof object === 'function' )\n\t\treturn function(this: ThisParameterType<T>, ...args: any[]) { return object.apply(this, args); } as T // eslint-disable-line no-invalid-this\n\n\tif ( object instanceof RegExp )\n\t\treturn new RegExp(object.source, object.flags) as T;\n\n\tif ( object instanceof Date )\n\t\treturn new Date(object) as T;\n\n\tif ( typeof object !== 'object' )\n\t\treturn object as T;\n\n\tif ( ! seen )\n\t\tseen = new Set;\n\n\tif ( seen.has(object) )\n\t\tthrow new Error('recursive structure detected');\n\n\tseen.add(object);\n\n\tif ( Array.isArray(object) )\n\t\treturn object.map(x => deep_copy(x, new Set(seen))) as T;\n\n\tif ( object instanceof Set ) {\n\t\tconst out = new Set<any>();\n\t\tfor(const item of object) {\n\t\t\tif ( typeof item === 'object' )\n\t\t\t\tout.add(deep_copy(item));\n\t\t\telse\n\t\t\t\tout.add(item);\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tif ( object instanceof Map ) {\n\t\tconst out = new Map<any, any>();\n\t\tfor(const [key, val] of object.entries()) {\n\t\t\tlet k = typeof key === 'object' ? deep_copy(key) : key,\n\t\t\t\tv = typeof val === 'object' ? deep_copy(val) : val;\n\n\t\t\tout.set(k, v);\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tconst out: any = {};\n\tfor(const [key, val] of Object.entries(object)) {\n\t\tif ( typeof val === 'object' )\n\t\t\tout[key] = deep_copy(val, new Set(seen));\n\t\telse\n\t\t\tout[key] = val;\n\t}\n\n\treturn out as T;\n}\n\n\n/**\n * Normalize an add-on ID to make it more suitable for comparison\n * in certain contexts, such as inclusion in emote set IDs as\n * an example.\n */\nexport function normalizeAddonIdForComparison(input: string) {\n\treturn input.toLowerCase().replace(/[\\.\\_\\-]+/, '-');\n}\n\n/**\n * Create a regular expression for detecting the presence of\n * an add-on ID within a string. This uses {@link normalizeAddonIdForComparison}\n * along with a few hard-coded exceptions for current add-ons.\n *\n * @param input The add-on ID to test for.\n */\nexport function makeAddonIdChecker(input: string) {\n\tinput = escape_regex(normalizeAddonIdForComparison(input));\n\tinput = input.replace(/-+/g, '[\\.\\_\\-]+');\n\n\t// Special: ffzap-bttv\n\tinput = input.replace(/\\bbttv\\b/g, '(?:bttv|betterttv)');\n\n\t// Special: which seven tho\n\tinput = input.replace(/\\b7tv\\b/g, '(?:7tv|seventv)');\n\n\t// Special: pronouns (badges)\n\tinput = input.replace(/\\bpronouns\\b/g, '(?:pronouns|addon-pn)');\n\n\treturn new RegExp('\\\\b' + input + '\\\\b', 'i');\n}\n\n\ntype PossibleFunction<TReturn, TThis = unknown, TArgs extends any[] = any[]> =\n\t((this: TThis, ...args: TArgs) => TReturn) | TReturn;\n\n/**\n * Resolve a value that may be either a value, or a function that returns\n * the value.\n *\n * @param input The value to resolve.\n * @param ctx A context (this) to call the potential function with.\n * @param args\n * @returns\n */\nexport function maybe_call<TReturn, TThis, TArgs extends any[]>(\n\tinput: PossibleFunction<TReturn, TThis, TArgs>,\n\tctx: TThis,\n\t...args: TArgs\n): TReturn {\n\tif ( typeof input === 'function' ) {\n\t\tif ( ctx )\n\t\t\treturn (input as any).call(ctx, ...args);\n\t\treturn (input as any)(...args);\n\t}\n\n\treturn input;\n}\n\n\nconst SPLIT_REGEX = /[^\\uD800-\\uDFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDFFF]/g;\n\n/**\n * Split an input string into individual characters. This is used when\n * performing chat message tokenization due to the difference in how\n * JavaScript strings and strings on other platforms handle length and\n * offsets.\n *\n * @param str The string to split.\n */\nexport function split_chars(str: string) {\n\tif ( str === '' )\n\t\treturn [];\n\n\treturn str.match(SPLIT_REGEX);\n}\n\n/**\n * Pick a random value from an object or array and return it.\n *\n * @param obj The object or array to pick from.\n */\nexport function pick_random<T>(obj: T[]): T;\nexport function pick_random<T extends object, K extends keyof T>(obj: T): T[K];\nexport function pick_random(obj: any) {\n\tif ( ! obj )\n\t\treturn null;\n\n\tif ( ! Array.isArray(obj) ) {\n\t\tconst keys = Object.keys(obj);\n\t\treturn obj[pick_random(keys)];\n\t}\n\n\treturn obj[Math.floor(Math.random() * obj.length)];\n}\n\n/**\n * Escape a string for inclusion in a regular expression.\n */\nexport const escape_regex: (str: string) => string = /*(RegExp as any).escape\n\t? (str: string) => ((RegExp as any).escape(` ${str}`) as string).slice(1)\n\t:*/ function escape_regex(str: string) {\n\t\treturn str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\t};\n\n\nexport function addWordSeparators(str: string) {\n\treturn `(^|.*?${WORD_SEPARATORS})(?:${str})(?=$|${WORD_SEPARATORS})`\n}\n\n\nconst CONTROL_CHARS = '/$^+.()=!|';\n\n/**\n * Convert a glob into a regular expression.\n *\n * @param input The glob to convert.\n */\nexport function glob_to_regex(input: string) {\n\tif ( typeof input !== 'string' )\n\t\tthrow new TypeError('input must be a string');\n\n\tlet output = '',\n\t\tgroups = 0;\n\n\tfor(let i=0, l=input.length; i<l; i++) {\n\t\tconst char = input[i];\n\n\t\tif ( CONTROL_CHARS.includes(char) )\n\t\t\toutput += `\\\\${char}`;\n\n\t\telse if ( char === '\\\\' ) {\n\t\t\ti++;\n\t\t\tconst next = input[i];\n\t\t\tif ( next ) {\n\t\t\t\tif ( CONTROL_CHARS.includes(next) )\n\t\t\t\t\toutput += `\\\\${next}`;\n\t\t\t\telse\n\t\t\t\t\toutput += next;\n\t\t\t}\n\n\t\t} else if ( char === '?' )\n\t\t\toutput += '.';\n\n\t\telse if ( char === '[' ) {\n\t\t\toutput += char;\n\t\t\tconst next = input[i + 1];\n\t\t\tif ( next === '!' ) {\n\t\t\t\ti++;\n\t\t\t\toutput += '^';\n\t\t\t}\n\n\t\t} else if ( char === ']' )\n\t\t\toutput += char;\n\n\t\telse if ( char === '{' ) {\n\t\t\toutput += '(?:';\n\t\t\tgroups++;\n\n\t\t} else if ( char === '}' ) {\n\t\t\tif ( groups > 0 ) {\n\t\t\t\toutput += ')';\n\t\t\t\tgroups--;\n\t\t\t}\n\n\t\t} else if ( char === ',' && groups > 0 )\n\t\t\toutput += '|';\n\n\t\telse if ( char === '*' ) {\n\t\t\tlet count = 1;\n\t\t\twhile(input[i+1] === '*') {\n\t\t\t\tcount++;\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\tif ( count > 1 )\n\t\t\t\toutput += '.*?';\n\t\t\telse\n\t\t\t\toutput += '[^\\\\s]*?';\n\n\t\t} else\n\t\t\toutput += char;\n\t}\n\n\t/*while(groups > 0) {\n\t\toutput += ')';\n\t\tgroups--;\n\t}*/\n\n\treturn output;\n}\n\n\n/**\n * Truncate a string. Tries to intelligently break the string in white-space\n * if possible, without back-tracking. The returned string can be up to\n * `ellipsis.length + target + overage` characters long.\n * @param input The string to truncate.\n * @param target The target length for the result\n * @param overage Accept up to this many additional characters for a better result\n * @param ellipsis The string to append when truncating\n * @param break_line If true, attempt to break at the first LF\n * @param trim If true, runs trim() on the string before truncating\n * @returns The truncated string\n */\nexport function truncate(\n\tinput: string,\n\ttarget: number = 100,\n\toverage: number = 15,\n\tellipsis: string = '',\n\tbreak_line: boolean = true,\n\ttrim: boolean = true\n) {\n\tif ( ! input || ! input.length )\n\t\treturn input;\n\n\tif ( trim )\n\t\tinput = input.trim();\n\n\tlet idx = break_line ? input.indexOf('\\n') : -1;\n\tif ( idx === -1 || idx > target )\n\t\tidx = target;\n\n\tif ( input.length <= idx )\n\t\treturn input;\n\n\tlet out = input.slice(0, idx).trimEnd();\n\tif ( overage > 0 && out.length >= idx ) {\n\t\tlet next_space = input.slice(idx).search(/\\s+/);\n\t\tif ( next_space === -1 && overage + idx > input.length )\n\t\t\tnext_space = input.length - idx;\n\n\t\tif ( next_space !== -1 && next_space <= overage ) {\n\t\t\tif ( input.length <= (idx + next_space) )\n\t\t\t\treturn input;\n\n\t\t\tout = input.slice(0, idx + next_space);\n\t\t}\n\t}\n\n\treturn out + ellipsis;\n}\n\n\n/**\n * Convert a number into a hexidecimal string, ensuring that the resulting\n * string is at least two characters.\n *\n * @param input The number to convert.\n */\nfunction decimalToHex(input: number) {\n\treturn input.toString(16).padStart(2, '0')\n}\n\n/**\n * Generate a random hexadecimal string of a given length. This uses\n * {@link crypto.getRandomValues} to generate randomness.\n *\n * @param length The desired string length.\n */\nexport function generateHex(length: number = 40) {\n\tconst arr = new Uint8Array(length / 2);\n\twindow.crypto.getRandomValues(arr);\n\treturn Array.from(arr, decimalToHex).join('')\n}\n\n\nexport type StringSortFn = (first: string, second: string) => number;\n\n/**\n * SourcedSet is similar to a Set, except that entries in the set are kept\n * track of based upon a `source`. This allows entries from a specific source\n * to be modified or removed without affecting entries added by other\n * sources.\n *\n * Note that this does **not** have the same API surface as a normal Set\n * and it should not be treated as such.\n *\n * This is used internally when tracking things like what emote sets or badges\n * are available in user and room contexts, with the `source` values being\n * the add-ons manipulating the data.\n *\n * @param T The type of object to hold.\n */\nexport class SourcedSet<T> {\n\n\tprivate _use_set: boolean;\n\n\t/**\n\t * The internal store used by the SourcedSet to hold its current state.\n\t * Depending on the value of `use_set` when you created the SourcedSet,\n\t * this may be either a Set or an array. This can be accessed directly\n\t * for better performance or iteration, but it should not be\n\t * modified directly.\n\t */\n\t_cache: Set<T> | T[];\n\n\tprivate _sources?: Map<string, T[]>;\n\tprivate _sorted_sources?: T[][] | null;\n\n\tprivate _sourceSortFn?: StringSortFn | null;\n\n\t/**\n\t * Create a new SourcedSet.\n\t *\n\t * @param use_set If this is set to true, use Set instances for holding\n\t * data, otherwise use arrays.\n\t *\n\t * @param T The type of object to hold.\n\t */\n\tconstructor(use_set = false, source_sorter?: StringSortFn) {\n\t\tthis._use_set = use_set;\n\t\tthis._cache = use_set ? new Set<T>() : [];\n\t\tthis._sourceSortFn = source_sorter;\n\t}\n\n\n\tresortSources() {\n\t\tthis._sorted_sources = null;\n\n\t\t// We don't need to rebuild if we have less than 2 sources\n\t\t// since sorting wouldn't change anything.\n\t\tif (this._sources && this._sources.size > 1)\n\t\t\tthis._rebuild();\n\t}\n\n\n\tsetSortFunction(fn: StringSortFn | null) {\n\t\t// If the method isn't changing, then we don't need\n\t\t// to do anything.\n\t\tif (this._sourceSortFn === fn)\n\t\t\treturn;\n\n\t\t// Set the new sort function.\n\t\tthis._sourceSortFn = fn;\n\n\t\t// And re-sort.\n\t\tthis.resortSources();\n\t}\n\n\n\t_sortSources() {\n\t\tif (!this._sources || this._sources.size === 0) {\n\t\t\tthis._sorted_sources = [];\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._sources.size === 1 || !this._sourceSortFn) {\n\t\t\tthis._sorted_sources = [...this._sources.values()];\n\t\t\treturn;\n\t\t}\n\n\t\tconst sources = [...this._sources?.entries()];\n\t\tsources.sort((a, b) => this._sourceSortFn!(a[0], b[0]));\n\n\t\tthis._sorted_sources = sources.map(entry => entry[1]);\n\t}\n\n\t/**\n\t * Trigger a rebuild of the SourcedSet. You should not need to\n\t * call this manually.\n\t */\n\t_rebuild() {\n\t\tif ( ! this._sources )\n\t\t\treturn;\n\n\t\tconst use_set = this._use_set,\n\t\t\tcache = this._cache = use_set ? new Set<T>() : ([] as T[]);\n\n\t\tif (!this._sorted_sources)\n\t\t\tthis._sortSources();\n\n\t\tfor(const items of this._sorted_sources!)\n\t\t\tfor(const i of items)\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t}\n\n\t/** Get the values added by a specific source. */\n\tget(source: string) { return this._sources && this._sources.get(source) }\n\t/** Check to see if a specific source has any values. */\n\thas(source: string) { return this._sources ? this._sources.has(source) : false }\n\n\t*iterateSources() {\n\t\tif ( this._sources )\n\t\t\tfor(const entry of this._sources)\n\t\t\t\tyield entry;\n\t}\n\n\t/** Check to see if a specific source has a specific value. */\n\tsourceIncludes(source: string, value: T) {\n\t\tconst src = this._sources && this._sources.get(source);\n\t\treturn src && src.includes(value);\n\t}\n\n\t/** Check to see if the SourcedSet contains a value. */\n\tincludes(value: T) {\n\t\treturn this._use_set\n\t\t\t? (this._cache as Set<T>).has(value)\n\t\t\t: (this._cache as T[]).includes(value);\n\t}\n\n\t/** Delete a specific source from the set. */\n\tdelete(source: string) {\n\t\tif ( this._sources && this._sources.has(source) ) {\n\t\t\tthis._sources.delete(source);\n\t\t\tthis._sorted_sources = null;\n\t\t\tthis._rebuild();\n\t\t}\n\t}\n\n\t/** Add the provided items to a specific source. */\n\textend(source: string, ...items: T[]) {\n\t\tif ( ! this._sources )\n\t\t\tthis._sources = new Map;\n\n\t\tconst existing = this._sources.get(source);\n\t\tif ( existing ) {\n\t\t\t// If there are existing items, add our new items\n\t\t\t// to the existing array.\n\t\t\tfor(const item of items)\n\t\t\t\tif (! existing.includes(item))\n\t\t\t\t\texisting.push(item);\n\n\t\t} else {\n\t\t\t// If there aren't existing items, just insert our\n\t\t\t// array into the sources list. Also, clear the\n\t\t\t// sorted sources cache.\n\t\t\tthis._sources.set(source, items);\n\t\t\tthis._sorted_sources = null;\n\t\t}\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\t// If we need sorting, do a rebuild, otherwise go ahead\n\t\t// and add the items normally.\n\t\tif ( need_sorting )\n\t\t\tthis._rebuild();\n\t\telse {\n\t\t\tconst use_set = this._use_set,\n\t\t\t\tcache = this._cache;\n\n\t\t\tfor(const i of items) {\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Set a specific source's items to the provided items,\n\t * removing any previous data in the process.\n\t */\n\tset(source: string, items: T | T[]) {\n\t\tif ( ! Array.isArray(items) )\n\t\t\titems = [items];\n\n\t\t// If we have no items, just delete the source instead.\n\t\tif ( ! items.length )\n\t\t\treturn this.delete(source);\n\n\t\tif ( ! this._sources )\n\t\t\tthis._sources = new Map;\n\n\t\tconst existing = this._sources.has(source);\n\t\tthis._sources.set(source, items);\n\t\tthis._sorted_sources = null;\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\t// If we need sorting, or if we replaced an existing source,\n\t\t// then we need a rebuild. Otherwise, go ahead and add the\n\t\t// items normally.\n\t\tif ( existing || need_sorting )\n\t\t\tthis._rebuild();\n\t\telse {\n\t\t\tconst use_set = this._use_set,\n\t\t\t\tcache = this._cache;\n\n\t\t\tfor(const i of items) {\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Add an item to a specific source. */\n\tpush(source: string, item: T) {\n\t\tif ( ! this._sources )\n\t\t\treturn this.set(source, item);\n\n\t\tconst existing = this._sources.get(source);\n\t\tif ( ! existing?.length )\n\t\t\treturn this.set(source, item);\n\n\t\telse if ( existing.includes(item) )\n\t\t\treturn;\n\n\t\texisting.push(item);\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\tif ( need_sorting )\n\t\t\tthis._rebuild();\n\t\telse if ( this._use_set )\n\t\t\t(this._cache as Set<T>).add(item);\n\t\telse if ( ! (this._cache as T[]).includes(item) )\n\t\t\t(this._cache as T[]).push(item);\n\t}\n\n\t/** Remove an item from a specific source. */\n\tremove(source: string, item: T) {\n\t\tif ( ! this._sources || ! this._sources.has(source) )\n\t\t\treturn;\n\n\t\tconst existing = this._sources.get(source),\n\t\t\tidx = existing ? existing.indexOf(item) : -1;\n\n\t\tif ( idx === -1 )\n\t\t\treturn;\n\n\t\t(existing as T[]).splice(idx, 1);\n\n\t\t// Removal always requires a rebuild.\n\t\tthis._rebuild();\n\t}\n}\n\n\n/**\n * Decode a base-64 input string into an ArrayBuffer.\n *\n * @param input The string to convert.\n */\nexport function b64ToArrayBuffer(input: string) {\n\tconst bin = atob(input),\n\t\tlen = bin.length,\n\t\tbuffer = new ArrayBuffer(len),\n\t\tview = new Uint8Array(buffer);\n\n\tfor(let i = 0, len = bin.length; i < len; i++)\n\t\tview[i] = bin.charCodeAt(i);\n\n\treturn buffer;\n}\n\n\nconst PEM_HEADER = /-----BEGIN (.+?) KEY-----/,\n\tPEM_FOOTER = /-----END (.+?) KEY-----/;\n\n/**\n * Import an RSA key that is using PEM encoding. This method will determine\n * if the key is a private key or not by searching the PEM header for\n * the string \"PRIVATE\" (case insensitive).\n *\n * If the key is a private key, it will be imported using PKCS8. If it\n * is a public key, it will be imported using SPKI.\n *\n * This uses {@link crypto.subtle.importKey} and is intended for use with\n * the Pub/Sub experiment's message signing feature.\n *\n * @param pem The certificate to import\n * @param uses The uses we will perform with this key\n */\nexport function importRsaKey(pem: string, uses: KeyUsage[] = ['verify']) {\n\tconst start_match = PEM_HEADER.exec(pem),\n\t\tend_match = PEM_FOOTER.exec(pem);\n\n\tif ( ! start_match || ! end_match || start_match[1] !== end_match[1] )\n\t\tthrow new Error('invalid key');\n\n\tconst is_private = /\\bPRIVATE\\b/i.test(start_match[1]),\n\t\tstart = start_match.index + start_match[0].length,\n\t\tend = end_match.index;\n\n\tconst content = pem.slice(start, end).replace(/\\n/g, '').trim();\n\t//console.debug('content', JSON.stringify(content));\n\n\tconst buffer = b64ToArrayBuffer(content);\n\n\treturn crypto.subtle.importKey(\n\t\tis_private ? 'pkcs8' : 'spki',\n\t\tbuffer,\n\t\t{\n\t\t\tname: \"RSA-PSS\",\n\t\t\thash: \"SHA-256\"\n\t\t},\n\t\ttrue,\n\t\tuses\n\t);\n}\n\n/**\n * Perform a {@link fetch} request, and return the response JSON if\n * the request is okay, or else return `null`.\n *\n * @param url The URL to fetch\n * @param init The optional parameters to provide to fetch, if any\n * @param error_value A value to return if an error is caught,\n * defaults to `null`.\n */\nexport function fetchJSON<T>(\n\turl: URL | string,\n\tinit?: RequestInit,\n\terror_value: T | null = null\n) {\n\treturn fetch(url, init)\n\t\t.then(resp => resp.ok ? resp.json() as Promise<T> : null)\n\t\t.catch(() => error_value);\n}\n","'use strict';\n\nexport function parse(path: string) {\n\treturn parseAST({\n\t\tpath,\n\t\ti: 0\n\t});\n}\n\ntype ParseContext = {\n\tpath: string;\n\ti: number;\n}\n\nexport type PathNode = {\n\ttitle: string;\n\tkey: string;\n\tpage?: boolean;\n\ttab?: boolean;\n}\n\nfunction parseAST(ctx: ParseContext) {\n\tconst path = ctx.path,\n\t\tlength = path.length,\n\t\tout = [];\n\n\tlet token: PathNode | null = null,\n\t\traw: string | null = null;\n\n\tlet old_tab = false,\n\t\told_page = false;\n\n\twhile ( ctx.i < length ) {\n\t\tconst start = ctx.i,\n\t\t\tchar = path[start],\n\t\t\tnext = path[start + 1];\n\n\t\tif ( ! token )\n\t\t\ttoken = {} as PathNode;\n\n\t\tif ( ! raw )\n\t\t\traw = '';\n\n\t\t// JSON\n\t\tif ( char === '@' && next === '{') {\n\t\t\tctx.i++;\n\t\t\tconst tag = parseJSON(ctx);\n\t\t\tif ( tag )\n\t\t\t\tObject.assign(token, tag);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Segment End?\n\t\tconst tab = char === `~` && next === '>',\n\t\t\tpage = char === '>' && next === '>',\n\t\t\tsegment = ! page && char === '>';\n\n\t\tif ( ! segment && ! page && ! tab ) {\n\t\t\traw += char;\n\t\t\tctx.i++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// We're at the end of a segment, so push\n\t\t// the token out.\n\t\tif ( tab || page )\n\t\t\tctx.i++;\n\n\t\ttoken.title = raw.trim();\n\t\ttoken.key = token.title.toSnakeCase();\n\n\t\ttoken.page = old_page;\n\t\ttoken.tab = old_tab;\n\n\t\told_page = page;\n\t\told_tab = tab;\n\n\t\tout.push(token);\n\t\ttoken = raw = null;\n\t\tctx.i++;\n\t}\n\n\tif ( token && raw ) {\n\t\ttoken.title = raw.trim();\n\t\ttoken.key = token.title.toSnakeCase();\n\t\ttoken.page = old_page;\n\t\ttoken.tab = old_tab;\n\t\tout.push(token);\n\t}\n\n\treturn out;\n}\n\nfunction parseJSON(ctx: ParseContext) {\n\tconst path = ctx.path,\n\t\tlength = path.length,\n\n\t\tstart = ctx.i;\n\n\tctx.i++;\n\n\tconst stack = ['{'];\n\tlet string: string | boolean = false;\n\n\twhile ( ctx.i < length && stack.length ) {\n\t\tconst start = ctx.i,\n\t\t\tchar = path[start];\n\n\t\tif ( string ) {\n\t\t\tif ( char === '\\\\' ) {\n\t\t\t\tctx.i++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( (char === '\"' || char === \"'\") && char === string ) {\n\t\t\t\tstack.pop();\n\t\t\t\tstring = false;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif ( char === '\"' || char === \"'\" ) {\n\t\t\t\tstring = char;\n\t\t\t\tstack.push(char);\n\t\t\t}\n\n\t\t\tif ( char === '{' || char === '[' )\n\t\t\t\tstack.push(char);\n\n\t\t\tif ( char === ']' ) {\n\t\t\t\tif ( stack.pop() !== '[' )\n\t\t\t\t\tthrow new SyntaxError('Invalid JSON');\n\t\t\t}\n\n\t\t\tif ( char === '}' ) {\n\t\t\t\tif ( stack.pop() !== '{' )\n\t\t\t\t\tthrow new SyntaxError('Invalid JSON');\n\t\t\t}\n\t\t}\n\n\t\tctx.i++;\n\t}\n\n\treturn JSON.parse(path.slice(start, ctx.i));\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"204\":\"menu-md4\",\"208\":\"rich_tokens\",\"935\":\"zip\",\"2009\":\"markdown\",\"2086\":\"main-menu\",\"2348\":\"chat\",\"2597\":\"site-css-tweaks\",\"3224\":\"queries\",\"4164\":\"menu-md1\",\"6530\":\"regex\",\"7629\":\"menu-md0\",\"8163\":\"menu-md5\"}[chunkId] || chunkId) + \".js\";\n};","__webpack_require__.h = () => (\"76313c69f0d0df3a2768\")","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\nvar dataWebpackPrefix = \"frankerfacez:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t\tif (script.src.indexOf(window.location.origin + '/') !== 0) {\n\t\t\tscript.crossOrigin = \"anonymous\";\n\t\t}\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.j = 4609;","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t4609: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = globalThis[\"ffzWebpackJsonp\"] = globalThis[\"ffzWebpackJsonp\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import type { ClientVersion } from \"./types\";\n\nconst RAVEN_LEVELS: Record<number, string> = {\n\t1: 'debug',\n\t2: 'info',\n\t4: 'warn',\n\t8: 'error'\n};\n\n\nexport enum LogLevel {\n\tVerbose = 0,\n\tDebug = 1,\n\tInfo = 2,\n\tWarning = 4,\n\tError = 8,\n\tOff = 99\n}\n\nfunction readLSLevel(): number | null {\n\tconst level = localStorage.ffzLogLevel;\n\tif ( ! level )\n\t\treturn null;\n\n\tconst upper = level.toUpperCase(),\n\t\tvalue = (Logger as any)[upper];\n\n\tif ( typeof value === 'number' )\n\t\treturn value;\n\n\tif ( /^\\d+$/.test(level) )\n\t\treturn parseInt(level, 10);\n\n\treturn null;\n}\n\n\ninterface Core {\n\n\thost: string;\n\tflavor: string;\n\n};\n\n\ntype InitItem = {\n\ttime: number;\n\tcategory: string | null;\n\tmessage: string;\n\tlevel: string | number;\n}\n\n\nexport class Logger {\n\tpublic static readonly Levels = LogLevel;\n\tpublic static readonly VERBOSE = LogLevel.Verbose;\n\tpublic static readonly DEBUG = LogLevel.Debug;\n\tpublic static readonly INFO = LogLevel.Info;\n\tpublic static readonly WARN = LogLevel.Warning;\n\tpublic static readonly WARNING = LogLevel.Warning;\n\tpublic static readonly ERROR = LogLevel.Error;\n\tpublic static readonly OFF = LogLevel.Off;\n\n\tpublic static readonly DEFAULT_LEVEL = LogLevel.Info;\n\n\tname: string | null;\n\tenabled: boolean;\n\tlevel: LogLevel;\n\n\tlabel?: string;\n\n\tinit?: boolean;\n\tcaptured_init?: InitItem[];\n\n\troot: Logger;\n\tparent: Logger | null;\n\tchildren: Record<string, Logger>;\n\n\traven: any;\n\n\tconstructor(parent: Logger | null, name: string | null, level?: LogLevel | null, raven?: any) {\n\t\tthis.root = parent ? parent.root : this;\n\t\tthis.parent = parent;\n\t\tthis.name = name;\n\n\t\tif ( this.root == this ) {\n\t\t\tthis.init = false;\n\t\t\tthis.captured_init = [];\n\t\t\tthis.label = 'FFZ';\n\t\t}\n\n\t\tthis.enabled = true;\n\t\tthis.level = level ?? (parent && parent.level) ?? readLSLevel() ?? Logger.DEFAULT_LEVEL;\n\t\tthis.raven = raven || (parent && parent.raven);\n\n\t\tthis.children = {};\n\t}\n\n\t/** @internal */\n\thi(core: Core, version?: ClientVersion) {\n\t\tconst VER = version ?? (core.constructor as any)?.version_info;\n\t\tthis.info(`FrankerFaceZ v${VER} (s:${core.host} f:${core.flavor} b:${VER?.build} c:${VER?.commit || 'null'})`);\n\n\t\ttry {\n\t\t\tconst loc = new URL(location.toString());\n\t\t\tloc.search = '';\n\t\t\tthis.info(`Initial URL: ${loc}`);\n\t\t} catch(err) {\n\t\t\tthis.warn(`Unable to read location.`, err);\n\t\t}\n\t}\n\n\tget(name: string, level?: LogLevel) {\n\t\tif ( ! this.children[name] )\n\t\t\tthis.children[name] = new Logger(this, (this.name ? `${this.name}.${name}` : name), level);\n\n\t\treturn this.children[name];\n\t}\n\n\tverbose(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(LogLevel.Verbose, message, optionalParams);\n\t}\n\n\tverboseColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.VERBOSE, message, colors, optionalParams);\n\t}\n\n\tdebug(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.DEBUG, message, optionalParams);\n\t}\n\n\tdebugColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.DEBUG, message, colors, optionalParams);\n\t}\n\n\tinfo(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.INFO, message, optionalParams);\n\t}\n\n\tinfoColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.INFO, message, colors, optionalParams);\n\t}\n\n\twarn(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.WARN, message, optionalParams);\n\t}\n\n\twarnColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.WARN, message, colors, optionalParams);\n\t}\n\n\twarning(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.WARN, message, optionalParams);\n\t}\n\n\twarningColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.WARN, message, colors, optionalParams);\n\t}\n\n\terror(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.ERROR, message, optionalParams);\n\t}\n\n\terrorColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.ERROR, message, colors, optionalParams);\n\t}\n\n\tcrumb(...args: any[]) {\n\t\tif ( this.raven )\n\t\t\treturn this.raven.captureBreadcrumb(...args);\n\t}\n\n\tcapture(exc: Error, opts?: any, ...args: any[]) {\n\t\tif ( this.raven ) {\n\t\t\topts = opts || {};\n\t\t\tif ( ! opts.logger )\n\t\t\t\topts.logger = this.name;\n\n\t\t\tthis.raven.captureException(exc, opts);\n\t\t}\n\n\t\tif ( args.length ) {\n\t\t\tconst msg = args.shift();\n\t\t\treturn this.error(msg, ...args);\n\t\t}\n\t}\n\n\tinvokeColor(level: number, message: any, colors: string | string[], ...optionalParams: any[]) {\n\t\tif ( ! this.enabled || level < this.level )\n\t\t\treturn;\n\n\t\tif ( ! Array.isArray(colors) )\n\t\t\tcolors = [colors];\n\n\t\t//const message = args ? Array.prototype.slice.call(args) : [];\n\n\t\tif ( level > LogLevel.Verbose ) {\n\t\t\tlet out = message;\n\t\t\tif ( typeof out === 'string' )\n\t\t\t\tout = out.replace(/%c/g, '');\n\n\t\t\tif ( optionalParams.length )\n\t\t\t\tout = `${out} ${optionalParams.join(' ')}`;\n\n\t\t\tif ( this.root.init && this.root.captured_init )\n\t\t\t\tthis.root.captured_init.push({\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tcategory: this.name,\n\t\t\t\t\tmessage: out,\n\t\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t\t});\n\n\t\t\tthis.crumb({\n\t\t\t\tmessage: out,\n\t\t\t\tcategory: this.name,\n\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t});\n\t\t}\n\n\t\tconst default_style = level < LogLevel.Info\n\t\t\t? 'color:#999999'\n\t\t\t: '';\n\n\t\tif ( this.name ) {\n\t\t\tif ( typeof message === 'string' )\n\t\t\t\tmessage = `%c${this.root.label} [%c${this.name}%c]:%c ${message}`;\n\t\t\telse {\n\t\t\t\toptionalParams.unshift(message);\n\t\t\t\tmessage = `%c${this.root.label} [%c${this.name}%c]:%c`;\n\t\t\t}\n\n\t\t\tcolors.unshift('color:#755000; font-weight:bold', default_style, 'color:#755000; font-weight:bold', default_style);\n\n\t\t} else {\n\t\t\tif ( typeof message === 'string' )\n\t\t\t\tmessage = `%c${this.root.label}:%c ${message}`;\n\t\t\telse {\n\t\t\t\toptionalParams.unshift(message);\n\t\t\t\tmessage = `%c${this.root.label}:%c`;\n\t\t\t}\n\n\t\t\tcolors.unshift('color:#755000; font-weight:bold', default_style);\n\t\t}\n\n\t\tif ( level < LogLevel.Info )\n\t\t\tconsole.debug(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Warning )\n\t\t\tconsole.info(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Error )\n\t\t\tconsole.warn(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Off )\n\t\t\tconsole.error(message, ...colors, ...optionalParams);\n\t}\n\n\t/* eslint no-console: \"off\" */\n\tinvoke(level: number, message: string, optionalParams?: any[]) {\n\t\tif ( ! this.enabled || level < this.level || level >= LogLevel.Off )\n\t\t\treturn;\n\n\t\tconst result = optionalParams ? [\n\t\t\tmessage,\n\t\t\t...optionalParams\n\t\t] : [message];\n\n\t\tif ( level > LogLevel.Verbose ) {\n\t\t\tconst out = result.join(' ');\n\n\t\t\tif ( this.root.init && this.root.captured_init )\n\t\t\t\tthis.root.captured_init.push({\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tcategory: this.name,\n\t\t\t\t\tmessage: out,\n\t\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t\t});\n\n\t\t\tthis.crumb({\n\t\t\t\tmessage: out,\n\t\t\t\tcategory: this.name,\n\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t});\n\t\t}\n\n\t\t// Chrome removed any sort of special styling from debug\n\t\t// logging, so let's add our own to make them visually distinct.\n\t\tconst default_style = level < LogLevel.Info\n\t\t\t? 'color:#999999'\n\t\t\t: '';\n\n\t\t// If we're adding our own style, we need to grab as many of\n\t\t// the strings as we can.\n\t\tlet strings = '';\n\t\tif ( default_style !== '' ) {\n\t\t\twhile(result.length > 0 && typeof result[0] === 'string') {\n\t\t\t\tstrings += ' ' + result.shift();\n\t\t\t}\n\t\t}\n\n\t\tif ( this.name ) {\n\t\t\tresult.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${strings}`, 'color:#755000; font-weight:bold', default_style, 'color:#755000; font-weight:bold', default_style);\n\t\t} else\n\t\t\tresult.unshift(`%c${this.root.label}:%c${strings}`, 'color:#755000; font-weight:bold', default_style);\n\n\t\tif ( level < LogLevel.Info )\n\t\t\tconsole.debug(...result);\n\n\t\telse if ( level < LogLevel.Warning )\n\t\t\tconsole.info(...result);\n\n\t\telse if ( level < LogLevel.Error )\n\t\t\tconsole.warn(...result);\n\n\t\telse if ( level < LogLevel.Off )\n\t\t\tconsole.error(...result);\n\t}\n}\n\nexport default Logger;\n","\n/** A union of the various Blob types that are supported. */\nexport type BlobLike = Blob | File | ArrayBuffer | Uint8Array;\n\n/** A union of the various serialized blob types. */\nexport type SerializedBlobLike = SerializedBlob | SerializedFile | SerializedArrayBuffer | SerializedUint8Array;\n\n/** A serialized {@link Blob} representation. */\nexport type SerializedBlob = {\n\ttype: 'blob';\n\tmime: string;\n\tbuffer: ArrayBuffer\n};\n\n/** A serialized {@link File} representation. */\nexport type SerializedFile = {\n\ttype: 'file';\n\tmime: string;\n\tname: string;\n\tmodified: number;\n\tbuffer: ArrayBuffer\n};\n\n/** A serialized {@link ArrayBuffer} representation. */\nexport type SerializedArrayBuffer = {\n\ttype: 'ab';\n\tbuffer: ArrayBuffer;\n};\n\n/** A serialized {@link Uint8Array} representation. */\nexport type SerializedUint8Array = {\n\ttype: 'u8',\n\tbuffer: ArrayBuffer\n};\n\n/**\n * Determine if the provided object is a valid Blob that can be serialized\n * for transmission via a messaging API.\n */\nexport function isValidBlob(blob: any): blob is BlobLike {\n\treturn blob instanceof Blob || blob instanceof File || blob instanceof ArrayBuffer || blob instanceof Uint8Array;\n}\n\n/**\n * Serialize the provided {@link BlobLike} object into a format that can be\n * transmitted via a messaging API.\n */\nexport async function serializeBlob(blob?: BlobLike): Promise<SerializedBlobLike | null> {\n\tif ( ! blob )\n\t\treturn null;\n\n\tif ( blob instanceof Blob )\n\t\treturn {\n\t\t\ttype: 'blob',\n\t\t\tmime: blob.type,\n\t\t\tbuffer: await blob.arrayBuffer(),\n\t\t}\n\n\tif ( blob instanceof File )\n\t\treturn {\n\t\t\ttype: 'file',\n\t\t\tmime: blob.type,\n\t\t\tname: blob.name,\n\t\t\tmodified: blob.lastModified,\n\t\t\tbuffer: await blob.arrayBuffer()\n\t\t}\n\n\tif ( blob instanceof ArrayBuffer )\n\t\treturn {\n\t\t\ttype: 'ab',\n\t\t\tbuffer: blob\n\t\t}\n\n\tif ( blob instanceof Uint8Array )\n\t\treturn {\n\t\t\ttype: 'u8',\n\t\t\tbuffer: blob.buffer\n\t\t}\n\n\tthrow new TypeError('Invalid type');\n}\n\n/**\n * Deserialize the provided {@link SerializedBlobLike} object into a copy of\n * the original {@link BlobLike}.\n */\nexport function deserializeBlob(data: SerializedBlobLike): BlobLike | null {\n\tif ( ! data || ! data.type )\n\t\treturn null;\n\n\tif ( data.type === 'blob' )\n\t\treturn new Blob([data.buffer], {type: data.mime});\n\n\tif ( data.type === 'file' )\n\t\treturn new File([data.buffer], data.name, {type: data.mime, lastModified: data.modified});\n\n\tif ( data.type === 'ab' )\n\t\treturn data.buffer;\n\n\tif ( data.type === 'u8' )\n\t\treturn new Uint8Array(data.buffer);\n\n\tthrow new TypeError('Invalid type');\n}\n","'use strict';\n\nimport type Logger from \"utilities/logging\";\nimport type SettingsProfile from \"./profile\";\nimport type { SettingDefinition, SettingsTypeHandler } from \"./types\";\nimport type SettingsContext from \"./context\";\n\n// ============================================================================\n// Settings Types\n// ============================================================================\n\nconst DEFAULT = Symbol('default');\n\n\nexport const basic: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[]) {\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) )\n\t\t\t\treturn [\n\t\t\t\t\tprofile.get(key) as T,\n\t\t\t\t\t[profile.id]\n\t\t\t\t]\n\t}\n}\n\n\nexport const object_merge: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[], definition: SettingDefinition<any>, log: Logger) {\n\t\tconst values: T[] = [],\n\t\t\tsources: number[] = [];\n\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) ) {\n\t\t\t\tconst val = profile.get<T>(key);\n\t\t\t\tif ( ! val || typeof val !== 'object' ) {\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\" of type ${typeof val}. Skipping.`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tsources.push(profile.id);\n\t\t\t\tvalues.unshift(val);\n\t\t\t}\n\n\t\tif ( sources.length )\n\t\t\treturn [\n\t\t\t\tObject.assign({}, ...values),\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\ntype UnwrapArray<T> = T extends Array<infer U> ? U : T;\n\nexport const basic_array_merge: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[], definition: SettingDefinition<any>, log: Logger) {\n\t\tconst values: UnwrapArray<T>[] = [],\n\t\t\tsources: number[] = [];\n\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) ) {\n\t\t\t\tconst val = profile.get<UnwrapArray<T>>(key);\n\t\t\t\tif ( ! Array.isArray(val) ) {\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\"`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tsources.push(profile.id);\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tvalues.push(v);\n\t\t\t}\n\n\t\tif ( sources.length )\n\t\t\treturn [\n\t\t\t\tvalues,\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\nexport const array_merge: SettingsTypeHandler = {\n\tdefault(val) {\n\t\tconst values = [];\n\t\tfor(const v of val)\n\t\t\tif ( v.t !== 'inherit' && v.t !== 'skip' && v.v )\n\t\t\t\tvalues.push(v.v);\n\n\t\treturn values;\n\t},\n\n\tget<T>(\n\t\tkey: string,\n\t\tprofiles: SettingsProfile[],\n\t\tdefinition: SettingDefinition<any>,\n\t\tlog: Logger,\n\t\tctx: SettingsContext\n\t) {\n\n\t\tconst values: UnwrapArray<T>[] = [],\n\t\t\tsources: number[] = [];\n\t\tlet trailing: UnwrapArray<T>[] = [];\n\t\tlet had_value = false;\n\n\t\tlet profs: (SettingsProfile | typeof DEFAULT)[] = profiles;\n\t\tif ( definition.inherit_default )\n\t\t\tprofs = [...profiles, DEFAULT];\n\n\t\tfor(const profile of profs) {\n\t\t\tlet value;\n\t\t\tif ( profile === DEFAULT ) {\n\t\t\t\tvalue = definition.default;\n\t\t\t\tif ( typeof value === 'function' )\n\t\t\t\t\tvalue = value(ctx);\n\n\t\t\t} else if ( profile.has(key) )\n\t\t\t\tvalue = profile.get(key);\n\t\t\telse\n\t\t\t\tcontinue;\n\n\t\t\tif ( ! Array.isArray(value) ) {\n\t\t\t\tif ( profile !== DEFAULT )\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\" of type ${typeof value}. Skipping.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst trail: UnwrapArray<T>[] = [];\n\n\t\t\tif ( profile !== DEFAULT )\n\t\t\t\tsources.push(profile.id);\n\n\t\t\tlet is_trailing = false;\n\t\t\tfor(const val of value) {\n\t\t\t\thad_value = true;\n\t\t\t\tif ( val.t === 'inherit' )\n\t\t\t\t\tis_trailing = true;\n\t\t\t\telse if ( val.t === 'skip' )\n\t\t\t\t\tcontinue;\n\t\t\t\telse if ( is_trailing )\n\t\t\t\t\ttrail.push(val.v);\n\t\t\t\telse\n\t\t\t\t\tvalues.push(val.v);\n\t\t\t}\n\n\t\t\ttrailing = trail.concat(trailing);\n\n\t\t\t// If we didn't run into an inherit, don't inherit.\n\t\t\tif ( ! is_trailing && ! definition.always_inherit )\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( had_value )\n\t\t\treturn [\n\t\t\t\tvalues.concat(trailing),\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\n\nexport default {\n\tbasic,\n\tobject_merge,\n\tbasic_array_merge,\n\tarray_merge\n} as Record<string, SettingsTypeHandler>;\n","'use strict';\n\n// ============================================================================\n// Settings Contexts\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {has, get as getter, array_equals, set_equals, map_equals, deep_equals} from 'utilities/object';\n\nimport DEFINITIONS from './typehandlers';\nimport type { AllSettingsKeys, ContextData, SettingMetadata, SettingType, SettingDefinition, SettingsKeys } from './types';\nimport type SettingsManager from '.';\nimport type SettingsProfile from './profile';\nimport type { SettingsTypeMap } from 'utilities/types';\n\n/**\n * Perform a basic check of a setting's requirements to see if they changed.\n * @param {Object} definition\n * @param {Map} cache\n * @param {Map} old_cache\n * @returns Whether or not they changed.\n */\nfunction compare_requirements(\n\tdefinition: SettingDefinition<any>,\n\tcache: Map<string, unknown>,\n\told_cache: Map<string, unknown>\n) {\n\tif ( ! definition || ! Array.isArray(definition.requires) )\n\t\treturn false;\n\n\tfor(const req of definition.requires) {\n\t\tconst old_value = old_cache.get(req),\n\t\t\tnew_value = cache.get(req);\n\n\t\tif ( typeof old_value !== typeof new_value )\n\t\t\treturn true;\n\n\t\tif ( Array.isArray(old_value) && Array.isArray(new_value) ) {\n\t\t\tif ( ! array_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if ( new_value instanceof Set && old_value instanceof Set ) {\n\t\t\tif ( ! set_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if( new_value instanceof Map && old_value instanceof Map ) {\n\t\t\tif ( ! map_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if ( new_value !== old_value )\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n\nexport type SettingsContextEvents = {\n\t[K in keyof SettingsTypeMap as `changed:${K}`]: [value: SettingsTypeMap[K], old_value: SettingsTypeMap[K]];\n} & {\n\t[K in keyof SettingsTypeMap as `uses_changed:${K}`]: [uses: number[] | null, old_uses: number[] | null];\n} & {\n\tchanged: [key: SettingsKeys, value: any, old_value: any];\n\tuses_changed: [key: SettingsKeys, uses: number[] | null, old_uses: number[] | null];\n\n\tcontext_changed: [];\n\tprofiles_changed: [];\n}\n\n\n/**\n * The SettingsContext class provides a context through which to read\n * settings values in addition to emitting events when settings values\n * are changed.\n */\nexport default class SettingsContext extends EventEmitter<SettingsContextEvents> {\n\n\tparent: SettingsContext | null;\n\tmanager: SettingsManager;\n\n\torder: number[];\n\n\t/** @internal */\n\t_context: ContextData;\n\tprivate __context: ContextData = null as any;\n\n\tprivate __profiles: SettingsProfile[];\n\n\tprivate __cache: Map<SettingsKeys, unknown>;\n\tprivate __meta: Map<SettingsKeys, SettingMetadata>;\n\n\tprivate __ls_listening: boolean;\n\tprivate __ls_wanted: Map<string, Set<string>>;\n\n\tconstructor(manager: SettingsContext | SettingsManager, context?: ContextData) {\n\t\tsuper();\n\n\t\tif ( manager instanceof SettingsContext ) {\n\t\t\tthis.parent = manager;\n\t\t\tthis.manager = manager.manager;\n\n\t\t\tthis.parent.on('context_changed', this._rebuildContext, this);\n\n\t\t} else {\n\t\t\tthis.parent = null;\n\t\t\tthis.manager = manager;\n\t\t}\n\n\t\t(this.manager as any).__contexts.push(this);\n\t\tthis._context = context || {};\n\n\t\t/*this._context_objects = new Set;\n\t\tif ( context )\n\t\t\tthis._updateContext(context, undefined, undefined, new Set);*/\n\n\t\tthis.__ls_listening = false;\n\t\tthis.__ls_wanted = new Map;\n\n\t\tthis.__cache = new Map;\n\t\tthis.__meta = new Map;\n\t\tthis.__profiles = [];\n\t\tthis.order = [];\n\n\t\tthis._rebuildContext();\n\t}\n\n\tdestroy() {\n\t\tif ( this.parent )\n\t\t\tthis.parent.off('context_changed', this._rebuildContext, this);\n\n\t\tfor(const profile of this.__profiles)\n\t\t\tprofile.off('changed', this._onChanged, this);\n\n\t\tconst contexts = (this.manager as any).__contexts,\n\t\t\tidx = contexts.indexOf(this);\n\n\t\tif ( idx !== -1 )\n\t\t\tcontexts.splice(idx, 1);\n\t}\n\n\n\t// ========================================================================\n\t// Local Storage Handling\n\t// ========================================================================\n\n\t_watchLS() {\n\t\tif ( this.__ls_listening )\n\t\t\treturn;\n\n\t\tthis.__ls_listening = true;\n\t\tthis.manager.on(':ls-update', this._onLSUpdate, this);\n\t}\n\n\t_unwatchLS() {\n\t\tif ( ! this.__ls_listening )\n\t\t\treturn;\n\n\t\tthis.__ls_listening = false;\n\t\tthis.manager.off(':ls-update', this._onLSUpdate, this);\n\t}\n\n\t_onLSUpdate(key: string) {\n\t\tconst keys = this.__ls_wanted.get(`ls.${key}`);\n\t\tif ( keys )\n\t\t\tfor(const key of keys)\n\t\t\t\tthis._update(key as SettingsKeys, key as SettingsKeys, []);\n\t}\n\n\n\t// ========================================================================\n\t// State Construction\n\t// ========================================================================\n\n\t_rebuildContext() {\n\t\tthis.__context = this.parent ?\n\t\t\tObject.assign({}, this.parent.__context || this.parent._context, this._context) :\n\t\t\tthis._context;\n\n\t\t// Make sure we re-build the cache. Dependency hell.\n\t\tif ( ! this.selectProfiles() )\n\t\t\tthis.rebuildCache();\n\n\t\tthis.emit('context_changed');\n\t}\n\n\n\tselectProfiles() {\n\t\tconst new_profiles: SettingsProfile[] = [],\n\t\t\torder: number[] = this.order = [];\n\n\t\tif ( ! this.manager.disable_profiles ) {\n\t\t\tfor(const profile of this.manager.__profiles)\n\t\t\t\tif ( profile.toggled && profile.matches(this.__context) ) {\n\t\t\t\t\tnew_profiles.push(profile);\n\t\t\t\t\torder.push(profile.id);\n\t\t\t\t}\n\t\t}\n\n\t\tif ( array_equals(this.__profiles, new_profiles) )\n\t\t\treturn false;\n\n\t\tconst changed_ids = new Set;\n\n\t\tfor(const profile of this.__profiles)\n\t\t\tif ( ! new_profiles.includes(profile) ) {\n\t\t\t\tprofile.off('changed', this._onChanged, this);\n\t\t\t\tchanged_ids.add(profile.id);\n\t\t\t}\n\n\t\tfor(const profile of new_profiles)\n\t\t\tif ( ! this.__profiles.includes(profile) ) {\n\t\t\t\tprofile.on('changed', this._onChanged as any, this);\n\t\t\t\tchanged_ids.add(profile.id);\n\t\t\t}\n\n\t\tthis.__profiles = new_profiles;\n\t\tthis.emit('profiles_changed');\n\t\tthis.rebuildCache(/*changed_ids*/);\n\t\treturn true;\n\t}\n\n\n\trebuildCache() {\n\t\tconst old_cache = this.__cache,\n\t\t\told_meta = this.__meta,\n\t\t\tmeta = this.__meta = new Map;\n\n\t\tthis.__cache = new Map;\n\n\t\t// TODO: Limit the values we recalculate to ones affected by the change\n\t\t// that happened to the profiles. This is harder because of setting\n\t\t// dependencies.\n\n\t\tfor(const [key, old_value] of old_cache) {\n\t\t\tconst new_value = this.get(key),\n\t\t\t\tnew_m = meta.get(key),\n\t\t\t\told_m = old_meta.get(key),\n\t\t\t\tnew_uses = new_m ? new_m.uses : null,\n\t\t\t\told_uses = old_m ? old_m.uses : null;\n\n\t\t\tconst definition = this.manager.definitions.get(key);\n\t\t\tlet changed = false;\n\n\t\t\tif ( ! Array.isArray(definition) && definition?.equals ) {\n\t\t\t\tif ( definition.equals === 'requirements' )\n\t\t\t\t\tchanged = compare_requirements(definition, this.__cache, old_cache);\n\t\t\t\telse if ( typeof definition.equals === 'function' )\n\t\t\t\t\tchanged = ! definition.equals(new_value, old_value, this.__cache, old_cache);\n\t\t\t}\n\n\t\t\telse if ( Array.isArray(new_value) && Array.isArray(old_value) )\n\t\t\t\tchanged = ! array_equals(new_value, old_value);\n\n\t\t\telse if ( new_value instanceof Set && old_value instanceof Set )\n\t\t\t\tchanged = ! set_equals(new_value, old_value);\n\n\t\t\telse if ( new_value instanceof Map && old_value instanceof Map )\n\t\t\t\tchanged = ! map_equals(new_value, old_value);\n\n\t\t\telse if ( new_value !== old_value )\n\t\t\t\tchanged = true;\n\n\t\t\tif ( changed ) {\n\t\t\t\tthis.emit('changed', key, new_value, old_value);\n\t\t\t\tthis.emit(`changed:${key}`, new_value, old_value as any);\n\t\t\t}\n\n\t\t\tif ( ! array_equals(new_uses, old_uses) ) {\n\t\t\t\tthis.emit('uses_changed', key, new_uses, old_uses);\n\t\t\t\tthis.emit(`uses_changed:${key}`, new_uses, old_uses);\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Context Control\n\t// ========================================================================\n\n\tcontext(context: ContextData) {\n\t\treturn new SettingsContext(this, context);\n\t}\n\n\n\tupdateContext(context: ContextData) {\n\t\tlet changed = false;\n\n\t\tfor(const key in context)\n\t\t\tif ( has(context, key) ) {\n\t\t\t\tconst val = context[key];\n\t\t\t\ttry {\n\t\t\t\t\tif ( deep_equals(val, this._context[key]) )\n\t\t\t\t\t\tcontinue;\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t\t// This can catch a recursive structure error.\n\t\t\t\t}\n\n\t\t\t\tthis._context[key] = val as any;\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\tif ( changed )\n\t\t\tthis._rebuildContext();\n\t}\n\n\n\t/*_updateContext(context, prefix, keys, changed) {\n\t\tif ( ! context || typeof context !== 'object' )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = Object.keys(context);\n\n\t\tif ( prefix && this._context_objects.has(prefix) ) {\n\t\t\tfor(const key of Object.keys(this._context) )\n\t\t\t\tif ( key.startsWith(prefix) ) {\n\t\t\t\t\tconst partial_key = key.substr(prefix.length);\n\t\t\t\t\tif ( ! keys.includes(partial_key) )\n\t\t\t\t\t\tkeys.push(partial_key);\n\t\t\t\t}\n\t\t}\n\n\t\tif ( prefix )\n\t\t\tthis._context_objects.add(prefix);\n\n\t\tfor(const key of keys) {\n\t\t\tconst full_key = prefix ? `${prefix}${key}` : key,\n\t\t\t\tpref = `${full_key}.`,\n\t\t\t\told_value = this._context[full_key],\n\t\t\t\tval = context[key];\n\n\t\t\tconst keys = val && (typeof val === 'object') && Object.keys(val);\n\t\t\tif ( keys && keys.length ) {\n\t\t\t\tthis._updateContext(val, pref, keys, changed);\n\n\t\t\t} else if ( this._context_objects.has(pref) ) {\n\t\t\t\tthis._updateContext({}, pref, [], changed);\n\t\t\t\tthis._context_objects.delete(pref);\n\n\t\t\t\tif ( (val || old_value) && val !== old_value ) {\n\t\t\t\t\tthis._context[full_key] = val;\n\t\t\t\t\tchanged.add(full_key);\n\t\t\t\t}\n\n\t\t\t} else if ( val !== old_value ) {\n\t\t\t\tthis._context[full_key] = val;\n\t\t\t\tchanged.add(full_key);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tupdateContext(context) {\n\t\tif ( ! context || typeof context !== 'object' )\n\t\t\treturn;\n\n\t\tconst changed = new Set;\n\t\tthis._updateContext(context, undefined, undefined, changed);\n\n\t\tif ( changed.size )\n\t\t\tthis._rebuildContext();\n\t}*/\n\n\n\tsetContext(context: ContextData) {\n\t\t//this._context_objects = new Set;\n\t\tthis._context = {};\n\t\tthis.updateContext(context);\n\t}\n\n\n\t// ========================================================================\n\t// Data Access\n\t// ========================================================================\n\n\t_onChanged(key: SettingsKeys) {\n\t\tthis._update(key, key, []);\n\t}\n\n\t_update<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, initial: SettingsKeys, visited: SettingsKeys[]) {\n\t\tif ( ! this.__cache.has(key) )\n\t\t\treturn;\n\n\t\telse if ( visited.includes(key) )\n\t\t\tthrow new Error(`cyclic dependent chain when updating setting \"${initial}\"`);\n\n\t\tvisited.push(key);\n\n\t\tconst old_value = this.__cache.get(key) as TValue | undefined,\n\t\t\told_meta = this.__meta.get(key),\n\t\t\tnew_value = this._get(key, key, []),\n\t\t\tnew_meta = this.__meta.get(key),\n\n\t\t\told_uses = old_meta ? old_meta.uses : null,\n\t\t\tnew_uses = new_meta ? new_meta.uses : null;\n\n\t\tif ( ! array_equals(new_uses, old_uses) ) {\n\t\t\tthis.emit('uses_changed', key, new_uses, old_uses);\n\t\t\tthis.emit(`uses_changed:${key}` as any, new_uses, old_uses);\n\t\t}\n\n\t\tif ( old_value === new_value )\n\t\t\treturn;\n\n\t\tthis.emit('changed', key, new_value, old_value);\n\t\tthis.emit(`changed:${key}` as any, new_value, old_value);\n\n\t\tconst definition = this.manager.definitions.get(key);\n\t\tif ( ! Array.isArray(definition) && definition?.required_by )\n\t\t\tfor(const req_key of definition.required_by)\n\t\t\t\tif ( ! req_key.startsWith('context.') && ! req_key.startsWith('ls.') )\n\t\t\t\t\tthis._update(req_key as SettingsKeys, initial, Array.from(visited));\n\t}\n\n\n\t_get<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, initial: SettingsKeys, visited: SettingsKeys[]): TValue {\n\t\tif ( visited.includes(key) )\n\t\t\tthrow new Error(`cyclic dependency when resolving setting \"${initial}\"`);\n\n\t\tvisited.push(key);\n\n\t\tconst definition = this.manager.definitions.get(key);\n\t\tconst raw_type = ! Array.isArray(definition) && definition?.type,\n\t\t\ttype = raw_type ? DEFINITIONS[raw_type] : DEFINITIONS.basic;\n\n\t\tif ( ! type )\n\t\t\tthrow new Error(`non-existent setting type \"${raw_type}\"`);\n\n\t\tconst raw_value = this._getRaw(key, type),\n\t\t\tmeta: SettingMetadata = {\n\t\t\t\tuses: raw_value ? raw_value[1] : null\n\t\t\t};\n\n\t\tlet value = raw_value ? raw_value[0] : undefined;\n\n\t\tif ( definition ) {\n\t\t\tif ( Array.isArray(definition) )\n\t\t\t\tthrow new Error(`non-existent setting \"${key}\" required when resolving setting \"${initial}\"`);\n\n\t\t\tif ( meta.uses === null ) {\n\t\t\t\tconst def_default = definition.default;\n\t\t\t\tif ( typeof def_default === 'function' )\n\t\t\t\t\tvalue = def_default(this);\n\t\t\t\telse\n\t\t\t\t\tvalue = def_default;\n\n\t\t\t\tif ( type.default )\n\t\t\t\t\tvalue = type.default(value, definition, this.manager.log);\n\t\t\t}\n\n\t\t\tif ( definition.requires )\n\t\t\t\tfor(const req_key of definition.requires)\n\t\t\t\t\tif ( req_key.startsWith('ls.') ) {\n\t\t\t\t\t\tthis._watchLS();\n\t\t\t\t\t\tlet keys = this.__ls_wanted.get(req_key);\n\t\t\t\t\t\tif ( ! keys )\n\t\t\t\t\t\t\tthis.__ls_wanted.set(req_key, keys = new Set);\n\n\t\t\t\t\t\tkeys.add(key);\n\n\t\t\t\t\t} else if ( ! req_key.startsWith('context.') && ! this.__cache.has(req_key as SettingsKeys) )\n\t\t\t\t\t\tthis._get(req_key as SettingsKeys, initial, Array.from(visited));\n\n\t\t\tif ( definition.process )\n\t\t\t\tvalue = definition.process(this, value, meta);\n\t\t}\n\n\t\tthis.__cache.set(key, value);\n\t\tthis.__meta.set(key, meta);\n\t\treturn value;\n\t}\n\n\n\t*profiles() {\n\t\tfor(const profile of this.__profiles)\n\t\t\tyield profile;\n\t}\n\n\n\thasProfile(profile: number | SettingsProfile) {\n\t\tif ( typeof profile === 'number' ) {\n\t\t\tfor(const prof of this.__profiles)\n\t\t\t\tif ( prof.id === profile )\n\t\t\t\t\treturn true;\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.__profiles.includes(profile);\n\t}\n\n\n\t_getRaw(key: SettingsKeys, type) {\n\t\tif ( ! type )\n\t\t\tthrow new Error(`non-existent type for ${key}`)\n\n\t\treturn type.get(\n\t\t\tkey,\n\t\t\tthis.profiles(),\n\t\t\tthis.manager.definitions.get(key),\n\t\t\tthis.manager.log,\n\t\t\tthis\n\t\t);\n\t}\n\n\n\t// ========================================================================\n\t// Data Access\n\t// ========================================================================\n\n\tupdate(key: SettingsKeys) {\n\t\tthis._update(key, key, []);\n\t}\n\n\tget<\n\t\tK extends AllSettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K): TValue {\n\t\tif ( key.startsWith('ls.') )\n\t\t\treturn this.manager.getLS(key.slice(3)) as TValue;\n\n\t\tif ( key.startsWith('context.') )\n\t\t\t//return this.__context[key.slice(8)];\n\t\t\treturn getter(key.slice(8), this.__context);\n\n\t\tif ( this.__cache.has(key as SettingsKeys) )\n\t\t\treturn this.__cache.get(key as SettingsKeys) as TValue;\n\n\t\treturn this._get(key as SettingsKeys, key as SettingsKeys, []);\n\t}\n\n\tgetChanges<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingsTypeMap[K]\n\t>(key: K, fn: (value: TValue, old_value: TValue | undefined) => void, ctx?: any) {\n\t\tthis.onChange(key, fn, ctx);\n\t\tfn.call(ctx, this.get(key), undefined as TValue);\n\t}\n\n\tonChange<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingsTypeMap[K]\n\t>(key: K, fn: (value: TValue, old_value: TValue) => void, ctx?: any) {\n\t\tthis.on(`changed:${key}`, fn as any, ctx);\n\t}\n\n\n\tuses(key: AllSettingsKeys) {\n\t\tif ( key.startsWith('ls.') )\n\t\t\treturn null;\n\n\t\tif ( key.startsWith('context.') )\n\t\t\treturn null;\n\n\t\tif ( ! this.__meta.has(key as SettingsKeys) )\n\t\t\tthis._get(key as SettingsKeys, key as SettingsKeys, []);\n\n\t\treturn this.__meta.get(key as SettingsKeys)?.uses ?? null;\n\t}\n}\n","'use strict';\n\nimport type { SettingDefinition, SettingProcessor, SettingUiDefinition } from \"./types\";\n\nconst BAD = Symbol('BAD');\ntype BadType = typeof BAD;\n\nfunction do_number(\n\tinput: number | BadType,\n\tdefault_value: number,\n\tdefinition: SettingUiDefinition<number>\n)  {\n\tif ( typeof input !== 'number' || isNaN(input) || ! isFinite(input) )\n\t\tinput = BAD;\n\n\tif ( input !== BAD ) {\n\t\tconst bounds = definition.bounds;\n\t\tif ( Array.isArray(bounds) ) {\n\t\t\tif ( bounds.length >= 3 ) {\n\t\t\t\t// [low, inclusive, high, inclusive]\n\t\t\t\tif ( (bounds[1] ? (input < bounds[0]) : (input <= bounds[0])) ||\n\t\t\t\t\t\t// TODO: Figure out why it doesn't like bounds[2] but bounds[3] is okay\n\t\t\t\t\t\t(bounds[3] ? (input > (bounds as any)[2]) : (input >= (bounds as any)[2])) )\n\t\t\t\t\tinput = BAD;\n\n\t\t\t} else if ( bounds.length === 2 ) {\n\t\t\t\t// [low, inclusive] or [low, high] ?\n\t\t\t\tif ( typeof bounds[1] === 'boolean' ) {\n\t\t\t\t\tif ( bounds[1] ? input < bounds[0] : input <= bounds[0] )\n\t\t\t\t\t\tinput = BAD;\n\t\t\t\t} else if ( input < bounds[0] || input > bounds[1] )\n\t\t\t\t\tinput = BAD;\n\t\t\t} else if ( bounds.length === 1 && input < bounds[0] )\n\t\t\t\tinput = BAD;\n\t\t}\n\t}\n\n\treturn input === BAD ? default_value : input;\n}\n\nexport const to_int: SettingProcessor<number> = (\n\tvalue,\n\tdefault_value,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?\\d+$/.test(value) )\n\t\tvalue = parseInt(value, 10);\n\telse if ( typeof value !== 'number' )\n\t\tvalue = BAD;\n\n\treturn do_number(value as number, default_value, definition);\n}\n\nexport const to_float: SettingProcessor<number> = (\n\tvalue: unknown,\n\tdefault_value,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?[\\d.]+$/.test(value) )\n\t\tvalue = parseFloat(value);\n\telse if ( typeof value !== 'number' )\n\t\tvalue = BAD;\n\n\treturn do_number(value as number, default_value, definition);\n}\n\n","'use strict';\n\nimport type { SettingUiDefinition, SettingValidator } from \"./types\";\n\n\nfunction do_number(value: any, definition: SettingUiDefinition<number>) {\n\tif ( typeof value !== 'number' || isNaN(value) || ! isFinite(value) )\n\t\treturn false;\n\n\tconst bounds = definition.bounds;\n\tif ( Array.isArray(bounds) ) {\n\t\tif ( bounds.length >= 3 ) {\n\t\t\t// [low, inclusive, high, inclusive]\n\t\t\tif ( (bounds[1] ? (value < bounds[0]) : (value <= bounds[0])) ||\n\t\t\t\t\t(bounds[3] ? (value > (bounds as any)[2]) : (value >= (bounds as any)[2])) )\n\t\t\t\treturn false;\n\n\t\t} else if ( bounds.length === 2 ) {\n\t\t\t// [low, inclusive] or [low, high] ?\n\t\t\tif ( typeof bounds[1] === 'boolean' ) {\n\t\t\t\tif ( bounds[1] ? value < bounds[0] : value <= bounds[0] )\n\t\t\t\t\treturn false;\n\t\t\t} else if ( value < bounds[0] || value > bounds[1] )\n\t\t\t\treturn false;\n\t\t} else if ( bounds.length === 1 && value < bounds[0] )\n\t\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport const process_to_int: SettingValidator<number> = (\n\tvalue,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?\\d+$/.test(value) )\n\t\tvalue = parseInt(value, 10);\n\telse if ( typeof value !== 'number' )\n\t\treturn false;\n\n\treturn do_number(value, definition);\n}\n\nexport const process_to_float: SettingValidator<number> = (\n\tvalue,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?[\\d.]+$/.test(value) )\n\t\tvalue = parseFloat(value);\n\telse if ( typeof value !== 'number' )\n\t\treturn false;\n\n\treturn do_number(value, definition);\n}\n","'use strict';\n\n// ============================================================================\n// Profile Filters for Settings\n// ============================================================================\n\nimport {glob_to_regex, escape_regex, matchScreen, ScreenOptions} from 'utilities/object';\nimport {FilterData, FilterType, createTester} from 'utilities/filtering';\nimport { DEBUG } from 'utilities/constants';\nimport type { ContextData } from './types';\nimport type { ScreenDetails } from 'root/types/getScreenDetails';\nimport SettingsManager from '.';\n\nlet safety: ((input: string | RegExp) => boolean) | null = null;\n\nfunction loadSafety(callback?: () => void) {\n\timport(/* webpackChunkName: 'regex' */ 'safe-regex').then(thing => {\n\t\tsafety = thing.default;\n\t\tif ( callback )\n\t\t\tcallback();\n\t})\n}\n\nconst NeverMatch = () => false;\n\n\n// Logical Components\n\nexport const Invert: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, true, false, rebuild)\n\t},\n\n\tmaxRules: 1,\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'Invert',\n\ti18n: 'settings.filter.invert',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\nexport const And: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, false, false, rebuild);\n\t},\n\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'And',\n\ti18n: 'settings.filter.and',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\nexport const Or: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, false, true, rebuild);\n\t},\n\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'Or',\n\ti18n: 'settings.filter.or',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\ntype IfData = [\n\tcondition: FilterData[],\n\tif_true: FilterData[],\n\tif_else: FilterData[]\n];\n\nexport const If: FilterType<IfData, ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\tconst cond = createTester(config[0], rule_types as any, false, false, rebuild),\n\t\t\tif_true = createTester(config[1], rule_types as any, false, false, rebuild),\n\t\t\tif_false = createTester(config[2], rule_types as any, false, false, rebuild);\n\n\t\treturn ctx => cond(ctx) ? if_true(ctx) : if_false(ctx)\n\t},\n\n\tchildRules: true,\n\ttall: true,\n\ttitle: 'If',\n\ti18n: 'settings.filter.if',\n\n\tdefault: () => [[], [], []],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/if.vue')\n};\n\nexport const Constant: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\tif ( config )\n\t\t\treturn () => true;\n\t\treturn NeverMatch;\n\t},\n\n\ttitle: 'True or False',\n\ti18n: 'settings.filter.true_false',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\n\n// Context Stuff\n\nfunction parseTime(time: string) {\n\tif ( typeof time !== 'string' || ! time.length )\n\t\treturn null;\n\n\tconst idx = time.indexOf(':');\n\tif ( idx === -1 )\n\t\treturn null;\n\n\tlet hours, minutes;\n\ttry {\n\t\thours = parseInt(time.slice(0, idx), 10);\n\t\tminutes = parseInt(time.slice(idx + 1), 10);\n\n\t} catch(err) {\n\t\treturn null;\n\t}\n\n\treturn hours * 60 + minutes;\n}\n\ntype TimeFilter = FilterType<[start: string, end: string], ContextData> & {\n\t_captured: Set<number>;\n\tcaptured: () => number[];\n};\n\nexport const Time: TimeFilter = {\n\t_captured: new Set,\n\n\tcreateTest(config) {\n\t\tconst start = parseTime(config[0]),\n\t\t\tend = parseTime(config[1]);\n\n\t\tif ( start == null || end == null )\n\t\t\treturn NeverMatch;\n\n\t\tif ( start <= end )\n\t\t\treturn () => {\n\t\t\t\tTime._captured.add(start);\n\t\t\t\tTime._captured.add(end + 1);\n\n\t\t\t\tconst d = new Date,\n\t\t\t\t\tv = d.getHours() * 60 + d.getMinutes();\n\n\t\t\t\treturn v >= start && v <= end;\n\t\t\t}\n\n\t\treturn () => {\n\t\t\tTime._captured.add(start + 1);\n\t\t\tTime._captured.add(end);\n\n\t\t\tconst d = new Date,\n\t\t\t\tv = d.getHours() * 60 + d.getMinutes();\n\n\t\t\treturn v >= start || v <= end;\n\t\t}\n\t},\n\n\tcaptured: () => {\n\t\tconst out = Array.from(Time._captured);\n\t\tTime._captured = new Set;\n\t\tout.sort((a, b) => a - b);\n\t\treturn out;\n\t},\n\n\ttitle: 'Time of Day',\n\ti18n: 'settings.filter.time',\n\n\tdefault: () => ['08:00', '18:00'],\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/time.vue')\n}\n\nexport const TheaterMode: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => {\n\t\t\tif ( ctx.fullscreen )\n\t\t\t\treturn config === false;\n\t\t\treturn ctx.ui?.theatreModeEnabled === config;\n\t\t}\n\t},\n\n\ttitle: 'Theater Mode',\n\ti18n: 'settings.filter.theater',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Fullscreen: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.fullscreen === config;\n\t},\n\n\ttitle: 'Fullscreen',\n\ti18n: 'settings.filter.fullscreen',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Moderator: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.moderator === config;\n\t},\n\n\ttitle: 'Is Moderator',\n\ti18n: 'settings.filter.moderator',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Debug: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn () => DEBUG === config;\n\t},\n\n\ttitle: 'Is Developer Mode',\n\ti18n: 'settings.filter.dev',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const AddonDebug: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.addonDev == config\n\t},\n\n\ttitle: 'Is Addon Developer Mode',\n\ti18n: 'settings.filter.addon-dev',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n}\n\nexport const SquadMode: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.ui?.squadModeEnabled === config;\n\t},\n\n\ttitle: 'Squad Mode',\n\ti18n: 'settings.filter.squad',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const NativeDarkTheme: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\tconst val = config ? 1 : 0;\n\t\treturn ctx => ctx.ui?.theme === val;\n\t},\n\n\ttitle: 'Dark Theme',\n\ti18n: 'settings.filter.native-dark',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\n// TODO: Add typing.\ntype PageData = {\n\troute: string;\n\tvalues: Record<string, string>;\n};\n\nexport const Page: FilterType<PageData, ContextData> = {\n\tcreateTest(config) {\n\t\tif ( ! config )\n\t\t\treturn NeverMatch;\n\n\t\tconst name = config.route,\n\t\t\tparts: [index: number, value: string][] = [];\n\n\t\tif ( Object.keys(config.values).length ) {\n\t\t\tconst ffz = window.FrankerFaceZ?.get(),\n\t\t\t\trouter = ffz && ffz.resolve('site.router') as any;\n\n\t\t\tif ( ! router )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tconst route = router.getRoute(name);\n\t\t\tif ( ! route || ! route.parts )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tlet i = 1;\n\t\t\tfor(const part of route.parts) {\n\t\t\t\tif ( typeof part === 'object' ) {\n\t\t\t\t\tconst val = config.values[part.name];\n\t\t\t\t\tif ( val && val.length )\n\t\t\t\t\t\tparts.push([i, val.toLowerCase()]);\n\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ctx => {\n\t\t\tif ( ! ctx.route || ! ctx.route_data || ctx.route.name !== name )\n\t\t\t\treturn false;\n\n\t\t\tfor(const [index, value] of parts) {\n\t\t\t\tlet thing = ctx.route_data[index];\n\t\t\t\tif ( typeof thing === 'string' )\n\t\t\t\t\tthing = thing.toLowerCase();\n\n\t\t\t\tif ( thing !== value )\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t},\n\n\ttall: true,\n\ttitle: 'Current Page',\n\ti18n: 'settings.filter.page',\n\n\tdefault: () => ({\n\t\troute: 'front-page',\n\t\tvalues: {}\n\t}),\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/page.vue')\n};\n\ntype ChannelData = {\n\tlogin: string | null;\n\tid: string | null;\n};\n\nexport const Channel: FilterType<ChannelData, ContextData> = {\n\tcreateTest(config) {\n\t\tconst login =  config?.login,\n\t\t\tid = config?.id;\n\n\t\tif ( ! id && ! login )\n\t\t\treturn NeverMatch;\n\n\t\telse if ( ! id )\n\t\t\treturn ctx => ctx.channel === login;\n\n\t\telse if ( ! login )\n\t\t\treturn ctx => ctx.channelID === id;\n\n\t\treturn ctx =>\n\t\t\tctx.channelID === id ||\n\t\t\t(ctx.channelID == null && ctx.channel === login);\n\t},\n\n\ttitle: 'Current Channel',\n\ti18n: 'settings.filter.channel',\n\n\tdefault: () => ({\n\t\tlogin: null,\n\t\tid: null\n\t}),\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/channel.vue')\n};\n\ntype CategoryData = {\n\tname: string | null;\n\tid: string | null;\n}\n\nexport const Category: FilterType<CategoryData, ContextData> = {\n\tcreateTest(config) {\n\t\tconst name = config?.name,\n\t\t\tid = config?.id;\n\n\t\tif ( ! id && ! name )\n\t\t\treturn NeverMatch;\n\n\t\telse if ( ! id )\n\t\t\treturn ctx => ctx.category === name;\n\n\t\telse if ( ! name )\n\t\t\treturn ctx => ctx.categoryID === id;\n\n\t\treturn ctx =>\n\t\t\tctx.categoryID === id ||\n\t\t\t(ctx.categoryID == null && ctx.category === name);\n\t},\n\n\ttitle: 'Current Category',\n\ti18n: 'settings.filter.category',\n\n\tdefault: () => ({\n\t\tname: null,\n\t\tid: null\n\t}),\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/category.vue')\n}\n\ntype TitleData = {\n\ttitle: string;\n\tmode: 'text' | 'glob' | 'raw' | 'regex';\n\tsensitive: boolean;\n};\n\nexport const Title: FilterType<TitleData, ContextData> = {\n\tcreateTest(config, _, reload) {\n\t\tconst mode = config?.mode;\n\t\tlet title = config?.title,\n\t\t\tneed_safety = true;\n\n\t\tif ( ! title || ! mode )\n\t\t\treturn NeverMatch;\n\n\t\tif ( mode === 'text' ) {\n\t\t\ttitle = escape_regex(title);\n\t\t\tneed_safety = false;\n\t\t} else if ( mode === 'glob' )\n\t\t\ttitle = glob_to_regex(title);\n\t\telse if ( mode !== 'raw' )\n\t\t\treturn NeverMatch;\n\n\t\tif ( need_safety ) {\n\t\t\tif ( ! safety )\n\t\t\t\tloadSafety(reload);\n\n\t\t\tif ( ! safety || ! safety(title) )\n\t\t\t\treturn NeverMatch;\n\t\t}\n\n\t\tlet regex: RegExp;\n\t\ttry {\n\t\t\tregex = new RegExp(title, `g${config.sensitive ? '' : 'i'}`);\n\t\t} catch(err) {\n\t\t\treturn NeverMatch;\n\t\t}\n\n\t\treturn ctx => {\n\t\t\tregex.lastIndex = 0;\n\t\t\treturn ctx.title ? regex.test(ctx.title): false;\n\t\t}\n\t},\n\n\ttitle: 'Current Title',\n\ti18n: 'settings.filter.title',\n\n\tdefault: () => ({\n\t\ttitle: '',\n\t\tmode: 'text',\n\t\tsensitive: false\n\t}),\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/title.vue')\n};\n\n// Monitor Stuff\n\ntype MonitorType = FilterType<ScreenOptions, ContextData> & {\n\t_used: boolean;\n\tdetails?: ScreenDetails | null | false;\n\n\tused: () => boolean;\n\n};\n\nexport let Monitor: MonitorType = null as any;\n\nif ( window.getScreenDetails ) {\n\n\tMonitor = {\n\t\t_used: false,\n\t\tdetails: undefined,\n\n\t\tused: () => {\n\t\t\tconst out = Monitor._used;\n\t\t\tMonitor._used = false;\n\t\t\treturn out;\n\t\t},\n\n\t\tcreateTest(config, _, reload) {\n\t\t\tif ( ! config?.label )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tMonitor._used = true;\n\t\t\tif ( reload && Monitor.details === undefined ) {\n\t\t\t\tconst FFZ = window.FrankerFaceZ ?? ((window as any).FFZBridge as any),\n\t\t\t\t\tffz = FFZ?.get(),\n\t\t\t\t\tsettings = ffz?.resolve('settings');\n\t\t\t\tif ( settings )\n\t\t\t\t\tsettings.createMonitorUpdate().then(() => {\n\t\t\t\t\t\treload();\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn () => {\n\t\t\t\tMonitor._used = true;\n\t\t\t\tconst details = Monitor.details;\n\t\t\t\tif ( ! details )\n\t\t\t\t\treturn false;\n\n\t\t\t\tconst sorted = details.screens,\n\t\t\t\t\tmatched = matchScreen(sorted, config);\n\n\t\t\t\treturn matched === details.currentScreen;\n\t\t\t};\n\t\t},\n\n\t\tdefault: () => ({\n\t\t\tlabel: null\n\t\t}),\n\n\t\ttitle: 'Current Monitor',\n\t\ti18n: 'settings.filter.monitor',\n\n\t\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/monitor.vue')\n\t};\n\n}\n","'use strict';\n\nimport { isValidBlob, deserializeBlob, serializeBlob, BlobLike, SerializedBlobLike } from 'utilities/blobs';\n\n\n// ============================================================================\n// Settings Providers\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {TicketLock, has, once} from 'utilities/object';\nimport type SettingsManager from '.';\nimport type { OptionalArray, OptionalPromise, ProviderTypeMap } from '../utilities/types';\nimport { EXTENSION } from '../utilities/constants';\n\nconst DB_VERSION = 1,\n\tNOT_WWW_TWITCH = window.location.host !== 'www.twitch.tv',\n\tNOT_WWW_YT = window.location.host !== 'www.youtube.com';\n\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ProviderEvents = {\n\t'change-provider': [];\n\t'set': [key: string, value: any, deleted: boolean];\n\t'changed': [key: string, value: any, deleted: boolean];\n\t'quota-exceeded': [error: any];\n\n\t'set-blob': [key: string, value: BlobLike | undefined, deleted: boolean];\n\t'changed-blob': [key: string, deleted: boolean];\n\t'clear-blobs': [];\n}\n\n\n// ============================================================================\n// SettingsProvider\n// ============================================================================\n\n/**\n * Base class for providers for the settings system. A provider is in charge\n * of reading and writing values from storage as well as sending events to\n * the {@link SettingsManager} when a value is changed remotely.\n */\nexport abstract class SettingsProvider extends EventEmitter<ProviderEvents> {\n\n\t// Static Stuff\n\n\tstatic priority: number = 0;\n\tstatic title: string;\n\tstatic description: string;\n\n\tstatic hasContent: () => OptionalPromise<boolean>;\n\n\n\tmanager: SettingsManager;\n\tdisabled: boolean;\n\n\tprotected ready: boolean = false;\n\n\t/**\n\t * Create a new SettingsProvider\n\t * @param {SettingsManager} manager - The manager that owns this provider.\n\t */\n\tconstructor(manager: SettingsManager) {\n\t\tsuper();\n\n\t\tthis.manager = manager;\n\t\tthis.disabled = false;\n\t}\n\n\tstatic supported() {\n\t\treturn false;\n\t}\n\n\tstatic allowTransfer = true;\n\tstatic shouldUpdate = true;\n\n\tawaitReady() {\n\t\tif ( this.ready )\n\t\t\treturn Promise.resolve();\n\n\t\treturn Promise.reject(new Error('Not Implemented'));\n\t}\n\n\tget allowTransfer() {\n\t\treturn (this.constructor as typeof SettingsProvider).allowTransfer;\n\t}\n\n\tget shouldUpdate() {\n\t\treturn (this.constructor as typeof SettingsProvider).shouldUpdate;\n\t}\n\n\tabstract broadcastTransfer(): void;\n\tabstract disableEvents(): void;\n\n\tabstract flush(): OptionalPromise<void>;\n\n\tabstract get<K extends keyof ProviderTypeMap>(\n\t\tkey: K,\n\t\tdefault_value: ProviderTypeMap[K]\n\t): ProviderTypeMap[K];\n\tabstract get<K extends keyof ProviderTypeMap>(\n\t\tkey: K\n\t): ProviderTypeMap[K] | null;\n\tabstract get<T>(\n\t\tkey: Exclude<string, keyof ProviderTypeMap>,\n\t\tdefault_value: T\n\t): T;\n\tabstract get<T>(\n\t\tkey: Exclude<string, keyof ProviderTypeMap>\n\t): T | null;\n\n\tabstract set<K extends keyof ProviderTypeMap>(key: K, value: ProviderTypeMap[K]): void;\n\tabstract set<K extends string>(key: Exclude<K, keyof ProviderTypeMap>, value: unknown): void;\n\tabstract delete(key: string): void;\n\tabstract clear(): void;\n\n\tabstract has(key: string): boolean;\n\n\tabstract keys(): Iterable<string>;\n\tabstract entries(): Iterable<[string, any]>;\n\n\tabstract get size(): number;\n\n}\n\n\nexport abstract class AdvancedSettingsProvider extends SettingsProvider {\n\n\tget supportsBlobs() { return true; }\n\n\tisValidBlob(blob: any): blob is BlobLike {\n\t\treturn this.supportsBlobs && isValidBlob(blob);\n\t}\n\n\tabstract getBlob(key: string): Promise<BlobLike | null>;\n\tabstract setBlob(key: string, value: BlobLike): Promise<void>;\n\tabstract deleteBlob(key: string): Promise<void>;\n\tabstract hasBlob(key: string): Promise<boolean>;\n\tabstract clearBlobs(): Promise<void>;\n\tabstract blobKeys(): Promise<Iterable<string>>;\n\n}\n\n\nexport abstract class RemoteSettingsProvider extends AdvancedSettingsProvider {\n\n\t// State and Storage\n\tprivate _start_time: number;\n\tprivate _cached: Map<string, any>;\n\n\tprivate _blobs: boolean | null;\n\tprivate _rpc: Map<number, [(input: any) => void, () => void]>;\n\tprivate _last_id: number;\n\n\tprivate resolved_ready: boolean;\n\tprivate _ready_wait_resolve?: (() => void) | null;\n\tprivate _ready_wait_fail?: ((err: any) => void) | null;\n\tprivate _ready_wait?: Promise<void> | null;\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tthis._start_time = performance.now();\n\n\t\tthis._rpc = new Map;\n\n\t\tthis._cached = new Map;\n\t\tthis.resolved_ready = false;\n\t\tthis.ready = false;\n\t\tthis._ready_wait = null;\n\n\t\tthis._blobs = null;\n\t\tthis._last_id = 0;\n\t}\n\n\tget supportsBlobs() {\n\t\treturn this._blobs ?? false;\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\tdisableEvents() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\n\t// Initialization\n\n\tprotected resolveReady(success: boolean, data?: any) {\n\t\tif ( this.manager )\n\t\t\tthis.manager.log.info(`${this.constructor.name} ready in ${(performance.now() - this._start_time).toFixed(5)}ms`);\n\n\t\tthis.resolved_ready = true;\n\t\tthis.ready = success;\n\n\t\tif ( success && this._ready_wait_resolve )\n\t\t\tthis._ready_wait_resolve();\n\t\telse if ( ! success && this._ready_wait_fail )\n\t\t\tthis._ready_wait_fail(data);\n\t}\n\n\tawaitReady() {\n\t\tif ( this.resolved_ready ) {\n\t\t\tif ( this.ready )\n\t\t\t\treturn Promise.resolve();\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tif ( this._ready_wait )\n\t\t\treturn this._ready_wait;\n\n\t\treturn this._ready_wait = new Promise<void>((resolve, fail) => {\n\t\t\tthis._ready_wait_resolve = resolve;\n\t\t\tthis._ready_wait_fail = fail;\n\n\t\t}).finally(() => {\n\t\t\tthis._ready_wait = null;\n\t\t\tthis._ready_wait_resolve = null;\n\t\t\tthis._ready_wait_fail = null;\n\t\t});\n\t}\n\n\n\t// Provider Methods\n\n\tget<T>(key: string, default_value?: T): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\tthis.rpc({ffz_type: 'set', key, value})\n\t\t\t.catch(err => this.manager.log.error('Error setting value', err));\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tthis._cached.delete(key);\n\t\tthis.rpc({ffz_type: 'delete', key})\n\t\t\t.catch(err => this.manager.log.error('Error deleting value', err));\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\tclear() {\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\t\tfor(const key of old_cache.keys())\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\tthis.rpc('clear')\n\t\t\t.catch(err => this.manager.log.error('Error clearing storage', err));\n\t}\n\n\thas(key: string) { return this._cached.has(key); }\n\tkeys() { return this._cached.keys(); }\n\tentries() { return this._cached.entries(); }\n\tget size() { return this._cached.size; }\n\n\tasync flush() {\n\t\tawait this.rpc('flush');\n\t}\n\n\n\t// Provider Methods: Blobs\n\n\tasync getBlob(key: string) {\n\t\tconst msg = await this.rpc({ffz_type: 'get-blob', key});\n\t\treturn msg ? deserializeBlob(msg) : null;\n\t}\n\n\tasync setBlob(key: string, value: BlobLike) {\n\t\tawait this.rpc({\n\t\t\tffz_type: 'set-blob',\n\t\t\tkey,\n\t\t\tvalue: await serializeBlob(value)\n\t\t});\n\t}\n\n\tasync deleteBlob(key: string) {\n\t\tawait this.rpc({\n\t\t\tffz_type: 'delete-blob',\n\t\t\tkey\n\t\t});\n\t}\n\n\tasync hasBlob(key: string) {\n\t\treturn this.rpc({ffz_type: 'has-blob', key});\n\t}\n\n\tasync clearBlobs() {\n\t\tawait this.rpc('clear-blobs');\n\t}\n\n\tasync blobKeys() {\n\t\treturn this.rpc('blob-keys');\n\t}\n\n\n\t// Communication\n\n\tabstract send(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>): void;\n\n\trpc<K extends keyof CorsRpcTypes>(\n\t\tmsg: K | RPCInputMessage<K>,\n\t\ttransfer?: OptionalArray<Transferable>\n\t) {\n\t\tconst id = ++this._last_id;\n\n\t\treturn new Promise<CorsOutput<K>>((resolve,fail) => {\n\t\t\tthis._rpc.set(id, [resolve, fail]);\n\t\t\tlet out: CorsMessage;\n\t\t\tif ( typeof msg === 'string' )\n\t\t\t\tout = {ffz_type: msg} as CorsMessage;\n\t\t\telse\n\t\t\t\tout = msg as unknown as CorsMessage;\n\n\t\t\tout.id = id;\n\t\t\tthis.send(out, transfer);\n\t\t});\n\t}\n\n\thandleMessage(msg: CorsMessage) {\n\t\tif ( msg.ffz_type === 'ready' )\n\t\t\tthis.rpc('init-load').then(msg => {\n\t\t\t\tthis._blobs = msg.blobs;\n\t\t\t\tfor(const [key, value] of Object.entries(msg.values))\n\t\t\t\t\tthis._cached.set(key, value);\n\n\t\t\t\tthis.resolveReady(true);\n\n\t\t\t}).catch(err => {\n\t\t\t\tthis.resolveReady(false, err);\n\t\t\t});\n\n\t\telse if ( msg.ffz_type === 'change' )\n\t\t\tthis.onChange(msg);\n\n\t\telse if ( msg.ffz_type === 'change-blob' )\n\t\t\tthis.emit('changed-blob', msg.key, msg.deleted);\n\n\t\telse if ( msg.ffz_type === 'clear-blobs' )\n\t\t\tthis.emit('clear-blobs');\n\n\t\telse if ( msg.ffz_type === 'reply' || msg.ffz_type === 'reply-error' )\n\t\t\tthis.onReply(msg);\n\n\t\telse\n\t\t\tthis.manager.log.warn('Unknown Message', msg.ffz_type, msg);\n\t}\n\n\tonChange(msg: RPCInputMessage<'change'>) {\n\t\tconst key = msg.key,\n\t\t\tvalue = msg.value,\n\t\t\tdeleted = msg.deleted;\n\n\t\tif ( deleted ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\t\t} else {\n\t\t\tthis._cached.set(key, value);\n\t\t\tthis.emit('changed', key, value, false);\n\t\t}\n\t}\n\n\tonReply(msg: CorsReplyMessage | CorsReplyErrorMessage) {\n\t\tconst id = msg.id,\n\t\t\tsuccess = msg.ffz_type === 'reply',\n\t\t\tcbs = this._rpc.get(id);\n\t\tif ( ! cbs )\n\t\t\treturn this.manager.log.warn('Received reply for unknown ID', id);\n\n\t\tthis._rpc.delete(id);\n\t\tif ( success )\n\t\t\tcbs[0](msg.reply);\n\t\telse\n\t\t\tcbs[1]();\n\t}\n}\n\n\n\n\n\n// ============================================================================\n// LocalStorage\n// ============================================================================\n\nexport class LocalStorageProvider extends SettingsProvider {\n\n\t// Static Stuff\n\tstatic priority = -1000;\n\tstatic title = 'Local Storage';\n\tstatic description = '[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.';\n\n\t// All environments that support FFZ support LocalStorage.\n\tstatic supported() {\n\t\treturn true;\n\t}\n\n\tstatic hasContent(prefix?: string) {\n\t\tif ( ! prefix )\n\t\t\tprefix = 'FFZ:setting:';\n\n\t\tfor(const key in localStorage)\n\t\t\tif ( key.startsWith(prefix) && has(localStorage, key) )\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\t// Config and Storage\n\treadonly prefix: string;\n\tprivate _cached: Map<string, any>;\n\n\t// Event Handling\n\tprivate _broadcaster?: BroadcastChannel | null;\n\tprivate _boundHandleMessage?: ((event: MessageEvent) => void) | null;\n\tprivate _boundHandleStorage?: ((event: StorageEvent) => void) | null;\n\n\tconstructor(manager: SettingsManager, prefix?: string) {\n\t\tsuper(manager);\n\t\tthis.prefix = prefix = prefix == null ? 'FFZ:setting:' : prefix;\n\n\t\tconst cache = this._cached = new Map,\n\t\t\tlen = prefix.length;\n\n\t\tfor(const key in localStorage)\n\t\t\tif ( has(localStorage, key) && key.startsWith(prefix) ) {\n\t\t\t\tconst val = localStorage.getItem(key);\n\t\t\t\tif ( val )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcache.set(key.slice(len), JSON.parse(val));\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.manager.log.warn(`unable to parse value for ${key}`, val);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\tthis.ready = true;\n\n\t\tif ( window.BroadcastChannel ) {\n\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-settings');\n\t\t\tbc.addEventListener('message',\n\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\n\t\t} else {\n\t\t\twindow.addEventListener('storage',\n\t\t\t\tthis._boundHandleStorage = this.handleStorage.bind(this));\n\t\t}\n\t}\n\n\tbroadcastTransfer() {\n\t\tthis.broadcast({type: 'change-provider'});\n\t}\n\n\tprivate removeListeners() {\n\t\tif ( this._broadcaster ) {\n\t\t\tif ( this._boundHandleMessage )\n\t\t\t\tthis._broadcaster.removeEventListener('message', this._boundHandleMessage);\n\t\t\tthis._broadcaster.close();\n\t\t\tthis._boundHandleMessage = this._broadcaster = null;\n\t\t}\n\n\t\tif ( this._boundHandleStorage ) {\n\t\t\twindow.removeEventListener('storage', this._boundHandleStorage);\n\t\t\tthis._boundHandleStorage = null;\n\t\t}\n\t}\n\n\tdisableEvents() {\n\t\tthis.removeListeners();\n\n\t\tthis.broadcast = () => {};\n\t\tthis.emit = () => {};\n\t}\n\n\tdestroy() {\n\t\tthis.disable();\n\t\tthis._cached.clear();\n\t}\n\n\tdisable() {\n\t\tthis.removeListeners();\n\t\tthis.disabled = true;\n\t}\n\n\n\tflush() { /* no-op */ } // eslint-disable-line class-methods-use-this\n\n\n\tbroadcast(msg: any) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\n\thandleMessage(event: MessageEvent) {\n\t\tif ( this.disabled || ! event.isTrusted || ! event.data )\n\t\t\treturn;\n\n\t\tthis.manager.log.debug('storage broadcast event', event.data);\n\t\tconst {type, key} = event.data;\n\n\t\tif ( type === 'change-provider') {\n\t\t\tthis.manager.log.info('Received notice of changed settings provider.');\n\t\t\tthis.emit('change-provider');\n\t\t\tthis.disable();\n\t\t\tthis.disableEvents();\n\n\t\t} else if ( type === 'set' ) {\n\t\t\tconst val = JSON.parse(localStorage.getItem(this.prefix + key) ?? 'null');\n\t\t\tthis._cached.set(key, val);\n\t\t\tthis.emit('changed', key, val, false);\n\n\t\t} else if ( type === 'delete' ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'clear' ) {\n\t\t\tconst old_keys = Array.from(this._cached.keys());\n\t\t\tthis._cached.clear();\n\t\t\tfor(const key of old_keys)\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\t\t}\n\t}\n\n\n\thandleStorage(event: StorageEvent) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis.manager.log.debug('storage event', event);\n\t\tif ( event.storageArea !== localStorage )\n\t\t\treturn;\n\n\t\tif ( event.key && event.key.startsWith(this.prefix) ) {\n\t\t\t// If value is null, the key was deleted.\n\t\t\tconst key = event.key.slice(this.prefix.length);\n\t\t\tlet val = event.newValue;\n\n\t\t\tif ( val === null ) {\n\t\t\t\tthis._cached.delete(key);\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t\t} else {\n\t\t\t\tval = JSON.parse(val);\n\t\t\t\tthis._cached.set(key, val);\n\t\t\t\tthis.emit('changed', key, val, false);\n\t\t\t}\n\t\t}\n\t}\n\n\tget<T>(\n\t\tkey: string,\n\t\tdefault_value?: T\n\t): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\ttry {\n\t\t\tlocalStorage.setItem(this.prefix + key, JSON.stringify(value));\n\t\t} catch(err) {\n\t\t\tif ( this.manager )\n\t\t\t\tthis.manager.log.error(`An error occurred while trying to save a value to localStorage for key \"${this.prefix + key}\"`);\n\n\t\t\tif ( err && /quota/i.test(err.toString()) )\n\t\t\t\tthis.emit('quota-exceeded', err);\n\n\t\t\tthrow err;\n\t\t}\n\n\t\tthis.broadcast({type: 'set', key});\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis._cached.delete(key);\n\t\tlocalStorage.removeItem(this.prefix + key);\n\t\tthis.broadcast({type: 'delete', key});\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\treturn this._cached.has(key);\n\t}\n\n\tkeys() {\n\t\treturn this._cached.keys();\n\t}\n\n\tclear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\n\t\tfor(const key of old_cache.keys()) {\n\t\t\tlocalStorage.removeItem(this.prefix + key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\t\t}\n\n\t\tthis.broadcast({type: 'clear'});\n\t}\n\n\tentries() {\n\t\treturn this._cached.entries();\n\t}\n\n\tget size() {\n\t\treturn this._cached.size;\n\t}\n}\n\n\nexport class IndexedDBProvider extends AdvancedSettingsProvider {\n\n\t// Static Stuff\n\tstatic priority = 10;\n\tstatic title = 'IndexedDB';\n\tstatic description = '[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.';\n\n\tstatic supported() {\n\t\treturn window.indexedDB != null;\n\t}\n\n\tstatic hasContent() {\n\t\treturn new Promise<boolean>((resolve) => {\n\t\t\tconst request = window.indexedDB.open('FFZ', DB_VERSION);\n\t\t\trequest.onerror = () => resolve(false);\n\n\t\t\trequest.onupgradeneeded = e => {\n\t\t\t\t// TODO: Logic to detect that the version updated.\n\t\t\t\t// Can wait to implement till we actually increment version.\n\t\t\t\tif ( e.target instanceof IDBRequest )\n\t\t\t\t\te.target.transaction?.abort();\n\n\t\t\t\tresolve(false);\n\t\t\t}\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tconst db = request.result;\n\n\t\t\t\t// We have a database, but does it contain anything?\n\t\t\t\tlet store;\n\t\t\t\ttry {\n\t\t\t\t\tconst trx = db.transaction(['settings'], 'readonly');\n\t\t\t\t\tstore = trx.objectStore('settings');\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// This indicates a bad database.\n\t\t\t\t\treturn resolve(false);\n\t\t\t\t}\n\n\t\t\t\tconst r2 = store.getAllKeys();\n\n\t\t\t\tr2.onerror = () => {\n\t\t\t\t\tdb.close();\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\n\t\t\t\tr2.onsuccess = () => {\n\t\t\t\t\tconst success = Array.isArray(r2.result) && r2.result.length > 0;\n\t\t\t\t\tdb.close();\n\t\t\t\t\treturn resolve(success);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\t// State and Storage\n\tprivate _start_time: number;\n\tprivate _cached: Map<string, any>;\n\tprivate _pending: Set<unknown> | null;\n\tprivate _flush_wait?: Promise<void> | null;\n\tprivate _flush_wait_resolve?: (() => void) | null;\n\tprivate _ready_wait?: Promise<void> | null;\n\n\tprivate _db_wait?: Promise<IDBDatabase> | null;\n\n\tprivate db?: IDBDatabase | null;\n\n\tprivate _last_tx: number = 0;\n\tprivate _lock: TicketLock;\n\n\t// Event Handling\n\tprivate _broadcaster?: BroadcastChannel | null;\n\tprivate _boundHandleMessage?: ((event: MessageEvent) => void) | null;\n\n\tconstructor(manager: SettingsManager, start: boolean = true) {\n\t\tsuper(manager);\n\n\t\tthis.getDB = once(this.getDB);\n\n\t\tthis._start_time = performance.now();\n\n\t\tthis._pending = new Set<unknown>;\n\t\tthis._flush_wait = null;\n\n\t\tthis._lock = new TicketLock();\n\n\t\tthis._cached = new Map;\n\t\tthis.ready = false;\n\t\tthis._ready_wait = null;\n\n\t\tif ( start ) {\n\t\t\tif ( window.BroadcastChannel ) {\n\t\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-settings');\n\t\t\t\tbc.addEventListener('message',\n\t\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\n\t\t\t}\n\n\t\t\tthis._ready_wait = this.loadSettings()\n\t\t\t\t.then(() => {\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.info(`IDB ready in ${(performance.now() - this._start_time).toFixed(5)}ms`);\n\t\t\t\t\tthis.ready = true;\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.error(`IDB failed after ${(performance.now() - this._start_time).toFixed(5)}ms:`, err);\n\t\t\t\t\tthis.ready = false;\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._ready_wait = null;\n\t\t\t\t});\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis.disable();\n\t\tthis._cached.clear();\n\t}\n\n\tdisable() {\n\t\tthis.disabled = true;\n\t\tthis.removeListeners();\n\n\t\tif ( this.db ) {\n\t\t\tthis.db.close();\n\t\t\tthis.db = null;\n\t\t}\n\t}\n\n\tprivate removeListeners() {\n\t\tif ( this._broadcaster ) {\n\t\t\tif ( this._boundHandleMessage )\n\t\t\t\tthis._broadcaster.removeEventListener('message', this._boundHandleMessage);\n\t\t\tthis._broadcaster.close();\n\t\t\tthis._boundHandleMessage = this._broadcaster = null;\n\t\t}\n\t}\n\n\tbroadcastTransfer() {\n\t\tthis.broadcast({type: 'change-provider'});\n\t}\n\n\tdisableEvents() {\n\t\tthis.removeListeners();\n\t\tthis.broadcast = () => {};\n\t\tthis.emit = () => {};\n\t}\n\n\n\t_onStart(obj: unknown) {\n\t\tif ( ! this._pending )\n\t\t\tthis._pending = new Set<any>;\n\n\t\tthis._pending.add(obj);\n\t}\n\n\t_onFinish(obj: unknown) {\n\t\tif ( this._pending ) {\n\t\t\tthis._pending.delete(obj);\n\n\t\t\tif ( this._pending.size )\n\t\t\t\treturn;\n\t\t}\n\n\t\tif ( this._flush_wait_resolve )\n\t\t\tthis._flush_wait_resolve();\n\t}\n\n\tflush() {\n\t\tif ( this._flush_wait )\n\t\t\treturn this._flush_wait;\n\n\t\tif ( ! this._pending || ! this._pending.size )\n\t\t\treturn Promise.resolve();\n\n\t\treturn this._flush_wait = new Promise<void>(resolve => {\n\t\t\tthis._flush_wait_resolve = resolve\n\t\t}).finally(() => {\n\t\t\tthis._flush_wait_resolve = null;\n\t\t\tthis._flush_wait = null;\n\t\t});\n\t}\n\n\n\tbroadcast(msg: any) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\n\thandleMessage(event: MessageEvent) {\n\t\tif ( this.disabled || ! event.isTrusted || ! event.data )\n\t\t\treturn;\n\n\t\tif ( this.manager )\n\t\t\tthis.manager.log.debug('storage broadcast event', event.data);\n\t\tconst {type, key} = event.data;\n\n\t\tif ( type === 'change-provider') {\n\t\t\tthis.manager.log.info('Received notice of changed settings provider.');\n\t\t\tthis.emit('change-provider');\n\t\t\tthis.disable();\n\t\t\tthis.disableEvents();\n\n\t\t} else if ( type === 'set' ) {\n\t\t\tthis._get(key).then(val => {\n\t\t\t\tthis._cached.set(key, val);\n\t\t\t\tthis.emit('changed', key, val, false);\n\t\t\t}).catch(err => this.manager && this.manager.log.error(`Error getting setting \"${key}\" from database`, err));\n\n\t\t} else if ( type === 'delete' ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'clear' ) {\n\t\t\tconst old_keys = Array.from(this._cached.keys());\n\t\t\tthis._cached.clear();\n\t\t\tfor(const key of old_keys)\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'set-blob' ) {\n\t\t\tthis.emit('changed-blob', key, false);\n\t\t} else if ( type === 'delete-blob' ) {\n\t\t\tthis.emit('changed-blob', key, true);\n\t\t} else if ( type === 'clear-blobs' ) {\n\t\t\tthis.emit('clear-blobs');\n\t\t}\n\t}\n\n\n\tawaitReady() {\n\t\tif ( this._ready_wait )\n\t\t\treturn this._ready_wait;\n\n\t\tif ( this.ready )\n\t\t\treturn Promise.resolve();\n\n\t\treturn Promise.reject();\n\t}\n\n\n\t// Synchronous Methods\n\n\tget<T>(key: string, default_value?: T): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\tthis._set(key, value)\n\t\t\t.then(() => this.broadcast({type: 'set', key}))\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error saving setting \"${key}\" to database`, err));\n\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis._cached.delete(key);\n\t\tthis._delete(key)\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error deleting setting \"${key}\" from database`, err))\n\t\t\t.then(() => this.broadcast({type: 'delete', key}));\n\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\treturn this._cached.has(key);\n\t}\n\n\tkeys() {\n\t\treturn this._cached.keys();\n\t}\n\n\tclear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\n\t\tfor(const key of old_cache.keys())\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\tthis._clear()\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error clearing database`, err))\n\t\t\t.then(() => this.broadcast({type: 'clear'}));\n\t}\n\n\tentries() {\n\t\treturn this._cached.entries();\n\t}\n\n\tget size() {\n\t\treturn this._cached.size;\n\t}\n\n\n\t// IDB Interaction\n\n\tgetDB(second = false) {\n\t\tif ( this.db )\n\t\t\treturn Promise.resolve(this.db);\n\n\t\tif ( this._db_wait )\n\t\t\treturn this._db_wait;\n\n\t\tlet this_wait: Promise<IDBDatabase>;\n\t\treturn this._db_wait = this_wait = new Promise<IDBDatabase>((resolve, reject) => {\n\n\t\t\tconst request = window.indexedDB.open('FFZ', DB_VERSION);\n\t\t\tthis._onStart(request);\n\n\t\t\trequest.onerror = event => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error opening database.', event);\n\n\t\t\t\treject(event);\n\t\t\t\tthis._onFinish(request);\n\t\t\t}\n\n\t\t\trequest.onupgradeneeded = event => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.info(`Upgrading database from version ${event.oldVersion} to ${DB_VERSION}`);\n\n\t\t\t\tconst db = request.result;\n\n\t\t\t\tdb.createObjectStore('settings', {keyPath: 'k'});\n\t\t\t\tdb.createObjectStore('blobs');\n\t\t\t}\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.info(`Database opened. (After: ${(performance.now() - this._start_time).toFixed(5)}ms)`);\n\n\t\t\t\tthis.db = request.result;\n\n\t\t\t\ttry {\n\t\t\t\t\tconst trx = this.db.transaction(['settings', 'blobs'], 'readonly');\n\t\t\t\t\ttrx.objectStore('settings');\n\t\t\t\t\ttrx.objectStore('blobs');\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// If this is an error, the database is in an invalid state.\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.error(`Database in invalid state.`, err);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.db.close();\n\t\t\t\t\t} catch(e) { /* no-op */ }\n\n\t\t\t\t\tthis._onFinish(request);\n\t\t\t\t\tthis.db = null;\n\n\t\t\t\t\tif ( second )\n\t\t\t\t\t\treject(err);\n\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Try deleting the database and making a new one.\n\t\t\t\t\t\tconst delreq = window.indexedDB.deleteDatabase('FFZ');\n\t\t\t\t\t\tthis._onStart(delreq);\n\n\t\t\t\t\t\tdelreq.onerror = event => {\n\t\t\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\t\t\tthis.manager.log.error('Error deleting invalid database.', event);\n\t\t\t\t\t\t\treject(event);\n\t\t\t\t\t\t\tthis._onFinish(delreq);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelreq.onsuccess = () => {\n\t\t\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\t\t\tthis.manager.log.info('Deleted invalid database.');\n\n\t\t\t\t\t\t\tthis._onFinish(delreq);\n\t\t\t\t\t\t\tthis._db_wait = null;\n\t\t\t\t\t\t\tthis.getDB(true)\n\t\t\t\t\t\t\t\t.then(resolve)\n\t\t\t\t\t\t\t\t.catch(reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tresolve(this.db);\n\t\t\t\tthis._onFinish(request);\n\t\t\t}\n\t\t}).finally(() => {\n\t\t\tif ( this_wait === this._db_wait )\n\t\t\t\tthis._db_wait = null;\n\t\t});\n\t}\n\n\n\tasync loadSettings() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading settings from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst request = store.getAll();\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tfor(const entry of request.result)\n\t\t\t\t\tthis._cached.set(entry.k, entry.v);\n\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\trequest.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading settings from database.', err);\n\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _getKeys() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<IDBValidKey[]>((resolve,fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading keys from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst request = store.getAllKeys();\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve(request.result);\n\t\t\t};\n\n\t\t\trequest.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading keys from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\t\t});\n\t}\n\n\n\tasync _get(key: string) {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<any>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading value from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.get(key);\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading value from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve(req.result.v);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _set(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted setting value to database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.put({k: key, v: value});\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error setting value to database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _delete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted deleting value from database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.delete(key);\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error deleting value from database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t}\n\n\n\tasync _clear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted clearing database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.clear();\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error clearing database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t}\n\n\t/* Blobs */\n\n\tasync getBlob(key: string) {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readonly'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<BlobLike>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.get(key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = e => {\n\t\t\t\tif ( isValidBlob(req.result) )\n\t\t\t\t\tresolve(req.result);\n\t\t\t\telse\n\t\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync setBlob(key: string, value: BlobLike) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( ! this.isValidBlob(value) )\n\t\t\tthrow new Error('Invalid blob type');\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.put(value, key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'set-blob', key});\n\t\t\t\tthis.emit('set-blob', key, value, false);\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync deleteBlob(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.delete(key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'delete-blob', key});\n\t\t\t\tthis.emit('set-blob', key, undefined, true);\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync hasBlob(key: string) {\n\t\tconst keys = await this.blobKeys();\n\t\treturn keys.includes(key);\n\t}\n\n\tasync clearBlobs() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = fail;\n\t\t\tconst req = store.clear();\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'clear-blobs'});\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync blobKeys() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readonly'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<string[]>((resolve, fail) => {\n\t\t\tconst req = store.getAllKeys();\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tif ( Array.isArray(req.result) )\n\t\t\t\t\tresolve(req.result as string[]);\n\t\t\t\telse\n\t\t\t\t\tfail();\n\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n}\n\n\n// ============================================================================\n// CrossOriginStorageBridge\n// ============================================================================\n\nexport class CrossOriginStorageBridge extends RemoteSettingsProvider {\n\n\t// Static Stuff\n\n\tstatic supported() { return NOT_WWW_TWITCH && NOT_WWW_YT; }\n\tstatic hasContent() {\n\t\treturn CrossOriginStorageBridge.supported();\n\t}\n\n\tstatic priority = 100;\n\tstatic title = 'Cross-Origin Storage Bridge';\n\tstatic description = 'This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don\\'t want your settings to automatically synchronize for some reason.';\n\n\tstatic allowTransfer = false;\n\tstatic shouldUpdate = false;\n\n\t// State and Storage\n\tprivate frame: HTMLIFrameElement | null;\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tconst frame = this.frame = document.createElement('iframe');\n\t\tframe.src = (this.manager.root as any).host === 'youtube' ?\n\t\t\t'//www.youtube.com/__ffz_bridge/' :\n\t\t\t'//www.twitch.tv/p/ffz_bridge/';\n\t\tframe.id = 'ffz-settings-bridge';\n\t\tframe.style.width = '0';\n\t\tframe.style.height = '0';\n\n\t\tthis.onMessage = this.onMessage.bind(this);\n\n\t\twindow.addEventListener('message', this.onMessage);\n\t\tdocument.body.appendChild(frame);\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\tdisableEvents() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\n\t// CORS Communication\n\n\tonMessage(event: MessageEvent) {\n\t\tconst msg = event.data;\n\t\tif ( ! msg || ! msg.ffz_type )\n\t\t\treturn;\n\n\t\tthis.handleMessage(msg);\n\t}\n\n\tsend(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>) {\n\t\tif ( typeof msg === 'string' )\n\t\t\tmsg = {ffz_type: msg} as any;\n\n\t\ttry {\n\t\t\t// as any, because we have an error catcher for a reason\n\t\t\t((this.frame as any).contentWindow as unknown as Window).postMessage(\n\t\t\t\tmsg,\n\t\t\t\t'*',\n\t\t\t\ttransfer ? (Array.isArray(transfer) ? transfer : [transfer]) : undefined\n\t\t\t);\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error('Error sending message to bridge.', err, msg, transfer);\n\t\t}\n\t}\n\n}\n\n\n// ============================================================================\n// ExtensionProvider\n// ============================================================================\n\nexport class ExtensionProvider extends RemoteSettingsProvider {\n\n\t// Static Stuff\n\n\tstatic supported() { return EXTENSION }\n\n\tstatic hasContent() {\n\t\tif ( ! ExtensionProvider.supported() )\n\t\t\treturn false;\n\n\t\t// We need a promise since we need to message the extension and\n\t\t// request to know if it has keys or not.\n\t\treturn new Promise<boolean>((resolve) => {\n\t\t\tlet responded = false,\n\t\t\t\ttimeout: ReturnType<typeof setTimeout> | null = null ;\n\n\t\t\tconst listener = (evt: MessageEvent<any>) => {\n\t\t\t\tif (evt.source !== window)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (evt.data && evt.data.type === 'ffz_from_ext') {\n\t\t\t\t\tconst msg = evt.data.data,\n\t\t\t\t\t\ttype = msg?.ffz_type;\n\n\t\t\t\t\tif (type === 'has-keys') {\n\t\t\t\t\t\tresponded = true;\n\t\t\t\t\t\tresolve(msg.value);\n\t\t\t\t\t\tcleanup();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst cleanup = () => {\n\t\t\t\tif (!responded) {\n\t\t\t\t\tresponded = true;\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\n\t\t\t\twindow.removeEventListener('message', listener);\n\t\t\t}\n\n\t\t\twindow.addEventListener('message', listener);\n\n\t\t\twindow.postMessage({\n\t\t\t\ttype: 'ffz_to_ext',\n\t\t\t\tdata: {\n\t\t\t\t\tffz_type: 'check-has-keys'\n\t\t\t\t}\n\t\t\t}, '*');\n\n\t\t\ttimeout = setTimeout(cleanup, 1000);\n\t\t});\n\t}\n\n\tstatic priority = 101;\n\tstatic title = 'Browser Extension Storage';\n\tstatic description = 'This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.';\n\n\tstatic allowTransfer = true;\n\tstatic shouldUpdate = true;\n\n\t// State and Storage\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tthis.onExtMessage = this.onExtMessage.bind(this);\n\t\twindow.addEventListener('message', this.onExtMessage);\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\n\t}\n\n\tdisableEvents() {\n\n\t}\n\n\t// Communication\n\n\tonExtMessage(evt: MessageEvent<any>) {\n\t\tif (evt.source !== window)\n\t\t\treturn;\n\n\t\tif (evt.data?.type === 'ffz_from_ext' && evt.data.data?.ffz_type)\n\t\t\tthis.handleMessage(evt.data.data);\n\t}\n\n\tsend(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>) {\n\t\tif ( typeof msg === 'string' )\n\t\t\tmsg = {ffz_type: msg} as any;\n\n\t\ttry {\n\t\t\twindow.postMessage(\n\t\t\t\t{\n\t\t\t\t\ttype: 'ffz_to_ext',\n\t\t\t\t\tdata: msg\n\t\t\t\t},\n\t\t\t\t'*',\n\t\t\t\ttransfer ? (Array.isArray(transfer) ? transfer : [transfer]) : undefined\n\t\t\t);\n\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error('Error sending message to extension.', err, msg, transfer);\n\t\t}\n\t}\n\n}\n\n\n\ntype CorsRpcTypes = {\n\n\t'ready': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'load': {\n\t\tinput: void;\n\t\toutput: Record<string, any>;\n\t};\n\n\t'change': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: any;\n\t\t\tdeleted: boolean;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'init-load': {\n\t\tinput: void;\n\t\toutput: {\n\t\t\tblobs: boolean;\n\t\t\tvalues: Record<string, any>;\n\t\t}\n\t};\n\n\t'set': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: any;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'delete': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'clear': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'get-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: SerializedBlobLike | null;\n\t};\n\n\t'set-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: SerializedBlobLike | null;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'change-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tdeleted: boolean;\n\t\t};\n\t\toutput: void;\n\t}\n\n\t'delete-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'has-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: boolean;\n\t};\n\n\t'clear-blobs': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'blob-keys': {\n\t\tinput: void;\n\t\toutput: string[];\n\t};\n\n\t'flush': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n};\n\ntype CorsInput<K extends keyof CorsRpcTypes> = CorsRpcTypes[K] extends { input: infer U } ? U : void;\ntype CorsOutput<K extends keyof CorsRpcTypes> = CorsRpcTypes[K] extends { output: infer U } ? U : void;\n\ntype RPCInputMessage<K extends keyof CorsRpcTypes> = {\n\tffz_type: K;\n\tid?: number;\n} & CorsInput<K>;\n\ntype CorsReplyMessage = {\n\tffz_type: 'reply';\n\tid: number;\n\treply: any;\n};\n\ntype CorsReplyErrorMessage = {\n\tffz_type: 'reply-error';\n\tid: number;\n};\n\ntype CorsMessage = CorsReplyMessage | CorsReplyErrorMessage | {\n\t[K in keyof CorsRpcTypes]: RPCInputMessage<K>\n}[keyof CorsRpcTypes];\n\n\n\n// ============================================================================\n// Available Providers Map\n// ============================================================================\n\nexport const Providers: Record<string, typeof SettingsProvider> = {\n\n\tlocal: LocalStorageProvider,\n\tidb: IndexedDBProvider,\n\tcosb: CrossOriginStorageBridge,\n\t//ext: ExtensionProvider\n\n};\n","'use strict';\n\nimport { AdvancedSettingsProvider } from \"./providers\";\nimport type { SettingsClearable } from \"./types\";\n\n// ============================================================================\n// Clearable Settings\n// ============================================================================\n\nexport const Experiments: SettingsClearable = {\n\tlabel: 'Experiment Overrides',\n\tkeys: [\n\t\t'exp-lock',\n\t\t'experiment-overrides'\n\t]\n};\n\nexport const HiddenEmotes: SettingsClearable = {\n\tlabel: 'Hidden Emotes',\n\tkeys(provider) {\n\t\tconst keys = ['emote-menu.hidden-sets'];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( key.startsWith('hidden-emotes.') )\n\t\t\t\tkeys.push(key);\n\n\t\treturn keys;\n\t}\n};\n\nexport const FavoriteEmotes: SettingsClearable = {\n\tlabel: 'Favorited Emotes',\n\tkeys(provider) {\n\t\tconst keys = [];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( key.startsWith('favorite-emotes.') )\n\t\t\t\tkeys.push(key);\n\n\t\treturn keys;\n\t}\n};\n\nexport const Overrides: SettingsClearable = {\n\tlabel: 'Name and Color Overrides',\n\tkeys: [\n\t\t'overrides.colors',\n\t\t'overrides.names'\n\t]\n};\n\nexport const Profiles: SettingsClearable = {\n\tlabel: 'Profiles',\n\tclear(provider, settings) {\n\t\tconst keys = ['profiles'];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( /^p:\\d+:/.test(key) )\n\t\t\t\tkeys.push(key);\n\n\t\tfor(const key of keys)\n\t\t\tprovider.delete(key);\n\n\t\tsettings.loadProfiles();\n\t}\n};\n\nexport const Everything: SettingsClearable = {\n\tlabel: 'Absolutely Everything',\n\tasync clear(provider, settings) {\n\t\tprovider.clear();\n\t\tif ( provider.supportsBlobs && provider instanceof AdvancedSettingsProvider )\n\t\t\tawait provider.clearBlobs();\n\n\t\tsettings.loadProfiles();\n\t}\n};\n","'use strict';\n\n// ============================================================================\n// Settings System\n// ============================================================================\n\nimport { DEBUG } from 'utilities/constants';\nimport Module, { GenericModule, buildAddonProxy } from 'utilities/module';\nimport {deep_equals, has, debounce, deep_copy, generateUUID} from 'utilities/object';\nimport {PathNode, parse as parse_path} from 'utilities/path-parser';\n\nimport SettingsProfile from './profile';\nimport SettingsContext from './context';\n\nimport * as PROCESSORS from './processors';\nimport * as VALIDATORS from './validators';\nimport * as FILTERS from './filters';\nimport * as CLEARABLES from './clearables';\n\nimport type { SettingsProfileMetadata, ContextData, ExportedFullDump, SettingsClearable, SettingDefinition, SettingProcessor, SettingUiDefinition, SettingValidator, SettingType, ExportedBlobMetadata, SettingsKeys, AllSettingsKeys, ConcreteLocalStorageData } from './types';\nimport type { FilterType } from 'utilities/filtering';\nimport { AdvancedSettingsProvider, IndexedDBProvider, LocalStorageProvider, Providers, type SettingsProvider } from './providers';\nimport type { AddonInfo, SettingsTypeMap } from 'utilities/types';\n\nexport {parse as parse_path} from 'utilities/path-parser';\n\n\n// TODO: Special types for msg.\nfunction postMessage(target: MessageEventSource, msg: any) {\n\ttry {\n\t\t(target as Window).postMessage(msg, '*');\n\t\treturn true;\n\t} catch(err) {\n\t\treturn false;\n\t}\n}\n\nexport const NO_SYNC_KEYS = ['session'];\n\n\n// ============================================================================\n// Registration\n// ============================================================================\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\tsettings: SettingsEvents;\n\t}\n\tinterface ModuleMap {\n\t\tsettings: SettingsManager;\n\t}\n}\n\n\n// ============================================================================\n// Events\n// ============================================================================\n\n// TODO: Check settings keys for better typing on events.\n\nexport type SettingsEvents = {\n\t[K in keyof SettingsTypeMap as `:changed:${K}`]: [value: SettingsTypeMap[K], old_value: SettingsTypeMap[K]];\n} & {\n\t[key: `:uses_changed:${string}`]: [uses: number[] | null, old_uses: number[] | null];\n\n\t':added-definition': [key: SettingsKeys, definition: SettingDefinition<any>];\n\t':removed-definition': [key: SettingsKeys, definition: SettingDefinition<any>];\n\n\t':quota-exceeded': [];\n\t':change-provider': [];\n\n\t':ls-update': [key: string, value: any];\n\n\t':profile-created': [profile: SettingsProfile];\n\t':profile-changed': [profile: SettingsProfile];\n\t':profile-deleted': [profile: SettingsProfile];\n\t':profile-toggled': [profile: SettingsProfile, enabled: boolean];\n\t':profiles-reordered': [];\n};\n\n\n// ============================================================================\n// SettingsManager\n// ============================================================================\n\n/**\n * The SettingsManager module creates all the necessary class instances\n * required for the settings system to operate, facilitates communication\n * and discovery, and emits events for other modules to react to.\n */\nexport default class SettingsManager extends Module<'settings', SettingsEvents> {\n\n\t_start_time: number;\n\n\t// localStorage Hooks\n\tprivate __ls_hooked: boolean;\n\tprivate __ls_scheduled: Set<string>;\n\tprivate __ls_cache: Map<string, unknown>;\n\tprivate __ls_timer?: ReturnType<typeof setTimeout> | null;\n\n\n\t// Storage of Things\n\tclearables: Record<string, SettingsClearable>;\n\tfilters: Record<string, FilterType<any, ContextData>>;\n\tprocessors: Record<string, SettingProcessor<any>>;\n\tproviders: Record<string, typeof SettingsProvider>;\n\tvalidators: Record<string, SettingValidator<any>>;\n\n\t// Storage of Settings\n\tui_structures: Map<string, SettingDefinition<any>>;\n\tdefinitions: Map<string, SettingDefinition<any> | string[]>;\n\n\t// Storage of State\n\t// The provider *can* technically be null but it won't ever be in practice.\n\t// So we don't set the type to null to avoid making annoying checks everywhere.\n\tprovider: SettingsProvider = null as any;\n\tmain_context: SettingsContext;\n\n\tprivate _context_proxies: Set<MessageEventSource>;\n\n\tprivate _update_timer?: ReturnType<typeof setTimeout> | null;\n\tprivate _time_timer?: ReturnType<typeof setTimeout> | null;\n\tprivate _time_next?: number | null;\n\n\tprivate _active_provider: string = 'local';\n\n\tprivate _provider_waiter?: Promise<SettingsProvider> | null;\n\tprivate _provider_resolve?: ((input: SettingsProvider) => void) | null;\n\n\t/** @internal */\n\t__contexts: SettingsContext[];\n\t/** @internal */\n\t__profiles: SettingsProfile[];\n\tprivate __profile_ids: Record<number, SettingsProfile | null>;\n\tprivate __profile_uuids: Record<string, SettingsProfile | null>;\n\n\t/**\n\t * Whether or not profiles have been disabled for this session\n\t */\n\tdisable_profiles: boolean = false;\n\n\tupdateSoon: () => void;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.providers = {};\n\t\tfor(const [key, provider] of Object.entries(Providers)) {\n\t\t\tif ( provider.supported() )\n\t\t\t\tthis.providers[key] = provider;\n\t\t}\n\n\t\t// This cannot be modified at a future time, as providers NEED\n\t\t// to be ready very early in FFZ intitialization. Seal it.\n\t\tObject.seal(this.providers);\n\n\t\tthis.updateSoon = debounce(() => this.updateRoutes(), 50, false);\n\n\t\t// Do we want to not enable any profiles?\n\t\ttry {\n\t\t\tconst params = new URL(window.location as any).searchParams;\n\t\t\tif ( params ) {\n\t\t\t\tif ( params.has('ffz-no-settings') )\n\t\t\t\t\tthis.disable_profiles = true;\n\t\t\t}\n\t\t} catch(err) { /* no-op */ }\n\n\t\t// Local Storage\n\t\tthis.__ls_scheduled = new Set;\n\t\tthis.__ls_cache = new Map;\n\t\tthis.__ls_hooked = false;\n\t\tthis._updateLS = this._updateLS.bind(this);\n\n\t\t// State\n\t\tthis.__contexts = [];\n\t\tthis.__profiles = [];\n\t\tthis.__profile_ids = {};\n\t\tthis.__profile_uuids = {};\n\n\t\tthis.ui_structures = new Map;\n\t\tthis.definitions = new Map;\n\n\t\t// Validators\n\t\tthis.validators = {};\n\n\t\tfor(const key in VALIDATORS)\n\t\t\tif ( has(VALIDATORS, key) )\n\t\t\t\tthis.validators[key] = VALIDATORS[key];\n\n\t\t// Processors\n\t\tthis.processors = {};\n\n\t\tfor(const key in PROCESSORS)\n\t\t\tif ( has(PROCESSORS, key) )\n\t\t\t\tthis.processors[key] = PROCESSORS[key];\n\n\t\t// Clearable Data Rules\n\t\tthis.clearables = {};\n\n\t\tfor(const key in CLEARABLES)\n\t\t\tif ( has(CLEARABLES, key) )\n\t\t\t\tthis.clearables[key] = CLEARABLES[key];\n\n\t\t// Filters\n\t\tthis.filters = {};\n\n\t\tfor(const key in FILTERS)\n\t\t\tif ( has(FILTERS, key) && FILTERS[key] )\n\t\t\t\tthis.filters[key] = FILTERS[key];\n\n\n\t\t// Create our provider as early as possible.\n\t\tthis._createProvider().then(provider => {\n\t\t\tthis.provider = provider;\n\t\t\tthis.log.info(`Using Provider: ${provider.constructor.name}`);\n\t\t\tprovider.on('changed', this._onProviderChange, this);\n\t\t\tprovider.on('quota-exceeded', (err) => {\n\t\t\t\tthis.emit(':quota-exceeded');\n\t\t\t});\n\t\t\tprovider.on('change-provider', () => {\n\t\t\t\tthis.emit(':change-provider');\n\t\t\t});\n\n\t\t\tif ( this._provider_resolve )\n\t\t\t\tthis._provider_resolve(provider);\n\t\t});\n\n\t\t//this.migrations = new MigrationManager(this);\n\n\t\t// Also create the main context as early as possible.\n\t\tthis.main_context = new SettingsContext(this);\n\n\t\tthis.main_context.on('changed', (key: keyof SettingsTypeMap, new_value, old_value) => {\n\t\t\tthis.emit(`:changed:${key}`, new_value, old_value);\n\t\t});\n\n\t\tthis.main_context.on('uses_changed', (key: keyof SettingsTypeMap, new_uses, old_uses) => {\n\t\t\tthis.emit(`:uses_changed:${key}`, new_uses, old_uses);\n\t\t});\n\n\t\tthis.main_context.on('context_changed', () => this._updateContextProxies());\n\t\tthis._context_proxies = new Set;\n\n\t\twindow.addEventListener('message', event => {\n\t\t\tconst type = event.data?.ffz_type;\n\n\t\t\tif ( type === 'open-settings' )\n\t\t\t\tthis.emit('main_menu:open');\n\n\t\t\telse if ( type === 'request-context' && event.source ) {\n\t\t\t\tthis._context_proxies.add(event.source);\n\t\t\t\tthis._updateContextProxies(event.source);\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('beforeunload', () => {\n\t\t\tfor(const proxy of this._context_proxies)\n\t\t\t\tpostMessage(proxy, {ffz_type: 'context-gone'});\n\t\t});\n\n\t\t// Don't wait around to be required.\n\t\tthis._start_time = performance.now();\n\t\tthis.enable();\n\t}\n\n\t_updateContextProxies(proxy?: MessageEventSource) {\n\t\tif ( ! proxy && ! this._context_proxies.size )\n\t\t\treturn;\n\n\t\tconst ctx = JSON.parse(JSON.stringify(this.main_context._context));\n\t\tfor(const key of NO_SYNC_KEYS)\n\t\t\tif ( has(ctx, key) )\n\t\t\t\tdelete ctx[key];\n\n\t\tif ( proxy )\n\t\t\tpostMessage(proxy, {ffz_type: 'context-update', ctx});\n\t\telse\n\t\t\tfor(const proxy of this._context_proxies)\n\t\t\t\tpostMessage(proxy, {ffz_type: 'context-update', ctx});\n\t}\n\n\n\taddFilter<T>(key: string, data: FilterType<T, ContextData>) {\n\t\tif ( this.filters[key] )\n\t\t\treturn this.log.warn('Tried to add already existing filter', key);\n\n\t\tthis.filters[key] = data;\n\t\tthis.updateRoutes();\n\t}\n\n\tgetFilterBasicEditor() { // eslint-disable-line class-methods-use-this\n\t\treturn () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = [];\n\t\tfor(const [key, value] of (this.main_context as any).__cache.entries())\n\t\t\tout.push(`${key}: ${JSON.stringify(value)}`);\n\n\t\treturn out.join('\\n');\n\t}\n\n\tawaitProvider() {\n\t\tif ( this.provider )\n\t\t\treturn Promise.resolve(this.provider);\n\n\t\tif ( this._provider_waiter )\n\t\t\treturn this._provider_waiter;\n\n\t\treturn this._provider_waiter = new Promise<SettingsProvider>((resolve, reject) => {\n\t\t\tthis._provider_resolve = resolve;\n\t\t}).finally(() => {\n\t\t\tthis._provider_waiter = null;\n\t\t\tthis._provider_resolve = null;\n\t\t});\n\t}\n\n\n\t/**\n\t * Called when the SettingsManager instance should be enabled.\n\t */\n\tasync onEnable() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\tthrow new Error('did not get provider');\n\n\t\tawait this.provider.awaitReady();\n\n\t\t// When the router updates we additional routes, make sure to\n\t\t// trigger a rebuild of profile context and re-select profiles.\n\t\tthis.on('site.router:updated-routes', this.updateRoutes, this);\n\n\t\t// Load profiles, but don't run any events because we haven't done\n\t\t// migrations yet.\n\t\tthis.loadProfiles(true);\n\n\t\t// Handle migrations.\n\t\t//await this.migrations.process('core');\n\n\t\t// Now we can tell our context(s) about the profiles we have.\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tconst duration = performance.now() - this._start_time;\n\t\tthis.log.info(`Initialization complete after ${duration.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`)\n\n\t\tthis.scheduleUpdates();\n\t\tthis.updateClock();\n\t}\n\n\n\tasync createMonitorUpdate() {\n\t\tconst Monitor = FILTERS?.Monitor;\n\t\tif ( ! Monitor || Monitor.details !== undefined )\n\t\t\treturn;\n\n\t\tMonitor.details = null;\n\t\ttry {\n\t\t\tif ( window.getScreenDetails ) {\n\t\t\t\tMonitor.details = await window.getScreenDetails();\n\t\t\t\tMonitor.details.addEventListener('currentscreenchange', () => {\n\t\t\t\t\tfor(const context of this.__contexts)\n\t\t\t\t\t\tcontext.selectProfiles();\n\t\t\t\t});\n\t\t\t} else\n\t\t\t\tMonitor.details = false;\n\n\t\t} catch(err) {\n\t\t\tthis.log.error('Unable to get monitor details', err);\n\t\t\tMonitor.details = false;\n\t\t}\n\t}\n\n\n\tupdateClock() {\n\t\tconst captured = FILTERS?.Time?.captured?.();\n\t\tif ( ! captured?.length )\n\t\t\treturn;\n\n\t\tif ( this._time_timer )\n\t\t\tclearTimeout(this._time_timer);\n\n\t\tconst d = new Date,\n\t\t\tnow = d.getHours() * 60 + d.getMinutes();\n\n\t\tlet next = this._time_next != null ? this._time_next : null;\n\t\tfor(const value of captured) {\n\t\t\tif ( value <= now )\n\t\t\t\tcontinue;\n\n\t\t\tif ( next == null || value < next )\n\t\t\t\tnext = value;\n\t\t}\n\n\t\t// There's no time waiting for today. Skip to the next day.\n\t\tif ( next == null )\n\t\t\tnext = captured[0] + 1440;\n\n\t\t// Determine how long it'll take to reach the next time period.\n\t\tconst delta = (next - now) * 60 * 1000 - 59750 + (60000 - Date.now() % 60000);\n\t\tthis._time_timer = setTimeout(() => {\n\t\t\tfor(const context of this.__contexts)\n\t\t\t\tcontext.selectProfiles();\n\n\t\t\tthis.updateClock();\n\t\t}, delta);\n\t}\n\n\n\t// ========================================================================\n\t// LocalStorage Management\n\t// ========================================================================\n\n\tprivate _updateLSKey(key: string) {\n\t\tif ( this.__ls_cache.has(key) || this.__ls_cache.has(`raw.${key}`) ) {\n\t\t\tthis.__ls_scheduled.add(key);\n\t\t\tif ( ! this.__ls_timer )\n\t\t\t\tthis.__ls_timer = setTimeout(this._updateLS, 0);\n\t\t}\n\n\n\n\t}\n\n\tprivate _hookLS() {\n\t\tif ( this.__ls_hooked )\n\t\t\treturn;\n\n\t\tthis.__ls_hooked = true;\n\t\tconst original = localStorage.setItem,\n\t\t\tt = this;\n\n\t\tlocalStorage.setItem = function(key, ...args) {\n\t\t\t// Guard this because we never want to break\n\t\t\t// localStorage, even if something really\n\t\t\t// weird happens.\n\t\t\ttry {\n\t\t\t\tt._updateLSKey(key);\n\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\treturn original.call(this, key, ...args);\n\t\t}\n\n\t\tthis._handleLSEvent = this._handleLSEvent.bind(this);\n\t\twindow.addEventListener('storage', this._handleLSEvent);\n\t}\n\n\tprivate _handleLSEvent(event: StorageEvent) {\n\t\tif ( event.key && event.storageArea === localStorage )\n\t\t\tthis._updateLSKey(event.key);\n\t}\n\n\tprivate _updateLS() {\n\t\tclearTimeout(this.__ls_timer as ReturnType<typeof setTimeout>);\n\t\tthis.__ls_timer = null;\n\t\tconst keys = this.__ls_scheduled;\n\t\tthis.__ls_scheduled = new Set;\n\n\t\tfor(const key of keys) {\n\t\t\tconst has_value = this.__ls_cache.has(key),\n\t\t\t\traw_key = `raw.${key}`,\n\t\t\t\thas_raw = this.__ls_cache.has(raw_key);\n\n\t\t\tif ( ! has_raw && ! has_value )\n\t\t\t\tcontinue;\n\n\t\t\tconst raw = localStorage.getItem(key);\n\n\t\t\tif ( has_raw ) {\n\t\t\t\tthis.__ls_cache.set(raw_key, raw);\n\t\t\t\tthis.emit(':ls-update', raw_key, raw);\n\t\t\t}\n\n\t\t\tif ( has_value ) {\n\t\t\t\tlet value;\n\t\t\t\tif ( raw )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = JSON.parse(raw);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.log.warn(`Unable to parse localStorage value as JSON for \"${key}\"`, err);\n\t\t\t\t\t}\n\n\t\t\t\tthis.__ls_cache.set(key, value);\n\t\t\t\tthis.emit(':ls-update', key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetLS<T>(key: string): T | null {\n\t\tif ( this.__ls_cache.has(key) )\n\t\t\treturn this.__ls_cache.get(key) as T;\n\n\t\tif ( ! this.__ls_hooked )\n\t\t\tthis._hookLS();\n\n\t\tconst is_raw = key.startsWith('raw.'),\n\t\t\traw = localStorage.getItem(is_raw ? key.slice(4) : key);\n\n\t\tlet value;\n\t\tif ( is_raw )\n\t\t\tvalue = raw;\n\t\telse\n\t\t\ttry {\n\t\t\t\tvalue = raw ? JSON.parse(raw) : null;\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn(`Unable to parse localStorage value as JSON for \"${key}\"`, err);\n\t\t\t}\n\n\t\tthis.__ls_cache.set(key, value);\n\t\treturn value;\n\t}\n\n\n\t// ========================================================================\n\t// Backup and Restore\n\t// ========================================================================\n\n\tasync generateBackupFile() {\n\t\tconst now = new Date(),\n\t\t\ttimestamp = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;\n\n\t\tif ( await this._needsZipBackup() ) {\n\t\t\tconst blob = await this._getZipBackup();\n\t\t\treturn new File([blob], `ffz-settings (${timestamp}).zip`, {type: 'application/zip'});\n\t\t}\n\n\t\tconst settings = await this.getSettingsDump();\n\t\treturn new File([JSON.stringify(settings)], `ffz-settings (${timestamp}).json`, {type: 'application/json;charset=utf-8'});\n\t}\n\n\n\tprivate async _needsZipBackup() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\treturn false;\n\n\t\tawait this.provider.awaitReady();\n\n\t\tif ( !(this.provider instanceof AdvancedSettingsProvider) || ! this.provider.supportsBlobs )\n\t\t\treturn false;\n\n\t\tconst keys = await this.provider.blobKeys();\n\t\treturn Array.isArray(keys) ? keys.length > 0 : false;\n\t}\n\n\n\tprivate async _getZipBackup() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\tthrow new Error('provider not available');\n\n\t\tawait this.provider.awaitReady();\n\n\t\t// Create our ZIP file.\n\t\tconst JSZip = (await import(/* webpackChunkName: \"zip\" */ 'jszip')).default,\n\t\t\tout = new JSZip();\n\n\t\t// Normal Settings\n\t\tconst settings = await this.getSettingsDump();\n\t\tout.file('settings.json', JSON.stringify(settings));\n\n\t\t// Blob Settings\n\t\tconst metadata: Record<string, ExportedBlobMetadata> = {};\n\n\t\tif ( this.provider instanceof AdvancedSettingsProvider && this.provider.supportsBlobs ) {\n\t\t\tconst keys = await this.provider.blobKeys();\n\t\t\tfor(const key of keys) {\n\t\t\t\tconst safe_key = encodeURIComponent(key),\n\t\t\t\t\tblob = await this.provider.getBlob(key); // eslint-disable-line no-await-in-loop\n\t\t\t\tif ( ! blob )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst md: ExportedBlobMetadata = {\n\t\t\t\t\tkey\n\t\t\t\t};\n\n\t\t\t\tif ( blob instanceof File ) {\n\t\t\t\t\tmd.type = 'file';\n\t\t\t\t\tmd.name = blob.name;\n\t\t\t\t\tmd.modified = blob.lastModified;\n\t\t\t\t\tmd.mime = blob.type;\n\n\t\t\t\t} else if ( blob instanceof Blob ) {\n\t\t\t\t\tmd.type = 'blob';\n\n\t\t\t\t} else if ( blob instanceof ArrayBuffer ) {\n\t\t\t\t\tmd.type = 'ab';\n\t\t\t\t} else if ( blob instanceof Uint8Array ) {\n\t\t\t\t\tmd.type = 'ui8';\n\t\t\t\t} else\n\t\t\t\t\tcontinue;\n\n\t\t\t\tmetadata[safe_key] = md;\n\t\t\t\tout.file(`blobs/${safe_key}`, blob);\n\t\t\t}\n\t\t}\n\n\t\tout.file('blobs.json', JSON.stringify(metadata));\n\n\t\treturn out.generateAsync({type: 'blob'});\n\t}\n\n\n\tasync getSettingsDump() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\treturn null;\n\n\t\tawait this.provider.awaitReady();\n\n\t\tconst out: ExportedFullDump = {\n\t\t\tversion: 2,\n\t\t\ttype: 'full',\n\t\t\tvalues: {}\n\t\t};\n\n\t\tfor(const [key, value] of this.provider.entries())\n\t\t\tout.values[key] = value;\n\n\t\treturn out;\n\t}\n\n\n\tscheduleUpdates() {\n\t\tif ( this._update_timer )\n\t\t\tclearTimeout(this._update_timer);\n\n\t\tthis._update_timer = setTimeout(() => this.checkUpdates(), 5000);\n\t}\n\n\n\tasync checkUpdates() {\n\t\tawait this.awaitProvider();\n\t\tawait this.provider?.awaitReady();\n\n\t\tif ( ! this.provider?.shouldUpdate )\n\t\t\treturn;\n\n\t\tconst promises = [];\n\t\tfor(const profile of this.__profiles) {\n\t\t\tif ( ! profile || ! profile.url || profile.pause_updates )\n\t\t\t\tcontinue;\n\n\t\t\tconst out = profile.checkUpdate();\n\t\t\tpromises.push(out instanceof Promise ? out : Promise.resolve(out));\n\t\t}\n\n\t\tconst data = await Promise.all(promises);\n\n\t\tlet success = 0;\n\t\tfor(const thing of data)\n\t\t\tif ( thing )\n\t\t\t\tsuccess++;\n\n\t\tthis.log.info(`Successfully refreshed ${success} of ${data.length} profiles from remote URLs.`);\n\t}\n\n\n\t// ========================================================================\n\t// Provider Interaction\n\t// ========================================================================\n\n\t/**\n\t * Return an object with all the known, supported providers.\n\t * @returns {Object} The object.\n\t */\n\tgetProviders() {\n\t\treturn this.providers;\n\t}\n\n\t/**\n\t * Return the key of the active provider.\n\t * @returns {String} The key for the active provider\n\t */\n\tgetActiveProvider() {\n\t\treturn this._active_provider;\n\t}\n\n\t/**\n\t * Evaluate the environment that FFZ is running in and then decide which\n\t * provider should be used to retrieve and store settings.\n\t *\n\t * @returns {SettingsProvider} The provider to store everything.\n\t */\n\tasync _createProvider() {\n\t\t// If we should be using Cross-Origin Storage Bridge, do so.\n\t\t//if ( this.providers.cosb && this.providers.cosb.supported() )\n\t\t//\treturn new this.providers.cosb(this);\n\n\t\tlet wanted = localStorage.ffzProviderv2;\n\t\tif ( wanted == null )\n\t\t\twanted = localStorage.ffzProviderv2 = await this.sniffProvider();\n\n\t\tif ( this.providers[wanted] ) {\n\t\t\tconst provider = new (this.providers[wanted] as any)(this) as SettingsProvider;\n\t\t\tthis._active_provider = wanted;\n\t\t\treturn provider;\n\t\t}\n\n\t\t// Fallback to localStorage if nothing else was wanted and available.\n\t\tthis._active_provider = 'local';\n\t\treturn new LocalStorageProvider(this);\n\t}\n\n\n\t/**\n\t * Evaluate the environment and attempt to guess which provider we should\n\t * use for storing settings. This is necessary in case localStorage is\n\t * cleared while we have settings stored in IndexedDB.\n\t *\n\t * In the future, this may default to IndexedDB for new users.\n\t *\n\t * @returns {String} The key for which provider we should use.\n\t */\n\tasync sniffProvider() {\n\t\tconst providers = Array.from(Object.entries(this.providers));\n\t\tproviders.sort((a, b) =>\n\t\t\t((b[1] as any).priority ?? 0) -\n\t\t\t((a[1] as any).priority ?? 0)\n\t\t);\n\n\t\tfor(const [key, provider] of providers) {\n\t\t\tif ( provider.supported() && await provider.hasContent() ) // eslint-disable-line no-await-in-loop\n\t\t\t\treturn key;\n\t\t}\n\n\t\t// Fallback to local if no provider indicated present settings.\n\t\treturn 'local';\n\t}\n\n\t/**\n\t * Change to a new settings provider. This immediately prevents changes\n\t * to the old provider, and will reload the page when settings have\n\t * been transfered over.\n\t *\n\t * @param {String} key The key of the new provider to swap to.\n\t * @param {Boolean} transfer Whether or not settings should be transferred\n\t * from the current provider.\n\t */\n\tasync changeProvider(key: string, transfer: boolean) {\n\t\tif ( ! this.providers[key] || ! this.providers[key].supported() )\n\t\t\tthrow new Error(`Invalid provider: ${key}`);\n\n\t\t// If we're changing to the current provider... well, that doesn't make\n\t\t// a lot of sense, does it? Abort!\n\t\tif ( key === this._active_provider || ! this.provider )\n\t\t\treturn;\n\n\t\tconst old_provider = this.provider;\n\t\tthis.provider = null as any;\n\n\t\t// Let all other tabs know what's up.\n\t\told_provider.broadcastTransfer();\n\n\t\t// Are we transfering settings?\n\t\tif ( transfer ) {\n\t\t\tconst new_provider = new (this.providers[key] as any)(this) as SettingsProvider;\n\t\t\tawait new_provider.awaitReady();\n\n\t\t\tif ( new_provider.allowTransfer && old_provider.allowTransfer ) {\n\t\t\t\told_provider.disableEvents();\n\n\t\t\t\t// When transfering, we clear all existing settings.\n\t\t\t\tnew_provider.clear();\n\t\t\t\tif ( new_provider instanceof AdvancedSettingsProvider && new_provider.supportsBlobs )\n\t\t\t\t\tawait new_provider.clearBlobs();\n\n\t\t\t\t// Wait for it to do that.\n\t\t\t\tawait new_provider.flush();\n\n\t\t\t\tfor(const [key,val] of old_provider.entries())\n\t\t\t\t\tnew_provider.set(key, val);\n\n\t\t\t\tif ( old_provider instanceof AdvancedSettingsProvider && old_provider.supportsBlobs && new_provider instanceof AdvancedSettingsProvider && new_provider.supportsBlobs ) {\n\t\t\t\t\tfor(const key of await old_provider.blobKeys() ) {\n\t\t\t\t\t\tconst blob = await old_provider.getBlob(key); // eslint-disable-line no-await-in-loop\n\t\t\t\t\t\tif ( blob )\n\t\t\t\t\t\t\tawait new_provider.setBlob(key, blob); // eslint-disable-line no-await-in-loop\n\t\t\t\t\t}\n\n\t\t\t\t\tawait old_provider.clearBlobs();\n\t\t\t\t}\n\n\t\t\t\told_provider.clear();\n\n\t\t\t\tawait old_provider.flush();\n\t\t\t\tawait new_provider.flush();\n\t\t\t}\n\t\t}\n\n\t\t// Change over.\n\t\tlocalStorage.ffzProviderv2 = key;\n\t\tlocation.reload();\n\t}\n\n\n\t/**\n\t * React to a setting that has changed elsewhere. Generally, this is\n\t * the result of a setting being changed in another tab or, when cloud\n\t * settings are enabled, on another computer.\n\t */\n\t_onProviderChange(key: string, new_value: any, deleted: boolean) {\n\t\t// If profiles have changed, reload our profiles.\n\t\tif ( key === 'profiles' )\n\t\t\treturn this.loadProfiles();\n\n\t\tif ( ! key.startsWith('p:') )\n\t\t\treturn;\n\n\t\t// If we're still here, it means an individual setting was changed.\n\t\t// Look up the profile it belongs to and emit a changed event from\n\t\t// that profile, thus notifying any contexts or UI instances.\n\t\tkey = key.slice(2);\n\n\t\t// Is it a value?\n\t\tconst idx = key.indexOf(':');\n\t\tif ( idx === -1 )\n\t\t\treturn;\n\n\t\tconst profile = this.__profile_ids[key.slice(0, idx) as any],\n\t\t\ts_key = key.slice(idx + 1);\n\n\t\tif ( profile && ! profile.ephemeral ) {\n\t\t\tif ( s_key === ':enabled' )\n\t\t\t\tprofile.emit('toggled', profile, deleted ? true : new_value);\n\t\t\telse\n\t\t\t\tprofile.emit('changed', s_key, new_value, deleted);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Profile Management\n\t// ========================================================================\n\n\tupdateRoutes() {\n\t\t// Clear the existing matchers.\n\t\tfor(const profile of this.__profiles)\n\t\t\tprofile.clearMatcher();\n\n\t\t// And then re-select the active profiles.\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t}\n\n\n\t_onProfileToggled(profile: SettingsProfile, enabled: boolean) {\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t\tthis.emit(':profile-toggled', profile, enabled);\n\t}\n\n\n\t/**\n\t * Get an existing {@link SettingsProfile} instance.\n\t * @param id  - The id or uuid of the profile.\n\t */\n\tprofile(id: number | string): SettingsProfile | null {\n\t\treturn this.__profile_uuids[id] ?? this.__profile_ids[id as number] ?? null;\n\t}\n\n\n\t/**\n\t * Build {@link SettingsProfile} instances for all of the profiles\n\t * defined in storage, re-using existing instances when possible.\n\t */\n\tloadProfiles(suppress_events: boolean = false) {\n\t\tconst old_profile_ids = this.__profile_ids,\n\t\t\told_profile_uuids = this.__profile_uuids,\n\t\t\told_profiles = this.__profiles,\n\n\t\t\tprofile_ids: Record<number, SettingsProfile> = this.__profile_ids = {},\n\t\t\tprofiles: SettingsProfile[] = this.__profiles = [],\n\t\t\tprofile_uuids: Record<string, SettingsProfile> = this.__profile_uuids = {},\n\n\t\t\t// Create a set of actual IDs with a map from the profiles\n\t\t\t// list rather than just getting the keys from the ID map\n\t\t\t// because the ID map is an object and coerces its strings\n\t\t\t// to keys.\n\t\t\told_ids = new Set(old_profiles.map(x => x.id)),\n\n\t\t\tnew_ids = new Set<number>,\n\t\t\tchanged_ids = new Set<number>;\n\n\t\tlet raw_profiles = this.provider?.get<SettingsProfileMetadata[]>('profiles') ?? [\n\t\t\tSettingsProfile.Moderation,\n\t\t\tSettingsProfile.Default\n\t\t];\n\n\t\t// Sanity check. If we have no profiles, delete the old data.\n\t\tif ( ! raw_profiles?.length ) {\n\t\t\tthis.provider?.delete('profiles');\n\t\t\traw_profiles = [\n\t\t\t\tSettingsProfile.Moderation,\n\t\t\t\tSettingsProfile.Default\n\t\t\t];\n\t\t}\n\n\t\t// Update: Add UUIDs to all profiles.\n\t\tlet need_save = false;\n\n\t\tfor(const profile of raw_profiles) {\n\t\t\tif ( ! profile.uuid ) {\n\t\t\t\tneed_save = true;\n\n\t\t\t\tif ( profile.i18n_key === SettingsProfile.Default.i18n_key )\n\t\t\t\t\tprofile.uuid = SettingsProfile.Default.uuid as string;\n\t\t\t\telse if ( profile.i18n_key === SettingsProfile.Moderation.i18n_key )\n\t\t\t\t\tprofile.uuid = SettingsProfile.Moderation.uuid as string;\n\t\t\t\telse\n\t\t\t\t\tprofile.uuid = generateUUID();\n\t\t\t}\n\t\t}\n\n\t\tif ( need_save )\n\t\t\tthis.provider?.set('profiles', raw_profiles);\n\n\t\tlet reordered = false,\n\t\t\tchanged = false;\n\n\t\tfor(const profile of old_profiles) {\n\t\t\tprofile.off('toggled', this._onProfileToggled, this);\n\t\t\tprofile.hotkey_enabled = false;\n\t\t}\n\n\t\tfor(const profile_data of raw_profiles) {\n\t\t\tconst id = profile_data.id as number,\n\t\t\t\tslot_id = profiles.length,\n\t\t\t\told_profile = old_profile_ids[id],\n\t\t\t\told_slot_id = old_profile ? old_profiles.indexOf(old_profile) : -1;\n\n\t\t\told_ids.delete(id);\n\n\t\t\tif ( old_slot_id !== slot_id )\n\t\t\t\treordered = true;\n\n\t\t\tif ( old_profile && deep_equals(old_profile.data, profile_data, true) ) {\n\t\t\t\t// Did the order change?\n\t\t\t\tif ( old_slot_id !== slot_id )\n\t\t\t\t\tchanged = true;\n\n\t\t\t\tprofiles.push(profile_ids[id] = old_profile);\n\t\t\t\tprofile_uuids[old_profile.uuid] = old_profile;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst new_profile = profile_ids[id] = new SettingsProfile(this, profile_data);\n\t\t\tif ( old_profile ) {\n\t\t\t\told_profile.transferListeners(new_profile);\n\t\t\t\tchanged_ids.add(id);\n\n\t\t\t} else\n\t\t\t\tnew_ids.add(id);\n\n\t\t\tprofiles.push(new_profile);\n\t\t\tprofile_uuids[new_profile.uuid] = new_profile;\n\t\t\tchanged = true;\n\t\t}\n\n\t\tfor(const profile of profiles) {\n\t\t\tprofile.on('toggled', this._onProfileToggled, this);\n\t\t\tprofile.hotkey_enabled = true;\n\t\t}\n\n\t\tif ( ! changed && ! old_ids.size || suppress_events )\n\t\t\treturn;\n\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\n\t\tfor(const id of new_ids)\n\t\t\tthis.emit(':profile-created', profile_ids[id]);\n\n\t\tfor(const id of changed_ids)\n\t\t\tthis.emit(':profile-changed', profile_ids[id]);\n\n\t\tif ( reordered )\n\t\t\tthis.emit(':profiles-reordered');\n\t}\n\n\n\t/**\n\t * Create a new profile and return the {@link SettingsProfile} instance\n\t * representing it.\n\t */\n\tcreateProfile(options: Partial<SettingsProfileMetadata> = {}) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to create profile before settings have initialized. Please await enable()');\n\n\t\tif ( options.id !== undefined )\n\t\t\tthrow new Error('You cannot specify an ID when creating a profile.');\n\n\t\tlet id = 0;\n\n\t\t// Find the next available profile ID.\n\t\twhile ( this.__profile_ids[id] ) {\n\t\t\t// Ephemeral profiles have negative IDs.\n\t\t\toptions.ephemeral ? id-- : id++;\n\t\t}\n\n\t\toptions.id = id;\n\t\toptions.uuid = generateUUID();\n\n\t\tif ( ! options.name )\n\t\t\toptions.name = `Unnamed Profile ${this.__profiles.length + 1}`;\n\n\t\tconst profile = this.__profile_ids[id] = new SettingsProfile(this, options);\n\t\tthis.__profile_uuids[options.uuid] = profile;\n\t\tthis.__profiles.unshift(profile);\n\n\t\tprofile.on('toggled', this._onProfileToggled, this);\n\t\tprofile.hotkey_enabled = true;\n\n\t\t// Don't bother saving if it's ephemeral.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-created', profile);\n\t\treturn profile;\n\t}\n\n\n\t/**\n\t * Delete a profile.\n\t *\n\t * @param id - The ID of the profile to delete, or just the profile itself.\n\t */\n\tdeleteProfile(id: number | SettingsProfile) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to delete profile before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\tif ( this.__profiles.length === 1 )\n\t\t\tthrow new Error('cannot delete only profile');\n\n\t\t/*if ( profile.id === 0 )\n\t\t\tthrow new Error('cannot delete default profile');*/\n\n\t\tprofile.off('toggled', this._onProfileToggled, this);\n\t\tprofile.clear();\n\t\tthis.__profile_ids[id] = null;\n\t\tthis.__profile_uuids[profile.uuid] = null;\n\n\t\tconst idx = this.__profiles.indexOf(profile);\n\t\tif ( idx !== -1 )\n\t\t\tthis.__profiles.splice(idx, 1);\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-deleted', profile);\n\t}\n\n\n\tmoveProfile(id: number | SettingsProfile, index: number) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to move profiles before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\tconst profiles = this.__profiles,\n\t\t\tidx = profiles.indexOf(profile);\n\t\tif ( idx === index )\n\t\t\treturn;\n\n\t\tprofiles.splice(index, 0, ...profiles.splice(idx, 1));\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profiles-reordered');\n\t}\n\n\n\tsaveProfile(id: number | SettingsProfile) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to save profile before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-changed', profile);\n\t}\n\n\n\t_saveProfiles() {\n\t\tconst out = this.__profiles\n\t\t\t.filter(prof => ! prof.ephemeral)\n\t\t\t.map(prof => prof.data);\n\n\t\t// Ensure that we always have a non-ephemeral profile.\n\t\tif ( ! out ) {\n\t\t\tthis.createProfile({\n\t\t\t\tname: 'Default Profile',\n\t\t\t\ti18n_key: 'setting.profiles.default',\n\t\t\t\tdescription: 'Settings that apply everywhere on Twitch.'\n\t\t\t});\n\n\t\t\t// Just return. Creating the profile will call this method again.\n\t\t\treturn;\n\t\t}\n\n\t\tthis.provider?.set('profiles', out);\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t}\n\n\n\t// ========================================================================\n\t// Context Helpers\n\t// ========================================================================\n\n\tcontext(env: ContextData) {\n\t\treturn this.main_context.context(env);\n\t}\n\n\tget<\n\t\tK extends AllSettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K): TValue {\n\t\treturn this.main_context.get(key);\n\t}\n\n\tgetChanges<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(\n\t\tkey: K,\n\t\tfn: (val: TValue) => void,\n\t\tctx?: any\n\t) { return this.main_context.getChanges(key, fn, ctx); }\n\n\tonChange<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(\n\t\tkey: K,\n\t\tfn: (val: TValue) => void,\n\t\tctx?: any\n\t) { return this.main_context.onChange(key, fn, ctx); }\n\n\tuses<K extends AllSettingsKeys>(key: K) { return this.main_context.uses(key) }\n\tupdate<K extends SettingsKeys>(key: K) { return this.main_context.update(key) }\n\n\tupdateContext(context: ContextData) { return this.main_context.updateContext(context) }\n\tsetContext(context: ContextData) { return this.main_context.setContext(context) }\n\n\n\t// ========================================================================\n\t// Add-On Proxy\n\t// ========================================================================\n\n\tgetAddonProxy(addon_id: string, addon: AddonInfo, module: GenericModule) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides: Record<string, any> = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\n\t\toverrides.add = <\n\t\t\tK extends SettingsKeys,\n\t\t\tTValue = SettingType<K>,\n\t\t>(key: K, definition: SettingDefinition<TValue>) => {\n\t\t\treturn this.add(key, definition, addon_id);\n\t\t};\n\n\t\t// TODO: Update addUI here too\n\t\toverrides.addUI = <\n\t\t\tK extends string,\n\t\t\tTValue = K extends SettingsKeys ? SettingType<K> : unknown,\n\t\t>(key: K, definition: SettingUiDefinition<TValue>) => {\n\t\t\treturn this.addUI(key, definition, addon_id);\n\t\t};\n\n\t\toverrides.addClearable = (key: string, definition: SettingsClearable) => {\n\t\t\treturn this.addClearable(key, definition, addon_id);\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'settings', overrides);\n\t}\n\n\t// ========================================================================\n\t// Definitions\n\t// ========================================================================\n\n\tadd<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, definition: SettingDefinition<TValue>, source?: string) {\n\n\t\tconst old_definition = this.definitions.get(key),\n\t\t\trequired_by = (Array.isArray(old_definition)\n\t\t\t\t? old_definition\n\t\t\t\t: old_definition?.required_by) ?? [];\n\n\t\tdefinition.required_by = required_by;\n\t\tdefinition.requires = definition.requires ?? [];\n\n\t\tdefinition.__source = source;\n\n\t\tfor(const req_key of definition.requires) {\n\t\t\tconst req = this.definitions.get(req_key);\n\t\t\tif ( Array.isArray(req) )\n\t\t\t\treq.push(key);\n\t\t\telse if ( req )\n\t\t\t\treq.required_by?.push(key);\n\t\t\telse\n\t\t\t\tthis.definitions.set(req_key, [key]);\n\t\t}\n\n\n\t\tif ( definition.ui ) {\n\t\t\tconst ui = definition.ui;\n\t\t\tui.path_tokens = ui.path_tokens ?\n\t\t\t\tformat_path_tokens(ui.path_tokens) :\n\t\t\t\tui.path ?\n\t\t\t\t\tparse_path(ui.path) :\n\t\t\t\t\tundefined;\n\n\t\t\tif ( source && ui.path_tokens && ui.path_tokens.length >= 2 && ui.path_tokens[0].key === 'add_ons' ) {\n\t\t\t\tconst addons = this.resolve('addons'),\n\t\t\t\t\taddon = addons?.getAddon(source);\n\n\t\t\t\tif ( addon ) {\n\t\t\t\t\tconst test = ui.path_tokens[1] as any,\n\t\t\t\t\t\tlinks: string[] = [];\n\n\t\t\t\t\tlinks.push(`add_ons.changelog.${source}`);\n\t\t\t\t\tif ( addon.short_name )\n\t\t\t\t\t\tlinks.push(`add_ons.changelog.${addon.short_name.toSnakeCase()}`);\n\t\t\t\t\tif ( addon.name )\n\t\t\t\t\t\tlinks.push(`add_ons.changelog.${addon.name.toSnakeCase()}`);\n\n\t\t\t\t\ttest.header_links = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnavigate: links,\n\t\t\t\t\t\t\ti18n_key: 'home.changelog',\n\t\t\t\t\t\t\ttitle: 'Changelog'\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! ui.key && key )\n\t\t\t\tui.key = key;\n\n\t\t\tif ( ! ui.key && ui.title )\n\t\t\t\tui.key = ui.title.toSnakeCase();\n\n\t\t\tif ( (ui.component === 'setting-select-box' ||\n\t\t\t\t  ui.component === 'setting-combo-box') &&\n\t\t\t\tArray.isArray(ui.data) && ! ui.no_i18n\n\t\t\t) {\n\t\t\t\tconst i18n_base = `${ui.i18n_key || `setting.entry.${key}`}.values`;\n\t\t\t\tfor(const value of ui.data) {\n\t\t\t\t\tif ( value.i18n_key === undefined && value.value !== undefined )\n\t\t\t\t\t\tvalue.i18n_key = `${i18n_base}.${value.value}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( definition.changed )\n\t\t\tthis.on(`:changed:${key}` as any, definition.changed);\n\n\t\tthis.definitions.set(key, definition);\n\n\t\t// Do not re-emit `added-definition` when re-adding an existing\n\t\t// setting. Prevents the settings UI from goofing up.\n\t\tif ( ! old_definition || Array.isArray(old_definition) )\n\t\t\tthis.emit(':added-definition', key, definition);\n\t}\n\n\n\tremove(key: string) {\n\t\tconst definition = this.definitions.get(key);\n\t\tif ( ! definition )\n\t\t\treturn;\n\n\t\t// If the definition is an array, we're already not defined.\n\t\tif ( Array.isArray(definition) )\n\t\t\treturn;\n\n\t\t// Remove this definition from the definitions list.\n\t\tif ( Array.isArray(definition.required_by) && definition.required_by.length > 0 )\n\t\t\tthis.definitions.set(key, definition.required_by);\n\t\telse\n\t\t\tthis.definitions.delete(key);\n\n\t\t// Remove it from all the things it required.\n\t\tif ( Array.isArray(definition.requires) )\n\t\t\tfor(const req_key of definition.requires) {\n\t\t\t\tlet req = this.definitions.get(req_key);\n\t\t\t\tif ( Array.isArray(req) ) {\n\t\t\t\t\tconst idx = req.indexOf(key);\n\t\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\t\treq.splice(idx, 1);\n\n\t\t\t\t} else if ( req?.required_by )\n\t\t\t\t\treq = req.required_by;\n\t\t\t}\n\n\t\tif ( definition.changed )\n\t\t\tthis.off(`:changed:${key}` as any, definition.changed);\n\n\t\tthis.emit(':removed-definition', key as any, definition);\n\t}\n\n\n\t// TODO: Update this because addUI doesn't use keys or types\n\taddUI<\n\t\tK extends string,\n\t\tTValue = K extends SettingsKeys ? SettingType<K> : unknown\n\t>(key: K, definition: Partial<SettingUiDefinition<TValue>>, source?: string) {\n\n\t\tlet def: SettingDefinition<TValue>;\n\t\tif ( (definition as any).ui )\n\t\t\tdef = (definition as any);\n\t\telse\n\t\t\tdef = {\n\t\t\t\tui: definition as SettingUiDefinition<TValue>\n\t\t\t} as SettingDefinition<TValue>;\n\n\t\tdef.__source = source;\n\n\t\tconst ui = def.ui as SettingUiDefinition<TValue>;\n\t\tui.path_tokens = ui.path_tokens ?\n\t\t\tformat_path_tokens(ui.path_tokens) :\n\t\t\tui.path ?\n\t\t\t\tparse_path(ui.path) :\n\t\t\t\tundefined;\n\n\t\tif ( ! ui.key && ui.title )\n\t\t\tui.key = ui.title.toSnakeCase();\n\n\t\tconst old_definition = this.ui_structures.get(key);\n\t\tthis.ui_structures.set(key, def);\n\n\t\t// Do not re-emit `added-definition` when re-adding an existing\n\t\t// setting. Prevents the settings UI from goofing up.\n\t\tif ( ! old_definition )\n\t\t\tthis.emit(':added-definition', key as any, def);\n\t}\n\n\n\taddClearable(key: string | Record<string, SettingsClearable>, definition?: SettingsClearable, source?: string) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addClearable(k, value, source);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( definition ) {\n\t\t\tdefinition.__source = source;\n\t\t\tthis.clearables[key] = definition;\n\t\t}\n\t}\n\n\tgetClearables() {\n\t\treturn deep_copy(this.clearables);\n\t}\n\n\n\taddProcessor(key: string | Record<string, SettingProcessor<any>>, processor?: SettingProcessor<any>) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addProcessor(k, value);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( processor )\n\t\t\tthis.processors[key] = processor;\n\t}\n\n\tgetProcessor<T>(key: string): SettingProcessor<T> | null {\n\t\treturn this.processors[key] ?? null;\n\t}\n\n\tgetProcessors() {\n\t\treturn deep_copy(this.processors);\n\t}\n\n\taddValidator(key: string | Record<string, SettingValidator<any>>, validator?: SettingValidator<any>) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addValidator(k, value);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( validator )\n\t\t\tthis.validators[key] = validator;\n\t}\n\n\tgetValidator<T>(key: string): SettingValidator<T> | null {\n\t\treturn this.validators[key] ?? null;\n\t}\n\n\tgetValidators() {\n\t\treturn deep_copy(this.validators);\n\t}\n}\n\n\nexport function format_path_tokens(tokens: (string | PathNode)[]) {\n\tfor(let i=0, l = tokens.length; i < l; i++) {\n\t\tconst token = tokens[i];\n\t\tif ( typeof token === 'string' ) {\n\t\t\ttokens[i] = {\n\t\t\t\tkey: token.toSnakeCase(),\n\t\t\t\ttitle: token\n\t\t\t};\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif ( ! token.key )\n\t\t\ttoken.key = token.title.toSnakeCase();\n\t}\n\n\treturn tokens as PathNode[];\n}\n","'use strict';\n\nimport Logger from 'utilities/logging';\nimport Module from 'utilities/module';\n\nimport {DEBUG} from 'utilities/constants';\nimport {serializeBlob, deserializeBlob} from 'utilities/blobs';\n\nimport SettingsManager from './settings/index';\n\nclass FFZBridge extends Module {\n\tconstructor() {\n\t\tsuper();\n\t\tconst start_time = performance.now();\n\n\t\tFFZBridge.instance = this;\n\n\t\tthis.host = 'null';\n\t\tthis.flavor = 'bridge';\n\n\t\tthis.name = 'ffz_bridge';\n\t\tthis.__state = 0;\n\t\tthis.__modules.core = this;\n\n\t\t// ========================================================================\n\t\t// Logging\n\t\t// ========================================================================\n\n\t\tthis.log = new Logger(null, null, null);\n\t\tthis.log.label = 'FFZBridge';\n\t\tthis.log.init = true;\n\n\t\tthis.core_log = this.log.get('core');\n\t\tthis.log.hi(this);\n\n\n\t\t// ========================================================================\n\t\t// Core Systems\n\t\t// ========================================================================\n\n\t\tthis.inject('settings', SettingsManager);\n\n\n\t\t// ========================================================================\n\t\t// Startup\n\t\t// ========================================================================\n\n\t\tthis.enable().then(() => {\n\t\t\tconst duration = performance.now() - start_time;\n\t\t\tthis.core_log.info(`Initialization complete in ${duration.toFixed(5)}ms.`);\n\t\t\tthis.log.init = false;\n\t\t}).catch(err => {\n\t\t\tthis.core_log.error(`An error occurred during initialization.`, err);\n\t\t\tthis.log.init = false;\n\t\t});\n\t}\n\n\tstatic get() {\n\t\treturn FFZBridge.instance;\n\t}\n\n\tasync onEnable() {\n\t\twindow.addEventListener('message', this.onMessage.bind(this));\n\t\tthis.settings.provider.on('changed', this.onProviderChange, this);\n\t\tthis.settings.provider.on('changed-blob', this.onProviderBlobChange, this);\n\t\tthis.settings.provider.on('clear-blobs', this.onProviderClearBlobs, this);\n\n\t\tawait this.settings.awaitProvider();\n\t\tawait this.settings.provider.awaitReady();\n\n\t\tthis.send({\n\t\t\tffz_type: 'ready'\n\t\t});\n\t}\n\n\tasync onMessage(event) {\n\t\tconst msg = event.data;\n\t\tif ( ! msg || ! msg.ffz_type )\n\t\t\treturn;\n\n\t\tif ( msg.ffz_type === 'load' ) {\n\t\t\tconst out = {};\n\t\t\tfor(const [key, value] of this.settings.provider.entries())\n\t\t\t\tout[key] = value;\n\n\t\t\tthis.send({\n\t\t\t\tffz_type: 'loaded',\n\t\t\t\tdata: out\n\t\t\t});\n\n\t\t\treturn;\n\n\t\t} else if ( msg.ffz_type === 'change' ) {\n\t\t\tthis.onChange(msg);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! msg.id )\n\t\t\treturn this.log.warn('Received command with no reply ID');\n\n\t\tlet reply, transfer;\n\n\t\ttry {\n\t\t\tif ( msg.ffz_type === 'init-load' ) {\n\t\t\t\treply = {\n\t\t\t\t\tblobs: this.settings.provider.supportsBlobs,\n\t\t\t\t\tvalues: {}\n\t\t\t\t};\n\n\t\t\t\tfor(const [key,value] of this.settings.provider.entries())\n\t\t\t\t\treply.values[key] = value;\n\n\t\t\t} else if ( msg.ffz_type === 'set' )\n\t\t\t\tthis.settings.provider.set(msg.key, msg.value);\n\n\t\t\telse if ( msg.ffz_type === 'delete' )\n\t\t\t\tthis.settings.provider.delete(msg.key);\n\n\t\t\telse if ( msg.ffz_type === 'clear' )\n\t\t\t\tthis.settings.provider.clear();\n\n\t\t\telse if ( msg.ffz_type === 'get-blob' ) {\n\t\t\t\treply = await serializeBlob(await this.settings.provider.getBlob(msg.key));\n\t\t\t\tif ( reply )\n\t\t\t\t\ttransfer = reply.buffer;\n\n\t\t\t} else if ( msg.ffz_type === 'set-blob' ) {\n\t\t\t\tconst blob = deserializeBlob(msg.value);\n\t\t\t\tawait this.settings.provider.setBlob(msg.key, blob);\n\n\t\t\t} else if ( msg.ffz_type === 'delete-blob' )\n\t\t\t\tawait this.settings.provider.deleteBlob(msg.key);\n\n\t\t\telse if ( msg.ffz_type === 'has-blob' )\n\t\t\t\treply = await this.settings.provider.hasBlob(msg.key);\n\n\t\t\telse if ( msg.ffz_type === 'clear-blobs' )\n\t\t\t\tawait this.settings.provider.clearBlobs();\n\n\t\t\telse if ( msg.ffz_type === 'blob-keys' )\n\t\t\t\treply = await this.settings.provider.blobKeys();\n\n\t\t\telse if ( msg.ffz_type === 'flush' )\n\t\t\t\tawait this.settings.provider.flush();\n\n\t\t\telse\n\t\t\t\treturn this.send({\n\t\t\t\t\tffz_type: 'reply-error',\n\t\t\t\t\tid: msg.id,\n\t\t\t\t\terror: 'bad-command'\n\t\t\t\t});\n\n\t\t\tthis.send({\n\t\t\t\tffz_type: 'reply',\n\t\t\t\tid: msg.id,\n\t\t\t\treply\n\t\t\t}, transfer);\n\n\t\t} catch(err) {\n\t\t\tthis.log.error('Error handling command.', err);\n\t\t\tthis.send({\n\t\t\t\tffz_type: 'reply-error',\n\t\t\t\tid: msg.id\n\t\t\t});\n\t\t}\n\t}\n\n\tsend(msg, blob) { // eslint-disable-line class-methods-use-this\n\t\ttry {\n\t\t\twindow.parent.postMessage(msg, '*', blob ? [blob] : undefined)\n\t\t} catch(err) { this.log.error('send error', err); /* no-op */ }\n\t}\n\n\tonChange(msg) {\n\t\tconst key = msg.key,\n\t\t\tvalue = msg.value,\n\t\t\tdeleted = msg.deleted;\n\n\t\tif ( deleted )\n\t\t\tthis.settings.provider.delete(key);\n\t\telse\n\t\t\tthis.settings.provider.set(key, value);\n\t}\n\n\tonProviderChange(key, value, deleted) {\n\t\tthis.send({\n\t\t\tffz_type: 'change',\n\t\t\tkey,\n\t\t\tvalue,\n\t\t\tdeleted\n\t\t});\n\t}\n\n\tonProviderBlobChange(key, deleted) {\n\t\tthis.send({\n\t\t\tffz_type: 'change-blob',\n\t\t\tkey,\n\t\t\tdeleted\n\t\t});\n\t}\n\n\tonProviderClearBlobs() {\n\t\tthis.send({\n\t\t\tffz_type: 'clear-blobs'\n\t\t});\n\t}\n}\n\nFFZBridge.Logger = Logger;\n\nconst VER = FFZBridge.version_info = Object.freeze({\n\tmajor: __version_major__,\n\tminor: __version_minor__,\n\trevision: __version_patch__,\n\textra: __version_prerelease__?.length && __version_prerelease__[0],\n\tcommit: __git_commit__,\n\tbuild: __version_build__,\n\thash: __webpack_hash__,\n\ttoString: () =>\n\t\t`${VER.major}.${VER.minor}.${VER.revision}${VER.build ? `.${VER.build}` : ''}${VER.extra || ''}${DEBUG ? '-dev' : ''}`\n});\n\nwindow.FFZBridge = FFZBridge;\nwindow.ffz_bridge = new FFZBridge();"],"names":["manager","data","val","key","value","context","out","old_keys","Mousetrap","event","default_value","p","len","keys","entry","count","SettingsProfile","DEBUG","EXTENSION","path","SERVER_OR_EXT","API_SERVER","STAGING_API","STAGING_CDN","NEW_API","SENTRY_ID","WORD_SEPARATORS","WEIRD_EMOTE_SIZES","BAD_HOTKEYS","RERENDER_SETTINGS","UPDATE_BADGE_SETTINGS","UPDATE_TOKEN_SETTINGS","KEYS","TWITCH_EMOTE_V2","KNOWN_CODES","REPLACEMENT_BASE","REPLACEMENTS","WS_CLUSTERS","LINK_DATA_HOSTS","PUBSUB_CLUSTERS","EMQX_SERVERS","IS_OSX","IS_WIN","IS_WEBKIT","IS_FIREFOX","WEBKIT_CSS","TWITCH_GLOBAL_SETS","TWITCH_POINTS_SETS","TWITCH_PRIME_SETS","EmoteTypes","RESOLVERS_REQUIRE_TOS","Detach","StopPropagation","SNAKE_CAPS","SNAKE_SPACE","SNAKE_TRIM","separator","result","new_listeners","old_listeners","removed","list","a","b","other","other_val","FFZEvent","FFZWaitableEvent","fn","ctx","priority","prepend","info","ttl","resolve","args","evt","f","c","item","ret","err","idx","need_sort","new_items","EventEmitter","promises","results","promise","name","parent","i","chr","parts","depth","prefix","remain","x","y","HierarchicalEventEmitter","createTester","rules","filter_types","inverted","or","rebuild","tests","names","rule","type","test","LoadState","State","EXTRACTOR","extractAddonId","addon","addon_id","is_loadable","load_requires","log","initial","chain","state","CyclicDependencyError","module","ModuleError","dep","requires","load_state","require","full_name","variable","inject_reference","proto","old_val","dependents","inst","req_name","req_path","req_mod","in_path","in_name","in_mod","added","raw_path","raw_module","lix","trimmed","buildAddonProxy","Module","accessor","thing","overrides","access_warnings","no_proxy","handler","obj","prop","receiver","warning","message","modules","HOP","getTwitchEmoteURL","id","scale","animated","dark","getTwitchEmoteSrcSet","big","isValidShortcut","generateUUID","input","ffz","i18n","TranslatableError","sha256","msgBuffer","hashBuffer","matchScreen","screens","options","match","mscore","mon","score","has","object","sleep","delay","make_enum","l","word","make_enum_flags","TimeoutError","timeout","fail","resolved","timer","limit","waiter","held","TicketLock","Mutex","debounce","immediate","later","once","array_equals","deep_equals","first","second","ignore_undefined","first_seen","second_seen","source_keys","dest_keys","set_equals","shallow_object_equals","map_equals","v","substr_count","str","needle","get","segments","part","new_object","shallow_copy","seen","deep_copy","k","normalizeAddonIdForComparison","makeAddonIdChecker","escape_regex","maybe_call","SPLIT_REGEX","split_chars","pick_random","addWordSeparators","CONTROL_CHARS","glob_to_regex","output","groups","char","next","truncate","target","overage","ellipsis","break_line","trim","next_space","decimalToHex","generateHex","length","arr","use_set","source_sorter","sources","cache","items","source","src","existing","need_sorting","SourcedSet","b64ToArrayBuffer","bin","buffer","view","PEM_HEADER","PEM_FOOTER","importRsaKey","pem","uses","start_match","end_match","is_private","start","end","content","fetchJSON","url","init","error_value","resp","parse","parseAST","token","raw","old_tab","old_page","tag","parseJSON","tab","page","stack","string","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","getProto","leafPrototypes","mode","ns","def","current","exports","definition","chunkId","inProgress","dataWebpackPrefix","done","script","needAttach","scripts","s","onScriptComplete","prev","doneFns","scriptUrl","document","installedChunks","installedChunkData","reject","error","loadingEnded","errorType","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","RAVEN_LEVELS","LogLevel","readLSLevel","level","upper","Logger","raven","core","version","VER","loc","optionalParams","colors","exc","opts","msg","default_style","strings","isValidBlob","blob","serializeBlob","deserializeBlob","DEFAULT","profiles","profile","values","trailing","had_value","profs","trail","is_trailing","compare_requirements","old_cache","req","old_value","new_value","contexts","new_profiles","order","changed_ids","old_meta","meta","new_m","old_m","new_uses","old_uses","changed","visited","new_meta","req_key","raw_type","raw_value","def_default","prof","SettingsContext","BAD","do_number","bounds","to_int","to_float","process_to_int","process_to_float","safety","loadSafety","callback","NeverMatch","Invert","config","rule_types","And","Or","If","cond","if_true","if_false","Constant","parseTime","time","hours","minutes","Time","d","TheaterMode","Fullscreen","Moderator","Debug","AddonDebug","SquadMode","NativeDarkTheme","Page","router","route","index","Channel","login","Category","Title","_","reload","title","need_safety","regex","Monitor","FFZ","settings","details","sorted","DB_VERSION","NOT_WWW_TWITCH","NOT_WWW_YT","SettingsProvider","AdvancedSettingsProvider","success","transfer","cbs","RemoteSettingsProvider","LocalStorageProvider","request","e","db","store","r2","this_wait","trx","delreq","release","IndexedDBProvider","frame","CrossOriginStorageBridge","responded","listener","cleanup","ExtensionProvider","Providers","Experiments","HiddenEmotes","provider","FavoriteEmotes","Overrides","Profiles","Everything","postMessage","NO_SYNC_KEYS","params","proxy","duration","captured","now","delta","original","has_value","raw_key","has_raw","is_raw","timestamp","JSZip","metadata","safe_key","md","wanted","providers","old_provider","new_provider","deleted","s_key","enabled","suppress_events","old_profile_ids","old_profile_uuids","old_profiles","profile_ids","profile_uuids","old_ids","new_ids","raw_profiles","need_save","reordered","profile_data","slot_id","old_profile","old_slot_id","new_profile","env","is_dev","old_definition","required_by","ui","format_path_tokens","addons","links","i18n_base","processor","validator","SettingsManager","tokens","start_time","reply","FFZBridge"],"sourceRoot":""}