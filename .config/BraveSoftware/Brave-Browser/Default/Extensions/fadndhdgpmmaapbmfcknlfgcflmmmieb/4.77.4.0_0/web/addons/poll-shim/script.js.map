{"version":3,"file":"poll-shim/script.js","mappings":"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","sources":["webpack://ffz-addons/webpack/bootstrap","webpack://ffz-addons/webpack/runtime/define property getters","webpack://ffz-addons/webpack/runtime/ensure chunk","webpack://ffz-addons/webpack/runtime/get javascript chunk filename","webpack://ffz-addons/webpack/runtime/global","webpack://ffz-addons/webpack/runtime/hasOwnProperty shorthand","webpack://ffz-addons/webpack/runtime/load script","webpack://ffz-addons/webpack/runtime/make namespace object","webpack://ffz-addons/webpack/runtime/publicPath","webpack://ffz-addons/webpack/runtime/jsonp chunk loading","webpack://ffz-addons/./src/poll-shim/index.js"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + (chunkId === 366 ? \"poll-shim/vue\" : chunkId) + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\nvar dataWebpackPrefix = \"ffz-addons:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t\tif (script.src.indexOf(window.location.origin + '/') !== 0) {\n\t\t\tscript.crossOrigin = \"anonymous\";\n\t\t}\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl + \"../\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t996: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = globalThis[\"ffzAddonsWebpackJsonp\"] = globalThis[\"ffzAddonsWebpackJsonp\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","'use strict';\n\nconst {generateUUID} = FrankerFaceZ.utilities.object;\n\nconst VALID_ROUTES = [\n\t'embed-chat',\n\t'popout'\n];\n\nclass PollShim extends Addon {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.router');\n\t\tthis.inject('site.twitch_data');\n\n\t\tthis.settings.addUI('addon.poll-shim.info', {\n\t\t\tpath: 'Add-Ons > Poll-Shim >> Info @{\"sort\": -1000}',\n\t\t\tno_filter: true,\n\t\t\tcomponent: () => import('./components/info.vue'),\n\n\t\t\tshouldBeActive: () => this.shouldBeActive,\n\t\t\tisActive: () => this.active,\n\n\t\t\thasPubSub: () => this.pubsub_open,\n\t\t\thasWS: () => this._socket != null && this._socket.readyState === WebSocket.OPEN,\n\t\t\tisAuthed: () => this.socket_auth,\n\n\t\t\tgetChannel: () => this.getUser(),\n\t\t\tgetSelf: () => this.getSelf(),\n\n\t\t\tgetWS: () => this._socket,\n\t\t\tgetPolls: () => this.polls,\n\n\t\t\ton: (...args) => this.on(...args),\n\t\t\toff: (...args) => this.off(...args)\n\t\t});\n\n\t\tthis.settings.add('addon.poll-shim.enabled', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Add-Ons > Poll-Shim >> General @{\"sort\": -500}',\n\t\t\t\ttitle: 'Enable Poll-Shim.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.onNavigate()\n\t\t});\n\n\t\tthis.settings.add('addon.poll-shim.user', {\n\t\t\tdefault: null,\n\t\t\trequires: ['context.channelID', 'context.session.user.id', 'context.route.name'],\n\t\t\tprocess: (ctx, val) => {\n\t\t\t\tif ( val == null || typeof val !== 'string' ) {\n\t\t\t\t\tconst route = ctx.get('context.route.name');\n\t\t\t\t\tif ( typeof route === 'string' && route.startsWith('dash-') )\n\t\t\t\t\t\treturn ctx.get('context.channelID');\n\n\t\t\t\t\treturn ctx.get('context.session.user.id');\n\t\t\t\t}\n\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Add-Ons > Poll-Shim >> General',\n\t\t\t\ttitle: 'Channel',\n\t\t\t\tdescription: 'Set this to override the channel where polls should be run. Please note that you must be a moderator of the channel in question to run a poll.',\n\t\t\t\tcomponent: () => import('./components/channel.vue')\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tif ( this.active ) {\n\t\t\t\t\tthis.deactivate();\n\t\t\t\t\tif ( this.shouldBeActive )\n\t\t\t\t\t\tthis.activate();\n\t\t\t\t} else\n\t\t\t\t\tthis.onNavigate();\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('addon.poll-shim.address', {\n\t\t\tdefault: 'ws://localhost:31337',\n\t\t\tui: {\n\t\t\t\tpath: 'Add-Ons > Poll-Shim >> Connectivity',\n\t\t\t\ttitle: 'Address',\n\t\t\t\tdescription: 'Connect to this address for polls.',\n\t\t\t\tcomponent: 'setting-text-box'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tif ( this._socket )\n\t\t\t\t\tthis._socket.reconnect();\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('addon.poll-shim.key', {\n\t\t\tdefault: generateUUID(),\n\t\t\tui: {\n\t\t\t\tpath: 'Add-Ons > Poll-Shim >> Authentication',\n\t\t\t\ttitle: 'Passphrase',\n\t\t\t\tdescription: 'The server you connect to must authenticate with this passphrase to be allowed to create polls.\\n\\n**Note:** This value changes every page load until you manually set it.',\n\t\t\t\tcomponent: 'setting-text-box'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tif ( this._socket )\n\t\t\t\t\tthis._socket.reconnect();\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('addon.poll-shim.client-key', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Add-Ons > Poll-Shim >> Authentication',\n\t\t\t\ttitle: 'Client Passphrase',\n\t\t\t\tdescription: 'If this is set, the client will authenticate by sending this passphrase to the server once the server connects.',\n\t\t\t\tcomponent: 'setting-text-box'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tif ( this._socket )\n\t\t\t\t\tthis._socket.reconnect();\n\t\t\t}\n\t\t});\n\n\t\tthis.url_provider = () => this.settings.get('addon.poll-shim.address');\n\t\tthis.active = false;\n\t\tthis.polls = new Set;\n\t\tthis.updating_polls = new Set;\n\t\tthis.socket_auth = false;\n\n\t\tthis.onWSClose = this.onWSClose.bind(this);\n\t\tthis.onWSMessage = this.onWSMessage.bind(this);\n\t\tthis.onWSOpen = this.onWSOpen.bind(this);\n\t}\n\n\tget shouldBeActive() {\n\t\tif ( ! this.enabled && ! this.enabling )\n\t\t\treturn false;\n\n\t\tif ( this.errored )\n\t\t\treturn false;\n\n\t\tif ( ! this.settings.get('addon.poll-shim.enabled') )\n\t\t\treturn false;\n\n\t\t// Make sure this updates on navigation / whatever.\n\t\tthis.settings.main_context.update('addon.poll-shim.user');\n\n\t\tconst user_id = this.settings.get('addon.poll-shim.user'),\n\t\t\tcore = this.site.getCore();\n\t\tif ( ! user_id || ! core || ! core.pubsub )\n\t\t\treturn false;\n\n\t\tconst route = this.router.current_name;\n\t\tif ( typeof route !== 'string' )\n\t\t\treturn false;\n\n\t\tif ( ! VALID_ROUTES.includes(route) && ! route.startsWith('dash-') )\n\t\t\treturn false;\n\n\t\tconst current_id = this.settings.get('context.channelID');\n\t\treturn current_id && current_id == user_id;\n\t}\n\n\tasync onEnable() {\n\t\tthis.ReconnectingWebSocket = (await import('reconnecting-websocket')).default;\n\n\t\tthis.on('site.router:route', this.onNavigate, this);\n\t\tthis.onNavigate();\n\t}\n\n\tonDisable() {\n\t\tthis.off('site.router:route', this.onNavigate, this);\n\t\tif ( this.active )\n\t\t\tthis.deactivate();\n\t}\n\n\tonNavigate() {\n\t\tconst should = this.shouldBeActive;\n\t\tif ( should && ! this.active )\n\t\t\tthis.activate();\n\t\telse if ( ! should && this.active )\n\t\t\tthis.deactivate();\n\t}\n\n\tasync activate() {\n\t\tif ( ! this.enabled && ! this.enabling )\n\t\t\treturn;\n\n\t\tconst user_id = this.settings.get('addon.poll-shim.user'),\n\t\t\tcore = this.site.getCore();\n\n\t\tif ( ! user_id || ! core || ! core.pubsub )\n\t\t\treturn;\n\n\t\tthis.channel_id = user_id;\n\t\tconst [user, self] = await Promise.all([\n\t\t\tthis.getUser(),\n\t\t\tthis.getSelf()\n\t\t]);\n\t\tif ( ! user ) {\n\t\t\tthis.channel_id = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log.info('Activating shim.');\n\n\t\tthis._unsub = core.pubsub.subscribe({\n\t\t\ttopic: `polls.${user_id}`,\n\t\t\tsuccess: () => {\n\t\t\t\tthis.pubsub_open = true;\n\t\t\t\tthis.emit(':update');\n\t\t\t},\n\t\t\tfailure: e => {\n\t\t\t\tthis.log.error('Failed to listen to pubsub', e);\n\t\t\t\tthis.errored = true;\n\t\t\t\tthis.pubsub_open = false;\n\t\t\t\tthis.deactivate();\n\t\t\t},\n\t\t\tonMessage: e => this.onPubSub(e)\n\t\t});\n\n\t\tthis._socket = new this.ReconnectingWebSocket(this.url_provider, [], {\n\t\t\tmaxEnqueuedMessages: 0\n\t\t});\n\t\tthis._socket.addEventListener('open', this.onWSOpen);\n\t\tthis._socket.addEventListener('close', this.onWSClose);\n\t\tthis._socket.addEventListener('message', this.onWSMessage);\n\n\t\tthis.active = true;\n\t\tthis.emit(':update');\n\t}\n\n\tdeactivate() {\n\t\tthis.log.info('Deactivating shim.');\n\n\t\tif ( this._unsub ) {\n\t\t\tthis._unsub();\n\t\t\tthis._unsub = null;\n\t\t}\n\n\t\tif ( this._socket ) {\n\t\t\tthis._socket.close();\n\t\t\tthis._socket.removeEventListener('open', this.onWSOpen);\n\t\t\tthis._socket.removeEventListener('close', this.onWSClose);\n\t\t\tthis._socket.removeEventListener('message', this.onWSMessage);\n\t\t\tthis._socket = null;\n\t\t}\n\n\t\tif ( this._open_timer ) {\n\t\t\tclearTimeout(this._open_timer);\n\t\t\tthis._open_timer = null;\n\t\t}\n\n\t\tthis.updating_polls.clear();\n\t\tthis.polls.clear();\n\t\tthis.pubsub_open = false;\n\t\tthis.socket_auth = false;\n\t\tthis.channel_id = null;\n\t\tthis._user = null;\n\t\tthis._self = null;\n\t\tthis.active = false;\n\t\tthis.emit(':update');\n\t}\n\n\tonPubSub(event) {\n\t\tconst type = event.type;\n\t\tif ( type === 'POLL_UPDATE' || type === 'POLL_COMPLETE' )\n\t\t\tthis.handlePoll(event.data.poll);\n\t}\n\n\tsend(type, msg = {}) {\n\t\tif ( ! this._socket )\n\t\t\treturn;\n\n\t\tif ( typeof msg !== 'object' )\n\t\t\tmsg = {data: msg};\n\n\t\tmsg.type = type;\n\t\tthis._socket.send(JSON.stringify(msg));\n\t}\n\n\tonWSOpen() {\n\t\tthis.log.debug('WebSocket Connected');\n\t\tthis.emit(':update');\n\n\t\tconst key = this.settings.get('addon.poll-shim.client-key');\n\t\tif ( key && key.length )\n\t\t\tthis.send('auth', {data: key});\n\n\t\tthis._open_timer = setTimeout(() => {\n\t\t\tif ( this._open_timer ) {\n\t\t\t\tclearTimeout(this._open_timer);\n\t\t\t\tthis._open_timer = null;\n\t\t\t}\n\n\t\t\tif ( this._socket )\n\t\t\t\tthis._socket.reconnect();\n\t\t}, 1000);\n\t}\n\n\tonWSClose() {\n\t\tif ( this._open_timer ) {\n\t\t\tclearTimeout(this._open_timer);\n\t\t\tthis._open_timer = null;\n\t\t}\n\n\t\tthis.log.debug('WebSocket Closed');\n\t\tthis.polls.clear();\n\t\tthis.updating_polls.clear();\n\t\tthis.socket_auth = false;\n\t\tthis.emit(':update');\n\t}\n\n\tasync getUser() {\n\t\tif ( this._user )\n\t\t\treturn this._user;\n\n\t\tconst user_id = this.channel_id;\n\t\tif ( ! user_id ) {\n\t\t\tthis._user = null;\n\t\t\treturn null;\n\t\t}\n\n\t\tthis._user = await this.twitch_data.getUser(user_id);\n\t\treturn this._user;\n\t}\n\n\tasync getSelf() {\n\t\tif ( this._self )\n\t\t\treturn this._self;\n\n\t\tconst user_id = this.channel_id;\n\t\tif ( ! user_id ) {\n\t\t\tthis._self = null;\n\t\t\treturn null;\n\t\t}\n\n\t\tconst current_user = this.site.getUser();\n\t\tif ( current_user && current_user.id == user_id ) {\n\t\t\tthis._self = {\n\t\t\t\tisModerator: true,\n\t\t\t\tisEditor: true\n\t\t\t}\n\t\t} else\n\t\t\tthis._self = await this.twitch_data.getUserSelf(user_id);\n\n\t\treturn this._self;\n\t}\n\n\tonWSMessage(event) {\n\t\tlet msg;\n\t\ttry {\n\t\t\tmsg = JSON.parse(event.data);\n\t\t} catch(err) {\n\t\t\tthis.log.debug('Invalid WS Message', err);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! msg || ! msg.type )\n\t\t\treturn;\n\n\t\tthis.log.debug('WebSocket Message', msg);\n\n\t\tconst type = msg.type;\n\t\tif ( type === 'auth' ) {\n\t\t\tif ( this.socket_auth || msg.data !== this.settings.get('addon.poll-shim.key') ) {\n\t\t\t\tthis.log.debug('WebSocket Authentication Error. Reconnecting.');\n\t\t\t\tthis.send('error', {id: 'bad_auth'});\n\t\t\t\tthis._socket.close();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif ( this._socket )\n\t\t\t\t\t\tthis._socket.reconnect();\n\t\t\t\t}, 1000);\n\n\t\t\t\tthis.emit(':update');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.socket_auth = true;\n\t\t\tthis.send('auth_ok');\n\t\t\tthis.log.info('WebSocket Connected and Authorized');\n\n\t\t\tPromise.all([\n\t\t\t\tthis.getUser(),\n\t\t\t\tthis.getSelf()\n\t\t\t]).then(([user, self]) => {\n\t\t\t\tif ( ! user )\n\t\t\t\t\treturn this.send('error', {id: 'no_user'});\n\n\t\t\t\tconst is_mod = (self && self.isModerator);\n\t\t\t\tconst roles = user.roles || {};\n\n\t\t\t\tthis.send('user', {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tlogin: user.login,\n\t\t\t\t\tdisplay_name: user.displayName,\n\t\t\t\t\tcan_create: is_mod && (roles.isAffiliate || roles.isPartner)\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif ( this._open_timer ) {\n\t\t\t\tclearTimeout(this._open_timer);\n\t\t\t\tthis._open_timer = null;\n\t\t\t}\n\n\t\t\tthis.emit(':update');\n\t\t\treturn;\n\n\t\t} else if ( ! this.socket_auth )\n\t\t\tthis.send('error', {id: 'no_auth'});\n\n\t\tif ( type === 'create' ) {\n\t\t\tif ( typeof msg.title !== 'string' )\n\t\t\t\treturn this.send('error', {id: 'no_title'});\n\n\t\t\tconst title = msg.title.trim();\n\t\t\tif ( ! title.length )\n\t\t\t\treturn this.send('error', {id: 'no_title'});\n\n\t\t\tif ( ! Array.isArray(msg.choices) || msg.choices.some(x => typeof x !== 'string' && x.length > 50) )\n\t\t\t\treturn this.send('error', {id: 'bad_choices'});\n\n\t\t\tif ( ! this.channel_id )\n\t\t\t\treturn this.send('error', {id: 'no_channel'});\n\n\t\t\tconst duration = msg.duration || 60;\n\t\t\tif ( typeof duration !== 'number' || duration < 15 || isNaN(duration) || duration > 180 )\n\t\t\t\treturn this.send('error', {id: 'bad_duration'});\n\n\t\t\tconst subscriberMultiplier = msg.subscriberMultiplier || false;\n\t\t\tconst subscriberOnly = msg.subscriberOnly || false;\n\n\t\t\tconst bits = msg.bits || 0;\n\t\t\tif ( typeof bits !== 'number' || bits > 10000 )\n\t\t\t\treturn this.send('error', {id: 'bad_bits'});\n\n\t\t\tthis.twitch_data.createPoll(\n\t\t\t\tthis.channel_id,\n\t\t\t\ttitle,\n\t\t\t\tmsg.choices,\n\t\t\t\t{\n\t\t\t\t\tduration,\n\t\t\t\t\tsubscriberMultiplier,\n\t\t\t\t\tsubscriberOnly,\n\t\t\t\t\tbits\n\t\t\t\t}\n\t\t\t).then(async poll => {\n\t\t\t\tif ( ! poll ) {\n\t\t\t\t\tconst user = await this.getUser(),\n\t\t\t\t\t\troles = user?.roles || {};\n\t\t\t\t\tif ( ! user )\n\t\t\t\t\t\treturn this.send('error', {id: 'cannot_poll', err: 'Invalid channel ID or API error.'});\n\t\t\t\t\tif ( ! roles.isAffiliate && ! roles.isPartner )\n\t\t\t\t\t\treturn this.send('error', {id: 'cannot_poll', err: 'Channel does not have access to Polls. Must be affiliate or partner.'});\n\n\t\t\t\t\tthis.send('error', {id: 'cannot_poll', err: 'Unable to create poll.'})\n\t\t\t\t}\n\n\t\t\t\tthis.polls.add(poll.id);\n\t\t\t\tthis.send('created', {id: poll.id});\n\n\t\t\t\tpoll.durationSeconds = duration;\n\t\t\t\tthis.handlePoll(poll);\n\t\t\t\tthis.emit(':update');\n\n\t\t\t}).catch(err => {\n\t\t\t\tthis.send('error', {id: 'cannot_poll', err: String(err)});\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( type === 'listen' ) {\n\t\t\tif ( ! msg.id )\n\t\t\t\tthis.send('error', {id: 'no_id'});\n\n\t\t\tthis.polls.add(msg.id);\n\t\t\tthis.updating_polls.add(msg.id);\n\t\t\tthis.twitch_data.getPoll(msg.id).then(data => {\n\t\t\t\tif ( ! this.updating_polls.has(msg.id) )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( ! data )\n\t\t\t\t\tdata = {\n\t\t\t\t\t\tid: msg.id,\n\t\t\t\t\t\tstatus: 'COMPLETED',\n\t\t\t\t\t\tchoices: []\n\t\t\t\t\t};\n\n\t\t\t\tthis.handlePoll(data);\n\t\t\t});\n\n\t\t\tthis.emit(':update');\n\t\t\treturn;\n\t\t}\n\n\t\tif ( type === 'get' ) {\n\t\t\tif ( ! msg.id )\n\t\t\t\tthis.send('error', {id: 'no_id'});\n\n\t\t\tthis.updating_polls.add(msg.id);\n\t\t\tthis.twitch_data.getPoll(msg.id).then(data => {\n\t\t\t\tif ( ! this.updating_polls.has(msg.id) )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( ! data )\n\t\t\t\t\tdata = {\n\t\t\t\t\t\tid: msg.id,\n\t\t\t\t\t\tstatus: 'COMPLETED',\n\t\t\t\t\t\tchoices: []\n\t\t\t\t\t};\n\n\t\t\t\tthis.handlePoll(data, true);\n\t\t\t});\n\n\t\t\tthis.emit(':update');\n\t\t\treturn;\n\t\t}\n\n\t\tif ( type === 'end' ) {\n\t\t\tif ( ! msg.id )\n\t\t\t\tthis.send('error', {id: 'no_id'});\n\n\t\t\tthis.twitch_data.terminatePoll(msg.id).then(() => {\n\t\t\t\tthis.updating_polls.delete(msg.id);\n\t\t\t\tthis.polls.delete(msg.id);\n\t\t\t\tthis.send('ended', {id: msg.id})\n\t\t\t});\n\n\t\t\tthis.emit(':update');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.send('error', {id: 'unknown_command'});\n\t}\n\n\thandlePoll(data, override = false, type = 'update') {\n\t\tif ( ! this.active || ! this._socket )\n\t\t\treturn;\n\n\t\tconst poll = formatPoll(data);\n\t\tthis.updating_polls.delete(poll.id);\n\n\t\tif ( ! this.polls.has(poll.id) && ! override )\n\t\t\treturn;\n\n\t\tif ( poll.ended ) {\n\t\t\tthis.polls.delete(poll.id);\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\tthis.send(type, {poll});\n\t}\n\n}\n\nPollShim.register();\n\nfunction formatPoll(data, poll_id) {\n\tif ( ! data )\n\t\treturn {\n\t\t\tid: poll_id,\n\t\t\tended: true,\n\t\t\tchoices: []\n\t\t};\n\n\tconst ended = data.status !== 'ACTIVE';\n\tlet duration = data.durationSeconds || data.duration_seconds,\n\t\tremaining = data.remaining_duration_milliseconds;\n\n\tif ( duration == null ) {\n\t\tconst ended = data.endedAt || data.ended_at,\n\t\t\tstarted = data.startedAt || data.startedAt;\n\n\t\tif ( started && ended )\n\t\t\tduration = Math.floor((Date.parse(ended) - Date.parse(started)) / 1000);\n\t\telse\n\t\t\tduration = 0;\n\t}\n\n\tif ( remaining == null ) {\n\t\tif ( ended )\n\t\t\tremaining = 0;\n\t\telse {\n\t\t\tconst started = data.startedAt || data.startedAt;\n\t\t\tif ( started )\n\t\t\t\tremaining = Math.max(0, (duration * 1000) - (Date.now() - Date.parse(started)));\n\t\t\telse\n\t\t\t\tremaining = duration * 1000;\n\t\t}\n\t}\n\n\tconst choices = [],\n\t\tout = {\n\t\t\tid: data.id || data.poll_id,\n\t\t\tended,\n\t\t\tduration,\n\t\t\tremaining,\n\t\t\tchoices\n\t\t};\n\n\tfor(const choice of data.choices)\n\t\tif ( choice )\n\t\t\tchoices.push({\n\t\t\t\ttext: choice.title,\n\t\t\t\tvotes: choice.votes?.total || 0\n\t\t\t});\n\n\treturn out;\n}"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","exports","definition","key","chunkId","promises","obj","prop","inProgress","dataWebpackPrefix","url","done","script","needAttach","scripts","i","s","onScriptComplete","prev","event","timeout","doneFns","fn","scriptUrl","document","installedChunks","installedChunkData","promise","resolve","reject","error","loadingEnded","errorType","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","data","chunkIds","moreModules","runtime","id","result","chunkLoadingGlobal","generateUUID","VALID_ROUTES","args","ctx","val","route","user_id","core","current_id","should","user","self","e","type","msg","current_user","err","is_mod","roles","title","x","duration","subscriberMultiplier","subscriberOnly","bits","poll","override","formatPoll","PollShim","poll_id","ended","remaining","started","choices","out","choice"],"sourceRoot":""}