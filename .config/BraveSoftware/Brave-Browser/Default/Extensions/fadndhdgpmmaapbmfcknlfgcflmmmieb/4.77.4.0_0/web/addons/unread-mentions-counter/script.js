(()=>{var h=Object.defineProperty;var l=(r,o)=>h(r,"name",{value:o,configurable:!0});(()=>{var r={};const s=class s extends FrankerFaceZ.utilities.addon.Addon{constructor(...t){super(...t),this.mentionCounterRegExp=/\(@[0-9]*\)/,this.titleObserver=new MutationObserver(this.monitorTitle),this.counterLocation=this.settings.get("addon.unread-mentions-counter.counter-location")||"icon",this.favicon={element:{16:document.querySelector('link[rel="icon"][sizes="16x16"]'),32:document.querySelector('link[rel="icon"][sizes="32x32"]')},original:{16:null,32:null}},this.favicon.original[16]=this.favicon.element[16].href,this.favicon.original[32]=this.favicon.element[32].href,this.inject("chat"),this.initializeSettings()}initializeSettings(){this.settings.add("addon.unread-mentions-counter.counter-location",{default:"icon",ui:{path:"Add-Ons > Unread Mentions Counter >> Behavior",title:"Counter Location",description:"Will not take effect until counter changes or page is refreshed.",component:"setting-select-box",data:[{value:"icon",title:"Icon"},{value:"tab-title",title:"Tab Title"},{value:"both",title:"Icon + Tab Title"}]}}),this.settings.add("addon.unread-mentions-counter.ping-types",{default:["mention"],type:"basic_array_merge",ui:{path:"Add-Ons > Unread Mentions Counter >> Behavior",title:"Ping Types",description:"Surprise! This add-on isn't *just* for mentions. Select which types of pings/highlights to count.",component:"setting-select-box",multiple:!0,data:()=>this.chat.getHighlightReasons()}}),this.settings.add("addon.unread-mentions-counter.browser-notifications.enabled",{default:!1,ui:{path:"Add-Ons > Unread Mentions Counter >> Browser Notifications",title:"Enable Browser Notifications",description:`Enable browser notifications for new unread mentions/pings.

**NOTE:** This requires enabling browser notifications on Twitch as a whole so if you don't want to receive browser notifications from Twitch itself be sure to disable those in the Notification Settings of your Twitch account.`,component:"setting-check-box",onUIChange:t=>t&&this.requestNotificationsPermission()}}),this.settings.add("addon.unread-mentions-counter.browser-notifications.interact-to-close",{default:!1,ui:{path:"Add-Ons > Unread Mentions Counter >> Browser Notifications",title:"Interact To Close",description:"If enabled, notifications will only close when you manually close them. Otherwise, notifications will automatically close after several seconds.",component:"setting-check-box"}}),this.settings.add("addon.unread-mentions-counter.browser-notifications.icon-photo",{default:"channel",ui:{path:"Add-Ons > Unread Mentions Counter >> Browser Notifications",title:"Notification Icon Photo",description:"Choose whose profile photo should be displayed in the notification.",component:"setting-select-box",data:[{value:"channel",title:"Channel"},{value:"message-author",title:"Message Author"}]}}),this.settings.add("addon.unread-mentions-counter.icon.bg-color",{default:"rgba(255, 0, 0, 1.0)",ui:{path:"Add-Ons > Unread Mentions Counter >> Icon Counter Appearance",title:"Background Color",description:"This is the color of the icon counter's circular background.",component:"setting-color-box",alpha:!0,openUp:!0},changed:()=>{this.insertIconCounter()}}),this.settings.add("addon.unread-mentions-counter.icon.text-color",{default:"rgba(255, 255, 255, 1.0)",ui:{path:"Add-Ons > Unread Mentions Counter >> Icon Counter Appearance",title:"Text Color",description:"This is the color of the icon counter's text (i.e. the number of unread mentions/pings).",component:"setting-color-box",alpha:!0,openUp:!0},changed:()=>{this.insertIconCounter()}})}countMentions(t){const e=t.message,n=this.settings.get("addon.unread-mentions-counter.ping-types"),i=n.filter(c=>e.highlights?.has(c)),u=this.settings.get("addon.unread-mentions-counter.browser-notifications.icon-photo")==="channel"?e.roomID:e.user.id;let a="Mention";if(!(document.visibilityState==="visible"&&document.hasFocus()||e.deleted||e.isHistorical||e.ffz_removed||!e.mentioned)&&e.mentioned&&i.length>0&&(this.mentionCount++,this.insertCounters(),i.includes("mention")||(a="Ping"),this.settings.get("addon.unread-mentions-counter.browser-notifications.enabled"))){const c=new Notification(`${a}ed by ${e.user.displayName} in ${e.roomLogin}'s chat`,{body:`${e.user.displayName}: ${e.message}`,icon:`https://cdn.frankerfacez.com/avatar/twitch/${u}`,requireInteraction:this.settings.get("addon.unread-mentions-counter.browser-notifications.interact-to-close")})}}createIcon(){for(const t of[16,32]){const e=document.createElement("canvas"),n=e.getContext("2d"),i=new Image;e.width=t,e.height=t,i.crossOrigin="anonymous",i.onload=()=>{n.drawImage(i,0,0,t,t),n.beginPath(),n.arc(e.width-t/3,t/3,t/3,0,2*Math.PI),n.fillStyle=this.settings.get("addon.unread-mentions-counter.icon.bg-color"),n.fill(),n.font=Math.ceil(t/1.78)+'px Inter, "Helvetica Neue", Helvetica, Arial, sans-serif',n.textAlign="center",n.textBaseline="middle",n.fillStyle=this.settings.get("addon.unread-mentions-counter.icon.text-color"),n.fillText(this.mentionCount,e.width-t/3,t/2.75),this.favicon.element[t].href=e.toDataURL()},i.src="/favicon.ico"}}insertCounters(){this.insertIconCounter(),this.insertTitleCounter()}insertIconCounter(){this.mentionCount>0&&["both","icon"].includes(this.counterLocation)?this.createIcon():this.resetIcon()}insertTitleCounter(){if(this.mentionCount===0||!["both","tab-title"].includes(this.counterLocation)){this.resetTitle();return}document.title.match(this.mentionCounterRegExp)?document.title=document.title.replace(this.mentionCounterRegExp,`(@${this.mentionCount})`):document.title=`(@${this.mentionCount}) ${document.title}`}monitorTitle(t){!t[0].target.textContent.match(this.mentionCounterRegExp)&&this.mentionCount>0&&this.insertTitleCounter()}onDisable(){this.stopCounting()}onEnable(){this.mentionCount=0,this.toggleCounting(this),document.addEventListener("visibilitychange",()=>{this.toggleCounting(this)},!1),window.addEventListener("blur",()=>{this.toggleCounting(this)},!1),window.addEventListener("focus",()=>{this.toggleCounting(this)},!1),this.log.info("Unread Mentions Counter add-on successfully enabled.")}requestNotificationsPermission(){Notification.requestPermission().then(t=>{t==="granted"?this.log.info("Browser notification permission has been granted by the user."):this.log.info("Browser notification permission has been denied by the user.")})}resetIcon(){this.favicon.element[16].href=this.favicon.original[16],this.favicon.element[32].href=this.favicon.original[32]}resetTitle(){document.title=document.title.replace(this.mentionCounterRegExp,"").trim()}stopCounting(){this.mentionCount=0,this.observingTitle=!1,this.resetTitle(),this.resetIcon(),this.titleObserver.disconnect(),this.off("chat:buffer-message",this.countMentions,this)}toggleCounting(t){if(document.visibilityState==="hidden"||document.visibilityState==="visible"&&!document.hasFocus()){if(this.observingTitle)return;this.titleObserver.observe(document.getElementsByTagName("title")[0],{subtree:!0,characterData:!0,childList:!0}),this.observingTitle=!0,t.on("chat:buffer-message",t.countMentions,t)}else t.stopCounting()}};l(s,"UnreadMentionsCounter");let o=s;o.register("unread-mentions-counter",null,"1.1.2")})();})();

//# sourceMappingURL=script.js.map