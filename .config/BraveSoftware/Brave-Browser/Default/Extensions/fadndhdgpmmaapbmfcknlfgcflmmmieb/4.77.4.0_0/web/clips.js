(()=>{var dr=Object.defineProperty;var B=(Mi,Pi)=>dr(Mi,"name",{value:Pi,configurable:!0});var Ks=[];(()=>{var Mi={22923:(ge,te)=>{"use strict";const S=/\s/,K={OPEN:"{",CLOSE:"}",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSING:"/",SEP:",",SUB_VAR:"#",ESCAPE:"'"},P="subnumeric_types",L="submessage_types",I=Object.keys(K),W=Symbol("C"),x=te=ge.exports=B(function r(g){if(!(this instanceof r))return new r(g);this.opts=Object.assign({OFFSET:"offset:",[P]:["plural","selectordinal"],[L]:["plural","selectordinal","select"],allowTags:!0,requireOther:!0},K,g);for(let u=0;u<I.length;u++){const w=I[u],z=this.opts[w];if(typeof z!="string"||z.length!==1)throw new Error(`Option ${w} must be a 1-length string`);for(let C=u+1;C<I.length;C++){const y=I[C];if(this.opts[y]===z)throw new Error(`Option ${w} and ${y} cannot match`)}}},"Parser2"),m=x.prototype;m.parse=function(r){return this.parseAST({msg:String(r),i:0},null)},m.parseAST=function(r,g){const u=r.msg,w=this.opts,z=u.length,C=g&&w[P].includes(g.t),y=[];for(;r.i<z;){const a=r.i,v=u[a];if(v===w.CLOSE)if(!g)f(y,"}"),r.i++;else break;else if(v===w.OPEN||C&&v===w.SUB_VAR)f(y,this.parseElement(r,g));else if(w.allowTags&&v===w.TAG_OPEN&&!S.test(u[a+1])){const F=this.parseTag(r,g);if(F===W){g.closed=!0;break}else f(y,F)}else f(y,this.parseText(r,g));if(r.i===a)throw c(v,r.i)}return y},m.parseText=function(r,g,u=!0,w=!0,z=!1){const C=r.msg,y=this.opts,a=y.allowTags,v=C.length,F=g&&y[P].includes(g.t);let A="";for(;r.i<v;){const D=C[r.i];if(D===y.OPEN||D===y.CLOSE||a&&(D===y.TAG_OPEN||z&&(D===y.TAG_CLOSE||D===y.TAG_CLOSING))||!u&&D===y.SEP||!w&&S.test(D)||F&&D===y.SUB_VAR)break;if(D===y.ESCAPE){let O=C[++r.i];if(O===y.ESCAPE)A+=O,r.i++;else if(O===y.OPEN||O===y.CLOSE||a&&(O===y.TAG_OPEN||z&&(O===y.TAG_CLOSE||O===y.TAG_CLOSING))||F&&O===y.SUB_VAR||!w||!u)for(A+=O;++r.i<v;)if(O=C[r.i],O===y.ESCAPE)if(O=C[r.i+1],O===y.ESCAPE)A+=O,r.i++;else{r.i++;break}else A+=O;else A+=D}else r.i++,A+=D}return A},m.parseTag=function(r,g){const u=r.msg,w=r.i,z=this.opts;r.i++;let C=u[r.i],y=!1;if(C===z.TAG_CLOSING){if(!g||!g.n)throw c(C,r.i);y=!0,r.i++,d(r)}const a=this.parseText(r,null,!1,!1,!0);if(!a)return u.slice(w,r.i);if(d(r),C=u[r.i],y){if(C!==z.TAG_CLOSE)throw b(z.TAG_CLOSE,C,r.i);if(a!==g.n)throw c("tag mismatch",w);return r.i++,W}if(y=!1,C===z.TAG_CLOSING&&(y=!0,r.i++,C=u[r.i]),C!==z.TAG_CLOSE)return u.slice(w,r.i);r.i++;const v={n:a};if(y)return v;const F=this.parseAST(r,v);if(F&&F.length&&(v.c=F),!v.closed&&r.i>=u.length)throw b("closing tag",r);return delete v.closed,v},m.parseElement=function(r,g){const u=r.msg,w=this.opts,z=g&&w[P].includes(g.t);let C=u[r.i];if(z&&C===w.SUB_VAR)return r.i++,{v:g.v,t:"number"};r.i++,d(r);const y=this.parseText(r,null,!1,!1);if(!y)throw b("placeholder id",C,r.i);const a={v:y};if(d(r),C=u[r.i],C===w.CLOSE)return r.i++,a;if(C!==w.SEP)throw b(`${w.SEP} or ${w.CLOSE}`,C,r.i);r.i++,d(r);const v=this.parseText(r,null,!1,!1);if(!v)throw b("type",r);if(a.t=v,d(r),C=u[r.i],C===w.CLOSE){if(w[L].includes(a.t))throw b("sub-messages",r);return r.i++,a}else if(C!==w.SEP)throw b(`${w.SEP} or ${w.CLOSE}`,C,r.i);if(r.i++,d(r),w[P].includes(a.t)){const F=this.parseOffset(r);F&&(a.f=F,d(r))}if(w[L].includes(a.t)){const F=this.parseSubmessages(r,a),A=w.requireOther;if((Array.isArray(A)?A.includes(a.t):A)&&!F.other)throw b("other sub-message",r);a.o=F}else{const F=this.parseText(r,null,!0,!0);if(!F)throw b("format",r);a.f=F.trimRight()}if(d(r),C=u[r.i],C!==w.CLOSE)throw b(w.CLOSE,C,r.i);return r.i++,a},m.parseSubmessages=function(r,g){const u=r.msg,w=u.length,z={};for(;r.i<w&&u[r.i]!==this.opts.CLOSE;){const y=this.parseText(r,null,!0,!1);if(!y)throw b("sub-message selector",r);d(r),z[y]=this.parseSubmessage(r,g),d(r)}return z},m.parseSubmessage=function(r,g){const u=r.msg,w=this.opts;if(u[r.i]!==w.OPEN)throw b(w.OPEN,r);r.i++;const z=this.parseAST(r,g);if(u[r.i]!==w.CLOSE)throw b(w.CLOSE,r);return r.i++,z},m.parseOffset=function(r){const g=r.msg,u=this.opts.OFFSET,w=g.length;if(g.slice(r.i,r.i+u.length)!==u)return;r.i+=u.length,d(r);const z=r.i;for(;r.i<w&&/[-\d]/.test(g[r.i]);)r.i++;if(z===r.i)throw b("number",r);return+g.slice(z,r.i)};function b(r,g,u){return typeof g=="object"&&(u=g.i,g=g.msg[u]),new SyntaxError(`expected ${r} at position ${u} but found ${g||"eof"}`)}B(b,"expected");function c(r,g){return new SyntaxError(`unexpected ${r} at position ${g}`)}B(c,"unexpected");function d(r){const g=r.msg,u=g.length;for(;r.i<u&&S.test(g[r.i]);)r.i++}B(d,"skipSpace");function f(r,g){const u=r.length-1;typeof g=="string"&&typeof r[u]=="string"?r[u]+=g:r.push(g)}B(f,"mergePush")},5926:(ge,te,S)=>{"use strict";S.d(te,{fi:()=>J,kZ:()=>O});var K=S(57845),P=S(23111),L=S(61378),I=S(52319);function W(G){return{scrollLeft:G.scrollLeft,scrollTop:G.scrollTop}}B(W,"getHTMLElementScroll");function x(G){return G===(0,L.Z)(G)||!(0,I.Re)(G)?(0,P.Z)(G):W(G)}B(x,"getNodeScroll");var m=S(43332),b=S(61300),c=S(4377),d=S(10710),f=S(62079);function r(G){var V=G.getBoundingClientRect(),q=(0,f.NM)(V.width)/G.offsetWidth||1,re=(0,f.NM)(V.height)/G.offsetHeight||1;return q!==1||re!==1}B(r,"isElementScaled");function g(G,V,q){q===void 0&&(q=!1);var re=(0,I.Re)(V),ae=(0,I.Re)(V)&&r(V),fe=(0,c.Z)(V),be=(0,K.Z)(G,ae,q),Pe={scrollLeft:0,scrollTop:0},ne={x:0,y:0};return(re||!re&&!q)&&(((0,m.Z)(V)!=="body"||(0,d.Z)(fe))&&(Pe=x(V)),(0,I.Re)(V)?(ne=(0,K.Z)(V,!0),ne.x+=V.clientLeft,ne.y+=V.clientTop):fe&&(ne.x=(0,b.Z)(fe))),{x:be.left+Pe.scrollLeft-ne.x,y:be.top+Pe.scrollTop-ne.y,width:be.width,height:be.height}}B(g,"getCompositeRect");var u=S(5618),w=S(26857),z=S(52839),C=S(49880);function y(G){var V=new Map,q=new Set,re=[];G.forEach(function(fe){V.set(fe.name,fe)});function ae(fe){q.add(fe.name);var be=[].concat(fe.requires||[],fe.requiresIfExists||[]);be.forEach(function(Pe){if(!q.has(Pe)){var ne=V.get(Pe);ne&&ae(ne)}}),re.push(fe)}return B(ae,"sort"),G.forEach(function(fe){q.has(fe.name)||ae(fe)}),re}B(y,"order");function a(G){var V=y(G);return C.xs.reduce(function(q,re){return q.concat(V.filter(function(ae){return ae.phase===re}))},[])}B(a,"orderModifiers");function v(G){var V;return function(){return V||(V=new Promise(function(q){Promise.resolve().then(function(){V=void 0,q(G())})})),V}}B(v,"debounce");function F(G){var V=G.reduce(function(q,re){var ae=q[re.name];return q[re.name]=ae?Object.assign({},ae,re,{options:Object.assign({},ae.options,re.options),data:Object.assign({},ae.data,re.data)}):re,q},{});return Object.keys(V).map(function(q){return V[q]})}B(F,"mergeByName");var A={placement:"bottom",modifiers:[],strategy:"absolute"};function D(){for(var G=arguments.length,V=new Array(G),q=0;q<G;q++)V[q]=arguments[q];return!V.some(function(re){return!(re&&typeof re.getBoundingClientRect=="function")})}B(D,"areValidElements");function O(G){G===void 0&&(G={});var V=G,q=V.defaultModifiers,re=q===void 0?[]:q,ae=V.defaultOptions,fe=ae===void 0?A:ae;return B(function(Pe,ne,ie){ie===void 0&&(ie=fe);var le={placement:"bottom",orderedModifiers:[],options:Object.assign({},A,fe),modifiersData:{},elements:{reference:Pe,popper:ne},attributes:{},styles:{}},ze=[],oe=!1,we={state:le,setOptions:B(function(Ie){var Ve=typeof Ie=="function"?Ie(le.options):Ie;Be(),le.options=Object.assign({},fe,le.options,Ve),le.scrollParents={reference:(0,I.kK)(Pe)?(0,w.Z)(Pe):Pe.contextElement?(0,w.Z)(Pe.contextElement):[],popper:(0,w.Z)(ne)};var Ke=a(F([].concat(re,le.options.modifiers)));return le.orderedModifiers=Ke.filter(function(Ye){return Ye.enabled}),Te(),we.update()},"setOptions"),forceUpdate:B(function(){if(!oe){var Ie=le.elements,Ve=Ie.reference,Ke=Ie.popper;if(D(Ve,Ke)){le.rects={reference:g(Ve,(0,z.Z)(Ke),le.options.strategy==="fixed"),popper:(0,u.Z)(Ke)},le.reset=!1,le.placement=le.options.placement,le.orderedModifiers.forEach(function(ye){return le.modifiersData[ye.name]=Object.assign({},ye.data)});for(var Ye=0;Ye<le.orderedModifiers.length;Ye++){if(le.reset===!0){le.reset=!1,Ye=-1;continue}var it=le.orderedModifiers[Ye],wt=it.fn,zt=it.options,Ht=zt===void 0?{}:zt,Wt=it.name;typeof wt=="function"&&(le=wt({state:le,options:Ht,name:Wt,instance:we})||le)}}}},"forceUpdate"),update:v(function(){return new Promise(function(Oe){we.forceUpdate(),Oe(le)})}),destroy:B(function(){Be(),oe=!0},"destroy")};if(!D(Pe,ne))return we;we.setOptions(ie).then(function(Oe){!oe&&ie.onFirstUpdate&&ie.onFirstUpdate(Oe)});function Te(){le.orderedModifiers.forEach(function(Oe){var Ie=Oe.name,Ve=Oe.options,Ke=Ve===void 0?{}:Ve,Ye=Oe.effect;if(typeof Ye=="function"){var it=Ye({state:le,name:Ie,instance:we,options:Ke}),wt=B(function(){},"noopFn2");ze.push(it||wt)}})}B(Te,"runModifierEffects");function Be(){ze.forEach(function(Oe){return Oe()}),ze=[]}return B(Be,"cleanupModifierEffects"),we},"createPopper2")}B(O,"popperGenerator");var J=O()},75865:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(52319);function P(L,I){var W=I.getRootNode&&I.getRootNode();if(L.contains(I))return!0;if(W&&(0,K.Zq)(W)){var x=I;do{if(x&&L.isSameNode(x))return!0;x=x.parentNode||x.host}while(x)}return!1}B(P,"contains")},57845:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(52319),P=S(62079),L=S(61378),I=S(16182);function W(x,m,b){m===void 0&&(m=!1),b===void 0&&(b=!1);var c=x.getBoundingClientRect(),d=1,f=1;m&&(0,K.Re)(x)&&(d=x.offsetWidth>0&&(0,P.NM)(c.width)/x.offsetWidth||1,f=x.offsetHeight>0&&(0,P.NM)(c.height)/x.offsetHeight||1);var r=(0,K.kK)(x)?(0,L.Z)(x):window,g=r.visualViewport,u=!(0,I.Z)()&&b,w=(c.left+(u&&g?g.offsetLeft:0))/d,z=(c.top+(u&&g?g.offsetTop:0))/f,C=c.width/d,y=c.height/f;return{width:C,height:y,top:z,right:w+C,bottom:z+y,left:w,x:w,y:z}}B(W,"getBoundingClientRect")},26302:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(61378);function P(L){return(0,K.Z)(L).getComputedStyle(L)}B(P,"getComputedStyle2")},4377:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(52319);function P(L){return(((0,K.kK)(L)?L.ownerDocument:L.document)||window.document).documentElement}B(P,"getDocumentElement")},5618:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(57845);function P(L){var I=(0,K.Z)(L),W=L.offsetWidth,x=L.offsetHeight;return Math.abs(I.width-W)<=1&&(W=I.width),Math.abs(I.height-x)<=1&&(x=I.height),{x:L.offsetLeft,y:L.offsetTop,width:W,height:x}}B(P,"getLayoutRect")},43332:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(P){return P?(P.nodeName||"").toLowerCase():null}B(K,"getNodeName")},52839:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>d});var K=S(61378),P=S(43332),L=S(26302),I=S(52319);function W(f){return["table","td","th"].indexOf((0,P.Z)(f))>=0}B(W,"isTableElement");var x=S(85564),m=S(3518);function b(f){return!(0,I.Re)(f)||(0,L.Z)(f).position==="fixed"?null:f.offsetParent}B(b,"getTrueOffsetParent");function c(f){var r=/firefox/i.test((0,m.Z)()),g=/Trident/i.test((0,m.Z)());if(g&&(0,I.Re)(f)){var u=(0,L.Z)(f);if(u.position==="fixed")return null}var w=(0,x.Z)(f);for((0,I.Zq)(w)&&(w=w.host);(0,I.Re)(w)&&["html","body"].indexOf((0,P.Z)(w))<0;){var z=(0,L.Z)(w);if(z.transform!=="none"||z.perspective!=="none"||z.contain==="paint"||["transform","perspective"].indexOf(z.willChange)!==-1||r&&z.willChange==="filter"||r&&z.filter&&z.filter!=="none")return w;w=w.parentNode}return null}B(c,"getContainingBlock");function d(f){for(var r=(0,K.Z)(f),g=b(f);g&&W(g)&&(0,L.Z)(g).position==="static";)g=b(g);return g&&((0,P.Z)(g)==="html"||(0,P.Z)(g)==="body"&&(0,L.Z)(g).position==="static")?r:g||c(f)||r}B(d,"getOffsetParent")},85564:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(43332),P=S(4377),L=S(52319);function I(W){return(0,K.Z)(W)==="html"?W:W.assignedSlot||W.parentNode||((0,L.Zq)(W)?W.host:null)||(0,P.Z)(W)}B(I,"getParentNode")},61378:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(P){if(P==null)return window;if(P.toString()!=="[object Window]"){var L=P.ownerDocument;return L&&L.defaultView||window}return P}B(K,"getWindow")},23111:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(61378);function P(L){var I=(0,K.Z)(L),W=I.pageXOffset,x=I.pageYOffset;return{scrollLeft:W,scrollTop:x}}B(P,"getWindowScroll")},61300:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(57845),P=S(4377),L=S(23111);function I(W){return(0,K.Z)((0,P.Z)(W)).left+(0,L.Z)(W).scrollLeft}B(I,"getWindowScrollBarX")},52319:(ge,te,S)=>{"use strict";S.d(te,{Re:()=>L,Zq:()=>I,kK:()=>P});var K=S(61378);function P(W){var x=(0,K.Z)(W).Element;return W instanceof x||W instanceof Element}B(P,"isElement");function L(W){var x=(0,K.Z)(W).HTMLElement;return W instanceof x||W instanceof HTMLElement}B(L,"isHTMLElement");function I(W){if(typeof ShadowRoot>"u")return!1;var x=(0,K.Z)(W).ShadowRoot;return W instanceof x||W instanceof ShadowRoot}B(I,"isShadowRoot")},16182:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(3518);function P(){return!/^((?!chrome|android).)*safari/i.test((0,K.Z)())}B(P,"isLayoutViewport")},10710:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(26302);function P(L){var I=(0,K.Z)(L),W=I.overflow,x=I.overflowX,m=I.overflowY;return/auto|scroll|overlay|hidden/.test(W+m+x)}B(P,"isScrollParent")},26857:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>m});var K=S(85564),P=S(10710),L=S(43332),I=S(52319);function W(b){return["html","body","#document"].indexOf((0,L.Z)(b))>=0?b.ownerDocument.body:(0,I.Re)(b)&&(0,P.Z)(b)?b:W((0,K.Z)(b))}B(W,"getScrollParent");var x=S(61378);function m(b,c){var d;c===void 0&&(c=[]);var f=W(b),r=f===((d=b.ownerDocument)==null?void 0:d.body),g=(0,x.Z)(f),u=r?[g].concat(g.visualViewport||[],(0,P.Z)(f)?f:[]):f,w=c.concat(u);return r?w:w.concat(m((0,K.Z)(u)))}B(m,"listScrollParents")},49880:(ge,te,S)=>{"use strict";S.d(te,{BL:()=>m,Ct:()=>u,DH:()=>a,F2:()=>L,I:()=>P,MS:()=>D,N7:()=>w,Pj:()=>d,XM:()=>y,YP:()=>r,bw:()=>g,cW:()=>A,d7:()=>W,ij:()=>z,iv:()=>F,k5:()=>f,mv:()=>x,r5:()=>C,t$:()=>I,ut:()=>b,wX:()=>v,we:()=>K,xs:()=>O,zV:()=>c});var K="top",P="bottom",L="right",I="left",W="auto",x=[K,P,L,I],m="start",b="end",c="clippingParents",d="viewport",f="popper",r="reference",g=x.reduce(function(J,G){return J.concat([G+"-"+m,G+"-"+b])},[]),u=[].concat(x,[W]).reduce(function(J,G){return J.concat([G,G+"-"+m,G+"-"+b])},[]),w="beforeRead",z="read",C="afterRead",y="beforeMain",a="main",v="afterMain",F="beforeWrite",A="write",D="afterWrite",O=[w,z,C,y,a,v,F,A,D]},16572:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{afterMain:()=>K.wX,afterRead:()=>K.r5,afterWrite:()=>K.MS,applyStyles:()=>P.Z,arrow:()=>L.Z,auto:()=>K.d7,basePlacements:()=>K.mv,beforeMain:()=>K.XM,beforeRead:()=>K.N7,beforeWrite:()=>K.iv,bottom:()=>K.I,clippingParents:()=>K.zV,computeStyles:()=>I.Z,createPopper:()=>g.fi,createPopperBase:()=>f.fi,createPopperLite:()=>w,detectOverflow:()=>r.Z,end:()=>K.ut,eventListeners:()=>W.Z,flip:()=>x.Z,hide:()=>m.Z,left:()=>K.t$,main:()=>K.DH,modifierPhases:()=>K.xs,offset:()=>b.Z,placements:()=>K.Ct,popper:()=>K.k5,popperGenerator:()=>f.kZ,popperOffsets:()=>c.Z,preventOverflow:()=>d.Z,read:()=>K.ij,reference:()=>K.YP,right:()=>K.F2,start:()=>K.BL,top:()=>K.we,variationPlacements:()=>K.bw,viewport:()=>K.Pj,write:()=>K.cW});var K=S(49880),P=S(32898),L=S(63454),I=S(24502),W=S(72582),x=S(16087),m=S(48051),b=S(61150),c=S(35772),d=S(29228),f=S(5926),r=S(24041),g=S(78224),u=[W.Z,c.Z,I.Z,P.Z],w=(0,f.kZ)({defaultModifiers:u})},32898:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(43332),P=S(52319);function L(x){var m=x.state;Object.keys(m.elements).forEach(function(b){var c=m.styles[b]||{},d=m.attributes[b]||{},f=m.elements[b];!(0,P.Re)(f)||!(0,K.Z)(f)||(Object.assign(f.style,c),Object.keys(d).forEach(function(r){var g=d[r];g===!1?f.removeAttribute(r):f.setAttribute(r,g===!0?"":g)}))})}B(L,"applyStyles");function I(x){var m=x.state,b={popper:{position:m.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(m.elements.popper.style,b.popper),m.styles=b,m.elements.arrow&&Object.assign(m.elements.arrow.style,b.arrow),function(){Object.keys(m.elements).forEach(function(c){var d=m.elements[c],f=m.attributes[c]||{},r=Object.keys(m.styles.hasOwnProperty(c)?m.styles[c]:b[c]),g=r.reduce(function(u,w){return u[w]="",u},{});!(0,P.Re)(d)||!(0,K.Z)(d)||(Object.assign(d.style,g),Object.keys(f).forEach(function(u){d.removeAttribute(u)}))})}}B(I,"effect");const W={name:"applyStyles",enabled:!0,phase:"write",fn:L,effect:I,requires:["computeStyles"]}},63454:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>g});var K=S(65352),P=S(5618),L=S(75865),I=S(52839),W=S(61919),x=S(72907),m=S(49534),b=S(62219),c=S(49880),d=B(function(w,z){return w=typeof w=="function"?w(Object.assign({},z.rects,{placement:z.placement})):w,(0,m.Z)(typeof w!="number"?w:(0,b.Z)(w,c.mv))},"toPaddingObject2");function f(u){var w,z=u.state,C=u.name,y=u.options,a=z.elements.arrow,v=z.modifiersData.popperOffsets,F=(0,K.Z)(z.placement),A=(0,W.Z)(F),D=[c.t$,c.F2].indexOf(F)>=0,O=D?"height":"width";if(!(!a||!v)){var J=d(y.padding,z),G=(0,P.Z)(a),V=A==="y"?c.we:c.t$,q=A==="y"?c.I:c.F2,re=z.rects.reference[O]+z.rects.reference[A]-v[A]-z.rects.popper[O],ae=v[A]-z.rects.reference[A],fe=(0,I.Z)(a),be=fe?A==="y"?fe.clientHeight||0:fe.clientWidth||0:0,Pe=re/2-ae/2,ne=J[V],ie=be-G[O]-J[q],le=be/2-G[O]/2+Pe,ze=(0,x.u)(ne,le,ie),oe=A;z.modifiersData[C]=(w={},w[oe]=ze,w.centerOffset=ze-le,w)}}B(f,"arrow");function r(u){var w=u.state,z=u.options,C=z.element,y=C===void 0?"[data-popper-arrow]":C;y!=null&&(typeof y=="string"&&(y=w.elements.popper.querySelector(y),!y)||(0,L.Z)(w.elements.popper,y)&&(w.elements.arrow=y))}B(r,"effect");const g={name:"arrow",enabled:!0,phase:"main",fn:f,effect:r,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]}},24502:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>g});var K=S(49880),P=S(52839),L=S(61378),I=S(4377),W=S(26302),x=S(65352),m=S(47408),b=S(62079),c={top:"auto",right:"auto",bottom:"auto",left:"auto"};function d(u,w){var z=u.x,C=u.y,y=w.devicePixelRatio||1;return{x:(0,b.NM)(z*y)/y||0,y:(0,b.NM)(C*y)/y||0}}B(d,"roundOffsetsByDPR");function f(u){var w,z=u.popper,C=u.popperRect,y=u.placement,a=u.variation,v=u.offsets,F=u.position,A=u.gpuAcceleration,D=u.adaptive,O=u.roundOffsets,J=u.isFixed,G=v.x,V=G===void 0?0:G,q=v.y,re=q===void 0?0:q,ae=typeof O=="function"?O({x:V,y:re}):{x:V,y:re};V=ae.x,re=ae.y;var fe=v.hasOwnProperty("x"),be=v.hasOwnProperty("y"),Pe=K.t$,ne=K.we,ie=window;if(D){var le=(0,P.Z)(z),ze="clientHeight",oe="clientWidth";if(le===(0,L.Z)(z)&&(le=(0,I.Z)(z),(0,W.Z)(le).position!=="static"&&F==="absolute"&&(ze="scrollHeight",oe="scrollWidth")),le=le,y===K.we||(y===K.t$||y===K.F2)&&a===K.ut){ne=K.I;var we=J&&le===ie&&ie.visualViewport?ie.visualViewport.height:le[ze];re-=we-C.height,re*=A?1:-1}if(y===K.t$||(y===K.we||y===K.I)&&a===K.ut){Pe=K.F2;var Te=J&&le===ie&&ie.visualViewport?ie.visualViewport.width:le[oe];V-=Te-C.width,V*=A?1:-1}}var Be=Object.assign({position:F},D&&c),Oe=O===!0?d({x:V,y:re},(0,L.Z)(z)):{x:V,y:re};if(V=Oe.x,re=Oe.y,A){var Ie;return Object.assign({},Be,(Ie={},Ie[ne]=be?"0":"",Ie[Pe]=fe?"0":"",Ie.transform=(ie.devicePixelRatio||1)<=1?"translate("+V+"px, "+re+"px)":"translate3d("+V+"px, "+re+"px, 0)",Ie))}return Object.assign({},Be,(w={},w[ne]=be?re+"px":"",w[Pe]=fe?V+"px":"",w.transform="",w))}B(f,"mapToStyles");function r(u){var w=u.state,z=u.options,C=z.gpuAcceleration,y=C===void 0?!0:C,a=z.adaptive,v=a===void 0?!0:a,F=z.roundOffsets,A=F===void 0?!0:F,D={placement:(0,x.Z)(w.placement),variation:(0,m.Z)(w.placement),popper:w.elements.popper,popperRect:w.rects.popper,gpuAcceleration:y,isFixed:w.options.strategy==="fixed"};w.modifiersData.popperOffsets!=null&&(w.styles.popper=Object.assign({},w.styles.popper,f(Object.assign({},D,{offsets:w.modifiersData.popperOffsets,position:w.options.strategy,adaptive:v,roundOffsets:A})))),w.modifiersData.arrow!=null&&(w.styles.arrow=Object.assign({},w.styles.arrow,f(Object.assign({},D,{offsets:w.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:A})))),w.attributes.popper=Object.assign({},w.attributes.popper,{"data-popper-placement":w.placement})}B(r,"computeStyles");const g={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:r,data:{}}},72582:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(61378),P={passive:!0};function L(W){var x=W.state,m=W.instance,b=W.options,c=b.scroll,d=c===void 0?!0:c,f=b.resize,r=f===void 0?!0:f,g=(0,K.Z)(x.elements.popper),u=[].concat(x.scrollParents.reference,x.scrollParents.popper);return d&&u.forEach(function(w){w.addEventListener("scroll",m.update,P)}),r&&g.addEventListener("resize",m.update,P),function(){d&&u.forEach(function(w){w.removeEventListener("scroll",m.update,P)}),r&&g.removeEventListener("resize",m.update,P)}}B(L,"effect");const I={name:"eventListeners",enabled:!0,phase:"write",fn:B(function(){},"fn"),effect:L,data:{}}},16087:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>r});var K={left:"right",right:"left",bottom:"top",top:"bottom"};function P(g){return g.replace(/left|right|bottom|top/g,function(u){return K[u]})}B(P,"getOppositePlacement");var L=S(65352),I={start:"end",end:"start"};function W(g){return g.replace(/start|end/g,function(u){return I[u]})}B(W,"getOppositeVariationPlacement");var x=S(24041),m=S(47408),b=S(49880);function c(g,u){u===void 0&&(u={});var w=u,z=w.placement,C=w.boundary,y=w.rootBoundary,a=w.padding,v=w.flipVariations,F=w.allowedAutoPlacements,A=F===void 0?b.Ct:F,D=(0,m.Z)(z),O=D?v?b.bw:b.bw.filter(function(V){return(0,m.Z)(V)===D}):b.mv,J=O.filter(function(V){return A.indexOf(V)>=0});J.length===0&&(J=O);var G=J.reduce(function(V,q){return V[q]=(0,x.Z)(g,{placement:q,boundary:C,rootBoundary:y,padding:a})[(0,L.Z)(q)],V},{});return Object.keys(G).sort(function(V,q){return G[V]-G[q]})}B(c,"computeAutoPlacement");function d(g){if((0,L.Z)(g)===b.d7)return[];var u=P(g);return[W(g),u,W(u)]}B(d,"getExpandedFallbackPlacements");function f(g){var u=g.state,w=g.options,z=g.name;if(!u.modifiersData[z]._skip){for(var C=w.mainAxis,y=C===void 0?!0:C,a=w.altAxis,v=a===void 0?!0:a,F=w.fallbackPlacements,A=w.padding,D=w.boundary,O=w.rootBoundary,J=w.altBoundary,G=w.flipVariations,V=G===void 0?!0:G,q=w.allowedAutoPlacements,re=u.options.placement,ae=(0,L.Z)(re),fe=ae===re,be=F||(fe||!V?[P(re)]:d(re)),Pe=[re].concat(be).reduce(function(ue,xe){return ue.concat((0,L.Z)(xe)===b.d7?c(u,{placement:xe,boundary:D,rootBoundary:O,padding:A,flipVariations:V,allowedAutoPlacements:q}):xe)},[]),ne=u.rects.reference,ie=u.rects.popper,le=new Map,ze=!0,oe=Pe[0],we=0;we<Pe.length;we++){var Te=Pe[we],Be=(0,L.Z)(Te),Oe=(0,m.Z)(Te)===b.BL,Ie=[b.we,b.I].indexOf(Be)>=0,Ve=Ie?"width":"height",Ke=(0,x.Z)(u,{placement:Te,boundary:D,rootBoundary:O,altBoundary:J,padding:A}),Ye=Ie?Oe?b.F2:b.t$:Oe?b.I:b.we;ne[Ve]>ie[Ve]&&(Ye=P(Ye));var it=P(Ye),wt=[];if(y&&wt.push(Ke[Be]<=0),v&&wt.push(Ke[Ye]<=0,Ke[it]<=0),wt.every(function(ue){return ue})){oe=Te,ze=!1;break}le.set(Te,wt)}if(ze)for(var zt=V?3:1,Ht=B(function(xe){var Re=Pe.find(function(He){var Ze=le.get(He);if(Ze)return Ze.slice(0,xe).every(function(qe){return qe})});if(Re)return oe=Re,"break"},"_loop2"),Wt=zt;Wt>0;Wt--){var ye=Ht(Wt);if(ye==="break")break}u.placement!==oe&&(u.modifiersData[z]._skip=!0,u.placement=oe,u.reset=!0)}}B(f,"flip");const r={name:"flip",enabled:!0,phase:"main",fn:f,requiresIfExists:["offset"],data:{_skip:!1}}},48051:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>x});var K=S(49880),P=S(24041);function L(m,b,c){return c===void 0&&(c={x:0,y:0}),{top:m.top-b.height-c.y,right:m.right-b.width+c.x,bottom:m.bottom-b.height+c.y,left:m.left-b.width-c.x}}B(L,"getSideOffsets");function I(m){return[K.we,K.F2,K.I,K.t$].some(function(b){return m[b]>=0})}B(I,"isAnySideFullyClipped");function W(m){var b=m.state,c=m.name,d=b.rects.reference,f=b.rects.popper,r=b.modifiersData.preventOverflow,g=(0,P.Z)(b,{elementContext:"reference"}),u=(0,P.Z)(b,{altBoundary:!0}),w=L(g,d),z=L(u,f,r),C=I(w),y=I(z);b.modifiersData[c]={referenceClippingOffsets:w,popperEscapeOffsets:z,isReferenceHidden:C,hasPopperEscaped:y},b.attributes.popper=Object.assign({},b.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":y})}B(W,"hide");const x={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:W}},61150:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(65352),P=S(49880);function L(x,m,b){var c=(0,K.Z)(x),d=[P.t$,P.we].indexOf(c)>=0?-1:1,f=typeof b=="function"?b(Object.assign({},m,{placement:x})):b,r=f[0],g=f[1];return r=r||0,g=(g||0)*d,[P.t$,P.F2].indexOf(c)>=0?{x:g,y:r}:{x:r,y:g}}B(L,"distanceAndSkiddingToXY");function I(x){var m=x.state,b=x.options,c=x.name,d=b.offset,f=d===void 0?[0,0]:d,r=P.Ct.reduce(function(z,C){return z[C]=L(C,m.rects,f),z},{}),g=r[m.placement],u=g.x,w=g.y;m.modifiersData.popperOffsets!=null&&(m.modifiersData.popperOffsets.x+=u,m.modifiersData.popperOffsets.y+=w),m.modifiersData[c]=r}B(I,"offset");const W={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:I}},35772:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>L});var K=S(47840);function P(I){var W=I.state,x=I.name;W.modifiersData[x]=(0,K.Z)({reference:W.rects.reference,element:W.rects.popper,strategy:"absolute",placement:W.placement})}B(P,"popperOffsets");const L={name:"popperOffsets",enabled:!0,phase:"read",fn:P,data:{}}},29228:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>g});var K=S(49880),P=S(65352),L=S(61919);function I(u){return u==="x"?"y":"x"}B(I,"getAltAxis");var W=S(72907),x=S(5618),m=S(52839),b=S(24041),c=S(47408),d=S(29852),f=S(62079);function r(u){var w=u.state,z=u.options,C=u.name,y=z.mainAxis,a=y===void 0?!0:y,v=z.altAxis,F=v===void 0?!1:v,A=z.boundary,D=z.rootBoundary,O=z.altBoundary,J=z.padding,G=z.tether,V=G===void 0?!0:G,q=z.tetherOffset,re=q===void 0?0:q,ae=(0,b.Z)(w,{boundary:A,rootBoundary:D,padding:J,altBoundary:O}),fe=(0,P.Z)(w.placement),be=(0,c.Z)(w.placement),Pe=!be,ne=(0,L.Z)(fe),ie=I(ne),le=w.modifiersData.popperOffsets,ze=w.rects.reference,oe=w.rects.popper,we=typeof re=="function"?re(Object.assign({},w.rects,{placement:w.placement})):re,Te=typeof we=="number"?{mainAxis:we,altAxis:we}:Object.assign({mainAxis:0,altAxis:0},we),Be=w.modifiersData.offset?w.modifiersData.offset[w.placement]:null,Oe={x:0,y:0};if(le){if(a){var Ie,Ve=ne==="y"?K.we:K.t$,Ke=ne==="y"?K.I:K.F2,Ye=ne==="y"?"height":"width",it=le[ne],wt=it+ae[Ve],zt=it-ae[Ke],Ht=V?-oe[Ye]/2:0,Wt=be===K.BL?ze[Ye]:oe[Ye],ye=be===K.BL?-oe[Ye]:-ze[Ye],ue=w.elements.arrow,xe=V&&ue?(0,x.Z)(ue):{width:0,height:0},Re=w.modifiersData["arrow#persistent"]?w.modifiersData["arrow#persistent"].padding:(0,d.Z)(),He=Re[Ve],Ze=Re[Ke],qe=(0,W.u)(0,ze[Ye],xe[Ye]),st=Pe?ze[Ye]/2-Ht-qe-He-Te.mainAxis:Wt-qe-He-Te.mainAxis,xt=Pe?-ze[Ye]/2+Ht+qe+Ze+Te.mainAxis:ye+qe+Ze+Te.mainAxis,Kt=w.elements.arrow&&(0,m.Z)(w.elements.arrow),nt=Kt?ne==="y"?Kt.clientTop||0:Kt.clientLeft||0:0,l=(Ie=Be?.[ne])!=null?Ie:0,p=it+st-l-nt,$=it+xt-l,M=(0,W.u)(V?(0,f.VV)(wt,p):wt,it,V?(0,f.Fp)(zt,$):zt);le[ne]=M,Oe[ne]=M-it}if(F){var Z,H=ne==="x"?K.we:K.t$,j=ne==="x"?K.I:K.F2,U=le[ie],ee=ie==="y"?"height":"width",he=U+ae[H],Se=U-ae[j],De=[K.we,K.t$].indexOf(fe)!==-1,Me=(Z=Be?.[ie])!=null?Z:0,X=De?he:U-ze[ee]-oe[ee]-Me+Te.altAxis,_e=De?U+ze[ee]+oe[ee]-Me-Te.altAxis:Se,se=V&&De?(0,W.q)(X,U,_e):(0,W.u)(V?X:he,U,V?_e:Se);le[ie]=se,Oe[ie]=se-U}w.modifiersData[C]=Oe}}B(r,"preventOverflow");const g={name:"preventOverflow",enabled:!0,phase:"main",fn:r,requiresIfExists:["offset"]}},78224:(ge,te,S)=>{"use strict";S.d(te,{fi:()=>r});var K=S(5926),P=S(72582),L=S(35772),I=S(24502),W=S(32898),x=S(61150),m=S(16087),b=S(29228),c=S(63454),d=S(48051),f=[P.Z,L.Z,I.Z,W.Z,x.Z,m.Z,b.Z,c.Z,d.Z],r=(0,K.kZ)({defaultModifiers:f})},47840:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(65352),P=S(47408),L=S(61919),I=S(49880);function W(x){var m=x.reference,b=x.element,c=x.placement,d=c?(0,K.Z)(c):null,f=c?(0,P.Z)(c):null,r=m.x+m.width/2-b.width/2,g=m.y+m.height/2-b.height/2,u;switch(d){case I.we:u={x:r,y:m.y-b.height};break;case I.I:u={x:r,y:m.y+m.height};break;case I.F2:u={x:m.x+m.width,y:g};break;case I.t$:u={x:m.x-b.width,y:g};break;default:u={x:m.x,y:m.y}}var w=d?(0,L.Z)(d):null;if(w!=null){var z=w==="y"?"height":"width";switch(f){case I.BL:u[w]=u[w]-(m[z]/2-b[z]/2);break;case I.ut:u[w]=u[w]+(m[z]/2-b[z]/2);break;default:}}return u}B(W,"computeOffsets")},24041:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>G});var K=S(49880),P=S(61378),L=S(4377),I=S(61300),W=S(16182);function x(V,q){var re=(0,P.Z)(V),ae=(0,L.Z)(V),fe=re.visualViewport,be=ae.clientWidth,Pe=ae.clientHeight,ne=0,ie=0;if(fe){be=fe.width,Pe=fe.height;var le=(0,W.Z)();(le||!le&&q==="fixed")&&(ne=fe.offsetLeft,ie=fe.offsetTop)}return{width:be,height:Pe,x:ne+(0,I.Z)(V),y:ie}}B(x,"getViewportRect");var m=S(26302),b=S(23111),c=S(62079);function d(V){var q,re=(0,L.Z)(V),ae=(0,b.Z)(V),fe=(q=V.ownerDocument)==null?void 0:q.body,be=(0,c.Fp)(re.scrollWidth,re.clientWidth,fe?fe.scrollWidth:0,fe?fe.clientWidth:0),Pe=(0,c.Fp)(re.scrollHeight,re.clientHeight,fe?fe.scrollHeight:0,fe?fe.clientHeight:0),ne=-ae.scrollLeft+(0,I.Z)(V),ie=-ae.scrollTop;return(0,m.Z)(fe||re).direction==="rtl"&&(ne+=(0,c.Fp)(re.clientWidth,fe?fe.clientWidth:0)-be),{width:be,height:Pe,x:ne,y:ie}}B(d,"getDocumentRect");var f=S(26857),r=S(52839),g=S(52319),u=S(57845),w=S(85564),z=S(75865),C=S(43332);function y(V){return Object.assign({},V,{left:V.x,top:V.y,right:V.x+V.width,bottom:V.y+V.height})}B(y,"rectToClientRect");function a(V,q){var re=(0,u.Z)(V,!1,q==="fixed");return re.top=re.top+V.clientTop,re.left=re.left+V.clientLeft,re.bottom=re.top+V.clientHeight,re.right=re.left+V.clientWidth,re.width=V.clientWidth,re.height=V.clientHeight,re.x=re.left,re.y=re.top,re}B(a,"getInnerBoundingClientRect");function v(V,q,re){return q===K.Pj?y(x(V,re)):(0,g.kK)(q)?a(q,re):y(d((0,L.Z)(V)))}B(v,"getClientRectFromMixedType");function F(V){var q=(0,f.Z)((0,w.Z)(V)),re=["absolute","fixed"].indexOf((0,m.Z)(V).position)>=0,ae=re&&(0,g.Re)(V)?(0,r.Z)(V):V;return(0,g.kK)(ae)?q.filter(function(fe){return(0,g.kK)(fe)&&(0,z.Z)(fe,ae)&&(0,C.Z)(fe)!=="body"}):[]}B(F,"getClippingParents");function A(V,q,re,ae){var fe=q==="clippingParents"?F(V):[].concat(q),be=[].concat(fe,[re]),Pe=be[0],ne=be.reduce(function(ie,le){var ze=v(V,le,ae);return ie.top=(0,c.Fp)(ze.top,ie.top),ie.right=(0,c.VV)(ze.right,ie.right),ie.bottom=(0,c.VV)(ze.bottom,ie.bottom),ie.left=(0,c.Fp)(ze.left,ie.left),ie},v(V,Pe,ae));return ne.width=ne.right-ne.left,ne.height=ne.bottom-ne.top,ne.x=ne.left,ne.y=ne.top,ne}B(A,"getClippingRect");var D=S(47840),O=S(49534),J=S(62219);function G(V,q){q===void 0&&(q={});var re=q,ae=re.placement,fe=ae===void 0?V.placement:ae,be=re.strategy,Pe=be===void 0?V.strategy:be,ne=re.boundary,ie=ne===void 0?K.zV:ne,le=re.rootBoundary,ze=le===void 0?K.Pj:le,oe=re.elementContext,we=oe===void 0?K.k5:oe,Te=re.altBoundary,Be=Te===void 0?!1:Te,Oe=re.padding,Ie=Oe===void 0?0:Oe,Ve=(0,O.Z)(typeof Ie!="number"?Ie:(0,J.Z)(Ie,K.mv)),Ke=we===K.k5?K.YP:K.k5,Ye=V.rects.popper,it=V.elements[Be?Ke:we],wt=A((0,g.kK)(it)?it:it.contextElement||(0,L.Z)(V.elements.popper),ie,ze,Pe),zt=(0,u.Z)(V.elements.reference),Ht=(0,D.Z)({reference:zt,element:Ye,strategy:"absolute",placement:fe}),Wt=y(Object.assign({},Ye,Ht)),ye=we===K.k5?Wt:zt,ue={top:wt.top-ye.top+Ve.top,bottom:ye.bottom-wt.bottom+Ve.bottom,left:wt.left-ye.left+Ve.left,right:ye.right-wt.right+Ve.right},xe=V.modifiersData.offset;if(we===K.k5&&xe){var Re=xe[fe];Object.keys(ue).forEach(function(He){var Ze=[K.F2,K.I].indexOf(He)>=0?1:-1,qe=[K.we,K.I].indexOf(He)>=0?"y":"x";ue[He]+=Re[qe]*Ze})}return ue}B(G,"detectOverflow")},62219:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(P,L){return L.reduce(function(I,W){return I[W]=P,I},{})}B(K,"expandToHashMap")},65352:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(P){return P.split("-")[0]}B(K,"getBasePlacement")},29852:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(){return{top:0,right:0,bottom:0,left:0}}B(K,"getFreshSideObject")},61919:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(P){return["top","bottom"].indexOf(P)>=0?"x":"y"}B(K,"getMainAxisFromPlacement")},47408:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(P){return P.split("-")[1]}B(K,"getVariation")},62079:(ge,te,S)=>{"use strict";S.d(te,{Fp:()=>K,NM:()=>L,VV:()=>P});var K=Math.max,P=Math.min,L=Math.round},49534:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>P});var K=S(29852);function P(L){return Object.assign({},(0,K.Z)(),L)}B(P,"mergePaddingObject")},3518:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>K});function K(){var P=navigator.userAgentData;return P!=null&&P.brands&&Array.isArray(P.brands)?P.brands.map(function(L){return L.brand+"/"+L.version}).join(" "):navigator.userAgent}B(K,"getUAString")},72907:(ge,te,S)=>{"use strict";S.d(te,{q:()=>L,u:()=>P});var K=S(62079);function P(I,W,x){return(0,K.Fp)(I,(0,K.VV)(W,x))}B(P,"within");function L(I,W,x){var m=P(I,W,x);return m>x?x:m}B(L,"withinMaxClamp")},41182:function(ge,te,S){(function(K,P){ge.exports=te=P()})(this,function(){var K=K||function(P,L){var I;if(typeof window<"u"&&window.crypto&&(I=window.crypto),typeof self<"u"&&self.crypto&&(I=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(I=globalThis.crypto),!I&&typeof window<"u"&&window.msCrypto&&(I=window.msCrypto),!I&&typeof global<"u"&&global.crypto&&(I=global.crypto),!I)try{I=S(91054)}catch{}var W=B(function(){if(I){if(typeof I.getRandomValues=="function")try{return I.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof I.randomBytes=="function")try{return I.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},"cryptoSecureRandomInt"),x=Object.create||function(){function y(){}return B(y,"F"),function(a){var v;return y.prototype=a,v=new y,y.prototype=null,v}}(),m={},b=m.lib={},c=b.Base=function(){return{extend:function(y){var a=x(this);return y&&a.mixIn(y),(!a.hasOwnProperty("init")||this.init===a.init)&&(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var y=this.extend();return y.init.apply(y,arguments),y},init:function(){},mixIn:function(y){for(var a in y)y.hasOwnProperty(a)&&(this[a]=y[a]);y.hasOwnProperty("toString")&&(this.toString=y.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=b.WordArray=c.extend({init:function(y,a){y=this.words=y||[],a!=L?this.sigBytes=a:this.sigBytes=y.length*4},toString:function(y){return(y||r).stringify(this)},concat:function(y){var a=this.words,v=y.words,F=this.sigBytes,A=y.sigBytes;if(this.clamp(),F%4)for(var D=0;D<A;D++){var O=v[D>>>2]>>>24-D%4*8&255;a[F+D>>>2]|=O<<24-(F+D)%4*8}else for(var J=0;J<A;J+=4)a[F+J>>>2]=v[J>>>2];return this.sigBytes+=A,this},clamp:function(){var y=this.words,a=this.sigBytes;y[a>>>2]&=4294967295<<32-a%4*8,y.length=P.ceil(a/4)},clone:function(){var y=c.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var a=[],v=0;v<y;v+=4)a.push(W());return new d.init(a,y)}}),f=m.enc={},r=f.Hex={stringify:function(y){for(var a=y.words,v=y.sigBytes,F=[],A=0;A<v;A++){var D=a[A>>>2]>>>24-A%4*8&255;F.push((D>>>4).toString(16)),F.push((D&15).toString(16))}return F.join("")},parse:function(y){for(var a=y.length,v=[],F=0;F<a;F+=2)v[F>>>3]|=parseInt(y.substr(F,2),16)<<24-F%8*4;return new d.init(v,a/2)}},g=f.Latin1={stringify:function(y){for(var a=y.words,v=y.sigBytes,F=[],A=0;A<v;A++){var D=a[A>>>2]>>>24-A%4*8&255;F.push(String.fromCharCode(D))}return F.join("")},parse:function(y){for(var a=y.length,v=[],F=0;F<a;F++)v[F>>>2]|=(y.charCodeAt(F)&255)<<24-F%4*8;return new d.init(v,a)}},u=f.Utf8={stringify:function(y){try{return decodeURIComponent(escape(g.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return g.parse(unescape(encodeURIComponent(y)))}},w=b.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=u.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var a,v=this._data,F=v.words,A=v.sigBytes,D=this.blockSize,O=D*4,J=A/O;y?J=P.ceil(J):J=P.max((J|0)-this._minBufferSize,0);var G=J*D,V=P.min(G*4,A);if(G){for(var q=0;q<G;q+=D)this._doProcessBlock(F,q);a=F.splice(0,G),v.sigBytes-=V}return new d.init(a,V)},clone:function(){var y=c.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0}),z=b.Hasher=w.extend({cfg:c.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){w.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){y&&this._append(y);var a=this._doFinalize();return a},blockSize:512/32,_createHelper:function(y){return function(a,v){return new y.init(v).finalize(a)}},_createHmacHelper:function(y){return function(a,v){return new C.HMAC.init(y,v).finalize(a)}}}),C=m.algo={};return m}(Math);return K})},99968:function(ge,te,S){(function(K,P){ge.exports=te=P(S(41182))})(this,function(K){return function(){var P=K,L=P.lib,I=L.WordArray,W=L.Hasher,x=P.algo,m=[],b=x.SHA1=W.extend({_doReset:function(){this._hash=new I.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,d){for(var f=this._hash.words,r=f[0],g=f[1],u=f[2],w=f[3],z=f[4],C=0;C<80;C++){if(C<16)m[C]=c[d+C]|0;else{var y=m[C-3]^m[C-8]^m[C-14]^m[C-16];m[C]=y<<1|y>>>31}var a=(r<<5|r>>>27)+z+m[C];C<20?a+=(g&u|~g&w)+1518500249:C<40?a+=(g^u^w)+1859775393:C<60?a+=(g&u|g&w|u&w)-1894007588:a+=(g^u^w)-899497514,z=w,w=u,u=g<<30|g>>>2,g=r,r=a}f[0]=f[0]+r|0,f[1]=f[1]+g|0,f[2]=f[2]+u|0,f[3]=f[3]+w|0,f[4]=f[4]+z|0},_doFinalize:function(){var c=this._data,d=c.words,f=this._nDataBytes*8,r=c.sigBytes*8;return d[r>>>5]|=128<<24-r%32,d[(r+64>>>9<<4)+14]=Math.floor(f/4294967296),d[(r+64>>>9<<4)+15]=f,c.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var c=W.clone.call(this);return c._hash=this._hash.clone(),c}});P.SHA1=W._createHelper(b),P.HmacSHA1=W._createHmacHelper(b)}(),K.SHA1})},51722:function(ge){(function(te,S){ge.exports=S()})(this,function(){"use strict";var te=1e3,S=6e4,K=36e5,P="millisecond",L="second",I="minute",W="hour",x="day",m="week",b="month",c="quarter",d="year",f="date",r="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,u=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,w={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},z=B(function(G,V,q){var re=String(G);return!re||re.length>=V?G:""+Array(V+1-re.length).join(q)+G},"m"),C={s:z,z:function(G){var V=-G.utcOffset(),q=Math.abs(V),re=Math.floor(q/60),ae=q%60;return(V<=0?"+":"-")+z(re,2,"0")+":"+z(ae,2,"0")},m:B(function G(V,q){if(V.date()<q.date())return-G(q,V);var re=12*(q.year()-V.year())+(q.month()-V.month()),ae=V.clone().add(re,b),fe=q-ae<0,be=V.clone().add(re+(fe?-1:1),b);return+(-(re+(q-ae)/(fe?ae-be:be-ae))||0)},"t3"),a:function(G){return G<0?Math.ceil(G)||0:Math.floor(G)},p:function(G){return{M:b,y:d,w:m,d:x,D:f,h:W,m:I,s:L,ms:P,Q:c}[G]||String(G||"").toLowerCase().replace(/s$/,"")},u:function(G){return G===void 0}},y="en",a={};a[y]=w;var v=B(function(G){return G instanceof O},"p"),F=B(function(G,V,q){var re;if(!G)return y;if(typeof G=="string")a[G]&&(re=G),V&&(a[G]=V,re=G);else{var ae=G.name;a[ae]=G,re=ae}return!q&&re&&(y=re),re||!q&&y},"S"),A=B(function(G,V){if(v(G))return G.clone();var q=typeof V=="object"?V:{};return q.date=G,q.args=arguments,new O(q)},"w"),D=C;D.l=F,D.i=v,D.w=function(G,V){return A(G,{locale:V.$L,utc:V.$u,x:V.$x,$offset:V.$offset})};var O=function(){function G(q){this.$L=F(q.locale,null,!0),this.parse(q)}B(G,"M2");var V=G.prototype;return V.parse=function(q){this.$d=function(re){var ae=re.date,fe=re.utc;if(ae===null)return new Date(NaN);if(D.u(ae))return new Date;if(ae instanceof Date)return new Date(ae);if(typeof ae=="string"&&!/Z$/i.test(ae)){var be=ae.match(g);if(be){var Pe=be[2]-1||0,ne=(be[7]||"0").substring(0,3);return fe?new Date(Date.UTC(be[1],Pe,be[3]||1,be[4]||0,be[5]||0,be[6]||0,ne)):new Date(be[1],Pe,be[3]||1,be[4]||0,be[5]||0,be[6]||0,ne)}}return new Date(ae)}(q),this.$x=q.x||{},this.init()},V.init=function(){var q=this.$d;this.$y=q.getFullYear(),this.$M=q.getMonth(),this.$D=q.getDate(),this.$W=q.getDay(),this.$H=q.getHours(),this.$m=q.getMinutes(),this.$s=q.getSeconds(),this.$ms=q.getMilliseconds()},V.$utils=function(){return D},V.isValid=function(){return this.$d.toString()!==r},V.isSame=function(q,re){var ae=A(q);return this.startOf(re)<=ae&&ae<=this.endOf(re)},V.isAfter=function(q,re){return A(q)<this.startOf(re)},V.isBefore=function(q,re){return this.endOf(re)<A(q)},V.$g=function(q,re,ae){return D.u(q)?this[re]:this.set(ae,q)},V.unix=function(){return Math.floor(this.valueOf()/1e3)},V.valueOf=function(){return this.$d.getTime()},V.startOf=function(q,re){var ae=this,fe=!!D.u(re)||re,be=D.p(q),Pe=B(function(Be,Oe){var Ie=D.w(ae.$u?Date.UTC(ae.$y,Oe,Be):new Date(ae.$y,Oe,Be),ae);return fe?Ie:Ie.endOf(x)},"$2"),ne=B(function(Be,Oe){return D.w(ae.toDate()[Be].apply(ae.toDate("s"),(fe?[0,0,0,0]:[23,59,59,999]).slice(Oe)),ae)},"l2"),ie=this.$W,le=this.$M,ze=this.$D,oe="set"+(this.$u?"UTC":"");switch(be){case d:return fe?Pe(1,0):Pe(31,11);case b:return fe?Pe(1,le):Pe(0,le+1);case m:var we=this.$locale().weekStart||0,Te=(ie<we?ie+7:ie)-we;return Pe(fe?ze-Te:ze+(6-Te),le);case x:case f:return ne(oe+"Hours",0);case W:return ne(oe+"Minutes",1);case I:return ne(oe+"Seconds",2);case L:return ne(oe+"Milliseconds",3);default:return this.clone()}},V.endOf=function(q){return this.startOf(q,!1)},V.$set=function(q,re){var ae,fe=D.p(q),be="set"+(this.$u?"UTC":""),Pe=(ae={},ae[x]=be+"Date",ae[f]=be+"Date",ae[b]=be+"Month",ae[d]=be+"FullYear",ae[W]=be+"Hours",ae[I]=be+"Minutes",ae[L]=be+"Seconds",ae[P]=be+"Milliseconds",ae)[fe],ne=fe===x?this.$D+(re-this.$W):re;if(fe===b||fe===d){var ie=this.clone().set(f,1);ie.$d[Pe](ne),ie.init(),this.$d=ie.set(f,Math.min(this.$D,ie.daysInMonth())).$d}else Pe&&this.$d[Pe](ne);return this.init(),this},V.set=function(q,re){return this.clone().$set(q,re)},V.get=function(q){return this[D.p(q)]()},V.add=function(q,re){var ae,fe=this;q=Number(q);var be=D.p(re),Pe=B(function(le){var ze=A(fe);return D.w(ze.date(ze.date()+Math.round(le*q)),fe)},"y2");if(be===b)return this.set(b,this.$M+q);if(be===d)return this.set(d,this.$y+q);if(be===x)return Pe(1);if(be===m)return Pe(7);var ne=(ae={},ae[I]=S,ae[W]=K,ae[L]=te,ae)[be]||1,ie=this.$d.getTime()+q*ne;return D.w(ie,this)},V.subtract=function(q,re){return this.add(-1*q,re)},V.format=function(q){var re=this,ae=this.$locale();if(!this.isValid())return ae.invalidDate||r;var fe=q||"YYYY-MM-DDTHH:mm:ssZ",be=D.z(this),Pe=this.$H,ne=this.$m,ie=this.$M,le=ae.weekdays,ze=ae.months,oe=B(function(Oe,Ie,Ve,Ke){return Oe&&(Oe[Ie]||Oe(re,fe))||Ve[Ie].substr(0,Ke)},"h2"),we=B(function(Oe){return D.s(Pe%12||12,Oe,"0")},"c2"),Te=ae.meridiem||function(Oe,Ie,Ve){var Ke=Oe<12?"AM":"PM";return Ve?Ke.toLowerCase():Ke},Be={YY:String(this.$y).slice(-2),YYYY:this.$y,M:ie+1,MM:D.s(ie+1,2,"0"),MMM:oe(ae.monthsShort,ie,ze,3),MMMM:oe(ze,ie),D:this.$D,DD:D.s(this.$D,2,"0"),d:String(this.$W),dd:oe(ae.weekdaysMin,this.$W,le,2),ddd:oe(ae.weekdaysShort,this.$W,le,3),dddd:le[this.$W],H:String(Pe),HH:D.s(Pe,2,"0"),h:we(1),hh:we(2),a:Te(Pe,ne,!0),A:Te(Pe,ne,!1),m:String(ne),mm:D.s(ne,2,"0"),s:String(this.$s),ss:D.s(this.$s,2,"0"),SSS:D.s(this.$ms,3,"0"),Z:be};return fe.replace(u,function(Oe,Ie){return Ie||Be[Oe]||be.replace(":","")})},V.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},V.diff=function(q,re,ae){var fe,be=D.p(re),Pe=A(q),ne=(Pe.utcOffset()-this.utcOffset())*S,ie=this-Pe,le=D.m(this,Pe);return le=(fe={},fe[d]=le/12,fe[b]=le,fe[c]=le/3,fe[m]=(ie-ne)/6048e5,fe[x]=(ie-ne)/864e5,fe[W]=ie/K,fe[I]=ie/S,fe[L]=ie/te,fe)[be]||ie,ae?le:D.a(le)},V.daysInMonth=function(){return this.endOf(b).$D},V.$locale=function(){return a[this.$L]},V.locale=function(q,re){if(!q)return this.$L;var ae=this.clone(),fe=F(q,re,!0);return fe&&(ae.$L=fe),ae},V.clone=function(){return D.w(this.$d,this)},V.toDate=function(){return new Date(this.valueOf())},V.toJSON=function(){return this.isValid()?this.toISOString():null},V.toISOString=function(){return this.$d.toISOString()},V.toString=function(){return this.$d.toUTCString()},G}(),J=O.prototype;return A.prototype=J,[["$ms",P],["$s",L],["$m",I],["$H",W],["$W",x],["$M",b],["$y",d],["$D",f]].forEach(function(G){J[G[1]]=function(V){return this.$g(V,G[0],G[1])}}),A.extend=function(G,V){return G.$i||(G(V,O,A),G.$i=!0),A},A.locale=F,A.isDayjs=v,A.unix=function(G){return A(1e3*G)},A.en=a[y],A.Ls=a,A.p={},A})},92045:function(ge){(function(te,S){ge.exports=S()})(this,function(){"use strict";return function(te,S,K){te=te||{};var P=S.prototype,L={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function I(x,m,b,c){return P.fromToBase(x,m,b,c)}B(I,"i"),K.en.relativeTime=L,P.fromToBase=function(x,m,b,c,d){for(var f,r,g,u=b.$locale().relativeTime||L,w=te.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],z=w.length,C=0;C<z;C+=1){var y=w[C];y.d&&(f=c?K(x).diff(b,y.d,!0):b.diff(x,y.d,!0));var a=(te.rounding||Math.round)(Math.abs(f));if(g=f>0,a<=y.r||!y.r){a<=1&&C>0&&(y=w[C-1]);var v=u[y.l];d&&(a=d(""+a)),r=typeof v=="string"?v.replace("%d",a):v(a,m,y.l,g);break}}if(m)return r;var F=g?u.future:u.past;return typeof F=="function"?F(r):F.replace("%s",r)},P.to=function(x,m){return I(x,m,this,!0)},P.from=function(x,m){return I(x,m,this)};var W=B(function(x){return x.$u?K.utc():K()},"d");P.toNow=function(x){return this.to(W(this),x)},P.fromNow=function(x){return this.from(W(this),x)}}})},5199:ge=>{"use strict";ge.exports=()=>/\u{1F3F4}\u{E0067}\u{E0062}(?:\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074}|\u{E0065}\u{E006E}\u{E0067})\u{E007F}|(?:\u{1F9D1}\u{1F3FF}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FF}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FE}]|(?:\u{1F9D1}\u{1F3FE}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FE}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FD}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FD}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FC}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FC}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FB}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FC}-\u{1F3FF}]|\u{1F468}(?:\u{1F3FB}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u{1F91D}\u200D\u{1F468}[\u{1F3FC}-\u{1F3FF}]|[\u2695\u2696\u2708]\uFE0F|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]))?|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FE}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])\uFE0F|\u200D(?:[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC})?|(?:\u{1F469}(?:\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}]))|\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]\u200D\u{1F91D}\u200D\u{1F9D1})[\u{1F3FB}-\u{1F3FF}]|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F469}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F9D1}(?:\u200D(?:\u{1F91D}\u200D\u{1F9D1}|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F9D1}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F469}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F636}\u200D\u{1F32B}|\u{1F3F3}\uFE0F\u200D\u26A7|\u{1F43B}\u200D\u2744|(?:[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u{1F3F4}\u200D\u2620|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]\u200D[\u2640\u2642]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u2600-\u2604\u260E\u2611\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26B0\u26B1\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0\u26F1\u26F4\u26F7\u26F8\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u3030\u303D\u3297\u3299\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F202}\u{1F237}\u{1F321}\u{1F324}-\u{1F32C}\u{1F336}\u{1F37D}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}\u{1F39F}\u{1F3CD}\u{1F3CE}\u{1F3D4}-\u{1F3DF}\u{1F3F5}\u{1F3F7}\u{1F43F}\u{1F4FD}\u{1F549}\u{1F54A}\u{1F56F}\u{1F570}\u{1F573}\u{1F576}-\u{1F579}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}\u{1F6CB}\u{1F6CD}-\u{1F6CF}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6F0}\u{1F6F3}])\uFE0F|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F469}\u200D\u{1F467}|\u{1F469}\u200D\u{1F466}|\u{1F635}\u200D\u{1F4AB}|\u{1F62E}\u200D\u{1F4A8}|\u{1F415}\u200D\u{1F9BA}|\u{1F9D1}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F469}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F1FD}\u{1F1F0}|\u{1F1F6}\u{1F1E6}|\u{1F1F4}\u{1F1F2}|\u{1F408}\u200D\u2B1B|\u2764\uFE0F\u200D[\u{1F525}\u{1FA79}]|\u{1F441}\uFE0F|\u{1F3F3}\uFE0F|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|[#\*0-9]\uFE0F\u20E3|\u2764\uFE0F|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]|\u{1F3F4}|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270C\u270D\u{1F574}\u{1F590}][\uFE0F\u{1F3FB}-\u{1F3FF}]|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F408}\u{1F415}\u{1F43B}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F62E}\u{1F635}\u{1F636}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F384}\u{1F386}-\u{1F393}\u{1F3A0}-\u{1F3C1}\u{1F3C5}\u{1F3C6}\u{1F3C8}\u{1F3C9}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F8}-\u{1F407}\u{1F409}-\u{1F414}\u{1F416}-\u{1F43A}\u{1F43C}-\u{1F43E}\u{1F440}\u{1F444}\u{1F445}\u{1F451}-\u{1F465}\u{1F46A}\u{1F479}-\u{1F47B}\u{1F47D}-\u{1F480}\u{1F484}\u{1F488}-\u{1F48E}\u{1F490}\u{1F492}-\u{1F4A9}\u{1F4AB}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F5A4}\u{1F5FB}-\u{1F62D}\u{1F62F}-\u{1F634}\u{1F637}-\u{1F644}\u{1F648}-\u{1F64A}\u{1F680}-\u{1F6A2}\u{1F6A4}-\u{1F6B3}\u{1F6B7}-\u{1F6BF}\u{1F6C1}-\u{1F6C5}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90D}\u{1F90E}\u{1F910}-\u{1F917}\u{1F91D}\u{1F920}-\u{1F925}\u{1F927}-\u{1F92F}\u{1F93A}\u{1F93F}-\u{1F945}\u{1F947}-\u{1F976}\u{1F978}\u{1F97A}-\u{1F9B4}\u{1F9B7}\u{1F9BA}\u{1F9BC}-\u{1F9CB}\u{1F9D0}\u{1F9E0}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93C}-\u{1F93E}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9BB}\u{1F9CD}-\u{1F9CF}\u{1F9D1}-\u{1F9DD}]/gu},49276:(ge,te,S)=>{"use strict";S.d(te,{D3:()=>m,Dk:()=>g,Vf:()=>z,ZP:()=>y,aA:()=>b,of:()=>c});var K=S(22527),P=S(24431),L=S(46949),I=S(83269),W=S(5199),x=S.n(W);const m=["component"],b={"smileys-emotion":"Smileys & Emotions","people-body":"People",component:"Components","animals-nature":"Animals & Nature","food-drink":"Food & Drink","travel-places":"Travel & Places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"},c=Object.keys(b),d={1:"1f3fb",2:"1f3fc",3:"1f3fd",4:"1f3fe",5:"1f3ff"};let f=!0,r;try{r=new RegExp("(?<!\\u{E0002})\\u{E0002}","gu")}catch{f=!1,r=null}const g=r,u=/\u{200D}/gu,w="\u{E0002}",z={google:"noto",twitter:"twemoji",open:"openmoji",blob:"blob"};function C(F){let A=typeof F=="number"?F:parseInt(F,16);return A<65536?String.fromCharCode(A):(A-=65536,String.fromCharCode(55296+(A>>10),56320+(A&1023)))}B(C,"codepoint_to_emoji");const v=class v extends K.default{constructor(...A){super(...A),this.inject("..emotes"),this.inject("settings"),f?this.settings.add("chat.emoji.replace-joiner",{default:1,process(D,O){return O===2?1:O},ui:{path:"Chat > Behavior >> Emoji",title:"Emoji Joiner Workaround",description:"This feature is intended to allow the use of combined emoji in supported clients. This is required due to a bug in TMI that strips ZWJ characters from chat messages. [Visit the original issue](https://github.com/FrankerFaceZ/FrankerFaceZ/issues/1147) for more details.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Display Only"},{value:3,title:"Display and Send"}]}}):(this.log.warn('This browser does not support regexp lookbehind. The "Emoji Joiner Workaround" feature will be disabled.'),this.settings.add("chat.emoji.replace-joiner",{process(){return 0}})),this.settings.add("chat.emoji.style",{default:"twitter",process(D,O){return O!=0&&!z[O]?"twitter":O},ui:{path:"Chat > Appearance >> Emoji",title:"Emoji Style",component:"setting-select-box",data:[{value:"twitter",title:"Twitter (Twemoji)"},{value:"google",title:"Google (Noto)"},{value:"blob",title:"Blob"},{value:"open",title:"OpenMoji"},{value:0,title:"Native"}]}}),this.splitter=x()(),this.categories=b,this.emoji={},this.names={},this.chars=new Map}onEnable(){this.on("chat:pre-send-message",A=>{A.context.get("chat.emoji.replace-joiner")<2||(A.message=A.message.replace(u,w))}),this.loadEmojiData()}async loadEmojiData(A=0){let D;try{D=await fetch(`${P.SERVER}/script/emoji/v3.2.json?_${(0,I.getBuster)(60)}`).then(q=>q.ok?q.json():null)}catch(q){return A++,A<10?setTimeout(()=>this.loadEmojiData(A),500*A):(this.log.error("Error loading emoji data.",q),!1)}if(!D)return!1;const O=D.c,J={},G={},V=new Map;for(const q of D.e){const re=Object.assign(a(q.slice(4)),{category:O[q[0]],sort:q[1],names:q[2],name:q[3]});Array.isArray(re.names)||(re.names=[re.names]),re.name||(re.name=re.names[0].replace(/_/g," ")),J[re.code]=re,V.set(re.raw,[re.code,null]);for(const ae of re.names)G[ae]=re.code;if(q[7]){const ae=re.variants={};for(const fe of q[7]){if(Array.isArray(fe[3])||!fe[3]){const ne=Object.assign(a(fe),{category:O[q[0]],sort:q[1],names:fe[5],hidden:!0});Array.isArray(ne.names)||(ne.names=[ne.names]),ne.name=ne.names[0].replace(/_/g," "),J[ne.code]=ne,V.set(ne.raw,[ne.code,null]);for(const ie of ne.names)G[ie]=ne.code;continue}const be=d[fe[3]];if(!be){console.warn("Unknown tone:",fe[3],fe,re);continue}const Pe=Object.assign(a(fe),{key:be});ae[be]=Pe,V.set(Pe.raw,[re.code,Pe.key])}}}return this.emoji=J,this.names=G,this.chars=V,this.log.info(`Loaded data about ${Object.keys(J).length} emoji.`),this.emit(":populated"),!0}getFullImage(A,D){return D||(D=this.parent.context.get("chat.emoji.style")),(0,L.has)(z,D)||(D="twitter"),`${P.SERVER}/static/emoji/images/${z[D]}/${A}`}getFullImageSet(A,D){return D||(D=this.parent.context.get("chat.emoji.style")),(0,L.has)(z,D)||(D="twitter"),`${P.SERVER}/static/emoji/images/${z[D]}/${A} 72w`}};B(v,"Emoji");let y=v;function a(F){let A=F[0];return F[4]===0&&(A=`${A}-fe0f`),{code:A,image:`${F[0]}.png`,raw:A.split("-").map(C).join(""),sheet_x:F[1][0],sheet_y:F[1][1],has:{google:!!(8&F[2]),blob:!!(4&F[2])||!!(8&F[2]),twitter:!!(2&F[2]),open:!!(1&F[2])}}}B(a,"hydrate_emoji")},33612:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(22527);let P=0,L=0;const W=class W extends K.default{constructor(m,b){super(m,b),this._id=`_ffz$${P++}`,this.log.info(`Using: ${this.constructor.name}`)}getReact(){if(this._react)return this._react;let m;try{m=this.getCore?.()?.intl?.react}catch{}if(m?.Component&&m.createElement)return this._react=m;if(m=this.resolve("site.web_munch")?.getModule?.("react"),m?.Component&&m.createElement)return this._react=m}getReactDom(){if(this._reactDom)return this._reactDom;let m=this.resolve("site.web_munch")?.getModule?.("react-dom");if(m?.createPortal)return this._reactDom=m}findReact(){const m=this.getReact();if(m)return Promise.resolve(m);const b=this.resolve("site.web_munch");return b?b.findModule("react"):this.waitFor("site.web_munch:registered").then(()=>this.findReact())}awaitElement(m,b,c=6e4){b||(b=document.documentElement);const d=b.querySelector(m);return d?Promise.resolve(d):new Promise((f,r)=>{const g=`${this._id}$observer`,u=b[g],w=L++,z=c&&setTimeout(()=>{const y=b[g];if(!y)return;const[a,v]=y;for(let F=0;F<v.length;F++){const A=v[F];if(A[0]===w){v.splice(F,1),A[3]("Timed out");break}}v.length||(a.disconnect(),b[g]=null)},c);if(u){u[1].push([w,m,f,r,z]);return}const C=new MutationObserver(()=>{const y=b[g];if(!y){C.disconnect();return}const a=y[1];for(let v=0;v<a.length;v++){const F=a[v],A=b.querySelector(F[1]);A&&(a.splice(v,1),v--,F[4]&&clearTimeout(F[4]),F[2](A))}a.length||(C.disconnect(),b[g]=null)});b[g]=[C,[[w,m,f,r,z]]],C.observe(b,{childList:!0,attributes:!0,characterData:!0,subtree:!0})})}};B(W,"BaseSite");let I=W},10789:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>z});var K=S(22527),P=S(44589),L=S(46949),I=S(83342);const W=(0,P.createElement)("span"),x=".video-player__default-player .player-controls__left-control-group",m=".video-player__default-player .player-controls__right-control-group",b=window.AudioContext&&window.DynamicsCompressorNode!=null,c=b&&window.GainNode!=null,d="setting.entry.player.volume-scroll.values",f=[{value:!1,title:"Disabled",i18n_key:`${d}.false`},{value:!0,title:"Enabled",i18n_key:`${d}.true`},{value:2,title:"Enabled with Right-Click",i18n_key:`${d}.2`},{value:3,title:"Enabled with Alt",i18n_key:`${d}.3`},{value:4,title:"Enabled with Alt + Right-Click",i18n_key:`${d}.4`},{value:5,title:"Enabled with Shift",i18n_key:`${d}.5`},{value:6,title:"Enabled with Shift + Right-Click",i18n_key:`${d}.6`},{value:7,title:"Enabled with Ctrl",i18n_key:`${d}.7`},{value:8,title:"Enabled with Ctrl + Right-Click",i18n_key:`${d}.8`}];function r(y){return y.querySelector('button[aria-label*="alt+x"]')??y.querySelector('button[aria-label]:has(path[d="M8 9H6v2h2V9zm1 0h2v2H9V9zm5 0h-2v2h2V9z"]')}B(r,"getNativeClipButton");function g(y){return y===2||y===4||y===6||y===8}B(g,"wantsRMB");function u(y,a,v){return!(g(y)&&a.button!==2&&!v||!a.altKey&&(y===3||y===4)||!a.shiftKey&&(y===5||y===6)||!a.ctrlKey&&(y===7||y===8))}B(u,"matchesEvent");function w(y){const a=y.currentTarget,v=a&&a.querySelector("figure");!v||v.classList.contains("ffz-i-t-reset-clicked")||(v.classList.toggle("ffz-i-t-reset",!1),v.classList.toggle("ffz-i-t-reset-clicked",!0),setTimeout(()=>{v.classList.toggle("ffz-i-t-reset",!0),v.classList.toggle("ffz-i-t-reset-clicked",!1)},500))}B(w,"rotateButton");const C=class C extends K.default{constructor(...a){super(...a),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.onShortcut=this.onShortcut.bind(this),this.LEFT_CONTROLS=x,this.RIGHT_CONTROLS=m,this.registerSettings()}registerSettings(){this.settings.add("player.embed-metadata",{default:!0,ui:{path:"Player > General >> Embed and Popout",title:"Show metadata when mousing over the player.",component:"setting-check-box"}}),this.settings.add("player.cast-button.hide",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the Cast button."},changed:a=>this.css_tweaks.toggleHide("player-cast",a)}),this.settings.add("player.clip-button.hide-native",{default:null,requires:["player.clip-button.custom"],process:(a,v)=>v??a.get("player.clip-button.custom"),ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Hide the native Clip button.",description:"By default, this is enabled when using the setting to add a custom Clip button."},changed:a=>this.css_tweaks.toggle("player-hide-native-clip",a)}),this.settings.add("player.clip-button.custom",{default:!1,ui:{path:"Player > General >> Appearance",component:"setting-check-box",title:"Display a custom Clip button.",description:"Add a custom Clip button to the player that better fits the style of the other buttons."},changed:()=>{for(const a of this.Player.instances)this.addClipButton(a)}}),this.settings.add("player.fade-pause-buffer",{default:!1,ui:{path:"Player > General >> Playback",title:"Fade the player when paused or buffering to make the UI easier to see.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-fade-paused",a)}),this.settings.add("player.disable-content-warnings",{default:!1,ui:{path:"Player > General >> General",title:"Do not display content warnings.",description:"When this is enabled, FFZ will automatically skip content warnings. This feature is intended for use by adults only.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.skipContentWarnings(a)}}),b&&(this.settings.add("player.compressor.enable",{default:!0,ui:{path:'Player > Compressor @{"description": "These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more."} >> General',title:"Enable the audio compressor and add an `Audio Compressor` button to the player controls.",sort:-1e3,component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.addCompressorButton(a)}}),this.settings.add("player.compressor.default",{default:!1,ui:{path:"Player > Compressor >> General",title:"Enable the compressor by default.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.compressPlayer(a)}}),this.settings.add("player.compressor.force-legacy",{default:!1,ui:{path:"Player > Compressor >> Advanced",title:"Force use of legacy browser API.",description:"This setting forces FrankerFaceZ to attempt to use an older browser API to create the compressor. Please reset your player after changing this setting.",component:"setting-check-box",force_seen:!0}}),this.settings.add("player.compressor.shortcut",{default:null,requires:["player.compressor.enable"],process(a,v){return a.get("player.compressor.enable")?v:null},ui:{path:"Player > Compressor >> General",title:"Shortcut Key",description:"This key sequence can be used to toggle the compressor.",component:"setting-hotkey"},changed:()=>{this.updateShortcut();for(const a of this.Player.instances)this.addCompressorButton(a)}}),c&&(this.settings.add("player.gain.enable",{default:!1,ui:{sort:-1,path:'Player > Compressor >> Gain Control @{"sort": 50, "description": "Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses."}',title:"Enable gain control when the audio compressor is enabled.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.compressPlayer(a)}}),this.settings.add("player.gain.no-volume",{default:!1,requires:["player.gain.enable"],process(a,v){return a.get("player.gain.enable")?v:!1},ui:{path:"Player > Compressor >> Gain Control",title:"Force built-in volume to 100% when the audio compressor is enabled.",description:"With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.",component:"setting-check-box"},changed:a=>{this.css_tweaks.toggleHide("player-gain-volume",a);for(const v of this.Player.instances)this.updateGainVolume(v)}}),this.settings.add("player.gain.scroll",{default:!1,ui:{path:"Player > Compressor >> Gain Control",title:"Scroll Adjust",description:"Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:f}}),this.settings.add("player.gain.default",{default:100,requires:["player.gain.min","player.gain.max"],process(a,v){const F=a.get("player.gain.min"),A=a.get("player.gain.max");return v/=100,v<F&&(v=F),v>A&&(v=A),v},ui:{path:"Player > Compressor >> Gain Control",title:"Default Value",component:"setting-text-box",description:"The default value for gain control, when gain control is enabled. 100% means no change in volume.",process:"to_int",bounds:[0,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.min",{default:0,process:(a,v)=>v/100,ui:{path:"Player > Compressor >> Gain Control",title:"Minimum",component:"setting-text-box",description:`**Range:** 0 ~ 100

The minimum allowed value for gain control. 0% is effectively muted.`,process:"to_int",bounds:[0,!0,100,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.max",{default:200,process:(a,v)=>v/100,ui:{path:"Player > Compressor >> Gain Control",title:"Maximum",component:"setting-text-box",description:`**Range:** 100 ~ 1000

The maximum allowed value for gain control. 100% is no change. 200% is double the volume.`,process:"to_int",bounds:[100,!0,1e3,!0]},changed:()=>this.updateGains()})),this.settings.add("player.compressor.threshold",{default:-50,ui:{path:'Player > Compressor >> Advanced @{"sort": 1000}',title:"Threshold",sort:0,description:`**Range:** -100 ~ 0

The decibel value above which the compression will start taking effect.`,component:"setting-text-box",process:"to_int",bounds:[-100,!0,0,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.knee",{default:40,ui:{path:"Player > Compressor >> Advanced",title:"Knee",sort:5,description:`**Range:** 0 ~ 40

A decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,40,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.ratio",{default:12,ui:{path:"Player > Compressor >> Advanced",title:"Ratio",sort:10,description:`**Range:** 0 ~ 20

The amount of change, in dB, needed in the input for a 1 dB change in the output.`,component:"setting-text-box",process:"to_int",bounds:[0,!0,20,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.attack",{default:0,ui:{path:"Player > Compressor >> Advanced",title:"Attack",sort:15,description:`**Range:** 0 ~ 1

The amount of time, in seconds, required to reduce the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.release",{default:.25,ui:{path:"Player > Compressor >> Advanced",title:"Release",sort:20,description:`**Range:** 0 ~ 1
The amount of time, in seconds, required to increase the gain by 10 dB.`,component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()})),this.settings.add("player.allow-catchup",{default:!0,ui:{path:'Player > General @{"sort": -1000} >> General',title:"Allow the player to speed up to reduce delay.",description:"Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.",component:"setting-check-box"},changed:()=>this.updatePlaybackRates()}),this.settings.add("player.mute-click",{default:!1,ui:{path:"Player > General >> Volume",title:"Mute or unmute the player by middle-clicking.",component:"setting-check-box"}}),this.settings.add("player.volume-scroll",{default:!1,ui:{path:"Player > General >> Volume",title:"Adjust volume by scrolling with the mouse wheel.",description:"*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:f}}),this.settings.add("player.button.reset",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Reset Player` button to the player controls.",description:"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.addResetButton(a)}}),document.pictureInPictureEnabled&&this.settings.add("player.button.pip",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Picture-in-Picture` button to the player controls.",description:"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.",component:"setting-check-box"},changed:()=>{for(const a of this.Player.instances)this.addPiPButton(a)}}),this.settings.add("player.volume-scroll-steps",{default:.1,ui:{path:"Player > General >> Volume",title:"Volume scroll amount",description:"How much the volume level is changed per individual scroll input.",component:"setting-select-box",data:[{value:.1,title:"10%"},{value:.05,title:"5%"},{value:.02,title:"2%"},{value:.01,title:"1%"}]}}),this.settings.add("player.captions.font-size",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Size",description:"How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.captions.font-family",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Family",description:"Override the font used for displaying Closed Captions.",component:"setting-combo-box",data:()=>(0,I.R7)()},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.ext-hide",{default:0,ui:{path:"Player > General >> Extensions",title:"Show Overlay Extensions",description:"**Note**: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security. To prevent extensions from loading entirely, we recommend using the [Disable Twitch Extensions browser extension](https://twitch-tools.rootonline.de/disable_twitch_extensions.php) by CommanderRoot.",component:"setting-select-box",data:[{value:2,title:"Never"},{value:1,title:"With Controls"},{value:0,title:"Always"}]},changed:a=>this.updateHideExtensions(a)}),this.settings.add("player.ext-interaction",{default:!0,ui:{path:"Player > General >> Extensions",title:"Allow mouse interaction with overlay extensions.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-ext-mouse",!a)}),this.settings.add("player.no-autoplay",{default:!1,ui:{path:"Player > General >> Playback",title:"Do not automatically start playing videos or streams.",description:"Note: This feature does not apply when navigating directly from channel to channel.",component:"setting-check-box"}}),this.settings.add("player.vod.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play the next recommended video after a video finishes.",component:"setting-check-box"}}),this.settings.add("player.volume-always-shown",{default:!1,ui:{path:"Player > General >> Volume",title:"Keep the volume slider expanded at all times.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-volume",a)}),this.settings.add("player.hide-mouse",{default:!0,ui:{path:"Player > General >> General",title:"Hide mouse when controls aren't visible.",component:"setting-check-box"},changed:a=>this.css_tweaks.toggle("player-hide-mouse",a)}),this.settings.add("player.single-click-pause",{default:!1,ui:{path:"Player > General >> Playback",title:"Pause/Unpause the player by clicking.",component:"setting-check-box"}})}async onEnable(){await this.settings.awaitProvider(),await this.settings.provider.awaitReady(),this.css_tweaks.toggleHide("player-cast",this.settings.get("player.cast-button.hide")),this.css_tweaks.toggleHide("player-gain-volume",this.settings.get("player.gain.no-volume")),this.css_tweaks.toggle("player-hide-native-clip",this.settings.get("player.clip-button.hide-native")),this.css_tweaks.toggle("player-volume",this.settings.get("player.volume-always-shown")),this.css_tweaks.toggle("player-ext-mouse",!this.settings.get("player.ext-interaction")),this.css_tweaks.toggle("player-hide-mouse",this.settings.get("player.hide-mouse")),this.css_tweaks.toggle("player-fade-paused",this.settings.get("player.fade-pause-buffer")),this.installVisibilityHook(),this.updateHideExtensions(),this.updateCaptionsCSS(),this.updateShortcut(),this.on(":reset",this.resetAllPlayers,this),this.Player.ready((a,v)=>{this.modifyPlayerClass(a);for(const F of v){const A=F.props?.playerEvents;A&&((0,P.off)(A,"Playing",F.setPlayerActive),(0,P.off)(A,"PlayerSeekCompleted",F.setPlayerActive)),F.ffzMaybeRemoveNativeListeners(),F.maybeAttachDomEventListeners(),F.ffzScheduleState(),A&&((0,P.on)(A,"Playing",F.setPlayerActive),(0,P.on)(A,"PlayerSeekCompleted",F.setPlayerActive)),this.updateGUI(F),this.compressPlayer(F),this.updatePlaybackRate(F)}}),this.Player.on("mount",a=>{this.updateGUI(a),this.compressPlayer(a),this.updatePlaybackRate(a)}),this.Player.on("update",a=>{this.updateGUI(a),this.compressPlayer(a),this.updatePlaybackRate(a)}),this.Player.on("unmount",a=>{a.ffzUninstall()}),this.on("i18n:update",()=>{for(const a of this.Player.instances)this.updateGUI(a)})}updateShortcut(){const a=this.Mousetrap=this.Mousetrap||this.resolve("site.web_munch")?.getModule?.("mousetrap")||window.Mousetrap;if(!a||!a.bind)return;this._shortcut_bound&&(a.unbind(this._shortcut_bound),this._shortcut_bound=null);const v=this.settings.get("player.compressor.shortcut");b&&v&&(0,L.isValidShortcut)(v)&&(a.bind(v,this.onShortcut),this._shortcut_bound=v)}onShortcut(a){for(const v of this.Player.instances)this.compressPlayer(v,a)}modifyPlayerClass(a){const v=this,F=a.prototype.maybeAttachDomEventListeners;a.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0,this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffzErrorReset||(this._ffzErrorReset=v.addErrorResetButton.bind(v,this)),this._ffzReady||(this._ffzReady=this.ffzReady.bind(this));const A=this,D=this.setPlayerActive,O=this.setPlayerInactive;this.setPlayerActive=function(){return A.ffzScheduleState(),D.call(A)},this.setPlayerInactive=function(){return A.ffzScheduleState(),O.call(A)},this.ffzOnEnded=()=>{v.settings.get("player.vod.autoplay")||v.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||v.fine.getChildNode(this),1e3).then(G=>G.click())};const J=this.props.playerEvents;J&&((0,P.on)(J,"Buffering",this._ffzUpdateState),(0,P.on)(J,"Playing",this._ffzUpdateState),(0,P.on)(J,"PlayerError",this._ffzUpdateState),(0,P.on)(J,"PlayerError",this._ffzErrorReset),(0,P.on)(J,"Ended",this._ffzUpdateState),(0,P.on)(J,"Ended",this.ffzOnEnded),(0,P.on)(J,"Ready",this._ffzReady),(0,P.on)(J,"Idle",this._ffzUpdateState)),this.ffzStopAutoplay()},a.prototype.ffzUninstall=function(){this._ffz_state_raf&&cancelAnimationFrame(this._ffz_state_raf);const A=this.props.playerEvents;A&&this._ffzUpdateState&&((0,P.off)(A,"Playing",this._ffzUpdateState),(0,P.off)(A,"PlayerError",this._ffzUpdateState),(0,P.off)(A,"PlayerError",this._ffzErrorReset),(0,P.off)(A,"Ended",this._ffzUpdateState),(0,P.off)(A,"Ended",this.ffzOnEnded),(0,P.off)(A,"Ready",this._ffzReady),(0,P.off)(A,"Idle",this._ffzUpdateState)),this.ffzRemoveListeners(),this._ffz_state_raf=null,this._ffzUpdateState=null,this._ffzErrorReset=null,this._ffzReady=null,this.ffzOnEnded=null},a.prototype.ffzReady=function(){const A=this.props.containerRef;A&&requestAnimationFrame(()=>{const D=A.querySelectorAll(".ffz--player-reset figure");for(const O of D)O._ffz_unspin&&clearTimeout(O._ffz_unspin),O.classList.toggle("loading",!1)})},a.prototype.ffzStopAutoplay=function(){v.shouldStopAutoplay(this)&&v.stopPlayer(this.props.mediaPlayerInstance,this.props.playerEvents,this)},a.prototype.ffzScheduleState=function(){this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffz_state_raf||(this._ffz_state_raf=requestAnimationFrame(this._ffzUpdateState))},a.prototype.ffzUpdateState=function(){this._ffz_state_raf=null;const A=this.props.containerRef;if(!A)return;const D=A.dataset;D.controls=this.state?.active||!1;let O=this.props.mediaPlayerInstance;if(!O)return;O.core&&(O=O.core);const J=O.state?.state,G=O.mediaSinkManager?.video;J==="Playing"&&G?._ffz_maybe_compress&&(G._ffz_maybe_compress=!1,v.compressPlayer(this)),G&&G._ffz_compressed!=null&&(D.compressed=G._ffz_compressed),D.ended=J==="Ended",D.paused=J==="Idle",D.buffering=J==="Buffering"},a.prototype.ffzAttachListeners=function(){const A=this.props.containerRef;!A||this._ffz_listeners||(this._ffz_listeners=!0,this._ffz_scroll_handler||(this._ffz_scroll_handler=this.ffzScrollHandler.bind(this)),this._ffz_click_handler||(this._ffz_click_handler=this.ffzClickHandler.bind(this)),this._ffz_dblclick_handler||(this._ffz_dblclick_handler=this.ffzDblClickHandler.bind(this)),this._ffz_menu_handler||(this._ffz_menu_handler=this.ffzMenuHandler.bind(this)),(0,P.on)(A,"wheel",this._ffz_scroll_handler),(0,P.on)(A,"dblclick",this._ffz_dblclick_handler),(0,P.on)(A,"mousedown",this._ffz_click_handler),(0,P.on)(A,"contextmenu",this._ffz_menu_handler))},a.prototype.ffzRemoveListeners=function(){const A=this.props.containerRef;!A||!this._ffz_listeners||(this._ffz_scroll_handler&&((0,P.off)(A,"wheel",this._ffz_scroll_handler),this._ffz_scroll_handler=null),this._ffz_click_handler&&((0,P.off)(A,"mousedown",this._ffz_click_handler),this._ffz_click_handler=null),this._ffz_menu_handler&&((0,P.off)(A,"contextmenu",this._ffz_menu_handler),this._ffz_menu_handler=null),this._ffz_dblclick_handler&&((0,P.off)(A,"dblclick",this._ffz_dblclick_handler),this._ffz_dblclick_handler=null),this._ffz_listeners=!1)},a.prototype.ffzDelayPause=function(){this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer),(this.props?.mediaPlayerInstance).isPaused()||(this._ffz_pause_timer=setTimeout(()=>{const D=this.props?.mediaPlayerInstance;D.isPaused()||D.pause()},500))},a.prototype.ffzDblClickHandler=function(A){A&&this._ffz_pause_timer&&clearTimeout(this._ffz_pause_timer)},a.prototype.ffzClickHandler=function(A){if(!A)return;const D=v.settings.get("player.volume-scroll"),O=v.settings.get("player.gain.scroll"),J=v.settings.get("player.single-click-pause"),G=g(D)||g(O);if(J&&A.button===0){if(!A.target||!A.target.classList.contains("click-handler"))return;this.ffzDelayPause()}if(G&&A.button===2&&(this.ffz_rmb=!0,this.ffz_scrolled=!1),!v.settings.get("player.mute-click")||A.button!==1)return;const V=this.props?.mediaPlayerInstance;if(!V?.isMuted)return;const q=!V.isMuted();return V.setMuted(q),localStorage.setItem("video-muted",JSON.stringify({default:q})),A.preventDefault(),!1},a.prototype.ffzMenuHandler=function(A){this.ffz_rmb=!1,this.ffz_scrolled&&(A.preventDefault(),A.stopPropagation())},a.prototype.ffzScrollHandler=function(A){const D=v.settings.get("player.volume-scroll"),O=v.settings.get("player.gain.scroll"),J=v.settings.get("player.gain.no-volume"),G=O&&u(O,A,this.ffz_rmb),V=D&&u(D,A,this.ffz_rmb);if(!G&&!V)return;const q=A.wheelDelta||-(A.deltaY||A.detail||0),re=this.props?.mediaPlayerInstance,ae=re?.mediaSinkManager?.video||re?.core?.mediaSinkManager?.video,fe=ae?._ffz_compressed&&ae?._ffz_gain!=null,be=fe&&G;if(!re?.getVolume)return;g(be?O:D)&&(this.ffz_scrolled=!0);const Pe=v.settings.get("player.volume-scroll-steps");if(be){let ne=ae._ffz_gain_value;ne==null&&(ne=v.settings.get("player.gain.default"));const ie=v.settings.get("player.gain.min"),le=v.settings.get("player.gain.max");q>0?ne+=Pe:ne-=Pe,ne<ie&&(ne=ie),ne>le&&(ne=le),ae._ffz_gain_value=ne,J&&ne!==0&&(re.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),v.updateGain(this)}else if(V&&!(ae._ffz_compressed&&J)){const ne=ae?.volume??re.getVolume(),ie=Math.max(0,Math.min(1,ne+(q>0?Pe:-Pe)));re.setVolume(ie),localStorage.volume=ie,ie!==0&&(re.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1})))}return A.preventDefault(),!1},a.prototype.ffzMaybeRemoveNativeListeners=function(){const A=this.props.containerRef;A&&this.listenersAttached&&((0,P.off)(A,"mouseleave",this.setPlayerInactive),(0,P.off)(A,"mouseenter",this.setPlayerActive),(0,P.off)(A,"mousemove",this.onMouseMove),this.listenersAttached=!1)},a.prototype.maybeAttachDomEventListeners=function(){try{this.ffzInstall(),this.ffzAttachListeners()}catch(A){v.log.error("Error attaching event listener.",A)}return F.call(this)}}shouldStopAutoplay(){return!1}installVisibilityHook(){if(!document.pictureInPictureEnabled){this.log.info("Skipping visibility hooks. Picture-in-Picture is not available.");return}const a=this;document.addEventListener("fullscreenchange",()=>{const v=document.fullscreenElement,F=document.pictureInPictureElement;v&&F&&(v===F||v.contains(F))&&document.exitPictureInPicture();for(const A of this.Player.instances)this.addPiPButton(A)});try{Object.defineProperty(document,"hidden",{configurable:!0,get(){return document.pictureInPictureElement!=null||a.settings.get("player.force-visible")?!1:document.visibilityState==="hidden"}})}catch(v){this.log.warn("Unable to install document visibility hook.",v)}}stopPlayer(a,v,F){if(a&&a.pause&&(a.getState?.()||a.core?.getState?.())==="Playing")a.pause();else if(v&&!v._ffz_stopping){v._ffz_stopping=!0;const A=B(()=>{F.props.mediaPlayerInstance?.pause&&(F.props.mediaPlayerInstance.pause(),(0,P.off)(v,"Playing",A),v._ffz_stopping=!1)},"immediatePause");this.log.info("Unable to immediately pause. Listening for playing event."),(0,P.on)(v,"Playing",A)}}updateCaptionsCSS(){const a=[],v=this.settings.get("player.captions.font-size");let F=this.settings.get("player.captions.font-family");if(F&&F.length){const[A,D]=(0,I.jo)(F);F=A,this._font_unloader&&this._font_unloader(),this._font_unloader=D,F.indexOf(" ")!==-1&&F.indexOf(",")===-1&&F.indexOf('"')===-1&&F.indexOf("'")===-1&&(F=`"${F}"`),W.style.fontFamily="",W.style.fontFamily=F,W.style.fontFamily&&a.push(`font-family: ${W.style.fontFamily} !important;`)}W.style.fontSize="",W.style.fontSize=v,W.style.fontSize&&a.push(`font-size: ${W.style.fontSize} !important;`),a.length?this.css_tweaks.set("captions-font",`.player-captions-container__caption-line {
	${a.join(`
	`)}
}`):this.css_tweaks.delete("captions-font")}updateHideExtensions(a){a===void 0&&(a=this.settings.get("player.ext-hide")),this.css_tweaks.toggleHide("player-ext-hover",a===1),this.css_tweaks.toggleHide("player-ext",a===2)}skipContentWarnings(a){if(!this.settings.get("player.disable-content-warnings"))return;const v=this.fine.getHostNode(a),F=v&&v.querySelector('button[data-a-target="content-classification-gate-overlay-start-watching-button"]');F&&F.click()}updateGUI(a){this.skipContentWarnings(a),this.addPiPButton(a),this.addResetButton(a),this.addClipButton(a),this.addCompressorButton(a,!1),this.addGainSlider(a,!1),this.addMetadata(a),this.emit(":update-gui",a)}areControlsDisabled(a){return a._ffz_control_state||this.findControlState(a),a._ffz_control_state?a._ffz_control_state.props.disableControls:!1}findControlState(a){a._ffz_control_state||(a._ffz_control_state=this.fine.searchTree(a,v=>v.props&&(0,L.has)(v.props,"disableControls"),200))}addGainSlider(a,v,F=0){const A=a.props.containerRef||this.fine.getChildNode(a),D=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,O=A&&A.querySelector(x);let J=D!=null&&D._ffz_compressed&&D._ffz_gain;if(this.areControlsDisabled(a)&&(J=null),!O)return D&&!J?void 0:F<5?setTimeout(this.addGainSlider.bind(this,a,v,(F||0)+1),250):void 0;const G=this.settings.get("player.gain.min"),V=this.settings.get("player.gain.max");(G>=V||V<=G)&&(J=null);let q,re,ae,fe,be,Pe=O.querySelector(".ffz--player-gain");if(!J){Pe&&Pe.remove();return}if(Pe){if(v)return;ae=Pe.querySelector("input"),be=Pe.querySelector(".ffz--gain-value"),re=Pe.querySelector(".ffz-il-tooltip"),q=Pe.querySelector(".ffz-il-tooltip .ffz--p-tip"),fe=Pe.querySelector(".ffz-il-tooltip .ffz--p-value")}else{const ze=B(()=>{let oe=ae.value/100;const we=this.settings.get("player.gain.min"),Te=this.settings.get("player.gain.max");if(oe<we&&(oe=we),oe>Te&&(oe=Te),oe==D._ffz_gain_value)return;const Be=a.props.mediaPlayerInstance,Oe=Be.core||Be;!this.areControlsDisabled(a)&&oe>0&&this.settings.get("player.gain.no-volume")&&Oe?.isMuted?.()&&(Oe.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),D._ffz_gain_value=oe,J.gain.value=oe;const Ie=Te-we,Ve=(oe-we)/Ie;be.style.width=`${Ve*100}%`,fe.textContent=`${Math.round(oe*100)}%`},"on_change");Pe=(0,P.createElement)("div",{class:"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container"},(0,P.createElement)("div",{class:"tw-align-items-center tw-flex tw-full-height"},(0,P.createElement)("label",{class:"tw-hide-accessible"},this.i18n.t("player.gain.label","Gain Control")),(0,P.createElement)("div",{class:"tw-flex tw-full-width tw-relative tw-z-above"},ae=(0,P.createElement)("input",{class:"ffz-range ffz-range--overlay",type:"range",min:"0",max:"100",step:"1","data-a-target":"player-gain-slider",value:"100"}),(0,P.createElement)("div",{class:"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below"},(0,P.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-container"},be=(0,P.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-value ffz--gain-value","data-test-selector":"ffz-range__fill-value-selector"}))))),re=(0,P.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},(0,P.createElement)("div",null,q=(0,P.createElement)("div",{class:"ffz--p-tip"}),fe=(0,P.createElement)("div",{class:"tw-regular ffz--p-value"})))),ae.addEventListener("input",ze),O.appendChild(Pe)}let ne=D._ffz_gain_value;ne==null&&(ne=this.settings.get("player.gain.default")),ae.min=G*100,ae.max=V*100,ae.value=ne*100;const ie=V-G,le=(ne-G)/ie;be.style.width=`${le*100}%`,q.textContent=this.i18n.t("player.gain.label","Gain Control"),fe.textContent=`${Math.round(ne*100)}%`}addCompressorButton(a,v,F=0){const A=a.props.containerRef||this.fine.getChildNode(a),D=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,O=A&&A.querySelector(x),J=b&&D!=null&&this.settings.get("player.compressor.enable");if(!O)return J&&F<5?setTimeout(this.addCompressorButton.bind(this,a,v,(F||0)+1),250):void 0;let G,V,q,re,ae=O.querySelector(".ffz--player-comp");if(!J||this.areControlsDisabled(a)){ae&&ae.remove();return}if(!ae)ae=(0,P.createElement)("div",{class:"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container"},re=(0,P.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-comp-button",onClick:this.compressPlayer.bind(this,a)},(0,P.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,P.createElement)("div",{class:"tw-button-icon__icon"},G=(0,P.createElement)("figure",{class:"ffz-player-icon"})))),(0,P.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},(0,P.createElement)("div",null,V=(0,P.createElement)("div",{class:"ffz--p-tip"}),q=(0,P.createElement)("div",{class:"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain"})))),O.appendChild(ae);else{if(v)return;G=ae.querySelector("figure"),re=ae.querySelector("button"),V=ae.querySelector(".ffz-il-tooltip .ffz--p-tip"),q=ae.querySelector(".ffz-il-tooltip .ffz--p-extra")}const fe=D._ffz_compressed,be=this.canCompress(a);let Pe=be?fe?this.i18n.t("player.comp_button.off","Disable Audio Compressor"):this.i18n.t("player.comp_button.on","Audio Compressor"):this.i18n.t("player.comp_button.disabled","Audio Compressor cannot be enabled when viewing Clips.");q.textContent=this.i18n.t("player.comp_button.help","See the FFZ Control Center for details. If audio breaks, please reset the player."),be&&this._shortcut_bound&&(Pe=`${Pe} (${this._shortcut_bound})`),G.classList.toggle("ffz-i-comp-on",fe),G.classList.toggle("ffz-i-comp-off",!fe),re.disabled=!be,re.setAttribute("aria-label",Pe),V.textContent=Pe}replaceVideoElement(a,v){const F=(0,P.createElement)("video"),A=v?._ffz_pregain_volume??v?.volume??a.getVolume(),D=a.isMuted();return F._ffz_gain_value=v._ffz_gain_value,F._ffz_state=v._ffz_state,F._ffz_toggled=v._ffz_toggled,F._ffz_maybe_compress=v._ffz_compressed,F.volume=A,D&&(F.muted=!0),F.playsInline=!0,this.installPlaybackRate(F),v.replaceWith(F),a.attachHTMLVideoElement(F),F}hookPlayerLoad(a){!a||a._ffz_load||(a._ffz_load=a.load,a.load=(...v)=>{try{const F=a.getHTMLVideoElement();F?._ffz_compressor&&a.attachHTMLVideoElement&&(this.log.info("Recreating video element due to player load with compressor installed."),this.replaceVideoElement(a,F))}catch(F){t.log.error("Error while handling player load.",F)}return a._ffz_load(...v)})}compressPlayer(a,v){const F=a.props.mediaPlayerInstance,A=F.core||F,D=A?.mediaSinkManager?.video;if(!D||!b)return;this.hookPlayerLoad(F),a._ffz_setSrc||(a._ffz_setSrc=a.setSrc,a.setSrc=async function(...be){console.log("setSrc",be);const Pe=a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;return Pe&&Pe._ffz_compressor&&await this.resetPlayer(a),a._ffz_setSrc(...be)}),A._ffz_setVolume||(A._ffz_setVolume=A.setVolume,A._ffz_fakeVolume=()=>{}),D._ffz_maybe_compress=!1;const O=D._ffz_compressed||!1;let J=D._ffz_toggled?D._ffz_state:this.settings.get("player.compressor.default");if(v!=null&&(v.preventDefault(),D._ffz_toggled=!0,J=!D._ffz_compressed,D._ffz_state=J),D._ffz_compressor){if(!D._ffz_comp_reset&&!this.canCompress(a)){D._ffz_comp_reset=!0,this.resetPlayer(a);return}}else{if(!J)return;this.createCompressor(a,D)}let G=D._ffz_gain;const V=c&&this.settings.get("player.gain.enable"),q=G!=null;if((J==O||v==null&&D._ffz_toggled)&&q==V)return;const re=D._ffz_context,ae=D._ffz_compressor,fe=D._ffz_source;if(!(!re||!ae||!fe)){if(V&&!G){let be=D._ffz_gain_value;be==null&&(be=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;G=D._ffz_gain=new GainNode(re,{gain:be})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),G=D._ffz_gain=re.createGain(),G.gain.value=be}ae.connect(G),O&&(ae.disconnect(re.destination),G.connect(re.destination))}else!V&&G&&(ae.disconnect(G),O&&(G.disconnect(re.destination),ae.connect(re.destination)),G=D._ffz_gain=null);J!=O&&(J?(fe.disconnect(re.destination),fe.connect(ae),G?(G.connect(re.destination),this.settings.get("player.gain.no-volume")&&(D._ffz_pregain_volume=A.getVolume(),A._ffz_setVolume(1),A.setVolume=A._ffz_fakeVolume)):ae.connect(re.destination)):(fe.disconnect(ae),G?(G.disconnect(re.destination),D._ffz_pregain_volume!=null&&(A._ffz_setVolume(D._ffz_pregain_volume),A.setVolume=A._ffz_setVolume,D._ffz_pregain_volume=null)):ae.disconnect(re.destination),fe.connect(re.destination))),a.props.containerRef&&(a.props.containerRef.dataset.compressed=J),D._ffz_compressed=J,this.addCompressorButton(a),this.addGainSlider(a)}}updateGainVolume(a){const v=a.props.mediaPlayerInstance,F=v.core||v,A=F?.mediaSinkManager?.video;if(!A||!A._ffz_compressed)return;const D=this.settings.get("player.gain.no-volume");D&&A._ffz_pregain_volume==null?(A._ffz_pregain_volume=F.getVolume(),F._ffz_setVolume(1),F.setVolume=F._ffz_fakeVolume):!D&&A._ffz_pregain_volume!=null&&(F._ffz_setVolume(A._ffz_pregain_volume),F.setVolume=F._ffz_setVolume,A._ffz_pregain_volume=null)}canCompress(a){if(!b)return!1;const v=a.props?.mediaPlayerInstance;if(v==null)return!1;const F=v.mediaSinkManager?.video||v.core?.mediaSinkManager?.video;return!(!F||!F.src&&!F.srcObject||F.src&&new URL(F.src).protocol!=="blob:")}createCompressor(a,v,F){if(!this.canCompress(a))return;let A=v._ffz_compressor;if(!A){if(F=F||new AudioContext,F.state==="suspended"){let O;const J=B(()=>{if(clearTimeout(O),F.removeEventListener("statechange",J),F.state==="suspended"){this.log.debug("Aborting due to browser auto-play policy.");return}this.createCompressor(a,v,F)},"evt");this.log.debug("Attempting to resume suspended AudioContext."),O=setTimeout(J,100);try{F.addEventListener("statechange",J),F.resume()}catch{}return}v._ffz_context=F;let D;try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;D=v._ffz_source=new MediaElementAudioSourceNode(F,{mediaElement:v})}catch{this.log.info("Unable to use new MediaElementAudioSourceNode. Falling back to old method."),D=v._ffz_source=F.createMediaElementSource(v)}D.connect(F.destination);try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;A=v._ffz_compressor=new DynamicsCompressorNode(F)}catch{this.log.info("Unable to use new DynamicsCompressorNode. Falling back to old method."),A=v._ffz_compressor=F.createDynamicsCompressor()}if(this.settings.get("player.gain.enable")){let O,J=v._ffz_gain_value;J==null&&(J=this.settings.get("player.gain.default"));try{if(this.settings.get("player.compressor.force-legacy"))throw new Error;O=v._ffz_gain=new GainNode(F,{gain:J})}catch{this.log.info("Unable to use new GainNode. Falling back to old method."),O=v._ffz_gain=F.createGain(),O.gain.value=J}A.connect(O)}v._ffz_compressed=!1}this.updateCompressor(null,A)}updateGains(){for(const a of this.Player.instances)this.updateGain(a)}updateGain(a,v,F,A=!0){if(F||(F=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video),v==null&&(v=F?._ffz_gain),!F||!v)return;let D=F._ffz_gain_value;D==null&&(D=this.settings.get("player.gain.default")),v.gain.value=D,A&&this.addGainSlider(a)}updateCompressors(){for(const a of this.Player.instances)this.updateCompressor(a)}updateCompressor(a,v){v==null&&(v=(a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video)?._ffz_compressor),v&&(v.threshold.value=this.settings.get("player.compressor.threshold"),v.knee.value=this.settings.get("player.compressor.knee"),v.ratio.value=this.settings.get("player.compressor.ratio"),v.attack.value=this.settings.get("player.compressor.attack"),v.release.value=this.settings.get("player.compressor.release"))}updatePlaybackRates(){for(const a of this.Player.instances)this.updatePlaybackRate(a)}updatePlaybackRate(a){const v=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;v.setFFZPlaybackRate||this.installPlaybackRate(v),v.setFFZPlaybackRate(v.playbackRate)}installPlaybackRate(a){if(a.setFFZPlaybackRate)return;let v=a.playbackRate;const F=this,A=B(()=>{F.settings.get("player.allow-catchup")||Object.defineProperty(a,"playbackRate",{configurable:!0,get(){return v},set(D){(D===1||D<1||D>=1.1)&&a.setFFZPlaybackRate(D)}})},"installProperty");a.setFFZPlaybackRate=D=>{delete a.playbackRate,v=D,a.playbackRate=D,A()}}addPiPButton(a,v=0){const F=a.props.containerRef||this.fine.getChildNode(a),A=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,D=A&&document.fullscreenElement&&document.fullscreenElement.contains(A),O=F&&F.querySelector(m),J=document.pictureInPictureEnabled&&this.settings.get("player.button.pip");if(!O)return J&&v<5?setTimeout(this.addPiPButton.bind(this,a,(v||0)+1),250):void 0;let G,V,q,re=O.querySelector(".ffz--player-pip");if(!J){re&&re.remove();return}if(re)G=re.querySelector("figure"),q=re.querySelector("button"),V=re.querySelector(".ffz-il-tooltip");else{re=(0,P.createElement)("div",{class:"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container"},q=(0,P.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-pip-button",onClick:this.pipPlayer.bind(this,a)},(0,P.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,P.createElement)("div",{class:"tw-button-icon__icon"},G=(0,P.createElement)("figure",{class:"ffz-player-icon"})))),V=(0,P.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const Pe=O.querySelector('button[data-a-target="player-theatre-mode-button"]')||O.querySelector('button[aria-label*="Theat"]')||O.querySelector('button[data-a-target="player-fullscreen-button"]');Pe?O.insertBefore(re,Pe.parentElement):O.appendChild(re)}const ae=!!document.pictureInPictureElement,fe=!1,be=D?this.i18n.t("player.pip_button.fs","Cannot use Picture-in-Picture when Fullscreen"):fe?this.i18n.t("player.pip_button.swap","Switch Picture-in-Picture"):ae?this.i18n.t("player.pip_button.off","Exit Picture-in-Picture"):this.i18n.t("player.pip_button","Picture-in-Picture");G.classList.toggle("ffz-i-t-pip-inactive",!ae||fe),G.classList.toggle("ffz-i-t-pip-active",ae&&!fe),q.setAttribute("aria-label",be),V.textContent=be}pipPlayer(a,v){const F=a.props.mediaPlayerInstance?.mediaSinkManager?.video||a.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;!F||!document.pictureInPictureEnabled||(v&&v.preventDefault(),!(document.fullscreenElement&&document.fullscreenElement.contains(F))&&(F._ffz_pip_enter||(F.addEventListener("enterpictureinpicture",F._ffz_pip_enter=()=>{this.addPiPButton(a)}),F.addEventListener("leavepictureinpicture",F._ffz_pip_exit=()=>{this.addPiPButton(a)})),document.pictureInPictureElement?document.exitPictureInPicture():F.requestPictureInPicture()))}addClipButton(a,v=0){const F=a.props.containerRef||this.fine.getChildNode(a),A=F&&F.querySelector(m),D=this.settings.get("player.clip-button.custom");if(!A)return D&&v<5?setTimeout(this.addClipButton.bind(this,a,(v||0)+1),250):void 0;let O,J,G=A.querySelector(".ffz--player-clip");if(!D){G&&G.remove();return}if((!A.ffz_native_clip||!A.contains(A.ffz_native_clip))&&(A.ffz_native_clip=r(A)),G)J=G.querySelector("button"),O=G.querySelector(".ffz-il-tooltip");else{const re=B(fe=>{const be=r(A);be&&be.click()},"on_click");G=(0,P.createElement)("div",{class:"ffz--player-clip tw-inline-flex tw-relative ffz-il-tooltip__container"},J=(0,P.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-clip-button",onClick:re},(0,P.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,P.createElement)("div",{class:"tw-button-icon__icon"},(0,P.createElement)("figure",{class:"ffz-player-icon ffz-i-clip"})))),O=(0,P.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const ae=A.querySelector(".ffz--player-reset button")||A.querySelector(".ffz--player-pip button")||A.querySelector('button[data-a-target="player-theatre-mode-button"]')||A.querySelector('button[aria-label*="Theat"]')||A.querySelector('button[data-a-target="player-fullscreen-button"]');ae?A.insertBefore(G,ae.parentElement):A.appendChild(G)}const V=A.ffz_native_clip,q=V?V.disabled||V.ariaDisabled==="true":!1;J.disabled=q,J.setAttribute("aria-label",O.textContent=q?V.ariaLabel||this.i18n.t("player.clip-button.disabled","Clips are Disabled"):this.i18n.t("player.clip-button","Clip (Alt+X)"))}clickClip(a,v){console.log("clicked clip",a,v)}addResetButton(a,v=0){const F=a.props.containerRef||this.fine.getChildNode(a),A=F&&F.querySelector(m),D=this.settings.get("player.button.reset");if(!A)return D&&v<5?setTimeout(this.addResetButton.bind(this,a,(v||0)+1),250):void 0;let O,J,G=A.querySelector(".ffz--player-reset");if(!D){G&&G.remove();return}if(G)J=G.querySelector("button"),O=G.querySelector(".ffz-il-tooltip");else{G=(0,P.createElement)("div",{class:"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container"},J=(0,P.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:w,onDblClick:this.resetPlayer.bind(this,a)},(0,P.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,P.createElement)("div",{class:"tw-button-icon__icon"},(0,P.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),O=(0,P.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const V=A.querySelector(".ffz--player-pip button")||A.querySelector('button[data-a-target="player-theatre-mode-button"]')||A.querySelector('button[aria-label*="Theat"]')||A.querySelector('button[data-a-target="player-fullscreen-button"]');V?A.insertBefore(G,V.parentElement):A.appendChild(G)}J.setAttribute("aria-label",O.textContent=this.i18n.t("player.reset_button","Reset Player (Double-Click)"))}addErrorResetButton(a,v=0){const F=a.props.containerRef||this.fine.getChildNode(a),A=F&&F.querySelector(".content-overlay-gate"),D=this.settings.get("player.button.reset");if(!A){if(!D)return;v<2&&this.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||t.fine.getChildNode(this),1e3).then(()=>{this.addErrorResetButton(a,(v||0)+1)}).catch(()=>{this.log.warn("Unable to find container element for Error Reset button.")});return}let O,J,G=A.querySelector(".ffz--player-reset");if(!D){G&&G.remove();return}G?(J=G.querySelector("button"),O=G.querySelector(".ffz-il-tooltip")):(G=(0,P.createElement)("div",{class:"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1"},J=(0,P.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:w,onDblClick:this.resetPlayer.bind(this,a)},(0,P.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,P.createElement)("div",{class:"tw-button-icon__icon"},(0,P.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),O=(0,P.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"})),A.appendChild(G)),J.setAttribute("aria-label",O.textContent=this.i18n.t("player.reset_button","Double-Click to Reset Player"))}resetAllPlayers(){for(const a of this.Player.instances)this.resetPlayer(a)}async resetPlayer(a,v){const F=a?a.mediaSinkManager||a.core?.mediaSinkManager?a:a?.props?.mediaPlayerInstance:null;if(v){v.preventDefault();const G=v.currentTarget,V=G&&G.querySelector("figure");if(V){if(V.classList.contains("loading"))return;V.classList.toggle("ffz-i-t-reset",!0),V.classList.toggle("ffz-i-t-reset-clicked",!1),V.classList.toggle("loading",!0),V._ffz_unspin=setTimeout(()=>{V._ffz_unspin=null,V.classList.toggle("loading",!1)},1e4)}}const A=F.getDuration?.()??1/0;let D=-1;const O=F.core||F;O._ffz_setVolume&&(O.setVolume=O._ffz_setVolume),isFinite(A)&&!isNaN(A)&&A>0&&(D=F.getPosition());const J=F.mediaSinkManager?.video||F.core?.mediaSinkManager?.video;if(J?._ffz_compressor&&F.attachHTMLVideoElement){const G=this.replaceVideoElement(F,J);G._ffz_maybe_compress=!0}this.PlayerSource.check();for(const G of this.PlayerSource.instances)(!F||F===G.props?.mediaPlayerInstance)&&await G.setSrc({isNewMediaPlayerInstance:!1});D>0&&setTimeout(()=>F.seekTo(D),250)}addMetadata(a){this.metadata&&(a._ffz_md_update||(a._ffz_md_update=(0,L.debounce)(()=>requestAnimationFrame(()=>this._updateMetadata(a)),1e3,2)),a._ffz_md_update())}wantsMetadata(){return!1}_updateMetadata(a){a._ffz_cont&&!document.contains(a._ffz_cont)&&(a._ffz_cont=null);const v=this.wantsMetadata(a);if(!a._ffz_cont){if(!v)return;const F=a.props.containerRef||this.fine.getChildNode(a),A=F&&F.querySelector(m);if(!A)return;a._ffz_cont=(0,P.createElement)("div",{class:"ffz--player-meta-tray"}),A.insertBefore(a._ffz_cont,A.firstElementChild)}if(!v){a._ffz_cont.remove(),a._ffz_cont=null;return}this.updateMetadata(a)}updateMetadata(a,v){const F=a._ffz_cont;if(!F||!document.contains(F))return;v?Array.isArray(v)||(v=[v]):v=this.metadata.keys;const A=this.getData(),D=A?.props?.data?.user,O=a._ffz_meta_timers=a._ffz_meta_timers||{},J=B(V=>this.updateMetadata(a,V),"refresh_fn"),G={channel:{id:D?.id,login:A?.props?.channelLogin,display_name:D?.displayName,live:D?.stream?.id!=null,live_since:D?.stream?.createdAt},inst:a,source:A,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>D?.id?this.getBroadcastID(a,D.id):null};for(const V of v)this.metadata.renderPlayer(V,G,F,O,J)}getUptime(a){let A=this.getData()?.props?.data?.user?.stream?.createdAt;return A?(A instanceof Date||(A=new Date(A)),(Date.now()-A.getTime())/1e3):null}getBroadcastID(a,v){if(!this.twitch_data)return Promise.resolve(null);const F=a._ffz_bcast_cache=a._ffz_bcast_cache||{};return v===F.channel_id&&Date.now()-F.saved<6e4?Promise.resolve(F.broadcast_id):new Promise(async(A,D)=>{if(F.updating){F.updating.push([A,D]);return}F.channel_id=v,F.updating=[[A,D]];let O,J;try{O=await this.twitch_data.getBroadcastID(v)}catch(V){O=null,J=V}const G=F.updating;if(F.updating=null,F.channel_id!==v){J=new Error("Outdated"),F.channel_id=null,F.broadcast_id=null,F.saved=0;for(const V of G)V[1](J);return}F.broadcast_id=O,F.saved=Date.now();for(const V of G)J?V[1](J):V[0](O)})}get playerUI(){return this.fine.searchTree(this.Player.first,v=>v.props&&v.props.uiContext,150)?.props?.uiContext}get current(){for(const a of this.Player.instances)if(a?.props?.mediaPlayerInstance)return a.props.mediaPlayerInstance;return null}};B(C,"PlayerBase");let z=C},43874:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>O});var K=S(33612),P=S(22527),L=S(46949),I=S(24431),W=(ne=>(ne[ne.Unloaded=0]="Unloaded",ne[ne.Loaded=1]="Loaded",ne[ne.Ready=2]="Ready",ne[ne.Used=3]="Used",ne))(W||{});const x={};function m(ne){return x[ne]?x[ne]:x[ne]=new RegExp(`\\b(?<!\\.)${ne}\\(([0-9e_+]+)\\)`,"g")}B(m,"getRequireRegex");const b=["webpackJsonp","webpackChunktwitch_twilight","webpackChunktwitch_sunlight","webpackJsonp_N_E"],c=null;function d(ne,ie){let le=0;const ze={},oe={},we=[],Te={},Be=[];function Oe(Ie){ze[Ie]=le,oe[Ie]=le,le++,we.push(Ie),Te[Ie]=!0;const Ve=ne[Ie];if(Ve.requires)for(const Ke of Ve.requires)ie.has(Ke)&&(ze[Ke]===void 0?(Oe(Ke),oe[Ie]=Math.min(oe[Ie],oe[Ke])):Te[Ke]&&(oe[Ie]=Math.min(oe[Ie],ze[Ke])));if(oe[Ie]===ze[Ie]){const Ke=[];let Ye;do Ye=we.pop(),Te[Ye]=!1,Ke.push(Ye);while(Ye!==Ie);Be.push(Ke)}}B(Oe,"strongconnect");for(const Ie of ie)ze[Ie]===void 0&&Oe(Ie);return Be}B(d,"computeSCC");const q=class q extends P.default{constructor(ie,le){super(ie,le),this._processGraph=this._processGraph.bind(this),this.start_time=performance.now(),this._known_rules={},this._mod_cache={},this._require=null,this._chunk_names={},this._pending_ready_ids=new Set,this._loaded_ids=new Set,this._graph={},this.hookLoader(),this.getRequire()}waitForLoader(){return this._original_loader?Promise.resolve(this._original_loader):(this._load_waiter||(this._load_waiter=new Promise((ie,le)=>{this._load_wait_fns=[ie,le]})),this._load_waiter)}_resolveLoadWait(ie){const le=this._load_wait_fns;this._load_waiter=null,this._load_wait_fns=null,le&&(ie?le[0](ie):le[1]())}hookLoader(ie=0){if(this._original_loader){this.log.warn("Attempted to call hookLoader twice.");return}let le=null;for(const we of b)if(window[we]){le=we;break}if(!le){if(ie>240){this.log.error("Unable to find webpack's loader after one minute.");try{const we=[];for(const Te of Object.keys(window))(0,L.has)(window,Te)&&typeof Te=="string"&&/webpack/i.test(Te)&&!/ffz/i.test(Te)&&we.push(Te);we.length?this.log.info("Possible Matches: ",we.join(", ")):this.log.info("No possible matches found.")}catch{}this._resolveLoadWait();return}setTimeout(this.hookLoader.bind(this,ie+1),250);return}const ze=window[le];if(Array.isArray(ze)){this._original_store=ze,this._original_loader=ze.push,this._processAllModules();try{ze.push=this.webpackJsonpv4.bind(this)}catch{this.log.warn("Unable to wrap webpackJsonp due to write protection."),this._resolveLoadWait();return}}else{this.log.error("webpackJsonp is of an unknown value. Unable to wrap."),this._resolveLoadWait();return}this._resolveLoadWait(this._original_loader);const oe=performance.now();this.log.info(`Hooked webpack loader after ${Math.round(100*(oe-this.start_time))/100}ms`)}webpackJsonpv4(ie,...le){const ze=ie[0].map(Be=>typeof Be!="string"?`${Be}`:Be),oe=ie[1],we=Array.isArray(ze)?ze.map(Be=>this._chunk_names[Be]??Be):null;this.log.verbose(`Twitch Chunk Loaded: ${ze} (${we?.join(", ")})`),this.log.verbose(`Modules: ${Object.keys(oe)}`);const Te=this._original_loader.call(this._original_store,ie,...le);return oe&&this._processModulesV4(oe),Te}getRequire(){return this._require?Promise.resolve(this._require):(this._require_waiter||(this._require_waiter=new Promise(async(ie,le)=>{let ze=await this.waitForLoader();ze=ze.bind(this._original_store);const oe=`ffz-loader$${(0,L.generateUUID)()}`;ze([[oe],{[oe]:(we,Te,Be)=>{this._require=Be,this._loadChunkNames(),ie(this._require);const Oe=performance.now();this.log.info(`Hooked webpack require after ${Math.round(100*(Oe-this.start_time))/100}ms`),this._processAllModules(),this._require_waiter=null}},we=>we(oe)])})),this._require_waiter)}_loadChunkNames(){let ie=null;if(this._require?.u){const le=this._require.u.toString(),ze=/assets\/"\+\(?({\d+:.*?})/.exec(le),oe=ze?ze[1].replace(/([\de]+):/g,(we,Te)=>{if(/^\d+e\d+$/.test(Te)){const Be=Te.split("e");Te=parseInt(Be[0],10)*10**parseInt(Be[1],10)}return`"${Te}":`}):null;if(oe)try{ie=JSON.parse(oe)}catch(we){console.log(oe),console.log(we)}}ie?(this._chunk_names=ie,this.log.debug(`Loaded names for ${Object.keys(ie).length} chunks from require().`)):this.log.warn("Unable to find chunk names in require().")}_getNode(ie){let le=this._graph[ie];return le||(le=this._graph[ie]={id:ie,state:0,requires:null,dependants:null}),le}_processAllModules(){if(!(!this._require?.m||!this._original_store||this._processed_all)){this._processed_all=!0;for(const ie of this._original_store)ie&&ie[1]&&this._processModulesV4(ie[1])}}_processModulesV4(ie){const le=this._require;let ze=!1;for(const oe of Object.keys(ie)){const we=this._getNode(oe),Te=le?.m?.[oe];we.state!==0||!Te||(we.state=1,this._loaded_ids.add(oe),we.requires==null&&this._detectRequirements(we,Te),we.requires===!1&&(we.state=2,this._loaded_ids.delete(oe),this._pending_ready_ids.add(oe)),we.dependants&&we.dependants.size>0&&(ze=!0))}(ze||this._pending_ready_ids.size>0)&&this.scheduleGraphUpdate()}_detectRequirements(ie,le){const ze=le.toString(),oe=/^function\([^,)]+,[^,)]+,([^,)]+)/.exec(ze);if(oe){const we=m(oe[1]),Te=new Set;we.lastIndex=0;let Be;for(;Be=we.exec(ze);){let Oe=Be[1];if(Oe==="e")continue;if(/^\d+e\d+$/.test(Oe)){const Ve=Oe.split("e");Oe=`${parseInt(Ve[0],10)*10**parseInt(Ve[1],10)}`}Te.add(Oe);const Ie=this._getNode(Oe);Ie.dependants??(Ie.dependants=new Set),Ie.dependants.add(ie.id)}ie.requires=Te.size>0?Te:!1}else ie.requires=!1}scheduleGraphUpdate(){this._graph_update_raf||(this._graph_update_raf=requestAnimationFrame(this._processGraph))}_processGraph(){this._graph_update_raf=null;const ie=performance.now(),le=this._pending_ready_ids.size;let ze=!0;for(;ze&&(ze=!1,this._loaded_ids.size!==0);){const we=d(this._graph,this._loaded_ids);for(const Te of we){if(Te.length===0)continue;let Be=!0;for(const Oe of Te){const Ie=this._graph[Oe];if(Ie.requires)for(const Ve of Ie.requires){if(Te.includes(Ve))continue;const Ke=this._graph[Ve];if(!Ke||Ke.state!==2&&Ke.state!==3){Be=!1;break}}if(!Be)break}if(Be){ze=!0;for(const Oe of Te){const Ie=this._graph[Oe];Ie.state===1&&(Ie.state=2,this._loaded_ids.delete(Oe),this._pending_ready_ids.add(Oe))}}}}const oe=performance.now();if(this.log.debug(`Processed graph in ${Math.round(100*(oe-ie))/100}ms, found ${this._pending_ready_ids.size-le} newly ready modules. There are ${this._loaded_ids.size} remaining Loaded modules.`),this._pending_ready_ids.size){const we=this._pending_ready_ids;this._pending_ready_ids=new Set,this.emit(":new-ready",we)}}known(ie,le){if(typeof ie=="object"){for(const ze of Object.keys(ie))this.known(ze,ie[ze]);return}this._known_rules[ie]=le}async findModule(ie,le){return this._require||await this.getRequire(),this.getModule(ie,le)}findDeep(ie,le,ze=!0){if(ie&&!Array.isArray(ie)&&(ie=[ie]),!this._require||!this._original_store)throw new Error("We do not have webpack");const oe=[],we=this._chunk_names;for(const[Te,Be]of this._original_store)for(const Oe of Object.keys(Be)){const Ie=this._getNode(Oe);if(!(Ie.state!==2&&Ie.state!==3))try{Ie.state=3;const Ve=this._require(Oe);if(Ve){for(const[Ke,Ye]of Object.entries(Ve))if(Ye&&le(Ye,Ve,Ke)){if(this.log.info(`Found in key "${Ke}" of module "${Oe}" (${this.chunkNameForModule(Oe)})`),!ze)return Ve;oe.push(Ve);break}}}catch(Ve){this.log.warn("Exception while deep scanning webpack.",Ve)}}return oe.length?oe:(this.log.info("Unable to find deep scan target."),null)}getModule(ie,le){if(typeof ie=="function"&&(le=ie,ie=null),ie&&this._mod_cache[ie])return this._mod_cache[ie];if(!le&&ie&&(le=this._known_rules[ie]),!le)throw new Error(`no known predicate for locating ${ie}`);const ze=this._require;return ze?.m?this._newGetModule(ie,le,ze):null}_chunksForModule(ie){if(!this._original_store)return null;const le=new Set;for(const[ze,oe]of this._original_store)if(oe[ie])for(const we of ze)le.add(we);return[...le]}chunkNameForModule(ie){const le=this._chunksForModule(ie);if(!le)return null;for(const ze of le){const oe=this._chunk_names[ze];if(oe)return oe}return null}chunkNamesForModule(ie){const le=this._chunksForModule(ie);return le?le.map(ze=>this._chunk_names[ze]||ze):null}_newGetModule(ie,le,ze){if(!ze)return null;let oe;if(this._original_store&&le.chunks&&this._chunk_names&&Object.keys(this._chunk_names).length){const Te=typeof le.chunks=="function";!Te&&!Array.isArray(le.chunks)&&(le.chunks=[le.chunks]);const Be=le.chunks,Oe=this._chunk_names;let Ie=[];for(const[Ve,Ke]of this._original_store){let Ye=!1;for(const it of Ve)if(Te?Be(Oe[it],it):Be.includes(it)||Be.includes(String(it))||Oe[it]&&Be.includes(Oe[it])){Ye=!0;break}Ye&&(Ie=[...Ie,...Object.keys(Ke)])}oe=new Set(Ie)}else oe=new Set(Object.keys(this._graph));let we=0;for(const Te of oe)try{we++;const Be=this._getNode(Te);if(Be.state!==2&&Be.state!==3)continue;Be.state=3;const Oe=ze(Te);if(Oe){const Ie=le(Oe);if(Ie){this.log.debug(`Located module "${ie}" in module ${Te}${I.DEBUG?` (${this.chunkNameForModule(Te)})`:""} after ${we} tries`);const Ve=le.use_result?Ie:Oe;return ie&&(this._mod_cache[ie]=Ve),Ve}}}catch(Be){this.log.warn(`Unexpected error trying to find module '${Te}':`,Be)}return this.log.debug(`Unable to locate module "${ie}" despite checking ${we} modules`),null}};B(q,"WebMunch");let f=q;var r=S(17159);const re=class re extends P.default{constructor(ie,le){super(ie,le),this._pruneLive=this._pruneLive.bind(this),this._wrappers=new Map,this._observer=null,this._watching=new Set,this._live_watching=null,this.scheduleCleaning()}onDisable(){this._stopWatching()}define(ie,le,ze,oe=null,we=0,Te=5e3,Be=!0){if(this._wrappers.has(ie))return this._wrappers.get(ie);if(!le||typeof le!="string"||!le.length)throw new Error("cannot find definition and no selector provided");const Oe=new w(ie,le,ze,oe,we,Te,Be,this);return this._wrappers.set(ie,Oe),Oe}route(ie){this._route=ie,this._timer=Date.now(),this._updateLiveWatching(),this.checkAll(),this.cleanAll()}scheduleCleaning(){this._clean_timeout&&clearTimeout(this._clean_timeout),this._clean_timeout=setTimeout(()=>{this._clean_timeout=null,this.cleanAll(),this.scheduleCleaning()},1e3)}cleanAll(){this._clean_all&&cancelAnimationFrame(this._clean_all),this._clean_all=requestAnimationFrame(()=>{this._clean_all=null;for(const ie of this._wrappers.values())ie.clean()})}checkAll(){if(this._watching)for(const ie of this._watching)ie.check()}updateTimeout(){this._timer=Date.now(),this._updateLiveWatching(),this.checkAll()}_isActive(ie,le){return!(ie.routes===!1||this._route&&ie.routes.length&&!ie.routes.includes(this._route)||ie.timeout>0&&le-this._timer>ie.timeout)}_updateLiveWatching(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);const ie=this._live_watching=[],le=Date.now();let ze=Number.POSITIVE_INFINITY;if(this._watching)for(const oe of this._watching)this._isActive(oe,le)&&(oe.timeout>0&&oe.timeout<ze&&(ze=oe.timeout),ie.push(oe));isFinite(ze)&&(this._timeout=setTimeout(this._pruneLive,ze)),ie.length?this._observer||this._startWatching():this._stopWatching()}_pruneLive(){this._updateLiveWatching()}_checkWatchers(ie){if(this._live_watching)for(const le of this._live_watching)le.checkElements(ie)}_startWatching(){!this._observer&&this._live_watching&&this._live_watching.length&&(this.log.info("Installing MutationObserver."),this._observer=new MutationObserver(ie=>this._checkWatchers(ie.map(le=>le.target))),this._observer.observe(document.body,{childList:!0,subtree:!0}))}_stopWatching(){this._observer&&(this.log.info("Stopping MutationObserver."),this._observer.disconnect()),this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._live_watching=null,this._observer=null}listen(ie,le=!0){this._watching.has(ie)||!le||(le&&(this._timer=Date.now()),this._watching.add(ie),this._updateLiveWatching())}unlisten(ie){this._watching.has(ie)&&(this._watching.delete(ie),this._updateLiveWatching())}};B(re,"Elemental");let g=re,u=0;const ae=class ae extends r.EventEmitter{constructor(ie,le,ze,oe,we,Te,Be,Oe){super(),this.id=u++,this.param=`_ffz$elemental$${this.id}`,this.remove_param=`_ffz$elemental_remove$${this.id}`,this._schedule=this._schedule.bind(this),this.name=ie,this.selector=le,this.routes=ze??[],this.opts=oe,this.limit=we,this.timeout=Te,this.check_removal=Be,this.opts&&!this.opts.childList&&!this.opts.attributes&&!this.opts.characterData&&(this.opts.attributes=!0),this.count=0,this.instances=new Set,this.elemental=Oe,this.check(),this.schedule()}get atLimit(){return this.limit>0&&this.count>=this.limit}clean(){const ie=Array.from(this.instances);let le=!1;for(const ze of ie)document.contains(ze)||(this.remove(ze,!1),le=!0);le&&((this.limit===0||this.count<this.limit)&&this.check(),this.schedule())}schedule(){this._stimer||(this._stimer=setTimeout(this._schedule,0))}_schedule(){this._stimer&&clearTimeout(this._stimer),this._stimer=null,this.limit===0||this.count<this.limit?this.elemental.listen(this):this.elemental.unlisten(this)}check(){const ie=document.querySelectorAll(this.selector);for(const le of ie)this.add(le)}checkElements(ie){if(this.atLimit)return this.schedule();for(const le of ie){const ze=le.querySelectorAll(this.selector);for(const oe of ze)this.add(oe);if(this.atLimit)return}}get first(){for(const ie of this.instances)return ie;return null}toArray(){return Array.from(this.instances)}each(ie){for(const le of this.instances)ie(le)}add(ie){if(!this.instances.has(ie)){if(this.instances.add(ie),this.count++,this.check_removal&&ie.parentNode){const le=new MutationObserver(()=>{requestAnimationFrame(()=>{document.contains(ie)||this.remove(ie)})});le.observe(ie.parentNode,{childList:!0}),ie[this.remove_param]=le}if(this.opts){const le=new MutationObserver(ze=>{document.contains(ie)?this.__running.size||this.emit("mutate",ie,ze):this.remove(ie)});le.observe(ie,this.opts),ie[this.param]=le}this.schedule(),this.emit("mount",ie)}}remove(ie,le=!0){const ze=ie[this.param];ze&&(ze.disconnect(),ie[this.param]=null);const oe=ie[this.remove_param];oe&&(oe.disconnect(),ie[this.remove_param]=null),this.instances.has(ie)&&(this.instances.delete(ie),this.count--,le&&this.schedule(),this.emit("unmount",ie))}};B(ae,"ElementalWrapper");let w=ae;var z=S(98247),C=S(45866),y=S(29632),a=S(27040);const fe=class fe extends r.FFZEvent{constructor(ie){super(ie),this._obj=void 0,this._changed=!1}markChanged(){this._changed=!0}get topic(){return this.event.topic}get message(){return this._obj===void 0&&(this._obj=JSON.parse(this.event.message)??null),this._obj}set message(ie){this._obj=ie,this._changed=!0}};B(fe,"PubSubEvent");let v=fe;const be=class be extends P.default{constructor(ie,le){super(ie,le),this.instance=null}onEnable(ie=0){const le=window.__twitch_pubsub_client;if(!le){ie>10?this.log.warn("Unable to find PubSub."):new Promise(ze=>setTimeout(ze,50)).then(()=>this.onEnable(ie+1));return}le&&(this.instance=le,this.hookClient(le)),this.instance||this.log.warn("Unable to find a PubSub instance.")}handleMessage(ie){try{if(ie.type==="MESSAGE"&&ie.data?.topic){const le=ie.data.topic,ze=le.indexOf("."),oe=ze===-1?le:le.slice(0,ze),we=ze===-1?"":le.slice(ze+1),Te=new v({prefix:oe,trail:we,event:ie.data});if(this.emit(":pubsub-message",Te),Te.defaultPrevented)return!0;Te._changed&&(ie.data.message=JSON.stringify(Te._obj))}}catch(le){this.log.error("Error processing PubSub event.",le)}return!1}hookClient(ie){const le=this,ze=ie.onMessage;ie.connection.removeAllListeners("message"),ie.onMessage=function(Te){if(!le.handleMessage(Te))return ze.call(this,Te)},ie.connection.addListener("message",ie.onMessage);const oe=ie.listen,we=ie.unlisten;ie.ffz_original_listen=oe,ie.ffz_original_unlisten=we,ie.listen=function(Te,Be,...Oe){const Ie=Te.topic,Ve=Ie&&!!ie.topicListeners?._events?.[Ie],Ke=oe.call(this,Te,Be,...Oe);return Ie&&!Ve&&le.emit(":add-topic",Ie),Ke},ie.unlisten=function(Te,Be,...Oe){const Ie=!!ie.topicListeners?._events?.[Te],Ve=we.call(this,Te,Be,...Oe);return Ie&&!ie.topicListeners?._events?.[Te]&&le.emit(":remove-topic",Te),Ve}}simulateMessage(ie,le){if(!this.instance)throw new Error("No PubSub instance available");this.instance.simulateMessage(ie,JSON.stringify(le))}get topics(){const ie=this.instance?.topicListeners?._events;return ie?Object.keys(ie):[]}};B(be,"Subpump");let F=be;var A=S(44589);const D=S.p+"main.css",Pe=class Pe extends K.Z{constructor(...ie){super(...ie),this.inject(f),this.inject(z.Z),this.inject(g),this.inject("router",C.Z),this.inject(y.default,!1),this.inject(a.default),this.inject(F),this._dom_updates=[]}async populateModules(){const ie=await S(41152),le=await this.loadFromContext(ie,this.log);this.log.info(`Loaded descriptions of ${Object.keys(le).length} modules.`)}async onLoad(){await this.populateModules(),this.web_munch.known(Pe.KNOWN_MODULES),this.router.route(Pe.ROUTES),this.router.routeName(Pe.ROUTE_NAMES),this.router.route("user","/:userName",null,ie=>ie?.channelView!=="Home"),this.router.route("user-home","/:userName",null,ie=>ie?.channelView==="Home"),this.router.route(Pe.DASH_ROUTES,"dashboard.twitch.tv"),this.router.route(Pe.PLAYER_ROUTES,"player.twitch.tv"),this.router.route(Pe.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){this.settings=this.resolve("settings"),this.web_munch.findModule("simplebar").then(Be=>{!window.ffzSimplebar&&Be&&(window.ffzSimplebar=Be)}).catch(()=>{});const ie=this.fine.searchNode(null,Be=>Be?.pendingProps?.store?.getState),le=this.store=ie?.pendingProps?.store;if(!le)return new Promise(Be=>setTimeout(Be,50)).then(()=>this.onEnable());this.on(":dom-update",(...Be)=>{this._dom_updates.push(Be),this._dom_frame||(this._dom_frame=requestAnimationFrame(()=>{const Oe=this._dom_updates,Ie=this.resolve("core");this._dom_updates=[],this._dom_frame=null;for(const[Ve,Ke]of Oe){const Ye=this.fine.getChildNode(Ke);Ie.emit("core:dom-update",Ve,Ye,Ke)}}))});const ze=B(()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}}),"update_size");window.addEventListener("resize",ze),ze();const oe=B(()=>{this.settings.updateContext({fullscreen:!!document.fullscreenElement}),this.emit(":fullscreen")},"update_fullscreen");document.addEventListener("fullscreenchange",oe),this.settings.updateContext({fullscreen:!!document.fullscreenElement}),le.subscribe(()=>this.updateContext()),this.updateContext(),this.router.on(":route",(Be,Oe)=>{this.log.info("Navigation",Be&&Be.name,Oe&&Oe[0]),this.fine.route(Be&&Be.name),this.elemental.route(Be&&Be.name),this.settings.updateContext({route:Be,route_data:Oe})});const we=this.router.current;this.fine.route(we&&we.name),this.elemental.route(we&&we.name),this.settings.updateContext({route:we,route_data:this.router.match}),document.head.appendChild((0,A.createElement)("link",{href:D,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}));const Te=new URL(window.location).searchParams;if(Te&&(Te.has("ffz-settings")&&this.resolve("main_menu").openExclusive(),Te.has("ffz-translate"))){const Be=this.resolve("translation_ui");Be.dialog.exclusive=!0,Be.enable()}}updateContext(){try{const ie=this.store.getState(),le=this.router?.reactLocation;this.settings.updateContext({location:le,ui:ie&&ie.ui,session:ie&&ie.session,chat:ie&&ie.chat})}catch(ie){this.log.error("Error updating context.",ie)}}getSession(){const ie=this.store&&this.store.getState();return ie&&ie.session}getUser(){if(this._user)return this._user;const ie=this.getSession();return this._user=ie&&ie.user}getCore(){return this._core||(this._core=this.web_munch.getModule("core")),this._core}};B(Pe,"Twilight");let O=Pe;const J="_calculateChangedBits";O.KNOWN_MODULES={simplebar:ne=>ne.globalObserver&&ne.initDOMLoadedElements,react:ne=>ne.Component&&ne.createElement,"react-dom":ne=>ne.createRoot&&ne.createPortal,core:ne=>{if(ne.x2?.experiments&&ne.x2.intl)return ne.x2;if(ne.$6?.experiments)return ne.$6;if(ne.p?.experiments)return ne.p;if(ne.o?.experiments)return ne.o;if(ne.q?.experiments)return ne.q},cookie:ne=>ne&&ne.set&&ne.get&&ne.getJSON&&ne.withConverter,"extension-service":ne=>ne.extensionService,"callout-types":ne=>{if(ne.o?.ClipLiveNudge&&ne.o?.Drop&&ne.o?.ShareResub)return ne.o},"chat-types":ne=>{if((0,L.has)(ne.ZW,"Message")&&(0,L.has)(ne.ZW,"RoomMods"))return{automod:ne.sq,chat:ne.ZW,message:ne.IF,mod:ne.RB};if((0,L.has)(ne.b,"Message")&&(0,L.has)(ne.b,"RoomMods"))return{automod:ne.a,chat:ne.b,message:ne.c,mod:ne.e};if((0,L.has)(ne.SJ,"Message")&&(0,L.has)(ne.SJ,"RoomMods"))return{automod:ne.mT,chat:ne.SJ,message:ne.Ay,mod:ne.Aw}},"gql-printer":ne=>{if(ne!==window){if(ne.print&&ne.print.toString().includes(".visit"))return ne.print;if(ne.S&&ne.S.toString().includes(".visit"))return ne.S}},"user-report":ne=>ne.Z?.displayName==="Loadable(ReportUserModal)"&&ne.Z,"sub-form":ne=>typeof ne.T=="function"&&String(ne.T).includes("CheckoutModal")&&ne.T,mousetrap:ne=>ne.bindGlobal&&ne.unbind&&ne.handleKey,"algolia-search":ne=>{if(ne.a?.prototype?.queryTopResults&&ne.a.prototype.queryForType)return ne.a;if(ne.w9?.prototype?.queryTopResults&&ne.w9.prototype.queryForType)return ne.w9},calloutstack:ne=>{if((0,L.has)(ne.at?._currentValue,"callouts")&&typeof ne.at._currentValue.pinCallout=="function")return{stack:ne.at}},highlightstack:ne=>{if((0,L.has)(ne.g$?._currentValue,"highlights")&&typeof ne.SP?._currentValue=="function")return{stack:ne.g$,dispatch:ne.SP};if((0,L.has)(ne.b,J)&&(0,L.has)(ne.c,J))return{stack:ne.b,dispatch:ne.c};if((0,L.has)(ne.fQ,J)&&(0,L.has)(ne.vJ,J))return{stack:ne.fQ,dispatch:ne.vJ};if((0,L.has)(ne.fQ?._currentValue,"highlights")&&typeof ne.vJ?._currentValue=="function")return{stack:ne.fQ,dispatch:ne.vJ}}};const G=B(ne=>!ne||ne.includes("vendor")||ne.includes("core"),"VEND_CORE");O.KNOWN_MODULES.core.use_result=!0,O.KNOWN_MODULES.core.skip_cache=!0,O.KNOWN_MODULES.simplebar.chunks=G,O.KNOWN_MODULES.react.chunks=G,O.KNOWN_MODULES.cookie.chunks=G,O.KNOWN_MODULES["gql-printer"].use_result=!0,O.KNOWN_MODULES["gql-printer"].chunks=G,O.KNOWN_MODULES.mousetrap.chunks=G;const V=B(ne=>!ne||ne.includes("chat"),"CHAT_CHUNK");O.KNOWN_MODULES["callout-types"].use_result=!0,O.KNOWN_MODULES["chat-types"].use_result=!0,O.KNOWN_MODULES["chat-types"].chunks=V,O.KNOWN_MODULES.calloutstack.use_result=!0,O.KNOWN_MODULES.highlightstack.use_result=!0,O.KNOWN_MODULES.highlightstack.chunks=V,O.KNOWN_MODULES["algolia-search"].use_result=!0,O.KNOWN_MODULES["algolia-search"].chunks="core",O.KNOWN_MODULES["user-report"].use_result=!0,O.KNOWN_MODULES["user-report"].chunks=ne=>!ne||ne.includes("core")||ne.includes("common"),O.KNOWN_MODULES["sub-form"].use_result=!0,O.KNOWN_MODULES["sub-form"].chunks="core",O.POPOUT_ROUTES=["embed-chat","popout","dash-popout-chat","mod-popout-chat"],O.CHAT_ROUTES=["collection","popout","dash-chat","video","user-video","user-home","user-clip","user-videos","user-clips","user-events","user-followers","user-following","user","dash","embed-chat","squad","command-center","dash-stream-manager","dash-popout-chat","mod-view","mod-popout-chat"],O.ROUTE_NAMES={dir:"Browse","dir-following":"Following","dir-all":"Browse Live Channels",dash:"Dashboard",popout:"Popout Chat","dash-popout-chat":"Dashboard Popout Chat","user-video":"Channel Video","popout-player":"Popout/Embed Player"},O.SUNLIGHT_ROUTES=["dash-stream-manager","dash-channel-analytics","dash-stream-summary","dash-achievements","dash-roles","dash-activity","dash-channel-points","dash-video-producer","dash-edit-video","dash-collections","dash-edit-collection","dash-clips","dash-settings-moderation","dash-settings-channel","dash-settings-revenue","dash-extensions","dash-streaming-tools"],O.PLAYER_ROUTES={"popout-player":"/"},O.CLIP_ROUTES={"clip-page":"/:slug"},O.DASH_ROUTES={"dash-stream-manager":"/u/:userName/stream-manager","dash-channel-analytics":"/u/:userName/channel-analytics","dash-stream-summary":"/u/:userName/stream-summary","dash-achievements":"/u/:userName/achievements","dash-roles":"/u/:userName/community/roles","dash-activity":"/u/:userName/community/activity","dash-channel-points":"/u/:userName/community/channel-points","dash-video-producer":"/u/:userName/content/video-producer","dash-edit-video":"/u/:userName/content/video-producer/edit/:videoID","dash-collections":"/u/:userName/content/collections","dash-edit-collection":"/u/:userName/content/collections/:collectionID","dash-clips":"/u/:userName/content/clips","dash-settings-moderation":"/u/:userName/settings/moderation","dash-settings-channel":"/u/:userName/settings/channel","dash-settings-revenue":"/u/:userName/settings/revenue","dash-extensions":"/u/:userName/extensions","dash-streaming-tools":"/u/:userName/broadcast","dash-popout-chat":"/popout/u/:userName/stream-manager/chat"},O.ROUTES={"front-page":"/",collection:"/directory/collection/:collectionID",dir:"/directory","dir-gaming":"/directory/gaming","dir-irl":"/directory/irl","dir-music":"/directory/music","dir-creative":"/directory/creative","dir-esports":"/directory/esports","dir-following":"/directory/following/:category?","dir-game-index":"/directory/category/:gameName","dir-game-clips":"/directory/category/:gameName/clips","dir-game-videos":"/directory/category/:gameName/videos/:filter","dir-all":"/directory/all/:filter?",dash:"/:userName/dashboard/:live?",event:"/event/:eventName",popout:"/popout/:userName/chat",video:"/videos/:videoID","user-video":"/:userName/video/:videoID","user-videos":"/:userName/videos/:filter?","user-clips":"/:userName/clips","user-clip":"/:userName/clip/:clipID","user-collections":"/:userName/collections","user-events":"/:userName/events","user-followers":"/:userName/followers","user-following":"/:userName/following",product:"/products/:productName",prime:"/prime",turbo:"/turbo",search:"/search",squad:"/:userName/squad","command-center":"/:userName/commandcenter","embed-chat":"/embed/:userName/chat","mod-view":"/moderator/:userName","mod-popout-chat":"/popout/moderator/:userName/chat","drops-inventory":"/drops/inventory","drops-campaigns":"/drops/campaigns"},O.DIALOG_EXCLUSIVE=".moderation-root,.sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root,#root",O.DIALOG_MAXIMIZED='.moderation-view-page > div[data-highlight-selector="main-grid"],.sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area,.teams-page-body__outer-container .scrollable-area',O.DIALOG_SELECTOR=".moderation-root,.sunlight-root,#root,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area"},24531:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>P});var K=S(22527);const L=class L extends K.default{constructor(...W){super(...W),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.settings.add("layout.display-bits-button",{requires:["chat.bits.show"],default:null,process(x,m){return m??x.get("chat.bits.show")},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the Get Bits button.",description:"By default, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering)",component:"setting-check-box"},changed:()=>this.BitsButton.forceUpdate()}),this.BitsButton=this.fine.define("bits-button",x=>x.toggleBalloon&&x.toggleShowTutorial)}onEnable(){this.BitsButton.ready(W=>{const x=this,m=W.prototype.render;W.prototype.render=function(){return x.settings.get("layout.display-bits-button")?m.call(this):null},this.BitsButton.forceUpdate()})}};B(L,"BitsButton");let P=L},11746:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>I});var K=S(46949),P=S(22527);const L=["chat-input"],W=class W extends P.default{constructor(...m){super(...m),this.inject("settings"),this.should_enable=!0}onEnable(){this.on("core:dom-update",this.handleDomUpdate,this),this.hookSettings()}awaitSettings(m=0){return window.BetterTTV?.settings?window.BetterTTV.settings:m>100?Promise.reject():(0,K.sleep)(50).then(()=>this.awaitSettings(m+1))}async hookSettings(){const m=await this.awaitSettings(),b=B(()=>this.updateContext(m),"waiter");if(m.on("changed.clickTwitchEmotes",b),m.on("changed.bttvGIFEmotes",b),b(),m.get("ffzEmotes")){if(this.settings.provider.get("bttv-ffz-notice"))return;const c=this.resolve("site.menu_button");c&&(c.addToast({icon:"ffz-i-zreknarf",text_i18n:"compat.bttv.emotes-on",text:`You have "FrankerFaceZ Emotes" turned on in BetterTTV's settings, but you also have FrankerFaceZ installed. Please disable "FrankerFaceZ Emotes" in BetterTTV's settings. It isn't necessary.`}),this.settings.provider.set("bttv-ffz-notice",!0))}}updateContext(m){this.settings.updateContext({bttv:{loaded:!0,emote_menu:m.get("clickTwitchEmotes"),gifs:m.get("bttvGIFEmotes")}})}handleDomUpdate(m){if(window.BetterTTV?.watcher?.emitLoad&&L.includes(m)){this.log.info("Sending chat reload event to BetterTTV.");try{window.BetterTTV.watcher.emitLoad("chat")}catch(b){this.log.error("An error occurred with BetterTTV:",b)}}}};B(W,"BTTVCompat");let I=W},74756:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>x});var K=S(22527),P=S(14873),L=S(46949),I=S(44589);const W=["user","user-home","user-about","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],m=class m extends K.default{constructor(...c){super(...c),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.inject("site.subpump"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.settings.add("channel.auto-click-off-featured",{default:!1,ui:{path:"Channel > Behavior >> General",title:`Automatically un-check "Featured Clips Only" when viewing a channel's clips.`,component:"setting-check-box"}}),this.settings.add("channel.panel-tips",{default:!1,ui:{path:"Channel > Behavior >> Panels",title:"Display rich tool-tips for links in channel panels.",component:"setting-check-box"},changed:d=>{this.updatePanelTips(),this.css_tweaks.toggle("panel-links",d)}}),this.settings.add("channel.auto-skip-trailer",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically skip channel trailers.",component:"setting-check-box"},changed:d=>{d&&this.ChannelTrailer.each(f=>this.maybeSkipTrailer(f))}}),this.settings.add("channel.auto-click-chat",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically open chat when opening an offline channel page.",component:"setting-check-box"}}),this.settings.add("channel.extra-links",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Add extra links to live channel pages, next to the streamer's name.",component:"setting-check-box"},changed:()=>this.updateLinks()}),this.ChannelPanels=this.fine.define("channel-panels",d=>d.layoutMasonry&&d.updatePanelOrder&&d.onExtensionPoppedOut,W),this.ChannelTrailer=this.elemental.define("channel-trailer",".channel-trailer-player__wrapper",W,{attributes:!0},1),this.ChannelRoot=this.elemental.define("channel-root",".channel-root",W,{attributes:!0},1),this.InfoBar=this.elemental.define("channel-info-bar","#live-channel-stream-information",W,{childNodes:!0,subtree:!0},1)}onEnable(){this.updateChannelColor(),this.css_tweaks.toggle("panel-links",this.settings.get("channel.panel-tips")),this.on("i18n:update",this.updateLinks,this),this.ChannelTrailer.on("mount",this.maybeSkipTrailer,this),this.ChannelTrailer.on("update",this.maybeSkipTrailer,this),this.ChannelTrailer.each(c=>this.maybeSkipTrailer(c)),this.ChannelPanels.on("mount",this.updatePanelTips,this),this.ChannelPanels.on("update",this.updatePanelTips,this),this.ChannelPanels.on("unmount",this.removePanelTips,this),this.ChannelPanels.ready((c,d)=>{for(const f of d)this.updatePanelTips(f)}),this.ChannelRoot.on("mount",this.updateRoot,this),this.ChannelRoot.on("mutate",this.updateRoot,this),this.ChannelRoot.on("unmount",this.removeRoot,this),this.ChannelRoot.each(c=>this.updateRoot(c)),this.InfoBar.on("mount",this.updateBar,this),this.InfoBar.on("mutate",this.updateBar,this),this.InfoBar.on("unmount",this.removeBar,this),this.InfoBar.each(c=>this.updateBar(c)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}maybeSkipTrailer(c){if(!this.settings.get("channel.auto-skip-trailer"))return;const d=this.fine.searchParent(c,f=>f.props&&f.props.onDismiss);d&&(this.log.info("Automatically skipping channel trailer."),d.props.onDismiss())}updatePanelTips(c){if(!c){for(const f of this.ChannelPanels.instances)f&&this.updatePanelTips(f);return}const d=this.fine.getChildNode(c);if(!d||!this.settings.get("channel.panel-tips"))return this.removePanelTips(c);if(c._ffz_tips&&c._ffz_tip_el!==d&&this.removePanelTips(c),!c._ffz_tips){const f=this.resolve("tooltips");f&&(c._ffz_tips=f._createInstance(d,"tw-link","link",f.getRoot()),c._ffz_tip_el=d)}}removePanelTips(c){c?._ffz_tips&&(c._ffz_tips.destroy(),c._ffz_tips=null,c._ffz_tip_el=null)}checkFeaturedClips(){this.router.current_name!=="user-clips"&&this.router.current_name!=="user-videos"||this._featured_waiting||!this.settings.get("channel.auto-click-off-featured")||(this._featured_waiting=this.parent.awaitElement("input#featured-clips-toggle").then(c=>{c.checked&&c.click(),this._featured_waiting=!1}).catch(()=>{this._featured_waiting=!1}))}checkNavigation(){this.checkFeaturedClips(),!(!this.settings.get("channel.auto-click-chat")||this.router.current_name!=="user-home")&&this.router.old_location!==this.router.location&&this.router.replace(this.router.location,{channelView:"Watch"})}updateLinks(){for(const c of this.InfoBar.instances)c._ffz_link_login=null,this.updateBar(c)}updateSubscription(c,d){this._subbed_login===d&&this._subbed_id===c||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),c&&(this.pubsub.subscribe(this,`twitch/${c}`),this._subbed_id=c),d&&(this.socket.subscribe(this,`channel.${d}`),this._subbed_login=d))}updateBar(c){c._ffz_update||(c._ffz_update=(0,L.debounce)(()=>requestAnimationFrame(()=>this._updateBar(c)),1e3,2)),c._ffz_update()}_updateBar(c){c._ffz_cont&&!document.contains(c._ffz_cont)&&(c._ffz_cont.classList.remove("ffz--meta-tray"),c._ffz_cont=null);const d=this.settings.get("channel.extra-links");c._ffz_links&&(!document.contains(c._ffz_links)||!d)&&(c._ffz_links.remove(),c._ffz_links=null,c._ffz_link_login=null);let f=c.querySelector(".ffz--native-viewers-container");if(!f){let y=0,a=c.querySelector('p[data-a-target="animated-channel-viewers-count"]');for(;a&&a!=c&&y<5;){if(a.querySelector("svg")){a.classList.add("ffz--native-viewers-container"),f=a;break}a=a.parentElement,y++}}if(!c._ffz_cont){let y=c.querySelector('.report-button,button[data-test-selector="video-options-button"],button[data-test-selector="clip-options-button"],button[data-a-target="report-button-more-button"]');!y&&f&&(y=f.parentElement);let a=y&&(y.closest(".tw-flex-wrap.tw-justify-content-end")||y.closest(".tw-justify-content-end"));!a&&y&&(a=y.parentElement?.parentElement,a&&a.parentElement?.childElementCount===2&&y.dataset.aTarget!=="report-button-more-button"&&(a=a.parentElement.firstElementChild)),a&&c.contains(a)?(c._ffz_cont=a,a.classList.add("ffz--meta-tray")):c._ffz_cont=null}if(!c._ffz_links&&d){const y=c.querySelector("a .tw-title"),a=y&&y.closest("a"),v=a&&a.closest("div");v&&c.contains(v)&&(c._ffz_links=(0,I.createElement)("div",{class:"ffz--links tw-mg-l-1"}),v.appendChild(c._ffz_links))}const r=this.fine.getReactInstance(c);let g=r?.child?.memoizedProps;g?.channelLogin||(g=g?.children?.props);const u=g?.watchPartyProps?.isShowingWatchPartyInMain;if(this.settings.updateContext({isWatchParty:u}),!c._ffz_cont||!g?.channelID){this.updateSubscription(null,null);return}if(c._ffz_links&&g.channelLogin!==c._ffz_link_login){const y=c._ffz_link_login=g.channelLogin;if(y){const a=B((v,F)=>{const A=(0,I.createElement)("a",{href:v,class:"tw-c-text-alt-2 tw-interactive tw-pd-x-1 tw-font-size-5"},F);return A.addEventListener("click",D=>{D.ctrlKey||D.shiftKey||D.altKey||(D.preventDefault(),this.router.push(v))}),A},"make_link");c._ffz_links.closest(".home-header-sticky")?c._ffz_links.innerHTML="":(0,I.setChildren)(c._ffz_links,[a(`/${y}/schedule`,this.i18n.t("channel.links.schedule","Schedule")),a(`/${y}/videos`,this.i18n.t("channel.links.videos","Videos")),a(`/${y}/clips`,this.i18n.t("channel.links.clips","Clips"))])}else c._ffz_links.innerHTML=""}let w=null;this.fine.searchNode(r,y=>{let a=y?.memoizedState,v=0;for(;a!=null&&w==null&&v<50;)w=a?.memoizedState?.current?.result?.data?.user??a?.memoizedState?.current?.previousData?.user,w?.lastBroadcast?.game||(w=null),w||(a=a?.next),v++;return w!=null});const z=w?.lastBroadcast?.game,C=w?.lastBroadcast?.title;(z?.id!==c._ffz_game_cache||C!==c._ffz_title_cache)&&this.settings.updateContext({category:z?.displayName,categoryID:z?.id,title:C}),this.updateSubscription(g.channelID,g.channelLogin),this.updateMetadata(c),this.emit(":update-bar",c,g,w)}removeBar(c){if(this.updateSubscription(null,null),c._ffz_cont&&c._ffz_cont.classList.remove("ffz--meta-tray"),c._ffz_cont=null,c._ffz_meta_timers){for(const d of Object.values(c._ffz_meta_timers))clearTimeout(d);c._ffz_meta_timers=null}c._ffz_update=null}updateMetadata(c,d){const f=c._ffz_cont;let g=this.fine.getReactInstance(c)?.memoizedProps?.children?.props;if(g&&!g.channelID&&(g=g.children?.props),!f||!document.contains(f)||!g||!g.channelID)return;d?Array.isArray(d)||(d=[d]):d=this.metadata.keys;const u=c._ffz_meta_timers=c._ffz_meta_timers||{},w=B(C=>this.updateMetadata(c,C),"refresh_fn"),z={channel:{id:g.channelID,login:g.channelLogin,display_name:g.displayName,live:g.isLive&&!g.videoID&&!g.clipSlug,video:!!(g.videoID||g.clipSlug),live_since:g.liveSince},props:g,el:c,getViewerCount:()=>{const C=f.querySelector('p[data-a-target="animated-channel-viewers-count"]'),y=C&&this.fine.getReactInstance(C),a=y?.memoizedProps?.children;if(typeof a=="string"&&/^[0-9,.]+$/.test(a))try{const F=parseInt(a.replace(/[\.,]+/,""),10);if(!isNaN(F)&&isFinite(F)&&F>0)return F}catch{}const v=a?.props;return v&&v.value!=null?v.value:0},getUserSelfImmediate:C=>{const y=this.getUserSelf(c,g.channelID,!0);return y&&y.then?(y.then(C),null):y},getUserSelf:()=>this.getUserSelf(c,g.channelID),getBroadcastID:()=>this.getBroadcastID(c,g.channelID)};for(const C of d)this.metadata.renderLegacy(C,z,f,u,w)}updateRoot(c){const d=this.fine.getReactInstance(c);let f=null,r=d,g=0,u=0;for(;r!=null&&f==null&&g<10;){let w=r?.memoizedState;for(u=0;w!=null&&f==null&&u<50;)f=w?.memoizedState?.current?.result?.data?.userOrError??w?.memoizedState?.current?.previousData?.userOrError,f||(w=w?.next),u++;r=r?.return,g++}f&&f.id?(this.updateChannelColor(f.primaryColorHex),this.settings.updateContext({channel:f.login,channelID:f.id,channelColor:f.primaryColorHex})):this.removeRoot()}removeRoot(){this.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateChannelColor(c){let d=c&&P.Color.RGBA.fromHex(c);d||(d=P.Color.RGBA.fromHex("9147FF")),d?(this.css_tweaks.setVariable("channel-color",d.toCSS()),this.css_tweaks.setVariable("channel-color-20",d._a(.2).toCSS()),this.css_tweaks.setVariable("channel-color-30",d._a(.3).toCSS())):(this.css_tweaks.deleteVariable("channel-color"),this.css_tweaks.deleteVariable("channel-color-20"),this.css_tweaks.deleteVariable("channel-color-30"))}getUserSelf(c,d,f){const r=c._ffz_self_cache=c._ffz_self_cache||{};return d===r.channel_id&&Date.now()-r.saved<6e4?f?r.data:Promise.resolve(r.data):new Promise(async(g,u)=>{if(r.updating){r.updating.push([g,u]);return}r.channel_id=d,r.updating=[[g,u]];let w,z;try{w=await this.twitch_data.getUserSelf(d)}catch(y){w=null,z=y}const C=r.updating;if(r.updating=null,r.channel_id!==d){z=new Error("Outdated"),r.channel_id=null,r.data=null,r.saved=0;for(const y of C)y[1](z);return}r.data=w,r.saved=Date.now();for(const y of C)z?y[1](z):y[0](w)})}getBroadcastID(c,d){const f=c._ffz_bcast_cache=c._ffz_bcast_cache||{};return d===f.channel_id&&Date.now()-f.saved<6e4?Promise.resolve(f.broadcast_id):new Promise(async(r,g)=>{if(f.updating){f.updating.push([r,g]);return}f.channel_id=d,f.updating=[[r,g]];let u,w;try{u=await this.twitch_data.getBroadcastID(d)}catch(C){u=null,w=C}const z=f.updating;if(f.updating=null,f.channel_id!==d){w=new Error("Outdated"),f.channel_id=null,f.broadcast_id=null,f.saved=0;for(const C of z)C[1](w);return}f.broadcast_id=u,f.saved=Date.now();for(const C of z)w?C[1](w):C[0](u)})}};B(m,"Channel");let x=m},6172:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>ye,formatBitsConfig:()=>ue});var K=S(14873),P=S(46949),L=S(24431),I=S(83342),W=S(6170),x=S(22527),m=S(43874);const b=["touchmove","scroll","wheel","mousewheel","DOMMouseScroll"];let c=0;const xe=class xe extends x.default{constructor(...l){super(...l),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject("site.web_munch"),this.ChatScroller=this.fine.define("chat-scroller",p=>p.saveScrollRef&&p.handleScrollEvent&&!p.renderLines&&p.resume,m.Z.CHAT_ROUTES),this.settings.add("chat.scroller.freeze",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Pause Chat Scrolling",description:`Automatically stop chat from scrolling when moving the mouse over it or holding a key.

**Note:** Scrolling up in chat will always prevent automatic scrolling, regardless of this setting.`,component:"setting-select-box",data:[{value:0,title:"Use Twitch Setting"},{value:1,title:"On Hover"},{value:2,title:"When Ctrl is Held"},{value:3,title:"When Meta is Held"},{value:4,title:"When Alt is Held"},{value:5,title:"When Shift is Held"},{value:6,title:"Ctrl or Hover"},{value:7,title:"Meta or Hover"},{value:8,title:"Alt or Hover"},{value:9,title:"Shift or Hover"}]}}),this.settings.add("chat.scroller.freeze-requires-hover",{default:!0,ui:{path:"Chat > Behavior >> Scrolling",title:"Require the mouse to be over chat to freeze with a hotkey.",component:"setting-check-box"}}),this.settings.add("chat.scroller.hover-delay",{default:750,ui:{path:"Chat > Behavior >> Scrolling",title:"Hover Timeout",description:"Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.",component:"setting-combo-box",data:[{value:250,title:"0.25 Seconds"},{value:500,title:"0.50 Seconds"},{value:750,title:"0.75 Seconds"},{value:1e3,title:"1 Second"},{value:2500,title:"2.5 Seconds"},{value:5e3,title:"5 Seconds"}]}}),this.settings.add("chat.scroller.smooth-scroll",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Smooth Scrolling",description:`**Note:** This may not behave well depending on your browser. Disable this if you encounter issues.

Smoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.`,component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Slow"},{value:2,title:"Medium"},{value:3,title:"Fast"},{value:4,title:"Very Fast"}]}})}updateUseKeys(){const l=this.use_keys;this.use_keys=!1;for(const p of this.chat.context.get("chat.actions.inline"))if(p&&p.display&&p.display.keys){this.use_keys=!0;break}for(const p of this.chat.context.get("chat.actions.hover"))if(p&&p.display&&p.display.keys){this.use_keys=!0;break}if(this.use_keys!==l)for(const p of this.ChatScroller.instances)p&&p.ffzUpdateKeys&&p.ffzUpdateKeys()}async onEnable(){this.on("i18n:update",()=>this.ChatScroller.forceUpdate()),this.chat.context.on("changed:chat.actions.inline",this.updateUseKeys,this),this.updateUseKeys(),this.pause_hover=this.chat.context.get("chat.scroller.freeze-requires-hover"),this.chat.context.on("changed:chat.scroller.freeze-requires-hover",M=>{this.pause_hover=M;for(const Z of this.ChatScroller.instances)Z.ffzMaybeUnpause()}),this.pause_delay=this.chat.context.get("chat.scroller.hover-delay"),this.chat.context.on("changed:chat.scroller.hover-delay",M=>{this.pause_delay=M;for(const Z of this.ChatScroller.instances)Z.ffzMaybeUnpause()}),this.pause=this.chat.context.get("chat.scroller.freeze"),this.chat.context.on("changed:chat.scroller.freeze",M=>{this.pause=M;for(const Z of this.ChatScroller.instances)Z.ffzMaybeUnpause()}),this.smooth_scroll=this.chat.context.get("chat.scroller.smooth-scroll"),this.chat.context.on("changed:chat.scroller.smooth-scroll",M=>{this.smooth_scroll=M;for(const Z of this.ChatScroller.instances)Z.ffzSetSmoothScroll(M)});const l=this,p=await this.site.findReact(),$=p?.createElement;if(!$)return l.log.warn("Unable to get React.");this.ChatScroller.ready((M,Z)=>{const H=M.prototype.componentDidCatch,j=M.prototype.render;M.prototype.componentDidCatch=function(U,ee){const he=this.state.ffz_errors||0;if(he<100&&(this.setState({ffz_errors:he+1,ffz_total_errors:(this.state.ffz_total_errors||0)+1}),l.log.capture(U,{extra:ee}),l.log.info("Error within Chat",U,ee,he)),H)return H.call(this,U,ee)},M.prototype.ffzZeroErrors=function(){this.setState({ffz_errors:0})},M.prototype.render=function(){if(this.state.ffz_errors>0){let U;const ee=this.state.ffz_total_errors<10,he=B(()=>{clearTimeout(U),this.ffzZeroErrors()},"handler");return ee&&(U=setTimeout(he,250)),$?$("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},[$("div",{className:"tw-mg-b-1"},"There was an error displaying chat."),!ee&&$("button",{className:"tw-button",onClick:he},$("span",{className:"tw-button__text"},"Try Again"))]):null}else{const U=j.call(this);try{const ee=U?.props?.children?.props?.children;ee?.[2]?.type?.displayName==="ChatPausedFooter"&&(ee[2]=this.ffzRenderFooter())}catch{}return U}},M.prototype.ffzInstallCleaner=function(){this._ffz_cleaner||(this._ffz_cleaner=this.ffzOnClean.bind(this),this._ffz_clean_timer=setInterval(this._ffz_cleaner,6e4))},M.prototype.ffzOnClean=function(){const U=l.fine.getChildNode(this);if(!U)return this.ffzRemoveCleaner();requestAnimationFrame(()=>l.cleanMessages(U.querySelector(".chat-scrollable-area__message-container")))},M.prototype.ffzRemoveCleaner=function(){this._ffz_clean_timer&&clearInterval(this._ffz_clean_timer),this._ffz_clean_timer=this._ffz_cleaner=null},M.prototype.ffzInstallHandler=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const U=this;U.ffz_oldScrollEvent=U.handleScrollEvent,U.ffz_oldScroll=U.scrollToBottom,U.ffz_acting=!1,U.ffz_outside=!0,U._ffz_accessor=`_ffz_contains_${c++}`,l.on("tooltips:hover",this.ffzTooltipHover,this),l.on("tooltips:leave",this.ffzTooltipLeave,this),U.scrollToBottom=function(){U._ffz_scroll_request||(U._ffz_scroll_request=requestAnimationFrame(U._scrollToBottom))},U._scrollToBottom=function(){U._ffz_scroll_request=null,U.state.isPaused||(U.ffz_smooth_scroll&&!U._ffz_one_fast_scroll?U.ffzSmoothScroll():(U._ffz_one_fast_scroll=!1,U.ffz_oldScroll()))},U.handleScrollEvent=function(Me){if(!U.scrollRef?.scrollContent||!(Me.which>0||Me.type==="mousewheel"||Me.type==="wheel"||Me.type==="touchmove"))return;const X=U.scrollRef.scrollContent,_e=X.scrollHeight-X.scrollTop-X.offsetHeight,se=_e>10;se!==U.state.ffz_scrolled_up&&U.setState({ffz_scrolled_up:se}),U.state.isPaused&&se&&U.setLoadMoreEnabled(!0),U.state.isPaused&&!se?U.ffzMaybeUnpause():!U.state.isPaused&&se&&U.pause()};const ee=U.resume;U.ffzFastResume=function(){U._ffz_one_fast_scroll=!0,U.resume()},U.resume=function(){U.setState({ffz_scrolled_up:!1}),ee.call(this)};const he=l.web_munch.getModule("mousetrap")||window.Mousetrap;he!=null&&(he.unbind("alt","keydown"),he.unbind("alt","keyup")),U.ffzHandleKey=U.ffzHandleKey.bind(U),window.addEventListener("keydown",U.ffzHandleKey),window.addEventListener("keyup",U.ffzHandleKey),U.hoverPause=U.ffzMouseMove.bind(U),U.hoverResume=U.ffzMouseLeave.bind(U);const Se=l.fine.getChildNode(U);Se&&Se.addEventListener("mousemove",U.hoverPause);const De=this.scrollRef?.scrollContent;if(De)for(const Me of b)De.removeEventListener(Me,U.ffz_oldScrollEvent),De.addEventListener(Me,U.handleScrollEvent);U.forceUpdate(),l.emit("site:dom-update","chat-scroller",U)},M.prototype.ffzSmoothScroll=function(){this._ffz_smooth_animation&&cancelAnimationFrame(this._ffz_smooth_animation),this.ffz_is_smooth_scrolling=!0;let U=this.ffz_smooth_scroll,ee=performance.now();const he=this.scrollRef?.scrollContent;if(!he)return;const Se=he.scrollHeight-he.clientHeight,De=Se-he.scrollTop;De>he.clientHeight?U=De:De>200&&(U+=U*Math.floor(De/200));const Me=B(()=>{if(this.state.isPaused)return this.ffz_is_smooth_scrolling=!1;const X=performance.now(),_e=X-ee,se=U*(_e/10);if(se>=1){const Ce=he.scrollTop,Ne=Ce+se,We=he.scrollHeight-he.clientHeight;ee=X,Ne<We?(he.scrollTop=Ce+se,this._ffz_smooth_animation=requestAnimationFrame(Me)):(he.scrollTop=We,this.ffz_is_smooth_scrolling=!1)}else this._ffz_smooth_animation=requestAnimationFrame(Me)},"smoothAnimation");Me()},M.prototype.ffzSetSmoothScroll=function(U){this.ffz_smooth_scroll=U,this.ffzMaybeUnpause()},M.prototype.ffzReadKeysFromEvent=function(U){return U.altKey===this.ffz_alt&&U.shiftKey===this.ffz_shift&&U.ctrlKey===this.ffz_ctrl&&U.metaKey===this.ffz_meta?!1:(this.ffz_alt=U.altKey,this.ffz_shift=U.shiftKey,this.ffz_ctrl=U.ctrlKey,this.ffz_meta=U.metaKey,!0)},M.prototype.ffzHandleKey=function(U){if(!this.ffzReadKeysFromEvent(U)||(this.ffzUpdateKeyTags(),l.pause_hover&&this.ffz_outside||this.ffzGetMode()<2))return;const ee=this.ffzShouldBePaused();ee!==this.state.isPaused&&(ee?(this.pause(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},M.prototype.ffzInstallHoverTimer=function(){this._ffz_hover_timer||(this._ffz_hover_timer=setInterval(()=>{this.state.isPaused&&this.ffzShouldBePaused()||this.ffzMaybeUnpause()},50))},M.prototype.ffzMouseMove=function(U){this.ffz_last_move=Date.now();const ee=this.ffz_outside;this.ffz_outside=!1,this._ffz_outside_timer&&(clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=null);const he=this.ffzReadKeysFromEvent(U);if(!he&&U.screenX===this.ffz_sx&&U.screenY===this.ffz_sy){ee&&this.ffzUpdateKeyTags();return}this.ffz_sx=U.screenX,this.ffz_sy=U.screenY,(he||ee)&&this.ffzUpdateKeyTags();const Se=this.ffzShouldBePaused();Se!==this.state.isPaused&&(Se?(this.pause(),this.ffzInstallHoverTimer(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},M.prototype.ffzMouseLeave=function(){this.ffz_outside=!0,this._ffz_outside_timer&&clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=setTimeout(()=>this.ffzMaybeUnpause(),64),this.ffzUpdateKeyTags()},M.prototype.ffzTooltipHover=function(U,ee,he){if(U[this._ffz_accessor]==null){const Se=this.scrollRef?.scrollContent;U[this._ffz_accessor]=Se?Se.contains(U):!1}U[this._ffz_accessor]&&this.ffzMouseMove(he)},M.prototype.ffzTooltipLeave=function(U){if(!this.ffz_outside){if(U[this._ffz_accessor]==null){const ee=this.scrollRef?.scrollContent;U[this._ffz_accessor]=ee?ee.contains(U):!1}U[this._ffz_accessor]&&this.ffzMouseLeave()}},M.prototype.ffzUpdateActing=function(){this._ffz_key_frame_acting||(this._ffz_key_frame_acting=requestAnimationFrame(()=>this.ffz_updateActing()))},M.prototype.ffz_updateActing=function(){this._ffz_key_frame_acting=null,this.scrollRef?.root&&(this.scrollRef.root.dataset.acting=this.ffz_acting)},M.prototype.ffzUpdateKeyTags=function(){this._ffz_key_frame||(this._ffz_key_frame=requestAnimationFrame(()=>this.ffz_updateKeyTags()))},M.prototype.ffz_updateKeyTags=function(){if(this._ffz_key_frame=null,!l.use_keys&&this.ffz_use_keys===l.use_keys||!this.scrollRef?.root)return;this.ffz_use_keys=l.use_keys,this.scrollRef.root.classList.toggle("ffz--keys",l.use_keys);const U=this.scrollRef.root.dataset;l.use_keys?(U.alt=!this.ffz_outside&&this.ffz_alt,U.ctrl=!this.ffz_outside&&this.ffz_ctrl,U.shift=!this.ffz_outside&&this.ffz_shift,U.meta=!this.ffz_outside&&this.ffz_meta):(delete U.alt,delete U.ctrl,delete U.shift,delete U.meta)},M.prototype.ffzShouldBePaused=function(U){if(U==null&&(U=Date.now()-(this.ffz_last_move??Date.now())),this.state.ffz_scrolled_up)return!0;const ee=this.ffzGetMode();return(!l.pause_hover||!this.ffz_outside)&&(this.ffz_acting||this.ffz_ctrl&&(ee===2||ee===6)||this.ffz_meta&&(ee===3||ee===7)||this.ffz_alt&&(ee===4||ee===8)||this.ffz_shift&&(ee===5||ee===9)||!this.ffz_outside&&U<l.pause_delay&&(ee===1||ee>5))},M.prototype.ffzGetMode=function(){let U=l.pause;if(U===0&&!this.props.mouseoverPausingDisabled){const ee=this.props.pauseSetting;ee==="MOUSEOVER_ALTKEY"?U=8:ee==="MOUSEOVER"?U=1:ee==="ALTKEY"&&(U=4)}return U},M.prototype.ffzMaybeUnpause=function(){this.state.isPaused&&!this._ffz_unpause_frame&&(this._ffz_unpause_frame=requestAnimationFrame(()=>{this._ffz_unpause_frame=null,this.state.isPaused&&!this.ffzShouldBePaused()&&this.resume()}))},M.prototype.ffzRenderFooter=function(){let U,ee="";if(this.state.ffz_scrolled_up)U=l.i18n.t("chat.messages-below","Chat Paused Due to Scroll");else if(this.state.isPaused){const he=this.ffzGetMode(),Se=this.ffz_acting?l.i18n.t("chat.acting","Taking Action"):he===2?l.i18n.t("key.ctrl","Ctrl Key"):he===3?l.i18n.t("key.meta","Meta Key"):he===4?l.i18n.t("key.alt","Alt Key"):he===5?l.i18n.t("key.shift","Shift Key"):he===6?l.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):he===7?l.i18n.t("key.meta_mouse","Meta or Mouse"):he===8?l.i18n.t("key.alt_mouse","Alt or Mouse"):he===9?l.i18n.t("key.shift_mouse","Shift or Mouse"):l.i18n.t("key.mouse","Mouse Movement");U=l.i18n.t("chat.paused","Chat Paused Due to {reason}",{reason:Se}),ee="ffz--freeze-indicator"}else return $("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${ee}`},null);return $("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${ee}`},$("div",{className:"tw-absolute tw-border-radius-medium tw-bottom-0 tw-c-background-overlay tw-c-text-overlay tw-mg-b-1"},$("button",{className:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--overlay ffz-core-button--text tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","data-a-target":"chat-list-footer",onClick:this.ffzFastResume},$("div",{className:"tw-align-items-center ffz-core-button-label tw-flex tw-flex-grow-0"},$("div",{className:"tw-flex-grow-0"},U)))))};for(const U of Z)this.onMount(U)}),this.ChatScroller.on("mount",this.onMount,this),this.ChatScroller.on("unmount",this.onUnmount,this)}onMount(l){l.ffzSetSmoothScroll(this.smooth_scroll),l.ffzInstallHandler(),l.ffzInstallCleaner()}onUnmount(l){this.off("tooltips:hover",l.ffzTooltipHover,l),this.off("tooltips:leave",l.ffzTooltipLeave,l),l._ffz_hover_timer&&(clearInterval(l._ffz_hover_timer),l._ffz_hover_timer=null),l._ffz_outside_timer&&(clearTimeout(l._ffz_outside_timer),l._ffz_outside_timer=null),l.ffzRemoveCleaner(),window.removeEventListener("keydown",l.ffzHandleKey),window.removeEventListener("keyup",l.ffzHandleKey)}cleanMessages(l){const p=ffz.site.fine.getReactInstance(l);if(!p||!Array.isArray(p.child?.memoizedProps))return;let $=null,M=p.child,Z=0;for(;M&&Z<10;){if(M.stateNode instanceof HTMLDivElement){$=M.stateNode;break}M=M.child,Z++}if(!$||$.parentElement!==l)return;let H=$.previousElementSibling;for(Z=0;H;){const j=H;H=H.previousElementSibling,j.remove(),Z++}Z>0&&this.log.debug(`Removed ${Z} dead chat lines from`,l)}};B(xe,"Scroller");let d=xe;const f="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",Re=class Re extends x.default{constructor(...l){super(...l),this.inject("chat"),this.inject("i18n"),this.inject("site"),this.RichContent=null,this.has_tokenizer=!1}async loadTokenizer(){if(!this.has_tokenizer)return this.tokenizer=await Promise.all([S.e(2009),S.e(208)]).then(S.bind(S,30642)),this.has_tokenizer=!0,this.tokenizer}async onEnable(){var M;const l=this,p=await this.site.findReact();if(!p)return;const $=p.createElement;this.RichContent=(M=class extends p.Component{constructor(H){super(H),this.state={loaded:!1,error:!1,has_tokenizer:l.has_tokenizer},l.has_tokenizer||l.loadTokenizer().then(()=>this.setState({...this.state,has_tokenizer:!0}))}async load(H=!1){this.clearRefresh();try{let j=this.props.getData(H);if(j instanceof Promise){const U=(0,P.has)(this.props,"timeout")?this.props.timeout:1e3;U?j=await(0,P.timeout)(j,U):j=await j}if(j||(j={error:{type:"i18n",key:"card.empty",phrase:"No data was returned."}}),j.error&&(j={short:{type:"header",image:{type:"image",url:f},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:j.error}}),j.refresh)try{this.clearRefresh();const U=new Date(j.refresh).getTime(),ee=U-Date.now();ee>0&&(this._refresh_timer=setTimeout(()=>this.load(!0),ee+100*Math.floor(Math.random()*100)))}catch{}this.setState(Object.assign({loaded:!0,url:this.props.url},j))}catch(j){j.message!=="timeout"&&l.log.capture(j),this.setState({has_tokenizer:l.has_tokenizer,loaded:!0,url:this.props.url,short:{type:"header",image:{type:"image",url:f},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:String(j)}})}}clearRefresh(){this._refresh_timer&&(clearTimeout(this._refresh_timer),this._refresh_timer=null)}checkReload(H){(!H||H&&this.props.url===H)&&this.reload()}reload(H=!1){this.clearRefresh(),this.setState({loaded:!1,error:!1,has_tokenizer:l.has_tokenizer},()=>this.load(H))}componentDidMount(){l.on("chat:update-link-resolver",this.checkReload,this),this.load()}componentWillUnmount(){l.off("chat:update-link-resolver",this.checkReload,this),this.clearRefresh()}renderCard(){return this.props.renderBody?this.props.renderBody(this.state,this,$):[this.renderUnsafe(),this.renderBody()]}renderUnsafe(){if(!this.state.unsafe)return null;const H=Array.from(new Set(this.state.urls.map(j=>j.flags).flat())).join(", ").toLowerCase();return $("div",{class:"ffz--corner-flag ffz--corner-flag__warn ffz-tooltip ffz-tooltip--no-mouse","data-title":l.i18n.t("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:H})},$("figure",{class:"ffz-i-attention"}))}renderBody(){let H;return(this.props.force_full===!0||this.props.force_full!==!1&&this.props.want_full&&this.state.full)&&(H=this.state.full),this.props.force_mid===!0||this.props.force_mid!==!1&&this.props.want_mid&&this.state.mid?H=this.state.mid:H=this.state.short,l.has_tokenizer&&this.state.v&&this.state.v>l.tokenizer.VERSION&&(H=null),l.has_tokenizer&&this.state.loaded&&H?$("div",{class:"ffz-card-rich tw-full-width tw-overflow-hidden tw-flex tw-flex-column"},l.tokenizer.renderTokens(H,$,{vue:!1,tList:(...j)=>l.i18n.tList(...j),i18n:l.i18n,last_player:0,player_state:this.state.player_state,togglePlayer:j=>{const U=this.state.player_state??{};U[j]=!U[j],this.setState({player_state:U})},link_click_handler:l.chat.handleLinkClick,fragments:this.state.fragments,i18n_prefix:this.state.i18n_prefix,allow_media:l.chat.context.get("tooltip.link-images"),allow_unsafe:l.chat.context.get("tooltip.link-nsfw-images")})):this.renderBasic()}renderBasic(){let H,j;return this.state.error?(H=l.i18n.t("card.error","An error occurred."),j=this.state.error):this.state.loaded&&this.state.has_tokenizer?(H=this.state.title,j=this.state.description):j=l.i18n.t("card.loading","Loading..."),!H&&!j&&(j=l.i18n.t("card.empty","No data was returned.")),j=j?j.split(/\n+/).slice(0,2).map(U=>$("div",{class:"tw-c-text-alt-2 tw-ellipsis tw-mg-x-05",title:U},U)):[],[$("div",{class:"ffz--header-image"}),$("div",{class:"ffz--card-text tw-full-width tw-overflow-hidden tw-flex tw-flex-column tw-justify-content-center"},H&&$("div",{class:"chat-card__title tw-ellipsis tw-mg-x-05"},$("span",{class:"tw-strong",title:H},H)),j)]}render(){let H=$("div",{class:"tw-flex tw-flex-nowrap tw-pd-05"},this.renderCard());const j=this.props.card_tooltip&&this.state.full&&!this.props.force_full;return this.state.url&&(H=$("a",{class:`${j?"ffz-tooltip ":""}${this.state.accent?"ffz-accent-card ":""}${this.state.error?"":"ffz-interactable--hover-enabled "}tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--default tw-interactive`,"data-tooltip-type":"link","data-url":this.state.url,"data-is-mail":!1,target:"_blank",rel:"noreferrer noopener",href:this.state.url,onClick:l.chat.handleLinkClick},H)),$("div",{class:`tw-border-radius-medium tw-elevation-1 ffz--chat-card tw-relative${this.state.unsafe?" ffz--unsafe":""}`,style:{"--ffz-color-accent":this.state.accent||null}},$("div",{class:"tw-border-radius-medium tw-c-background-alt tw-flex tw-full-width"},H))}},B(M,"RichContent"),M)}};B(Re,"RichContent");let r=Re;var g=S(83269),u=S(44615);const w={1e3:1,2e3:2,3e3:3},He=class He extends x.default{constructor(...l){super(...l),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject(r),this.inject("experiments"),this.inject("chat.actions"),this.inject("chat.overrides"),this.inject("chat.emotes"),this.line_types={},this.line_types.unknown={renderNotice:(p,$,M,Z,H)=>`Unknown message type: ${p.ffz_type}`},this.line_types.notice={renderNotice:(p,$,M,Z,H)=>{const j=p.ffz_data;let U=this.line_types.notice.renderContent(p,$,M,Z,H);if(!j.icon)return U;if(typeof U=="string"&&(U=H("span",{},U)),typeof j.icon=="function")try{U.ffz_icon=j.icon(j,Z,H)}catch(ee){this.log.capture(ee),this.log.error("Error using custom renderer for notice:",ee)}else j.icon instanceof URL?U.ffz_icon=H("img",{className:"ffz-notice-icon tw-mg-r-05",src:j.icon.toString()}):U.ffz_icon=H("span",{className:`${j.icon} tw-mg-r-05`});return U},renderContent:(p,$,M,Z,H)=>{const j=p.ffz_data;if(j.renderer)try{return j.renderer(j,Z,H)}catch(ee){return this.log.capture(ee),this.log.error("Error using custom renderer for notice:",ee),"Error rendering notice."}const U=j.i18n?this.i18n.t(j.i18n,j.messgae,j):j.message;if(j.markdown)return(0,W.e)()?H("span",{dangerouslySetInnerHTML:{__html:(0,W.e)().renderInline(U)}}):((0,W.Z)().then(()=>Z.forceUpdate()),"Loading...");if(j.tokenize){const ee=j.ffz_tokens=j.ffz_tokens||this.chat.tokenizeMessage({badges:{},message:U,id:p.id,user:p.user,roomLogin:p.roomLogin,roomID:p.roomID});return this.chat.renderTokens(ee,H)}return U}},this.line_types.hype={renderNotice:(p,$,M,Z,H)=>{if(this.chat.context.get("chat.hype.message-style")===0)return null;const U=p.user,ee=p.ffz_tokens=p.ffz_tokens||this.chat.tokenizeMessage(p,$),he=ee.length>0;let Se=p.hype_amount;const De=p.hype_exponent??0;De>0&&(Se/=Math.pow(10,De));try{Se=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:p.hype_currency,compactDisplay:"short",minimumFractionDigits:De,maximumFractionDigits:De}).format(Se)}catch{Se=`${p.hype_currency} ${Se}`}return he?this.i18n.tList("chat.hype-chat","Sent a Hype Chat for {amount}!",{amount:Se}):this.i18n.tList("chat.hype-chat.user","{user} sent a Hype Chat for {amount}!",{amount:Se,user:H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},U.displayName))})}},this.line_types.cheer={renderNotice:(p,$,M,Z,H)=>this.i18n.tList("chat.bits-message","Cheered {count, plural, one {# Bit} other {# Bits}}",{count:p.bits||0})},this.line_types.points={getClass:p=>`ffz--points-line tw-pd-l-1 tw-pd-r-2 ${p.ffz_reward_highlight&&this.chat.context.get("chat.points.allow-highlight")===2?"ffz-custom-color ffz--points-highlight":""}`,renderNotice:(p,$,M,Z,H)=>{if(!p.ffz_reward)return null;const j=p.user,U=(0,u.KC)(p.ffz_reward),ee=p.ffz_tokens=p.ffz_tokens||this.chat.tokenizeMessage(p,$),he=ee.length>0,Se=H("span",{className:"ffz--points-reward"},(0,u.yg)(p.ffz_reward,this.i18n)),De=H("span",{className:"ffz--points-cost"},[H("span",{className:U?"ffz-i-bits":"ffz--points-icon"}),this.i18n.formatNumber((0,u.at)(p.ffz_reward))]);return he?this.i18n.tList("chat.points.redeemed","Redeemed {reward} {cost}",{reward:Se,cost:De}):this.i18n.tList("chat.points.user-redeemed","{user} redeemed {reward} {cost}",{reward:Se,cost:De,user:H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},j.displayName))})}},this.line_types.resub={getClass:()=>"ffz--subscribe-line tw-pd-r-2",renderNotice:(p,$,M,Z,H)=>{const j=p.sub_cumulative||p.sub_months,U=this.chat.context.get("chat.subs.show");let ee;if(U===1&&j>1&&(ee=(p.ffz_tokens=p.ffz_tokens||this.chat.tokenizeMessage(p,$)).length>0),!(U===3||U===1&&ee&&j>1||U===2&&j>1))return null;const he=p.user,Se=p.sub_plan||{},De=w[Se.plan]||1,Me=p.sub_multi,X=(Me?.count??0)>1&&Me.tenure===0,_e=this.i18n.tList(`chat.sub.main${X?"-multi":""}`,`{user} subscribed {plan}${X?" for {multi, plural, one {# month} other {# months}} in advance":""}. `,{user:H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},he.displayName)),plan:Se.prime?this.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):this.i18n.t("chat.sub.plan","at Tier {tier}",{tier:De}),multi:X?Me.count:1});return p.sub_share_streak&&p.sub_streak>1?_e.push(this.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:p.sub_cumulative,streak:p.sub_streak})):j>1&&_e.push(this.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:j})),this.chat.context.get("chat.subs.compact")||(_e.ffz_icon=H("span",{className:`ffz-i-${Se.prime?"crown":"star"} tw-mg-r-05`})),_e}},this.line_types.ritual={getClass:()=>"ffz--ritual-line tw-pd-r-2",renderNotice:(p,$,M,Z,H)=>{const j=p.user;if(p.ritual==="new_chatter")return this.i18n.tList("chat.ritual","{user} is new here. Say hello!",{user:H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},j.displayName))})}},this.line_types.sub_gift={getClass:()=>"ffz--subscribe-line",renderNotice:(p,$,M,Z,H)=>{const j=p.user,U=p.sub_plan||{},ee=p.sub_months||1,he=w[U.plan]||1;let Se;const De={months:ee,user:p.sub_anon||j.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},j.displayName)),plan:U.plan==="custom"?"":this.i18n.t("chat.sub.gift-plan","Tier {tier}",{tier:he}),recipient:H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,"data-user":JSON.stringify(p.sub_recipient)},H("span",{className:"tw-c-text-base tw-strong"},p.sub_recipient.displayName))};return ee<=1?Se=this.i18n.tList("chat.sub.mystery","{user} gifted a {plan} Sub to {recipient}! ",De):Se=this.i18n.tList("chat.sub.gift-months","{user} gifted {months, plural, one {# month} other {# months}} of {plan} Sub to {recipient}!",De),p.sub_total===1?Se.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):p.sub_total>1&&Se.push(this.i18n.t("chat.sub.gift-total","They've gifted {count,number} Subs in the channel!",{count:p.sub_total})),this.chat.context.get("chat.subs.compact")||(Se.ffz_icon=H("span",{className:`ffz-i-${U.prime?"crown":"star"} tw-mg-r-05`})),Se}},this.line_types.sub_mystery={getClass:()=>"ffz--subscribe-line",renderNotice:(p,$,M,Z,H)=>{const j=p.mystery;j&&(j.line=Z);const U=this.i18n.tList("chat.sub.gift","{user} is gifting {count, plural, one {# Tier {tier} Sub} other {# Tier {tier} Subs}} to {channel}'s community! ",{user:p.sub_anon||p.user.username==="ananonymousgifter"?this.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):H("span",{role:"button",className:"chatter-name",onClick:Z.ffz_user_click_handler,onContextMenu:this.actions.handleUserContext},H("span",{className:"tw-c-text-base tw-strong"},p.user.displayName)),count:p.sub_count,tier:w[p.sub_plan]||1,channel:p.roomLogin});p.sub_total===1?U.push(this.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):p.sub_total>1&&U.push(this.i18n.t("chat.sub.gift-total","They've gifted {count} Subs in the channel!",{count:p.sub_total})),Z.ffz_click_expand||(Z.ffz_click_expand=()=>{Z.setState({ffz_expanded:!Z.state.ffz_expanded})});const ee=this.chat.context.get("chat.subs.merge-gifts-visibility")?!Z.state.ffz_expanded:Z.state.ffz_expanded;let he=null;if(ee&&j&&j.recipients&&j.recipients.length>0){const Me=[];for(const X of j.recipients)Me.length&&Me.push(", "),Me.push(H("span",{role:"button",className:"ffz--giftee-name",onClick:Z.ffz_user_click_handler,"data-user":JSON.stringify(X)},H("span",{className:"tw-c-text-base tw-strong"},X.displayName)));he=H("div",{className:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2"},Me)}const Se=[U];j&&Se.push(H("span",{className:`tw-pd-l-05 tw-font-size-4 ffz-i-${ee?"down":"right"}-dir`}));const De=[H("div",{className:"tw-full-width tw-c-text-alt-2",onClick:Z.ffz_click_expand},Se),he];return this.chat.context.get("chat.subs.compact")||(De.ffz_icon=H("span",{className:`ffz-i-star${p.sub_anon?"-empty":""} tw-mg-r-05`})),De.ffz_target=Se,De}},this.ChatLine=this.fine.define("chat-line",p=>p.renderMessageBody&&p.props&&!p.onExtensionNameClick&&!(0,P.has)(p.props,"hasModPermissions"),m.Z.CHAT_ROUTES),this.ExtensionLine=this.fine.define("extension-line",p=>p.renderMessageBody&&p.onExtensionNameClick,m.Z.CHAT_ROUTES),this.WhisperLine=this.fine.define("whisper-line",p=>p.props&&p.props.message&&(0,P.has)(p.props,"reportOutgoingWhisperRendered"))}async onEnable(){this.on("chat.overrides:changed",Z=>this.updateLinesByUser(Z,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this),this.can_reprocess=!0,this.on("chat:reload-data",()=>this.can_reprocess=!0),this.on("chat:room-add",()=>this.can_reprocess=!0),this.on("load_tracker:complete:chat-data",()=>{!this.chat.context.get("chat.update-when-loaded")||!this.can_reprocess||(this.can_reprocess=!1,this.log.info("Reprocessing chat lines due to data loads."),this.updateLines())});for(const Z of L.RERENDER_SETTINGS)this.chat.context.on(`changed:${Z}`,this.rerenderLines,this);for(const Z of L.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${Z}`,this.updateLineTokens,this);for(const Z of L.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${Z}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-messages",(Z,H,j,U)=>{if(Z){for(const ee of this.ChatLine.instances){const he=ee.props.message;he&&U.push({message:he,_instance:ee,update:()=>ee.forceUpdate()})}for(const ee of this.ExtensionLine.instances){const he=ee.props.message;he&&U.push({message:he,_instance:ee,update:()=>ee.forceUpdate()})}}if(H)for(const ee of this.WhisperLine.instances){const he=ee.props.message;he&&he._ffz_message&&U.push({message:he._ffz_message,_instance:ee,update:()=>ee.forceUpdate()})}}),this.on("chat:get-tab-commands",Z=>{this.experiments.getTwitchAssignmentByName("chat_replies")!=="control"&&Z.commands.push({name:"reply",description:"Reply to a user's last message.",permissionLevel:0,ffz_group:"FrankerFaceZ",commandArgs:[{name:"username",isRequired:!0},{name:"message",isRequired:!1}]})}),this.on("chat:pre-send-message",Z=>{if(this.experiments.getTwitchAssignmentByName("chat_replies")==="control")return;const H=Z.message,j=this.parent.chat_types||{};let U,ee;if(/^\/reply ?/i.test(H))U=H.slice(7).trim();else return;Z.preventDefault();const he=U.indexOf(" ");if(he!==-1&&(ee=U.slice(he+1),U=U.slice(0,he)),U.startsWith("@")&&(U=U.slice(1)),U&&U.length){U=U.toLowerCase();const Se=Array.from(this.ChatLine.instances);let De=Se.length;for(;De--;){const Me=Se[De],X=Me?.props?.message,_e=X?.user;if(_e&&(_e.login===U||_e.displayName?.toLowerCase?.()===U)){ee?Z.sendMessage(ee,{reply:{parentDeleted:X.deleted||!1,parentDisplayName:_e.displayName,parentMessageBody:X.message,parentMsgId:X.id,parentUid:_e.id,parentUserLogin:_e.login}}):requestAnimationFrame(()=>Me.ffzOpenReply());return}}}Z.addMessage({type:j.Notice,message:this.i18n.t("chat.reply.bad-user","Invalid user or no known message to reply to.")})});const l=this,p=await this.site.findReact();if(!p)return;const $=p.createElement,M=this.rich_content&&this.rich_content.RichContent;this.WhisperLine.ready(Z=>{const H=Z.prototype.render;Z.prototype.render=function(){if(this._ffz_no_scan=!0,!this.props.message||!this.props.message.content||!this.props.message.from)return H.call(this);try{const j=l.chat.standardizeWhisper(this.props.message),U=j.is_action,ee=U?l.chat.context.get("chat.me-style"):0,he=ee>=2,Se=ee===1||ee===3,De=j.user,Me=l.overrides.getColor(De.id)||De.color,X=l.parent.colors.process(Me),_e=j.ffz_tokens=j.ffz_tokens||l.chat.tokenizeMessage(j,null),se=l.chat.renderTokens(_e,$),Ce=l.overrides.getName(De.id);return $("div",{className:"thread-message__message"},$("div",{className:"tw-pd-x-1 tw-pd-y-05"},[$("span",{className:`thread-message__message--user-name notranslate${Ce?" ffz--name-override":""}`,style:{color:X}},Ce||De.displayName),$("span",null,U?" ":": "),$("span",{className:`message${he?" chat-line__message-body--italicized":""}`,style:{color:Se&&X}},se)]))}catch(j){return l.log.error(j),l.log.capture(j,{extra:{props:this.props}}),H.call(this)}},setTimeout(()=>this.WhisperLine.forceUpdate())}),this.ChatLine.ready(Z=>{const H=Z.prototype.render;Z.prototype.shouldComponentUpdate=function(j,U){const ee=U&&U.alwaysShowMessage||!j.message.deleted,he=this._ffz_show;return this._ffz_show=ee,ee!==he||U&&this.state&&U.ffz_expanded!==this.state.ffz_expanded||j.deletedMessageDisplay!==this.props.deletedMessageDisplay||j.deletedCount!==this.props.deletedCount||j.message!==this.props.message||j.isCurrentUserModerator!==this.props.isCurrentUserModerator||j.showModerationIcons!==this.props.showModerationIcons||j.showTimestamps!==this.props.showTimestamps||j.pinnedMessage?.message?.id===j.message?.id!=(this.props.pinnedMessage?.message?.id===this.props.message?.id)},Z.prototype.ffzOpenReply=function(){if(this.onMessageClick)return this.onMessageClick();if(this.props.reply){this.setOPCardTray(this.props.reply);return}if(this.props.hasReply){const ee=this.props.message;if(ee?.user){this.setOPCardTray({parentMsgId:ee.id,parentUid:ee.user.userID,parentUserLogin:ee.user.userLogin,parentDeleted:ee.deleted,parentDisplayName:ee.user.userDisplayName,parentMessageBody:ee.messageBody});return}}const j=this.renderMessageAuthor;this.renderMessageAuthor=()=>this.ffzReplyAuthor();const U=this.props.message?.ffz_tokens;U&&(this.setMessageTray(this.props.message,l.chat.renderTokens(U,$)),this.renderMessageAuthor=j)},Z.prototype.ffzReplyAuthor=function(){const j=l.chat.standardizeMessage(this.props.message),U=j.user,ee=l.overrides.getColor(U.id)||U.color,he=l.parent.colors.process(ee);let Se=j.roomLogin?j.roomLogin:j.channel?j.channel.slice(1):void 0,De=j.roomId?j.roomId:this.props.channelID;if(!Se&&De){const _e=l.chat.getRoom(De,null,!0);_e&&_e.login&&(Se=j.roomLogin=_e.login)}if(!De&&Se){const _e=l.chat.getRoom(null,De,!0);_e&&_e.id&&(De=j.roomId=_e.id)}const Me=l.chat.formatUser(U,$),X=l.overrides.getName(U.id);return $("span",{"data-room-id":De,"data-room":Se,"data-user-id":U.userID,"data-user":U.userLogin&&U.userLogin.toLowerCase()},[$("span",{className:"chat-line__message--badges"},l.chat.badges.render(j,$)),$("span",{className:`chat-line__username notranslate${X?" ffz--name-override tw-relative ffz-il-tooltip__container":""}`,role:"button",style:{color:he},onClick:this.ffz_user_click_handler,onContextMenu:l.actions.handleUserContext},X?[$("span",{className:"chat-author__display-name"},X),$("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},Me)]:Me)])},Z.prototype.ffzRenderSharedChatPill=function(){let j=l.chat.context.get("chat.shared-chat.style");if(j==null&&(j=this.props.isCurrentUserModerator?2:0),j===0)return null;const U=this.props.message,ee=U.sourceRoomID,he=ee&&this.props.sharedChatDataByChannelID?.get(ee),Se=!he||ee===(U.roomId??this.props.channelID);if(!he)return null;const De=l.i18n.t("chat.sent-from-source","Sent from {source}",{source:he.displayName??he.login});return j===1?$("span",{className:`ffz-pill ffz-tooltip tw-mg-r-05 ${Se?"ffz-pill--brand":""}`,"data-title":De},`${he.displayName??he.login}`):j===2?$("figure",{className:`ffz-tooltip ffz-tooltip--no-mouse ffz-shared-chat-badge ffz-avatar tw-border-radius-rounded ${Se?"ffz-shared-chat-badge--active":""} tw-mg-r-05`,"data-title":l.i18n.t("chat.sent-from-source","Sent from {source}",{source:he.displayName})},$("img",{className:"tw-block tw-border-radius-rounded tw-image",src:he.profileImageURL,alt:he.displayName})):null},Z.prototype.ffzNewRender=function(){try{this._ffz_no_scan=!0;const j=l.chat.standardizeMessage(this.props.message),U=l.chat.context.get("chat.filtering.display-deleted");let ee=this.props.deletedMessageDisplay;if(U?ee=U:!this.props.isCurrentUserModerator&&ee==="DETAILED"&&(ee="LEGACY"),ee==="BRIEF"&&j.deleted){const dt=this.props.deletedCount;return dt==null?null:$("div",{className:"chat-line__status"},l.i18n.t("chat.deleted-messages",`{count,plural,
one {One message was deleted by a moderator.}
other {# messages were deleted by a moderator.}
}`,{count:dt}))}const he=j.sourceRoomID,Se=he&&this.props.sharedChatDataByChannelID?.get(he);let De=j.roomLogin?j.roomLogin:j.channel?j.channel.slice(1):void 0,Me=j.roomId?j.roomId:this.props.channelID;if(!De&&Me){const dt=l.chat.getRoom(Me,null,!0);dt&&dt.login&&(De=j.roomLogin=dt.login)}if(!Me&&De){const dt=l.chat.getRoom(null,De,!0);dt&&dt.id&&(Me=j.roomId=dt.id)}const X=l.site.getUser(),_e={id:Me,login:De},se=!Se||he===Me,Ce=se?_e:{id:he,login:Se.login},Ne=l.chat.context.get("chat.replies.style"),We=this.props&&!!(this.props.hasReply||this.props.reply||!this.props.replyRestrictedReason),Xe=We&&j.message&&!j.deleted&&!this.props.disableReplyClick,de=Xe&&(We||X&&X.login!==j.user?.login);X&&(X.moderator=this.props.isCurrentUserModerator,X.staff=this.props.isCurrentUserStaff,X.reply_mode=Ne,X.can_reply=de),this.ffz_open_reply||(this.ffz_open_reply=this.ffzOpenReply.bind(this)),this.ffz_user_click_handler||(this.props.onUsernameClick?this.ffz_user_click_handler=dt=>{if(this.isKeyboardEvent(dt)&&dt.keyCode!==L.KEYS.Space&&dt.keyCode!==L.KEYS.Enter)return;const mt=dt.currentTarget,Tt=mt&&mt.dataset;let Rt=j.user;if(Tt&&Tt.user)try{Rt=JSON.parse(Tt.user)}catch{}const ei=l.makeEvent({inst:this,event:dt,message:j,user:Rt,room:_e,source:Ce});l.emit("chat:user-click",ei),!ei.defaultPrevented&&this.props.onUsernameClick(Rt.login,"chat_message",j.id,mt.getBoundingClientRect().bottom)}:this.ffz_user_click_handler=this.openViewerCard||this.usernameClickHandler);let ke,$e,Ge=null,rt=j.ffz_type&&l.line_types[j.ffz_type];if(!rt&&j.bits>0&&l.chat.context.get("chat.bits.cheer-notice")&&(rt=l.line_types.cheer),!rt&&j.ffz_type&&(rt=l.line_types.unknown),rt){if(rt.render)return rt.render(j,X,_e,this,$);rt.renderNotice&&(ke=rt.renderNotice(j,X,_e,this,$)),rt.getClass&&($e=rt.getClass(j,X,_e,this,$))}const at=j.user,At=l.chat.context.get("chat.emotes.animated")===2;at&&!at.lowerLogin&&at.userLogin&&(at.lowerLogin=at.userLogin.toLowerCase()),$e=$e||"";let kt,It,Bt=null;if(ee==="BRIEF"?(kt=!0,It=!1):ee==="DETAILED"?(kt=!0,It=j.deleted):(kt=this.state?.alwaysShowMessage||!j.deleted,It=!1),j.deleted){const dt=l.chat.context.get("chat.filtering.display-mod-action");if(dt===2||dt===1&&ee==="DETAILED"){const mt=j.modActionType;mt==="timeout"?Bt=l.i18n.t("chat.mod-action.timeout","{duration} Timeout",{duration:(0,g.print_duration)(j.duration||1)}):mt==="ban"?Bt=l.i18n.t("chat.mod-action.ban","Banned"):(mt==="delete"||!mt)&&(Bt=l.i18n.t("chat.mod-action.delete","Deleted")),Bt&&j.modLogin&&(Bt=l.i18n.t("chat.mod-action.by","{action} by {login}",{login:j.modLogin,action:Bt})),Bt&&(Bt=$("span",{className:"tw-pd-l-05","data-test-selector":"chat-deleted-message-attribution"},`(${Bt})`))}}let Et=null;const Lt=l.chat.context.get("chat.filtering.show-reasons");if(j.highlights?.size&&Lt){Et=[];for(const dt of j.highlights){const mt=l.chat._hl_reasons[dt];let Tt,Rt;mt&&(Rt=mt.i18n_key?l.i18n.t(mt.i18n_key,mt.title):mt.title,Tt=mt.i18n_label?l.i18n.t(mt.i18n_label,mt.label):mt.label,Tt===Rt&&(Rt=null)),Tt||(Tt=dt),Et.push($("span",{className:`ffz-pill ffz-highlight-tag${mt?" ffz-tooltip":""}`,"data-title":Rt},Tt))}Et.length>0?Et=$("span",{className:`ffz-highlight-tags ${Lt===1?"ffz-highlight-tags__above":"tw-mg-r-05"}`},Et):Et=null}const Dt=j.ffz_tokens=j.ffz_tokens||l.chat.tokenizeMessage(j,X),Qt=Dt.length>0||!ke;let Nt;if(Qt){const dt=Ne===2||Ne===1&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference!=="expanded"?j.ffz_reply=j.ffz_reply||l.chat.tokenizeReply(this.props.reply):null,mt=l.parent.message_types&&l.parent.message_types.Action===j.messageType,Tt=this.props.isLastEmoteGigantified||(0,u._x)(j.ffz_reward),Rt=mt?l.chat.context.get("chat.me-style"):0,ei=Rt>=2,Jt=Rt===1||Rt===3,hi=l.overrides.getColor(at.id)||at.color,ct=l.parent.colors.process(hi),tt=kt&&M&&l.chat.pluckRichContent(Dt,j),Ot=Tt&&l.chat.pluckLastEmote(Dt,j),$t=l.chat.formatUser(at,$),St=l.overrides.getName(at.id);let Ft=j.ffz_user_class;Ft instanceof Set?Ft=[...Ft].join(" "):Array.isArray(Ft)&&(Ft=Ft.join(" "));const pt=Se&&l.chat.context.get("chat.shared-chat.username-tooltip"),et={className:`chat-line__username notranslate${St?" ffz--name-override":""}${St||pt?" tw-relative ffz-il-tooltip__container":""} ${Ft??""}`,role:"button",style:{color:ct},onClick:this.ffz_user_click_handler,onContextMenu:l.actions.handleUserContext};j.ffz_user_props&&Object.assign(et,j.ffz_user_props),j.ffz_user_style&&Object.assign(et.style,j.ffz_user_style);const lt=$("span",et,St?[$("span",{className:"chat-author__display-name"},St),$("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},[$t,pt?$("div",{className:"tw-font-size-8 tw-mg-t-05"},l.i18n.t("chat.sent-from-source","Sent from {source}",{source:Se.displayName??Se.login})):null])]:pt?[$t,$("span",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},l.i18n.t("chat.sent-from-source","Sent from {source}",{source:Se.displayName??Se.login}))]:$t),gt=this.props.showTimestamps||this.props.isHistorical?$("span",{className:"chat-line__timestamp"},l.chat.formatTime(j.timestamp)):null,ft=kt&&We&&dt?l.chat.renderTokens(dt,$):null,ot=j.ffz_reward_highlight&&l.chat.context.get("chat.points.allow-highlight")===1;Nt=[Ne===1&&this.props.reply&&this.props.repliesAppearancePreference&&this.props.repliesAppearancePreference==="expanded"?this.renderReplyLine():null,Se?this.ffzRenderSharedChatPill():null,gt,j.ffz_no_actions?null:l.actions.renderInline(j,this.props.showModerationIcons,X,_e,$,this),this.renderInlineHighlight?this.renderInlineHighlight():null,Lt===2?Et:null,$("span",{className:"chat-line__message--badges"},l.chat.badges.render(j,$)),lt,$("span",{"aria-hidden":!0},mt?" ":": "),ft,kt?$("span",{className:`message ${ei?"chat-line__message-body--italicized":""} ${ot?"chat-line__message-body--highlighted":""}`,style:Jt?{color:ct}:null},l.chat.renderTokens(Dt,$,Ne!==0&&We?this.props.reply:null)):$("span",{className:"chat-line__message--deleted"},$("a",{href:"",onClick:this.alwaysShowMessage},l.i18n.t("chat.message-deleted","<message deleted>"))),Bt,tt?$(M,tt):null,Ot?$("div",{className:"chat-line__message--ffz-giant-emote"},l.chat.renderGiantEmote(Ot,$)):null]}let jt;if(ke){const dt=Array.isArray(ke.ffz_target);if(Nt)dt?ke.ffz_icon&&ke.ffz_target.unshift(ke.ffz_icon):ke.ffz_icon&&(ke=[ke.ffz_icon,ke]),Nt=$("div",{className:"chat-line--inline chat-line__message","data-room-id":Ce?.id??j.roomId??_e.id,"data-room":Ce?.login??j.roomLogin,"data-user-id":at?.userID,"data-user":at?.lowerLogin},Nt);else{const mt=l.chat.context.get("chat.extra-timestamps"),Tt=mt&&(this.props.showTimestamps||this.props.isHistorical)?$("span",{className:"chat-line__timestamp"},l.chat.formatTime(j.timestamp)):null,Rt=j.ffz_no_actions?null:l.actions.renderInline(j,this.props.showModerationIcons,X,_e,$,this);dt?ke.ffz_target.unshift(Se?this.ffzRenderSharedChatPill():null,ke.ffz_icon??null,Tt,Rt,Lt===2?Et:null):ke=[Se?this.ffzRenderSharedChatPill():null,ke.ffz_icon??null,Tt,Rt,Lt===2?Et:null,ke]}$e=`${$e} ffz-notice-line user-notice-line tw-pd-y-05`,dt||(ke=$("div",{className:"tw-c-text-alt-2"},ke)),Et&&Lt===1?jt=[Et,ke,Nt??null]:Nt?jt=[ke,Nt]:jt=ke}else $e=`${$e} chat-line__message`,Et&&Lt===1?jt=[Et,Nt]:jt=Nt;const ut=at&&j.id&&!j.ffz_no_actions?l.actions.renderHover(j,this.props.showModerationIcons,X,_e,$,this):null;return ut&&($e=`${$e} tw-relative`,jt=[$("div",{className:"chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0","data-test-selector":"chat-message-highlight"}),$("div",{className:"chat-line__message-container tw-relative"},jt),ut]),Ge==null&&(Ge=j.mentioned&&j.mention_color?l.parent.inverse_colors.process(j.mention_color):null),$("div",{className:`${$e}${It?" ffz--deleted-message":""}${j.mentioned?" ffz-mentioned":""}${Ge?" ffz-custom-color":""}`,style:{backgroundColor:Ge},"data-room-id":Ce?.id??j.roomId??_e.id,"data-room":Ce?.login??j.roomLogin,"data-user-id":at?.userID,"data-user":at?.lowerLogin,onMouseOver:At?l.chat.emotes.animHover:null,onMouseOut:At?l.chat.emotes.animLeave:null},jt)}catch(j){l.log.error(j),l.log.capture(j,{extra:{props:this.props}});try{return console.log("trying old 1"),H.call(this)}catch(U){return l.log.error("An error in Twitch shit.",U),l.log.capture(U,{extra:{props:this.props}}),"An error occurred rendering this chat line."}}},Z.prototype.render=Z.prototype.ffzNewRender,setTimeout(()=>this.ChatLine.forceUpdate())}),this.ExtensionLine.ready(Z=>{const H=Z.prototype.render;Z.prototype.render=function(){try{if(this._ffz_no_scan=!0,!this.props.installedExtensions)return null;const j=l.chat.standardizeMessage(this.props.message),U=j&&j.extension;if(!U||!this.props.installedExtensions.some(se=>{const Ce=se.extension;return Ce&&(Ce.clientId||Ce.clientID)===(U.clientId||U.clientID)&&Ce.version===U.version}))return null;const ee=l.parent.colors.process(U.chatColor);let he=j.roomLogin?j.roomLogin:j.channel?j.channel.slice(1):void 0;if(!he&&this.props.channelID){const se=l.chat.getRoom(this.props.channelID,null,!0);se&&se.login&&(he=j.roomLogin=se.login)}const Se=l.site.getUser(),De={id:this.props.channelID,login:he},Me=j.ffz_tokens=j.ffz_tokens||l.chat.tokenizeMessage(j,Se),X=M&&l.chat.pluckRichContent(Me,j),_e=j.mentioned&&j.mention_color?l.parent.inverse_colors.process(j.mention_color):null;return Me.length?$("div",{className:`chat-line__message${j.mentioned?" ffz-mentioned":""}${_e?" ffz-custom-color":""}`,style:{backgroundColor:_e},"data-room-id":De.id,"data-room":De.login,"data-extension":U.clientID},[this.props.showTimestamps&&$("span",{className:"chat-line__timestamp"},l.chat.formatTime(j.timestamp)),$("span",{className:"chat-line__message--badges"},l.chat.badges.render(j,$)),$("span",{className:"chat-line__username notranslate",role:"button",style:{color:ee},onClick:this.onExtensionNameClick},$("span",{className:"chat-author__display-name"},U.displayName)),$("span",null,": "),$("span",{className:"message"},l.chat.renderTokens(Me,$)),X&&$(M,X)]):null}catch(j){return l.log.info(j),l.log.capture(j,{extra:{props:this.props}}),H.call(this)}},setTimeout(()=>this.ExtensionLine.forceUpdate())})}checkEffects(){for(const l of this.ChatLine.instances){const p=l.props.message,$=p?.ffz_tokens;if($)for(const M of $)M.type==="emote"&&M.modifier_flags&&this.emotes.ensureEffect(M.modifier_flags)}for(const l of this.WhisperLine.instances){const p=l.props.message?._ffz_message,$=p?.ffz_tokens;if($)for(const M of $)M.type==="emote"&&M.modifier_flags&&this.emotes.ensureEffect(M.modifier_flags)}}updateLineById(l,p=!0,$=null){$==null&&($=p);for(const M of this.ChatLine.instances){const Z=M.props.message;if(Z?.id===l){$&&(Z.ffz_badges=Z.ffz_badge_cache=null),p&&(Z.ffz_tokens=null,Z.ffz_reply=null,Z.highlights=Z.mentioned=Z.mention_color=Z.color_priority=null),M.forceUpdate();return}}for(const M of this.WhisperLine.instances){const Z=M.props.message?._ffz_message;if(Z?.id===l){($||p)&&(Z._ffz_message=null),M.forceUpdate();return}}}updateLinesByUser(l,p,$=!0,M=!0){for(const Z of this.ChatLine.instances){const H=Z.props.message,j=H?.user;j&&(l&&l==j.id||p&&p==j.login)&&(M&&(H.ffz_badges=H.ffz_badge_cache=null),$&&(H.ffz_tokens=null,H.ffz_reply=null,H.highlights=H.mentioned=H.mention_color=H.color_priority=null),Z.forceUpdate())}for(const Z of this.WhisperLine.instances){const H=Z.props.message?._ffz_message,j=H?.user;j&&(l&&l==j.id||p&&p==j.login)&&(H._ffz_message=null,Z.forceUpdate())}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){return this._updateLines(!1,!1)}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(l=!0,p=!0){for(const $ of this.ChatLine.instances){const M=$.props.message;M&&(p&&(M.ffz_badge_cache=M.ffz_badges=null),l&&(M.ffz_tokens=null,M.ffz_reply=null,M.highlights=M.mentioned=M.mention_color=M.mention_priority=M.clear_priority=null))}for(const $ of this.ExtensionLine.instances){const M=$.props.message;M&&(p&&(M.ffz_badge_cache=M.ffz_badges=null),l&&(M.ffz_tokens=null,M.ffz_reply=null,M.highlights=M.mentioned=M.mention_color=M.mention_priority=M.clear_priority=null))}for(const $ of this.WhisperLine.instances){const M=$.props.message;M&&M._ffz_message&&(M._ffz_message=null)}this.ChatLine.forceUpdate(),this.ExtensionLine.forceUpdate(),this.WhisperLine.forceUpdate(),this.emit("chat:updated-lines")}};B(He,"ChatLine");let z=He;var C=S(44589),y=S(17159);const Ze=class Ze extends x.default{constructor(...l){super(...l),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("site.fine"),this.inject("site"),this.inject("site.css_tweaks"),this.settings.add("chat.input.hide-identity",{default:!1,ui:{path:"Chat > Input >> Appearance",title:'Display "Chat Identity" in the chat settings menu rather than the input box.',component:"setting-check-box"}}),this.SettingsMenu=this.fine.define("chat-settings",p=>p.renderUniversalOptions&&p.onBadgesChanged,m.Z.CHAT_ROUTES)}async onEnable(){this.on("i18n:update",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.scroller.freeze",()=>this.SettingsMenu.forceUpdate()),this.chat.context.on("changed:chat.input.hide-identity",M=>{this.css_tweaks.toggle("hide-chat-identity",M),this.SettingsMenu.forceUpdate()}),this.css_tweaks.toggle("hide-chat-identity",this.chat.context.get("chat.input.hide-identity"));const l=this,p=await this.site.findReact();if(!p)return;const $=p.createElement;this.SettingsMenu.ready(M=>{const Z=M.prototype.render,H=M.prototype.renderUniversalOptions;M.prototype.renderUniversalOptions=function(){const j=H.call(this);return this.ffzSettingsClick||(this.ffzSettingsClick=U=>l.click(this,U)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),j.props.children.push($("div",{class:"tw-full-width tw-relative"},$("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.ffzSettingsClick},$("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},$("div",{class:"tw-flex-grow-1"},l.i18n.t("site.menu_button","FrankerFaceZ Control Center")))),l.cant_window&&$("div",{class:"tw-mg-t-05 tw-c-text-alt-2"},$("span",{class:"ffz-i-attention"},l.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch."))))),j},M.prototype.ffzRenderIdentity=function(){if(!this.state||!this.props||this.state.moderatorMode||this.state.chatAppearance||this.state.chatPause||this.state.followerMode||this.state.recentRaids||this.state.repliesAppearance||this.state.slowMode||this.props.isShowingChatFilterSettings||this.props.isShowingDeletedMessageDisplaySettings||!this.props.isLoggedIn||!l.chat.context.get("chat.input.hide-identity"))return null;const j=this.props.data?.currentUser,U=this.props.data?.user?.self?.displayBadges;if(!j||!j.login||!Array.isArray(U))return null;const ee=j.login&&j.displayName&&j.displayName.trim().toLowerCase()!==j.login,he=l.parent.colors.process(j.chatColor),Se={};for(const Me of U)Me?.setID&&Me.version&&(Se[Me.setID]=Me.version);this._ffzIdentityClick||(this._ffzIdentityClick=()=>{document.querySelector('button[data-a-target="chat-badge-carousel-badge-icon"]').click(),this.props.onCloseSettings()});const De={user:j,badges:Se,ffz_badges:l.badges.getBadges(j.id,j.login,this.props.channelID,this.props.channelLogin),roomID:this.props.channelID,roomLogin:this.props.channelLogin};return this._ffzIdentityMsg=De,$("div",{class:"ffz-identity"},$("div",{class:"tw-mg-y-05 tw-pd-x-05"},$("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},l.i18n.t("chat.identity-menu","Chat Identity"))),$("div",{class:"tw-full-width tw-relative"},$("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this._ffzIdentityClick},$("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},$("div",{class:"tw-flex-grow-1"},$("span",{class:"ffz--editor-name"},$("span",{class:"ffz--editor-badges","data-room-id":this.props.channelID,"data-room":this.props.channelLogin},l.badges.render(De,$,!0,!0)),$("span",{class:"tw-strong notranslate",style:{color:he}},$("span",{class:"name-display__name"},j.displayName||j.login),ee&&$("span",{class:"intl-name"}," (",j.login,") ")))),$("div",{class:"tw-align-items-center tw-flex tw-flex-shrink-0 tw-mg-l-05"},$("figure",{class:"ffz-i-right-open"}))))))},M.prototype.render=function(){const j=Z.call(this);try{const U=j?.props?.children?.props?.children?.props?.children?.[1]?.props?.children?.props?.children;if(Array.isArray(U)){const ee=this.ffzRenderIdentity();ee&&U.unshift(ee)}}catch(U){l.log.error("Error rendering chat settings menu.",U)}return j},this.SettingsMenu.forceUpdate()}),this.SettingsMenu.on("update",this.updateSettingsMenu,this),this.SettingsMenu.on("unmount",M=>{M.ffzSettingsClick=null})}updateSettingsMenu(l){const p=this.fine.getChildNode(l);if(!p||!document.contains(p))return;let $;if(l.props?.editAppearance){this.registerBadgePicker();const ee=p.querySelector('span[data-a-target="edit-display-name"]');$=ee&&ee.closest(".tw-mg-t-1")}else $=p.querySelector('.name-display > div:not([data-test-selector="edit-appearance-button"])');if(!$||!p.contains($))return;const M=l.props?.data?.currentUser,Z=l.props?.data?.user?.self?.displayBadges;if(!M||!M.login||!Array.isArray(Z))return;const H=M.login&&M.displayName&&M.displayName.trim().toLowerCase()!==M.login,j=this.parent.colors.process(M.chatColor),U={};for(const ee of $.children)ee?.classList&&(ee.classList.contains("ffz--editor-name")?ee.remove():ee.classList.add("tw-hide"));for(const ee of Z)ee?.setID&&ee.version&&(U[ee.setID]=ee.version);$.appendChild((0,C.createElement)("span",{className:"ffz--editor-name"},[(0,C.createElement)("span",{className:"ffz--editor-badges","data-room-id":l.props.channelID,"data-room-login":l.props.channelLogin},this.badges.render({user:M,badges:U,ffz_badges:this.badges.getBadges(M.id,M.login,l.props.channelID,l.props.channelLogin),roomID:l.props.channelID,roomLogin:l.props.channelLogin},C.createElement,!0,!0)),(0,C.createElement)("span",{class:"tw-strong notranslate",style:{color:j}},(0,C.createElement)("span",{class:"name-display__name"},M.displayName||M.login),H&&(0,C.createElement)("span",{class:"intl-name"}," (",M.login,")"))]))}registerBadgePicker(){this.BadgePicker||(this.BadgePicker=this.fine.define("badge-picker",l=>l.onGlobalBadgeClicked&&l.onGlobalBadgeKeyPress,m.Z.CHAT_ROUTES),this.BadgePicker.on("mount",this.updateBadgePicker,this),this.BadgePicker.on("update",this.updateBadgePicker,this),this.BadgePicker.ready((l,p)=>{for(const $ of p)this.updateBadgePicker($)}))}updateBadgePicker(l){const p=this.fine.getChildNode(l);if(!p){l.props?.data?.loading===!1&&!l._ffz_try_again&&(l._ffz_try_again=requestAnimationFrame(()=>this.updateBadgePicker(l)));return}const $=p.querySelector(".tw-flex-column");if(!$)return;const M=this.badges.getBadges(l.props.userID,l.props.userLogin);let Z;for(const ee of M){const he=this.badges.badges[ee?.id];he&&!he.addon&&(Z=he)}const H=$.querySelector(".ffz--badge-selector");if(H){Z||H.remove();return}else if(!Z)return;const j=(0,C.createElement)("div",{class:"ffz--badge-selector tw-border-b tw-mg-b-1"},(0,C.createElement)("div",{class:"tw-mg-y-05 tw-pd-x-05"},(0,C.createElement)("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},this.i18n.t("chat.ffz-badge.title","FrankerFaceZ Badge"))),(0,C.createElement)("div",null,(0,C.createElement)("p",{class:"tw-mg-b-05 tw-pd-x-05"},this.i18n.tList("chat.ffz-badge.about","This badge appears globally for users with FrankerFaceZ. Please visit the {website} to change this badge.",{website:(0,C.createElement)("a",{href:"https://www.frankerfacez.com/subscribe",class:"ffz-link",rel:"noopener noreferrer",target:"_blank"},this.i18n.t("chat.ffz-badge.site-link","FrankerFaceZ website"))}))),(0,C.createElement)("div",{role:"radiogroup",class:"tw-align-items-center tw-flex tw-flex-wrap tw-mg-b-05 tw-mg-t-05 tw-pd-x-05"},(0,C.createElement)("div",{class:"tw-mg-r-1 tw-mg-y-05"},(0,C.createElement)("div",{class:"tw-inline-flex"},(0,C.createElement)("div",{class:"edit-appearance__badge-chooser edit-appearance__badge-chooser--selected tw-border-radius-small"},(0,C.createElement)("img",{alt:Z.title,src:Z.urls[2],srcset:`${Z.urls[2]} 1x, ${Z.urls[4]} 2x`,style:{backgroundColor:Z.color||"transparent"},role:"radio","aria-checked":"true",class:"tw-full-height tw-full-width"})))))),U=$.querySelector('[data-test-selector="global-badges-test-selector"]')?.nextElementSibling;U?$.insertBefore(j,U):$.appendChild(j)}closeMenu(l){const p=this.fine.searchParent(l,M=>M.setChatInputRef&&M.setAutocompleteInputRef,100),$=p&&this.fine.searchTree(p,M=>M.props&&M.props.isSettingsOpen&&M.onClickSettings);$&&$.onClickSettings()}click(l,p){const $=p.currentTarget,M=$&&$.dataset&&$.dataset.page,Z=new y.FFZEvent({item:M,event:p,errored:!1});if(this.emit("main_menu:open",Z),Z.errored){this.cant_window=!0,this.SettingsMenu.forceUpdate();return}this.closeMenu(l)}};B(Ze,"SettingsMenu");let a=Ze;var v=S(49276),F=S(90424),A=S.n(F);const D={1e3:"Tier 1",2e3:"Tier 2",3e3:"Tier 3"},O=["the_horns","raised_back_of_hand","ok_hand","+1","clap","fist","pinched_fingers","wave","pinch","victory","love_you_gesture"];function J(nt,l){l||(l=nt.closest(".simplebar-scroll-content")??nt.parentElement);const p=l.offsetHeight,$=nt.offsetHeight,M=nt.offsetTop;if($>=p){l.scrollTop=M;return}const Z=M+$/2-p/2;l.scrollTop=Z}B(J,"scrollIntoView");function G(nt){if(!nt)return nt;try{return new Date(nt)}catch{return null}}B(G,"maybe_date");const V=window?.Intl?.Collator&&new Intl.Collator(void 0,{numeric:!0}),q=[B(function(l,p){return V?V.compare(l.id,p.id):l.id<p.id?-1:l.id>p.id?1:0},"id_asc"),B(function(l,p){return V?V.compare(p.id,l.id):l.id>p.id?-1:l.id<p.id?1:0},"id_desc"),B(function(l,p){const $=l.name.toLowerCase(),M=p.name.toLowerCase();return $<M?-1:$>M?1:V?V.compare(l.id,p.id):l.id<p.id?-1:l.id>p.id?1:0},"name_asc"),B(function(l,p){const $=l.name.toLowerCase(),M=p.name.toLowerCase();return $>M?-1:$<M?1:V?V.compare(p.id,l.id):l.id>p.id?-1:l.id<p.id?1:0},"name_desc"),B(function(l,p){if(l.order!=null||p.order!=null){if(l.order&&p.order==null)return-1;if(p.order&&l.order==null)return 1;if(l.order<p.order)return-1;if(l.order>p.order)return 1}return V?V.compare(l.id,p.id):l.id<p.id?-1:l.id>p.id?1:0},"native_asc"),B(function(l,p){if(l.order!=null||p.order!=null){if(l.order&&p.order==null)return 1;if(p.order&&l.order==null)return-1;if(l.order<p.order)return 1;if(l.order>p.order)return-1}return V?V.compare(l.id,p.id):l.id<p.id?1:l.id>p.id?-1:0},"native_desc")];function re(nt,l){const p=nt.sort_key,$=l.sort_key;if(p<$)return-1;if($<p)return 1;const M=nt.title.toLowerCase(),Z=l.title.toLowerCase();return M<Z?-1:Z<M?1:0}B(re,"sort_sets");const qe=class qe extends x.default{constructor(...l){super(...l),this.inject("staging"),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.SUB_STATUS=A(),this.settings.add("chat.emote-menu.shortcut",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Use Ctrl+E to open the Emote Menu.",description:"When enabled and you press Ctrl+E with the chat input focused, the emote menu will open.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.modifiers",{default:0,ui:{path:"Chat > Emote Menu >> General",title:"Emote Modifiers",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"In-Line"}]}}),this.settings.add("chat.emote-menu.clear-search",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Reset search when closing the Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.enabled",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Use the FrankerFaceZ Emote Menu.",description:"The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.",component:"setting-check-box"},changed:()=>this.EmoteMenu.forceUpdate()}),this.settings.add("chat.emote-menu.icon",{requires:["chat.emote-menu.enabled","context.bttv.emote_menu"],default:!1,process(p,$){return p.get("chat.emote-menu.enabled")?p.get("context.bttv.emote_menu")||$:!1},ui:{path:"Chat > Emote Menu >> Appearance",title:"Replace the emote menu icon with the FFZ icon for that classic feel.",description:"**Note:** This setting may be forcibly enabled if other emote menus are detected, to ensure you can visually identify the FFZ Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-quick-nav",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show a quick navigation bar along the side of the menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tall",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use extra height for the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-heading",{default:1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show Headers",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Not Searching"}]}}),this.settings.add("chat.emote-menu.show-search",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show the search box.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.reduced-padding",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use reduced padding.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.default-tab",{default:"channel",ui:{path:"Chat > Emote Menu >> General",title:"Default Tab",component:"setting-select-box",data:[{value:"fav",title:"Favorites"},{value:"channel",title:"Channel"},{value:"effect",title:"Emote Effects"},{value:"all",title:"My Emotes"},{value:"emoji",title:"Emoji"}]}}),this.settings.add("chat.emote-menu.effect-tab",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display Emote Effects in their own tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tooltips",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Display emote preview tool-tips in the FFZ Emote Menu.",component:"setting-check-box",description:"You may wish to disable this for performance reasons."}}),this.settings.add("chat.emote-menu.show-emoji",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display emoji in the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.combine-tabs",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Display all emotes on one tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.stay-loaded",{requires:["chat.emote-menu.combine-tabs"],default:null,process(p,$){return $==null&&($=p.get("chat.emote-menu.combine-tabs")),$},ui:{path:"Chat > Emote Menu >> General",title:"Stay loaded after opening.",component:"setting-check-box",description:"This causes the emote menu to stay in the DOM even when it's not visible. Enabling this may help the site perform better when opening the menu if it's slow. By default, this setting is enabled when using `Display all emotes on one tab.`"}}),this.settings.add("chat.emote-menu.sort-emotes",{default:4,ui:{path:"Chat > Emote Menu >> Sorting",title:"Sort Emotes By",component:"setting-select-box",data:[{value:4,title:"Native Order, Ascending"},{value:5,title:"Native Order, Descending"},{value:0,title:"Order Added (ID), Ascending"},{value:1,title:"Order Added (ID), Descending"},{value:2,title:"Name, Ascending"},{value:3,title:"Name, Descending"}]}}),this.settings.add("chat.emote-menu.sort-tiers-last",{default:!0,ui:{path:"Chat > Emote Menu >> Sorting",title:"List emotes from higher sub tiers last.",component:"setting-check-box"}}),this.EmoteMenu=this.fine.define("chat-emote-menu",p=>p.getAllEmoteSets&&p.getSortedChannelEmotes&&p.props?.emotePickerSource,m.Z.CHAT_ROUTES),this.MenuWrapper=this.fine.wrap("ffz-emote-menu")}async onEnable(){this.on("i18n:update",()=>this.EmoteMenu.forceUpdate()),this.on("chat.emotes:update-default-sets",this.maybeUpdate,this),this.on("chat.emotes:update-user-sets",this.maybeUpdate,this),this.on("chat.emotes:update-room-sets",this.maybeUpdate,this),this.on("chat.emotes:loaded",this.maybeUpdate,this),this.on("chat.emotes:change-favorite",this.maybeUpdate,this),this.on("chat.emotes:change-hidden",this.maybeUpdate,this),this.on("chat.emoji:populated",this.maybeUpdate,this),this.chat.context.on("changed:chat.emote-menu.enabled",()=>this.EmoteMenu.forceUpdate());const l=B(()=>{for(const Z of this.MenuWrapper.instances)Z.rebuildData()},"rebuild");this.chat.context.on("changed:chat.emotes.enabled",l),this.chat.context.on("changed:chat.emote-menu.modifiers",l),this.chat.context.on("changed:chat.emote-menu.show-emoji",l),this.chat.context.on("changed:chat.emote-menu.tooltips",l),this.chat.context.on("changed:chat.fix-bad-emotes",l),this.chat.context.on("changed:chat.emote-menu.effect-tab",l),this.chat.context.on("changed:chat.emote-menu.sort-emotes",l),this.chat.context.on("changed:chat.emote-menu.sort-tiers-last",l),this.chat.context.on("changed:chat.emoji.style",this.updateEmojiVariables,this),this.chat.context.getChanges("chat.emote-menu.icon",Z=>this.css_tweaks.toggle("emote-menu",Z)),this.updateEmojiVariables(),this.css_tweaks.setVariable("emoji-menu--sheet","//cdn.frankerfacez.com/static/emoji/images/sheet-twemoji-36.png"),this.css_tweaks.setVariable("emoji-menu--count",58),this.css_tweaks.setVariable("emoji-menu--size",36);const p=this,$=await this.site.findReact(),M=$&&$.createElement;if(!M)return p.log.warn("Unable to get React.");this.defineClasses(),this.EmoteMenu.ready(Z=>{const H=Z.prototype.render;Z.prototype.render=function(){return this._ffz_no_scan=!1,!this.props||this.props.emotePickerSource==="bits-rewards"||!(0,P.has)(this.props,"channelID")||!p.chat.context.get("chat.emote-menu.enabled")?H.call(this):M(p.MenuErrorWrapper,{visible:this.props.visible},M(p.MenuComponent,{source:this.props.emotePickerSource,visible:this.props.visible,toggleVisibility:this.props.toggleVisibility,channel_data:this.props.channelData,emote_data:this.props.emoteSetsData,user_id:this.props.currentUserID,channel_id:this.props.channelID,loading:this.props.channelData?.loading||this.props.emoteSetsData?.loading,error:this.props.channelData?.error||this.props.emoteSetsData?.error,onClickToken:this.props.onClickToken}))},this.EmoteMenu.forceUpdate()})}updateEmojiVariables(){const l=this.chat.context.get("chat.emoji.style")||"twitter",p=`//cdn.frankerfacez.com/static/emoji/images/sheet-${v.Vf[l]||"twemoji"}-`,$=this.emoji_size=36,M=this.emoji_sheet_count=58,Z=this.emoji_sheet_size=M*($+2),H=this.emoji_sheet_pct=100*Z/$;this.emoji_sheet_remain=Z-$,this.css_tweaks.set("emoji-menu",`.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {
	background-size: ${H}% ${H}%;
	background-image: url("${p}36.png");
	background-image: ${L.WEBKIT_CSS}image-set(
		url("${p}18.png") 0.5x,
		url("${p}36.png") 1x,
		url("${p}72.png") 2x
	);
}`)}maybeUpdate(){if(this.chat.context.get("chat.emote-menu.enabled"))for(const l of this.MenuWrapper.instances)l.rebuildData()}defineClasses(){var U,ee,he,Se,De;const l=this,p=this.settings.provider,$=this.site.getReact(),M=$&&$.createElement;this.EmojiTonePicker=(U=class extends $.Component{constructor(X){super(X),this.onClick=()=>this.setState({open:!this.state.open}),this.onMouseEnter=()=>this.state.open||this.setState({emoji:this.pickRandomEmoji()}),this.onClickOutside=()=>this.state.open&&this.setState({open:!1}),this.clickTone=_e=>{this.props.pickTone(_e.currentTarget.dataset.tone),this.setState({open:!1})},this.element=null,this.saveRef=_e=>this.element=_e,this.state={open:!1,emoji:this.pickRandomEmoji(),tone:null}}componentDidMount(){this.element&&(this._clicker=new C.ClickOutside(this.element,this.onClickOutside))}componentWillUnmount(){this._clicker&&(this._clicker.destroy(),this._clicker=null)}pickRandomEmoji(){const X=this.props.choices,_e=Math.floor(Math.random()*X.length);return X[_e]}renderTone(X,_e){return X?M("button",{key:X.code,"data-tone":_e,class:"tw-interactive tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-y-05 tw-pd-x-2",onClick:this.clickTone},this.renderEmoji(X)):null}renderToneMenu(){if(!this.state.open)return null;const X=this.state.emoji;if(!X||!X.variants)return null;const _e=Object.entries(X.variants).map(([se,Ce])=>this.renderTone(Ce,se));return M("div",{class:"tw-absolute ffz-balloon ffz-il-tooltip--up ffz-il-tooltip--align-right ffz-balloon tw-block"},M("div",{class:"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1"},this.renderTone(X,null),_e))}renderEmoji(X){if(!X)return null;const _e=X.sheet_x*(l.emoji_size+2)+1,se=X.sheet_y*(l.emoji_size+2)+1,Ce=100*_e/l.emoji_sheet_remain,Ne=100*se/l.emoji_sheet_remain;return M("figure",{class:"ffz--emoji-tone-picker__emoji",style:{backgroundPosition:`${Ce}% ${Ne}%`}})}render(){const X=this.state.emoji,_e=this.props.tone,se=_e&&X.variants[_e];return M("div",{ref:this.saveRef,class:"ffz--emoji-tone-picker tw-relative tw-mg-l-1"},M("button",{class:"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow",onClick:this.onClick,onMouseEnter:this.onMouseEnter},M("span",{class:"tw-button__text"},this.renderEmoji(se||X)),M("span",{class:"tw-button__icon tw-button__icon--right"},M("figure",{class:"ffz-i-down-dir"}))),this.renderToneMenu())}},B(U,"FFZEmojiTonePicker"),U),this.MenuSection=(ee=class extends $.Component{constructor(X){super(X),this.ref=null,this.saveRef=Ce=>{this.ref&&this.props.stopObserving(this.ref),this.ref=Ce,Ce&&this.props.startObserving(this.ref,this)};const _e=p.get("emote-menu.collapsed"),se=p.get("emote-menu.hidden-sets");this.state={active:!1,activeEmote:-1,hidden:se&&X.data&&se.includes(X.data.hide_key||X.data.key),collapsed:_e&&X.data&&_e.includes(X.data.key),intersecting:!window.IntersectionObserver},this.keyHeading=this.keyHeading.bind(this),this.clickHeading=this.clickHeading.bind(this),this.clickEmote=this.clickEmote.bind(this),this.mouseEnter=()=>this.state.intersecting||this.setState({intersecting:!0}),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.props.addSection(this),this.ref&&this.props.startObserving(this.ref,this)}componentWillUnmount(){this.props.removeSection(this),this.ref&&this.props.stopObserving(this.ref)}keyInteract(X){}clickEmote(X){if(this.props.visibility_control){const We=X.currentTarget.dataset;let Xe,de=We.id;if(We.provider==="twitch")Xe="twitch";else if(We.provider==="ffz"){const ke=l.emotes.emote_sets[We.set],$e=ke&&ke.emotes[de];if(!$e)return;Xe=ke.source||"ffz",de=$e.id}else return;l.emotes.toggleHidden(Xe,de);return}if(l.emotes.handleClick(X,!0))return;let _e="",se="";const Ce=X.currentTarget.dataset.effects,Ne=X.currentTarget.dataset.effectPrefix==="true";Ce?.length>0&&Ce!="0"&&l.emotes.target_emote&&(Ne?se=` ${l.emotes.target_emote.name}`:_e=`${l.emotes.target_emote.name} `),this.props.onClickToken(`${_e}${X.currentTarget.dataset.name}${se}`)}keyHeading(X){(X.keyCode===L.KEYS.Enter||X.keyCode===L.KEYS.Space)&&this.clickHeading()}clickHeading(){if(this.props.visibility_control){const Ne=p.get("emote-menu.hidden-sets")||[],We=this.props.data.hide_key||this.props.data.key,Xe=Ne.indexOf(We);if(We==="twitch-current-channel")return;Xe===-1?(Ne.push(We),this.setState({hidden:!0})):(Ne.splice(Xe,1),this.setState({hidden:!1})),p.set("emote-menu.hidden-sets",Ne),l.emit("chat.emotes:change-set-hidden",We);return}if(this.props.filtered)return;const X=p.get("emote-menu.collapsed")||[],_e=!this.state.collapsed,se=this.props.data.key,Ce=X.indexOf(se);if(this.setState({collapsed:_e}),_e&&Ce===-1)X.push(se);else if(!_e&&Ce!==-1)X.splice(Ce,1);else return;p.set("emote-menu.collapsed",X)}onMouseEnter(X){const _e=X.currentTarget.dataset.setId;this.setState({unlocked:_e})}onMouseLeave(){this.setState({unlocked:null})}render(){const X=this.props.data,_e=this.props.filtered,se=this.props.visibility_control;let Ce=!(X.is_favorites&&!this.props.combineTabs)&&this.props.showHeading;Ce===2?Ce=!_e:Ce=!!Ce,se&&(Ce=!0);const Ne=se?this.state.hidden:!1,We=se?Ne:Ce&&!_e&&this.state.collapsed;if(!X)return null;let Xe;X.image?Xe=M("img",{class:`ffz--menu-badge${X.image_large?" ffz--menu-badge__large":""}`,src:X.image,srcSet:X.image_set}):Xe=M("figure",{class:`ffz--menu-badge ffz-i-${X.icon||"zreknarf"}`});let de;const ke=X.renews&&X.renews.getTime(),$e=X.ends&&X.ends.getTime();ke>0?de={icon:"calendar",message:l.i18n.t("emote-menu.sub-renews","This sub renews {seconds,humantime}.",{seconds:ke})}:$e&&(X.prime?de={icon:"crown",message:l.i18n.t("emote-menu.sub-prime",`This is your free sub with Prime Gaming.
It ends {seconds,humantime}.`,{seconds:$e})}:X.gift?de={icon:"gift",message:l.i18n.t("emote-menu.sub-gift-ends","This gifted sub ends {seconds,humantime}.",{seconds:$e})}:de={icon:"calendar-empty",message:l.i18n.t("emote-menu.sub-ends","This sub ends {seconds,humantime}.",{seconds:$e})});let Ge=X.source_i18n?l.i18n.t(X.source_i18n,X.source):X.source;return Ge==null&&(Ge="FFZ"),M("section",{ref:this.saveRef,"data-key":X.key,class:_e?"filtered":"",onMouseEnter:this.mouseEnter},Ce?M("heading",{tabindex:"0",class:"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap",onKeyDown:this.keyHeading,onClick:this.clickHeading},Xe,M("div",{class:"tw-pd-l-05"},(X.i18n?l.i18n.t(X.i18n,X.title):X.title)||l.i18n.t("emote-menu.unknown","Unknown Source"),!se&&de&&M("span",{class:`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${de.icon}`,"data-tooltip-type":"html","data-title":de.message})),M("div",{class:"tw-flex-grow-1"}),M("span",{class:!se&&X.channel_source?"ffz-tooltip":"","data-title":X.channel_source},se?Ne?l.i18n.t("emote-menu.visibility.hidden","Hidden"):l.i18n.t("emote-menu.visibility.visible","Visible"):Ge),!se&&_e?"":M("figure",{class:`tw-pd-l-05 ffz-i-${We?"left":"down"}-dir`})):null,We||this.renderBody(Ce))}renderBody(X){const _e=this.props.data,se=this.props.filtered,Ce=_e.locks&&_e.locks[this.state.unlocked],Ne=_e.filtered_emotes&&_e.filtered_emotes.map(We=>{if(se&&We.locked)return;const Xe=We.locked&&(!Ce||!Ce.emotes.has(We.id)),de=Xe&&_e.locks&&_e.locks[We.set_id];let ke="";return de&&(de.id==="subwoofer"?ke=l.i18n.t("emote-menu.emote-subwoofer","Become an FFZ Subwoofer to unlock this emote."):de.id==="cheer"?ke=l.i18n.t("emote-menu.emote-cheer","Cheer an additional {bits_remaining, plural, one {# bit} other {# bits}} to unlock this emote.",de):de.id==="follower"?ke=l.i18n.t("emote-menu.emote-follower","Follow {user} to unlock this emote in their channel.",de):_e.all_locked?ke=l.i18n.t("emote-menu.emote-sub","Subscribe for {price} to unlock this emote.",de):ke=l.i18n.t("emote-menu.emote-up","Upgrade your sub to {price} to unlock this emote.",de)),this.renderEmote(We,Xe,X,ke)});return M("div",{class:"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center"},Ne,!this.props.visibility_control&&!se&&this.renderSellout())}renderEmote(X,_e,se,Ce){if(!this.state.intersecting)return M("span",{key:X.id,class:"emote-picker__placeholder",style:{width:`${X.width||28}px`,height:`${X.height||28}px`}});const Ne=this.props.visibility_control,We=this.props.emote_modifiers[X.id],Xe=Array.isArray(We)&&We.length>0,de=this.props.animated,ke=Ne&&X.hidden,$e=l.chat.context.get("chat.emote-menu.tooltips");let Ge,rt;return de&&X.animSrc?(Ge=X.animSrc,rt=X.animSrcSet):(Ge=X.src,rt=X.srcSet),M("button",{key:X.id,class:`${$e?"ffz-tooltip ":""}emote-picker__emote-link${!Ne&&_e?" locked":""}${ke?" emote-hidden":""}`,"data-tooltip-type":"emote","data-provider":X.provider,"data-id":X.id,"data-set":X.set_id,"data-code":X.code,"data-modifiers":We,"data-effects":X.effects,"data-effect-prefix":X.effect_prefix,"data-variant":X.variant,"data-no-source":se,"data-name":X.name,"aria-label":X.name,"data-locked":X.locked,"data-sellout":Ce,onClick:(this.props.visibility_control||!X.locked)&&this.clickEmote},M("figure",{class:"emote-picker__emote-figure"},M("img",{class:`emote-picker__emote-image${X.emoji?" ffz-emoji":""}`,src:Ge,srcSet:rt,alt:X.name,height:X.height?`${X.height}px`:null,width:X.width?`${X.width}px`:null})),!Ne&&Xe&&M("div",{class:"emote-button__options"}),!Ne&&X.favorite&&M("figure",{class:"ffz--favorite ffz-i-star"}),!Ne&&_e&&M("figure",{class:`ffz-i-${X.lock_icon||"lock"}`}),ke&&M("figure",{class:"ffz-i-eye-off"}))}renderSellout(){const X=this.props.data;if(!X.all_locked||!X.locks)return null;let _e=X.locks[this.state.unlocked],se=Object.values(X.locks).filter(Ne=>Ne.id!=="cheer"),Ce=se.filter(Ne=>Ne.is_ffz).length>0;return!_e&&X.locks.length===1&&(_e=X.locks[0]),se.length?M("div",{class:"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0"},Ce?l.i18n.t("emote-menu.ffz-unlock","This feature is available to FFZ Subwoofers."):_e?l.i18n.t("emote-menu.sub-unlock","Subscribe for {price} to unlock {count, plural, one {# emote} other {# emotes}}",{price:_e.price,count:_e.emotes.size}):l.i18n.t("emote-menu.sub-basic","Subscribe to unlock some emotes"),Ce&&this.props.ffz_sub_data?.has_free_sub?M("div",{class:"tw-pd-y-1"},l.i18n.t("emote-menu.free-sub.about","As thanks for supporting us in the past, you can get one month of FFZ Subwoofer for free.")):null,M("div",{class:"ffz--sub-buttons tw-mg-t-05"},se.map(Ne=>Ne.hide_button?null:M("a",{key:Ne.price,class:"tw-button tw-border-radius-none",href:Ne.url,target:"_blank",rel:"noopener noreferrer","data-set-id":Ne.set_id,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},M("span",{class:"tw-button__text"},Ce&&this.props.ffz_sub_data?.has_free_sub?l.i18n.t("emote-menu.free-sub","Use My Free Month"):Ne.price))))):null}},B(ee,"FFZMenuSection"),ee),this.fine.wrap("ffz-menu-section",this.MenuSection),this.EmojiSection=(he=class extends this.MenuSection{renderEmote(X,_e,se,Ce){const Ne=X.x*(l.emoji_size+2)+1,We=X.y*(l.emoji_size+2)+1,Xe=100*Ne/l.emoji_sheet_remain,de=100*We/l.emoji_sheet_remain,ke=l.chat.context.get("chat.emote-menu.tooltips");return M("button",{key:X.id,class:`${ke?"ffz-tooltip ":""}emote-picker__emote-link${_e?" locked":""}${X.emoji?" emote-picker__emoji":""}`,"data-tooltip-type":"emote","data-provider":X.provider,"data-id":X.id,"data-set":X.set_id,"data-code":X.code,"data-variant":X.variant,"data-no-source":se,"data-name":X.name,"aria-label":X.name,"data-locked":X.locked,"data-sellout":Ce,onClick:!X.locked&&this.clickEmote},M("figure",{class:"emote-picker__emote-figure",style:{backgroundPosition:`${Xe}% ${de}%`}}),X.favorite&&M("figure",{class:"ffz--favorite ffz-i-star"}),_e&&M("figure",{class:`ffz-i-${X.lock_icon||"lock"}`}))}},B(he,"FFZMenuEmojiSection"),he);let Z;const H=B(()=>requestAnimationFrame(()=>this.emit("tooltips:cleanup")),"doClear"),j=B(()=>{clearTimeout(Z),setTimeout(H,100)},"clearTooltips");this.MenuErrorWrapper=(Se=class extends $.Component{constructor(X){super(X),this.state={errored:!1,error:null}}static getDerivedStateFromError(X){return{errored:!0,error:X}}componentDidCatch(X){l.log.capture(X),l.log.error("Error rendering the FFZ Emote Menu."),this.setState({errored:!0,error:X})}render(){if(this.state.errored){if(!this.props.visible)return null;const X=l.chat.context.get("chat.emote-menu.reduced-padding");return M("div",{class:`ffz-balloon ffz-balloon--md ffz-il-tooltip--up ffz-il-tooltip--align-right tw-block tw-absolute ffz--emote-picker${X?" reduced-padding":""}`,"data-a-target":"emote-picker"},M("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},M("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},M("div",{class:"tw-align-center tw-pd-1"},M("div",{class:"tw-mg-b-1"},M("div",{class:"tw-mg-2"},M("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),l.i18n.t("emote-menu.error","There was an error rendering this menu."),M("br",null),l.settings.get("reports.error.enable")?l.i18n.t("emote-menu.error-report","An error report has been automatically submitted."):"",M("div",{class:"tw-mg-t-05 tw-border-t-1 tw-pd-t-05"},l.i18n.t("emote-menu.disable","As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.")))))))}return this.props.children}},B(Se,"FFZEmoteMenuErrorWrapper"),Se),this.MenuComponent=(De=class extends $.Component{constructor(X){super(X),this.nav_ref=null,this.saveNavRef=_e=>{this.nav_ref=_e},this.ref=null,this.saveScrollRef=_e=>{this.ref=_e,this.createObserver()},this.sections=[],this.activeSection=-1,this.state={tab:null,active_nav:null,stayLoaded:l.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:l.chat.context.get("chat.emote-menu.show-quick-nav"),animated:l.chat.context.get("chat.emotes.animated"),showHeading:l.chat.context.get("chat.emote-menu.show-heading"),tall:l.chat.context.get("chat.emote-menu.tall"),reducedPadding:l.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:l.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:l.chat.context.get("chat.emote-menu.show-search"),clearSearch:l.chat.context.get("chat.emote-menu.clear-search"),hasNewEffects:!1,unlockedEffects:l.settings.provider.get("unlocked-effects",[]),tone:l.settings.provider.get("emoji-tone",null)},X.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),this.rebuildData(),this.observing=new Map,this.addSection=_e=>{this.sections.includes(_e)||this.sections.push(_e)},this.removeSection=_e=>{const se=this.sections.indexOf(_e);se!==-1&&(this.sections.splice(se),se===this.activeSection?this.activeSection=-1:se<this.activeSection&&this.activeSection--)},this.startObserving=this.startObserving.bind(this),this.stopObserving=this.stopObserving.bind(this),this.handleObserve=this.handleObserve.bind(this),this.pickTone=this.pickTone.bind(this),this.clickTab=this.clickTab.bind(this),this.clickSideNav=this.clickSideNav.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.toggleVisibilityControl=this.toggleVisibilityControl.bind(this)}createObserver(){if(this.observer){if(this._observed===this.ref)return;this.observer.disconnect(),this.observer=this._observed=null}if(!(!this.ref||!window.IntersectionObserver)){this._observed=this.ref,this.observer=new IntersectionObserver(this.handleObserve,{root:this.ref,rootMargin:"50px 0px",threshold:.01});for(const X of this.observing.keys())this.observer.observe(X);this.observeSoon()}}observeSoon(){requestAnimationFrame(()=>{this.observer&&this.handleObserve(this.observer.takeRecords())})}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=this._observed=null)}scrollNavIntoView(){requestAnimationFrame(()=>{const X=this.nav_ref?.querySelector?.(`button[data-key="${this.state.active_nav}"]`);X&&J(X)})}handleObserve(X){let _e=!1,se=this.state.active_nav;for(const Ce of X){const Ne=this.observing.get(Ce.target),We=Ce.isIntersecting;!Ne||Ne.state.intersecting===We||(_e=!0,Ne.setState({intersecting:We}),We&&(se=Ne.props?.data?.key))}_e&&(requestAnimationFrame(j),!this.lock_active&&se!==this.state.active_nav&&this.setState({active_nav:se},()=>this.scrollNavIntoView()))}startObserving(X,_e){const se=this.observing.get(X);_e!==se&&(se&&this.stopObserving(X),this.observing.set(X,_e),this.observer&&this.observer.observe(X),this.observeSoon())}stopObserving(X){this.observing.has(X)&&(this.observing.delete(X),this.observer&&this.observer.unobserve(X))}componentDidMount(){this.ref&&this.createObserver(),l.chat.context.on("changed:chat.emotes.animated",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.show-heading",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.show-search",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.clear-search",this.updateSettingState,this),l.chat.context.on("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu=this}componentWillUnmount(){this.destroyObserver(),l.chat.context.off("changed:chat.emotes.animated",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.show-heading",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.show-search",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.clear-search",this.updateSettingState,this),l.chat.context.off("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu===this&&(window.ffz_menu=null)}updateSettingState(){this.setState({stayLoaded:l.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:l.chat.context.get("chat.emote-menu.show-quick-nav"),animated:l.chat.context.get("chat.emotes.animated"),showHeading:l.chat.context.get("chat.emote-menu.show-heading"),reducedPadding:l.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:l.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:l.chat.context.get("chat.emote-menu.show-search"),clearSearch:l.chat.context.get("chat.emote-menu.clear-search"),tall:l.chat.context.get("chat.emote-menu.tall")})}seeEffects(){this.state.hasNewEffects&&(l.settings.provider.set("unlocked-effects",this.state.unlockedEffects),this.setState({hasNewEffects:!1}))}pickTone(X){X=X||null,l.settings.provider.set("emoji-tone",X),this.setState(this.filterState(this.state.filter,this.buildEmoji(Object.assign({},this.state,{tone:X}))))}clickSideNav(X){const _e=X.currentTarget.dataset.key,se=this.ref?.querySelector?.(`section[data-key="${_e}"]`);se&&(this.lock_active=!0,J(se),this.setState({active_nav:_e}),setTimeout(()=>this.lock_active=!1,250))}clickTab(X){const _e=X.currentTarget.dataset.tab;if(_e==="effect"&&this.seeEffects(),this.state.combineTabs){let se;switch(_e){case"fav":se=this.state.filtered_fav_sets;break;case"channel":se=this.state.filtered_channel_sets;break;case"effect":se=this.state.filtered_effect_sets;break;case"emoji":se=this.state.filtered_emoji_sets;break;case"all":default:se=this.state.filtered_all_sets;break}const Ce=se&&se[0],Ne=Ce&&this.ref?.querySelector?.(`section[data-key="${Ce.key}"]`);Ne&&J(Ne);return}this.setState({tab:_e})}clickSettings(X){const _e=new y.FFZEvent({item:"chat.emote_menu",event:X,errored:!1});l.emit("main_menu:open",_e)}toggleVisibilityControl(){this.setState(this.filterState(this.state.filter,this.state,!this.state.visibility_control))}handleFilterChange(X){this.setState(this.filterState(X.target.value,this.state))}handleKeyDown(X){if(X.keyCode===L.KEYS.Escape)this.props.toggleVisibility();else return;X.preventDefault()}loadData(X=!1,_e,se){if(se=se||this.state,!se)return!1;_e=_e||this.props;const Ce=_e.emote_data&&_e.emote_data.emoteSets,Ne=Array.isArray(Ce)?new Set(Ce.map(We=>We.id)):new Set;return X=X||se.set_data&&!(0,P.set_equals)(se.set_sets,Ne),se.set_data&&!X?!1:(this.setState({loading:!0},()=>{l.getData(Ne,X).then(We=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{set_sets:Ne,set_data:We,loading:!1}))))})}),!0)}loadFFZPlanData(X=!1,_e,se){return se=se||this.state,!se||se.ffz_plan_loading||se.ffz_sub_data&&!X?!1:(this.setState({ffz_plan_loading:!0},()=>{l.getFFZSubPrices().then(Ce=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_plan_data:Ce,ffz_plan_loading:!1}))))})}),!0)}loadFFZSubData(X=!1,_e,se){return se=se||this.state,!se||se.ffz_loading||se.ffz_sub_data&&!X?!1:(this.setState({ffz_loading:!0},()=>{l.getFFZSubData().then(Ce=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{ffz_sub_data:Ce,ffz_loading:!1}))))})}),!0)}filterState(X,_e,se){const Ce=Object.assign({},_e);return se!=null?Ce.visibility_control=se:se=Ce.visibility_control,Ce.filter=X,Ce.filtered=X&&X.length>0&&X!==":"||!1,Ce.filtered_channel_sets=this.filterSets(X,Ce.channel_sets,se),Ce.filtered_effect_sets=this.filterSets(X,Ce.effect_sets,se),Ce.filtered_all_sets=this.filterSets(X,Ce.all_sets,se),Ce.filtered_fav_sets=this.filterSets(X,Ce.fav_sets,se),Ce.filtered_emoji_sets=this.filterSets(X,Ce.emoji_sets,se),Ce.has_effect_tab=Ce.filtered_effect_sets.length>0,Ce}filterSets(X,_e,se){const Ce=[];if(!_e||!_e.length)return Ce;const Ne=X&&X.length>0&&X!==":",We=p.get("emote-menu.hidden-sets")||[];for(const Xe of _e){if(!se&&We.includes(Xe.key))continue;(Xe.filtered_emotes=Xe.emotes.filter(ke=>!se&&ke.hidden?!1:!Ne||!ke.locked&&this.doesEmoteMatch(X,ke))).length&&Ce.push(Xe)}return Ce}doesEmoteMatch(X,_e){if(!X||!X.length)return!0;const se=_e.search||_e.name,Ce=se.toLowerCase(),Ne=X.toLowerCase(),We=X.startsWith(":"),Xe=Ne.slice(1);if(Array.isArray(_e.extra)){let ke=_e.extra.length;for(;ke--;){if(!We&&_e.extra[ke].includes(Ne))return!0;if(We&&_e.extra[ke].startsWith(Xe))return!0}}if(!We)return Ce.includes(Ne);if(Ce.startsWith(Xe))return!0;const de=se.indexOf(X.charAt(1).toUpperCase());return de!==-1?Ce.slice(de+1).startsWith(Ne.slice(2)):!1}buildEmoji(X){const _e=Object.assign({},X),se=_e.emoji_sets=[],Ce=l.emotes.getFavorites("emoji"),Ne=_e.favorites=(_e.favorites||[]).filter(ke=>!ke.emoji),We=_e.tone=_e.tone||null,Xe=_e.tone_emoji=[],de={};if(l.chat.context.get("chat.emote-menu.show-emoji")){let ke=l.chat.context.get("chat.emoji.style")||"twitter";v.Vf[ke]||(ke="twitter");for(const $e of Object.values(l.emoji.emoji)){if(!$e||!$e.has[ke]||v.D3.includes($e.category))continue;if($e.variants){for(const Bt of $e.names)if(O.includes(Bt)){Xe.push($e);break}}const Ge=Ce.includes($e.code),rt=$e.variants&&$e.variants[We],at=rt&&rt.has[ke],At=at?rt:$e;let kt=de[$e.category];kt||(kt=de[$e.category]=[],se.push({key:`emoji-${$e.category}`,sort_key:v.of.indexOf($e.category),emoji:!0,image:l.emoji.getFullImage(At.image),i18n:`emoji.category.${$e.category.toSnakeCase()}`,title:v.aA[$e.category]||$e.category,src:"emoji",source:"Emoji",source_i18n:"emote-menu.emoji",emotes:kt}));const It={provider:"emoji",id:$e.sort,emoji:!0,code:$e.code,name:At.raw,variant:at&&We,hidden:$e.hidden,search:$e.names[0],extra:$e.names.length>1?$e.names.map(Bt=>Bt.toLowerCase()):null,height:18,width:18,x:At.sheet_x,y:At.sheet_y,favorite:Ge,src:l.emoji.getFullImage(At.image),srcSet:l.emoji.getFullImageSet(At.image)};kt.push(It),Ge&&Ne.push(It)}}return _e.has_emoji_tab=se.length>0,_e.fav_sets=[{key:"favorites",title:"Favorites",i18n:"emote-menu.favorites",icon:"star",source:"",is_favorites:!0,emotes:Ne}],Ne.sort(this.getSorter()),se.sort(re),_e}getAllSets(){return[...this.state.channel_sets||[],...this.state.effect_sets||[],...this.state.all_sets||[]]}getSorter(){return q[l.chat.context.get("chat.emote-menu.sort-emotes")]||q[0]||(()=>0)}buildState(X,_e){const se=Object.assign({},_e),Ce=se.set_data||{},Ne=se.emote_modifiers={},We=se.channel_sets=[],Xe=se.all_sets=[],de=se.effect_sets=[],ke=se.favorites=[];if(X.loading||X.error||se.loading||se.set_data&&this.loadData(!1,X,se))return se;const $e=this.getSorter(),Ge=l.chat.context.get("chat.emote-menu.sort-tiers-last"),rt=B((ct,tt)=>{if(ct.misc||tt.misc)return $e(ct,tt);if(!ct.locked&&tt.locked)return-1;if(ct.locked&&!tt.locked)return 1;if(Ge||ct.locked||tt.locked)if(ct.bits||tt.bits){if(tt.bits){if(!ct.bits)return-1}else return 1;const Ot=ct.bit_value||0,$t=tt.bit_value||0;if(V){const St=V.compare(Ot,$t);if(St!=0)return St}else{if(Ot<$t)return-1;if(Ot>$t)return 1}}else if(V){const Ot=V.compare(ct.set_id,tt.set_id);if(Ot!=0)return Ot}else{if(ct.set_id<tt.set_id)return-1;if(ct.set_id>tt.set_id)return 1}return $e(ct,tt)},"sort_emotes"),at=X.channel_data&&X.channel_data.user,At=at&&at.subscriptionProducts,kt=at&&X.channel_data?.channel?.localEmoteSets,It=at&&at.self?.follower!=null,Bt=!It&&X.user_id&&at?.id!=X.user_id,Et=at?.cheer?.badgeTierEmotes,Lt=new Set;if(Array.isArray(kt))for(const ct of kt)ct?.id&&Lt.add(ct.id);const Dt=X.emote_data&&X.emote_data.emoteSets,Qt=X.emote_data&&X.emote_data.emoteMap,Nt=l.emotes.getFavorites("twitch"),jt=l.emotes.getHidden("twitch"),ut=new Set,dt=[],mt={},Tt=new Set;if(Array.isArray(Dt))for(const ct of Dt){if(!ct||!Array.isArray(ct.emotes))continue;const tt=ct.id,Ot=parseInt(tt,10),$t=ct.owner,St=Lt.has(tt),Ft=!St&&Ot>5e8,pt=L.TWITCH_POINTS_SETS.includes(Ot)||$t?.login==="channel_points",et=St?at:pt?null:$t,lt=Ce[tt],gt=Ft&&$t&&$t.id==at?.id;Tt.add(tt);let ft=`twitch-set-${tt}`,ot=0,_t="twitch",vt=et&&(et.displayName||et.login);if(vt?(ft=`twitch-${et?.id}`,St?l.emotes.setTwitchSetChannel(tt,{id:tt,type:L.EmoteTypes.Follower,owner:{id:et.id,login:et.login,displayName:et.displayName}}):Ft?l.emotes.setTwitchSetChannel(tt,{id:tt,type:L.EmoteTypes.BitsTier,owner:{id:et.id,login:et.login,displayName:et.displayName}}):l.emotes.setTwitchSetChannel(tt,{id:tt,type:L.EmoteTypes.Subscription,owner:{id:et.id,login:et.login,displayName:et.displayName}})):et?vt=l.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:tt}):pt?(vt=l.i18n.t("emote-menu.points","Unlocked with Points"),ft="twitch-points",_t="channel-points",ot=45):L.TWITCH_GLOBAL_SETS.includes(Ot)?(vt=l.i18n.t("emote-menu.global","Global Emotes"),ft="twitch-global",ot=100,l.emotes.setTwitchSetChannel(tt,{id:tt,type:L.EmoteTypes.Global,owner:null})):L.TWITCH_PRIME_SETS.includes(Ot)?(vt=l.i18n.t("emote_menu.prime","Prime"),ft="twitch-prime",_t="crown",ot=75,l.emotes.setTwitchSetChannel(tt,{id:tt,type:L.EmoteTypes.Prime,owner:null})):(vt=l.i18n.t("emote-menu.misc","Miscellaneous"),ft="twitch-misc",_t="inventory",ot=50),St)continue;let Ut,Gt;mt[ft]?(Ut=mt[ft],Gt=Ut.emotes,lt&&Ut.bad&&(Ut.bad=!1,Ut.renews=lt.renews,Ut.ends=lt.ends,Ut.prime=lt.prime,Ut.gift=lt.gift)):(Gt=[],Ut=mt[ft]={sort_key:ot,key:ft,image:et?.profileImageURL,image_large:!0,icon:_t,title:vt,source:l.i18n.t("emote-menu.twitch","Twitch"),emotes:Gt,renews:lt?.renews,ends:lt?.ends,prime:lt?.prime,gift:lt?.gift},lt||(Ut.bad=!0));let gi=0;for(const Vt of ct.emotes){if(!Vt||!Vt.id||!Vt.token)continue;const Mt=Vt.id,Ci=L.KNOWN_CODES[Vt.token]||Vt.token,qt=Qt&&Qt[Ci];pt||l.emotes.setTwitchEmoteSet(Mt,tt);const _i=[""];if(Array.isArray(Vt.modifiers)&&Vt.modifiers.length&&l.chat.context.get("chat.emote-menu.modifiers")===1)for(const ni of Vt.modifiers)_i.push(`_${ni.code}`);for(const ni of _i){const Xt=`${Mt}${ni}`,ti=`${Ci}${ni}`,bi=Nt.includes(Xt),Vi=qt&&qt.id!=Xt,ii=L.REPLACEMENTS[Xt];let ui,Bi,ri,xi;ii&&l.chat.context.get("chat.fix-bad-emotes")?ui=`${L.REPLACEMENT_BASE}${ii}`:(ui=(0,P.getTwitchEmoteURL)(Xt,1,!1),Bi=(0,P.getTwitchEmoteSrcSet)(Xt,!1),ri=(0,P.getTwitchEmoteURL)(Xt,1,!0),xi=(0,P.getTwitchEmoteSrcSet)(Xt,!0));const di={provider:"twitch",id:Xt,set_id:tt,name:ti,src:ui,srcSet:Bi,animSrc:ri,animSrcSet:xi,order:gi++,overridden:Vi?qt.id:null,misc:!et,bits:Ft,hidden:jt.includes(Xt),favorite:bi};Gt.push(di),gt&&dt.push(di),bi&&!ut.has(Xt)&&ke.push(di),ut.add(Xt)}}Gt.length&&(Gt.sort(rt),Xe.includes(Ut)||Xe.push(Ut))}if(Array.isArray(kt)||Array.isArray(At)||Array.isArray(Et)){const ct=l.badges.getTwitchBadge("subscriber","0",at.id,at.login),tt=[],Ot=new Set,$t={},St={sort_key:-10,key:"twitch-current-channel",hide_key:`twitch-${at.id}`,image:ct&&ct.image1x,image_set:ct&&`${ct.image1x} 1x, ${ct.image2x} 2x, ${ct.image4x} 4x`,icon:"twitch",title:l.i18n.t("emote-menu.main-set","Channel Emotes"),source:l.i18n.t("emote-menu.twitch","Twitch"),emotes:tt,locks:$t,all_locked:!0};if(Array.isArray(kt))for(const pt of kt){if(!pt||!Array.isArray(pt.emotes))continue;const et=pt.id;let lt;Bt&&($t[et]={set_id:et,id:"follower",user:at?.displayName||at?.login,hide_button:!0,emotes:lt=new Set});let gt=0;for(const ft of pt.emotes){if(!ft||!ft.id||!ft.token)continue;const ot=ft.id,_t=L.KNOWN_CODES[ft.token]||ft.token,vt=ut.has(ot),Ut=Nt.includes(ot),Gt={provider:"twitch",id:ot,set_id:et,name:_t,order:gt++,src:(0,P.getTwitchEmoteURL)(ot,1,!1),srcSet:(0,P.getTwitchEmoteSrcSet)(ot,!1),animSrc:(0,P.getTwitchEmoteURL)(ot,1,!0),animSrcSet:(0,P.getTwitchEmoteSrcSet)(ot,!0),favorite:Ut,hidden:jt.includes(ot),locked:Bt,lock_icon:"heart"};tt.push(Gt),Ut&&!vt&&ke.push(Gt),ut.add(ot),lt&&lt.add(ot)}}if(Array.isArray(At))for(const pt of At){if(!pt||!Array.isArray(pt.emotes))continue;const et=pt.emoteSetID,lt=Ce[et],gt=!Tt.has(et);let ft;lt&&(St.renews=lt.renews,St.ends=lt.ends,St.prime=lt.prime,St.gift=lt.gift&&lt.gift.isGift),gt?$t[et]={set_id:et,id:pt.id,price:pt.price||D[pt.tier],url:pt.url,emotes:ft=new Set(Ot)}:St.all_locked=!1;let ot=0;for(const _t of pt.emotes){if(!_t||!_t.id||!_t.token)continue;const vt=_t.id,Ut=L.KNOWN_CODES[_t.token]||_t.token,Gt=ut.has(vt),gi=Nt.includes(vt),Vt={provider:"twitch",id:vt,set_id:et,name:Ut,order:ot++,locked:gt&&!Gt,src:(0,P.getTwitchEmoteURL)(vt,1,!1),srcSet:(0,P.getTwitchEmoteSrcSet)(vt,!1),animSrc:(0,P.getTwitchEmoteURL)(vt,1,!0),animSrcSet:(0,P.getTwitchEmoteSrcSet)(vt,!0),favorite:gi,hidden:jt.includes(vt)};tt.push(Vt),!gt&&gi&&!Gt&&ke.push(Vt),ut.add(vt),ft&&(Ot.add(vt),ft.add(vt))}}const Ft=new Set;if(Array.isArray(Et)){let pt;for(const et of Et){if(!et||!et.id||!et.bitsBadgeTierSummary)continue;const lt=et.id,gt=et.setID,ft=et.bitsBadgeTierSummary,ot=!ut.has(lt)&&!ft.self?.isUnlocked;ot&&($t[gt]={set_id:gt,id:"cheer",price:null,bits:ft.threshold,bits_remaining:ft.self?.numberOfBitsUntilUnlock??ft.threshold,emotes:new Set([et.id])});const _t=Nt.includes(lt),vt={provider:"twitch",id:lt,set_id:gt,name:et.token,locked:ot,order:pt++,src:(0,P.getTwitchEmoteURL)(lt,1,!1),srcSet:(0,P.getTwitchEmoteSrcSet)(lt,!1),animSrc:(0,P.getTwitchEmoteURL)(lt,1,!0),animSrcSet:(0,P.getTwitchEmoteSrcSet)(lt,!0),bits:!0,bit_value:ft.threshold,favorite:_t,hidden:jt.includes(lt)};tt.push(vt),!ot&&_t&&!ut.has(lt)&&ke.push(vt),Ft.add(lt),ut.add(lt)}}if(dt.length)for(const pt of dt)Ft.has(pt.id)||tt.push(pt);tt.length&&(tt.sort(rt),We.push(St))}let Rt=!1,ei=!1,Jt=!1;const hi=[...l.settings.provider.get("unlocked-effects",[])];if(l.chat.context.get("chat.emotes.enabled")>1){const ct=l.site.getUser(),tt=l.chat.context.get("chat.emote-menu.effect-tab"),Ot=l.emotes.getRoomSetsWithSources(ct?.id,ct?.login,X.channel_id,null),$t=l.emotes.getSubSetsWithSources(),St=l.emotes.getGlobalSetsWithSources(ct?.id,ct?.login),Ft=new Set,pt={};let et={};for(const[gt,ft,ot]of Ot){if(Ft.has(gt))continue;Ft.add(gt);const _t=this.processFFZSet(gt,ft,ke,pt,et,!1,void 0,ot,X.channel_id);_t&&(_t.emotes.sort(rt),We.includes(_t)||We.push(_t))}et={};const lt=St.map(gt=>gt?.[0]?.id);for(const[gt,ft]of $t){if(Ft.has(gt))continue;Ft.add(gt);const ot=!lt.includes(gt.id);Rt=!0;const _t=this.processFFZSet(gt,ft,ke,pt,et,ot,se);_t&&(_t.emotes.sort(rt),tt&&!de.includes(_t)&&_t.has_effects?(Jt=this.checkNewEffects(_t.emotes,hi)||Jt,de.push(_t)):Xe.includes(_t)||Xe.push(_t))}et={};for(const[gt,ft]of St){if(Ft.has(gt))continue;Ft.add(gt);const ot=this.processFFZSet(gt,ft,ke,pt,et);ot&&(ot.emotes.sort(rt),tt&&!de.includes(ot)&&ot.has_effects?(Jt=this.checkNewEffects(ot.emotes,hi)||Jt,de.push(ot)):Xe.includes(ot)||Xe.push(ot),!We.includes(ot)&&(0,P.maybe_call)(ot.force_global,this,gt,X.channel_data&&X.channel_data.user,ct)&&We.push(ot))}}return se.wants_resub_info=Rt,se.wants_plan_info=ei,this.props.visible&&(se.tab==="effects"&&(Jt=!1),ei&&this.loadFFZPlanData(),Rt&&this.loadFFZSubData()),We.sort(re),de.sort(re),Xe.sort(re),se.has_channel_tab=We.length>0,se.has_effect_tab=de.length>0,se.hasNewEffects=de.length>0&&Jt,se.unlockedEffects=hi,this.buildEmoji(se)}checkNewEffects(X,_e){let se=!1;for(const Ce of X)Ce&&!Ce.locked&&Ce.id&&Ce.provider==="ffz"&&!_e.includes(Ce.id)&&(se=!0,_e.push(Ce.id));return se}processFFZSet(X,_e,se,Ce,Ne,We=!1,Xe,de,ke=null){if(!X||!X.emotes)return null;let $e;if(de){const ut=l.parent.shared_room_data?.get(de);$e=ut?.displayName??ut?.login}const Ge=X.source||"ffz",rt=l.emotes.getFavorites(Ge),at=l.emotes.getHidden(Ge),At=Ce[Ge]=Ce[Ge]||new Set,kt=`${X.merge_source||Ge}-${X.merge_id||X.id}`,It=l.emotes.providers.get(_e),Bt=It&&It.menu_name?It.menu_i18n_key?l.i18n.t(It.menu_i18n_key,It.menu_name,It):It.menu_name:X.source||"FFZ",Et=_e==="ffz-main"||X.title_is_channel?$e?l.i18n.t("emote-menu.source-set","{channel}'s Emotes",{channel:$e}):l.i18n.t("emote-menu.main-set","Channel Emotes"):X.title||l.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:X.id});let Lt=It&&It.sort_key||X.sort;Lt==null&&(Lt=X.title.toLowerCase().includes("global")?100:0),de&&de!==ke&&(Lt+=50);let Dt,Qt,Nt;Ne[kt]?(Dt=Ne[kt],Qt=Dt.emotes,kt===`${Ge}-${X.id}`&&Object.assign(Dt,{sort_key:Lt,image:X.icon,title:Et,source:Bt,channel_source:$e,force_global:X.force_global})):(Qt=[],Dt=Ne[kt]={sort_key:Lt,key:kt,image:X.icon,icon:"zreknarf",title:Et,source:Bt,channel_source:$e,emotes:Qt,force_global:X.force_global,all_locked:!0});const jt=(Xe||this.state)?.ffz_sub_data?.sets?.[X.id];jt&&(Dt.renews=jt.next_bill_date,Dt.ends=jt.expires_at),We?(Dt.locks=Dt.locks||{},Dt.locks[X.id]={set_id:X.id,id:"subwoofer",is_ffz:!0,price:"More Info",url:"https://www.frankerfacez.com/subscribe",emotes:Nt=new Set}):Dt.all_locked=!1;for(const ut of Object.values(X.emotes))if(!ut.hidden){const dt=rt.includes(ut.id),mt={provider:"ffz",id:ut.id,set_id:X.id,src:ut.src,srcSet:ut.srcSet,animSrc:ut.animSrc,animSrcSet:ut.animSrcSet,effects:ut.modifier?ut.modifier_flags:0,effect_prefix:ut.modifier?ut.modifier_prefix:!1,name:ut.name,favorite:dt,locked:We,hidden:at.includes(ut.id),height:ut.height,width:ut.width};Qt.push(mt),!We&&dt&&!At.has(ut.id)&&(se.push(mt),At.add(ut.id)),We&&Nt.add(ut.id),ut.modifier&&ut.modifier_flags&&(Dt.has_effects=!0)}if(Qt.length)return Dt}rebuildData(){const X=this.buildState(this.props,this.state);this.setState(this.filterState(X.filter,X))}componentDidUpdate(X){if(this.props.visible&&!X.visible&&(this.loadData(),this.state.wants_plan_info&&this.loadFFZPlanData(),this.state.wants_resub_info&&this.loadFFZSubData()),!this.props.visible&&X.visible&&this.state.clearSearch){this.setState(this.filterState("",this.state));return}const _e=this.props.channel_data,se=X.channel_data,Ce=_e?.user!==se?.user||_e?.channel!==se?.channel,Ne=this.props.emote_data,We=X.emote_data,Xe=!(0,P.deep_equals)(Ne?.emoteSets,We?.emoteSets)||!(0,P.deep_equals)(Ne?.emoteMap,We?.emoteMap);(Ce||Xe||this.props.user_id!==X.user_id||this.props.channel_id!==X.channel_id||this.props.loading!==X.loading||this.props.error!==X.error)&&(l.log.debug("Updating emote menu data. cd",Ce,", ed",Xe),this.rebuildData())}renderError(){return M("div",{class:"tw-align-center tw-pd-1"},M("div",{class:"tw-mg-b-1"},M("div",{class:"tw-mg-2"},M("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),l.i18n.t("emote-menu.error","There was an error rendering this menu.")),M("button",{class:"tw-button",onClick:this.forceUpdate},M("span",{class:"tw-button__text"},l.i18n.t("error.try-again","Try Again"))))}renderEmpty(){return M("div",{class:"tw-align-center tw-pd-1"},M("div",{class:"tw-mg-2"},M("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),this.state.filtered?l.i18n.t("emote-menu.empty-search","There are no matching emotes."):this.state.tab==="fav"?l.i18n.t("emote-menu.empty-favs","You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.",{hotkey:L.IS_OSX?"\u2318":"Ctrl"}):l.i18n.t("emote-menu.empty","There's nothing here."))}renderLoading(){return M("div",{class:"tw-align-center tw-pd-1"},M("h1",{class:"tw-mg-5 ffz-i-zreknarf loading"}),l.i18n.t("emote-menu.loading","Loading..."))}render(){if(!this.props.visible&&(!this.state.stayLoaded||!this.loadedOnce))return null;const X=this.state.loading||this.props.loading,_e=this.state.reducedPadding,se=this.state.combineTabs;X||(this.loadedOnce=!0);let Ce,Ne,We,Xe,de;if(se)Ne=[this.state.filtered_fav_sets,this.state.filtered_channel_sets,this.state.filtered_effect_sets,this.state.filtered_all_sets,this.state.filtered_emoji_sets].flat();else switch(Ce=this.state.tab||l.chat.context.get("chat.emote-menu.default-tab"),(Ce==="effect"&&!this.state.has_effect_tab||Ce==="channel"&&!this.state.has_channel_tab||Ce==="emoji"&&!this.state.has_emoji_tab)&&(Ce="all"),We=Ce==="emoji",Xe=Ce==="fav",de=Ce==="effect",Ce){case"fav":Ne=this.state.filtered_fav_sets;break;case"channel":Ne=this.state.filtered_channel_sets;break;case"effect":Ne=this.state.filtered_effect_sets;break;case"emoji":Ne=this.state.filtered_emoji_sets;break;case"all":default:Ne=this.state.filtered_all_sets;break}const ke=this.state.visibility_control,$e=this.props.source==="whisper";return M("div",{class:`tw-block${this.props.visible?"":" tw-hide"}`,style:{display:this.props.visible?null:"none !important"}},M("div",{class:"tw-absolute ffz-attached ffz-attached--right ffz-attached--up"},M("div",{class:`ffz-balloon ffz-balloon--auto tw-inline-block tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2 ffz--emote-picker${this.state.tall?" ffz--emote-picker__tall":""}${_e?" reduced-padding":""}`,"data-a-target":"emote-picker",role:"dialog"},M("div",{class:`emote-picker${$e?"__whisper":""}`},M("div",{class:"tw-flex"},M("div",{class:`emote-picker__tab-content${$e?"-whisper":""} tw-full-width scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},M("div",{ref:this.saveScrollRef,class:"simplebar-scroll-content"},M("div",{class:"simplebar-content"},X&&this.renderLoading(),!X&&Ne&&Ne.map((Ge,rt)=>Ge&&(!ke||!Ge.emoji&&!Ge.is_favorites)&&M(Ge.emoji?l.EmojiSection:l.MenuSection,{key:Ge.key,idx:rt,data:Ge,ffz_sub_data:this.state.ffz_sub_data,emote_modifiers:this.state.emote_modifiers,animated:this.state.animated,combineTabs:this.state.combineTabs,showHeading:this.state.showHeading,filtered:this.state.filtered,visibility_control:ke,onClickToken:this.props.onClickToken,addSection:this.addSection,removeSection:this.removeSection,startObserving:this.startObserving,stopObserving:this.stopObserving})),!X&&(!Ne||!Ne.length)&&this.renderEmpty()))),!X&&this.state.quickNav&&!Xe&&M("div",{class:`emote-picker__nav_content${$e?"-whisper":""} tw-block tw-border-radius-none tw-c-background-alt-2`},M("div",{class:`emote-picker__nav-content-overflow${$e?"-whisper":""} scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},M("div",{ref:this.saveNavRef,class:"simplebar-scroll-content"},M("div",{class:"simplebar-content"},!X&&Ne&&Ne.map(Ge=>{if(!Ge||ke&&(Ge.is_favorites||Ge.emoji))return null;const rt=this.state.active_nav===Ge.key;return M("button",{key:Ge.key,class:`${rt?"emote-picker-tab-item-wrapper__active ":""}${_e?"tw-mg-y-05":"tw-mg-y-1"} tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse`,"data-key":Ge.key,"data-title":`${Ge.i18n?l.i18n.t(Ge.i18n,Ge.title):Ge.title}
${Ge.source_i18n?l.i18n.t(Ge.source_i18n,Ge.source):Ge.source}${Ge.channel_source?` (${Ge.channel_source})`:""}`,"data-tooltip-side":"left",onClick:this.clickSideNav},M("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${_e?"":"tw-pd-x-05 "}tw-pd-y-05${rt?" emote-picker-tab-item-avatar__active tw-c-text-link":""}`},Ge.image?M("figure",{class:"ffz-avatar ffz-avatar--size-20"},M("img",{class:"tw-block tw-border-radius-rounded tw-img tw-image-avatar",src:Ge.image,srcSet:Ge.image_set})):M("figure",{class:`ffz-emote-picker--nav-icon ffz-i-${Ge.icon||"zreknarf"}`})))}),se&&M("div",{class:"tw-mg-y-1 tw-mg-x-05 tw-border-t"}),se&&M("button",{class:"tw-mg-y-1 tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse","data-title":l.i18n.t("emote-menu.settings","Open Settings"),"data-tooltip-side":"left",onClick:this.clickSettings},M("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${_e?"":"tw-pd-x-05 "}tw-pd-y-05`},M("figure",{class:"ffz-emote-picker--nav-icon ffz-i-cog"})))))))),M("div",{class:"emote-picker__controls-container tw-relative"},(We||this.state.showSearch)&&M("div",{class:"tw-border-t tw-pd-1"},M("div",{class:"tw-flex"},M("input",{type:"text",class:"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width ffz-input tw-pd-x-1 tw-pd-y-05",placeholder:We?l.i18n.t("emote-menu.search-emoji","Search for Emoji"):l.i18n.t("emote-menu.search","Search for Emotes"),value:this.state.filter,autoFocus:!0,autoCapitalize:"off",autoCorrect:"off",onChange:this.handleFilterChange,onKeyDown:this.handleKeyDown}),(se||We)&&!ke&&this.state.has_emoji_tab&&M(l.EmojiTonePicker,{tone:this.state.tone,choices:this.state.tone_emoji,pickTone:this.pickTone}),(se||!We)&&M("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},M("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon--primary ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.state.visibility_control?" ffz-core-button--primary":" tw-button-icon"}`,onClick:this.toggleVisibilityControl},M("span",{class:"tw-button-icon__icon tw-mg-x-05"},M("figure",{class:this.state.visibility_control?"ffz-i-eye-off":"ffz-i-eye"}))),M("div",{class:"ffz-il-tooltip ffz-il-tooltip--up ffz-il-tooltip--align-right"},this.state.visibility_control?l.i18n.t("emote-menu.toggle-hide.on","Exit Emote Visibility Control"):l.i18n.t("emote-menu.toggle-hide.off","Emote Visibility Control"),M("div",{class:"tw-mg-t-1 ffz--tooltip-explain"},l.i18n.t("emote-menu.toggle-hide.info","Emote Visibility Control allows you to hide emotes from your emote menu, either individually or by set. With Emote Visibility Control enabled, just click an emote to hide or unhide it. Please note that you will still see the emotes in chat if someone uses them, but they won't appear in your emote menu.")))))),se&&this.state.quickNav?null:M("div",{class:"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt"},!ke&&M("div",{class:`emote-picker-tab-item${Ce==="fav"?" emote-picker-tab-item--active":""} tw-relative`},M("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="fav"?" ffz-interactable--selected":""}`,id:"emote-picker__fav","data-tab":"fav","data-tooltip-type":"html","data-title":l.i18n.t("emote-menu.favorites","Favorites"),onClick:this.clickTab},M("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},M("figure",{class:"ffz-i-star"})))),this.state.has_channel_tab&&M("div",{class:`emote-picker-tab-item${Ce==="channel"?" emote-picker-tab-item--active":""} tw-relative`},M("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="channel"?" ffz-interactable--selected":""}`,id:"emote-picker__channel","data-tab":"channel","data-tooltip-type":"html","data-title":l.i18n.t("emote-menu.channel","Channel"),onClick:this.clickTab},M("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},M("figure",{class:"ffz-i-camera"})))),this.state.has_effect_tab&&M("div",{class:`emote-picker-tab-item${Ce==="effect"?" emote-picker-tab-item--active":""} tw-relative`},M("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="effect"?" ffz-interactable--selected":""}`,id:"emote-picker__effect","data-tab":"effect","data-tooltip-type":"html","data-title":l.i18n.t("emote-menu.effects","Emote Effects"),onClick:this.clickTab},this.state.hasNewEffects&&M("div",{class:"ffz-new-indicator"}),M("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},M("figure",{class:"ffz-i-fx"})))),M("div",{class:`emote-picker-tab-item${Ce==="all"?" emote-picker-tab-item--active":""} tw-relative`},M("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="all"?" ffz-interactable--selected":""}`,id:"emote-picker__all","data-tab":"all","data-tooltip-type":"html","data-title":l.i18n.t("emote-menu.my-emotes","My Emotes"),onClick:this.clickTab},M("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},M("figure",{class:"ffz-i-channels"})))),!ke&&this.state.has_emoji_tab&&M("div",{class:`emote-picker-tab-item${Ce==="emoji"?" emote-picker-tab-item--active":""} tw-relative`},M("button",{class:`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${Ce==="emoji"?" ffz-interactable--selected":""}`,id:"emote-picker__emoji","data-tab":"emoji","data-tooltip-type":"html","data-title":l.i18n.t("emote-menu.emoji","Emoji"),onClick:this.clickTab},M("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},M("figure",{class:"ffz-i-smile"})))),M("div",{class:"tw-flex-grow-1"}),M("div",{class:"emote-picker-tab-item tw-relative"},M("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive","data-tooltip-type":"html","data-title":l.i18n.t("emote-menu.settings","Open Settings"),onClick:this.clickSettings},M("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},M("figure",{class:"ffz-i-cog"}))))))))))}},B(De,"FFZEmoteMenuComponent"),De),this.fine.wrap("ffz-emote-menu",this.MenuComponent)}async getFFZSubPrices(){let l;try{l=await fetch(`${this.staging.api}/payment/plans`).then($=>$.ok?$.json():null)}catch($){this.log.error("Unable to load subscription prices from server.",$),l=null}const p={sets:{}};for(const $ of Object.values(l.plans)){if(!Array.isArray($.temporary_collections))continue;let M;for(const Z of Object.values(l.gateway_plans))if(Z.plan_id===$.id&&Z.months===1){M=Z.prices;break}if(M)for(const Z of $.temporary_collections)p.sets[Z]={plan_id:$.id,prices:M}}return p}async getFFZSubData(){if(!this.resolve("site").getUser())return null;const p=await this.resolve("socket").getBareAPIToken();if(!p)return null;let $;try{$=await fetch(`${this.staging.api}/v2/subscription/status?include=plan`,{headers:{Authorization:`Bearer ${p}`}}).then(Z=>Z.ok?Z.json():null)}catch(Z){this.log.error("Unable to load subscription status from server.",Z),$=null}if(!$)return{error:!0};const M={has_free_sub:$.user?.bonus_month_eligible??!1,sets:{}};if($.user?.active_subs)for(const Z of Object.values($.user.active_subs)){const H=$.plans?.[Z.id];if(Array.isArray(H?.temporary_collections))for(const j of H.temporary_collections)M.sets[j]={plan_id:Z.id,expires_at:Z.expires_at?new Date(Z.expires_at):null,next_bill_date:Z.next_bill_date?new Date(Z.next_bill_date):null}}return M}async getData(l,p,$=null,M=[]){if(this._data){if(!p&&(0,P.set_equals)(l,this._data_sets))return this._data;this._data=null,this._data_sets=null}let Z;try{Z=await this.apollo.client.query({query:A(),variables:{first:75,after:$,criteria:{filter:"ALL"}},fetchPolicy:p?"network-only":"cache-first"})}catch(he){return this.log.warn("Error fetching additional emote menu data.",he),this._data=null}const H={},j=(0,P.get)("data.currentUser.subscriptionBenefits.edges.@each.node",Z),U=(0,P.get)("data.currentUser.subscriptionBenefits.pageInfo.hasNextPage",Z),ee=(0,P.get)("data.currentUser.subscriptionBenefits.edges.@last.cursor",Z);if(M=M.concat(j),U)return this.getData(l,p,ee,M);if(M&&M.length)for(const he of M){const Se=he&&he.product,De=Se&&Se.emoteSetID;De&&(H[De]={ends:G(he.endsAt),renews:G(he.renewsAt),prime:he.purchasedWithPrime,set_id:De,type:Se.type,gift:he.gift?.isGift})}return this._data_sets=l,this._data=H}};B(qe,"EmoteMenu");let ae=qe;ae.getData=(0,P.once)(ae.getData),ae.getFFZSubData=(0,P.once)(ae.getFFZSubData),ae.getFFZSubPrices=(0,P.once)(ae.getFFZSubPrices);const fe=Intl.Collator(),be=Intl.Collator(void 0,{sensitivity:"accent"}),Pe=0,ne=1,ie=2,le=3,ze=4;function oe(nt){return nt?nt.type==="emote"?nt.emoteName:nt.type==="text"?nt.text:Array.isArray(nt.children)?nt.children.map(oe).join(""):"":""}B(oe,"getNodeText");function we(nt,l){let p=0,$=0,M=nt;for(;$<l.length;){const Z=l[$];for(let H=0;H<Z;H++)p+=oe(M[H]).length;M=Array.isArray(M[Z])?M[Z]:M[Z]?.children,$++}return p}B(we,"getNodeOffset");const st=class st extends x.default{constructor(...l){super(...l),this.inject("chat"),this.inject("chat.actions"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.settings.add("chat.hype.display-input",{default:!0,ui:{path:"Chat > Hype Chat >> Input",title:"Allow the Hype Chat button to appear in the chat input element.",component:"setting-check-box"}}),this.settings.add("chat.inline-preview.enabled",{default:!0,ui:{path:"Chat > Input >> Appearance",title:"Display in-line previews of FrankerFaceZ emotes when entering a chat message.",description:"**Note:** This feature is temperamental. It may not display all emotes, and emote effects and overlay emotes are not displayed correctly. Once this setting has been enabled, it cannot be reasonably disabled and will remain active until you refresh the page.",component:"setting-check-box"}}),this.settings.add("chat.mru.enabled",{default:!0,ui:{path:"Chat > Input >> Recent Messages",title:"Allow pressing up and down to recall previously sent chat messages.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.ffz-emotes",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of FrankerFaceZ emotes.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emoji",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emoji.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emotes-without-colon",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emotes without typing a colon. (:)",description:"This will prevent the tab-completion of usernames without the @ prefix.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.limit-results",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Limit tab-completion results to 25.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-favorites",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize favorite emotes at the top.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-prefix-matches",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize emotes that start with user input.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.matching",{default:1,ui:{path:"Chat > Input >> Tab Completion",title:"Emote Matching Type",description:"1: `ppa` would match `Kappa`\n\n2: `sip` would match `cohhSip` but not `Gossip`\n\n3: `pasta` would match `pastaThat` but not `HoldThat`",component:"setting-select-box",data:[{value:1,title:"1: Anything (Twitch style)"},{value:2,title:"2: Non-Prefix (Old FFZ style)"},{value:3,title:"3: Exact (Case-Insensitive)"}]}}),this.ChatInput=this.fine.define("chat-input",p=>p&&p.setLocalChatInputRef&&p.setLocalAutocompleteInputRef,m.Z.CHAT_ROUTES),this.EmoteSuggestions=this.fine.define("tab-emote-suggestions",p=>p&&p.getMatches&&p.autocompleteType==="emote",m.Z.CHAT_ROUTES),this.MentionSuggestions=this.fine.define("tab-mention-suggestions",p=>p&&p.getMentions&&p.renderMention,m.Z.CHAT_ROUTES),this.CommandSuggestions=this.fine.define("tab-cmd-suggestions",p=>p&&p.getMatches&&p.doesCommandMatchTerm,m.Z.CHAT_ROUTES),this.EmoteUsageCount={TriHard:196568036,Kappa:192158118,"4Head":155758710,PogChamp:151485090,cmonBruh:146352878,BibleThump:56472964,WutFace:45069031,Kreygasm:41387580,DansGame:38097659,SMOrc:34734484,KappaPride:34262839,VoHiYo:27886434,SwiftRage:24561900,ResidentSleeper:24438298,EleGiggle:19891526,FailFish:19118343,NotLikeThis:18802905,Keepo:18351415,BabyRage:18220906,MingLee:18026207,HeyGuys:14851569,ANELE:14648986,PJSalt:14438861}}async onEnable(){this.chat.context.on("changed:chat.hype.display-input",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.actions.room-above",()=>this.ChatInput.forceUpdate()),this.chat.context.on("changed:chat.tab-complete.emotes-without-colon",M=>{for(const Z of this.EmoteSuggestions.instances)Z.canBeTriggeredByTab=M;for(const Z of this.MentionSuggestions.instances)Z.canBeTriggeredByTab=!M}),this.use_previews=this.chat.context.get("chat.inline-preview.enabled"),this.chat.context.on("changed:chat.inline-preview.enabled",M=>{if(!this.use_previews&&(this.use_previews=M,M))for(const Z of this.ChatInput.instances)this.installPreviewObserver(Z),Z.ffzInjectEmotes(),Z.forceUpdate(),this.emit("site:dom-update","chat-input",Z)});const l=await this.site.findReact(),p=l&&l.createElement;if(!p)return this.log.warn("Unable to get React.");const $=this;this.ChatInput.ready((M,Z)=>{const H=M.prototype.render;M.prototype.render=function(){const j=H.call(this);try{if(!$.chat.context.get("chat.hype.display-input")){const se=(0,C.findReactFragment)(j,Ce=>Ce.key==="paidPinnedMessage");se&&(se.type=()=>null)}const ee=$.chat.context.get("chat.actions.room-above"),he=$.chat.context.get("context.chat_state")||{},Se=ee?(0,C.findReactFragment)(j,se=>se.props&&Array.isArray(se.props.children)):(0,C.findReactFragment)(j,se=>se.props&&se.props.className==="chat-input__buttons-container");if(!Se||!Se.props||!Se.props.children)return j;const De=this.props;if(!De||!De.channelID)return j;const Me=De.sessionUser?{id:De.sessionUser.id,login:De.sessionUser.login,displayName:De.sessionUser.displayName,mod:De.isCurrentUserModerator,staff:De.isStaff}:null,X={id:De.channelID,login:De.channelLogin,displayName:De.channelDisplayName,emoteOnly:De.emoteOnlyMode,slowMode:De.slowMode,slowDuration:De.slowModeDuration,subsMode:De.subsOnlyMode,r9kMode:he.r9k,followersOnly:he.followersOnly,followersDuration:he.followersOnlyRequirement},_e=$.actions.renderRoom($.chat.context.get("context.chat.showModIcons"),Me,X,ee,p);ee?Se.props.children.unshift(_e||null):Se.props.children.splice(1,0,_e||null)}catch(U){$.log.error(U),$.log.capture(U)}return j};for(const j of Z)j.forceUpdate(),this.emit("site:dom-update","chat-input",j),this.updateEmoteCompletion(j),this.overrideChatInput(j),j.ffzInjectEmotes(),this.installPreviewObserver(j)}),this.EmoteSuggestions.ready((M,Z)=>{for(const H of Z)this.overrideEmoteMatcher(H)}),this.MentionSuggestions.ready((M,Z)=>{for(const H of Z)this.overrideMentionMatcher(H)}),this.CommandSuggestions.ready((M,Z)=>{for(const H of Z)this.overrideCommandMatcher(H)}),this.ChatInput.on("update",this.updateEmoteCompletion,this),this.ChatInput.on("mount",this.overrideChatInput,this),this.ChatInput.on("mount",this.installPreviewObserver,this),this.ChatInput.on("unmount",this.removePreviewObserver,this),this.EmoteSuggestions.on("mount",this.overrideEmoteMatcher,this),this.MentionSuggestions.on("mount",this.overrideMentionMatcher,this),this.CommandSuggestions.on("mount",this.overrideCommandMatcher,this),this.chat.context.on("changed:chat.emotes.animated",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.emotes.enabled",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.tab-complete.matching",this.uncacheTabCompletion,this),this.on("chat.emotes:change-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-set-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-favorite",this.uncacheTabCompletion,this),this.on("chat.emotes:update-default-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-user-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-room-sets",this.uncacheTabCompletion,this),this.on("site.css_tweaks:update-chat-css",this.resizeInput,this)}uncacheTabCompletion(){for(const l of this.EmoteSuggestions.instances)l.ffz_ffz_cache=null,l.ffz_twitch_cache=null;if(this.use_previews)for(const l of this.ChatInput.instances)l.ffzInjectEmotes(),l.forceUpdate(),this.emit("site:dom-update","chat-input",l)}updateInput(){for(const l of this.ChatInput.instances)l&&(l.forceUpdate(),this.emit("site:dom-update","chat-input",l))}resizeInput(){this._resize_waiter&&cancelAnimationFrame(this._resize_waiter),this._resize_waiter=requestAnimationFrame(()=>this._resizeInput())}_resizeInput(){this._resize_waiter=null;for(const l of this.ChatInput.instances)l.resizeInput()}installPreviewObserver(l){if(l._ffz_preview_observer||!window.MutationObserver||!this.use_previews)return;const p=this.fine.getHostNode(l),$=p&&p.querySelector(".chat-input__textarea");$&&(l._ffz_preview_observer=new MutationObserver(M=>{for(const Z of M)for(const H of Z.addedNodes)H instanceof Element&&this.checkForPreviews(l,H)}),l._ffz_preview_observer.observe($,{childList:!0,subtree:!0}))}checkForPreviews(l,p){if(p.querySelector?.('span[data-a-target="chat-input-emote-preview"]'))for(const $ of document.querySelectorAll(".tw-tooltip-layer img.chat-line__message--emote"))$&&$.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__")&&this.updatePreview(l,$);for(const $ of p.querySelectorAll?.("img.chat-line__message--emote"))$&&($.dataset.ffzId||$.src.startsWith("https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__"))&&this.updatePreview(l,$)}updatePreview(l,p){let $=p.dataset.ffzSet,M=p.dataset.ffzId;if(!M){const Se=p.src.indexOf("__FFZ__",49),De=p.src.slice(49,Se),Me=De.indexOf("::");if(Me===-1)return;$=De.slice(0,Me),M=De.slice(Me+2),p.dataset.ffzSet=$,p.dataset.ffzId=M}const Z=this.emotes.emote_sets[$],H=Z?.emotes?.[M];if(!H)return;const j=this.chat.context.get("chat.emotes.animated")>0;p.src=(j?H.animSrc:null)??H.src,p.srcset=(j?H.animSrcSet:null)??H.srcSet;const U=`${H.width}px`,ee=`${H.height}px`;p.style.width=U,p.style.height=ee;const he=p.closest(".chat-image__container");if(he){he.style.width=U,he.style.height=ee;const Se=he.closest(".chat-line__message--emote-button");Se&&(Se.style.width=U,Se.style.height=ee,Se._ffz_click_handler||(Se._ffz_click_handler=this.previewClick.bind(this,H.id,Z.id,H.name),Se.addEventListener("click",Se._ffz_click_handler)))}}previewClick(l,p,$,M){const Z=this.makeEvent({provider:"ffz",id:l,set:p,name:$,source:M});this.emit("chat.emotes:click",Z),Z.defaultPrevented&&(M.preventDefault(),M.stopImmediatePropagation())}removePreviewObserver(l){l._ffz_preview_observer&&(l._ffz_preview_observer.disconnect(),l._ffz_preview_observer=null)}updateEmoteCompletion(l,p){p||(p=this.fine.searchTree(l,"tab-emote-suggestions",50)),p&&(p._ffz_user=l.props.sessionUser,p._ffz_channel_id=l.props.channelID,p._ffz_channel_login=l.props.channelLogin)}overrideChatInput(l){if(l._ffz_override)return;const p=this,$=l.onKeyDown,M=l.onMessageSend,Z=l.resizeInput,H=l.componentDidUpdate;l.ffzInjectEmotes=function(){const j=this.props.emotes.findIndex(ee=>ee?.id==="FrankerFaceZWasHere"),U=p.createFakeEmoteSet(l);if(j===-1&&U)this.props.emotes.push(U);else if(j!==-1&&U)this.props.emotes.splice(j,1,U);else if(j!==-1&&!U)this.props.emotes.splice(j,1);else return},l.componentDidUpdate=function(j,...U){try{j.emotes!==this.props.emotes&&Array.isArray(this.props.emotes)&&l.ffzInjectEmotes()}catch(ee){p.log.error("Error updating emote autocompletion data.",ee)}H&&H.call(this,j,...U)},l.resizeInput=function(j,...U){try{if(j){if(l.chatInputRef instanceof Element){const ee=getComputedStyle(l.chatInputRef),he=ee&&parseFloat(ee.lineHeight||18)||18,Se=he*1+20.5,De=Math.ceil((l.chatInputRef.scrollHeight-Se)/he),Me=Math.min(1+De,4);l.setState({numInputRows:Me})}}else l.setState({numInputRows:1})}catch(ee){return p.log.error("Error in resizeInput",ee),Z.call(this,j,...U)}},l.messageHistory=[],l.tempInput="",l.messageHistoryPos=-1,l.ffzGetValue=function(){return l.chatInputRef&&typeof l.chatInputRef.value=="string"?l.chatInputRef.value:l.state.value&&typeof l.state.value=="string"?l.state.value:""},l.ffzGetSelection=function(){if(typeof l.chatInputRef?.selectionEnd=="number")return[l.chatInputRef.selectionStart,l.chatInputRef.selectionEnd];if(l.chatInputRef?.state?.slateEditor){const j=l.chatInputRef.state.slateEditor,U=j.selection,ee=j.children;if(!U?.anchor?.path||!U?.focus?.path)return[0,0];const he=we(ee,U.anchor.path)+U.anchor.offset,Se=we(ee,U.focus.path)+U.focus.offset;return he<Se?[he,Se]:[Se,he]}return[0,0]},l.ffzSetSelection=function(j,U){l.chatInputRef?.setSelectionRange&&l.chatInputRef.setSelectionRange(j,U)},l.onKeyDown=function(j){try{const U=j.charCode||j.keyCode;if(l.onEmotePickerToggle&&p.chat.context.get("chat.emote-menu.shortcut")&&j.key==="e"&&j.ctrlKey&&!j.altKey&&!j.shiftKey){l.onEmotePickerToggle(),j.preventDefault();return}const ee=l.ffzGetValue();if(l.autocompleteInputRef&&l.chatInputRef&&p.chat.context.get("chat.mru.enabled")&&!j.shiftKey&&!j.ctrlKey&&!j.altKey){const he=l.ffzGetSelection();if(U===38&&he[0]===0&&he[1]===0){if(!l.messageHistory.length)return;ee&&l.messageHistoryPos===-1&&(l.tempInput=ee),l.messageHistoryPos<l.messageHistory.length-1&&(l.messageHistoryPos++,l.autocompleteInputRef.setValue(l.messageHistory[l.messageHistoryPos]),l.ffzSetSelection(0));return}else if(U===40&&he[0]>=ee.length&&he[1]===he[0]){if(!l.messageHistory.length)return;l.messageHistoryPos>0?(l.messageHistoryPos--,l.autocompleteInputRef.setValue(l.messageHistory[l.messageHistoryPos]),l.ffzSetSelection(l.messageHistory[l.messageHistoryPos].length)):l.messageHistoryPos===0&&(l.autocompleteInputRef.setValue(l.tempInput),l.ffzSetSelection(l.tempInput.length),l.messageHistoryPos=-1);return}}U===L.KEYS.Escape&&!j.shiftKey&&!j.ctrlKey&&!j.altKey&&(l.props.isShowingEmotePicker?l.props.closeEmotePicker():l.props.tray&&(!l.state.value||!l.state.value.length)&&l.props.clearTray())}catch(U){p.log.capture(U),p.log.error(U)}$.call(this,j)},l.onMessageSend=function(j){try{if(p.chat.context.get("chat.mru.enabled")){const U=l.ffzGetValue();U&&U.length&&(!l.messageHistory.length||l.messageHistory[0]!==U)&&(l.messageHistory.unshift(U),l.messageHistory=l.messageHistory.slice(0,20)),l.messageHistoryPos=-1,l.tempInput=""}}catch(U){p.log.capture(U),p.log.error(U)}M.call(this,j)}}overrideMentionMatcher(l){l.canBeTriggeredByTab=!this.chat.context.get("chat.tab-complete.emotes-without-colon")}overrideCommandMatcher(l){if(l._ffz_override)return;l._ffz_override=!0,l.oldCommands=l.getCommands,l.oldMatches=l.getMatches,l.oldReplacement=l.determineReplacement;const p=this;l.getMatches=function(Z,H,j){try{return j===0&&p.chat.CommandPrefixes.includes(Z[0])?l.getCommands(Z):null}catch(U){return p.log.error("Error getting matches from command handler.",U),l.oldCommands(Z,H,j)}},l.getCommands=function(Z){try{const H=l.props.getCommands(l.props.permissionLevel,{isEditor:l.props.isCurrentUserEditor}),j=p.fine.searchParent(l,Me=>Me?.props?.channelID&&Me?.props?.setTray,50),U=p.makeEvent({input:Z,permissionLevel:l.props.permissionLevel,isEditor:l.props.isCurrentUserEditor,commands:H,__input:j,channel:j?{id:j.props.channelID,login:j.props.channelLogin}:null});if(p.emit("chat:get-tab-commands",U),!H||!H.length)return null;const ee=Z[0],he=Z.slice(1),Se=H.filter(Me=>ee===(Me.prefix??"/")&&l.doesCommandMatchTerm(Me,he)).sort(l.sortCommands),De=[];for(const Me of Se){const X=Me.commandArgs?.[0];let _e;X?.isRequired&&(_e=`[${X.name}]`),De.push({current:Z,replacement:l.determineReplacement(Me),description:Me.description,element:l.renderCommandSuggestion(Me,he),group:Me.ffz_group?Array.isArray(Me.ffz_group)?p.i18n.t(...Me.ffz_group):Me.ffz_group:l.determineGroup(Me),selection:_e})}return ee!=="/"&&!De.length?null:De}catch(H){return console.error(H),l.oldCommands(Z)}},l.determineReplacement=function(Z){const H=l.oldReplacement(Z);return(Z.prefix??"/")!=="/"&&H.startsWith("/")?Z.prefix+H.slice(1):H};const $=this.site.getReact(),M=$?.createElement;M&&(l.renderCommandSuggestion=function(Z,H){const j=Array.isArray(Z?.commandArgs)?Z.commandArgs.map(U=>M("div",{class:`tw-mg-r-05${U.isRequired?"":" tw-c-text-alt"}`},"[",U.name,"]")):null;return M("div",{class:"tw-pd-05"},M("div",{class:"tw-flex"},M("div",{class:"tw-mg-r-05"},M("span",null,Z.prefix??"/"),M("span",{class:"tw-semibold"},Z.name)),j),M("p",{class:"tw-c-text-alt-2 tw-font-size-7"},Z.description))})}createFakeEmoteSet(l){if(!this.use_previews)return null;if(!l._ffz_channel_login){const U=this.fine.searchParent(l,"chat-input",50);U&&this.updateEmoteCompletion(U,l)}const p=l._ffz_user,$=l._ffz_channel_id,M=l._ffz_channel_login;if(!M)return null;const Z=this.emotes.getSets(p?.id,p?.login,$,M);if(!Z||!Z.length)return null;const H=[],j=new Set;for(const U of Z){if(!U||!U.emotes)continue;const ee=U.source||"ffz";for(const he of Object.values(U.emotes))!he||!he.id||!he.name||j.has(he.name)||(j.add(he.name),H.push({id:`__FFZ__${U.id}::${he.id}__FFZ__`,modifiers:null,setID:"FrankerFaceZWasHere",token:he.name}))}return{__typename:"EmoteSet",emotes:H,id:"FrankerFaceZWasHere",owner:null}}overrideEmoteMatcher(l){if(l._ffz_override)return;const p=this;l.canBeTriggeredByTab=this.chat.context.get("chat.tab-complete.emotes-without-colon"),l.getMatches=function(Z,H){return H?Z.length<2?null:l.getMatchedEmotes(Z):Z.startsWith(":")?Z.length<3?null:l.getMatchedEmotes(Z):null},l.doesEmoteMatchTerm=function(Z,H){const j=Z.name||Z.token;if(!j)return Pe;if(j.startsWith(H))return ze;let U=Z.tokenLower;U||(U=j.toLowerCase());const ee=H.toLowerCase();if(U.startsWith(ee))return le;const he=j.indexOf(H.charAt(0).toUpperCase());return he!==-1&&U.slice(he+1).startsWith(ee.slice(1))?ie:U.includes(ee)?ne:Pe},l.getMatchedEmotes=function(Z){const H=p.chat.context.get("chat.emotes.enabled"),j=p.chat.context.get("chat.tab-complete.limit-results");let U=H?p.getTwitchEmoteSuggestions(Z,this):[];if(H>1&&p.chat.context.get("chat.tab-complete.ffz-emotes")){const ee=p.getEmoteSuggestions(Z,this);Array.isArray(ee)&&ee.length&&(U=U.concat(ee))}if(p.chat.context.get("chat.tab-complete.emoji")){const ee=p.getEmojiSuggestions(Z,this);Array.isArray(ee)&&ee.length&&(U=Array.isArray(U)?U.concat(ee):ee)}return U=p.sortEmotes(U),j&&U.length>25?U.slice(0,25):U};const $=this.site.getReact(),M=$?.createElement;l.renderFFZEmojiSuggestion=function(Z){return M($.Fragment,null,M("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:Z.token,favorite:Z.favorite},M("img",{class:"emote-autocomplete-provider__image ffz-emoji",src:Z.src,srcSet:Z.srcset}),Z.favorite&&M("figure",{class:"ffz--favorite ffz-i-star"})),M("div",{class:"tw-ellipsis",title:Z.token},Z.token))},l.renderEmoteSuggestion=function(Z){return M($.Fragment,null,M("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:Z.token,favorite:Z.favorite},M("img",{class:"emote-autocomplete-provider__image",srcSet:Z.srcSet}),Z.favorite&&M("figure",{class:"ffz--favorite ffz-i-star"})),M("div",{class:"tw-ellipsis",title:Z.token},Z.token))}}sortEmotes(l){const p=this.chat.context.get("chat.tab-complete.prioritize-favorites"),$=this.chat.context.get("chat.tab-complete.emotes-without-colon"),M=this.chat.context.get("chat.tab-complete.prioritize-prefix-matches");return l.sort((Z,H)=>{const j=Z.matched||Z.replacement,U=H.matched||H.replacement;if(p&&Z.favorite^H.favorite)return 0-Z.favorite+H.favorite;if(M){const ee=!!Z.matched,he=!!H.matched;if(ee^he)return $?0-ee+he:0-he+ee;const Se=Z.match_type===ze,De=H.match_type===ze;if(Se&&De)return fe.compare(j,U);if(Se)return-1;if(De)return 1;const Me=Z.match_type===le,X=H.match_type===le;return Me&&X?be.compare(j,U):Me?-1:X?1:fe.compare(j,U)}return 0})}buildTwitchCache(l){if(!Array.isArray(l))return{emotes:[],length:0};const p=[],$=new Set,M=this.chat.context.get("chat.emotes.animated")>0,Z=this.settings.provider.get("emote-menu.hidden-sets"),H=Array.isArray(Z)&&Z.length>0,j=this.emotes.getHidden("twitch"),U=this.emotes.getFavorites("twitch");for(const ee of l){const he=parseInt(ee.id,10),Se=ee.owner,De=L.TWITCH_POINTS_SETS.includes(he)||Se?.login==="channel_points",Me=De?null:Se;if(ee.id==="FrankerFaceZWasHere")continue;let X=`twitch-set-${ee.id}`,_e=null;if(Me?.login?(X=`twitch-${Me.id}`,_e=Me.displayName||Me.login):De?X="twitch-points":L.TWITCH_GLOBAL_SETS.includes(he)?X="twitch-global":L.TWITCH_PRIME_SETS.includes(he)?X="twitch-prime":X="twitch-misc",!(H&&Z.includes(X)))for(const se of ee.emotes){if(!se||!se.id||j.includes(se.id))continue;const Ce=se.id,Ne=L.KNOWN_CODES[se.token]||se.token;if(!Ne||$.has(Ne))continue;$.add(Ne);const We=L.REPLACEMENTS[Ce];let Xe;We&&this.chat.context.get("chat.fix-bad-emotes")?Xe=`${L.REPLACEMENT_BASE}${We} 1x`:Xe=(0,P.getTwitchEmoteSrcSet)(Ce,M),p.push({id:Ce,source:X,extra:_e,setID:ee.id,token:Ne,tokenLower:Ne.toLowerCase(),srcSet:Xe,favorite:U.includes(Ce)})}}return{emotes:p,length:l.length}}getTwitchEmoteSuggestions(l,p){p.ffz_twitch_cache?.length!==p.props.emotes?.length&&(p.ffz_twitch_cache=this.buildTwitchCache(p.props.emotes));const $=this.chat.context.get("chat.tab-complete.matching"),M=p.ffz_twitch_cache.emotes;if(!M.length)return[];const Z=[],H=[],j=[],U=l.startsWith(":")?l.slice(1):l;for(const ee of M){const he=p.doesEmoteMatchTerm(ee,U);if(he<$)continue;const Se={current:l,emote:ee,replacement:ee.token,element:p.renderEmoteSuggestion(ee),favorite:ee.favorite,count:this.EmoteUsageCount[ee.token]||0,match_type:he};he<$||(Se.count>0?Z.push(Se):he>ie?H.push(Se):j.push(Se))}return Z.sort((ee,he)=>he.count-ee.count),H.sort((ee,he)=>fe.compare(ee.replacement,he.replacement)),j.sort((ee,he)=>fe.compare(ee.replacement,he.replacement)),Z.concat(H).concat(j)}getEmojiSuggestions(l,p){if(!l.startsWith(":"))return[];let $=l.slice(1).toLowerCase();const M=this.chat.context.get("chat.emoji.style"),Z=this.settings.provider.get("emoji-tone",null),H=this.emotes.getFavorites("emoji"),j=[],U=$.endsWith(":");U&&($=$.slice(0,-1));const ee=new Set;for(const he in this.emoji.names)if(U?he===$:he.startsWith($)){const Se=this.emoji.emoji[this.emoji.names[he]],De=Se.variants&&Se.variants[Z],Me=De||Se;if(Se&&(M===0||Me.has[M])&&!ee.has(Me.raw)){ee.add(Me.raw);const X=this.emoji.getFullImageSet(Me.image,M),_e=`:${he}:`,se=H.includes(Se.code);j.push({current:l,emoji:Me,matched:_e,srcSet:X,replacement:Me.raw,element:p.renderFFZEmojiSuggestion({token:_e,id:`emoji-${Se.code}`,src:this.emoji.getFullImage(Me.image,M),srcSet:X,favorite:se}),favorite:se})}}return j}buildFFZCache(l,p,$,M){const Z=this.emotes.getSets(l,p,$,M);if(!Z||!Z.length)return{emotes:[],length:0,user_id:l,user_login:p,channel_id:$,channel_login:M};const H=[],j=this.chat.context.get("chat.emotes.animated")>0,U=this.settings.provider.get("emote-menu.hidden-sets"),ee=Array.isArray(U)&&U.length>0,he=new Set;for(const Se of Z){if(!Se||!Se.emotes)continue;const De=Se.source||"ffz",Me=Se.source_line||`${Se.source||"FFZ"} ${Se.title||"Global"}`,X=`${Se.merge_source||De}-${Se.merge_id||Se.id}`;if(ee&&U.includes(X))continue;const _e=this.emotes.getHidden(De),se=this.emotes.getFavorites(De);for(const Ce of Object.values(Se.emotes))!Ce||!Ce.id||Ce.hidden||_e.includes(Ce.id)||he.has(Ce.name)||Ce.name&&(he.add(Ce.name),H.push({id:`${De}-${Ce.id}`,source:De,extra:Me,token:Ce.name,tokenLower:Ce.name.toLowerCase(),srcSet:j&&Ce.animSrcSet||Ce.srcSet,favorite:se.includes(Ce.id)}))}return{emotes:H,length:Z.length}}getEmoteSuggestions(l,p){if(!p._ffz_channel_login){const Se=this.fine.searchParent(p,"chat-input",50);Se&&this.updateEmoteCompletion(Se,p)}const $=this.chat.context.get("chat.tab-complete.matching"),M=p._ffz_user,Z=p._ffz_channel_id,H=p._ffz_channel_login;if(!H)return[];let j=p.ffz_ffz_cache;(!j||j.user_id!==M?.id||j.user_login!==M?.login||j.channel_id!==Z||j.channel_login!==H)&&(j=p.ffz_ffz_cache=this.buildFFZCache(M?.id,M?.login,Z,H));const U=j.emotes;if(!U.length)return[];const ee=l.startsWith(":")?l.slice(1):l,he=[];for(const Se of U){const De=p.doesEmoteMatchTerm(Se,ee);De<$||he.push({current:l,emote:Se,replacement:Se.token,element:p.renderEmoteSuggestion(Se),favorite:Se.favorite,count:0,match_type:De})}return he}getInput(){for(const l of this.ChatInput.instances)if(!(!l.autocompleteInputRef||!l.state)&&l.state.value)return l.state.value;return null}pasteMessage(l,p){for(const $ of this.ChatInput.instances)if($?.props?.channelLogin===l){if(!$.autocompleteInputRef||!$.state)return;$.state.value&&(p=`${$.state.value} ${p}`),$.autocompleteInputRef.setValue(p),$.autocompleteInputRef.componentRef?.focus?.()}}};B(st,"Input");let Te=st;const xt=class xt extends x.default{constructor(...l){super(...l),this.inject("chat"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.last_login=null,this.settings.add("chat.viewer-cards.highlight-chat",{default:!1,ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight messages from users with open viewer cards.",component:"setting-check-box"}}),this.settings.add("chat.viewer-cards.color",{default:"",ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("chat.viewer-cards.use-color",{requires:["chat.viewer-cards.highlight-chat","chat.viewer-cards.color"],process(p){if(p.get("chat.viewer-cards.highlight-chat"))return p.get("chat.viewer-cards.color")}}),this.ViewerCard=this.fine.define("chat-viewer-card",p=>p.props?.targetLogin&&p.props?.hideViewerCard)}onEnable(){this.chat.context.on("changed:chat.viewer-cards.highlight-chat",this.refreshStyle,this),this.chat.context.on("changed:chat.viewer-cards.color",this.refreshStyle,this),this.on("..:update-colors",this.refreshStyle,this),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("update",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this)}refreshStyle(){this.updateStyle(this.last_login)}updateStyle(l){if(typeof l=="string"&&(l=l.toLowerCase()),this.last_login=l,l&&this.chat.context.get("chat.viewer-cards.highlight-chat")){let p=this.chat.context.get("chat.viewer-cards.color");p&&p.length?p=this.parent.inverse_colors.process(p):this.chat.context.get("theme.is-dark")?p="rgba(0,80,255,0.2)":p="rgba(128,170,255,0.2)",this.css_tweaks.set("viewer-card-highlight",`
body .chat-room .chat-scrollable-area__message-container > div:nth-child(1n+0) > .chat-line__message:not(.chat-line--inline):not(.something-nonexistent)[data-user="${l}"],
body .chat-room .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user="${l}"] {
	background-color: ${p} !important;
}`)}else this.css_tweaks.delete("viewer-card-highlight")}updateCard(l){this.updateStyle(l.props&&l.props.targetLogin)}unmountCard(){this.updateStyle()}};B(xt,"ViewerCards");let Be=xt;const Oe=(0,P.make_enum)("Post","Action"),Ie=(0,P.make_enum)("Ban","Timeout","Delete"),Ve=(0,P.make_enum)("MessageRejectedPrompt","CheerMessageRejectedPrompt","MessageRejected","MessageAllowed","MessageDenied","CheerMessageDenied","CheerMessageTimeout","MessageModApproved","MessageModDenied"),Ke=["Message","Notice","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","RoomMods","RoomState","BadgesUpdated"],Ye=(0,P.make_enum)("Message","ExtensionMessage","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","Subscription","Resubscription","GiftPaidUpgrade","AnonGiftPaidUpgrade","PrimePaidUpgrade","PrimeCommunityGiftReceivedEvent","ExtendSubscription","SubGift","AnonSubGift","Clear","RoomMods","RoomState","Raid","Unraid","Notice","Info","BadgesUpdated","Purchase","BitsCharity","CrateGift","RewardGift","SubMysteryGift","AnonSubMysteryGift","StandardPayForward","CommunityPayForward","FirstCheerMessage","FirstMessageHighlight","BitsBadgeTierMessage","InlinePrivateCallout","ChannelPointsReward","CommunityChallengeContribution","LiveMessageSeparator","RestrictedLowTrustUserMessage","CommunityIntroduction","Shoutout","AnnouncementMessage","CharityDonation","MessageIdUpdate","ViewerMilestone","GigantifiedEmote"),it=["Reconnect","RoomState","BadgesUpdated","Clear"],wt={pinned_re_sub:"share-resub",community_points_reward:"community-points-rewards",clip_live_nudge_chat_trigger:"clip-live-nudge",cheer_badge_grant:"bits-badge-tier"},zt={AppointedModerator:"appointed-moderator",BitsBadgeTier:"bits-badge-tier",BitsPowerUps:"bits-power-ups",ClipLiveNudge:"clip-live-nudge",CommunityMoment:"community-moment",CommunityPointsRewards:"community-points-rewards",CosmicAbyss:"cosmic-abyss",CreatorAnniversaries:"creator-anniversaries",Drop:"drop",EarnedSubBadge:"earned-sub-badge",FavoritedGuestCollab:"favorited-guest-collab",GiftBadgeExpiration:"gift-badge-expiration",GiftBadgeRestored:"gift-badge-restored",GiftBundleUpSell:"gift-bundle-up-sell",HypeTrainRewards:"hype-train-rewards",LapsedBitsUser:"lapsed-bits-user",PartnerPlusUpSellNudge:"partner-plus-up-sell-nudge",ReplyByKeyboard:"reply-by-keyboard",RequestToJoinAccepted:"request-to-join-accepted",STPromo:"st-promo",ShareResub:"share-resub",SubtemberPromoBits:"subtember-promo-bits",ThankSubGifter:"thank-sub-gifter",TurnOffAnimatedEmotes:"turn-off-animated-emotes",WalletDrop:"wallet-drop"},Ht=[],Wt=["onBadgesUpdatedEvent"],Kt=class Kt extends x.default{constructor(...l){super(...l),this.should_enable=!0,this.shared_room_data=new Map,this.shared_rooms={},this.colors=new K.ColorAdjuster,this.inverse_colors=new K.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.inject("experiments"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("site.subpump"),this.inject("chat"),this.inject(d),this.inject(z),this.inject(a),this.inject(ae),this.inject(Te),this.inject(Be),this.ChatLeaderboard=this.fine.define("chat-leaderboard",p=>p.props?.topItems&&(0,P.has)(p.props,"forceMiniView")&&(0,P.has)(p.props,"leaderboardType"),m.Z.CHAT_ROUTES),this.ChatService=this.fine.define("chat-service",p=>p.join&&p.client&&p.props.setChatConnectionAPI,m.Z.CHAT_ROUTES),this.ChatBuffer=this.fine.define("chat-buffer",p=>p.updateHandlers&&p.delayedMessageBuffer&&p.handleMessage,m.Z.CHAT_ROUTES),this.ChatController=this.fine.define("chat-controller",p=>p.parseOutgoingMessage&&p.onRoomStateUpdated&&p.renderNotifications,m.Z.CHAT_ROUTES),this.ChatRenderer=this.fine.define("chat-renderer",p=>p.mapMessagesToChatLines&&p.reportChatRenderSent,m.Z.CHAT_ROUTES),this.ChatContainer=this.fine.define("chat-container",p=>p.closeViewersList&&p.onChatInputFocus,m.Z.CHAT_ROUTES),this.ChatBufferConnector=this.fine.define("chat-buffer-connector",p=>p.clearBufferHandle&&p.syncBufferedMessages,m.Z.CHAT_ROUTES),this.ChatRewardEventHandler=this.fine.define("chat-reward-event-handler",p=>p.unsubscribe&&p.handleMessage&&p.props?.messageHandlerAPI&&p.props?.rewardMap,m.Z.CHAT_ROUTES),this.joined_raids=new Set,this.RaidController=this.fine.define("raid-controller",p=>p.handleLeaveRaid&&p.handleJoinRaid,m.Z.CHAT_ROUTES),this.InlineCallout=this.fine.define("inline-callout",p=>p.showCTA&&p.toggleContextMenu&&p.actionClick,m.Z.CHAT_ROUTES),this.PinnedCallout=this.fine.define("pinned-callout",p=>p.getCalloutTitle&&p.buildCalloutProps&&p.pin,m.Z.CHAT_ROUTES),this.CalloutSelector=this.fine.define("callout-selector",p=>p.selectCalloutComponent&&p.props&&(0,P.has)(p.props,"callouts"),m.Z.CHAT_ROUTES),this.PointsButton=this.fine.define("points-button",p=>p.renderIcon&&p.renderFlame&&p.handleIconAnimationComplete,m.Z.CHAT_ROUTES),this.PointsClaimButton=this.fine.define("points-claim-button",p=>p.getClaim&&p.onClick&&p.props&&p.props.claimCommunityPoints,m.Z.CHAT_ROUTES),this.CommunityChestBanner=this.fine.define("community-chest-banner",p=>p.getLastGifterText&&p.getBannerText&&(0,P.has)(p,"finalCount"),m.Z.CHAT_ROUTES),this.PointsInfo=this.fine.define("points-info",p=>p.pointIcon!==void 0&&p.pointName!==void 0,m.Z.CHAT_ROUTES),this.GiftBanner=this.fine.define("gift-banner",p=>p.getBannerText&&p.onGiftMoreClick,m.Z.CHAT_ROUTES),this.settings.add("chat.subs.native",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices using Twitch's native UI.",component:"setting-check-box"}}),this.settings.add("chat.filtering.show-reasons",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Display Reasons",description:"If this is enabled, the reasons a given message was highlighted will be displayed alongside the message. This is a simple display. Enable the debugging option below in Behavior for more details, but be aware that the debugging option has a slight performance impact compared to this.",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:1,title:"Above Message"},{value:2,title:"Inline"}]}}),this.settings.add("chat.disable-handling",{default:null,requires:["context.disable-chat-processing"],process(p,$){return $!=null?!$:!!p.get("context.disable-chat-processing")},ui:{path:"Debugging > Chat >> Processing",title:"Enable processing of chat messages.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("debug.chat-test",{path:"Debugging > Chat >> Chat",component:"chat-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.filtering.blocked-callouts",{default:[],type:"array_merge",always_inherit:!0,process:(p,$)=>{const M=new Set,Z=this.callout_types??zt;for(const H of $)H?.v&&Z[H.v]&&!Ht.includes(H.v)&&M.add(Z[H.v]);return M},ui:{path:'Chat > Filtering > Block >> Callout Types @{"description":"This filter allows you to remove callouts of specific types from Twitch chat. Callouts are special messages that can be pinned to the bottom of chat and often have associated actions, like claiming a drop or sharing your resubscription."}',component:"blocked-types",getExtraTerms:()=>Object.keys(this.callout_types).filter(p=>!Ht.includes(p)),data:()=>Object.keys(this.callout_types).filter(p=>!Ht.includes(p)).sort()}}),this.settings.add("chat.filtering.blocked-types",{default:[],type:"array_merge",always_inherit:!0,process(p,$){const M=new Set;for(const Z of $)Z?.v&&!Ke.includes(Z.v)&&M.add(Z.v);return M},ui:{path:'Chat > Filtering > Block >> Message Types @{"description":"This filter allows you to remove all messages of a certain type from Twitch chat. It can be used to filter system messages, such as Hosts or Raids. Some types, such as moderation actions, cannot be blocked to prevent chat functionality from breaking."}',component:"blocked-types",getExtraTerms:()=>Object.keys(this.chat_types).filter(p=>!Ke.includes(p)&&!/^\d+$/.test(p)),data:()=>Object.keys(this.chat_types).filter(p=>!Ke.includes(p)&&!/^\d+$/.test(p)).sort()}}),this.settings.add("chat.replies.style",{default:1,ui:{path:"Chat > Appearance >> Replies",title:"Style",description:"Twitch's default style adds a floating button to the right and displays a notice above messages that are replies. FrankerFaceZ uses an In-Line Chat Action (that can be removed in [Chat > Actions > In-Line](~chat.actions.in_line)) and uses an in-line mention to denote replies.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch (Default)"},{value:2,title:"FrankerFaceZ"}]}}),this.settings.add("channel.raids.no-autojoin",{default:!1,ui:{path:"Channel > Behavior >> Raids",title:"Do not automatically join raids.",component:"setting-check-box"}}),this.settings.add("chat.powerup.effects",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow "Message Effects" messages to appear in chat.',component:"setting-check-box",description:"*Note*: Only affects messages sent after you change this setting. You can use your own chat for testing."}}),this.settings.add("channel.raids.blocked-channels",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Channel > Behavior >> Raids: Blocked Channels @{"description": "You will not automatically join raids to channels listed here."}',component:"basic-terms",words:!1}}),this.settings.add("__filter:channel.raids.blocked-channels",{requires:["channel.raids.blocked-channels"],equals:"requirements",process(p){const $=p.get("channel.raids.blocked-channels");if(!$||!$.length)return null;const M=[];for(const Z of $){const H=Z.t;let j=Z.v;H==="glob"?j=(0,P.glob_to_regex)(j):H!=="raw"&&(j=(0,P.escape_regex)(j)),!(!j||!j.length)&&M.push(j)}return M.length?new RegExp(`^(?:${M.join("|")})$`,"gi"):null}}),this.settings.add("chat.hide-community-highlights",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide all Community Highlights from the top of chat.",component:"setting-check-box",description:"Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them."}}),this.settings.add("chat.subs.gift-banner",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display a banner at the top of chat when a mass gift sub happens.",component:"setting-check-box"}}),this.settings.add("chat.banners.last-events",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Support Activity Feed to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.charity",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the charity fundraiser progress to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.hide-appleplus",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide the drop notification for getting AppleTV+ when you buy a subscription.",component:"setting-check-box",description:`**Note:** Normally, I wouldn't add something that directly affects an advertisement like this, but Twitch broke the "Don't show again" checkbox, so it's up to us to fix it.`}}),this.settings.add("chat.banners.hype-train",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Hype Train to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.shared-chat",{default:!0,ui:{path:"Chat > Shared Chat >> Behavior",title:"Allow the Shared Chat notice to be displayed in chat when a Shared Chat is enabled.",component:"setting-check-box"}}),this.settings.add("chat.banners.pinned-message",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Pinned Messages to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.drops",{default:!0,ui:{path:"Chat > Drops >> Appearance",title:"Allow messages about Drops to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.polls",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Polls to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.prediction",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Predictions to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.callouts.clip",{default:!0,ui:{path:"Chat > Appearance >> Community",title:'Allow the "Chat seems active." clip suggestion to be displayed in chat.',component:"setting-check-box"}}),this.settings.add("chat.community-chest.show",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display the Community Gift Chest banner.",component:"setting-check-box"}}),this.settings.add("chat.points.allow-highlight",{default:2,ui:{path:"Chat > Channel Points >> Appearance",title:"Highlight the message in chat when someone redeems Highlight My Message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Style"},{value:2,title:"FFZ Style"}]}}),this.settings.add("chat.points.show-callouts",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display messages in chat about Channel Points rewards.",component:"setting-check-box"}}),this.settings.add("chat.points.show-button",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display Channel Points button beneath chat.",component:"setting-check-box"}}),this.settings.add("chat.points.show-rewards",{default:!0,requires:["layout.portrait-min-chat"],process(p,$){return p.get("layout.portrait-min-chat")?!1:$},ui:{path:"Chat > Channel Points >> Behavior",title:"Allow available rewards to appear next to the Channel Points button.",component:"setting-check-box"}}),this.settings.add("chat.points.auto-rewards",{default:!1,ui:{path:"Chat > Channel Points >> Behavior",title:"Automatically claim bonus rewards.",component:"setting-check-box",force_seen:!0}}),this.settings.add("chat.drops.auto-rewards",{default:!1,ui:{path:"Chat > Drops >> Behavior",title:"Automatically claim drops.",component:"setting-check-box"}}),this.settings.add("chat.pin-resubs",{default:!1,ui:{path:"Chat > Behavior >> General",title:"Automatically pin re-subscription messages in chat.",component:"setting-check-box"}}),this.settings.add("chat.shared-chat.style",{default:null,ui:{path:"Chat > Shared Chat >> Appearance",title:"Pill Style",component:"setting-select-box",description:"This controls the appearance of the pill at the left-side of chat messages when a message is part of a Shared Chat. By default, this is Avatar for moderators and broadcasters and Hidden for everyone else.",data:[{value:null,title:"Automatic"},{value:0,title:"Hidden"},{value:1,title:"Channel Name"},{value:2,title:"Avatar"}]}}),this.settings.add("chat.shared-chat.username-tooltip",{default:!0,ui:{path:"Chat > Shared Chat >> Appearance",component:"setting-check-box",title:"Display the source channel of a chat message when hovering over the poster's username."}}),this.settings.add("chat.width",{default:null,ui:{path:'Chat > Appearance >> General @{"sort": -1}',title:"Width",description:"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process(p){return p=parseInt(p,10),isNaN(p)||!isFinite(p)||p<=0?null:p}}}),this.settings.add("chat.effective-width",{requires:["chat.width","context.ui.rightColumnWidth"],process(p){const $=p.get("chat.width");return $??(p.get("context.ui.rightColumnWidth")||340)}}),this.settings.add("chat.use-width",{requires:["chat.width","context.ui.rightColumnExpanded","context.isWatchParty"],process(p){return!p.get("context.ui.rightColumnExpanded")||p.get("context.isWatchParty")?!1:p.get("chat.width")!=null}}),this.settings.add("chat.bits.show-pinned",{requires:["chat.bits.show"],default:null,process(p,$){return $??p.get("chat.bits.show")},ui:{path:"Chat > Appearance >> Community",title:"Display Leaderboard",description:`The leaderboard shows the top cheerers and sub gifters in a channel.

By default due to a previous implementation, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering).`,component:"setting-check-box"}}),this.settings.add("chat.bits.show-rewards",{requires:["chat.bits.show"],default:null,process(p,$){return $??p.get("chat.bits.show")},ui:{path:"Chat > Bits and Cheering >> Behavior",title:"Display messages when a cheer shares rewards to people in chat.",description:"By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.",component:"setting-check-box"}}),this.settings.add("chat.bits.cheer-notice",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display a notice on chat messages that include cheers.",description:"This feature is intended to prevent possible confusion from chatters using emotes to fake cheers in messages. When enabled, messages that contain real cheers will display a message above them, similar to how resubscription messages or point redemptions with messages function.",component:"setting-check-box"}}),this.settings.add("chat.rituals.show",{default:!0,ui:{path:"Chat > Filtering > General >> Rituals",title:'Display ritual messages such as "User is new here! Say Hello!".',component:"setting-check-box"}}),this.settings.add("chat.extra-timestamps",{default:!0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display timestamps on notices.",description:"When enabled, timestamps will be displayed on point redemptions, subscriptions, etc.",component:"setting-check-box"}}),this.settings.add("chat.hype.message-style",{default:1,ui:{path:"Chat > Hype Chat >> Appearance",title:"Hype Chat Style",component:"setting-select-box",description:"**Note**: Hype Chats that include messages will always have their messages displayed, regardless of setting. Changes made to this setting may not affect existing chat messages.",data:[{value:0,title:"Do Not Display"},{value:1,title:"Standard Twitch (Large, Colored, Limited FFZ Support)"},{value:2,title:"Minimal (Marked with System Message, No Colors)"}]}}),this.settings.add("chat.subs.show",{default:3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display Subs in Chat",component:"setting-select-box",description:'**Note**: Messages sent with re-subs will always be displayed. This only controls the special "X subscribed!" message.',data:[{value:0,title:"Do Not Display"},{value:1,title:"Re-Subs with Messages Only"},{value:2,title:"Re-Subs Only"},{value:3,title:"Display All"}]}}),this.settings.add("chat.subs.compact",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices in a more compact (classic style) form.",component:"setting-check-box"}}),this.settings.add("chat.subs.merge-gifts",{default:1e3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Merge Mass Sub Gifts",component:"setting-select-box",data:[{value:1e3,title:"Disabled"},{value:50,title:"More than 50"},{value:20,title:"More than 20"},{value:10,title:"More than 10"},{value:5,title:"More than 5"},{value:0,title:"Always"}],description:`Merge mass gift subscriptions into a single message, depending on the quantity.
**Note:** Only affects newly gifted subs.`}}),this.settings.add("chat.subs.merge-gifts-visibility",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Expand merged mass sub gift messages by default.",component:"setting-check-box"}}),this.settings.add("chat.lines.alternate",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display lines with alternating background colors.",component:"setting-check-box"}}),this.settings.add("chat.lines.padding",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Reduce padding around lines.",component:"setting-check-box"}}),this.settings.add("chat.lines.borders",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Separators",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Basic Line (1px Solid)"},{value:2,title:"3D Line (2px Groove)"},{value:3,title:"3D Line (2px Groove Inset)"},{value:4,title:"Wide Line (2px Solid)"}]}}),this.settings.add("chat.input.show-mod-view",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Mod View" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-highlight",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Chat Highlight Settings" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-shield",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Shield Mode" button to appear in relevant channels.',component:"setting-check-box"}}),this.settings.add("chat.input.show-elevate-your-message",{default:!0,ui:{path:"Chat > Input >> Appearance",title:'Allow the "Elevate Your Message" button to be displayed.',component:"setting-check-box"}})}get currentChat(){for(const l of this.ChatController.instances)if(l&&l.chatService)return l;return null}updateColors(){const l=this.chat.context.get("theme.is-dark"),p=this.chat.context.get("chat.adjustment-mode"),$=this.chat.context.get("chat.adjustment-contrast"),M=this.colors,Z=this.inverse_colors;let H=l,j=K.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-background")||this.chat.context.get("theme.color.background"));j&&(H=j.toHSLA().l<.5),j=H?"#191919":"#E0E0E0";let U=!H,ee=K.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-text")||this.chat.context.get("theme.color.text"));ee&&(U=ee.toHSLA().l<.5),ee=U?"#19171c":"#dad8de",M._base=j,M.mode=p,M.contrast=$,Z._base=ee,Z.mode=p,Z.contrast=$,this.chat_line.rerenderLines(),this.updateMentionCSS(),this.emit(":update-colors")}updateChatCSS(){this._update_css_waiter||(this._update_css_waiter=requestAnimationFrame(()=>this._updateChatCSS()))}_updateChatCSS(){cancelAnimationFrame(this._update_css_waiter),this._update_css_waiter=null;const l=this.chat.context.get("chat.effective-width"),p=this.chat.context.get("chat.actions.size"),$=this.chat.context.get("chat.actions.hover-size"),M=this.chat.context.get("chat.timestamp-size"),Z=this.chat.context.get("chat.font-size"),H=this.chat.context.get("chat.lines.emote-alignment"),j=Math.round(20/12*Z),U=Math.round($*(2/3)),ee=$-U;let he=this.chat.context.get("chat.font-family")||"inherit";const[Se,De]=(0,I.jo)(he);he=Se,this._font_unloader&&this._font_unloader(),this._font_unloader=De,he.indexOf(" ")!==-1&&he.indexOf(",")===-1&&he.indexOf('"')===-1&&he.indexOf("'")===-1&&(he=`"${he}"`),M?this.css_tweaks.set("ts-size",`.chat-line__timestamp{font-size:${M/10}rem}`):this.css_tweaks.delete("ts-size"),this.css_tweaks.setVariable("chat-actions-size",`${p/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-size",`${U/10}rem`),this.css_tweaks.setVariable("chat-actions-hover-padding",`${ee/20}rem`),this.css_tweaks.setVariable("chat-font-size",`${Z/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${j/10}rem`),this.css_tweaks.setVariable("chat-font-family",he),this.css_tweaks.setVariable("chat-width",`${l/10}rem`),this.css_tweaks.setVariable("negative-chat-width",`${-l/10}rem`),this.css_tweaks.toggle("chat-font",Z!==13||he!=="inherit"),this.css_tweaks.toggle("chat-width",this.settings.get("chat.use-width")),this.css_tweaks.toggle("chat-fix--watch-party",this.settings.get("context.isWatchParty")),this.css_tweaks.toggle("emote-alignment-padded",H===1),this.css_tweaks.toggle("emote-alignment-baseline",H===2),this.emit(":update-chat-css"),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateLineBorders(){const l=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",l>0),this.css_tweaks.toggle("chat-borders-3d",l===2),this.css_tweaks.toggle("chat-borders-3d-inset",l===3),this.css_tweaks.toggle("chat-borders-wide",l===4)}updateMentionCSS(){const l=this.chat.context.get("chat.filtering.highlight-mentions");this.css_tweaks.toggle("chat-mention-token",this.chat.context.get("chat.filtering.highlight-tokens"));const p=this.chat.context.get("chat.filtering.mention-color");p?(this.css_tweaks.toggle("chat-mention-bg",!1),this.css_tweaks.toggle("chat-mention-bg-alt",!1),this.css_tweaks.toggle("chat-mention-bg-custom",!0),this.css_tweaks.setVariable("chat-mention-color",this.inverse_colors.process(p))):(this.css_tweaks.toggle("chat-mention-bg-custom",!1),this.css_tweaks.toggle("chat-mention-bg",l),this.css_tweaks.toggle("chat-mention-bg-alt",l&&this.chat.context.get("chat.lines.alternate")))}updatePointsInfo(l){const p=l?.pointIcon,$=l?.pointName;p?this.css_tweaks.set("points-icon",`.ffz--points-icon:before { display: none }
.ffz--points-icon:after {
	display: inline-block;
	margin: 0 0.5rem -0.6rem;
	background-image: url("${p.url}");
	background-image: ${L.WEBKIT_CSS}image-set(url("${p.url}") 1x, url("${p.url2x}") 2x, url("${p.url4x}") 4x);
}`):this.css_tweaks.delete("points-icon"),this.point_name=$||null}grabTypes(){if(this.types_loaded)return;const l=this.web_munch.getModule("chat-types"),p=this.web_munch.getModule("callout-types");if(this.callout_types=p||zt,this.automod_types=l?.automod||Ve,this.chat_types=l?.chat||Ye,this.message_types=l?.message||Oe,this.mod_types=l?.mod||Ie,!l)return;p&&this.chat.context.update("chat.filtering.blocked-callouts"),this.types_loaded=!0;const $=[];(0,P.shallow_object_equals)(this.callout_types,zt)||$.push("CALLOUT_TYPES"),(0,P.shallow_object_equals)(this.automod_types,Ve)||$.push("AUTOMOD_TYPES"),(0,P.shallow_object_equals)(this.chat_types,Ye)||$.push("CHAT_TYPES"),(0,P.shallow_object_equals)(this.message_types,Oe)||$.push("MESSAGE_TYPES"),(0,P.shallow_object_equals)(this.mod_types,Ie)||$.push("MOD_TYPES"),$.length&&this.log.info("Chat Types have changed from static mappings for categories:",$.join(" "))}updateDisableHandling(){this.disable_handling=this.chat.context.get("chat.disable-handling")}onEnable(){this.on("site.web_munch:new-ready",this.grabTypes),this.on("site.web_munch:new-ready",this.defineClasses),this.grabTypes(),this.defineClasses(),this.chat.context.on("changed:chat.callouts.clip",this.updateCallouts,this),this.chat.context.on("changed:chat.filtering.blocked-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-callouts",this.updateCallouts,this),this.chat.context.on("changed:chat.points.show-button",()=>this.PointsButton.forceUpdate()),this.chat.context.on("changed:chat.points.show-rewards",()=>{this.PointsButton.forceUpdate(),this.PointsClaimButton.forceUpdate()}),this.chat.context.on("changed:chat.bits.show",()=>{this.PointsButton.forceUpdate()}),this.chat.context.on("changed:chat.banners.hype-train",this.cleanHighlights,this),this.chat.context.on("changed:chat.subs.gift-banner",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.polls",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.prediction",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.drops",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.pinned-message",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.hide-appleplus",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.shared-chat",this.cleanHighlights,this),this.chat.context.on("changed:chat.disable-handling",this.updateDisableHandling,this),this.chat.context.on("changed:chat.banners.charity",()=>{this.ChatContainer.forceUpdate()}),this.chat.context.on("changed:chat.subs.gift-banner",()=>this.GiftBanner.forceUpdate(),this),this.chat.context.on("changed:chat.effective-width",this.updateChatCSS,this),this.settings.main_context.on("changed:chat.use-width",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.size",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.hover-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.timestamp-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.on("changed:theme.color.background",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-background",this.updateColors,this),this.chat.context.on("changed:theme.color.text",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-text",this.updateColors,this),this.chat.context.on("changed:chat.lines.borders",this.updateLineBorders,this),this.chat.context.on("changed:chat.filtering.highlight-mentions",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.highlight-tokens",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.mention-color",this.updateMentionCSS,this),this.chat.context.on("changed:chat.pin-resubs",p=>{p&&(this.updateInlineCallouts(),this.updatePinnedCallouts())},this),this.chat.context.on("changed:chat.community-chest.show",()=>{this.CommunityChestBanner.forceUpdate(),this.updateCallouts()},this),this.chat.context.getChanges("chat.emotes.2x",p=>{this.css_tweaks.toggle("big-emoji",p>1),this.toggleEmoteJail()}),this.chat.context.getChanges("chat.emotes.limit-size",()=>this.toggleEmoteJail()),this.chat.context.getChanges("chat.banners.last-events",p=>this.css_tweaks.toggleHide("last-x-events",!p)),this.chat.context.getChanges("chat.input.show-mod-view",p=>this.css_tweaks.toggleHide("ci-mod-view",!p)),this.chat.context.getChanges("chat.input.show-highlight",p=>this.css_tweaks.toggleHide("ci-highlight-settings",!p)),this.chat.context.getChanges("chat.input.show-shield",p=>this.css_tweaks.toggleHide("ci-shield-mode",!p)),this.chat.context.getChanges("chat.lines.padding",p=>this.css_tweaks.toggle("chat-padding",p)),this.chat.context.getChanges("chat.bits.show",p=>this.css_tweaks.toggle("hide-bits",!p)),this.chat.context.on("changed:chat.bits.show-pinned",()=>this.ChatLeaderboard.forceUpdate()),this.chat.context.getChanges("chat.filtering.deleted-style",p=>{this.css_tweaks.toggle("chat-deleted-strike",p===1||p===2),this.css_tweaks.toggle("chat-deleted-fade",p<2)}),this.chat.context.getChanges("chat.filtering.clickable-mentions",p=>this.css_tweaks.toggle("clickable-mentions",p)),this.chat.context.getChanges("chat.filtering.bold-mentions",p=>this.css_tweaks.toggle("chat-mention-no-bold",!p)),this.chat.context.getChanges("chat.hide-community-highlights",p=>this.css_tweaks.toggleHide("community-highlights",p)),this.chat.context.getChanges("chat.lines.alternate",p=>{this.css_tweaks.toggle("chat-rows",p),this.updateMentionCSS()}),this.chat.context.getChanges("chat.input.show-elevate-your-message",p=>this.css_tweaks.toggleHide("elevate-your-message",!p)),this.updateDisableHandling(),this.updateChatCSS(),this.updateColors(),this.updateLineBorders(),this.on("chat:get-messages-late",(p,$,M,Z)=>{if(!p)return;const H=new Set(Z.map(j=>j.message?.id));for(const j of this.ChatBuffer.instances){for(const U of j.buffer){const ee=U?.id;!ee||H.has(ee)||!U.ffz_standardized||(H.add(ee),Z.push({message:U,_instance:null,update:()=>null}))}for(const U of j.delayedMessageBuffer){const ee=U?.event,he=ee?.id;!he||H.has(he)||!ee.ffz_standardized||(H.add(he),Z.push({message:ee,_instance:null,update:()=>null}))}}}),this.on("chat:get-tab-commands",p=>{p.commands.push({name:"reconnect",description:"Force chat to reconnect.",permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.on("chat:pre-send-message",p=>{const $=p.message,M=p._inst;/^\/reconnect ?/i.test($)&&(p.preventDefault(),M.client?.reconnect?(M.addMessage({type:l.chat_types.Notice,message:l.i18n.t("chat.reconnect","FFZ is forcing chat to reconnect...")}),M.client.reconnect()):M.addMessage({type:l.chat_types.Notice,message:l.i18n.t("chat.reconnect.unable","FFZ is unable to force chat to reconnect.")}))}),this.RaidController.on("mount",this.wrapRaidController,this),this.RaidController.on("update",this.noAutoRaids,this),this.RaidController.ready((p,$)=>{for(const M of $)this.wrapRaidController(M)}),this.InlineCallout.on("mount",this.onInlineCallout,this),this.InlineCallout.on("update",this.onInlineCallout,this),this.InlineCallout.ready(()=>this.updateInlineCallouts()),this.PinnedCallout.on("mount",this.onPinnedCallout,this),this.PinnedCallout.on("update",this.onPinnedCallout,this),this.PinnedCallout.ready(()=>this.updatePinnedCallouts());const l=this;this.PointsInfo.on("mount",this.updatePointsInfo,this),this.PointsInfo.on("update",this.updatePointsInfo,this),this.PointsInfo.on("unmount",()=>this.updatePointsInfo(null)),this.PointsInfo.ready(()=>this.updatePointsInfo(this.PointsInfo.first)),this.ChatLeaderboard.ready(p=>{const $=p.prototype.render;p.prototype.render=function(){return l.chat.context.get("chat.bits.show-pinned")?$.call(this):null},this.ChatLeaderboard.forceUpdate()}),this.GiftBanner.ready(p=>{const $=p.prototype.render;p.prototype.render=function(){return l.chat.context.get("chat.subs.gift-banner")?$.call(this):null},this.GiftBanner.forceUpdate()}),this.CommunityChestBanner.ready(p=>{const $=p.prototype.render;p.prototype.render=function(){try{if(!l.chat.context.get("chat.community-chest.show"))return null}catch(M){l.log.capture(M),l.log.error(M)}return $.call(this)},this.CommunityChestBanner.forceUpdate()}),this.PointsButton.ready(p=>{const $=p.prototype.render;p.prototype.render=function(){try{if(!l.chat.context.get("chat.points.show-button"))return null;const M=this.state.animationQueue,Z=this.props.bitsEnabled;l.chat.context.get("chat.points.show-rewards")||(this.state.animationQueue=[]),l.chat.context.get("chat.bits.show")||(this.props.bitsEnabled=!1);const H=$.call(this);return this.state.animationQueue=M,this.props.bitsEnabled=Z,H}catch(M){l.log.capture(M),l.log.error(M)}return $.call(this)},this.PointsButton.forceUpdate()}),this.PointsClaimButton.ready(p=>{p.prototype.ffzHasOffer=function(){return!this.props.hidden&&!this.state?.error&&this.getClaim()!=null};const $=p.prototype.render;p.prototype.render=function(){try{if(this.ffzHasOffer()&&!this._ffz_timer&&l.chat.context.get("chat.points.auto-rewards")&&(this._ffz_timer=setTimeout(()=>{this._ffz_timer=null,this.onClick&&this.ffzHasOffer()&&this.onClick()},1e3+Math.floor(Math.random()*5e3))),!l.chat.context.get("chat.points.show-rewards"))return null}catch(M){l.log.capture(M),l.log.error(M)}return $.call(this)},this.PointsClaimButton.forceUpdate()}),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatUnmounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatService.ready((p,$)=>{this.wrapChatService(p);for(const M of $){M.client.events.removeAll(),M._ffzInstall();const Z=M.joinedChannel,H=M.client?.session?.channelstate?.[`#${Z}`]?.roomState;H&&this.updateChatState(H),M.addEventListeners(),M.props.setChatConnectionAPI({sendMessage:M.sendMessage,_ffz_inst:M})}}),this.ChatBuffer.ready((p,$)=>{this.wrapChatBuffer(p);for(const M of $){const Z=M.props.messageHandlerAPI;Z&&Z.removeMessageHandler(M.handleMessage),M._ffzInstall(),Z&&Z.addMessageHandler(M.handleMessage),M.props.setMessageBufferAPI({addUpdateHandler:M.addUpdateHandler,removeUpdateHandler:M.removeUpdateHandler,getUnreadCount:M.getUnreadCount,getMessages:M.getMessages,getMessagesForHighlight:M.getMessagesForHighlight,getMessagesForAllHighlights:M.getMessagesForAllHighlights,isPaused:M.isPaused,setPaused:M.setPaused,hasNewerLeft:M.hasNewerLeft,loadNewer:M.loadNewer,loadNewest:M.loadNewest,_ffz_inst:M})}}),this.ChatRewardEventHandler.ready((p,$)=>{const M=this,Z=p.prototype.subscribe;p.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const H=this,j=this.handleMessage;this.handleMessage=function(U){if(M.disable_handling)return j.call(this,U);try{if(!H.props?.channelID||!U)return;M.insertChannelPointMessage(U);return}catch(ee){return M.log.error("Error handling reward event:",ee),j.call(this,U)}}},p.prototype.subscribe=function(...H){try{this.ffzInstall()}catch(j){M.log.error("Error in subscribe for RewardEventHandler:",j)}return Z.call(this,...H)};for(const H of $)H.subscribe()}),this.ChatBufferConnector.on("mount",this.connectorMounted,this),this.ChatBufferConnector.on("update",this.connectorUpdated,this),this.ChatBufferConnector.on("unmount",this.connectorUnmounted,this),this.ChatBufferConnector.ready((p,$)=>{for(const M of $)this.connectorMounted(M)}),this.ChatController.ready((p,$)=>{const M=this,Z=p.prototype.componentDidCatch,H=p.prototype.render;p.prototype.componentDidCatch=function(j,U){const ee=this.state.ffz_errors||0;if(ee<100&&(this.setState({ffz_errors:ee+1}),M.log.info("Error within Chat",j,U,ee)),Z)return Z.call(this,j,U)},p.prototype.render=function(){if(this.state.ffz_errors>0){const j=M.site.getReact(),U=j&&j.createElement;return U?U("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},"There was an error displaying chat."):null}return H.call(this)};for(const j of $)this.chatMounted(j)}),this.ChatRenderer.on("mount",this.rendererMounted,this),this.ChatRenderer.on("unmount",this.rendererUnmounted,this),this.ChatRenderer.on("update",this.rendererUpdated,this),this.ChatRenderer.ready((p,$)=>{for(const M of $)this.rendererMounted(M)}),this.ChatContainer.on("mount",this.containerMounted,this),this.ChatContainer.on("unmount",this.containerUnmounted,this),this.ChatContainer.on("update",this.containerUpdated,this),this.CalloutSelector.ready((p,$)=>{const M=this,Z=p.prototype.render;p.prototype.render=function(){try{if(M.CalloutStackHandler){const H=M.site.getReact(),j=Z.call(this),U=j?.props?.children;return Array.isArray(U)&&U.push(H.createElement(M.CalloutStackHandler)),j}}catch{}return Z.call(this)};for(const H of $)H.forceUpdate()}),this.ChatContainer.ready((p,$)=>{const M=this,Z=p.prototype.render,H=p.prototype.componentDidCatch;p.prototype.ffzRender=function(){if(M.chat.context.get("chat.banners.charity"))return Z.call(this);const j=this.props.campaignData;this.props.campaignData=null;let U;try{U=Z.call(this)}catch(ee){throw this.props.campaignData=j,ee}return this.props.campaignData=j,U},p.prototype.render=function(){try{if(M.CommunityStackHandler){const j=M.site.getReact(),U=this.ffzRender(),ee=U?.props?.children?.props?.children;return j&&Array.isArray(ee)&&ee.push(j.createElement(M.CommunityStackHandler)),U}}catch{}return this.ffzRender()},p.prototype.componentDidCatch=function(j,U){const ee=this.state.ffz_errors||0;if(ee<100&&(this.setState({ffz_errors:ee+1}),M.log.info("Error within Chat Container",j,U,ee)),H)return H.call(this,j,U)};for(const j of $)this.containerMounted(j)}),this.subpump.on(":pubsub-message",p=>{if(p.prefix!=="community-points-channel-v1"||this.disable_handling)return;if(p.prefix==="pinned-chat-updates-v1"){this.log.debug("Pinned Chat",p);return}const $=this.ChatService.first,M=p.message,Z=M?.data?.redemption;!M||!$||M.type!=="reward-redeemed"||$.props.channelID!=Z?.channel_id||this.insertChannelPointMessage(M)})}insertChannelPointMessage(l){const p=this.ChatService.first,$=l?.data?.redemption,M=l?.type,Z=M==="reward-redeemed",H=M==="automatic-reward-redeemed";if(!$?.reward||!p||!H&&!Z||p.props.channelID!=$?.channel_id||Z&&$.user_input||H&&$.reward.reward_type!=="celebration")return;let j;H?j=`${inst.props.channelID}:${$.reward.reward_type}`:j=$.reward.id;const U=p.props.rewardMap[j];U&&(this.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward")||this.last_points_redeem!==$.id&&(this.last_points_redeem=$.id,p.postMessageToCurrentChannel({},{id:$.id,type:this.chat_types.Message,ffz_type:"points",ffz_reward:U,ffz_reward_highlight:(0,u.ZH)(U),messageParts:[],user:{id:$.user.id,login:$.user.login,displayName:$.user.display_name},timestamp:new Date(l.data.timestamp||$.redeemed_at).getTime()})))}shouldHideCallout(l){if(!l)return;l=wt[l]??l.replace(/_/g,"-");const p=this.callout_types??zt,$=this.chat.context.get("chat.filtering.blocked-callouts");return!!($&&$.has(l)||l===p.CommunityPointsRewards&&!this.chat.context.get("chat.points.show-callouts")||l===p.ClipLiveNudge&&!this.chat.context.get("chat.callouts.clip")||l==="prime_gift_bomb"&&!this.chat.context.get("chat.community-chest.show")||l==="megacheer_emote_recipient"&&!t.chat.context.get("chat.bits.show-rewards"))}updateCallouts(){this.updatePinnedCallouts(),this.updateInlineCallouts()}updatePinnedCallouts(){for(const l of this.PinnedCallout.instances)this.onPinnedCallout(l)}onPinnedCallout(l){const p=l.props,$=p?.event,M=$?.type;this.shouldHideCallout(M)&&(l.props.pinned?l.unpin():l.hide()),M==="share-resub"&&!p.pinned&&this.chat.context.get("chat.pin-resubs")&&!l._ffz_pinned&&(this.log.info("Automatically pinning re-sub notice."),l._ffz_pinned=!0,l.pin()),M==="drop"&&this.autoClickDrop(l)}updateInlineCallouts(){for(const l of this.InlineCallout.instances)this.onInlineCallout(l)}onInlineCallout(l){if(l.state.isHidden)return;const p=l.props?.event?.callout?.contextMenuProps,$=p?.event??l.props?.event,M=$?.type;if(this.shouldHideCallout(M)||this.shouldHideCallout(l.props?.event?.trackingType)){l.setState({isHidden:!0});return}if(M==="share-resub"&&this.chat.context.get("chat.pin-resubs")&&!l._ffz_pinned){const Z=p?.onPin;Z&&(this.log.info("Automatically pinning re-sub notice."),l._ffz_pinned=!0,l.hideOnContextMenuAction?l.hideOnContextMenuAction(Z)():Z())}M==="drop"&&this.autoClickDrop(l)}autoClickDrop(l){if((l.props?.event?.callout?.contextMenuProps?.event??l.props?.event)?.type!=="drop"||l._ffz_clicking||!this.chat.context.get("chat.drops.auto-rewards"))return;l._ffz_clicking=!0,this.resolve("site").awaitElement('button[data-a-target="chat-private-callout__primary-button"]',this.fine.getHostNode(l),1e4).then(Z=>{l._ffz_clicking=!1,!((l.props?.event?.callout?.contextMenuProps?.event??l.props?.event)?.type!=="drop"||!this.chat.context.get("chat.drops.auto-rewards"))&&Z.click()}).catch(()=>{l._ffz_clicking=!1})}wrapRaidController(l){if(l._ffz_wrapped)return this.noAutoRaids(l);l._ffz_wrapped=!0;const p=this,$=l.handleJoinRaid;l.handleJoinRaid=function(M,...Z){const H=l.props&&l.props.raid&&l.props.raid.id;return M&&M.type&&H&&p.joined_raids.add(H),$.call(this,M,...Z)},this.noAutoRaids(l)}noAutoRaids(l){l._ffz_no_raid||(l._ffz_no_raid=setTimeout(()=>{if(l._ffz_no_raid=null,l.props&&l.props.raid&&!l.isRaidCreator&&l.hasJoinedCurrentRaid){const p=l.props.raid.id;if(this.joined_raids.has(p))return;let $=this.settings.get("channel.raids.no-autojoin");if(!$){const M=this.settings.get("__filter:channel.raids.blocked-channels");if(M&&(l.props.raid.targetLogin&&M.test(l.props.raid.targetLogin)||l.props.raid.targetDisplayName&&M.test(l.props.raid.targetDisplayName))&&($=!0),!$)return}this.log.info("Automatically leaving raid:",p),l.handleLeaveRaid()}}))}toggleEmoteJail(){const l=this.chat.context.get("chat.emotes.2x"),p=this.chat.context.get("chat.emotes.limit-size");this.css_tweaks.toggle("big-emote-jail",p&&!l),this.css_tweaks.toggle("bigger-emote-jail",p&&l)}cleanHighlights(){const l={community_sub_gift:this.chat.context.get("chat.subs.gift-banner"),megacheer:this.chat.context.get("chat.bits.show"),hype_train:this.chat.context.get("chat.banners.hype-train"),prediction:this.chat.context.get("chat.banners.prediction"),poll:this.chat.context.get("chat.banners.polls"),pinned_chat:this.chat.context.get("chat.banners.pinned-message"),"mw-drop-available":this.chat.context.get("chat.banners.drops"),shared_chat:this.chat.context.get("chat.banners.shared-chat")},p=this.community_stack?.highlights;if(Array.isArray(p))for(const $ of p){if(!$||!$.event||!$.id)continue;const M=$.event.type;M&&(0,P.has)(l,M)&&!l[M]&&(this.log.info("Removing community highlight: ",M,"#",$.id),this.community_dispatch({type:"remove-highlight",id:$.id})),M==="mw-drop-available"&&$.event.detailsURL==="https://blog.twitch.tv/2024/07/26/sub-and-get-apple-tv/"&&this.chat.context.get("chat.banners.hide-appleplus")&&(this.log.info("Removing community highlight: ",M,"#",$.id),this.community_dispatch({type:"remove-highlight",id:$.id}))}}cleanCallouts(){const l=this.callout_stack;l?.pinnedCallout?.event?.type&&this.shouldHideCallout(l.pinnedCallout.event.type)&&l.unpinCallout(),l?.callouts?.[0]?.event?.type&&this.shouldHideCallout(l.callouts[0].event.type)&&l.clearCalloutType(l.callouts[0].event.type)}defineClasses(){if(this.CommunityStackHandler&&this.CalloutStackHandler)return!0;const l=this,p=this.site.getReact(),$=p?.createElement,M=this.web_munch.getModule("highlightstack"),Z=this.web_munch.getModule("calloutstack");return $?(!this.CalloutStackHandler&&Z&&(this.CalloutStackHandler=function(){const H=p.useContext(Z.stack);return l.callout_stack=H,l.cleanCallouts(),null},this.CalloutSelector.forceUpdate()),!this.CommunityStackHandler&&M&&(this.CommunityStackHandler=function(){const H=p.useContext(M.stack),j=p.useContext(M.dispatch);return l.community_stack=H,l.community_dispatch=j,l.cleanHighlights(),null},this.ChatContainer.forceUpdate()),!0):!1}updateChatState(l){const p=this.chat.context.get("context.chat_state")||{};(0,P.deep_equals)(l,p)||(this.chat.context.updateContext({chat_state:l}),this.input.updateInput())}tryUpdateBadges(){this._badge_timer||(this._badge_timer=setTimeout(()=>this._tryUpdateBadges(),0))}_tryUpdateBadges(){this._badge_timer&&clearTimeout(this._badge_timer),this._badge_timer=null,this.log.info("Trying to update badge data from the chat container.");const l=this.ChatContainer.first;l&&this.containerUpdated(l,l.props)}wrapChatBuffer(l){if(l.prototype._ffz_was_here)return;const p=this,$=l.prototype.clear,M=l.prototype.flushRawMessages,Z=l.prototype.componentDidMount;l.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const H=this,j=H.handleMessage,U=H.props.setMessageBufferAPI;H.props.setMessageBufferAPI=function(ee){return ee&&(ee._ffz_inst=H),U(ee)},H.handleMessage=function(ee){if(ee)try{const he=p.chat_types||{},Se=p.mod_types||{};if(p.chat.context.get("chat.filtering.blocked-types").has(he[ee.type])||ee.type===he.ChannelPointsReward&&!(0,u.zZ)(ee.reward)||ee.type===he.RewardGift&&!p.chat.context.get("chat.bits.show-rewards"))return;if(ee.type===he.Message){const Me=p.chat.standardizeMessage(ee),X=H._ffz_connector??H.ffzGetConnector();let _e=Me.roomID=Me.roomID?Me.roomID:X?.props?.channelID,se=Me.roomLogin=Me.roomLogin?Me.roomLogin:Me.channel?Me.channel.slice(1):X?.props?.channelLogin;if(!se&&_e){const Ne=p.chat.getRoom(_e,null,!0);Ne&&Ne.login&&(se=Me.roomLogin=Ne.login)}if(!_e&&se){const Ne=p.chat.getRoom(null,se,!0);Ne&&Ne.id&&(_e=Me.roomID=Ne.id)}const Ce=p.site.getUser();if(Ce&&X&&(Ce.moderator=X.props.isCurrentUserModerator,Ce.staff=X.props.isStaff),Me.ffz_tokens=Me.ffz_tokens||p.chat.tokenizeMessage(Me,Ce,!0),Me.ffz_removed)return;if(p.hasListeners("chat:receive-message")){const Ne=p.makeEvent({message:Me,inst:H,channel:se,channelID:_e});if(p.emit("chat:receive-message",Ne),Ne.defaultPrevented||Me.ffz_removed)return}}else if(ee.type===he.Moderation){if(p.emit("chat:mod-user",ee.moderationType,ee.userLogin,ee.targetMessageID,ee),!H.props.isCurrentUserModerator){const Me=ee.moderationType,X=ee.userLogin;let _e;if(Me===Se.Ban?_e="ban":Me===Se.Timeout?_e="timeout":Me===Se.Delete&&(_e="delete"),_e&&(ee.moderationActionType=_e),!H.moderatedUsers.has(X)&&Me!==Se.Delete){H.moderateBuffers([H.buffer,H.delayedMessageBuffer.map(se=>se.event)],X,ee),H.delayedMessageBuffer.push({event:ee,time:Date.now(),shouldDelay:!1});return}}}else ee.type===he.Clear&&(p.chat.context.get("chat.filtering.ignore-clear")?ee={type:he.Info,message:p.i18n.t("chat.ignore-clear","An attempt by a moderator to clear chat was ignored.")}:p.emit("chat:clear-chat",ee))}catch(he){p.log.error("Error processing chat event.",he),p.log.capture(he,{extra:{msg:ee}})}return j.call(H,ee)},H.setPaused=function(ee){H.paused!==ee&&(H.paused=ee,ee||(H.slidingWindowEnd=Math.min(H.buffer.length,p.chat.context.get("chat.scrollback-length")),H.props.isBackground||H.notifySubscribers()))},H.loadNewer=function(){if(!H.hasNewerLeft())return;const ee=Math.min(H.buffer.length,H.slidingWindowEnd+40),he=Math.max(0,ee-p.chat.context.get("chat.scrollback-length"));H.clear(H.buffer.length-he),H.slidingWindowEnd=ee-he,H.props.isBackground||H.notifySubscribers()},H.loadNewest=function(){if(!H.hasNewerLeft())return;const ee=p.chat.context.get("chat.scrollback-length");H.clear(ee),H.slidingWindowEnd=Math.min(ee,H.buffer.length),H.props.isBackground||H.notifySubscribers()},H.getMessages=function(){return H.buffer.slice(0,H.slidingWindowEnd+(H.ffz_extra||0))}},l.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(H){p.log.error("Error installing FFZ features onto chat buffer.",H)}return Z.call(this)},l.prototype.clear=function(H){try{H==null&&(H=0);const j=p.chat.context.get("chat.scrollback-length");if(!this.isPaused()&&H>j&&(H=j),H<=0)this.ffz_extra=0,this.buffer=[],this.delayedMessageBuffer=[],this.paused=!1;else{const U=this.buffer,ee=p.chat_types||Ye,he=U.length-H;if(he>0){let Se=0,De;for(let Me=0;Me<he;Me++)U[Me]&&!it.includes(ee[U[Me].type])&&(Se++,De=Me);this.buffer=U.slice(Se%2!==0?Math.max(he-4,De):he),this.ffz_extra=U.length-H}else this.ffz_extra=0,this.buffer=this.buffer.slice(0);this.paused&&this.buffer.length>=900&&this.setPaused(!1)}}catch(j){return p.log.error("Error running clear",j),$.call(this,H)}},l.prototype.ffzGetConnector=function(){if(this._ffz_connector)return this._ffz_connector;const H=Date.now();if(H-(this._ffz_connect_tried||0)>5e3){this._ffz_connect_tried=H;const j=p.ChatBufferConnector.first;if(j?.props?.messageBufferAPI?._ffz_inst===this)return this._ffz_connector=j}},l.prototype.flushRawMessages=function(){try{const H=[],j=p.chat_types||Ye,U=Date.now(),ee=p.chat.context.get("chat.delay"),he=ee===-1?this.delayDuration:ee,Se=U-he,De=this.shouldSeeBlockedAndDeletedMessages||this.props&&this.props.shouldSeeBlockedAndDeletedMessages,Me=this.hasNewerLeft(),X=this.isPaused(),_e=p.chat.context.get("chat.scrollback-length"),se=p.chat.context.get("chat.filtering.remove-deleted"),Ce=p.hasListeners("chat:buffer-message");let Ne=0,We=this.slidingWindowEnd,Xe=!1,de;for(const ke of this.delayedMessageBuffer)if(ke.time<=Se||!ke.shouldDelay){if(se!==0&&(se>1||!De)&&this.isDeletable(ke.event)&&ke.event.deleted)continue;if(Ce){if(de)de._reset();else{de=p.makeEvent({inst:this,channel:void 0,channelID:void 0,message:void 0});const rt=this._ffz_connector??this.ffzGetConnector(),at=rt&&rt.props.channelID;if(de.channelID=at,at){const At=p.chat.getRoom(at,null,!0);At&&At.login&&(de.channel=At.login)}}if(de.message=ke.event,p.emit("chat:buffer-message",de),de.defaultPrevented||ke.event.ffz_removed)continue}const $e=this.buffer[this.buffer.length-1],Ge=$e?.type;!this.props.isLoadingHistoricalMessages&&!this.props.historicalMessages||Ge!==j.Connected||ke.event.type===j.Connected||this.buffer.find(rt=>rt.type===j.LiveMessageSeparator)||this.buffer.push({type:j.LiveMessageSeparator,id:"live-message-separator"}),this.buffer.push(ke.event),Xe=!0,this.paused||(this.buffer.length>_e?Ne++:We++)}else H.push(ke);this.delayedMessageBuffer=H,Xe&&(this.clear(Math.min(900,this.buffer.length-Ne)),Ne===0&&We===this.slidingWindowEnd&&Me===this.hasNewerLeft()&&X===this.isPaused()||(this.slidingWindowEnd=We,this.props.isBackground||this.notifySubscribers())),this.flushHighlightsBuffer&&this.flushHighlightsBuffer()}catch(H){return p.log.error("Error running flush.",H),M.call(this)}}}addNotice(l,p){if(!l)return!1;l.startsWith("#")&&(l=l.slice(1)),l=l.toLowerCase();for(const $ of this.ChatService.instances)if(l==="*"||$.props.channelLogin.toLowerCase()===l){if(typeof p=="string")$.addMessage({type:(this.chat_types??Ye).Notice,message:p});else{const M=$.props,Z=M.channelLogin,H=M.channelID;p.markdown&&((0,W.e)()||(0,W.Z)()),$.addMessage({type:(this.chat_types??Ye).Message,channel:`#${Z}`,roomID:H,roomLogin:Z,id:`ffz_notice_${(0,P.generateUUID)()}`,ffz_type:"notice",ffz_no_actions:!0,ffz_data:p,message:null,messageParts:[],timestamp:Date.now(),user:{userID:H,userLogin:Z}})}return!0}return!1}sendMessage(l,p){const $=this.ChatService.first;if(!$||!l)return null;if(l.startsWith("#")&&(l=l.slice(1)),l.toLowerCase()!==$.props.channelLogin.toLowerCase())return $.client.sendCommand(l,p);$.sendMessage(p)}scheduleMystery(l){l.line&&(l._timer||(l._timer=setTimeout(()=>requestAnimationFrame(()=>{l._timer=null,l.line&&l.line.forceUpdate()}),250)))}wrapChatService(l){const p=this,$=l.prototype.componentDidMount,M=l.prototype.addEventListeners;l.prototype._ffz_was_here=!0,l.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const Z=this,H=this.sendMessage,j=B((...ee)=>Z.addMessage(...ee),"addMessage"),U=B((ee,he)=>Z.sendMessage(ee,he),"sendMessage");Z.sendMessage=function(ee,he){if(ee=ee.replace(/\s+/g," "),ee.startsWith("/ffz:")){ee=ee.slice(5).trim();const De=ee.indexOf(" ");let Me;De===-1?(Me=ee,ee=""):(Me=ee.slice(0,De),ee=ee.slice(De+1).trimStart());const X=p.makeEvent({command:Me,message:ee,extra:he,context:p.chat.context,channel:Z.props.channelLogin,_inst:Z,addMessage:j,sendMessage:U}),_e=`chat:ffz-command:${Me}`;return p.listeners(_e)?.length>0?p.emit(_e,X):Z.addMessage({type:p.chat_types.Notice,message:p.i18n.t("chat.ffz-command.invalid","No such command: /ffz:{subcmd}",{subcmd:Me})}),!1}const Se=p.makeEvent({message:ee,extra:he,context:p.chat.context,channel:Z.props.channelLogin,_inst:Z,addMessage:j,sendMessage:U});if(p.emit("chat:pre-send-message",Se),!Se.defaultPrevented)return H.call(this,Se.message,Se.extra)}},l.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(Z){p.log.error("Error installing FFZ features onto chat service.",Z)}return $.call(this)},l.prototype.addEventListeners=function(...Z){if(!this._ffz_init){const H=this;for(const de of Wt){const ke=this[de];ke&&(this[de]=function($e,Ge){H._wrapped=$e;const rt=ke.call(H,$e,Ge);return H._wrapped=null,rt})}const j=this.onAnnouncementEvent;this.onAnnouncementEvent=function(de){return j.call(this,de)};const U=this.onSubscriptionEvent;this.onSubscriptionEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("Subscription"))return;if(p.disable_handling||p.chat.context.get("chat.subs.native"))return U.call(H,de);if(p.chat.context.get("chat.subs.show")<3)return;de.body="";const ke=H.convertMessage({message:de});return ke.ffz_type="resub",ke.gift_theme=de.giftTheme,ke.sharedChat=de.sharedChat,ke.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,ke.sub_plan=de.methods,ke.sub_multi=de.multiMonthData?.multiMonthDuration?{count:de.multiMonthData.multiMonthDuration,tenure:de.multiMonthData.multiMonthTenure}:null,H.postMessageToCurrentChannel(de,ke)}catch(ke){return p.log.capture(ke,{extra:de}),U.call(H,de)}};const ee=this.onRoomStateEvent;this.onRoomStateEvent=function(de){try{const ke=de.channel,$e=p.chat.context.get("context.channel");ke&&(ke===$e||ke===`#${$e}`)&&p.updateChatState(de.state)}catch(ke){p.log.capture(ke,{extra:de})}return ee.call(H,de)};const he=this.onPinnedChatEvent;this.onPinnedChatEvent=function(de){try{const ke=p.chat.context.get("chat.hype.message-style");if(ke!==1){if(de.isSystemMessage&&ke===0)return;const $e=H.convertMessage(de);return $e.ffz_type="hype",$e.sharedChat=de.sharedChat,$e.hype_amount=de.amount,$e.hype_canonical_amount=de.canonical_amount,$e.hype_currency=de.currency,$e.hype_exponent=de.exponent,$e.hype_level=de.level,de.isSystemMessage&&($e.message="",$e.messageBody="",$e.messageParts=[],de.message.body=""),H.postMessageToCurrentChannel(de,$e)}}catch(ke){p.log.capture(ke,{extra:de})}return he.call(H,de)};const Se=this.onResubscriptionEvent;this.onResubscriptionEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("Resubscription"))return;if(p.disable_handling||p.chat.context.get("chat.subs.native"))return Se.call(H,de);if(p.chat.context.get("chat.subs.show")<2&&!de.body)return;const ke=H.convertMessage({message:de});return ke.ffz_type="resub",ke.sharedChat=de.sharedChat,ke.gift_theme=de.giftTheme,ke.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,ke.sub_cumulative=de.cumulativeMonths||0,ke.sub_streak=de.streakMonths||0,ke.sub_share_streak=de.shouldShareStreakTenure,ke.sub_months=de.months,ke.sub_plan=de.methods,ke.sub_multi=de.multiMonthData?.multiMonthDuration?{count:de.multiMonthData.multiMonthDuration,tenure:de.multiMonthData.multiMonthTenure}:null,H.postMessageToCurrentChannel(de,ke)}catch(ke){return p.log.capture(ke,{extra:de}),Se.call(H,de)}};const De=this.ffz_mysteries={},Me=this.onSubscriptionGiftEvent;this.onSubscriptionGiftEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("SubGift"))return;if(p.disable_handling||p.chat.context.get("chat.subs.native"))return Me.call(H,de);const ke=`${de.channel}:${de.user.userID}`,$e=De[ke];if($e)if($e.expires<Date.now())De[ke]=null;else{$e.recipients.push({id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName}),$e.recipients.length>=$e.size&&(De[ke]=null),$e.line&&p.scheduleMystery($e);return}de.body="";const Ge=H.convertMessage({message:de});return Ge.ffz_type="sub_gift",Ge.sharedChat=de.sharedChat,Ge.sub_recipient={id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName},Ge.gift_theme=de.giftTheme,Ge.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,Ge.sub_months=de.giftMonths,Ge.sub_plan=de.methods,Ge.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,Ge)}catch(ke){return p.log.capture(ke,{extra:de}),Me.call(H,de)}};const X=this.onCommunityIntroductionEvent;this.onCommunityIntroductionEvent=function(de){try{if(p.disable_handling)return X.call(this,de);if(p.chat.context.get("chat.filtering.blocked-types").has("CommunityIntroduction")){const ke=H.convertMessage(de);return ke.sharedChat=de.sharedChat,H.postMessageToCurrentChannel(de,ke)}}catch(ke){p.log.capture(ke,{extra:de}),p.log.error(ke)}return X.call(this,de)};const _e=this.onAnonSubscriptionGiftEvent;this.onAnonSubscriptionGiftEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("AnonSubGift"))return;if(p.disable_handling||p.chat.context.get("chat.subs.native"))return _e.call(H,de);const ke=`${de.channel}:ANON`,$e=De[ke];if($e)if($e.expires<Date.now())De[ke]=null;else{$e.recipients.push({id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName}),$e.recipients.length>=$e.size&&(De[ke]=null),$e.line&&p.scheduleMystery($e);return}de.body="";const Ge=H.convertMessage({message:de});return Ge.ffz_type="sub_gift",Ge.sharedChat=de.sharedChat,Ge.gift_theme=de.giftTheme,Ge.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,Ge.sub_anon=!0,Ge.sub_recipient={id:de.recipientID,login:de.recipientLogin,displayName:de.recipientName},Ge.sub_months=de.giftMonths,Ge.sub_plan=de.methods,Ge.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,Ge)}catch(ke){return p.log.capture(ke,{extra:de}),_e.call(H,de)}};const se=this.onSubscriptionMysteryGiftEvent;this.onSubscriptionMysteryGiftEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("SubMysteryGift"))return;if(p.disable_handling||p.chat.context.get("chat.subs.native"))return se.call(H,de);let ke=null;if(de.massGiftCount>p.chat.context.get("chat.subs.merge-gifts")){const Ge=`${de.channel}:${de.user.userID}`;ke=De[Ge]={recipients:[],size:de.massGiftCount,expires:Date.now()+3e4}}de.body="";const $e=H.convertMessage({message:de});return $e.ffz_type="sub_mystery",$e.sharedChat=de.sharedChat,$e.gift_theme=de.giftTheme,$e.sub_goal=H.getGoalData?H.getGoalData(de.goalData):null,$e.mystery=ke,$e.sub_plan=de.plan,$e.sub_count=de.massGiftCount,$e.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,$e)}catch(ke){return p.log.capture(ke,{extra:de}),se.call(H,de)}};const Ce=this.onAnonSubscriptionMysteryGiftEvent;this.onAnonSubscriptionMysteryGiftEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("AnonSubMysteryGift"))return;if(p.disable_handling||p.chat.context.get("chat.subs.native"))return Ce.call(H,de);let ke=null;if(de.massGiftCount>p.chat.context.get("chat.subs.merge-gifts")){const Ge=`${de.channel}:ANON`;ke=De[Ge]={recipients:[],size:de.massGiftCount,expires:Date.now()+3e4}}de.body="";const $e=H.convertMessage({message:de});return $e.ffz_type="sub_mystery",$e.sharedChat=de.sharedChat,$e.sub_anon=!0,$e.mystery=ke,$e.sub_plan=de.plan,$e.sub_count=de.massGiftCount,$e.sub_total=de.senderCount,H.postMessageToCurrentChannel(de,$e)}catch(ke){return p.log.capture(ke,{extra:de}),Ce.call(H,de)}};const Ne=this.onRitualEvent;this.onRitualEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("Ritual"))return;if(p.disable_handling)return Ne.call(H,de);const ke=H.convertMessage(de);return ke.sharedChat=de.sharedChat,ke.ffz_type="ritual",ke.ritual=de.type,H.postMessageToCurrentChannel(de,ke)}catch(ke){return p.log.capture(ke,{extra:de}),Ne.call(H,de)}};const We=this.onChannelPointsRewardEvent;this.onChannelPointsRewardEvent=function(de){try{if(p.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward"))return;if(p.disable_handling)return We.call(H,de);const ke=de.rewardID&&(0,P.get)(de.rewardID,H.props.rewardMap);if(ke){const $e=H.convertMessage(de);return p.chat.context.get("chat.powerup.effects")&&(0,u.zZ)(ke)&&de.animationID?H.postMessageToCurrentChannel(de,{type:p.chat_types.ChannelPointsReward,id:$e.id,displayName:$e.user.userDisplayName,login:$e.user.userLogin,reward:ke,message:$e,userID:$e.user.userID,animationID:de.animationID,sharedChat:de.sharedChat}):($e.ffz_animation_id=de.animationID,$e.sharedChat=de.sharedChat,$e.ffz_type="points",$e.ffz_reward=ke,$e.ffz_reward_highlight=(0,u.ZH)(ke),H.postMessageToCurrentChannel(de,$e))}}catch(ke){p.log.error(ke),p.log.capture(ke,{extra:de})}return We.call(H,de)};const Xe=this.addMessage;this.addMessage=function(de){const ke=H._wrapped;return ke&&!de._ffz_checked?H.postMessageToCurrentChannel(ke,de):Xe.call(H,de)},this._ffz_init=!0}return M.apply(this,...Z)},l.prototype.postMessageToCurrentChannel=function(Z,H){const j=H;if(H._ffz_checked=!0,(H.type===p.chat_types.ChannelPointsReward||H.type===p.chat_types.CommunityIntroduction||H.message?.user&H.message?.badgeDynamicData)&&(H=H.message),Z.channel){let U=H.channel=Z.channel.toLowerCase();if(U.startsWith("#")&&(U=U.slice(1)),U!==this.props.channelLogin.toLowerCase())return;H.roomLogin=U}if(H.ffz_first_msg=H.isFirstMsg||Z.message?.isFirstMsg||!1,H.ffz_returning=Z.message?.isReturningChatter||!1,Z.message){const U=Z.message.user,ee=Z.message.flags;if(U&&(H.emotes=U.emotes),ee&&this.getFilterFlagOptions){const he=this.props.isCurrentUserModerator&&p.chat.context.get("chat.automod.run-as-mod");he&&(this.props.isCurrentUserModerator=!1),H.flags=this.getFilterFlagOptions(ee),he&&(this.props.isCurrentUserModerator=!0)}(!H.message||typeof H.message=="string")&&(typeof Z.action=="string"?H.message=Z.action:H.message=Z.message.body)}this.addMessage(j)}}addRoom(l,p){if(p||(p=l.props),!p.channelID)return null;const $=l._ffz_room=this.chat.getRoom(p.channelID,p.channelLogin&&p.channelLogin.toLowerCase(),!1,!0);return $.ref(l),$}removeRoom(l){l._ffz_room&&(l._ffz_room.unref(l),l._ffz_room=null)}chatMounted(l,p){l.chatBuffer&&(l.chatBuffer.ffzController=l),p||(p=l.props),this.addRoom(l,p)&&(this.updateRoomBitsConfig(l,p.bitsConfig),this.settings.updateContext({moderator:p.isCurrentUserModerator,chatHidden:p.isHidden}),(p.isEmbedded||p.isPopout)&&this.settings.updateContext({channel:p.channelLogin&&p.channelLogin.toLowerCase(),channelID:p.channelID}),this.chat.context.updateContext({moderator:p.isCurrentUserModerator,channel:p.channelLogin&&p.channelLogin.toLowerCase(),channelID:p.channelID}))}chatUnmounted(l){l.chatBuffer&&l.chatBuffer.ffzController===this&&(l.chatBuffer.ffzController=null),(l.props.isEmbedded||l.props.isPopout)&&this.settings.updateContext({channel:null,channelID:null}),this.settings.updateContext({moderator:!1,chatHidden:!1}),this.chat.context.updateContext({moderator:!1,channel:null,channelID:null}),this.removeRoom(l)}chatUpdated(l,p){if(l.chatBuffer&&(l.chatBuffer.ffzController=l),!l._ffz_room||p.channelID!=l._ffz_room.id){this.removeRoom(l),l._ffz_mounted&&this.chatMounted(l);return}p.bitsConfig!==l.props.bitsConfig&&this.updateRoomBitsConfig(l,l.props.bitsConfig);let $=l.props.channelLogin;$&&($=$.toLowerCase()),(l.props.isEmbedded||l.props.isPopout)&&this.settings.updateContext({channel:$,channelID:l.props.channelID}),this.settings.updateContext({moderator:l.props.isCurrentUserModerator,chatHidden:l.props.isHidden}),this.chat.context.updateContext({moderator:l.props.isCurrentUserModerator,channel:$,channelID:l.props.channelID})}updateRoomBitsConfig(l,p){const $=l._ffz_room;if(!$)return;let M=null;if(p&&Array.isArray(p.orderedActions)){M=new Set;for(const Z of p.orderedActions)Z&&Z.prefix&&M.add(Z.prefix)}!this._ffz_old_bits&&!M||(0,P.set_equals)(this._ffz_old_bits,M)||(this._ffz_old_bits=M,$.updateBitsConfig(ue(p)),this.chat_line.updateLineTokens())}connectorMounted(l){const p=l.props.messageBufferAPI;p&&p._ffz_inst&&p._ffz_inst._ffz_connector!==l&&(p._ffz_inst._ffz_connector=l)}connectorUpdated(l,p){const $=p.messageBufferAPI,M=l.props.messageBufferAPI;$!==M&&($&&$._ffz_inst&&$._ffz_inst._ffz_connector===l&&($._ffz_inst._ffz_connector=null),M&&M._ffz_inst&&M._ffz_inst._ffz_connector!==l&&($._ffz_inst._ffz_connector=l))}connectorUnmounted(l){const p=l.props.messageBufferAPI;p&&p._ffz_inst&&p._ffz_inst._ffz_connector===l&&(p._ffz_inst._ffz_connector=null)}rendererMounted(l,p){p||(p=l.props),this.updateRendererSharedChats(l,p?.sharedChatDataByChannelID)}updateRendererSharedChats(l,p){if(p??(p=l.props.sharedChatDataByChannelID),l._ffz_cached_shared===p)return;this.shared_room_data=l._ffz_cached_shared=p,this.shared_rooms=l._ffz_shared_rooms=l._ffz_shared_rooms||{};const $=new Set(Object.keys(l._ffz_shared_rooms));let M=!1;if(p!=null)for(const[H,j]of p.entries()){$.delete(H);let U=l._ffz_shared_rooms[H];U||(U=this.chat.getRoom(H,j.login),U.ref(l),l._ffz_shared_rooms[H]=U);const ee=j.badges?.channelsBySet;let he=0;if(ee)for(const Se of ee.values())for(const De of Se.values())he++;U.badgeCount()!==he&&(M=!0,U.updateBadges(ee))}for(const H of $){const j=l._ffz_shared_rooms[H];j&&j.unref(l),j.unshareChat(),delete l._ffz_shared_rooms[H]}const Z=Object.keys(l._ffz_shared_rooms);for(const H of Object.values(l._ffz_shared_rooms))H.shareChats(Z);Z.length>0&&this.settings.provider.get("shared-chat-notice")!==1&&(this.settings.provider.set("shared-chat-notice",1),this.addNotice("*",{icon:"ffz-i-zreknarf",message:this.i18n.t("chat.shared-chat.welcome","FrankerFaceZ: This is a Shared Chat, a new feature from Twitch to combine multiple stream chats into one. FrankerFaceZ support is early, so some messages might not look correct. Sorry for any trouble!")})),M&&this.chat_line.updateLineBadges()}rendererUnmounted(l){if(l._ffz_shared_rooms)for(const p of Object.values(l._ffz_shared_rooms))p.unref(l);l._ffz_shared_rooms=null,l._ffz_cached_shared=null,this.shared_room_data=new Map,this.shared_rooms={}}rendererUpdated(l,p){this.updateRendererSharedChats(l,p?.sharedChatDataByChannelID)}get shouldUpdateChannel(){const l=this.router.current_name;return m.Z.POPOUT_ROUTES.includes(l)||m.Z.SUNLIGHT_ROUTES.includes(l)}containerMounted(l,p){if(p||(p=l.props),!!this.addRoom(l,p)&&(this.updateRoomBitsConfig(l,p.bitsConfig),p.globalBadgeData?.badges?this.chat.badges.updateTwitchBadges(p.globalBadgeData.badges):p.data?.badges&&this.chat.badges.updateTwitchBadges(p.data.badges),p.data)){if(this.shouldUpdateChannel){const $=p.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor($),this.settings.updateContext({channel:p.channelLogin,channelID:p.channelID,channelColor:$})}this.updateRoomBadges(l,p.data.user&&p.data.user.broadcastBadges),this.updateRoomRules(l,p.chatRules)}}containerUnmounted(l){this.shouldUpdateChannel&&(this.resolve("site.channel").updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})),this.removeRoom(l)}containerUpdated(l,p){if(!l._ffz_room||p.channelID!=l._ffz_room.id){this.removeRoom(l),l._ffz_mounted&&this.containerMounted(l,p);return}if(p.bitsConfig!==l.props.bitsConfig&&this.updateRoomBitsConfig(l,p.bitsConfig),p.data&&m.Z.POPOUT_ROUTES.includes(this.router.current_name)){const j=p.data.user?.primaryColorHex;this.resolve("site.channel").updateChannelColor(j),this.settings.updateContext({channel:p.channelLogin,channelID:p.channelID,channelColor:j})}const $=p.data?.user?.broadcastBadges??[],M=l.props.data?.user?.broadcastBadges??[],Z=p.globalBadgeData?.badges??[],H=l.props.globalBadgeData?.badges??[];(this.chat.badges.getTwitchBadgeCount()!==Z.length||Z.length!==H.length)&&this.chat.badges.updateTwitchBadges(Z),(l._ffz_room.badgeCount()!==$.length||$.length!==M.length)&&this.updateRoomBadges(l,$),this.updateRoomRules(l,p.chatRules)}hasRoomBadges(l){const p=l._ffz_room;return p?p.hasBadges():!1}updateRoomBadges(l,p){const $=l._ffz_room;$&&($.updateBadges(p),this.chat_line.updateLineBadges())}updateRoomRules(l,p){const $=l._ffz_room;$&&($.rules=p)}};B(Kt,"ChatHook");let ye=Kt;function ue(nt){if(!nt)return;const l={},p=nt.indexedActions,$={};if(Array.isArray(nt.tiers))for(const M of nt.tiers)$[M.bits]=M.color;for(const M in p)if((0,P.has)(p,M)){const Z=p[M],H=l[M]={id:Z.id,prefix:Z.prefix,tiers:[]};if(nt?.getImage)for(const j of Z.orderedTiers){const U={};for(const ee of["light","dark"]){const he=U[ee]=U[ee]||{},Se=he.static=he.static||{},De=he.animated=he.animated||{};for(const Me of[1,2,4])Se[Me]=nt.getImage(Z.prefix,ee,"static",j.bits,Me,"png"),De[Me]=nt.getImage(Z.prefix,ee,"animated",j.bits,Me,"gif")}H.tiers.push({amount:j.bits,color:j.color||$[j.bits]||"inherit",id:j.id,images:U})}else if(Z.orderedTiers[0]?.images)for(const j of Z.orderedTiers){const U={};for(const ee of j.images){const he=U[ee.theme]=U[ee.theme]||[],Se=ee.isAnimated?"animated":"static",De=he[Se]=he[Se]||{};De[ee.dpiScale]=ee.url}H.tiers.push({amount:j.bits,color:j.color||$[j.bits]||"inherit",id:j.id,images:U})}}return l}B(ue,"formatBitsConfig")},44615:(ge,te,S)=>{"use strict";S.d(te,{KC:()=>K,ZH:()=>I,_x:()=>W,at:()=>m,yg:()=>c,zZ:()=>x});function K(d){return d.pricingType==="BITS"}B(K,"doesRewardCostBits");function P(d){return d?.__typename==="CommunityPointsAutomaticReward"}B(P,"isAutomaticReward");function L(d){return d?.__typename==="CommunityPointsCustomReward"}B(L,"isCustomReward");function I(d){return P(d)&&d.type==="SEND_HIGHLIGHTED_MESSAGE"}B(I,"isHighlightedReward");function W(d){return d&&(d.title?.includes?.("FFZ:GE")||d.prompt?.includes?.("FFZ:GE"))}B(W,"isGiantEmoteReward");function x(d){return d?.type==="SEND_ANIMATED_MESSAGE"}B(x,"isMessageEffect");function m(d){const f=K(d);return P(d)?f?d.bitsCost||d.defaultBitsCost:d.cost||d.defaultCost:f?d.bitsCost:d.cost}B(m,"getRewardCost");function b(d){return P(d)?d.backgroundColor||d.defaultBackgroundColor:d.backgroundColor}B(b,"getRewardColor");function c(d,f){if(L(d))return d.title;switch(d.type){case"SEND_ANIMATED_MESSAGE":return f.t("chat.points.animated","Message Effects");case"SEND_HIGHLIGHTED_MESSAGE":return f.t("chat.points.highlighted","Highlight My Message");case"SINGLE_MESSAGE_BYPASS_SUB_MODE":return f.t("chat.points.bypass-sub","Send a Message in Sub-Only Mode");case"CHOSEN_SUB_EMOTE_UNLOCK":return f.t("chat.points.choose-emote","Choose an Emote to Unlock");case"RANDOM_SUB_EMOTE_UNLOCK":return f.t("chat.points.random-emote","Unlock a Random Sub Emote");case"CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK":return f.t("chat.points.modify-emote","Modify a Single Emote");default:return f.t("chat.points.reward","Reward")}}B(c,"getRewardTitle")},6325:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>L});var K=S(22527),P=S(46949);const I=class I extends K.default{constructor(...x){super(...x),this.should_enable=!0,this.inject("settings"),this.inject("site.chat"),this.inject("chat.emotes")}onEnable(){this.hookEmoteMenu()}async hookEmoteMenu(){const x=await this.findEmoteMenu();if(!x)return this.log.info("Emote Menu for Twitch was not found after 60 seconds.");x.registerEmoteGetter("FrankerFaceZ",()=>{const m=this.chat.ChatContainer.first,b=m&&m.props;if(!b)return;const c=this.emotes.getSets(b.userID,b.currentUserLogin,b.channelID,b.channelLogin),d=this.resolve("chat"),f=(d?.context||this.settings)?.get?.("chat.emotes.animated")>0,r=[];for(const g of c)if(!(!g||!g.emotes)){for(const u in g.emotes)if((0,P.has)(g.emotes,u)){const w=g.emotes[u];if(w.hidden)continue;r.push({text:w.name,url:f&&w.animated?.[1]||w.urls[1],channel:`${g.source||"FrankerFaceZ"} ${g.title}`,badge:g.icon||"//cdn.frankerfacez.com/script/devicon.png"})}}return r})}async findEmoteMenu(x=0){return window.emoteMenu&&emoteMenu.registerEmoteGetter?emoteMenu:x>=6e4?null:(await(0,P.sleep)(100),this.findEmoteMenu(x+100))}};B(I,"CompatEmoteMenu");let L=I},17103:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>m});var K=S(22527),P=S(44589),L=S(46949),I=S(83342);const W=document.createElement("span"),x={"side-nav":".side-nav,#sideNav","side-nav-viewers":".side-nav-card__live-status","side-rec-channels":".side-nav .recommended-channels,.side-nav .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-friends":".side-nav .online-friends","side-closed-friends":".side-nav--collapsed .online-friends","side-closed-rec-channels":".side-nav--collapsed .recommended-channels,.side-nav--collapsed .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-offline-channels":".ffz--side-nav-card-offline","side-rerun-channels":".side-nav .ffz--side-nav-card-rerun","modview-hide-info":".modview-player-widget__hide-stream-info","community-highlights":".community-highlight-stack__card","elevate-your-message":'.chat-input__input-icons button[aria-label="ElevatedMessage"]',"prime-offers":".top-nav__prime","discover-luna":'.top-nav__external-link[data-a-target="try-presto-link"]',subtember:".subtember-gradient","player-gain-volume":'.video-player__container[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__container[data-controls="false"] .extension-taskbar,.video-player__container[data-controls="false"] .extension-container,.video-player__container[data-controls="false"] .extensions-dock__layout,.video-player__container[data-controls="false"] .extensions-notifications,.video-player__container[data-controls="false"] .extensions-video-overlay-size-container',"player-cast":".video-player button:has(.tw-chromecast-button__icon)","player-event-bar":".channel-root .live-event-banner-ui__header","player-rerun-bar":'.channel-root__player-container div.tw-c-text-overlay:not([data-a-target="hosting-ui-header"])',"pinned-cheer":'.pinned-cheer,.pinned-cheer-v2,.channel-leaderboard,.channel-leaderboard-marquee,div[data-test-selector="channel-leaderboard-container"]',whispers:'body .whispers-open-threads,.tw-core-button[data-a-target="whisper-box-button"],.whispers__pill',"dir-live-ind":'.live-channel-card[data-ffz-type="live"] .tw-channel-status-text-indicator,article[data-ffz-type="live"] .tw-channel-status-text-indicator,.switcher-hopper__scroll-container .tw-tower a[data-ffz-type="live"] .tw-channel-status-text-indicator',"profile-hover":".preview-card .tw-relative:hover .ffz-channel-avatar","not-live-bar":'div[data-test-selector="non-live-video-banner-layout"]',"channel-live-ind":".channel-header__user .tw-channel-status-text-indicator,.channel-info-content .tw-halo__indicator",celebration:"body .celebration__overlay","last-x-events":".last-x-events_container","pinned-hype-chat":".paid-pinned-chat-message-list","side-stories":".side-nav__title + div[class*=storiesLeftNavSection]","ci-mod-view":'.chat-input__buttons-container a[href*="/moderator"]',"ci-highlight-settings":'.chat-input__buttons-container button[data-highlight-selector="chat-highlights-shortcut"]',"ci-shield-mode":'.chat-input__buttons-container > div:last-child button[class|="ScCoreButton"]:not([data-highlight-selector]):not([data-a-target])'},b=class b extends K.default{constructor(...d){super(...d),this.should_enable=!0,this.inject("settings"),this.style=new P.ManagedStyle,this.chunks={},this.chunks_loaded=!1,this._state={},this.settings.add("metadata.modview.hide-info",{default:!1,ui:{path:"Channel > Metadata >> Mod View",title:'Hide "Hide Stream Info Stripe" button.',component:"setting-check-box"},changed:f=>this.toggleHide("modview-hide-info",f)}),this.settings.add("metadata.viewers.no-native",{requires:["metadata.viewers"],default:null,process(f,r){return r??f.get("metadata.viewers")},changed:f=>this.toggle("hide-native-viewers",f),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Viewer Count.",description:"By default, this is enabled whenever FFZ's own Viewer Count display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("metadata.uptime.no-native",{requires:["metadata.uptime"],default:null,process(f,r){return r??f.get("metadata.uptime")!==0},changed:f=>this.toggle("hide-native-uptime",f),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Stream Uptime.",description:"By default, this is enabled whenever FFZ's own Stream Uptime display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("layout.use-chat-fix",{requires:["context.force_chat_fix","layout.swap-sidebars","layout.use-portrait","chat.use-width","context.isWatchParty"],process(f){return f.get("context.isWatchParty")?!1:f.get("context.force_chat_fix")||f.get("layout.swap-sidebars")||f.get("layout.use-portrait")||f.get("chat.use-width")},changed:f=>{f?this.toggle("chat-no-animate",!0):!f&&!this._no_anim_timer&&(this._no_anim_timer=requestAnimationFrame(()=>{this._no_anim_timer=null,this.settings.get("layout.use-chat-fix")||this.toggle("chat-no-animate",!1)})),this.toggle("chat-fix",f),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-stories",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Stories",component:"setting-check-box"}}),this.settings.add("layout.side-nav.show",{default:1,requires:["layout.use-portrait"],process(f,r){return r===2?!f.get("layout.use-portrait"):r},ui:{sort:-1,path:"Appearance > Layout >> Side Navigation",title:"Display Side Navigation",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"Hide in Portrait"}]},changed:f=>{this.toggle("hide-side-nav",!f),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-viewers",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Channel View Counts",component:"setting-check-box"},changed:f=>this.toggleHide("side-nav-viewers",f)}),this.settings.add("layout.side-nav.show-avatars",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Channel Avatars",component:"setting-check-box"},changed:f=>this.toggle("hide-side-nav-avatars",!f)}),this.settings.add("layout.side-nav.show-rec-channels",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended / Popular Channels",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:f=>{this.toggleHide("side-rec-channels",f===0),this.toggleHide("side-closed-rec-channels",f===2)}}),this.settings.add("layout.side-nav.show-friends",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Online Friends",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:f=>{this.toggleHide("side-friends",f===0),this.toggleHide("side-closed-friends",f===2)}}),this.settings.add("layout.side-nav.hide-offline",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Offline Channels",component:"setting-check-box"},changed:f=>this.toggleHide("side-offline-channels",f)}),this.settings.add("layout.side-nav.rerun-style",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Reruns",component:"setting-select-box",data:[{value:0,title:"Do Not Display"},{value:1,title:"Normally"},{value:2,title:"Faded (33% Opacity)"}]},changed:f=>{this.toggleHide("side-rerun-channels",f===0),this.toggle("side-rerun-opacity",f===2)}}),this.settings.add("layout.swap-sidebars",{default:!1,requires:["context.isWatchParty"],process(f,r){return f.get("context.isWatchParty")?!1:r},ui:{path:"Appearance > Layout >> Side Navigation",title:"Swap Sidebars",description:"Swap navigation and chat to the opposite sides of the window.",component:"setting-check-box"},changed:f=>{this.toggle("swap-sidebars",f),this.emit("site.layout:resize")}}),this.settings.add("layout.minimal-navigation",{requires:["layout.theatre-navigation","context.isWatchParty"],default:!1,process(f,r){return f.get("context.isWatchParty")?!1:f.get("layout.theatre-navigation")?!0:r},ui:{path:"Appearance > Layout >> Top Navigation",title:"Minimize Navigation",description:"Slide the site navigation bar up out of view when it isn't in use.",component:"setting-check-box"},changed:f=>{this.toggle("minimal-navigation",f),this.emit("site.layout:resize")}}),this.settings.add("layout.theatre-navigation",{requires:["layout.is-theater-mode"],default:!1,process(f,r){return f.get("layout.is-theater-mode")?r:!1},ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the minimized navigation bar when in theatre mode.",component:"setting-check-box"},changed:f=>{this.toggle("theatre-nav",f),this.emit("site.layout:resize")}}),this.settings.add("layout.subtember",{default:!0,ui:{path:"Appearance > Layout >> Channel",title:"Allow the Subtember upsell banner to appear.",component:"setting-check-box"}}),this.settings.add("layout.turbo-cta",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Allow the Twitch Turbo button to appear.",component:"setting-check-box"}}),this.settings.add("layout.prime-offers",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Prime Gaming Loot.",component:"setting-check-box"},changed:f=>this.toggleHide("prime-offers",!f)}),this.settings.add("layout.hide-discover-luna",{default:!1,ui:{path:"Appearance > Layout >> Top Navigation",title:'Hide the "Discover Luna" link.',component:"setting-check-box"},changed:f=>this.toggleHide("discover-luna",f)}),this.settings.add("whispers.show",{default:!0,ui:{path:"Chat > Whispers >> General",title:"Display Whispers",component:"setting-check-box"},changed:f=>{this.toggleHide("whispers",!f),this.emit("site.layout:resize")}}),this.settings.add("chat.hype.show-pinned",{default:!0,ui:{path:"Chat > Hype Chat >> Appearance",title:"Allow Hype Chat messages to appear pinned at the top of chat.",component:"setting-check-box"},changed:f=>this.toggleHide("pinned-hype-chat",!f)}),this.settings.add("chat.bits.show",{default:!0,ui:{order:-1,path:"Chat > Bits and Cheering >> Appearance",title:"Display Bits",description:"Display UI associated with bits. Note: This will not hide cheering in chat messages.",component:"setting-check-box"},changed:f=>this.toggle("hide-bits",!f)}),this.settings.add("channel.show-celebrations",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow Celebrations to appear.",description:"Celebrations are animations that cover the entire Twitch page.",component:"setting-check-box"},changed:f=>this.toggleHide("celebration",!f)}),this.settings.add("layout.theme.global-font",{default:"",ui:{path:"Appearance > Theme >> Fonts",title:"Font Family",description:'Override the font used for the entire Twitch website. The old default font was: `"Helvetica Neue",Helvetica,Arial,sans-serif`\n\nAny font available via [Google Fonts](https://fonts.google.com/) can be loaded by prefixing the font name with `google:`.',component:"setting-combo-box",data:()=>(0,I.R7)()},changed:()=>this.updateFont()}),this.settings.add("channel.hide-unfollow",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Unfollow button.",component:"setting-check-box"},changed:f=>this.toggle("hide-unfollow-button",f)}),this.settings.add("channel.hide-live-indicator",{requires:["context.route.name"],process(f,r){return f.get("context.route.name")==="user"||f.get("context.route.name")==="user-home"?r:!1},default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "LIVE" indicator on live channel pages.',component:"setting-check-box"},changed:f=>this.toggleHide("channel-live-ind",f)}),this.settings.add("channel.round-avatars",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow avatar images to be rounded.",component:"setting-check-box"},changed:f=>this.toggle("square-avatars",!f)})}onEnable(){this.toggleHide("modview-hide-info",this.settings.get("metadata.modview.hide-info")),this.toggleHide("side-nav-viewers",this.settings.get("layout.side-nav.hide-viewers")),this.toggle("hide-native-uptime",this.settings.get("metadata.uptime.no-native")),this.toggle("hide-native-viewers",this.settings.get("metadata.viewers.no-native")),this.toggle("chat-fix",this.settings.get("layout.use-chat-fix")),this.toggle("swap-sidebars",this.settings.get("layout.swap-sidebars")),this.toggle("minimal-navigation",this.settings.get("layout.minimal-navigation")),this.toggle("theatre-nav",this.settings.get("layout.theatre-navigation")),this.toggle("hide-side-nav-avatars",!this.settings.get("layout.side-nav.show-avatars")),this.toggle("hide-side-nav",!this.settings.get("layout.side-nav.show")),this.toggleHide("side-offline-channels",this.settings.get("layout.side-nav.hide-offline")),this.toggleHide("discover-luna",this.settings.get("layout.hide-discover-luna")),this.toggleHide("prime-offers",!this.settings.get("layout.prime-offers")),this.toggle("hide-unfollow-button",this.settings.get("channel.hide-unfollow")),this.toggleHide("pinned-hype-chat",!this.settings.get("chat.hype.show-pinned")),this.toggle("square-avatars",!this.settings.get("channel.round-avatars")),this.toggleHide("channel-live-ind",this.settings.get("channel.hide-live-indicator"));const d=this.settings.get("layout.side-nav.rerun-style");this.toggleHide("side-rerun-channels",d===0),this.toggle("side-rerun-opacity",d===2);const f=this.settings.get("layout.side-nav.show-rec-channels");this.toggleHide("side-rec-channels",f===0),this.toggleHide("side-closed-rec-channels",f===2);const r=this.settings.get("layout.side-nav.show-friends");this.toggleHide("side-friends",r===0),this.toggleHide("side-closed-friends",r===2),this.toggleHide("whispers",!this.settings.get("whispers.show")),this.toggleHide("celebration",!this.settings.get("channel.show-celebrations")),this.settings.getChanges("layout.subtember",g=>this.toggleHide("subtember",!g)),this.settings.getChanges("layout.side-nav.hide-stories",g=>this.toggleHide("side-stories",g)),this.updateFont(),this.updateTopNav(),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateTopNav(){requestAnimationFrame(()=>this.emit("site.layout:update-nav"))}updateFont(){let d=this.settings.get("layout.theme.global-font");if(d&&d.length){const[f,r]=(0,I.jo)(d);if(d=f,this._font_unloader&&this._font_unloader(),this._font_unloader=r,d.indexOf(" ")!==-1&&d.indexOf(",")===-1&&d.indexOf('"')===-1&&d.indexOf("'")===-1&&(d=`"${d}"`),W.style.fontFamily="",W.style.fontFamily=d,W.style.fontFamily){this.setVariable("global-font",d),this.toggle("global-font",!0);return}}this.toggle("global-font",!1),this.deleteVariable("global-font")}toggleHide(d,f){const r=`hide--${d}`;if(!f){this.style.delete(r);return}if(!(0,L.has)(x,d))throw new Error(`cannot find class for "${d}"`);this.style.set(r,`${x[d]} { display: none !important }`)}toggle(d,f){f=!!f,(this._state[d]??!1)!==f&&(this._state[d]=f,this._apply(d))}_apply(d){if(!this._state[d]){this.style&&this.style.delete(d);return}if(!this.style.has(d)){if(!this.chunks_loaded)return this.loadFromContext().then(()=>this._apply(d));if(!(0,L.has)(this.chunks,d)){this.log.warn(`Unknown chunk name "${d}" for toggle()`);return}this.style.set(d,this.chunks[d])}}set(d,f){return this.style.set(d,f)}delete(d){return this.style.delete(d)}setVariable(d,f,r="body"){this.style.set(`var--${d}`,`${r} { --ffz-${d}: ${f}; }`)}deleteVariable(d){this.style.delete(`var--${d}`)}loadFromContext(){if(!this.chunks_loaded)return new Promise(async d=>{const f=(await S.e(2597).then(S.bind(S,96677))).default;for(const r of f.keys()){const g=r.slice(2,r.length-(r.endsWith(".scss")?5:4));this.chunks[g]=f(r).default}this.emit("site.layout:resize"),this.chunks_loaded=!0,d()})}};B(b,"CSSTweaks");let m=b},95778:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>I});var K=S(22527),P=S(46949),L=S(43874);const W=class W extends K.default{constructor(...m){super(...m),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.channel"),this.SunlightBroadcast=this.fine.define("sunlight-bcast",b=>b.getGame&&b.getTitle&&b.props?.data,L.Z.SUNLIGHT_ROUTES),this.SunlightManager=this.fine.define("sunlight-manager",b=>b.props?.channelID&&b.props.channelLogin&&(0,P.has)(b.props,"hostedChannel"),L.Z.SUNLIGHT_ROUTES)}onEnable(){this.SunlightManager.on("mount",this.updateSunlight,this),this.SunlightManager.on("update",this.updateSunlight,this),this.SunlightManager.on("unmount",this.removeSunlight,this),this.SunlightManager.ready((m,b)=>{for(const c of b)this.updateSunlight(c)}),this.SunlightBroadcast.on("mount",this.updateBroadcast,this),this.SunlightBroadcast.on("update",this.updateBroadcast,this),this.SunlightBroadcast.on("unmount",this.removeBroadcast,this),this.SunlightBroadcast.ready((m,b)=>{for(const c of b)this.updateBroadcast(c)})}updateSunlight(m){this.settings.updateContext({channel:(0,P.get)("props.channelLogin",m),channelID:(0,P.get)("props.channelID",m)})}removeSunlight(){this.settings.updateContext({channel:null,channelID:null})}updateBroadcast(m){const b=m.props?.data?.user?.broadcastSettings,c=b?.game;this.settings.updateContext({category:c?.name,categoryID:c?.id,title:b?.title})}removeBroadcast(){this.settings.updateContext({category:null,categoryID:null,title:null})}};B(W,"Dashboard");let I=W},96432:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{CARD_CONTEXTS:()=>x,CONTENT_FLAGS:()=>m,default:()=>d});var K=S(22527),P=S(83269),L=S(44589),I=S(46949);const f=class f extends K.default{constructor(...u){super(...u),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("settings"),this.GameHeader=this.fine.define("game-header",w=>w.props&&w.props.data&&w.getBannerImage&&w.getDirectoryCountAndTags,["dir-game-index","dir-community","dir-game-videos","dir-game-clips","dir-game-details"]),this.settings.addUI("directory.game.blocked-games",{path:`Directory > Categories @{"description": "Please note that due to limitations in Twitch's website, names here must be formatted exactly as displayed in your client. For best results, you can block or unblock categories directly from directory pages."} >> Blocked`,component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()}),this.settings.addUI("directory.game.hidden-thumbnails",{path:"Directory > Categories >> Hidden Thumbnails",component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()})}onEnable(){this.GameHeader.on("mount",this.updateGameHeader,this),this.GameHeader.on("update",this.updateGameHeader,this),this.GameHeader.on("unmount",()=>{this.settings.updateContext({category:null,categoryID:null})}),this.settings.provider.on("changed",u=>{if(u==="directory.game.blocked-games"||u==="directory.game.hidden-thumbnails"){this.parent.updateCards();for(const w of this.GameHeader.instances)this.updateGameHeader(w)}}),this.GameHeader.ready((u,w)=>{for(const z of w)this.updateGameHeader(z)}),this.on("site.router:route",u=>{u&&u.name==="dir-game-index"&&this.updateGameHeader()})}updateGameHeader(u){if(u===void 0){for(const z of this.GameHeader.instances)this.updateGameHeader(z);return}this.updateButtons(u);const w=u?.props?.data?.game;this.settings.updateContext({category:w?.name,categoryID:w?.id})}updateButtons(u){const w=this.fine.getChildNode(u);if((0,I.get)("data.game",u.props)==null||!w||!w.querySelector)return;const z=w.querySelector(".ffz-directory-buttons");z&&z.remove();const C=w.querySelector(".directory-header-new__info > div > div + div");if(!C)return;let y,a,v,F;const A=(0,I.get)("data.game.name",u.props)||u.props.directoryName,D=B(()=>{const J=this.settings.provider.get("directory.game.blocked-games",[]),G=J.includes(A);y.classList.toggle("active",G),a.textContent=G?this.i18n.t("directory.unblock","Unblock"):this.i18n.t("directory.block","Block")},"update_block"),O=B(()=>{const J=this.settings.provider.get("directory.game.hidden-thumbnails",[]),G=J.includes(A);v.classList.toggle("active",G),F.textContent=G?this.i18n.t("directory.show-thumbnails","Show Thumbnails"):this.i18n.t("directory.hide-thumbnails","Hide Thumbnails")},"update_hidden");y=(0,L.createElement)("button",{class:"tw-mg-r-1 tw-button ffz-directory-toggle-block",onClick:this.generateClickHandler("directory.game.blocked-games",A,D)},a=(0,L.createElement)("span",{class:"tw-button__text"})),D(),v=(0,L.createElement)("button",{class:"tw-button ffz-directory-toggle-thumbnail",onClick:this.generateClickHandler("directory.game.hidden-thumbnails",A,O)},F=(0,L.createElement)("span",{class:"tw-button__text"})),O(),C.appendChild((0,L.createElement)("div",{class:"tw-mg-t-1 ffz-directory-buttons"},y,v))}generateClickHandler(u,w,z){return C=>{C.preventDefault();const y=this.settings.provider.get(u)||[],a=y.indexOf(w);a===-1?y.push(w):y.splice(a,1),this.settings.provider.set(u,y),this.parent.updateCards(),z()}}};B(f,"Game");let W=f;const x=((g={})=>(g[g.SingleGameList=1]="SingleGameList",g[g.SingleChannelList=2]="SingleChannelList",g[g.MixedGameAndChannelList=3]="MixedGameAndChannelList",g))(),m=["DrugsIntoxication","Gambling","MatureGame","ProfanityVulgarity","SexualThemes","ViolentGraphic"];function b(g,u){return g[0].length&&g[1].push((0,I.addWordSeparators)(g[0].join("|"))),g[1].length?new RegExp(g[1].join("|"),u):null}B(b,"formatTerms");const c=["front-page","dir","dir-community","dir-community-index","dir-creative","dir-following","dir-game-index","dir-game-clips","dir-game-videos","dir-all","dir-category","user-videos","user-clips"],r=class r extends K.default{constructor(...u){super(...u),this.should_enable=!0,this.inject("site"),this.inject("site.elemental"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.css_tweaks"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("settings"),this.inject(W),this.DirectoryCard=this.elemental.define("directory-card",'article[data-a-target^="video-carousel-card-"],article[data-a-target^="followed-vod-"],article[data-a-target^="card-"],div[data-a-target^="video-tower-card-"] article,div[data-a-target^="clips-card-"] article,.shelf-card__impression-wrapper article,.tw-tower div article',c,null,0,0),this.DirectoryExperimentCard=this.elemental.define("directory-experiment-card",".switcher-hopper__scroll-container .tw-tower > div > a",c,null,0,0),this.DirectoryGameCard=this.elemental.define("directory-game-card",".game-card[data-a-id]",c,null,0,0),this.DirectoryShelf=this.fine.define("directory-shelf",w=>w.shouldRenderNode&&w.props&&w.props.shelf,c),this.DirectorySorter=this.fine.define("directory-sorter",w=>w.getSortOptionLink&&w.getSortOptionText&&w.getSortOptionOnClick&&w.getFilterIDs,c),this.settings.add("directory.hidden.style",{default:2,ui:{path:'Directory > Categories >> Hidden Thumbnail Style @{"sort": 100}',title:"Hidden Style",component:"setting-select-box",sort:100,data:[{value:0,title:"Replace Image"},{value:1,title:"Replace Image and Blur Title"},{value:2,title:"Blur Image"},{value:3,title:"Blur Image and Title"}]},changed:w=>{this.css_tweaks.toggle("dir-no-blur",w<2),this.css_tweaks.toggle("dir-blur-title",w===1||w===3)}}),this.settings.add("directory.hide-costream-border",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Hide border on streams with guest stars.",component:"setting-check-box",getExtraTerms:()=>["costream","co-stream"]}}),this.settings.add("directory.hidden.reveal",{default:!1,ui:{path:"Directory > Categories >> Hidden Thumbnail Style",title:"Reveal hidden entries on mouse hover.",component:"setting-check-box",sort:101},changed:w=>this.css_tweaks.toggle("dir-reveal",w)}),this.settings.add("directory.uptime",{default:1,ui:{path:"Directory > Channels >> Appearance",title:"Stream Uptime",description:"Display the stream uptime on the channel cards.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateCards()}),this.settings.add("directory.show-flags",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Display Content Flags on channel cards.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-live",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show the Live indicator on channels that are live.",component:"setting-check-box"},changed:w=>this.css_tweaks.toggleHide("dir-live-ind",w)}),this.settings.add("directory.hide-promoted",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show Promoted streams in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-vodcasts",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show reruns in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-recommended",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Recommended Live Channels` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryShelf.forceUpdate()}),this.settings.add("directory.block-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Username",component:"basic-terms",words:!1}}),this.settings.add("__filter:directory.block-users",{requires:["directory.block-users"],equals:"requirements",process(w){const z=w.get("directory.block-users");if(!z||!z.length)return null;const C=[[],[]];for(const y of z){const a=y.t;let v=y.v;a==="glob"?v=(0,I.glob_to_regex)(v):a!=="raw"&&(v=(0,I.escape_regex)(v)),!(!v||!v.length)&&C[y.s?0:1].push(v)}return[C[0].length?new RegExp(`^(?:${C[0].join("|")})$`):null,C[1].length?new RegExp(`^(?:${C[1].join("|")})$`,"i"):null]},changed:()=>this.updateCards()}),this.settings.add("directory.block-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.block-titles",{requires:["directory.block-titles"],equals:"requirements",process(w){const z=w.get("directory.block-titles");if(!z||!z.length)return null;const C=[[[],[]],[[],[]]];for(const y of z){const a=y.t;let v=y.v;a==="glob"?v=(0,I.glob_to_regex)(v):a!=="raw"&&(v=(0,I.escape_regex)(v)),!(!v||!v.length)&&C[y.s?0:1][y.w?0:1].push(v)}return[b(C[0],"g"),b(C[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blocked-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Block by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.blur-titles",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Title",component:"basic-terms"}}),this.settings.add("__filter:directory.blur-titles",{requires:["directory.blur-titles"],equals:"requirements",process(w){const z=w.get("directory.blur-titles");if(!z||!z.length)return null;const C=[[[],[]],[[],[]]];for(const y of z){const a=y.t;let v=y.v;a==="glob"?v=(0,I.glob_to_regex)(v):a!=="raw"&&(v=(0,I.escape_regex)(v)),!(!v||!v.length)&&C[y.s?0:1][y.w?0:1].push(v)}return[b(C[0],"g"),b(C[1],"gi")]},changed:()=>this.updateCards()}),this.settings.add("directory.blur-tags",{default:[],type:"basic_array_merge",always_inherit:!0,ui:{path:"Directory > Channels >> Hide Thumbnails by Tag",component:"tag-list-editor"},changed:()=>this.updateCards()}),this.settings.add("directory.wait-flags",{default:!0,ui:{path:"Directory > Channels >> Appearance",title:"Hide Thumbnails for all channels until Content Flags have been loaded.",description:"We need to load content flags with a separate query, so they aren't immediately available to determine if a given stream should be hidden, or have its thumbnail blurred. This setting will blur ALL thumbnails until after we've finished loading the necessary content flag information, ensuring you don't see a flash of anything you would rather not.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.block-flags",{default:[],type:"array_merge",always_inherit:!0,process(w,z){const C=new Set;for(const y of z){let a=y?.v;a==="ViolentGrpahic"&&(a="ViolentGraphic"),a&&C.add(a)}return C},ui:{path:"Directory > Channels >> Block by Flag",component:"blocked-types",getExtraTerms:()=>[...m],data:()=>[...m].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.blur-flags",{default:[],type:"array_merge",always_inherit:!0,process(w,z){const C=new Set;for(const y of z)y?.v&&C.add(y.v);return C},ui:{path:"Directory > Channels >> Hide Thumbnails by Flag",component:"blocked-types",getExtraTerms:()=>[...m],data:()=>[...m].sort()},changed:()=>this.updateCards()}),this.settings.add("directory.default-sort",{default:!1,ui:{path:"Directory > General >> General",title:"Force Default Sorting",component:"setting-select-box",data:[{value:!1,title:"Disabled"},{value:"RELEVANCE",title:"Recommended For You"},{value:"VIEWER_COUNT",title:"Viewers (High to Low)"},{value:"VIEWER_COUNT_ASC",title:"Viewers (Low to High)"},{value:"RECENT",title:"Recently Started"}]},changed:()=>this.updateSorting()}),this.routeClick=this.routeClick.bind(this)}onEnable(){this.css_tweaks.toggleHide("profile-hover",this.settings.get("directory.show-channel-avatars")===2),this.css_tweaks.toggleHide("dir-live-ind",this.settings.get("directory.hide-live")),this.css_tweaks.toggle("dir-reveal",this.settings.get("directory.hidden.reveal")),this.settings.getChanges("directory.hide-costream-border",z=>this.css_tweaks.toggle("hide-costream-border",z));const u=this.settings.get("directory.hidden.style");this.css_tweaks.toggle("dir-no-blur",u<2),this.css_tweaks.toggle("dir-blur-title",u===1||u===3),this.on("i18n:update",()=>this.updateCards()),this.DirectoryExperimentCard.on("mount",this.updateExpCard,this),this.DirectoryExperimentCard.on("mutate",this.updateExpCard,this),this.DirectoryExperimentCard.on("unmount",this.clearExpCard,this),this.DirectoryExperimentCard.each(z=>this.updateExpCard(z)),this.DirectoryCard.on("mount",this.updateCard,this),this.DirectoryCard.on("mutate",this.updateCard,this),this.DirectoryCard.on("unmount",this.clearCard,this),this.DirectoryCard.each(z=>this.updateCard(z)),this.DirectoryGameCard.on("mount",this.updateGameCard,this),this.DirectoryGameCard.on("mutate",this.updateGameCard,this),this.DirectoryGameCard.each(z=>this.updateGameCard(z)),this.DirectorySorter.on("mount",this.updateSorting,this),this.DirectorySorter.ready(()=>this.updateSorting());const w=this;this.DirectoryShelf.ready(z=>{const C=z.prototype.shouldRenderNode;z.prototype.shouldRenderNode=function(a,...v){try{let F;if(a.__typename==="Game"?F=a.name:a.game&&(F=a.game.name),F&&w.settings.provider.get("directory.game.blocked-games",[]).includes(F))return!1}catch(F){w.log.capture(F),w.log.error(F)}return C.call(this,a,...v)};const y=z.prototype.render;z.prototype.render=function(){try{if(w.settings.get("directory.hide-recommended")&&(0,I.get)("props.shelf.title.key",this)==="live_recs_following")return null}catch(a){w.log.capture(a)}return y.call(this)},this.DirectoryShelf.forceUpdate()})}updateSorting(u){if(!u){for(const C of this.DirectorySorter.instances)this.updateSorting(C);return}const w=this.settings.get("directory.default-sort");if(!w||w===u.state?.activeOption)return;const z=u.getSortOptionLink(w,!1,u.props);z?.props?.linkTo&&(z.props.onClick&&z.props.onClick(),this.router.push(z.props.linkTo))}updateGameCard(u){const w=this.fine.getReactInstance(u);if(!w)return;const z=w.return?.memoizedProps;if(!z?.trackingProps?.category)return;const C=z.trackingProps.category,y=z.tagListProps?.tags;let a=!1;if(Array.isArray(y)){const A=this.settings.get("directory.blocked-tags",[]);if(A.length){for(const D of y)if(D?.id&&A.includes(D.id)){a=!0;break}}}const v=a||this.settings.provider.get("directory.game.blocked-games",[]).includes(C);let F=u.closest(".tw-tower > div");F||(F=u),F.querySelectorAll('a[data-a-target="tw-box-art-card-link"]').length<2&&F.classList.toggle("tw-hide",v)}updateCards(){this.DirectoryCard.each(u=>this.updateCard(u)),this.DirectoryExperimentCard.each(u=>this.updateExpCard(u)),this.DirectoryGameCard.each(u=>this.updateGameCard(u)),this.DirectoryShelf.forceUpdate(),this.emit(":update-cards")}clearCard(u,w=!1){this.clearUptime(u),this.clearFlags(u);const z=this._getTopRightContainer(u,w);z&&z.remove(),u._ffz_top_right=null}clearExpCard(u){return this.clearCard(u,!0)}updateCard(u){const w=this.fine.searchParentNode(u,C=>C.memoizedProps?.channelLogin);if(!w)return;const z=w.memoizedProps;return this._updateCard(u,!1,z,z.trackingProps)}updateExpCard(u){const w=this.fine.searchParentNode(u,y=>y.memoizedProps?.item?.channelID);if(!w)return;const z=w.memoizedProps,C=z.item;return this._updateCard(u,!0,C,z.tracking)}_updateCard(u,w,z,C){const y=z.categoryName||z.gameTitle||C?.game||C?.categoryName||C?.category,a=z.tags??z.tagListProps?.freeformTags,v=this.settings.get("directory.wait-flags"),F=this.settings.get("directory.show-flags"),A=this.settings.get("directory.blur-flags",[]),D=this.settings.get("directory.block-flags",[]),O=A.size>0||D.size>0,J=F||O;u._ffz_flags===void 0&&J&&(u._ffz_flags=null,z.slug||z.type==="clips"?u._ffz_flags=[]:z.vodID||z.type==="videos"?u._ffz_flags=[]:this.twitch_data.getStreamFlags(z.channelID,z.channelID?null:z.channelLogin).then(be=>{u._ffz_flags=be??[],w?this.updateExpCard(u):this.updateCard(u)}));let G=!1,V=!1;if(Array.isArray(a)){const be=this.settings.get("directory.blocked-tags",[]),Pe=this.settings.get("directory.blur-tags",[]);if(be.length||Pe.length)for(const ne of a){if(ne?.name){const ie=ne.name.toLowerCase();be.includes(ie)&&(G=!0),Pe.includes(ie)&&(V=!0)}if((G||!be.length)&&(V||!Pe.length))break}}let q=V;if(v&&O&&u._ffz_flags==null&&(q=!0),q||(q=this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(y)),!q&&A.size&&u._ffz_flags){for(const be of u._ffz_flags)if(be?.id&&A.has(be.id)){q=!0;break}}if(!q){const be=this.settings.get("__filter:directory.blur-titles");be&&(be[0]&&(be[0].lastIndex=-1),be[1]&&(be[1].lastIndex=-1),(be[0]&&be[0].test(z.title)||be[1]&&be[1].test(z.title))&&(q=!0))}const re=z.type??z.streamType;u.classList.toggle("ffz-hide-thumbnail",q),u.dataset.ffzType=re;let ae=!1;if(G)ae=!0;else if(re==="rerun"&&this.settings.get("directory.hide-vodcasts"))ae=!0;else if(z.context!=null&&z.context!==x.SingleGameList&&this.settings.provider.get("directory.game.blocked-games",[]).includes(y))ae=!0;else if((z.isPromotion||z.sourceType==="COMMUNITY_BOOST"||z.sourceType==="PROMOTION"||z.sourceType==="SPONSORED")&&this.settings.get("directory.hide-promoted"))ae=!0;else{if(D.size&&u._ffz_flags){for(const be of u._ffz_flags)if(be?.id&&D.has(be.id)){ae=!0;break}}if(!ae){const be=this.settings.get("__filter:directory.block-users");be&&(be[0]&&(be[0].lastIndex=-1),be[1]&&(be[1].lastIndex=-1),(be[0]&&be[0].test(z.channelLogin)||be[1]&&be[1].test(z.channelLogin))&&(ae=!0))}if(!ae){const be=this.settings.get("__filter:directory.block-titles");be&&(be[0]&&(be[0].lastIndex=-1),be[1]&&(be[1].lastIndex=-1),(be[0]&&be[0].test(z.title)||be[1]&&be[1].test(z.title))&&(ae=!0))}}let fe=u.closest(".tw-tower > div");fe||(fe=u),fe.querySelectorAll(".tw-aspect .tw-image:not(.tw-image-avatar)").length<2&&fe.classList.toggle("tw-hide",ae),this.updateUptime(u,z,w),this.updateFlags(u,w)}updateFlags(u,w=!1){if(!document.contains(u))return this.clearFlags(u);if(!this.settings.get("directory.show-flags")||!u._ffz_flags?.length)return this.clearFlags(u);const C=this._getTopRightContainer(u,!0,w);if(!C)return this.clearFlags(u);u.ffz_flags_el?u.contains(u.ffz_flags_el)||C.appendChild(u.ffz_flags_el):C.appendChild(u.ffz_flags_el=(0,L.createElement)("div",{class:"tw-mg-y-05 ffz-flags-element tw-relative ffz-il-tooltip__container"},(0,L.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,L.createElement)("figure",{class:"ffz-i-flag"})),u.ffz_flags_tt=(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--pre ffz-il-tooltip--down ffz-il-tooltip--align-right"}))),u.ffz_flags_tt.textContent=this.i18n.t("metadata.flags.tooltip","Intended for certain audiences. May contain:")+`

`+u._ffz_flags.map(y=>y.localizedName).join(`
`)}clearFlags(u){u.ffz_flags_el&&(u.ffz_flags_el.remove(),u.ffz_flags_tt=null,u.ffz_flags_el=null)}_getTopRightContainer(u,w=!0,z=!1){let C=u._ffz_top_right??u.querySelector(".ffz-top-right");if(C||!w)return C;let y=z?u.querySelector(".tw-aspect .tw-image"):u.querySelector('a[data-a-target="preview-card-image-link"] > div');return y&&z&&(y=y.parentElement?.parentElement),y?(C=(0,L.createElement)("div",{"data-test-selector":"top-right-selector",class:"tw-absolute tw-mg-1 tw-right-0 tw-top-0 ffz-top-right tw-flex tw-flex-column tw-align-items-end"}),u._ffz_top_right=C,y.appendChild(C),C):null}updateUptime(u,w,z=!1){if(!document.contains(u))return this.clearUptime(u);const C=this.settings.get("directory.uptime"),y=this._getTopRightContainer(u,C>0,z);if(!y||C===0||w.viewCount||w.animatedImageProps||w.type==="videos"||w.type==="clips")return this.clearUptime(u);let a=w.createdAt;a||(u.ffz_stream_meta===void 0&&(u.ffz_stream_meta=null,this.twitch_data.getStreamMeta(null,w.channelLogin).then(D=>{u.ffz_stream_meta=D,this.updateUptime(u,w,z)})),a=u.ffz_stream_meta?.createdAt);const v=a&&new Date(a),F=v&&Math.floor((Date.now()-v)/1e3)||0;if(F<1)return this.clearUptime(u);const A=(0,P.duration_to_string)(F,!1,!1,!1,C===1);if(u.ffz_uptime_el||(u.ffz_uptime_el=y.querySelector(".ffz-uptime-element")),u.ffz_uptime_el?u.contains(u.ffz_uptime_el)||y.appendChild(u.ffz_uptime_el):y.appendChild(u.ffz_uptime_el=(0,L.createElement)("div",{class:"ffz-uptime-element tw-relative ffz-il-tooltip__container"},(0,L.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},(0,L.createElement)("div",{class:"tw-flex tw-c-text-live"},(0,L.createElement)("figure",{class:"ffz-i-clock"})),u.ffz_uptime_span=(0,L.createElement)("p",null)),(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-right"},this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),u.ffz_uptime_tt=(0,L.createElement)("div",{class:"tw-pd-t-05"})))),u.ffz_uptime_span||(u.ffz_uptime_span=u.ffz_uptime_el.querySelector("p")),!u.ffz_uptime_span)return this.clearUptime(u);if(u.ffz_uptime_tt||(u.ffz_uptime_tt=u.ffz_uptime_el.querySelector(".ffz-il-tooltip > div")),!u.ffz_uptime_tt)return this.clearUptime(u);u.ffz_update_timer||(u.ffz_update_timer=setInterval(this.updateUptime.bind(this,u,w,z),1e3)),u.ffz_uptime_span.textContent=A,u.ffz_last_created_at!==a&&(u.ffz_uptime_tt.textContent=this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:v}),u.ffz_last_created_at=a)}clearUptime(u){u.ffz_update_timer&&(clearInterval(u.ffz_update_timer),u.ffz_update_timer=null),u.ffz_uptime_el&&(u.ffz_uptime_el.remove(),u.ffz_uptime_el=null,u.ffz_uptime_span=null,u.ffz_uptime_tt=null,u.ffz_last_created_at=null)}routeClick(u,w){if(u.preventDefault(),u.stopPropagation(),!w){const z=u.currentTarget;if(z){const C=z.dataset;C&&C.href?w=C.href:z.href&&(w=z.href)}}w&&this.router.push(w)}hijackUserClick(u,w,z=null){u.preventDefault(),u.stopPropagation(),z&&z(u,w),this.router.navigate("user",{userName:w})}};B(r,"Directory");let d=r},68318:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>x});var K=S(24431),P=S(22527),L=S(46949);const I=["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],W=["popout","embed-chat","dash-chat"],m=class m extends P.default{constructor(...c){super(...c),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.ResizeDetector=this.fine.define("resize-detector",d=>d.maybeDebounceOnScroll&&d.setGrowDivRef&&d.props.onResize),this.SideBar=this.elemental.define("sidebar",".side-bar-contents",null,{childNodes:!0,subtree:!0},1),this.settings.add("clips.layout.big",{default:!1,ui:{path:"Appearance > Layout >> Clips",title:"Allow the player to get larger on `clips.twitch.tv` pages.",description:"This only affects windows at least 1,200 pixels wide and attempts to make the player and chat replay as large as possible.",component:"setting-check-box"}}),this.settings.add("layout.portrait",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"Enable Portrait Mode",description:"In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.",component:"setting-check-box"}}),this.settings.add("layout.portrait-invert",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"When in portrait mode, place chat at the top.",component:"setting-check-box"},changed:d=>document.body.classList.toggle("ffz--portrait-invert",d)}),this.settings.add("layout.portrait-threshold",{default:1.25,ui:{path:"Appearance > Layout >> Channel",title:"Portrait Mode Threshold",description:"This is the Width to Height ratio at which point Portrait Mode will begin to activate.",component:"setting-text-box",process(d){return d=parseFloat(d,10),isNaN(d)||!isFinite(d)||d<=0?1.25:d}}}),this.settings.add("layout.portrait-min-chat",{default:!1,requires:["layout.use-portrait"],process(d,f){return d.get("layout.use-portrait")?f:!1},ui:{path:"Appearance > Layout >> Channel",title:"Use compact chat in Portrait Mode.",description:"When enabled, this minimizes the chat header and places the chat input box in line with the chat buttons in order to present a more compact chat able to display more lines with limited vertical space.",component:"setting-check-box"}}),this.settings.add("layout.use-portrait",{requires:["layout.portrait","layout.portrait-threshold","context.route.name","context.size","context.isWatchParty"],process(d){if(d.get("context.isWatchParty"))return!1;const f=d.get("context.size");return!f||!d.get("layout.portrait")||!I.includes(d.get("context.route.name"))?!1:f.width/f.height<=d.get("layout.portrait-threshold")},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.inject-portrait",{requires:["layout.use-portrait","context.ui.rightColumnExpanded"],process(d){return d.get("layout.use-portrait")&&d.get("context.ui.rightColumnExpanded")}}),this.settings.add("layout.fix-player-size",{requires:["layout.inject-portrait","chat.use-width","layout.swap-sidebars"],process(d){return d.get("layout.inject-portrait")||d.get("chat.use-width")||d.get("layout.swap-sidebars")}}),this.settings.add("layout.use-portrait-swapped",{requires:["layout.inject-portrait","layout.swap-sidebars"],process(d){return d.get("layout.inject-portrait")&&d.get("layout.swap-sidebars")}}),this.settings.add("layout.use-portrait-meta",{requires:["layout.inject-portrait","player.theatre.metadata"],process(d){return d.get("layout.inject-portrait")&&d.get("player.theatre.metadata")}}),this.settings.add("layout.use-portrait-meta-top",{requires:["layout.use-portrait-meta","layout.portrait-invert"],process(d){return d.get("layout.use-portrait-meta")&&!d.get("layout.portrait-invert")}}),this.settings.add("layout.is-theater-mode",{requires:["context.ui.theatreModeEnabled","context.fullscreen"],process(d){return d.get("context.fullscreen")?!1:d.get("context.ui.theatreModeEnabled")}}),this.settings.add("layout.show-portrait-chat",{requires:["layout.use-portrait","layout.portrait-extra-height","layout.portrait-extra-width"],process(){return!0},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.portrait-extra-height",{requires:["context.new_channel","context.squad_bar","layout.is-theater-mode","player.theatre.no-whispers","whispers.show","layout.minimal-navigation"],process(d){let f=0;return d.get("layout.is-theater-mode")?(d.get("layout.minimal-navigation")&&(f+=1),d.get("whispers.show")&&!d.get("player.theatre.no-whispers")&&(f+=4)):(f=d.get("layout.minimal-navigation")?1:5,d.get("whispers.show")&&(f+=4),d.get("context.squad_bar")&&(f+=6),f+=d.get("context.new_channel")?1:5),f}}),this.settings.add("layout.portrait-extra-width",{require:["layout.side-nav.show","layout.is-theater-mode","context.ui.sideNavExpanded"],process(d){return!d.get("layout.side-nav.show")||d.get("layout.is-theater-mode")?0:d.get("context.ui.sideNavExpanded")?24:5}}),this.settings.add("layout.is-minimal",{require:["context.route.name"],process(d){return W.includes(d.get("context.route.name"))}})}onEnable(){document.body.classList.toggle("ffz--portrait-invert",this.settings.get("layout.portrait-invert")),this.on(":update-nav",this.updateNavLinks,this),this.on(":resize",this.handleResize,this),this.settings.getChanges("layout.portrait-min-chat",c=>this.css_tweaks.toggle("portrait-chat",c)),this.settings.getChanges("layout.inject-portrait",c=>this.css_tweaks.toggle("portrait",c)),this.settings.getChanges("layout.use-portrait-swapped",c=>this.css_tweaks.toggle("portrait-swapped",c)),this.settings.getChanges("layout.use-portrait-meta",c=>this.css_tweaks.toggle("portrait-metadata",c)),this.settings.getChanges("layout.use-portrait-meta-top",c=>this.css_tweaks.toggle("portrait-metadata-top",c)),this.settings.getChanges("layout.portrait-extra-width",c=>this.css_tweaks.setVariable("portrait-extra-width",`${c}rem`)),this.settings.getChanges("layout.portrait-extra-height",c=>this.css_tweaks.setVariable("portrait-extra-height",`${c}rem`)),this.settings.getChanges("layout.fix-player-size",c=>this.css_tweaks.toggle("player-size",c)),this.on("site.directory:update-cards",()=>{this.SideBar.each(c=>this._updateSidebar(c))}),this.ResizeDetector.ready(()=>{this._needs_resize&&(this._needs_resize=!1,this.handleResize())}),this.SideBar.on("mount",this.updateSidebar,this),this.SideBar.on("mutate",this.updateSidebar,this),this.SideBar.each(c=>this.updateSidebar(c))}handleResize(){this._resize_timer||(this._resize_timer=setTimeout(()=>this._handleResize(),K.IS_FIREFOX?500:100))}_handleResize(){if(clearTimeout(this._resize_timer),this._resize_timer=null,!this.ResizeDetector.instances.size)this._needs_resize=!0;else{for(const c of this.ResizeDetector.instances)c?.onScroll?.();this.emit("site.player:fix-player")}}get is_minimal(){return this.settings.get("layout.is-minimal")}updateSidebar(c){c&&(c._ffz_update||(c._ffz_update=(0,L.debounce)(()=>requestAnimationFrame(()=>this._updateSidebar(c)),1e3,2)),c._ffz_update())}_updateSidebar(c){if(!c)return;const d=c.querySelectorAll(".side-nav-card"),f=this.settings.provider.get("directory.game.blocked-games",[]);for(const r of d){const g=this.fine.getReactInstance(r),u=g?.return?.return?.memoizedProps,w=u?.metadataRight?.props?.stream,z=w?.type==="rerun",C=w?.game?.displayName,y=u?.offline??!1;let a=!1;if(C&&f.includes(C)&&(a=!0),u?.isPromoted&&this.settings.get("directory.hide-promoted"))a=!0;else{if(!a){const v=this.settings.get("__filter:directory.block-users"),F=u?.userLogin;v&&F&&(v[0]&&(v[0].lastIndex=-1),v[1]&&(v[1].lastIndex=-1),(v[0]&&v[0].test(F)||v[1]&&v[1].test(F))&&(a=!0))}if(!a){const v=this.settings.get("__filter:directory.block-titles"),F=w?.broadcaster?.broadcastSettings?.title;v&&F&&(v[0]&&(v[0].lastIndex=-1),v[1]&&(v[1].lastIndex=-1),(v[0]&&v[0].test(F)||v[1]&&v[1].test(F))&&(a=!0))}}r.classList.toggle("ffz--side-nav-card-rerun",z),r.classList.toggle("ffz--side-nav-card-offline",y),r.classList.toggle("tw-hide",a)}}updateNavLinks(){}updatePortraitMode(){}};B(m,"Layout");let x=m},29333:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>x});var K=S(24431),P=S(22527),L=S(44589),I=S(43874),W=S(6170);const m=class m extends P.default{constructor(...c){super(...c),this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.elemental"),this.pauseToasts=this.pauseToasts.bind(this),this.unpauseToasts=this.unpauseToasts.bind(this),this.should_enable=!0,this._pill_content=null,this._has_update=!1,this._important_update=!1,this._new_settings=0,this._loading=!1,this.toasts=[],this.settings.add("ffz.show-new-settings",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.",component:"setting-check-box"},changed:()=>this.update()}),this.ModBar=this.fine.define("mod-view-bar",d=>d.actions&&d.updateRoot&&d.childContext,["mod-view"]),this.SunlightNav=this.elemental.define("sunlight-nav",".sunlight-top-nav > div > div > div > div:last-child > div",I.Z.SUNLIGHT_ROUTES,{attributes:!0},1),this.NavBar=this.fine.define("nav-bar",d=>d.renderOnsiteNotifications&&d.renderTwitchPrimeCrown),this.SquadBar=this.fine.define("squad-nav-bar",d=>d.exitSquadMode&&d.props&&d.props.squadID,["squad"]),this.MultiController=this.fine.define("multi-controller",d=>d.handleAddStream&&d.handleRemoveStream&&d.getInitialStreamLayout,["command-center"])}get loading(){return this._loading}set loading(c){c!==this._loading&&(this._loading=c,this.update())}get new_settings(){return this._new_settings}set new_settings(c){c!==this._new_settings&&(this._new_settings=c,this.update())}get has_new(){return this.settings.get("ffz.show-new-settings")&&this._new_settings>0}get important_update(){return this._important_update}set important_update(c){this._important_update=!1,this.update()}get has_update(){return this._has_update}get has_strings(){return this.i18n.new_strings>0||this.i18n.changed_strings>0}set has_update(c){c&&!this._has_update&&(this._important_update=!0),this._has_update=c,this.update()}get pill(){return this._pill_content}set pill(c){this._pill_content=c,this.update()}formatPill(){const c=this._pill_content;return typeof c=="number"?this.i18n.formatNumber(c):c==null&&this.has_new?this.i18n.formatNumber(this._new_settings):c}formatExtraPill(){if(this.has_update)return null;if(this.settings.disable_profiles)return(0,L.createElement)("figure",{class:"ffz-i-cog"});if(this.has_strings)return this.i18n.formatNumber(this.i18n.new_strings+this.i18n.changed_strings);const c=this.resolve("addons");return K.DEBUG&&c.has_dev?this.i18n.t("site.menu_button.dev","dev"):K.DEBUG&&!c.has_dev?this.i18n.t("site.menu_button.main-dev","m-dev"):!K.DEBUG&&c.has_dev?this.i18n.t("site.menu_button.addon-dev","a-dev"):null}updateToasts(){requestAnimationFrame(()=>this._updateToasts())}_updateToasts(){for(const c of this.NavBar.instances)this.updateButtonToast(c);for(const c of this.SquadBar.instances)this.updateButtonToast(c);for(const c of this.MultiController.instances)this.updateButtonToast(c);for(const c of this.SunlightNav.instances)this.updateButtonToast(null,c,!0);for(const c of this.ModBar.instances)this.updateButtonToast(c)}update(){requestAnimationFrame(()=>this._update())}_update(){for(const c of this.NavBar.instances)this.updateButton(c);for(const c of this.SquadBar.instances)this.updateButton(c);for(const c of this.MultiController.instances)this.updateButton(c);for(const c of this.SunlightNav.instances)this.updateButton(null,c,!0);for(const c of this.ModBar.instances)this.updateButton(c)}onEnable(){this.NavBar.ready(()=>this.update()),this.NavBar.on("mount",this.updateButton,this),this.NavBar.on("update",this.updateButton,this),this.SquadBar.ready(()=>this.update()),this.SquadBar.on("mount",this.updateButton,this),this.SquadBar.on("update",this.updateButton,this),this.MultiController.ready(()=>this.update()),this.MultiController.on("mount",this.updateButton,this),this.MultiController.on("update",this.updateButton,this),this.SunlightNav.on("mount",c=>this.updateButton(null,c,!0)),this.SunlightNav.on("mutate",c=>this.updateButton(null,c,!0)),this.SunlightNav.each(c=>this.updateButton(null,c,!0)),this.ModBar.ready(()=>this.update()),this.ModBar.on("mount",this.updateButton,this),this.ModBar.on("update",this.updateButton,this),this.on(":clicked",()=>this.important_update=!1),this.once(":clicked",this.loadMenu),this.on("i18n:new-strings",this.update),this.on("i18n:changed-strings",this.update),this.on("i18n:update",this.update),this.on("addons:data-loaded",this.update),this.once("settings:quota-exceeded",()=>{this.addError("site.menu_button.quota-exceeded","Your local storage space for this website is full, and settings cannot be saved. Please backup your settings and switch to a higher capacity provider in [Data Management > Storage >> Provider](~data_management.storage.tabs.provider).","ffz-i-attention",!0),this.update()}),this.on("settings:change-provider",()=>{this.addError("site.menu_button.changed","The FrankerFaceZ settings provider has changed. Please refresh this tab to avoid strange behavior."),this.update()})}addError(c,d,f="ffz-i-attention",r=!1){this.addToast({icon:f,text_i18n:c,text:d,markdown:r})}addToast(c){if(c.markdown&&!(0,W.e)())return(0,W.Z)().then(()=>this.addToast(c));this.toasts.push(c),!(this.toasts.length>5)&&this.updateToasts()}pauseToasts(){const c=Math.min(5,this.toasts.length),d=performance.now();this._toasts_paused=!0;for(let f=0;f<c;f++){const r=this.toasts[f];if(!r||!r.started)continue;r._timer&&(clearTimeout(r._timer),r._timer=null);const g=d-r.started,u=r.timeout-g;r.remaining=u,r.percentage=100*u/r.timeout,r.el&&r.el.replaceWith(this.renderToast(r))}}unpauseToasts(){const c=Math.min(5,this.toasts.length),d=performance.now();this._toasts_paused=!1;for(let f=0;f<c;f++){const r=this.toasts[f];if(!(!r||!r.started)){if(r.remaining){const g=r.timeout-r.remaining;r.started=d-g}r.el&&r.el.replaceWith(this.renderToast(r))}}}renderToasts(){const c=Math.min(5,this.toasts.length);if(!c)return null;const d=[];for(let f=0;f<c;f++)d.push(this.renderToast(this.toasts[f]));return d}renderToast(c){c._remove||(c._remove=()=>{c._timer&&(clearTimeout(c._timer),c._timer=null),c.el=null;const r=this.toasts.indexOf(c);r!==-1&&(this.toasts.splice(r,1),this.toasts.length||(this._toasts_paused=!1),this.updateToasts())});let d=null;const f=c.markdown?(0,W.e)():null;if(c.markdown&&!f)return null;if(c.timeout){const r=performance.now();c.started||(c.started=r);const g=r-c.started,u=c.timeout-g;let w;this._toasts_paused?w=c.percentage:c._timer||(c._timer=setTimeout(c._remove,u)),w==null&&(w=c.percentage=100*u/c.timeout),d=(0,L.createElement)("div",{class:"ffz-toast--progress tw-absolute tw-overflow-hidden tw-z-below"},(0,L.createElement)("div",{class:"tw-border-radius-rounded ffz-progress-bar ffz-progress-bar--countdown ffz-progress-bar--default ffz-progress-bar--mask",role:"progressbar","aria-valuenow":w,"aria-valuemin":"0","aria-valuemax":"100"},(0,L.createElement)("div",{class:"tw-block tw-border-bottom-left-radius-rounded tw-border-top-left-radius-rounded ffz-progress-bar__fill","data-a-target":"tw-progress-bar-animation",style:{width:`${w}%`,"animation-duration":`${u/1e3}s`}})))}return c.el=(0,L.createElement)("div",{class:`ffz-toast ffz-balloon ffz-balloon--lg tw-mg-y-1${this._toasts_paused?" ffz-toast--paused":""}`},(0,L.createElement)("div",{class:"tw-pd-1 tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-relative"},(0,L.createElement)("div",{class:"tw-flex tw-align-items-start"},c.icon&&(typeof c.icon=="string"?(0,L.createElement)("figure",{class:`tw-font-size-3 tw-pd-r-1 ${c.icon}`}):c.icon),c.render?c.render.call(this,c):null,c.title||c.text?(0,L.createElement)("div",{class:"tw-flex-grow-1"},c.title?(0,L.createElement)("header",{class:"tw-semibold tw-font-size-3 tw-pd-b-05"},c.title_i18n?this.i18n.tList(c.title_i18n,c.title,c):c.title):null,c.text?(0,L.createElement)("span",{class:`${c.lines?"ffz--line-clamp":""}`,style:{"--ffz-lines":c.lines}},c.markdown?(0,L.createElement)("span",{dangerouslySetInnerHTML:{__html:(0,W.e)().render(c.text_i18n?this.i18n.t(c.text_i18n,c.text,c):c.text)}}):null,c.markdown?null:c.text_i18n?this.i18n.tList(c.text_i18n,c.text,c):c.text):null):null,!c.unclosable&&(0,L.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:c._remove},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-cancel"})))),d)),c.el}updateButtonToast(c,d,f){const r=(c||d)._ffz_toast_el;if(r){r.innerHTML="",(0,L.setChildren)(r,this.renderToasts(),!1,!0);return}this.updateButton(c,d,f)}updateButton(c,d,f){const r=this.fine.getChildNode(c);let g=!1,u=!1;if(d||(d=r&&r.querySelector(".top-nav__menu")),d||(r&&r.classList.contains("squad-stream-top-bar__container")?d=r:d=r&&r.querySelector(".squad-stream-top-bar__container"),d&&(g=!0)),!d&&c.handleAddStream&&(d=this.fine.searchTree(c,F=>F.classList&&F.classList.contains("multiview-stream-page__header")),d&&(g=!0)),!d&&c.getIsAdsEnabled&&(d=r&&r.querySelector(".sunlight-top-nav > .tw-flex > .tw-flex > .tw-justify-content-end > .tw-flex"),d&&(f=!0)),!d&&c.childContext&&(d=r&&r.querySelector(".modview-dock > div:last-child"),d&&(u=!0)),!d)return;if(!g&&!u&&!f){let F=null;try{F=d.querySelector(":scope > .tw-justify-content-end:last-child")}catch{}F?d=F:d=d.lastElementChild}let w,z=d.querySelector(".ffz-top-nav");z&&z.remove();const C=this.resolve("addons"),y=this.renderToasts(),a=this.formatPill(),v=this.formatExtraPill();if(z=(0,L.createElement)("div",{class:`ffz-top-nav ${u?"ffz-mod-view-button tw-relative tw-mg-b-1":`tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative ${f?"tw-mg-l-05 tw-mg-r-2":"tw-mg-x-05"}`}`},(0,L.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},w=(0,L.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.loading?" loading":""}`,onClick:F=>this.handleClick(F,w),onContextMenu:F=>this.renderContext(F,w)},(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-zreknarf"})))),this.has_error&&(0,L.createElement)("div",{class:`tw-absolute ffz-balloon ffz-balloon--lg tw-block ${u?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},(0,L.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1"},(0,L.createElement)("div",{class:"tw-flex tw-align-items-center"},(0,L.createElement)("div",{class:"tw-flex-grow-1"},this.error.i18n?this.i18n.t(this.error.i18n,this.error.text):this.error.text),this.error.permanent?null:(0,L.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:()=>this.error=null},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-cancel"})))))),(0,L.createElement)("div",{class:`ffz-il-tooltip ${u?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`},this.i18n.t("site.menu_button","FrankerFaceZ Control Center"),this.has_update&&(0,L.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.update-desc","There is an update available. Please refresh your page.")),this.settings.disable_profiles&&(0,L.createElement)("div",{class:"tw-mg-t-1"},this.i18n.tList("site.menu_button.no-settings",'Settings are disabled in this tab due to the inclusion of "{param}" in the URL.',{param:(0,L.createElement)("code",{class:"ffz-monospace"},"?ffz-no-settings")})),this._new_settings>0&&(0,L.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.new-desc","There {count,plural,one {is one new setting} other {are # new settings}}.",{count:this._new_settings})),this.has_strings&&(0,L.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.strings","There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.",{added:this.i18n.new_strings,changed:this.i18n.changed_strings})),K.DEBUG&&(0,L.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.main-dev-desc","You are running a developer build of FrankerFaceZ.")),C.has_dev&&(0,L.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.addon-dev-desc","You have loaded add-on data from a local development server.")))),(c||d)._ffz_toast_el=(0,L.createElement)("div",{class:`ffz-toast--container tw-absolute tw-block ${u?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"}`,onmouseenter:this.pauseToasts,onmouseleave:this.unpauseToasts},y),this.has_update&&(0,L.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,L.createElement)("div",{class:`tw-pill ${this.important_update?"tw-pill--notification":""}`},(0,L.createElement)("figure",{class:"ffz-i-arrows-cw"}))),v&&(0,L.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},(0,L.createElement)("div",{class:"tw-pill"},v)),a&&(0,L.createElement)("div",{class:"ffz-menu__pill tw-absolute"},(0,L.createElement)("div",{class:"tw-pill"},a))),u)d.insertBefore(z,d.firstElementChild);else{let F=d.lastElementChild;F&&F.classList.contains("resize-detector")&&(F=F.previousElementSibling),F?d.insertBefore(z,F):d.appendChild(z)}this._ctx_open&&this.renderContext(null,w)}handleClick(c,d){if(c.shiftKey)return K.DEBUG&&c.ctrlKey?requestAnimationFrame(()=>this.i18n.openUI()):this.resolve("main_menu").openPopout();this.emit(":clicked",c,d)}renderButtonIcon(c){const d=this.settings.main_context.hasProfile(c);return(0,L.createElement)("figure",{class:`ffz--profile__icon ${d?"ffz-i-ok":c.toggled?"ffz-i-minus":"ffz-i-cancel"}`})}renderButtonTip(c){return c.toggled?this.settings.main_context.hasProfile(c)?this.i18n.t("setting.profiles.active","This profile is enabled and active."):this.i18n.t("setting.profiles.disabled.rules","This profile is enabled, but inactive due to its rules."):this.i18n.t("setting.profiles.disabled","This profile is disabled.")}renderContext(c,d){if(c){if(c.shiftKey||c.ctrlKey)return;c.preventDefault()}const f=d.parentElement.parentElement,r=f.classList.contains("ffz-mod-view-button");let g=f.querySelector(".ffz--menu-context");if(g)if(g._ffz_destroy)g._ffz_destroy();else return;const u=B(()=>{this._ctx_open=!1,g._ffz_outside&&g._ffz_outside.destroy(),g.remove()},"destroy"),w=[];for(const z of this.settings.__profiles){const C=(0,L.createElement)("button",{class:"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-title":this.renderButtonTip(z),onClick:a=>{z.toggled=!z.toggled,(0,L.setChildren)(C,this.renderButtonIcon(z)),C.dataset.title=this.renderButtonTip(z),C._ffz_tooltip?.rerender&&C._ffz_tooltip.rerender(),this.emit("tooltips:cleanup"),a.preventDefault(),a.stopPropagation()}},this.renderButtonIcon(z)),y=z.desc_i18n_key||z.i18n_key&&`${z.i18n_key}.description`;w.push((0,L.createElement)("div",{class:"tw-relative tw-border-b tw-pd-y-05 tw-pd-x-1 tw-flex"},C,(0,L.createElement)("div",null,(0,L.createElement)("h4",null,z.i18n_key?this.i18n.t(z.i18n_key,z.name,z):z.name,z.ephemeral&&(0,L.createElement)("div",{class:"tw-inline tw-mg-l-05 ffz-il-tooltip__container ffz--profile-row__icon ffz-i-user-secret tw-relative"},(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.ephemeral","This profile is ephemeral.")))),z.description&&(0,L.createElement)("div",{class:"description"},y?this.i18n.t(y,z.description,z):z.description))))}g=(0,L.createElement)("div",{class:`tw-absolute ffz-attached ${r?"ffz-attached--up ffz-attached--left":"ffz-attached--down ffz-attached--right"}`},(0,L.createElement)("div",{class:"ffz-balloon ffz-balloon--lg tw-block ffz--menu-context"},(0,L.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4"},(0,L.createElement)("div",{class:"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header"},(0,L.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left"},(0,L.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onDblClick:()=>{this.emit("site.player:reset"),u()}},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-t-reset"}))),(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-left"},this.i18n.t("player.reset_button.all","Reset All Players (Double-Click)")))),(0,L.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center"},(0,L.createElement)("h5",{class:"tw-align-center tw-c-text-alt tw-semibold"},this.i18n.t("site.menu_button.profiles","Profiles"))),(0,L.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,L.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onClick:z=>{this.openSettings(z,d),u()}},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-cog"}))),(0,L.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.configure","Configure")))),(0,L.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},(0,L.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",onClick:u},(0,L.createElement)("span",{class:"tw-button-icon__icon"},(0,L.createElement)("figure",{class:"ffz-i-cancel"}))))),(0,L.createElement)("div",{class:"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},w)))),g._ffz_destroy=u,g._ffz_outside=new L.ClickOutside(g,u),f.appendChild(g),this._ctx_open=!0}openSettings(c,d){const f=this.resolve("main_menu");f&&(f.requestPage("data_management.profiles"),!f.showing&&this.emit(":clicked",c,d))}loadMenu(c,d,f){const r=this.resolve("main_menu");r&&(f&&r.requestPage(f),!r.showing&&(this.loading=!0,r.enable(c).then(()=>{this.loading=!1}).catch(g=>{this.log.capture(g),this.log.error("Error enabling main menu.",g),this.addError("site.menu_button.error","There was an error loading the FFZ Control Center. Please refresh and try again."),this.loading=!1,this.once(":clicked",this.loadMenu)})))}onDisable(){this.off("i18n:update",this.update),this.off(":clicked",this.loadMenu)}};B(m,"MenuButton");let x=m},94296:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>L});var K=S(22527),P=S(46949);const I=class I extends K.default{constructor(...x){super(...x),this.inject("i18n"),this.inject("settings"),this.inject("site.channel"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.inject("site.elemental"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.inject("pubsub"),this.should_enable=!0,this._cached_color=null,this._cached_channel=null,this._cached_id=null,this.Root=this.elemental.define("mod-view-root",".moderation-view-page",["mod-view"],{attributes:!0},1),this.ModInfoBar=this.elemental.define("mod-info-bar",".modview-player-widget__stream-info .simplebar-content",["mod-view"],{childNodes:!0,subtree:!0},1,3e4,!1),this.checkRoot=(0,P.debounce)(this.checkRoot,250),this.checkBar=(0,P.debounce)(this.checkBar,250)}onEnable(){this.Root.on("mount",this.updateRoot,this),this.Root.on("mutate",this.updateRoot,this),this.Root.on("unmount",this.removeRoot,this),this.Root.each(x=>this.updateRoot(x)),this.ModInfoBar.on("mount",this.updateBar,this),this.ModInfoBar.on("mutate",this.updateBar,this),this.ModInfoBar.on("unmount",this.removeBar,this),this.ModInfoBar.each(x=>this.updateBar(x)),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}updateSubscription(x,m){this._subbed_login===m&&this._subbed_id===x||(this._subbed_id&&(this.pubsub.unsubscribe(this,`twitch/${this._subbed_id}`),this._subbed_id=null),this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),x&&(this.pubsub.subscribe(this,`twitch/${x}`),this._subbed_id=x),m&&(this.socket.subscribe(this,`channel.${m}`),this._subbed_login=m))}checkNavigation(){this.router.current_name==="mod-view"&&(this.channel.updateChannelColor(this._cached_color),this.checkRoot())}checkBar(){this.ModInfoBar.clean()}checkRoot(){this.Root.each(x=>this.updateRoot(x))}updateRoot(x){const m=this.fine.getReactInstance(x);let b=null,c=this.fine.searchNode(m,d=>{let f=0,r=d.memoizedState;for(;r!=null&&b==null&&f<50;)b=r?.memoizedState?.current?.result?.data?.user??r?.memoizedState?.current?.previousData?.user,(!b?.id||!b?.login)&&(b=null),r=r?.next,f++;if(b)return!0});b?.id?this._cached_id!=b.id&&(this._cached_id=b.id,this._cached_channel=b,this._cached_color=null,this.updateSubscription(b.id,b.login),this.getChannelColor(x,b.id).then(d=>{this._cached_id==b.id&&(this._cached_color=d,this.channel.updateChannelColor(d),this.settings.updateContext({channelColor:d}))}).catch(()=>{this._cached_id==b.id&&(this._cached_color=null,this.channel.updateChannelColor(),this.settings.updateContext({channelColor:null}))}),this.settings.updateContext({channel:b.login,channelID:b.id})):this.removeRoot()}getChannelColor(x,m,b){const c=x._ffz_color_cache=x._ffz_color_cache||{};return m===c.channel_id&&Date.now()-c.saved<6e4?b?c.data:Promise.resolve(c.data):new Promise(async(d,f)=>{if(c.updating){c.updating.push([d,f]);return}c.channel_id=m,c.updating=[[d,f]];let r,g;try{r=await this.twitch_data.getChannelColor(m)}catch(w){r=null,g=w}const u=c.updating;if(c.updating=null,c.channel_id!==m){g=new Error("Outdated"),c.channel_id=null,c.data=null,c.saved=0;for(const w of u)w[1](g);return}c.data=r,c.saved=Date.now();for(const w of u)g?w[1](g):w[0](r)})}removeRoot(){this._cached_id=null,this._cached_channel=null,this._cached_color=null,this.updateSubscription(),this.channel.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateBar(x){const m=x.closest(".modview-player-widget__stream-info"),b=m&&this.fine.getReactInstance(m);let c=null,d=b?.return?.memoizedState,f=0;for(;d!=null&&c==null&&f<50;)c=d?.memoizedState?.current?.result?.data?.channel??d?.memoizedState?.current?.previousData?.channel,d=d?.next,f++;const r=c?.lastBroadcast,g=r?.title,u=r?.game;if(this._cached_bar_id!=c?.id&&(this._cached_bar_id=c?.id,this._cached_bar_channel=c),(g!=x._cached_title||u?.id!=x._cached_game)&&(x._cached_title=g,x._cached_game=u?.id,this.settings.updateContext({category:u?.name,categoryID:u?.id,title:g})),m){if(!m._ffz_cont){const w=m._ffz_cont=m.querySelector(".modview-player-widget__viewcount");w&&w.classList.add("ffz--mod-tray")}this.updateMetadata(m)}}removeBar(x){this.settings.updateContext({category:null,categoryID:null,title:null});const m=x.closest(".modview-player-widget__stream-info");if(m){if(m._ffz_cont&&m._ffz_cont.classList.remove("ffz--mod-tray"),m._ffz_cont=null,m._ffz_meta_timers){for(const b of Object.values(m._ffz_meta_timers))clearTimeout(b);m._ffz_meta_timers=null}m._ffz_update=null}}updateMetadata(x,m){const b=x._ffz_cont,c=this._cached_bar_channel;if(!b||!document.contains(b)){this.checkBar();return}if(!c?.id)return;m?Array.isArray(m)||(m=[m]):m=this.metadata.keys;const d=x._ffz_meta_timers=x._ffz_meta_timers||{},f=B(g=>this.updateMetadata(x,g),"refresh_fn"),r={channel:{id:c.id,login:c.login,display_name:c.displayName},el:x,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>null};for(const g of m)this.metadata.definitions[g].modview&&this.metadata.renderLegacy(g,r,b,d,f)}};B(I,"ModView");let L=I},63155:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{PLAYER_ROUTES:()=>P,default:()=>L});var K=S(10789);const P=["front-page","user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following","dash","squad","command-center","dash-stream-manager","mod-view","user-home"],I=class I extends K.Z{constructor(...x){super(...x),this.should_enable=!0,this.inject("site.router"),this.inject("metadata"),this.DataSource=this.fine.define("data-source",m=>m.consentMetadata&&m.onPlaying&&m.props&&m.props.data,P),this.Player=this.fine.define("highwind-player",m=>m.setPlayerActive&&m.props?.playerEvents&&m.props?.mediaPlayerInstance,P),this.TheatreHost=this.fine.define("theatre-host",m=>m.toggleTheatreMode&&m.props&&m.props.onTheatreModeEnabled,["user","user-home","video","user-video","user-clip"]),this.PlayerSource=this.fine.define("player-source",m=>m.setSrc&&m.setInitialPlaybackSettings,P)}repositionPlayer(){if(!this._mover){const x=document.querySelector(".channel-root__player");this._mover=this.fine.searchNode(x,m=>m.memoizedProps?.triggerPlayerReposition,50)}this._mover&&this._mover.memoizedProps.triggerPlayerReposition()}registerSettings(){super.registerSettings(),this.settings.add("player.home.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play featured broadcasters on the front page.",component:"setting-check-box"}}),this.settings.add("player.theatre.no-whispers",{default:!1,requires:["whispers.show"],process(x,m){return x.get("whispers.show")?m:!0},ui:{path:"Player > General >> Theatre Mode",title:"Hide whispers when Theatre Mode is enabled.",component:"setting-check-box"},changed:x=>this.css_tweaks.toggle("theatre-no-whispers",x)}),this.settings.add("player.theatre.metadata",{default:!1,requires:["context.route.name","layout.is-theater-mode"],process(x,m){return!x.get("layout.is-theater-mode")||x.get("context.route.name")==="video"?!1:m},ui:{path:"Player > General >> Theatre Mode",title:"Show metadata when mousing over the player.",component:"setting-check-box"},changed:x=>this.css_tweaks.toggle("theatre-metadata",x)}),this.settings.add("player.theatre.auto-enter",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Automatically open Theatre Mode when visiting a channel.",component:"setting-check-box"}}),this.settings.add("player.fullscreen.auto-chat",{default:!1,ui:{path:"Player > General >> Fullscreen",title:"Automatically expand chat when entering fullscreen mode.",component:"setting-check-box"}}),this.settings.add("player.hide-event-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Event Bar",description:"Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.",component:"setting-check-box"},changed:x=>{this.css_tweaks.toggleHide("player-event-bar",x),this.repositionPlayer()}})}async onEnable(){await super.onEnable(),this.css_tweaks.toggle("theatre-no-whispers",this.settings.get("player.theatre.no-whispers")),this.css_tweaks.toggle("theatre-metadata",this.settings.get("player.theatre.metadata")),this.css_tweaks.toggleHide("player-event-bar",this.settings.get("player.hide-event-bar")),this.on(":fix-player",this.repositionPlayer,this),this.on("site:fullscreen",this.maybeOpenChat,this),this.TheatreHost.on("mount",x=>{x._ffz_theater_start=Date.now(),this.tryTheatreMode(x)}),this.TheatreHost.on("update",this.tryTheatreMode,this),this.TheatreHost.ready((x,m)=>{const b=Date.now();for(const c of m)c._ffz_theater_start=b,this.tryTheatreMode(c)}),this.PlayerSource.on("mount",this.checkCarousel,this),this.PlayerSource.on("update",this.checkCarousel,this)}maybeOpenChat(){this.settings.get("player.fullscreen.auto-chat")&&this.parent.awaitElement(".right-column--collapsed .right-column__toggle-visibility button",document.fullscreenElement,1e3).then(x=>x.click())}shouldStopAutoplay(){return this.settings.get("player.no-autoplay")||!this.settings.get("player.home.autoplay")&&this.router.current?.name==="front-page"}checkCarousel(x){}getData(){return this.DataSource.first}tryTheatreMode(x){x._ffz_theater_timer||(x._ffz_theater_timer=setTimeout(()=>{x._ffz_theater_timer=null,!(!this.settings.get("player.theatre.auto-enter")||!x._ffz_mounted)&&this.router.current_name==="user"&&(x.props.channelHomeLive||x.props.channelHomeCarousel||x.props.theatreModeEnabled||Date.now()-(x._ffz_theater_start||0)>2e3||x.props.onTheatreModeEnabled&&x.props.onTheatreModeEnabled())},250))}repositionPlayer(){}updateSquadContext(){this.settings.updateContext({squad_bar:this.hasSquadBar})}get hasSquadBar(){return!1}};B(I,"Player");let L=I},24020:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>d});var K=S(22527),P=S(44589),L=S(14873);const I=S.p+"color_normalizer.css",W=["product","prime","turbo"],x=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],m=":root{color-scheme: only light}",b=":root{forced-color-adjust: none}",c={dark:{c:{"background-brand":11,"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":2,"background-toggle-handle-checked":10,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":15,"background-top-nav":7,"background-toggle-handle-checked":10,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}},f=class f extends K.default{constructor(...g){super(...g),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.should_enable=!0,this.settings.add("theme.high-contrast-tweaks",{default:null,requires:["context.is-forced-colors","theme.disable-high-contrast"],process(u,w){return w===null?u.get("theme.disable-high-contrast")?!1:u.get("context.is-forced-colors")??!1:w},ui:{path:"Appearance > Theme >> Tweaks",title:"Enable the use of High Contrast tweaks.",description:"This loads an additional set of styles when Forced Color / OS High Contrast mode is enabled to ensure page elements are displayed more appropriately.",component:"setting-check-box"}}),this.settings.add("theme.disable-high-contrast",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Disable Forced Color / OS High Contrast",component:"setting-check-box",description:"Enabling this will instruct your browser to not respect your operating system's High Contrast settings when displaying Twitch. You may need to refresh for this to take full effect."},changed:()=>this.updateCSS()}),this.settings.add("theme.disable-auto-dark",{default:!1,ui:{path:'Appearance > Theme >> Tweaks @{"sort": 10}',title:"Disable Auto Dark Theme",component:"setting-check-box",description:"Enabling this will attempt to disable a browser's built-in automatic dark theme conversion for websites, which is unnecessary on Twitch and can cause display issues. This may not apply depending on your web browser and settings."},changed:()=>this.updateCSS()}),this.settings.add("theme.legacy-dark-input",{default:!1,ui:{path:"Appearance > Theme >> Tweaks",title:"Use old input element colors with dark theme.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("theme.font.size",{default:13,process(u,w){if(typeof w!="number")try{w=parseFloat(w)}catch{w=null}return(!w||w<1||isNaN(w)||!isFinite(w)||w>25)&&(w=13),w},ui:{path:'Appearance > Theme >> Fonts @{"sort": 2}',title:"Font Size",description:"**Minimum:** `1`, **Maximum:** `25`, *Old Default:* `12`\n\nHow large should normal text be, in pixels. This may be affected by your browser's zoom and font settings.",component:"setting-text-box",type:"number"},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",ui:{path:'Appearance > Theme >> Colors @{"sort": 0, "description": "This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection."}',title:"Background",description:"Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Background",description:"If not set, the tooltip settings will be automatically adjusted based on the brightness of the background.",component:"setting-color-box",alpha:!0,sort:10},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Text",component:"setting-color-box",sort:11},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",ui:{path:'Appearance > Theme >> Chat Colors @{"sort":1}',title:"Background",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process(u){return!W.includes(u.get("context.route.name"))}}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(u){const w=u.get("context.force-theme");return w??(u.get("context.route.name")==="embed-chat"?(u.get("context.location.search")||"").includes("dark"):u.get("context.ui.theatreModeEnabled")||u.get("theme.can-dark")&&u.get("context.ui.theme")===1)},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process(u){return!u.get("theme.is-dark")}}),this._style=null,this._normalizer=null}updateFont(){let g=this.settings.get("theme.font.size");if(typeof g=="string"&&/^[0-9.]+$/.test(g)?g=parseFloat(g):typeof g!="number"&&(g=null),!g||isNaN(g)||!isFinite(g)||g<1||g===13){this.css_tweaks.delete("font-size");return}g=g/10,this.css_tweaks.set("font-size",`html body {
	--font-size-1: ${4.153846153846154*g}rem;
	--font-size-2: ${2.769230769230769*g}rem;
	--font-size-3: ${1.8461538461538463*g}rem;
	--font-size-4: ${1.3846153846153846*g}rem;
	--font-size-5: ${1.0769230769230769*g}rem;
	--font-size-6: ${g}rem;
	--font-size-7: ${.9230769230769231*g}rem;
	--font-size-8: ${.9230769230769231*g}rem;
	--font-size-base: ${g}rem;
}
`)}generateBackgroundTextBlob(g){const u=g.toHSLA(),w=u.l,z=w<.5;return this.generateBackgroundBlob(g)+this.generateTextBlob(L.Color.RGBA.fromCSS(z?"#FFF":"#000"))}generateBackgroundBlob(g){const u=g.toHSLA(),w=u.l,z=w<.5;return[`--color-background-body:${g.toCSS()};`,`--color-background-input-focus:${g.toCSS()};`,`--color-background-base:${u._l(w+(z?.05:-.05)).toCSS()};`,`--color-background-alt:${u._l(w+(z?.1:-.1)).toCSS()};`,"--color-background-float:var(--color-background-alt);",`--color-background-alt-2:${u._l(w+(z?.15:-.15)).toCSS()};`].join("")}generateTextBlob(g){g.a<.4&&(g=g._a(.4));const u=g.a;return[`--color-text-base:${g.toCSS()};`,`--color-text-input:${g.toCSS()};`,`--color-text-label:${g.toCSS()};`,`--color-text-label-optional:${g._a(u-.4).toCSS()};`,`--color-text-alt:${g._a(u-.2).toCSS()};`,`--color-text-alt-2:${g._a(u-.4).toCSS()};`].join("")}generateAccentBlob(g,u){g.a<1&&(g=g._a(1));const w=g.toHSLA(),z=w.l,C=x.map(F=>F===0?g.toCSS():w._l(z+F).toCSS()),y=[],a=[];for(let F=0;F<C.length;F++)y.push(`--ffz-color-accent-${F+1}:${C[F]};`);let v=u?c.dark:c.light;for(const[F,A]of Object.entries(v.c))typeof A=="number"&&y.push(`--color-${F}:${C[A-1]};`);v=u?c.accent_dark:c.accent_light;for(const[F,A]of Object.entries(v.c))typeof A=="number"&&a.push(`--color-${F}:${C[A-1]} !important;`);return[y.join(""),a.join("")]}updateCSS(){if(this.settings.get("theme.disable-high-contrast")?this.css_tweaks.set("nofc",b):this.css_tweaks.delete("nofc"),this.settings.get("theme.disable-auto-dark")?this.css_tweaks.set("nodark",m):this.css_tweaks.delete("nodark"),this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark")){this.toggleNormalizer(!1),this.toggleAccentNormal(!0),this.css_tweaks.delete("colors");return}let g=this.settings.get("theme.is-dark");const u=[],w=[],z=L.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(z){z.a=1;const ae=z.toHSLA();g=ae.l<.5;try{const be=this.resolve("site").store,Pe=be.getState().ui.theme,ne=g?1:0;Pe!==ne&&be.dispatch({type:"core.ui.THEME_CHANGED",theme:ne})}catch(be){this.log.warning("Unable to automatically set the Twitch Dark Theme state.",be)}u.push(this.generateBackgroundBlob(ae)),g&&(u.push("--color-border-base: var(--color-opac-gl-2);"),u.push("--color-background-interactable-hover: var(--color-opac-gl-1);"),u.push("--color-background-interactable-active: var(--color-opac-gl-2);"),u.push("--color-background-button-text-hover: var(--color-opac-gl-1);"),u.push("--color-background-button-text-active: var(--color-opac-gl-2);"))}let C=L.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));!C&&z&&(C=L.Color.RGBA.fromCSS(g?"#FFF":"#000")),C&&u.push(this.generateTextBlob(C)),g&&this.settings.get("theme.legacy-dark-input")&&u.push(`--color-background-input: var(--color-opac-w-4);
--color-background-input-overlay: var(--color-opac-b-4);
--color-background-input-overlay-focus: var(--color-black);
--color-background-selectable: var(--color-opac-w-3);
--color-background-selectable-hover: var(--color-opac-w-4);
--color-border-input: var(--color-opac-w-4);
--color-border-input-hover: var(--color-opac-w-6);
--color-border-input-overlay: var(--color-opac-w-6);
--color-border-input-overlay-hover: var(--color-opac-w-8);
--color-border-input-checkbox: var(--color-opac-w-10);
--color-border-selectable: var(--color-opac-w-2);
--color-border-selectable-hover: var(--color-opac-w-3);`);const y=L.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!y),y){const ae=this.generateAccentBlob(y,g);u.push(ae[0]),w.push(ae[1])}let a=L.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background")),v;!a&&z&&(a=L.Color.RGBA.fromCSS(g?"#FFF":"#000")),a?(u.push(`--color-background-tooltip: ${a.toCSS()};`),v=a.toHSLA().l<.5):v=!g;let F=L.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const A=F||a;if(F||(F=L.Color.RGBA.fromCSS(v?"#FFF":"#000")),F){A&&u.push(`--color-text-tooltip: ${F.toCSS()};`);const ae=F.toHSLA(),fe=ae.a;u.push(`--color-text-tooltip-alt: ${ae._a(fe-.2).toCSS()};`),u.push(`--color-text-tooltip-alt-2: ${ae._a(fe-.4).toCSS()};`)}const D=[],O=L.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let J=g;if(O){O.a=1;const ae=O.toHSLA();J=ae.l<.5,D.push(this.generateBackgroundBlob(ae))}let G=L.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));!G&&O&&(G=L.Color.RGBA.fromCSS(J?"#FFF":"#000")),G&&D.push(this.generateTextBlob(G));const V=L.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),q=[];if(V){const ae=this.generateAccentBlob(V,J);D.push(ae[0]),q.push(ae[1])}D.length?this.css_tweaks.set("chat-colors",`.moderation-view-page-widget .stream-chat,.chat-shell {${D.join(`
`)}}.moderation-view-page-widget .stream-chat .tw-accent-region,.chat-shell .tw-accent-region{${q.join(`
`)}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(D.length||u.length);const re=g?"":":not(.settings-menu-button-component--forced-dark-theme)";u.length?this.css_tweaks.set("colors",`body,body .tw-root--theme-light,body .tw-root--theme-dark${re} {${u.join(`
`)}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${w.join(`
`)}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(g){if(g){const u=[];for(let w=0;w<15;w++)u.push(`--ffz-color-accent-${w+1}:var(--color-twitch-purple-${w+1});`);this.css_tweaks.set("accent-normal",`body {${u.join(`
`)}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(g){if(this._normalizer){if(!g){this._normalizer.remove();return}}else{if(!g)return;this._normalizer=(0,P.createElement)("link",{rel:"stylesheet",type:"text/css",href:I})}document.head.contains(this._normalizer)||document.head.appendChild(this._normalizer)}onEnable(){let g;try{g=window.matchMedia("(forced-colors: active)")?.matches}catch{}this.settings.updateContext({"is-forced-colors":g??!1}),this.settings.getChanges("theme.high-contrast-tweaks",u=>{this.css_tweaks.toggle("hc-tweaks",u)}),this.updateCSS(),this.updateFont()}};B(f,"ThemeEngine");let d=f},4948:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>c});var K=S(46949),P=S(83269),L=S(6172),I=S(22527),W=S(24431);const x=/^([^\s]+) subscribed ([^.]+)\. They've subscribed for (\d+) months(?:[^!]+streak)?!/,m={1e3:1,2e3:2,3e3:3};function b(f){try{/^[\d-]+$/.test(f)&&(f=parseInt(f,10))}catch{}return(typeof f!="number"||isNaN(f)||!isFinite(f))&&(f=0),f}B(b,"parseParamInt");const d=class d extends I.default{constructor(...r){super(...r),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.overrides"),this.injectAs("site_chat","site.chat"),this.inject("site.chat.chat_line.rich_content"),this.VideoChatController=this.fine.define("video-chat-controller",g=>g.onError&&g.videoData&&g.props?.comments,["user-video","user-clip","video"]),this.VideoChatLine=this.fine.define("video-chat-line",g=>g.onTimestampClickHandler&&g.props?.messageContext,["user-video","user-clip","video"]),this.settings.add("chat.video-chat.timestamps",{default:!0,ui:{path:"Chat > Chat on Videos >> Appearance",title:"Display timestamps alongside chat messages.",component:"setting-check-box"}}),this.settings.add("chat.video-chat.enabled",{default:!0,ui:{path:'Chat > Chat on Videos @{"description": "This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos."} >> General',title:"Enable FrankerFaceZ features for Chat on Videos.",description:"Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.",component:"setting-check-box"}}),this.active_room=null}async onEnable(){var z;this.chat.context.on("changed:chat.video-chat.enabled",this.rerenderLines,this),this.chat.context.on("changed:chat.video-chat.timestamps",this.rerenderLines,this),this.on("chat.overrides:changed",C=>this.updateLinesByUser(C,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this),this.on("chat.emotes:update-effects",this.checkEffects,this);for(const C of W.RERENDER_SETTINGS)this.chat.context.on(`changed:${C}`,this.rerenderLines,this);for(const C of W.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${C}`,this.updateLineTokens,this);for(const C of W.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${C}`,this.updateLineBadges,this);this.on("chat:get-messages",(C,y,a,v)=>{if(a)for(const F of this.VideoChatLine.instances){const A=F.props.messageContext;A.comment?._ffz_message&&v.push({message:A.comment._ffz_message,_instance:F,update:()=>F.forceUpdate()})}}),this.VideoChatController.on("mount",this.chatMounted,this),this.VideoChatController.on("unmount",this.chatUnmounted,this),this.VideoChatController.on("receive-props",this.chatUpdated,this),this.VideoChatController.ready((C,y)=>{for(const a of y)this.chatMounted(a)});const r=this,g=await this.site.findReact();if(!g)return;const u=g.createElement,w=this.rich_content&&this.rich_content.RichContent;this.MenuContainer=(z=class extends g.Component{constructor(y){super(y),this.onBanUser=()=>{this.props.onBanUserClick({bannedUser:this.props.context.comment.commenter,targetChannel:this.props.context.comment.channelId,comment:this.props.context.comment})},this.onDeleteComment=()=>{this.props.onDeleteCommentClick(this.props.context.comment)},this.onOpen=()=>{this.props.onDisableSync(),this.setState({force:!0})},this.onClose=()=>{this.setState({force:!1})},this.state={force:!1}}render(){return null}},B(z,"FFZMenuContainer"),z),this.VideoChatLine.ready(C=>{const y=C.prototype.render;C.prototype.ffzRenderMessage=function(a,v){const F=a.is_action,A=F?r.chat.context.get("chat.me-style"):0,D=A>=2,O=A===1||A===3,J=a.user,G=r.overrides.getColor(J.id)||J.color,V=r.site_chat.colors.process(G),q=r.site.getUser();q&&(q.moderator=this.props.isCurrentUserModerator,q.staff=q.roles&&q.roles.isStaff);let re;if(a.system_msg===!0){const oe=a.params||{};if(oe["msg-id"]==="resub"){const Te=r.chat.context.get("chat.subs.show"),Be=b(oe["msg-param-months"]),Oe=b(oe["msg-param-cumulative-months"]),Ie=Oe||Be;if(r.log.info("resub-notice setting:",Te,"months:",Ie,"cumulative:",Oe,"raw:",Be),r.log.info("-> params:",oe),Te===3||Ie>1&&Te>0){const Ve=b(oe["msg-param-should-share-streak"])===1,Ke=oe["msg-param-sub-plan"],Ye=Ke==="Prime",it=m[Ke]||1;r.log.info("-> share:",Ve,"plan:",Ke,"tier:",it),re=r.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:u("span",{class:"tw-c-text-base tw-strong"},J.displayName),plan:Ye?r.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):r.i18n.t("chat.sub.plan","at Tier {tier}",{tier:it})}),Ve&&Be>1?re.push(r.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:Oe,streak:Be})):Ie>1&&re.push(r.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:Ie}))}}}else a.system_msg&&(re=a.system_msg);const ae=a.ffz_tokens=a.ffz_tokens||r.chat.tokenizeMessage(a,q),fe=w&&r.chat.pluckRichContent(ae,a),be=r.chat.formatUser(J,u),Pe=r.overrides.getName(J.id);let ne=a.ffz_user_class;ne instanceof Set?ne=[...ne].join(" "):Array.isArray(ne)&&(ne=ne.join(" "));const ie={className:`video-chat__message-author notranslate${Pe?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${ne??""}`,"data-test-selector":"comment-author-selector",href:`/${J.login}`,rel:"noopener noreferrer",target:"_blank",style:{color:V}};a.ffz_user_props&&Object.assign(ie,a.ffz_user_props),a.ffz_user_style&&Object.assign(ie.style,a.ffz_user_style);const le=u("a",ie,Pe?[u("span",{className:"chat-author__display-name"},Pe),u("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},be)]:be);let ze=u("div",{class:"tw-flex-grow-1","data-room-id":a.roomID,"data-room":a.roomLogin,"data-user-id":J.id,"data-user":J.login},u("span",{class:"chat-line__message--badges"},r.chat.badges.render(a,u)),le,u("div",{"data-test-selector":"comment-message-selector",class:"tw-inline video-chat__message"},u("span",null,F?" ":": "),u("span",{class:`message ${D?"chat-line__message-body--italicized":""}`,style:{color:O?V:null}},r.chat.renderTokens(ae,u)),fe&&u(w,fe)));return re&&(ze=u("div",{class:"tw-flex-grow-1"},u("div",{class:"tw-flex tw-c-text-alt-2"},u("div",null,re)),ze)),u("div",{class:"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base"},ze,v?u(r.MenuContainer,{context:v,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.props.onBanUserClick,onDeleteCommentClick:this.props.onDeleteCommentClick,onDisableSync:this.props.onDisableSync,onReplyClick:this.onReplyClickHandler}):null)},C.prototype.ffzRenderExpanded=function(a){return a._reply_handler||(a._reply_handler=()=>this.onReplyClickHandler(a.user.login)),u("div",{class:"tw-align-items-center tw-flex tw-pd-t-05"},u("button",{class:"tw-button tw-button--text","data-test-selector":"parent-reply-button",onClick:a._reply_handler},u("span",{class:"tw-button__text tw-pd-0"},r.i18n.t("video-chat.reply","Reply"))),u("span",{class:"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative ffz-il-tooltip__container"},"\u2022 ",r.i18n.t("video-chat.time","{time,humantime} ago",{time:a.timestamp}),u("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},r.i18n.formatDateTime(a.timestamp,"full"))))},C.prototype.render=function(){try{if(this._ffz_no_scan=!0,this.state?.showReplyForm||!r.chat.context.get("chat.video-chat.enabled"))return y.call(this);const a=this.props.messageContext,v=r.standardizeMessage(a.comment,a.author),F=this.ffzRenderMessage(v,a),A=this.props.hideTimestamp||!r.chat.context.get("chat.video-chat.timestamps"),D=v.mentioned&&v.mention_color?r.site_chat.inverse_colors.process(v.mention_color):null;if(v.ffz_removed)return null;const O=!D&&v.highlight&&r.chat.context.get("chat.points.allow-highlight");return u("div",{"data-test-selector":"message-layout",class:`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${v.is_sub?" ffz-notice-line ffz--subscribe-line":""}${v.highlight?" ffz-notice-line ffz--points-line":""}${O?" ffz--points-highlight ffz-custom-color":""}${v.mentioned?" ffz-mentioned":""}${D?" ffz-custom-color":""}`,style:{backgroundColor:D}},A||u("div",{"data-test-selector":"message-timestamp",class:"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header"},u("div",{class:"tw-mg-r-05"},u("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},u("button",{class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.onTimestampClickHandler},u("div",{class:"tw-pd-x-05"},u("p",{class:"tw-font-size-7"},(0,P.print_duration)(a.comment.contentOffset)))),u("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},r.i18n.t("video-chat.jump","Jump to Video"))))),u("div",{class:"tw-full-width"},F,this.props.isExpandedLayout&&this.ffzRenderExpanded(v),a.replies&&a.replies.length>0&&u("div",{class:"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply"},a.comment.moreReplies&&u("div",{class:"tw-inline-block vod-message__show-more-replies"},u("button",{class:"tw-interactive tw-button tw-button--text",onClick:this.onLoadMoreRepliesClickHandler},u("span",{class:"tw-button__text","data-a-target":"tw-button-text"},r.i18n.t("video-chat.show-more","Show more replies...")))),u("ul",null,a.replies.map(J=>u("li",{key:J.comment&&J.comment.id,class:"tw-mg-l-05"},this.ffzRenderMessage(r.standardizeMessage(J.comment,J.author),J),this.props.isExpandedLayout&&this.ffzRenderExpanded(v)))))))}catch(a){return r.log.error("Problem rendering Chat",a),y.call(this)}},setTimeout(()=>this.VideoChatLine.forceUpdate())})}updateLines(){return this._updateLines()}rerenderLines(){this.VideoChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(r=!0,g=!0){for(const u of this.VideoChatLine.instances){const w=u.props.messageContext;if(w.comment&&(w.comment._ffz_message=null,Array.isArray(w.replies)))for(const z of w.replies)z.comment&&(z.comment._ffz_message=null)}this.VideoChatLine.forceUpdate()}updateLinesByUser(r,g){for(const u of this.VideoChatLine.instances){const w=u.props.messageContext;if(!w.comment)continue;const z=w.author;z&&(r&&r==z.id||g&&g==z.name)&&(w.comment._ffz_message=null,u.forceUpdate())}}updateLineById(r,g=!0,u=null){u==null&&(u=g);for(const w of this.VideoChatLine.instances){const z=w.props.messageContext;if(z.comment&&z.comment?.id===r){(g||u)&&(z.comment._ffz_message=null),w.forceUpdate();return}}}checkEffects(){for(const r of this.VideoChatLine.instances){const g=r.props.messageContext,u=g?.comment?._ffz_message,w=u?.ffz_tokens;if(w)for(const z of w)z.type==="emote"&&z.modifier_flags&&this.emotes.ensureEffect(z.modifier_flags)}}standardizeMessage(r,g){if(r._ffz_message)return r._ffz_message;const u=this.active_room||this.chat.getRoom(r.channelId,null,!0,!0),w=r.message.userNoticeParams,z=w&&w["msg-id"],C=r._ffz_message={id:r.id,user:{color:r.message.userColor,id:g.id,login:g.name,displayName:g.displayName,isIntl:g.name&&g.displayName&&g.displayName.trim().toLowerCase()!==g.name,type:g.type},roomLogin:u&&u.login,roomID:u&&u.id||r.channelId,ffz_badges:this.chat.badges.getBadges(g.id,g.login,u?.id,u?.login),badges:r.userBadges,messageParts:r.message.tokens,is_action:r.message.isAction,more_replies:r.moreReplies,timestamp:r.createdAt,ffz_context:"video",is_sub:z==="sub"||z==="resub",highlight:z==="highlighted-message",params:w};if(Array.isArray(C.messageParts)&&C.messageParts.length&&z==="resub"){let y=C.messageParts[0].content;if(typeof y=="string"){const a=x.exec(y);a&&(y=y.slice(a[0].length).trimLeft(),y.length&&(C.messageParts[0].ffz_content=y,C.system_msg=!0))}}return this.chat.detokenizeMessage(C),C}addRoom(r,g){g||(g=r.props);const u=(0,K.get)("data.video.owner",g);if(!u||!u.id)return null;const w=r._ffz_room=this.chat.getRoom(u.id,u.login&&u.login.toLowerCase(),!1,!0);return w.ref(r),w}removeRoom(r){r._ffz_room&&(r._ffz_room.unref(r),r._ffz_room=null)}chatMounted(r,g){g||(g=r.props),this.addRoom(r,g)&&(this.active_room=r._ffz_room,this.chat.badges.updateTwitchBadges((0,K.get)("data.badges",g)),this.updateRoomBadges(r,(0,K.get)("data.video.owner.broadcastBadges",g)),this.updateRoomBitsConfig(r,g.bitsConfig))}chatUpdated(r,g){if((0,K.get)("data.video.owner.id",g)!==(0,K.get)("data.video.owner.id",r.props)){this.removeRoom(r),this.chatMounted(r,g);return}const u=(0,K.get)("data.badges",g),w=(0,K.get)("data.badges",r.props),z=(0,K.get)("data.video.owner.broadcastBadges",g),C=(0,K.get)("data.video.owner.broadcastBadges",r.props);u!==w&&this.chat.badges.updateTwitchBadges(u),z!==C&&this.updateRoomBadges(r,z),g.bitsConfig!==r.props.bitsConfig&&this.updateRoomBitsConfig(r,g.bitsConfig);const y=(0,K.get)("data.video.owner",g);this.settings.updateContext({moderator:g.isCurrentUserModerator}),this.chat.context.updateContext({moderator:g.isCurrentUserModerator,channel:y?y.login:null,channelID:y?y.id:null})}chatUnmounted(r){this.active_room===r._ffz_room&&(this.active_room=null),this.removeRoom(r)}updateRoomBadges(r,g){const u=r._ffz_room;u&&u.updateBadges(g)}updateRoomBitsConfig(r,g){const u=r._ffz_room;u&&u.updateBitsConfig((0,L.formatBitsConfig)(g))}};B(d,"VideoChatHook");let c=d},29632:(ge,te,S)=>{"use strict";S.d(te,{default:()=>m});var K=S(22527),P=S(46949),L=S(5286),I=S(17159);const b=class b extends I.FFZEvent{constructor(r){super(r),this._changed=!1}markChanged(){return this._changed=!0,this}};B(b,"ApolloEvent");let W=b;const c=class c extends null{constructor(r){super(`${r.message}; Location: ${r.locations}`)}};B(c,"GQLError");let x=c;const d=class d extends K.default{constructor(...r){super(...r),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){if(this._gql_print)return this._gql_print;const r=this.resolve("site.web_munch");return this._gql_print=r?.getModule?.("gql-printer")}onEnable(){let r=this.client;if(!r){const C=this.fine.react;if(r=(C&&C.stateNode)?.props?.client,C&&!r){let a=0,v=C;for(;!r?.queryManager&&v&&a++<20;)r=v?.memoizedProps?.client,v=v?.child;if(!r){const F=this.fine.searchTree(null,A=>A.props?.client?.queryManager,500);F&&(r=F.props.client)}}this.client=r}if(!r)return new Promise(()=>this.onEnable(),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link){this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");return}this.hooked_query_init=!1;const g=this,u=this.client.queryManager.constructor.prototype,w=u.getCurrentQueryResult;if(u.getCurrentQueryResult=function(C,y=!0){const a=w.call(this,C,y);if(a&&a.partial)try{try{const v=C.getLastResult(),F=C.options;this.dataStore.getCache().read({query:F.query,variables:F.variables,previousResult:v?v.data:void 0,optimistic:y})}catch(v){if(v.toString().includes("Can't find field")&&C.lastResult&&!C.lastResult.loading&&!C.lastError&&Date.now()-(C._ffz_last_retry||0)>=12e4){const F=(0,P.get)("options.query.definitions.0.name",C),A=F&&F.kind==="Name"?F.value:`#${C.queryId}`;g.log.info("Forcing query to refetch due to missing field:",A),C._ffz_last_retry=Date.now(),C.refetch()}}}catch(v){g.log.capture(v)}return a},this.client.queryManager.queryStore){const C=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(y){const a=this.store[y.queryId];return a&&a.queryString!==y.queryString&&(a.queryString=y.queryString),C.call(this,y)}}const z=this.ApolloLink=this.client.link.constructor;this.link=new z((C,y)=>{if(!this.enabled)return y(C);let a=C.variables;Object.keys(a).length||(a=void 0);try{this.hooked_query_init&&this.apolloPreFlight(C)}catch(v){return this.log.capture(v,{tags:{operation:C.operationName},extra:{variables:a}}),this.log.error("Error running Pre-Flight",v,C),y(C)}return y(C).map(v=>{v.extensions&&v.extensions.operationName===C.operationName&&this.log.crumb({level:"info",category:"gql",message:`${C.operationName} [${v.extensions&&v.extensions.durationMilliseconds||"??"}ms]`,data:{variables:a}});try{this.apolloPostFlight(v)}catch(F){this.log.capture(F,{tags:{operation:C.operationName},extra:{variables:a}}),this.log.error("Error running Post-Flight",F,v)}return v})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=z.from([this.link,this.old_link]),this.client.queryManager.link=z.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(r){const g=r.operationName,u=this.modifiers[g],w=`:request.${g}`,z=this.hasListeners(w);if(!u&&!z)return;const C=this.client.queryManager,y=C&&C.queryIdsByName,a=C&&C.queries,v=y&&y[g],F=Array.isArray(v)?v[0]:v,A=a&&a.get(F);if(u)for(const O of u)typeof O=="function"?O(r):O[1]&&this.applyModifier(r,O[1]);let D=!!u;if(z){const O=new W({operation:g,request:r});this.emit(w,O),O._changed&&(D=!0)}if(D){const O=this.client.queryManager.queryStore.store[F],J=this.gqlPrint&&this.gqlPrint(r.query);O&&(J?(O.queryString=J,r.query.loc.source.body=J,r.query.loc.end=J.length,A&&(A.document=r.query,A.observableQuery&&A.observableQuery.options&&(A.observableQuery.options.query=r.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",g),this.client.queryManager.queryStore.store[F]=null))}}apolloPostFlight(r){if(!r.extensions)return;const g=r.extensions.operationName,u=this.post_modifiers[g];if(u)for(const w of u)w(r);this.emit(`:response.${g}`,r.data)}applyModifier(r,g){r.query=(0,L.default)(r.query,g)}registerModifier(r,g,u=!0){if(typeof g!="function"){if(!u)throw new Error("post modifiers must be functions");g=[g,g]}(u?this.modifiers[r]=this.modifiers[r]||[]:this.post_modifiers[r]=this.post_modifiers[r]||[]).push(g)}unregisterModifier(r,g,u=!0){const w=u?this.modifiers[r]:this.post_modifiers[r];if(w){if(typeof g!="function")throw new Error("graphql modifiers cannot be removed");for(let z=0;z<w.length;z++){const C=w[z];if(typeof C=="function"?C===g:C[0]===g){w.splice(z,1);return}}}}getQuery(r){const g=this.client.queryManager?.queries;if(g)for(const u of g.values()){const w=u?.observableQuery;if(w?.queryName===r)return w}}maybeRefetch(r){const g=this.getQuery(r);!g||!g.lastResult||g.lastResult.stale||g.refetch()}ensureQuery(r,g,u=500,w=12e4){const z=this.getQuery(r);if(z){const C=z.lastResult;let y;C?C.loading?y=!0:typeof g=="function"?y=g(C):y=(0,P.get)(g,C)!==void 0:y=!1,!y&&Date.now()-(z._ffz_last_retry||0)>=w&&(z._ffz_last_retry=Date.now(),z.options.query=Object.assign({},z.options.query),u===0?z.refetch():u>0&&setTimeout(()=>{z.refetch()},u))}return z}getFromQuery(r,g,u=500,w=12e4){const z=this.getQuery(r),C=z&&z.lastResult;if(!z)return;let y;if(!(C&&(typeof g=="function"?y=g(C):y=(0,P.get)(g,C),C.loading)))return y===void 0&&Date.now()-(z._ffz_last_retry||0)>=w&&(z._ffz_last_retry=Date.now(),z.options.query=Object.assign({},z.options.query),u===0?z.refetch():u>0&&setTimeout(()=>z.refetch(),u)),y}};B(d,"Apollo");let m=d},6170:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>b,e:()=>c});var K=S(20857);let P,L,I,W;function x(){return P?Promise.resolve(P):new Promise((d,f)=>{if(I)return I.push([d,f]);I=[[d,f]],Promise.all([S.e(2009).then(S.t.bind(S,19404,23)),S.e(2009).then(S.t.bind(S,43496,23))]).then(r=>{P=r[0]?.default,L=r[1]?.default;const g=I;I=null;for(const u of g)u[0](P)}).catch(r=>{const g=I;I=null;for(const u of g)u[1](r)})})}B(x,"loadMD");function m(d){const f=d.renderer.rules.link_open||this.defaultRender;d.renderer.rules.link_open=function(r,g,u,w,z){const C=r[g];if(C&&C.type==="link_open"&&Array.isArray(C.attrs)){let y;for(const a of C.attrs)if(a[0]==="href"){y=a[1];break}if(y.startsWith("~")){let a;if(y==="~"){let v=g+1,F=[];for(;v<r.length;){const D=r[v],O=D?.type;if(O==="text")F.push(D);else if(O==="link_close")break;v++}F=F.map(D=>D.content).join(""),a=(0,K.Q)(F).map(D=>D.key).join(".")}else a=y.slice(1);if(a&&a.length){for(const v of C.attrs)if(v[0]==="class"){v[1]=v[1].replace(/ffz-tooltip/g,"");break}C.attrs.push(["data-settings-link",a]),C.attrs.push(["onclick",'FrankerFaceZ.get().resolve("main_menu").mdNavigate(this);return false'])}}}return f(r,g,u,w,z)}}B(m,"SettingsLinks"),m.defaultRender=function(d,f,r,g,u){return u.renderToken(d,f,r)};async function b(){if(!W){const d=await x();if(!d)return null;const f=W=new d({html:!1,linkify:!0});f.use(m),f.use(L,{attrs:{class:"ffz-tooltip",target:"_blank",rel:"noopener","data-tooltip-type":"link"}})}return W}B(b,"awaitMD");function c(d){if(W)return W;d&&b().then(f=>d(f))}B(c,"getMD")},81011:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>I});var K=S(17159),P=S(46949),L=S(37087);const W=class W extends K.EventEmitter{constructor(m,b){super(),this._enabled=!1,this.ephemeral=!1,this.id=-1,this.uuid=null,this.name=null,this.pause_updates=!1,this.show_toggle=!1,this._hotkey_enabled=!1,this.onShortcut=this.onShortcut.bind(this),this._hotkey_enabled=!1,this.manager=m,this.provider=m.provider,this.data=b,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`,this.ephemeral&&(this._enabled=!0,this._storage=new Map)}get data(){return{id:this.id,uuid:this.uuid,name:this.name,i18n_key:this.i18n_key,hotkey:this.hotkey,pause_updates:this.pause_updates,ephemeral:this.ephemeral,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(m){if(typeof m!="object")throw new TypeError("data must be an object");this.clearMatcher(),m.ephemeral&&(this.ephemeral=!0);for(const[b,c]of Object.entries(m))this[b]=c}clearMatcher(){this.matcher=null}matches(m){return this.matcher||(this.matcher=(0,L.createTester)(this.context,this.manager.filters,!1,!1,()=>this.manager.updateSoon())),this.matcher(m)}save(){this.ephemeral||this.manager.saveProfile(this.id)}getBackup(){const m={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};delete m.profile.ephemeral;for(const[b,c]of this.entries())m.values[b]=c;return m}async checkUpdate(){if(!this.url||this.pause_updates)return!1;const m=await(0,P.fetchJSON)(this.url);if(!m||m.type!=="profile"||!m.profile||!m.values)return!1;delete m.profile.ephemeral,delete m.profile.id,delete m.profile.uuid,delete m.profile.name,delete m.profile.i18n_key,delete m.profile.hotkey,delete m.profile.description,delete m.profile.desc_i18n_key,delete m.profile.url,delete m.profile.pause_updates,this.data=m.profile;const b=new Set(this.keys());for(const[c,d]of Object.entries(m.values))b.delete(c),this.set(c,d);for(const c of b)this.delete(c);return!0}get hotkey(){return this._hotkey}set hotkey(m){m!==this._hotkey&&(this._hotkey=m,this._hotkey_enabled&&this._updateHotkey())}get hotkey_enabled(){return this._hotkey_enabled}set hotkey_enabled(m){this._hotkey_enabled=!!m,this._updateHotkey()}_updateHotkey(){const m=this.Mousetrap=this.Mousetrap||window.Mousetrap;if(!m)return;const b=this._hotkey;this._bound_key&&(this._bound_key!==b||!this._hotkey_enabled)&&(m.unbind(this._bound_key),this._bound_key=null),this._hotkey_enabled&&b&&(0,P.isValidShortcut)(b)&&(m.bind(b,this.onShortcut),this._bound_key=b)}onShortcut(m){this.toggled=!this.toggled,m&&(m.stopPropagation(),m.preventDefault())}get toggled(){return this.ephemeral?this._enabled:this.provider.get(this.enabled_key,!0)}set toggled(m){m!==this.toggled&&(this.ephemeral?this._enabled=m:this.provider.set(this.enabled_key,m),this.emit("toggled",this,m))}setContext(m){if(this.id===0)throw new Error("cannot set context of default profile");this.context=m,this.clearMatcher(),this.save()}get(m,b){return this.ephemeral?this._storage&&this._storage.has(m)?this._storage.get(m):b??null:this.provider.get(this.prefix+m,b)}set(m,b){this.ephemeral?this._storage&&this._storage.set(m,b):this.provider.set(this.prefix+m,b),this.emit("changed",m,b,!1)}delete(m){this.ephemeral?this._storage&&this._storage.delete(m):this.provider.delete(this.prefix+m),this.emit("changed",m,void 0,!0)}has(m){return this.ephemeral?this._storage?this._storage.has(m):!1:this.provider.has(this.prefix+m)}keys(){if(this.ephemeral)return this._storage?Array.from(this._storage.keys()):[];const m=[],b=this.prefix,c=b.length;for(const d of this.provider.keys())d.startsWith(b)&&d!==this.enabled_key&&m.push(d.slice(c));return m}clear(){if(this.ephemeral){if(this._storage){const c=this.keys();this._storage.clear();for(const d of c)this.emit("changed",d,void 0,!0)}return}const m=this.prefix,b=m.length;for(const c of this.provider.keys())c.startsWith(m)&&c!==this.enabled_key&&(this.provider.delete(c),this.emit("changed",c.slice(b),void 0,!0))}*entries(){if(this.ephemeral){if(this._storage)for(const m of this._storage.entries())yield m}else{const m=this.prefix,b=m.length;for(const c of this.provider.keys())c.startsWith(m)&&c!==this.enabled_key&&(yield[c.slice(b),this.provider.get(c)])}}get size(){if(this.ephemeral)return this._storage?this._storage.size:0;const m=this.prefix;let b=0;for(const c of this.provider.keys())c.startsWith(m)&&c!==this.enabled_key&&b++;return b}};B(W,"SettingsProfile");let I=W;I.Default={id:0,uuid:"ffz_profile_default",name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},I.Moderation={id:1,uuid:"ffz_profile_moderation",name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},34923:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>P});var K=S(22527);const L=class L extends K.default{constructor(W,x){super(W,x),this.settings=null,this.site=null,this.fine=null,this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site"),this.LoadableComponent=this.fine.define("loadable-component",m=>m.props?.component&&m.props.loader),this.ErrorBoundaryComponent=this.fine.define("error-boundary-component",m=>m.props?.name&&m.props?.onError&&m.props?.children&&m.onErrorBoundaryTestEmit),this.overrides=new Map}onEnable(){this.settings.getChanges("chat.hype.show-pinned",W=>{this.toggle("PaidPinnedChatMessageList",W)}),this.settings.getChanges("layout.turbo-cta",W=>{this.toggle("TopNav__TurboButton_Available",W)}),this.ErrorBoundaryComponent.ready((W,x)=>{this.log.debug("Found Error Boundary component wrapper.");const m=this,b=W.prototype,c=b.render;b._ffz_wrapped_render=c,b.render=function(){try{const d=this.props.name;if(m.overrides.has(d)&&!m.shouldRender(d))return null}catch(d){console.error(d)}return c.call(this)},this.ErrorBoundaryComponent.updateInstances()}),this.LoadableComponent.ready((W,x)=>{this.log.debug("Found Loadable component wrapper.");const m=this,b=W.prototype,c=b.render;b.render=function(){try{const d=this.props.component;if(m.overrides.has(d)&&this.state){let f=this.state.Component;if(typeof f=="function"&&!f.ffzWrapped){const r=m.site.getReact(),g=r&&r.createElement;if(g){if(!f.ffzWrapper){let u=B(function(z){return m.shouldRender(w.props.component)?g(f,z):null},"FFZWrapper");const w=this;u.ffzWrapped=!0,u.displayName=`FFZWrapper(${this.props.component})`,f.ffzWrapper=u}this.state.Component=f.ffzWrapper}}}}catch(d){console.error(d)}return c.call(this)},this.LoadableComponent.updateInstances()})}toggle(W,x=null){const m=this.overrides.get(W)??!0;x==null?x=!m:x=!!x,x!==m&&(this.overrides.set(W,x),this.update(W))}update(W){for(const x of this.LoadableComponent.instances){const m=x.props?.component;m&&m===W&&x.forceUpdate()}for(const x of this.ErrorBoundaryComponent.instances){const m=x.props?.name;m&&m===W&&x.forceUpdate()}}shouldRender(W){return this.overrides.get(W)??!0}};B(L,"Loadable");let P=L},70052:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{default:()=>L});var K=S(22527),P=S(44589);const I=class I extends K.default{constructor(x,m){super(x,m),this.i18n=null,this.fine=null,this.settings=null,this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.settings.add("sub-button.prime-notice",{default:!0,ui:{path:"Channel > Metadata >> Subscription",title:"Show Prime Reminder",description:"Display a crown on subscription buttons when your free channel sub with Prime is available.",component:"setting-check-box"},changed:()=>this.SubButton.forceUpdate()}),this.SubButton=this.fine.define("sub-button",b=>b.handleSubMenuAction&&b.openSubModal,["user","user-home","user-video","user-clip","video","user-videos","user-clips","user-collections","user-events","user-followers","user-following"])}onEnable(){this.settings.on(":changed:layout.swap-sidebars",()=>this.SubButton.forceUpdate()),this.SubButton.ready((x,m)=>{for(const b of m)this.updateSubButton(b)}),this.SubButton.on("mount",this.updateSubButton,this),this.SubButton.on("update",this.updateSubButton,this)}updateSubButton(x){const m=this.fine.getChildNode(x),b=m?.querySelector('button[data-a-target="subscribe-button"]');if(!b)return;const c=x.props,d=c.data&&c.data.user,f=d&&d.self,r=this.settings.get("sub-button.prime-notice")&&f&&f.canPrimeSubscribe&&!f.subscriptionBenefit,g=b.querySelector(".ffz--can-prime");if(r&&!g)b.insertBefore((0,P.createElement)("span",{class:"tw-button__icon tw-button__icon--left ffz--can-prime"},(0,P.createElement)("figure",{class:"ffz-i-crown ffz-tooltip","data-title":this.i18n.t("sub-button.prime","Your free channel sub with Prime is available.")})),b.firstElementChild),b.appendChild((0,P.createElement)("span",{class:"ffz--post-prime"}));else if(!r&&g){g.remove();const u=b.querySelector(".ffz--post-prime");u&&u.remove()}}};B(I,"SubButton");let L=I},5227:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{Addon:()=>P});var K=S(22527);const L=class L extends K.default{constructor(W,x){super(W,x,!0),this.i18n=null,this.settings=null,this.inject("i18n"),this.inject("settings")}populate(W,x){return this.log.warn("[DEV-CHECK] populate() has been renamed to loadFromContext(). The populate() name is deprecated."),this.loadFromContext(W,x)}static register(W,x,m){if(typeof W=="object"&&(x=W,W=x.id||void 0),!W)if(this.name)W=this.name.toSnakeCase();else throw new Error("Unable to register module without ID.");!x&&this.info&&(x=this.info),m&&(this.version=m);const b=window.FrankerFaceZ.get(),c=b?.addons;c&&(x?(x.id=W,c.addAddon(x)):c.hasAddon(W)||c.addAddon({id:W}),m&&c.setVersion(W,m));try{b.register(`addon.${W}`,this)}catch(d){if(d instanceof Error&&d.message&&d.message.includes("Name Collision for Module")){const f=b.resolve(`addon.${W}`);f&&(f.external=!0)}throw d}}};B(L,"Addon");let P=L},38626:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{deserializeBlob:()=>L,isValidBlob:()=>K,serializeBlob:()=>P});function K(I){return I instanceof Blob||I instanceof File||I instanceof ArrayBuffer||I instanceof Uint8Array}B(K,"isValidBlob");async function P(I){if(!I)return null;if(I instanceof Blob)return{type:"blob",mime:I.type,buffer:await I.arrayBuffer()};if(I instanceof File)return{type:"file",mime:I.type,name:I.name,modified:I.lastModified,buffer:await I.arrayBuffer()};if(I instanceof ArrayBuffer)return{type:"ab",buffer:I};if(I instanceof Uint8Array)return{type:"u8",buffer:I.buffer};throw new TypeError("Invalid type")}B(P,"serializeBlob");function L(I){if(!I||!I.type)return null;if(I.type==="blob")return new Blob([I.buffer],{type:I.mime});if(I.type==="file")return new File([I.buffer],I.name,{type:I.mime,lastModified:I.modified});if(I.type==="ab")return I.buffer;if(I.type==="u8")return new Uint8Array(I.buffer);throw new TypeError("Invalid type")}B(L,"deserializeBlob")},14873:(ge,te,S)=>{var w;"use strict";S.r(te),S.d(te,{Color:()=>d,ColorAdjuster:()=>f,bit2linear:()=>P,hue2rgb:()=>K,linear2bit:()=>L});function K(y,a,v){return v<0&&(v+=1),v>1&&(v-=1),v<.16666666666666666?y+(a-y)*6*v:v<.5?a:v<.6666666666666666?y+(a-y)*(.6666666666666666-v)*6:y}B(K,"hue2rgb");function P(y){return y<=.04045?y/12.92:Math.pow((y+.055)/1.055,2.4)}B(P,"bit2linear");function L(y){return y<=.0031308?y*12.92:Math.pow(1.055*y,.4166666666666667)-.055}B(L,"linear2bit");const r=class r{constructor(a,v,F,A){this.r=a||0,this.g=v||0,this.b=F||0,this.a=A||0}eq(a,v=!1){return a instanceof r?this.r===a.r&&this.g===a.g&&this.b===a.b&&(v||this.a===a.a):a?this.eq(a.toRGBA(),v):!1}_r(a){return new r(a,this.g,this.b,this.a)}_g(a){return new r(this.r,a,this.b,this.a)}_b(a){return new r(this.r,this.g,a,this.a)}_a(a){return new r(this.r,this.g,this.b,a)}static fromName(a){const v=d.getContext();v.clearRect(0,0,1,1),v.fillStyle=a,v.fillRect(0,0,1,1);const F=v.getImageData(0,0,1,1);return F?.data?.length!==4?null:new r(F.data[0],F.data[1],F.data[2],F.data[3]/255)}static fromCSS(a){return a=a&&a.trim(),a?.length?a.charAt(0)==="#"?r.fromHex(a):r.fromName(a):null}static fromHex(a){a.charAt(0)==="#"&&(a=a.slice(1));let v,F=255;return a.length===4?(F=parseInt(a[3],16)*17,a=a.slice(0,3)):a.length===8&&(F=parseInt(a.slice(6),16),a=a.slice(0,6)),a.length===3?v=(parseInt(a[0],16)*17<<16)+(parseInt(a[1],16)*17<<8)+parseInt(a[2],16)*17:v=parseInt(a,16),new r(v>>16,v>>8&255,v&255,F/255)}static fromHSVA(a,v,F,A){let D,O,J;const G=Math.floor(a*6),V=a*6-G,q=F*(1-v),re=F*(1-V*v),ae=F*(1-(1-V)*v);switch(G%6){case 0:D=F,O=ae,J=q;break;case 1:D=re,O=F,J=q;break;case 2:D=q,O=F,J=ae;break;case 3:D=q,O=re,J=F;break;case 4:D=ae,O=q,J=F;break;default:D=F,O=q,J=re}return new r(Math.round(Math.min(Math.max(0,D*255),255)),Math.round(Math.min(Math.max(0,O*255),255)),Math.round(Math.min(Math.max(0,J*255),255)),A===void 0?1:A)}static fromHSLA(a,v,F,A){if(v===0){const J=Math.round(Math.min(Math.max(0,255*F),255));return new r(J,J,J,A===void 0?1:A)}const D=F<.5?F*(1+v):F+v-F*v,O=2*F-D;return new r(Math.round(Math.min(Math.max(0,255*K(O,D,a+.3333333333333333)),255)),Math.round(Math.min(Math.max(0,255*K(O,D,a)),255)),Math.round(Math.min(Math.max(0,255*K(O,D,a-.3333333333333333)),255)),A===void 0?1:A)}static fromXYZA(a,v,F,A){const D=3.240479*a-1.53715*v-.498535*F,O=-.969256*a+1.875992*v+.041556*F,J=.055648*a-.204043*v+1.057311*F;return new r(Math.max(0,Math.min(255,255*L(D))),Math.max(0,Math.min(255,255*L(O))),Math.max(0,Math.min(255,255*L(J))),A===void 0?1:A)}toCSS(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:this.toHex()}toHex(){return`#${((Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)).toString(16).padStart(6,"0")}`}toRGBA(){return this}toHSVA(){return W.fromRGBA(this.r,this.g,this.b,this.a)}toHSLA(){return x.fromRGBA(this.r,this.g,this.b,this.a)}toXYZA(){return b.fromRGBA(this.r,this.g,this.b,this.a)}toLUVA(){return this.toXYZA().toLUVA()}get_Y(){return(.299*this.r+.587*this.g+.114*this.b)/255}luminance(){const a=P(this.r/255),v=P(this.g/255),F=P(this.b/255);return .2126*a+.7152*v+.0722*F}brighten(a){return a=typeof a=="number"?a:1,a=Math.round(255*(a/100)),new r(Math.max(0,Math.min(255,this.r+a)),Math.max(0,Math.min(255,this.g+a)),Math.max(0,Math.min(255,this.b+a)),this.a)}daltonize(a){let v;if(typeof a=="string")if(d.CVDMatrix.hasOwnProperty(a))v=d.CVDMatrix[a];else throw new Error("Invalid CVD matrix");else v=a;const F=v[0],A=v[1],D=v[2],O=v[3],J=v[4],G=v[5],V=v[6],q=v[7],re=v[8],ae=17.8824*this.r+43.5161*this.g+4.11935*this.b,fe=3.45565*this.r+27.1554*this.g+3.86714*this.b,be=.0299566*this.r+.184309*this.g+1.46709*this.b,Pe=F*ae+A*fe+D*be,ne=O*ae+J*fe+G*be,ie=V*ae+q*fe+re*be;let le=.0809444479*Pe+-.130504409*ne+.116721066*ie,ze=-.0102485335*Pe+.0540193266*ne+-.113614708*ie,oe=-.000365296938*Pe+-.00412161469*ne+.693511405*ie;le=this.r-le,ze=this.g-ze,oe=this.b-oe;const we=0*le+0*ze+0*oe,Te=.7*le+1*ze+0*oe,Be=.7*le+0*ze+1*oe;return le=Math.min(Math.max(0,we+this.r),255),ze=Math.min(Math.max(0,Te+this.g),255),oe=Math.min(Math.max(0,Be+this.b),255),new r(le,ze,oe,this.a)}};B(r,"RGBAColor");let I=r;const g=class g{constructor(a,v,F,A){this.h=a||0,this.s=v||0,this.v=F||0,this.a=A||0}eq(a,v=!1){return a instanceof g?this.h===a.h&&this.s===a.s&&this.v===a.v&&(v||this.a===a.a):a?this.eq(a.toHSVA(),v):!1}_h(a){return new g(a,this.s,this.v,this.a)}_s(a){return new g(this.h,a,this.v,this.a)}_v(a){return new g(this.h,this.s,a,this.a)}_a(a){return new g(this.h,this.s,this.v,a)}static fromRGBA(a,v,F,A){a/=255,v/=255,F/=255;const D=Math.max(a,v,F),O=Math.min(a,v,F),J=Math.min(Math.max(0,D-O),1),G=D===0?0:J/D,V=D;let q;if(J===0)q=0;else{switch(D){case a:q=(v-F)/J+(v<F?6:0);break;case v:q=(F-a)/J+2;break;default:q=(a-v)/J+4}q/=6}return new g(q,G,V,A===void 0?1:A)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromHSVA(this.h,this.s,this.v,this.a)}toHSVA(){return this}toHSLA(){return this.toRGBA().toHSLA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}};B(g,"HSVAColor");let W=g;const u=class u{constructor(a,v,F,A){this.h=a||0,this.s=v||0,this.l=F||0,this.a=A||0}eq(a,v=!1){return a instanceof u?this.h===a.h&&this.s===a.s&&this.l===a.l&&(v||this.a===a.a):a?this.eq(a.toHSLA(),v):!1}_h(a){return new u(a,this.s,this.l,this.a)}_s(a){return new u(this.h,a,this.l,this.a)}_l(a){return new u(this.h,this.s,a,this.a)}_a(a){return new u(this.h,this.s,this.l,a)}static fromRGBA(a,v,F,A){a/=255,v/=255,F/=255;const D=Math.max(a,v,F),O=Math.min(a,v,F),J=Math.min(Math.max(0,(D+O)/2),1),G=Math.min(Math.max(0,D-O),1);let V,q;if(G===0)V=q=0;else{switch(q=J>.5?G/(2-D-O):G/(D+O),D){case a:V=(v-F)/G+(v<F?6:0);break;case v:V=(F-a)/G+2;break;default:V=(a-v)/G+4}V/=6}return new u(V,q,J,A===void 0?1:A)}toCSS(){const a=this.a;return`hsl${a!==1?"a":""}(${Math.round(this.h*360)},${Math.round(this.s*100)}%,${Math.round(this.l*100)}%${a!==1?`,${this.a}`:""})`}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromHSLA(this.h,this.s,this.l,this.a)}toHSLA(){return this}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this.toRGBA().toXYZA()}toLUVA(){return this.toRGBA().toLUVA()}targetLuminance(a){let v=this.s,F=0,A=1;v*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;let D=(A-F)/2,O=F+D;for(;D>152587890625e-16;D/=2,O=F+D)I.fromHSLA(this.h,v,O,1).luminance()>a?A=O:F=O;return new u(this.h,v,O,this.a)}};B(u,"HSLAColor");let x=u;const m=(w=class{constructor(a,v,F,A){this.x=a||0,this.y=v||0,this.z=F||0,this.a=A||0}eq(a,v=!1){return a instanceof w?this.x===a.x&&this.y===a.y&&this.z===a.z&&(v||this.a===a.a):a?this.eq(a.toXYZA(),v):!1}_x(a){return new w(a,this.y,this.z,this.a)}_y(a){return new w(this.x,a,this.z,this.a)}_z(a){return new w(this.x,this.y,a,this.a)}_a(a){return new w(this.x,this.y,this.z,a)}static fromRGBA(a,v,F,A){const D=P(a/255),O=P(v/255),J=P(F/255);return new w(.412453*D+.35758*O+.180423*J,.212671*D+.71516*O+.072169*J,.019334*D+.119193*O+.950227*J,A===void 0?1:A)}static fromLUVA(a,v,F,A){const D=1/(w.WHITE.x+15*w.WHITE.y+3*w.WHITE.z),O=4*w.WHITE.x*D,J=9*w.WHITE.y*D,G=a>8?Math.pow((a+16)/116,3):a/w.KAPPA,V=1/3*(52*a/(v+13*a*O)-1),q=-5*G,re=-1/3,ae=G*(39*a/(F+13*a*J)-5),fe=(ae-q)/(V-re),be=fe*V+q;return new w(fe,G,be,A===void 0?1:A)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return I.fromXYZA(this.x,this.y,this.z,this.a)}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return this}toLUVA(){return c.fromXYZA(this.x,this.y,this.z,this.a)}},B(w,"_XYZAColor2"),w);m.EPSILON=Math.pow(.20689655172413793,3),m.KAPPA=Math.pow(9.666666666666666,3),m.WHITE=null;let b=m;b.WHITE=new I(255,255,255,1).toXYZA();const z=class z{constructor(a,v,F,A){this.l=a||0,this.u=v||0,this.v=F||0,this.a=A||0}eq(a,v=!1){return a instanceof z?this.l===a.l&&this.u===a.u&&this.v===a.v&&(v||this.a===a.a):a?this.eq(a.toLUVA(),v):!1}_l(a){return new z(a,this.u,this.v,this.a)}_u(a){return new z(this.l,a,this.v,this.a)}_v(a){return new z(this.l,this.u,a,this.a)}_a(a){return new z(this.l,this.u,this.v,a)}static fromXYZA(a,v,F,A){const D=1/(b.WHITE.x+15*b.WHITE.y+3*b.WHITE.z),O=4*b.WHITE.x*D,J=9*b.WHITE.y*D,G=v/b.WHITE.y;let V=a+15*v+3*F;V===0&&(V=1);const q=1/V,re=4*a*q,ae=9*v*q,fe=G>b.EPSILON?116*Math.pow(G,1/3)-16:b.KAPPA*G,be=13*fe*(re-O),Pe=13*fe*(ae-J);return new z(fe,be,Pe,A===void 0?1:A)}toCSS(){return this.toRGBA().toCSS()}toHex(){return this.toRGBA().toHex()}toRGBA(){return this.toXYZA().toRGBA()}toHSLA(){return this.toRGBA().toHSLA()}toHSVA(){return this.toRGBA().toHSVA()}toXYZA(){return b.fromLUVA(this.l,this.u,this.v,this.a)}toLUVA(){return this}};B(z,"LUVAColor");let c=z;const d={CVDMatrix:{protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]},getCanvas(){return d._canvas||(d._canvas=document.createElement("canvas")),d._canvas},getContext:()=>(d._context||(d._context=d.getCanvas().getContext("2d")),d._context),RGBA:I,HSVA:W,HSLA:x,XYZA:b,LUVA:c,fromCSS(y){return I.fromCSS(y)}},C=class C{constructor(a="#232323",v=0,F=4.5){this._dark=!1,this._cache=new Map,this._luv=0,this._luma=0,this._contrast=F,this._base=a,this._mode=v,this.rebuildContrast()}get contrast(){return this._contrast}set contrast(a){this._contrast=a,this.rebuildContrast()}get base(){return this._base}set base(a){this._base=a,this.rebuildContrast()}get dark(){return this._dark}get mode(){return this._mode}set mode(a){this._mode=a,this.rebuildContrast()}rebuildContrast(){this._cache=new Map;const a=I.fromCSS(this._base);if(!a)throw new Error("Invalid base color");const v=a.luminance();(this._dark=v<.5)?(this._luv=new b(0,this._contrast*(a.toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luma=this._contrast*(a.luminance()+.05)-.05):(this._luv=new b(0,(a.toXYZA().y+.05)/this._contrast-.05,0,1).toLUVA().l,this._luma=(a.luminance()+.05)/this._contrast-.05)}process(a,v=!1){if(!a)return null;if(this._mode===-1)return"";if(typeof a!="string"&&(a=a.toCSS()),this._mode===0)return a;if(this._cache.has(a))return this._cache.get(a);let F;try{F=I.fromCSS(a)}catch(D){if(v)throw D;return null}if(!F)return null;if(this._mode===1){const D=F.luminance();(this._dark?D<this._luma:D>this._luma)&&(F=F.toHSLA().targetLuminance(this._luma).toRGBA())}else if(this._mode===2){const D=F.toLUVA();(this._dark?D.l<this._luv:D.l>this._luv)&&(F=D._l(this._luv).toRGBA())}else if(this._mode===3)if(this._dark)for(;F.get_Y()<.5;){const D=F.toHSLA();F=D._l(Math.min(Math.max(0,.1+.9*D.l),1)).toRGBA()}else for(;F.get_Y()>=.5;){const D=F.toHSLA();F=D._l(Math.min(Math.max(0,.9*D.l),1)).toRGBA()}else if(this._mode===4){let D=0;if(this._dark)for(;F.luminance()<.15&&D++<127;)F=F.brighten();else for(;F.luminance()>.3&&D++<127;)F=F.brighten(-1)}const A=F.toCSS();return this._cache.set(a,A),A}};B(C,"ColorAdjuster");let f=C},45866:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>W});var K=S(72167),P=S.n(K),L=S(22527),I=S(46949);const x=class x extends L.default{constructor(b,c){super(b,c),this.fine=null,this.inject("..fine"),this.__routes=[],this.routes={},this.route_names={},this.current=null,this.current_name=null,this.current_state=null,this.match=null,this.location=null}onEnable(b=0){const c=this.fine.searchTree(null,r=>r?.props?.history);if(this.history=c?.props?.history,this.history){this.history.listen(r=>{this.enabled&&this._navigateTo(r)}),this._navigateTo(this.history.location);return}const d=this.fine.searchNode(null,r=>r?.pendingProps?.router?.subscribe);this.router=d?.pendingProps?.router;const f=this.fine.searchNode(null,r=>r?.pendingProps?.navigator?.push);if(this.navigator=f?.pendingProps?.navigator,!this.router||!this.navigator)return b>100&&(this.log.warn("Finding React's router is taking a long time."),b=-500),(0,I.sleep)(50).then(()=>this.onEnable(b+1));this.router.subscribe(r=>{this.enabled&&r?.location&&this._navigateTo(r.location)}),this._navigateTo(this.router.router.state.location)}navigate(b,c,d,f){const r=this.getURL(b,c,d);this.push(r,f)}get reactLocation(){if(this.history)return this.history.location;if(this.router)return this.router.router.state.location}push(b,c){if(this.history)this.history.push(b,c);else if(this.navigator)this.navigator.push(b,c);else throw new Error("unable to push new route")}replace(b,c){if(this.history)this.history.replace(b,c);else if(this.navigator)this.navigator.replace(b,c);else throw new Error("unable to replace route")}_navigateTo(b){this.log.debug("New Location",b);const c=window.location.host,d=b.pathname,f=b.search,r=b.state;d===this.location&&c===this.domain&&f===this.search&&(0,I.deep_equals)(r,this.current_state)||(this.old_location=this.location,this.old_search=this.search,this.old_domain=this.domain,this.old_state=this.current_state,this.location=d,this.search=f,this.domain=c,this.current_state=r,this._pickRoute())}_pickRoute(){const b=this.location,c=this.domain;this.old_route=this.current,this.old_name=this.current_name,this.old_match=this.match;for(const d of this.__routes){if(d.domain&&d.domain!==c)continue;const f=d.regex.exec(b);if(f&&(!d.state_fn||d.state_fn(this.current_state))){this.log.debug("Matching Route",d,f),this.current=d,this.current_name=d.name,this.match=f,this.emit(":route",d,f);return}}this.current=this.current_name=this.match=null,this.emit(":route",null,null)}getURL(b,c,d,...f){const r=this.routes[b];if(!r)throw new Error(`unable to find route "${b}"`);if(typeof c!="object"){const g=[c,d,...f];c={};let u=0;for(const w of r.parts)if(w&&w.name&&(c[w.name]=g[u],u++,u>=g.length))break}return r.url(c,d)}getRoute(b){return this.routes[b]}getRoutes(){return this.routes}getRouteNames(){for(const b of Object.keys(this.getRoutes()))this.getRouteName(b);return this.route_names}getRouteName(b){return this.route_names[b]||(this.route_names[b]=b.replace(/^dash-([a-z])/,(c,d)=>`Dashboard: ${d.toLocaleUpperCase()}`).replace(/(^|-)([a-z])/g,(c,d,f)=>`${d?" ":""}${f.toLocaleUpperCase()}`)),this.route_names[b]}routeName(b,c,d=!0){if(typeof b=="object"){for(const f in b)(0,I.has)(b,f)&&this.routeName(f,b[f],!1);d&&this.emit(":updated-route-names");return}c&&(this.route_names[b]=c,d&&this.emit(":updated-route-names"))}route(b,c,d=null,f=null,r=!0){if(typeof b=="object"){d=c;for(const z in b)(0,I.has)(b,z)&&this.route(z,b[z],d,f,!1);r&&(this.__routes.sort((z,C)=>C.score-z.score),this.location&&this._pickRoute(),this.emit(":updated-routes"));return}const g=(0,K.parse)(c),u=g.reduce((z,C)=>z+(typeof C=="string"?C.split("/").length-1:0),0),w=this.routes[b]={name:b,parts:g,score:u,domain:d,state_fn:f,regex:(0,K.tokensToRegExp)(g),url:(0,K.tokensToFunction)(g)};this.__routes.push(w),r&&(this.__routes.sort((z,C)=>C.score-z.score),this.location&&this._pickRoute(),this.emit(":updated-routes"))}};B(x,"FineRouter");let W=x},98247:(ge,te,S)=>{"use strict";S.d(te,{Z:()=>L});var K=S(17159),P=S(22527);const x=class x extends P.default{constructor(c,d){super(c,d),this._route=null,this._wrappers=new Map,this._known_classes=new Map,this._observer=null,this._waiting=[],this._live_waiting=null}async onEnable(c=0){this.root_element||(this.root_element=await this.parent.awaitElement(this.selector||"body #root"));let d=this.root_element?._reactRootContainer;if(d?._internalRoot?.current&&(d=d?._internalRoot),d?.current){this.react_root=d,this.react=d?.current?.child;return}if(this.root_element&&!d){let f=x.findAccessor(this.root_element,"__reactContainer");if(f){this.react_root=null,this.react=this.root_element[f];return}}if(c>500)throw new Error("Unable to find React after 25 seconds");return this.root_element=null,new Promise(f=>setTimeout(f,50)).then(()=>this.onEnable(c+1))}onDisable(){this.react_root=this.root_element=this.react=this.accessor=null}static findAccessor(c,d){for(const f in c)if(d?f.startsWith(`${d}$`):f.startsWith("__reactInternalInstance$")||f.startsWith("__reactFiber$"))return f;return null}resolveNode(c){return!c&&this.react?this.react:c instanceof Node?this.getReactInstance(c):c?._reactInternals?c._reactInternals:c?._reactInternalFiber?c._reactInternalFiber:c||null}getReactInstance(c){return this.accessor||(this.accessor=x.findAccessor(c)),this.accessor?c[this.accessor]??c._reactRootContainer?._internalRoot?.current??c._reactRootContainer?.current??null:null}getOwner(c){return c=this.resolveNode(c),c?.return??null}getParentNode(c,d=100,f=!1){return this.searchParent(c,r=>r instanceof Node,d,0,f)}getChildNode(c,d=100,f=!1){return this.searchTree(c,r=>r instanceof Node,d,0,f)}getHostNode(c,d=100){return this.getChildNode(c,d)}getParent(c){return this.getOwner(c)}getFirstChild(c){return this.resolveNode(c)?.child??null}getChildren(c){const d=this.resolveNode(c);if(!d)return[];const f=[];let r=d.child;for(;r;)f.push(r),r=r.sibling;return f}searchParent(c,d,f=15,r=0,g=!0){if(r>f)return null;const u=this.resolveNode(c);if(!u)return null;if(typeof d=="string"){const z=this._wrappers.get(d);if(!z)throw new Error("invalid critera");if(!z.class)return null;d=B(C=>C&&C.constructor===z.class,"criteria")}const w=u.stateNode;if(w&&d(w,u))return w;if(u.return){const z=this.searchParent(u.return,d,f,r+1,g);if(z)return z}if(g&&w?.containerInfo){const z=w.containerInfo?.parentElement,C=z&&this.getReactInstance(z);if(C){const y=this.searchParent(C,d,f,r+1,g);if(y)return y}}return null}searchParentNode(c,d,f=15,r=0,g=!0){if(r>f)return null;const u=this.resolveNode(c);if(!u)return null;if(d(u))return u;if(u.return){const z=this.searchParentNode(u.return,d,f,r+1,g);if(z)return z}const w=u.stateNode;if(g&&w?.containerInfo){const z=w.containerInfo?.parentElement,C=z&&this.getReactInstance(z);if(C){const y=this.searchParentNode(C,d,f,r+1,g);if(y)return y}}return null}searchNode(c,d,f=15,r=0,g=!0){if(r>f)return null;const u=this.resolveNode(c);if(!u)return null;if(d(u))return u;if(u._ffz_no_scan||u.stateNode?._ffz_no_scan)return null;let w=u.child;for(;w;){const C=this.searchNode(w,d,f,r+1,g);if(C)return C;w=w.sibling}const z=u.stateNode;if(g&&z?.props?.root){const C=z.props.root._reactRootContainer;if(C){let y=C._internalRoot?.current||C.current;for(;y;){const a=this.searchNode(y,d,f,r+1,g);if(a)return a;y=y.sibling}}}return null}searchTree(c,d,f=15,r=0,g=!0,u){const w=this.resolveNode(c);if(u&&!(u instanceof Set)&&(u=new Set),!w||r>f)return u||null;if(typeof d=="string"){const y=this._wrappers.get(d);if(!y)throw new Error("invalid critera");if(!y.class)return u||null;d=B(a=>a&&a.constructor===y.class,"criteria")}const z=w.stateNode;if(z&&d(z,w))if(u)u.add(z);else return z;if(w._ffz_no_scan||w.stateNode?._ffz_no_scan)return u||null;let C=w.child;for(;C;){const y=this.searchTree(C,d,f,r+1,g,u);if(y&&!u)return y;C=C.sibling}if(g&&z?.props?.root){const y=z.props.root._reactRootContainer;if(y){let a=y._internalRoot?.current||y.current;for(;a;){const v=this.searchTree(a,d,f,r+1,g,u);if(v&&!u)return v;a=a.sibling}}}return u||null}findAllMatching(c,d,f=15,r=!0,g=!1,u=0,w=!0){const z=new Set;let C=B((y,a)=>!z.has(y)&&d(y,a),"crit");for(;;){const y=g?this.searchParent(c,C,f,u,w):this.searchTree(c,C,f,u,w);if(!y)break;if(r&&!z.size){const a=y.constructor;C=B((v,F)=>!z.has(v)&&v instanceof a&&d(v,F),"crit")}z.add(y)}return z}searchAll(c,d,f=15,r=0,g=null,u=!0){const w=this.resolveNode(c);if(g||(g={seen:new Set,classes:d.map(()=>null),out:d.map(()=>({cls:null,instances:new Set,depth:null})),max_depth:r}),!w||r>f)return g.out;r>g.max_depth&&(g.max_depth=r);const z=w.stateNode;if(z){const y=z.constructor,a=g.classes.indexOf(y);if(a!==-1)g.out[a].instances.add(z);else if(!g.seen.has(y)){let v=d.length;for(;v-- >0;)if(d[v](z,w)){g.classes[v]=g.out[v].cls=y,g.out[v].instances.add(z),g.out[v].depth=r;break}g.seen.add(y)}}if(w._ffz_no_scan||w.stateNode?._ffz_no_scan)return g.out;let C=w.child;for(;C;)this.searchAll(C,d,f,r+1,g,u),C=C.sibling;if(u&&z?.props?.root){const y=z.props.root._reactRootContainer;if(y){let a=y._internalRoot&&y._internalRoot.current||y.current;for(;a;)this.searchAll(a,d,f,r+1,g,u),a=a.sibling}}return g.out}route(c){this._route=c,this._updateLiveWaiting()}_updateLiveWaiting(){const c=this._live_waiting=[],d=this._waiting_crit=[],f=this._route;if(this._waiting)for(const r of this._waiting)r.routes===!1||!r.criteria||(!f||!r.routes?.length||r.routes.includes(f))&&(c.push(r),d.push(r.criteria));this._live_waiting.length?this._waiting_timer||this._startWaiting():this._stopWaiting()}define(c,d,f=null){if(this._wrappers.has(c))return this._wrappers.get(c);if(!d)throw new Error("cannot find definition and no criteria provided");const r=new W(c,d,f,this);this._wrappers.set(c,r);const g=this.react?this.searchAll(this.react,[d],1e3)[0]:null;return g?.cls?(r._set(g.cls,g.instances),this._known_classes.set(g.cls,r)):f!==!1&&(this._waiting.push(r),this._updateLiveWaiting()),r}wrap(c,d){let f;if(this._wrappers.has(c)?f=this._wrappers.get(c):(f=new W(c,null,null,this),this._wrappers.set(c,f)),d){if(f.class||f.criteria)throw new Error("tried setting a class on an already initialized FineWrapper");f._set(d,new Set),this._known_classes.set(d,f)}return f}_checkWaiters(c=null){if(this._live_waiting){Array.isArray(c)||(c=[c]);for(let d of c){if(!this._live_waiting.length||!this._waiting_crit)break;let f=null;if(!d&&this.react?f=this.react:d instanceof Node?f=this.getReactInstance(d):d?._reactInternals?f=d._reactInternals:d?._reactInternalFiber&&(f=d._reactInternalFiber),!f||f._ffz_no_scan||f.stateNode?._ffz_no_scan)continue;const r=this.searchAll(f,this._waiting_crit,1e3);let g=r.length;for(;g-- >0;)if(r[g].cls){const u=r[g],w=this._live_waiting.splice(g,1)[0];this._waiting_crit.splice(g,1);const z=this._waiting.indexOf(w);z!==-1&&this._waiting.splice(z,1),this.log.debug(`Found class for "${w.name}" at depth ${u.depth}`),w._set(u.cls,u.instances)}}this._live_waiting.length||this._stopWaiting()}}_startWaiting(){this.log.info("Installing MutationObserver."),this._waiting_timer=setInterval(()=>this._checkWaiters(),500),this._observer||(this._observer=new MutationObserver(c=>this._checkWaiters(c.map(d=>d.target)))),this._observer.observe(document.body,{childList:!0,subtree:!0})}_stopWaiting(){this.log.info("Stopping MutationObserver."),this._observer&&this._observer.disconnect(),this._waiting_timer&&clearInterval(this._waiting_timer),this._live_waiting=null,this._waiting_crit=null,this._waiting_timer=null}};B(x,"Fine");let L=x;const I={"will-mount":"UNSAFE_componentWillMount",mount:"componentDidMount",render:"render","receive-props":"UNSAFE_componentWillReceiveProps","should-update":"shouldComponentUpdate","will-update":"UNSAFE_componentWillUpdate",update:"componentDidUpdate",unmount:"componentWillUnmount"},m=class m extends K.EventEmitter{constructor(c,d,f,r){super(),this.name=c,this.criteria=d,this.fine=r,this.instances=new Set,this.routes=f??[],this._wrapped=new Map,this._class=null}get class(){return this._class}get first(){return this.toArray()[0]}__cleanListeners(){const c=super.__cleanListeners();for(const d of c){const f=I[d];if(f)try{this._unwrap(f)}catch{}}return c}toArray(){return Array.from(this.instances)}check(c=null,d=1e3){if(this._class||!this.criteria)return;const f=this.fine.findAllMatching(c,this.criteria,d);if(f.size){const r=Array.from(f);this._set(r[0].constructor,r)}}ready(c){this._class?c(this._class,this.instances):this.once("set",c)}each(c){for(const d of this.instances)c(d)}updateInstances(c=null,d=1e3){if(!this._class)return;const f=this.fine.findAllMatching(c,r=>r.constructor===this._class,d);for(const r of f)r._ffz_mounted=!0,this.instances.add(r)}_set(c,d){if(this._class)throw new Error("already have a class");this._class=c,c._ffz_wrapper=this;const f=this,r=this.instances,g=c.prototype,u=g.UNSAFE_componentWillMount,w=g.componentWillUnmount,z=g.UNSAFE_componentWillMount=u?function(...y){return this._ffz_mounted=!0,r.add(this),f.emit("will-mount",this,...y),u.apply(this,y)}:function(...y){this._ffz_mounted=!0,r.add(this),f.emit("will-mount",this,...y)},C=g.componentWillUnmount=w?function(...y){return f.emit("unmount",this,...y),r.delete(this),this._ffz_mounted=!1,w.apply(this,y)}:function(...y){f.emit("unmount",this,...y),r.delete(this),this._ffz_mounted=!1};this._wrapped.set("UNSAFE_componentWillMount",[z,u]),this._wrapped.set("componentWillUnmount",[C,w]);for(const y of this.events())this._maybeWrap(y);if(d)for(const y of d)y._ffz_mounted=!0,r.add(y);this.emit("set",c,r)}_add(c){for(const d of c)this.instances.add(d)}_maybeWrap(c){const d=I[c];!this._class||!d||this._wrapped.has(d)||this._wrap(c,d)}_wrap(c,d){if(this._wrapped.has(d)||!this._class)return;const f=this,r=this._class.prototype,g=r[d],u=r[d]=g?function(...w){return this._ffz_mounted||(this._ffz_mounted=!0,f.instances.add(this),f.emit("late-mount",this)),f.emit(c,this,...w),g.apply(this,w)}:d==="shouldComponentUpdate"?function(...w){return this._ffz_mounted||(this._ffz_mounted=!0,f.instances.add(this),f.emit("late-mount",this)),f.emit(c,this,...w),!0}:function(...w){this._ffz_mounted||(this._ffz_mounted=!0,f.instances.add(this),f.emit("late-mount",this)),f.emit(c,this,...w)};this._wrapped.set(d,[u,g])}_unwrap(c){const d=this._wrapped.get(c);if(!d||!this._class)return;const f=this._class.prototype,[r,g]=d;if(f[c]!==r)throw new Error("unable to unwrap -- prototype modified");f[c]=g,this._wrapped.delete(c)}forceUpdate(){for(const c of this.instances)try{c.forceUpdate(),this.fine.emit("site:dom-update",this.name,c)}catch(d){d instanceof Error&&this.fine.log.capture(d,{tags:{fine_wrapper:this.name}}),this.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`,d)}}on(c,d,f,r,g=!1){return this._maybeWrap(c),super.on(c,d,f,r,g)}once(c,d,f,r,g=!1){return this._maybeWrap(c),super.once(c,d,f,r,g)}many(c,d,f,r,g,u=!1){return this._maybeWrap(c),super.many(c,d,f,r,g,u)}waitFor(c,d,f,r=!1){return this._maybeWrap(c),super.waitFor(c,d,f,r)}};B(m,"FineWrapper");let W=m},24431:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{API_SERVER:()=>x,BAD_HOTKEYS:()=>g,DEBUG:()=>K,EMQX_SERVERS:()=>J,EXTENSION:()=>P,EmoteTypes:()=>ne,IS_FIREFOX:()=>re,IS_OSX:()=>G,IS_WEBKIT:()=>q,IS_WIN:()=>V,KEYS:()=>C,KNOWN_CODES:()=>a,LINK_DATA_HOSTS:()=>D,NEW_API:()=>c,PUBSUB_CLUSTERS:()=>O,REPLACEMENTS:()=>F,REPLACEMENT_BASE:()=>v,RERENDER_SETTINGS:()=>u,RESOLVERS_REQUIRE_TOS:()=>ie,SENTRY_ID:()=>d,SERVER:()=>L,SERVER_OR_EXT:()=>W,STAGING_API:()=>m,STAGING_CDN:()=>b,TWITCH_EMOTE_V2:()=>y,TWITCH_GLOBAL_SETS:()=>fe,TWITCH_POINTS_SETS:()=>be,TWITCH_PRIME_SETS:()=>Pe,UPDATE_BADGE_SETTINGS:()=>w,UPDATE_TOKEN_SETTINGS:()=>z,WEBKIT_CSS:()=>ae,WEIRD_EMOTE_SIZES:()=>r,WORD_SEPARATORS:()=>f,WS_CLUSTERS:()=>A});const K=localStorage.ffzDebugMode==="true"&&document.body.classList.contains("ffz-dev"),P=!0,L=K?"https://localhost:8000":"https://cdn2.frankerfacez.com";let I=`${L}/script`;P&&(I=S.p,I.endsWith("/")&&(I=I.slice(0,I.length-1)));const W=I,x="https://api.frankerfacez.com",m="https://api-staging.frankerfacez.com",b="https://cdn-staging.frankerfacez.com",c="https://api2.frankerfacez.com",d="https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2",f="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]",r={15:[21,27],16:[22,27],17:[20,27],18:[20,27],22:[19,27],25:[25,28],26:[20,27],28:[39,27],30:[29,27],32:[21,27],33:[25,32],34:[21,28],36:[36,30],40:[21,27],41:[19,27],46:[24,24],47:[24,24],50:[18,27],52:[32,32],65:[40,30],66:[20,27],69:[41,28],73:[21,30],74:[24,30],86:[36,30],87:[24,30],92:[23,30],244:[24,30],354:[20,30],357:[28,30],360:[22,30],483:[20,18],484:[20,22],485:[27,18],486:[21,32],487:[15,32],488:[29,24],489:[20,18],490:[20,18],491:[20,18],492:[20,18],493:[20,18],494:[20,18],495:[20,18],496:[20,18],497:[20,18],498:[20,18],499:[20,18],500:[20,18],501:[20,18],1896:[20,30],1898:[26,28],1899:[22,30],1900:[33,30],1901:[24,28],1902:[27,29],1904:[24,30],1906:[24,30]},g=["f","space","k","shift+up","shift+down","esc","m","?","alt+t","alt+x"],u=["chat.name-format","chat.me-style","chat.rituals.show","chat.subs.show","chat.subs.compact","chat.actions.inline","chat.actions.hover","chat.timestamp-format","chat.points.allow-highlight","chat.filtering.display-deleted","chat.filtering.display-mod-action","chat.replies.style","chat.bits.cheer-notice","chat.filtering.hidden-tokens","chat.hype.message-style","chat.filtering.show-reasons","chat.emotes.allow-gigantify","chat.shared-chat.username-tooltip","chat.shared-chat.style"],w=["chat.badges.style","chat.badges.hidden","chat.badges.custom-mod","chat.badges.custom-vip"],z=["chat.emotes.enabled","chat.emotes.2x","chat.emotes.animated","chat.emoji.style","chat.emoji.replace-joiner","chat.bits.stack","chat.rich.enabled","chat.rich.want-mid","chat.rich.hide-tokens","chat.rich.all-links","chat.rich.minimum-level","chat.filtering.process-own","chat.filtering.mention-priority","chat.filtering.debug","chat.fix-bad-emotes","__filter:highlight-terms","__filter:highlight-users","__filter:highlight-badges","__filter:block-terms","__filter:block-users","__filter:block-badges"],C={Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Meta:91,Context:93},y="//static-cdn.jtvnw.net/emoticons/v2",a={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},v=`${L}/static/replacements/`,F={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},A={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",.7],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1],["wss://ayaya.frankerfacez.com/",1],["wss://champ.frankerfacez.com/",1]],Development:[["ws://127.0.0.1:7999/",1]]},D={localhost:{title:"Local Dev Server (Port 8002)",value:"https://localhost:8002",has_sse:!0},"localhost-cf":{title:"Local Dev Worker (Wrangler, Port 8787)",value:"https://localhost:8787"},Production:{title:"Production",value:"https://link-service.workers.frankerfacez.com"}},O={Production:"https://pubsub.frankerfacez.com",Staging:"https://pubsub-staging-alt.frankerfacez.com",EMQXTest:"emqx-test",Development:"https://stendec.dev/ps/"},J=["biblethump.frankerfacez.com"],G=navigator.platform?navigator.platform.indexOf("Mac")!==-1:/OS X/.test(navigator.userAgent),V=navigator.platform?navigator.platform.indexOf("Win")!==-1:/Windows/.test(navigator.userAgent),q=navigator.userAgent.indexOf("AppleWebKit/")!==-1&&navigator.userAgent.indexOf("Edge/")===-1,re=navigator.userAgent.indexOf("Firefox/")!==-1,ae=q?"-webkit-":"",fe=[0,33,42],be=[300238151],Pe=[457,793,19151,19194];var ne=(le=>(le[le.Unknown=0]="Unknown",le[le.Prime=1]="Prime",le[le.Turbo=2]="Turbo",le[le.LimitedTime=3]="LimitedTime",le[le.ChannelPoints=4]="ChannelPoints",le[le.Unavailable=5]="Unavailable",le[le.Subscription=6]="Subscription",le[le.BitsTier=7]="BitsTier",le[le.Global=8]="Global",le[le.TwoFactor=9]="TwoFactor",le[le.Follower=10]="Follower",le))(ne||{});const ie={YouTube:{label:"You must agree to the YouTube Terms of Service to view this embed.",i18n_key:"embed.warn.youtube",i18n_links:"embed.warn.youtube.links",links:`To view YouTube embeds, you must agree to YouTube's Terms of Service:
* [Terms of Service](https://www.youtube.com/t/terms)
* [Privacy Policy](https://policies.google.com/privacy)`,i18n_accept:"embed.warn.youtube.agree",accept:"Yes, I accept the YouTube Terms of Service."}}},94417:(ge,te,S)=>{var b;"use strict";S.d(te,{getDialogNextZ:()=>I});var K=S(17159),P=S(43874);let L=9e3;function I(){return L++}B(I,"getDialogNextZ");const W=(b=class extends K.EventEmitter{constructor(d,f={}){super(),this.selectors={exclusive:b.EXCLUSIVE,maximized:b.MAXIMIZED,normal:b.SELECTOR},f.selectors&&(this.selectors=Object.assign(this.selectors,f.selectors)),this._maximized=f.maximized||!1,this._exclusive=f.exclusive||!1,this.prepend=f.prepend||!1,this._element=null,this._visible=!1,typeof d=="function"?this.factory=d:this.element=d}get maximized(){return this._exclusive||this._maximized}set maximized(d){d=!!d,d!==this._maximized&&(this._visible?this.toggleSize():this._maximized=d)}get visible(){return this._visible}set visible(d){d=!!d,d!==this._visible&&this.toggleVisible()}get exclusive(){return this._exclusive}set exclusive(d){if(this._visible)throw new Error("cannot set exclusive flag when dialog already visible");this._exclusive=d}get element(){return this._element}set element(d){if(this._visible)throw new Error("cannot change element when dialog already visible");if(!(d instanceof Node))throw new Error("element must be an instance of Node");this._element=d}show(){this.visible=!0}hide(){this.visible=!1}maximize(){this.maximized=!0}restore(){this.maximized=!1}getContainer(){return document.querySelector(this._exclusive?this.selectors.exclusive:this._maximized?this.selectors.maximized:this.selectors.normal)}toggleVisible(d){if(d&&d.button!==0)return;const f=this.maximized,r=this._visible=!this._visible,g=this.getContainer();if(f&&g&&g.classList.toggle("ffz-has-dialog",r),!r){this._element&&this._element.remove(),this.emit("hide"),this.factory&&(this._element=null);return}if(g){if(this.factory){const u=this.factory();if(u instanceof Promise){u.then(w=>{this._element=w,this.prepend?g.insertBefore(w,g.firstChild):g.appendChild(w),this.emit("show")}).catch(w=>{this.emit("error",w)});return}else this._element=u}this._element&&(this.prepend?g.insertBefore(this._element,g.firstChild):g.appendChild(this._element),this.emit("show"))}}toggleSize(d){if(!this._visible||d&&d.button!==0||!this._element)return;this._maximized=!this._maximized;const f=this.maximized,r=this.getContainer(),g=this._element.parentElement;r!==g&&(f?r&&r.classList.add("ffz-has-dialog"):g&&g.classList.remove("ffz-has-dialog"),this._element.remove(),r&&(this.prepend?r.insertBefore(this._element,r.firstChild):r.appendChild(this._element)),this.emit("resize"))}},B(b,"_Dialog2"),b);W.EXCLUSIVE=P.Z.DIALOG_EXCLUSIVE,W.MAXIMIZED=P.Z.DIALOG_MAXIMIZED,W.SELECTOR=P.Z.DIALOG_SELECTOR;let x=null;var m=null},44589:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{ClickOutside:()=>v,ManagedStyle:()=>a,createElement:()=>f,findReactFragment:()=>d,hasSharedParent:()=>g,highlightJson:()=>F,off:()=>c,on:()=>b,openFile:()=>u,readFile:()=>w,sanitize:()=>C,setChildren:()=>r});var K=S(46949),P=S(24431);const L=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","type","usemap","value","width","wrap"],I=["svg","animate","animateMotion","animateTransform","circle","clipPath","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font-face-format","font-face-name","font-face-src","font-face-uri","font-face","font","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","tref","tspan","use","view","vkern"],W=["controls","autoplay","loop"],x=document.createRange();function m(O){return O.replace(/[-_]\w/g,J=>J[1].toUpperCase())}B(m,"camelCase");function b(O,J,G,V){return O.addEventListener(J,G,V)}B(b,"on");function c(O,J,G,V){return O.removeEventListener(J,G,V)}B(c,"off");function d(O,J,G=25,V=0,q){if(!q)q=new Set;else if(q.has(O))return null;if(J(O))return O;if(V>=G)return null;if(q.add(O),O?.props?.children)if(Array.isArray(O.props.children)){for(const re of O.props.children)if(re)if(Array.isArray(re))for(const ae of re){const fe=d(ae,J,G,V+1,q);if(fe)return fe}else{const ae=d(re,J,G,V+1,q);if(ae)return ae}}else{const re=d(O.props.children,J,G,V+1,q);if(re)return re}return null}B(d,"findReactFragment");function f(O,J,...G){const q=I.includes(O)?document.createElementNS("http://www.w3.org/2000/svg",O):document.createElement(O);if(G.length===0?G=null:G.length===1&&(G=G[0]),typeof J=="string")q.setAttribute("class",J);else if(J){for(const re in J)if((0,K.has)(J,re)){const ae=re.toLowerCase(),fe=J[re];if(re==="className")q.setAttribute("class",fe);else if(ae==="style")if(typeof fe=="string")q.style.cssText=fe;else if(fe&&typeof fe=="object")for(const[be,Pe]of Object.entries(fe))(0,K.has)(q.style,be)||(0,K.has)(Object.getPrototypeOf(q.style),be)?q.style[be]=Pe:q.style.setProperty(be,fe[be]);else P.DEBUG&&fe!=null&&console.warn("unsupported style value",fe);else if(ae==="dataset")if(fe&&typeof fe=="object")for(const be in fe)(0,K.has)(fe,be)&&(q.dataset[m(be)]=fe[be]);else P.DEBUG&&fe!=null&&console.warn("unsupported dataset value",fe);else re==="dangerouslySetInnerHTML"?fe&&fe.__html&&(q.innerHTML=fe.__html):ae.startsWith("on")?q.addEventListener(ae.slice(2),fe):ae.startsWith("data-")?q.dataset[m(ae.slice(5))]=fe:W.includes(ae)?fe&&fe!=="false"&&q.setAttribute(re,fe):ae.startsWith("aria-")||L.includes(ae)||I.includes(O)?q.setAttribute(re,fe):q[re]=fe}}return G&&r(q,G),q}B(f,"createElement");function r(O,J,G=!1,V=!1){if(G&&window.FrankerFaceZ.get().log.warn("call to setChildren with no_sanitize set to true -- this is no longer supported"),J instanceof Node)V||(O.innerHTML=""),O.appendChild(J);else if(Array.isArray(J)){V||(O.innerHTML="");for(const q of J)if(q instanceof Node)O.appendChild(q);else if(Array.isArray(q))r(O,q,G,!0);else if(q){const re=typeof q=="string"?q:String(q);O.appendChild(document.createTextNode(re))}}else if(J){const q=typeof J=="string"?J:String(J);O.appendChild(document.createTextNode(q))}}B(r,"setChildren");function g(O,J,G){for(;O;){if(O.contains(J))return!0;O=O.parentElement,G&&(O=O instanceof Element?O.closest(G):null)}return!1}B(g,"hasSharedParent");function u(O,J){return new Promise(G=>{const V=document.createElement("input");V.type="file",V.accept=O,V.multiple=J;let q=!1;V.onchange=()=>{if(!q){q=!0;const re=Array.from(V.files??[]);G(J?re:re[0])}},V.click()})}B(u,"openFile");function w(O,J="utf-8"){return new Promise((G,V)=>{const q=new FileReader;q.readAsText(O,J),q.onload=()=>G(q.result),q.onerror=re=>V(re)})}B(w,"readFile");const z=document.createElement("span");function C(O){z.textContent=O;const J=z.innerHTML;return z.textContent="",J}B(C,"sanitize");let y=0;const A=class A{constructor(J){this.id=J||y++,this._blocks={},this._style=f("style",{type:"text/css",id:`ffz--managed-style--${this.id}`}),document.head.appendChild(this._style)}destroy(){this._style&&this._style.remove(),this._blocks=null,this._style=null}clear(){this._blocks={},this._style.innerHTML=""}get(J){const G=this._blocks[J];if(G)return G.textContent}has(J){return!!this._blocks[J]}set(J,G,V=!1){const q=this._blocks[J];if(q){if(!V&&q.textContent===G)return;q.textContent=G}else this._style.appendChild(this._blocks[J]=document.createTextNode(G))}delete(J){const G=this._blocks[J];G&&(this._style.contains(G)&&this._style.removeChild(G),this._blocks[J]=null)}};B(A,"ManagedStyle");let a=A;const D=class D{constructor(J,G){this.el=J,this.cb=G,this._fn=this.handleClick.bind(this),document.documentElement.addEventListener("click",this._fn)}destroy(){this._fn&&document.documentElement.removeEventListener("click",this._fn),this.cb=this.el=this._fn=null}handleClick(J){this.cb&&this.el&&!this.el.contains(J.target)&&this.cb(J)}};B(D,"ClickOutside");let v=D;function F(O,J=!1,G=1,V=30){let q="",re="";if(J&&(q="    ".repeat(G-1),re="    ".repeat(G)),G>V)return'<span class="ffz-ct--obj-literal">&lt;nested&gt;</span>';if(O==null)return`<span class="ffz-ct--literal" depth="${G}">null</span>`;if(typeof O=="number"||typeof O=="boolean")return`<span class="ffz-ct--literal" depth="${G}">${O}</span>`;if(typeof O=="string")return`<span class=ffz-ct--string depth="${G}">${C(JSON.stringify(O))}</span>`;if(Array.isArray(O))return`<span class="ffz-ct--obj-open" depth="${G}">[</span>`+(O.length>0?O.map(fe=>(J?`
${re}`:"")+F(fe,J,G+1,V)).join(`<span class="ffz-ct--obj-sep" depth="${G}">, </span>`)+(J?`
${q}`:""):"")+`<span class="ffz-ct--obj-close" depth="${G}">]</span>`;const ae=[];for(const[fe,be]of Object.entries(O))ae.length>0&&ae.push(`<span class="ffz-ct--obj-sep" depth="${G}">, </span>`),J&&ae.push(`
${re}`),ae.push(`<span class="ffz-ct--obj-key" depth="${G}">${C(JSON.stringify(fe))}</span><span class="ffz-ct--obj-key-sep" depth="${G}">: </span>`),ae.push(F(be,J,G+1,V));return`<span class="ffz-ct--obj-open" depth="${G}">{</span>${ae.join("")}${ae.length&&J?`
${q}`:""}<span class="ffz-ct--obj-close" depth="${G}">}</span>`}B(F,"highlightJson")},17159:(ge,te,S)=>{var r;"use strict";S.r(te),S.d(te,{Detach:()=>K,EventEmitter:()=>m,FFZEvent:()=>b,FFZWaitableEvent:()=>c,HierarchicalEventEmitter:()=>d,StopPropagation:()=>P,default:()=>f});const K=Symbol("Detach"),P=Symbol("StopPropagation"),L=/([a-z])([A-Z])/g,I=/[ \t\W]/g,W=/^_+|_+$/g;String.prototype.toSlug=function(z="-"){let C=this;return C.normalize&&(C=C.normalize("NFD")),C.replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,z)},String.prototype.toSnakeCase=function(){let z=this;return z.normalize&&(z=z.normalize("NFD")),z.replace(/[\u0300-\u036f]/g,"").trim().replace(L,"$1_$2").replace(I,"_").replace(W,"").toLowerCase()};const x=(r=class{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return[];const C={},y=this.__listeners,a=[];for(const[v,F]of Object.entries(y))F?.length?C[v]=F:a.push(v);return this.__listeners=C,this.__dead_events=0,a}__sortListeners(C){if(this.__running.has(C))return;const y=this.__listeners[C];y&&y.sort((a,v)=>a[3]-v[3])}transferListeners(C){if(!(C instanceof r))throw new Error("other must also be EventEmitter");if(!(C.events().length+C.__running.size)){C.__listeners=this.__listeners,C.__dead_events=this.__dead_events,this.__listeners={},this.__dead_events=0;return}for(const[a,v]of Object.entries(this.__listeners)){if(!v||!v.length)continue;let F=C.__listeners[a];Array.isArray(F)?(F.push(...v),C.__sortListeners(a)):C.__listeners[a]=v}this.__listeners={},this.__dead_events=0}makeEvent(C){return b.makeEvent(C)}makeWaitableEvent(C){return c.makeEvent(C)}on(C,y,a,v,F=!1){if(typeof y!="function")throw new TypeError("fn must be a function");const A=[y,a,!1,v??0,F],D=this.__listeners[C];return D?(F?D.unshift(A):D.push(A),this.__sortListeners(C)):this.__listeners[C]=[A],this}once(C,y,a,v,F=!1){return this.many(C,1,y,a,v,F)}many(C,y,a,v,F,A=!1){if(typeof a!="function")throw new TypeError("fn must be a function");if(typeof y!="number"||isNaN(y)||!isFinite(y)||y<1)throw new TypeError("ttl must be a positive, finite number");const D=[a,v,y,F??0,A],O=this.__listeners[C];return O?(A?O.unshift(D):O.push(D),this.__sortListeners(C)):this.__listeners[C]=[D],this}waitFor(C,y,a,v=!1){return new Promise(F=>{const A=[(...O)=>F(O),y,1,a??0,v],D=this.__listeners[C];D?(v?D.unshift(A):D.push(A),this.__sortListeners(C)):this.__listeners[C]=[A]})}off(C,y,a){if(C==null){if(!y&&!a)throw new Error("you must provide at least one constraint when removing listeners");for(const F in Object.keys(this.__listeners))this.__running.has(F)||this.off(F,y,a);return this}if(this.__running.has(C))throw new Error("concurrent modification: tried removing event listener while event is running");let v=this.__listeners[C];return v?(!y&&!a?v=null:(v=v.filter(([F,A])=>!((!y||F===y)&&(!a||a===A))),v.length||(v=null)),this.__listeners[C]=v,v||this.__dead_events++,this):this}offContext(C,y){return this.off(C,void 0,y)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(C){const y=this.__listeners[C];return y?Array.from(y):[]}hasListeners(C){return!!this.__listeners[C]}emit(C,...y){let a=this.__listeners[C];if(!a)return;if(this.__running.has(C))throw new Error("concurrent access: tried to emit event while event is running");const v=new Set;this.__listeners[C]=null,this.__running.add(C);for(const D of a){const[O,J,G]=D;let V;try{V=O.apply(J,y)}catch(q){this.log&&(this.log.capture(q,{tags:{event:C},extra:{args:y}}),this.log.error(q))}if(V===K?v.add(D):G!==!1&&(G<=1?v.add(D):D[2]=G-1),V instanceof Promise&&y[0]instanceof c&&y[0].waitFor(V),y[0]instanceof b&&y[0].propagationStopped||V===P)break}if(v.size)for(const D of v){const O=a.indexOf(D);O!==-1&&a.splice(O,1)}let F=!1;const A=this.__listeners[C];A&&(a=a.concat(A),F=!0),a.length?this.__listeners[C]=a:(this.__listeners[C]=null,this.__dead_events++),this.__running.delete(C),F&&this.__sortListeners(C)}},B(r,"_EventEmitter2"),r);x.Detach=K,x.StopPropagation=P;let m=x;const g=class g{static makeEvent(C){return new g(C)}constructor(C){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,C)}_reset(){this.defaultPrevented=!1,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}};B(g,"FFZEvent");let b=g;const u=class u extends b{constructor(){super(...arguments),this.__waiter_results=null}static makeEvent(C){return new u(C)}_wait(){if(this.__waiter)return this.__waiter;if(!this.__promises){const y=this.__waiter_results;return this.__waiter_results=null,y?Promise.resolve(y):null}const C=this.__promises;return this.__promises=null,this.__waiter=Promise.all(C).then(y=>(this.__waiter_results?this.__waiter_results.push(...y):this.__waiter_results=y,this.__waiter=null,this._wait()??[])).catch(y=>{throw this.__waiter=null,y})}_reset(){super._reset(),this.__waiter=null,this.__waiter_results=null,this.__promises=null}waitFor(C){this.__promises?this.__promises.push(C):this.__promises=[C]}};B(u,"FFZWaitableEvent");let c=u;const w=class w extends m{constructor(C,y){super(),this.name=C||(this.constructor.name||"").toSnakeCase(),this.parent=y,y?(this.root=y.root,this.__listeners=y.__listeners,this.__running=y.__running,this.__path=C&&y.__path?`${y.__path}.${C}`:C):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}transferListeners(C){if(!(C instanceof w&&C.root===this.root))throw new Error("Transfering listeners from a HierarchicalEventEmitter is not supported.")}abs_path(C){if(typeof C!="string"||!C.length)throw new TypeError("path must be a non-empty string");let y=0,a;const v=this.__path_parts,F=v.length;do{if(a=C.charAt(y),C.charAt(y)==="."){if(y>F)throw new Error("invalid path: reached top of stack");continue}break}while(++y<C.length);const A=a===":";if(y===0)return A&&this.__path?`${this.__path}${C}`:C;const D=v.slice(0,F-(y-1)).join("."),O=C.slice(y);if(D.length)if(O.length){if(A)return D+O}else return D;else return O;return`${D}.${O}`}on(C,y,a,v,F=!1){return super.on(this.abs_path(C),y,a,v,F)}once(C,y,a,v,F=!1){return super.once(this.abs_path(C),y,a,v,F)}many(C,y,a,v,F,A=!1){return super.many(this.abs_path(C),y,a,v,F,A)}waitFor(C,y,a,v=!1){return super.waitFor(this.abs_path(C),y,a,v)}off(C,y,a){return super.off(C&&this.abs_path(C),y,a)}listeners(C){return super.listeners(this.abs_path(C))}hasListeners(C){return super.hasListeners(this.abs_path(C))}emit(C,...y){return super.emit(this.abs_path(C),...y)}eventsWithChildren(){const C=super.events(),y=this.__path||"",a=y.length;return C.filter(v=>{const F=v.charAt(a);return v.startsWith(y)&&(F===""||F==="."||F===":")})}events(){const C=super.events(),y=this.__path||"",a=y.length;return C.filter(v=>{const F=v.charAt(a);return v.startsWith(y)&&(F===""||F===":")})}};B(w,"HierarchicalEventEmitter");let d=w;const f=d},37087:(ge,te,S)=>{"use strict";S.d(te,{createTester:()=>K});function K(P,L,I=!1,W=!1,x){if(!Array.isArray(P)||!L)return I?()=>!1:()=>!0;const m=[],b=[];let c=0;for(const d of P){if(!d||!d.type)continue;const f=L[d.type];if(!f){c++,m.push(()=>!1),b.push(`f${c}`);continue}const r=f.createTest(d.data,L,x);r&&(c++,m.push(r),b.push(`f${c}`))}return m.length?m.length===1?I?d=>!m[0](d):m[0]:new Function(...b,"ctx",`return ${I?"!(":""}${b.map(d=>`${d}(ctx)`).join(W?" || ":" && ")}${I?")":""};`).bind(null,...m):I?()=>!1:()=>!0}B(K,"createTester")},61892:(ge,te,S)=>{"use strict";S.d(te,{ALIASES:()=>L,ICONS:()=>I,load:()=>x,maybeLoad:()=>m});var K=S(44589);const P=S.p+"font-awesome.css",L={ban:["ban","block"],ok:["ok","unban","untimeout"],"clock-o":["clock-o","clock","timeout"],times:["remove","close","times"],cog:["gear","cog"],repeat:["rotate-right","repeat"],outdent:["dedent","outdent"],"picture-o":["photo","image","picture-o"],"pencil-square-o":["edit","pencil-square-o"],share:["mail-forward","share"],"exclamation-triangle":["warning","exclamation-triangle"],"bar-chart":["bar-chart-o","bar-chart"],cogs:["gears","cogs"],facebook:["facebook-f","facebook"],rss:["feed","rss"],users:["group","users"],link:["chain","link"],scissors:["cut","scissors"],"files-o":["copy","files-o"],"floppy-o":["save","floppy-o"],bars:["navicon","reorder","bars"],sort:["unsorted","sort"],"sort-desc":["sort-down","sort-desc"],"sort-asc":["sort-up","sort-asc"],undo:["rotate-left","undo"],gavel:["legal","gavel"],tachometer:["dashboard","tachometer"],bolt:["flash","bolt"],clipboard:["paste","clipboard"],mobile:["mobile-phone","mobile"],reply:["mail-reply","reply"],"reply-all":["mail-reply-all","reply-all"],"star-half-o":["star-half-empty","star-half-full","star-half-o"],"chain-broken":["unlink","chain-broken"],"caret-square-o-down":["toggle-down","caret-square-o-down"],"caret-square-o-up":["toggle-up","caret-square-o-up"],"caret-square-o-right":["toggle-right","caret-square-o-right"],eur:["euro","eur"],usd:["dollar","usd"],inr:["rupee","inr"],jpy:["cny","rmb","yen","jpy"],rub:["ruble","rouble","rub"],krw:["won","krw"],btc:["bitcoin","btc"],gratipay:["gittip","gratipay"],"caret-square-o-left":["toggle-left","caret-square-o-left"],try:["turkish-lira","try"],university:["institution","bank","university"],"graduation-cap":["mortar-board","graduation-cap"],car:["automobile","car"],taxi:["cab","taxi"],"file-image-o":["file-photo-o","file-picture-o","file-image-o"],"file-archive-o":["file-zip-o","file-archive-o"],"file-audio-o":["file-sound-o","file-audio-o"],"file-video-o":["file-movie-o","file-video-o"],"life-ring":["life-bouy","life-buoy","life-saver","support","life-ring"],rebel:["ra","resistance","rebel"],empire:["ge","empire"],"hacker-news":["y-combinator-square","yc-square","hacker-news"],weixin:["wechat","weixin"],"paper-plane":["send","paper-plane"],"paper-plane-o":["send-o","paper-plane-o"],"futbol-o":["soccer-ball-o","futbol-o"],ils:["shekel","sheqel","ils"],transgender:["intersex","transgender"],bed:["hotel","bed"],"y-combinator":["yc","y-combinator"],"battery-full":["battery-4","battery","battery-full"],"battery-three-quarters":["battery-3","battery-three-quarters"],"battery-half":["battery-2","battery-half"],"battery-quarter":["battery-1","battery-quarter"],"battery-empty":["battery-0","battery-empty"],"hourglass-start":["hourglass-1","hourglass-start"],"hourglass-half":["hourglass-2","hourglass-half"],"hourglass-end":["hourglass-3","hourglass-end"],"hand-rock-o":["hand-grab-o","hand-rock-o"],"hand-paper-o":["hand-stop-o","hand-paper-o"],television:["tv","television"],"american-sign-language-interpreting":["asl-interpreting","american-sign-language-interpreting"],deaf:["deafness","hard-of-hearing","deaf"],"sign-language":["signing","sign-language"],"google-plus-official":["google-plus-circle","google-plus-official"],"font-awesome":["fa","font-awesome"],"address-card":["vcard","address-card"],"address-card-o":["vcard-o","address-card-o"],"id-card":["drivers-license","id-card"],"id-card-o":["drivers-license-o","id-card-o"],"thermometer-full":["thermometer-4","thermometer","thermometer-full"],"thermometer-three-quarters":["thermometer-3","thermometer-three-quarters"],"thermometer-half":["thermometer-2","thermometer-half"],"thermometer-quarter":["thermometer-1","thermometer-quarter"],"thermometer-empty":["thermometer-0","thermometer-empty"],bath:["bathtub","s15","bath"],"window-close":["times-rectangle","window-close"],"window-close-o":["times-rectangle-o","window-close-o"]},I=["glass","music","search","envelope-o","heart","star","star-o","user","film","th-large","th","th-list","check","times","search-plus","search-minus","power-off","signal","cog","trash-o","home","file-o","clock-o","road","download","arrow-circle-o-down","arrow-circle-o-up","inbox","play-circle-o","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","outdent","indent","video-camera","picture-o","pencil","map-marker","adjust","tint","pencil-square-o","share-square-o","check-square-o","arrows","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-circle","minus-circle","times-circle","check-circle","question-circle","info-circle","crosshairs","times-circle-o","check-circle-o","ban","arrow-left","arrow-right","arrow-up","arrow-down","share","expand","compress","plus","minus","asterisk","exclamation-circle","gift","leaf","fire","eye","eye-slash","exclamation-triangle","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder","folder-open","arrows-v","arrows-h","bar-chart","twitter-square","facebook-square","camera-retro","key","cogs","comments","thumbs-o-up","thumbs-o-down","star-half","heart-o","sign-out","linkedin-square","thumb-tack","external-link","sign-in","trophy","github-square","upload","lemon-o","phone","square-o","bookmark-o","phone-square","twitter","facebook","github","unlock","credit-card","rss","hdd-o","bullhorn","bell","certificate","hand-o-right","hand-o-left","hand-o-up","hand-o-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-circle-down","globe","wrench","tasks","filter","briefcase","arrows-alt","users","link","cloud","flask","scissors","files-o","paperclip","floppy-o","square","bars","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-square","google-plus-square","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-desc","sort-asc","envelope","linkedin","undo","gavel","tachometer","comment-o","comments-o","bolt","sitemap","umbrella","clipboard","lightbulb-o","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-o","coffee","cutlery","file-text-o","building-o","hospital-o","ambulance","medkit","fighter-jet","beer","h-square","plus-square","angle-double-left","angle-double-right","angle-double-up","angle-double-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile","circle-o","quote-left","quote-right","spinner","circle","reply","github-alt","folder-o","folder-open-o","smile-o","frown-o","meh-o","gamepad","keyboard-o","flag-o","flag-checkered","terminal","code","reply-all","star-half-o","location-arrow","crop","code-fork","chain-broken","question","info","exclamation","superscript","subscript","eraser","puzzle-piece","microphone","microphone-slash","shield","calendar-o","fire-extinguisher","rocket","maxcdn","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-circle-down","html5","css3","anchor","unlock-alt","bullseye","ellipsis-h","ellipsis-v","rss-square","play-circle","ticket","minus-square","minus-square-o","level-up","level-down","check-square","pencil-square","external-link-square","share-square","compass","caret-square-o-down","caret-square-o-up","caret-square-o-right","eur","gbp","usd","inr","jpy","rub","krw","btc","file","file-text","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-numeric-asc","sort-numeric-desc","thumbs-up","thumbs-down","youtube-square","youtube","xing","xing-square","youtube-play","dropbox","stack-overflow","instagram","flickr","adn","bitbucket","bitbucket-square","tumblr","tumblr-square","long-arrow-down","long-arrow-up","long-arrow-left","long-arrow-right","apple","windows","android","linux","dribbble","skype","foursquare","trello","female","male","gratipay","sun-o","moon-o","archive","bug","vk","weibo","renren","pagelines","stack-exchange","arrow-circle-o-right","arrow-circle-o-left","caret-square-o-left","dot-circle-o","wheelchair","vimeo-square","try","plus-square-o","space-shuttle","slack","envelope-square","wordpress","openid","university","graduation-cap","yahoo","google","reddit","reddit-square","stumbleupon-circle","stumbleupon","delicious","digg","pied-piper-pp","pied-piper-alt","drupal","joomla","language","fax","building","child","paw","spoon","cube","cubes","behance","behance-square","steam","steam-square","recycle","car","taxi","tree","spotify","deviantart","soundcloud","database","file-pdf-o","file-word-o","file-excel-o","file-powerpoint-o","file-image-o","file-archive-o","file-audio-o","file-video-o","file-code-o","vine","codepen","jsfiddle","life-ring","circle-o-notch","rebel","empire","git-square","git","hacker-news","tencent-weibo","qq","weixin","paper-plane","paper-plane-o","history","circle-thin","header","paragraph","sliders","share-alt","share-alt-square","bomb","futbol-o","tty","binoculars","plug","slideshare","twitch","yelp","newspaper-o","wifi","calculator","paypal","google-wallet","cc-visa","cc-mastercard","cc-discover","cc-amex","cc-paypal","cc-stripe","bell-slash","bell-slash-o","trash","copyright","at","eyedropper","paint-brush","birthday-cake","area-chart","pie-chart","line-chart","lastfm","lastfm-square","toggle-off","toggle-on","bicycle","bus","ioxhost","angellist","cc","ils","meanpath","buysellads","connectdevelop","dashcube","forumbee","leanpub","sellsy","shirtsinbulk","simplybuilt","skyatlas","cart-plus","cart-arrow-down","diamond","ship","user-secret","motorcycle","street-view","heartbeat","venus","mars","mercury","transgender","transgender-alt","venus-double","mars-double","venus-mars","mars-stroke","mars-stroke-v","mars-stroke-h","neuter","genderless","facebook-official","pinterest-p","whatsapp","server","user-plus","user-times","bed","viacoin","train","subway","medium","y-combinator","optin-monster","opencart","expeditedssl","battery-full","battery-three-quarters","battery-half","battery-quarter","battery-empty","mouse-pointer","i-cursor","object-group","object-ungroup","sticky-note","sticky-note-o","cc-jcb","cc-diners-club","clone","balance-scale","hourglass-o","hourglass-start","hourglass-half","hourglass-end","hourglass","hand-rock-o","hand-paper-o","hand-scissors-o","hand-lizard-o","hand-spock-o","hand-pointer-o","hand-peace-o","trademark","registered","creative-commons","gg","gg-circle","tripadvisor","odnoklassniki","odnoklassniki-square","get-pocket","wikipedia-w","safari","chrome","firefox","opera","internet-explorer","television","contao","500px","amazon","calendar-plus-o","calendar-minus-o","calendar-times-o","calendar-check-o","industry","map-pin","map-signs","map-o","map","commenting","commenting-o","houzz","vimeo","black-tie","fonticons","reddit-alien","edge","credit-card-alt","codiepie","modx","fort-awesome","usb","product-hunt","mixcloud","scribd","pause-circle","pause-circle-o","stop-circle","stop-circle-o","shopping-bag","shopping-basket","hashtag","bluetooth","bluetooth-b","percent","gitlab","wpbeginner","wpforms","envira","universal-access","wheelchair-alt","question-circle-o","blind","audio-description","volume-control-phone","braille","assistive-listening-systems","american-sign-language-interpreting","deaf","glide","glide-g","sign-language","low-vision","viadeo","viadeo-square","snapchat","snapchat-ghost","snapchat-square","pied-piper","first-order","yoast","themeisle","google-plus-official","font-awesome","handshake-o","envelope-open","envelope-open-o","linode","address-book","address-book-o","address-card","address-card-o","user-circle","user-circle-o","user-o","id-badge","id-card","id-card-o","quora","free-code-camp","telegram","thermometer-full","thermometer-three-quarters","thermometer-half","thermometer-quarter","thermometer-empty","shower","bath","podcast","window-maximize","window-minimize","window-restore","window-close","window-close-o","bandcamp","grav","etsy","imdb","ravelry","eercast","microchip","snowflake-o","superpowers","wpexplorer","meetup"];let W=!1;const x=B(()=>{W||(W=!0,document.head.appendChild((0,K.createElement)("link",{href:P,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"})))},"load"),m=B(b=>{W||!String(b).startsWith("fa-")&&!String(b).startsWith("ffz-fa")||x()},"maybeLoad")},83342:(ge,te,S)=>{"use strict";S.d(te,{R7:()=>w,jo:()=>z});var K=S(44589);const P=S.p+"opendyslexic.css",L=["Roobert","Arial","Arial Black","Verdana","Helvetica","Tahoma","Trebuchet MS","Impact","Didot","American Typewriter","Lucida Console","Monaco","Bradley Hand","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT","Comic Sans MS"],I=document.fonts?.check?L.filter(C=>document.fonts.check(`16px ${C}`)).sort():L.sort(),W=["Roboto","Open Sans","Noto Sans JP","Lato","Montserrat","Roboto Condensed","Source Sans Pro","Oswald","Poppins","Noto Sans","Roboto Mono","Raleway","Ubuntu","Merriweather","Nunito","PT Sans","Roboto Slab","Playfair Display","Lora","Rubik","Mukta","Noto Sans KR","Work Sans","Nunito Sans","Nanum Gothic","Inter","Quicksand","PT Serif","Hind Siliguri","Titilium Web","Fira Sans","Noto Serif","Noto Sans TC","Karla"],x=new Map,m=new Map;function b(C){if(m.has(C))return;const y=encodeURIComponent(C),a=(0,K.createElement)("link",{id:`ffz-font-${y}`,rel:"stylesheet",href:`https://fonts.googleapis.com/css2?family=${y}`});m.set(C,a),document.head.appendChild(a)}B(b,"loadGoogleFont");function c(C){const y=m.get(C);y&&(m.delete(C),y.remove())}B(c,"unloadGoogleFont");const d=["OpenDyslexic","OpenDyslexicAlta","OpenDyslexicMono"];let f=0,r=null;function g(){r||(r=(0,K.createElement)("link",{id:"ffz-font-opendyslexic",rel:"stylesheet",type:"text/css",href:P}),document.head.appendChild(r))}B(g,"loadOpenDyslexic");function u(){r&&(r.remove(),r=null)}B(u,"unloadOpenDyslexic");function w(){const C=[{value:"",i18n_key:"setting.font.default",title:"Default"},{separator:!0,i18n_key:"setting.font.builtin",title:"Built-in Fonts"}];for(const y of I)C.push({value:y,title:y});C.push({separator:!0,i18n_key:"setting.font.dyslexic",title:"Dyslexia Fonts"});for(const y of d)C.push({value:y,title:y});C.push({separator:!0,i18n_key:"setting.font.google",title:"Google Fonts"});for(const y of W)C.push({value:`google:${y}`,title:y});return C}B(w,"getFontsList");function z(C){if(!C)return[C,null];if(d.includes(C)){f++,f===1&&g();let y=!1;return[C,B(()=>{y||(y=!0,f--,f||u())},"unloader")]}if(C.startsWith("google:")){const y=C.slice(7),a=(x.get(y)??0)+1;x.set(y,a),a===1&&b(y);let v=!1;return[y,B(()=>{if(!v){v=!0;const A=(x.get(y)??0)-1;A>0?x.set(y,A):(x.delete(y),c(y))}},"unloader")]}return[C,null]}B(z,"useFont")},5286:(ge,te,S)=>{"use strict";S.d(te,{default:()=>L});const K={Document:(I,W)=>(I.definitions&&W.definitions?I.definitions=P(I.definitions,W.definitions):W.definitions&&(I.definitions=W.definitions),I),Field:(I,W)=>(I.name&&(!W.name||W.name.value!==I.name.value)||(I.selectionSet&&W.selectionSet?I.selectionSet=L(I.selectionSet,W.selectionSet):W.selectionSet&&(I.selectionSet=W.selectionSet)),I),OperationDefinition:(I,W)=>(I.operation!==W.operation||(I.selectionSet&&W.selectionSet?I.selectionSet=L(I.selectionSet,W.selectionSet):W.selectionSet&&(I.selectionSet=W.selectionSet)),I),FragmentDefinition:(I,W)=>(I.typeCondition&&W.typeCondition&&(I.typeCondition.kind!==W.typeCondition.kind||I.typeCondition.name.value!=W.typeCondition.name.value)||(I.selectionSet&&W.selectionSet?I.selectionSet=L(I.selectionSet,W.selectionSet):W.selectionSet&&(I.selectionSet=W.selectionSet)),I),SelectionSet:(I,W)=>(I.selections&&W.selections?I.selections=P(I.selections,W.selections):W.selections&&(I.selections=W.selections),I)};function P(I,W){let x=!1;const m={};for(const b of I)!b||!b.name||b.name.kind!=="Name"||(b.operation&&(x=!0),m[b.name.value]=b);for(const b of W){if(!b||!b.name||b.name.kind!=="Name")continue;const c=b.name.value,d=m[c]?I.indexOf(m[c]):-1;if(d!==-1){if(I[d].operation&&b.operation&&I[d].operation!==b.operation)continue;I[d]=L(I[d],b),I[d].operation&&(x=!0)}else{if(x&&b.operation)continue;I.push(b)}}return I}B(P,"mergeList");function L(I,W){return I.kind!==W.kind?I:K[I.kind]?K[I.kind](I,W):I}B(L,"merge")},55467:(ge,te,S)=>{var m;"use strict";S.r(te),S.d(te,{LogLevel:()=>P,Logger:()=>W,default:()=>x});const K={1:"debug",2:"info",4:"warn",8:"error"};var P=(b=>(b[b.Verbose=0]="Verbose",b[b.Debug=1]="Debug",b[b.Info=2]="Info",b[b.Warning=4]="Warning",b[b.Error=8]="Error",b[b.Off=99]="Off",b))(P||{});function L(){const b=localStorage.ffzLogLevel;if(!b)return null;const c=b.toUpperCase(),d=W[c];return typeof d=="number"?d:/^\d+$/.test(b)?parseInt(b,10):null}B(L,"readLSLevel");const I=(m=class{constructor(c,d,f,r){this.root=c?c.root:this,this.parent=c,this.name=d,this.root==this&&(this.init=!1,this.captured_init=[],this.label="FFZ"),this.enabled=!0,this.level=f??(c&&c.level)??L()??m.DEFAULT_LEVEL,this.raven=r||c&&c.raven,this.children={}}hi(c,d){const f=d??c.constructor?.version_info;this.info(`FrankerFaceZ v${f} (s:${c.host} f:${c.flavor} b:${f?.build} c:${f?.commit||"null"})`);try{const r=new URL(location.toString());r.search="",this.info(`Initial URL: ${r}`)}catch(r){this.warn("Unable to read location.",r)}}get(c,d){return this.children[c]||(this.children[c]=new m(this,this.name?`${this.name}.${c}`:c,d)),this.children[c]}verbose(c,...d){return this.invoke(0,c,d)}verboseColor(c,d,...f){return this.invokeColor(m.VERBOSE,c,d,f)}debug(c,...d){return this.invoke(m.DEBUG,c,d)}debugColor(c,d,...f){return this.invokeColor(m.DEBUG,c,d,f)}info(c,...d){return this.invoke(m.INFO,c,d)}infoColor(c,d,...f){return this.invokeColor(m.INFO,c,d,f)}warn(c,...d){return this.invoke(m.WARN,c,d)}warnColor(c,d,...f){return this.invokeColor(m.WARN,c,d,f)}warning(c,...d){return this.invoke(m.WARN,c,d)}warningColor(c,d,...f){return this.invokeColor(m.WARN,c,d,f)}error(c,...d){return this.invoke(m.ERROR,c,d)}errorColor(c,d,...f){return this.invokeColor(m.ERROR,c,d,f)}crumb(...c){if(this.raven)return this.raven.captureBreadcrumb(...c)}capture(c,d,...f){if(this.raven&&(d=d||{},d.logger||(d.logger=this.name),this.raven.captureException(c,d)),f.length){const r=f.shift();return this.error(r,...f)}}invokeColor(c,d,f,...r){if(!this.enabled||c<this.level)return;if(Array.isArray(f)||(f=[f]),c>0){let u=d;typeof u=="string"&&(u=u.replace(/%c/g,"")),r.length&&(u=`${u} ${r.join(" ")}`),this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:u,level:K[c]||c}),this.crumb({message:u,category:this.name,level:K[c]||c})}const g=c<2?"color:#999999":"";this.name?(typeof d=="string"?d=`%c${this.root.label} [%c${this.name}%c]:%c ${d}`:(r.unshift(d),d=`%c${this.root.label} [%c${this.name}%c]:%c`),f.unshift("color:#755000; font-weight:bold",g,"color:#755000; font-weight:bold",g)):(typeof d=="string"?d=`%c${this.root.label}:%c ${d}`:(r.unshift(d),d=`%c${this.root.label}:%c`),f.unshift("color:#755000; font-weight:bold",g)),c<2?console.debug(d,...f,...r):c<4?console.info(d,...f,...r):c<8?console.warn(d,...f,...r):c<99&&console.error(d,...f,...r)}invoke(c,d,f){if(!this.enabled||c<this.level||c>=99)return;const r=f?[d,...f]:[d];if(c>0){const w=r.join(" ");this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:w,level:K[c]||c}),this.crumb({message:w,category:this.name,level:K[c]||c})}const g=c<2?"color:#999999":"";let u="";if(g!=="")for(;r.length>0&&typeof r[0]=="string";)u+=" "+r.shift();this.name?r.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${u}`,"color:#755000; font-weight:bold",g,"color:#755000; font-weight:bold",g):r.unshift(`%c${this.root.label}:%c${u}`,"color:#755000; font-weight:bold",g),c<2?console.debug(...r):c<4?console.info(...r):c<8?console.warn(...r):c<99&&console.error(...r)}},B(m,"_Logger2"),m);I.Levels=P,I.VERBOSE=0,I.DEBUG=1,I.INFO=2,I.WARN=4,I.WARNING=4,I.ERROR=8,I.OFF=99,I.DEFAULT_LEVEL=2;let W=I;const x=W},22527:(ge,te,S)=>{var g;"use strict";S.r(te),S.d(te,{CyclicDependencyError:()=>r,LoadState:()=>L,Module:()=>b,ModuleError:()=>f,State:()=>I,buildAddonProxy:()=>d,default:()=>c});var K=S(17159),P=S(46949),L=(z=>(z[z.Unloaded=0]="Unloaded",z[z.Loading=1]="Loading",z[z.Loaded=2]="Loaded",z[z.Unloading=3]="Unloading",z))(L||{}),I=(z=>(z[z.Disabled=0]="Disabled",z[z.Enabling=1]="Enabling",z[z.Enabled=2]="Enabled",z[z.Disabling=3]="Disabling",z))(I||{});const W=/^addon\.([^.]+)(?:\.|$)/i;function x(z){return W.exec(z)?.[1]}B(x,"extractAddonId");const m=(g=class extends K.default{constructor(C,y,a){if(!y&&C instanceof g&&(y=C,C=void 0),super(C,y),this.load_dependents=null,this.dependents=null,this.references=null,this.__modules=y?y.__modules:{},this.children={},y?.__addon_id)this.__addon_id=y.__addon_id,this.__addon_root=y.__addon_root;else if(a){const F=x(this.__path);F&&(this.__addon_id=F,this.__addon_root=this)}y&&!y.children[this.name]&&(y.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this);let v=!!this.onLoad;if(!v){const F=this.__get_load_requires();v=Array.isArray(F)&&F.length>0}this.__load_state=v?0:2,this.__state=v||this.onEnable?0:2,this._time("instance"),this.emit(":registered",this)}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===2}get loading(){return this.__load_state===1}get enabled(){return this.__state===2}get enabling(){return this.__state===1}get addon_id(){return this.__addon_id}get addon_root(){return this.__addon_root}get addon_manifest(){if(this.__addon_id)return this.resolve("addons")?.getAddon(this.__addon_id)??this.__addon_root?.constructor?.info??void 0}get log(){return this.__log||(this.__log=this.parent&&this.parent.log?.get?.(this.name)),this.__log}set log(C){this.__log=C}_time(C){this.root.timing&&(typeof C!="object"&&(C={event:C}),C.module=this.__path||"core",this.root.timing.addEvent(C))}load(){return this.__load(this.__path,[])}unload(){return this.__unload(this.__path,[])}enable(){return this.__enable(this.__path,[])}disable(){return this.__disable(this.__path,[])}canUnload(){return this.__canUnload(this.__path,[])}canDisable(){return this.__canDisable(this.__path,[])}__load(C,y){const a=this.__path||this.name,v=this.__load_state;if(y.includes(this))return Promise.reject(new r(`cyclic load requirements when loading ${C}`,[...y,this]));if(this.load_requires)for(const F of this.load_requires){const A=this.__resolve(F);if(A instanceof g&&y.includes(A))return Promise.reject(new r(`cyclic load requirements when loading ${C}`,[...y,this,A]))}return y.push(this),v===1?this.__load_promise:v===2?Promise.resolve():v===3?Promise.reject(new f(`attempted to load module ${a} while module is being unloaded`)):(this._time("load-start"),this.__load_state=1,this.__load_promise=(async()=>{if(this.load_requires){const F=[];for(const A of this.load_requires){const D=this.__resolve(A);if(!D||!(D instanceof g))throw new f(`cannot find required module ${A} when loading ${a}`);F.push(D.__enable(C,Array.from(y)))}await Promise.all(F)}if(this.onLoad)return this._time("load-self"),this.onLoad()})().then(F=>(this.__load_state=2,this.__load_promise=null,this._time("load-end"),this.emit(":loaded",this),F)).catch(F=>{throw this.__load_state=0,this.__load_promise=null,this._time("load-end"),F}))}__canUnload(C,y){const a=this.__path||this.name,v=this.__load_state;if(y.includes(this))throw new r(`cyclic load requirements when checking if can unload ${C}`,[...y,this]);if(this.load_dependents){y.push(this);for(const F of this.load_dependents){const A=this.__resolve(F);if(A instanceof g){if(y.includes(A))throw new r(`cyclic load requirements when checking if can unload ${C}`,[...y,this,A]);if(!A.__canUnload(C,Array.from(y)))return!1}}}return v===3||v===0?!0:this.onLoad&&!this.onUnload?!1:v!==1}__unload(C,y){const a=this.__path||this.name,v=this.__load_state;if(y.includes(this))return Promise.reject(new r(`cyclic load requirements when unloading ${C}`,[...y,this]));if(this.load_dependents)for(const F of this.load_dependents){const A=this.__resolve(F);if(A instanceof g&&y.includes(A))return Promise.reject(new r(`cyclic load requirements when unloading ${C}`,[...y,this,A]))}return y.push(this),v===3?this.__load_promise:v===0?Promise.resolve():this.onLoad&&!this.onUnload?Promise.reject(new f(`attempted to unload module ${a} but module cannot be unloaded`)):v===1?Promise.reject(new f(`attempted to unload module ${a} while module is being loaded`)):(this._time("unload-start"),this.__load_state=3,this.__load_promise=(async()=>{if(this.__state!==0&&await this.disable(),this.load_dependents){const F=[];for(const A of this.load_dependents){const D=this.__resolve(A);!D||!(D instanceof g)||F.push(D.__unload(C,Array.from(y)))}await Promise.all(F)}if(this._time("unload-self"),this.onUnload)return this.onUnload()})().then(F=>(this.__load_state=0,this.__load_promise=null,this._time("unload-end"),this.emit(":unloaded",this),F)).catch(F=>{throw this.__load_state=2,this.__load_promise=null,this._time("unload-end"),F}))}__enable(C,y){const a=this.__path||this.name,v=this.__state;if(y.includes(this))return Promise.reject(new r(`cyclic requirements when enabling ${C}`,[...y,this]));if(this.requires)for(const F of this.requires){const A=this.__resolve(F);if(A instanceof g&&y.includes(A))return Promise.reject(new r(`cyclic requirements when enabling ${C}`,[...y,this,A]))}return y.push(this),v===1?this.__state_promise:v===2?Promise.resolve():v===3?Promise.reject(new f(`attempted to enable module ${a} while module is being disabled`)):(this._time("enable-start"),this.__state=1,this.__state_promise=(async()=>{const F=[],A=this.requires,D=this.__load_state;if(D===3)throw new f(`attempted to load module ${a} while module is being unloaded`);if((D===1||D===0)&&F.push(this.load()),A)for(const O of A){const J=this.__resolve(O);if(!J||!(J instanceof g))throw new f(`cannot find required module ${O} when enabling ${a}`);F.push(J.__enable(C,Array.from(y)))}if(await Promise.all(F),this.onEnable)return this._time("enable-self"),this.onEnable()})().then(F=>(this.__state=2,this.__state_promise=null,this._time("enable-end"),this.emit(":enabled",this),F)).catch(F=>{throw this.__state=0,this.__state_promise=null,this._time("enable-end"),F}))}__canDisable(C,y){const a=this.__path||this.name,v=this.__state;if(y.includes(this))throw new r(`cyclic load requirements when checking if can disable ${C}`,[...y,this]);if(this.dependents){y.push(this);for(const F of this.dependents){const A=this.__resolve(F);if(A&&A instanceof g){if(y.includes(A))throw new r(`cyclic load requirements when checking if can disable ${C}`,[...y,this,A]);if(!A.__canDisable(C,Array.from(y)))return!1}}}if(v===3||v===0)return!0;if(this.onDisable){if(v===1)return!1}else return!1;return!0}__disable(C,y){const a=this.__path||this.name,v=this.__state;if(y.includes(this))return Promise.reject(new r(`cyclic requirements when disabling ${C}`,[...y,this]));if(this.dependents)for(const F of this.dependents){const A=this.__resolve(F);if(A instanceof g&&y.includes(A))return Promise.reject(new r(`cyclic requirements when disabling ${C}`,[...y,this,A]))}if(y.push(this),v===3)return this.__state_promise;if(v===0)return Promise.resolve();if(this.onDisable){if(v===1)return Promise.reject(new f(`attempted to disable module ${a} but module is being enabled`))}else return Promise.reject(new f(`attempted to disable module ${a} but module cannot be disabled`));return this._time("disable-start"),this.__state=3,this.__state_promise=(async()=>{if(this.__load_state!==2)throw new f(`attempted to disable module ${a} but module is unloaded -- weird state`);if(this.dependents){const F=[];for(const A of this.dependents){const D=this.__resolve(A);!D||!(D instanceof g)||F.push(D.__disable(C,Array.from(y)))}await Promise.all(F)}if(this.onDisable)return this._time("disable-self"),this.onDisable()})().then(F=>(this.__state=0,this.__state_promise=null,this._time("disable-end"),this.emit(":disabled",this),F)).catch(F=>{throw this.__state=2,this.__state_promise=null,this._time("disable-end"),F})}on(C,y,a,v,F=!1){return super.on(C,y,a===void 0?this:a,v,F)}once(C,y,a,v,F=!1){return super.once(C,y,a===void 0?this:a,v,F)}many(C,y,a,v,F,A=!1){return super.many(C,y,a,v===void 0?this:v,F,A)}waitFor(C,y,a,v=!1){return super.waitFor(C,y===void 0?this:y,a,v)}off(C,y,a){return super.off(C,y,a===void 0?this:a)}__resolve(C){return C instanceof g?C:this.__modules[this.abs_path(C)]}resolve(C){let y=this.__resolve(C);return y instanceof g?(this.__processModule&&(y=this.__processModule(y)),y):null}hasModule(C){return this.__modules[this.abs_path(C)]instanceof g}__get_requires(){return(0,P.has)(this,"requires")?this.requires:(0,P.has)(this.constructor,"requires")?this.constructor.requires:null}__get_load_requires(){return(0,P.has)(this,"load_requires")?this.load_requires:(0,P.has)(this.constructor,"load_requires")?this.constructor.load_requires:null}__processModule(C){if(this.__addon_id&&C.getAddonProxy){const y=this.__addon_id;if(C.__proxies||(C.__proxies={}),C.__proxies[y])return C.__proxies[y];const a=this.__resolve("addons")?.getAddon?.(y),v=C.getAddonProxy(y,a,this.__addon_root??this,this);return v!==C&&(C.__proxies[y]=v),v}return C}inject(C,y,a=!0){(C instanceof g||C&&C.prototype instanceof g)&&(a=y??!0,y=C,C=null);const v=this.requires=this.__get_requires()||[];if(y instanceof g)C||(C=y.constructor.name.toSnakeCase());else if(y&&y.prototype instanceof g)C||(C=y.name.toSnakeCase()),y=this.register(C,y);else if(C){const F=C;if(C=C.replace(/^(?:[^.]*\.)+/,""),y=this.__resolve(F),!y||!(y instanceof g))return y?y[2].push([this.__path,C]):this.__modules[this.abs_path(F)]=[[],[],[[this.__path,C]]],v.push(this.abs_path(F)),this[C]=null}else throw new TypeError("must provide a valid module name or class");if(!y)throw new Error(`cannot find module ${C} or no module provided`);return a&&v.push(y.abs_path(".")),this.enabled&&!y.enabled&&y.enable(),y.references.push([this.__path,C]),y instanceof g&&this.__processModule&&(y=this.__processModule(y)),this[C]=y}injectAs(C,y,a,v=!0){(y instanceof g||y&&y.prototype instanceof g)&&(v=a??!0,a=y,y=null);const F=this.requires=this.__get_requires()||[];if(a instanceof g)y||(y=a.constructor.name.toSnakeCase());else if(a&&a.prototype instanceof g)y||(y=a.name.toSnakeCase()),a=this.register(y,a);else if(y){const A=y;if(y=y.replace(/^(?:[^.]*\.)+/,""),a=this.__resolve(A),!a||!(a instanceof g))return a?a[2].push([this.__path,C]):this.__modules[this.abs_path(A)]=[[],[],[[this.__path,C]]],F.push(this.abs_path(A)),this[C]=null}else throw new TypeError("must provide a valid module name or class");if(!a)throw new Error(`cannot find module ${y} or no module provided`);return v&&F.push(a.abs_path(".")),this.enabled&&!a.enabled&&a.enable(),a.references.push([this.__path,C]),this.__processModule&&(a=this.__processModule(a)),this[C]=a}register(C,y,a=!1){C.prototype instanceof g&&(a=y,y=C,C=y.name.toSnakeCase());const v=this.abs_path(`.${C}`),F=y.prototype,A=this.__modules[v];if(!(F instanceof g))throw new TypeError(`Module ${C} is not subclass of Module.`);if(A instanceof g)throw new f(`Name Collision for Module ${v}`);const D=A||[[],[],[]];let O=this.__modules[v]=new y(C,this);const J=O.requires=O.__get_requires()||[],G=O.load_requires=O.__get_load_requires()||[];O.dependents=D[0],O.load_dependents=D[1],O.references=D[2];for(const V of J){const q=O.abs_path(V),re=this.__modules[q];re?Array.isArray(re)?re[0].push(v):re.dependents.push(v):this.__modules[q]=[[v],[],[]]}for(const V of G){const q=O.abs_path(V),re=this.__modules[q];re?Array.isArray(re)?re[1].push(v):re.load_dependents.push(v):this.__modules[q]=[[],[v],[]]}for(const[V,q]of D[2]){const re=this.__resolve(V);re&&!Array.isArray(re)?re[q]=O:this.log.warn(`Unable to find module "${V}" that wanted "${q}".`)}return this.__processModule&&(O=this.__processModule(O)),a&&(this[C]=O),O}async loadFromContext(C,y){y=y??this.log;const a={};for(const v of C.keys()){const F=await C(v),A=F.module||F.default,D=v.lastIndexOf("."),O=D>2?v.slice(2,D):v,J=O.endsWith("/index")?O.slice(0,-6):O;try{a[J]=this.register(J,A)}catch(G){y&&G instanceof Error&&(y.capture(G,{extra:{module:J,path:v}}),y.warn(G,`Skipping ${v}`))}}return a}},B(g,"_Module2"),g);m.buildAddonProxy=d;let b=m;const c=b;function d(z,C,y,a,v,F){const A={get(D,O,J){let G=a[O];if(G!==void 0)return typeof G=="function"?G.bind(D):G;const V=v&&v[O];return z?.log&&V&&z.log.warn(`[DEV-CHECK] Accessed ${y}.${O} directly. ${typeof V=="string"?V:""}`),G=D[O],typeof G=="function"?G.bind(D):z&&G instanceof b?z.resolve(G):Reflect.get(D,O,J)}};return F?A:new Proxy(C,A)}B(d,"buildAddonProxy");const u=class u extends Error{};B(u,"ModuleError");let f=u;const w=class w extends f{constructor(C,y){super(`${C} (${y.map(a=>a.path).join(" => ")})`),this.modules=y}};B(w,"CyclicDependencyError");let r=w},46949:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{Mutex:()=>C,SourcedSet:()=>Oe,TicketLock:()=>z,TimeoutError:()=>u,TranslatableError:()=>m,addWordSeparators:()=>le,array_equals:()=>v,b64ToArrayBuffer:()=>Ie,debounce:()=>y,deep_copy:()=>q,deep_equals:()=>F,escape_regex:()=>ie,fetchJSON:()=>it,generateHex:()=>Be,generateUUID:()=>x,get:()=>G,getTwitchEmoteSrcSet:()=>I,getTwitchEmoteURL:()=>L,glob_to_regex:()=>oe,has:()=>d,importRsaKey:()=>Ye,isValidShortcut:()=>W,makeAddonIdChecker:()=>ae,make_enum:()=>r,make_enum_flags:()=>g,map_equals:()=>D,matchScreen:()=>c,maybe_call:()=>fe,normalizeAddonIdForComparison:()=>re,once:()=>a,pick_random:()=>ne,set_equals:()=>O,sha256:()=>b,shallow_copy:()=>V,shallow_object_equals:()=>A,sleep:()=>f,split_chars:()=>Pe,substr_count:()=>J,timeout:()=>w,truncate:()=>we});var K=S(24431);const P=Object.prototype.hasOwnProperty;function L(ye,ue,xe=!1,Re=!0){return`${K.TWITCH_EMOTE_V2}/${ye}/${xe?"default":"static"}/${Re?"dark":"light"}/${ue==4?3:ue}.0`}B(L,"getTwitchEmoteURL");function I(ye,ue=!1,xe=!0,Re=!1){return Re?`${L(ye,2,ue,xe)} 1x, ${L(ye,4,ue,xe)} 2x`:`${L(ye,1,ue,xe)} 1x, ${L(ye,2,ue,xe)} 2x, ${L(ye,4,ue,xe)} 4x`}B(I,"getTwitchEmoteSrcSet");function W(ye){return ye?(ye=ye.toLowerCase().trim(),!K.BAD_HOTKEYS.includes(ye)):!1}B(W,"isValidShortcut");const x=crypto.randomUUID?()=>crypto.randomUUID():B(function ye(ue){return ue?(ue^Math.random()*16>>ue/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,ye)},"generateUUID2"),wt=class wt extends Error{constructor(ue,xe,Re){super(ue),this.i18n_key=xe,this.data=Re}toString(){const ue=window.FrankerFaceZ?.get(),xe=ue?.resolve("i18n");return xe&&this.i18n_key?xe.t(this.i18n_key,this.message,this.data):this.message}};B(wt,"TranslatableError");let m=wt;async function b(ye){const ue=new TextEncoder().encode(ye),xe=await crypto.subtle.digest("SHA-256",ue);return Array.from(new Uint8Array(xe)).map(Ze=>Ze.toString(16).padStart(2,"0")).join("")}B(b,"sha256");function c(ye,ue){let xe,Re=0;for(let He=0;He<ye.length;He++){const Ze=ye[He];if(Ze.label!==ue.label)continue;let qe=1;ue.left&&ue.left===Ze.left&&(qe+=15),ue.top&&ue.top===Ze.top&&(qe+=15),ue.width&&ue.width===Ze.width&&(qe+=10),ue.height&&ue.height===Ze.height&&(qe+=10),ue.index&&(qe-=Math.abs(ue.index-He)),qe>Re&&(xe=Ze,Re=qe)}return xe}B(c,"matchScreen");function d(ye,ue){return ye?P.call(ye,ue):!1}B(d,"has");function f(ye){return new Promise(ue=>setTimeout(ue,ye))}B(f,"sleep");function r(...ye){const ue={};for(let xe=0,Re=ye.length;xe<Re;xe++){const He=ye[xe];ue[He]=xe,ue[xe]=He}return ue}B(r,"make_enum");function g(...ye){const ue={};ue.None=0,ue[0]="None";for(let xe=0,Re=ye.length;xe<Re;xe++){const He=ye[xe],Ze=Math.pow(2,xe);ue[He]=Ze,ue[Ze]=He}return ue}B(g,"make_enum_flags");const zt=class zt extends Error{constructor(ue){super(ue??"timeout")}};B(zt,"TimeoutError");let u=zt;function w(ye,ue){return new Promise((xe,Re)=>{let He=!1;const Ze=setTimeout(()=>{He||(He=!0,Re(new u))},ue);ye.then(qe=>{He||(He=!0,clearTimeout(Ze),xe(qe))}).catch(qe=>{He||(He=!0,clearTimeout(Ze),Re(qe))})})}B(w,"timeout");const Ht=class Ht{constructor(ue=1){this.limit=ue,this.__active=0,this.__waiting=[]}get available(){return this.__active<this.limit}__done(){for(this.__active--;this.__active<this.limit&&this.__waiting.length>0;){this.__active++;const ue=this.__waiting.shift();ue&&ue(this.__getTicket())}}__getTicket(){let ue=!0;return()=>{ue&&(ue=!1,this.__done())}}wait(){return this.__active<this.limit?(this.__active++,Promise.resolve(this.__getTicket())):new Promise(ue=>this.__waiting.push(ue))}};B(Ht,"TicketLock");let z=Ht;const C=z;function y(ye,ue,xe=!1){let Re;if(xe){const He=B(()=>Re=null,"later");return xe===2?B(function(...qe){Re?(clearTimeout(Re),Re=setTimeout(()=>{Re=null,ye.apply(this,qe)},ue)):(ye.apply(this,qe),Re=setTimeout(He,ue))},"debouncedFunction"):function(...Ze){Re?clearTimeout(Re):ye.apply(this,Ze),Re=setTimeout(He,ue)}}return function(...He){Re&&clearTimeout(Re),Re=setTimeout(ye.bind(this,...He),ue)}}B(y,"debounce");function a(ye){let ue;return B(function(...Re){if(ue)return ue;try{ue=Promise.resolve(ye.call(this,...Re))}catch(He){return Promise.reject(He)}return ue.finally(()=>ue=void 0)},"onceFunction")}B(a,"once");function v(ye,ue){if(!Array.isArray(ye)||!Array.isArray(ue)||ye.length!==ue.length)return!1;let xe=ye.length;for(;xe--;)if(ye[xe]!==ue[xe])return!1;return!0}B(v,"array_equals");function F(ye,ue,xe=!1,Re,He){if(ye===ue)return!0;if(typeof ye!=typeof ue||typeof ye!="object"||ye===null!=(ue===null))return!1;if(Re||(Re=new Set),He||(He=new Set),Re.has(ye)||He.has(ue))throw new Error("recursive structure detected");Re.add(ye),He.add(ue);const Ze=Object.keys(ye),qe=Object.keys(ue);if(!xe&&!O(new Set(Ze),new Set(qe)))return!1;for(const st of Ze)if(!F(ye[st],ue[st],xe,new Set(Re),new Set(He)))return!1;if(xe){for(const st of qe)if(!Ze.includes(st)&&!F(ye[st],ue[st],xe,new Set(Re),new Set(He)))return!1}return!0}B(F,"deep_equals");function A(ye,ue){if(typeof ye!="object"||typeof ue!="object")return!1;const xe=Object.keys(ye);if(!O(new Set(xe),new Set(Object.keys(ue))))return!1;for(const Re of xe)if(ye[Re]!==ue[Re])return!1;return!0}B(A,"shallow_object_equals");function D(ye,ue){if(!(ye instanceof Map)||!(ue instanceof Map)||ye.size!==ue.size)return!1;for(const[xe,Re]of ye)if(!ue.has(xe)||ue.get(xe)!==Re)return!1;return!0}B(D,"map_equals");function O(ye,ue){if(!(ye instanceof Set)||!(ue instanceof Set)||ye.size!==ue.size)return!1;for(const xe of ye)if(!ue.has(xe))return!1;return!0}B(O,"set_equals");function J(ye,ue){let xe=0,Re=0;for(;Re<ye.length;){const He=ye.indexOf(ue,Re);if(He===-1)break;xe++,Re=He+1}return xe}B(J,"substr_count");function G(ye,ue){let xe=ye;if(typeof xe=="string"){if(P.call(ue,xe))return ue[xe];xe=xe.split(".")}for(let Re=0,He=xe.length;Re<He;Re++){const Ze=xe[Re];if(Ze==="@each"){const qe=xe.slice(Re+1);if(qe.length)if(Array.isArray(ue))ue=ue.map(st=>G(qe,st));else{const st={};for(const xt in ue)P.call(ue,xt)&&(st[xt]=G(qe,ue[xt]));ue=st}break}else Ze==="@last"?ue=ue[ue.length-1]:ue=ue[Ze];if(!ue)break}return ue}B(G,"get");function V(ye,ue=2,xe){if(ye==null)return ye;if(ye instanceof Promise||typeof ye=="function")return null;if(typeof ye!="object")return ye;if(ue===0)return null;if(xe||(xe=new Set),xe.add(ye),Array.isArray(ye)){const He=[];for(const Ze of ye)xe.has(Ze)||He.push(V(Ze,ue-1,new Set(xe)));return He}const Re={};for(const[He,Ze]of Object.entries(ye))xe.has(Ze)||(Re[He]=V(Ze,ue-1,new Set(xe)));return Re}B(V,"shallow_copy");function q(ye,ue){if(ye===null)return null;if(ye===void 0)return;if(ye instanceof Promise)return new Promise((Re,He)=>ye.then(Re).catch(He));if(typeof ye=="function")return function(...Re){return ye.apply(this,Re)};if(ye instanceof RegExp)return new RegExp(ye.source,ye.flags);if(ye instanceof Date)return new Date(ye);if(typeof ye!="object")return ye;if(ue||(ue=new Set),ue.has(ye))throw new Error("recursive structure detected");if(ue.add(ye),Array.isArray(ye))return ye.map(Re=>q(Re,new Set(ue)));if(ye instanceof Set){const Re=new Set;for(const He of ye)typeof He=="object"?Re.add(q(He)):Re.add(He);return Re}if(ye instanceof Map){const Re=new Map;for(const[He,Ze]of ye.entries()){let qe=typeof He=="object"?q(He):He,st=typeof Ze=="object"?q(Ze):Ze;Re.set(qe,st)}return Re}const xe={};for(const[Re,He]of Object.entries(ye))typeof He=="object"?xe[Re]=q(He,new Set(ue)):xe[Re]=He;return xe}B(q,"deep_copy");function re(ye){return ye.toLowerCase().replace(/[\.\_\-]+/,"-")}B(re,"normalizeAddonIdForComparison");function ae(ye){return ye=ie(re(ye)),ye=ye.replace(/-+/g,"[._-]+"),ye=ye.replace(/\bbttv\b/g,"(?:bttv|betterttv)"),ye=ye.replace(/\b7tv\b/g,"(?:7tv|seventv)"),ye=ye.replace(/\bpronouns\b/g,"(?:pronouns|addon-pn)"),new RegExp("\\b"+ye+"\\b","i")}B(ae,"makeAddonIdChecker");function fe(ye,ue,...xe){return typeof ye=="function"?ue?ye.call(ue,...xe):ye(...xe):ye}B(fe,"maybe_call");const be=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function Pe(ye){return ye===""?[]:ye.match(be)}B(Pe,"split_chars");function ne(ye){if(!ye)return null;if(!Array.isArray(ye)){const ue=Object.keys(ye);return ye[ne(ue)]}return ye[Math.floor(Math.random()*ye.length)]}B(ne,"pick_random");const ie=B(function(ue){return ue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},"escape_regex2");function le(ye){return`(^|.*?${K.WORD_SEPARATORS})(?:${ye})(?=$|${K.WORD_SEPARATORS})`}B(le,"addWordSeparators");const ze="/$^+.()=!|";function oe(ye){if(typeof ye!="string")throw new TypeError("input must be a string");let ue="",xe=0;for(let Re=0,He=ye.length;Re<He;Re++){const Ze=ye[Re];if(ze.includes(Ze))ue+=`\\${Ze}`;else if(Ze==="\\"){Re++;const qe=ye[Re];qe&&(ze.includes(qe)?ue+=`\\${qe}`:ue+=qe)}else if(Ze==="?")ue+=".";else if(Ze==="[")ue+=Ze,ye[Re+1]==="!"&&(Re++,ue+="^");else if(Ze==="]")ue+=Ze;else if(Ze==="{")ue+="(?:",xe++;else if(Ze==="}")xe>0&&(ue+=")",xe--);else if(Ze===","&&xe>0)ue+="|";else if(Ze==="*"){let qe=1;for(;ye[Re+1]==="*";)qe++,Re++;qe>1?ue+=".*?":ue+="[^\\s]*?"}else ue+=Ze}return ue}B(oe,"glob_to_regex");function we(ye,ue=100,xe=15,Re="\u2026",He=!0,Ze=!0){if(!ye||!ye.length)return ye;Ze&&(ye=ye.trim());let qe=He?ye.indexOf(`
`):-1;if((qe===-1||qe>ue)&&(qe=ue),ye.length<=qe)return ye;let st=ye.slice(0,qe).trimEnd();if(xe>0&&st.length>=qe){let xt=ye.slice(qe).search(/\s+/);if(xt===-1&&xe+qe>ye.length&&(xt=ye.length-qe),xt!==-1&&xt<=xe){if(ye.length<=qe+xt)return ye;st=ye.slice(0,qe+xt)}}return st+Re}B(we,"truncate");function Te(ye){return ye.toString(16).padStart(2,"0")}B(Te,"decimalToHex");function Be(ye=40){const ue=new Uint8Array(ye/2);return window.crypto.getRandomValues(ue),Array.from(ue,Te).join("")}B(Be,"generateHex");const Wt=class Wt{constructor(ue=!1,xe){this._use_set=ue,this._cache=ue?new Set:[],this._sourceSortFn=xe}resortSources(){this._sorted_sources=null,this._sources&&this._sources.size>1&&this._rebuild()}setSortFunction(ue){this._sourceSortFn!==ue&&(this._sourceSortFn=ue,this.resortSources())}_sortSources(){if(!this._sources||this._sources.size===0){this._sorted_sources=[];return}if(this._sources.size===1||!this._sourceSortFn){this._sorted_sources=[...this._sources.values()];return}const ue=[...this._sources?.entries()];ue.sort((xe,Re)=>this._sourceSortFn(xe[0],Re[0])),this._sorted_sources=ue.map(xe=>xe[1])}_rebuild(){if(!this._sources)return;const ue=this._use_set,xe=this._cache=ue?new Set:[];this._sorted_sources||this._sortSources();for(const Re of this._sorted_sources)for(const He of Re)ue?xe.add(He):xe.includes(He)||xe.push(He)}get(ue){return this._sources&&this._sources.get(ue)}has(ue){return this._sources?this._sources.has(ue):!1}*iterateSources(){if(this._sources)for(const ue of this._sources)yield ue}sourceIncludes(ue,xe){const Re=this._sources&&this._sources.get(ue);return Re&&Re.includes(xe)}includes(ue){return this._use_set?this._cache.has(ue):this._cache.includes(ue)}delete(ue){this._sources&&this._sources.has(ue)&&(this._sources.delete(ue),this._sorted_sources=null,this._rebuild())}extend(ue,...xe){this._sources||(this._sources=new Map);const Re=this._sources.get(ue);if(Re)for(const Ze of xe)Re.includes(Ze)||Re.push(Ze);else this._sources.set(ue,xe),this._sorted_sources=null;if(this._sourceSortFn!=null&&this._sources.size>1)this._rebuild();else{const Ze=this._use_set,qe=this._cache;for(const st of xe)Ze?qe.add(st):qe.includes(st)||qe.push(st)}}set(ue,xe){if(Array.isArray(xe)||(xe=[xe]),!xe.length)return this.delete(ue);this._sources||(this._sources=new Map);const Re=this._sources.has(ue);this._sources.set(ue,xe),this._sorted_sources=null;const He=this._sourceSortFn!=null&&this._sources.size>1;if(Re||He)this._rebuild();else{const Ze=this._use_set,qe=this._cache;for(const st of xe)Ze?qe.add(st):qe.includes(st)||qe.push(st)}}push(ue,xe){if(!this._sources)return this.set(ue,xe);const Re=this._sources.get(ue);if(Re?.length){if(Re.includes(xe))return}else return this.set(ue,xe);Re.push(xe),this._sourceSortFn!=null&&this._sources.size>1?this._rebuild():this._use_set?this._cache.add(xe):this._cache.includes(xe)||this._cache.push(xe)}remove(ue,xe){if(!this._sources||!this._sources.has(ue))return;const Re=this._sources.get(ue),He=Re?Re.indexOf(xe):-1;He!==-1&&(Re.splice(He,1),this._rebuild())}};B(Wt,"SourcedSet");let Oe=Wt;function Ie(ye){const ue=atob(ye),xe=ue.length,Re=new ArrayBuffer(xe),He=new Uint8Array(Re);for(let Ze=0,qe=ue.length;Ze<qe;Ze++)He[Ze]=ue.charCodeAt(Ze);return Re}B(Ie,"b64ToArrayBuffer");const Ve=/-----BEGIN (.+?) KEY-----/,Ke=/-----END (.+?) KEY-----/;function Ye(ye,ue=["verify"]){const xe=Ve.exec(ye),Re=Ke.exec(ye);if(!xe||!Re||xe[1]!==Re[1])throw new Error("invalid key");const He=/\bPRIVATE\b/i.test(xe[1]),Ze=xe.index+xe[0].length,qe=Re.index,st=ye.slice(Ze,qe).replace(/\n/g,"").trim(),xt=Ie(st);return crypto.subtle.importKey(He?"pkcs8":"spki",xt,{name:"RSA-PSS",hash:"SHA-256"},!0,ue)}B(Ye,"importRsaKey");function it(ye,ue,xe=null){return fetch(ye,ue).then(Re=>Re.ok?Re.json():null).catch(()=>xe)}B(it,"fetchJSON")},20857:(ge,te,S)=>{"use strict";S.d(te,{Q:()=>K});function K(I){return P({path:I,i:0})}B(K,"parse");function P(I){const W=I.path,x=W.length,m=[];let b=null,c=null,d=!1,f=!1;for(;I.i<x;){const r=I.i,g=W[r],u=W[r+1];if(b||(b={}),c||(c=""),g==="@"&&u==="{"){I.i++;const y=L(I);y&&Object.assign(b,y);continue}const w=g==="~"&&u===">",z=g===">"&&u===">";if(!(!z&&g===">")&&!z&&!w){c+=g,I.i++;continue}(w||z)&&I.i++,b.title=c.trim(),b.key=b.title.toSnakeCase(),b.page=f,b.tab=d,f=z,d=w,m.push(b),b=c=null,I.i++}return b&&c&&(b.title=c.trim(),b.key=b.title.toSnakeCase(),b.page=f,b.tab=d,m.push(b)),m}B(P,"parseAST");function L(I){const W=I.path,x=W.length,m=I.i;I.i++;const b=["{"];let c=!1;for(;I.i<x&&b.length;){const d=I.i,f=W[d];if(c){if(f==="\\"){I.i++;continue}(f==='"'||f==="'")&&f===c&&(b.pop(),c=!1)}else{if((f==='"'||f==="'")&&(c=f,b.push(f)),(f==="{"||f==="[")&&b.push(f),f==="]"&&b.pop()!=="[")throw new SyntaxError("Invalid JSON");if(f==="}"&&b.pop()!=="{")throw new SyntaxError("Invalid JSON")}I.i++}return JSON.parse(W.slice(m,I.i))}B(L,"parseJSON")},83269:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{durationForChat:()=>I,durationForURL:()=>W,duration_to_string:()=>P,getBuster:()=>K,print_duration:()=>L});function K(x=5){const m=Math.floor(Date.now()/1e3);return m-m%x}B(K,"getBuster");function P(x,m,b,c,d){const f=x%60;let r=Math.floor(x/60),g=Math.floor(r/60),u="";if(r=r%60,m){const z=Math.floor(g/24);if(g=g%24,b&&z>0)return`${u} days`;u=z>0?`${z} days, `:""}const w=c===!1||u?.length>0||g>0;return`${u}${w?`${u&&g<10?"0":""}${g}:`:""}${w&&r<10?"0":""}${r}${d?"":`:${f<10?"0":""}${f}`}`}B(P,"duration_to_string");function L(x){let m=Math.floor(x/60);const b=Math.floor(m/60);return m%=60,x%=60,`${b>0?`${b}:${m<10?"0":""}`:""}${m}:${x<10?"0":""}${x}`}B(L,"print_duration");function I(x){const m=x%60;let b=Math.floor(x/60),c=Math.floor(b/60);const d=Math.floor(c/24);return b=b%60,c=c%24,`${d>0?`${d}d`:""}${c>0?`${c}h`:""}${b>0?`${b}m`:""}${m>0?`${m}s`:""}`}B(I,"durationForChat");function W(x){const m=x%60;let b=Math.floor(x/60);const c=Math.floor(b/60);return b=b%60,`${c>0?`${c}h`:""}${b>0?`${b}m`:""}${m>0?`${m}s`:""}`}B(W,"durationForURL")},8528:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{DefaultOptions:()=>x,NoContent:()=>W,Tooltip:()=>m,default:()=>b,makeReference:()=>d,normalizeModifiers:()=>c});var K=S(44589),P=S(46949),L=S(78224);let I=0;const W=Symbol("NoContent"),x={html:!1,delayShow:0,delayHide:0,live:!0,tooltipClass:"ffz__tooltip",innerClass:"ffz__tooltip--inner",arrowClass:"ffz__tooltip--arrow"},r=class r{constructor(u,w,z){if(this.shift_state=!1,this.ctrl_state=!1,typeof u=="string"&&(u=document.querySelector(u)),!(u instanceof HTMLElement))throw new TypeError("invalid parent");if(this.options=Object.assign({},x,z),this.live=this.options.live,this.parent=u,this.container=this.options.container||this.parent,this.cls=w,this.options.check_modifiers&&this.installModifiers(),this.live)this.cls=w,this.elements=new Set;else{let C;if(typeof w=="string")C=Array.from(u.querySelectorAll(w));else if(Array.isArray(w))C=w;else if(w instanceof HTMLElement)C=[w];else throw new TypeError("invalid elements");this.elements=new Set(C)}if(this._accessor=`_ffz_tooltip$${I++}`,this._onMouseOut=C=>{const y=C.target;if(y&&y.dataset?.forceOpen!=="true")return this._exit(y)},!this.options.manual)if(this.live)this._onMouseOver=C=>{this.updateShift(C.shiftKey,C.ctrlKey);const y=C.target;y&&y.classList&&y.classList.contains(this.cls)&&y.dataset?.forceOpen!=="true"&&this._enter(y)},u.addEventListener("mouseover",this._onMouseOver),u.addEventListener("mouseout",this._onMouseOut);else if(this._onMouseOver=C=>{this.updateShift(C.shiftKey,C.ctrlKey);const y=C.target;this.elements.has(y)&&y.dataset.forceOpen!=="true"&&this._enter(y)},this.elements.size<=5)for(const C of this.elements)C.addEventListener("mouseenter",this._onMouseOver),C.addEventListener("mouseleave",this._onMouseOut);else u.addEventListener("mouseover",this._onMouseOver),u.addEventListener("mouseout",this._onMouseOut)}destroy(){if(this.removeModifiers(),!this.options.manual)if(this.live||this.elements.size>5)this._onMouseOver&&this.parent.removeEventListener("mouseover",this._onMouseOver),this.parent.removeEventListener("mouseout",this._onMouseOut);else for(const u of this.elements)this._onMouseOver&&u.removeEventListener("mouseenter",this._onMouseOver),u.removeEventListener("mouseleave",this._onMouseOut);for(const u of this.elements){const w=u[this._accessor];w&&w.visible&&this.hide(w),u[this._accessor]=null,u._ffz_tooltip=null}this.elements=null,this._onMouseOut=this._onMouseOver=null,this.container=null,this.parent=null}installModifiers(){this._keyUpdate||(this._keyUpdate=u=>this.updateShift(u.shiftKey,u.ctrlKey),window.addEventListener("keydown",this._keyUpdate),window.addEventListener("keyup",this._keyUpdate))}removeModifiers(){this._keyUpdate&&(window.removeEventListener("keydown",this._keyUpdate),window.removeEventListener("keyup",this._keyUpdate),this._keyUpdate=null)}updateShift(u,w){u===this.shift_state&&w===this.ctrl_state||(this.shift_state=u,this.ctrl_state=w,this._shift_af||(this._shift_af=requestAnimationFrame(()=>{if(this._shift_af=null,this.elements)for(const z of this.elements){const C=z[this._accessor];C&&C.outer&&(C.outer.dataset.shift=`${this.shift_state}`,C.outer.dataset.ctrl=`${this.ctrl_state}`,C.update())}})))}cleanup(){if(!(this.options.manual||!this.elements))for(const u of this.elements){const w=u[this._accessor];document.body.contains(u)||w&&w.visible&&this.hide(w)}}_enter(u){let w=u[this._accessor];if(w||(w=u[this._accessor]={target:u}),w.state=!0,w._show_timer&&(clearTimeout(w._show_timer),w._show_timer=null),w.visible)return;const z=(0,P.maybe_call)(this.options.delayShow,null,u,w);z===0?this.show(w):w._show_timer=setTimeout(()=>{w._show_timer=null,w.state&&this.show(w)},z)}_exit(u){const w=u[this._accessor];if(!w||(w.state=!1,w._show_timer&&(clearTimeout(w._show_timer),w._show_timer=null),!w.visible))return;const z=(0,P.maybe_call)(this.options.delayHide,null,u,w);z===0?this.hide(w):w._show_timer=setTimeout(()=>{w._show_timer=null,w.state||this.hide(w)},z)}show(u){const w=this.options,z=u.target;this.elements.add(z),z._ffz_tooltip=u,u._wait_promise=null,u.waitForDom=()=>u.element?Promise.resolve():(u._wait_promise||(u._wait_promise=new Promise(q=>u._waiter=q)),u._wait_promise),u.update=()=>u._update(),u.show=()=>{let q=z[this._accessor];q||(q=z[this._accessor]={target:z}),this.show(q)},u.hide=()=>this.hide(u),u.rerender=()=>{u.visible&&(u.hide(),u.show())};let C=(0,P.maybe_call)(w.content,null,z,u);if(C===void 0&&(C=u.target.title),u.visible||C===W||!C&&!w.onShow)return;const y=(0,K.createElement)("div",{className:w.arrowClass,"x-arrow":!0}),a=u.element=(0,K.createElement)("div",w.innerClass),v=u.outer=(0,K.createElement)("div",{className:w.tooltipClass,"data-shift":this.shift_state,"data-ctrl":this.ctrl_state},[a,y]);if(w.arrowInner&&y.appendChild((0,K.createElement)("div",w.arrowInner)),u.align&&a.classList.add(`${w.innerClass}--align-${u.align}`),u.add_class){for(const q of Array.isArray(u.add_class)?u.add_class:[u.add_class])a.classList.add(q);u.add_class=void 0}const F=(0,P.maybe_call)(w.interactive,null,z,u),A=(0,P.maybe_call)(w.hover_events,null,z,u);v.classList.toggle("interactive",F||!1),(!w.manual||A&&(w.onHover||w.onLeave||w.onMove))&&(A&&w.onMove&&v.addEventListener("mousemove",v._ffz_move_handler=q=>{this.updateShift(q.shiftKey,q.ctrlKey),w.onMove(z,u,q)}),v.addEventListener("mouseover",v._ffz_over_handler=q=>{!w.no_auto_remove&&!document.contains(z)&&this.hide(u),A&&w.onHover&&w.onHover(z,u,q),w.manual||((0,P.maybe_call)(w.interactive,null,z,u)?this._enter(z):z.dataset.forceOpen!=="true"&&this._exit(z))}),v.addEventListener("mouseout",v._ffz_out_handler=q=>{A&&w.onLeave&&w.onLeave(z,u,q),!w.manual&&z.dataset.forceOpen!=="true"&&this._exit(z)}));const D=(0,P.maybe_call)(w.html,null,z,u),O=D?"innerHTML":"textContent",J={flip:{behavior:["top","bottom","left","right"]},offset:{offset:[0,10]},arrow:{element:y}};let G=Object.assign({modifiers:J},w.popper);G.modifiers=Object.assign(J,G.modifiers),w.popperConfig&&(G=w.popperConfig(z,u,G)??G),G.onUpdate=(0,P.debounce)(()=>{!w.no_auto_remove&&!document.contains(u.target)&&this.hide(u)},250);let V=z;w.no_update&&(V=d(z)),u._update=()=>{u.popper&&u.popper.forceUpdate()},u._waiter&&u._waiter(),u._waiter=null,u._wait_promise=null,C instanceof Promise?(a.innerHTML='<div class="ffz-i-zreknarf loader"></div>',C.then(q=>{if(!q)return this.hide(u);D&&(q instanceof Node||Array.isArray(q))?(a.innerHTML="",(0,K.setChildren)(a,q,w.sanitizeChildren)):a[O]=q,u._update()}).catch(q=>{this.options.logger&&this.options.logger.error("Error rendering tooltip content.",q),this.options.i18n?a.textContent=this.options.i18n.t("tooltip.render-error",`There was an error rendering this tooltip.
{err}`,{err:q}):a.textContent=`There was an error rendering this tooltip.
${q}`,u._update()})):C&&(D&&(C instanceof Node||Array.isArray(C))?(0,K.setChildren)(a,C,w.sanitizeChildren):a[O]=C),G.modifiers=c(G.modifiers),u.popper=(0,L.fi)(V,v,G),this.container.appendChild(v),u.visible=!0,w.onShow&&w.onShow(z,u)}hide(u){const w=this.options;if(w.onHide&&w.onHide(u.target,u),u.popper&&(u.popper.destroy(),u.popper=null),u.outer){const z=u.outer;z._ffz_over_handler&&z.removeEventListener("mouseover",z._ffz_over_handler),z._ffz_out_handler&&z.removeEventListener("mouseout",z._ffz_out_handler),z._ffz_move_handler&&z.removeEventListener("mousemove",z._ffz_move_handler),z.remove(),u.outer=z._ffz_out_handler=z._ffz_over_handler=null}this.live&&this.elements&&this.elements.delete(u.target),u.target._ffz_tooltip===u&&(u.target._ffz_tooltip=null),u.target[this._accessor]=null,u._update=u.rerender=u.update=f,u.element=null,u.visible=!1}};B(r,"Tooltip");let m=r;const b=m;function c(g){const u=[];for(const[w,z]of Object.entries(g)){const C={name:w};if(z&&typeof z=="object"&&!Array.isArray(z)){(0,P.has)(z,"enabled")&&(C.enabled=z.enabled);const y=Object.keys(z);(y.length>1||y.length===1&&y[0]!=="enabled")&&(C.options=z)}u.push(C)}return u}B(c,"normalizeModifiers");function d(g,u,w=0,z=0){let C;if(g instanceof HTMLElement){const a=g.getBoundingClientRect();C=a.x,u=a.y,w=a.height,z=a.width}else C=g;return{getBoundingClientRect:()=>({top:u,bottom:u+w,y:u,left:C,right:C+z,x:g,height:w,width:z}),clientWidth:z,clientHeight:w}}B(d,"makeReference");function f(){}B(f,"noop")},2356:(ge,te,S)=>{"use strict";S.r(te),S.d(te,{DEFAULT_FORMATS:()=>f,DEFAULT_TYPES:()=>d,TranslationCore:()=>r,default:()=>g,getCardinalName:()=>C,getOrdinalName:()=>v});var K=S(51722),P=S.n(K),L=S(92045),I=S.n(L),W=S(46949),x=S(83269),m=S(22923),b=S.n(m);P().extend(I());const c={allowTags:!1,requireOther:!1},d={tostring(A){return`${A}`},select(A,D,O,J,G,V){const q=D.o&&(D.o[A]||D.o.other);if(q)return this._processAST(q,V,O)},plural(A,D,O,J,G,V){const q=D.o&&(D.o[`=${A}`]||D.o[C(O,A)]||D.o.other);if(q)return this._processAST(q,V,O)},selectordinal(A,D,O,J,G,V){const q=D.o&&(D.o[`=${A}`]||D.o[v(O,A)]||D.o.other);if(q)return this._processAST(q,V,O)},number(A,D){if(typeof A!="number"){let O=parseFloat(A);if((isNaN(O)||!isFinite(O))&&(O=parseInt(A,10)),isNaN(O)||!isFinite(O))return A;A=O}return this.formatNumber(A,D.f)},currency(A,D){if(typeof A!="number"){let O=parseFloat(A);if((isNaN(O)||!isFinite(O))&&(O=parseInt(A,10)),isNaN(O)||!isFinite(O))return A;A=O}return this.formatCurrency(A,D.f)},date(A,D){return this.formatDate(A,D.f)},time(A,D){return this.formatTime(A,D.f)},datetime(A,D){return this.formatDateTime(A,D.f)},duration(A){return this.formatDuration(A)},localestring(A){return this.toLocaleString(A)},relativetime(A,D){return this.formatRelativeTime(A,D.f)},humantime(A,D){return this.formatRelativeTime(A,D.f)},en_plural:A=>A!==1?"s":""},f={number:{currency:{style:"currency"},percent:{style:"percent"},long_percent:{style:"percent",minimumFractionDigits:2}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},default:{},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},datetime:{short:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric"},medium:{},long:{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},F=class F{constructor(D){if(D=D||{},this.warn=D.warn,this._locale=D.locale||"en",this._dayjs_locale=D.dayjsLocale||"en",this.defaultLocale=D.defaultLocale||this._locale,this.transformation=null,this.defaultDateFormat=D.defaultDateFormat??"default",this.defaultTimeFormat=D.defaultTimeFormat??"short",this.defaultDateTimeFormat=D.defaultDateTimeFormat??"medium",this.phrases=new Map,this.cache=new Map,this.numberFormats=new Map,this.currencyFormats=new Map,this.formats=Object.assign({},f),D.formats){const O=Object.keys(D.formats);for(const J of O)this.formats[J]=Object.assign({},this.formats[J],D.formats[J])}this.types=Object.assign({},d,D.types||{}),this.parser=new(b())(Object.assign({},c,D.parserOptions)),D.phrases&&this.extend(D.phrases)}get locale(){return this._locale}set locale(D){D!==this._locale&&(this._locale=D,this.numberFormats.clear(),this.currencyFormats.clear())}toLocaleString(D){return D?.toLocaleString?D.toLocaleString(this._locale):typeof D!="string"?`${D}`:D}formatRelativeTime(D,O){const J=P()(D),G=O==="plain";try{return J.locale(this._dayjs_locale).fromNow(G)}catch{return J.fromNow(G)}}formatCurrency(D,O){let J=this.currencyFormats.get(O);return J||(J=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:O}),this.currencyFormats.set(O,J)),J.format(D)}formatNumber(D,O){let J=this.numberFormats.get(O);return J||(this.formats.number[O]?J=new Intl.NumberFormat(this.locale,this.formats.number[O]):typeof O=="number"?J=new Intl.NumberFormat(this.locale,{minimumFractionDigits:O,maximumFractionDigits:O}):J=new Intl.NumberFormat(this.locale),this.numberFormats.set(O,J)),J.format(D)}formatDuration(D){return(0,x.duration_to_string)(D)}formatDate(D,O){if(O||(O=this.defaultDateFormat),O&&!this.formats.date[O]){const J=P()(D);try{return J.locale(this._dayjs_locale).format(O)}catch{return J.format(O)}}return D instanceof Date||(D=new Date(D)),D.toLocaleDateString(this._locale,this.formats.date[O]||{})}formatTime(D,O){if(O||(O=this.defaultTimeFormat),O&&!this.formats.time[O]){const J=P()(D);try{return J.locale(this._dayjs_locale).format(O)}catch{return J.format(O)}}return D instanceof Date||(D=new Date(D)),D.toLocaleTimeString(this._locale,this.formats.time[O]||{})}formatDateTime(D,O){if(O||(O=this.defaultDateTimeFormat),O&&!this.formats.datetime[O]){const J=P()(D);try{return J.locale(this._dayjs_locale).format(O)}catch{return J.format(O)}}return D instanceof Date||(D=new Date(D)),D.toLocaleString(this._locale,this.formats.datetime[O]||{})}extend(D,O){const J=[];if(!D||typeof D!="object")return J;for(const G of Object.keys(D)){const V=O?G==="_"?O:`${O}.${G}`:G,q=D[G];if(typeof q=="object")J.push(...this.extend(q,V));else{let re;try{re=this.parser.parse(q)}catch(ae){this.warn&&this.warn(`Error parsing i18n phrase for key "${V}": ${q}`,ae);continue}this.phrases.set(V,q),this.cache.set(V,re),J.push(V)}}return J}unset(D,O){typeof D=="string"&&(D=[D]);const J=Array.isArray(D)?D:Object.keys(D);for(const G of J){const V=O?G==="_"?O:`${O}.${G}`:G;typeof D[G]=="object"?this.unset(D,V):(this.phrases.delete(V),this.cache.delete(V))}}has(D){return this.phrases.has(D)}set(D,O){const J=this.parser.parse(O);this.phrases.set(D,O),this.cache.set(D,J)}clear(){this.phrases.clear(),this.cache.clear()}replace(D){this.clear(),this.extend(D)}_preTransform(D,O,J,G={}){let V,q,re=J??{};if(typeof re=="number"&&(re={count:re}),!G.noCache&&this.phrases.has(D))V=this.cache.get(D)??[],q=this.locale;else if(!G.noCache&&this.cache.has(D))V=this.cache.get(D)??[],q=this.defaultLocale;else{let ae=null;try{ae=this.parser.parse(O)}catch(fe){if(G.throwParse)throw fe;!G.noWarn&&this.warn&&this.warn(`Error parsing i18n phrase for key "${D}": ${O}`,fe),V=["parsing error"],q=this.defaultLocale}ae?(V=ae,q=this.locale,G.noCache||(this.locale===this.defaultLocale&&this.phrases.set(D,O),this.cache.set(D,ae))):(V=[],q=this.defaultLocale)}return this.transformation&&(V=this.transformation(D,V)),[V,re,q]}t(D,O,J,G){return u(this.tList(D,O,J,G))}tList(D,O,J,G){return this._processAST(...this._preTransform(D,O,J,G))}formatNode(D,O,J,G,V){if(!D||typeof D!="object")return D;J==null&&(J=this.locale);const q=(0,W.get)(D.v,O);if(q==null)return null;if(D.t){const re=this.types[D.t];if(re)return re.call(this,q,D,J,G,V,O);this.warn&&this.warn(`Encountered unknown type "${D.t}" when formatting node.`)}return q}_processAST(D,O,J){const G=[];for(const V of D){const q=this.formatNode(V,O,J,G,D);q!=null&&G.push(q)}return G}};B(F,"TranslationCore");let r=F;const g=r;function u(A){return Array.isArray(A)?A.map(u).join(""):`${A}`}B(u,"listToString");let w=null,z=null;function C(A,D){return(!w||A!==z)&&(w=new Intl.PluralRules(A,{type:"cardinal"}),z=A),w.select(D)}B(C,"getCardinalName");let y=null,a=null;function v(A,D){return(!y||A!==a)&&(y=new Intl.PluralRules(A,{type:"ordinal"}),a=A),y.select(D)}B(v,"getOrdinalName")},27040:(ge,te,S)=>{"use strict";S.d(te,{default:()=>L});var K=S(22527),P=S(46949);const I=class I extends K.default{constructor(x,m){super(x,m),this.apollo=null,this.site=null,this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this._waiting_flag_ids=new Map,this._waiting_flag_logins=new Map,this._loadStreams=(0,P.debounce)(this._loadStreams,50),this._loadStreamFlags=(0,P.debounce)(this._loadStreamFlags,50),this._loadUsers=(0,P.debounce)(this._loadUsers,50)}queryApollo(x,m,b){let c;return!m&&!b&&"query"in x&&x.query?c=x:(c={query:x,variables:m},b&&(c=Object.assign(c,b))),this.apollo.client.query(c)}mutate(x,m,b){let c;return!m&&!b&&"mutation"in x&&x.mutation?c=x:(c={mutation:x,variables:m},b&&(c=Object.assign(c,b))),this.apollo.client.mutate(c)}get languageCode(){const x=this.site.getSession();return x&&x.languageCode||"en"}get locale(){const x=this.site.getSession();return x&&x.locale||"en-US"}async getBadges(){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,68905,23))))?.data?.badges}async getMatchingCategories(x,m=15,b=null){const c=await this.queryApollo(await S.e(3224).then(S.t.bind(S,29817,23)),{query:x,first:m,cursor:b}),d=(0,P.get)("data.searchCategories.edges.@each.node",c)??[],f=x.toLowerCase();return Array.isArray(d)&&d.sort((r,g)=>{const u=r&&(r.name?.toLowerCase?.()===f||r?.displayName?.toLowerCase?.()===f),w=r&&(g.name?.toLowerCase?.()===f||g?.displayName?.toLowerCase?.()===f);return u&&!w?-1:!u&&w?1:0}),{cursor:(0,P.get)("data.searchCategories.edges.@last.cursor",c),items:d,finished:!(0,P.get)("data.searchCategories.pageInfo.hasNextPage",c),count:(0,P.get)("data.searchCategories.totalCount",c)||0}}async getCategory(x,m){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,95373,23)),{id:x,name:m}))?.data?.game}async deleteChatMessage(x,m){x=String(x);const b=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,4223,23)),variables:{input:{channelID:x,messageID:m}}}),c=b?.data?.deleteChatMessage?.responseCode;if(c==="TARGET_IS_BROADCASTER")throw new P.TranslatableError("You cannot delete the broadcaster's messages.","chat.delete.forbidden.broadcaster");if(c==="TARGET_IS_MODERATOR")throw new P.TranslatableError("You cannot delete messages from moderator {displayName}.","chat.delete.forbidden.moderator",(0,P.get)("data.deleteChatMessage.message.sender",b));if(c!=="SUCCESS")throw new P.TranslatableError("You don't have permission to delete messages.","chat.delete.forbidden");return!0}async getMatchingUsers(x,m=15,b=null){const c=await this.queryApollo(await S.e(3224).then(S.t.bind(S,4176,23)),{query:x,first:m,cursor:b}),d=(0,P.get)("data.searchUsers.edges.@each.node",c)??[],f=x.toLowerCase();return Array.isArray(d)&&d.sort((r,g)=>{const u=r&&(r.login?.toLowerCase?.()===f||r?.displayName?.toLowerCase?.()===f),w=r&&(g.login?.toLowerCase?.()===f||g?.displayName?.toLowerCase?.()===f);return u&&!w?-1:!u&&w?1:0}),{cursor:(0,P.get)("data.searchUsers.edges.@last.cursor",c),items:d,finished:!(0,P.get)("data.searchUsers.pageInfo.hasNextPage",c),count:(0,P.get)("data.searchUsers.totalCount",c)||0}}async getUser(x,m){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,2247,23)),{id:x,login:m}))?.data?.user}async getUserGame(x,m){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,34489,23)),{id:x,login:m}))?.data?.user?.broadcastSettings?.game}async getUserSelf(x,m){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,23333,23)),{id:x,login:m}))?.data?.user?.self}async getUserFollowed(x,m){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,70470,23)),{id:x,login:m}))?.data?.user?.self?.follower}async followUser(x,m=!1){x=String(x),m=!!m;const b=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,33886,23)),variables:{input:{targetID:x,disableNotifications:m}}});console.log("follow result",b);const c=b?.data?.followUser?.error;if(c?.code)throw new Error(c.code);return b?.data?.followUser?.follow}async unfollowUser(x){x=String(x);const m=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,65199,23)),variables:{input:{targetID:x}}});return console.log("unfollow result",m),m?.data?.unfollowUser?.follow}async getLastBroadcast(x,m){return(await this.queryApollo(await S.e(3224).then(S.t.bind(S,82042,23)),{id:x,login:m,type:"ARCHIVE",sort:"TIME",limit:1}))?.data?.user?.videos?.edges?.[0]?.node}getUserBasic(x,m){let b,c,d;if(x)b=this._waiting_user_ids,d=String(x);else if(m)b=this._waiting_user_logins,d=m;else return Promise.reject("id and login cannot both be null");let f=b.get(d);if(f)return f[0];let r,g;return c=new Promise((u,w)=>{r=u,g=w}),b.set(d,[c,r,g]),this._loading_users||this._loadUsers(),c}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const x=[...this._waiting_user_ids.keys()].slice(0,50),m=50-x.length,b=m>0?[...this._waiting_user_logins.keys()].slice(0,m):[];let c;try{c=(await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,59649,23)),variables:{ids:x.length?x:null,logins:b.length?b:null}}))?.data?.users??[]}catch(r){for(const g of x){const u=this._waiting_user_ids.get(g);this._waiting_user_ids.delete(g),u&&u[2](r)}for(const g of b){const u=this._waiting_user_logins.get(g);this._waiting_user_logins.delete(g),u&&u[2](r)}return}const d=new Set(x),f=new Set(b);if(Array.isArray(c))for(const r of c){if(!r||!r.id)continue;d.delete(r.id),f.delete(r.login);let g=this._waiting_user_ids.get(r.id);g&&(this._waiting_user_ids.delete(r.id),g[1](r)),g=this._waiting_user_logins.get(r.login),g&&(this._waiting_user_logins.delete(r.login),g[1](r))}for(const r of d){const g=this._waiting_user_ids.get(r);g&&(this._waiting_user_ids.delete(r),g[1](null))}for(const r of f){const g=this._waiting_user_logins.get(r);g&&(this._waiting_user_logins.delete(r),g[1](null))}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(x,m){return(await this.getLastBroadcast(x,m))?.id}async getChannelColor(x,m){return(await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,30252,23)),variables:{id:x,login:m}}))?.data?.user?.primaryColorHex}async getPoll(x){const m=await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,89218,23)),variables:{id:x}});return(0,P.get)("data.poll",m)}async createPoll(x,m,b,c={}){if(typeof m!="string")throw new TypeError("title must be string");if(!Array.isArray(b)||b.some(g=>typeof g!="string"))throw new TypeError("choices must be array of strings");let d=c.bits||0,f=c.duration||60;(typeof d!="number"||d<0)&&(d=0),(typeof f!="number"||f<0)&&(f=60);const r=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,31902,23)),variables:{input:{bitsCost:d,bitsVoting:d>0,choices:b.map(g=>({title:g})),durationSeconds:f,ownedBy:`${x}`,subscriberMultiplier:c.subscriberMultiplier||!1,subscriberOnly:c.subscriberOnly||!1,title:m}}});return(0,P.get)("data.createPoll.poll",r)}async archivePoll(x){const m=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,83852,23)),variables:{id:x}});return(0,P.get)("data.archivePoll.poll",m)}async terminatePoll(x){const m=await this.mutate({mutation:await S.e(3224).then(S.t.bind(S,20685,23)),variables:{id:x}});return(0,P.get)("data.terminatePoll.poll",m)}getStreamMeta(x,m){let b,c,d;if(x)b=this._waiting_stream_ids,d=String(x);else if(m)b=this._waiting_stream_logins,d=m;else return Promise.reject("id and login cannot both be null");let f=b.get(d);if(f)return f[0];let r,g;return c=new Promise((u,w)=>{r=u,g=w}),b.set(d,[c,r,g]),this._loading_streams||this._loadStreams(),c}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const x=[...this._waiting_stream_ids.keys()].slice(0,50),m=50-x.length,b=m>0?[...this._waiting_stream_logins.keys()].slice(0,m):[];let c;try{c=(await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,61421,23)),variables:{ids:x.length?x:null,logins:b.length?b:null}}))?.data?.users}catch(r){for(const g of x){const u=this._waiting_stream_ids.get(g);this._waiting_stream_ids.delete(g),u&&u[2](r)}for(const g of b){const u=this._waiting_stream_logins.get(g);this._waiting_stream_logins.delete(g),u&&u[2](r)}return}const d=new Set(x),f=new Set(b);if(Array.isArray(c))for(const r of c){if(!r||!r.id)continue;d.delete(r.id),f.delete(r.login);let g=this._waiting_stream_ids.get(r.id);g&&(this._waiting_stream_ids.delete(r.id),g[1](r.stream)),g=this._waiting_stream_logins.get(r.login),g&&(this._waiting_stream_logins.delete(r.login),g[1](r.stream))}for(const r of d){const g=this._waiting_stream_ids.get(r);g&&(this._waiting_stream_ids.delete(r),g[1](null))}for(const r of f){const g=this._waiting_stream_logins.get(r);g&&(this._waiting_stream_logins.delete(r),g[1](null))}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}getStreamFlags(x,m){let b,c,d;if(x)b=this._waiting_flag_ids,d=String(x);else if(m)b=this._waiting_flag_logins,d=m;else return Promise.reject("id and login cannot both be null");let f=b.get(d);if(f)return f[0];let r,g;return c=new Promise((u,w)=>{r=u,g=w}),b.set(d,[c,r,g]),this._loading_flags||this._loadStreamFlags(),c}async _loadStreamFlags(){if(this._loading_flags)return;this._loading_flags=!0;const x=[...this._waiting_flag_ids.keys()].slice(0,50),m=50-x.length,b=m>0?[...this._waiting_flag_logins.keys()].slice(0,m):[];let c;try{c=(await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,9808,23)),variables:{ids:x.length?x:null,logins:b.length?b:null}}))?.data?.users}catch(r){for(const g of x){const u=this._waiting_flag_ids.get(g);u&&(this._waiting_flag_ids.delete(g),u[2](r))}for(const g of b){const u=this._waiting_flag_logins.get(g);u&&(this._waiting_flag_logins.delete(g),u[2](r))}return}const d=new Set(x),f=new Set(b);if(Array.isArray(c))for(const r of c){if(!r||!r.id)continue;d.delete(r.id),f.delete(r.login);let g=this._waiting_flag_ids.get(r.id);g&&(this._waiting_flag_ids.delete(r.id),g[1](r.stream?.contentClassificationLabels??null)),g=this._waiting_flag_logins.get(r.login),g&&(this._waiting_flag_logins.delete(r.login),g[1](r.stream?.contentClassificationLabels??null))}for(const r of d){const g=this._waiting_flag_ids.get(r);g&&(this._waiting_flag_ids.delete(r),g[1](null))}for(const r of f){const g=this._waiting_flag_logins.get(r);g&&(this._waiting_flag_logins.delete(r),g[1](null))}this._loading_flags=!1,(this._waiting_flag_ids.size||this._waiting_flag_logins.size)&&this._loadStreamFlags()}async getMatchingTags(x){const b=(await this.queryApollo({query:await S.e(3224).then(S.t.bind(S,50873,23)),variables:{query:x,first:100}}))?.data?.searchFreeformTags?.edges;if(!Array.isArray(b)||!b.length)return[];const c=[];for(const d of b){const f=d?.node?.tagName;f&&c.push(f)}return c}};B(I,"TwitchData");let L=I},36e3:ge=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetClipInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"curator"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"broadcaster"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:184}};te.loc.source={body:"query FFZ_GetClipInfo($slug:ID!){clip(slug:$slug){id curator{id login displayName}broadcaster{id login displayName}game{id displayName}title thumbnailURL(width:86 height:45)viewCount}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(m){if(m.kind!=="FragmentDefinition")return!0;var b=m.name.value;return S[b]?!1:(S[b]=!0,!0)})}B(K,"unique");function P(x,m){if(x.kind==="FragmentSpread")m.add(x.name.value);else if(x.kind==="VariableDefinition"){var b=x.type;b.kind==="NamedType"&&m.add(b.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(c){P(c,m)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(c){P(c,m)}),x.definitions&&x.definitions.forEach(function(c){P(c,m)})}B(P,"collectFragmentReferences");var L={};B(function(){te.definitions.forEach(function(m){if(m.name){var b=new Set;P(m,b),L[m.name.value]=b}})},"extractReferences")();function I(x,m){for(var b=0;b<x.definitions.length;b++){var c=x.definitions[b];if(c.name&&c.name.value==m)return c}}B(I,"findOperation");function W(x,m){var b={kind:x.kind,definitions:[I(x,m)]};x.hasOwnProperty("loc")&&(b.loc=x.loc);var c=L[m]||new Set,d=new Set,f=new Set;for(c.forEach(function(g){f.add(g)});f.size>0;){var r=f;f=new Set,r.forEach(function(g){if(!d.has(g)){d.add(g);var u=L[g]||new Set;u.forEach(function(w){f.add(w)})}})}return d.forEach(function(g){var u=I(x,g);u&&b.definitions.push(u)}),b}B(W,"oneQuery"),ge.exports=te,ge.exports.FFZ_GetClipInfo=W(te,"FFZ_GetClipInfo")},98750:ge=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:174}};te.loc.source={body:"query FFZ_GetEmoteInfo($id:ID!){emote(id:$id){id artist{id login displayName}owner{id login displayName}setID text subscriptionProduct{id state owner{id login displayName}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(m){if(m.kind!=="FragmentDefinition")return!0;var b=m.name.value;return S[b]?!1:(S[b]=!0,!0)})}B(K,"unique");function P(x,m){if(x.kind==="FragmentSpread")m.add(x.name.value);else if(x.kind==="VariableDefinition"){var b=x.type;b.kind==="NamedType"&&m.add(b.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(c){P(c,m)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(c){P(c,m)}),x.definitions&&x.definitions.forEach(function(c){P(c,m)})}B(P,"collectFragmentReferences");var L={};B(function(){te.definitions.forEach(function(m){if(m.name){var b=new Set;P(m,b),L[m.name.value]=b}})},"extractReferences")();function I(x,m){for(var b=0;b<x.definitions.length;b++){var c=x.definitions[b];if(c.name&&c.name.value==m)return c}}B(I,"findOperation");function W(x,m){var b={kind:x.kind,definitions:[I(x,m)]};x.hasOwnProperty("loc")&&(b.loc=x.loc);var c=L[m]||new Set,d=new Set,f=new Set;for(c.forEach(function(g){f.add(g)});f.size>0;){var r=f;f=new Set,r.forEach(function(g){if(!d.has(g)){d.add(g);var u=L[g]||new Set;u.forEach(function(w){f.add(w)})}})}return d.forEach(function(g){var u=I(x,g);u&&b.definitions.push(u)}),b}B(W,"oneQuery"),ge.exports=te,ge.exports.FFZ_GetEmoteInfo=W(te,"FFZ_GetEmoteInfo")},60795:ge=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteSetInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emoteSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:126}};te.loc.source={body:"query FFZ_GetEmoteSetInfo($id:ID!){emoteSet(id:$id){id owner{id login displayName subscriptionProducts{id emoteSetID state}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(m){if(m.kind!=="FragmentDefinition")return!0;var b=m.name.value;return S[b]?!1:(S[b]=!0,!0)})}B(K,"unique");function P(x,m){if(x.kind==="FragmentSpread")m.add(x.name.value);else if(x.kind==="VariableDefinition"){var b=x.type;b.kind==="NamedType"&&m.add(b.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(c){P(c,m)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(c){P(c,m)}),x.definitions&&x.definitions.forEach(function(c){P(c,m)})}B(P,"collectFragmentReferences");var L={};B(function(){te.definitions.forEach(function(m){if(m.name){var b=new Set;P(m,b),L[m.name.value]=b}})},"extractReferences")();function I(x,m){for(var b=0;b<x.definitions.length;b++){var c=x.definitions[b];if(c.name&&c.name.value==m)return c}}B(I,"findOperation");function W(x,m){var b={kind:x.kind,definitions:[I(x,m)]};x.hasOwnProperty("loc")&&(b.loc=x.loc);var c=L[m]||new Set,d=new Set,f=new Set;for(c.forEach(function(g){f.add(g)});f.size>0;){var r=f;f=new Set,r.forEach(function(g){if(!d.has(g)){d.add(g);var u=L[g]||new Set;u.forEach(function(w){f.add(w)})}})}return d.forEach(function(g){var u=I(x,g);u&&b.definitions.push(u)}),b}B(W,"oneQuery"),ge.exports=te,ge.exports.FFZ_GetEmoteSetInfo=W(te,"FFZ_GetEmoteSetInfo")},87590:ge=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"previewThumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"320"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"180"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"lengthSeconds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publishedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"50"}}],directives:[]}]}}]}}]}}],loc:{start:0,end:207}};te.loc.source={body:"query FFZ_GetVideoInfo($id:ID!){video(id:$id){id title previewThumbnailURL(width:320 height:180)lengthSeconds publishedAt viewCount game{id displayName}owner{id login displayName profileImageURL(width:50)}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(m){if(m.kind!=="FragmentDefinition")return!0;var b=m.name.value;return S[b]?!1:(S[b]=!0,!0)})}B(K,"unique");function P(x,m){if(x.kind==="FragmentSpread")m.add(x.name.value);else if(x.kind==="VariableDefinition"){var b=x.type;b.kind==="NamedType"&&m.add(b.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(c){P(c,m)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(c){P(c,m)}),x.definitions&&x.definitions.forEach(function(c){P(c,m)})}B(P,"collectFragmentReferences");var L={};B(function(){te.definitions.forEach(function(m){if(m.name){var b=new Set;P(m,b),L[m.name.value]=b}})},"extractReferences")();function I(x,m){for(var b=0;b<x.definitions.length;b++){var c=x.definitions[b];if(c.name&&c.name.value==m)return c}}B(I,"findOperation");function W(x,m){var b={kind:x.kind,definitions:[I(x,m)]};x.hasOwnProperty("loc")&&(b.loc=x.loc);var c=L[m]||new Set,d=new Set,f=new Set;for(c.forEach(function(g){f.add(g)});f.size>0;){var r=f;f=new Set,r.forEach(function(g){if(!d.has(g)){d.add(g);var u=L[g]||new Set;u.forEach(function(w){f.add(w)})}})}return d.forEach(function(g){var u=I(x,g);u&&b.definitions.push(u)}),b}B(W,"oneQuery"),ge.exports=te,ge.exports.FFZ_GetVideoInfo=W(te,"FFZ_GetVideoInfo")},96883:ge=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteCard"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emoteID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"emoteID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"artist"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"channel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"localEmoteSets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"stream"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follower"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefit"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emotes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"priceInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currency"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"bitsBadgeTierSummary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threshold"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUnlocked"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"numberOfBitsUntilUnlock"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:418}};te.loc.source={body:"query FFZ_EmoteCard($emoteID:ID!){emote(id:$emoteID){id type token setID artist{id login displayName}owner{id login displayName channel{id localEmoteSets{id emotes{id token}}}stream{id type}self{follower{followedAt}subscriptionBenefit{id tier}}subscriptionProducts{id displayName tier name url emotes{id token}priceInfo{id currency price}}}bitsBadgeTierSummary{threshold self{isUnlocked numberOfBitsUntilUnlock}}type}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(m){if(m.kind!=="FragmentDefinition")return!0;var b=m.name.value;return S[b]?!1:(S[b]=!0,!0)})}B(K,"unique");function P(x,m){if(x.kind==="FragmentSpread")m.add(x.name.value);else if(x.kind==="VariableDefinition"){var b=x.type;b.kind==="NamedType"&&m.add(b.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(c){P(c,m)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(c){P(c,m)}),x.definitions&&x.definitions.forEach(function(c){P(c,m)})}B(P,"collectFragmentReferences");var L={};B(function(){te.definitions.forEach(function(m){if(m.name){var b=new Set;P(m,b),L[m.name.value]=b}})},"extractReferences")();function I(x,m){for(var b=0;b<x.definitions.length;b++){var c=x.definitions[b];if(c.name&&c.name.value==m)return c}}B(I,"findOperation");function W(x,m){var b={kind:x.kind,definitions:[I(x,m)]};x.hasOwnProperty("loc")&&(b.loc=x.loc);var c=L[m]||new Set,d=new Set,f=new Set;for(c.forEach(function(g){f.add(g)});f.size>0;){var r=f;f=new Set,r.forEach(function(g){if(!d.has(g)){d.add(g);var u=L[g]||new Set;u.forEach(function(w){f.add(w)})}})}return d.forEach(function(g){var u=I(x,g);u&&b.definitions.push(u)}),b}B(W,"oneQuery"),ge.exports=te,ge.exports.FFZ_EmoteCard=W(te,"FFZ_EmoteCard")},90424:ge=>{var te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteMenu_SubStatus"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"criteria"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SubscriptionBenefitCriteriaInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefits"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"criteria"},value:{kind:"Variable",name:{kind:"Name",value:"criteria"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gift"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isGift"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"purchasedWithPrime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"renewsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:296}};te.loc.source={body:"query FFZ_EmoteMenu_SubStatus($first:Int$after:Cursor$criteria:SubscriptionBenefitCriteriaInput!){currentUser{id subscriptionBenefits(first:$first after:$after criteria:$criteria){pageInfo{hasNextPage}edges{cursor node{id gift{isGift}purchasedWithPrime endsAt renewsAt product{id emoteSetID}}}}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function K(x){return x.filter(function(m){if(m.kind!=="FragmentDefinition")return!0;var b=m.name.value;return S[b]?!1:(S[b]=!0,!0)})}B(K,"unique");function P(x,m){if(x.kind==="FragmentSpread")m.add(x.name.value);else if(x.kind==="VariableDefinition"){var b=x.type;b.kind==="NamedType"&&m.add(b.name.value)}x.selectionSet&&x.selectionSet.selections.forEach(function(c){P(c,m)}),x.variableDefinitions&&x.variableDefinitions.forEach(function(c){P(c,m)}),x.definitions&&x.definitions.forEach(function(c){P(c,m)})}B(P,"collectFragmentReferences");var L={};B(function(){te.definitions.forEach(function(m){if(m.name){var b=new Set;P(m,b),L[m.name.value]=b}})},"extractReferences")();function I(x,m){for(var b=0;b<x.definitions.length;b++){var c=x.definitions[b];if(c.name&&c.name.value==m)return c}}B(I,"findOperation");function W(x,m){var b={kind:x.kind,definitions:[I(x,m)]};x.hasOwnProperty("loc")&&(b.loc=x.loc);var c=L[m]||new Set,d=new Set,f=new Set;for(c.forEach(function(g){f.add(g)});f.size>0;){var r=f;f=new Set,r.forEach(function(g){if(!d.has(g)){d.add(g);var u=L[g]||new Set;u.forEach(function(w){f.add(w)})}})}return d.forEach(function(g){var u=I(x,g);u&&b.definitions.push(u)}),b}B(W,"oneQuery"),ge.exports=te,ge.exports.FFZ_EmoteMenu_SubStatus=W(te,"FFZ_EmoteMenu_SubStatus")},4866:(ge,te,S)=>{var K=S(89),P=S(49388),L=S(64311),I=S(45138);function W(x,m,b){if(arguments.length<2&&(b=x,x=null,m=null),this.capacity=b,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var c=L.getPointerArray(b);this.forward=new c(b),this.backward=new c(b),this.K=typeof x=="function"?new x(b):new Array(b),this.V=typeof m=="function"?new m(b):new Array(b),this.size=0,this.head=0,this.tail=0,this.items={}}B(W,"LRUCache"),W.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},W.prototype.splayOnTop=function(x){var m=this.head;if(this.head===x)return this;var b=this.backward[x],c=this.forward[x];return this.tail===x?this.tail=b:this.backward[c]=b,this.forward[b]=c,this.backward[m]=x,this.head=x,this.forward[x]=m,this},W.prototype.set=function(x,m){var b=this.items[x];if(typeof b<"u"){this.splayOnTop(b),this.V[b]=m;return}this.size<this.capacity?b=this.size++:(b=this.tail,this.tail=this.backward[b],delete this.items[this.K[b]]),this.items[x]=b,this.K[b]=x,this.V[b]=m,this.forward[b]=this.head,this.backward[this.head]=b,this.head=b},W.prototype.setpop=function(x,m){var b=null,c=null,d=this.items[x];return typeof d<"u"?(this.splayOnTop(d),b=this.V[d],this.V[d]=m,{evicted:!1,key:x,value:b}):(this.size<this.capacity?d=this.size++:(d=this.tail,this.tail=this.backward[d],b=this.V[d],c=this.K[d],delete this.items[this.K[d]]),this.items[x]=d,this.K[d]=x,this.V[d]=m,this.forward[d]=this.head,this.backward[this.head]=d,this.head=d,c?{evicted:!0,key:c,value:b}:null)},W.prototype.has=function(x){return x in this.items},W.prototype.get=function(x){var m=this.items[x];if(!(typeof m>"u"))return this.splayOnTop(m),this.V[m]},W.prototype.peek=function(x){var m=this.items[x];if(!(typeof m>"u"))return this.V[m]},W.prototype.forEach=function(x,m){m=arguments.length>1?m:this;for(var b=0,c=this.size,d=this.head,f=this.K,r=this.V,g=this.forward;b<c;)x.call(m,r[d],f[d],this),d=g[d],b++},W.prototype.keys=function(){var x=0,m=this.size,b=this.head,c=this.K,d=this.forward;return new K(function(){if(x>=m)return{done:!0};var f=c[b];return x++,x<m&&(b=d[b]),{done:!1,value:f}})},W.prototype.values=function(){var x=0,m=this.size,b=this.head,c=this.V,d=this.forward;return new K(function(){if(x>=m)return{done:!0};var f=c[b];return x++,x<m&&(b=d[b]),{done:!1,value:f}})},W.prototype.entries=function(){var x=0,m=this.size,b=this.head,c=this.K,d=this.V,f=this.forward;return new K(function(){if(x>=m)return{done:!0};var r=c[b],g=d[b];return x++,x<m&&(b=f[b]),{done:!1,value:[r,g]}})},typeof Symbol<"u"&&(W.prototype[Symbol.iterator]=W.prototype.entries),W.prototype.inspect=function(){for(var x=new Map,m=this.entries(),b;b=m.next(),!b.done;)x.set(b.value[0],b.value[1]);return Object.defineProperty(x,"constructor",{value:W,enumerable:!1}),x},typeof Symbol<"u"&&(W.prototype[Symbol.for("nodejs.util.inspect.custom")]=W.prototype.inspect),W.from=function(x,m,b,c){if(arguments.length<2){if(c=I.guessLength(x),typeof c!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(c=m,m=null,b=null);var d=new W(m,b,c);return P(x,function(f,r){d.set(r,f)}),d},ge.exports=W},45138:(ge,te,S)=>{var K=S(49388),P=S(64311);function L(m){return Array.isArray(m)||P.isTypedArray(m)}B(L,"isArrayLike");function I(m){if(typeof m.length=="number")return m.length;if(typeof m.size=="number")return m.size}B(I,"guessLength");function W(m){var b=I(m),c=typeof b=="number"?new Array(b):[],d=0;return K(m,function(f){c[d++]=f}),c}B(W,"toArray");function x(m){var b=I(m),c=typeof b=="number"?P.getPointerArray(b):Array,d=typeof b=="number"?new Array(b):[],f=typeof b=="number"?new c(b):[],r=0;return K(m,function(g){d[r]=g,f[r]=r++}),[d,f]}B(x,"toArrayWithIndices"),te.isArrayLike=L,te.guessLength=I,te.toArray=W,te.toArrayWithIndices=x},64311:(ge,te)=>{var S=Math.pow(2,8)-1,K=Math.pow(2,16)-1,P=Math.pow(2,32)-1,L=Math.pow(2,7)-1,I=Math.pow(2,15)-1,W=Math.pow(2,31)-1;te.getPointerArray=function(m){var b=m-1;if(b<=S)return Uint8Array;if(b<=K)return Uint16Array;if(b<=P)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},te.getSignedPointerArray=function(m){var b=m-1;return b<=L?Int8Array:b<=I?Int16Array:b<=W?Int32Array:Float64Array},te.getNumberType=function(m){return m===(m|0)?Math.sign(m)===-1?m<=127&&m>=-128?Int8Array:m<=32767&&m>=-32768?Int16Array:Int32Array:m<=255?Uint8Array:m<=65535?Uint16Array:Uint32Array:Float64Array};var x={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};te.getMinimalRepresentation=function(m,b){var c=null,d=0,f,r,g,u,w;for(u=0,w=m.length;u<w;u++)g=b?b(m[u]):m[u],r=te.getNumberType(g),f=x[r.name],f>d&&(d=f,c=r);return c},te.isTypedArray=function(m){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(m)},te.concat=function(){var m=0,b,c,d;for(b=0,d=arguments.length;b<d;b++)m+=arguments[b].length;var f=new arguments[0].constructor(m);for(b=0,c=0;b<d;b++)f.set(arguments[b],c),c+=arguments[b].length;return f},te.indices=function(m){for(var b=te.getPointerArray(m),c=new b(m),d=0;d<m;d++)c[d]=d;return c}},49388:(ge,te,S)=>{var K=S(18713),P=K.ARRAY_BUFFER_SUPPORT,L=K.SYMBOL_SUPPORT;ge.exports=B(function(W,x){var m,b,c,d,f;if(!W)throw new Error("obliterator/forEach: invalid iterable.");if(typeof x!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(W)||P&&ArrayBuffer.isView(W)||typeof W=="string"||W.toString()==="[object Arguments]"){for(c=0,d=W.length;c<d;c++)x(W[c],c);return}if(typeof W.forEach=="function"){W.forEach(x);return}if(L&&Symbol.iterator in W&&typeof W.next!="function"&&(W=W[Symbol.iterator]()),typeof W.next=="function"){for(m=W,c=0;f=m.next(),f.done!==!0;)x(f.value,c),c++;return}for(b in W)W.hasOwnProperty(b)&&x(W[b],b)},"forEach")},89:ge=>{function te(S){if(typeof S!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=S}B(te,"Iterator"),typeof Symbol<"u"&&(te.prototype[Symbol.iterator]=function(){return this}),te.of=function(){var S=arguments,K=S.length,P=0;return new te(function(){return P>=K?{done:!0}:{done:!1,value:S[P++]}})},te.empty=function(){var S=new te(function(){return{done:!0}});return S},te.fromSequence=function(S){var K=0,P=S.length;return new te(function(){return K>=P?{done:!0}:{done:!1,value:S[K++]}})},te.is=function(S){return S instanceof te?!0:typeof S=="object"&&S!==null&&typeof S.next=="function"},ge.exports=te},18713:(ge,te)=>{te.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",te.SYMBOL_SUPPORT=typeof Symbol<"u"},72167:ge=>{ge.exports=g,ge.exports.match=L,ge.exports.regexpToFunction=I,ge.exports.parse=K,ge.exports.compile=P,ge.exports.tokensToFunction=W,ge.exports.tokensToRegExp=r;var te="/",S=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function K(u,w){for(var z=[],C=0,y=0,a="",v=w&&w.delimiter||te,F=w&&w.whitelist||void 0,A=!1,D;(D=S.exec(u))!==null;){var O=D[0],J=D[1],G=D.index;if(a+=u.slice(y,G),y=G+O.length,J){a+=J[1],A=!0;continue}var V="",q=D[2],re=D[3],ae=D[4],fe=D[5];if(!A&&a.length){var be=a.length-1,Pe=a[be],ne=F?F.indexOf(Pe)>-1:!0;ne&&(V=Pe,a=a.slice(0,be))}a&&(z.push(a),a="",A=!1);var ie=fe==="+"||fe==="*",le=fe==="?"||fe==="*",ze=re||ae,oe=V||v;z.push({name:q||C++,prefix:V,delimiter:oe,optional:le,repeat:ie,pattern:ze?m(ze):"[^"+x(oe===v?oe:oe+v)+"]+?"})}return(a||y<u.length)&&z.push(a+u.substr(y)),z}B(K,"parse");function P(u,w){return W(K(u,w),w)}B(P,"compile");function L(u,w){var z=[],C=g(u,z,w);return I(C,z)}B(L,"match");function I(u,w){return function(z,C){var y=u.exec(z);if(!y)return!1;for(var a=y[0],v=y.index,F={},A=C&&C.decode||decodeURIComponent,D=1;D<y.length;D++)if(y[D]!==void 0){var O=w[D-1];O.repeat?F[O.name]=y[D].split(O.delimiter).map(function(J){return A(J,O)}):F[O.name]=A(y[D],O)}return{path:a,index:v,params:F}}}B(I,"regexpToFunction");function W(u,w){for(var z=new Array(u.length),C=0;C<u.length;C++)typeof u[C]=="object"&&(z[C]=new RegExp("^(?:"+u[C].pattern+")$",b(w)));return function(y,a){for(var v="",F=a&&a.encode||encodeURIComponent,A=a?a.validate!==!1:!0,D=0;D<u.length;D++){var O=u[D];if(typeof O=="string"){v+=O;continue}var J=y?y[O.name]:void 0,G;if(Array.isArray(J)){if(!O.repeat)throw new TypeError('Expected "'+O.name+'" to not repeat, but got array');if(J.length===0){if(O.optional)continue;throw new TypeError('Expected "'+O.name+'" to not be empty')}for(var V=0;V<J.length;V++){if(G=F(J[V],O),A&&!z[D].test(G))throw new TypeError('Expected all "'+O.name+'" to match "'+O.pattern+'"');v+=(V===0?O.prefix:O.delimiter)+G}continue}if(typeof J=="string"||typeof J=="number"||typeof J=="boolean"){if(G=F(String(J),O),A&&!z[D].test(G))throw new TypeError('Expected "'+O.name+'" to match "'+O.pattern+'", but got "'+G+'"');v+=O.prefix+G;continue}if(!O.optional)throw new TypeError('Expected "'+O.name+'" to be '+(O.repeat?"an array":"a string"))}return v}}B(W,"tokensToFunction");function x(u){return u.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}B(x,"escapeString");function m(u){return u.replace(/([=!:$/()])/g,"\\$1")}B(m,"escapeGroup");function b(u){return u&&u.sensitive?"":"i"}B(b,"flags");function c(u,w){if(!w)return u;var z=u.source.match(/\((?!\?)/g);if(z)for(var C=0;C<z.length;C++)w.push({name:C,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return u}B(c,"regexpToRegexp");function d(u,w,z){for(var C=[],y=0;y<u.length;y++)C.push(g(u[y],w,z).source);return new RegExp("(?:"+C.join("|")+")",b(z))}B(d,"arrayToRegexp");function f(u,w,z){return r(K(u,z),w,z)}B(f,"stringToRegexp");function r(u,w,z){z=z||{};for(var C=z.strict,y=z.start!==!1,a=z.end!==!1,v=z.delimiter||te,F=[].concat(z.endsWith||[]).map(x).concat("$").join("|"),A=y?"^":"",D=0;D<u.length;D++){var O=u[D];if(typeof O=="string")A+=x(O);else{var J=O.repeat?"(?:"+O.pattern+")(?:"+x(O.delimiter)+"(?:"+O.pattern+"))*":O.pattern;w&&w.push(O),O.optional?O.prefix?A+="(?:"+x(O.prefix)+"("+J+"))?":A+="("+J+")?":A+=x(O.prefix)+"("+J+")"}}if(a)C||(A+="(?:"+x(v)+")?"),A+=F==="$"?"$":"(?="+F+")";else{var G=u[u.length-1],V=typeof G=="string"?G[G.length-1]===v:G===void 0;C||(A+="(?:"+x(v)+"(?="+F+"))?"),V||(A+="(?="+x(v)+"|"+F+")")}return new RegExp(A,b(z))}B(r,"tokensToRegExp");function g(u,w,z){return u instanceof RegExp?c(u,w):Array.isArray(u)?d(u,w,z):f(u,w,z)}B(g,"pathToRegexp")},47596:(ge,te)=>{"use strict";var S;/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=Symbol.for("react.element"),P=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),m=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),r=Symbol.iterator;function g(oe){return oe===null||typeof oe!="object"?null:(oe=r&&oe[r]||oe["@@iterator"],typeof oe=="function"?oe:null)}B(g,"A");var u={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,z={};function C(oe,we,Te){this.props=oe,this.context=we,this.refs=z,this.updater=Te||u}B(C,"E"),C.prototype.isReactComponent={},C.prototype.setState=function(oe,we){if(typeof oe!="object"&&typeof oe!="function"&&oe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,oe,we,"setState")},C.prototype.forceUpdate=function(oe){this.updater.enqueueForceUpdate(this,oe,"forceUpdate")};function y(){}B(y,"F"),y.prototype=C.prototype;function a(oe,we,Te){this.props=oe,this.context=we,this.refs=z,this.updater=Te||u}B(a,"G");var v=a.prototype=new y;v.constructor=a,w(v,C.prototype),v.isPureReactComponent=!0;var F=Array.isArray,A=Object.prototype.hasOwnProperty,D={current:null},O={key:!0,ref:!0,__self:!0,__source:!0};function J(oe,we,Te){var Be,Oe={},Ie=null,Ve=null;if(we!=null)for(Be in we.ref!==void 0&&(Ve=we.ref),we.key!==void 0&&(Ie=""+we.key),we)A.call(we,Be)&&!O.hasOwnProperty(Be)&&(Oe[Be]=we[Be]);var Ke=arguments.length-2;if(Ke===1)Oe.children=Te;else if(1<Ke){for(var Ye=Array(Ke),it=0;it<Ke;it++)Ye[it]=arguments[it+2];Oe.children=Ye}if(oe&&oe.defaultProps)for(Be in Ke=oe.defaultProps,Ke)Oe[Be]===void 0&&(Oe[Be]=Ke[Be]);return{$$typeof:K,type:oe,key:Ie,ref:Ve,props:Oe,_owner:D.current}}B(J,"M");function G(oe,we){return{$$typeof:K,type:oe.type,key:we,ref:oe.ref,props:oe.props,_owner:oe._owner}}B(G,"N");function V(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===K}B(V,"O");function q(oe){var we={"=":"=0",":":"=2"};return"$"+oe.replace(/[=:]/g,function(Te){return we[Te]})}B(q,"escape2");var re=/\/+/g;function ae(oe,we){return typeof oe=="object"&&oe!==null&&oe.key!=null?q(""+oe.key):we.toString(36)}B(ae,"Q");function fe(oe,we,Te,Be,Oe){var Ie=typeof oe;(Ie==="undefined"||Ie==="boolean")&&(oe=null);var Ve=!1;if(oe===null)Ve=!0;else switch(Ie){case"string":case"number":Ve=!0;break;case"object":switch(oe.$$typeof){case K:case P:Ve=!0}}if(Ve)return Ve=oe,Oe=Oe(Ve),oe=Be===""?"."+ae(Ve,0):Be,F(Oe)?(Te="",oe!=null&&(Te=oe.replace(re,"$&/")+"/"),fe(Oe,we,Te,"",function(it){return it})):Oe!=null&&(V(Oe)&&(Oe=G(Oe,Te+(!Oe.key||Ve&&Ve.key===Oe.key?"":(""+Oe.key).replace(re,"$&/")+"/")+oe)),we.push(Oe)),1;if(Ve=0,Be=Be===""?".":Be+":",F(oe))for(var Ke=0;Ke<oe.length;Ke++){Ie=oe[Ke];var Ye=Be+ae(Ie,Ke);Ve+=fe(Ie,we,Te,Ye,Oe)}else if(Ye=g(oe),typeof Ye=="function")for(oe=Ye.call(oe),Ke=0;!(Ie=oe.next()).done;)Ie=Ie.value,Ye=Be+ae(Ie,Ke++),Ve+=fe(Ie,we,Te,Ye,Oe);else if(Ie==="object")throw we=String(oe),Error("Objects are not valid as a React child (found: "+(we==="[object Object]"?"object with keys {"+Object.keys(oe).join(", ")+"}":we)+"). If you meant to render a collection of children, use an array instead.");return Ve}B(fe,"R");function be(oe,we,Te){if(oe==null)return oe;var Be=[],Oe=0;return fe(oe,Be,"","",function(Ie){return we.call(Te,Ie,Oe++)}),Be}B(be,"S");function Pe(oe){if(oe._status===-1){var we=oe._result;we=we(),we.then(function(Te){(oe._status===0||oe._status===-1)&&(oe._status=1,oe._result=Te)},function(Te){(oe._status===0||oe._status===-1)&&(oe._status=2,oe._result=Te)}),oe._status===-1&&(oe._status=0,oe._result=we)}if(oe._status===1)return oe._result.default;throw oe._result}B(Pe,"T");var ne={current:null},ie={transition:null},le={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:ie,ReactCurrentOwner:D};function ze(){throw Error("act(...) is not supported in production builds of React.")}B(ze,"X"),S={map:be,forEach:function(oe,we,Te){be(oe,function(){we.apply(this,arguments)},Te)},count:function(oe){var we=0;return be(oe,function(){we++}),we},toArray:function(oe){return be(oe,function(we){return we})||[]},only:function(oe){if(!V(oe))throw Error("React.Children.only expected to receive a single React element child.");return oe}},S=C,S=L,S=W,S=a,S=I,S=c,S=le,S=ze,S=B(function(oe,we,Te){if(oe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+oe+".");var Be=w({},oe.props),Oe=oe.key,Ie=oe.ref,Ve=oe._owner;if(we!=null){if(we.ref!==void 0&&(Ie=we.ref,Ve=D.current),we.key!==void 0&&(Oe=""+we.key),oe.type&&oe.type.defaultProps)var Ke=oe.type.defaultProps;for(Ye in we)A.call(we,Ye)&&!O.hasOwnProperty(Ye)&&(Be[Ye]=we[Ye]===void 0&&Ke!==void 0?Ke[Ye]:we[Ye])}var Ye=arguments.length-2;if(Ye===1)Be.children=Te;else if(1<Ye){Ke=Array(Ye);for(var it=0;it<Ye;it++)Ke[it]=arguments[it+2];Be.children=Ke}return{$$typeof:K,type:oe.type,key:Oe,ref:Ie,props:Be,_owner:Ve}},"__webpack_unused_export__"),S=B(function(oe){return oe={$$typeof:m,_currentValue:oe,_currentValue2:oe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},oe.Provider={$$typeof:x,_context:oe},oe.Consumer=oe},"__webpack_unused_export__"),te.createElement=J,S=B(function(oe){var we=J.bind(null,oe);return we.type=oe,we},"__webpack_unused_export__"),S=B(function(){return{current:null}},"__webpack_unused_export__"),S=B(function(oe){return{$$typeof:b,render:oe}},"__webpack_unused_export__"),S=V,S=B(function(oe){return{$$typeof:f,_payload:{_status:-1,_result:oe},_init:Pe}},"__webpack_unused_export__"),S=B(function(oe,we){return{$$typeof:d,type:oe,compare:we===void 0?null:we}},"__webpack_unused_export__"),S=B(function(oe){var we=ie.transition;ie.transition={};try{oe()}finally{ie.transition=we}},"__webpack_unused_export__"),S=ze,S=B(function(oe,we){return ne.current.useCallback(oe,we)},"__webpack_unused_export__"),S=B(function(oe){return ne.current.useContext(oe)},"__webpack_unused_export__"),S=B(function(){},"__webpack_unused_export__"),S=B(function(oe){return ne.current.useDeferredValue(oe)},"__webpack_unused_export__"),S=B(function(oe,we){return ne.current.useEffect(oe,we)},"__webpack_unused_export__"),S=B(function(){return ne.current.useId()},"__webpack_unused_export__"),S=B(function(oe,we,Te){return ne.current.useImperativeHandle(oe,we,Te)},"__webpack_unused_export__"),S=B(function(oe,we){return ne.current.useInsertionEffect(oe,we)},"__webpack_unused_export__"),S=B(function(oe,we){return ne.current.useLayoutEffect(oe,we)},"__webpack_unused_export__"),S=B(function(oe,we){return ne.current.useMemo(oe,we)},"__webpack_unused_export__"),S=B(function(oe,we,Te){return ne.current.useReducer(oe,we,Te)},"__webpack_unused_export__"),S=B(function(oe){return ne.current.useRef(oe)},"__webpack_unused_export__"),S=B(function(oe){return ne.current.useState(oe)},"__webpack_unused_export__"),S=B(function(oe,we,Te){return ne.current.useSyncExternalStore(oe,we,Te)},"__webpack_unused_export__"),S=B(function(){return ne.current.useTransition()},"__webpack_unused_export__"),S="18.3.1"},75271:(ge,te,S)=>{"use strict";ge.exports=S(47596)},73637:(ge,te,S)=>{var K={"./af.js":[20179,1081],"./am.js":[61783,5380],"./ar-dz.js":[98136,5215],"./ar-iq.js":[82690,789],"./ar-kw.js":[62009,5151],"./ar-ly.js":[49408,1722],"./ar-ma.js":[87330,909],"./ar-sa.js":[66575,5012],"./ar-tn.js":[5742,8757],"./ar.js":[46567,3030],"./az.js":[14319,8736],"./be.js":[41737,2244],"./bg.js":[86835,6757],"./bi.js":[50045,8111],"./bm.js":[65561,9082],"./bn.js":[57602,4667],"./bo.js":[92594,3134],"./br.js":[34467,3968],"./bs.js":[53169,9248],"./ca.js":[97569,4178],"./cs.js":[30625,5123],"./cv.js":[6326,4060],"./cy.js":[49268,3166],"./da.js":[11559,4103],"./de-at.js":[12369,5954],"./de-ch.js":[71107,7168],"./de.js":[24569,300],"./dv.js":[25427,5528],"./el.js":[90524,1784],"./en-au.js":[29061,4634],"./en-ca.js":[31304,2928],"./en-gb.js":[84252,627],"./en-ie.js":[48757,2730],"./en-il.js":[98038,9],"./en-in.js":[7282,6644],"./en-nz.js":[97960,485],"./en-sg.js":[435,3949],"./en-tt.js":[90954,5818],"./en.js":[22039,427],"./eo.js":[39399,3923],"./es-do.js":[47688,4026],"./es-mx.js":[81773,2972],"./es-pr.js":[66106,5624],"./es-us.js":[18541,187],"./es.js":[23607,172],"./et.js":[29776,9040],"./eu.js":[20166,6960],"./fa.js":[28288,6633],"./fi.js":[88189,5928],"./fo.js":[49697,9627],"./fr-ca.js":[15296,7007],"./fr-ch.js":[53415,7063],"./fr.js":[4938,3674],"./fy.js":[7811,8733],"./ga.js":[3368,6020],"./gd.js":[53560,3017],"./gl.js":[85222,4466],"./gom-latn.js":[38546,6099],"./gu.js":[78309,6993],"./he.js":[41436,9706],"./hi.js":[463,7409],"./hr.js":[27147,3793],"./ht.js":[95139,3104],"./hu.js":[18224,6994],"./hy-am.js":[25976,365],"./id.js":[74970,2698],"./is.js":[799,1087],"./it-ch.js":[6071,8302],"./it.js":[97727,8744],"./ja.js":[78117,9418],"./jv.js":[22281,3496],"./ka.js":[87931,3099],"./kk.js":[52334,1494],"./km.js":[35155,6169],"./kn.js":[72879,9701],"./ko.js":[62905,5929],"./ku.js":[34078,8555],"./ky.js":[24026,2819],"./lb.js":[62619,8124],"./lo.js":[29979,1462],"./lt.js":[75887,6903],"./lv.js":[35493,2437],"./me.js":[50532,4518],"./mi.js":[73059,3883],"./mk.js":[17450,3512],"./ml.js":[66422,8996],"./mn.js":[16428,8753],"./mr.js":[35778,3294],"./ms-my.js":[40583,2593],"./ms.js":[33650,6881],"./mt.js":[6045,4863],"./my.js":[74361,3741],"./nb.js":[10697,3148],"./ne.js":[16608,3868],"./nl-be.js":[11377,7953],"./nl.js":[6987,9724],"./nn.js":[8758,9663],"./oc-lnc.js":[68064,9495],"./pa-in.js":[16767,838],"./pl.js":[28012,8705],"./pt-br.js":[19978,3639],"./pt.js":[51357,7479],"./ro.js":[71948,3905],"./ru.js":[3381,8700],"./rw.js":[79914,3128],"./sd.js":[90126,7087],"./se.js":[46319,8723],"./si.js":[99008,9797],"./sk.js":[84600,6512],"./sl.js":[64955,3951],"./sq.js":[74716,3392],"./sr-cyrl.js":[55854,1532],"./sr.js":[23534,1907],"./ss.js":[19239,7003],"./sv-fi.js":[57972,9047],"./sv.js":[43032,8919],"./sw.js":[60125,4176],"./ta.js":[1565,9872],"./te.js":[92516,5825],"./tet.js":[26712,4984],"./tg.js":[39351,4653],"./th.js":[89225,5389],"./tk.js":[48485,2355],"./tl-ph.js":[17517,2343],"./tlh.js":[35984,3508],"./tr.js":[33092,2661],"./tzl.js":[69109,6199],"./tzm-latn.js":[13637,6782],"./tzm.js":[38063,1785],"./ug-cn.js":[98490,8256],"./uk.js":[65589,6190],"./ur.js":[85859,3199],"./uz-latn.js":[96588,3290],"./uz.js":[45589,9238],"./vi.js":[41191,357],"./x-pseudo.js":[59018,6858],"./yo.js":[14163,8898],"./zh-cn.js":[9073,5352],"./zh-hk.js":[74828,8638],"./zh-tw.js":[78141,4101],"./zh.js":[42882,5235]};function P(L){if(!S.o(K,L))return Promise.resolve().then(()=>{var x=new Error("Cannot find module '"+L+"'");throw x.code="MODULE_NOT_FOUND",x});var I=K[L],W=I[0];return S.e(I[1]).then(()=>S.t(W,23))}B(P,"webpackAsyncContext"),P.keys=()=>Object.keys(K),P.id=73637,ge.exports=P},39706:(ge,te,S)=>{var K={"./chat-borders-3d-inset.scss":84366,"./chat-borders-3d.scss":7757,"./chat-borders-wide.scss":7411,"./chat-borders.scss":52157,"./chat-font.scss":37602,"./chat-rows.scss":87338,"./emote-alignment-baseline.scss":4803,"./emote-alignment-padded.scss":22558,"./full-width.scss":241,"./global-font.scss":79001,"./player-ext-mouse.scss":61425,"./player-fade-paused.scss":5108,"./player-hide-mouse.scss":38374,"./player-volume.scss":7655,"./square-avatars.scss":17789};function P(I){return L(I).then(S)}B(P,"webpackAsyncContext");function L(I){return S.e(8089).then(()=>{if(!S.o(K,I)){var W=new Error("Cannot find module '"+I+"'");throw W.code="MODULE_NOT_FOUND",W}return K[I]})}B(L,"webpackAsyncContextResolve"),P.keys=()=>Object.keys(K),P.resolve=L,P.id=39706,ge.exports=P},41152:(ge,te,S)=>{var K={"./bits_button.js":24531,"./bttv_compat.js":11746,"./channel.jsx":74756,"./chat/index.js":6172,"./compat_emote_menu.js":6325,"./css_tweaks/index.js":17103,"./dashboard.js":95778,"./directory/index.jsx":96432,"./layout.js":68318,"./loadable.tsx":34923,"./menu_button.jsx":29333,"./mod-view.jsx":94296,"./player.jsx":63155,"./sub_button.tsx":70052,"./theme/index.js":24020,"./video_chat/index.jsx":4948};function P(I){var W=L(I);return S(W)}B(P,"webpackContext");function L(I){if(!S.o(K,I)){var W=new Error("Cannot find module '"+I+"'");throw W.code="MODULE_NOT_FOUND",W}return K[I]}B(L,"webpackContextResolve"),P.keys=B(function(){return Object.keys(K)},"webpackContextKeys"),P.resolve=L,ge.exports=P,P.id=41152},77074:(ge,te,S)=>{"use strict";ge.exports=S.p+"experiments.json"},24290:ge=>{"use strict";ge.exports=ffzVue},91054:()=>{}},Pi={};function Q(ge){var te=Pi[ge];if(te!==void 0)return te.exports;var S=Pi[ge]={exports:{}};return Mi[ge].call(S.exports,S,S.exports,Q),S.exports}B(Q,"__webpack_require__"),Q.m=Mi,Q.n=ge=>{var te=ge&&ge.__esModule?()=>ge.default:()=>ge;return Q.d(te,{a:te}),te},(()=>{var ge=Object.getPrototypeOf?S=>Object.getPrototypeOf(S):S=>S.__proto__,te;Q.t=function(S,K){if(K&1&&(S=this(S)),K&8||typeof S=="object"&&S&&(K&4&&S.__esModule||K&16&&typeof S.then=="function"))return S;var P=Object.create(null);Q.r(P);var L={};te=te||[null,ge({}),ge([]),ge(ge)];for(var I=K&2&&S;typeof I=="object"&&!~te.indexOf(I);I=ge(I))Object.getOwnPropertyNames(I).forEach(W=>L[W]=()=>S[W]);return L.default=()=>S,Q.d(P,L),P}})(),Q.d=(ge,te)=>{for(var S in te)Q.o(te,S)&&!Q.o(ge,S)&&Object.defineProperty(ge,S,{enumerable:!0,get:te[S]})},Q.f={},Q.e=ge=>Promise.all(Object.keys(Q.f).reduce((te,S)=>(Q.f[S](ge,te),te),[])),Q.u=ge=>""+({9:"i18n-33",172:"i18n-44",187:"i18n-43",204:"menu-md4",208:"rich_tokens",300:"i18n-26",357:"i18n-134",365:"i18n-64",427:"i18n-38",485:"i18n-35",627:"i18n-31",789:"i18n-3",838:"i18n-98",909:"i18n-6",935:"zip",1081:"i18n-0",1087:"i18n-66",1462:"i18n-79",1494:"i18n-72",1532:"i18n-111",1722:"i18n-5",1784:"i18n-28",1785:"i18n-128",1871:"translation-ui",1907:"i18n-112",2009:"markdown",2086:"main-menu",2244:"i18n-11",2343:"i18n-123",2348:"chat",2355:"i18n-122",2437:"i18n-81",2593:"i18n-88",2597:"site-css-tweaks",2661:"i18n-125",2698:"i18n-65",2730:"i18n-32",2819:"i18n-77",2928:"i18n-30",2972:"i18n-41",3017:"i18n-55",3030:"i18n-9",3099:"i18n-71",3104:"i18n-62",3128:"i18n-104",3134:"i18n-16",3148:"i18n-92",3166:"i18n-22",3199:"i18n-131",3224:"queries",3290:"i18n-132",3294:"i18n-87",3392:"i18n-110",3496:"i18n-70",3508:"i18n-124",3512:"i18n-84",3639:"i18n-100",3674:"i18n-52",3741:"i18n-91",3793:"i18n-61",3868:"i18n-93",3883:"i18n-83",3905:"i18n-102",3923:"i18n-39",3949:"i18n-36",3951:"i18n-109",3968:"i18n-17",4026:"i18n-40",4060:"i18n-21",4101:"i18n-139",4103:"i18n-23",4164:"menu-md1",4176:"i18n-116",4178:"i18n-19",4466:"i18n-56",4518:"i18n-82",4634:"i18n-29",4653:"i18n-120",4667:"i18n-15",4863:"i18n-90",4984:"i18n-119",5012:"i18n-7",5123:"i18n-20",5151:"i18n-4",5215:"i18n-2",5235:"i18n-140",5352:"i18n-137",5380:"i18n-1",5389:"i18n-121",5528:"i18n-27",5624:"i18n-42",5818:"i18n-37",5825:"i18n-118",5928:"i18n-48",5929:"i18n-75",5954:"i18n-24",6020:"i18n-54",6099:"i18n-57",6115:"emote-cards",6169:"i18n-73",6190:"i18n-130",6199:"i18n-126",6512:"i18n-108",6530:"regex",6633:"i18n-47",6644:"i18n-34",6757:"i18n-12",6782:"i18n-127",6858:"i18n-135",6881:"i18n-89",6903:"i18n-80",6960:"i18n-46",6993:"i18n-58",6994:"i18n-63",7003:"i18n-113",7007:"i18n-50",7063:"i18n-51",7087:"i18n-105",7168:"i18n-25",7409:"i18n-60",7479:"i18n-101",7485:"vue",7629:"menu-md0",7953:"i18n-94",8111:"i18n-13",8124:"i18n-78",8163:"menu-md5",8256:"i18n-129",8302:"i18n-67",8555:"i18n-76",8586:"overrides",8638:"i18n-138",8700:"i18n-103",8705:"i18n-99",8723:"i18n-106",8733:"i18n-53",8736:"i18n-10",8744:"i18n-68",8753:"i18n-86",8757:"i18n-8",8898:"i18n-136",8919:"i18n-115",8996:"i18n-85",9040:"i18n-45",9047:"i18n-114",9082:"i18n-14",9238:"i18n-133",9248:"i18n-18",9418:"i18n-69",9442:"vue-chat",9495:"i18n-97",9627:"i18n-49",9663:"i18n-96",9701:"i18n-74",9706:"i18n-59",9724:"i18n-95",9797:"i18n-107",9872:"i18n-117"}[ge]||ge)+".js",Q.h=()=>"76313c69f0d0df3a2768",Q.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),Q.o=(ge,te)=>Object.prototype.hasOwnProperty.call(ge,te),(()=>{var ge={},te="frankerfacez:";Q.l=(S,K,P,L)=>{if(ge[S]){ge[S].push(K);return}var I,W;if(P!==void 0)for(var x=document.getElementsByTagName("script"),m=0;m<x.length;m++){var b=x[m];if(b.getAttribute("src")==S||b.getAttribute("data-webpack")==te+P){I=b;break}}I||(W=!0,I=document.createElement("script"),I.charset="utf-8",I.timeout=120,Q.nc&&I.setAttribute("nonce",Q.nc),I.setAttribute("data-webpack",te+P),I.src=S,I.src.indexOf(window.location.origin+"/")!==0&&(I.crossOrigin="anonymous")),ge[S]=[K];var c=B((f,r)=>{I.onerror=I.onload=null,clearTimeout(d);var g=ge[S];if(delete ge[S],I.parentNode&&I.parentNode.removeChild(I),g&&g.forEach(u=>u(r)),f)return f(r)},"onScriptComplete"),d=setTimeout(c.bind(null,void 0,{type:"timeout",target:I}),12e4);I.onerror=c.bind(null,I.onerror),I.onload=c.bind(null,I.onload),W&&document.head.appendChild(I)}})(),Q.r=ge=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ge,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ge,"__esModule",{value:!0})},Q.j=8102,(()=>{var ge;Q.g.importScripts&&(ge=Q.g.location+"");var te=Q.g.document;if(!ge&&te&&(te.currentScript&&(ge=te.currentScript.src),!ge)){var S=te.getElementsByTagName("script");if(S.length)for(var K=S.length-1;K>-1&&!ge;)ge=S[K--].src}if(!ge)throw new Error("Automatic publicPath is not supported in this browser");ge=ge.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),Q.p=ge})(),(()=>{var ge={8102:0,2682:0};Q.f.j=(K,P)=>{var L=Q.o(ge,K)?ge[K]:void 0;if(L!==0)if(L)P.push(L[2]);else{var I=new Promise((b,c)=>L=ge[K]=[b,c]);P.push(L[2]=I);var W=Q.p+Q.u(K),x=new Error,m=B(b=>{if(Q.o(ge,K)&&(L=ge[K],L!==0&&(ge[K]=void 0),L)){var c=b&&(b.type==="load"?"missing":b.type),d=b&&b.target&&b.target.src;x.message="Loading chunk "+K+` failed.
(`+c+": "+d+")",x.name="ChunkLoadError",x.type=c,x.request=d,L[1](x)}},"loadingEnded");Q.l(W,m,"chunk-"+K,K)}};var te=B((K,P)=>{var[L,I,W]=P,x,m,b=0;if(L.some(d=>ge[d]!==0)){for(x in I)Q.o(I,x)&&(Q.m[x]=I[x]);if(W)var c=W(Q)}for(K&&K(P);b<L.length;b++)m=L[b],Q.o(ge,m)&&ge[m]&&ge[m][0](),ge[m]=0},"webpackJsonpCallback"),S=globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[];S.forEach(te.bind(null,0)),S.push=te.bind(null,S.push.bind(S))})();var fr={};(()=>{var wi,ki;"use strict";var ge={};Q.r(ge),Q.d(ge,{to_float:()=>V,to_int:()=>G});var te={};Q.r(te),Q.d(te,{process_to_float:()=>ae,process_to_int:()=>re});var S={};Q.r(S),Q.d(S,{AddonDebug:()=>Ye,And:()=>le,Category:()=>Wt,Channel:()=>Ht,Constant:()=>we,Debug:()=>Ke,Fullscreen:()=>Ie,If:()=>oe,Invert:()=>ie,Moderator:()=>Ve,Monitor:()=>ue,NativeDarkTheme:()=>wt,Or:()=>ze,Page:()=>zt,SquadMode:()=>it,TheaterMode:()=>Oe,Time:()=>Be,Title:()=>ye});var K={};Q.r(K),Q.d(K,{Everything:()=>Se,Experiments:()=>H,FavoriteEmotes:()=>U,HiddenEmotes:()=>j,Overrides:()=>ee,Profiles:()=>he});var P={};Q.r(P),Q.d(P,{AddonEmotes:()=>kn,AutomoddedTerms:()=>vn,BadgeStuff:()=>_n,BlockedTerms:()=>yn,BlockedUsers:()=>mn,CheerEmotes:()=>wn,CustomHighlights:()=>bn,Emoji:()=>Sn,FilterTester:()=>hn,Links:()=>es,Mentions:()=>fn,Replies:()=>un,TwitchEmotes:()=>Cn,UserHighlights:()=>pn});var L={};Q.r(L),Q.d(L,{Links:()=>xn});var I={};Q.r(I),Q.d(I,{Clip:()=>Rn,User:()=>On,Video:()=>$n});var W={};Q.r(W),Q.d(W,{ban:()=>Gn,chat:()=>Hn,copy_message:()=>jn,edit_overrides:()=>Nn,mod:()=>qn,msg_delete:()=>Wn,open_url:()=>Un,pin:()=>In,reply:()=>Ln,timeout:()=>Vn,toggle_profile:()=>Jn,unban:()=>Zn,unmod:()=>Yn,untimeout:()=>Kn,whisper:()=>Xn});var x={};Q.r(x),Q.d(x,{combo:()=>sr,dynamic:()=>Qn,emote:()=>tr,icon:()=>ir,image:()=>nr,text:()=>er});var m=Q(51722),b=Q.n(m),c=Q(55467),d=Q(22527),f=Q(24431),r=Q(46949),g=Q(20857),u=Q(81011),w=Q(17159);const z=Symbol("default"),F={basic:{get(k,e){for(const i of e)if(i.has(k))return[i.get(k),[i.id]]}},object_merge:{get(k,e,i,s){const n=[],o=[];for(const h of e)if(h.has(k)){const _=h.get(k);if(!_||typeof _!="object"){s.warn(`Profile #${h.id} has an invalid value for "${k}" of type ${typeof _}. Skipping.`);continue}o.push(h.id),n.unshift(_)}if(o.length)return[Object.assign({},...n),o]}},basic_array_merge:{get(k,e,i,s){const n=[],o=[];for(const h of e)if(h.has(k)){const _=h.get(k);if(!Array.isArray(_)){s.warn(`Profile #${h.id} has an invalid value for "${k}"`);continue}o.push(h.id);for(const E of _)n.push(E)}if(o.length)return[n,o]}},array_merge:{default(k){const e=[];for(const i of k)i.t!=="inherit"&&i.t!=="skip"&&i.v&&e.push(i.v);return e},get(k,e,i,s,n){const o=[],h=[];let _=[],E=!1,R=e;i.inherit_default&&(R=[...e,z]);for(const T of R){let N;if(T===z)N=i.default,typeof N=="function"&&(N=N(n));else if(T.has(k))N=T.get(k);else continue;if(!Array.isArray(N)){T!==z&&s.warn(`Profile #${T.id} has an invalid value for "${k}" of type ${typeof N}. Skipping.`);continue}const Y=[];T!==z&&h.push(T.id);let ce=!1;for(const me of N)if(E=!0,me.t==="inherit")ce=!0;else{if(me.t==="skip")continue;ce?Y.push(me.v):o.push(me.v)}if(_=Y.concat(_),!ce&&!i.always_inherit)break}if(E)return[o.concat(_),h]}}};function A(k,e,i){if(!k||!Array.isArray(k.requires))return!1;for(const s of k.requires){const n=i.get(s),o=e.get(s);if(typeof n!=typeof o)return!0;if(Array.isArray(n)&&Array.isArray(o)){if(!(0,r.array_equals)(o,n))return!0}else if(o instanceof Set&&n instanceof Set){if(!(0,r.set_equals)(o,n))return!0}else if(o instanceof Map&&n instanceof Map){if(!(0,r.map_equals)(o,n))return!0}else if(o!==n)return!0}return!1}B(A,"compare_requirements");const Ai=class Ai extends w.EventEmitter{constructor(e,i){super(),this.__context=null,e instanceof Ai?(this.parent=e,this.manager=e.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=e),this.manager.__contexts.push(this),this._context=i||{},this.__ls_listening=!1,this.__ls_wanted=new Map,this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const s of this.__profiles)s.off("changed",this._onChanged,this);const e=this.manager.__contexts,i=e.indexOf(this);i!==-1&&e.splice(i,1)}_watchLS(){this.__ls_listening||(this.__ls_listening=!0,this.manager.on(":ls-update",this._onLSUpdate,this))}_unwatchLS(){this.__ls_listening&&(this.__ls_listening=!1,this.manager.off(":ls-update",this._onLSUpdate,this))}_onLSUpdate(e){const i=this.__ls_wanted.get(`ls.${e}`);if(i)for(const s of i)this._update(s,s,[])}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const e=[],i=this.order=[];if(!this.manager.disable_profiles)for(const n of this.manager.__profiles)n.toggled&&n.matches(this.__context)&&(e.push(n),i.push(n.id));if((0,r.array_equals)(this.__profiles,e))return!1;const s=new Set;for(const n of this.__profiles)e.includes(n)||(n.off("changed",this._onChanged,this),s.add(n.id));for(const n of e)this.__profiles.includes(n)||(n.on("changed",this._onChanged,this),s.add(n.id));return this.__profiles=e,this.emit("profiles_changed"),this.rebuildCache(),!0}rebuildCache(){const e=this.__cache,i=this.__meta,s=this.__meta=new Map;this.__cache=new Map;for(const[n,o]of e){const h=this.get(n),_=s.get(n),E=i.get(n),R=_?_.uses:null,T=E?E.uses:null,N=this.manager.definitions.get(n);let Y=!1;!Array.isArray(N)&&N?.equals?N.equals==="requirements"?Y=A(N,this.__cache,e):typeof N.equals=="function"&&(Y=!N.equals(h,o,this.__cache,e)):Array.isArray(h)&&Array.isArray(o)?Y=!(0,r.array_equals)(h,o):h instanceof Set&&o instanceof Set?Y=!(0,r.set_equals)(h,o):h instanceof Map&&o instanceof Map?Y=!(0,r.map_equals)(h,o):h!==o&&(Y=!0),Y&&(this.emit("changed",n,h,o),this.emit(`changed:${n}`,h,o)),(0,r.array_equals)(R,T)||(this.emit("uses_changed",n,R,T),this.emit(`uses_changed:${n}`,R,T))}}context(e){return new Ai(this,e)}updateContext(e){let i=!1;for(const s in e)if((0,r.has)(e,s)){const n=e[s];try{if((0,r.deep_equals)(n,this._context[s]))continue}catch{}this._context[s]=n,i=!0}i&&this._rebuildContext()}setContext(e){this._context={},this.updateContext(e)}_onChanged(e){this._update(e,e,[])}_update(e,i,s){if(this.__cache.has(e)){if(s.includes(e))throw new Error(`cyclic dependent chain when updating setting "${i}"`)}else return;s.push(e);const n=this.__cache.get(e),o=this.__meta.get(e),h=this._get(e,e,[]),_=this.__meta.get(e),E=o?o.uses:null,R=_?_.uses:null;if((0,r.array_equals)(R,E)||(this.emit("uses_changed",e,R,E),this.emit(`uses_changed:${e}`,R,E)),n===h)return;this.emit("changed",e,h,n),this.emit(`changed:${e}`,h,n);const T=this.manager.definitions.get(e);if(!Array.isArray(T)&&T?.required_by)for(const N of T.required_by)!N.startsWith("context.")&&!N.startsWith("ls.")&&this._update(N,i,Array.from(s))}_get(e,i,s){if(s.includes(e))throw new Error(`cyclic dependency when resolving setting "${i}"`);s.push(e);const n=this.manager.definitions.get(e),o=!Array.isArray(n)&&n?.type,h=o?F[o]:F.basic;if(!h)throw new Error(`non-existent setting type "${o}"`);const _=this._getRaw(e,h),E={uses:_?_[1]:null};let R=_?_[0]:void 0;if(n){if(Array.isArray(n))throw new Error(`non-existent setting "${e}" required when resolving setting "${i}"`);if(E.uses===null){const T=n.default;typeof T=="function"?R=T(this):R=T,h.default&&(R=h.default(R,n,this.manager.log))}if(n.requires)for(const T of n.requires)if(T.startsWith("ls.")){this._watchLS();let N=this.__ls_wanted.get(T);N||this.__ls_wanted.set(T,N=new Set),N.add(e)}else!T.startsWith("context.")&&!this.__cache.has(T)&&this._get(T,i,Array.from(s));n.process&&(R=n.process(this,R,E))}return this.__cache.set(e,R),this.__meta.set(e,E),R}*profiles(){for(const e of this.__profiles)yield e}hasProfile(e){if(typeof e=="number"){for(const i of this.__profiles)if(i.id===e)return!0;return!1}return this.__profiles.includes(e)}_getRaw(e,i){if(!i)throw new Error(`non-existent type for ${e}`);return i.get(e,this.profiles(),this.manager.definitions.get(e),this.manager.log,this)}update(e){this._update(e,e,[])}get(e){return e.startsWith("ls.")?this.manager.getLS(e.slice(3)):e.startsWith("context.")?(0,r.get)(e.slice(8),this.__context):this.__cache.has(e)?this.__cache.get(e):this._get(e,e,[])}getChanges(e,i,s){this.onChange(e,i,s),i.call(s,this.get(e),void 0)}onChange(e,i,s){this.on(`changed:${e}`,i,s)}uses(e){return e.startsWith("ls.")||e.startsWith("context.")?null:(this.__meta.has(e)||this._get(e,e,[]),this.__meta.get(e)?.uses??null)}};B(Ai,"SettingsContext");let D=Ai;const O=Symbol("BAD");function J(k,e,i){if((typeof k!="number"||isNaN(k)||!isFinite(k))&&(k=O),k!==O){const s=i.bounds;Array.isArray(s)&&(s.length>=3?((s[1]?k<s[0]:k<=s[0])||(s[3]?k>s[2]:k>=s[2]))&&(k=O):s.length===2?typeof s[1]=="boolean"?(s[1]?k<s[0]:k<=s[0])&&(k=O):(k<s[0]||k>s[1])&&(k=O):s.length===1&&k<s[0]&&(k=O))}return k===O?e:k}B(J,"do_number");const G=B((k,e,i)=>(typeof k=="string"&&/^-?\d+$/.test(k)?k=parseInt(k,10):typeof k!="number"&&(k=O),J(k,e,i)),"to_int"),V=B((k,e,i)=>(typeof k=="string"&&/^-?[\d.]+$/.test(k)?k=parseFloat(k):typeof k!="number"&&(k=O),J(k,e,i)),"to_float");function q(k,e){if(typeof k!="number"||isNaN(k)||!isFinite(k))return!1;const i=e.bounds;if(Array.isArray(i)){if(i.length>=3){if((i[1]?k<i[0]:k<=i[0])||(i[3]?k>i[2]:k>=i[2]))return!1}else if(i.length===2){if(typeof i[1]=="boolean"){if(i[1]?k<i[0]:k<=i[0])return!1}else if(k<i[0]||k>i[1])return!1}else if(i.length===1&&k<i[0])return!1}return!0}B(q,"validators_do_number");const re=B((k,e)=>{if(typeof k=="string"&&/^-?\d+$/.test(k))k=parseInt(k,10);else if(typeof k!="number")return!1;return q(k,e)},"process_to_int"),ae=B((k,e)=>{if(typeof k=="string"&&/^-?[\d.]+$/.test(k))k=parseFloat(k);else if(typeof k!="number")return!1;return q(k,e)},"process_to_float");var fe=Q(37087);let be=null;function Pe(k){Q.e(6530).then(Q.t.bind(Q,28820,23)).then(e=>{be=e.default,k&&k()})}B(Pe,"loadSafety");const ne=B(()=>!1,"NeverMatch"),ie={createTest(k,e,i){return(0,fe.createTester)(k,e,!0,!1,i)},maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,9786))},le={createTest(k,e,i){return(0,fe.createTester)(k,e,!1,!1,i)},childRules:!0,tall:!0,title:"And",i18n:"settings.filter.and",default:()=>[],editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,9786))},ze={createTest(k,e,i){return(0,fe.createTester)(k,e,!1,!0,i)},childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,9786))},oe={createTest(k,e,i){const s=(0,fe.createTester)(k[0],e,!1,!1,i),n=(0,fe.createTester)(k[1],e,!1,!1,i),o=(0,fe.createTester)(k[2],e,!1,!1,i);return h=>s(h)?n(h):o(h)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,17907))},we={createTest(k){return k?()=>!0:ne},title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))};function Te(k){if(typeof k!="string"||!k.length)return null;const e=k.indexOf(":");if(e===-1)return null;let i,s;try{i=parseInt(k.slice(0,e),10),s=parseInt(k.slice(e+1),10)}catch{return null}return i*60+s}B(Te,"parseTime");const Be={_captured:new Set,createTest(k){const e=Te(k[0]),i=Te(k[1]);return e==null||i==null?ne:e<=i?()=>{Be._captured.add(e),Be._captured.add(i+1);const s=new Date,n=s.getHours()*60+s.getMinutes();return n>=e&&n<=i}:()=>{Be._captured.add(e+1),Be._captured.add(i);const s=new Date,n=s.getHours()*60+s.getMinutes();return n>=e||n<=i}},captured:()=>{const k=Array.from(Be._captured);return Be._captured=new Set,k.sort((e,i)=>e-i),k},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,64e3))},Oe={createTest(k){return e=>e.fullscreen?k===!1:e.ui?.theatreModeEnabled===k},title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},Ie={createTest(k){return e=>e.fullscreen===k},title:"Fullscreen",i18n:"settings.filter.fullscreen",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},Ve={createTest(k){return e=>e.moderator===k},title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},Ke={createTest(k){return()=>f.DEBUG===k},title:"Is Developer Mode",i18n:"settings.filter.dev",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},Ye={createTest(k){return e=>e.addonDev==k},title:"Is Addon Developer Mode",i18n:"settings.filter.addon-dev",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},it={createTest(k){return e=>e.ui?.squadModeEnabled===k},title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},wt={createTest(k){const e=k?1:0;return i=>i.ui?.theme===e},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))},zt={createTest(k){if(!k)return ne;const e=k.route,i=[];if(Object.keys(k.values).length){const s=window.FrankerFaceZ?.get(),n=s&&s.resolve("site.router");if(!n)return ne;const o=n.getRoute(e);if(!o||!o.parts)return ne;let h=1;for(const _ of o.parts)if(typeof _=="object"){const E=k.values[_.name];E&&E.length&&i.push([h,E.toLowerCase()]),h++}}return s=>{if(!s.route||!s.route_data||s.route.name!==e)return!1;for(const[n,o]of i){let h=s.route_data[n];if(typeof h=="string"&&(h=h.toLowerCase()),h!==o)return!1}return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,38961))},Ht={createTest(k){const e=k?.login,i=k?.id;if(!i&&!e)return ne;if(i){if(!e)return s=>s.channelID===i}else return s=>s.channel===e;return s=>s.channelID===i||s.channelID==null&&s.channel===e},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,69370))},Wt={createTest(k){const e=k?.name,i=k?.id;if(!i&&!e)return ne;if(i){if(!e)return s=>s.categoryID===i}else return s=>s.category===e;return s=>s.categoryID===i||s.categoryID==null&&s.category===e},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,94344))},ye={createTest(k,e,i){const s=k?.mode;let n=k?.title,o=!0;if(!n||!s)return ne;if(s==="text")n=(0,r.escape_regex)(n),o=!1;else if(s==="glob")n=(0,r.glob_to_regex)(n);else if(s!=="raw")return ne;if(o&&(be||Pe(i),!be||!be(n)))return ne;let h;try{h=new RegExp(n,`g${k.sensitive?"":"i"}`)}catch{return ne}return _=>(h.lastIndex=0,_.title?h.test(_.title):!1)},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,43922))};let ue=null;window.getScreenDetails&&(ue={_used:!1,details:void 0,used:()=>{const k=ue._used;return ue._used=!1,k},createTest(k,e,i){if(!k?.label)return ne;if(ue._used=!0,i&&ue.details===void 0){const s=window.FrankerFaceZ??window.FFZBridge,n=s?.get(),o=n?.resolve("settings");o&&o.createMonitorUpdate().then(()=>{i()})}return()=>{ue._used=!0;const s=ue.details;if(!s)return!1;const n=s.screens;return(0,r.matchScreen)(n,k)===s.currentScreen}},default:()=>({label:null}),title:"Current Monitor",i18n:"settings.filter.monitor",editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,57049))});var xe=Q(38626);const Re=1,He=window.location.host!=="www.twitch.tv",Ze=window.location.host!=="www.youtube.com",as=class as extends w.EventEmitter{constructor(e){super(),this.ready=!1,this.manager=e,this.disabled=!1}static supported(){return!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get allowTransfer(){return this.constructor.allowTransfer}get shouldUpdate(){return this.constructor.shouldUpdate}};B(as,"SettingsProvider");let qe=as;qe.priority=0,qe.allowTransfer=!0,qe.shouldUpdate=!0;const ls=class ls extends qe{get supportsBlobs(){return!0}isValidBlob(e){return this.supportsBlobs&&(0,xe.isValidBlob)(e)}};B(ls,"AdvancedSettingsProvider");let st=ls;const cs=class cs extends st{constructor(e){super(e),this._start_time=performance.now(),this._rpc=new Map,this._cached=new Map,this.resolved_ready=!1,this.ready=!1,this._ready_wait=null,this._blobs=null,this._last_id=0}get supportsBlobs(){return this._blobs??!1}broadcastTransfer(){}disableEvents(){}resolveReady(e,i){this.manager&&this.manager.log.info(`${this.constructor.name} ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.resolved_ready=!0,this.ready=e,e&&this._ready_wait_resolve?this._ready_wait_resolve():!e&&this._ready_wait_fail&&this._ready_wait_fail(i)}awaitReady(){return this.resolved_ready?this.ready?Promise.resolve():Promise.reject():this._ready_wait?this._ready_wait:this._ready_wait=new Promise((e,i)=>{this._ready_wait_resolve=e,this._ready_wait_fail=i}).finally(()=>{this._ready_wait=null,this._ready_wait_resolve=null,this._ready_wait_fail=null})}get(e,i){return this._cached.has(e)?this._cached.get(e):i}set(e,i){if(i===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,i),this.rpc({ffz_type:"set",key:e,value:i}).catch(s=>this.manager.log.error("Error setting value",s)),this.emit("set",e,i,!1)}delete(e){this._cached.delete(e),this.rpc({ffz_type:"delete",key:e}).catch(i=>this.manager.log.error("Error deleting value",i)),this.emit("set",e,void 0,!0)}clear(){const e=this._cached;this._cached=new Map;for(const i of e.keys())this.emit("changed",i,void 0,!0);this.rpc("clear").catch(i=>this.manager.log.error("Error clearing storage",i))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}entries(){return this._cached.entries()}get size(){return this._cached.size}async flush(){await this.rpc("flush")}async getBlob(e){const i=await this.rpc({ffz_type:"get-blob",key:e});return i?(0,xe.deserializeBlob)(i):null}async setBlob(e,i){await this.rpc({ffz_type:"set-blob",key:e,value:await(0,xe.serializeBlob)(i)})}async deleteBlob(e){await this.rpc({ffz_type:"delete-blob",key:e})}async hasBlob(e){return this.rpc({ffz_type:"has-blob",key:e})}async clearBlobs(){await this.rpc("clear-blobs")}async blobKeys(){return this.rpc("blob-keys")}rpc(e,i){const s=++this._last_id;return new Promise((n,o)=>{this._rpc.set(s,[n,o]);let h;typeof e=="string"?h={ffz_type:e}:h=e,h.id=s,this.send(h,i)})}handleMessage(e){e.ffz_type==="ready"?this.rpc("init-load").then(i=>{this._blobs=i.blobs;for(const[s,n]of Object.entries(i.values))this._cached.set(s,n);this.resolveReady(!0)}).catch(i=>{this.resolveReady(!1,i)}):e.ffz_type==="change"?this.onChange(e):e.ffz_type==="change-blob"?this.emit("changed-blob",e.key,e.deleted):e.ffz_type==="clear-blobs"?this.emit("clear-blobs"):e.ffz_type==="reply"||e.ffz_type==="reply-error"?this.onReply(e):this.manager.log.warn("Unknown Message",e.ffz_type,e)}onChange(e){const i=e.key,s=e.value;e.deleted?(this._cached.delete(i),this.emit("changed",i,void 0,!0)):(this._cached.set(i,s),this.emit("changed",i,s,!1))}onReply(e){const i=e.id,s=e.ffz_type==="reply",n=this._rpc.get(i);if(!n)return this.manager.log.warn("Received reply for unknown ID",i);this._rpc.delete(i),s?n[0](e.reply):n[1]()}};B(cs,"RemoteSettingsProvider");let xt=cs;const hs=class hs extends qe{constructor(e,i){super(e),this.prefix=i=i??"FFZ:setting:";const s=this._cached=new Map,n=i.length;for(const o in localStorage)if((0,r.has)(localStorage,o)&&o.startsWith(i)){const h=localStorage.getItem(o);if(h)try{s.set(o.slice(n),JSON.parse(h))}catch{this.manager.log.warn(`unable to parse value for ${o}`,h)}}this.ready=!0,window.BroadcastChannel?(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)):window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}static supported(){return!0}static hasContent(e){e||(e="FFZ:setting:");for(const i in localStorage)if(i.startsWith(e)&&(0,r.has)(localStorage,i))return!0;return!1}broadcastTransfer(){this.broadcast({type:"change-provider"})}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}destroy(){this.disable(),this._cached.clear()}disable(){this.removeListeners(),this.disabled=!0}flush(){}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager.log.debug("storage broadcast event",e.data);const{type:i,key:s}=e.data;if(i==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(i==="set"){const n=JSON.parse(localStorage.getItem(this.prefix+s)??"null");this._cached.set(s,n),this.emit("changed",s,n,!1)}else if(i==="delete")this._cached.delete(s),this.emit("changed",s,void 0,!0);else if(i==="clear"){const n=Array.from(this._cached.keys());this._cached.clear();for(const o of n)this.emit("changed",o,void 0,!0)}}handleStorage(e){if(!this.disabled&&(this.manager.log.debug("storage event",e),e.storageArea===localStorage&&e.key&&e.key.startsWith(this.prefix))){const i=e.key.slice(this.prefix.length);let s=e.newValue;s===null?(this._cached.delete(i),this.emit("changed",i,void 0,!0)):(s=JSON.parse(s),this._cached.set(i,s),this.emit("changed",i,s,!1))}}get(e,i){return this._cached.has(e)?this._cached.get(e):i}set(e,i){if(!this.disabled){if(i===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,i);try{localStorage.setItem(this.prefix+e,JSON.stringify(i))}catch(s){throw this.manager&&this.manager.log.error(`An error occurred while trying to save a value to localStorage for key "${this.prefix+e}"`),s&&/quota/i.test(s.toString())&&this.emit("quota-exceeded",s),s}this.broadcast({type:"set",key:e}),this.emit("set",e,i,!1)}}delete(e){this.disabled||(this._cached.delete(e),localStorage.removeItem(this.prefix+e),this.broadcast({type:"delete",key:e}),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const i of e.keys())localStorage.removeItem(this.prefix+i),this.emit("changed",i,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}};B(hs,"LocalStorageProvider");let Kt=hs;Kt.priority=-1e3,Kt.title="Local Storage",Kt.description="[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.";const us=class us extends st{constructor(e,i=!0){super(e),this._last_tx=0,this.getDB=(0,r.once)(this.getDB),this._start_time=performance.now(),this._pending=new Set,this._flush_wait=null,this._lock=new r.TicketLock,this._cached=new Map,this.ready=!1,this._ready_wait=null,i&&(window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._ready_wait=this.loadSettings().then(()=>{this.manager&&this.manager.log.info(`IDB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.ready=!0}).catch(s=>{this.manager&&this.manager.log.error(`IDB failed after ${(performance.now()-this._start_time).toFixed(5)}ms:`,s),this.ready=!1}).finally(()=>{this._ready_wait=null}))}static supported(){return window.indexedDB!=null}static hasContent(){return new Promise(e=>{const i=window.indexedDB.open("FFZ",Re);i.onerror=()=>e(!1),i.onupgradeneeded=s=>{s.target instanceof IDBRequest&&s.target.transaction?.abort(),e(!1)},i.onsuccess=()=>{const s=i.result;let n;try{n=s.transaction(["settings"],"readonly").objectStore("settings")}catch{return e(!1)}const o=n.getAllKeys();o.onerror=()=>{s.close(),e(!1)},o.onsuccess=()=>{const h=Array.isArray(o.result)&&o.result.length>0;return s.close(),e(h)}}})}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this.removeListeners(),this.db&&(this.db.close(),this.db=null)}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null)}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}_onStart(e){this._pending||(this._pending=new Set),this._pending.add(e)}_onFinish(e){this._pending&&(this._pending.delete(e),this._pending.size)||this._flush_wait_resolve&&this._flush_wait_resolve()}flush(){return this._flush_wait?this._flush_wait:!this._pending||!this._pending.size?Promise.resolve():this._flush_wait=new Promise(e=>{this._flush_wait_resolve=e}).finally(()=>{this._flush_wait_resolve=null,this._flush_wait=null})}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager&&this.manager.log.debug("storage broadcast event",e.data);const{type:i,key:s}=e.data;if(i==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(i==="set")this._get(s).then(n=>{this._cached.set(s,n),this.emit("changed",s,n,!1)}).catch(n=>this.manager&&this.manager.log.error(`Error getting setting "${s}" from database`,n));else if(i==="delete")this._cached.delete(s),this.emit("changed",s,void 0,!0);else if(i==="clear"){const n=Array.from(this._cached.keys());this._cached.clear();for(const o of n)this.emit("changed",o,void 0,!0)}else i==="set-blob"?this.emit("changed-blob",s,!1):i==="delete-blob"?this.emit("changed-blob",s,!0):i==="clear-blobs"&&this.emit("clear-blobs")}awaitReady(){return this._ready_wait?this._ready_wait:this.ready?Promise.resolve():Promise.reject()}get(e,i){return this._cached.has(e)?this._cached.get(e):i}set(e,i){if(!this.disabled){if(i===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,i),this._set(e,i).then(()=>this.broadcast({type:"set",key:e})).catch(s=>this.manager&&this.manager.log.error(`Error saving setting "${e}" to database`,s)),this.emit("set",e,i,!1)}}delete(e){this.disabled||(this._cached.delete(e),this._delete(e).catch(i=>this.manager&&this.manager.log.error(`Error deleting setting "${e}" from database`,i)).then(()=>this.broadcast({type:"delete",key:e})),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const i of e.keys())this.emit("changed",i,void 0,!0);this._clear().catch(i=>this.manager&&this.manager.log.error("Error clearing database",i)).then(()=>this.broadcast({type:"clear"}))}entries(){return this._cached.entries()}get size(){return this._cached.size}getDB(e=!1){if(this.db)return Promise.resolve(this.db);if(this._db_wait)return this._db_wait;let i;return this._db_wait=i=new Promise((s,n)=>{const o=window.indexedDB.open("FFZ",Re);this._onStart(o),o.onerror=h=>{this.manager&&this.manager.log.error("Error opening database.",h),n(h),this._onFinish(o)},o.onupgradeneeded=h=>{this.manager&&this.manager.log.info(`Upgrading database from version ${h.oldVersion} to ${Re}`);const _=o.result;_.createObjectStore("settings",{keyPath:"k"}),_.createObjectStore("blobs")},o.onsuccess=()=>{this.manager&&this.manager.log.info(`Database opened. (After: ${(performance.now()-this._start_time).toFixed(5)}ms)`),this.db=o.result;try{const h=this.db.transaction(["settings","blobs"],"readonly");h.objectStore("settings"),h.objectStore("blobs")}catch(h){this.manager&&this.manager.log.error("Database in invalid state.",h);try{this.db.close()}catch{}if(this._onFinish(o),this.db=null,e)n(h);else{const _=window.indexedDB.deleteDatabase("FFZ");this._onStart(_),_.onerror=E=>{this.manager&&this.manager.log.error("Error deleting invalid database.",E),n(E),this._onFinish(_)},_.onsuccess=()=>{this.manager&&this.manager.log.info("Deleted invalid database."),this._onFinish(_),this._db_wait=null,this.getDB(!0).then(s).catch(n)}}return}s(this.db),this._onFinish(o)}}).finally(()=>{i===this._db_wait&&(this._db_wait=null)})}async loadSettings(){const e=await this.getDB(),i=e.transaction(["settings"],"readonly"),s=i.objectStore("settings"),n=this._last_tx++;return this._onStart(n),new Promise((o,h)=>{i.onabort=E=>{this.manager&&this.manager.log.error("Transaction aborted reading settings from database.",E),this._onFinish(n),h()};const _=s.getAll();_.onsuccess=()=>{for(const E of _.result)this._cached.set(E.k,E.v);this._onFinish(n),o()},_.onerror=E=>{this.manager&&this.manager.log.error("Error reading settings from database.",E),this._onFinish(n),h()}})}async _getKeys(){const e=await this.getDB(),i=e.transaction(["settings"],"readonly"),s=i.objectStore("settings"),n=this._last_tx++;return this._onStart(n),new Promise((o,h)=>{i.onabort=E=>{this.manager&&this.manager.log.error("Transaction aborted reading keys from database.",E),this._onFinish(n),h()};const _=s.getAllKeys();_.onsuccess=()=>{this._onFinish(n),o(_.result)},_.onerror=E=>{this.manager&&this.manager.log.error("Error reading keys from database.",E),this._onFinish(n),h()}})}async _get(e){const i=await this.getDB(),s=i.transaction(["settings"],"readonly"),n=s.objectStore("settings"),o=this._last_tx++;return this._onStart(o),new Promise((h,_)=>{s.onabort=R=>{this.manager&&this.manager.log.error("Transaction aborted reading value from database.",R),this._onFinish(o),_()};const E=n.get(e);E.onerror=R=>{this.manager&&this.manager.log.error("Error reading value from database.",R),this._onFinish(o),_()},E.onsuccess=()=>{this._onFinish(o),h(E.result.v)}})}async _set(e,i){if(this.disabled)return;const s=this._last_tx++;this._onStart(s);const n=await this._lock.wait(),o=await this.getDB(),h=o.transaction(["settings"],"readwrite"),_=h.objectStore("settings");return new Promise((E,R)=>{h.onabort=N=>{this.manager&&this.manager.log.error("Transaction aborted setting value to database.",N),n(),this._onFinish(s),R()};const T=_.put({k:e,v:i});T.onerror=N=>{this.manager&&this.manager.log.error("Error setting value to database.",N),n(),this._onFinish(s),R()},T.onsuccess=()=>{n(),this._onFinish(s),E()}})}async _delete(e){if(this.disabled)return;const i=this._last_tx++;this._onStart(i);const s=await this._lock.wait(),n=await this.getDB(),o=n.transaction(["settings"],"readwrite"),h=o.objectStore("settings");return new Promise((_,E)=>{o.onabort=T=>{this.manager&&this.manager.log.error("Transaction aborted deleting value from database.",T),s(),this._onFinish(i),E()};const R=h.delete(e);R.onerror=T=>{this.manager&&this.manager.log.error("Error deleting value from database.",T),s(),this._onFinish(i),E()},R.onsuccess=()=>{s(),this._onFinish(i),_()}})}async _clear(){if(this.disabled)return;const e=this._last_tx++;this._onStart(e);const i=await this._lock.wait(),s=await this.getDB(),n=s.transaction(["settings"],"readwrite"),o=n.objectStore("settings");return new Promise((h,_)=>{n.onabort=R=>{this.manager&&this.manager.log.error("Transaction aborted clearing database.",R),i(),this._onFinish(e),_()};const E=o.clear();E.onerror=R=>{this.manager&&this.manager.log.error("Error clearing database.",R),i(),this._onFinish(e),_()},E.onsuccess=()=>{i(),this._onFinish(e),h()}})}async getBlob(e){const i=await this.getDB(),s=i.transaction(["blobs"],"readonly"),n=s.objectStore("blobs");return new Promise((o,h)=>{const _=n.get(e);this._onStart(_),_.onerror=()=>{h(),this._onFinish(_)},_.onsuccess=E=>{(0,xe.isValidBlob)(_.result)?o(_.result):h(),this._onFinish(_)}})}async setBlob(e,i){if(this.disabled)return;if(!this.isValidBlob(i))throw new Error("Invalid blob type");const s=await this.getDB(),n=s.transaction(["blobs"],"readwrite"),o=n.objectStore("blobs");return new Promise((h,_)=>{const E=o.put(i,e);this._onStart(E),E.onerror=()=>{_(),this._onFinish(E)},E.onsuccess=()=>{h(),this.broadcast({type:"set-blob",key:e}),this.emit("set-blob",e,i,!1),this._onFinish(E)}})}async deleteBlob(e){if(this.disabled)return;const i=await this.getDB(),s=i.transaction(["blobs"],"readwrite"),n=s.objectStore("blobs");return new Promise((o,h)=>{const _=n.delete(e);this._onStart(_),_.onerror=()=>{h(),this._onFinish(_)},_.onsuccess=()=>{o(),this.broadcast({type:"delete-blob",key:e}),this.emit("set-blob",e,void 0,!0),this._onFinish(_)}})}async hasBlob(e){return(await this.blobKeys()).includes(e)}async clearBlobs(){if(this.disabled)return;const e=await this.getDB(),i=e.transaction(["blobs"],"readwrite"),s=i.objectStore("blobs");return new Promise((n,o)=>{const h=s.clear();this._onStart(h),h.onerror=()=>{o(),this._onFinish(h)},h.onsuccess=()=>{n(),this.broadcast({type:"clear-blobs"}),this._onFinish(h)}})}async blobKeys(){const e=await this.getDB(),i=e.transaction(["blobs"],"readonly"),s=i.objectStore("blobs");return new Promise((n,o)=>{const h=s.getAllKeys();this._onStart(h),h.onerror=()=>{o(),this._onFinish(h)},h.onsuccess=()=>{Array.isArray(h.result)?n(h.result):o(),this._onFinish(h)}})}};B(us,"IndexedDBProvider");let nt=us;nt.priority=10,nt.title="IndexedDB",nt.description="[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.";const l=(wi=class extends xt{constructor(e){super(e);const i=this.frame=document.createElement("iframe");i.src=this.manager.root.host==="youtube"?"//www.youtube.com/__ffz_bridge/":"//www.twitch.tv/p/ffz_bridge/",i.id="ffz-settings-bridge",i.style.width="0",i.style.height="0",this.onMessage=this.onMessage.bind(this),window.addEventListener("message",this.onMessage),document.body.appendChild(i)}static supported(){return He&&Ze}static hasContent(){return wi.supported()}broadcastTransfer(){}disableEvents(){}onMessage(e){const i=e.data;!i||!i.ffz_type||this.handleMessage(i)}send(e,i){typeof e=="string"&&(e={ffz_type:e});try{this.frame.contentWindow.postMessage(e,"*",i?Array.isArray(i)?i:[i]:void 0)}catch(s){this.manager.log.error("Error sending message to bridge.",s,e,i)}}},B(wi,"_CrossOriginStorageBridge2"),wi);l.priority=100,l.title="Cross-Origin Storage Bridge",l.description="This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don't want your settings to automatically synchronize for some reason.",l.allowTransfer=!1,l.shouldUpdate=!1;let p=l;const $=(ki=class extends xt{static supported(){return f.EXTENSION}static hasContent(){return ki.supported()?new Promise(e=>{let i=!1,s=null;const n=B(h=>{if(h.source===window&&h.data&&h.data.type==="ffz_from_ext"){const _=h.data.data;_?.ffz_type==="has-keys"&&(i=!0,e(_.value),o())}},"listener"),o=B(()=>{i||(i=!0,e(!1)),s&&(clearTimeout(s),s=null),window.removeEventListener("message",n)},"cleanup");window.addEventListener("message",n),window.postMessage({type:"ffz_to_ext",data:{ffz_type:"check-has-keys"}},"*"),s=setTimeout(o,1e3)}):!1}constructor(e){super(e),this.onExtMessage=this.onExtMessage.bind(this),window.addEventListener("message",this.onExtMessage)}broadcastTransfer(){}disableEvents(){}onExtMessage(e){e.source===window&&e.data?.type==="ffz_from_ext"&&e.data.data?.ffz_type&&this.handleMessage(e.data.data)}send(e,i){typeof e=="string"&&(e={ffz_type:e});try{window.postMessage({type:"ffz_to_ext",data:e},"*",i?Array.isArray(i)?i:[i]:void 0)}catch(s){this.manager.log.error("Error sending message to extension.",s,e,i)}}},B(ki,"_ExtensionProvider2"),ki);$.priority=101,$.title="Browser Extension Storage",$.description="This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.",$.allowTransfer=!0,$.shouldUpdate=!0;let M=null;const Z={local:Kt,idb:nt,cosb:p},H={label:"Experiment Overrides",keys:["exp-lock","experiment-overrides"]},j={label:"Hidden Emotes",keys(k){const e=["emote-menu.hidden-sets"];for(const i of k.keys())i.startsWith("hidden-emotes.")&&e.push(i);return e}},U={label:"Favorited Emotes",keys(k){const e=[];for(const i of k.keys())i.startsWith("favorite-emotes.")&&e.push(i);return e}},ee={label:"Name and Color Overrides",keys:["overrides.colors","overrides.names"]},he={label:"Profiles",clear(k,e){const i=["profiles"];for(const s of k.keys())/^p:\d+:/.test(s)&&i.push(s);for(const s of i)k.delete(s);e.loadProfiles()}},Se={label:"Absolutely Everything",async clear(k,e){k.clear(),k.supportsBlobs&&k instanceof st&&await k.clearBlobs(),e.loadProfiles()}};function De(k,e){try{return k.postMessage(e,"*"),!0}catch{return!1}}B(De,"postMessage");const Me=["session"],ds=class ds extends d.default{constructor(e,i){super(e,i),this.provider=null,this._active_provider="local",this.disable_profiles=!1,this.providers={};for(const[s,n]of Object.entries(Z))n.supported()&&(this.providers[s]=n);Object.seal(this.providers),this.updateSoon=(0,r.debounce)(()=>this.updateRoutes(),50,!1);try{const s=new URL(window.location).searchParams;s&&s.has("ffz-no-settings")&&(this.disable_profiles=!0)}catch{}this.__ls_scheduled=new Set,this.__ls_cache=new Map,this.__ls_hooked=!1,this._updateLS=this._updateLS.bind(this),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.__profile_uuids={},this.ui_structures=new Map,this.definitions=new Map,this.validators={};for(const s in te)(0,r.has)(te,s)&&(this.validators[s]=te[s]);this.processors={};for(const s in ge)(0,r.has)(ge,s)&&(this.processors[s]=ge[s]);this.clearables={};for(const s in K)(0,r.has)(K,s)&&(this.clearables[s]=K[s]);this.filters={};for(const s in S)(0,r.has)(S,s)&&S[s]&&(this.filters[s]=S[s]);this._createProvider().then(s=>{this.provider=s,this.log.info(`Using Provider: ${s.constructor.name}`),s.on("changed",this._onProviderChange,this),s.on("quota-exceeded",n=>{this.emit(":quota-exceeded")}),s.on("change-provider",()=>{this.emit(":change-provider")}),this._provider_resolve&&this._provider_resolve(s)}),this.main_context=new D(this),this.main_context.on("changed",(s,n,o)=>{this.emit(`:changed:${s}`,n,o)}),this.main_context.on("uses_changed",(s,n,o)=>{this.emit(`:uses_changed:${s}`,n,o)}),this.main_context.on("context_changed",()=>this._updateContextProxies()),this._context_proxies=new Set,window.addEventListener("message",s=>{const n=s.data?.ffz_type;n==="open-settings"?this.emit("main_menu:open"):n==="request-context"&&s.source&&(this._context_proxies.add(s.source),this._updateContextProxies(s.source))}),window.addEventListener("beforeunload",()=>{for(const s of this._context_proxies)De(s,{ffz_type:"context-gone"})}),this._start_time=performance.now(),this.enable()}_updateContextProxies(e){if(!e&&!this._context_proxies.size)return;const i=JSON.parse(JSON.stringify(this.main_context._context));for(const s of Me)(0,r.has)(i,s)&&delete i[s];if(e)De(e,{ffz_type:"context-update",ctx:i});else for(const s of this._context_proxies)De(s,{ffz_type:"context-update",ctx:i})}addFilter(e,i){if(this.filters[e])return this.log.warn("Tried to add already existing filter",e);this.filters[e]=i,this.updateRoutes()}getFilterBasicEditor(){return()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,47178))}generateLog(){const e=[];for(const[i,s]of this.main_context.__cache.entries())e.push(`${i}: ${JSON.stringify(s)}`);return e.join(`
`)}awaitProvider(){return this.provider?Promise.resolve(this.provider):this._provider_waiter?this._provider_waiter:this._provider_waiter=new Promise((e,i)=>{this._provider_resolve=e}).finally(()=>{this._provider_waiter=null,this._provider_resolve=null})}async onEnable(){if(await this.awaitProvider(),!this.provider)throw new Error("did not get provider");await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const i of this.__contexts)i.selectProfiles();const e=performance.now()-this._start_time;this.log.info(`Initialization complete after ${e.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}async createMonitorUpdate(){const e=S?.Monitor;if(!(!e||e.details!==void 0)){e.details=null;try{window.getScreenDetails?(e.details=await window.getScreenDetails(),e.details.addEventListener("currentscreenchange",()=>{for(const i of this.__contexts)i.selectProfiles()})):e.details=!1}catch(i){this.log.error("Unable to get monitor details",i),e.details=!1}}}updateClock(){const e=S?.Time?.captured?.();if(!e?.length)return;this._time_timer&&clearTimeout(this._time_timer);const i=new Date,s=i.getHours()*60+i.getMinutes();let n=this._time_next!=null?this._time_next:null;for(const h of e)h<=s||(n==null||h<n)&&(n=h);n==null&&(n=e[0]+1440);const o=(n-s)*60*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout(()=>{for(const h of this.__contexts)h.selectProfiles();this.updateClock()},o)}_updateLSKey(e){(this.__ls_cache.has(e)||this.__ls_cache.has(`raw.${e}`))&&(this.__ls_scheduled.add(e),this.__ls_timer||(this.__ls_timer=setTimeout(this._updateLS,0)))}_hookLS(){if(this.__ls_hooked)return;this.__ls_hooked=!0;const e=localStorage.setItem,i=this;localStorage.setItem=function(s,...n){try{i._updateLSKey(s)}catch{}return e.call(this,s,...n)},this._handleLSEvent=this._handleLSEvent.bind(this),window.addEventListener("storage",this._handleLSEvent)}_handleLSEvent(e){e.key&&e.storageArea===localStorage&&this._updateLSKey(e.key)}_updateLS(){clearTimeout(this.__ls_timer),this.__ls_timer=null;const e=this.__ls_scheduled;this.__ls_scheduled=new Set;for(const i of e){const s=this.__ls_cache.has(i),n=`raw.${i}`,o=this.__ls_cache.has(n);if(!o&&!s)continue;const h=localStorage.getItem(i);if(o&&(this.__ls_cache.set(n,h),this.emit(":ls-update",n,h)),s){let _;if(h)try{_=JSON.parse(h)}catch(E){this.log.warn(`Unable to parse localStorage value as JSON for "${i}"`,E)}this.__ls_cache.set(i,_),this.emit(":ls-update",i,_)}}}getLS(e){if(this.__ls_cache.has(e))return this.__ls_cache.get(e);this.__ls_hooked||this._hookLS();const i=e.startsWith("raw."),s=localStorage.getItem(i?e.slice(4):e);let n;if(i)n=s;else try{n=s?JSON.parse(s):null}catch(o){this.log.warn(`Unable to parse localStorage value as JSON for "${e}"`,o)}return this.__ls_cache.set(e,n),n}async generateBackupFile(){const e=new Date,i=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;if(await this._needsZipBackup()){const n=await this._getZipBackup();return new File([n],`ffz-settings (${i}).zip`,{type:"application/zip"})}const s=await this.getSettingsDump();return new File([JSON.stringify(s)],`ffz-settings (${i}).json`,{type:"application/json;charset=utf-8"})}async _needsZipBackup(){if(await this.awaitProvider(),!this.provider||(await this.provider.awaitReady(),!(this.provider instanceof st)||!this.provider.supportsBlobs))return!1;const e=await this.provider.blobKeys();return Array.isArray(e)?e.length>0:!1}async _getZipBackup(){if(await this.awaitProvider(),!this.provider)throw new Error("provider not available");await this.provider.awaitReady();const e=(await Q.e(935).then(Q.t.bind(Q,29597,23))).default,i=new e,s=await this.getSettingsDump();i.file("settings.json",JSON.stringify(s));const n={};if(this.provider instanceof st&&this.provider.supportsBlobs){const o=await this.provider.blobKeys();for(const h of o){const _=encodeURIComponent(h),E=await this.provider.getBlob(h);if(!E)continue;const R={key:h};if(E instanceof File)R.type="file",R.name=E.name,R.modified=E.lastModified,R.mime=E.type;else if(E instanceof Blob)R.type="blob";else if(E instanceof ArrayBuffer)R.type="ab";else if(E instanceof Uint8Array)R.type="ui8";else continue;n[_]=R,i.file(`blobs/${_}`,E)}}return i.file("blobs.json",JSON.stringify(n)),i.generateAsync({type:"blob"})}async getSettingsDump(){if(await this.awaitProvider(),!this.provider)return null;await this.provider.awaitReady();const e={version:2,type:"full",values:{}};for(const[i,s]of this.provider.entries())e.values[i]=s;return e}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout(()=>this.checkUpdates(),5e3)}async checkUpdates(){if(await this.awaitProvider(),await this.provider?.awaitReady(),!this.provider?.shouldUpdate)return;const e=[];for(const n of this.__profiles){if(!n||!n.url||n.pause_updates)continue;const o=n.checkUpdate();e.push(o instanceof Promise?o:Promise.resolve(o))}const i=await Promise.all(e);let s=0;for(const n of i)n&&s++;this.log.info(`Successfully refreshed ${s} of ${i.length} profiles from remote URLs.`)}getProviders(){return this.providers}getActiveProvider(){return this._active_provider}async _createProvider(){let e=localStorage.ffzProviderv2;if(e==null&&(e=localStorage.ffzProviderv2=await this.sniffProvider()),this.providers[e]){const i=new this.providers[e](this);return this._active_provider=e,i}return this._active_provider="local",new Kt(this)}async sniffProvider(){const e=Array.from(Object.entries(this.providers));e.sort((i,s)=>(s[1].priority??0)-(i[1].priority??0));for(const[i,s]of e)if(s.supported()&&await s.hasContent())return i;return"local"}async changeProvider(e,i){if(!this.providers[e]||!this.providers[e].supported())throw new Error(`Invalid provider: ${e}`);if(e===this._active_provider||!this.provider)return;const s=this.provider;if(this.provider=null,s.broadcastTransfer(),i){const n=new this.providers[e](this);if(await n.awaitReady(),n.allowTransfer&&s.allowTransfer){s.disableEvents(),n.clear(),n instanceof st&&n.supportsBlobs&&await n.clearBlobs(),await n.flush();for(const[o,h]of s.entries())n.set(o,h);if(s instanceof st&&s.supportsBlobs&&n instanceof st&&n.supportsBlobs){for(const o of await s.blobKeys()){const h=await s.getBlob(o);h&&await n.setBlob(o,h)}await s.clearBlobs()}s.clear(),await s.flush(),await n.flush()}}localStorage.ffzProviderv2=e,location.reload()}_onProviderChange(e,i,s){if(e==="profiles")return this.loadProfiles();if(!e.startsWith("p:"))return;e=e.slice(2);const n=e.indexOf(":");if(n===-1)return;const o=this.__profile_ids[e.slice(0,n)],h=e.slice(n+1);o&&!o.ephemeral&&(h===":enabled"?o.emit("toggled",o,s?!0:i):o.emit("changed",h,i,s))}updateRoutes(){for(const e of this.__profiles)e.clearMatcher();for(const e of this.__contexts)e.selectProfiles();this.updateClock()}_onProfileToggled(e,i){for(const s of this.__contexts)s.selectProfiles();this.updateClock(),this.emit(":profile-toggled",e,i)}profile(e){return this.__profile_uuids[e]??this.__profile_ids[e]??null}loadProfiles(e=!1){const i=this.__profile_ids,s=this.__profile_uuids,n=this.__profiles,o=this.__profile_ids={},h=this.__profiles=[],_=this.__profile_uuids={},E=new Set(n.map(pe=>pe.id)),R=new Set,T=new Set;let N=this.provider?.get("profiles")??[u.Z.Moderation,u.Z.Default];N?.length||(this.provider?.delete("profiles"),N=[u.Z.Moderation,u.Z.Default]);let Y=!1;for(const pe of N)pe.uuid||(Y=!0,pe.i18n_key===u.Z.Default.i18n_key?pe.uuid=u.Z.Default.uuid:pe.i18n_key===u.Z.Moderation.i18n_key?pe.uuid=u.Z.Moderation.uuid:pe.uuid=(0,r.generateUUID)());Y&&this.provider?.set("profiles",N);let ce=!1,me=!1;for(const pe of n)pe.off("toggled",this._onProfileToggled,this),pe.hotkey_enabled=!1;for(const pe of N){const Ae=pe.id,Fe=h.length,ve=i[Ae],Le=ve?n.indexOf(ve):-1;if(E.delete(Ae),Le!==Fe&&(ce=!0),ve&&(0,r.deep_equals)(ve.data,pe,!0)){Le!==Fe&&(me=!0),h.push(o[Ae]=ve),_[ve.uuid]=ve;continue}const Ee=o[Ae]=new u.Z(this,pe);ve?(ve.transferListeners(Ee),T.add(Ae)):R.add(Ae),h.push(Ee),_[Ee.uuid]=Ee,me=!0}for(const pe of h)pe.on("toggled",this._onProfileToggled,this),pe.hotkey_enabled=!0;if(!(!me&&!E.size||e)){for(const pe of this.__contexts)pe.selectProfiles();this.updateClock();for(const pe of R)this.emit(":profile-created",o[pe]);for(const pe of T)this.emit(":profile-changed",o[pe]);ce&&this.emit(":profiles-reordered")}}createProfile(e={}){if(!this.enabled)throw new Error("Unable to create profile before settings have initialized. Please await enable()");if(e.id!==void 0)throw new Error("You cannot specify an ID when creating a profile.");let i=0;for(;this.__profile_ids[i];)e.ephemeral?i--:i++;e.id=i,e.uuid=(0,r.generateUUID)(),e.name||(e.name=`Unnamed Profile ${this.__profiles.length+1}`);const s=this.__profile_ids[i]=new u.Z(this,e);return this.__profile_uuids[e.uuid]=s,this.__profiles.unshift(s),s.on("toggled",this._onProfileToggled,this),s.hotkey_enabled=!0,s.ephemeral||this._saveProfiles(),this.emit(":profile-created",s),s}deleteProfile(e){if(!this.enabled)throw new Error("Unable to delete profile before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const i=this.__profile_ids[e];if(!i)return;if(this.__profiles.length===1)throw new Error("cannot delete only profile");i.off("toggled",this._onProfileToggled,this),i.clear(),this.__profile_ids[e]=null,this.__profile_uuids[i.uuid]=null;const s=this.__profiles.indexOf(i);s!==-1&&this.__profiles.splice(s,1),i.ephemeral||this._saveProfiles(),this.emit(":profile-deleted",i)}moveProfile(e,i){if(!this.enabled)throw new Error("Unable to move profiles before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const s=this.__profile_ids[e];if(!s)return;const n=this.__profiles,o=n.indexOf(s);o!==i&&(n.splice(i,0,...n.splice(o,1)),s.ephemeral||this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(e){if(!this.enabled)throw new Error("Unable to save profile before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const i=this.__profile_ids[e];i&&(i.ephemeral||this._saveProfiles(),this.emit(":profile-changed",i))}_saveProfiles(){const e=this.__profiles.filter(i=>!i.ephemeral).map(i=>i.data);if(!e){this.createProfile({name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."});return}this.provider?.set("profiles",e);for(const i of this.__contexts)i.selectProfiles();this.updateClock()}context(e){return this.main_context.context(e)}get(e){return this.main_context.get(e)}getChanges(e,i,s){return this.main_context.getChanges(e,i,s)}onChange(e,i,s){return this.main_context.onChange(e,i,s)}uses(e){return this.main_context.uses(e)}update(e){return this.main_context.update(e)}updateContext(e){return this.main_context.updateContext(e)}setContext(e){return this.main_context.setContext(e)}getAddonProxy(e,i,s){if(!e)return this;const n={},o=f.DEBUG||i?.dev;return n.add=(h,_)=>this.add(h,_,e),n.addUI=(h,_)=>this.addUI(h,_,e),n.addClearable=(h,_)=>this.addClearable(h,_,e),(0,d.buildAddonProxy)(s,this,"settings",n)}add(e,i,s){const n=this.definitions.get(e),o=(Array.isArray(n)?n:n?.required_by)??[];i.required_by=o,i.requires=i.requires??[],i.__source=s;for(const h of i.requires){const _=this.definitions.get(h);Array.isArray(_)?_.push(e):_?_.required_by?.push(e):this.definitions.set(h,[e])}if(i.ui){const h=i.ui;if(h.path_tokens=h.path_tokens?_e(h.path_tokens):h.path?(0,g.Q)(h.path):void 0,s&&h.path_tokens&&h.path_tokens.length>=2&&h.path_tokens[0].key==="add_ons"){const _=this.resolve("addons"),E=_?.getAddon(s);if(E){const R=h.path_tokens[1],T=[];T.push(`add_ons.changelog.${s}`),E.short_name&&T.push(`add_ons.changelog.${E.short_name.toSnakeCase()}`),E.name&&T.push(`add_ons.changelog.${E.name.toSnakeCase()}`),R.header_links=[{navigate:T,i18n_key:"home.changelog",title:"Changelog"}]}}if(!h.key&&e&&(h.key=e),!h.key&&h.title&&(h.key=h.title.toSnakeCase()),(h.component==="setting-select-box"||h.component==="setting-combo-box")&&Array.isArray(h.data)&&!h.no_i18n){const _=`${h.i18n_key||`setting.entry.${e}`}.values`;for(const E of h.data)E.i18n_key===void 0&&E.value!==void 0&&(E.i18n_key=`${_}.${E.value}`)}}i.changed&&this.on(`:changed:${e}`,i.changed),this.definitions.set(e,i),(!n||Array.isArray(n))&&this.emit(":added-definition",e,i)}remove(e){const i=this.definitions.get(e);if(i&&!Array.isArray(i)){if(Array.isArray(i.required_by)&&i.required_by.length>0?this.definitions.set(e,i.required_by):this.definitions.delete(e),Array.isArray(i.requires))for(const s of i.requires){let n=this.definitions.get(s);if(Array.isArray(n)){const o=n.indexOf(e);o!==-1&&n.splice(o,1)}else n?.required_by&&(n=n.required_by)}i.changed&&this.off(`:changed:${e}`,i.changed),this.emit(":removed-definition",e,i)}}addUI(e,i,s){let n;i.ui?n=i:n={ui:i},n.__source=s;const o=n.ui;o.path_tokens=o.path_tokens?_e(o.path_tokens):o.path?(0,g.Q)(o.path):void 0,!o.key&&o.title&&(o.key=o.title.toSnakeCase());const h=this.ui_structures.get(e);this.ui_structures.set(e,n),h||this.emit(":added-definition",e,n)}addClearable(e,i,s){if(typeof e=="object"){for(const[n,o]of Object.entries(e))this.addClearable(n,o,s);return}else if(typeof e!="string")throw new Error("invalid key");i&&(i.__source=s,this.clearables[e]=i)}getClearables(){return(0,r.deep_copy)(this.clearables)}addProcessor(e,i){if(typeof e=="object"){for(const[s,n]of Object.entries(e))this.addProcessor(s,n);return}else if(typeof e!="string")throw new Error("invalid key");i&&(this.processors[e]=i)}getProcessor(e){return this.processors[e]??null}getProcessors(){return(0,r.deep_copy)(this.processors)}addValidator(e,i){if(typeof e=="object"){for(const[s,n]of Object.entries(e))this.addValidator(s,n);return}else if(typeof e!="string")throw new Error("invalid key");i&&(this.validators[e]=i)}getValidator(e){return this.validators[e]??null}getValidators(){return(0,r.deep_copy)(this.validators)}};B(ds,"SettingsManager");let X=ds;function _e(k){for(let e=0,i=k.length;e<i;e++){const s=k[e];if(typeof s=="string"){k[e]={key:s.toSnakeCase(),title:s};continue}s.key||(s.key=s.title.toSnakeCase())}return k}B(_e,"format_path_tokens");var se=Q(44589),Ce=Q(83269);const fs=class fs extends d.default{constructor(e,i){super(e,i),this.i18n=null,this.load_tracker=null,this.settings=null,this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("load_tracker"),this.load_requires=["settings"],this.target=this.parent.flavor||"unknown",this.has_dev=!1,this.reload_required=!1,this.addons={},this.enabled_addons=[],this.versions={},this.load_tracker.schedule("chat-data","addon-initial")}onLoad(){this._loader=this.loadAddonData()}onEnable(){this.settings.addUI("add-ons",{path:'Add-Ons @{"description": "Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.", "profile_warning": false}',component:"addon-list",title:"Add-Ons",no_filter:!0,getExtraTerms:()=>Object.values(this.addons).map(e=>e.search_terms),getFFZ:()=>this,isReady:()=>this.enabled,getAddons:()=>Object.values(this.addons),getVersions:()=>(0,r.deep_copy)(this.versions),hasAddon:e=>this.hasAddon(e),getVersion:e=>this.getVersion(e),doesAddonTarget:e=>this.doesAddonTarget(e),isAddonEnabled:e=>this.isAddonEnabled(e),isAddonExternal:e=>this.isAddonExternal(e),enableAddon:e=>this.enableAddon(e),disableAddon:e=>this.disableAddon(e),reloadAddon:e=>this.reloadAddon(e),canReloadAddon:e=>this.canReloadAddon(e),isReloadRequired:()=>this.reload_required,refresh:()=>window.location.reload(),on:(...e)=>this.on(...e),off:(...e)=>this.off(...e)}),f.EXTENSION||this.settings.add("addons.dev.server",{default:!1,ui:{path:"Add-Ons >> Development",title:"Use Local Development Server",description:"Attempt to load add-ons from local development server on port 8001.",component:"setting-check-box"}}),this.on("i18n:update",this.rebuildAddonSearch,this),this.settings.provider.on("changed",this.onProviderChange,this),this._loader?.then(()=>{this.enabled_addons=this.settings.provider.get("addons.enabled",[]);for(const e of this.enabled_addons)this.hasAddon(e)&&this.doesAddonTarget(e)&&this._enableAddon(e).catch(i=>{this.log.error(`An error occured while enabling the add-on "${e}":`,i),this.log.capture(i)});this.load_tracker.notify("chat-data","addon-initial"),this.emit(":ready")})}doesAddonTarget(e){const i=this.getAddon(e);if(!i)return!1;const s=i.targets??["main"];return Array.isArray(s)?s.includes(this.target):!1}generateLog(){const e=["Known"];for(const[i,s]of Object.entries(this.addons)){if(Array.isArray(s))continue;const n=this.versions[i];e.push(`${i} | ${this.isAddonEnabled(i)?"enabled":"disabled"} | ${n?`${n} | `:""}${s.dev?"dev | ":""}${this.isAddonExternal(i)?"external | ":""}${s.short_name} v${s.version}`)}e.push(""),e.push("Modules");for(const[i,s]of Object.entries(this.__modules))s&&e.push(`${s.loaded?"loaded  ":s.loading?"loading ":"unloaded"} | ${s.enabled?"enabled ":s.enabling?"enabling":"disabled"} | ${i}`);return e.join(`
`)}onProviderChange(e,i){if(e!="addons.enabled")return;const s=Array.isArray(i)?i:[],n=[...this.enabled_addons];for(const o of n)s.includes(o)||this.disableAddon(o,!1);for(const o of s)n.includes(o)||this.enableAddon(o,!1)}async loadAddonData(){const[e,i]=await Promise.all([(0,r.fetchJSON)(`${f.SERVER_OR_EXT}/addons.json?_=${(0,Ce.getBuster)(30)}`),!f.EXTENSION&&this.settings.get("addons.dev.server")?(0,r.fetchJSON)(`https://localhost:8001/script/addons.json?_=${(0,Ce.getBuster)()}`):null]);if(Array.isArray(e)){const s=`${f.SERVER_OR_EXT}/addons/`;for(const n of e)n.icon&&(n.icon=new URL(n.icon,s).toString()),this.addAddon(n,!1)}if(Array.isArray(i)){this.has_dev=!0;for(const s of i)this.addAddon(s,!0)}this.settings.updateContext({addonDev:this.has_dev}),this.rebuildAddonSearch(),this.emit(":data-loaded")}setVersion(e,i){this.versions[e]=i}addAddon(e,i=!1){let s=e;const n=this.addons[s.id];this.addons[s.id]=s,s.name=s.name??s.id,s.dev=i,s.requires=s.requires||[],s.required_by=Array.isArray(n)?n:n&&n.required_by||[],s.updated&&(s.updated=new Date(s.updated)),s.created&&(s.created=new Date(s.created)),s._search=s.search_terms;for(const o of s.requires){const h=this.addons[o];Array.isArray(h)?h.push(s.id):h?h.required_by.push(s.id):this.addons[o]=[s.id]}(!n||Array.isArray(n))&&this.settings.addUI(`addon-changelog.${s.id}`,{path:`Add-Ons > Changelog > ${s.name}`,component:"changelog",force_seen:!0,addons:!0,addon:(0,r.deep_copy)(s),getFFZ:()=>this,getVersion:()=>this.versions[s.id]}),this.emit(":added",s.id,s)}rebuildAddonSearch(){for(const e of Object.values(this.addons)){if(Array.isArray(e))continue;const i=new Set([e._search,e.name,e.short_name,e.author,e.description]);this.i18n.locale!=="en"&&(e.name_i18n&&i.add(this.i18n.t(e.name_i18n,e.name)),e.short_name_i18n&&i.add(this.i18n.t(e.short_name_i18n,e.short_name)),e.author_i18n&&i.add(this.i18n.t(e.author_i18n,e.author)),e.maintainer_i18n&&i.add(this.i18n.t(e.maintainer_i18n,e.maintainer)),e.description_i18n&&i.add(this.i18n.t(e.description_i18n,e.description))),e.search_terms=[...i].map(s=>s?s.toLocaleLowerCase():"").join(`
`)}}isAddonEnabled(e){return this.isAddonExternal(e)?!0:this.enabled_addons.includes(e)}getAddon(e){const i=this.addons[e]??null;return Array.isArray(i)?null:i}hasAddon(e){return this.getAddon(e)!=null}getVersion(e){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);const s=this.resolve(`addon.${e}`);if(s){if("version"in s)return s.version;if(s.constructor&&"version"in s.constructor)return s.constructor.version}return i.version}isAddonExternal(e){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);const i=this.resolve(`addon.${e}`);return i?document.head.querySelector(`script#ffz-loaded-addon-${e}`)?i.external||i.constructor?.external:!0:!1}canReloadAddon(e){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);let i=this.resolve(`addon.${e}`);if(!i||!i.canDisable()||!i.canUnload())return!1;if(i.children){for(const s of Object.values(i.children))if(!s.canDisable()||!s.canUnload())return!1}return!0}async fullyUnloadModule(e){if(!(!e||!e.addon_id)){if(e.children)for(const i of Object.values(e.children))await this.fullyUnloadModule(i);await e.disable(),await e.unload(),e.parent instanceof d.default&&e.parent.children[e.name]===e&&delete e.parent.children[e.name];for(const i of e.references){const s=this.resolve(i[0]),n=i[1];s[n]===e&&(s[n]=null)}this.emit(":fully-unload",e.addon_id),this.__modules[e.__path]===e&&delete this.__modules[e.__path],this.off(void 0,void 0,e);for(const i of this.settings.__contexts)i.off(void 0,void 0,e);for(const[i,s]of Array.from(this.settings.definitions.entries()))!Array.isArray(s)&&s?.__source===e.addon_id&&this.settings.remove(i);e.__log=null}}async reloadAddon(e){const i=this.getAddon(e),s=this.resolve("site.menu_button");if(!i)throw new Error(`Unknown add-on id: ${e}`);const n=performance.now();let o=this.resolve(`addon.${e}`);if(o)try{await this.fullyUnloadModule(o)}catch(E){throw s&&s.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.unload",text:`Unable to unload existing modules for add-on "{addon_id}":

{error}`,icon:"ffz-i-attention",addon_id:e,error:String(E)}),E}let h=document.querySelector(`script#ffz-loaded-addon-${i.id}`);h&&h.remove(),window.ffzAddonsWebpackJsonp&&(window.ffzAddonsWebpackJsonp=void 0);try{await this._enableAddon(e)}catch(E){throw s&&s.addToast({title_i18n:"addons.reload.toast-error",title:"Error Reloading Add-On",text_i18n:"addons.reload.toast-error.reload",text:`Unable to load new module for add-on "{addon_id}":

{error}`,error:String(E),icon:"ffz-i-attention",addon_id:e}),E}const _=performance.now();s&&s.addToast({title_i18n:"addons.reload.toast",title:"Reloaded Add-On",text_i18n:"addons.reload.toast.text",text:'Successfully reloaded add-on "{addon_id}" in {duration}ms.',icon:"ffz-i-info",addon_id:e,timeout:5e3,duration:Math.round(100*(_-n))/100})}async _enableAddon(e){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);if(Array.isArray(i.load_events))for(const n of i.load_events)this.load_tracker.schedule(n,`addon.${e}`);await this.loadAddon(e);const s=this.resolve(`addon.${e}`);if(s&&!s.enabled&&await s.enable(),Array.isArray(i.load_events))for(const n of i.load_events)this.load_tracker.notify(n,`addon.${e}`,!1)}async loadAddon(e){const i=this.getAddon(e);if(!i)throw new Error(`Unknown add-on id: ${e}`);await this.i18n.loadChunk(`addon.${e}`);let s=this.resolve(`addon.${e}`);if(s){s.loaded||await s.load(),this.emit(":addon-loaded",e);return}document.head.appendChild((0,se.createElement)("script",{id:`ffz-loaded-addon-${i.id}`,type:"text/javascript",src:i.src||`${i.dev?"https://localhost:8001/script":f.SERVER_OR_EXT}/addons/${i.id}/script.js?_=${(0,Ce.getBuster)(30)}`,crossorigin:"anonymous"})),await(0,r.timeout)(this.waitFor(`addon.${e}:registered`),6e4),s=this.resolve(`addon.${e}`),s&&!s.loaded&&await s.load(),this.emit(":addon-loaded",e)}unloadAddon(e){const i=this.resolve(`addon.${e}`);if(i)return i.unload()}enableAddon(e,i=!0){const s=this.getAddon(e);if(!s)throw new Error(`Unknown add-on id: ${e}`);if(!this.isAddonEnabled(e)){if(Array.isArray(s.requires))for(const n of s.requires){if(!this.hasAddon(n))throw new Error(`Unknown add-on id: ${n}`);this.enableAddon(n)}this.emit(":addon-enabled",e),this.enabled_addons.push(e),i&&this.settings.provider.set("addons.enabled",this.enabled_addons),this.doesAddonTarget(e)&&this._enableAddon(e).catch(n=>{this.log.error(`An error occured while enabling the add-on "${e}":`,n),this.log.capture(n)})}}async disableAddon(e,i=!0){const s=this.getAddon(e);if(!s)throw new Error(`Unknown add-on id: ${e}`);if(this.isAddonExternal(e))throw new Error(`Cannot disable external add-on with id: ${e}`);if(this.isAddonEnabled(e)){if(Array.isArray(s.required_by)){const n=[];for(const o of s.required_by)n.push(this.disableAddon(o));await Promise.all(n)}this.emit(":addon-disabled",e),this.enabled_addons.splice(this.enabled_addons.indexOf(e),1),i&&this.settings.provider.set("addons.enabled",this.enabled_addons);try{const n=this.resolve(`addon.${e}`);n&&await n.disable()}catch{this.reload_required=!0,this.emit(":reload-required")}}}};B(fs,"AddonManager");let Ne=fs;/*! js-cookie v3.0.5 | MIT */function We(k){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)k[s]=i[s]}return k}B(We,"js_cookie_assign");var Xe={read:function(k){return k[0]==='"'&&(k=k.slice(1,-1)),k.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(k){return encodeURIComponent(k).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function de(k,e){function i(n,o,h){if(!(typeof document>"u")){h=We({},e,h),typeof h.expires=="number"&&(h.expires=new Date(Date.now()+h.expires*864e5)),h.expires&&(h.expires=h.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var _="";for(var E in h)h[E]&&(_+="; "+E,h[E]!==!0&&(_+="="+h[E].split(";")[0]));return document.cookie=n+"="+k.write(o,n)+_}}B(i,"set");function s(n){if(!(typeof document>"u"||arguments.length&&!n)){for(var o=document.cookie?document.cookie.split("; "):[],h={},_=0;_<o.length;_++){var E=o[_].split("="),R=E.slice(1).join("=");try{var T=decodeURIComponent(E[0]);if(h[T]=k.read(R,T),n===T)break}catch{}}return n?h[n]:h}}return B(s,"get"),Object.create({set:i,get:s,remove:function(n,o){i(n,"",We({},o,{expires:-1}))},withAttributes:function(n){return de(this.converter,We({},this.attributes,n))},withConverter:function(n){return de(We({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(k)}})}B(de,"init");var ke=de(Xe,{path:"/"}),$e=Q(99968),Ge=Q.n($e);const rt="experiment_overrides",at={expires:7,domain:".twitch.tv"},At=Q(77074);var kt=(k=>(k[k.Unknown=0]="Unknown",k[k.Device=1]="Device",k[k.User=2]="User",k[k.Channel=3]="Channel",k))(kt||{});function It(k){return"t"in k}B(It,"isTwitchExperiment");function Bt(k){return"description"in k}B(Bt,"isFFZExperiment");function Et(k,e){return k.rarity<e.rarity?-1:k.rarity>e.rarity?1:k.name<e.name?-1:k.name>e.name?1:0}B(Et,"sortExperimentLog");const Wi=class Wi extends d.default{constructor(e,i){super(e,i),this.settings=null,this.get=this.getAssignment,this.inject("settings"),this.settings.addUI("experiments",{path:"Debugging > Experiments",component:"experiments",no_filter:!0,getExtraTerms:()=>{const s=[];for(const[n,o]of Object.entries(this.experiments))s.push(n),o.name&&s.push(o.name),o.description&&s.push(o.description);for(const[n,o]of Object.entries(this.getTwitchExperiments()))s.push(n),o.name&&s.push(o.name);return s},is_locked:()=>this.getControlsLocked(),unlock:()=>this.unlockControls(),unique_id:()=>this.unique_id,ffz_data:()=>(0,r.deep_copy)(this.experiments),twitch_data:()=>(0,r.deep_copy)(this.getTwitchExperiments()),usingTwitchExperiment:s=>this.usingTwitchExperiment(s),getTwitchAssignment:s=>this.getTwitchAssignment(s),getTwitchType:s=>this.getTwitchType(s),hasTwitchOverride:s=>this.hasTwitchOverride(s),setTwitchOverride:(s,n)=>this.setTwitchOverride(s,n),deleteTwitchOverride:s=>this.deleteTwitchOverride(s),getAssignment:s=>this.getAssignment(s),hasOverride:s=>this.hasOverride(s),setOverride:(s,n)=>this.setOverride(s,n),deleteOverride:s=>this.deleteOverride(s),on:(...s)=>this.on(...s),off:(...s)=>this.off(...s)}),this.unique_id=ke.get("unique_id"),this.Cookie=ke,this.experiments={},this.cache=new Map}getControlsLocked(){if(f.DEBUG)return!1;const e=this.settings.provider.get("exp-lock",0);return isNaN(e)||!isFinite(e)?!0:Date.now()-e>=864e5}unlockControls(){this.settings.provider.set("exp-lock",Date.now())}async onLoad(){await this.loadExperiments()}async loadExperiments(){let e;try{e=await(0,r.fetchJSON)(f.DEBUG?At:`${f.SERVER}/script/experiments.json?_=${(0,Ce.getBuster)()}`)}catch(n){this.log.warn("Unable to load experiment data.",n);return}if(!e)return;this.experiments=e;const i=this.cache;this.cache=new Map;let s=0;for(const[n,o]of i.entries()){const h=this.getAssignment(n);o!==h&&(s++,this.emit(":changed",n,h,o),this.emit(`:changed:${n}`,h,o))}this.log.info(`Loaded information on ${Object.keys(e).length} experiments.${s>0?` ${s} values updated.`:""}`)}onEnable(){this.on("pubsub:command:reload_experiments",this.loadExperiments,this),this.on("pubsub:command:update_experiment",e=>{this.updateExperiment(e.key,e.data)},this)}updateExperiment(e,i){if(this.log.info(`Received updated data for experiment "${e}" via PubSub.`,i),Array.isArray(i)){const s=this.experiments[e];if(!s)return;s.groups=i}else i?.groups&&(this.experiments[e]=i);this._rebuildKey(e)}generateLog(){const e=[`Unique ID: ${this.unique_id}`,""],i=[];for(const[o,h]of Object.entries(this.experiments)){const _=this.getAssignment(o),E=this.hasOverride(o);let R=0,T=0;for(const N of h.groups)N.value===_&&(R=N.weight),T+=N.weight;!E&&R===T||i.push({key:o,name:h.name,value:_,override:E,rarity:R/T})}i.sort(Et);for(const o of i)e.push(`FFZ | ${o.name}: ${o.value}${o.override?" (Override)":""} (r:${o.rarity})`);const s=[],n=this.settings.get("context.channel");for(const[o,h]of Object.entries(this.getTwitchExperiments())){if(!this.usingTwitchExperiment(o))continue;const _=this.getTwitchAssignment(o),E=this.hasTwitchOverride(o);let R=0,T=0;for(const N of h.groups)N.value===_&&(R=N.weight),T+=N.weight;!E&&R===T||s.push({key:o,name:h.name,value:_,override:E,type:this.getTwitchTypeByKey(o),rarity:R/T})}s.sort(Et);for(const o of s)e.push(`Twitch | ${o.name}: ${o.value}${o.override?" (Override)":""} (r:${o.rarity}, t:${o.type}${o.type==="channel_id"?`, c:${n}`:""})`);return e.join(`
`)}getTwitchType(e){const i=this.resolve("site")?.getCore?.();return i?.experiments?.getExperimentType?i.experiments.getExperimentType(e):e===1?"device_id":e===2?"user_id":e===3?"channel_id":e}getTwitchTypeByKey(e){const i=this.getTwitchExperiments(),s=i?.[e];return s?.t?this.getTwitchType(s.t):null}getTwitchExperiments(){if(window.__twilightSettings)return window.__twilightSettings.experiments??{};const e=this.resolve("site")?.getCore?.();return e&&e.experiments.experiments||{}}usingTwitchExperiment(e){const i=this.resolve("site")?.getCore?.();return i&&(0,r.has)(i.experiments.assignments,e)}_getOverrideCookie(){const e=ke.get(rt);let i;try{i=e?JSON.parse(e):{}}catch{i={}}return i.experiments||(i.experiments={}),i.disabled||(i.disabled=[]),i}_saveOverrideCookie(e){e&&(!e.experiments||!Object.keys(e.experiments).length)&&(!e.disabled||!e.disabled.length)&&(e=void 0),e?ke.set(rt,JSON.stringify(e),at):ke.remove(rt,at)}_checkExternalAccess(){let e;try{e=new Error().stack}catch(s){try{e=s.stack}catch{}}if(!e)return;e=e.split(/\s*\n+\s*/g).filter(s=>s.startsWith("at "));let i=!1;for(const s of e)if(!s.includes(f.SERVER_OR_EXT)){i=!0;break}i&&this.log.warn("Detected access by external script.")}setTwitchOverride(e,i){const s=this._getOverrideCookie(),n=s.experiments,o=s.disabled;this._checkExternalAccess(),n[e]=i;const h=o.indexOf(e);h!=-1&&o.splice(h,1),this._saveOverrideCookie(s);const _=this.resolve("site")?.getCore?.();_&&(_.experiments.overrides[e]=i),this._rebuildTwitchKey(e,!0,i)}deleteTwitchOverride(e){const i=this._getOverrideCookie(),s=i.experiments;if(this._checkExternalAccess(),!(0,r.has)(s,e))return;const n=s[e];delete s[e],this._saveOverrideCookie(i);const o=this.resolve("site")?.getCore?.();o&&delete o.experiments.overrides[e],this._rebuildTwitchKey(e,!1,n)}hasTwitchOverride(e){const i=this._getOverrideCookie(),s=i.experiments;return(0,r.has)(s,e)}getTwitchAssignment(e,i=null){const s=this.resolve("site")?.getCore?.(),n=s&&s.experiments;if(!n)return null;if(!n.hasInitialized&&n.initialize)try{n.initialize()}catch(_){this.log.warn("Error attempting to initialize Twitch experiments tracker.",_)}if(n.overrides&&n.overrides[e])return n.overrides[e];const o=n.experiments[e],h=this.getTwitchType(o?.t??0);return h==="channel_id"?n.getAssignmentById(e,{bucketing:{type:1,value:i??this.settings.get("context.channelID")}}):n.assignments?.[e]?n.assignments[e]:h==="device_id"?n.selectTreatment(e,o,this.unique_id):h==="user_id"?n.selectTreatment(e,o,this.resolve("site")?.getUser?.()?.id):null}getTwitchKeyFromName(e){const i=this.getTwitchExperiments();if(i){e=e.toLowerCase();for(const s in i)if((0,r.has)(i,s)){const n=i[s];if(n&&n.name&&n.name.toLowerCase()===e)return s}}}getTwitchAssignmentByName(e,i=null){const s=this.getTwitchKeyFromName(e);return s?this.getTwitchAssignment(s,i):null}_rebuildTwitchKey(e,i,s){const n=this.resolve("site")?.getCore?.(),o=n.experiments,h=(0,r.has)(o.assignments,e)?o.assignments[e]:null;if(h!==s){const _=i?s:h;this.emit(":twitch-changed",e,_,h),this.emit(`:twitch-changed:${e}`,_,h)}}setOverride(e,i){const s=this.settings.provider.get("experiment-overrides",{});s[e]=i,this.settings.provider.set("experiment-overrides",s),this._rebuildKey(e)}deleteOverride(e){const i=this.settings.provider.get("experiment-overrides");!i||!(0,r.has)(i,e)||(delete i[e],Object.keys(i).length?this.settings.provider.set("experiment-overrides",i):this.settings.provider.delete("experiment-overrides"),this._rebuildKey(e))}hasOverride(e){const i=this.settings.provider.get("experiment-overrides");return i?(0,r.has)(i,e):!1}getAssignment(e){if(this.cache.has(e))return this.cache.get(e);const i=this.experiments[e];if(!i)return this.log.warn(`Tried to get assignment for experiment "${e}" which is not known.`),null;const s=this.settings.provider.get("experiment-overrides"),n=s&&(0,r.has)(s,e)?s[e]:Wi.selectGroup(e,i,this.unique_id??"");return this.cache.set(e,n),n}_rebuildKey(e){if(!this.cache.has(e))return;const i=this.cache.get(e);this.cache.delete(e);const s=this.getAssignment(e);s!==i&&(this.emit(":changed",e,s,i),this.emit(`:changed:${e}`,s,i))}static selectGroup(e,i,s){const n=e+s+(i.seed||""),o=i.groups.reduce((_,E)=>_+E.weight,0);let h=(Ge()(n).words[0]>>>0)/Math.pow(2,32);for(const _ of i.groups)if(h-=_.weight/o,h<=0)return _.value;return null}};B(Wi,"ExperimentManager");let Lt=Wi;var Dt=Q(2356);const Qt=B((k,e)=>fetch(k,e).then(i=>i.ok?i.json():null).catch(()=>null),"fetchJSON"),Nt=/\s*at\s+(.+?)\s+\((.+)\)$/,jt=/^(.+):\/\/(.+?)(?:\?[a-zA-Z0-9]+)?:(\d+:\d+)$/,ut={filter(k){return k.includes(".frankerfacez.com")||k.includes("localhost")},cacheGlobally:!0},dt=["/src/i18n.js","/src/utilities/vue.js"],mt=["(\u30FB`\u03C9\xB4\u30FB)",";;w;;","owo","ono","oAo","oxo","ovo;","UwU",">w<","^w^","> w >","v.v"],Tt=B((k,e)=>k.map(i=>{if(typeof i=="string")return e(i);if(typeof i=="object"&&i.o){const s=Object.assign(i,{o:{}});for(const n of Object.keys(i.o))s.o[n]=Tt(i.o[n],e)}return i}),"transformText"),Rt=B(k=>k.replace(/(?:r|l)/g,"w").replace(/(?:R|L)/g,"W").replace(/n([aeiou])/g,"ny$1").replace(/N([aeiou])/g,"Ny$1").replace(/N([AEIOU])/g,"NY$1").replace(/ove/g,"uv").replace(/!+/g,` ${(0,r.pick_random)(mt)} `),"owo"),ei={double:(k,e)=>[...e," ",...e],upper:(k,e)=>Tt(e,i=>i.toUpperCase()),lower:(k,e)=>Tt(e,i=>i.toLowerCase()),append_key:(k,e)=>[...e,` (${k})`],set_key:k=>[k],owo:(k,e)=>Tt(e,Rt)},ps=class ps extends d.default{constructor(...e){super(...e),this.inject("settings"),this._seen=new Set,this.availableLocales=["en"],this.chunks=["client"],this.localeData={en:{name:"English"}},this.loadLocales(),this.strings_loaded=!1,this.new_strings=0,this.changed_strings=0,this.capturing=!1,this.captured=new Map,this.settings.addUI("i18n.debug.open",{path:"Debugging > Localization >> Editing",component:"i18n-open",force_seen:!0}),this.settings.add("i18n.debug.capture",{default:null,process(i,s){return s===null?f.DEBUG:s},ui:{path:"Debugging > Localization >> General",title:"Enable message capture.",description:"Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.",component:"setting-check-box",force_seen:!0},changed:i=>{this.capturing=i}}),this.settings.add("i18n.debug.transform",{default:null,ui:{path:"Debugging > Localization >> General",title:"Transformation",description:"Transform all localized strings to test string coverage as well as length.",component:"setting-select-box",data:[{value:null,title:"Disabled"},{value:"upper",title:"Upper Case"},{value:"lower",title:"Lower Case"},{value:"append_key",title:"Append Key"},{value:"set_key",title:"Set to Key"},{value:"double",title:"Double"},{value:"owo",title:"owo what's this"}]},changed:i=>{this._.transformation=ei[i],this.emit(":transform"),this.emit(":update")}}),this.settings.add("i18n.locale",{default:-1,process:(i,s)=>{if((s===-1||typeof s!="string")&&(s=i.get("context.session.languageCode")||"en"),this.availableLocales.includes(s))return s;if(s==="no"&&this.availableLocales.includes("nb"))return"nb";const n=s.indexOf("-");return n===-1?"en":(s=s.slice(0,n),this.availableLocales.includes(s)?s:"en")},ui:{path:'Appearance > Localization >> General @{"sort":-100}',title:"Language",description:"FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.",component:"setting-select-box",data:(i,s)=>this.getLocaleOptions(s)},changed:i=>this.locale=i}),this.settings.add("i18n.format.date",{default:"default",ui:{path:"Appearance > Localization >> Formatting",title:"Date Format",description:"The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"date",component:"format-preview"},data:()=>{const i=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.date))i.push({value:n,title:`${this.formatDate(s,n)} (${n})`});return i}},changed:i=>{this._.defaultDateFormat=i,this.emit(":update")}}),this.settings.add("i18n.format.time",{default:"short",ui:{path:"Appearance > Localization >> Formatting",title:"Time Format",description:"The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"time",component:"format-preview"},data:()=>{const i=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.time))i.push({value:n,title:`${this.formatTime(s,n)} (${n})`});return i}},changed:i=>{this._.defaultTimeFormat=i,this.emit(":update")}}),this.settings.add("i18n.format.datetime",{default:"medium",ui:{path:"Appearance > Localization >> Formatting",title:"Date-Time Format",description:"The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"datetime",component:"format-preview"},data:()=>{const i=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.datetime))i.push({value:n,title:`${this.formatDateTime(s,n)} (${n})`});return i}},changed:i=>{this._.defaultDateTimeFormat=i,this.emit(":update")}})}getLocaleOptions(e){e===void 0&&(e=this.settings.get("i18n.locale"));const i=[],s=[];for(const o of this.availableLocales){const h=this.localeData[o];let _=h?.native_name||h?.name||o;h?.coverage!=null&&h?.coverage<100&&(_=this.t("i18n.locale-coverage","{name} ({coverage,number,percent} Complete)",{name:_,coverage:h.coverage/100}));const E={selected:e===o,value:o,title:_};h?.joke?s.push(E):i.push(E)}i.sort((o,h)=>o.title.localeCompare(h.title)),s.sort((o,h)=>o.title.localeCompare(h.title));let n=[{selected:e===-1,value:-1,i18n_key:"setting.appearance.localization.general.language.twitch",title:"Use Twitch's Language"}];return i.length&&(n.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.languages",title:"Supported Languages"}),n=n.concat(i)),s.length&&(n.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.joke",title:"Joke Languages"}),n=n.concat(s)),n}onEnable(){this.capturing=this.settings.get("i18n.debug.capture"),this.capturing&&this.loadStrings(),this._=new Dt.default({warn:(...e)=>this.log.warn(...e),defaultDateFormat:this.settings.get("i18n.format.date"),defaultTimeFormat:this.settings.get("i18n.format.time"),defaultDateTimeFormat:this.settings.get("i18n.format.datetime")}),window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-i18n")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._.transformation=ei[this.settings.get("i18n.debug.transform")],this.locale=this.settings.get("i18n.locale")}async loadChunk(e){if(this.chunks.includes(e))return[];this.chunks.push(e);const i=this._.locale,s=await this.loadLocale(i,e),n=this._.extend(s);return n.length&&(this.log.info(`Loaded Chunk: ${e} -- Phrases: ${n.length}`),this.emit(":loaded",n),this.emit(":update")),n}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}getKeys(){const e=[];for(const i of this.captured.values()){const s=(0,r.deep_copy)(i);s.translation=this._.phrases.get(s.key)||s.phrase,e.push(s)}return e}requestKeys(){this.broadcast({type:"request-keys"})}updatePhrase(e,i){this.broadcast({type:"update-key",key:e,phrase:i}),this._.extend({[e]:i}),this.emit(":loaded",[e]),this.emit(":update")}handleMessage(e){const i=e.data;if(i){if(i.type==="update-key")this._.extend({[i.key]:i.phrase}),this.emit(":loaded",[i.key]),this.emit(":update");else if(i.type==="request-keys")this.broadcast({type:"keys",data:Array.from(this.captured.values())});else if(i.type==="keys"&&Array.isArray(i.data)){for(const s of i.data)this.captured.set(s.key,s);this.emit(":got-keys")}}}openUI(e=!0){this.capturing||(this.capturing=!0,this.emit(":update"));const i=this.resolve("translation_ui");e?i.openPopout():i.enable()}get dayjsLocale(){return this._?._dayjs_locale}get locale(){return this._&&this._.locale}set locale(e){this.setLocale(e)}async loadStrings(e=!1){if(this.strings_loaded&&!e||this.strings_loading)return;this.strings_loading=!0;const i=await fetch(`${f.SERVER}/script/locale/strings.json?_=${(0,Ce.getBuster)(30)}`);let s;i.ok?s=await i.json():(this.log.warn(`Error Loading Strings -- Status: ${i.status}`),s=[]);for(const n of s){const o=n.id;let h=this.captured.get(o);if(h||(this.captured.set(o,h={key:o,phrase:n.default,hits:0,calls:[]}),n.source?.length&&h.calls.push(n.source)),!h.options&&n.context?.length)try{h.options=JSON.parse(n.context)}catch{}h.known=n.default,h.different=n.default!==h.phrase}this.new_strings=0,this.changed_strings=0;for(const n of this.captured.values())n.known||this.new_strings++,n.different&&this.changed_strings++;this.strings_loaded=!0,this.strings_loading=!1,this.log.info(`Loaded ${s.length} strings from the server.`),this.emit(":strings-loaded"),this.emit(":new-strings",this.new_strings),this.emit(":changed-strings",this.changed_strings)}see(e,i,s){if(!this.capturing)return;let n;try{n=new Error().stack}catch(h){try{n=h.stack}catch{}}let o=this.captured.get(e);o||(this.captured.set(e,o={key:e,phrase:i,hits:0,calls:[]}),this.strings_loaded&&(this.new_strings++,this.emit(":new-strings",this.new_strings))),i!==o.phrase&&(o.phrase=i,o.known&&i!==o.known&&!o.different&&(o.different=!0,this.changed_strings++,this.emit(":changed-strings",this.changed_strings))),o.options=this.pluckVariables(e,s),o.hits++,n&&(this.mapStackTrace?this.mapStackTrace(n,h=>this.recordCall(o,h),ut):Promise.all([Q.e(7852),Q.e(1871)]).then(Q.t.bind(Q,58194,23)).then(h=>{this.mapStackTrace=h.mapStackTrace,this.mapStackTrace(n,_=>this.recordCall(o,_),ut)}))}pluckVariables(e,i){const s=this._.cache.get(e);if(!s)return null;const n={};return this._doPluck(s,i,n),Object.keys(n).length?n:null}_doPluck(e,i,s){if(Array.isArray(e)){for(const n of e)this._doPluck(n,i,s);return}if(typeof e=="object"&&e.v){const n=(0,r.get)(e.v,i);if(n&&n.$$typeof)return;s[e.v]=(0,r.shallow_copy)(n)}}recordCall(e,i){if(Array.isArray(i))for(const s of i){const n=Nt.exec(s);if(!n)continue;const o=jt.exec(n[2]);if(!o||o[1]!=="webpack")continue;const h=o[2];if(h.includes("/node_modules/")||dt.includes(h))continue;let _;if(n[1]==="MainMenu.getSettingsTree")_="FFZ Control Center";else{let E=n[1];(E==="Proxy.render"||E.startsWith("Proxy.push"))&&o[2].includes(".vue")&&(E="Vue Component"),_=`${E} (${o[2]}:${o[3]})`}e.calls.includes(_)||e.calls.push(_);return}}async loadLocales(){const e=await fetch(`${f.SERVER}/script/locale/locales.json?_=${(0,Ce.getBuster)(30)}`);let i;e.ok?i=await e.json():this.log.warn(`Error Populating Locales -- Status: ${e.status}`),(!Array.isArray(i)||!i.length)&&(i=[{id:"en",name:"English",coverage:100,rtl:!1,hashes:{}}]),this.localeData={},this.availableLocales=[];for(const s of i){const n=s.id.toLowerCase();this.localeData[n]=s,this.availableLocales.push(n)}this.emit(":locales-loaded")}async loadLocale(e,i=null){if(e=e.toLowerCase(),e==="en")return{};const s=this.localeData[e]?.hashes;if(!s)return this.log.info(`Cannot Load Locale: ${e}`),{};i?Array.isArray(i)||(i=[i]):i=this.chunks;const n=this.localeData[e].id,o=[];for(const R of i){const T=s[R];T&&o.push(Qt(`https://cdn2.frankerfacez.com/static/locale/${n}/${R}.${T}.json`))}const h=await Promise.all(o),_={};let E=0;for(const R of h)if(R)for(const[T,N]of Object.entries(R))typeof N=="string"&&N.length>0?_[T]=N:E++;return E>0&&this.log.debug(`Ignored ${E} invalid values while loading ${e} chunks.`),_}async setLocale(e){e=e.toLowerCase();const i=this._.locale;if(e===i)return[];if(this._.locale=e,this._.clear(),this.log.info(`Changed Locale: ${e} -- Old: ${i}`),this.emit(":changed",e,i),this.emit(":update"),e==="en")return this.emit(":loaded",[]),this._._dayjs_locale="en",[];const s=this.localeData[e],n=await this.loadLocale(s?.id||e);let o;try{o=s?.dayjs_override||e,await this.loadDayjsLocale(o)}catch{this.log.warn(`Unable to load DayJS locale for ${e}`),o="en"}if(this._.locale!==e)throw new Error("locale has changed since we started loading");this._._dayjs_locale=o;const h=this._.extend(n);return h.length&&(this.log.info(`Loaded Locale: ${e} -- Phrases: ${h.length}`),this.emit(":loaded",h),this.emit(":update")),h}async loadDayjsLocale(e){if(!(e==="en"||e==="en-arrr"))try{await Q(73637)(`./${e}.js`)}catch(i){this.log.warn(`Unable to load day.js locale data for locale "${e}"`,i)}}has(e){return this._.has(e)}formatNode(...e){return this._.formatNode(...e)}toLocaleString(...e){return this._.toLocaleString(...e)}toRelativeTime(...e){return this._.formatRelativeTime(...e)}formatNumber(...e){return this._.formatNumber(...e)}formatCurrency(...e){return this._.formatCurrency(...e)}formatDuration(...e){return this._.formatDuration(...e)}formatDate(...e){return this._.formatDate(...e)}formatTime(...e){return this._.formatTime(...e)}formatDateTime(...e){return this._.formatDateTime(...e)}t(e,...i){return this.see(e,...i),this._.t(e,...i)}tList(e,...i){return this.see(e,...i),this._.tList(e,...i)}};B(ps,"TranslationManager");let Jt=ps;const hi=/\$/g,ct=String.prototype.replace,tt=/^\s*([^(]+?)\s*(?:\(\s*([^)]+?)\s*\))?\s*$/;function Ot(k){if(!k||!k.length)return;const e=[];for(const i of k.split(/\|/g)){const s=tt.exec(i);s&&e.push({fmt:s[1],extra:s[2]})}return e}B(Ot,"parseFormatters");function $t(k,e,i,s,n){const o=Array.isArray(k);if(e==null)return o?k[0]:k;let h=k;const _=typeof e=="number"?{count:e}:e;return o&&(h=h[0]),typeof h=="string"&&(h=ct.call(h,s,(E,R,T)=>{let N=(0,r.get)(R.trim(),_);if(N==null)return"";const Y=Ot(T);let ce=!1;if(Y)for(const me of Y){const pe=n[me.fmt];typeof pe=="function"&&(N=pe(N,i,_,me.extra),ce=!0)}return!ce&&typeof N=="string"&&(N=ct.call(N,hi,"$$")),N})),h}B($t,"transformPhrase");var St=(k=>(k[k.Disconnected=0]="Disconnected",k[k.Connecting=1]="Connecting",k[k.Connected=2]="Connected",k))(St||{});function Ft(k){let e=k.length;const i=[k];for(;(e=k.lastIndexOf("/",e-1))!==-1;)i.push(`${k.slice(0,e)}/*`);return i.push("*"),i}B(Ft,"enumerateSubs");const ms=class ms extends w.EventEmitter{constructor(){super(),this._ws=null,this._topics=new Set,this._live_topics=new Set,this._want_connection=!1,this._state=0,this._reconnectTimer=null,this._failedConnections=0,this._performReconnect=this._performReconnect.bind(this)}_reconnect(e=!0){if(this._reconnectTimer)return;let i=250+(e?Math.floor(this._failedConnections*(Math.random()*5e3)+5e3):0);this._reconnectTimer=setTimeout(this._performReconnect,i)}_performReconnect(){if(this._reconnectTimer=null,this._ws&&(this._ws.close(),this._ws=null,this._state=0),this._live_topics=new Set(this._topics),!this._live_topics.size)return;this._state=1;const e=new URL("wss://pubsub.workers.frankerfacez.com/ws");if(this._live_topics.size>10)e.searchParams.append("t","*");else for(const s of this._live_topics)e.searchParams.append("t",s);const i=this._ws=new WebSocket(e.toString());i.addEventListener("open",s=>{this._state=2,this._failedConnections=0,this.emit("connect",s)}),i.addEventListener("error",s=>{this.emit("error",s)}),i.addEventListener("close",s=>{this._ws=null,this._state=0,this.emit("disconnect",s),this._want_connection&&this._reconnect()}),i.addEventListener("message",s=>{if(typeof s.data=="string"){let n;try{n=JSON.parse(s.data)}catch{return}if(!n.topic||typeof n.topic!="string")return;if(this._live_topics.size>10&&!this._live_topics.has(n.topic)){let o=!1;for(const h of Ft(n.topic))if(this._live_topics.has(h)){o=!0;break}if(!o)return}this.emit("message",n)}})}get connected(){return this._state===2}get connecting(){return this._state===1}get disconnected(){return this._state===0}connect(){this._want_connection=!0,this._reconnect(!1)}disconnect(){this._want_connection=!1,this._failedConnections=0,this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._ws&&(this._ws.close(),this._ws=null,this._state=0,this.emit("disconnect",null))}subscribe(e){Array.isArray(e)||(e=[e]);for(const i of e)this._topics.add(i);this._want_connection&&!(0,r.set_equals)(this._topics,this._live_topics)&&this._reconnect()}unsubscribe(e){Array.isArray(e)||(e=[e]);for(const i of e)this._topics.delete(i);this._want_connection&&!(0,r.set_equals)(this._topics,this._live_topics)&&this._reconnect()}};B(ms,"PubSubClient");let pt=ms;const gs=class gs extends d.default{constructor(e,i){super(e,i),this.experiments=null,this.settings=null,this.inject("settings"),this.inject("experiments"),this.settings.add("pubsub.enabled",{default:()=>this.experiments.getAssignment("worker_pubsub")??!1,ui:{path:'Debugging @{"expanded": false, "sort": 9999} > PubSub >> General',title:"Enable PubSub.",description:"Whether or not you want your client to connect to FrankerFaceZ's PubSub system. This is still in testing and should be left alone unless you know what you're doing.",force_seen:!0,component:"setting-check-box"},changed:s=>s?this.connect():this.disconnect()}),this._topics=new Map,this._client=null}onEnable(){this.subscribe(null,"global"),this.connect(),this.on("experiments:changed:worker_pubsub",this._updateSetting,this)}onDisable(){this.off("experiments:changed:worker_pubsub",this._updateSetting,this),this.disconnect(),this.unsubscribe(null,"global")}_updateSetting(){this.settings.update("pubsub.enabled")}get connected(){return this._client!=null}reconnect(){this.disconnect(),this.connect()}async connect(){if(this._client||!this.settings.get("pubsub.enabled"))return;const e=this._client=new pt;e.on("connect",()=>{this.log.info("Connected to PubSub.")}),e.on("disconnect",()=>{this.log.info("Disconnected from PubSub.")}),e.on("error",s=>{this.log.error("Error in PubSub",s)}),e.on("message",s=>{const n=s.topic,o=s.data;if(!o?.cmd){this.log.debug(`Received message on topic "${n}":`,o),this.emit(":message",n,o);return}o.topic=n,this.log.debug(`Received command on topic "${n}" for command "${o.cmd}":`,o.data),this.emit(`:command:${o.cmd}`,o.data,o)});const i=[...this._topics.keys()];e.subscribe(i),await e.connect()}disconnect(){this._client&&(this._client.disconnect(),this._client=null)}subscribe(e,...i){const s=this._topics;let n=!1;for(const o of i){let h=s.get(o);h?h.add(e):(this._client&&this._client.subscribe(o),h=new Set,h.add(e),s.set(o,h),n=!0)}n&&this.emit(":sub-change")}unsubscribe(e,...i){const s=this._topics;let n=!1;for(const o of i){const h=s.get(o);h&&(h.delete(e),h.size||(n=!0,s.delete(o),this._client&&this._client.unsubscribe(o)))}n&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}};B(gs,"PubSub");let et=gs;const _s=class _s extends d.default{constructor(e,i){super(e,i),this.settings=null,this.api=f.API_SERVER,this.cdn=f.SERVER,this.active=!1,this.inject("settings"),this.settings.add("data.use-staging",{default:!1,ui:{path:'Debugging > Data Sources >> Staging @{"sort": -1}',force_seen:!0,title:"Use staging as data source.",component:"setting-check-box"}}),this.updateStaging(!1)}onEnable(){this.settings.getChanges("data.use-staging",this.updateStaging,this)}updateStaging(e){this.active=e,this.api=e?f.STAGING_API:f.API_SERVER,this.cdn=e?f.STAGING_CDN:f.SERVER,this.emit(":updated",this.api,this.cdn)}};B(_s,"StagingSelector");let lt=_s;const bs=class bs extends d.default{constructor(e,i){super(e,i),this.pending_loads=new Map,this.settings=null,this.should_enable=!0,this.inject("settings"),this.settings.add("chat.update-when-loaded",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Update existing chat messages when loading new data.",component:"setting-check-box",description:"This may cause elements in chat to move, so you may wish to disable this when performing moderation."}})}onEnable(){this.on(":schedule",this.schedule)}schedule(e,i){let s=this.pending_loads.get(e);(!s||!s.pending||!s.timers)&&(s={pending:new Set,timers:{},success:!1},this.pending_loads.set(e,s)),!s.pending.has(i)&&(s.pending.add(i),s.timers[i]=setTimeout(()=>this.notify(e,i,!1),15e3))}notify(e,i,s=!0){const n=this.pending_loads.get(e);if(!(!n||!n.pending||!n.timers)&&(n.timers[i]&&(clearTimeout(n.timers[i]),n.timers[i]=null),!!n.pending.has(i)&&(n.pending.delete(i),s&&(n.success=!0),!n.pending.size))){const o=Object.keys(n.timers);this.log.debug("complete",e,o),n.success&&this.emit(`:complete:${e}`,o),this.pending_loads.delete(e)}}};B(bs,"LoadTracker");let gt=bs;var ft=Q(33612),ot=Q(98247),_t=Q(45866),vt=Q(29632),Ut=Q(27040);const ys=class ys extends d.default{constructor(e,i){super(e,i),this.rules={},this.chunks={},this._toggle_state={},this._chunks_loaded=!1,this._loadChunks=(0,r.once)(this._loadChunks)}get chunks_loaded(){return this._chunks_loaded}get loader(){return this._chunk_loader}set loader(e){e!==this._chunk_loader&&(this._chunks_loaded=!1,this._chunk_loader=e)}get style(){return this._style||(this._style=new se.ManagedStyle),this._style}toggleHide(e,i){const s=`hide--${e}`;if(i=i!=null?!!i:!this._toggle_state[s],this._toggle_state[s]!==i){if(this._toggle_state[s]=i,!i){this._style&&this._style.delete(s);return}if(!(0,r.has)(this.rules,e))throw new Error(`unknown rule "${e}" for toggleHide`);this.style.set(s,`${this.rules[e]}{display:none !important}`)}}toggle(e,i){i=i!=null?!!i:!this._toggle_state[e],this._toggle_state[e]!=i&&(this._toggle_state[e]=i,this._apply(e))}_apply(e){if(!this._toggle_state[e]){this._style&&this._style.delete(e);return}this.style.has(e)||(this._chunks_loaded?(0,r.has)(this.chunks,e)?this.style.set(e,this.chunks[e]):this.log.warn(`Unknown chunk name "${e}" for toggle()`):this._loadChunks().then(()=>this._apply(e)))}set(e,i){return this.style.set(e,i)}delete(e){this._style&&this._style.delete(e)}setVariable(e,i,s="body"){this.style.set(`var--${e}`,`${s}{--ffz-${e}:${i};}`)}deleteVariable(e){this._style&&this._style.delete(`var--${e}`)}async _loadChunks(){if(this._chunks_loaded)return;if(!this._chunk_loader){this._chunks_loaded=!0;return}const e=[];for(const i of this._chunk_loader.keys()){const s=i.slice(2,i.length-(i.endsWith(".scss")?5:4));e.push(this._chunk_loader(i).then(n=>{typeof n?.default=="string"&&(this.chunks[s]=n.default)}))}await Promise.all(e),this._chunks_loaded=!0}};B(ys,"CSSTweaks");let Gt=ys;var gi=Q(10789);const vs=class vs extends gi.Z{constructor(...e){super(...e),this.Player=this.fine.define("highwind-player",i=>i.setPlayerActive&&i.props?.playerEvents&&i.props?.mediaPlayerInstance),this.PlayerSource=this.fine.define("player-source",i=>i.setSrc&&i.setInitialPlaybackSettings)}};B(vs,"Player");let Vt=vs;var Mt=Q(14873),Ci=Q(83342),qt=Q(75271);const ws=class ws extends d.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.overrides"),this.inject("site.fine"),this.ChatLine=this.fine.define("clip-chat-line",i=>i.renderFragments&&i.renderUserBadges),this.render=!0,this.messages=new WeakMap,window.toggleLines=()=>{this.render=!this.render,this.updateLines()}}onEnable(){this.on("chat.overrides:changed",e=>this.updateLinesByUser(e,null,!1,!1),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-line",this.updateLineById,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this);for(const e of f.RERENDER_SETTINGS)this.chat.context.on(`changed:${e}`,this.rerenderLines,this);for(const e of f.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineTokens,this);for(const e of f.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-messages",(e,i,s,n)=>{if(e)for(const o of this.ChatLine.instances){const h=this.standardizeMessage(o.props.node,o.props.video);h&&n.push({message:h,_instance:o,update:()=>o.forceUpdate()})}}),this.site=this.resolve("site"),this.ChatLine.ready(e=>{const i=this,s=e.prototype.render;e.prototype.render=function(){try{if(this._ffz_no_scan=!0,!i.render)return s.call(this);const n=i.standardizeMessage(this.props.node,this.props.video),o=i.chat.context.get("chat.emotes.animated")===2,h=n.is_action,_=h?i.chat.context.get("chat.me-style"):0,E=_>=2,R=_===1||_===3,T=n.user,N=i.overrides.getColor(T.id)||T.color,Y=i.parent.colors.process(N),ce=i.site.getUser(),me=n.ffz_tokens=n.ffz_tokens||i.chat.tokenizeMessage(n,ce),pe=i.chat.formatUser(T,qt.createElement),Ae=i.overrides.getName(T.id);let Fe=n.ffz_user_class;Fe instanceof Set?Fe=[...Fe].join(" "):Array.isArray(Fe)&&(Fe=Fe.join(" "));const ve={className:`clip-chat__message-author tw-font-size-5 ffz-link notranslate tw-strong${Ae?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${Fe??""}`,href:`https://www.twitch.tv/${T.login}/clips`,style:{color:Y}};n.ffz_user_props&&Object.assign(ve,n.ffz_user_props),n.ffz_user_style&&Object.assign(ve.style,n.ffz_user_style);const Le=(0,qt.createElement)("a",ve,Ae?[(0,qt.createElement)("span",{className:"chat-author__display-name"},Ae),(0,qt.createElement)("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},pe)]:pe);return(0,qt.createElement)("div",{class:"tw-mg-b-1"},(0,qt.createElement)("div",{"data-a-target":"tw-animation-target",class:"ffz--clip-chat-line tw-animation tw-animation--animate tw-animation--duration-short tw-animation--fill-mode-both tw-animation--slide-in-bottom tw-animation--timing-ease","data-room-id":n.roomID,"data-room":n.roomLogin,"data-user-id":T.id,"data-user":T.login,onMouseOver:o?i.chat.emotes.animHover:null,onMouseOut:o?i.chat.emotes.animLeave:null},(0,qt.createElement)("span",{class:"chat-line__message--badges"},i.chat.badges.render(n,qt.createElement)),Le,(0,qt.createElement)("div",{class:"tw-inline-block tw-mg-r-05"},h?"":":"),(0,qt.createElement)("span",{class:`message${E?" chat-line__message-body--italicized":""}`,style:{color:R?Y:null}},i.chat.renderTokens(me,qt.createElement))))}catch(n){i.log.error(n),i.log.capture(n,{extra:{props:this.props}})}return s.call(this)},this.ChatLine.forceUpdate()})}updateLinesByUser(e,i){for(const s of this.ChatLine.instances){const n=s.props.node,o=n?.commentor;o&&(e&&e==o.id||i&&i==o.login)&&(this.messages.delete(n),s.forceUpdate())}}updateLineById(e,i=!0,s=null){s==null&&(s=i);for(const n of this.ChatLine.instances){const o=n.props.node;if(o?.id===e){(i||s)&&this.messages.delete(o),n.forceUpdate();return}}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){this.ChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(e=!0,i=!0){for(const s of this.ChatLine.instances){const n=s.props.node;this.messages.delete(n)}this.ChatLine.forceUpdate()}standardizeMessage(e,i){if(!e||!e.message)return e;if(this.messages.has(e))return this.messages.get(e);const s=this.chat.getRoom(i.owner.id,null,!0,!0),n=e.commenter||{},o={};if(e.message.userBadges)for(const _ of e.message.userBadges)_?.setID&&(o[_.setID]=_.version);const h={user:{color:n.chatColor,id:n.id,login:n.login,displayName:n.displayName,isIntl:n.login&&n.displayName&&n.displayName.trim().toLowerCase()!==n.login,type:"user"},roomLogin:s&&s.login,roomID:s&&s.id,badges:o,id:e.id,ffz_badges:this.chat.badges.getBadges(n.id,n.login,s?.id,s?.login),messageParts:e.message.fragments};return this.detokenizeMessage(h,e),this.messages.set(e,h),h}detokenizeMessage(e){const i=[],s=e.messageParts,n=s.length,o={};let h=0;for(let _=0;_<n;_++){const E=s[_],R=E&&E.text;if(!R||!R.length)continue;const T=(0,r.split_chars)(R).length;if(E.emote){const N=E.emote.emoteID;(o[N]=o[N]||[]).push({startIndex:h,endIndex:h+T-1})}i.push(R),h+=T}return e.message=i.join(""),e.ffz_emotes=o,e}};B(ws,"Line");let _i=ws;const ks=class ks extends d.default{constructor(...e){super(...e),this.colors=new Mt.ColorAdjuster,this.inverse_colors=new Mt.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.settings.add("theme.is-dark",{requires:["context.ui.theme"],process(i){return i.get("context.ui.theme")===1}}),this.inject("chat"),this.inject("site.twitch_data"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject(_i),this.ChatController=this.fine.define("clip-chat-controller",i=>i.filterChatLines)}onEnable(){this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.getChanges("chat.lines.alternate",e=>this.css_tweaks.toggle("chat-rows",e)),this.chat.context.getChanges("chat.lines.borders",this.updateLineBorders,this),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatMounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatController.on("receive-props",this.chatUpdated,this),this.ChatController.ready((e,i)=>{for(const s of i)this.chatMounted(s)}),this.loadBadges(),this.updateChatCSS(),this.updateColors()}updateLineBorders(){const e=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",e>0),this.css_tweaks.toggle("chat-borders-3d",e===2),this.css_tweaks.toggle("chat-borders-3d-inset",e===3),this.css_tweaks.toggle("chat-borders-wide",e===4)}updateChatCSS(){const e=this.chat.context.get("chat.font-size"),i=this.chat.context.get("chat.lines.emote-alignment"),s=Math.round(20/12*e);let n=this.chat.context.get("chat.font-family")||"inherit";const[o,h]=(0,Ci.jo)(n);n=o,this._font_unloader&&this._font_unloader(),this._font_unloader=h,n.indexOf(" ")!==-1&&n.indexOf(",")===-1&&n.indexOf('"')===-1&&n.indexOf("'")===-1&&(n=`"${n}"`),this.css_tweaks.setVariable("chat-font-size",`${e/10}rem`),this.css_tweaks.setVariable("chat-line-height",`${s/10}rem`),this.css_tweaks.setVariable("chat-font-family",n),this.css_tweaks.toggle("chat-font",e!==12||n),this.css_tweaks.toggle("emote-alignment-padded",i===1),this.css_tweaks.toggle("emote-alignment-baseline",i===2)}updateColors(){const e=this.chat.context.get("theme.is-dark"),i=this.chat.context.get("chat.adjustment-mode"),s=this.chat.context.get("chat.adjustment-contrast"),n=this.colors,o=this.inverse_colors;n._base=e?"#191919":"#e0e0e0",n.mode=i,n.contrast=s,o._base=e?"#dad8de":"#19171c",o.mode=i,o.contrast=s,this.line.updateLines()}async loadBadges(){let e;try{e=await this.twitch_data.getBadges()}catch(i){this.log.warn("Error loading badge data.",i);return}e&&this.chat.badges.updateTwitchBadges(e)}addNotice(){return!1}sendMessage(){return null}addRoom(e,i){i||(i=e.props);const s=(0,r.get)("data.clip.broadcaster.id",i);if(!s)return null;const n=e._ffz_room=this.chat.getRoom(s,null,!1,!0);return n.ref(e),this.settings.updateContext({channelID:s}),n}removeRoom(e){e._ffz_room&&(e._ffz_room.unref(e),e._ffz_room=null,this.settings.updateContext({channelID:null}))}chatMounted(e,i){i||(i=e.props),this.addRoom(e,i)&&this.updateRoomBadges(e,(0,r.get)("data.clip.video.owner.broadcastBadges",i))}chatUmounted(e){this.removeRoom(e)}chatUpdated(e,i){if(!e._ffz_room||i?.data?.clip?.broadcaster?.id!==e._ffz_room.id){this.chatUmounted(e),this.chatMounted(e,i);return}const s=(0,r.get)("data.clip.video.owner.broadcastBadges",i),n=(0,r.get)("data.clip.video.owner.broadcastBadges",e.props);s!==n&&this.updateRoomBadges(e,s)}updateRoomBadges(e,i){const s=e._ffz_room;s&&s.updateBadges(i)}};B(ks,"Chat");let ni=ks;const Xt=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],ti={dark:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":9,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":9,"background-top-nav":7,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}},Ss=class Ss extends d.default{constructor(...e){super(...e),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.settings.add("theme.font.size",{default:13,process(i,s){if(typeof s!="number")try{s=parseFloat(s)}catch{s=null}return(!s||s<1||isNaN(s)||!isFinite(s)||s>25)&&(s=13),s},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process(){return!0}}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(i){const s=i.get("context.force-theme");return s??(i.get("context.ui.theatreModeEnabled")||i.get("theme.can-dark")&&i.get("context.ui.theme")===1)},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process(i){return!i.get("theme.is-dark")}}),this._style=null,this._normalizer=null}updateFont(){let e=this.settings.get("theme.font.size");if(typeof e=="string"&&/^[0-9.]+$/.test(e)?e=parseFloat(e):typeof e!="number"&&(e=null),!e||isNaN(e)||!isFinite(e)||e<1||e===13){this.css_tweaks.delete("font-size");return}e=e/10,this.css_tweaks.set("font-size",`html body {
	--font-size-1: ${54/13*e}rem;
	--font-size-2: ${36/13*e}rem;
	--font-size-3: ${24/13*e}rem;
	--font-size-4: ${18/13*e}rem;
	--font-size-5: ${14/13*e}rem;
	--font-size-6: ${e}rem;
	--font-size-7: ${12/13*e}rem;
	--font-size-8: ${12/13*e}rem;
	--font-size-base: ${e}rem;
}
`)}updateCSS(){if(this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark")){this.toggleNormalizer(!1),this.toggleAccentNormal(!0),this.css_tweaks.delete("colors");return}let e=!1,i=this.settings.get("theme.is-dark");const s=[],n=[],o=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(o){o.a=1,s.push(`--color-background-body: ${o.toCSS()};`);const ve=o.toHSLA(),Le=ve.l;i=Le<.5;try{const Ee=this.resolve("site").store,je=Ee.getState().ui.theme,Ue=i?1:0;je!==Ue&&Ee.dispatch({type:"core.ui.THEME_CHANGED",theme:Ue})}catch{}e=!0,s.push(`--color-background-input-focus: ${o.toCSS()};`),s.push(`--color-background-base: ${ve._l(Le+(i?.05:-.05)).toCSS()};`),s.push(`--color-background-alt: ${ve._l(Le+(i?.1:-.1)).toCSS()};`),s.push(`--color-background-alt-2: ${ve._l(Le+(i?.15:-.15)).toCSS()};`)}this.css_tweaks.toggleHide("dark-toggle",e);let h=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));if(!h&&o&&(h=Mt.Color.RGBA.fromCSS(i?"#FFF":"#000")),h){s.push(`--color-text-base: ${h.toCSS()};`),s.push(`--color-text-input: ${h.toCSS()};`);const ve=h.toHSLA(),Le=ve.a;s.push(`--color-text-label: ${h.toCSS()};`),s.push(`--color-text-label-optional: ${ve._a(Le-.4).toCSS()};`),s.push(`--color-text-alt: ${ve._a(Le-.2).toCSS()};`),s.push(`--color-text-alt-2: ${ve._a(Le-.4).toCSS()};`)}const _=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!_),_){_.a=1;const ve=_.toHSLA(),Le=ve.l,Ee=Xt.map(Ue=>Ue===0?_.toCSS():ve._l(Le+Ue).toCSS());for(let Ue=0;Ue<Ee.length;Ue++)s.push(`--ffz-color-accent-${Ue+1}:${Ee[Ue]};`);let je=i?ti.dark:ti.light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&s.push(`--color-${Ue}:${Ee[Je-1]};`);je=i?ti.accent_dark:ti.accent_light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&n.push(`--color-${Ue}:${Ee[Je-1]} !important;`)}let E=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background")),R;!E&&o&&(E=Mt.Color.RGBA.fromCSS(i?"#FFF":"#000")),E?(s.push(`--color-background-tooltip: ${E.toCSS()};`),R=E.toHSLA().l<.5):R=!i;let T=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const N=T||E;if(T||(T=Mt.Color.RGBA.fromCSS(R?"#FFF":"#000")),T){N&&s.push(`--color-text-tooltip: ${T.toCSS()};`);const ve=T.toHSLA(),Le=ve.a;s.push(`--color-text-tooltip-alt: ${ve._a(Le-.2).toCSS()};`),s.push(`--color-text-tooltip-alt-2: ${ve._a(Le-.4).toCSS()};`)}const Y=[],ce=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let me=i;if(ce){ce.a=1,Y.push(`--color-background-body: ${ce.toCSS()};`);const ve=ce.toHSLA(),Le=ve.l;me=Le<.5,Y.push(`--color-background-input-focus: ${ce.toCSS()};`),Y.push(`--color-background-base: ${ve._l(Le+(me?.05:-.05)).toCSS()};`),Y.push(`--color-background-alt: ${ve._l(Le+(me?.1:-.1)).toCSS()};`),Y.push(`--color-background-alt-2: ${ve._l(Le+(me?.15:-.15)).toCSS()};`)}let pe=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));if(!pe&&ce&&(pe=Mt.Color.RGBA.fromCSS(me?"#FFF":"#000")),pe){Y.push(`--color-text-base: ${pe.toCSS()};`),Y.push(`--color-text-input: ${pe.toCSS()};`);const ve=pe.toHSLA(),Le=ve.a;Y.push(`--color-text-label: ${pe.toCSS()};`),Y.push(`--color-text-label-optional: ${ve._a(Le-.4).toCSS()};`),Y.push(`--color-text-alt: ${ve._a(Le-.2).toCSS()};`),Y.push(`--color-text-alt-2: ${ve._a(Le-.4).toCSS()};`)}const Ae=Mt.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),Fe=[];if(Ae){Ae.a=1;const ve=Ae.toHSLA(),Le=ve.l,Ee=Xt.map(Ue=>Ue===0?Ae.toCSS():ve._l(Le+Ue).toCSS());for(let Ue=0;Ue<Ee.length;Ue++)Y.push(`--ffz-color-accent-${Ue+1}:${Ee[Ue]};`);let je=me?ti.dark:ti.light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&Y.push(`--color-${Ue}:${Ee[Je-1]};`);je=me?ti.accent_dark:ti.accent_light;for(const[Ue,Je]of Object.entries(je.c))typeof Je=="number"&&Fe.push(`--color-${Ue}:${Ee[Je-1]} !important;`)}Y.length?this.css_tweaks.set("chat-colors",`.chat-shell {${Y.join(`
`)}}.chat-shell .tw-accent-region{${Fe.join(`
`)}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(Y.length||s.length),s.length?this.css_tweaks.set("colors",`body {${s.join(`
`)}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${n.join(`
`)}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(e){if(e){const i=[];for(let s=0;s<15;s++)i.push(`--ffz-color-accent-${s+1}:var(--color-twitch-purple-${s+1});`);this.css_tweaks.set("accent-normal",`body {${i.join(`
`)}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(e){}onEnable(){this.updateCSS(),this.updateFont()}};B(Ss,"ThemeEngine");let bi=Ss;const Vi=Q.p+"clips-main.css",Gi=class Gi extends ft.Z{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject(ot.Z),this.inject("router",_t.Z),this.inject(vt.default,!1),this.inject(Ut.default),this.inject("css_tweaks",Gt),this.css_tweaks.loader=Q(39706),this.css_tweaks.rules={"unfollow-button":".follow-btn__follow-btn--following,.follow-btn--following","player-gain-volume":'.video-player__overlay[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__overlay[data-controls="false"] .extension-taskbar,.video-player__overlay[data-controls="false"] .extension-container,.video-player__overlay[data-controls="false"] .extensions-dock__layout,.video-player__overlay[data-controls="false"] .extensions-notifications,.video-player__overlay[data-controls="false"] .extensions-video-overlay-size-container',"dark-toggle":'div[data-a-target="dark-mode-toggle"],div[data-a-target="dark-mode-toggle"] + div'},this.inject(Vt),this.inject(ni),this.inject("theme",bi),this.ClipsMenu=this.fine.define("clips-menu",i=>i.props?.signup&&(0,r.has)(i.state,"dropdownOpen")),document.head.appendChild((0,se.createElement)("link",{href:Vi,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}))}onLoad(){this.router.route(Gi.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){const e=this.fine.searchNode(null,o=>o.memoizedProps?.store),i=this.store=e?.memoizedProps?.store;if(!i)return(0,r.sleep)(50).then(()=>this.onEnable());this.ClipsMenu.on("mount",this.updateMenu,this),this.ClipsMenu.on("update",this.updateMenu,this),this.ClipsMenu.ready((o,h)=>{for(const _ of h)this.updateMenu(_)}),this.on("i18n:update",()=>{for(const o of this.ClipsMenu.instances)this.updateMenu(o)}),i.subscribe(()=>this.updateContext()),this.updateContext(),this.settings.updateContext({clips:!0});const s=B(()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}}),"update_size");window.addEventListener("resize",s),s(),this.router.on(":route",(o,h)=>{this.log.info("Navigation",o&&o.name,h&&h[0]),this.fine.route(o&&o.name),this.settings.updateContext({route:o,route_data:h})});const n=this.router.current;this.fine.route(n&&n.name),this.settings.updateContext({route:n,route_data:this.router.match}),this.settings.add("clips.layout.big",{default:!1}),this.settings.getChanges("channel.hide-unfollow",o=>this.css_tweaks.toggleHide("unfollow-button",o)),this.settings.getChanges("clips.layout.big",o=>this.css_tweaks.toggle("full-width",o))}updateContext(){try{const e=this.store.getState(),i=this.router?.reactLocation;this.settings.updateContext({location:i,ui:e?.ui,session:e?.session})}catch(e){this.log.error("Error updating context.",e)}}getSession(){return this.store?.getState?.()?.session}getUser(){if(this._user)return this._user;const e=this.getSession();return this._user=e?.user}updateMenu(e){const i=this.fine.getChildNode(e),s=i&&i.querySelector(".clips-top-nav-user__dropdown--open");if(!s)return;const n=e.state.dropdownOpen;let o,h,_=s.querySelector(".ffz--cc-button");if(_)if(n)h=_.querySelector("button"),o=_.querySelector(".ffz--label");else{_.remove();return}else{if(!n)return;const E=B(()=>{const R=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");R&&R.focus(),e.toggleDropdown(!1)},"handler");_=(0,se.createElement)("div",{class:"ffz--cc-button"},h=(0,se.createElement)("button",{class:"tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onclick:E},(0,se.createElement)("div",{class:"tw-align-items-center tw-c-text-alt tw-flex tw-pd-x-2 tw-pd-y-05"},o=(0,se.createElement)("div",{class:"ffz--label tw-flex-grow-1 tw-ellipsis"})))),s.insertBefore(_,s.lastElementChild)}o.textContent=h.title=this.i18n.t("site.menu_button","FrankerFaceZ Control Center")}};B(Gi,"ClipsSite");let ii=Gi;ii.CLIP_ROUTES={"clip-page":"/:slug"},ii.CHAT_ROUTES=["clip-page"],ii.DIALOG_SELECTOR="#root > div";const Cs=class Cs extends d.default{constructor(e,i){super(e,i),this.Vue=null,this.i18n=null,this.key="ffz-stuff",this._components={},this.inject("i18n")}async onLoad(){const e=window.ffzVue=this.Vue=(await Promise.all([Q.e(4047),Q.e(7485)]).then(Q.bind(Q,35702))).default,i=this._components,[s,n,o]=await Promise.all([Promise.all([Q.e(4047),Q.e(7485)]).then(Q.bind(Q,6108)),Promise.all([Q.e(4047),Q.e(7485)]).then(Q.t.bind(Q,59010,19)),Promise.all([Q.e(4047),Q.e(7485)]).then(Q.bind(Q,8222))]);this.component(o.default),e.use(s),e.mixin(n.mixin);for(const h in i)(0,r.has)(i,h)&&e.component(h,i[h]);this._components=null,e.use(this)}component(e,i){if(typeof e=="function")for(const s of e.keys())this.component(s.slice(2,s.length-4),e(s).default);else if(typeof e=="object")for(const s in e)(0,r.has)(e,s)&&this.component(s,e[s]);else this.Vue?this.Vue.component(e,i):this._components&&(this._components[e]=i)}install(e){const i=this;this._vue_i18n||(this._vue_i18n=new e({data(){return{locale:i.i18n.locale,phrases:{}}},methods:{tNumber_(s,n){return this.locale,i.i18n.formatNumber(s,n)},tDate_(s,n){return this.locale,i.i18n.formatDate(s,n)},tTime_(s,n){return this.locale,i.i18n.formatTime(s,n)},tDateTime_(s,n){return this.locale,i.i18n.formatDateTime(s,n)},t_(s,n,o){return this.locale&&this.phrases[s],i.i18n.t(s,n,o)},tList_(s,n,o){return this.locale&&this.phrases[s],i.i18n.tList(s,n,o)},tNode_(s,n){return this.locale,i.i18n.formatNode(s,n)},setLocale(s){i.i18n.locale=s}}}),this.on("i18n:transform",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:changed",()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}}),this.on("i18n:loaded",s=>{const n=this._vue_i18n,o=n.phrases;for(const h of s)n.$set(o,h,(o[h]||0)+1)}),e.prototype.$i18n=this._vue_i18n),e.component("t-list",{props:{tag:{required:!1},phrase:{type:String,required:!0},default:{type:String,required:!0},data:{type:Object,required:!1}},render(s){return s(this.tag||"span",this.$i18n.tList_(this.phrase,this.default,Object.assign({},this.data,this.$scopedSlots)).map(n=>typeof n=="function"?n():n))}}),e.mixin({methods:{reactNavigate(s,n,o){const h=i.resolve("site.router");h&&(n&&(n.preventDefault(),n.stopPropagation()),h.push(s,o??void 0))},getReactURL(s,n,o,...h){return i.resolve("site.router").getURL(s,n,o,...h)},getI18n(){return i.i18n},t(s,n,o){return this.$i18n.t_(s,n,o)},tList(s,n,o){return this.$i18n.tList_(s,n,o)},tNode(s,n){return this.$i18n.tNode_(s,n)},tNumber(s,n){return this.$i18n.tNumber_(s,n)},tDate(s,n){return this.$i18n.tDate_(s,n)},tTime(s,n){return this.$i18n.tTime_(s,n)},tDateTime(s,n){return this.$i18n.tDateTime_(s,n)}}})}};B(Cs,"VueModule");let ui=Cs;const Bi=ui;var ri=Q(8528),xi=Q(6170);const xs=class xs extends d.default{constructor(e,i){super(e,i),this.i18n=null,this.types={},this.inject("i18n"),this.should_enable=!0,this.types.json=s=>{const n=s.dataset.title;return[n&&(0,se.createElement)("strong",null,n),(0,se.createElement)("code",{className:`block${n?" pd-t-05 border-t mg-t-05":""}`,style:{fontFamily:"monospace",textAlign:"left"}},s.dataset.data)]},this.types.child=s=>{const n=s.querySelector(":scope > .ffz-tooltip-child");return n?(s._ffz_child=n,n.remove(),n.classList.remove("ffz-tooltip-child"),n):null},this.types.child.onHide=s=>{const n=s._ffz_child;n&&(s._ffz_child=null,n.remove(),s.querySelector(":scope > .ffz-tooltip-child")||(n.classList.add("ffz-tooltip-child"),s.appendChild(n)))},this.types.markdown=(s,n)=>{n.add_class="ffz-tooltip--markdown";const o=(0,xi.e)();return o?o.render(s.dataset.title):(0,xi.Z)().then(h=>h.render(s.dataset.title))},this.types.text=s=>(0,se.sanitize)(s.dataset.title??""),this.types.html=s=>s.dataset.title,this.onFSChange=this.onFSChange.bind(this)}getAddonProxy(e,i,s){if(!e)return this;const n={},o=f.DEBUG||i?.dev;let h;return n.define=(_,E)=>(E&&(E.__source=e),this.define(_,E)),o&&(n.cleanup=()=>(s.log.warn('[DEV-CHECK] Instead of calling tooltips.cleanup(), you can emit the event "tooltips:cleanup"'),this.cleanup()),h={types:"Please use tooltips.define()"}),(0,d.buildAddonProxy)(s,this,"tooltips",n,h)}onEnable(){const e=this.getRoot();window.addEventListener("fullscreenchange",this.onFSChange),this.container=e,this.tip_element=e,this.tips=this._createInstance(e),this.on(":cleanup",this.cleanup),this.on("addon:fully-unload",i=>{let s=0;for(const[n,o]of Object.entries(this.types))o?.__source===i&&(s++,this.types[n]=void 0);s&&(this.log.debug(`Cleaned up ${s} entries when unloading addon:`,i),this.cleanup())})}define(e,i){this.types[e]=i}getRoot(){return document.querySelector(".sunlight-root")||document.querySelector("#root")||document.querySelector(".clips-root")||document.body}_createInstance(e,i="ffz-tooltip",s="text",n){return new ri.default(e,i,{html:!0,i18n:this.i18n,live:!0,check_modifiers:!0,container:n||e,delayHide:this.checkDelayHide.bind(this,s),delayShow:this.checkDelayShow.bind(this,s),content:this.process.bind(this,s),interactive:this.checkInteractive.bind(this,s),hover_events:this.checkHoverEvents.bind(this,s),onShow:this.delegateOnShow.bind(this,s),onHide:this.delegateOnHide.bind(this,s),popperConfig:this.delegatePopperConfig.bind(this,s),popper:{placement:"top",modifiers:{flip:{}}},onHover:(o,h,_)=>{this.emit(":hover",o,h,_)},onLeave:(o,h,_)=>{this.emit(":leave",o,h,_)}})}onFSChange(){this.container||(this.container=this.getRoot());let e=this.container;document.fullscreenElement instanceof HTMLElement&&(e=document.fullscreenElement),e!==this.tip_element&&(this.tip_element=e,this.tips&&(this.tips.destroy(),this.tips=this._createInstance(e)))}cleanup(){this.tips&&this.tips.cleanup()}delegatePopperConfig(e,i,s,n){const o=i.dataset.tooltipType||e,h=this.types[o];return i.dataset.tooltipSide&&(n.placement=i.dataset.tooltipSide),h&&h.popperConfig?h.popperConfig(i,s,n):n}delegateOnShow(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];o&&o.onShow&&o.onShow(i,s)}delegateOnHide(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];o&&o.onHide&&o.onHide(i,s)}checkDelayShow(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.delayShow!=null?(0,r.maybe_call)(o.delayShow,null,i,s):0}checkDelayHide(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.delayHide!=null?(0,r.maybe_call)(o.delayHide,null,i,s):0}checkInteractive(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.interactive!=null?(0,r.maybe_call)(o.interactive,null,i,s):!1}checkHoverEvents(e,i,s){const n=i.dataset.tooltipType||e,o=this.types[n];return o?.hover_events!=null?(0,r.maybe_call)(o.hover_events,null,i,s):!1}process(e,i,s){const n=i.dataset.tooltipType||e||"text",o=i.dataset.tooltipAlign,h=this.types[n];return o&&(s.align=o),h?h(i,s):[(0,se.createElement)("strong",null,"Unhandled Tooltip Type"),(0,se.createElement)("code",{className:"tw-block pd-t-05 border-t mg-t-05",style:{fontFamily:"monospace",textAlign:"left"}},JSON.stringify(i.dataset,null,4))]}};B(xs,"TooltipProvider");let di=xs;const Bs={1:{staff:{1:{color:"#200f33",svg:!0,trans:{color:"#6441a5"}}},admin:{1:{color:"#faaf19",svg:!0}},global_mod:{1:{color:"#0c6f20",svg:!0}},broadcaster:{1:{color:"#e71818",svg:!0}},moderator:{1:{color:"#34ae0a",svg:!0}},twitchbot:{1:{color:"#34ae0a"}},partner:{1:{color:"transparent",trans:{image:!0,color:"#6441a5"}}},"clip-champ":{1:{color:"#6441a5"}},vip:{1:{color:"#b33ff0",trans:{color:"transparent",invert:!1}}},turbo:{1:{color:"#6441a5",svg:!0}},premium:{1:{color:"#009cdc"}},subscriber:{0:{color:"#6441a5"},1:{color:"#6441a5"}}},2:{staff:{1:{color:"#000"}},admin:{1:{color:"#DB7600"}},broadcaster:{1:{color:"#E91916"}},moderator:{1:{color:"#00AD03"}},global_mod:{1:{color:"#006441"}},twitchbot:{1:{color:"#00AD03"}},partner:{1:{color:"#9146FF"}},subscriber:{0:{color:"#8205B4"},1:{color:"#8205B4"}},vip:{1:{color:"#E005B9"}},turbo:{1:{color:"#59399A"}},premium:{1:{color:"#00A0D6"}},"anonymous-cheerer":{1:{color:"#4B367C"}},"clip-champ":{1:{color:"#9146FF"}},"artist-badge":{1:{color:"#1e69ff"}},no_audio:{1:{color:"#323239"}},no_video:{1:{color:"#323239"}}}},Rs={staff:-2,admin:-1,global_mod:-1,broadcaster:0,mod:1,moderator:1,twitchbot:1,vip:2,subscriber:25},Os="background-repeat:no-repeat;background-position:center;",qs=`${f.SERVER}/static/badges/twitch/`,Zi=f.IS_WEBKIT?"webkitMaskImage":"maskImage",Ri={0:k=>`${k.fore?`color:${k.fore};`:""}background:${k.image||""} ${k.color};background-size:${k.scale*1.8}rem;${k.svg?"":`background-image:${k.image_set};`}${Os}`,1:k=>`${Ri[0](k)}border-radius:${k.scale*.2}rem;`,2:k=>`${Ri[0](k)}border-radius:${k.scale*.9}rem;background-size:${k.scale*1.6}rem;`,3:k=>`${k.fore?`color:${k.fore};`:""}background:${k.color};border-radius:${k.scale*.9}rem;`,4:k=>`${Ri[3](k)}height:${k.scale}rem;min-width:${k.scale}rem;`,5:k=>`background:${k.image};background-size:${k.scale*1.8}rem;${k.svg?"":`background-image:${k.image_set};`}${Os}`,6:k=>`background:linear-gradient(${k.color},${k.color});${f.WEBKIT_CSS}mask-image:${k.image};${f.WEBKIT_CSS}mask-size:${k.scale*1.8}rem ${k.scale*1.8}rem;${k.svg?"":`${f.WEBKIT_CSS}mask-image:${k.image_set};`}`};function Ys(k,e){const i=k.urls||{1:k.image},s=`url("${i[1]}")`,n=`${f.WEBKIT_CSS}image-set(${s} 1x${i[2]?`, url("${i[2]}") 2x`:""}${i[4]?`, url("${i[4]}") 4x`:""})`;return e===3||e===4?"":e===6?`${f.WEBKIT_CSS}mask-image:${s} !important;${f.WEBKIT_CSS}mask-image:${n} !important;`:`background-image:${s} !important;background-image:${n} !important;`}B(Ys,"generateOverrideCSS");function oi(k,e,i,s,n,o=2,h,_,E=1,R=!1){let T=i.color||"transparent",N=i.fore||n?"#fff":"#000",Y=i.image||(i.addon?null:`${qs}${o}/${k}${i.svg?".svg":`/${e}/`}`),ce=!1,me=!1,pe,Ae,Fe;if(Y&&s>4){const ve=i.trans||{};T=ve.color||T,ve.image&&(ce=!0,ve.image!==!0&&(Y=ve.image)),(0,r.has)(ve,"invert")?me=ve.invert&&!n:me=s===5&&!n}return(s===3||s===4)&&T==="transparent"&&i.trans&&(T=i.trans.color||T),T==="transparent"&&(s=0),Y&&s!==3&&s!==4&&(pe=Y.endsWith(".svg"),i.urls?Ae=`url("${i.urls[E]}")`:Ae=`url("${pe?Y:`${Y}${E}${ce?"_trans":""}.png`}")`,i.urls&&E===1?Fe=`${f.WEBKIT_CSS}image-set(${Ae} 1x${i.urls[2]?`, url("${i.urls[2]}") 2x`:""}${i.urls[4]?`, url("${i.urls[4]}") 4x`:""})`:i.urls&&E===2?Fe=`${f.WEBKIT_CSS}image-set(${Ae} 1x${i.urls[4]?`, url("${i.urls[4]}") 2x`:""})`:!pe&&E<4?E===1?Fe=`${f.WEBKIT_CSS}image-set(${Ae} 1x, url("${Y}2${ce?"_trans":""}.png") 2x, url("${Y}4${ce?"_trans":""}.png") 4x)`:E===2&&(Fe=`${f.WEBKIT_CSS}image-set(${Ae} 1x, url("${Y}4${ce?"_trans":""}.png") 2x)`):Fe=Ae),h&&T&&T!=="transparent"&&(T=h.process(T)||T),_&&N&&N!=="transparent"&&T!=="transparent"&&(_.base=T,N=_.process(N)||N),Y||(s>4?s=1:s>3&&(s=2)),`${R&&(i.click_handler||i.click_url||i.click_action)?"cursor:pointer;":""}${me?"filter:invert(100%);":""}${Ri[s]({scale:1,color:T,fore:N,image:Ae,image_set:Fe,svg:pe})}${i.css||""}`}B(oi,"generateBadgeCSS");const Es=class Es extends d.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.style=new se.ManagedStyle("badges"),this.bulk=new Map,this._woofer_months={},this.badges={},this.twitch_badges={},f.IS_FIREFOX&&this.settings.add("chat.badges.media-queries",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use @media queries to support High-DPI Badge images in Mozilla Firefox.",description:"This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.",component:"setting-check-box"}}),this.settings.add("chat.badges.version",{default:2,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Version",component:"setting-select-box",data:[{value:1,title:"1 (Pre December 2019)"},{value:2,title:"2 (Current)"}]}}),this.settings.add("chat.badges.clickable",{default:2,process(i,s){return s===!0?2:s===!1?0:s},ui:{path:"Chat > Badges >> Behavior",title:"Allow clicking badges.",description:"Certain badges, such as Prime Gaming, act as links when this is enabled.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Legacy (Open URLs)"},{value:2,title:"Open Badge Card"}]}}),this.settings.add("chat.badges.fix-colors",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Adjust badge colors for visibility.",description:`Ensures that badges are visible against the current background.

**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.`,component:"setting-check-box"}}),this.settings.add("chat.badges.hidden",{default:{},type:"object_merge",ui:{path:"Chat > Badges >> tabs ~> Visibility",title:"Visibility",component:"badge-visibility",getBadges:i=>this.getSettingsBadges(!0,i)}}),this.settings.add("chat.badges.custom-mod",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom moderator badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.custom-vip",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom VIP badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.style",{default:1,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Style",component:"setting-select-box",data:[{value:0,title:"Square"},{value:1,title:"Rounded"},{value:2,title:"Circular"},{value:3,title:"Circular (Color Only)"},{value:4,title:"Circular (Color Only, Small)"},{value:5,title:"Transparent"},{value:6,title:"Transparent (Colored)"}]}}),this.handleClick=this.handleClick.bind(this)}getSettingsBadges(e,i){const s=[],n=[],o=[],h=[],_=[],E=[],R={},T=[];if(!Object.keys(this.twitch_badges).length&&i){const pe=this.resolve("site.twitch_data");pe&&pe.getBadges().then(Ae=>{this.updateTwitchBadges(Ae),i()})}for(const pe in this.twitch_badges)if((0,r.has)(this.twitch_badges,pe)){const Ae=this.twitch_badges[pe],Fe=[];let ve=Ae&&(Ae[1]||Ae[0]);for(const Le in Ae)if(Le!=="__cat"&&(0,r.has)(Ae,Le)){const Ee=Ae[Le];ve||(ve=Ee),Ee&&Ee.image1x&&Fe.push({version:Le,name:Ee.title,image:Ee.image1x,styleImage:`url("${Ee.image1x}")`})}if(ve){let Le;Ae.__cat==="m-other"?Le=n:Ae.__cat==="m-owl"?Le=o:Ae.__cat==="m-tcon"?Le=h:Ae.__cat==="m-game"?Le=_:Le=s,Le.push({id:pe,provider:"twitch",name:ve.title,color:"transparent",image:ve.image2x,versions:Fe,styleImage:`url("${ve.image2x}")`})}}if(e){const pe={};for(const[Ae,Fe]of Object.entries(this.badges)){if(Fe.no_visibility)continue;let ve=Fe.urls?Fe.urls[2]||Fe.urls[1]:Fe.image,Le=Fe.urls?.[1]||Fe.image,Ee=Fe.color||"transparent";Fe.addon||(ve=`//cdn.frankerfacez.com/badge/${Fe.id}/2/rounded`,Le=`//cdn.frankerfacez.com/badge/${Fe.id}/1/rounded`,Ee="transparent");let je;typeof Fe.addon=="string"?je=R[Fe.addon]=R[Fe.addon]||[]:je=Fe.addon?T:E;let Ue=Fe.title,Je;try{Je=(0,r.maybe_call)(Fe.tooltipExtra,this,null,Fe)}catch{Je=null}Je&&!(Je instanceof Promise)&&(Ue=Ue+Je);const ht=Fe.base_id??Ae,yt=ht===Ae;let Qe=pe[ht];Qe?(Qe.versions||(Qe.versions=[{version:Qe.key,name:Qe.tipname,color:Qe.color,image:Qe.image1x,styleImage:`url("${Qe.image1x}")`}]),Qe.versions.push({version:Ae,name:Ue,color:Ee,image:Le,styleImage:`url("${Le}")`}),yt&&(Qe.name=Fe.title,Qe.tipname=Ue,Qe.color=Ee,Qe.image=ve,Qe.styleImage=`url("${ve}")`)):(Qe={id:ht,key:Ae,provider:"ffz",name:Fe.title,tipname:Ue,color:Ee,image:ve,image1x:Le,styleImage:`url("${ve}")`},Fe.base_id&&(Qe.always_versions=!0,Qe.versions=[{version:Qe.key,name:Qe.tipname,color:Qe.color,image:Qe.image1x,styleImage:`url("${Qe.image1x}")`}]),pe[ht]=Qe,je.push(Qe))}}const Y=[{title:"Twitch",id:"m-twitch",badges:s},{title:"Twitch: TwitchCon",id:"m-tcon",badges:h},{title:"Twitch: Other",id:"m-other",badges:n},{title:"Twitch: Overwatch League",id:"m-owl",badges:o},{title:"Twitch: Game",id:"m-game",key:"game",badges:_}];E.length&&Y.push({title:"FrankerFaceZ",id:"m-ffz",badges:E});const ce=this.resolve("addons"),me=[];for(const[pe,Ae]of Object.entries(R)){const Fe=ce?.getAddon?.(pe),ve=Fe?.short_name??Fe?.name??pe;me.push({title:`Add-On: ${ve}`,id:`m-addon-${pe}`,badges:Ae})}return me.sort((pe,Ae)=>pe.title.localeCompare(Ae.title)),Y.push(...me),T.length&&Y.push({title:"Add-on",id:"m-addon",badges:T}),Y}onEnable(){this.parent.context.on("changed:chat.badges.custom-mod",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.custom-vip",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.style",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.is-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.tooltips-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.version",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.media-queries",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.fix-colors",this.rebuildColoredBadges,this),this.parent.context.on("changed:chat.badges.clickable",this.rebuildAllCSS,this),this.rebuildAllCSS(),this.loadGlobalBadges(),this.on("chat:reload-data",e=>{(!e||e.badges)&&this.loadGlobalBadges()}),this.on("addon:fully-unload",e=>{let i=0;for(const[s,n]of Object.entries(this.badges))n?.__source===e&&(i++,this.removeBadge(s,!1));i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,e),this.generateBadgeCSS())}),this.tooltips.types.badge=(e,i)=>{i.add_class="ffz__tooltip--badges";const s=this.parent.context.get("tooltip.badge-images"),n=this.getBadgeData(e);if(n.data==null)return ri.NoContent;const o=[];let h=!1;for(const _ of n.data){let E=null;_.room&&(E=this.resolve("site.chat")?.shared_room_data?.get(_.room)?.displayName,E&&(E=`

${E}`));const R=_.provider;if(R==="twitch"){const T=this.getTwitchBadge(_.badge,_.version,n.room_id,n.room_login),N=this.getTwitchBadge(_.badge,_.version,null,null,!0)||{};if(!T)continue;let Y=T.title||N.title;const ce=T.tier||N.tier;_.data&&(_.badge==="subscriber"?ce>0?Y=this.i18n.t("badges.subscriber.tier-months",`{title}
(Tier {tier}, {months, plural, one {# Month} other {# Months}})`,{title:Y,tier:ce,months:_.data}):Y=this.i18n.t("badges.subscriber.months",`{title}
({count, plural, one {# Month} other {# Months}})`,{title:Y,count:_.data}):_.badge==="founder"&&(Y=this.i18n.t("badges.founder.months",`{title}
(Subscribed for {count, plural, one {# Month} other {# Months}})`,{title:Y,count:_.data}))),o.push((0,se.createElement)("div",{class:"ffz-badge-tip"},s&&(0,se.createElement)("img",{class:"preview-image ffz-badge",src:T.image4x}),Y,E))}else if(R==="ffz"){const T=this.badges[_.id],N=_.badge,Y=(0,r.maybe_call)(N?.tooltipExtra??T?.tooltipExtra,this,n,N,e,i);Y instanceof Promise?(h=!0,o.push(Y.then(ce=>(0,se.createElement)("div",{class:"ffz-badge-tip"},s&&_.image&&(0,se.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:_.color,backgroundImage:`url("${_.image}")`}}),_.title,ce||"",E)))):o.push((0,se.createElement)("div",{class:"ffz-badge-tip"},s&&_.image&&(0,se.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:_.color,backgroundImage:`url("${_.image}")`}}),_.title,Y||"",E))}}return h?Promise.all(o):o}}getAddonProxy(e,i,s){if(!e)return this;const n=f.DEBUG||(i?.dev??!1),o=(0,r.makeAddonIdChecker)(e),h={},_={};return h.loadBadgeData=(E,R,...T)=>(R&&R.addon===void 0&&(R.addon=e),n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to chat.badges.loadBadgeData() did not include addon ID in badge_id:",E),this.loadBadgeData(E,R,...T)),n&&(h.removeBadge=(E,...R)=>{const T=this.badges[E];return T&&T.addon!==e&&s.log.warn("[DEV-CHECK] Removed un-owned badge with chat.badges.removeBadge():",key," owner:",T.addon??"ffz"),this.removeBadge(E,...R)},h.setBulk=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to chat.badges.setBulk() did not include addon ID in source:",E),this.setBulk(E,...R)),h.deleteBulk=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to chat.badges.deleteBulk() did not include addon ID in source:",E),this.deleteBulk(E,...R)),h.extendBulk=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to chat.badges.extendBulk() did not include addon ID in source:",E),this.extendBulk(E,...R)),_.badges="Please use loadBadgeData() or removeBadge()"),(0,d.buildAddonProxy)(s,this,"chat.badges",h,_)}getBadgeData(e){let i=e.parentElement?.parentElement;i?.dataset?.roomId||(i=e.closest("[data-room-id]"));const s=i?.dataset?.roomId,n=i?.dataset?.room,o=i?.dataset?.userId,h=i?.dataset?.user;let _;if(e.dataset.badgeData)_=JSON.parse(e.dataset.badgeData);else{const E=e.dataset.badgeIdx;let R;if(i.message)R=i.message;else{const T=this.resolve("site.fine");if(T){if(R=i[T.accessor]?.return?.stateNode?.props?.message,R||(R=T.searchParent(i,N=>N.props?.message)?.props?.message),!R&&this.root.flavor==="clips"){const N=this.resolve("site.chat.line"),Y=T.searchParent(i,ce=>ce.props?.node)?.props?.node;N&&Y&&(R=N.messages.get(Y))}R||(R=T.searchParent(i,N=>N.props?.node)?.props?.node?._ffz_message),R||(R=T.searchParent(i,N=>N.props?.messageContext)?.props?.messageContext?.comment?._ffz_message),R||(R=T.searchParent(i,N=>N._ffzIdentityMsg,50)?._ffzIdentityMsg)}}R?._ffz_message&&(R=R._ffz_message),R&&(_=R.ffz_badge_cache?.[E]?.[1]?.badges)}return{room_id:s,room_login:n,user_id:o,user_login:h,data:_}}handleClick(e){const i=this.parent.context.get("chat.badges.clickable");if(!i)return;const s=e.target,n=this.getBadgeData(s);if(n.data==null)return;let o=null,h=null;for(const _ of n.data){const E=_.provider;if(E==="twitch"){const R=this.getTwitchBadge(_.badge,_.version,n.room_id,n.room_login),T=this.getTwitchBadge(_.badge,_.version,null,null,!0)||{};if(!R)continue;i==1&&R.click_url?o=R.click_url:i==1&&T.click_url?o=T.click_url:i==1&&(R.click_action==="sub"||T.click_action==="sub")&&n.room_login?o=`https://www.twitch.tv/subs/${n.room_login}`:h=R;break}else if(E==="ffz"){const R=this.badges[s.dataset.badge];if(R?.click_handler){o=R.click_handler(n.user_id,n.user_login,n.room_id,n.room_login,n.data,e);break}if(R?.click_url){o=R.click_url;break}}}if(h){const _=this.resolve("site.fine");if(_){const E=_.searchParent(s,R=>R.openBadgeDetails&&R.props?.message);if(E){E.openBadgeDetails(h,e);return}}}o&&(0,se.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:o}).click(),e.preventDefault()}cacheBadges(e,i=!1){if(e.ffz_badge_cache)return e.ffz_badge_cache;const s=i?{}:this.parent.context.get("chat.badges.hidden")||{},n=this.parent.context.get("chat.badges.style"),o=this.parent.context.get("chat.badges.custom-mod"),h=this.parent.context.get("chat.badges.custom-vip"),_=n>5,E=n!==5,R=n!==3&&n!==4,T=this.twitch_badges,N=new Map,Y=e.badges||{},ce=e.badgeDynamicData||{},me=e.sourceRoomID?e.sourceRoomID:e.roomID,pe=e.sourceRoomID?null:e.roomLogin,Ae=this.parent.getRoom(me,pe,!0),Fe=e.ffz_badges;let ve=50,Le;for(const Ee in Y)if((0,r.has)(Y,Ee)){const je=Y[Ee],Ue=s[Ee],Je=T&&T[Ee],ht=Je&&Je.__cat||"m-twitch";if(!Ee||Ue||Ue==null&&s[ht])continue;(0,r.has)(Rs,Ee)?Le=Rs[Ee]:Le=ve++;const yt=ce[Ee]||Ee==="founder"&&ce.subscriber,Qe=Ee==="moderator"&&o&&Ae&&Ae.data&&Ae.data.mod_urls,bt=Ee==="vip"&&h&&Ae&&Ae.data&&Ae.data.vip_badge,Ct=[];if(Qe){const Yt=this.getTwitchBadge(Ee,je,me,pe);Ct.push({provider:"ffz",image:Qe[4]||Qe[2]||Qe[1],color:"#34ae0a",title:Yt?Yt.title:"Moderator",room:me,data:yt})}else if(bt){const Yt=this.getTwitchBadge(Ee,je,me,pe);Ct.push({provider:"ffz",image:bt[4]||bt[2]||bt[1],color:"transparent",title:Yt?Yt.title:"VIP",room:me,data:yt})}else Ct.push({provider:"twitch",badge:Ee,version:je,room:me,data:yt});N.set(Le,{id:Ee,props:{"data-provider":"twitch","data-badge":Ee,"data-version":je,style:{}},badges:Ct})}if(Array.isArray(Fe)){const Ee=new Set;for(const je of Fe)if(je&&je.id!=null){if(Ee.has(je.id))continue;Ee.add(je.id);const Ue=this.badges[je.id]||{},Je=typeof Ue.addon=="string"?`m-addon-${Ue.addon}`:Ue.addon?"m-addon":"m-ffz",ht=je.base_id??je.id,yt=s[ht];if(yt||yt==null&&s[Je])continue;const Qe=(0,r.has)(je,"slot")?je.slot:Ue.slot,bt=N.get(Qe),Ct=je.urls||(je.image?{1:je.image}:null),Yt=je.color||Ue.color||"transparent",ci=je.no_invert,pi=Yt!=="transparent"&&_,Ti=Ct||Ue.urls||{1:Ue.image},mi={provider:"ffz",id:je.id,badge:je,room:je.room,image:Ti[4]||Ti[2]||Ti[1],color:je.color||Ue.color,title:je.title||Ue.title};Ue.addon||(mi.image=`//cdn.frankerfacez.com/badge/${je.id}/4/rounded`,mi.color=null);let Zt;if(bt){bt.badges.push(mi);const si=(0,r.has)(je,"replaces")?je.replaces:Ue.replaces,Si=je.replaces_type||Ue.replaces_type;if(si&&(!Si||Si===bt.id))bt.replaced=je.id,bt.content=je.content||Ue.content||bt.content;else continue;Zt=bt.props.style}else{if(Qe==null)continue;{Zt={};const si={className:"ffz-tooltip ffz-badge","data-tooltip-type":"badge","data-provider":"ffz","data-badge":je.id,style:Zt};N.set(Qe,{id:je.id,props:si,badges:[mi],content:je.content||Ue.content})}}if(ci){const si=N.get(Qe);si.full_size=!0,si.no_invert=!0,Zt.background="unset",Zt.backgroundSize="unset",Zt[Zi]="unset"}if((R||Yt==="transparent")&&Ct){const si=`url("${Ct[1]}")`;let Si;(Ct[2]||Ct[4])&&(Si=`${f.WEBKIT_CSS}image-set(${si} 1x${Ct[2]?`, url("${Ct[2]}") 2x`:""}${Ct[4]?`, url("${Ct[4]}") 4x`:""})`),Zt[pi&&!ci?Zi:"backgroundImage"]=si,Si&&(Zt[pi&&!ci?Zi:"backgroundImage"]=Si)}E&&je.color&&(pi&&!ci?Zt.backgroundImage=`linear-gradient(${je.color},${je.color})`:Zt.backgroundColor=je.color)}}return e.ffz_badge_cache=Array.from(N).sort((Ee,je)=>Ee[0]-je[0])}render(e,i,s=!1,n=!1){if(!e.badges&&!e.ffz_badges||(e.ffz_badge_cache||this.cacheBadges(e,s),!e.ffz_badge_cache.length))return null;const o=[];for(let h=0,_=e.ffz_badge_cache.length;h<_;h++){const E=e.ffz_badge_cache[h][1],R=E.props;let T=(0,r.maybe_call)(E.content,this,E,e,i);T&&!Array.isArray(T)&&(T=[T]),R.className=`ffz-tooltip ffz-badge${T?" tw-pd-x-05":""}${E.full_size?" ffz-full-size":""}${E.no_invert?" ffz-no-invert":""}`,R.key=`${R["data-provider"]}-${R["data-badge"]}`,R["data-tooltip-type"]="badge",R["data-badge-idx"]=h,n||(R.onClick=this.handleClick),E.replaced&&(R["data-replaced"]=E.replaced),o.push(i("span",R,T||void 0))}return o}rebuildColor(){this.parent.context.get("chat.badges.fix-colors")?(this.fg_fixer=new Mt.ColorAdjuster("#fff",1,4.5),this.color_fixer=new Mt.ColorAdjuster(this.parent.context.get("theme.is-dark")?"#181818":"#FFFFFF",1,2.5)):(this.fg_fixer=null,this.color_fixer=null)}rebuildColoredBadges(){this.rebuildColor(),this.buildBadgeCSS(),this.buildTwitchCSSBadgeCSS()}rebuildAllCSS(){this.rebuildColor();for(const e of this.parent.iterateRooms())e.buildBadgeCSS(),e.buildModBadgeCSS();this.buildBadgeCSS(),this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}getBadges(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=this.parent.getUser(e,i,!0);h&&(e=e??h.id,i=i??h.login);const _=o&&o.getUser(e,i,!0),E=(h?.badges?h.badges._cache:[]).concat(_?.badges?_.badges._cache.map(R=>({...R,room:s})):[]);if(this.bulk.size){const R=String(e);for(const[T,N]of this.bulk)N?._cache.has(R)&&E.push({id:T})}return E}setBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0)),n.set(e,s)}deleteBulk(e,i){const s=this.bulk.get(i);s&&s.delete(e)}extendBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0)),Array.isArray(s)||(s=[s]),n.extend(e,...s)}async loadGlobalBadges(e=0){this.load_tracker.schedule("chat-data","ffz-global-badges");let i,s;if(this.experiments.getAssignment("api_load")&&e<1)try{fetch(`${f.NEW_API}/v1/badges/ids`).catch(()=>{})}catch{}try{i=await fetch(`${this.staging.api}/v1/badges/ids`)}catch(h){return e++,e<10?setTimeout(()=>this.loadGlobalBadges(e),500*e):(this.log.error("Error loading global badge data.",h),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1)}if(!i.ok)return this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1;try{s=await i.json()}catch(h){return this.log.error("Error parsing global badge data.",h),this.load_tracker.notify("chat-data","ffz-global-badges",!1),!1}let n=0,o=0;if(s.badges)for(const h of s.badges)h&&h.id&&(this.loadBadgeData(h.id,h,!1),n++);if(s.users){for(const h in s.users)if((0,r.has)(s.users,h)){const _=this.badges[h],E=_?.name;let R=0;if(E==="supporter"||E==="subwoofer"||E==="bot")this.setBulk("ffz-global",h,s.users[h].map(T=>String(T))),R=s.users[h].length;else for(const T of s.users[h])this.parent.getUser(T,void 0).addBadge("ffz-global",h)&&(R++,o++);R>0&&this.log.info(`Added "${_?_.name:`#${h}`}" to ${R} users.`)}}this.log.info(`Loaded ${n} badges and assigned them to ${o} users.`),this.buildBadgeCSS(),this.load_tracker.notify("chat-data","ffz-global-badges")}getBadge(e){return this.badges[e]??null}removeBadge(e,i=!0){this.badges[e]&&(delete this.badges[e],i&&this.buildBadgeCSS())}loadBadgeData(e,i,s=!0){this.badges[e]=i,i&&(i.addon===void 0&&(i.addon=/^addon/.test(e)),i.replaces&&!i.replaces_type&&(i.replaces_type=i.replaces,i.replaces=!0),!i.addon&&(i.name==="developer"||i.name==="subwoofer"||i.name==="supporter")&&(i.click_url="https://www.frankerfacez.com/subscribe"),!i.addon&&i.name==="subwoofer"&&(i.base_id=i.id,i.tooltipExtra=n=>n?.user_id?this.getSubwooferMonths(n.user_id).then(o=>{if(o?.months)return o.lifetime?`
`+this.i18n.t("badges.subwoofer.lifetime","Lifetime Subwoofer"):`
`+this.i18n.t("badges.subwoofer.months","({count, plural, one {# Month} other {# Months}})",{count:o.months})}):null)),s&&this.buildBadgeCSS()}getSubwooferMonths(e){let i=this._woofer_months[e];if(i instanceof Promise)return i;const s=i?.expires;return s&&Date.now()>=s&&(i=this._woofer_months[e]=null),i?.value?Promise.resolve(i.value):this._woofer_months[e]=fetch(`https://api.frankerfacez.com/v1/_user/id/${e}`).then(n=>n.ok?n.json():null).then(n=>{let o=null;return n?.user?.sub_months&&(o={months:n.user.sub_months,lifetime:n.user.sub_lifetime}),this._woofer_months[e]={expires:Date.now()+5*60*1e3,value:o},o}).catch(n=>(console.error("Error getting subwoofer data for user",e,n),this._woofer_months[e]={expires:Date.now()+60*1e3,value:null},null))}buildBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),i=this.parent.context.get("theme.is-dark"),s=this.parent.context.get("chat.badges.clickable"),n=f.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),o=[];for(const h in this.badges)if((0,r.has)(this.badges,h)){const _=this.badges[h],E=`.ffz-badge[data-badge="${h}"]`;o.push(`.ffz-badge[data-replaced="${h}"]{${Ys(_,e,i)}}`),n?(o.push(`@media (max-resolution: 99dpi) {${E}{${oi(h,0,_,e,i,0,this.color_fixer,this.fg_fixer,1,s)}}}`),o.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${E}{${oi(h,0,_,e,i,0,this.color_fixer,this.fg_fixer,2,s)}}}`),o.push(`@media (min-resolution: 200dpi) {${E}{${oi(h,0,_,e,i,0,this.color_fixer,this.fg_fixer,4,s)}}}`)):o.push(`${E}{${oi(h,0,_,e,i,0,this.color_fixer,this.fg_fixer,void 0,s)}}`)}this.style.set("ext-badges",o.join(`
`))}getTwitchBadge(e,i,s,n,o=!1){const h=this.parent.getRoom(s,n,!0);let _;if(h){const E=h.badges&&h.badges[e];_=E&&E[i]}if(!_){const E=this.twitch_badges&&this.twitch_badges[e];_=E&&E[i]}if(!_&&!o){const E=this.resolve("site.chat");E&&E.tryUpdateBadges&&E.tryUpdateBadges()}return _}getTwitchBadgeCount(){return this.twitch_badge_count||0}updateTwitchBadges(e){if(this.twitch_badge_count=0,!e)this.twitch_badges={};else if(!Array.isArray(e))this.twitch_badges=e;else{let i=null;if(e.length){i={};for(const s of e){const n=s.setID,o=i[n]=i[n]||{__cat:qi(n)};this.twitch_badge_count++,o[s.version]=Yi(s)}}this.twitch_badges=i}this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}buildTwitchCSSBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),i=this.parent.context.get("theme.is-dark"),s=this.parent.context.get("chat.badges.clickable"),n=f.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),o=this.parent.context.get("chat.badges.version"),h=Bs[o]||{},_=this.twitch_badges||{},E=[];for(const R in h)if((0,r.has)(h,R)){const T=h[R],N=_[R];for(const Y in T)if((0,r.has)(T,Y)){const ce=T[Y],me=N?.[Y],pe=`.ffz-badge[data-badge="${R}"][data-version="${Y}"]`;me&&me.click_url&&(ce.click_url=me.click_url),me&&me.click_action&&(ce.click_action=me.click_action),n?(E.push(`@media (max-resolution: 99dpi) {${pe}{${oi(R,Y,ce,e,i,o,this.color_fixer,this.fg_fixer,1,s)}}}`),E.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${pe}{${oi(R,Y,ce,e,i,o,this.color_fixer,this.fg_fixer,2,s)}}}`),E.push(`@media (min-resolution: 200dpi) {${pe}{${oi(R,Y,ce,e,i,o,this.color_fixer,this.fg_fixer,4,s)}}}`)):E.push(`${pe}{${oi(R,Y,ce,e,i,o,this.color_fixer,this.fg_fixer,void 0,s)}}`)}}this.style.set("css-badges",E.join(`
`))}buildTwitchBadgeCSS(){this.twitch_badges||this.style.delete("twitch-badges");const e=this.parent.context.get("chat.badges.version"),i=f.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),s=this.parent.context.get("chat.badges.clickable"),n=Bs[e]||{},o=[];for(const h in this.twitch_badges)if((0,r.has)(this.twitch_badges,h)){if((0,r.has)(n,h))continue;const _=this.twitch_badges[h];for(const E in _)if((0,r.has)(_,E)){const R=_[E],T=`.ffz-badge[data-badge="${h}"][data-version="${E}"]`;o.push(`${T} {
			${s&&(R.click_action||R.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${f.WEBKIT_CSS}mask-image: none;
			background-size: 1.8rem;
			background-image: url("${R.image1x}");
			background-image: ${f.WEBKIT_CSS}image-set(
				url("${R.image1x}") 1x,
				url("${R.image2x}") 2x,
				url("${R.image4x}") 4x
			);
		}`),i&&(o.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${T} {
								background-image: url("${R.image2x}");
							}}`),o.push(`@media (min-resolution: 200dpi) { ${T} {
								background-image: url("${R.image4x}");
							}}`))}}o.length?this.style.set("twitch-badges",o.join(`
`)):this.style.delete("twitch-badges")}};B(Es,"Badges");let Ki=Es;const Xs=["vga-champ-2017","warcraft","samusoffer_beta","power-rangers","bits-charity","glhf-pledge"];function qi(k){return Xs.includes(k)?"m-other":k.startsWith("overwatch-league")?"m-owl":k.startsWith("twitchcon")||k.startsWith("glitchcon")?"m-tcon":/_\d+$/.test(k)?"m-game":"m-twitch"}B(qi,"getBadgeCategory");function Yi(k){if(!k)return k;if(k={...k},!k.clickAction&&k.onClickAction&&(k.clickAction=k.onClickAction),k.clickAction==="VISIT_URL"&&k.clickURL&&(k.click_url=k.clickURL),k.clickAction==="TURBO"&&(k.click_url="https://www.twitch.tv/products/turbo?ref=chat_badge"),k.clickAction==="SUBSCRIBE"&&k.channelName?k.click_url=`https://www.twitch.tv/subs/${k.channelName}`:k.clickAction&&(k.click_action="sub"),k.setID==="subscriber"){const e=parseInt(k.version,10);!isNaN(e)&&isFinite(e)?(k.tier=(e-e%1e3)/1e3,k.tier<0&&(k.tier=0)):k.tier=0}return k}B(Yi,"fixBadgeData");var Js=Q(98750),$s=Q.n(Js),Qs=Q(60795),en=Q.n(Qs);const ai=Symbol("FFZ:Hover:RAF"),yi=Symbol("FFZ:Hover:State"),tn=f.IS_OSX?"metaKey":"ctrlKey",Pt=(0,r.make_enum_flags)("Hidden","FlipX","FlipY","GrowX","Slide","Appear","Leave","Rotate","Rotate90","Greyscale","Sepia","Rainbow","HyperRed","Shake","Cursed","Jam","Bounce","NoSpace"),Ei=Pt,pr=Object.values(Ei).filter(k=>typeof k=="number"),Oi=[[0,-18,0,0],[19.99,-18,0,0],[20,-18,.1,0],[25,-16,.2,.6],[30,-14,.3,-4],[35,-12,.4,.6],[40,-10,.5,-4],[45,-8,.6,2],[50,-6,.7,-3],[55,-4,.8,2],[60,-2,.9,-3],[65,0,1,0],[100,0,1,0]],$i=[[0,0,1,0],[39.99,0,1,0],[40,0,-.9,.9,-3],[45,-2,-.8,.8,2],[50,-4,-.7,.7,-3],[55,-6,-.6,.6,2],[60,-8,-.5,.5,-4],[65,-10,-.4,.4,.6],[70,-12,-.3,.3,-4],[75,-14,-.2,.2,.6],[80,-16,-.1,.1,0],[85,-18,-.01,0,0],[100,-18,0,0,0]];function li(k,e=1,i=0,s=!1){const n=[];for(const o of k){const h=o[0]*e+i;let _,E,R,T;if(_=s?"var(--ffz-effect-transforms) ":"",E=o[1]===0?"":`translateX(${o[1]}px) `,o.length===4)R=`scale(${o[2]})`,T=o[3]===0?"":` translateY(${o[3]}px)`;else{const N=o[2],Y=o[3];R=`scale(${N}, ${Y})`,T=o[4]===0?"":` translateY(${o[4]}px)`}n.push(`	${h}% { transform:${_}${E}${R}${T}; }`)}return n.join(`
`)}B(li,"appearLeaveToKeyframes");const Fi=[{setting:"FlipX",flags:Pt.FlipX,title:"Flip Horizontal",transform:"scaleX(-1)"},{setting:"FlipY",flags:Pt.FlipY,title:"Flip Vertical",transform:"scaleY(-1)"},{setting:"ShrinkX",flags:Pt.ShrinkX,title:"Squish Horizontal"},{setting:"GrowX",flags:Pt.GrowX,title:"Stretch Horizontal"},{setting:"Slide",flags:Pt.Slide,title:"Slide Animation",as_background:!0,animation:"ffz-effect-slide var(--ffz-speed-x) linear infinite",raw:`@keyframes ffz-effect-slide {
0% { background-position-x: 0; }
100% { background-position-x: calc(-1 * var(--ffz-width)); }
}`},{setting:"Appear",flags:Pt.Appear,not_flags:Pt.Leave,title:"Appear Animation",animation:"ffz-effect-appear 3s infinite linear",animationTransform:"ffz-effect-appear-transform 3s linear infinite",raw:`@keyframes ffz-effect-appear {
${li(Oi)}
}
@keyframes ffz-effect-appear-transform {
${li(Oi,1,0,!0)}
}`},{setting:"Leave",flags:Pt.Leave,not_flags:Pt.Appear,title:"Leave Animation",animation:"ffz-effect-leave 3s infinite linear",animationTransform:"ffz-effect-leave-transform 3s infinite linear",raw:`@keyframes ffz-effect-leave {
${li($i)}
}
@keyframes ffz-effect-leave-transform {
${li($i,1,0,!0)}
}`},{setting:["Appear","Leave"],flags:Pt.Appear|Pt.Leave,animation:"ffz-effect-in-out 6s infinite linear",animationTransform:"ffz-effect-in-out-transform 6s linear infinite",raw:`@keyframes ffz-effect-in-out {
${li(Oi,.5,0)}
${li($i,.5,50)}
}
@keyframes ffz-effect-in-out-transform {
${li(Oi,.5,0,!0)}
${li($i,.5,50,!0)}
}`},{setting:"Rotate",flags:Pt.Rotate,not_flags:Pt.Slide,title:"Rotate Animation",no_wide:!0,animation:"ffz-effect-rotate 1.5s infinite linear",animationTransform:"ffz-effect-rotate-transform 1.5s infinite linear",raw:`@keyframes ffz-effect-rotate {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
@keyframes ffz-effect-rotate-transform {
0% { transform: var(--ffz-effect-transforms) rotate(0deg); }
100% { transform: var(--ffz-effect-transforms) rotate(360deg); }
}`},{setting:"Rainbow",flags:Pt.Rainbow,title:"Rainbow Animation",animation:"ffz-effect-rainbow 2s linear infinite",animationFilter:"ffz-effect-rainbow-filter 2s linear infinite",raw:`@keyframes ffz-effect-rainbow {
	0% { filter: hue-rotate(0deg) }
	100% { filter: hue-rotate(360deg) }
}
@keyframes ffz-effect-rainbow-filter {
	0% { filter: var(--ffz-effect-filters) hue-rotate(0deg) }
	100% { filter: var(--ffz-effect-filters) hue-rotate(360deg) }
}`},{setting:"HyperRed",flags:Pt.HyperRed,title:"Hyper Red",filter:"brightness(0.2) sepia(1) brightness(2.2) contrast(3) saturate(8)"},{setting:"Shake",flags:Pt.Shake,title:"Hyper Shake Animation",animation:"ffz-effect-shake 0.1s linear infinite",animationTransform:"ffz-effect-shake-transform 0.1s linear infinite",raw:`@keyframes ffz-effect-shake-transform {
	0% { transform: var(--ffz-effect-transforms) translate(1px, 1px); }
	10% { transform: var(--ffz-effect-transforms) translate(-1px, -2px); }
	20% { transform: var(--ffz-effect-transforms) translate(-3px, 0px); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2px); }
	40% { transform: var(--ffz-effect-transforms) translate(1px, -1px); }
	50% { transform: var(--ffz-effect-transforms) translate(-1px, 2px); }
	60% { transform: var(--ffz-effect-transforms) translate(-3px, 1px); }
	70% { transform: var(--ffz-effect-transforms) translate(3px, 1px); }
	80% { transform: var(--ffz-effect-transforms) translate(-1px, -1px); }
	90% { transform: var(--ffz-effect-transforms) translate(1px, 2px); }
	100% { transform: var(--ffz-effect-transforms) translate(1px, -2px); }
}
@keyframes ffz-effect-shake {
	0% { transform: translate(1px, 1px); }
	10% { transform: translate(-1px, -2px); }
	20% { transform: translate(-3px, 0px); }
	30% { transform: translate(3px, 2px); }
	40% { transform: translate(1px, -1px); }
	50% { transform: translate(-1px, 2px); }
	60% { transform: translate(-3px, 1px); }
	70% { transform: translate(3px, 1px); }
	80% { transform: translate(-1px, -1px); }
	90% { transform: translate(1px, 2px); }
	100% { transform: translate(1px, -2px); }
}`},{setting:"Photocopy",flags:Pt.Cursed,title:"Cursed",filter:"grayscale(1) brightness(0.7) contrast(2.5)"},{setting:"Jam",flags:Pt.Jam,title:"Jam Animation",animation:"ffz-effect-jam 0.6s linear infinite",animationTransform:"ffz-effect-jam-transform 0.6s linear infinite",raw:`@keyframes ffz-effect-jam {
	0% { transform: translate(-2px, -2px) rotate(-6deg); }
	10% { transform: translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: translate(3px, 4px) rotate(-2deg); }
	50% { transform: translate(2px, 4px) rotate(3deg); }
	60% { transform: translate(1px, 4px) rotate(3deg); }
	70% { transform: translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: translate(-2px, -2px) rotate(-5deg); }
}
@keyframes ffz-effect-jam-transform {
	0% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-6deg); }
	10% { transform: var(--ffz-effect-transforms) translate(-1.5px, -2px) rotate(-8deg); }
	20% { transform: var(--ffz-effect-transforms) translate(1px, -1.5px) rotate(-8deg); }
	30% { transform: var(--ffz-effect-transforms) translate(3px, 2.5px) rotate(-6deg); }
	40% { transform: var(--ffz-effect-transforms) translate(3px, 4px) rotate(-2deg); }
	50% { transform: var(--ffz-effect-transforms) translate(2px, 4px) rotate(3deg); }
	60% { transform: var(--ffz-effect-transforms) translate(1px, 4px) rotate(3deg); }
	70% { transform: var(--ffz-effect-transforms) translate(-0.5px, 3px) rotate(2deg); }
	80% { transform: var(--ffz-effect-transforms) translate(-1.25px, 1px) rotate(0deg); }
	90% { transform: var(--ffz-effect-transforms) translate(-1.75px, -0.5px) rotate(-2deg); }
	100% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-5deg); }
}`},{setting:"Bounce",flags:Pt.Bounce,animation:"ffz-effect-bounce 0.5s linear infinite",animationTransform:"ffz-effect-bounce-transform 0.5s linear infinite",transformOrigin:"bottom center",raw:`@keyframes ffz-effect-bounce {
	0% { transform: scale(0.8, 1); }
	10% { transform: scale(0.9, 0.8); }
	20% { transform: scale(1, 0.4); }
	25% { transform: scale(1.2, 0.3); }
	25.001% { transform: scale(-1.2, 0.3); }
	30% { transform: scale(-1, 0.4); }
	40% { transform: scale(-0.9, 0.8); }
	50% { transform: scale(-0.8, 1); }
	60% { transform: scale(-0.9, 0.8); }
	70% { transform: scale(-1, 0.4); }
	75% { transform: scale(-1.2, 0.3); }
	75.001% { transform: scale(1.2, 0.3); }
	80% { transform: scale(1, 0.4); }
	90% { transform: scale(0.9, 0.8); }
	100% { transform: scale(0.8, 1); }
}
@keyframes ffz-effect-bounce-transform {
	0% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
	10% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	20% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	25% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	25.001% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	30% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	40% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	50% { transform: scale(-0.8, 1) var(--ffz-effect-transforms); }
	60% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }
	70% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }
	75% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }
	75.001% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }
	80% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }
	90% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }
	100% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }
}`},{setting:["Bounce","FlipY"],flags:Pt.Bounce|Pt.FlipY,transform:"translateY(100%)"}];function sn(){const k=[`.modified-emote[data-effects] > .chat-line__message--emote {
	--ffz-effect-filters: none;
	--ffz-effect-transforms: initial;
	--ffz-effect-animations: initial;
}`];for(const e of Fi)e.raw&&k.push(e.raw);return k.join(`
`)}B(sn,"generateBaseFilterCss");const Is={59847:{modifier_offset:"0 15px 15px 0",modifier:!0},70852:{modifier:!0,modifier_offset:"0 5px 20px 0",extra_width:5,shrink_to_fit:!0},70854:{modifier:!0,modifier_offset:"30px 0 0"},147049:{modifier:!0,modifier_offset:"4px 1px 0 3px"},147011:{modifier:!0,modifier_offset:"0"},70864:{modifier:!0,modifier_offset:"0"},147038:{modifier:!0,modifier_offset:"0"}},Fs=class Fs extends d.default{constructor(...e){super(...e),this.EmoteTypes=f.EmoteTypes,this.ModifierFlags=Ei,this.filters={},this.__filters=[],this.inject("i18n"),this.inject("settings"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.twitch_inventory_sets=new Set,this.__twitch_emote_to_set={},this.__twitch_set_to_channel={},this.__twitch_emote_to_artist={},this.bulk=new Map,this.effects_enabled={},this.pending_effects=new Set,this.applyEffects=this.applyEffects.bind(this),this.sub_sets=new r.SourcedSet,this.default_sets=new r.SourcedSet,this.global_sets=new r.SourcedSet,this.providers=new Map,this.setProvider("ffz",{name:"FrankerFaceZ",font_icon:"ffz-i-zreknarf"}),this.emote_sets={},this._set_refs={},this._set_timers={},this.settings.add("chat.emotes.source-priorities",{default:null,ui:{path:"Chat > Emote Priorities",component:"emote-priorities",data:()=>(0,r.deep_copy)(this.providers)}}),this.settings.add("chat.emotes.enabled",{default:2,ui:{path:"Chat > Appearance >> Emotes",title:"Display Emotes",sort:-100,force_seen:!0,description:"If you do not wish to see emotes, you can disable them here.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Only"},{value:2,title:"Enabled"}]}}),this.settings.add("chat.emotes.2x",{default:0,process(i,s){return s===!0?1:s===!1?0:s},ui:{path:"Chat > Appearance >> Emotes",title:"Larger Emotes",description:"This setting will make emotes appear twice as large in chat. It's good for use with larger fonts or just if you really like emotes.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Emotes"},{value:2,title:"Emotes and Emoji"}]}}),this.settings.add("chat.emotes.limit-size",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Limit Native Emote Size",description:"Sometimes, really obnoxiously large emotes slip through the cracks and wind up on Twitch. This limits the size of Twitch emotes to mitigate the issue.",component:"setting-check-box"}}),this.settings.add("chat.emotes.allow-gigantify",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:'Allow "Gigantify an Emote" Power-Up',description:"How big is too big? Giant? Disable this and the emotes will be displayed normally.",component:"setting-check-box"}}),this.settings.add("chat.fix-bad-emotes",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Fix Bad Twitch Global Emotes",description:"Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.",component:"setting-check-box"}}),this.settings.add("chat.click-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information pages by Shift-Clicking them.",component:"setting-check-box"}}),this.settings.add("chat.sub-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open Twitch subscription pages by Shift-Clicking emotes when relevant.",component:"setting-check-box"}}),this.settings.add("chat.emote-dialogs",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information cards for Twitch emotes by clicking them.",component:"setting-check-box"}}),this.settings.add("chat.effects.enable",{default:!0,ui:{path:"Chat > Emote Effects >> General",title:"Enable the use of emote effects.",description:"Emote Effects are special effects that can be applied to some emotes using special modifiers.",component:"setting-check-box"}});for(const i of Fi){if(!i.setting||Array.isArray(i.setting))continue;const s={default:i.animation?null:!0,ui:{path:'Chat > Emote Effects >> Specific Effect @{"description": "**Note:** Animated effects are, by default, only enabled when [Animated Emotes](~chat.appearance.emotes) are enabled."}',title:`Enable the effect "${i.title??i.setting}".`,component:"setting-check-box",force_seen:!0}};i.animation&&(s.default=null,s.requires=["chat.emotes.animated"],s.process=function(n,o){return o??n.get("chat.emotes.animated")===1}),this.settings.add(`chat.effects.${i.setting}`,s)}this.handleClick=this.handleClick.bind(this),this.animHover=this.animHover.bind(this),this.animLeave=this.animLeave.bind(this)}getAddonProxy(e,i,s){if(!e)return this;const n=f.DEBUG||i?.dev,o=(0,r.makeAddonIdChecker)(e),h={},_={};return h.addFilter=E=>(E&&(E.__source=e),this.addFilter(E)),h.setProvider=(E,R)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.setProvider did not include addon ID in provider:",E),R&&(R.__source=e),this.setProvider(E,R)),h.addDefaultSet=(E,R,T)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet did not include addon ID in provider:",E),this.providers.has(E)||(this.inferProvider(E,e),n&&s.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet for provider that has not been registered with emotes.setProvider:",E)),T&&(n&&!o.test(R)&&s.log.warn("[DEV-CHECK] Call to emotes.addDefaultSet loaded set data but did not include addon ID in set ID:",R),T.__source=e),this.addDefaultSet(E,R,T)),h.addSubSet=(E,R,T)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.addSubSet did not include addon ID in provider:",E),this.providers.has(E)||(this.inferProvider(E,e),n&&s.log.warn("[DEV-CHECK] Call to emotes.addSubSet for provider that has not been registered with emotes.setProvider:",E)),T&&(n&&!o.test(R)&&s.log.warn("[DEV-CHECK] Call to emotes.addSubSet loaded set data but did not include addon ID in set ID:",R),T.__source=e),this.addSubSet(E,R,T)),h.loadSetData=(E,R,...T)=>(n&&!o.test(E)&&s.log.warn("[DEV-CHECK] Call to emotes.loadSetData did not include addon ID in set ID:",E),R&&(R.__source=e),this.loadSetData(E,R,...T)),n&&(h.removeFilter=E=>{let R;typeof E=="string"?R=E:R=E.type;const T=this.filters[R];return T&&T.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned emote filter with emotes.removeFilter:",R," owner:",T.__source??"ffz"),this.removeFilter(E)},h.removeDefaultSet=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to emotes.removeDefaultSet did not include addon ID in provider:",E),this.removeDefaultSet(E,...R)),h.removeSubSet=(E,...R)=>(o.test(E)||s.log.warn("[DEV-CHECK] Call to emotes.removeSubSet did not include addon ID in provider:",E),this.removeSubSet(E,...R)),_.style=!0,_.effect_style=!0,_.emote_sets=!0,_.loadSetUserIds=_.loadSetUsers="This method is meant for internal use."),(0,d.buildAddonProxy)(s,this,"emotes",h,_)}onEnable(){this.style=new se.ManagedStyle("emotes"),this.effect_style=new se.ManagedStyle("effects"),this.base_effect_css=sn(),this.parent.context.getChanges("chat.emotes.source-priorities",this.updatePriorities,this),this.parent.context.on("changed:chat.effects.enable",this.updateEffects,this);for(const s of Fi)s.setting&&!Array.isArray(s.setting)&&this.parent.context.on(`changed:chat.effects.${s.setting}`,this.updateEffects,this);this.updateEffects();const e=this.getFavorites("twitch");let i=!1;for(let s=0;s<e.length;s++)typeof e[s]=="number"&&(i=!0,e[s]=`${e[s]}`);if(i&&this.setFavorites("twitch",e),Object.keys(this.emote_sets).length){this.log.info("Generating CSS for existing emote sets.");for(const s in this.emote_sets)if((0,r.has)(this.emote_sets,s)){const n=this.emote_sets[s];n&&(n.pending_css||n.css)&&(this.style.set(`es--${s}`,(n.pending_css||"")+(n.css||"")),n.pending_css=null)}}this.on("pubsub:command:follow_sets",this.updateFollowSets,this),this.on("pubsub:command:add_emote",s=>{const n=s.set_id,o=s.emote,h=this.emote_sets[n];if(!h)return;const _=!!h.emotes?.[o.id]||!!h.disabled_emotes?.[o.id],E=this.addEmoteToSet(n,o);this.maybeNotifyChange(_?"modified":"added",n,E)}),this.on("pubsub:command:remove_emote",s=>{const n=s.set_id,o=s.emote_id;if(!this.emote_sets[n])return;const h=this.removeEmoteFromSet(n,o);h&&this.maybeNotifyChange("removed",n,h)}),this.on("chat:reload-data",s=>{(!s||s.emotes)&&this.loadGlobalSets()}),this.on("addon:fully-unload",s=>{let n=0;for(const[o,h]of Object.entries(this.emote_sets))h?.__source===s&&(n++,this.loadSetData(o,null,!0));for(const[o,h]of Object.entries(this.filters))h?.__source===s&&(n++,this.removeFilter(o));for(const[o,h]of this.providers.entries())h?.__source===s&&(n++,this.setProvider(o,null));n&&this.log.debug(`Cleaned up ${n} entries when unloading addon:`,s)}),this.loadGlobalSets()}updatePriorities(e){const i=e?.length;!i||i<=0?this.sourceSortFn=null:this.sourceSortFn=(s,n)=>{s.startsWith("ffz-")&&(s="ffz"),n.startsWith("ffz-")&&(n="ffz");let o=e.indexOf(s),h=e.indexOf(n);return o===-1&&(o=i),h===-1&&(h=i),o-h},this.default_sets.setSortFunction(this.sourceSortFn),this.emit(":update-priorities",this.sourceSortFn)}inferProvider(e,i){if(this.providers.has(e))return;const s=this.resolve("addons")?.getAddon(i);s&&this.setProvider(e,{name:s.name,i18n_key:s.name_i18n,icon:s.icon,description:e,__source:i})}setProvider(e,i){i?(i.id=e,this.providers.set(e,i)):this.providers.delete(e)}addFilter(e,i=!0){const s=e.type;if((0,r.has)(this.filters,s)){this.log.warn(`Tried adding emote filter of type '${s}' when one was already present.`);return}this.filters[s]=e,e.priority==null&&(e.priotiy=0),this.__filters.push(e),this.__filters.sort((n,o)=>n.priority>o.priority?-1:n.priority<o.priority?1:n.type<o.type),i&&this.updateFiltered()}removeFilter(e,i=!0){let s;if(typeof e=="string"?s=e:s=e.type,e=this.filters[s],!e)return null;delete this.filters[s];const n=this.__filters.indexOf(e);return n!==-1&&(this.__filters.splice(n,1),i&&this.updateFiltered()),e}shouldFilterEmote(e,i,s){for(const n of this.__filters)if(n.test(e,i,s))return!0;return!1}updateFiltered(){for(const e of Object.values(this.emote_sets)){const i={},s={};let n=0,o=0,h=!1;for(const E of Object.values(e.emotes))this.shouldFilterEmote(E,e,e.id)?(s[E.id]=E,o++,h=!0):(i[E.id]=E,n++);for(const E of Object.values(e.disabled_emotes))this.shouldFilterEmote(E,e,e.id)?(s[E.id]=E,o++):(i[E.id]=E,n++,h=!0);if(!h)continue;this.log.info(`Filtered emote set #${e.id}: ${e.title} (total: ${n+o}, old: ${e.disabled_count}, new: ${o})`),e.emotes=i,e.count=n,e.disabled_emotes=s,e.disabled_count=o;const _=[];for(const E of Object.values(i)){const R=this.generateEmoteCSS(E);R?.length&&_.push(R)}this.style&&(_.length||e.css)?this.style.set(`es--${e.id}`,_.join("")+(e.css||"")):_.length&&(e.pending_css=_.join("")),this.emit(":loaded",e.id,e)}}maybeNotifyChange(e,i,s){this._pending_notifications||(this._pending_notifications=[]),this._pending_notifications.push({action:e,set_id:i,emote:s}),this._pending_timer||(this._pending_timer=setTimeout(()=>this._handleNotifyChange(),1e3))}_handleNotifyChange(){clearTimeout(this._pending_timer),this._pending_timer=null;const e=this._pending_notifications;this._pending_notifications=null;const i=this.resolve("site.chat");if(!i?.addNotice)return;const s=this.resolve("site").getUser();if(!s?.id)return;let n=this.parent.context.get("context.channelID"),o=this.parent.context.get("context.channel");const h=this.getSetIDs(s.id,s.login,n,o),_={};for(const E of e){const R=`${E.set_id}`,T=E.action;if(h.includes(R)){const N=_[R]=_[R]||{},Y=N[T]=N[T]||[];if(Y.find(ce=>ce.id===E.emote.id))continue;Y.push(E.emote)}}for(const[E,R]of Object.entries(_)){const T=this.emote_sets[E];if(T)for(const[N,Y]of Object.entries(R)){const ce=Y.map(pe=>pe.name).join(", ");let me;N==="added"?me=this.i18n.t("emote-updates.added","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been added to {set}.",{count:Y.length,emotes:ce,set:T.title}):N==="modified"?me=this.i18n.t("emote-updates.modified","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been updated in {set}.",{count:Y.length,emotes:ce,set:T.title}):N==="removed"&&(me=this.i18n.t("emote-updates.removed","The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been removed from {set}.",{count:Y.length,emotes:ce,set:T.title})),me&&i.addNotice("*",{icon:"ffz-i-zreknarf",message:me})}}}ensureEffect(e){this.effect_style.has(`${e}`)||(this.pending_effects.add(e),this._effect_timer||(this._effect_timer=requestAnimationFrame(this.applyEffects)))}applyEffects(){this._effect_timer=null;const e=this.pending_effects;this.pending_effects=new Set;for(const i of e){const s=this.generateFilterCss(i);this.effect_style.set(`${i}`,s??"")}}generateFilterCss(e){if(!this.parent.context.get("chat.effects.enable"))return null;let i,s,n,o,h=[];for(const _ of this.activeEffectStyles)(e&_.flags)===_.flags&&(_.not_flags&&(e&_.not_flags)===_.not_flags||(_.animation&&h.push(_),_.filter&&(i=i?`${i} ${_.filter}`:_.filter),_.transformOrigin&&(s=_.transformOrigin),_.transform&&(n=n?`${n} ${_.transform}`:_.transform)));if(h.length)for(const _ of h)i&&_.animationFilter?o=o?`${o}, ${_.animationFilter}`:_.animationFilter:n&&_.animationTransform?o=o?`${o}, ${_.animationTransform}`:_.animationTransform:o=o?`${o}, ${_.animation}`:_.animation;return!i&&!n&&!o?null:`.modified-emote[data-effects="${e}"] > .chat-line__message--emote {${i?`
	--ffz-effect-filters: ${i};
	filter: var(--ffz-effect-filters);`:""}${s?`
	transform-origin: ${s};`:""}${n?`
	--ffz-effect-transforms: ${n};
	transform: var(--ffz-effect-transforms);`:""}${o?`
	--ffz-effect-animations: ${o};
	animation: var(--ffz-effect-animations);`:""}
}`}updateEffects(){const e=this.parent.context.get("chat.effects.enable");this.effects_enabled={},this.activeEffectStyles=[],this.activeAsBackgroundMask=0,this.activeNoWideMask=0;for(const i of Fi)i.setting&&!Array.isArray(i.setting)&&(this.effects_enabled[i.setting]=this.parent.context.get(`chat.effects.${i.setting}`));for(const i of Fi){let s=!0;if(Array.isArray(i.setting)){for(const n of i.setting)if(!this.effects_enabled[n]){s=!1;break}}else i.setting&&(s=this.effects_enabled[i.setting]);s&&(this.activeEffectStyles.push(i),i.as_background&&(this.activeAsBackgroundMask=this.activeAsBackgroundMask|i.flags),i.no_wide&&(this.activeNoWideMask=this.activeNoWideMask|i.flags))}this.effect_style.clear(),!(!e||!this.activeEffectStyles.length)&&(this.effect_style.set("base",this.base_effect_css),this.emit(":update-effects"))}updateFollowSets(e){for(const i in e)if((0,r.has)(e,i)){const s=this.parent.getRoom(null,i,!0);if(!s||s.destroyed)continue;const n=e[i]||[],o=s.emote_sets,h=o&&o._sources;if(h&&h.has("ffz-featured"))for(const _ of h.get("ffz-featured")){const E=n.indexOf(_);E===-1?s.removeSet("ffz-featured",_):n.splice(E,1)}for(const _ of n)s.addSet("ffz-featured",_),this.emote_sets[_]||this.loadSet(_)}}toggleHidden(e,i,s=null){const n=`hidden-emotes.${e}`,o=this.settings.provider,h=o.get(n,[]),_=h.indexOf(i);if(s===null&&(s=_===-1),s&&_===-1)h.push(i);else if(!s&&_!==-1)h.splice(_,1);else return;h.length?o.set(n,h):o.delete(n),this.emit(":change-hidden",e,i,s)}isHidden(e,i){return this.getHidden(e).includes(i)}getHidden(e){return this.settings.provider.get(`hidden-emotes.${e}`)||[]}setHidden(e,i){const s=`hidden-emotes.${e}`;!Array.isArray(i)||!i.length?this.settings.provider.delete(s):this.settings.provider.set(s,i)}animHover(e){const i=e.currentTarget;i[yi]||(i[ai]&&cancelAnimationFrame(i[ai]),i[ai]=requestAnimationFrame(()=>{if(i[ai]=null,i[yi]||!i.matches(":hover"))return;i[yi]=!0;const s=i.querySelectorAll(".ffz-hover-emote");for(const n of s){const o=n.dataset;o.normalSrc&&o.hoverSrc&&(n.src=o.hoverSrc,n.srcset&&(n.srcset=o.hoverSrcSet))}}))}animLeave(e){const i=e.currentTarget;i[yi]&&(i[ai]&&cancelAnimationFrame(i[ai]),i[ai]=requestAnimationFrame(()=>{if(i[ai]=null,!i[yi]||i.matches(":hover"))return;i[yi]=!1;const s=i.querySelectorAll(".ffz-hover-emote");for(const n of s){const o=n.dataset;o.normalSrc&&(n.src=o.normalSrc,n.srcset&&(n.srcset=o.normalSrcSet))}}))}toggleFavorite(e,i,s=null){const n=`favorite-emotes.${e}`,o=this.settings.provider,h=o.get(n)||[],_=h.indexOf(i);if(s===null&&(s=_===-1),s&&_===-1)h.push(i);else if(!s&&_!==-1)h.splice(_,1);else return s;return h.length?o.set(n,h):o.delete(n),this.emit(":change-favorite",e,i,s),s}isFavorite(e,i){const s=this.settings.provider.get(`favorite-emotes.${e}`);return s&&s.includes(i)}getFavorites(e){return this.settings.provider.get(`favorite-emotes.${e}`)||[]}setFavorites(e,i){const s=`favorite-emotes.${e}`;!Array.isArray(i)||!i.length?this.settings.provider.delete(s):this.settings.provider.set(s,i)}handleClick(e,i=!1){const s=e.target,n=s&&s.dataset;if(!n)return;const o=n.provider,h=this.parent.context.get("chat.click-emotes"),_=this.parent.context.get("chat.sub-emotes");if(e.shiftKey&&(h||_)){let T;if(o==="twitch"){if(T=null,_){const N=this.resolve("site.apollo");if(N)return N.client.query({query:$s(),variables:{id:n.id}}).then(Y=>{const ce=(0,r.get)("data.emote.subscriptionProduct",Y);if(ce&&ce.state==="ACTIVE"&&ce.owner&&ce.owner.login)T=`https://www.twitch.tv/subs/${ce.owner.login}`;else if(!h)return!1;if(T){const me=window.open();me&&(me.opener=null,me.location=T)}}),!0}}else if(o==="ffz"){const N=this.emote_sets[n.set],Y=N&&(N.emotes[n.id]||N.disabled_emotes?.[n.id]);if(!Y)return;Y.click_url?T=Y.click_url:N.source||(T=`https://www.frankerfacez.com/emoticons/${Y.id}`)}if(!h)return!1;if(T){const N=window.open();N&&(N.opener=null,N.location=T)}return!0}if(e[tn]){let T,N;if(o==="twitch")T="twitch",N=n.id;else if(o==="ffz"){const ce=this.emote_sets[n.set],me=ce&&(ce.emotes[n.id]||ce.disabled_emotes?.[n.id]);if(!me)return;T=ce.source||"ffz",N=me.id}else if(o==="emoji")T="emoji",N=n.code;else return;this.toggleFavorite(T,N);const Y=s._ffz_tooltip;return Y&&Y.visible&&(Y.hide(),setTimeout(()=>document.contains(s)&&Y.show(),0)),!0}if(i)return!1;let E;try{E=JSON.parse(n.modifierInfo)}catch{}const R=this.makeEvent({provider:o,id:n.id,set:n.set,code:n.code,variant:n.variant,name:n.name||s.alt,modifiers:E,source:e});if(this.emit("chat.emotes:click",R),R.defaultPrevented)return!0;if(o==="twitch"&&this.parent.context.get("chat.emote-dialogs")){const T=this.resolve("site.fine");if(!T)return;const N=T.searchParent(s,me=>me.props&&me.props.message),Y=T.searchParent(s,me=>me.onShowEmoteCard,500);if(!N||!Y)return;const ce=s.getBoundingClientRect();return Y.onShowEmoteCard({channelID:N.props.channelID||"",channelLogin:N.props.channelLogin||"",emoteID:n.id,emoteCode:s.alt,sourceID:"chat",referrerID:"",initialTopOffset:ce.bottom,initialBottomOffset:ce.top}),!0}}getTargetEmote(){this.target_emote=null;const e=this.resolve("site").getUser(),i=e?this.resolve("site.chat.input"):null,s=i?i.getInput():null,n=this.resolve("site.chat.emote_menu")?.MenuWrapper?.first,o=n?.getAllSets?.(),h=o?o.map(_=>_.emotes).flat().filter(_=>!_.effects&&!_.locked):null;if(s&&h){const _={};for(let T=0;T<h.length;T++)_[h[T].name]||(_[h[T].name]=T);const E=s.split(" ");let R=E.length;for(;R--;){const T=E[R];if(_[T]!=null)return h[_[T]]}}if(h&&h.length){const _=Math.floor(Math.random()*h.length),E=h[_];return this.target_emote=E,E}return this.target_emote={provider:"ffz",set_id:3,id:149346,name:"LaterSooner",src:"https://cdn.frankerfacez.com/emote/149346/1",srcSet:"https://cdn.frankerfacez.com/emote/149346/1 1x, https://cdn.frankerfacez.com/emote/149346/2 2x, https://cdn.frankerfacez.com/emote/149346/4 4x",width:25,height:32}}getSetIDs(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=o&&o.getUser(e,i,!0),_=this.parent.getUser(e,i,!0);let E=(_?.emote_sets?_.emote_sets._cache:[]).concat(h?.emote_sets?h.emote_sets._cache:[],o?.emote_sets?o.emote_sets._cache:[],this.default_sets._cache);if(this.bulk.size){const R=String(e);for(const[T,N]of this.bulk)N?._cache.has(R)&&E.push(T)}if(o?.shared_chats?.size>0)for(const R of o.shared_chats){const T=this.parent.getRoom(R,null,!0),N=T&&T.getUser(e,i,!0);N?.emote_sets?._cache&&(E=E.concat(N.emote_sets._cache)),T?.emote_sets?._cache&&(E=E.concat(T.emote_sets._cache))}return E}getSets(e,i,s,n){return this.getSetIDs(e,i,s,n).map(o=>this.emote_sets[o])}_withSources(e,i,s,n=null){if(s?._sources){for(const[o,h]of s._sources)for(const _ of h)i.has(_)||(e.push([_,o,n]),i.add(_));return e}}getRoomSetIDsWithSources(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=o&&o.getUser(e,i,!0);if(!o)return[];const _=[],E=new Set;if(this._withSources(_,E,o.emote_sets,o.id),h&&this._withSources(_,E,h.emote_sets,o.id),o?.shared_chats?.size>0)for(const R of o.shared_chats){const T=this.parent.getRoom(R,null,!0),N=T&&T.getUser(e,i,!0);N&&this._withSources(_,E,N.emote_sets,R),T&&this._withSources(_,E,T.emote_sets,R)}return _}getRoomSetsWithSources(e,i,s,n){return this.getRoomSetIDsWithSources(e,i,s,n).map(([o,h,_])=>[this.emote_sets[o],h,_])}getRoomSetIDs(e,i,s,n){const o=this.parent.getRoom(s,n,!0),h=o&&o.getUser(e,i,!0);let _;if(o?h?.emote_sets?o.emote_sets?_=h.emote_sets._cache.concat(o.emote_sets._cache):_=h.emote_sets._cache:_=o.emote_sets?o.emote_sets._cache:[]:_=[],o?.shared_chats?.size>0)for(const E of o.shared_chats){const R=this.parent.getRoom(E,null,!0),T=R&&R.getUser(e,i,!0);T?.emote_sets?._cache&&(_=_.concat(T.emote_sets._cache)),R?.emote_sets?._cache&&(_=_.concat(R.emote_sets._cache))}return _}getRoomSets(e,i,s,n){return this.getRoomSetIDs(e,i,s,n).map(o=>this.emote_sets[o])}getGlobalSetIDsWithSources(e,i){const s=this.parent.getUser(e,i,!0),n=[],o=new Set;if(this._withSources(n,o,this.default_sets),s&&this._withSources(n,o,s.emote_sets),this.bulk.size){const h=String(e);for(const[_,E]of this.bulk)if(!o.has(_)&&E?._cache.has(h)){for(const[R,T]of E._sources)if(T&&T.includes(h)){n.push([_,R,null]);break}}}return n}getGlobalSetsWithSources(e,i){return this.getGlobalSetIDsWithSources(e,i).map(([s,n])=>[this.emote_sets[s],n,null])}getSubSetIDsWithSources(){const e=[],i=new Set;return this._withSources(e,i,this.sub_sets),e}getSubSetsWithSources(){return this.getSubSetIDsWithSources().map(([e,i])=>[this.emote_sets[e],i,null])}getGlobalSetIDs(e,i){const s=this.parent.getUser(e,i,!0),n=(s?.emote_sets?s.emote_sets._cache:[]).concat(this.default_sets._cache);if(this.bulk.size){const o=String(e);for(const[h,_]of this.bulk)_?._cache.has(o)&&n.push(h)}return n}getGlobalSets(e,i){return this.getGlobalSetIDs(e,i).map(s=>this.emote_sets[s])}getEmotes(e,i,s,n){const o={};for(const h of this.getSets(e,i,s,n))if(h&&h.emotes)for(const _ of Object.values(h.emotes))_&&!(0,r.has)(o,_.name)&&(o[_.name]=_);return o}setBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0));const o=n._cache.size;n.set(e,s);const h=n._cache.size;!o&&h&&this.refSet(i)}deleteBulk(e,i){const s=this.bulk.get(i);if(!s)return;const n=s._cache.size;s.delete(e);const o=s._cache.size;n&&!o&&this.unrefSet(i)}extendBulk(e,i,s){let n=this.bulk.get(i);n||this.bulk.set(i,n=new r.SourcedSet(!0)),Array.isArray(s)||(s=[s]);const o=n._cache.size;n.extend(e,...s);const h=n._cache.size;!o&&h&&this.refSet(i)}addDefaultSet(e,i,s){typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.default_sets.sourceIncludes(e,i)||(n=!this.default_sets.includes(i),this.default_sets.push(e,i),o=!0),s&&this.loadSetData(i,s),n&&(this.refSet(i),this.emit(":update-default-sets",e,i,!0)),o}removeDefaultSet(e,i){if(!i){const s=this.default_sets.get(e);if(s)for(const n of Array.from(s))this.removeDefaultSet(e,n);return}return typeof i=="number"&&(i=`${i}`),this.default_sets.sourceIncludes(e,i)?(this.default_sets.remove(e,i),this.default_sets.includes(i)||(this.unrefSet(i),this.emit(":update-default-sets",e,i,!1)),!0):!1}addSubSet(e,i,s){typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.sub_sets.sourceIncludes(e,i)||(n=!this.sub_sets.includes(i),this.sub_sets.push(e,i),o=!0),s&&this.loadSetData(i,s),n&&(this.refSet(i),this.emit(":update-sub-sets",e,i,!0)),o}removeSubSet(e,i){return typeof i=="number"&&(i=`${i}`),this.sub_sets.sourceIncludes(e,i)?(this.sub_sets.remove(e,i),this.sub_sets.includes(i)||(this.unrefSet(i),this.emit(":update-sub-sets",e,i,!1)),!0):!1}refSet(e){this._set_refs[e]=(this._set_refs[e]||0)+1,this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null)}unrefSet(e){(this._set_refs[e]=(this._set_refs[e]||1)-1)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout(()=>this.unloadSet(e),5e3))}async loadGlobalSets(e=0){this.load_tracker.schedule("chat-data","ffz-global");let i,s;if(this.experiments.getAssignment("api_load")&&e<1)try{fetch(`${f.NEW_API}/v1/set/global`).catch(()=>{})}catch{}try{i=await fetch(`${this.staging.api}/v1/set/global/ids`)}catch(o){return e++,e<10?setTimeout(()=>this.loadGlobalSets(e),500*e):(this.log.error("Error loading global emote sets.",o),this.load_tracker.notify("chat-data","ffz-global",!1),!1)}if(!i.ok)return this.load_tracker.notify("chat-data","ffz-global",!1),!1;try{s=await i.json()}catch(o){return this.log.error("Error parsing global emote data.",o),this.load_tracker.notify("chat-data","ffz-global",!1),!1}const n=s.sets||{};this.removeDefaultSet("ffz-global");for(const o of s.default_sets)this.addDefaultSet("ffz-global",o);for(const o in n)if((0,r.has)(n,o)){const h=n[o]?.id;this.loadSetData(o,n[o]),h&&!s.default_sets.includes(h)&&this.addSubSet("ffz-global",o)}return s.user_ids?this.loadSetUserIds(s.user_ids):s.users&&this.loadSetUsers(s.users),this.load_tracker.notify("chat-data","ffz-global"),!0}async loadSet(e,i=!1,s=0){const n=`ffz-${e}`;this.load_tracker.schedule("chat-data",n);let o,h;if(this.experiments.getAssignment("api_load"))try{fetch(`${f.NEW_API}/v1/set/${e}`).catch(()=>{})}catch{}try{o=await fetch(`${this.staging.api}/v1/set/${e}${this.staging.active?"/ids":""}`)}catch(E){return s++,s<10?setTimeout(()=>this.loadGlobalSets(s),500*s):(this.log.error(`Error loading data for set "${e}".`,E),this.load_tracker.notify("chat-data",n,!1),!1)}if(!o.ok)return this.load_tracker.notify("chat-data",n,!1),!1;try{h=await o.json()}catch(E){return this.log.error(`Error parsing data for set "${e}".`,E),this.load_tracker.notify("chat-data",n,!1),!1}const _=h.set;return _&&this.loadSetData(_.id,_,i),h.user_ids?this.loadSetUserIds(h.user_ids):h.users&&this.loadSetUsers(h.users),this.load_tracker.notify("chat-data",n,!0),!0}loadSetUserIds(e,i=!1){for(const s in e)if((0,r.has)(e,s)){const n=this.emote_sets[s],o=e[s];this.setBulk("ffz-global",s,o.map(h=>String(h))),i||this.log.info(`Added "${n?n.title:s}" emote set to ${o.length} users.`)}}loadSetUsers(e,i=!1){for(const s in e)if((0,r.has)(e,s)){const n=this.emote_sets[s],o=e[s];for(const h of o)this.parent.getUser(void 0,h).addSet("ffz-global",s);i||this.log.info(`Added "${n?n.title:s}" emote set to ${o.length} users.`)}}processEmote(e,i){return!e.id||!e.name||!e.urls?null:(e.set_id=i,e.src=e.urls[1],e.srcSet=`${e.urls[1]} 1x`,e.urls[2]&&(e.srcSet+=`, ${e.urls[2]} 2x`),e.urls[4]&&(e.srcSet+=`, ${e.urls[4]} 4x`),e.urls[2]&&(e.can_big=!0,e.src2=e.urls[2],e.srcSet2=`${e.urls[2]} 1x`,e.urls[4]&&(e.srcSet2+=`, ${e.urls[4]} 2x`)),e.animated?.[1]&&(e.animSrc=e.animated[1],e.animSrcSet=`${e.animated[1]} 1x`,e.animated[2]&&(e.animSrcSet+=`, ${e.animated[2]} 2x`,e.animSrc2=e.animated[2],e.animSrcSet2=`${e.animated[2]} 1x`,e.animated[4]&&(e.animSrcSet+=`, ${e.animated[4]} 4x`,e.animSrcSet2+=`, ${e.animated[4]} 2x`))),e.token={type:"emote",id:e.id,set:i,provider:"ffz",src:e.src,srcSet:e.srcSet,can_big:!!e.urls[2],src2:e.src2,srcSet2:e.srcSet2,animSrc:e.animSrc,animSrcSet:e.animSrcSet,animSrc2:e.animSrc2,animSrcSet2:e.animSrcSet2,masked:!!e.mask,mod:e.modifier,mod_prefix:e.modifier_prefix,mod_hidden:(e.modifier_flags&1)===1,text:e.hidden?"???":e.name,length:e.name.length,height:e.height,width:e.width,source_modifier_flags:e.modifier_flags??0},(0,r.has)(Is,e.id)&&Object.assign(e,Is[e.id]),e)}addEmoteToSet(e,i){const s=this.emote_sets[e];if(!s)throw new Error(`Invalid emote set "${e}"`);let n=this.processEmote(i,e);if(!n)throw new Error("Invalid emote data object.");const o=this.shouldFilterEmote(n,s,e);s.disabled_emotes[n.id]&&(delete s.disabled_emotes[n.id],s.disabled_count--);const _=s.emotes[n.id],E=_&&this.generateEmoteCSS(_);if(o)if(s.disabled_emotes[n.id]=n,s.disabled_count++,_){const T={};let N=0;for(const Y of Object.values(s.emotes))Y.id!=n.id&&(T[Y.id]=Y,N++);s.emotes=T,s.count=N}else return n;else s.emotes[n.id]=n,_||s.count++;const R=`es--${e}`;if(E&&E.length){const T=[];for(const N of Object.values(s.emotes)){const Y=this.generateEmoteCSS(N);Y&&Y.length&&T.push(Y)}this.style&&(T.length||s.css)?this.style.set(R,T.join("")+(s.css||"")):T.length&&(s.pending_css=T.join(""))}else if(!o){const T=this.generateEmoteCSS(n);T&&T.length&&(this.style?this.style.set(R,(this.style.get(R)||"")+T):s.pending_css=(s.pending_css||"")+T)}return this.emit(":loaded",e,s),n}removeEmoteFromSet(e,i){const s=this.emote_sets[e];if(!s)throw new Error(`Invalid emote set "${e}"`);i&&i.id&&(i=i.id);const n=s.disabled_emotes?.[i];if(n)return s.disabled_count--,delete s.disabled_emotes[i],n;const o=s.emotes[i];if(!o)return;const h=this.generateEmoteCSS(o),_=h&&h.length?[]:null,E={};let R=0;for(const T of Object.values(s.emotes))if(T.id!=i&&(E[T.id]=T,R++,_!=null)){const N=this.generateEmoteCSS(T);N&&N.length&&_.push(N)}if(s.emotes=E,s.count=R,_!=null){const T=`es--${e}`;this.style&&(_.length||s.css)?this.style.set(T,_.join("")+(s.css||"")):_.length&&(s.pending_css=_.join(""))}return this.emit(":loaded",e,s),o}loadSetData(e,i,s=!1){const n=this.emote_sets[e];if(!i){n&&(this.style&&this.style.delete(`es--${e}`),this.emote_sets[e]=null);return}this.emote_sets[e]=i;let o=0,h=0;const _=i.emotes||i.emoticons,E=i.emotes={},R=i.disabled_emotes={},T=[];i.id=e,i.emoticons=void 0;const N=[];for(const ce of _){let me=this.processEmote(ce,e);if(!me){N.push(ce);continue}if(this.shouldFilterEmote(me,i,e)){R[me.id]=me,h++;continue}const pe=this.generateEmoteCSS(me);pe&&T.push(pe),o++,E[me.id]=me}N.length&&this.log.warn(`Bad Emote Data for Set #${e}`,N),i.count=o,i.disabled_count=h,this.style&&(T.length||i.css)?this.style.set(`es--${e}`,T.join("")+(i.css||"")):T.length&&(i.pending_css=T.join("")),s||this.log.info(`Loaded emote set #${e}: ${i.title} (${o} emotes, ${h} filtered)`),this.emit(":loaded",e,i),(this._set_refs[e]||0)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout(()=>this.unloadSet(e),5e3))}unloadSet(e,i=!1,s=!1){const n=this.emote_sets[e],o=this._set_refs[e]||0;if(n){if(o>0){if(!i)return this.log.warn(`Attempted to unload emote set #${e} with ${o} users.`);this.log.warn(`Unloading emote set ${e} with ${o} users.`)}s||this.log.info(`Unloaded emote set #${e}: ${n.title}`),this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null),this.emit(":unloaded",e,n),this.emote_sets[e]=null}}generateEmoteCSS(e){if(!e.mask&&!e.margins&&(!e.modifier||!e.modifier_offset&&!e.extra_width&&!e.shrink_to_fit)&&!e.css)return"";let i="";if(e.modifier&&(e.modifier_offset||e.margins||e.extra_width||e.shrink_to_fit)){let s=e.modifier_offset||e.margins||"0";s=s.split(/\s+/).map(R=>parseInt(R,10)),s.length===3&&s.push(s[1]);const n=s.length,o=s[0%n],h=s[1%n],_=s[2%n],E=s[3%n];i=`.modified-emote span .ffz-emote[data-id="${e.id}"] {
	padding: ${o}px ${h}px ${_}px ${E}px;
	${e.shrink_to_fit?`max-width: calc(100% - ${40-E-h-(e.extra_width||0)}px);`:""}
	margin: 0 !important;
}`}return e.modifier&&e.mask?.[1]&&(i=(i||"")+`.modified-emote[data-modifiers~="${e.id}"] > .chat-line__message--emote {
	-webkit-mask-image: url("${e.mask[1]}");
	-webkit-mask-position: center center;
}`),`${i}.ffz-emote[data-id="${e.id}"] {
	${e.margins&&!e.modifier?`margin: ${e.margins} !important;`:""}
	${e.css||""}
}`}setTwitchEmoteSet(e,i){if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return;e=`${e}`}if(typeof i=="number"){if(isNaN(i)||!isFinite(i))return;i=`${i}`}this.__twitch_emote_to_set[e]=i}setTwitchSetChannel(e,i){if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return;e=`${e}`}this.__twitch_set_to_channel[e]=i}_getTwitchEmoteSet(e,i=!1){const s=this.__twitch_emote_to_set,n=this.__twitch_set_to_channel,o=this.__twitch_emote_to_artist;if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if((0,r.has)(s,e)&&(!i||(0,r.has)(o,e))){const _=s[e];return Array.isArray(_)?new Promise(E=>_.push(E)):Promise.resolve(_)}const h=this.resolve("site.apollo");return h?.client?new Promise(_=>{const E=[_];s[e]=E,(0,r.timeout)(h.client.query({query:$s(),variables:{id:`${e}`}}),2e3).then(R=>{const T=R?.data?.emote;let N=null;if(T&&(N=T.setID,T.id&&!(0,r.has)(o,T.id)&&(o[T.id]=T.artist),N&&!(0,r.has)(n,N))){const Y=nn(T);n[N]={id:N,type:Y,owner:T?.subscriptionProduct?.owner||T?.owner}}s[e]=N;for(const Y of E)Y(N)}).catch(()=>{s[e]=null;for(const R of E)R(null)})}):Promise.resolve(null)}getTwitchEmoteSet(e,i){const s=this._getTwitchEmoteSet(e);if(i)s.then(i);else return s}_getTwitchEmoteArtist(e){const i=this.__twitch_emote_to_artist;return(0,r.has)(i,e)?Promise.resolve(i[e]):this._getTwitchEmoteSet(e,!0).then(()=>i[e]).catch(()=>(i[e]=null,null))}getTwitchEmoteArtist(e,i){const s=this._getTwitchEmoteArtist(e);if(i)s.then(i);else return s}_getTwitchSetChannel(e){const i=this.__twitch_set_to_channel;if(typeof e=="number"){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if((0,r.has)(i,e)){const n=i[e];return Array.isArray(n)?new Promise(o=>n.push(o)):Promise.resolve(n)}const s=this.resolve("site.apollo");return s?.client?new Promise(n=>{const o=[n];i[e]=o,(0,r.timeout)(s.client.query({query:en(),variables:{id:`${e}`}}),2e3).then(h=>{const _=h?.data?.emoteSet;let E=null;_&&(E={id:e,type:rn(_),owner:_.owner?{id:_.owner.id,login:_.owner.login,displayName:_.owner.displayName}:null}),i[e]=E;for(const R of o)R(E)}).catch(()=>{i[e]=null;for(const h of o)h(null)})}):Promise.resolve(null)}getTwitchSetChannel(e,i){const s=this._getTwitchSetChannel(e);if(i)s.then(i);else return s}};B(Fs,"Emotes");let Xi=Fs;function nn(k){const e=k.subscriptionProduct;if(e){if(e.id==12658)return f.EmoteTypes.Prime;if(e.id==324)return f.EmoteTypes.Turbo;const s=e.owner;if(s)return s.id==139075904||e.state==="INACTIVE"?f.EmoteTypes.LimitedTime:f.EmoteTypes.Subscription}if(k.setID==300238151)return f.EmoteTypes.ChannelPoints;if(k.setID==300374282)return f.EmoteTypes.TwoFactor;const i=parseInt(k.setID,10);return!isNaN(i)&&isFinite(i)&&i>=5e8?f.EmoteTypes.BitsTier:f.EmoteTypes.Global}B(nn,"determineEmoteType");function rn(k){const e=/^\d+$/.test(k.id)?parseInt(k.id,10):null;if(e&&f.TWITCH_GLOBAL_SETS.includes(e))return f.EmoteTypes.Global;if(e&&f.TWITCH_POINTS_SETS.includes(e))return f.EmoteTypes.ChannelPoints;if(e&&f.TWITCH_PRIME_SETS.includes(e))return f.EmoteTypes.Prime;if(e==300374282)return f.EmoteTypes.TwoFactor;const i=k.owner;if(i){if(i.id==139075904)return f.EmoteTypes.LimitedTime;let s;if(Array.isArray(i.subscriptionProducts)){for(const n of i.subscriptionProducts)if(k.id==n.emoteSetID){s=n;break}}if(s){if(s.id==12658)return f.EmoteTypes.Prime;if(s.id==324)return f.EmoteTypes.Turbo;if(s.state==="INACTIVE")return f.EmoteTypes.LimitedTime}return f.EmoteTypes.Subscription}return e>=5e8?f.EmoteTypes.BitsTier:f.EmoteTypes.Global}B(rn,"determineSetType");var Ji=Q(49276);const zs=class zs extends d.default{constructor(e,i){super(e,i),this.settings=null,this.inject("settings"),this.color_cache=null,this.name_cache=null}onEnable(){this.settings.provider.on("changed",this.onProviderChange,this)}renderUserEditor(e,i){let s,n,o;const h=B(()=>{const E=s,R=n,T=o;s=n=o=null,E&&E.destroy(),R&&R.destroy(),T&&T.$destroy()},"destroy"),_=document.fullscreenElement??document.body.querySelector("#root>div")??document.body;n=new ri.default(_,[],{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,no_auto_remove:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"",arrowInner:"",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:_},flip:{behavior:["bottom","top","left","right"]}}},content:async(E,R)=>{const T=this.resolve("vue"),N=Q.e(8586).then(Q.bind(Q,54337));if(!T)throw new Error("unable to load vue");const[,Y]=await Promise.all([T.enable(),N]);return T.component("override-editor",Y.default),o=new T.Vue({el:(0,se.createElement)("div"),render:ce=>ce("override-editor",{user:e,name:this.getName(e.id),color:this.getColor(e.id),originalName:e.displayName??e.login,originalColor:e.color,updateTip:()=>R.update(),setColor:me=>this.setColor(e.id,me),deleteColor:()=>this.deleteColor(e.id),setName:me=>this.setName(e.id,me),deleteName:()=>this.deleteName(e.id),close:()=>R.hide()})}),o.$el},onShow:async(E,R)=>{await R.waitForDom(),requestAnimationFrame(()=>{R.outer&&(s=new se.ClickOutside(R.outer,h))})},onMove:(E,R,T)=>{this.emit("tooltips:hover",E,R,T)},onLeave:(E,R,T)=>{this.emit("tooltips:leave",E,R,T)},onHide:h}),n._enter(i)}onProviderChange(e){e==="overrides.colors"&&this.color_cache?this.loadColors():e==="overrides.names"&&this.name_cache&&this.loadNames()}get colors(){return this.color_cache??this.loadColors()}get names(){return this.name_cache??this.loadNames()}loadColors(){let e,i=!0;this.color_cache?e=new Set(Object.keys(this.color_cache)):(i=!1,this.color_cache={},e=new Set);const s=this.settings.provider.get("overrides.colors");if(s)for(const[n,o]of Object.entries(s))e.delete(n),this.color_cache[n]!==o&&(this.color_cache[n]=o,i&&this.emit(":changed",n,"color",o));for(const n of e)this.color_cache[n]=void 0,i&&this.emit(":changed",n,"color",void 0);return this.color_cache}loadNames(){let e,i=!0;this.name_cache?e=new Set(Object.keys(this.name_cache)):(i=!1,this.name_cache={},e=new Set);const s=this.settings.provider.get("overrides.names");if(s)for(const[n,o]of Object.entries(s))e.delete(n),this.name_cache[n]!==o&&(this.name_cache[n]=o,i&&this.emit(":changed",n,"name",o));for(const n of e)this.name_cache[n]=void 0,i&&this.emit(":changed",n,"name",void 0);return this.name_cache}getColor(e){return this.colors[e]??null}getName(e){return this.names[e]??null}setColor(e,i){this.colors[e]!==i&&(this.colors[e]=i,this.settings.provider.set("overrides.colors",this.colors),this.emit(":changed",e,"color",i))}setName(e,i){this.names[e]!==i&&(this.names[e]=i,this.settings.provider.set("overrides.names",this.names),this.emit(":changed",e,"name",i))}deleteColor(e){this.setColor(e,void 0)}deleteName(e){this.setName(e,void 0)}};B(zs,"overrides_Overrides");let Qi=zs;const As=class As{constructor(e,i,s,n){this.destroyed=!1,this._login=null,this.manager=e,this.room=i,this.emote_sets=null,this.badges=null,this._id=s,this.login=n,s&&((i??e).user_ids[s]=this)}destroy(){if(this.destroyed=!0,this.emote_sets){for(const i of this.emote_sets._cache)this.manager.emotes.unrefSet(i);this.emote_sets=null}this.badges&&(this.badges=null);const e=this.room||this.manager;e&&(this._login&&e.users&&e.users[this._login]===this&&(e.users[this._login]=null),e.user_ids&&e.user_ids[this._id]===this&&(e.user_ids[this._id]=null))}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.emote_sets)for(const[i,s]of e.emote_sets.iterateSources())for(const n of s)this.addSet(i,n);if(e.badges)for(const[i,s]of e.badges.iterateSources())for(const n of s)this.addBadge(i,n.id,n)}_unloadAddon(e){return 0}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e)return;const i=this.room||this.manager;if(this._login&&i.users[this._login]===this&&(i.users[this._login]=null),this._login=e,!e)return;const s=i.users[e];s&&s!==this&&(s.login=null),this._login=e,i.users[e]=this}addBadge(e,i,s){if(this.destroyed)return!1;typeof i=="number"&&(i=`${i}`),s?s.id=i:s={id:i},this.badges||(this.badges=new r.SourcedSet(!1,this.manager.emotes.sourceSortFn));const n=this.badges.get(e);if(n){for(const o of n)if(o.id==i)return Object.assign(o,s),!1}return this.badges.push(e,s),!0}getBadges(){return this.badges?[...this.badges._cache]:[]}getBadge(e){if(this.badges){for(const i of this.badges._cache)if(i.id==e)return i}return null}removeBadge(e,i){if(!this.badges)return!1;const s=this.badges.get(e);if(s){for(const n of s)if(n.id==i)return this.badges.remove(e,n),!0}return!1}removeAllBadges(e){return!this.badges||!this.badges.has(e)?!1:(this.badges.delete(e),!0)}addSet(e,i,s){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new r.SourcedSet),typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.emote_sets.sourceIncludes(e,i)||(n=!this.emote_sets.includes(i),this.emote_sets.push(e,i),o=!0),s&&this.manager.emotes.loadSetData(i,s),n&&(this.manager.emotes.refSet(i),this.manager.emotes.emit(":update-user-sets",this,e,i,!0)),o}removeAllSets(e){if(!this.emote_sets)return!1;const i=this.emote_sets.get(e);if(!Array.isArray(i)||!i.length)return!1;for(const s of i)this.removeSet(e,s);return!0}removeSet(e,i){if(this.emote_sets)return typeof i=="number"&&(i=`${i}`),this.emote_sets.sourceIncludes(e,i)?(this.emote_sets.remove(e,i),this.emote_sets.includes(i)||(this.manager.emotes.unrefSet(i),this.manager.emotes.emit(":update-user-sets",this,e,i,!1)),!0):!1}};B(As,"User");let Ii=As;var on=Object.defineProperty,an=B((k,e,i)=>e in k?on(k,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):k[e]=i,"__defNormalProp"),ln=B((k,e,i)=>(an(k,typeof e!="symbol"?e+"":e,i),i),"__publicField");const Ds=class Ds{constructor(e,i,s){ln(this,0),this._destroy_timer=null,this.refs=new Set,this.style=new se.ManagedStyle(`room--${s}`),this.emote_sets=null,this.badges=null,this.users={},this.user_ids={},this.shared_chats=new Set,this.manager=e,this._id=i,this.login=s,i&&(this.manager.room_ids[i]=this),i&&this.manager.pubsub&&this.manager.pubsub.subscribe(this,`twitch/${i}`),this.manager.emit(":room-add",this),this.load_data()}destroy(){if(clearTimeout(this._destroy_timer),this._destroy_timer=null,this.destroyed=!0,this.manager.emit(":room-remove",this),this.users)for(const e of Object.values(this.users))e&&e.destroy();if(this.user_ids)for(const e of Object.values(this.user_ids))e&&e.destroy();if(this.shared_chats=null,this.refs=null,this.users=null,this.user_ids=null,this.style&&(this.style.destroy(),this.style=null),this.emote_sets){for(const e of this.emote_sets._cache)this.manager.emotes.unrefSet(e);this.emote_sets=null}this._login&&(this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null),this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._id&&this.manager.pubsub&&this.manager.pubsub.unsubscribe(this,`twitch/${this._id}`),this.manager.room_ids[this._id]===this&&(this.manager.room_ids[this._id]=null)}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.refs)for(const s of e.refs)this.ref(s);if(e.shared_chats)for(const s of e.shared_chats)this.shareChat(s);if(e.emote_sets&&e.emote_sets._sources)for(const[s,n]of e.emote_sets._sources.entries())for(const o of n)this.addSet(s,o);e.data&&!this.data&&(this.data=e.data,this.data.css?this.style.set("css",this.data.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS()),e.badges&&!this.badges&&(this.badges=e.badges,this.buildBadgeCSS()),e.bitsConfig&&!this.bitsConfig&&(this.bitsConfig=e.bitsConfig,this.buildBitsCSS());const i=new Set;if(e.users)for(const s of Object.values(e.users))!s.destroyed&&!i.has(s)&&(this.getUser(s.id,s.login).merge(s),i.add(s));if(e.user_ids)for(const s of Object.values(e.user_ids))!s.destroyed&&!i.has(s)&&(this.getUser(s.id,s.login).merge(s),i.add(s))}shareChat(e){this.shared_chats.add(e)}shareChats(e){this.shared_chats=new Set(e||[])}unshareChat(e){e?this.shared_chats.delete(e):this.shared_chats.clear()}_unloadAddon(e){return 0}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e||(this._login&&this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null,this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this._login=e,!e))return;const i=this.manager.rooms[e];i&&i!==this&&(i.login=null),this._login=e,this.manager.rooms[e]=this,this.manager.socket&&this.manager.socket.subscribe(this,`room.${e}`),this.manager.emit(":room-update-login",this,e)}*iterateUsers(){const e=new Set;for(const i of Object.values(this.user_ids))i&&!i.destroyed&&(e.add(i),yield i);for(const i of Object.values(this.users))i&&!i.destroyed&&(yield i)}getUser(e,i,s,n,o=!1){if(this.destroyed)return null;let h;if(e&&typeof e=="number"&&(e=`${e}`),e&&this.user_ids[e]?h=this.user_ids[e]:i&&this.users[i]&&!n&&(h=this.users[i]),h&&h.destroyed&&(h=null),!h){if(s)return null;h=new Ii(this.manager,this,e,i)}if(e&&e!==h.id){if(h.id){if(this.manager.log.warn(`Data mismatch for user #${e} -- Stored ID: ${h.id} -- Login: ${i} -- Stored Login: ${h.login}`),o)throw new Error("id mismatch");this.user_ids[h.id]===h&&(this.user_ids[h.id]=null)}h._id=e,this.user_ids[e]=h}if(i){const _=this.users[i];_?_!==h&&!n&&(_.id?this.users[i]=h:(h.merge(_),_.destroy())):this.users[i]=h}return h}async load_data(e=0){if(this.destroyed)return;const i=`ffz-room-${this.id?`id:${this.id}`:this.login}`;if(this.manager.load_tracker.schedule("chat-data",i),this.manager.experiments.getAssignment("api_load"))try{fetch(`${f.NEW_API}/v1/room/${this.id?`id/${this.id}`:this.login}`).catch(()=>{})}catch{}let s,n;try{s=await fetch(`${this.manager.staging.api}/v1/room/${this.id?`id/${this.id}`:this.login}`)}catch(R){return e++,e<10?setTimeout(()=>this.load_data(e),500*e):(this.manager.log.error(`Error loading room data for ${this.id}:${this.login}`,R),this.manager.load_tracker.notify("chat-data",i,!1),!1)}if(!s.ok)return this.manager.load_tracker.notify("chat-data",i,!1),!1;try{n=await s.json()}catch(R){return this.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`,R),this.manager.load_tracker.notify("chat-data",i,!1),!1}const o=this.data?.user_badge_ids;if(o){for(const R in o)if((0,r.has)(o,R))for(const T of o[R])this.getUser(T,void 0).removeBadge("ffz",R)}const h=n.room,_=`${h.twitch_id}`;if(!this._id)this._id=_,this.manager.room_ids[_]=this;else if(this._id!==_)return this.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${_}`),this.manager.load_tracker.notify("chat-data",i,!1),!1;if(this.login?this.login!==h.id&&this.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got "${h.id}" from FFZ's API.`):this.login=h.id,this.data=h,this.removeAllSets("ffz-main"),h.set&&this.addSet("ffz-main",h.set),n.sets)for(const R in n.sets)(0,r.has)(n.sets,R)&&this.manager.emotes.loadSetData(R,n.sets[R]);const E=h.user_badge_ids;if(E){for(const R in E)if((0,r.has)(E,R))for(const T of E[R])this.getUser(T,void 0).addBadge("ffz",R)}return h.css?this.style.set("css",h.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS(),this.manager.load_tracker.notify("chat-data",i),!0}addSet(e,i,s){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new r.SourcedSet(!1,this.manager.emotes.sourceSortFn)),typeof i=="number"&&(i=`${i}`);let n=!1,o=!1;return this.emote_sets.sourceIncludes(e,i)||(n=!this.emote_sets.includes(i),this.emote_sets.push(e,i),o=!0),s&&this.manager.emotes.loadSetData(i,s),n&&(this.manager.emotes.refSet(i),this.manager.emotes.emit(":update-room-sets",this,e,i,!0)),o}removeAllSets(e){if(this.destroyed||!this.emote_sets)return!1;const i=this.emote_sets.get(e);if(!Array.isArray(i)||!i.length)return!1;for(const s of i)this.removeSet(e,s);return!0}removeSet(e,i){if(!(this.destroyed||!this.emote_sets))return typeof i=="number"&&(i=`${i}`),this.emote_sets.sourceIncludes(e,i)?(this.emote_sets.remove(e,i),this.emote_sets.includes(i)||(this.manager.emotes.unrefSet(i),this.manager.emotes.emit(":update-room-sets",this,e,i,!1)),!0):!1}ref(e){if(!this.refs)throw new Error("Attempting to use destroyed Room");clearTimeout(this._destroy_timer),this._destroy_timer=null,this.refs.add(e)}unref(e){this.refs&&(this.refs.delete(e),!this.refs.size&&!this._destroy_timer&&(this._destroy_timer=setTimeout(()=>this.destroy(),5e3)))}badgeCount(){return this.badge_count||0}updateBadges(e){if(this.badge_count=0,e instanceof Map){const i={};for(const[s,n]of e.entries()){const o=i[s]=i[s]||{__cat:qi(s)};for(const[h,_]of n.entries())o[h]=Yi(_),this.badge_count++}this.badges=i}else if(!Array.isArray(e))this.badges=e;else{const i={};for(const s of e){const n=s.setID,o=i[n]=i[n]||{__cat:qi(n)};o[s.version]=Yi(s),this.badge_count++}this.badges=i}this.buildBadgeCSS()}buildVIPBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.vip_badge||!this.manager.context.get("chat.badges.custom-vip"))return this.style.delete("vip-badge");const e=this.data.vip_badge,i=`url("${e[1]}")`;let s;(e[2]||e[4])&&(s=`${f.WEBKIT_CSS}image-set(${i} 1x${e[2]?`, url("${e[2]}") 2x`:""}${e[4]?`, url("${e[4]}") 4x`:""})`),this.style.set("vip-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="vip"] {
			background-color: transparent;
			background-image: ${i};
			${s?`background-image: ${s};`:""}
			${f.WEBKIT_CSS}mask-image: unset;
		}`)}buildModBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.mod_urls||!this.manager.context.get("chat.badges.custom-mod"))return this.style.delete("mod-badge");const e=this.manager.context.get("chat.badges.style"),i=e>5?`${f.WEBKIT_CSS}mask`:"background";if(!(e!==3&&e!==4))return this.style.delete("mod-badge");const n=this.data.mod_urls,o=`url("${n[1]}")`;let h;(n[2]||n[4])&&(h=`${f.WEBKIT_CSS}image-set(${o} 1x${n[2]?`, url("${n[2]}") 2x`:""}${n[4]?`, url("${n[4]}") 4x`:""})`),this.style.set("mod-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="moderator"] {
			${i}-image: ${o};
			${h?`${i}-image: ${h};`:""}
		}`)}buildBadgeCSS(){if(this.destroyed)return;if(!this.badges)return this.style.delete("badges");const e=f.IS_FIREFOX&&this.manager.context.get("chat.badges.media-queries"),i=this.manager.context.get("chat.badges.clickable"),s=[],n=this.id;for(const o in this.badges)if((0,r.has)(this.badges,o)){const h=this.badges[o];for(const _ in h)if((0,r.has)(h,_)){const E=h[_],R=`[data-room-id="${n}"] .ffz-badge[data-badge="${o}"][data-version="${_}"]`;s.push(`${R} {
			${i&&(E.click_action||E.click_url)?"cursor:pointer;":""}
			background-color: transparent;
			filter: none;
			${f.WEBKIT_CSS}mask-image: none;
			height: 1.8rem;
			width: 1.8rem;
			background-size: 1.8rem;
			background-image: url("${E.image1x}");
			background-image: ${f.WEBKIT_CSS}image-set(
				url("${E.image1x}") 1x,
				url("${E.image2x}") 2x,
				url("${E.image4x}") 4x
			);
		}`),e&&(s.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${R} {
								background-image: url("${E.image2x}");
							}}`),s.push(`@media (min-resolution: 200dpi) { ${R} {
								background-image: url("${E.image4x}");
							}}`))}}this.style.set("badges",s.join(`
`))}updateBitsConfig(e,i){if(!i&&this.bitsConfig&&e){const s=new Set(Object.keys(this.bitsConfig)),n=new Set(Object.keys(e));if((0,r.set_equals)(s,n))return}this.bitsConfig=e,this.buildBitsCSS()}buildBitsCSS(){if(this.destroyed)return;if(!this.bitsConfig)return this.style.delete("bits");const e=this.manager.context.get("chat.bits.animated")?"animated":"static",i=this.manager.context.get("theme.is-dark")?"dark":"light",s=this.manager.context.get("theme.tooltips-dark")?"dark":"light",n=[];for(const o in this.bitsConfig)if((0,r.has)(this.bitsConfig,o)){const h=this.bitsConfig[o],_=h.prefix.toLowerCase(),E=h.tiers,R=E.length;for(let T=0;T<R;T++){const N=E[T].images[i][e],Y=E[T].images[s][e];n.push(`.ffz-cheer[data-prefix="${_}"][data-tier="${T}"] {
	color: ${E[T].color||"inherit"};
	background-image: url("${N[1]}");
	background-image: ${f.WEBKIT_CSS}image-set(
		url("${N[1]}") 1x,
		url("${N[2]}") 2x,
		url("${N[4]}") 4x
	);
}
.ffz__tooltip .ffz-cheer[data-prefix="${_}"][data-tier="${T}"] {
	background-image: url("${Y[1]}");
	background-image: ${f.WEBKIT_CSS}image-set(
		url("${Y[1]}") 1x,
		url("${Y[2]}") 2x,
		url("${Y[4]}") 4x
	);
}
.ffz-cheer-preview[data-prefix="${_}"][data-tier="${T}"] {
	background-image: url("${Y[4]}");
}`)}}this.style.set("bits",n.join(`
`))}};B(Ds,"Room");let Li=Ds;const Ni=Ei.ShrinkX,ji=Ei.Slide,Ui=Ei.GrowX,zi="chat-image chat-line__message--emote",Ls=/(?:(https?:\/\/)?((?:[\w#%\-+=:~]+\.)+[a-z]{2,10}(?:\/[\w./#%&@()\-+=:?~]*[^\s\.!,?])?))/g,cn=/^(['"*([{<\\/]*)(@)((?:[^\u0000-\u007F]|[\w-])+)(?:\b|$)/,hn={type:"filter_test",priority:1e3,render(k,e){return k.msg.filters?.length?e("div",{class:"ffz-pill tw-mg-l-1"},k.msg.filters.join(", ")):null},process(k,e){if(!(!k||!k.length||!this.context.get("chat.filtering.debug")))return e.filters=[],k.push({type:"filter_test",msg:e}),k}};function Ns(k){return k==null?null:k==="true"}B(Ns,"datasetBool");const es={type:"link",priority:50,component:()=>Q.e(9442).then(Q.bind(Q,12868)),render(k,e){return e("a",{class:"ffz-tooltip link-fragment","data-tooltip-type":"link","data-url":k.url,"data-is-mail":k.is_mail,rel:"noopener noreferrer",target:"_blank",href:k.url,onClick:this.handleLinkClick},k.text)},tooltip(k,e){if(!this.context.get("tooltip.rich-links")&&!k.dataset.forceTooltip)return ri.NoContent;if(k.dataset.isMail==="true")return[this.i18n.t("tooltip.email-link","E-Mail {address}",{address:k.textContent})];const i=k.dataset.url||k.href,s=Ns(k.dataset.forceMedia)??this.context.get("tooltip.link-images"),n=Ns(k.dataset.forceUnsafe)??this.context.get("tooltip.link-nsfw-images");return Promise.all([Promise.all([Q.e(2009),Q.e(208)]).then(Q.bind(Q,30642)),this.get_link_info(i)]).then(([o,h])=>{if(!h||(h.v||1)>o.VERSION)return"";const _={tList:(...N)=>this.i18n.tList(...N),i18n:this.i18n,fragments:h.fragments,i18n_prefix:h.i18n_prefix,tooltip:!0,allow_media:s,allow_unsafe:n,onload:()=>requestAnimationFrame(()=>e.update())};let E;if(e.element&&(e.element.classList.add("ffz-rich-tip"),e.element.classList.add("tw-align-left")),e.outer&&h.accent&&(e.outer.classList.add("ffz-accent-tip"),e.outer.style.setProperty("--ffz-color-accent",h.accent)),h.full?E=o.renderTokens(h.full,se.createElement,_):h.mid?E=o.renderTokens(h.mid,se.createElement,_):h.short?E=o.renderTokens(h.short,se.createElement,_):E=this.i18n.t("card.empty","No data was returned."),!h.urls)return E;const R=[];for(let N=0;N<h.urls.length;N++){const Y=h.urls[N];R.push((0,se.createElement)("tr",null,(0,se.createElement)("td",null,this.i18n.formatNumber(N+1),"."),(0,se.createElement)("td",{class:"tw-c-text-alt-2 tw-pd-x-05 tw-word-break-all"},Y.url),(0,se.createElement)("td",null,Y.flags?Y.flags.map(ce=>(0,se.createElement)("span",{class:"ffz-pill"},ce.toLowerCase())):null)))}let T;if(h.unsafe){const N=Array.from(new Set(h.urls.map(Y=>Y.flags).flat())).join(", ");T=(0,se.createElement)("div",{class:"ffz-i-attention"},this.i18n.tList("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:N.toLowerCase()}))}else h.urls.length>1&&(T=this.i18n.t("tooltip.link-destination","Destination: {url}",{url:h.urls[h.urls.length-1].url}));return E=(0,se.createElement)("div",null,(0,se.createElement)("div",{class:"ffz--shift-hide"},E,T?(0,se.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-align-center"},T,(0,se.createElement)("div",{class:" tw-font-size-8"},this.i18n.t("tooltip.shift-detail","(Shift for Details)"))):null),(0,se.createElement)("div",{class:"ffz--shift-show tw-align-left"},(0,se.createElement)("div",{class:"tw-semibold tw-mg-b-05 tw-align-center"},this.i18n.t("tooltip.link.urls","Visited URLs")),(0,se.createElement)("table",null,R))),E}).catch(o=>(console.error(o),(0,se.sanitize)(this.i18n.t("tooltip.error","An error occurred. ({error})",{error:o}))))},process(k){if(!k||!k.length)return;const e=[];for(const i of k){if(i.type!=="text"){e.push(i);continue}Ls.lastIndex=0;const s=i.text;let n=0,o;for(;o=Ls.exec(s);){const h=o.index;n!==h&&e.push({type:"text",text:s.slice(n,h)});let _=o[0];if(_.endsWith(")")){let E=1,R=_.length-1;for(;R--;){const T=_[R];if(T===")"?E++:T==="("&&E--,!E)break}E&&(_=_.slice(0,_.length-1))}e.push({type:"link",url:`${o[1]?"":"https://"}${_}`,is_mail:!1,text:_}),n=h+_.length}n<s.length&&e.push({type:"text",text:s.slice(n)})}return e}};es.tooltip.interactive=function(k){if(!this.context.get("tooltip.rich-links")||!this.context.get("tooltip.link-interaction")||k.dataset.isMail==="true")return!1;const e=this.get_link_info(k.dataset.url,!0);return e&&e.interactive},es.tooltip.delayHide=function(k){return!this.context.get("tooltip.rich-links")||k.dataset.isMail==="true"?0:64};const un={type:"reply",priority:0,component:()=>null,render(k,e){let i=k.color;if(i){const s=this.resolve("site.chat");i=s?s.colors.process(i):i}return e("strong",{class:`chat-line__message-mention ffz--pointer-events ffz-tooltip ffz--reply-mention ffz-i-threads${k.me?" ffz--mention-me":""}`,style:{color:i},"data-tooltip-type":"reply","data-login":k.recipient,onClick:this.handleReplyClick},k.text)},tooltip(k){const e=this.resolve("site.fine");if(!k||!e)return null;const i=e.searchParent(k,n=>n.props&&n.props.reply&&n.setOPCardTray),s=i?.props?.reply;return s?[(0,se.createElement)("strong",{},this.i18n.t("chat.reply-to","Replying To:")),`

`,(0,se.createElement)("div",{className:"tw-align-left"},[(0,se.createElement)("strong",{},s.parentDisplayName),": ",s.parentMessageBody])]:null}};function dn(k,e,i,s){const n=i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"),o=this.context.get("chat.filtering.mention-priority");let h,_,E=!1;i&&i.login&&!n&&(h=i.login.toLowerCase(),_=i.displayName&&i.displayName.toLowerCase(),_===h&&(_=null),E=!0);const R=[];for(const T of k){if(T.type!=="text"){R.push(T);continue}let N=[];for(const Y of T.text.split(/ +/)){const ce=/^(@?)(\S+?)(?:\b|$)/.exec(Y);if(ce){let me=ce[2],pe=ce[1]==="@",Ae=!1;const Fe=me?me.toLowerCase():"",ve=this.color_cache?this.color_cache.get(Fe):null;(Fe===h||Fe===_)&&(Ae=!0),!pe&&!ve&&!Ae?N.push(Y):(N.length&&(R.push({type:"text",text:`${N.join(" ")} `}),N=[]),R.push({type:"mention",text:ce[0],me:Ae,color:s?ve:null,recipient:Fe}),Ae&&this.applyHighlight(e,o,null,"mention",!0),N.push(Y.substr(ce[0].length)))}else N.push(Y)}(N.length>1||N.length===1&&N[0]!=="")&&R.push({type:"text",text:N.join(" ")})}return R}B(dn,"mention_processAll");const fn={type:"mention",priority:0,component:()=>Q.e(9442).then(Q.bind(Q,30884)),render(k,e){let i=k.color;if(i){const s=this.resolve("site.chat");i=s?s.colors.process(i):i}return e("strong",{class:`chat-line__message-mention${k.me?" ffz--mention-me":""} ffz--pointer-events`,style:{color:i},"data-login":k.recipient,onClick:this.handleMentionClick},k.text)},process(k,e,i){if(!k||!k.length)return;const s=this.context.get("chat.filtering.all-mentions"),n=this.context.get("chat.filtering.color-mentions");if(s)return dn.call(this,k,e,i,n);const o=i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"),h=this.context.get("chat.filtering.mention-priority");let _,E,R,T=!1;i&&i.login&&!o?(E=i.login.toLowerCase(),R=i.displayName&&i.displayName.toLowerCase(),R===E&&(R=null),T=!0,_=new RegExp(`^(['"*([{<\\/]*)(?:(@?)(${i.login.toLowerCase()}${R?`|${R}`:""})|@((?:[^\0-\x7F]|[\\w-])+))(?:\\b|$)`,"i")):_=cn;const N=[];for(const Y of k){if(Y.type!=="text"){N.push(Y);continue}let ce=[];for(const me of Y.text.split(/ +/)){const pe=_.exec(me);if(pe){(ce.length||pe[1])&&(N.push({type:"text",text:`${ce.join(" ")} ${pe[1]||""}`}),ce=[]);let Ae,Fe=!1,ve=pe[2];pe[4]?(Ae=pe[4],ve="@"):(Ae=pe[3],Fe=T);const Le=Ae?Ae.toLowerCase():"",Ee=n&&this.color_cache?this.color_cache.get(Le):null;N.push({type:"mention",text:`${ve}${Ae}`,me:Fe,color:Ee,recipient:Le}),Fe&&this.applyHighlight(e,h,null,"mention",!0),ce.push(me.substr(pe[0].length))}else ce.push(me)}(ce.length>1||ce.length===1&&ce[0]!=="")&&N.push({type:"text",text:ce.join(" ")})}return N}},pn={type:"user_highlight",priority:90,process(k,e,i){if(i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const s=this.context.get("__filter:highlight-users");if(!s||!s.length)return;const n=e.user;for(const[o,h,_]of s)(_.test(n.login)||_.test(n.displayName))&&this.applyHighlight(e,o,h,"user")}},mn={type:"user_block",priority:100,process(k,e,i,s){if(i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const n=e.user,o=this.context.get("__filter:block-users");o&&(o[1]&&(o[1].test(n.login)||o[1].test(n.displayName))?(e.deleted=!0,e.ffz_removed=!0,s&&(e.ffz_halt_tokens=!0)):!e.deleted&&o[0]&&(o[0].test(n.login)||o[0].test(n.displayName))&&(e.deleted=!0))}};function gn(k){let e=k.badges?Object.keys(k.badges):null;if(!k.ffz_badges)return e;e||(e=[]);for(const i of k.ffz_badges)i?.id&&e.push(i.id);return e}B(gn,"getBadgeIDs");const _n={type:"badge_stuff",priority:97,process(k,e,i,s){if(i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const n=this.context.get("__filter:highlight-badges"),o=this.context.get("__filter:block-badges");if(!n&&!o)return;const h=gn(e);if(!(!h||!h.length))for(const _ of h){if(o&&o[1].includes(_)){e.deleted=!0,e.ffz_removed=!0,s&&(e.ffz_halt_tokens=!0);return}if(o&&!e.deleted&&o[0].includes(_)&&(e.deleted=!0),n&&n.has(_)){const E=n.get(_);Array.isArray(E)&&E.length>1&&this.applyHighlight(e,E[0],E[1],"badge")}}}},bn={type:"highlight",priority:35,component:()=>Q.e(9442).then(Q.bind(Q,27778)),render(k,e){return e("strong",{class:"ffz--highlight"},k.text)},process(k,e,i){if(!k||!k.length||i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const s=this.context.get("__filter:highlight-terms");if(!s)return;let n=!1;if(s.non)for(const[o,h,_]of s.non){if(n&&e.mention_priority!=null&&e.mention_priority>o)break;let E=!1;_[0]&&(_[0].lastIndex=0,E=_[0].test(e.message)),!E&&_[1]&&(_[1].lastIndex=0,E=_[1].test(e.message)),E&&(n=!0,this.applyHighlight(e,o,h,"term"))}if(!s.hl)return k;for(const[o,h,_]of s.hl){const E=[];for(const R of k){if(R.type!=="text"){E.push(R);continue}const T=R.text;let N=0,Y;for(;N<T.length;){_[0]&&(_[0].lastIndex=N),_[1]&&(_[1].lastIndex=N),Y=_[0]?_[0].exec(T):null;const ce=_[1]?_[1].exec(T):null;if(ce&&(!Y||Y.index>ce.index)&&(Y=ce),!Y)break;const me=Y.index,pe=Y[1]?Y[1].length:0,Ae=me+pe;N!==Ae&&E.push({type:"text",text:T.slice(N,Ae)}),this.applyHighlight(e,o,h,"term"),E.push({type:"highlight",text:Y[0].slice(pe)}),N=me+Y[0].length}N<T.length&&E.push({type:"text",text:T.slice(N)})}k=E}return k}};function js(k,e,i,s,n){const o=[];for(const h of k){if(h.type!=="text"){o.push(h);continue}const _=h.text;let E=0,R;for(;E<_.length;){i[0]&&(i[0].lastIndex=E),i[1]&&(i[1].lastIndex=E),R=i[0]?i[0].exec(_):null;const T=i[1]?i[1].exec(_):null;if(T&&(!R||R.index>T.index)&&(R=T),!R)break;const N=R.index,Y=R[1]?R[1].length:0,ce=N+Y;if(E!==ce&&o.push({type:"text",text:_.slice(E,ce)}),s&&(e.ffz_removed=!0,n))return k;o.push({type:"blocked",text:R[0].slice(Y)}),E=N+R[0].length}E<_.length&&o.push({type:"text",text:_.slice(E)})}return o}B(js,"blocked_process");const yn={type:"blocked",priority:99,component:()=>Q.e(9442).then(Q.bind(Q,87307)),render(k,e){return e("strong",{"data-text":k.text,"data-tooltip-type":"blocked",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(k){const e=k.dataset;return[(0,se.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.blocked-term","Blocked Term")),e.text]},process(k,e,i,s){if(!k||!k.length||i&&i.login&&i.login==e.user.login&&!this.context.get("chat.filtering.process-own"))return;const n=this.context.get("__filter:block-terms");if(n)return n.remove&&(k=js(k,e,n.remove,!0,s),s&&e.ffz_removed)?(e.ffz_halt_tokens=!0,k):(n.non&&(k=js(k,e,n.non,!1,s)),k)}},Us={A:"Hostility",I:"Discrimination",P:"Profanity",S:"Sexually Explicit Language"},vn={type:"amterm",priority:95,component:()=>Q.e(9442).then(Q.bind(Q,61669)),render(k,e){return e("strong",{"data-text":k.text,"data-categories":JSON.stringify(k.categories),"data-tooltip-type":"amterm",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"\xD7\xD7\xD7")},tooltip(k){const e=k.dataset,i=[];let s;try{s=JSON.parse(e.categories);for(const n in s)s[n]&&Us[n]&&i.push(this.i18n.t(`chat.filtering.automod.${n}`,Us[n]))}catch{i.push("Parse Error")}return[(0,se.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.automod-term","AutoMod Blocked Term")),this.i18n.t("chat.filtering.automod-why","This was flagged as: "),i.join(", ")]},process(k,e,i,s){if(!k||!k.length||!e.flags||!Array.isArray(e.flags.list))return;const n=e.flags.preferences,o=e.flags.list.filter(Y=>{if(!Y||Y.startIndex==null||Y.endIndex==null)return!1;const ce=Y.categories;if(!ce)return!1;for(const me in ce)if(ce[me]&&n[me])return!0}),h=o.length;if(!h)return;const _=[];let E=0,R=0;const T=this.context.get("chat.automod.remove-messages");if(this.context.get("chat.automod.delete-messages")&&(e.deleted=!0),T){e.ffz_removed=!0,s&&(e.ffz_halt_tokens=!0);return}for(const Y of k){const ce=Y.length||Y.text&&(0,r.split_chars)(Y.text).length||0,me=E,pe=E+ce;if(Y.type!=="text"){_.push(Y),E=pe;continue}const Ae=(0,r.split_chars)(Y.text);for(;R<h;){const Fe=o[R],ve=Fe.startIndex,Le=Fe.endIndex+1;if(Le<me){R++;continue}if(ve>pe){_.push(Y),E=pe;break}ve>E&&_.push({type:"text",text:Ae.slice(E-me,ve-me).join("")});let Ee=ve-me;if(Ee<0&&(Ee=0),_.push({type:"amterm",categories:Fe.categories,text:Ae.slice(Ee,Le-me).join("")}),Le>pe){E=pe;break}E=Le,R++}E<pe&&(me===E?_.push(Y):_.push({type:"text",text:Ae.slice(E-me).join("")}),E=pe)}return _}},wn={type:"cheer",priority:40,component:()=>Q.e(9442).then(Q.bind(Q,93114)),render(k,e){return e("span",{class:"ffz-cheer ffz-tooltip ffz--pointer-events","data-tooltip-type":"cheer","data-prefix":k.prefix,"data-amount":this.i18n.formatNumber(k.amount),"data-tier":k.tier,"data-individuals":JSON.stringify(k.individuals||null),alt:k.text})},tooltip(k){const e=k.dataset,i=parseInt(e.amount.replace(/,/g,""),10),s=e.prefix,n=e.tier,o=e.individuals&&JSON.parse(e.individuals),h=o&&o.length,_=[this.context.get("tooltip.emote-images")&&(0,se.createElement)("div",{class:"preview-image ffz-cheer-preview","data-prefix":s,"data-tier":n}),this.i18n.t("tooltip.bits","{count,number} Bits",i)];if(h>1){_.push((0,se.createElement)("br",null)),o.sort(E=>-E[0]);for(let E=0;E<h&&E<12;E++){const[R,T,N]=o[E];_.push(this.tokenizers.cheer.render.call(this,{amount:R,prefix:N,tier:T},se.createElement))}h>12&&(_.push((0,se.createElement)("br",null)),_.push(this.i18n.t("tooltip.bits.more","(and {count, number} more)",h-12)))}return _},process(k,e){if(!k||!k.length||!e.bits)return;const i=this.getRoom(e.roomID,e.roomLogin,!0),s=i&&i.bitsConfig;if(!s)return;const n=new RegExp(`^(${Object.keys(s).join("|")})(\\d+)$`,"i"),o=[],h={},_=this.context.get("chat.bits.stack");for(const E of k){if(!E||E.type!=="text"){o.push(E);continue}let R=[];for(const T of E.text.split(/ +/)){const N=n.exec(T);if(N){const Y=N[1].toLowerCase(),ce=s[Y];if(!ce){R.push(T);continue}const me=parseInt(N[2],10),pe=ce.tiers;let Ae,Fe;for(let ve=0,Le=pe.length;ve<Le;ve++)if(me>=pe[ve].amount){Ae=ve;break}if(R.length&&(o.push({type:"text",text:`${R.join(" ")} `}),R=[]),o.push(Fe={type:"cheer",prefix:Y,tier:Ae,amount:me,text:N[0]}),_){let ve=_===2?"cheer":Y;s[ve]||(ve=Y);const Le=h[ve]=h[ve]||{total:0,individuals:[]};Le.total+=me,Le.individuals.push([me,Ae,Y]),Fe.hidden=!0}R.push("")}else R.push(T)}(R.length>1||R.length===1&&R[0]!=="")&&o.push({type:"text",text:R.join(" ")})}if(_){for(const E in h)if((0,r.has)(h,E)){const R=h[E],T=s[E],N=T.tiers;let Y=0;for(let ce=N.length;Y<ce&&!(R.total>=N[Y].amount);Y++);o.unshift({type:"cheer",prefix:E,tier:Y,amount:R.total,individuals:R.individuals,length:0})}}return o}},Hs=B((k,e,i)=>{const s=k.anim===2,n=k.big&&k.can_big;let o,h,_,E,R,T;k.anim===1&&k.animSrc?(o=n?k.animSrc2:k.animSrc,h=n?k.animSrcSet2:k.animSrcSet):(o=n?k.src2:k.src,h=n?k.srcSet2:k.srcSet),s&&k.animSrc&&(R=o,T=h,_=n?k.animSrc2:k.animSrc,E=n?k.animSrcSet2:k.animSrcSet);const N=k.modifiers||[],Y=N.length,ce=e("img",{class:`${zi} ffz-tooltip${_?" ffz-hover-emote":""}${k.provider==="twitch"?" twitch-emote":k.provider==="ffz"?" ffz-emote":k.provider==="emoji"?" ffz-emoji":""}`,attrs:{src:f.IS_FIREFOX&&h?.length?void 0:o,srcSet:h,alt:k.text,height:k.big&&!k.can_big&&k.height?`${k.height*2}px`:void 0,"data-tooltip-type":"emote","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-code":k.code,"data-variant":k.variant,"data-normal-src":R,"data-normal-src-set":T,"data-hover-src":_,"data-hover-src-set":E,"data-modifiers":Y?N.map(me=>me.id).join(" "):null,"data-modifier-info":Y?JSON.stringify(N.map(me=>[me.set,me.id])):null}});return Y?e("div",{class:"ffz--inline modified-emote",attrs:{"data-test-selector":"emote-button","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-modifiers":Y?N.map(me=>me.id).join(" "):null}},[ce,N.map(me=>e("span",{key:me.text},Hs(me,e,!0)))]):i?ce:e("div",{className:"ffz--inline",attrs:{"data-test-selector":"emote-button"}},[ce])},"render_emote"),kn={type:"emote",priority:10,component:{functional:!0,render(k,{props:e}){return Hs(e.token,k)}},render(k,e,i){const s=k.anim===2,n=k.big&&k.can_big;let o,h,_,E,R,T;k.anim===1&&k.animSrc?(o=n?k.animSrc2:k.animSrc,h=n?k.animSrcSet2:k.animSrcSet):(o=n?k.src2:k.src,h=n?k.srcSet2:k.srcSet),s&&k.animSrc&&(R=o,T=h,_=n?k.animSrc2:k.animSrc,E=n?k.animSrcSet2:k.animSrcSet);let N,Y;const ce=k.modifiers||[],me=ce.length,pe=k.modifier_flags,Ae=k.big&&!k.can_big&&k.height;let Fe=(this.emotes.activeAsBackgroundMask&pe)!==0,ve=(this.emotes.activeNoWideMask&pe)!==0;if(ve||pe||me){if(k.provider==="emoji"){const Ee=k.big_emoji?2:1,je=Ee*1.5*(this.context.get("chat.font-size")??13);N={width:je,height:je},Y={width:je,height:je}}else{const Ee=k.big?2:1;N={width:k.width*Ee,height:k.height*Ee},Y={width:N.width,height:N.height}}for(const Ee of ce)if(Ee.effect_bg&&(Fe=!0),!Ee.mod_hidden&&Ee.set!=="info"){const je=Ee.big?2:1,Ue=Ee.width*je,Je=Ee.height*je;Ue>Y.width&&(Y.width=Ue),Je>Y.height&&(Y.height=Je)}if(pe&&(this.emotes.ensureEffect(pe),(pe&Ni)===Ni&&this.emotes.effects_enabled?.ShrinkX&&(N.width*=.5),(pe&Ui)===Ui&&this.emotes.effects_enabled?.GrowX&&(N.width*=2),N.width=Math.min(N.width,k.big?256:128),N.height=Math.min(N.height,k.big?80:40)),ve){const Ee=k.big?64:32;if(N.width>Ee){const je=Ee/N.width;N.width*=je,N.height*=je}}N.width>Y.width&&(Y.width=N.width),N.height>Y.height&&(Y.height=N.height),N.width!==Y.width&&(N.marginLeft=(Y.width-N.width)/2),N.height!==Y.height&&(N.marginTop=(Y.height-N.height)/2),pe&&(pe&ji)===ji&&(N["--ffz-width"]=`${N.width}px`,N["--ffz-speed-x"]=`${.5*(N.width/(k.big?64:32))}s`)}let Le;return Fe?(N=N||{},N.backgroundImage=`url("${o}")`,N.backgroundSize="100%",Le=e("div",{class:`${zi} ffz--pointer-events ffz-tooltip${_?" ffz-hover-emote":""}${k.provider==="twitch"?" twitch-emote":k.provider==="ffz"?" ffz-emote":k.provider==="emoji"?" ffz-emoji":""}`,style:N,"data-name":k.text,"data-tooltip-type":"emote","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-code":k.code,"data-variant":k.variant,"data-normal-src":R,"data-normal-src-set":T,"data-hover-src":_,"data-hover-src-set":E,"data-modifiers":me?ce.map(Ee=>Ee.id).join(" "):null,"data-modifier-info":me?JSON.stringify(ce.map(Ee=>[Ee.set,Ee.id])):null,onClick:this.emotes.handleClick},e("div",{class:"ffz-alt-text"},k.text))):Le=e("img",{class:`${zi} ffz--pointer-events ffz-tooltip${_?" ffz-hover-emote":""}${k.provider==="twitch"?" twitch-emote":k.provider==="ffz"?" ffz-emote":k.provider==="emoji"?" ffz-emoji":""}`,src:f.IS_FIREFOX&&h?.length?void 0:o,srcSet:h,style:N,height:N?void 0:Ae?`${k.height*2}px`:void 0,alt:k.text,"data-tooltip-type":"emote","data-provider":k.provider,"data-id":k.id,"data-set":k.set,"data-code":k.code,"data-variant":k.variant,"data-normal-src":R,"data-normal-src-set":T,"data-hover-src":_,"data-hover-src-set":E,"data-modifiers":me?ce.map(Ee=>Ee.id).join(" "):null,"data-modifier-info":me?JSON.stringify(ce.map(Ee=>[Ee.set,Ee.id])):null,onClick:this.emotes.handleClick}),!me&&!k.modifier_flags?i?Le:e("div",{class:"ffz--inline","data-test-selector":"emote-button"},Le):e("div",{class:`ffz--inline ffz--pointer-events modified-emote${N?" scaled-modified-emote":""}`,"data-test-selector":"emote-button","data-provider":k.provider,"data-id":k.id,"data-set":k.set,style:Y,"data-modifiers":me?ce.map(Ee=>Ee.id).join(" "):null,"data-effects":pe||void 0},Le,ce.map(Ee=>Ee.set==="info"||(Ee.source_modifier_flags&1)===1&&Ee.text?null:e("span",{key:Ee.text},this.tokenizers.emote.render.call(this,Ee,e,!0))))},async tooltip(k,e){const i=k.dataset,s=i.provider,n=i.modifierInfo;let o,h,_,E,R,T,N,Y,ce,me=!1;const pe=i.noSource==="true";if(n&&n!=="null"&&(T=JSON.parse(n).map(([Fe,ve])=>{if(Fe==="info")return(0,se.createElement)("span",{class:"tw-mg-05"},ve?.icon?(0,se.createElement)("img",{class:"ffz__tooltip__mod-icon",src:ve.icon}):null,ve?.icon?` - ${ve?.label}`:ve?.label);const Le=this.emotes.emote_sets[Fe],Ee=Le&&(Le.emotes[ve]||Le.disabled_emotes?.[ve]);if(Ee)return(0,se.createElement)("span",{class:"tw-mg-05"},this.tokenizers.emote.render.call(this,Ee.token,se.createElement),` - ${Ee.hidden?"???":Ee.name}`)})),s==="twitch"){Y=i.id;const Fe=pe?null:await this.emotes.getTwitchEmoteSet(Y),ve=Fe!=null&&await this.emotes.getTwitchSetChannel(Fe),Le=pe?null:await this.emotes.getTwitchEmoteArtist(Y);if(h=`${(0,r.getTwitchEmoteURL)(i.id,4,!0,!0)}?_=preview`,N="twitch",Le&&(E=Le.displayName||Le.login),ve){const Ee=ve.type;Ee===f.EmoteTypes.Global?ve.owner?.login?_=this.i18n.t("tooltip.channel","Channel: {source}",{source:ve.owner.displayName||ve.owner.login}):_=this.i18n.t("emote.global","Twitch Global"):Ee===f.EmoteTypes.BitsTier?(_=this.i18n.t("emote.bits","Twitch Bits Reward"),ve.owner?.login&&(_=this.i18n.t("emote.bits-owner",`{source}
Channel: {channel}`,{source:_,channel:ve.owner.displayName||ve.owner.login}))):Ee===f.EmoteTypes.Prime||Ee===f.EmoteTypes.Turbo?_=this.i18n.t("emote.prime","Prime Gaming"):Ee===f.EmoteTypes.TwoFactor?_=this.i18n.t("emote.2fa","Twitch 2FA Emote"):Ee===f.EmoteTypes.LimitedTime?_=this.i18n.t("emote.limited","Limited-Time Only Emote"):Ee===f.EmoteTypes.ChannelPoints?_=this.i18n.t("emote.points","Channel Points Emote"):Ee===f.EmoteTypes.Follower&&ve.owner?.login?_=this.i18n.t("emote.follower","Follower Emote ({source})",{source:ve.owner.displayName||ve.owner.login}):Ee===f.EmoteTypes.Subscription&&ve.owner?.login&&(_=this.i18n.t("tooltip.channel","Channel: {source}",{source:ve.owner.displayName||ve.owner.login}))}}else if(s==="ffz"){const Fe=this.emotes.emote_sets[i.set],ve=Fe&&(Fe.emotes[i.id]||Fe.disabled_emotes?.[i.id]);if(Fe&&(_=Fe.source_line||`${Fe.source||"FFZ"} ${Fe.title||"Global"}`,N=Fe.source||"ffz"),ve&&(Y=ve.id,ve.artist&&(E=ve.artist.display_name||ve.artist.name),ve.original_name&&ve.original_name!==ve.name&&(ce=this.i18n.t("emote.original-name","Name: {name}",{name:ve.original_name})),ve.owner&&(R=this.i18n.t("emote.owner","By: {owner}",{owner:ve.owner.display_name})),this.context.get("tooltip.emote-images.animated")&&ve.animated?.[1]?ve.animated[4]?h=ve.animated[4]:ve.animated[2]&&(h=ve.animated[2]):ve.urls[4]?h=ve.urls[4]:ve.urls[2]&&(h=ve.urls[2]),i.effects&&ve.modifier&&ve.modifier_flags)){R=null;const Ee=ve.modifier_flags;this.emotes.ensureEffect(Ee);const je=this.emotes.getTargetEmote();let Ue={width:(je.width??28)*2,height:(je.height??28)*2},Je={width:Ue.width,height:Ue.height},ht=(this.emotes.activeAsBackgroundMask&Ee)!==0,yt=(this.emotes.activeNoWideMask&Ee)!==0,Qe=!1;if((Ee&Ni)===Ni&&this.emotes.effects_enabled?.ShrinkX&&(Ue.width*=.5,Qe=!0),(Ee&Ui)===Ui&&this.emotes.effects_enabled?.GrowX&&(Ue.width*=2,Qe=!0),Qe&&(Ue.width>512&&(Ue.width=512),Ue.height>160&&(Ue.height=160)),yt&&Ue.width>64){const Ct=64/Ue.width;Ue.width*=Ct,Ue.height*=Ct}Ue.width>Je.width&&(Je.width=Ue.width),Ue.height>Je.height&&(Je.height=Ue.height),Ue.width!==Je.width&&(Ue.marginLeft=(Je.width-Ue.width)/2),Ue.height!==Je.height&&(Ue.marginTop=(Je.height-Ue.height)/2),(Ee&ji)===ji&&(Ue["--ffz-width"]=`${Ue.width}px`,Ue["--ffz-speed-x"]=`${.5*Ue.width/64}s`),Ue.width=`${Ue.width}px`,Ue.height=`${Ue.height}px`,Je.width=`${Je.width}px`,Je.height=`${Je.height}px`,ht&&(Ue.backgroundImage=`url("${je.src}")`,Ue.backgroundSize="100%"),h=(0,se.createElement)("div",{class:"ffz-effect-tip"},(0,se.createElement)("img",{src:je.src,srcSet:je.srcSet,width:(je.width??28)*2,height:(je.height??28)*2,onLoad:e.update}),(0,se.createElement)("span",{class:"ffz-i-right-open"}),(0,se.createElement)("div",{class:`ffz--inline ffz--pointer-events modified-emote${Ue?" scaled-modified-emote":""}`,style:Je,"data-modifiers":ve.id,"data-effects":Ee},ht?(0,se.createElement)("div",{class:`${zi} ffz--pointer-events ffz-tooltip ffz-emote`,style:Ue}):(0,se.createElement)("img",{class:`${zi} ffz--pointer-events ffz-tooltip ffz-emote`,src:je.src,srcSet:je.srcSet,style:Ue,height:Ue?void 0:`${je.height*2}px`,onLoad:e.update})))}}else if(s==="emoji"){const Fe=this.emoji.emoji[i.code],ve=this.context.get("chat.emoji.style"),Le=i.variant?Fe.variants[i.variant]:Fe,Ee=i.variant?this.emoji.emoji[i.variant]:null;N="emoji",Y=i.code,h=(0,se.createElement)("img",{class:"preview-image ffz-emoji",src:this.emoji.getFullImage(Le.image,ve),srcSet:this.emoji.getFullImageSet(Le.image,ve),onLoad:e.update}),me=!0,o=`:${Fe.names[0]}:${Ee?`:${Ee.names[0]}:`:""}`;const je=Fe.category?this.i18n.t(`emoji.category.${Fe.category.toSnakeCase()}`,Ji.aA[Fe.category]||Fe.category):null;_=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:je})}else return;o||(o=i.name||k.alt);const Ae=N&&this.emotes.isFavorite(N,Y);return[h&&this.context.get("tooltip.emote-images")&&(typeof h=="string"?(0,se.createElement)("img",{class:"preview-image",src:h,onLoad:e.update}):h),me||pe&&!R?o:this.i18n.t("tooltip.emote","Emote: {name}",{name:o}),!pe&&_&&this.context.get("tooltip.emote-sources")&&(0,se.createElement)("div",{class:"tw-pd-t-05"},_),ce&&(0,se.createElement)("div",{class:"tw-pd-t-05"},ce),R&&this.context.get("tooltip.emote-sources")&&(0,se.createElement)("div",{class:"tw-pd-t-05"},R),E&&this.context.get("tooltip.emote-sources")&&(0,se.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("emote.artist","Artist: {artist}",{artist:E})),i.sellout&&(0,se.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05"},i.sellout),T&&(0,se.createElement)("div",{class:"tw-pd-t-1 tw-pd-b-05"},T),Ae&&(0,se.createElement)("figure",{class:"ffz--favorite ffz-i-star"})]},process(k,e){if(!k||!k.length||this.context.get("chat.emotes.enabled")!==2)return;const i=this.emotes.getEmotes(e.user.id,e.user.login,e.roomID,e.roomLogin);if(!i)return;const s=this.context.get("chat.emotes.2x")>0,n=this.context.get("chat.emotes.animated"),o=[];let h=!1,_=!1,E,R;const T=this.emotes.ModifierFlags?.NoSpace;for(const N of k){if(!N)continue;if(N.type!=="text"){N.type==="emote"&&(N.modifiers||(N.modifiers=[],N.modifier_flags=0)),o.push(N),E=N;continue}let Y=[];for(const ce of N.text.split(/ +/))if((0,r.has)(i,ce)){if(R=i[ce],R.modifier&&R.modifier_prefix)h=!0;else if(R.modifier&&E&&E.modifiers&&(!Y.length||Y.length===1&&Y[0]==="")){E.modifiers.indexOf(R.token)===-1&&(R.modifier_flags&&(E.modifier_flags|=R.modifier_flags,T&&(R.modifier_flags&T)===T&&(_=!0)),E.modifiers.push(Object.assign({big:s,anim:n},R.token)));continue}if(Y.length){const pe={type:"text",text:`${Y.join(" ")} `};o.push(pe),pe.text.trim().length&&(E=pe),Y=[]}const me=Object.assign({modifiers:[],modifier_flags:0,big:s,anim:n},R.token);o.push(me),E=me,Y.push("")}else Y.push(ce);if(Y.length>1||Y.length===1&&Y[0]!==""){const ce={type:"text",text:Y.join(" ")};o.push(ce)}}if(h){let N,Y=!1,ce=o.length;for(;ce--;){const me=o[ce];me.type==="emote"&&!me.mod?(N=me,Y=!1):N&&me.type==="emote"&&me.mod&&me.mod_prefix?(N.modifiers.push(me),me.source_modifier_flags&&(N.modifier_flags|=me.source_modifier_flags,T&&(me.source_modifier_flags&T)===T&&(_=!0)),o.splice(ce,Y?2:1),Y=!1):N&&!Y&&me.type==="text"&&me.text===" "?Y=!0:(N=null,Y=!1)}}if(_){let N=!1,Y=o.length;for(;Y--;){const ce=o[Y];ce.type==="emote"&&(ce.modifier_flags&T)===T?N=!0:(N&&ce.type==="text"&&ce.text===" "&&o.splice(Y,1),N=!1)}}return o}},Sn={type:"emoji",priority:15,process(k){if(!k||!k.length)return;const e=this.emoji.splitter,i=this.context.get("chat.emotes.2x")>1,s=this.context.get("chat.emoji.replace-joiner")>0,n=this.context.get("chat.emoji.style");if(n===0)return;const o=[];for(const h of k){if(!h)continue;if(h.type!=="text"){o.push(h);continue}const _=s?h.text.replace(Ji.Dk,"\u200D"):h.text;e.lastIndex=0;let E=0,R;for(;R=e.exec(_);){const T=R.index,N=this.emoji.chars.get(R[0]);if(!N)continue;const Y=this.emoji.emoji[N[0]],ce=N[1]?Y.variants[N[1]]:Y,me=(0,r.split_chars)(R[0]).length;E!==T&&o.push({type:"text",text:_.slice(E,T)}),o.push({type:"emote",provider:"emoji",code:N[0],variant:N[1],big_emoji:i,src:this.emoji.getFullImage(ce.image,n),srcSet:this.emoji.getFullImageSet(ce.image,n),text:R[0],length:me,modifiers:[],modifier_flags:0}),E=T+R[0].length}E<_.length&&o.push({type:"text",text:_.slice(E)})}return o}},Cn={type:"twitch-emote",priority:20,process(k,e){if(!e.ffz_emotes||this.context.get("chat.emotes.enabled")<1)return;const i=e.ffz_emotes,s=this.context.get("chat.emotes.animated"),n=this.context.get("chat.emotes.2x")>0,o=this.context.get("chat.fix-bad-emotes"),h=[];for(const N in i)if((0,r.has)(i,N))for(const Y of i[N])h.push([N,Y.startIndex,Y.endIndex+1]);const _=h.length;if(!_)return;const E=[];h.sort((N,Y)=>N[1]!==Y[1]?N[1]-Y[1]:Y[0]-N[0]);let R=0,T=0;for(const N of k){const Y=N.length||N.text&&(0,r.split_chars)(N.text).length||0,ce=R,me=R+Y;if(N.type!=="text"){E.push(N),R=me;continue}const pe=(0,r.split_chars)(N.text);for(;T<_;){const[Ae,Fe,ve]=h[T];if(typeof Ae=="string"&&(Ae.startsWith("__FFZ__")||Ae.startsWith("__BTTV__"))){T++;continue}if(Fe>me||ve>me){ce===R?E.push(N):E.push({type:"text",text:pe.slice(R-ce).join("")}),Fe<me&&ve>me&&T++,R=me;break}if(Fe<R){T++;continue}Fe>R&&E.push({type:"text",text:pe.slice(R-ce,Fe-ce).join("")});let Le,Ee,je,Ue,Je,ht,yt,Qe,bt=!0;const Ct=f.REPLACEMENTS[Ae];Ct&&o?(Le=`${f.REPLACEMENT_BASE}${Ct}`,Ee="",bt=!1):(Le=(0,r.getTwitchEmoteURL)(Ae,1,!1),Ee=(0,r.getTwitchEmoteSrcSet)(Ae,!1),s>0&&(je=(0,r.getTwitchEmoteURL)(Ae,1,!0),Ue=(0,r.getTwitchEmoteSrcSet)(Ae,!0)),n&&(Je=(0,r.getTwitchEmoteURL)(Ae,2,!1),ht=(0,r.getTwitchEmoteSrcSet)(Ae,!1,!0,!0),s>0&&(yt=(0,r.getTwitchEmoteURL)(Ae,2,!0),Qe=(0,r.getTwitchEmoteSrcSet)(Ae,!0,!0,!0))));const Yt=f.WEIRD_EMOTE_SIZES[Ae],ci=Yt?Yt[0]:28,pi=Yt?Yt[1]:28;E.push({type:"emote",id:Ae,provider:"twitch",src:Le,srcSet:Ee,src2:Je,srcSet2:ht,animSrc:je,animSrc2:yt,animSrcSet:Ue,animSrcSet2:Qe,anim:s,big:n,can_big:bt,width:ci,height:pi,text:pe.slice(Fe-ce,ve-ce).join(""),modifiers:[],modifier_flags:0}),R=ve,T++}R<me&&(ce===R?E.push(N):E.push({type:"text",text:pe.slice(R-ce).join("")}),R=me)}return E}},xn={type:"link",can_hide_token:!0,priority:-10,test(k){if(k.type!=="link")return!1;const e=k.url;for(const i of this.__link_providers)if(i.test.call(this,e))return!0;return this.context.get("chat.rich.all-links")||k.force_rich},process(k,e){return{card_tooltip:!0,url:k.url,timeout:0,want_mid:e,getData:async(i=!1)=>{let s;try{s=await this.get_link_info(k.url,!1,i)}catch(n){return{url:k.url,error:String(n)}}return s?{...s,allow_media:this.context.get("tooltip.link-images"),allow_unsafe:this.context.get("tooltip.link-nsfw-images")}:{url:k.url}}}}};var En=Q(36e3),Fn=Q.n(En),zn=Q(87590),An=Q.n(zn);const Dn=/^(?:https?:\/\/)?clips\.twitch\.tv\/([a-z0-9-_=]+)(?:\/)?(\w+)?(?:\/edit)?/i,Tn=/^(?:https?:\/\/)?(?:(?:www|m)\.)?twitch\.tv\/\w+\/clip\/([a-z0-9-_=]+)/i,Mn=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/(?:\w+\/v|videos)\/(\w+)/,Pn=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/([^/]+)$/,Bn=["directory","_deck","p","downloads","jobs","turbo","settings","friends","subscriptions","inventory","wallet","store","drops","search","prime"],Rn={type:"clip",test(k){const e=Dn.exec(k)||Tn.exec(k);if(e&&e[1]&&e[1]!=="create")return e[1]},receive(k,e){const i=e?.twitch_metadata?.clip_metadata;if(i)return{id:i.id,slug:i.slug,title:e.title,thumbnailURL:e.thumbnail_url,curator:{id:i.curator_id,displayName:e.author_name},broadcaster:{id:i.broadcaster_id,displayName:i.channel_display_name},game:{displayName:i.game}}},async process(k,e){let i=e;if(!i){const T=this.resolve("site.apollo");if(!T)return null;i=(await T.client.query({query:Fn(),variables:{slug:k}}))?.data?.clip}if(!i||!i.broadcaster)return null;const s=i.game,n=s&&s.displayName;let o={type:"style",weight:"semibold",color:"alt-2",content:i.broadcaster.displayName};i.broadcaster.login&&(o={type:"link",url:`https://www.twitch.tv/${i.broadcaster.login}`,content:o});const h=n?{type:"i18n",key:"clip.desc.1.playing",phrase:"{user} playing {game}",content:{user:o,game:{type:"style",weight:"semibold",content:n}}}:{type:"i18n",key:"clip.desc.1",phrase:"Clip of {user}",content:{user:o}};let _=i.curator?{type:"style",color:"alt-2",content:i.curator.displayName}:{type:"i18n",key:"clip.unknown",phrase:"Unknown"};i.curator?.login&&(_={type:"link",url:`https://www.twitch.tv/${i.curator.login}`,content:_});let E;return i.viewCount>0?E={type:"i18n",key:"clip.desc.2",phrase:"Clipped by {curator} \u2014 {views, plural, one {# View} other {# Views}}",content:{curator:_,views:i.viewCount}}:E={type:"i18n",key:"clip.desc.no-views",phrase:"Clipped by {curator}",content:{curator:_}},{accent:"#6441a4",fragments:{header:{type:"header",image:{type:"image",url:i.thumbnailURL,sfw:!0,aspect:16/9},title:i.title,subtitle:h,extra:E}},short:{type:"ref",name:"header"},full:[{type:"ref",name:"header"},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"player",iframe:`https://clips.twitch.tv/embed?parent=twitch.tv&clip=${k}`,aspect:16/9,content:{type:"overlay",content:{type:"image",url:i.thumbnailURL,sfw:!0,aspect:16/9},center:{type:"style",size:"2",content:{type:"icon",name:"play"}}}}]}}]}}},On={type:"user",test(k){const e=Pn.exec(k);if(e&&!Bn.includes(e[1]))return e[1]},async process(k){const e=this.resolve("site.twitch_data"),i=e?await e.getUser(null,k):null;if(!i||!i.id)return null;const s=i.broadcastSettings?.game?.displayName,n=i.stream?.id,o={avatar:{type:"image",url:i.profileImageURL,rounding:-1,aspect:1},desc:i.description,title:[i.displayName]};n&&s&&(o.game={type:"style",weight:"semibold",content:s}),i.displayName.trim().toLowerCase()!==i.login&&o.title.push({type:"style",color:"alt-2",content:[" (",i.login,")"]}),i.roles?.isPartner&&o.title.push({type:"style",color:"link",content:{type:"icon",name:"verified"}});const h=[{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"}},{type:"box","mg-y":"small",wrap:"pre-wrap",lines:5,content:{type:"ref",name:"desc"}}];if(n&&s){const _=i.stream.previewImageURL?i.stream.previewImageURL.replace("{width}","320").replace("{height}","180"):null;h.push({type:"link",url:`https://www.twitch.tv/${i.login}`,embed:!0,interactive:!0,tooltip:!1,content:[{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"image",url:_,aspect:16/9}]}},{type:"box","mg-y":"small",lines:2,content:i.broadcastSettings.title},{type:"ref",name:"game"}]})}return h.push({type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch"]}),{v:5,accent:i.primaryColorHex?`#${i.primaryColorHex}`:null,fragments:o,short:{type:"header",image:{type:"ref",name:"avatar"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"desc"},extra:n?{type:"i18n",key:"cards.user.streaming",phrase:"streaming {game}",content:{game:{type:"ref",name:"game"}}}:null},full:h}}},$n={type:"video",test(k){const e=Mn.exec(k);if(e)return e[1]},async process(k){const e=this.resolve("site.apollo");if(!e)return null;const i=await e.client.query({query:An(),variables:{id:k}});if(!i||!i.data||!i.data.video||!i.data.video.owner)return null;const s=i.data.video,n=s.game,o=n&&n.displayName,h={title:s.title,thumbnail:{type:"image",url:s.previewThumbnailURL,aspect:16/9}},_={type:"link",url:`https://www.twitch.tv/${s.owner.login}`,content:{type:"style",weight:"semibold",color:"alt-2",content:s.owner.displayName}};h.subtitle=s.game?.displayName?{type:"i18n",key:"video.desc.1.playing",phrase:"Video of {user} playing {game}",content:{user:_,game:{type:"style",weight:"semibold",content:s.game.displayName}}}:{type:"i18n",key:"video.desc.1",phrase:"Video of {user}",content:{user:_}};let E=s.lengthSeconds;return{v:5,fragments:h,short:{type:"header",image:{type:"ref",name:"thumbnail"},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"},extra:{type:"i18n",key:"video.desc.2",phrase:"{length,duration} \u2014 {views,number} Views \u2014 {date,datetime}",content:{length:E,views:s.viewCount,date:s.publishedAt}}},full:[{type:"header",image:{type:"image",url:s.owner.profileImageURL,rounding:-1,aspect:1},title:{type:"ref",name:"title"},subtitle:{type:"ref",name:"subtitle"}},{type:"box","mg-y":"small",lines:5,wrap:"pre-wrap",content:s.description},{type:"conditional",media:!0,content:{type:"gallery",items:[{type:"overlay",content:{type:"ref",name:"thumbnail"},"top-left":{type:"format",format:"duration",value:E},"bottom-left":{type:"i18n",key:"video.views",phrase:"{views,number} views",content:{views:s.viewCount}}}]}},{type:"header",compact:!0,subtitle:[{type:"icon",name:"twitch"}," Twitch \u2022 ",{type:"format",format:"datetime",value:s.publishedAt}]}]}}},In={presets:[{appearance:{type:"icon",icon:"ffz-i-pin"}}],required_context:["message"],title:"Pin This Message",description:"Allows you to pin a chat message if you're a moderator.",can_self:!0,tooltip(k){return k.line?.props?.pinnedMessage?.message?.id===k.message_id?this.i18n.t("chat.actions.pin.already","This message is already pinned."):this.i18n.t("chat.actions.pin","Pin This Message")},disabled(k,e,i,s,n,o){return(o??k.line)?.props?.pinnedMessage?.message?.id===e.id&&e.id!=null},hidden(k,e,i,s,n,o){let h=o;if(!h||!h.props.isPinnable||!h.onPinMessageClick||!e.message||!e.message.length||e.deleted)return!0},click(k,e){let i=e.line;if(!i){const s=this.resolve("site.fine");i=s?s.searchParent(k.target,n=>n.setMessageTray&&n.props&&n.props.message):null}!i||!i.props.isPinnable||!i.onPinMessageClick||i.props.pinnedMessage?.message?.id!==e.message_id&&i.onPinMessageClick()}},Ln={presets:[{appearance:{type:"dynamic"}}],required_context:["message"],supports_dynamic:!0,title:"Reply to Message",description:"Allows you to directly reply to another user's message.",can_self:!0,dynamicAppearance(k,e,i,s,n,o,h){const _=h??e.line,E=_?.props;return{type:"icon",icon:E?.hasReply||E?.reply?"ffz-i-threads":"ffz-i-reply",color:k.color}},tooltip(k){const e=k.line?.props;return e?.hasReply||e?.reply?this.i18n.t("chat.actions.reply.thread","Open Thread"):this.i18n.t("chat.actions.reply","Reply to Message")},hidden(k,e,i,s){const n=e?.id;if(typeof n!="string"||!/^[0-9a-f]+-[0-9a-f]+/.test(n)||!s?.can_reply||s?.reply_mode===0||!e.message||e.deleted)return!0},click(k,e){let i=e.line;if(!i){const s=this.resolve("site.fine");i=s?s.searchParent(k.target,n=>n.setMessageTray&&n.props&&n.props.message):null}i&&i.ffzOpenReply()}},Nn={presets:[{appearance:{type:"icon",icon:"ffz-i-pencil"}}],required_context:["user"],title:"Change Name & Color",description:"Allows you to set local overrides for a user's name and color in chat.",can_self:!0,tooltip(){return this.i18n.t("chat.actions.edit_overrides","Change Name & Color")},click(k,e){this.resolve("chat.overrides").renderUserEditor(e.user,k.target)}},jn={presets:[{appearance:{type:"icon",icon:"ffz-i-docs"}}],defaults:{format:"{{user.displayName}}: {{message.text}}"},editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,66038)),required_context:["user","message"],title:"Copy Message",description:"Allows you to quickly copy a chat message to your clipboard.",can_self:!0,tooltip(k){const e=this.replaceVariables(k.options.format,k);return[(0,se.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.copy_message","Copy Message")),(0,se.createElement)("div",{class:"tw-align-left"},e)]},click(k,e){const i=this.replaceVariables(e.options.format,e);navigator.clipboard.writeText(i)}},Un={presets:[{appearance:{type:"icon",icon:"ffz-i-link-ext"}}],defaults:{url:"https://link.example/{{user.login}}"},editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,86773)),title:"Open URL",description(k){return k.options.url},description_i18n:null,can_self:!0,tooltip(k){const e=this.replaceVariables(k.options.url,k);return[(0,se.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.open_url","Open URL")),(0,se.createElement)("div",{class:"tw-align-left"},e)]},click(k,e){const i=this.replaceVariables(e.options.url,e),s=window.open();s&&(s.opener=null,s.location=i)}},Hn={presets:[{appearance:{type:"text",text:"C"}}],required_context:["room"],defaults:{command:"@{{user.login}} HeyGuys",paste:!1},title:"Chat Command",description(k){if(k.options.paste)return this.t("chat.actions.chat.desc.paste","Paste into chat: {cmd}",{cmd:k.options.command});const e=k.options.target??"";return this.t("chat.actions.chat.desc.target","Send in {target}: {cmd}",{cmd:k.options.command,target:/^\s*$/.test(e)?this.t("chat.actions.chat.desc.current","current channel"):e})},description_i18n:null,can_self:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,34727)),tooltip(k){const e=this.replaceVariables(k.options.command,k);let i=this.replaceVariables(k.options.target??"",k);return/^\s*$/.test(i)&&(i=null),[(0,se.createElement)("div",{class:"tw-border-b tw-mg-b-05"},i?this.i18n.t("chat.actions.chat.with-target","Chat Command in Channel: {target}",{target:i}):this.i18n.t("chat.actions.chat","Chat Command")),(0,se.createElement)("div",{class:"tw-align-left"},e)]},click(k,e){const i=this.replaceVariables(e.options.command,e);let s=this.replaceVariables(e.options.target??"",e);(e.options.paste||/^\s*$/.test(s))&&(s=e.room.login),e.options.paste?this.pasteMessage(s,i):this.sendMessage(s,i)}},Wn={presets:[{appearance:{type:"icon",icon:"ffz-i-trash"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user","message"],title:"Delete Message",tooltip(k){return this.i18n.t("chat.actions.delete.tooltip","Delete {user.login}'s message",{user:k.user})},click(k,e){return this.resolve("site.twitch_data").deleteChatMessage(e.room.id,e.message_id).catch(s=>{s instanceof r.TranslatableError&&this.addNotice(e.room.login,this.i18n.t(s.i18n_key,s.message,s.data))})}},Gn={presets:[{appearance:{type:"icon",icon:"ffz-i-block"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,93953)),title:"Ban User",reason_text(k){return this.i18n.t("chat.actions.ban-reason","Ban {user.login} for:",{user:k.user})},tooltip(k){return this.i18n.t("chat.actions.ban.tooltip","Ban {user.login}",{user:k.user})},click(k,e){let i=e.reason||e.options.reason||"";i.length&&(i=this.replaceVariables(i,e)),this.sendMessage(e.room.login,`/ban ${e.user.login} ${i}`)}},Vn={presets:[{appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}],defaults:{duration:600},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,69454)),title:"Timeout User",description:"{options.duration, plural, one {# second} other {# seconds}}",reason_text(k){return this.i18n.t("chat.actions.timeout-reason","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}} for:",{user:k.user,duration:k.options.duration})},tooltip(k){return this.i18n.t("chat.actions.timeout.tooltip","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}}",{user:k.user,duration:k.options.duration})},click(k,e){let i=e.reason||e.options.reason||"";i.length&&(i=this.replaceVariables(i,e)),this.sendMessage(e.room.login,`/timeout ${e.user.login} ${e.options.duration} ${i}`)}},Zn={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Unban User",tooltip(k){return this.i18n.t("chat.actions.unban.tooltip","Unban {user.login}",{user:k.user})},click(k,e){this.sendMessage(e.room.login,`/unban ${e.user.login}`)}},Kn={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Untimeout User",tooltip(k){return this.i18n.t("chat.actions.untimeout.tooltip","Untimeout {user.login}",{user:k.user})},click(k,e){this.sendMessage(e.room.login,`/untimeout ${e.user.login}`)}},qn={presets:[{appearance:{type:"icon",icon:"ffz-i-mod"}}],required_context:["room","user"],title:"Mod User",tooltip(k){return this.i18n.t("chat.actions.mod.tooltip","Mod {user.login}",{user:k.user})},hidden(k,e,i,s,n,o){return e.user.type==="mod"||e.user.id===i.id?!0:i.id!==s.id},click(k,e){this.sendMessage(e.room.login,`/mod ${e.user.login}`)}},Yn={presets:[{appearance:{type:"icon",icon:"ffz-i-unmod"}}],required_context:["room","user"],title:"Un-Mod User",tooltip(k){return this.i18n.t("chat.actions.unmod.tooltip","Un-Mod {user.login}",{user:k.user})},hidden(k,e,i,s,n,o){return e.user.type!=="mod"?!0:e.user.id===s.id||e.user.id===i.id?!1:i.id!==s.id},click(k,e){this.sendMessage(e.room.login,`/unmod ${e.user.login}`)}},Xn={presets:[{appearance:{type:"text",text:"W"}}],required_context:["user"],title:"Whisper User",tooltip(k){return this.i18n.t("chat.actions.whisper.tooltip","Whisper {user.login}",k)},click(k,e){const i=this.resolve("site"),s=i&&i.getUser(),n=i&&i.store;if(!s||!n||!e.user||!e.user.id||s.id==e.user.id)return;const o=parseInt(s.id,10),h=parseInt(e.user.id,10),_=o<h?`${o}_${h}`:`${h}_${o}`;n.dispatch({type:"whispers.THREAD_OPENED",data:{threadID:_,collapsed:!1}})}},Jn={presets:[{appearance:{type:"dynamic"}}],editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,12893)),required_context:[],supports_dynamic:!0,can_self:!0,title:"Toggle Settings Profile",description(k){const e=window.FrankerFaceZ.get(),i=e?.resolve("settings"),s=i?.profile(k.options?.uuid);return s?s.i18n_key?this.t(s.i18n_key,s.name):s.name:null},description_i18n:null,dynamicAppearance(k,e){const i=this.settings.profile(e.options?.uuid);return i?{type:"icon",icon:i.toggled?"ffz-i-ok":"ffz-i-cancel",color:k.color}:{type:"icon",icon:"ffz-i-attention",color:k.color}},tooltip(k){const e=this.settings.profile(k.options?.uuid);let i;return e?i=e.i18n_key?this.i18n.t(e.i18n_key,e.name):e.name:i="invalid",this.i18n.t("chat.actions.toggle_profile.tooltip","Toggle Profile: {name}",{name:i})},click(k,e){const i=this.settings.profile(e.options?.uuid);if(!i)return;const s=new Set;for(const n of["inline","hover","user-context","room"]){const o=`chat.actions.${n}`,h=this.parent.context.get(o);if(Array.isArray(h)){for(const _ of h)if(_.action==="toggle_profile"&&_.options?.uuid===i.uuid){s.add(n),this.parent.context.once(`changed:${o}`,()=>s.delete(n));break}}}i.toggled=!i.toggled,requestAnimationFrame(()=>{for(const n of s)this.parent.context.update(`chat.actions.${n}`)})}};var Ws=Q(61892);const Qn={title:"Dynamic",title_i18n:"setting.actions.appearance.dynamic",colored:!0,render(k,e,i){return e("figure",{style:{color:i},class:`${k.icon||"ffz-i-zreknarf"}`})}},er={title:"Text",title_i18n:"setting.actions.appearance.text",colored:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,74640)),component:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,68185)),render(k,e,i){return e("span",{style:{color:i}},k.text)}},tr={title:"Emote",title_i18n:"setting.actions.appearance.emote",editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,29668)),component:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,25816)),render(k,e){return e("figure",{class:"mod-icon__image"},e("img",{src:k.src}))}},ir={title:"Icon",title_i18n:"setting.actions.appearance.icon",colored:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,8684)),load(k){return k.icon&&k.icon.startsWith("ffz-fa")&&(0,Ws.load)(),!0},component:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,92123)),render(k,e,i){return e("figure",{style:{color:i},class:`${k.icon||"ffz-i-zreknarf"}`})}},sr={title:"Text and Icon",title_i18n:"setting.actions.appearance.combo",colored:!0,editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,56727)),load(k){return k.icon&&k.icon.startsWith("ffz-fa")&&(0,Ws.load)(),!0},component:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,6234)),render(k,e,i){return e("span",{style:{color:i},class:k.icon},k.text)}},nr={title:"Image",title_i18n:"setting.actions.appearance.image",editor:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,17816)),component:()=>Promise.all([Q.e(6530),Q.e(6940),Q.e(2086)]).then(Q.bind(Q,81725)),render(k,e){return e("figure",{class:"mod-icon__image"},e("img",{src:k.image}))}},rr=/\{\{(.*?)(?:\|(.*?))?\}\}/g,Ts=class Ts extends d.default{constructor(...e){super(...e),this.inject("settings"),this.inject("tooltips"),this.inject("i18n"),this.actions={},this.renderers={},this.filterAction=i=>i.appearance&&this.renderers[i.appearance.type]&&(!this.renderers[i.appearance.type].load||this.renderers[i.appearance.type].load(i.appearance))&&(!i.action||this.actions[i.action]),this.settings.add("chat.actions.size",{default:16,ui:{path:'Chat > Actions @{"always_list_pages": true} >> Appearance',title:"Action Size",description:"How tall actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.hover-size",{default:30,ui:{path:"Chat > Actions > Message Hover >> Appearance",title:"Action Size",description:"How tall hover actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.reasons",{default:[{v:{text:"One-Man Spam",i18n:"chat.reasons.spam"}},{v:{text:"Posting Bad Links",i18n:"chat.reasons.links"}},{v:{text:"Ban Evasion",i18n:"chat.reasons.evasion"}},{v:{text:"Threats / Personal Info",i18n:"chat.reasons.personal"}},{v:{text:"Hate / Harassment",i18n:"chat.reasons.hate"}},{v:{text:"Ignoring Broadcaster / Moderators",i18n:"chat.reason.ignore"}}],type:"array_merge",always_inherit:!0,process(i,s){if(Array.isArray(s))for(const n of s)n.i18n&&typeof n.i18n!="string"&&delete n.i18n;return s},ui:{path:"Chat > Actions > Reasons >> Custom Reasons",component:"chat-reasons"}}),this.settings.add("chat.actions.hover",{process:(i,s)=>s.filter(this.filterAction),default:[{v:{action:"pin",appearance:{type:"icon",icon:"ffz-i-pin"},options:{},display:{mod_icons:!0}}},{v:{action:"reply",appearance:{type:"dynamic"},options:{},display:{}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > Message Hover @{"description": "Here, you can define custom actions that will appear on top of messages in chat when you hover over them. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,hover_modifier:!1,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.inline",{process:(i,s)=>s.filter(this.filterAction),default:[{v:{action:"ban",appearance:{type:"icon",icon:"ffz-i-block"},options:{},display:{mod:!0,mod_icons:!0,deleted:!1}}},{v:{action:"unban",appearance:{type:"icon",icon:"ffz-i-ok"},options:{},display:{mod:!0,mod_icons:!0,deleted:!0}}},{v:{action:"timeout",appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}},{v:{action:"msg_delete",appearance:{type:"icon",icon:"ffz-i-trash"},options:{},display:{mod:!0,mod_icons:!0}}}],type:"array_merge",inherit_default:!0,ui:{path:`Chat > Actions > In-Line @{"description": "Here, you can define custom actions that will appear along messages in chat. If you aren't seeing an action you've defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}`,component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.user-context",{process:(i,s)=>s.filter(n=>n.type||this.filterAction(n)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > User Context @{"description": "Here, you can define custom actions that will appear in a context menu when you right-click a username in chat."}',component:"chat-actions",context:["user","room","message"],mod_icons:!0,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room",{process:(i,s)=>s.filter(n=>n.type||this.filterAction(n)),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > Room @{"description": "Here, you can define custom actions that will appear above the chat input box."}',component:"chat-actions",context:["room","room-mode"],inline:!1,data:()=>{const i=this.resolve("site.chat");return{color:s=>i&&i.colors?i.colors.process(s):s,actions:(0,r.deep_copy)(this.actions),renderers:(0,r.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room-above",{default:!1,ui:{path:"Chat > Actions > Room >> General",component:"setting-check-box",title:"Display Room Actions above the chat input box."}}),this.settings.add("chat.actions.rules-as-reasons",{default:!0,ui:{path:"Chat > Actions > Reasons >> Rules",component:"setting-check-box",title:"Include the current room's rules in the list of reasons."}}),this.handleClick=this.handleClick.bind(this),this.handleContext=this.handleContext.bind(this),this.handleUserContext=this.handleUserContext.bind(this)}onEnable(){this.tooltips.types.action=(e,i)=>{const s=this.getData(e);return s?s.definition.tooltip?s.tip&&s.tip.length?this.replaceVariables(s.tip,s):(0,r.maybe_call)(s.definition.tooltip,this,s,e,i):`Error: The "${s.action}" action provider does not have tooltip support.`:this.i18n.t("chat.actions.unknown","Unknown Action Type")};for(const e in W)(0,r.has)(W,e)&&this.addAction(e,W[e]);for(const e in x)(0,r.has)(x,e)&&this.addRenderer(e,x[e]);this.on("addon:fully-unload",e=>{let i=0;for(const[s,n]of Object.entries(this.actions))n?.__source===e&&(i++,delete this.actions[s]);for(const[s,n]of Object.entries(this.renderers))n?.__source===e&&(i++,delete this.renderers[s]);i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,e),this._updateContexts())})}getAddonProxy(e,i,s){if(!e)return this;const n={},o={},h=f.DEBUG||i?.dev;return n.addAction=(_,E)=>(E&&(E.__source=e),h&&!_.includes(e)&&s.log.warn("[DEV-CHECK] Call to actions.addAction() did not include add-on ID in key:",_),this.addAction(_,E)),n.addRenderer=(_,E)=>(E&&(E.__source=e),h&&!_.includes(e)&&s.log.warn("[DEV-CHECK] Call to actions.addRenderer() did not include add-on ID in key:",_),this.addRenderer(_,E)),h&&(n.removeAction=(..._)=>{for(const E of _){const R=this.actions[E];R&&R.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned action with actions.removeAction:",E," owner:",R.__source??"ffz")}return this.removeAction(..._)},n.removeRenderer=(..._)=>{for(const E of _){const R=this.renderers[E];R&&R.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned renderer with actions.removeRenderer:",E," owner:",R.__source??"ffz")}return this.removeRenderer(..._)},o.actions="Please use addAction() or removeAction()",o.renderers="Please use addRenderer() or removeRenderer()"),(0,d.buildAddonProxy)(s,this,"actions",n,o)}_updateContexts(){for(const e of this.settings.__contexts)e.update("chat.actions.inline"),e.update("chat.actions.hover"),e.update("chat.actions.user-context"),e.update("chat.actions.room")}addAction(e,i){if((0,r.has)(this.actions,e))return this.log.warn(`Attempted to add action "${e}" which is already defined.`);this.actions[e]=i,this._updateContexts()}addRenderer(e,i){if((0,r.has)(this.renderers,e))return this.log.warn(`Attempted to add renderer "${e}" which is already defined.`);this.renderers[e]=i,this._updateContexts()}getActions(){return{...this.actions}}getAction(e){return this.actions[e]??null}getRenderer(e){return this.renderers[e]??null}getRenderers(){return{...this.renderers}}removeAction(...e){let i=!1;for(const s of e)(0,r.has)(this.actions,s)&&(delete this.actions[s],i=!0);i&&this._updateContexts()}removeRenderer(...e){let i=!1;for(const s of e){if(!(0,r.has)(this.renderers,s))return;delete this.renderers[s],i=!0}i&&this._updateContexts()}replaceVariables(e,i){return $t(e,i,this.i18n.locale,rr,{upper(s){return s.toString().toUpperCase()},uppercase(s){return s.toString().toUpperCase()},lower(s){return s.toString().toLowerCase()},lowercase(s){return s.toString().toLowerCase()},snakecase(s){return s.toString().toSnakeCase()},slugify(s,n,o,h){return s.toString().toSlug(h&&h.length?h:"-")},urlencode(s){return encodeURIComponent(s)},word(s,n,o,h){if(!h||!h.length)return s;let _,E;const R=h.split(",");try{if(_=parseInt(R[0],10),isNaN(_)||!isFinite(_))return s}catch{return this.log.warn("Invalid value for word(start)",R[0]),s}if(R.length>1)if(!R[1].trim().length)E=-1;else try{if(E=parseInt(R[1],10),isNaN(E)||!isFinite(E))return s}catch{return this.log.warn("Invalid value for word(end)",R[1]),s}const T=s.split(/\s+/);return _<0&&(_=T.length+_),_<0&&(_=0),_>=T.length&&(_=T.length-1),E!=null?(E<0&&(E=T.length+E),E<_&&(E=_),E>T.length&&(E=T.length),T.slice(_,E+1).join(" ")):T[_]}})}renderInlineReasons(e,i,s){const n=this.parent.context.get("chat.actions.reasons"),o=[],h=this.parent.context.get("chat.actions.rules-as-reasons")&&this.parent.getRoom(e.room.id,e.room.login,!0),_=h&&h.rules;if(!n&&!_)return s.hide(),null;const E=B(T=>N=>(s.hide(),e.definition.click.call(this,N,Object.assign({reason:T},e)),N.preventDefault(),!1),"click_fn");if(n&&n.length)for(const T of n){const N=this.replaceVariables(typeof T.i18n=="string"?this.i18n.t(T.i18n,T.text):T.text,e);o.push((0,se.createElement)("li",{class:"tw-full-width tw-relative"},(0,se.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:E(N)},N)))}if(_&&_.length){n&&n.length&&o.push((0,se.createElement)("div",{class:"tw-mg-y-05 tw-border-b"}));for(const T of _)o.push((0,se.createElement)("li",{class:"tw-full-width tw-relative"},(0,se.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:E(T)},T)))}let R;return e.definition.reason_text?R=e.definition.reason_text.call(this,e,i,s):R=this.i18n.t("chat.actions.select-reason","Please select a reason from the list below:"),(0,se.createElement)("div",{class:"ffz--inline-reasons"},R?(0,se.createElement)("div",{class:"tw-pd-05 tw-border-b"},R):null,(0,se.createElement)("div",{class:"scrollable-area","data-simplebar":!0},(0,se.createElement)("div",{class:"simplebar-scroll-content"},(0,se.createElement)("div",{class:"simplebar-content"},(0,se.createElement)("ul",null,o)))))}renderInlineContext(e,i){const s=i.definition;let n;if(s.context)n=B((o,h)=>s.context.call(this,i,o,h),"content");else if(s.uses_reason)n=B((o,h)=>this.renderInlineReasons(i,o,h),"content");else return;return this.renderPopup(e,n)}renderPopup(e,i){if(e._ffz_destroy)return e._ffz_destroy();const s=e._ffz_destroy=()=>{if(e._ffz_outside&&e._ffz_outside.destroy(),e._ffz_popup){const h=e._ffz_popup;e._ffz_popup=null,h.destroy()}e._ffz_on_destroy&&e._ffz_on_destroy(),e._ffz_destroy=e._ffz_outside=e._ffz_on_destroy=null},n=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(e._ffz_popup=new ri.default(n,e,{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:n},flip:{behavior:["bottom","top","left","right"]}}},content:i,onShow:async(h,_)=>{await _.waitForDom(),e._ffz_outside=new se.ClickOutside(_.outer,s)},onMove:(h,_,E)=>{this.emit("tooltips:hover",h,_,E)},onLeave:(h,_,E)=>{this.emit("tooltips:leave",h,_,E)},onHide:s}))._enter(e)}getUserLevel(e,i){return!e||!i?0:e.id===i.id||e.login===i.login?5:i.moderator||i.type==="mod"||i.badges&&i.badges.moderator?3:0}renderRoom(e,i,s,n,o){const h=[],_=this.resolve("site.chat");let E=null;for(const Y of this.parent.context.get("chat.actions.room")){if(!Y)continue;Y.ctx="room";const ce=Y.type;if(ce){ce==="new-line"?E=null:ce==="space"?(E||h.push(E=[]),E.push(o("div",{class:"tw-flex-grow-1"}))):ce==="space-small"?(E||h.push(E=[]),E.push(o("div",{class:"tw-mg-x-1"}))):this.log.warn("Unknown action type",ce);continue}if(!Y.action||!Y.appearance)continue;let me=Y.appearance||{};const pe=Y.display||{},Ae=this.actions[Y.action];if(!Ae||pe.disabled||pe.mod_icons!=null&&pe.mod_icons!==!!e||pe.mod!=null&&pe.mod!==(i?!!i.mod:!1)||pe.staff!=null&&pe.staff!==(i?!!i.staff:!1)||pe.emoteOnly!=null&&pe.emoteOnly!==s.emoteOnly||pe.slowMode!=null&&pe.slowMode!==s.slowMode||pe.subsMode!=null&&pe.subsMode!==s.subsMode||pe.r9kMode!=null&&pe.r9kMode!==s.r9kMode||pe.followersOnly!=null&&pe.followersOnly!==s.followersOnly||(0,r.maybe_call)(Ae.hidden,this,Y,null,s,i,e))continue;if(me.type==="dynamic"){const Ue=Ae.dynamicAppearance&&Ae.dynamicAppearance.call(this,Object.assign({},me),Y,null,s,i,e);Ue&&(me=Ue)}if(Ae.override_appearance){const Ue=Ae.override_appearance.call(this,Object.assign({},me),Y,null,s,i,e);Ue&&(me=Ue)}const Fe=this.renderers[me.type];if(!Fe)continue;const ve=Fe.colored&&me.color,Le=(0,r.maybe_call)(Ae.disabled,this,Y,null,s,i,e)||!1,Ee=ve&&(_&&_.colors?_.colors.process(me.color):me.color),je=Fe.render.call(this,me,o,Ee);E||h.push(E=[]),E.push(o("button",{class:`ffz-tooltip tw-pd-x-05 mod-icon ffz-mod-icon tw-c-text-alt-2${Le?" disabled":""}${ve?" colored":""}`,"data-tooltip-type":"action","data-action":Y.action,"data-options":Y.options?JSON.stringify(Y.options):null,"data-tip":me.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},je))}if(!h.length)return null;const R=s&&JSON.stringify(s),T=h.length>1,N=T?h.map((Y,ce)=>o("div",{key:ce,class:"tw-flex tw-full-width tw-flex-row tw-flex-wrap"},Y)):h[0];return o("div",{class:`ffz--room-actions${T?" tw-flex-column":""} ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${n?"tw-pd-y-05 tw-border-t":"tw-mg-x-05"}`,"data-room":R},N)}renderUserContext(e,i){const s=this.resolve("site.fine"),n=this.resolve("site"),o=this.resolve("site.chat"),h=s&&s.searchParent(e,ve=>ve.props&&ve.props.message),_=h?.props?.message;if(!_||!n||!o)return;let E=_.roomLogin?_.roomLogin:_.channel?_.channel.slice(1):void 0;if(!E&&h.props.channelID){const ve=this.parent.getRoom(h.props.channelID,null,!0);ve&&ve.login&&(E=_.roomLogin=ve.login)}const R=n.getUser(),T={id:h.props.channelID,login:E},N=!!(h.props.hasReply||h.props.reply||!h.props.replyRestrictedReason),Y=N&&_.message&&!_.deleted&&!h.props.disableReplyClick,ce=Y&&(N||R&&R.login!==_.user?.login);_.roomId=T.id,R&&(R.moderator=h.props.isCurrentUserModerator,R.staff=h.props.isCurrentUserStaff,R.reply_mode=this.parent.context.get("chat.replies.style"),R.can_reply=ce);const me=this.getUserLevel(T,R),pe=this.getUserLevel(T,_.user);let Ae=h.props.showModerationIcons;me<3&&(Ae=!1);const Fe=h;return this.renderPopup(e,(ve,Le)=>{const Ee=[];let je=null;const Ue=B(ht=>{this.handleClick(ht,je),Le.hide()},"handle_click");for(const ht of i){if(!ht)continue;if(ht.ctx="user_context",ht.type==="new-line"){je=null;continue}else if(ht.type==="space-small"){je||Ee.push(je=[]),je.push((0,se.createElement)("div",{class:"tw-pd-x-1"}));continue}else if(ht.type==="space"){je||Ee.push(je=[]),je.push((0,se.createElement)("div",{class:"tw-flex-grow-1"}));continue}else if(!ht.action||!ht.appearance)continue;let yt=ht.appearance||{};const Qe=ht.display||{},bt=this.actions[ht.action];if(!bt||Qe.disabled||Qe.mod_icons!=null&&Qe.mod_icons!==!!Ae||Qe.mod!=null&&Qe.mod!==me>pe||Qe.staff!=null&&Qe.staff!==(R?!!R.staff:!1)||Qe.deleted!=null&&Qe.deleted!==!!_.deleted||(0,r.maybe_call)(bt.hidden,this,ht,_,T,R,Ae,Fe))continue;if(yt.type==="dynamic"){const Zt=bt.dynamicAppearance&&bt.dynamicAppearance.call(this,Object.assign({},yt),ht,_,T,R,Ae,Fe);Zt&&(yt=Zt)}if(bt.override_appearance){const Zt=bt.override_appearance.call(this,Object.assign({},yt),ht,_,T,R,Ae,Fe);Zt&&(yt=Zt)}const Ct=this.renderers[yt.type];if(!Ct)continue;const Yt=Ct.colored&&yt.color,ci=(0,r.maybe_call)(bt.disabled,this,ht,_,T,R,Ae,Fe)||!1,pi=Yt&&(o&&o.colors?o.colors.process(yt.color):yt.color),Ti=Ct.render.call(this,yt,se.createElement,pi);je||Ee.push(je=[]);const mi=(0,se.createElement)("button",{class:`ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text${ci?" tw-button--disabled disabled":""}`,"data-tooltip-type":"action","data-action":ht.action,"data-options":ht.options?JSON.stringify(ht.options):null,onClick:Ue,onContextMenu:this.handleContext},(0,se.createElement)("span",{class:"tw-button__text"},Ti));yt.tooltip&&(mi.dataset.tip=yt.tooltip),je.push(mi)}const Je=(0,se.createElement)("div",{class:"ffz-action-data tw-pd-05","data-source":"msg"},(0,se.createElement)("div",{class:"tw-pd-b-05 tw-border-b"},(0,se.createElement)("strong",null,_.user.displayName||_.user.login),"..."),Ee.map(ht=>!ht||!ht.length?null:(0,se.createElement)("div",{class:"tw-flex tw-flex-no-wrap"},ht)));return Je.ffz_message=_,Je.ffz_line=Fe,Je})}renderHover(e,i,s,n,o,h=null){const _=[],E=this.getUserLevel(n,s),R=this.getUserLevel(n,e.user),T=e.user&&s&&s.login===e.user.login;E<3&&(i=!1);const N=this.resolve("site.chat");let Y=!1;for(const ce of this.parent.context.get("chat.actions.hover")){if(!ce.action||!ce.appearance)continue;ce.ctx="hover";let me=ce.appearance||{};const pe=ce.display||{},Ae=pe.keys,Fe=this.actions[ce.action];if(!Fe||pe.disabled||pe.mod_icons!=null&&pe.mod_icons!==!!i||pe.mod!=null&&pe.mod!==E>R||pe.staff!=null&&pe.staff!==(s?!!s.staff:!1)||pe.deleted!=null&&pe.deleted!==!!e.deleted||T&&!Fe.can_self||(0,r.maybe_call)(Fe.hidden,this,ce,e,n,s,i,h))continue;if(me.type==="dynamic"){const Je=Fe.dynamicAppearance&&Fe.dynamicAppearance.call(this,Object.assign({},me),ce,e,n,s,i,h);Je&&(me=Je)}if(Fe.override_appearance){const Je=Fe.override_appearance.call(this,Object.assign({},me),ce,e,n,s,i,h);Je&&(me=Je)}const ve=this.renderers[me.type];if(!ve)continue;const Le=ve.colored&&me.color,Ee=(0,r.maybe_call)(Fe.disabled,this,ce,e,n,s,i,h)||!1,je=Le&&(N&&N.colors?N.colors.process(me.color):me.color),Ue=ve.render.call(this,me,o,je);Y=!0,_.push(o("div",{class:`ffz-hover-action${Ae?` ffz-has-modifier ffz-modifier-${Ae}`:""}`},o("button",{class:`ffz-tooltip ffz-mod-icon tw-c-text-alt-2${Ee?" disabled":""}${Le?" colored":""}`,"data-tooltip-type":"action","data-action":ce.action,"data-options":ce.options?JSON.stringify(ce.options):null,"data-tip":me.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},Ue)))}return Y?o("div",{class:"ffz--hover-actions ffz-action-data tw-mg-r-05","data-source":"line"},_):null}renderInline(e,i,s,n,o,h=null){const _=[],E=this.getUserLevel(n,s),R=this.getUserLevel(n,e.user),T=e.user&&s&&s.login===e.user.login;E<3&&(i=!1);const N=this.resolve("site.chat"),Y=[];let ce=!1;for(const pe of this.parent.context.get("chat.actions.inline")){if(!pe.action||!pe.appearance)continue;pe.ctx="inline";let Ae=pe.appearance||{};const Fe=pe.display||{},ve=Fe.keys,Le=Fe.hover,Ee=this.actions[pe.action];if(!Ee||Fe.disabled||Fe.mod_icons!=null&&Fe.mod_icons!==!!i||Fe.mod!=null&&Fe.mod!==E>R||Fe.staff!=null&&Fe.staff!==(s?!!s.staff:!1)||Fe.deleted!=null&&Fe.deleted!==!!e.deleted||T&&!Ee.can_self||(0,r.maybe_call)(Ee.hidden,this,pe,e,n,s,i,h))continue;if(Ae.type==="dynamic"){const bt=Ee.dynamicAppearance&&Ee.dynamicAppearance.call(this,Object.assign({},Ae),pe,e,n,s,i,h);bt&&(Ae=bt)}if(Ee.override_appearance){const bt=Ee.override_appearance.call(this,Object.assign({},Ae),pe,e,n,s,i,h);bt&&(Ae=bt)}const je=this.renderers[Ae.type];if(!je)continue;const Ue=je.colored&&Ae.color,Je=(0,r.maybe_call)(Ee.disabled,this,pe,e,n,s,i,h)||!1,ht=Ue&&(N&&N.colors?N.colors.process(Ae.color):Ae.color),yt=je.render.call(this,Ae,o,ht);let Qe=_;(ve||Le)&&(Qe=Y),ce=!0,Qe.push(o("button",{class:`ffz-tooltip mod-icon ffz-mod-icon tw-c-text-alt-2${Je?" disabled":""}${Ue?" colored":""}${ve?` ffz-modifier-${ve}`:""}${Le?" ffz-hover":""}`,"data-tooltip-type":"action","data-action":pe.action,"data-options":pe.options?JSON.stringify(pe.options):null,"data-tip":Ae.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},yt))}if(!ce)return null;let me=null;if(_.length&&(me=o("div",{class:"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05","data-source":"line"},_)),Y.length){const pe=o("div",{class:"ffz--inline-actions ffz--modifier-actions ffz-action-data","data-source":"line"},Y);return me?[me,pe]:pe}return me}getData(e){const i=e.dataset,s=e.closest(".ffz-action-data"),n=s&&s.dataset,o=i&&i.action,h=this.actions[o];if(!h)return null;let _,E,R,T=!1,N;if(n){if(n.source==="msg"&&s.ffz_message){const ce=s.ffz_message;N=s.ffz_line,T=!0,_=ce.user?{color:ce.user.color,id:ce.user.id,login:ce.user.login,displayName:ce.user.displayName,type:ce.user.type}:null,E={login:ce.roomLogin,id:ce.roomId},R={id:ce.id,text:ce.message}}else if(n.source==="line"){const ce=this.resolve("site.fine");if(N=ce&&ce.searchParent(s,me=>me.props&&me.props.message),N&&N.props&&N.props.message){T=!0;const me=N.props.message;_=me.user?{color:me.user.color,id:me.user.id,login:me.user.login,displayName:me.user.displayName,type:me.user.type}:null,E={login:N.props.channelLogin,id:N.props.channelID},R={id:me.id,text:me.message}}}T||(_=n.user?JSON.parse(n.user):null,E=n.room?JSON.parse(n.room):null,R=n.message?JSON.parse(n.message):n.msgId?{id:n.msgId}:null)}const Y={action:o,definition:h,tip:i.tip,options:i.options?JSON.parse(i.options):null,user:_,room:E,message:R,message_id:R?R.id:null,line:N};return h.defaults&&(Y.options=Object.assign({},(0,r.maybe_call)(h.defaults,this,Y,e),Y.options)),Y}handleClick(e){const i=e.target,s=this.getData(i);if(s&&!i.classList.contains("disabled"))return s.definition.click?(i._ffz_tooltip&&i._ffz_tooltip.hide(),s.definition.click.call(this,e,s)):s.definition.context?this.handleContext(e):this.log.warn(`No click handler for action provider "${s.action}"`)}handleContext(e){if(e.shiftKey)return;e.preventDefault();const i=e.target,s=this.getData(e.target);s&&(i.classList.contains("disabled")||(i._ffz_tooltip&&i._ffz_tooltip.hide(),!(!s.definition.context&&!s.definition.uses_reason)&&this.renderInlineContext(i,s)))}handleUserContext(e){if(e.shiftKey)return;const i=this.parent.context.get("chat.actions.user-context");if(!Array.isArray(i)||!i.length)return;e.preventDefault();const s=e.target;s._ffz_tooltip&&s._ffz_tooltip.hide(),this.renderUserContext(s,i)}pasteMessage(e,i){return this.resolve("site.chat.input").pasteMessage(e,i)}addNotice(e,i){return this.resolve("site.chat").addNotice(e,i)}sendMessage(e,i){return this.resolve("site.chat").sendMessage(e,i)}};B(Ts,"Actions");let ts=Ts;function is(k){return k.sort((e,i)=>e[0]<i[0]?1:e[0]>i[0]?-1:!e[1]&&i[1]?1:e[1]&&!i[1]?-1:0),k}B(is,"sortPriorityColorTerms");const or=["g","gi"],ss=["filter_test"];function Hi(k){const e=[];for(let i=0;i<k.length;i++){const s=k[i];s[0].length&&s[1].push((0,r.addWordSeparators)(s[0].join("|"))),e.push(s[1].length?new RegExp(s[1].join("|"),or[i]||"gi"):null)}return e}B(Hi,"formatTerms");const ar="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0",lr=/[ .,!]/,Gs=["gif emotes","gif emoticons","gifs"],Ms=class Ms extends d.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.inject("experiments"),this.inject("staging"),this.inject("load_tracker"),this.inject(Ki),this.inject(Xi),this.inject(Ji.ZP),this.inject(ts),this.inject("overrides",Qi),this._link_info={},this.clickToReveal=this.clickToReveal.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this),this.handleMentionClick=this.handleMentionClick.bind(this),this.handleReplyClick=this.handleReplyClick.bind(this),this.style=new se.ManagedStyle,this.context=this.settings.context({}),this.CommandPrefixes=new r.SourcedSet(!0),this.CommandPrefixes.set("ffz",["/","!"]),this.rooms={},this.users={},this.room_ids={},this.user_ids={},this.tokenizers={},this.__tokenizers=[],this.rich_providers={},this.__rich_providers=[],this.link_providers={},this.__link_providers=[],this._hl_reasons={},this.addHighlightReason("mention","Mentioned","Mention"),this.addHighlightReason("user","Highlight User","User"),this.addHighlightReason("badge","Highlight Badge","Badge"),this.addHighlightReason("term","Highlight Term","Term"),this.settings.add("debug.link-resolver.source",{process:(n,o)=>f.LINK_DATA_HOSTS[o]??f.LINK_DATA_HOSTS.Production,default:null,ui:{path:"Debugging > Data Sources >> Links",title:"Link Resolver",component:"setting-select-box",force_seen:!0,data:[{value:null,title:"Automatic"}].concat(Object.entries(f.LINK_DATA_HOSTS).map(n=>({value:n[0],title:n[1].title})))},changed:()=>this.clearLinkCache()}),this.settings.addUI("debug.link-resolver.test",{path:"Debugging > Data Sources >> Links",component:"link-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.timestamp-size",{default:null,ui:{path:"Chat > Appearance >> General",title:"Timestamp Font Size",description:"How large should timestamps be, in pixels. Defaults to Font Size if not set.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-size",{default:13,ui:{path:"Chat > Appearance >> General",title:"Font Size",description:"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-family",{default:"",ui:{path:"Chat > Appearance >> General",title:"Font Family",description:"Set the font used for displaying chat messages.",component:"setting-combo-box",data:()=>(0,Ci.R7)()}}),this.settings.add("chat.name-format",{default:0,ui:{path:"Chat > Appearance >> Usernames",title:"Display Style",description:"Change how usernames are displayed in chat when users have an international display name set.",component:"setting-select-box",data:[{value:0,title:"International Name (Username) <Default>"},{value:1,title:"International Name"},{value:2,title:"Username"}]}}),this.settings.add("chat.lines.emote-alignment",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Emote Alignment",description:"Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.",component:"setting-select-box",data:[{value:0,title:"Standard"},{value:1,title:"Padded"},{value:2,title:"Baseline (BTTV-Like)"}]}}),this.settings.add("chat.rich.enabled",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content in chat.",description:"This displays rich content blocks for things like linked clips and videos.",component:"setting-check-box"}}),this.settings.add("chat.rich.want-mid",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display larger rich content in chat.",description:`This enables the use of bigger rich content embeds in chat. This is **not** recommended for most users and/or chats.

**Note:** Enabling this may cause chat to scroll at inopportune times due to content loading. Moderators should not use this feature.`,component:"setting-check-box"}}),this.settings.add("chat.rich.hide-tokens",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Hide matching links for rich content.",component:"setting-check-box"}}),this.settings.add("chat.rich.all-links",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content embeds for all links.",description:"*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*",component:"setting-check-box",extra:{component:"chat-rich-example",getChat:()=>this}}}),this.settings.add("chat.rich.minimum-level",{default:0,ui:{path:"Chat > Appearance >> Rich Content",title:"Required User Level",description:"Only display rich content embeds on messages posted by users with this level or higher.",component:"setting-select-box",data:[{value:4,title:"Broadcaster"},{value:3,title:"Moderator"},{value:2,title:"VIP"},{value:1,title:"Subscriber"},{value:0,title:"Everyone"}]}}),this.settings.add("chat.scrollback-length",{default:150,ui:{path:"Chat > Behavior >> General",title:"Scrollback Length",description:"Keep up to this many lines in chat. Setting this too high will create lag.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.filtering.debug",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Display a list of highlight reasons on every chat message for debugging.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("chat.filtering.pad-bottom",{path:"Chat > Filtering > Highlight",sort:1e3,component:"setting-spacer",top:"30rem",force_seen:!0}),this.settings.add("chat.filtering.click-to-reveal",{default:!1,ui:{path:'Chat > Filtering > General @{"sort":-1} >> Behavior',title:"Click to reveal deleted terms.",component:"setting-check-box"}}),this.settings.add("chat.filtering.deleted-style",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Detailed Message Style",description:"This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.",component:"setting-select-box",data:[{value:0,title:"Faded"},{value:1,title:"Faded, Line Through"},{value:2,title:"Line Through"},{value:3,title:"No Change"}]}}),this.settings.add("chat.filtering.display-deleted",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",sort:-1,title:"Rendering Mode",description:"This, when set, overrides the `Deleted Messages` mode selected in Twitch chat settings, which is normally only accessible for moderators. Brief hides messages entirely and shows a notice in chat that a number of messages were hidden. Detailed shows the contents of the message. Legacy shows `<message deleted>` with click to reveal.",component:"setting-select-box",data:[{value:!1,title:"Do Not Override"},{value:"BRIEF",title:"Brief"},{value:"DETAILED",title:"Detailed"},{value:"LEGACY",title:"Legacy"}]}}),this.settings.add("chat.filtering.display-mod-action",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Display Reason",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"In Detailed Mode"},{value:2,title:"Always"}]}}),this.settings.add("chat.automod.delete-messages",{default:!0,ui:{path:'Chat > Filtering > General >> AutoMod Filters @{"description": "Extra configuration for Twitch\'s native `Chat Filters`."}',title:"Mark messages as deleted if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.remove-messages",{default:!0,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Remove messages entirely if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.run-as-mod",{default:!1,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Use Chat Filters as a moderator.",description:"By default, Twitch's Chat Filters feature does not function for moderators. This overrides that behavior.",component:"setting-check-box"}}),this.settings.add("chat.filtering.process-own",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Filter your own messages.",component:"setting-check-box"}}),this.settings.add("chat.filtering.ignore-clear",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Do not Clear Chat when commanded to.",component:"setting-check-box"}}),this.settings.add("chat.filtering.remove-deleted",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Remove deleted messages from chat.",description:"Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.",component:"setting-select-box",data:[{value:0,title:"Do Not Remove"},{value:1,title:"Remove Unseen (Default)"},{value:2,title:"Remove Unseen as Moderator"},{value:3,title:"Remove All"}]}}),this.settings.add("chat.delay",{default:-1,ui:{path:"Chat > Behavior >> General",title:"Artificial Chat Delay",description:"Delay the appearance of chat messages to allow for moderation before you see them.",component:"setting-select-box",data:[{value:-1,title:"Default Delay (Room Specific; Non-Mod Only)"},{value:0,title:"No Delay"},{value:300,title:"Minor (Bot Moderation; 0.3s)"},{value:1200,title:"Normal (Human Moderation; 1.2s)"},{value:5e3,title:"Large (Spoiler Removal / Slow Mods; 5s)"},{value:1e4,title:"Extra Large (10s)"},{value:15e3,title:"Extremely Large (15s)"},{value:2e4,title:"Mods Asleep; Delay Chat (20s)"},{value:3e4,title:"Half a Minute (30s)"},{value:6e4,title:"Why??? (1m)"},{value:7884e8,title:"The CBenni Option (Literally 25 Years)"}]}}),this.settings.add("chat.filtering.hidden-tokens",{default:[],type:"array_merge",always_inherit:!0,process(n,o){const h=new Set;for(const _ of o)(_?.v||!ss.includes(_.v))&&h.add(_.v);return h},ui:{path:'Chat > Appearance >> Hidden Token Types @{"description":"This filter allows you to prevent specific content token types from appearing chat messages, such as hiding all cheers or emotes."}',component:"blocked-types",getExtraTerms:()=>Object.keys(this.tokenizers).filter(n=>!ss.includes(n)&&this.tokenizers[n]?.render),data:()=>Object.keys(this.tokenizers).filter(n=>!ss.includes(n)&&this.tokenizers[n]?.render).sort()}}),this.settings.add("chat.filtering.highlight-basic-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight @{"description": "These settings allow you to highlight messages in chat based on their contents. Setting priorities on rules allows you to determine which highlight color should be applied if a message matches multiple rules. Rules with a higher priority take priority over rules with lower priorities.\\n\\nYou can also create a rule that removes highlights from messages, preventing lower priority rules from highlighting them, by setting a color with an alpha value of zero. Example: `#00000000`"} >> Users',component:"basic-terms",colored:!0,words:!1,priority:!0}}),this.settings.add("__filter:highlight-users",{requires:["chat.filtering.highlight-basic-users"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-users");if(!o||!o.length)return null;const h=new Map;for(const E of o){const R=E.p||0,T=E.t;let N=E.c||null,Y=E.v;if(T==="glob"?Y=(0,r.glob_to_regex)(Y):T!=="raw"&&(Y=(0,r.escape_regex)(Y)),!Y||!Y.length)continue;try{new RegExp(Y)}catch{continue}let ce=h.get(R);if(ce||(ce=new Map,h.set(R,ce)),N){const me=Mt.Color.RGBA.fromCSS(N);(!me||!me.a)&&(N=!1)}ce.has(N)?ce.get(N).push(Y):ce.set(N,[Y])}const _=[];for(const[E,R]of h)for(const[T,N]of R)_.push([E,T,new RegExp(`^(?:${N.join("|")})$`,"gi")]);return is(_)}}),this.settings.add("chat.filtering.highlight-basic-users-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Block >> Users",component:"basic-terms",removable:!0,words:!1}}),this.settings.add("__filter:block-users",{requires:["chat.filtering.highlight-basic-users-blocked"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-users-blocked");if(!o||!o.length)return null;const h=[[],[]];for(const _ of o){const E=_.t;let R=_.v;E==="glob"?R=(0,r.glob_to_regex)(R):E!=="raw"&&(R=(0,r.escape_regex)(R)),!(!R||!R.length)&&h[_.remove?1:0].push(R)}return h.map(_=>_.length?new RegExp(`^(?:${_.join("|")})$`,"i"):null)}}),this.settings.add("chat.filtering.highlight-basic-badges",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Highlight >> Badges",component:"badge-highlighting",colored:!0,priority:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:highlight-badges",{requires:["chat.filtering.highlight-basic-badges"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-badges");if(!o||!o.length)return null;const h=new Map;for(const _ of o){let E=_.c||null;const R=_.p||0,T=_.v;if(E){const Y=Mt.Color.RGBA.fromCSS(E);(!Y||!Y.a)&&(E=!1)}const N=h.get(T);(!N||N[0]<R||E&&!N[1]&&N[0]<=R)&&h.set(T,[R,E])}return h}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Badges @{"description": "**Note:** This section is for filtering messages out of chat from users with specific badges. If you wish to hide a badge, go to [Chat > Badges >> Visibility](~chat.badges.tabs.visibility)."}',component:"badge-highlighting",removable:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:block-badges",{requires:["chat.filtering.highlight-basic-badges-blocked"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-badges-blocked");if(!o||!o.length)return null;const h=[[],[]];for(const _ of o)_.v&&h[_.remove?1:0].push(_.v);return!h[0].length&&!h[1].length?null:h}}),this.settings.add("chat.filtering.highlight-basic-terms",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",colored:!0,priority:!0,highlight:!0}}),this.settings.add("__filter:highlight-terms",{requires:["chat.filtering.highlight-tokens","chat.filtering.highlight-basic-terms"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-tokens"),h=n.get("chat.filtering.highlight-basic-terms");if(!h||!h.length)return null;const _=new Map;let E=!1,R=!1;for(const N of h){const Y=N.p||0,ce=o&&((0,r.has)(N,"h")?N.h:!0),me=N.s,pe=N.t,Ae=(0,r.has)(N,"w")?N.w:pe!=="raw";let Fe=N.c||null,ve=N.v;if(pe==="glob"?ve=(0,r.glob_to_regex)(ve):pe!=="regex"&&pe!=="raw"&&(ve=(0,r.escape_regex)(ve)),!ve||!ve.length)continue;try{new RegExp(ve)}catch{continue}ce?E=!0:R=!0;let Le=_.get(Y);if(Le||(Le=new Map,_.set(Y,Le)),Fe){const je=Mt.Color.RGBA.fromCSS(Fe);(!je||!je.a)&&(Fe=!1)}let Ee=Le.get(Fe);Ee||Le.set(Fe,Ee=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]]),Ee[ce?0:1][me?0:1][Ae?0:1].push(ve)}if(!E&&!R)return null;const T={hl:E?[]:null,non:R?[]:null};for(const[N,Y]of _)for(const[ce,me]of Y){const pe=Hi(me[0]),Ae=Hi(me[1]);(pe[0]||pe[1])&&T.hl.push([N,ce,pe]),(Ae[0]||Ae[1])&&T.non.push([N,ce,Ae])}return E&&is(T.hl),R&&is(T.non),T}}),this.settings.add("chat.filtering.highlight-basic-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",removable:!0}}),this.settings.add("__filter:block-terms",{requires:["chat.filtering.highlight-basic-blocked"],equals:"requirements",process(n){const o=n.get("chat.filtering.highlight-basic-blocked");if(!o||!o.length)return null;const h=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]];let _=!1,E=!1;for(const R of o){const T=R.t,N=R.s,Y=(0,r.has)(R,"w")?R.w:T!=="raw";let ce=R.v;T==="glob"?ce=(0,r.glob_to_regex)(ce):T!=="regex"&&T!=="raw"&&(ce=(0,r.escape_regex)(ce)),!(!ce||!ce.length)&&(R.remove?_=!0:E=!0,h[R.remove?1:0][N?0:1][Y?0:1].push(ce))}return!_&&!E?null:{remove:_?Hi(h[1]):null,non:E?Hi(h[0]):null}}}),this.settings.add("chat.filtering.clickable-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Viewer Cards >> Behavior",title:"Enable opening viewer cards by clicking mentions in chat."}}),this.settings.add("chat.filtering.all-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions for all users without requiring an at sign (@).",description:"**Note**: This setting can increase memory usage and impact chat performance."}}),this.settings.add("chat.filtering.color-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with username colors.",description:"**Note:** Not compatible with color overrides as mentions do not include user IDs."}}),this.settings.add("chat.filtering.need-colors",{requires:["chat.filtering.all-mentions","chat.filtering.color-mentions"],process(n){return n.get("chat.filtering.all-mentions")||n.get("chat.filtering.color-mentions")}}),this.settings.add("chat.filtering.bold-mentions",{default:!0,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with a bold font."}}),this.settings.add("chat.filtering.mention-priority",{default:0,ui:{path:"Chat > Filtering > General >> Appearance",title:"Mention Priority",component:"setting-text-box",type:"number",process:"to_int",description:"Mentions of your name have this priority for the purpose of highlighting. See [Chat > Filtering > Highlight](~chat.filtering.highlight) for more details."}}),this.settings.add("chat.filtering.mention-color",{default:"",ui:{path:"Chat > Filtering > General >> Appearance",title:"Custom Highlight Color",component:"setting-color-box",description:"If this is set, highlighted messages with no default color set will use this color rather than red."}}),this.settings.add("chat.filtering.highlight-mentions",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight messages that mention you.",component:"setting-check-box"}}),this.settings.add("chat.filtering.highlight-tokens",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight matched words in chat.",component:"setting-check-box"}}),this.settings.add("tooltip.images",{default:!0,ui:{path:'Chat > Tooltips >> General @{"sort": -1}',title:"Display images in tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.badge-images",{default:!0,requires:["tooltip.images"],process(n,o){return n.get("tooltip.images")?o:!1},ui:{path:"Chat > Tooltips >> Badges",title:"Display large images of badges.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-sources",{default:!0,ui:{path:"Chat > Tooltips >> Emotes",title:"Display known sources.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-images",{default:!0,requires:["tooltip.images"],process(n,o){return n.get("tooltip.images")?o:!1},ui:{path:"Chat > Tooltips >> Emotes",title:"Display large images of emotes.",component:"setting-check-box"}}),this.settings.add("tooltip.rich-links",{default:!0,ui:{sort:-1,path:"Chat > Tooltips >> Links",title:"Display rich tooltips for links.",component:"setting-check-box",extra:{component:"chat-tooltip-example"}}}),this.settings.add("tooltip.link-interaction",{default:!0,ui:{path:"Chat > Tooltips >> Links",title:"Allow interaction with supported link tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.link-images",{default:!0,requires:["tooltip.images"],process(n,o){return n.get("tooltip.images")?o:!1},ui:{path:"Chat > Tooltips >> Links",title:"Display images for links.",component:"setting-check-box"}}),this.settings.add("tooltip.link-nsfw-images",{default:!1,ui:{path:"Chat > Tooltips >> Links",title:"Display potentially NSFW images.",description:"When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.",component:"setting-check-box"}});for(const[n,o]of Object.entries(f.RESOLVERS_REQUIRE_TOS))this.settings.addUI(`tooltip.tos.${n}`,{path:'Chat > Tooltips >> Terms of Service @{"description": "The following services require you to agree to their Terms of Service before we can show you information from their platforms."}',component:"tooltip-tos",item:n,override_setting:"agreed-tos",getChat:()=>this,data:(0,r.deep_copy)(o),onUIChange:()=>this.emit(":update-link-resolver")});this.settings.add("chat.adjustment-mode",{default:null,process(n,o){return o??(n.get("ls.useHighContrastColors")??!0?1:0)},requires:["ls.useHighContrastColors"],ui:{path:"Chat > Appearance >> Colors",title:"Adjustment",description:"Alter user colors to ensure that they remain readable.",default(n){return n.get("ls.useHighContrastColors")??!0?1:0},component:"setting-select-box",data:[{value:-1,title:"No Color"},{value:0,title:"Unchanged"},{value:1,title:"HSL Luma"},{value:2,title:"Luv Luma"},{value:3,title:"HSL Loop (BTTV-Like)"},{value:4,title:"RGB Loop (Deprecated)"}]}}),this.settings.add("chat.adjustment-contrast",{default:4.5,ui:{path:"Chat > Appearance >> Colors",title:"Minimum Contrast",description:"Set the minimum contrast ratio used by Luma adjustments when determining readability.",component:"setting-text-box",process:"to_float"}}),this.settings.add("chat.me-style",{default:2,ui:{path:"Chat > Appearance >> Chat Lines",title:"Action Style",description:"When someone uses `/me`, the message will be rendered in this style.",component:"setting-select-box",data:[{value:0,title:"No Style"},{value:1,title:"Colorized (Old Style)"},{value:2,title:"Italic (New Style)"},{value:3,title:"Colorized Italic"}]}}),this.settings.add("chat.bits.stack",{default:0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Cheer Stacking",description:"Collect all the cheers in a message into a single cheer at the start of the message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Grouped by Type"},{value:2,title:"All in One"}]}}),this.settings.add("chat.emotes.animated",{default:null,requires:["ls.emoteAnimationsEnabled"],process(n,o){return o??(n.get("ls.emoteAnimationsEnabled")??!0?1:0)},ui:{path:"Chat > Appearance >> Emotes",sort:-50,title:"Animated Emotes",default(n){return n.get("ls.emoteAnimationsEnabled")??!0?1:0},getExtraTerms:()=>Gs,description:"This controls whether or not animated emotes are allowed to play in chat. When this is `Disabled`, emotes will appear as static images. Setting this to `Enable on Hover` may cause performance issues.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enable on Hover"}]}}),this.settings.add("tooltip.emote-images.animated",{requires:["chat.emotes.animated"],default:null,process(n,o){return o==null&&(o=!!n.get("chat.emotes.animated")),o},ui:{path:"Chat > Tooltips >> Emotes",title:"Display animated images of emotes.",getExtraTerms:()=>Gs,description:"If this is not overridden, animated images are only shown in emote tool-tips if [Chat > Appearance >> Emotes > Animated Emotes](~chat.appearance.emotes) is not disabled.",component:"setting-check-box"}}),this.settings.add("chat.bits.animated",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display animated cheers.",component:"setting-check-box"}});const i=new Date(0).toLocaleTimeString().toUpperCase(),s=i.lastIndexOf("PM")===-1&&i.lastIndexOf("AM")===-1;this.settings.add("chat.timestamp-format",{default:s?"H:mm":"h:mm",ui:{path:"Chat > Appearance >> Chat Lines",title:"Timestamp Format",component:"setting-combo-box",description:"Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)",data:[{value:"h:mm",title:"12 Hour"},{value:"h:mm:ss",title:"12 Hour with Seconds"},{value:"H:mm",title:"24 Hour"},{value:"H:mm:ss",title:"24 Hour with Seconds"},{value:"hh:mm",title:"Padded"},{value:"hh:mm:ss",title:"Padded with Seconds"},{value:"HH:mm",title:"Padded 24 Hour"},{value:"HH:mm:ss",title:"Padded 24 Hour with Seconds"}]}}),this.context.on("changed:theme.is-dark",()=>{for(const n of this.iterateRooms())n.buildBitsCSS()}),this.context.on("changed:chat.bits.animated",()=>{for(const n of this.iterateRooms())n.buildBitsCSS()}),this.context.on("changed:chat.filtering.need-colors",async n=>{n?await this.createColorCache():this.color_cache=null,this.emit(":update-line-tokens")}),this.context.on("changed:chat.filtering.all-mentions",()=>this.emit(":update-line-tokens")),this.context.on("changed:chat.filtering.color-mentions",()=>this.emit(":update-line-tokens"))}async createColorCache(){const e=await Q(4866);this.color_cache=new e(150)}generateLog(){const e=["chat settings","-------------------------------------------------------------------------------"];for(const[i,s]of this.context.__cache.entries())e.push(`${i}: ${JSON.stringify(s)}`);return e.join(`
`)}getAddonProxy(e,i,s){if(!e)return this;const n=f.DEBUG||i?.dev,o=(0,r.makeAddonIdChecker)(e),h={},_={},E=(0,d.buildAddonProxy)(s,null,"getUser()",{addBadge:n?function(T,...N){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().addBadge() did not include addon ID in provider:",T),this.addBadge(T,...N)}:void 0,removeBadge:n?function(T,...N){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().removeBadge() did not include addon ID in provider:",T),this.removeBadge(T,...N)}:void 0,addSet(T,N,Y){return n&&!o.test(T)&&s.log.warn("[DEV-CHECK] Call to getUser().addSet() did not include addon ID in provider:",T),this.manager.emotes.providers.has(T)||(this.manager.emotes.inferProvider(T,e),n&&s.log.warn("[DEV-CHECK] Call to getUser().addSet() for provider that has not been registered with emotes.setProvider:",T)),Y&&(n&&!o.test(N)&&s.log.warn("[DEV-CHECK] Call to getUser().addSet() loaded set data but did not include addon ID in set ID:",N),Y.__source=e),this.addSet(T,N,Y)},removeAllSets:n?function(T){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().removeAllSets() did not include addon ID in provider:",T),this.removeAllSets(T)}:void 0,removeSet:n?function(T,...N){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getUser().removeSet() did not include addon ID in provider:",T),this.removeSet(T,...N)}:void 0},n?{badges:"Please use addBadge(), getBadge(), or removeBadge()",emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",room:!0}:null,!0),R=(0,d.buildAddonProxy)(s,null,"getRoom()",{getUser(...T){const N=this.getUser(...T);if(N)return new Proxy(N,E)},addSet(T,N,Y){return n&&!o.test(T)&&s.log.warn("[DEV-CHECK] Call to getRoom().addSet() did not include addon ID in provider:",T),this.manager.emotes.providers.has(T)||(this.manager.emotes.inferProvider(T,e),n&&s.log.warn("[DEV-CHECK] Call to getRoom().addSet() for provider that has not been registered with emotes.setProvider:",T)),Y&&(n&&!o.test(N)&&s.log.warn("[DEV-CHECK] Call to getRoom().addSet() loaded set data but did not include addon ID in set ID:",N),Y.__source=e),this.addSet(T,N,Y)},removeAllSets:n?function(T){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getRoom().removeAllSets() did not include addon ID in provider:",T),this.removeAllSets(T)}:void 0,removeSet:n?function(T,...N){return o.test(T)||s.log.warn("[DEV-CHECK] Call to getRoom().removeSet() did not include addon ID in provider:",T),this.removeSet(T,...N)}:void 0},{badges:!0,load_data:!0,emote_sets:"Please use addSet(), removeSet(), or removeAllSets()",refs:"Please use ref() or unref()",style:!0,users:"Please use getUser()",user_ids:"Please use getUser()"},!0);return h.iterateUsers=function*(){for(const T of this.iterateUsers())yield new Proxy(T,E)},h.iterateRooms=function*(){for(const T of this.iterateRooms())yield new Proxy(T,R)},h.iterateAllRoomsAndUsers=function*(){for(const T of this.iterateAllRoomsAndUsers())yield new Proxy(T,T instanceof Li?R:E)},h.addTabCommandPrefix=(T,N=null)=>(N==null&&(N=e),n&&N!==e&&s.log.warn("[DEV-CHECK] Used addTabCommandPrefix with incorrect provider."),this.addTabCommandPrefix(T,N)),h.removeTabCommandPrefix=(T,N=null)=>(N==null&&(N=e),n&&N!==e&&s.log.warn("[DEV-CHECK] Used removeTabCommandPrefix with incorrect provider."),this.removeTabCommandPrefix(T,N)),h.addTokenizer=T=>(T&&(T.__source=e),this.addTokenizer(T)),h.addLinkProvider=T=>(T&&(T.__source=e),this.addLinkProvider(T)),h.addRichProvider=T=>(T&&(T.__source=e),this.addRichProvider(T)),n&&(h.getUser=(...T)=>{let N=this.getUser(...T);if(N)return new Proxy(N,E)},h.getRoom=(...T)=>{let N=this.getRoom(...T);if(N)return new Proxy(N,R)},h.removeTokenizer=T=>{let N;typeof T=="string"?N=T:N=T.type;const Y=this.tokenizers[N];return Y&&Y.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned tokenizer with chat.removeTokenizer:",N," owner:",Y.__source??"ffz"),this.removeTokenizer(T)},h.removeLinkProvider=T=>{let N;typeof T=="string"?N=T:N=T.type;const Y=this.link_providers[N];return Y&&Y.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned link provider with chat.removeLinkProvider:",N," owner:",Y.__source??"ffz"),this.removeLinkProvider(T)},h.removeRichProvider=T=>{let N;typeof T=="string"?N=T:N=T.type;const Y=this.link_providers[N];return Y&&Y.__source!==e&&s.log.warn("[DEV-CHECK] Removed un-owned rich provider with chat.removeRichProvider:",N," owner:",Y.__source??"ffz"),this.removeRichProvider(T)}),(0,d.buildAddonProxy)(s,this,"chat",h,_)}onEnable(){this.socket=this.resolve("socket"),this.pubsub=this.resolve("pubsub"),this.settings.provider.on("changed",this.onProviderChange,this),this.on("site.subpump:pubsub-message",this.onPubSub,this),this.on("chat.emotes:update-priorities",e=>{for(const i of this.iterateAllRoomsAndUsers())i.emote_sets&&i.emote_sets.setSortFunction(e)}),this.context.get("chat.filtering.need-colors")&&this.createColorCache().then(()=>this.emit(":update-line-tokens"));for(const e in P)(0,r.has)(P,e)&&this.addTokenizer(P[e]);for(const e in L)(0,r.has)(L,e)&&this.addRichProvider(L[e]);for(const e in I)(0,r.has)(I,e)&&this.addLinkProvider(I[e]);this.on("chat:reload-data",e=>{for(const i of this.iterateRooms())i.load_data()}),this.on("chat:get-tab-commands",e=>{e.commands.push({name:"ffz:reload",description:this.i18n.t("chat.command.reload","Reload FFZ and add-on chat data (emotes, badges, etc.)"),permissionLevel:0,ffz_group:"FrankerFaceZ"})}),this.triggered_reload=!1,this.on("chat:ffz-command:reload",e=>{if(this.triggered_reload)return;const i=this.resolve("site.chat");i?.addNotice&&i.addNotice("*",this.i18n.t("chat.command.reload.starting","FFZ is reloading data...")),this.triggered_reload=!0,this.emit("chat:reload-data")}),this.on("load_tracker:complete:chat-data",e=>{if(this.triggered_reload){const i=this.resolve("site.chat");i?.addNotice&&i.addNotice("*",this.i18n.t("chat.command.reload.done","FFZ has finished reloading data. (Sources: {list})",{list:e.join(", ")}))}this.triggered_reload=!1}),this.on("addon:fully-unload",e=>{let i=0;for(const[s,n]of Object.entries(this.link_providers))n?.__source===e&&(i++,this.removeLinkProvider(s));for(const[s,n]of Object.entries(this.rich_providers))n?.__source===e&&(i++,this.removeRichProvider(s));for(const[s,n]of Object.entries(this.tokenizers))n?.__source===e&&(i++,this.removeTokenizer(s));this.CommandPrefixes.delete(e);for(const s of this.iterateAllRoomsAndUsers())i+=s._unloadAddon(e)??0;i&&(this.log.debug(`Cleaned up ${i} entries when unloading addon:`,e),this.emit(":update-line-tokens"))})}onPubSub(e){if(e.prefix==="stream-chat-room-v1"&&e.message.type==="chat_rich_embed"){const i=e.message.data,s=i.request_url,n=this.__link_providers;if(this._link_info[s])return;for(const o of n){const h=o.test.call(this,s);if(h){const _=o.receive?o.receive.call(this,h,i):i;let E=o.process.call(this,h,_);E instanceof Promise||(E=Promise.resolve(E)),E.then(R=>{this._link_info[s]||(this._link_info[s]=[!0,Date.now()+12e4,R])});return}}}}getUser(e,i,s,n,o=!1){let h;if(e&&typeof e=="number"&&(e=`${e}`),e&&this.user_ids[e]?h=this.user_ids[e]:i&&this.users[i]&&!n&&(h=this.users[i]),h&&h.destroyed&&(h=null),!h){if(s)return null;h=new Ii(this,null,e,i)}if(e&&e!==h.id){if(h.id){if(this.log.warn(`Data mismatch for user #${e} -- Stored ID: ${h.id} -- Login: ${i} -- Stored Login: ${h.login}`),o)throw new Error("id mismatch");this.user_ids[h.id]===h&&(this.user_ids[h.id]=null)}h._id=e,this.user_ids[e]=h}if(i){const _=this.users[i];_?_!==h&&!n&&(_.id?this.users[i]=h:(h.merge(_),_.destroy(!0))):this.users[i]=h}return h}getRoom(e,i,s,n,o=!1){let h;if(e&&typeof e=="number"&&(e=`${e}`),e&&this.room_ids[e]?h=this.room_ids[e]:i&&this.rooms[i]&&!n&&(h=this.rooms[i]),h&&h.destroyed&&(h=null),!h){if(s)return null;h=new Li(this,e,i)}if(e&&e!==h.id){if(h.id){if(this.log.warn(`Data mismatch for room #${e} -- Stored ID: ${h.id} -- Login: ${i} -- Stored Login: ${h.login}`),o)throw new Error("id mismatch");this.room_ids[h.id]===h&&(this.room_ids[h.id]=null)}h._id=e,this.room_ids[e]=h}if(i){const _=this.rooms[i];_?_!==h&&!n&&(_.id?this.rooms[i]=h:(h.merge(_),_.destroy(!0))):this.rooms[i]=h}return h}*iterateAllRoomsAndUsers(){for(const e of this.iterateRooms()){yield e;for(const i of e.iterateUsers())yield i}for(const e of this.iterateUsers())yield e}*iterateUsers(){const e=new Set;for(const i of Object.values(this.user_ids))i&&!i.destroyed&&(e.add(i),yield i);for(const i of Object.values(this.users))i&&!i.destroyed&&(yield i)}*iterateRooms(){const e=new Set;for(const i of Object.values(this.room_ids))i&&!i.destroyed&&(e.add(i),yield i);for(const i of Object.values(this.rooms))i&&!i.destroyed&&!e.has(i)&&(yield i)}iterateMessages(e=!0,i=!0,s=!0){const n=[];return this.emit("chat:get-messages",e,i,s,n),this.emit("chat:get-messages-late",e,i,s,n),n}handleLinkClick(e){if(e.ctrlKey||e.shiftKey)return;const i=e.currentTarget,s=i?.dataset;if(!s)return;const n=this.makeEvent({url:s.url??i.href,source:e});if(this.emit("chat:click-link",n),n.defaultPrevented)return e.preventDefault(),e.stopPropagation(),!0}handleReplyClick(e){const i=e.target,s=this.resolve("site.fine");if(!i||!s)return;const n=s.searchParent(i,o=>o.props&&o.props.reply&&o.setOPCardTray);n&&n.setOPCardTray(n.props.reply)}handleMentionClick(e){if(!this.context.get("chat.filtering.clickable-mentions"))return;const i=e.target,s=i&&i.dataset;if(!s||!s.login)return;const n=this.resolve("site.fine");if(!n)return;const o=n.searchParent(i,h=>h.props&&h.props.onUsernameClick);o&&o.props.onUsernameClick(s.login,void 0,void 0,e.currentTarget.getBoundingClientRect().bottom)}clickToReveal(e){const i=e.target;if(i){if(i._ffz_visible)i.textContent="\xD7\xD7\xD7";else if(this.context.get("chat.filtering.click-to-reveal"))i.dataset&&(i.textContent=i.dataset.text);else return;i._ffz_visible=!i._ffz_visible}}standardizeWhisper(e){if(!e)return e;if(e._ffz_message)return e._ffz_message;const i={},s=e.content.startsWith("/me "),n=s?4:0,o=e._ffz_message={id:e.id,user:{...e.from},message:e.content.slice(n),is_action:s,ffz_emotes:i,timestamp:e.sentAt&&e.sentAt.getTime(),deleted:!1};if(o.user.color=o.user.chatColor,Array.isArray(e.emotes)&&e.emotes.length)for(const h of e.emotes){const _=h.emoteID;(i[_]=i[_]||[]).push({startIndex:h.from-n,endIndex:h.to-n})}return o}getUserLevel(e){return!e||!e.user?0:e.user.login===e.roomLogin||e.badges&&e.badges.broadcaster?4:e.badges?e.badges.moderator?3:e.badges.vip?2:e.badges.subscriber?1:0:0}tokenizeReply(e){return e?[{type:"reply",text:e.parentDisplayName,color:this.context.get("chat.filtering.color-mentions")&&this.color_cache?this.color_cache.get(e.parentUserLogin):null,recipient:e.parentUserLogin},{type:"text",text:" "}]:null}applyHighlight(e,i,s,n,o=!1){if(!e)return e;const h=e.mention_priority==null,_=h||i>=e.mention_priority,E=h||i>e.mention_priority;if(e.filters&&e.filters.push(`${n}(${i})${_&&s===!1?":remove":s?`:${s}`:""}`),_){if(e.mention_priority=i,s===!1){E&&(e.mentioned=!1,e.clear_priority=i,e.mention_color=e.highlights=null);return}e.mentioned=!0,e.highlights||(e.highlights=new Set)}e.mentioned&&(e.clear_priority==null||i>=e.clear_priority)&&(e.highlights.add(n),(s||o)&&(E||!e.mention_color)&&(e.mention_color=s))}standardizeMessage(e){if(!e)return e;e.ffz_standardized=!0,e.sender&&!e.user&&(e.user=e.sender),e.from&&!e.user&&(e.user=e.from);let i=e.user;i||(i=e.user={});const s=e.extension||{};if(i.color=i.color||i.chatColor||s.chatColor||null,i.type=i.type||i.userType||null,i.id=i.id||i.userID||null,i.login=i.login||i.userLogin||null,i.displayName=i.displayName||i.userDisplayName||i.login||s.displayName,i.isIntl=i.login&&i.displayName&&i.displayName.trim().toLowerCase()!==i.login,this.color_cache&&i.color&&this.color_cache.set(i.login,i.color),!e.message&&e.messageParts&&this.detokenizeMessage(e),e.content&&!e.message&&(e.content.fragments?this.detokenizeContent(e):e.message=e.content.text),e.ffz_emotes||this.standardizeEmotes(e),!e.badges&&i.displayBadges){const n=e.badges={};for(const o of i.displayBadges)n[o.setID]=o.version}if(!e.badges&&s.displayBadges){const n=e.badges={};for(const o of s.displayBadges)n[o.setID]=o.version}return i.type==null&&e.badges&&e.badges.moderator&&(i.type="mod"),!e.timestamp&&e.sentAt&&(e.timestamp=new Date(e.sentAt).getTime()),e.deletedAt!==void 0&&(e.deleted=!!e.deletedAt),e.ffz_badges=e.sourceRoomID?this.badges.getBadges(i.id,i.login,e.sourceRoomID,null):this.badges.getBadges(i.id,i.login,e.roomID,e.roomLogin),e}standardizeEmotes(e){if(e.emotes&&e.message){const i={},s=(0,r.split_chars)(e.message);let n=0;e.message&&e.messageBody&&e.message!==e.messageBody&&(n=s.length-(0,r.split_chars)(e.messageBody).length);for(const o in e.emotes)if((0,r.has)(e.emotes,o)){const h=e.emotes[o];if(Array.isArray(h))return e.ffz_emotes=e.emotes;const _=i[h.id]=i[h.id]||[];let E=h.startIndex+1+n;for(;E<s.length&&!lr.test(s[E]);)E++;_.push({startIndex:h.startIndex+n,endIndex:E-1})}e.ffz_emotes=i;return}e.messageParts?this.detokenizeMessage(e,!0):e.content&&e.content.fragments&&this.detokenizeContent(e,!0)}detokenizeContent(e,i=!1){const s=[],n=e.content.fragments,o=n.length,h={};let _=0,E,R=!0;for(let T=0;T<o;T++){const N=n[T],Y=N.content,ce=Y&&Y.__typename;if(E=N.text,ce==="Emote"){const me=Y.emoteID;(h[me]=h[me]||[]).push({startIndex:_,endIndex:_+E.length-1})}E&&E.length&&(R&&E.startsWith("/me ")&&(e.is_action=!0,E=E.slice(4)),_+=(0,r.split_chars)(E).length,s.push(E)),R=!1}return i||(e.message=s.join("")),e.ffz_emotes=h,e}detokenizeMessage(e,i=!1){const s=[],n=e.messageParts,o=n.length,h={};let _=0,E,R=null,T=0;for(let N=0;N<o;N++){const Y=n[N],ce=Y.ffz_content??Y.content;if(ce){if(typeof ce=="string")E=ce;else if(ce.recipient)E=`@${ce.recipient}`;else if(ce.url)E=ce.url;else if(ce.cheerAmount)T+=ce.cheerAmount,E=`${ce.alt}${ce.cheerAmount}`;else if(ce.images){const me=ce.images.themed?ce.images.dark:ce.images.sources;let pe=ce.emoteID;if(!pe){const Ae=me&&(/\/emoticons\/v1\/(\d+)\/[\d.]+$/.exec(me["1x"])||/\/emoticons\/v2\/(\d+)\//.exec(me["1x"]));pe=Ae&&Ae[1]}if(E=ce.alt,pe){const Ae=h[pe]=h[pe]||[],Fe=R>0?1:0;Ae.push({startIndex:_+Fe,endIndex:_+E.length-1})}R>0&&(E=` ${E}`)}else continue;E&&(_+=(0,r.split_chars)(E).length,R=Y.type,s.push(E))}}return i||(e.message=s.join("")),e.bits=T,e.ffz_emotes=h,e}formatUser(e,i){const s=this.context.get("chat.name-format"),n=s===2&&e.isIntl?e.login:e.displayName||e.login,o=[i("span",{className:"chat-author__display-name"},n)];return s===0&&e.isIntl&&o.push(i("span",{className:"chat-author__intl-login"},` (${e.login})`)),o}formatTime(e){e instanceof Date||(e=new Date(e));const i=this.context.get("chat.timestamp-format"),s=b()(e);try{return s.locale(this.i18n.locale).format(i)}catch{return s.format(i)}}addHighlightReason(e,i,s){if(typeof e=="object"&&e.key?(i=e,e=i.key):typeof i=="string"&&(i={title:i}),typeof s=="string"&&s.length>0&&(i.label=s),i.value=i.key=e,i.i18n_key||(i.i18n_key=`hl-reason.${e}`),i.label&&!i.i18n_label&&(i.i18n_label=`${i.i18n_key}.label`),this._hl_reasons[e])throw new Error(`Highlight Reason already exists with key ${e}`);this._hl_reasons[e]=i}getHighlightReason(e){return this._hl_reasons[e]??null}getHighlightReasons(){return Object.values(this._hl_reasons)}addTabCommandPrefix(e,i="ffz"){Array.isArray(e)||(e=[e]);for(const s of e){if(typeof s!="string"||s.length!==1)throw new Error("Invalid command prefix. Must be string of length 1.");this.CommandPrefixes.push(i,s)}}removeTabCommandPrefix(e,i="ffz"){Array.isArray(e)||(e=[e]);for(const s of e)this.CommandPrefixes.remove(i,s)}addTokenizer(e){const i=e.type;if((0,r.has)(this.tokenizers,i)){this.log.warn(`Tried adding tokenizer of type '${i}' when one was already present.`);return}if(this.tokenizers[i]=e,e.priority==null&&(e.priority=0),e.tooltip){const s=e.tooltip,n=this.tooltips.types[i]=s.bind(this);for(const o of["interactive","delayShow","delayHide","onShow","onHide"])n[o]=typeof s[o]=="function"?s[o].bind(this):s[o]}this.__tokenizers.push(e),this.__tokenizers.sort((s,n)=>s.priority>n.priority?-1:s.priority<n.priority?1:s.type<n.type)}removeTokenizer(e){let i;if(typeof e=="string"?i=e:i=e.type,e=this.tokenizers[i],!e)return null;delete this.tokenizers[i],e.tooltip&&delete this.tooltips.types[i];const s=this.__tokenizers.indexOf(e);return s!==-1&&this.__tokenizers.splice(s,1),e}addLinkProvider(e){const i=e.type;if((0,r.has)(this.link_providers,i)){this.log.warn(`Tried adding link provider of type '${i}' when one was already present.`);return}this.link_providers[i]=e,e.priority==null&&(e.priority=0),this.__link_providers.push(e),this.__link_providers.sort((s,n)=>s.priority>n.priority?-1:s.priority<n.priority?1:s.type<n.type)}removeLinkProvider(e){let i;if(typeof e=="string"?i=e:i=e.type,e=this.link_providers[i],!e)return null;delete this.link_providers[i];const s=this.__link_providers.indexOf(e);return s!==-1&&this.__link_providers.splice(s,1),e}addRichProvider(e){const i=e.type;if((0,r.has)(this.rich_providers,i)){this.log.warn(`Tried adding rich provider of type '${i}' when one was already present.`);return}this.rich_providers[i]=e,e.priority==null&&(e.priority=0),this.__rich_providers.push(e),this.__rich_providers.sort((s,n)=>s.priority>n.priority?-1:s.priority<n.priority?1:s.type<n.type)}removeRichProvider(e){let i;if(typeof e=="string"?i=e:i=e.type,e=this.rich_providers[i],!e)return null;delete this.rich_providers[i];const s=this.__rich_providers.indexOf(e);return s!==-1&&this.__rich_providers.splice(s,1),e}tokenizeString(e,i,s,n=!1){let o=[{type:"text",text:e}];for(const h of this.__tokenizers){if(!h.process)continue;const _=h.process.call(this,o,i,s,n);if(_&&(o=_),n&&i.ffz_halt_tokens){i.ffz_halt_tokens=void 0;break}}return o}pluckLastEmote(e){if(!Array.isArray(e))return;let i=e.length;for(;i--;){const s=e[i];if(s.type==="emote"&&s.provider!=="emoji")return this.context.get("chat.emotes.allow-gigantify")?(s.gigantify=!0,s.hidden=!0,s):(s.gigantify&&(s.hidden=!1),null);if(s.hidden)continue}}pluckRichContent(e,i){if(!this.context.get("chat.rich.enabled")||this.context.get("chat.rich.minimum-level")>this.getUserLevel(i)||!Array.isArray(e))return;const s=this.__rich_providers,n=this.context.get("chat.rich.want-mid");for(const o of e)if(o.allow_rich??!0){for(const h of s)if(h.test.call(this,o,i))return o.hidden=h.can_hide_token&&(this.context.get("chat.rich.hide-tokens")||h.hide_token),h.process.call(this,o,n)}}tokenizeMessage(e,i,s=!1){if(e.content&&!e.message&&(e.message=e.content.text),e.sender&&!e.user&&(e.user=e.sender),!e.message)return[];let n=[{type:"text",text:e.message}];for(const o of this.__tokenizers){if(!o.process)continue;const h=o.process.call(this,n,e,i,s);if(h&&(n=h),s&&e.ffz_halt_tokens){e.ffz_halt_tokens=void 0;break}}return n||[]}renderGiantEmote(e,i){i||(i=se.createElement);const s=e.anim===1,n=e.anim===2;let o,h,_;if(e.provider==="twitch")o=(0,r.getTwitchEmoteURL)(e.id,4,s,!0),n&&(h=(0,r.getTwitchEmoteURL)(e.id,4,!0,!0)),_=112;else if(e.provider==="ffz"){const E=this.emotes.emote_sets[e.set],R=E?.emotes?.[e.id];if(R){let T=(s?R.animated:null)??R.urls,N=Vs(T);if(!N)return null;o=N[0],_=R.height*N[1],n&&R.animated&&(N=Vs(R.animated),N&&(h=N[0]))}}else o=null;return o?i("img",{className:`chat-image chat-line__message--emote ffz--pointer-events ffz-tooltip${h?" ffz-hover-emote":""}${e.provider==="twitch"?" twitch-emote":e.provider==="ffz"?" ffz-emote":e.provider==="emoji"?" ffz-emoji":""}`,src:o,height:`${_}px`,alt:e.text,"data-normal-src":o,"data-hover-src":h,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-code":e.code,"data-variant":e.variant,onClick:this.emotes.handleClick}):null}renderTokens(e,i,s){i||(i=se.createElement);const n=[],o=this.tokenizers,h=e.length,_=this.context.get("chat.filtering.hidden-tokens");for(let E=0;E<h;E++){const R=e[E],T=R.type,N=o[T];if(R.hidden||_.has(T))continue;let Y;s&&E===0&&T==="mention"&&R.recipient&&R.recipient===s.parentUserLogin||(T==="text"?Y=i("span",{className:"text-fragment","data-a-target":"chat-message-text"},R.text):N?Y=N.render.call(this,R,i,s):Y=i("em",{className:"ffz-unknown-token ffz-tooltip","data-tooltip-type":"json","data-data":JSON.stringify(R,null,2)},`[unknown token: ${T}]`),Y&&n.push(Y))}return n}clearLinkCache(e){if(e){const s=this._link_info[e];if(!s[0])for(const n of s[2])n[1]();this._link_info[e]=null,this.emit(":update-link-resolver",e);return}const i=this._link_info;this._link_info={};for(const s of Object.values(i))if(!s[0])for(const n of s[2])n[1]();this.emit(":update-link-resolver")}get_link_info(e,i,s=!1){let n=this._link_info[e];const o=n&&n[1];if((n&&n[0]&&s||o&&Date.now()>o)&&(n=this._link_info[e]=null),n&&n[0]){const h=this.handleLinkToS(n[2]);return i?h:Promise.resolve(h)}return i?null:n?new Promise((h,_)=>n[2].push([h,_])):new Promise((h,_)=>{n=this._link_info[e]=[!1,null,[[h,_]]];const E=B((T,N)=>{N=this.fixLinkInfo(N);const Y=!n[0]&&n[2];if(n[0]=!0,n[1]=Date.now()+12e4,n[2]=T?N:null,N=this.handleLinkToS(N),Y)for(const ce of Y)ce[T?0:1](N)},"handle");for(const T of this.__link_providers){const N=T.test.call(this,e);if(N){(0,r.timeout)(T.process.call(this,N),15e3).then(Y=>E(!0,Y)).catch(Y=>E(!1,Y));return}}let R=this.settings.get("debug.link-resolver.source").value;R==="special:socket"&&!this.socket&&(R=f.LINK_DATA_HOSTS.test.value),R==="special:socket"?(0,r.timeout)(this.socket.call("get_link",e),15e3).then(T=>E(!0,T)).catch(T=>E(!1,T)):(0,r.timeout)(fetch(`${R}?url=${encodeURIComponent(e)}`).then(T=>T.json()),15e3).then(T=>E(!0,T)).catch(T=>E(!1,T))})}handleLinkToS(e){if(!Array.isArray(e?.urls))return e;const i=this.settings.provider.get("agreed-tos",[]),s=this.settings.provider.get("declined-tos",[]),n=new Set(e.urls.map(o=>o.resolver).filter(o=>o));for(const[o,h]of Object.entries(f.RESOLVERS_REQUIRE_TOS))if(n.has(o)&&!i.includes(o)){const _=s.includes(o);return{...e,url:null,short:[{type:"box",content:[h.i18n_key?{type:"i18n",key:h.i18n_key,phrase:h.label}:h.label,_?null:" ",_?null:{type:"conditional",tooltip:!1,content:{type:"i18n",key:"embed.tos-open-settings",phrase:"{link} to open your settings.",content:{link:{type:"open_settings",item:"chat.tooltips",content:{type:"i18n",key:"embed.tos-open-settings.click",phrase:"Click here"}}}},alternative:{type:"i18n",key:"embed.tos-settings",phrase:"Open the FFZ Control Center and navigate to Chat > Tooltips to agree."}}]}],mid:null,full:null}}return e}agreeToTerms(e){const i=this.settings.provider.get("agreed-tos",[]);i.includes(e)||(this.settings.provider.set("agreed-tos",[...i,e]),this.emit(":update-link-resolver"))}declineTerms(e){const i=this.settings.provider.get("declined-tos",[]);i.includes(e)||(this.settings.provider.set("declined-tos",[...i,e]),this.emit(":update-link-resolver"))}hasAgreedToTerms(e){const i=this.settings.provider.get("agreed-tos");return i?i.includes(e):!1}hasDeclinedTerms(e){const i=this.settings.provider.get("declined-tos");return i?i.includes(e):!1}onProviderChange(e,i){e!=="agreed-tos"&&e!=="declined-tos"||this.emit(":update-link-resolver")}fixLinkInfo(e){if(!e)return e;if(e.error&&e.message&&(e.error=e.message),e.error&&(e={v:5,title:this.i18n.t("card.error","An error occurred."),description:e.error,short:{type:"header",image:{type:"image",url:ar},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:e.error},unsafe:e.unsafe,urls:e.urls}),e.v<5&&!e.short&&!e.full&&(e.title||e.desc_1||e.desc_2)){const i=e.preview||e.image;e={v:5,short:{type:"header",image:i?{type:"image",url:i,sfw:e.image_safe??!1}:null,title:e.title,subtitle:e.desc_1,extra:e.desc_2}}}return e}};B(Ms,"chat_Chat");let ns=Ms;function Vs(k){return k?.[4]?[k[4],4]:k?.[3]?[k[3],3]:k?.[2]?[k[2],2]:k?.[1]?[k[1],1]:null}B(Vs,"getBiggestImage");var Zs=Q(94417),cr=Q(96883),hr=Q.n(cr);function ur(k){return k==="SUBSCRIPTIONS"?f.EmoteTypes.Subscription:k==="FOLLOWER"?f.EmoteTypes.Follower:k==="GLOBALS"||k==="SMILIES"?f.EmoteTypes.Global:k==="LIMITED_TIME"||k==="MEGA_COMMERCE"?f.EmoteTypes.LimitedTime:k==="BITS_BADGE_TIERS"?f.EmoteTypes.BitsTier:k==="CHANNEL_POINTS"?f.EmoteTypes.ChannelPoints:k==="TWO_FACTOR"?f.EmoteTypes.TwoFactor:k==="PRIME"?f.EmoteTypes.Prime:k==="TURBO"?f.EmoteTypes.Turbo:f.EmoteTypes.Unknown}B(ur,"getEmoteTypeFromTwitchType");function rs(k){return k==="1000"||k==="prime"?1:k==="2000"?2:k==="3000"?3:1}B(rs,"tierToNumber");const Ps=class Ps extends d.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("chat"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.apollo"),this.inject("site.twitch_data"),this.vue=this.resolve("vue"),this.open_cards={},this.last_card=null}onEnable(){this.on("chat.emotes:click",this.handleClick,this)}handleClick(e){this.chat.context.get("chat.emote-dialogs")&&(e.preventDefault(),this.openCard({provider:e.provider,code:e.code,variant:e.variant,name:e.name,set:e.set,id:e.id??`${e.code}::${e.variant}`},e.modifiers,e.source))}async loadVue(){if(this._vue_loaded)return;await this.vue.enable();const e=await Q.e(6115).then(Q.bind(Q,81414));this.vue.component("emote-card",e.default),this._vue_loaded=!0}canReportTwitch(){const e=this.resolve("site"),i=e.getUser(),s=this.resolve("site.web_munch");let n;try{n=s.getModule("user-report")}catch{return!1}return!!n&&!!i?.id&&e?.store?.dispatch}reportTwitchEmote(e,i){const s=this.resolve("site"),n=s.getUser(),o=this.resolve("site.web_munch");let h;try{h=o.getModule("user-report")}catch{return!1}return!n?.id||!s?.store?.dispatch?!1:(s.store.dispatch({type:"core.modal.MODAL_SHOWN",modalComponent:h,modalProps:{reportContext:{contentID:String(e),contentMetadata:{channelID:String(n.id)},contentType:"EMOTE_REPORT",targetUserID:String(i),trackingContext:"emote_card"}}}),!0)}async loadData(e){if(e.provider==="twitch"){const o=this.resolve("site.apollo");if(!o)throw new Error("Unable to load emote data");const h=await o.client.query({query:hr(),variables:{emoteID:e.id}});if(!h?.data?.emote)throw new Error("Unable to load emote data");const _=h.data.emote,E=(0,r.getTwitchEmoteURL)(_.id,2,!0,!0),R=`${E} 1x, ${(0,r.getTwitchEmoteURL)(_.id,4,!0,!0)} 2x`;let T,N,Y,ce=ur(_.type),me;try{me=parseInt(_.setID,10)}catch{}if(f.TWITCH_GLOBAL_SETS.includes(me)?ce=f.EmoteTypes.Global:f.TWITCH_POINTS_SETS.includes(me)?ce=f.EmoteTypes.ChannelPoints:f.TWITCH_PRIME_SETS.includes(me)&&(ce=f.EmoteTypes.Prime),ce===f.EmoteTypes.Subscription){const Ae=_.owner?.subscriptionProducts;if(Array.isArray(Ae)){for(const Fe of Ae)if(Fe.emotes.some(ve=>ve.id===_.id)){Y=rs(Fe.tier);break}}T=this.i18n.t("emote-card.sub","Tier {tier} Sub Emote ({source})",{tier:Y,source:_.owner?.displayName||_.owner?.login}),N="twitch"}else ce===f.EmoteTypes.Follower?(T=this.i18n.t("emote.follower","Follower Emote ({source})",{source:_.owner.displayName||_.owner.login}),N="twitch"):ce===f.EmoteTypes.Global?T=this.i18n.t("emote.global","Twitch Global"):ce===f.EmoteTypes.LimitedTime?T=this.i18n.t("emote.limited","Limited-Time Only Emote"):ce===f.EmoteTypes.BitsTier?(T=this.i18n.t("emote-card.bits","{amount,number} Bits Reward ({source})",{amount:_.bitsBadgeTierSummary?.threshold,source:_.owner.displayName||_.owner.login}),N="twitch"):ce===f.EmoteTypes.TwoFactor?T=this.i18n.t("emote.2fa","Twitch 2FA Emote"):ce===f.EmoteTypes.ChannelPoints?(T=this.i18n.t("emote.points","Channel Points Emote"),N="twitch"):ce===f.EmoteTypes.Prime||ce===f.EmoteTypes.Turbo?T=this.i18n.t("emote.prime","Prime Gaming"):T=_.type;const pe={id:_.id,fav_source:"twitch",channel_id:_.owner?.id,more:[],body:N,src:E,srcSet:R,name:_.token,source:T,artist:_.artist?_.artist.displayName||_.artist.login:null,artistLink:_.artist?`https://www.twitch.tv/${_.artist.login}`:null};if(_.owner?.id&&(pe.channel_title=_.owner.displayName??_.owner.login,pe.channel_login=_.owner.login,pe.channel_live=!!_.owner.stream?.id,pe.channel_followed=!!_.owner?.self?.follower?.followedAt,pe.more.push({type:"link",icon:"ffz-i-link-ext",title:"View Channel on TwitchEmotes.com",href:`https://twitchemotes.com/channels/${_.owner.id}`}),this.canReportTwitch()&&pe.more.push({type:"report-twitch",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),_.bitsBadgeTierSummary?.threshold)pe.unlock_mode="bits",pe.unlocked=_.bitsBadgeTierSummary.self?.isUnlocked,pe.bits_amount=_.bitsBadgeTierSummary.threshold,pe.bits_remain=_.bitsBadgeTierSummary.self?.numberOfBitsUntilUnlock??pe.unlock_amount;else if(ce===f.EmoteTypes.Follower){pe.unlock_mode="follow",pe.unlocked=!1;const Ae=pe.extra_emotes=[];if(!pe.unlocked&&Array.isArray(_.owner?.channel?.localEmoteSets)){for(const Fe of _.owner.channel.localEmoteSets)if(Array.isArray(Fe.emotes))for(const ve of Fe.emotes){const Le=(0,r.getTwitchEmoteURL)(ve.id,1,!0,!0),Ee=`${Le} 1x, ${(0,r.getTwitchEmoteURL)(ve.id,2,!0,!0)} 2x`;Ae.push({id:ve.id,name:ve.token,src:Le,srcSet:Ee})}}}else if(ce===f.EmoteTypes.Subscription){pe.unlock_mode="subscribe",pe.unlocked=!1,pe.unlock_tier=Y,pe.existing_tier=0;const Ae=_.owner?.self?.subscriptionBenefit;Ae?.tier&&(pe.existing_tier=rs(Ae.tier));const Fe=pe.extra_emotes=[],ve=pe.existing_tier;if(ve>=Y)pe.unlocked=!0;else if(Array.isArray(_.owner?.subscriptionProducts))for(const Le of _.owner.subscriptionProducts){const Ee=rs(Le.tier);if(Ee===Y&&(pe.channel_product=Le.name,Le.priceInfo?.price&&Le.priceInfo.currency)){const je=new Intl.NumberFormat(navigator.languages,{style:"currency",currency:Le.priceInfo.currency});pe.product_price=je.format(Le.priceInfo.price/100)}if(Ee>ve&&Ee<=Y&&Array.isArray(Le.emotes))for(const je of Le.emotes){const Ue=(0,r.getTwitchEmoteURL)(je.id,1,!0,!0),Je=`${Ue} 1x, ${(0,r.getTwitchEmoteURL)(je.id,2,!0,!0)} 2x`;Fe.push({id:je.id,name:je.token,src:Ue,srcSet:Je})}}}return pe}if(e.provider==="emoji"){const o=this.emoji.emoji[e.code],h=this.chat.context.get("chat.emoji.style"),_=e.variant?o.variants[e.variant]:o,E=e.variant?this.emoji.emoji[e.variant]:null,R=o.category?this.i18n.t(`emoji.category.${o.category.toSnakeCase()}`,this.emoji.categories[o.category]||o.category):null;return{id:e.code,fav_source:"emoji",more:[],src:this.emoji.getFullImage(_.image,h),srcSet:this.emoji.getFullImageSet(_.image,h),width:18,height:18,name:`:${o.names[0]}:${E?`:${E.names[0]}:`:""}`,source:this.i18n.t("tooltip.emoji","Emoji - {category}",{category:R})}}if(e.provider!=="ffz")throw new Error("Invalid provider");const i=this.emotes.emote_sets[e.set],s=i?i.emotes?.[e.id]||i.disabled_emotes?.[e.id]:null;if(!s)throw new Error("Unable to load emote data");const n={id:s.id,fav_source:i.source??"ffz",more:[],src:s.animSrc2??s.src2,srcSet:s.animSrcSet2??s.srcSet2,width:s.width,height:s.height,name:s.name,originalName:s.original_name,source:i.source_line||`${i.source||"FFZ"} ${i.title||"Global Emotes"}`,owner:s.owner?s.owner.display_name||s.owner.name:null,ownerLink:s.owner&&!i.source?`https://www.frankerfacez.com/${s.owner.name}`:null,artist:s.artist?s.artist.display_name||s.artist.name:null,artistLink:s.artist&&!i.source?`https://www.frankerfacez.com/${s.artist.name}`:null};return i.source?s.click_url&&n.more.push({type:"link",title_i18n:"emote-card.view-external",title:"View on {source}",source:i.source,href:s.click_url}):(s.public&&(n.body="manage-ffz"),n.more.push({type:"link",title_i18n:"emote-card.view-on-ffz",title:"View on FrankerFaceZ",href:`https://www.frankerfacez.com/emoticon/${s.id}-`}),n.more.push({type:"report-ffz",title_i18n:"emote-card.report",title:"Report Emote",icon:"ffz-i-flag"})),n}async openCard(e,i,s){const n=`${e.provider}::${e.id}::${i??""}`,o=this.open_cards[n];if(o){o.$el.style.zIndex=(0,Zs.getDialogNextZ)(),o.focus();return}let h=s?s.clientX:window.innerWidth/2,_=s?s.clientY+15:window.innerHeight/2;if(this.last_card){const R=this.last_card;s||(h=R.$el.offsetLeft,_=R.$el.offsetTop),R.close()}const E=this.loadData(e);await this.loadVue(),this.last_card=this.open_cards[n]=this.buildCard(h,_,e,i,E)}buildCard(e,i,s,n,o){let h;const _=new this.vue.Vue({el:(0,se.createElement)("div"),render:T=>T("emote-card",{props:{raw_emote:(0,r.deep_copy)(s),raw_modifiers:n,data:o,getFFZ:()=>this,reportTwitchEmote:(...N)=>this.reportTwitchEmote(...N),getZ:Zs.getDialogNextZ},on:{emit:(N,...Y)=>this.emit(N,...Y),close:()=>{_.$el.remove(),_.$destroy(),this.last_card===h&&(this.last_card=null);const Y=`${s.provider}::${s.id}::${n??""}`;this.open_cards[Y]===h&&(this.open_cards[Y]=null),this.emit("tooltips:cleanup")},pin:()=>{this.last_card===h&&(this.last_card=null)}}})});h=_.$children[0];const E=_.$el;return E.style.left=`${e}px`,E.style.top=`${i}px`,document.querySelector(this.site.constructor.DIALOG_SELECTOR??"#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height").appendChild(E),requestAnimationFrame(()=>h.constrain()),h}};B(Ps,"EmoteCard");let os=Ps;const Di=class Di extends d.default{constructor(){super();const e=performance.now();Di.instance=this,this.host="twitch",this.flavor="clips",this.name="ffz_clips",this.__state=0,this.__modules.core=this,this.log=new c.default(null,null,null),this.log.label="FFZClips",this.log.init=!0,this.core_log=this.log.get("core"),this.log.hi(this),this.inject("settings",X),this.inject("experiments",Lt),this.inject("i18n",Jt),this.inject("staging",lt),this.inject("load_tracker",gt),this.inject("pubsub",et),this.inject("site",ii),this.inject("addons",Ne),this.register("vue",Bi),this.inject("tooltips",di),this.register("chat",ns),this.register("emote_card",os),this.enable().then(()=>this.enableInitialModules()).then(()=>{const i=performance.now()-e;this.core_log.info(`Initialization complete in ${i.toFixed(5)}ms.`),this.log.init=!1}).catch(i=>{this.core_log.error("An error occurred during initialization.",i),this.log.init=!1})}static get(){return Di.instance}async enableInitialModules(){const e=[];for(const i in this.__modules){const s=this.__modules[i];s instanceof d.default&&s.should_enable&&e.push(s.enable())}await Promise.all(e)}async generateLog(){const e=[];for(const s in this.__modules){const n=this.__modules[s];n instanceof d.default&&n.generateLog&&n!=this&&e.push((async()=>{try{return[s,await(0,r.timeout)(Promise.resolve(n.generateLog()),5e3)]}catch(o){return[s,`Error: ${o}`]}})())}const i=await Promise.all(e);if(this.log.captured_init&&this.log.captured_init.length>0){const s=[];for(const n of this.log.captured_init){const o=b()(n.time).locale("en").format("H:mm:ss");s.push(`[${o}] ${n.level} | ${n.category||"core"}: ${n.message}`)}i.unshift(["initialization",s.join(`
`)])}return i.map(s=>`${s[0]}
-------------------------------------------------------------------------------
${typeof s[1]=="string"?s[1]:JSON.stringify(s[1],null,4)}`).join(`

`)}};B(Di,"FrankerFaceZ");let fi=Di;fi.Logger=c.default;const vi=fi.version_info=Object.freeze({major:4,minor:77,revision:4,extra:Ks?.length&&Ks[0],commit:"b250075813ef4902b5a303fc7290d6429703feef",build:"0",hash:Q.h(),toString:()=>`${vi.major}.${vi.minor}.${vi.revision}${vi.build?`.${vi.build}`:""}${vi.extra||""}${f.DEBUG?"-dev":""}`});fi.utilities={addon:Q(5227),blobs:Q(38626),color:Q(14873),constants:Q(24431),dom:Q(44589),events:Q(17159),logging:Q(55467),module:Q(22527),object:Q(46949),time:Q(83269),tooltip:Q(8528),i18n:Q(2356),dayjs:Q(51722),popper:Q(16572)},window.FrankerFaceZ=fi,window.ffz=new fi})()})();})();

//# sourceMappingURL=clips.js.map