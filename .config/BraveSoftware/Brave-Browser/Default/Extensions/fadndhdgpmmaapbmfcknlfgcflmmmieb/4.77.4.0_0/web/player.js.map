{"version":3,"file":"player.js","mappings":"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AAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,CACD,EACA,aAAc,CACb,KACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,aAAc,CACb,IACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,UAAW,CACV,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,gBAAiB,CAChB,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,IACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,IACA,IACD,EACA,aAAc,CACb,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,cAAe,CACd,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,eAAgB,CACf,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,WAAY,CACX,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,WAAY,CACX,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,WAAY,CACX,MACA,IACD,EACA,gBAAiB,CAChB,MACA,IACD,EACA,WAAY,CACX,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,eAAgB,CACf,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,GACD,EACA,gBAAiB,CAChB,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,KACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,CACD,EACA,SAASi8B,EAAoBn+B,EAAK,CACjC,GAAG,CAACo+B,EAAoB,EAAEl8B,EAAKlC,CAAG,EACjC,OAAO,QAAQ,QAAQ,EAAE,KAAK,IAAM,CACnC,IAAIub,EAAI,IAAI,MAAM,uBAAyBvb,EAAM,GAAG,EACpD,MAAAub,EAAE,KAAO,mBACHA,CACP,CAAC,EAGF,IAAI8iB,EAAMn8B,EAAIlC,CAAG,EAAGJ,EAAKy+B,EAAI,CAAC,EAC9B,OAAOD,EAAoB,EAAEC,EAAI,CAAC,CAAC,EAAE,KAAK,IAClCD,EAAoB,EAAEx+B,EAAI,EAAM,CACvC,CACF,CAbS,EAAAu+B,EAAA,uBAcTA,EAAoB,KAAO,IAAO,OAAO,KAAKj8B,CAAG,EACjDi8B,EAAoB,GAAK,MACzBtgC,EAAO,QAAUsgC,C,kBCtkBjB,IAAIj8B,EAAM,CACT,0BAA2B,MAC3B,4BAA6B,KAC7B,2BAA4B,MAC5B,iCAAkC,MAClC,uBAAwB,KACzB,EAGA,SAASi8B,EAAoBn+B,EAAK,CACjC,OAAOs+B,EAA2Bt+B,CAAG,EAAE,KAAKo+B,CAAmB,CAChE,CAFS,EAAAD,EAAA,uBAGT,SAASG,EAA2Bt+B,EAAK,CACxC,OAAOo+B,EAAoB,EAA0B,IAAI,EAAE,KAAK,IAAM,CACrE,GAAG,CAACA,EAAoB,EAAEl8B,EAAKlC,CAAG,EAAG,CACpC,IAAIub,EAAI,IAAI,MAAM,uBAAyBvb,EAAM,GAAG,EACpD,MAAAub,EAAE,KAAO,mBACHA,CACP,CACA,OAAOrZ,EAAIlC,CAAG,CACf,CAAC,CACF,CATS,EAAAs+B,EAAA,8BAUTH,EAAoB,KAAO,IAAO,OAAO,KAAKj8B,CAAG,EACjDi8B,EAAoB,QAAUG,EAC9BH,EAAoB,GAAK,MACzBtgC,EAAO,QAAUsgC,C,+ECxBbI,GAA2B,CAAC,EAGhC,SAASH,EAAoBI,EAAU,CAEtC,IAAIC,EAAeF,GAAyBC,CAAQ,EACpD,GAAIC,IAAiB,OACpB,OAAOA,EAAa,QAGrB,IAAI5gC,EAAS0gC,GAAyBC,CAAQ,EAAI,CAGjD,QAAS,CAAC,CACX,EAGA,OAAAE,GAAoBF,CAAQ,EAAE,KAAK3gC,EAAO,QAASA,EAAQA,EAAO,QAASugC,CAAmB,EAGvFvgC,EAAO,OACf,CAlBS,EAAAugC,EAAA,uBAqBTA,EAAoB,EAAIM,GCxBxBN,EAAoB,EAAKvgC,GAAW,CACnC,IAAI8gC,EAAS9gC,GAAUA,EAAO,WAC7B,IAAOA,EAAO,QACd,IAAOA,EACR,OAAAugC,EAAoB,EAAEO,EAAQ,CAAE,EAAGA,CAAO,CAAC,EACpCA,CACR,G,KCPA,IAAIC,EAAW,OAAO,eAAkB3mB,GAAS,OAAO,eAAeA,CAAG,EAAMA,GAASA,EAAI,UACzF4mB,EAOJT,EAAoB,EAAI,SAASr0B,EAAO+0B,EAAM,CAG7C,GAFGA,EAAO,IAAG/0B,EAAQ,KAAKA,CAAK,GAC5B+0B,EAAO,GACP,OAAO/0B,GAAU,UAAYA,IAC3B+0B,EAAO,GAAM/0B,EAAM,YACnB+0B,EAAO,IAAO,OAAO/0B,EAAM,MAAS,YAAY,OAAOA,EAE5D,IAAIg1B,EAAK,OAAO,OAAO,IAAI,EAC3BX,EAAoB,EAAEW,CAAE,EACxB,IAAIC,EAAM,CAAC,EACXH,EAAiBA,GAAkB,CAAC,KAAMD,EAAS,CAAC,CAAC,EAAGA,EAAS,CAAC,CAAC,EAAGA,EAASA,CAAQ,CAAC,EACxF,QAAQx7B,EAAU07B,EAAO,GAAK/0B,EAAO,OAAO3G,GAAW,UAAY,CAAC,CAACy7B,EAAe,QAAQz7B,CAAO,EAAGA,EAAUw7B,EAASx7B,CAAO,EAC/H,OAAO,oBAAoBA,CAAO,EAAE,QAASpF,GAASghC,EAAIhhC,CAAG,EAAI,IAAO+L,EAAM/L,CAAG,CAAG,EAErF,OAAAghC,EAAI,QAAa,IAAOj1B,EACxBq0B,EAAoB,EAAEW,EAAIC,CAAG,EACtBD,CACR,C,KCxBAX,EAAoB,EAAI,CAACxgC,EAASqhC,IAAe,CAChD,QAAQjhC,KAAOihC,EACXb,EAAoB,EAAEa,EAAYjhC,CAAG,GAAK,CAACogC,EAAoB,EAAExgC,EAASI,CAAG,GAC/E,OAAO,eAAeJ,EAASI,EAAK,CAAE,WAAY,GAAM,IAAKihC,EAAWjhC,CAAG,CAAE,CAAC,CAGjF,ECPAogC,EAAoB,EAAI,CAAC,EAGzBA,EAAoB,EAAKc,GACjB,QAAQ,IAAI,OAAO,KAAKd,EAAoB,CAAC,EAAE,OAAO,CAAC/P,EAAUrwB,KACvEogC,EAAoB,EAAEpgC,CAAG,EAAEkhC,EAAS7Q,CAAQ,EACrCA,GACL,CAAC,CAAC,CAAC,ECNP+P,EAAoB,EAAKc,GAEjB,IAAM,CAAC,EAAI,UAAU,IAAM,UAAU,IAAM,UAAU,IAAM,WAAW,IAAM,cAAc,IAAM,UAAU,IAAM,WAAW,IAAM,UAAU,IAAM,UAAU,IAAM,UAAU,IAAM,UAAU,IAAM,SAAS,IAAM,UAAU,IAAM,SAAS,IAAM,MAAM,KAAO,SAAS,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,SAAS,KAAO,UAAU,KAAO,WAAW,KAAO,iBAAiB,KAAO,WAAW,KAAO,WAAW,KAAO,YAAY,KAAO,UAAU,KAAO,WAAW,KAAO,OAAO,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,kBAAkB,KAAO,WAAW,KAAO,QAAQ,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,SAAS,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,SAAS,KAAO,UAAU,KAAO,SAAS,KAAO,SAAS,KAAO,WAAW,KAAO,WAAW,KAAO,SAAS,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,WAAW,KAAO,WAAW,KAAO,QAAQ,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,SAAS,KAAO,WAAW,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,WAAW,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,UAAU,KAAO,U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","sources":["webpack://frankerfacez/<define:__version_prerelease__>","webpack://frankerfacez/./node_modules/.pnpm/@ffz+icu-msgparser@2.0.0/node_modules/@ffz/icu-msgparser/lib/parser.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getHTMLElementScroll.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getNodeScroll.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getCompositeRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/orderModifiers.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/debounce.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/mergeByName.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/createPopper.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/contains.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getBoundingClientRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getComputedStyle.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getDocumentElement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getLayoutRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getNodeName.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/isTableElement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getOffsetParent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getParentNode.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getWindow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getWindowScroll.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getWindowScrollBarX.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/instanceOf.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/isLayoutViewport.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/isScrollParent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getScrollParent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/listScrollParents.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/enums.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/popper-lite.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/applyStyles.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/arrow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/computeStyles.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/eventListeners.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getOppositePlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getOppositeVariationPlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/computeAutoPlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/flip.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/hide.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/offset.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/popperOffsets.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getAltAxis.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/preventOverflow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/popper.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/computeOffsets.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getViewportRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getDocumentRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/rectToClientRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getClippingRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/detectOverflow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/expandToHashMap.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getBasePlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getFreshSideObject.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getMainAxisFromPlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getVariation.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/math.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/mergePaddingObject.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/userAgent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/within.js","webpack://frankerfacez/./node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/core.js","webpack://frankerfacez/./node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha1.js","webpack://frankerfacez/./node_modules/.pnpm/dayjs@1.10.7/node_modules/dayjs/dayjs.min.js","webpack://frankerfacez/./node_modules/.pnpm/dayjs@1.10.7/node_modules/dayjs/plugin/relativeTime.js","webpack://frankerfacez/./src/sites/base.js","webpack://frankerfacez/./src/sites/shared/player.jsx","webpack://frankerfacez/./src/utilities/markdown.js","webpack://frankerfacez/./src/settings/profile.ts","webpack://frankerfacez/./src/utilities/addon.ts","webpack://frankerfacez/./src/utilities/blobs.ts","webpack://frankerfacez/./src/utilities/compat/fine.ts","webpack://frankerfacez/./src/utilities/constants.ts","webpack://frankerfacez/./src/utilities/dom.ts","webpack://frankerfacez/./src/utilities/events.ts","webpack://frankerfacez/./src/utilities/filtering.ts","webpack://frankerfacez/./styles/opendyslexic.scss","webpack://frankerfacez/./src/utilities/fonts.ts","webpack://frankerfacez/./src/utilities/logging.ts","webpack://frankerfacez/./src/utilities/module.ts","webpack://frankerfacez/./src/utilities/object.ts","webpack://frankerfacez/./src/utilities/path-parser.ts","webpack://frankerfacez/./src/utilities/time.ts","webpack://frankerfacez/./src/utilities/tooltip.ts","webpack://frankerfacez/./src/utilities/translation-core.ts","webpack://frankerfacez/./node_modules/dayjs/locale/ lazy ^\\.\\/.*\\.js$ chunkName: i18n-[index] namespace object","webpack://frankerfacez/./src/sites/player/css_tweaks/ ","webpack://frankerfacez/webpack/bootstrap","webpack://frankerfacez/webpack/runtime/compat get default export","webpack://frankerfacez/webpack/runtime/create fake namespace object","webpack://frankerfacez/webpack/runtime/define property getters","webpack://frankerfacez/webpack/runtime/ensure chunk","webpack://frankerfacez/webpack/runtime/get javascript chunk filename","webpack://frankerfacez/webpack/runtime/getFullHash","webpack://frankerfacez/webpack/runtime/global","webpack://frankerfacez/webpack/runtime/hasOwnProperty shorthand","webpack://frankerfacez/webpack/runtime/load script","webpack://frankerfacez/webpack/runtime/make namespace object","webpack://frankerfacez/webpack/runtime/runtimeId","webpack://frankerfacez/webpack/runtime/publicPath","webpack://frankerfacez/webpack/runtime/jsonp chunk loading","webpack://frankerfacez/./src/settings/typehandlers.ts","webpack://frankerfacez/./src/settings/context.ts","webpack://frankerfacez/./src/settings/processors.ts","webpack://frankerfacez/./src/settings/validators.ts","webpack://frankerfacez/./src/settings/filters.ts","webpack://frankerfacez/./src/settings/providers.ts","webpack://frankerfacez/./src/settings/clearables.ts","webpack://frankerfacez/./src/settings/index.ts","webpack://frankerfacez/./src/addons.ts","webpack://frankerfacez/./node_modules/.pnpm/js-cookie@3.0.5/node_modules/js-cookie/dist/js.cookie.mjs","webpack://frankerfacez/./src/experiments.ts","webpack://frankerfacez/./src/i18n.js","webpack://frankerfacez/./src/staging.tsx","webpack://frankerfacez/./src/pubsub/client.ts","webpack://frankerfacez/./src/pubsub/index.ts","webpack://frankerfacez/./src/load_tracker.ts","webpack://frankerfacez/./src/sites/player/metadata.jsx","webpack://frankerfacez/./src/sites/player/player.jsx","webpack://frankerfacez/./src/utilities/css-tweaks.ts","webpack://frankerfacez/./src/modules/tooltips.ts","webpack://frankerfacez/./src/sites/player/styles/player-main.scss","webpack://frankerfacez/./src/sites/player/index.jsx","webpack://frankerfacez/./src/player.js"],"sourcesContent":[null,"'use strict';\n\nconst SPACE = /\\s/,\n\tSYMBOLS = {\n\t\tOPEN: '{',\n\t\tCLOSE: '}',\n\t\tTAG_OPEN: '<',\n\t\tTAG_CLOSE: '>',\n\t\tTAG_CLOSING: '/',\n\t\tSEP: ',',\n\t\tSUB_VAR: '#',\n\t\tESCAPE: \"'\"\n\t},\n\tSUBNUM = 'subnumeric_types',\n\tSUBMSG = 'submessage_types',\n\tKEYS = Object.keys(SYMBOLS),\n\tCLOSE_TAG = Symbol('C');\n\nconst Parser = exports = module.exports = function Parser(options) {\n\t\tif ( ! (this instanceof Parser) )\n\t\t\treturn new Parser(options);\n\n\t\tthis.opts = Object.assign({\n\t\t\tOFFSET: 'offset:',\n\t\t\t[SUBNUM]: ['plural', 'selectordinal'],\n\t\t\t[SUBMSG]: ['plural', 'selectordinal', 'select'],\n\t\t\tallowTags: true,\n\t\t\trequireOther: true\n\t\t}, SYMBOLS, options);\n\n\t\tfor(let i=0; i < KEYS.length; i++) {\n\t\t\tconst key = KEYS[i],\n\t\t\t\tval = this.opts[key];\n\t\t\tif ( typeof val !== 'string' || val.length !== 1 )\n\t\t\t\tthrow new Error(`Option ${key} must be a 1-length string`);\n\t\t\tfor(let j=i+1; j < KEYS.length; j++) {\n\t\t\t\tconst k2 = KEYS[j];\n\t\t\t\tif ( this.opts[k2] === val )\n\t\t\t\t\tthrow new Error(`Option ${key} and ${k2} cannot match`);\n\t\t\t}\n\t\t}\n\t},\n\tp = Parser.prototype;\n\np.parse = function(msg) {\n\treturn this.parseAST({msg: String(msg), i: 0}, null);\n}\n\np.parseAST = function(context, parent) {\n\tconst msg = context.msg,\n\t\topts = this.opts,\n\t\tlength = msg.length,\n\t\tspecial_hash = parent && opts[SUBNUM].includes(parent.t),\n\t\tout = [];\n\n\twhile ( context.i < length ) {\n\t\tconst start = context.i,\n\t\t\tchar = msg[start];\n\n\t\tif ( char === opts.CLOSE ) {\n\t\t\tif ( ! parent ) {\n\t\t\t\tmergePush(out, '}')\n\t\t\t\tcontext.i++;\n\t\t\t} else\n\t\t\t\tbreak;\n\n\t\t} else if ( char === opts.OPEN || (special_hash && char === opts.SUB_VAR) ) {\n\t\t\tmergePush(out, this.parseElement(context, parent));\n\n\t\t} else if ( opts.allowTags && char === opts.TAG_OPEN && ! SPACE.test(msg[start+1]) ) {\n\t\t\tconst element = this.parseTag(context, parent);\n\t\t\tif ( element === CLOSE_TAG ) {\n\t\t\t\tparent.closed = true;\n\t\t\t\tbreak;\n\t\t\t} else\n\t\t\t\tmergePush(out, element);\n\n\t\t} else\n\t\t\tmergePush(out, this.parseText(context, parent));\n\n\t\t// Infinite Loop Protection\n\t\t// This should never be triggered.\n\t\t/* istanbul ignore if */\n\t\tif ( context.i === start )\n\t\t\tthrow unexpected(char, context.i);\n\t}\n\n\treturn out;\n}\n\np.parseText = function(context, parent, include_separator = true, include_space = true, include_tags = false) {\n\tconst msg = context.msg,\n\t\topts = this.opts,\n\t\ttags = opts.allowTags,\n\t\tlength = msg.length,\n\t\tspecial_hash = parent && opts[SUBNUM].includes(parent.t);\n\n\tlet out = '';\n\n\twhile ( context.i < length ) {\n\t\tconst char = msg[context.i];\n\t\tif ( char === opts.OPEN ||\n\t\t\t\tchar === opts.CLOSE ||\n\t\t\t\t(tags && (char === opts.TAG_OPEN || (include_tags && (char === opts.TAG_CLOSE || char === opts.TAG_CLOSING)))) ||\n\t\t\t\t(!include_separator && char === opts.SEP) ||\n\t\t\t\t(!include_space && SPACE.test(char)) ||\n\t\t\t\t(special_hash && char === opts.SUB_VAR) )\n\t\t\tbreak;\n\n\t\tif ( char === opts.ESCAPE ) {\n\t\t\tlet next = msg[++context.i];\n\t\t\tif ( next === opts.ESCAPE ) {\n\t\t\t\t// Escaped Escape Character\n\t\t\t\tout += next;\n\t\t\t\tcontext.i++;\n\t\t\t} else if (\n\t\t\t\tnext === opts.OPEN ||\n\t\t\t\tnext === opts.CLOSE ||\n\t\t\t\t(tags && (next === opts.TAG_OPEN || (include_tags && (next === opts.TAG_CLOSE || next === opts.TAG_CLOSING)))) ||\n\t\t\t\t(special_hash && next === opts.SUB_VAR) ||\n\t\t\t\t! include_space || ! include_separator\n\t\t\t) {\n\t\t\t\t// Special Character\n\t\t\t\t// Tags are only special when they're enabled.\n\t\t\t\t// Tag endings are only special inside open tags.\n\t\t\t\t// SUB_VAR is only special inside submessages.\n\t\t\t\t// Spaces and separators are only special inside placeholders.\n\t\t\t\tout += next;\n\t\t\t\twhile( ++context.i < length ) {\n\t\t\t\t\tnext = msg[context.i];\n\t\t\t\t\tif ( next === opts.ESCAPE ) {\n\t\t\t\t\t\t// Check for an escaped escape character, and don't\n\t\t\t\t\t\t// stop if we encounter one.\n\t\t\t\t\t\tnext = msg[context.i + 1];\n\t\t\t\t\t\tif ( next === opts.ESCAPE ) {\n\t\t\t\t\t\t\tout += next;\n\t\t\t\t\t\t\tcontext.i++;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontext.i++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else\n\t\t\t\t\t\tout += next;\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tout += char;\n\n\t\t} else {\n\t\t\tcontext.i++;\n\t\t\tout += char;\n\t\t}\n\t}\n\n\treturn out;\n}\n\np.parseTag = function(context, parent) {\n\tconst msg = context.msg,\n\t\tstart = context.i,\n\t\topts = this.opts;\n\n\tcontext.i++;\n\tlet char = msg[context.i];\n\n\t// Closing Tag?\n\tlet closing = false;\n\tif ( char === opts.TAG_CLOSING ) {\n\t\tif ( ! parent || ! parent.n )\n\t\t\tthrow unexpected(char, context.i);\n\t\tclosing = true;\n\t\tcontext.i++;\n\t\tskipSpace(context);\n\t}\n\n\t// Name\n\tconst name = this.parseText(context, null, false, false, true);\n\tif ( ! name )\n\t\treturn msg.slice(start, context.i);\n\n\tskipSpace(context);\n\tchar = msg[context.i];\n\n\tif ( closing ) {\n\t\tif ( char !== opts.TAG_CLOSE )\n\t\t\tthrow expected(opts.TAG_CLOSE, char, context.i);\n\n\t\tif ( name !== parent.n )\n\t\t\tthrow unexpected('tag mismatch', start);\n\n\t\tcontext.i++;\n\t\treturn CLOSE_TAG;\n\t}\n\n\tclosing = false;\n\tif ( char === opts.TAG_CLOSING ) {\n\t\tclosing = true;\n\t\tcontext.i++;\n\t\tchar = msg[context.i];\n\t}\n\n\tif ( char !== opts.TAG_CLOSE )\n\t\t// So long and thanks for all the fish.\n\t\treturn msg.slice(start, context.i);\n\n\tcontext.i++;\n\n\tconst tag = {\n\t\tn: name\n\t};\n\n\tif ( closing )\n\t\treturn tag;\n\n\tconst contents = this.parseAST(context, tag);\n\tif ( contents && contents.length )\n\t\ttag.c = contents;\n\n\tif ( ! tag.closed && context.i >= msg.length )\n\t\tthrow expected('closing tag', context);\n\n\tdelete tag.closed;\n\treturn tag;\n}\n\np.parseElement = function(context, parent) {\n\tconst msg = context.msg,\n\t\topts = this.opts,\n\t\tspecial_hash = parent && opts[SUBNUM].includes(parent.t);\n\n\tlet char = msg[context.i];\n\n\tif ( special_hash && char === opts.SUB_VAR ) {\n\t\tcontext.i++;\n\t\treturn {v: parent.v, t: 'number'}\n\t}\n\n\tcontext.i++;\n\tskipSpace(context);\n\n\t// ID\n\tconst id = this.parseText(context, null, false, false);\n\tif ( ! id )\n\t\tthrow expected('placeholder id', char, context.i);\n\n\tconst out = {v: id};\n\n\tskipSpace(context);\n\n\tchar = msg[context.i];\n\tif ( char === opts.CLOSE ) {\n\t\tcontext.i++;\n\t\treturn out;\n\n\t} else if ( char !== opts.SEP )\n\t\tthrow expected(`${opts.SEP} or ${opts.CLOSE}`, char, context.i);\n\n\tcontext.i++;\n\tskipSpace(context);\n\n\t// Type\n\tconst type = this.parseText(context, null, false, false);\n\tif ( ! type )\n\t\tthrow expected('type', context);\n\n\tout.t = type;\n\tskipSpace(context);\n\n\tchar = msg[context.i];\n\tif ( char === opts.CLOSE ) {\n\t\tif ( opts[SUBMSG].includes(out.t) )\n\t\t\tthrow expected('sub-messages', context);\n\n\t\tcontext.i++;\n\t\treturn out;\n\n\t} else if ( char !== opts.SEP )\n\t\tthrow expected(`${opts.SEP} or ${opts.CLOSE}`, char, context.i);\n\n\tcontext.i++;\n\tskipSpace(context);\n\n\t// Formatting\n\tif ( opts[SUBNUM].includes(out.t) ) {\n\t\tconst offset = this.parseOffset(context);\n\t\tif ( offset ) {\n\t\t\tout.f = offset;\n\t\t\tskipSpace(context);\n\t\t}\n\t}\n\n\tif ( opts[SUBMSG].includes(out.t) ) {\n\t\tconst submessages = this.parseSubmessages(context, out),\n\t\t\treq = opts.requireOther;\n\t\tif ( (Array.isArray(req) ? req.includes(out.t) : req) && ! submessages.other )\n\t\t\tthrow expected('other sub-message', context);\n\n\t\tout.o = submessages;\n\n\t} else {\n\t\tconst format = this.parseText(context, null, true, true);\n\t\tif ( ! format )\n\t\t\tthrow expected('format', context);\n\n\t\t// Since we allow spaces mid-format, we should trim any\n\t\t// remaining spaces off the end.\n\t\tout.f = format.trimRight();\n\t}\n\n\tskipSpace(context);\n\tchar = msg[context.i];\n\tif ( char !== opts.CLOSE )\n\t\tthrow expected(opts.CLOSE, char, context.i);\n\n\tcontext.i++;\n\treturn out;\n}\n\n\np.parseSubmessages = function(context, parent) {\n\tconst msg = context.msg,\n\t\tlength = msg.length,\n\t\tout = {};\n\n\twhile(context.i < length ) {\n\t\tconst char = msg[context.i];\n\t\tif ( char === this.opts.CLOSE )\n\t\t\tbreak;\n\n\t\tconst selector = this.parseText(context, null, true, false);\n\t\tif ( ! selector )\n\t\t\tthrow expected('sub-message selector', context);\n\n\t\tskipSpace(context);\n\t\tout[selector] = this.parseSubmessage(context, parent);\n\t\tskipSpace(context);\n\t}\n\n\treturn out;\n}\n\n\np.parseSubmessage = function(context, parent) {\n\tconst msg = context.msg,\n\t\topts = this.opts;\n\n\tif ( msg[context.i] !== opts.OPEN )\n\t\tthrow expected(opts.OPEN, context);\n\n\tcontext.i++;\n\tconst out = this.parseAST(context, parent);\n\n\tif ( msg[context.i] !== opts.CLOSE )\n\t\tthrow expected(opts.CLOSE, context);\n\n\tcontext.i++;\n\treturn out;\n}\n\n\np.parseOffset = function(context) {\n\tconst msg = context.msg,\n\t\tOFFSET = this.opts.OFFSET,\n\t\tlength = msg.length;\n\n\tif ( msg.slice(context.i, context.i + OFFSET.length) !== OFFSET )\n\t\treturn;\n\n\tcontext.i += OFFSET.length;\n\tskipSpace(context);\n\n\tconst start = context.i;\n\twhile(context.i < length && /[-\\d]/.test(msg[context.i]))\n\t\tcontext.i++;\n\n\tif ( start === context.i )\n\t\tthrow expected('number', context);\n\n\treturn +msg.slice(start, context.i);\n}\n\n\nfunction expected(char, found, index) {\n\tif ( typeof found === 'object' ) {\n\t\tindex = found.i;\n\t\tfound = found.msg[index];\n\t}\n\n\treturn new SyntaxError(`expected ${char} at position ${index} but found ${found || 'eof'}`);\n}\n\nfunction unexpected(char, index) {\n\treturn new SyntaxError(`unexpected ${char} at position ${index}`)\n}\n\nfunction skipSpace(context) {\n\tconst msg = context.msg,\n\t\tlength = msg.length;\n\n\twhile ( context.i < length && SPACE.test(msg[context.i]) )\n\t\tcontext.i++;\n}\n\nfunction mergePush(list, item) {\n\tconst l = list.length - 1;\n\tif ( typeof item === 'string' && typeof list[l] === 'string' )\n\t\tlist[l] += item;\n\telse\n\t\tlist.push(item);\n}\n","export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}","import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport { round } from \"../utils/math.js\";\n\nfunction isElementScaled(element) {\n  var rect = element.getBoundingClientRect();\n  var scaleX = round(rect.width) / element.offsetWidth || 1;\n  var scaleY = round(rect.height) / element.offsetHeight || 1;\n  return scaleX !== 1 || scaleY !== 1;\n} // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var offsetParentIsScaled = isHTMLElement(offsetParent) && isElementScaled(offsetParent);\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement, offsetParentIsScaled, isFixed);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent, true);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}","import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}","export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}","export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}","import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(setOptionsAction) {\n        var options = typeof setOptionsAction === 'function' ? setOptionsAction(state.options) : setOptionsAction;\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        });\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update – it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update – it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref) {\n        var name = _ref.name,\n            _ref$options = _ref.options,\n            options = _ref$options === void 0 ? {} : _ref$options,\n            effect = _ref.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };","import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}","import { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport { round } from \"../utils/math.js\";\nimport getWindow from \"./getWindow.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getBoundingClientRect(element, includeScale, isFixedStrategy) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n\n  var clientRect = element.getBoundingClientRect();\n  var scaleX = 1;\n  var scaleY = 1;\n\n  if (includeScale && isHTMLElement(element)) {\n    scaleX = element.offsetWidth > 0 ? round(clientRect.width) / element.offsetWidth || 1 : 1;\n    scaleY = element.offsetHeight > 0 ? round(clientRect.height) / element.offsetHeight || 1 : 1;\n  }\n\n  var _ref = isElement(element) ? getWindow(element) : window,\n      visualViewport = _ref.visualViewport;\n\n  var addVisualOffsets = !isLayoutViewport() && isFixedStrategy;\n  var x = (clientRect.left + (addVisualOffsets && visualViewport ? visualViewport.offsetLeft : 0)) / scaleX;\n  var y = (clientRect.top + (addVisualOffsets && visualViewport ? visualViewport.offsetTop : 0)) / scaleY;\n  var width = clientRect.width / scaleX;\n  var height = clientRect.height / scaleY;\n  return {\n    width: width,\n    height: height,\n    top: y,\n    right: x + width,\n    bottom: y + height,\n    left: x,\n    x: x,\n    y: y\n  };\n}","import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}","import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}","export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}","import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}","import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement, isShadowRoot } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getUAString from \"../utils/userAgent.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = /firefox/i.test(getUAString());\n  var isIE = /Trident/i.test(getUAString());\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}","import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}","export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}","import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}","import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };","import getUAString from \"../utils/userAgent.js\";\nexport default function isLayoutViewport() {\n  return !/^((?!chrome|android).)*safari/i.test(getUAString());\n}","import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}","import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}","import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}","export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];","import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow };","import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport { within } from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};","import { top, left, right, bottom, end } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref, win) {\n  var x = _ref.x,\n      y = _ref.y;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(x * dpr) / dpr || 0,\n    y: round(y * dpr) / dpr || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      variation = _ref2.variation,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets,\n      isFixed = _ref2.isFixed;\n  var _offsets$x = offsets.x,\n      x = _offsets$x === void 0 ? 0 : _offsets$x,\n      _offsets$y = offsets.y,\n      y = _offsets$y === void 0 ? 0 : _offsets$y;\n\n  var _ref3 = typeof roundOffsets === 'function' ? roundOffsets({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref3.x;\n  y = _ref3.y;\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static' && position === 'absolute') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top || (placement === left || placement === right) && variation === end) {\n      sideY = bottom;\n      var offsetY = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.height : // $FlowFixMe[prop-missing]\n      offsetParent[heightProp];\n      y -= offsetY - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left || (placement === top || placement === bottom) && variation === end) {\n      sideX = right;\n      var offsetX = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.width : // $FlowFixMe[prop-missing]\n      offsetParent[widthProp];\n      x -= offsetX - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  var _ref4 = roundOffsets === true ? roundOffsetsByDPR({\n    x: x,\n    y: y\n  }, getWindow(popper)) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref4.x;\n  y = _ref4.y;\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) <= 1 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref5) {\n  var state = _ref5.state,\n      options = _ref5.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    variation: getVariation(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration,\n    isFixed: state.options.strategy === 'fixed'\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};","import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};","var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}","var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}","import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}","import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases – research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};","import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};","import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};","export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}","import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport { within, withinMaxClamp } from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { min as mathMin, max as mathMax } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var normalizedTetherOffsetValue = typeof tetherOffsetValue === 'number' ? {\n    mainAxis: tetherOffsetValue,\n    altAxis: tetherOffsetValue\n  } : Object.assign({\n    mainAxis: 0,\n    altAxis: 0\n  }, tetherOffsetValue);\n  var offsetModifierState = state.modifiersData.offset ? state.modifiersData.offset[state.placement] : null;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis) {\n    var _offsetModifierState$;\n\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = offset + overflow[mainSide];\n    var max = offset - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis : minLen - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis : maxLen + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = (_offsetModifierState$ = offsetModifierState == null ? void 0 : offsetModifierState[mainAxis]) != null ? _offsetModifierState$ : 0;\n    var tetherMin = offset + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = offset + maxOffset - offsetModifierValue;\n    var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n    popperOffsets[mainAxis] = preventedOffset;\n    data[mainAxis] = preventedOffset - offset;\n  }\n\n  if (checkAltAxis) {\n    var _offsetModifierState$2;\n\n    var _mainSide = mainAxis === 'x' ? top : left;\n\n    var _altSide = mainAxis === 'x' ? bottom : right;\n\n    var _offset = popperOffsets[altAxis];\n\n    var _len = altAxis === 'y' ? 'height' : 'width';\n\n    var _min = _offset + overflow[_mainSide];\n\n    var _max = _offset - overflow[_altSide];\n\n    var isOriginSide = [top, left].indexOf(basePlacement) !== -1;\n\n    var _offsetModifierValue = (_offsetModifierState$2 = offsetModifierState == null ? void 0 : offsetModifierState[altAxis]) != null ? _offsetModifierState$2 : 0;\n\n    var _tetherMin = isOriginSide ? _min : _offset - referenceRect[_len] - popperRect[_len] - _offsetModifierValue + normalizedTetherOffsetValue.altAxis;\n\n    var _tetherMax = isOriginSide ? _offset + referenceRect[_len] + popperRect[_len] - _offsetModifierValue - normalizedTetherOffsetValue.altAxis : _max;\n\n    var _preventedOffset = tether && isOriginSide ? withinMaxClamp(_tetherMin, _offset, _tetherMax) : within(tether ? _tetherMin : _min, _offset, tether ? _tetherMax : _max);\n\n    popperOffsets[altAxis] = _preventedOffset;\n    data[altAxis] = _preventedOffset - _offset;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};","import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";","import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}","import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getViewportRect(element, strategy) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0;\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    var layoutViewport = isLayoutViewport();\n\n    if (layoutViewport || !layoutViewport && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}","import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}","export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}","import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element, strategy) {\n  var rect = getBoundingClientRect(element, false, strategy === 'fixed');\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent, strategy) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element, strategy)) : isElement(clippingParent) ? getInnerBoundingClientRect(clippingParent, strategy) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary, strategy) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent, strategy));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}","import getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$strategy = _options.strategy,\n      strategy = _options$strategy === void 0 ? state.strategy : _options$strategy,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary, strategy);\n  var referenceClientRect = getBoundingClientRect(state.elements.reference);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}","export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}","import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}","export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}","export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}","export default function getVariation(placement) {\n  return placement.split('-')[1];\n}","export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;","import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}","export default function getUAString() {\n  var uaData = navigator.userAgentData;\n\n  if (uaData != null && uaData.brands && Array.isArray(uaData.brands)) {\n    return uaData.brands.map(function (item) {\n      return item.brand + \"/\" + item.version;\n    }).join(' ');\n  }\n\n  return navigator.userAgent;\n}","import { max as mathMax, min as mathMin } from \"./math.js\";\nexport function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}\nexport function withinMaxClamp(min, value, max) {\n  var v = within(min, value, max);\n  return v > max ? max : v;\n}",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory();\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\troot.CryptoJS = factory();\n\t}\n}(this, function () {\n\n\t/*globals window, global, require*/\n\n\t/**\n\t * CryptoJS core components.\n\t */\n\tvar CryptoJS = CryptoJS || (function (Math, undefined) {\n\n\t    var crypto;\n\n\t    // Native crypto from window (Browser)\n\t    if (typeof window !== 'undefined' && window.crypto) {\n\t        crypto = window.crypto;\n\t    }\n\n\t    // Native crypto in web worker (Browser)\n\t    if (typeof self !== 'undefined' && self.crypto) {\n\t        crypto = self.crypto;\n\t    }\n\n\t    // Native crypto from worker\n\t    if (typeof globalThis !== 'undefined' && globalThis.crypto) {\n\t        crypto = globalThis.crypto;\n\t    }\n\n\t    // Native (experimental IE 11) crypto from window (Browser)\n\t    if (!crypto && typeof window !== 'undefined' && window.msCrypto) {\n\t        crypto = window.msCrypto;\n\t    }\n\n\t    // Native crypto from global (NodeJS)\n\t    if (!crypto && typeof global !== 'undefined' && global.crypto) {\n\t        crypto = global.crypto;\n\t    }\n\n\t    // Native crypto import via require (NodeJS)\n\t    if (!crypto && typeof require === 'function') {\n\t        try {\n\t            crypto = require('crypto');\n\t        } catch (err) {}\n\t    }\n\n\t    /*\n\t     * Cryptographically secure pseudorandom number generator\n\t     *\n\t     * As Math.random() is cryptographically not safe to use\n\t     */\n\t    var cryptoSecureRandomInt = function () {\n\t        if (crypto) {\n\t            // Use getRandomValues method (Browser)\n\t            if (typeof crypto.getRandomValues === 'function') {\n\t                try {\n\t                    return crypto.getRandomValues(new Uint32Array(1))[0];\n\t                } catch (err) {}\n\t            }\n\n\t            // Use randomBytes method (NodeJS)\n\t            if (typeof crypto.randomBytes === 'function') {\n\t                try {\n\t                    return crypto.randomBytes(4).readInt32LE();\n\t                } catch (err) {}\n\t            }\n\t        }\n\n\t        throw new Error('Native crypto module could not be used to get secure random number.');\n\t    };\n\n\t    /*\n\t     * Local polyfill of Object.create\n\n\t     */\n\t    var create = Object.create || (function () {\n\t        function F() {}\n\n\t        return function (obj) {\n\t            var subtype;\n\n\t            F.prototype = obj;\n\n\t            subtype = new F();\n\n\t            F.prototype = null;\n\n\t            return subtype;\n\t        };\n\t    }());\n\n\t    /**\n\t     * CryptoJS namespace.\n\t     */\n\t    var C = {};\n\n\t    /**\n\t     * Library namespace.\n\t     */\n\t    var C_lib = C.lib = {};\n\n\t    /**\n\t     * Base object for prototypal inheritance.\n\t     */\n\t    var Base = C_lib.Base = (function () {\n\n\n\t        return {\n\t            /**\n\t             * Creates a new object that inherits from this object.\n\t             *\n\t             * @param {Object} overrides Properties to copy into the new object.\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         field: 'value',\n\t             *\n\t             *         method: function () {\n\t             *         }\n\t             *     });\n\t             */\n\t            extend: function (overrides) {\n\t                // Spawn\n\t                var subtype = create(this);\n\n\t                // Augment\n\t                if (overrides) {\n\t                    subtype.mixIn(overrides);\n\t                }\n\n\t                // Create default initializer\n\t                if (!subtype.hasOwnProperty('init') || this.init === subtype.init) {\n\t                    subtype.init = function () {\n\t                        subtype.$super.init.apply(this, arguments);\n\t                    };\n\t                }\n\n\t                // Initializer's prototype is the subtype object\n\t                subtype.init.prototype = subtype;\n\n\t                // Reference supertype\n\t                subtype.$super = this;\n\n\t                return subtype;\n\t            },\n\n\t            /**\n\t             * Extends this object and runs the init method.\n\t             * Arguments to create() will be passed to init().\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var instance = MyType.create();\n\t             */\n\t            create: function () {\n\t                var instance = this.extend();\n\t                instance.init.apply(instance, arguments);\n\n\t                return instance;\n\t            },\n\n\t            /**\n\t             * Initializes a newly created object.\n\t             * Override this method to add some logic when your objects are created.\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         init: function () {\n\t             *             // ...\n\t             *         }\n\t             *     });\n\t             */\n\t            init: function () {\n\t            },\n\n\t            /**\n\t             * Copies properties into this object.\n\t             *\n\t             * @param {Object} properties The properties to mix in.\n\t             *\n\t             * @example\n\t             *\n\t             *     MyType.mixIn({\n\t             *         field: 'value'\n\t             *     });\n\t             */\n\t            mixIn: function (properties) {\n\t                for (var propertyName in properties) {\n\t                    if (properties.hasOwnProperty(propertyName)) {\n\t                        this[propertyName] = properties[propertyName];\n\t                    }\n\t                }\n\n\t                // IE won't copy toString using the loop above\n\t                if (properties.hasOwnProperty('toString')) {\n\t                    this.toString = properties.toString;\n\t                }\n\t            },\n\n\t            /**\n\t             * Creates a copy of this object.\n\t             *\n\t             * @return {Object} The clone.\n\t             *\n\t             * @example\n\t             *\n\t             *     var clone = instance.clone();\n\t             */\n\t            clone: function () {\n\t                return this.init.prototype.extend(this);\n\t            }\n\t        };\n\t    }());\n\n\t    /**\n\t     * An array of 32-bit words.\n\t     *\n\t     * @property {Array} words The array of 32-bit words.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var WordArray = C_lib.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of 32-bit words.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.create();\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607]);\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607], 6);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 4;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this word array to a string.\n\t         *\n\t         * @param {Encoder} encoder (Optional) The encoding strategy to use. Default: CryptoJS.enc.Hex\n\t         *\n\t         * @return {string} The stringified word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var string = wordArray + '';\n\t         *     var string = wordArray.toString();\n\t         *     var string = wordArray.toString(CryptoJS.enc.Utf8);\n\t         */\n\t        toString: function (encoder) {\n\t            return (encoder || Hex).stringify(this);\n\t        },\n\n\t        /**\n\t         * Concatenates a word array to this word array.\n\t         *\n\t         * @param {WordArray} wordArray The word array to append.\n\t         *\n\t         * @return {WordArray} This word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray1.concat(wordArray2);\n\t         */\n\t        concat: function (wordArray) {\n\t            // Shortcuts\n\t            var thisWords = this.words;\n\t            var thatWords = wordArray.words;\n\t            var thisSigBytes = this.sigBytes;\n\t            var thatSigBytes = wordArray.sigBytes;\n\n\t            // Clamp excess bits\n\t            this.clamp();\n\n\t            // Concat\n\t            if (thisSigBytes % 4) {\n\t                // Copy one byte at a time\n\t                for (var i = 0; i < thatSigBytes; i++) {\n\t                    var thatByte = (thatWords[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                    thisWords[(thisSigBytes + i) >>> 2] |= thatByte << (24 - ((thisSigBytes + i) % 4) * 8);\n\t                }\n\t            } else {\n\t                // Copy one word at a time\n\t                for (var j = 0; j < thatSigBytes; j += 4) {\n\t                    thisWords[(thisSigBytes + j) >>> 2] = thatWords[j >>> 2];\n\t                }\n\t            }\n\t            this.sigBytes += thatSigBytes;\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Removes insignificant bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray.clamp();\n\t         */\n\t        clamp: function () {\n\t            // Shortcuts\n\t            var words = this.words;\n\t            var sigBytes = this.sigBytes;\n\n\t            // Clamp\n\t            words[sigBytes >>> 2] &= 0xffffffff << (32 - (sigBytes % 4) * 8);\n\t            words.length = Math.ceil(sigBytes / 4);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = wordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone.words = this.words.slice(0);\n\n\t            return clone;\n\t        },\n\n\t        /**\n\t         * Creates a word array filled with random bytes.\n\t         *\n\t         * @param {number} nBytes The number of random bytes to generate.\n\t         *\n\t         * @return {WordArray} The random word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.random(16);\n\t         */\n\t        random: function (nBytes) {\n\t            var words = [];\n\n\t            for (var i = 0; i < nBytes; i += 4) {\n\t                words.push(cryptoSecureRandomInt());\n\t            }\n\n\t            return new WordArray.init(words, nBytes);\n\t        }\n\t    });\n\n\t    /**\n\t     * Encoder namespace.\n\t     */\n\t    var C_enc = C.enc = {};\n\n\t    /**\n\t     * Hex encoding strategy.\n\t     */\n\t    var Hex = C_enc.Hex = {\n\t        /**\n\t         * Converts a word array to a hex string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The hex string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var hexString = CryptoJS.enc.Hex.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var hexChars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                hexChars.push((bite >>> 4).toString(16));\n\t                hexChars.push((bite & 0x0f).toString(16));\n\t            }\n\n\t            return hexChars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a hex string to a word array.\n\t         *\n\t         * @param {string} hexStr The hex string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Hex.parse(hexString);\n\t         */\n\t        parse: function (hexStr) {\n\t            // Shortcut\n\t            var hexStrLength = hexStr.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < hexStrLength; i += 2) {\n\t                words[i >>> 3] |= parseInt(hexStr.substr(i, 2), 16) << (24 - (i % 8) * 4);\n\t            }\n\n\t            return new WordArray.init(words, hexStrLength / 2);\n\t        }\n\t    };\n\n\t    /**\n\t     * Latin1 encoding strategy.\n\t     */\n\t    var Latin1 = C_enc.Latin1 = {\n\t        /**\n\t         * Converts a word array to a Latin1 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Latin1 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var latin1String = CryptoJS.enc.Latin1.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var latin1Chars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                latin1Chars.push(String.fromCharCode(bite));\n\t            }\n\n\t            return latin1Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Latin1 string to a word array.\n\t         *\n\t         * @param {string} latin1Str The Latin1 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Latin1.parse(latin1String);\n\t         */\n\t        parse: function (latin1Str) {\n\t            // Shortcut\n\t            var latin1StrLength = latin1Str.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < latin1StrLength; i++) {\n\t                words[i >>> 2] |= (latin1Str.charCodeAt(i) & 0xff) << (24 - (i % 4) * 8);\n\t            }\n\n\t            return new WordArray.init(words, latin1StrLength);\n\t        }\n\t    };\n\n\t    /**\n\t     * UTF-8 encoding strategy.\n\t     */\n\t    var Utf8 = C_enc.Utf8 = {\n\t        /**\n\t         * Converts a word array to a UTF-8 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The UTF-8 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var utf8String = CryptoJS.enc.Utf8.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            try {\n\t                return decodeURIComponent(escape(Latin1.stringify(wordArray)));\n\t            } catch (e) {\n\t                throw new Error('Malformed UTF-8 data');\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts a UTF-8 string to a word array.\n\t         *\n\t         * @param {string} utf8Str The UTF-8 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Utf8.parse(utf8String);\n\t         */\n\t        parse: function (utf8Str) {\n\t            return Latin1.parse(unescape(encodeURIComponent(utf8Str)));\n\t        }\n\t    };\n\n\t    /**\n\t     * Abstract buffered block algorithm template.\n\t     *\n\t     * The property blockSize must be implemented in a concrete subtype.\n\t     *\n\t     * @property {number} _minBufferSize The number of blocks that should be kept unprocessed in the buffer. Default: 0\n\t     */\n\t    var BufferedBlockAlgorithm = C_lib.BufferedBlockAlgorithm = Base.extend({\n\t        /**\n\t         * Resets this block algorithm's data buffer to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm.reset();\n\t         */\n\t        reset: function () {\n\t            // Initial values\n\t            this._data = new WordArray.init();\n\t            this._nDataBytes = 0;\n\t        },\n\n\t        /**\n\t         * Adds new data to this block algorithm's buffer.\n\t         *\n\t         * @param {WordArray|string} data The data to append. Strings are converted to a WordArray using UTF-8.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm._append('data');\n\t         *     bufferedBlockAlgorithm._append(wordArray);\n\t         */\n\t        _append: function (data) {\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof data == 'string') {\n\t                data = Utf8.parse(data);\n\t            }\n\n\t            // Append\n\t            this._data.concat(data);\n\t            this._nDataBytes += data.sigBytes;\n\t        },\n\n\t        /**\n\t         * Processes available data blocks.\n\t         *\n\t         * This method invokes _doProcessBlock(offset), which must be implemented by a concrete subtype.\n\t         *\n\t         * @param {boolean} doFlush Whether all blocks and partial blocks should be processed.\n\t         *\n\t         * @return {WordArray} The processed data.\n\t         *\n\t         * @example\n\t         *\n\t         *     var processedData = bufferedBlockAlgorithm._process();\n\t         *     var processedData = bufferedBlockAlgorithm._process(!!'flush');\n\t         */\n\t        _process: function (doFlush) {\n\t            var processedWords;\n\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\t            var dataSigBytes = data.sigBytes;\n\t            var blockSize = this.blockSize;\n\t            var blockSizeBytes = blockSize * 4;\n\n\t            // Count blocks ready\n\t            var nBlocksReady = dataSigBytes / blockSizeBytes;\n\t            if (doFlush) {\n\t                // Round up to include partial blocks\n\t                nBlocksReady = Math.ceil(nBlocksReady);\n\t            } else {\n\t                // Round down to include only full blocks,\n\t                // less the number of blocks that must remain in the buffer\n\t                nBlocksReady = Math.max((nBlocksReady | 0) - this._minBufferSize, 0);\n\t            }\n\n\t            // Count words ready\n\t            var nWordsReady = nBlocksReady * blockSize;\n\n\t            // Count bytes ready\n\t            var nBytesReady = Math.min(nWordsReady * 4, dataSigBytes);\n\n\t            // Process blocks\n\t            if (nWordsReady) {\n\t                for (var offset = 0; offset < nWordsReady; offset += blockSize) {\n\t                    // Perform concrete-algorithm logic\n\t                    this._doProcessBlock(dataWords, offset);\n\t                }\n\n\t                // Remove processed words\n\t                processedWords = dataWords.splice(0, nWordsReady);\n\t                data.sigBytes -= nBytesReady;\n\t            }\n\n\t            // Return processed words\n\t            return new WordArray.init(processedWords, nBytesReady);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this object.\n\t         *\n\t         * @return {Object} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = bufferedBlockAlgorithm.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone._data = this._data.clone();\n\n\t            return clone;\n\t        },\n\n\t        _minBufferSize: 0\n\t    });\n\n\t    /**\n\t     * Abstract hasher template.\n\t     *\n\t     * @property {number} blockSize The number of 32-bit words this hasher operates on. Default: 16 (512 bits)\n\t     */\n\t    var Hasher = C_lib.Hasher = BufferedBlockAlgorithm.extend({\n\t        /**\n\t         * Configuration options.\n\t         */\n\t        cfg: Base.extend(),\n\n\t        /**\n\t         * Initializes a newly created hasher.\n\t         *\n\t         * @param {Object} cfg (Optional) The configuration options to use for this hash computation.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hasher = CryptoJS.algo.SHA256.create();\n\t         */\n\t        init: function (cfg) {\n\t            // Apply config defaults\n\t            this.cfg = this.cfg.extend(cfg);\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this hasher to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Reset data buffer\n\t            BufferedBlockAlgorithm.reset.call(this);\n\n\t            // Perform concrete-hasher logic\n\t            this._doReset();\n\t        },\n\n\t        /**\n\t         * Updates this hasher with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {Hasher} This hasher.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.update('message');\n\t         *     hasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            // Append\n\t            this._append(messageUpdate);\n\n\t            // Update the hash\n\t            this._process();\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the hash computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The hash.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hash = hasher.finalize();\n\t         *     var hash = hasher.finalize('message');\n\t         *     var hash = hasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Final message update\n\t            if (messageUpdate) {\n\t                this._append(messageUpdate);\n\t            }\n\n\t            // Perform concrete-hasher logic\n\t            var hash = this._doFinalize();\n\n\t            return hash;\n\t        },\n\n\t        blockSize: 512/32,\n\n\t        /**\n\t         * Creates a shortcut function to a hasher's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to create a helper for.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var SHA256 = CryptoJS.lib.Hasher._createHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHelper: function (hasher) {\n\t            return function (message, cfg) {\n\t                return new hasher.init(cfg).finalize(message);\n\t            };\n\t        },\n\n\t        /**\n\t         * Creates a shortcut function to the HMAC's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to use in this HMAC helper.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var HmacSHA256 = CryptoJS.lib.Hasher._createHmacHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHmacHelper: function (hasher) {\n\t            return function (message, key) {\n\t                return new C_algo.HMAC.init(hasher, key).finalize(message);\n\t            };\n\t        }\n\t    });\n\n\t    /**\n\t     * Algorithm namespace.\n\t     */\n\t    var C_algo = C.algo = {};\n\n\t    return C;\n\t}(Math));\n\n\n\treturn CryptoJS;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_algo = C.algo;\n\n\t    // Reusable object\n\t    var W = [];\n\n\t    /**\n\t     * SHA-1 hash algorithm.\n\t     */\n\t    var SHA1 = C_algo.SHA1 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new WordArray.init([\n\t                0x67452301, 0xefcdab89,\n\t                0x98badcfe, 0x10325476,\n\t                0xc3d2e1f0\n\t            ]);\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcut\n\t            var H = this._hash.words;\n\n\t            // Working variables\n\t            var a = H[0];\n\t            var b = H[1];\n\t            var c = H[2];\n\t            var d = H[3];\n\t            var e = H[4];\n\n\t            // Computation\n\t            for (var i = 0; i < 80; i++) {\n\t                if (i < 16) {\n\t                    W[i] = M[offset + i] | 0;\n\t                } else {\n\t                    var n = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n\t                    W[i] = (n << 1) | (n >>> 31);\n\t                }\n\n\t                var t = ((a << 5) | (a >>> 27)) + e + W[i];\n\t                if (i < 20) {\n\t                    t += ((b & c) | (~b & d)) + 0x5a827999;\n\t                } else if (i < 40) {\n\t                    t += (b ^ c ^ d) + 0x6ed9eba1;\n\t                } else if (i < 60) {\n\t                    t += ((b & c) | (b & d) | (c & d)) - 0x70e44324;\n\t                } else /* if (i < 80) */ {\n\t                    t += (b ^ c ^ d) - 0x359d3e2a;\n\t                }\n\n\t                e = d;\n\t                d = c;\n\t                c = (b << 30) | (b >>> 2);\n\t                b = a;\n\t                a = t;\n\t            }\n\n\t            // Intermediate hash value\n\t            H[0] = (H[0] + a) | 0;\n\t            H[1] = (H[1] + b) | 0;\n\t            H[2] = (H[2] + c) | 0;\n\t            H[3] = (H[3] + d) | 0;\n\t            H[4] = (H[4] + e) | 0;\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 14] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Return final computed hash\n\t            return this._hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        }\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA1('message');\n\t     *     var hash = CryptoJS.SHA1(wordArray);\n\t     */\n\t    C.SHA1 = Hasher._createHelper(SHA1);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA1(message, key);\n\t     */\n\t    C.HmacSHA1 = Hasher._createHmacHelper(SHA1);\n\t}());\n\n\n\treturn CryptoJS.SHA1;\n\n}));","!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(t=\"undefined\"!=typeof globalThis?globalThis:t||self).dayjs=e()}(this,(function(){\"use strict\";var t=1e3,e=6e4,n=36e5,r=\"millisecond\",i=\"second\",s=\"minute\",u=\"hour\",a=\"day\",o=\"week\",f=\"month\",h=\"quarter\",c=\"year\",d=\"date\",$=\"Invalid Date\",l=/^(\\d{4})[-/]?(\\d{1,2})?[-/]?(\\d{0,2})[Tt\\s]*(\\d{1,2})?:?(\\d{1,2})?:?(\\d{1,2})?[.:]?(\\d+)?$/,y=/\\[([^\\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:\"en\",weekdays:\"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday\".split(\"_\"),months:\"January_February_March_April_May_June_July_August_September_October_November_December\".split(\"_\")},m=function(t,e,n){var r=String(t);return!r||r.length>=e?t:\"\"+Array(e+1-r.length).join(n)+t},g={s:m,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?\"+\":\"-\")+m(r,2,\"0\")+\":\"+m(i,2,\"0\")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,f),s=n-i<0,u=e.clone().add(r+(s?-1:1),f);return+(-(r+(n-i)/(s?i-u:u-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:f,y:c,w:o,d:a,D:d,h:u,m:s,s:i,ms:r,Q:h}[t]||String(t||\"\").toLowerCase().replace(/s$/,\"\")},u:function(t){return void 0===t}},D=\"en\",v={};v[D]=M;var p=function(t){return t instanceof _},S=function(t,e,n){var r;if(!t)return D;if(\"string\"==typeof t)v[t]&&(r=t),e&&(v[t]=e,r=t);else{var i=t.name;v[i]=t,r=i}return!n&&r&&(D=r),r||!n&&D},w=function(t,e){if(p(t))return t.clone();var n=\"object\"==typeof e?e:{};return n.date=t,n.args=arguments,new _(n)},O=g;O.l=S,O.i=p,O.w=function(t,e){return w(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var _=function(){function M(t){this.$L=S(t.locale,null,!0),this.parse(t)}var m=M.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(O.u(e))return new Date;if(e instanceof Date)return new Date(e);if(\"string\"==typeof e&&!/Z$/i.test(e)){var r=e.match(l);if(r){var i=r[2]-1||0,s=(r[7]||\"0\").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return O},m.isValid=function(){return!(this.$d.toString()===$)},m.isSame=function(t,e){var n=w(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return w(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<w(t)},m.$g=function(t,e,n){return O.u(t)?this[e]:this.set(n,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var n=this,r=!!O.u(e)||e,h=O.p(t),$=function(t,e){var i=O.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},l=function(t,e){return O.w(n.toDate()[t].apply(n.toDate(\"s\"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},y=this.$W,M=this.$M,m=this.$D,g=\"set\"+(this.$u?\"UTC\":\"\");switch(h){case c:return r?$(1,0):$(31,11);case f:return r?$(1,M):$(0,M+1);case o:var D=this.$locale().weekStart||0,v=(y<D?y+7:y)-D;return $(r?m-v:m+(6-v),M);case a:case d:return l(g+\"Hours\",0);case u:return l(g+\"Minutes\",1);case s:return l(g+\"Seconds\",2);case i:return l(g+\"Milliseconds\",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var n,o=O.p(t),h=\"set\"+(this.$u?\"UTC\":\"\"),$=(n={},n[a]=h+\"Date\",n[d]=h+\"Date\",n[f]=h+\"Month\",n[c]=h+\"FullYear\",n[u]=h+\"Hours\",n[s]=h+\"Minutes\",n[i]=h+\"Seconds\",n[r]=h+\"Milliseconds\",n)[o],l=o===a?this.$D+(e-this.$W):e;if(o===f||o===c){var y=this.clone().set(d,1);y.$d[$](l),y.init(),this.$d=y.set(d,Math.min(this.$D,y.daysInMonth())).$d}else $&&this.$d[$](l);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[O.p(t)]()},m.add=function(r,h){var d,$=this;r=Number(r);var l=O.p(h),y=function(t){var e=w($);return O.w(e.date(e.date()+Math.round(t*r)),$)};if(l===f)return this.set(f,this.$M+r);if(l===c)return this.set(c,this.$y+r);if(l===a)return y(1);if(l===o)return y(7);var M=(d={},d[s]=e,d[u]=n,d[i]=t,d)[l]||1,m=this.$d.getTime()+r*M;return O.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||$;var r=t||\"YYYY-MM-DDTHH:mm:ssZ\",i=O.z(this),s=this.$H,u=this.$m,a=this.$M,o=n.weekdays,f=n.months,h=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].substr(0,s)},c=function(t){return O.s(s%12||12,t,\"0\")},d=n.meridiem||function(t,e,n){var r=t<12?\"AM\":\"PM\";return n?r.toLowerCase():r},l={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:O.s(a+1,2,\"0\"),MMM:h(n.monthsShort,a,f,3),MMMM:h(f,a),D:this.$D,DD:O.s(this.$D,2,\"0\"),d:String(this.$W),dd:h(n.weekdaysMin,this.$W,o,2),ddd:h(n.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(s),HH:O.s(s,2,\"0\"),h:c(1),hh:c(2),a:d(s,u,!0),A:d(s,u,!1),m:String(u),mm:O.s(u,2,\"0\"),s:String(this.$s),ss:O.s(this.$s,2,\"0\"),SSS:O.s(this.$ms,3,\"0\"),Z:i};return r.replace(y,(function(t,e){return e||l[t]||i.replace(\":\",\"\")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(r,d,$){var l,y=O.p(d),M=w(r),m=(M.utcOffset()-this.utcOffset())*e,g=this-M,D=O.m(this,M);return D=(l={},l[c]=D/12,l[f]=D,l[h]=D/3,l[o]=(g-m)/6048e5,l[a]=(g-m)/864e5,l[u]=g/n,l[s]=g/e,l[i]=g/t,l)[y]||g,$?D:O.a(D)},m.daysInMonth=function(){return this.endOf(f).$D},m.$locale=function(){return v[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=S(t,e,!0);return r&&(n.$L=r),n},m.clone=function(){return O.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},M}(),b=_.prototype;return w.prototype=b,[[\"$ms\",r],[\"$s\",i],[\"$m\",s],[\"$H\",u],[\"$W\",a],[\"$M\",f],[\"$y\",c],[\"$D\",d]].forEach((function(t){b[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),w.extend=function(t,e){return t.$i||(t(e,_,w),t.$i=!0),w},w.locale=S,w.isDayjs=p,w.unix=function(t){return w(1e3*t)},w.en=v[D],w.Ls=v,w.p={},w}));","!function(r,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(r=\"undefined\"!=typeof globalThis?globalThis:r||self).dayjs_plugin_relativeTime=e()}(this,(function(){\"use strict\";return function(r,e,t){r=r||{};var n=e.prototype,o={future:\"in %s\",past:\"%s ago\",s:\"a few seconds\",m:\"a minute\",mm:\"%d minutes\",h:\"an hour\",hh:\"%d hours\",d:\"a day\",dd:\"%d days\",M:\"a month\",MM:\"%d months\",y:\"a year\",yy:\"%d years\"};function i(r,e,t,o){return n.fromToBase(r,e,t,o)}t.en.relativeTime=o,n.fromToBase=function(e,n,i,d,u){for(var f,a,s,l=i.$locale().relativeTime||o,h=r.thresholds||[{l:\"s\",r:44,d:\"second\"},{l:\"m\",r:89},{l:\"mm\",r:44,d:\"minute\"},{l:\"h\",r:89},{l:\"hh\",r:21,d:\"hour\"},{l:\"d\",r:35},{l:\"dd\",r:25,d:\"day\"},{l:\"M\",r:45},{l:\"MM\",r:10,d:\"month\"},{l:\"y\",r:17},{l:\"yy\",d:\"year\"}],m=h.length,c=0;c<m;c+=1){var y=h[c];y.d&&(f=d?t(e).diff(i,y.d,!0):i.diff(e,y.d,!0));var p=(r.rounding||Math.round)(Math.abs(f));if(s=f>0,p<=y.r||!y.r){p<=1&&c>0&&(y=h[c-1]);var v=l[y.l];u&&(p=u(\"\"+p)),a=\"string\"==typeof v?v.replace(\"%d\",p):v(p,n,y.l,s);break}}if(n)return a;var M=s?l.future:l.past;return\"function\"==typeof M?M(a):M.replace(\"%s\",a)},n.to=function(r,e){return i(r,e,this,!0)},n.from=function(r,e){return i(r,e,this)};var d=function(r){return r.$u?t.utc():t()};n.toNow=function(r){return this.to(d(this),r)},n.fromNow=function(r){return this.from(d(this),r)}}}));","'use strict';\n\nimport Module, { GenericModule } from 'utilities/module';\n\nlet last_site = 0;\nlet last_call = 0;\n\nexport default class BaseSite extends Module {\n\n\tconstructor(name, parent) {\n\t\tsuper(name, parent);\n\t\tthis._id = `_ffz$${last_site++}`;\n\n\t\t//this.inject('settings');\n\n\t\tthis.log.info(`Using: ${this.constructor.name}`);\n\t}\n\n\n\t// ========================================================================\n\t// DOM Manipulation\n\t// ========================================================================\n\n\tgetReact() {\n\t\tif ( this._react )\n\t\t\treturn this._react;\n\n\t\tlet react;\n\t\ttry {\n\t\t\treact = this.getCore?.()?.intl?.react;\n\t\t} catch(err) { /* no-op */ }\n\n\t\tif ( react?.Component && react.createElement )\n\t\t\treturn this._react = react;\n\n\t\treact = this.resolve('site.web_munch')?.getModule?.('react');\n\t\tif ( react?.Component && react.createElement )\n\t\t\treturn this._react = react;\n\t}\n\n\tgetReactDom() {\n\t\tif ( this._reactDom )\n\t\t\treturn this._reactDom;\n\n\t\tlet reactDom = this.resolve('site.web_munch')?.getModule?.('react-dom');\n\t\tif ( reactDom?.createPortal )\n\t\t\treturn this._reactDom = reactDom;\n\t}\n\n\tfindReact() {\n\t\tconst react = this.getReact();\n\t\tif ( react )\n\t\t\treturn Promise.resolve(react);\n\n\t\tconst munch = this.resolve('site.web_munch');\n\t\tif ( munch )\n\t\t\treturn munch.findModule('react');\n\n\t\treturn this.waitFor('site.web_munch:registered')\n\t\t\t.then(() => this.findReact());\n\t}\n\n\tawaitElement(selector, parent, timeout = 60000) {\n\t\tif ( ! parent )\n\t\t\tparent = document.documentElement;\n\n\t\tconst el = parent.querySelector(selector);\n\t\tif ( el )\n\t\t\treturn Promise.resolve(el);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst observer_name = `${this._id}$observer`,\n\t\t\t\tdata = parent[observer_name],\n\t\t\t\tcall_id = last_call++,\n\n\t\t\t\ttimer = timeout && setTimeout(() => {\n\t\t\t\t\tconst data = parent[observer_name];\n\t\t\t\t\tif ( ! data )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tconst [observer, selectors] = data;\n\n\t\t\t\t\tfor(let i=0; i < selectors.length; i++) {\n\t\t\t\t\t\tconst d = selectors[i];\n\t\t\t\t\t\tif ( d[0] === call_id ) {\n\t\t\t\t\t\t\tselectors.splice(i, 1);\n\t\t\t\t\t\t\td[3]('Timed out');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ! selectors.length ) {\n\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t\tparent[observer_name] = null;\n\t\t\t\t\t}\n\t\t\t\t}, timeout);\n\n\t\t\tif ( data ) {\n\t\t\t\tdata[1].push([call_id, selector, resolve, reject, timer]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst observer = new MutationObserver(() => {\n\t\t\t\tconst data = parent[observer_name];\n\t\t\t\tif ( ! data ) {\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst selectors = data[1];\n\t\t\t\tfor(let i=0; i < selectors.length; i++) {\n\t\t\t\t\tconst d = selectors[i];\n\t\t\t\t\tconst el = parent.querySelector(d[1]);\n\t\t\t\t\tif ( el ) {\n\t\t\t\t\t\tselectors.splice(i, 1);\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tif ( d[4] )\n\t\t\t\t\t\t\tclearTimeout(d[4]);\n\n\t\t\t\t\t\td[2](el);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( ! selectors.length ) {\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\tparent[observer_name] = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tparent[observer_name] = [observer, [[call_id, selector, resolve, reject, timer]]];\n\t\t\tobserver.observe(parent, {\n\t\t\t\tchildList: true,\n\t\t\t\tattributes: true,\n\t\t\t\tcharacterData: true,\n\t\t\t\tsubtree: true\n\t\t\t});\n\t\t});\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Twitch Player -- Shared Code\n// ============================================================================\n\nimport Module from 'utilities/module';\n\nimport {createElement, on, off} from 'utilities/dom';\nimport {isValidShortcut, debounce, has} from 'utilities/object';\nimport { getFontsList, useFont } from 'utilities/fonts';\n\nconst STYLE_VALIDATOR = createElement('span');\n\nconst LEFT_CONTROLS = '.video-player__default-player .player-controls__left-control-group';\nconst RIGHT_CONTROLS = '.video-player__default-player .player-controls__right-control-group';\n\nconst HAS_COMPRESSOR = window.AudioContext && window.DynamicsCompressorNode != null,\n\tHAS_GAIN = HAS_COMPRESSOR && window.GainNode != null;\n\nconst SCROLL_I18N = 'setting.entry.player.volume-scroll.values',\n\tSCROLL_OPTIONS = [\n\t\t{value: false, title: 'Disabled', i18n_key: `${SCROLL_I18N}.false`},\n\t\t{value: true, title: 'Enabled', i18n_key: `${SCROLL_I18N}.true`},\n\t\t{value: 2, title: 'Enabled with Right-Click', i18n_key: `${SCROLL_I18N}.2`},\n\t\t{value: 3, title: 'Enabled with Alt', i18n_key: `${SCROLL_I18N}.3`},\n\t\t{value: 4, title: 'Enabled with Alt + Right-Click', i18n_key: `${SCROLL_I18N}.4`},\n\t\t{value: 5, title: 'Enabled with Shift', i18n_key: `${SCROLL_I18N}.5`},\n\t\t{value: 6, title: 'Enabled with Shift + Right-Click', i18n_key: `${SCROLL_I18N}.6`},\n\t\t{value: 7, title: 'Enabled with Ctrl', i18n_key: `${SCROLL_I18N}.7`},\n\t\t{value: 8, title: 'Enabled with Ctrl + Right-Click', i18n_key: `${SCROLL_I18N}.8`}\n\t];\n\nfunction getNativeClipButton(container) {\n\treturn container.querySelector('button[aria-label*=\"alt+x\"]') ??\n\tcontainer.querySelector('button[aria-label]:has(path[d=\"M8 9H6v2h2V9zm1 0h2v2H9V9zm5 0h-2v2h2V9z\"]');\n}\n\nfunction wantsRMB(setting) {\n\treturn setting === 2 || setting === 4 || setting === 6 || setting === 8;\n}\n\nfunction matchesEvent(setting, event, has_rmb) {\n\tif ( wantsRMB(setting) && event.button !== 2 && ! has_rmb )\n\t\treturn false;\n\n\tif ( ! event.altKey && (setting === 3 || setting === 4) )\n\t\treturn false;\n\n\tif ( ! event.shiftKey && (setting === 5 || setting === 6) )\n\t\treturn false;\n\n\tif ( ! event.ctrlKey && (setting === 7 || setting === 8) )\n\t\treturn false;\n\n\treturn true;\n}\n\nfunction rotateButton(event) {\n\tconst target = event.currentTarget,\n\t\ticon = target && target.querySelector('figure');\n\tif ( ! icon || icon.classList.contains('ffz-i-t-reset-clicked') )\n\t\treturn;\n\n\ticon.classList.toggle('ffz-i-t-reset', false);\n\ticon.classList.toggle('ffz-i-t-reset-clicked', true);\n\n\tsetTimeout(() => {\n\t\ticon.classList.toggle('ffz-i-t-reset', true);\n\t\ticon.classList.toggle('ffz-i-t-reset-clicked', false);\n\t}, 500);\n}\n\nexport default class PlayerBase extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.css_tweaks');\n\n\t\tthis.onShortcut = this.onShortcut.bind(this);\n\n\t\tthis.LEFT_CONTROLS = LEFT_CONTROLS;\n\t\tthis.RIGHT_CONTROLS = RIGHT_CONTROLS;\n\n\t\tthis.registerSettings();\n\t}\n\n\tregisterSettings() {\n\t\tthis.settings.add('player.embed-metadata', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Embed and Popout',\n\t\t\t\ttitle: 'Show metadata when mousing over the player.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.cast-button.hide', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Hide the Cast button.',\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggleHide('player-cast', val)\n\t\t});\n\n\t\tthis.settings.add('player.clip-button.hide-native', {\n\t\t\tdefault: null,\n\t\t\trequires: ['player.clip-button.custom'],\n\t\t\tprocess: (ctx, val) => val ?? ctx.get('player.clip-button.custom'),\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Hide the native Clip button.',\n\t\t\t\tdescription: 'By default, this is enabled when using the setting to add a custom Clip button.'\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggle('player-hide-native-clip', val)\n\t\t});\n\n\t\tthis.settings.add('player.clip-button.custom', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Display a custom Clip button.',\n\t\t\t\tdescription: 'Add a custom Clip button to the player that better fits the style of the other buttons.'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\tthis.addClipButton(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.fade-pause-buffer', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Fade the player when paused or buffering to make the UI easier to see.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggle('player-fade-paused', val)\n\t\t});\n\n\t\tthis.settings.add('player.disable-content-warnings', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\ttitle: 'Do not display content warnings.',\n\t\t\t\tdescription: 'When this is enabled, FFZ will automatically skip content warnings. This feature is intended for use by adults only.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => {\n\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\tthis.skipContentWarnings(inst);\n\t\t\t}\n\t\t});\n\n\t\tif ( HAS_COMPRESSOR ) {\n\t\t\tthis.settings.add('player.compressor.enable', {\n\t\t\t\tdefault: true,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor @{\"description\": \"These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more.\"} >> General',\n\t\t\t\t\ttitle: 'Enable the audio compressor and add an `Audio Compressor` button to the player controls.',\n\t\t\t\t\tsort: -1000,\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t},\n\n\t\t\t\tchanged: () => {\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.addCompressorButton(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.default', {\n\t\t\t\tdefault: false,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> General',\n\t\t\t\t\ttitle: 'Enable the compressor by default.',\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t},\n\n\t\t\t\tchanged: () => {\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.compressPlayer(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.force-legacy', {\n\t\t\t\tdefault: false,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Force use of legacy browser API.',\n\t\t\t\t\tdescription: 'This setting forces FrankerFaceZ to attempt to use an older browser API to create the compressor. Please reset your player after changing this setting.',\n\t\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\t\tforce_seen: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.shortcut', {\n\t\t\t\tdefault: null,\n\t\t\t\trequires: ['player.compressor.enable'],\n\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\tif ( ! ctx.get('player.compressor.enable') )\n\t\t\t\t\t\treturn null;\n\t\t\t\t\treturn val;\n\t\t\t\t},\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> General',\n\t\t\t\t\ttitle: 'Shortcut Key',\n\t\t\t\t\tdescription: 'This key sequence can be used to toggle the compressor.',\n\t\t\t\t\tcomponent: 'setting-hotkey'\n\t\t\t\t},\n\t\t\t\tchanged: () => {\n\t\t\t\t\tthis.updateShortcut();\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.addCompressorButton(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif ( HAS_GAIN ) {\n\t\t\t\tthis.settings.add('player.gain.enable', {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tsort: -1,\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control @{\"sort\": 50, \"description\": \"Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses.\"}',\n\t\t\t\t\t\ttitle: 'Enable gain control when the audio compressor is enabled.',\n\t\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => {\n\t\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\t\tthis.compressPlayer(inst);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.no-volume', {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\trequires: ['player.gain.enable'],\n\t\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\t\tif ( ! ctx.get('player.gain.enable') )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn val;\n\t\t\t\t\t},\n\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Force built-in volume to 100% when the audio compressor is enabled.',\n\t\t\t\t\t\tdescription: 'With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.',\n\t\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: val => {\n\t\t\t\t\t\tthis.css_tweaks.toggleHide('player-gain-volume', val);\n\t\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\t\tthis.updateGainVolume(inst);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.scroll', {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Scroll Adjust',\n\t\t\t\t\t\tdescription: 'Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*',\n\t\t\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\t\t\tdata: SCROLL_OPTIONS\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.default', {\n\t\t\t\t\tdefault: 100,\n\t\t\t\t\trequires: ['player.gain.min', 'player.gain.max'],\n\t\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\t\tconst min = ctx.get('player.gain.min'),\n\t\t\t\t\t\t\tmax = ctx.get('player.gain.max');\n\n\t\t\t\t\t\tval /= 100;\n\n\t\t\t\t\t\tif ( val < min )\n\t\t\t\t\t\t\tval = min;\n\t\t\t\t\t\tif ( val > max )\n\t\t\t\t\t\t\tval = max;\n\n\t\t\t\t\t\treturn val;\n\t\t\t\t\t},\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Default Value',\n\t\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\t\tdescription: 'The default value for gain control, when gain control is enabled. 100% means no change in volume.',\n\t\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\t\tbounds: [0, true]\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => this.updateGains()\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.min', {\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tprocess: (ctx, val) => val / 100,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Minimum',\n\t\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\t\tdescription: '**Range:** 0 ~ 100\\n\\nThe minimum allowed value for gain control. 0% is effectively muted.',\n\t\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\t\tbounds: [0, true, 100, true]\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => this.updateGains()\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.max', {\n\t\t\t\t\tdefault: 200,\n\t\t\t\t\tprocess: (ctx, val) => val / 100,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Maximum',\n\t\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\t\tdescription: '**Range:** 100 ~ 1000\\n\\nThe maximum allowed value for gain control. 100% is no change. 200% is double the volume.',\n\t\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\t\tbounds: [100, true, 1000, true]\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => this.updateGains()\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.settings.add('player.compressor.threshold', {\n\t\t\t\tdefault: -50,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced @{\"sort\": 1000}',\n\t\t\t\t\ttitle: 'Threshold',\n\t\t\t\t\tsort: 0,\n\t\t\t\t\tdescription: '**Range:** -100 ~ 0\\n\\nThe decibel value above which the compression will start taking effect.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\tbounds: [-100, true, 0, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.knee', {\n\t\t\t\tdefault: 40,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Knee',\n\t\t\t\t\tsort: 5,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 40\\n\\nA decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\tbounds: [0, true, 40, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.ratio', {\n\t\t\t\tdefault: 12,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Ratio',\n\t\t\t\t\tsort: 10,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 20\\n\\nThe amount of change, in dB, needed in the input for a 1 dB change in the output.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\tbounds: [0, true, 20, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.attack', {\n\t\t\t\tdefault: 0,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Attack',\n\t\t\t\t\tsort: 15,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 1\\n\\nThe amount of time, in seconds, required to reduce the gain by 10 dB.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_float',\n\t\t\t\t\tbounds: [0, true, 1, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.release', {\n\t\t\t\tdefault: 0.25,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Release',\n\t\t\t\t\tsort: 20,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 1\\nThe amount of time, in seconds, required to increase the gain by 10 dB.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_float',\n\t\t\t\t\tbounds: [0, true, 1, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\t\t}\n\n\t\tthis.settings.add('player.allow-catchup', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General @{\"sort\": -1000} >> General',\n\t\t\t\ttitle: 'Allow the player to speed up to reduce delay.',\n\t\t\t\tdescription: 'Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updatePlaybackRates()\n\t\t});\n\n\t\tthis.settings.add('player.mute-click', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Mute or unmute the player by middle-clicking.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.volume-scroll', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Adjust volume by scrolling with the mouse wheel.',\n\t\t\t\tdescription: '*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: SCROLL_OPTIONS\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.button.reset', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\ttitle: 'Add a `Reset Player` button to the player controls.',\n\t\t\t\tdescription: \"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\tthis.addResetButton(inst);\n\t\t\t}\n\t\t});\n\n\t\tif ( document.pictureInPictureEnabled )\n\t\t\tthis.settings.add('player.button.pip', {\n\t\t\t\tdefault: true,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\t\ttitle: 'Add a `Picture-in-Picture` button to the player controls.',\n\t\t\t\t\tdescription: \"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.\",\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t},\n\t\t\t\tchanged: () => {\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.addPiPButton(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.settings.add('player.volume-scroll-steps', {\n\t\t\tdefault: 0.1,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Volume scroll amount',\n\t\t\t\tdescription: 'How much the volume level is changed per individual scroll input.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0.1, title: '10%'},\n\t\t\t\t\t{value: 0.05, title: '5%'},\n\t\t\t\t\t{value: 0.02, title: '2%'},\n\t\t\t\t\t{value: 0.01, title: '1%'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.captions.font-size', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Font',\n\t\t\t\ttitle: 'Font Size',\n\t\t\t\tdescription: 'How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.',\n\t\t\t\tcomponent: 'setting-text-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.font-family', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Font',\n\t\t\t\ttitle: 'Font Family',\n\t\t\t\tdescription: 'Override the font used for displaying Closed Captions.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\tdata: () => getFontsList()\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\t/*this.settings.add('player.captions.custom-position', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\tsort: -1,\n\t\t\t\ttitle: 'Enable overriding the position and alignment of closed captions.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.vertical', {\n\t\t\tdefault: '10%',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\ttitle: 'Vertical Position',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tdescription: 'Override the position for Closed Captions. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.horizontal', {\n\t\t\tdefault: '50%',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\ttitle: 'Horizontal Position',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tdescription: 'Override the position for Closed Captions. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.alignment', {\n\t\t\tdefault: 32,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\ttitle: 'Alignment',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 11, title: 'Top Left'},\n\t\t\t\t\t{value: 12, title: 'Top Center'},\n\t\t\t\t\t{value: 13, title: 'Top Right'},\n\t\t\t\t\t{value: 21, title: 'Middle Left'},\n\t\t\t\t\t{value: 22, title: 'Middle Center'},\n\t\t\t\t\t{value: 23, title: 'Middle Right'},\n\t\t\t\t\t{value: 31, title: 'Bottom Left'},\n\t\t\t\t\t{value: 32, title: 'Bottom Center'},\n\t\t\t\t\t{value: 33, title: 'Bottom Right'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});*/\n\n\t\tthis.settings.add('player.ext-hide', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Extensions',\n\t\t\t\ttitle: 'Show Overlay Extensions',\n\t\t\t\tdescription: '**Note**: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security. To prevent extensions from loading entirely, we recommend using the [Disable Twitch Extensions browser extension](https://twitch-tools.rootonline.de/disable_twitch_extensions.php) by CommanderRoot.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 2, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'With Controls'},\n\t\t\t\t\t{value: 0, title: 'Always'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: val => this.updateHideExtensions(val)\n\t\t});\n\n\t\tthis.settings.add('player.ext-interaction', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Extensions',\n\t\t\t\ttitle: 'Allow mouse interaction with overlay extensions.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('player-ext-mouse', !val)\n\t\t})\n\n\t\tthis.settings.add('player.no-autoplay', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Do not automatically start playing videos or streams.',\n\t\t\t\tdescription: 'Note: This feature does not apply when navigating directly from channel to channel.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.vod.autoplay', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Auto-play the next recommended video after a video finishes.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.volume-always-shown', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Keep the volume slider expanded at all times.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('player-volume', val)\n\t\t});\n\n\t\tthis.settings.add('player.hide-mouse', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\ttitle: \"Hide mouse when controls aren't visible.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('player-hide-mouse', val)\n\t\t});\n\n\t\tthis.settings.add('player.single-click-pause', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: \"Pause/Unpause the player by clicking.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\t}\n\n\tasync onEnable() {\n\t\tawait this.settings.awaitProvider();\n\t\tawait this.settings.provider.awaitReady();\n\n\t\tthis.css_tweaks.toggleHide('player-cast', this.settings.get('player.cast-button.hide'));\n\t\tthis.css_tweaks.toggleHide('player-gain-volume', this.settings.get('player.gain.no-volume'));\n\t\tthis.css_tweaks.toggle('player-hide-native-clip', this.settings.get('player.clip-button.hide-native'));\n\t\tthis.css_tweaks.toggle('player-volume', this.settings.get('player.volume-always-shown'));\n\t\tthis.css_tweaks.toggle('player-ext-mouse', !this.settings.get('player.ext-interaction'));\n\t\tthis.css_tweaks.toggle('player-hide-mouse', this.settings.get('player.hide-mouse'));\n\t\tthis.css_tweaks.toggle('player-fade-paused', this.settings.get('player.fade-pause-buffer'));\n\n\t\tthis.installVisibilityHook();\n\t\tthis.updateHideExtensions();\n\t\tthis.updateCaptionsCSS();\n\t\tthis.updateShortcut();\n\n\t\tthis.on(':reset', this.resetAllPlayers, this);\n\n\t\tthis.Player.ready((cls, instances) => {\n\t\t\tthis.modifyPlayerClass(cls);\n\n\t\t\tfor(const inst of instances) {\n\t\t\t\tconst events = inst.props?.playerEvents;\n\t\t\t\tif ( events ) {\n\t\t\t\t\toff(events, 'Playing', inst.setPlayerActive);\n\t\t\t\t\toff(events, 'PlayerSeekCompleted', inst.setPlayerActive);\n\t\t\t\t}\n\n\t\t\t\tinst.ffzMaybeRemoveNativeListeners();\n\t\t\t\tinst.maybeAttachDomEventListeners();\n\t\t\t\tinst.ffzScheduleState();\n\n\t\t\t\tif ( events ) {\n\t\t\t\t\ton(events, 'Playing', inst.setPlayerActive);\n\t\t\t\t\ton(events, 'PlayerSeekCompleted', inst.setPlayerActive);\n\t\t\t\t}\n\n\t\t\t\tthis.updateGUI(inst);\n\t\t\t\tthis.compressPlayer(inst);\n\t\t\t\tthis.updatePlaybackRate(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.Player.on('mount', inst => {\n\t\t\tthis.updateGUI(inst);\n\t\t\tthis.compressPlayer(inst);\n\t\t\tthis.updatePlaybackRate(inst);\n\t\t});\n\t\tthis.Player.on('update', inst => {\n\t\t\tthis.updateGUI(inst);\n\t\t\tthis.compressPlayer(inst);\n\t\t\tthis.updatePlaybackRate(inst);\n\t\t});\n\n\t\tthis.Player.on('unmount', inst => {\n\t\t\tinst.ffzUninstall();\n\t\t});\n\n\t\tthis.on('i18n:update', () => {\n\t\t\tfor(const inst of this.Player.instances) {\n\t\t\t\tthis.updateGUI(inst);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateShortcut() {\n\t\tconst Mousetrap = this.Mousetrap = this.Mousetrap || this.resolve('site.web_munch')?.getModule?.('mousetrap') || window.Mousetrap;\n\t\tif ( ! Mousetrap || ! Mousetrap.bind )\n\t\t\treturn;\n\n\t\tif ( this._shortcut_bound ) {\n\t\t\tMousetrap.unbind(this._shortcut_bound);\n\t\t\tthis._shortcut_bound = null;\n\t\t}\n\n\t\tconst key = this.settings.get('player.compressor.shortcut');\n\t\tif ( HAS_COMPRESSOR && key && isValidShortcut(key) ) {\n\t\t\tMousetrap.bind(key, this.onShortcut);\n\t\t\tthis._shortcut_bound = key;\n\t\t}\n\t}\n\n\n\tonShortcut(e) {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.compressPlayer(inst, e);\n\t}\n\n\n\tmodifyPlayerClass(cls) {\n\t\tconst t = this,\n\t\t\told_attach = cls.prototype.maybeAttachDomEventListeners;\n\n\t\tcls.prototype.ffzInstall = function() {\n\t\t\tif ( this._ffz_installed )\n\t\t\t\treturn;\n\n\t\t\tthis._ffz_installed = true;\n\n\t\t\t//if ( ! this._ffzUpdateVolume )\n\t\t\t//\tthis._ffzUpdateVolume = debounce(this.ffzUpdateVolume.bind(this));\n\n\t\t\tif ( ! this._ffzUpdateState )\n\t\t\t\tthis._ffzUpdateState = this.ffzUpdateState.bind(this);\n\n\t\t\tif ( ! this._ffzErrorReset )\n\t\t\t\tthis._ffzErrorReset = t.addErrorResetButton.bind(t, this);\n\n\t\t\tif ( ! this._ffzReady )\n\t\t\t\tthis._ffzReady = this.ffzReady.bind(this);\n\n\t\t\tconst inst = this,\n\t\t\t\told_active = this.setPlayerActive,\n\t\t\t\told_inactive = this.setPlayerInactive;\n\n\t\t\tthis.setPlayerActive = function() {\n\t\t\t\tinst.ffzScheduleState();\n\t\t\t\treturn old_active.call(inst);\n\t\t\t}\n\n\t\t\tthis.setPlayerInactive = function() {\n\t\t\t\tinst.ffzScheduleState();\n\t\t\t\treturn old_inactive.call(inst);\n\t\t\t}\n\n\t\t\tthis.ffzOnEnded = () => {\n\t\t\t\tif ( t.settings.get('player.vod.autoplay') )\n\t\t\t\t\treturn;\n\n\t\t\t\tt.parent.awaitElement(\n\t\t\t\t\t'.autoplay-vod__content-container button',\n\t\t\t\t\tthis.props.containerRef || t.fine.getChildNode(this),\n\t\t\t\t\t1000\n\t\t\t\t).then(el => el.click());\n\t\t\t}\n\n\t\t\tconst events = this.props.playerEvents;\n\t\t\tif ( events ) {\n\t\t\t\ton(events, 'Buffering', this._ffzUpdateState);\n\t\t\t\ton(events, 'Playing', this._ffzUpdateState);\n\t\t\t\ton(events, 'PlayerError', this._ffzUpdateState);\n\t\t\t\ton(events, 'PlayerError', this._ffzErrorReset);\n\t\t\t\ton(events, 'Ended', this._ffzUpdateState);\n\t\t\t\ton(events, 'Ended', this.ffzOnEnded);\n\t\t\t\ton(events, 'Ready', this._ffzReady);\n\t\t\t\ton(events, 'Idle', this._ffzUpdateState);\n\t\t\t}\n\n\t\t\tthis.ffzStopAutoplay();\n\t\t}\n\n\t\t/*cls.prototype.ffzUpdateVolume = function() {\n\t\t\tif ( document.hidden )\n\t\t\t\treturn;\n\n\t\t\tconst player = this.props.mediaPlayerInstance,\n\t\t\t\tvideo = player?.mediaSinkManager?.video || player?.core?.mediaSinkManager?.video;\n\t\t\tif ( video ) {\n\t\t\t\tconst volume = video.volume,\n\t\t\t\t\tmuted = player.isMuted();\n\t\t\t\tif ( ! video.muted && player.getVolume() !== volume ) {\n\t\t\t\t\tplayer.setVolume(volume);\n\t\t\t\t\tplayer.setMuted(muted);\n\t\t\t\t}\n\t\t\t}\n\t\t}*/\n\n\t\tcls.prototype.ffzUninstall = function() {\n\t\t\tif ( this._ffz_state_raf )\n\t\t\t\tcancelAnimationFrame(this._ffz_state_raf);\n\n\t\t\tconst events = this.props.playerEvents;\n\t\t\tif ( events && this._ffzUpdateState ) {\n\t\t\t\toff(events, 'Playing', this._ffzUpdateState);\n\t\t\t\toff(events, 'PlayerError', this._ffzUpdateState);\n\t\t\t\toff(events, 'PlayerError', this._ffzErrorReset);\n\t\t\t\toff(events, 'Ended', this._ffzUpdateState);\n\t\t\t\toff(events, 'Ended', this.ffzOnEnded);\n\t\t\t\toff(events, 'Ready', this._ffzReady);\n\t\t\t\toff(events, 'Idle', this._ffzUpdateState);\n\t\t\t}\n\n\t\t\tthis.ffzRemoveListeners();\n\n\t\t\tthis._ffz_state_raf = null;\n\t\t\tthis._ffzUpdateState = null;\n\t\t\tthis._ffzErrorReset = null;\n\t\t\tthis._ffzReady = null;\n\t\t\tthis.ffzOnEnded = null;\n\t\t}\n\n\t\tcls.prototype.ffzReady = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont )\n\t\t\t\treturn;\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst icons = cont.querySelectorAll('.ffz--player-reset figure');\n\t\t\t\tfor(const icon of icons) {\n\t\t\t\t\tif ( icon._ffz_unspin )\n\t\t\t\t\t\tclearTimeout(icon._ffz_unspin);\n\n\t\t\t\t\ticon.classList.toggle('loading', false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tcls.prototype.ffzStopAutoplay = function() {\n\t\t\tif ( t.shouldStopAutoplay(this) )\n\t\t\t\tt.stopPlayer(this.props.mediaPlayerInstance, this.props.playerEvents, this);\n\t\t}\n\n\t\tcls.prototype.ffzScheduleState = function() {\n\t\t\tif ( ! this._ffzUpdateState )\n\t\t\t\tthis._ffzUpdateState = this.ffzUpdateState.bind(this);\n\n\t\t\tif ( ! this._ffz_state_raf )\n\t\t\t\tthis._ffz_state_raf = requestAnimationFrame(this._ffzUpdateState);\n\t\t}\n\n\t\tcls.prototype.ffzUpdateState = function() {\n\t\t\tthis._ffz_state_raf = null;\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont )\n\t\t\t\treturn;\n\n\t\t\tconst ds = cont.dataset;\n\t\t\tds.controls = this.state?.active || false;\n\n\t\t\tlet player = this.props.mediaPlayerInstance;\n\t\t\tif ( ! player )\n\t\t\t\treturn;\n\n\t\t\tif ( player.core )\n\t\t\t\tplayer = player.core;\n\n\t\t\tconst state = player.state?.state,\n\t\t\t\tvideo = player.mediaSinkManager?.video;\n\n\t\t\tif ( state === 'Playing' ) {\n\t\t\t\tif ( video?._ffz_maybe_compress ) {\n\t\t\t\t\tvideo._ffz_maybe_compress = false;\n\t\t\t\t\tt.compressPlayer(this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( video && video._ffz_compressed != null )\n\t\t\t\tds.compressed = video._ffz_compressed;\n\n\t\t\tds.ended = state === 'Ended';\n\t\t\tds.paused = state === 'Idle';\n\t\t\tds.buffering = state === 'Buffering';\n\t\t}\n\n\t\tcls.prototype.ffzAttachListeners = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont || this._ffz_listeners )\n\t\t\t\treturn;\n\n\t\t\tthis._ffz_listeners = true;\n\t\t\tif ( ! this._ffz_scroll_handler )\n\t\t\t\tthis._ffz_scroll_handler = this.ffzScrollHandler.bind(this);\n\n\t\t\tif ( ! this._ffz_click_handler )\n\t\t\t\tthis._ffz_click_handler = this.ffzClickHandler.bind(this);\n\n\t\t\tif ( ! this._ffz_dblclick_handler )\n\t\t\t\tthis._ffz_dblclick_handler = this.ffzDblClickHandler.bind(this);\n\n\t\t\tif ( ! this._ffz_menu_handler )\n\t\t\t\tthis._ffz_menu_handler = this.ffzMenuHandler.bind(this);\n\n\t\t\ton(cont, 'wheel', this._ffz_scroll_handler);\n\t\t\ton(cont, 'dblclick', this._ffz_dblclick_handler);\n\t\t\ton(cont, 'mousedown', this._ffz_click_handler);\n\t\t\ton(cont, 'contextmenu', this._ffz_menu_handler);\n\t\t}\n\n\t\tcls.prototype.ffzRemoveListeners = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont || ! this._ffz_listeners )\n\t\t\t\treturn;\n\n\t\t\tif ( this._ffz_scroll_handler ) {\n\t\t\t\toff(cont, 'wheel', this._ffz_scroll_handler);\n\t\t\t\tthis._ffz_scroll_handler = null;\n\t\t\t}\n\n\t\t\tif ( this._ffz_click_handler ) {\n\t\t\t\toff(cont, 'mousedown', this._ffz_click_handler);\n\t\t\t\tthis._ffz_click_handler = null;\n\t\t\t}\n\n\t\t\tif ( this._ffz_menu_handler ) {\n\t\t\t\toff(cont, 'contextmenu', this._ffz_menu_handler);\n\t\t\t\tthis._ffz_menu_handler = null;\n\t\t\t}\n\n\t\t\tif ( this._ffz_dblclick_handler ) {\n\t\t\t\toff(cont, 'dblclick', this._ffz_dblclick_handler);\n\t\t\t\tthis._ffz_dblclick_handler = null;\n\t\t\t}\n\n\t\t\tthis._ffz_listeners = false;\n\t\t}\n\n\t\tcls.prototype.ffzDelayPause = function() {\n\t\t\tif ( this._ffz_pause_timer )\n\t\t\t\tclearTimeout(this._ffz_pause_timer);\n\n\t\t\tconst player = this.props?.mediaPlayerInstance;\n\t\t\tif (! player.isPaused())\n\t\t\t\tthis._ffz_pause_timer = setTimeout(() => {\n\t\t\t\t\tconst player = this.props?.mediaPlayerInstance;\n\t\t\t\t\tif (!player.isPaused())\n\t\t\t\t\t\tplayer.pause();\n\t\t\t\t}, 500);\n\t\t}\n\n\t\tcls.prototype.ffzDblClickHandler = function(event) {\n\t\t\tif ( ! event )\n\t\t\t\treturn;\n\n\t\t\tif ( this._ffz_pause_timer )\n\t\t\t\tclearTimeout(this._ffz_pause_timer);\n\t\t}\n\n\t\tcls.prototype.ffzClickHandler = function(event) {\n\t\t\tif ( ! event )\n\t\t\t\treturn;\n\n\t\t\tconst vol_scroll = t.settings.get('player.volume-scroll'),\n\t\t\t\tgain_scroll = t.settings.get('player.gain.scroll'),\n\t\t\t\tclick_pause = t.settings.get('player.single-click-pause'),\n\n\t\t\t\twants_rmb = wantsRMB(vol_scroll) || wantsRMB(gain_scroll);\n\n\t\t\t// Left Click\n\t\t\tif (click_pause && event.button === 0) {\n\t\t\t\tif (! event.target || ! event.target.classList.contains('click-handler'))\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.ffzDelayPause();\n\t\t\t}\n\n\t\t\t// Right Click\n\t\t\tif ( wants_rmb && event.button === 2 ) {\n\t\t\t\tthis.ffz_rmb = true;\n\t\t\t\tthis.ffz_scrolled = false;\n\t\t\t}\n\n\t\t\t// Middle Click\n\t\t\tif ( ! t.settings.get('player.mute-click') || event.button !== 1 )\n\t\t\t\treturn;\n\n\t\t\tconst player = this.props?.mediaPlayerInstance;\n\t\t\tif ( ! player?.isMuted )\n\t\t\t\treturn;\n\n\t\t\tconst muted = ! player.isMuted();\n\t\t\tplayer.setMuted(muted);\n\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: muted}));\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n\t\tcls.prototype.ffzMenuHandler = function(event) {\n\t\t\tthis.ffz_rmb = false;\n\t\t\tif ( this.ffz_scrolled ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.ffzScrollHandler = function(event) {\n\t\t\tconst vol_scroll = t.settings.get('player.volume-scroll'),\n\t\t\t\tgain_scroll = t.settings.get('player.gain.scroll'),\n\t\t\t\tno_vol = t.settings.get('player.gain.no-volume'),\n\n\t\t\t\tmatches_gain = gain_scroll && matchesEvent(gain_scroll, event, this.ffz_rmb),\n\t\t\t\tmatches_vol = vol_scroll && matchesEvent(vol_scroll, event, this.ffz_rmb);\n\n\t\t\tif ( ! matches_gain && ! matches_vol )\n\t\t\t\treturn;\n\n\t\t\tconst delta = event.wheelDelta || -(event.deltaY || event.detail || 0),\n\t\t\t\tplayer = this.props?.mediaPlayerInstance,\n\t\t\t\tvideo = player?.mediaSinkManager?.video || player?.core?.mediaSinkManager?.video,\n\t\t\t\thas_gain = video?._ffz_compressed && video?._ffz_gain != null,\n\t\t\t\tdoing_gain = has_gain && matches_gain;\n\n\t\t\tif ( ! player?.getVolume )\n\t\t\t\treturn;\n\n\t\t\tif ( doing_gain ? wantsRMB(gain_scroll) : wantsRMB(vol_scroll) )\n\t\t\t\tthis.ffz_scrolled = true;\n\n\t\t\tconst amount = t.settings.get('player.volume-scroll-steps');\n\n\t\t\tif ( doing_gain ) {\n\t\t\t\tlet value = video._ffz_gain_value;\n\t\t\t\tif ( value == null )\n\t\t\t\t\tvalue = t.settings.get('player.gain.default');\n\n\t\t\t\tconst min = t.settings.get('player.gain.min'),\n\t\t\t\t\tmax = t.settings.get('player.gain.max');\n\n\t\t\t\tif ( delta > 0 )\n\t\t\t\t\tvalue += amount;\n\t\t\t\telse\n\t\t\t\t\tvalue -= amount;\n\n\t\t\t\tif ( value < min )\n\t\t\t\t\tvalue = min;\n\t\t\t\tif ( value > max )\n\t\t\t\t\tvalue = max;\n\n\t\t\t\tvideo._ffz_gain_value = value;\n\n\t\t\t\tif ( no_vol && value !== 0 ) {\n\t\t\t\t\tplayer.setMuted(false);\n\t\t\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: false}));\n\t\t\t\t}\n\n\t\t\t\tt.updateGain(this);\n\n\t\t\t} else if ( matches_vol && ! (video._ffz_compressed && no_vol) ) {\n\t\t\t\tconst old_volume = video?.volume ?? player.getVolume(),\n\t\t\t\t\tvolume = Math.max(0, Math.min(1, old_volume + (delta > 0 ? amount : -amount)));\n\n\t\t\t\tplayer.setVolume(volume);\n\t\t\t\tlocalStorage.volume = volume;\n\n\t\t\t\tif ( volume !== 0 ) {\n\t\t\t\t\tplayer.setMuted(false);\n\t\t\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: false}));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n\t\tcls.prototype.ffzMaybeRemoveNativeListeners = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( cont && this.listenersAttached ) {\n\t\t\t\toff(cont, 'mouseleave', this.setPlayerInactive);\n\t\t\t\toff(cont, 'mouseenter', this.setPlayerActive);\n\t\t\t\toff(cont, 'mousemove', this.onMouseMove);\n\t\t\t\tthis.listenersAttached = false;\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.maybeAttachDomEventListeners = function() {\n\t\t\ttry {\n\t\t\t\tthis.ffzInstall();\n\t\t\t\tthis.ffzAttachListeners();\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error attaching event listener.', err);\n\t\t\t}\n\n\t\t\treturn old_attach.call(this);\n\t\t}\n\t}\n\n\tshouldStopAutoplay() { // eslint-disable-line class-methods-use-this\n\t\treturn false;\n\t}\n\n\tinstallVisibilityHook() {\n\t\tif ( ! document.pictureInPictureEnabled ) {\n\t\t\tthis.log.info('Skipping visibility hooks. Picture-in-Picture is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst t = this;\n\n\t\tdocument.addEventListener('fullscreenchange', () => {\n\t\t\tconst fs = document.fullscreenElement,\n\t\t\t\tpip = document.pictureInPictureElement;\n\n\t\t\tif ( fs && pip && (fs === pip || fs.contains(pip)) )\n\t\t\t\tdocument.exitPictureInPicture();\n\n\t\t\t// Update the UI since we can't enter PiP from Fullscreen\n\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\tthis.addPiPButton(inst);\n\t\t});\n\n\t\ttry {\n\t\t\tObject.defineProperty(document, 'hidden', {\n\t\t\t\tconfigurable: true,\n\t\t\t\tget() {\n\t\t\t\t\t// If Picture in Picture is active, then we should not\n\t\t\t\t\t// drop quality. Therefore, we need to trick Twitch\n\t\t\t\t\t// into thinking the document is still active.\n\t\t\t\t\tif ( document.pictureInPictureElement != null )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tif ( t.settings.get('player.force-visible') )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\treturn document.visibilityState === 'hidden';\n\t\t\t\t}\n\t\t\t});\n\n\t\t} catch(err) {\n\t\t\tthis.log.warn('Unable to install document visibility hook.', err);\n\t\t}\n\t}\n\n\tstopPlayer(player, events, inst) {\n\t\tif ( player && player.pause && (player.getState?.() || player.core?.getState?.()) === 'Playing' )\n\t\t\tplayer.pause();\n\t\telse if ( events && ! events._ffz_stopping ) {\n\t\t\tevents._ffz_stopping = true;\n\n\t\t\tconst immediatePause = () => {\n\t\t\t\tif ( inst.props.mediaPlayerInstance?.pause ) {\n\t\t\t\t\tinst.props.mediaPlayerInstance.pause();\n\t\t\t\t\toff(events, 'Playing', immediatePause);\n\t\t\t\t\tevents._ffz_stopping = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.log.info('Unable to immediately pause. Listening for playing event.');\n\t\t\ton(events, 'Playing', immediatePause);\n\t\t}\n\t}\n\n\tupdateCaptionsCSS() {\n\t\t// Font\n\t\tconst font_out = [];\n\n\t\tconst font_size = this.settings.get('player.captions.font-size');\n\t\tlet font_family = this.settings.get('player.captions.font-family');\n\n\t\tif ( font_family && font_family.length ) {\n\t\t\tconst [processed, unloader] = useFont(font_family);\n\t\t\tfont_family = processed;\n\n\t\t\tif ( this._font_unloader )\n\t\t\t\tthis._font_unloader();\n\n\t\t\tthis._font_unloader = unloader;\n\n\t\t\tif ( font_family.indexOf(' ') !== -1 && font_family.indexOf(',') === -1 && font_family.indexOf('\"') === -1 && font_family.indexOf(\"'\") === -1 )\n\t\t\t\tfont_family = `\"${font_family}\"`;\n\n\t\t\tSTYLE_VALIDATOR.style.fontFamily = '';\n\t\t\tSTYLE_VALIDATOR.style.fontFamily = font_family;\n\n\t\t\tif ( STYLE_VALIDATOR.style.fontFamily )\n\t\t\t\tfont_out.push(`font-family: ${STYLE_VALIDATOR.style.fontFamily} !important;`);\n\t\t}\n\n\t\tSTYLE_VALIDATOR.style.fontSize = '';\n\t\tSTYLE_VALIDATOR.style.fontSize = font_size;\n\n\t\tif ( STYLE_VALIDATOR.style.fontSize )\n\t\t\tfont_out.push(`font-size: ${STYLE_VALIDATOR.style.fontSize} !important;`);\n\n\t\tif ( font_out.length )\n\t\t\tthis.css_tweaks.set('captions-font', `.player-captions-container__caption-line {\n\t${font_out.join('\\n\\t')}\n}`)\n\t\telse\n\t\t\tthis.css_tweaks.delete('captions-font');\n\n\t\t// Position\n\t\t/*const enabled = this.settings.get('player.captions.custom-position'),\n\t\t\tvertical = this.settings.get('player.captions.vertical'),\n\t\t\thorizontal = this.settings.get('player.captions.horizontal'),\n\t\t\talignment = this.settings.get('player.captions.alignment');\n\n\t\tif ( ! enabled ) {\n\t\t\tthis.css_tweaks.delete('captions-position');\n\t\t\treturn;\n\t\t}\n\n\t\tconst out = [], align_out = [],\n\t\t\talign_horizontal = alignment % 10,\n\t\t\talign_vertical = Math.floor(alignment / 10);\n\n\t\tlet custom_top = false,\n\t\t\tcustom_left = false;\n\n\t\tSTYLE_VALIDATOR.style.top = '';\n\t\tSTYLE_VALIDATOR.style.top = vertical;\n\t\tif ( STYLE_VALIDATOR.style.top ) {\n\t\t\tout.push(`${align_vertical === 3 ? 'bottom' : 'top'}: ${STYLE_VALIDATOR.style.top} !important;`)\n\t\t\tout.push(`${align_vertical === 3 ? 'top' : 'bottom'}: unset !important;`);\n\t\t\tcustom_top = true;\n\t\t}\n\n\t\tSTYLE_VALIDATOR.style.top = '';\n\t\tSTYLE_VALIDATOR.style.top = horizontal;\n\t\tif ( STYLE_VALIDATOR.style.top ) {\n\t\t\tif ( align_horizontal === 1 )\n\t\t\t\talign_out.push(`align-items: flex-start !important;`);\n\t\t\telse if ( align_horizontal === 3 )\n\t\t\t\talign_out.push(`align-items: flex-end !important;`);\n\n\t\t\tout.push(`${align_horizontal === 3 ? 'right' : 'left'}: ${STYLE_VALIDATOR.style.top} !important;`);\n\t\t\tout.push(`${align_horizontal === 3 ? 'left' : 'right'}: unset !important;`);\n\t\t\tcustom_left = true;\n\t\t}\n\n\t\tif ( align_horizontal !== 2 )\n\t\t\tout.push(`width: unset !important;`);\n\n\t\tout.push(`transform: translate(${(!custom_left || align_horizontal === 2) ? '-50%' : '0'}, ${(!custom_top || align_vertical === 2) ? '-50%' : '0'})`);\n\n\t\tthis.css_tweaks.set('captions-position', `.player-captions-container {\n\t${out.join('\\n\\t')};\n}${align_out.length ? `.player-captions-container__caption-window {\n\t${align_out.join('\\n\\t')}\n}` : ''}`);*/\n\t}\n\n\tupdateHideExtensions(val) {\n\t\tif ( val === undefined )\n\t\t\tval = this.settings.get('player.ext-hide');\n\n\t\tthis.css_tweaks.toggleHide('player-ext-hover', val === 1);\n\t\tthis.css_tweaks.toggleHide('player-ext', val === 2);\n\t}\n\n\tskipContentWarnings(inst) {\n\t\tif ( ! this.settings.get('player.disable-content-warnings') )\n\t\t\treturn;\n\n\t\tconst cont = this.fine.getHostNode(inst),\n\t\t\tbtn = cont && cont.querySelector('button[data-a-target=\"content-classification-gate-overlay-start-watching-button\"]');\n\n\t\tif ( btn )\n\t\t\tbtn.click();\n\t}\n\n\tupdateGUI(inst) {\n\t\tthis.skipContentWarnings(inst);\n\t\tthis.addPiPButton(inst);\n\t\tthis.addResetButton(inst);\n\t\tthis.addClipButton(inst);\n\t\tthis.addCompressorButton(inst, false);\n\t\tthis.addGainSlider(inst, false);\n\t\tthis.addMetadata(inst);\n\n\t\t//if ( inst._ffzUpdateVolume )\n\t\t//\tinst._ffzUpdateVolume();\n\n\t\tthis.emit(':update-gui', inst);\n\t}\n\n\tareControlsDisabled(inst) {\n\t\tif ( ! inst._ffz_control_state )\n\t\t\tthis.findControlState(inst);\n\n\t\tif ( inst._ffz_control_state )\n\t\t\treturn inst._ffz_control_state.props.disableControls;\n\n\t\treturn false;\n\t}\n\n\tfindControlState(inst) {\n\t\tif ( ! inst._ffz_control_state )\n\t\t\tinst._ffz_control_state = this.fine.searchTree(inst, n => n.props && has(n.props, 'disableControls'), 200);\n\t}\n\n\taddGainSlider(inst, visible_only, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video || inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,\n\t\t\tcontainer = outer && outer.querySelector(LEFT_CONTROLS);\n\t\tlet gain = video != null && video._ffz_compressed && video._ffz_gain;\n\n\t\tif ( this.areControlsDisabled(inst) )\n\t\t\tgain = null;\n\n\t\tif ( ! container ) {\n\t\t\tif ( video && ! gain )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addGainSlider.bind(this, inst, visible_only, (tries || 0) + 1), 250);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst min = this.settings.get('player.gain.min'),\n\t\t\tmax = this.settings.get('player.gain.max');\n\n\t\tif ( min >= max || max <= min )\n\t\t\tgain = null;\n\n\t\tlet tip, tipcont, input, extra, fill, cont = container.querySelector('.ffz--player-gain');\n\t\tif ( ! gain ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tconst on_change = () => {\n\t\t\t\tlet value = input.value / 100;\n\n\t\t\t\tconst min = this.settings.get('player.gain.min'),\n\t\t\t\t\tmax = this.settings.get('player.gain.max');\n\n\t\t\t\tif ( value < min )\n\t\t\t\t\tvalue = min;\n\t\t\t\tif ( value > max )\n\t\t\t\t\tvalue = max;\n\n\t\t\t\tif ( value == video._ffz_gain_value )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\t\t\tcore = player.core || player;\n\n\t\t\t\tif ( ! this.areControlsDisabled(inst) && value > 0 && this.settings.get('player.gain.no-volume') && core?.isMuted?.() ) {\n\t\t\t\t\tcore.setMuted(false);\n\t\t\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: false}));\n\t\t\t\t}\n\n\t\t\t\tvideo._ffz_gain_value = value;\n\t\t\t\tgain.gain.value = value;\n\n\t\t\t\tconst range = max - min,\n\t\t\t\t\twidth = (value - min) / range;\n\n\t\t\t\tfill.style.width = `${width * 100}%`;\n\t\t\t\textra.textContent = `${Math.round(value * 100)}%`;\n\t\t\t};\n\n\t\t\tcont = (<div class=\"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container\">\n\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-full-height\">\n\t\t\t\t\t<label class=\"tw-hide-accessible\">{this.i18n.t('player.gain.label','Gain Control')}</label>\n\t\t\t\t\t<div class=\"tw-flex tw-full-width tw-relative tw-z-above\">\n\t\t\t\t\t\t{input = (<input\n\t\t\t\t\t\t\tclass=\"ffz-range ffz-range--overlay\"\n\t\t\t\t\t\t\ttype=\"range\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\t\tstep=\"1\"\n\t\t\t\t\t\t\tdata-a-target=\"player-gain-slider\"\n\t\t\t\t\t\t\tvalue=\"100\"\n\t\t\t\t\t\t/>)}\n\t\t\t\t\t\t<div class=\"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below\">\n\t\t\t\t\t\t\t<div class=\"tw-border-radius-large ffz-range__fill-container\">\n\t\t\t\t\t\t\t\t{fill = (<div\n\t\t\t\t\t\t\t\t\tclass=\"tw-border-radius-large ffz-range__fill-value ffz--gain-value\"\n\t\t\t\t\t\t\t\t\tdata-test-selector=\"ffz-range__fill-value-selector\"\n\t\t\t\t\t\t\t\t/>)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{tipcont = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up\" role=\"tooltip\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{tip = (<div class=\"ffz--p-tip\" />)}\n\t\t\t\t\t\t{extra = (<div class=\"tw-regular ffz--p-value\" />)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>)}\n\t\t\t</div>);\n\n\t\t\t/*input.addEventListener('contextmenu', e => {\n\t\t\t\tvideo._ffz_gain_value = null;\n\t\t\t\tthis.updateGain(inst);\n\t\t\t\te.preventDefault();\n\t\t\t});*/\n\t\t\tinput.addEventListener('input', on_change);\n\t\t\tcontainer.appendChild(cont);\n\n\t\t} else if ( visible_only )\n\t\t\treturn;\n\t\telse {\n\t\t\tinput = cont.querySelector('input');\n\t\t\tfill = cont.querySelector('.ffz--gain-value');\n\t\t\ttipcont = cont.querySelector('.ffz-il-tooltip');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip .ffz--p-tip');\n\t\t\textra = cont.querySelector('.ffz-il-tooltip .ffz--p-value');\n\t\t}\n\n\t\tlet value = video._ffz_gain_value;\n\t\tif ( value == null )\n\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\tinput.min = min * 100;\n\t\tinput.max = max * 100;\n\t\tinput.value = value * 100;\n\n\t\tconst range = max - min,\n\t\t\twidth = (value - min) / range;\n\n\t\tfill.style.width = `${width * 100}%`;\n\n\t\ttip.textContent = this.i18n.t('player.gain.label', 'Gain Control');\n\t\textra.textContent = `${Math.round(value * 100)}%`;\n\t}\n\n\taddCompressorButton(inst, visible_only, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video || inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,\n\t\t\tcontainer = outer && outer.querySelector(LEFT_CONTROLS),\n\t\t\thas_comp = HAS_COMPRESSOR && video != null && this.settings.get('player.compressor.enable');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_comp )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addCompressorButton.bind(this, inst, visible_only, (tries || 0) + 1), 250);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet icon, tip, extra, btn, cont = container.querySelector('.ffz--player-comp');\n\t\tif ( ! has_comp || this.areControlsDisabled(inst) ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-comp-button\"\n\t\t\t\t\tonClick={this.compressPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t{icon = (<figure class=\"ffz-player-icon\" />)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up\" role=\"tooltip\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{tip = (<div class=\"ffz--p-tip\" />)}\n\t\t\t\t\t\t{extra = (<div class=\"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain\" />)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>);\n\n\t\t\tcontainer.appendChild(cont);\n\t\t} else if ( visible_only )\n\t\t\treturn;\n\t\telse {\n\t\t\ticon = cont.querySelector('figure');\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip .ffz--p-tip');\n\t\t\textra = cont.querySelector('.ffz-il-tooltip .ffz--p-extra');\n\t\t}\n\n\t\tconst comp_active = video._ffz_compressed,\n\t\t\tcan_apply = this.canCompress(inst);\n\t\tlet label = can_apply ?\n\t\t\tcomp_active ?\n\t\t\t\tthis.i18n.t('player.comp_button.off', 'Disable Audio Compressor') :\n\t\t\t\tthis.i18n.t('player.comp_button.on', 'Audio Compressor')\n\t\t\t: this.i18n.t('player.comp_button.disabled', 'Audio Compressor cannot be enabled when viewing Clips.');\n\n\t\textra.textContent = this.i18n.t('player.comp_button.help', 'See the FFZ Control Center for details. If audio breaks, please reset the player.');\n\n\t\tif ( can_apply && this._shortcut_bound )\n\t\t\tlabel = `${label} (${this._shortcut_bound})`;\n\n\t\ticon.classList.toggle('ffz-i-comp-on', comp_active);\n\t\ticon.classList.toggle('ffz-i-comp-off', ! comp_active);\n\t\tbtn.disabled = ! can_apply;\n\n\t\tbtn.setAttribute('aria-label', label);\n\t\ttip.textContent = label;\n\t}\n\n\treplaceVideoElement(player, video) {\n\t\tconst new_vid = createElement('video'),\n\t\t\tvol = video?._ffz_pregain_volume ?? video?.volume ?? player.getVolume(),\n\t\t\tmuted = player.isMuted();\n\n\t\tnew_vid._ffz_gain_value = video._ffz_gain_value;\n\t\tnew_vid._ffz_state = video._ffz_state;\n\t\tnew_vid._ffz_toggled = video._ffz_toggled;\n\t\tnew_vid._ffz_maybe_compress = video._ffz_compressed;\n\t\tnew_vid.volume = vol;\n\t\tif ( muted )\n\t\t\tnew_vid.muted = true;\n\t\tnew_vid.playsInline = true;\n\n\t\tthis.installPlaybackRate(new_vid);\n\t\tvideo.replaceWith(new_vid);\n\t\tplayer.attachHTMLVideoElement(new_vid);\n\t\treturn new_vid;\n\t}\n\n\thookPlayerLoad(player) {\n\t\tif ( ! player || player._ffz_load )\n\t\t\treturn;\n\n\t\tplayer._ffz_load = player.load;\n\n\t\tplayer.load = (...args) => {\n\t\t\ttry {\n\t\t\t\tconst video = player.getHTMLVideoElement();\n\t\t\t\tif ( video?._ffz_compressor && player.attachHTMLVideoElement ) {\n\t\t\t\t\tthis.log.info('Recreating video element due to player load with compressor installed.');\n\t\t\t\t\tthis.replaceVideoElement(player, video);\n\t\t\t\t}\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error while handling player load.', err);\n\t\t\t}\n\n\t\t\treturn player._ffz_load(...args);\n\t\t}\n\t}\n\n\tcompressPlayer(inst, e) {\n\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\tcore = player.core || player,\n\t\t\tvideo = core?.mediaSinkManager?.video;\n\n\t\tif ( ! video || ! HAS_COMPRESSOR )\n\t\t\treturn;\n\n\t\t// Backup the player load method.\n\t\tthis.hookPlayerLoad(player);\n\n\t\t// Backup and replace the setSrc method.\n\t\tif ( ! inst._ffz_setSrc ) {\n\t\t\tinst._ffz_setSrc = inst.setSrc;\n\t\t\tinst.setSrc = async function(...args) {\n\t\t\t\tconsole.log('setSrc', args);\n\t\t\t\tconst vid = inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\t\t\t\tif ( vid && vid._ffz_compressor )\n\t\t\t\t\tawait this.resetPlayer(inst);\n\t\t\t\treturn inst._ffz_setSrc(...args);\n\t\t\t}\n\t\t}\n\n\t\t// Backup the setVolume method.\n\t\tif ( ! core._ffz_setVolume ) {\n\t\t\tcore._ffz_setVolume = core.setVolume;\n\t\t\tcore._ffz_fakeVolume = () => {};\n\t\t}\n\n\t\tvideo._ffz_maybe_compress = false;\n\t\tconst compressed = video._ffz_compressed || false;\n\t\tlet wanted = video._ffz_toggled ? video._ffz_state : this.settings.get('player.compressor.default');\n\t\tif ( e != null ) {\n\t\t\te.preventDefault();\n\t\t\tvideo._ffz_toggled = true;\n\t\t\twanted = ! video._ffz_compressed;\n\t\t\tvideo._ffz_state = wanted;\n\t\t}\n\n\t\tif ( ! video._ffz_compressor ) {\n\t\t\tif ( ! wanted )\n\t\t\t\treturn;\n\n\t\t\tthis.createCompressor(inst, video);\n\n\t\t} else if ( ! video._ffz_comp_reset && ! this.canCompress(inst) ) {\n\t\t\tvideo._ffz_comp_reset = true;\n\t\t\tthis.resetPlayer(inst);\n\t\t\treturn;\n\t\t}\n\n\t\tlet gain = video._ffz_gain;\n\t\tconst want_gain = HAS_GAIN && this.settings.get('player.gain.enable'),\n\t\t\thas_gain = gain != null;\n\n\t\tif ( ((wanted == compressed) || (e == null && video._ffz_toggled)) && has_gain == want_gain )\n\t\t\treturn;\n\n\t\tconst ctx = video._ffz_context,\n\t\t\tcomp = video._ffz_compressor,\n\t\t\tsrc = video._ffz_source;\n\n\t\tif ( ! ctx || ! comp || ! src )\n\t\t\treturn;\n\n\t\tif ( want_gain && ! gain ) {\n\t\t\tlet value = video._ffz_gain_value;\n\t\t\tif ( value == null )\n\t\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\t\ttry {\n\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\tthrow new Error();\n\n\t\t\t\tgain = video._ffz_gain = new GainNode(ctx, {\n\t\t\t\t\tgain: value\n\t\t\t\t});\n\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.info('Unable to use new GainNode. Falling back to old method.');\n\t\t\t\tgain = video._ffz_gain = ctx.createGain();\n\t\t\t\tgain.gain.value = value;\n\t\t\t}\n\n\t\t\tcomp.connect(gain);\n\n\t\t\tif ( compressed ) {\n\t\t\t\tcomp.disconnect(ctx.destination);\n\t\t\t\tgain.connect(ctx.destination);\n\t\t\t}\n\n\t\t} else if ( ! want_gain && gain ) {\n\t\t\tcomp.disconnect(gain);\n\t\t\tif ( compressed ) {\n\t\t\t\tgain.disconnect(ctx.destination);\n\t\t\t\tcomp.connect(ctx.destination);\n\t\t\t}\n\n\t\t\tgain = video._ffz_gain = null;\n\t\t}\n\n\t\tif ( wanted != compressed ) {\n\t\t\tif ( wanted ) {\n\t\t\t\tsrc.disconnect(ctx.destination);\n\t\t\t\tsrc.connect(comp);\n\t\t\t\tif ( gain ) {\n\t\t\t\t\tgain.connect(ctx.destination);\n\t\t\t\t\tif ( this.settings.get('player.gain.no-volume') ) {\n\t\t\t\t\t\tvideo._ffz_pregain_volume = core.getVolume();\n\t\t\t\t\t\tcore._ffz_setVolume(1);\n\t\t\t\t\t\tcore.setVolume = core._ffz_fakeVolume;\n\t\t\t\t\t}\n\n\t\t\t\t} else\n\t\t\t\t\tcomp.connect(ctx.destination);\n\t\t\t} else {\n\t\t\t\tsrc.disconnect(comp);\n\t\t\t\tif ( gain ) {\n\t\t\t\t\tgain.disconnect(ctx.destination);\n\t\t\t\t\tif ( video._ffz_pregain_volume != null ) {\n\t\t\t\t\t\tcore._ffz_setVolume(video._ffz_pregain_volume);\n\t\t\t\t\t\tcore.setVolume = core._ffz_setVolume;\n\t\t\t\t\t\tvideo._ffz_pregain_volume = null;\n\t\t\t\t\t}\n\n\t\t\t\t} else\n\t\t\t\t\tcomp.disconnect(ctx.destination);\n\t\t\t\tsrc.connect(ctx.destination);\n\t\t\t}\n\t\t}\n\n\t\tif ( inst.props.containerRef )\n\t\t\tinst.props.containerRef.dataset.compressed = wanted;\n\n\t\tvideo._ffz_compressed = wanted;\n\t\tthis.addCompressorButton(inst);\n\t\tthis.addGainSlider(inst);\n\t}\n\n\tupdateGainVolume(inst) {\n\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\tcore = player.core || player,\n\t\t\tvideo = core?.mediaSinkManager?.video;\n\n\t\tif ( ! video || ! video._ffz_compressed )\n\t\t\treturn;\n\n\t\tconst setting = this.settings.get('player.gain.no-volume');\n\n\t\tif ( setting && video._ffz_pregain_volume == null ) {\n\t\t\tvideo._ffz_pregain_volume = core.getVolume();\n\t\t\tcore._ffz_setVolume(1);\n\t\t\tcore.setVolume = core._ffz_fakeVolume;\n\n\t\t} else if ( ! setting && video._ffz_pregain_volume != null ) {\n\t\t\tcore._ffz_setVolume(video._ffz_pregain_volume);\n\t\t\tcore.setVolume = core._ffz_setVolume;\n\t\t\tvideo._ffz_pregain_volume = null;\n\t\t}\n\t}\n\n\tcanCompress(inst) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! HAS_COMPRESSOR )\n\t\t\treturn false;\n\n\t\tconst player = inst.props?.mediaPlayerInstance;\n\t\tif ( player == null )\n\t\t\treturn false;\n\n\t\tconst video = player.mediaSinkManager?.video || player.core?.mediaSinkManager?.video;\n\t\tif ( ! video )\n\t\t\treturn false;\n\n\t\tif ( ! video.src && ! video.srcObject )\n\t\t\treturn false;\n\n\t\tif ( video.src ) {\n\t\t\tconst url = new URL(video.src);\n\t\t\tif ( url.protocol !== 'blob:' )\n\t\t\t\treturn false;\n\t\t}\n\n\t\t// TODO: Validation for srcObject (if we need it)\n\n\t\treturn true;\n\t}\n\n\tcreateCompressor(inst, video, ctx) {\n\t\tif ( ! this.canCompress(inst) )\n\t\t\treturn;\n\n\t\tlet comp = video._ffz_compressor;\n\t\tif ( ! comp ) {\n\t\t\tctx = ctx || new AudioContext();\n\t\t\tif ( ctx.state === 'suspended' ) {\n\t\t\t\tlet timer;\n\t\t\t\tconst evt = () => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\tctx.removeEventListener('statechange', evt);\n\t\t\t\t\tif (ctx.state === 'suspended') {\n\t\t\t\t\t\tthis.log.debug('Aborting due to browser auto-play policy.');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.createCompressor(inst, video, ctx);\n\t\t\t\t}\n\n\t\t\t\tthis.log.debug('Attempting to resume suspended AudioContext.');\n\t\t\t\ttimer = setTimeout(evt, 100);\n\t\t\t\ttry {\n\t\t\t\t\tctx.addEventListener('statechange', evt);\n\t\t\t\t\tctx.resume();\n\t\t\t\t} catch(err) { }\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvideo._ffz_context = ctx;\n\t\t\tlet src;\n\t\t\ttry {\n\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\tthrow new Error();\n\n\t\t\t\tsrc = video._ffz_source = new MediaElementAudioSourceNode(ctx, {\n\t\t\t\t\tmediaElement: video\n\t\t\t\t});\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.info('Unable to use new MediaElementAudioSourceNode. Falling back to old method.');\n\t\t\t\tsrc = video._ffz_source = ctx.createMediaElementSource(video);\n\t\t\t}\n\n\t\t\tsrc.connect(ctx.destination);\n\n\t\t\ttry {\n\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\tthrow new Error();\n\n\t\t\t\tcomp = video._ffz_compressor = new DynamicsCompressorNode(ctx);\n\t\t\t} catch (err) {\n\t\t\t\tthis.log.info('Unable to use new DynamicsCompressorNode. Falling back to old method.');\n\t\t\t\tcomp = video._ffz_compressor = ctx.createDynamicsCompressor();\n\t\t\t}\n\n\t\t\tif ( this.settings.get('player.gain.enable') ) {\n\t\t\t\tlet gain;\n\t\t\t\tlet value = video._ffz_gain_value;\n\t\t\t\tif ( value == null )\n\t\t\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\t\t\ttry {\n\t\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\t\tthrow new Error();\n\n\t\t\t\t\tgain = video._ffz_gain = new GainNode(ctx, {\n\t\t\t\t\t\tgain: value\n\t\t\t\t\t});\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.log.info('Unable to use new GainNode. Falling back to old method.');\n\t\t\t\t\tgain = video._ffz_gain = ctx.createGain();\n\t\t\t\t\tgain.gain.value = value;\n\t\t\t\t}\n\n\t\t\t\tcomp.connect(gain);\n\t\t\t}\n\n\t\t\tvideo._ffz_compressed = false;\n\t\t}\n\n\t\tthis.updateCompressor(null, comp);\n\t}\n\n\tupdateGains() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.updateGain(inst);\n\t}\n\n\tupdateGain(inst, gain, video, update_gui = true) {\n\t\tif ( ! video )\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\n\t\tif ( gain == null )\n\t\t\tgain = video?._ffz_gain;\n\n\t\tif ( ! video || ! gain )\n\t\t\treturn;\n\n\t\tlet value = video._ffz_gain_value;\n\t\tif ( value == null )\n\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\tgain.gain.value = value;\n\t\tif ( update_gui )\n\t\t\tthis.addGainSlider(inst);\n\t}\n\n\tupdateCompressors() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.updateCompressor(inst);\n\t}\n\n\tupdateCompressor(inst, comp) {\n\t\tif ( comp == null ) {\n\t\t\tconst video = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\t\t\tcomp = video?._ffz_compressor;\n\t\t}\n\n\t\tif ( ! comp )\n\t\t\treturn;\n\n\t\tcomp.threshold.value = this.settings.get('player.compressor.threshold');\n\t\tcomp.knee.value = this.settings.get('player.compressor.knee');\n\t\tcomp.ratio.value = this.settings.get('player.compressor.ratio');\n\t\tcomp.attack.value = this.settings.get('player.compressor.attack');\n\t\tcomp.release.value = this.settings.get('player.compressor.release');\n\t}\n\n\tupdatePlaybackRates() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.updatePlaybackRate(inst);\n\t}\n\n\tupdatePlaybackRate(inst) {\n\t\tconst video = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\n\t\tif ( ! video.setFFZPlaybackRate )\n\t\t\tthis.installPlaybackRate(video);\n\n\t\tvideo.setFFZPlaybackRate(video.playbackRate);\n\t}\n\n\tinstallPlaybackRate(video) {\n\t\tif ( video.setFFZPlaybackRate )\n\t\t\treturn;\n\n\t\tlet pbrate = video.playbackRate;\n\n\t\tconst t = this,\n\t\t\tinstallProperty = () => {\n\t\t\t\tif ( t.settings.get('player.allow-catchup') )\n\t\t\t\t\treturn;\n\n\t\t\t\tObject.defineProperty(video, 'playbackRate', {\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tget() {\n\t\t\t\t\t\treturn pbrate;\n\t\t\t\t\t},\n\t\t\t\t\tset(val) {\n\t\t\t\t\t\tif ( val === 1 || val < 1 || val >= 1.1 )\n\t\t\t\t\t\t\tvideo.setFFZPlaybackRate(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\tvideo.setFFZPlaybackRate = rate => {\n\t\t\tdelete video.playbackRate;\n\t\t\tpbrate = rate;\n\t\t\tvideo.playbackRate = rate;\n\t\t\tinstallProperty();\n\t\t};\n\t}\n\n\n\taddPiPButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video || inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,\n\t\t\tis_fs = video && document.fullscreenElement && document.fullscreenElement.contains(video),\n\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS),\n\t\t\thas_pip = document.pictureInPictureEnabled && this.settings.get('player.button.pip');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_pip )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addPiPButton.bind(this, inst, (tries || 0) + 1), 250);\n\n\t\t\treturn; // this.log.warn('Unable to find container element for PiP button.');\n\t\t}\n\n\t\tlet icon, tip, btn, cont = container.querySelector('.ffz--player-pip');\n\t\tif ( ! has_pip ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-pip-button\"\n\t\t\t\t\tonClick={this.pipPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t{icon = (<figure class=\"ffz-player-icon\" />)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tconst thing = container.querySelector('button[data-a-target=\"player-theatre-mode-button\"]') ||\n\t\t\t\t//container.querySelector('div:not(:has(.tw-tooltip)) button:not([data-a-target])') ||\n\t\t\t\tcontainer.querySelector('button[aria-label*=\"Theat\"]') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-fullscreen-button\"]');\n\n\t\t\tif ( thing ) {\n\t\t\t\tcontainer.insertBefore(cont, thing.parentElement);\n\t\t\t} else\n\t\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\ticon = cont.querySelector('figure');\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tconst pip_active = !!document.pictureInPictureElement,\n\t\t\tpip_swap = false, //pip_active && document.pictureInPictureElement !== video,\n\t\t\tlabel = is_fs ?\n\t\t\t\tthis.i18n.t('player.pip_button.fs', 'Cannot use Picture-in-Picture when Fullscreen')\n\t\t\t\t: pip_swap ?\n\t\t\t\t\tthis.i18n.t('player.pip_button.swap', 'Switch Picture-in-Picture')\n\t\t\t\t\t: pip_active ?\n\t\t\t\t\t\tthis.i18n.t('player.pip_button.off', 'Exit Picture-in-Picture')\n\t\t\t\t\t\t: this.i18n.t('player.pip_button', 'Picture-in-Picture');\n\n\t\ticon.classList.toggle('ffz-i-t-pip-inactive', ! pip_active || pip_swap);\n\t\ticon.classList.toggle('ffz-i-t-pip-active', pip_active && ! pip_swap);\n\n\t\tbtn.setAttribute('aria-label', label);\n\t\ttip.textContent = label;\n\t}\n\n\n\tpipPlayer(inst, e) {\n\t\tconst video = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\t\tif ( ! video || ! document.pictureInPictureEnabled )\n\t\t\treturn;\n\n\t\tif ( e )\n\t\t\te.preventDefault();\n\n\t\tif ( document.fullscreenElement && document.fullscreenElement.contains(video) )\n\t\t\treturn;\n\n\t\tif ( ! video._ffz_pip_enter ) {\n\t\t\tvideo.addEventListener('enterpictureinpicture', video._ffz_pip_enter = () => {\n\t\t\t\tthis.addPiPButton(inst);\n\t\t\t});\n\n\t\t\tvideo.addEventListener('leavepictureinpicture', video._ffz_pip_exit = () => {\n\t\t\t\tthis.addPiPButton(inst);\n\t\t\t});\n\t\t}\n\n\t\t//const is_this = document.pictureInPictureElement === video;\n\t\tif ( document.pictureInPictureElement )\n\t\t\tdocument.exitPictureInPicture();\n\t\telse\n\t\t//if ( ! is_this )\n\t\t\tvideo.requestPictureInPicture();\n\t}\n\n\taddClipButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS),\n\t\t\thas_clip_button = this.settings.get('player.clip-button.custom');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_clip_button )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addClipButton.bind(this, inst, (tries || 0) + 1), 250);\n\n\t\t\treturn; // this.log.warn('Unable to find container element for Clip button.');\n\t\t}\n\n\t\tlet tip, btn, cont = container.querySelector('.ffz--player-clip');\n\t\tif ( ! has_clip_button ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (! container.ffz_native_clip || ! container.contains(container.ffz_native_clip) )\n\t\t\tcontainer.ffz_native_clip = getNativeClipButton(container);\n\n\t\tif ( ! cont ) {\n\t\t\t// We need the native clip button, so we can dispatch a click.\n\t\t\tconst on_click = e => {\n\t\t\t\tconst native = getNativeClipButton(container);\n\t\t\t\tif (native)\n\t\t\t\t\tnative.click();\n\t\t\t}\n\n\t\t\tcont = (<div class=\"ffz--player-clip tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-clip-button\"\n\t\t\t\t\tonClick={on_click}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-player-icon ffz-i-clip\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tconst thing = container.querySelector('.ffz--player-reset button') ||\n\t\t\t\tcontainer.querySelector('.ffz--player-pip button') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-theatre-mode-button\"]') ||\n\t\t\t\t//container.querySelector('div:not(:has(.tw-tooltip)) button:not([data-a-target])') ||\n\t\t\t\tcontainer.querySelector('button[aria-label*=\"Theat\"]') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-fullscreen-button\"]');\n\n\t\t\tif ( thing ) {\n\t\t\t\tcontainer.insertBefore(cont, thing.parentElement);\n\t\t\t} else\n\t\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tconst native = container.ffz_native_clip,\n\t\t\tdisabled = native\n\t\t\t\t? (native.disabled || native.ariaDisabled === 'true')\n\t\t\t\t: false;\n\n\t\tbtn.disabled = disabled;\n\t\tbtn.setAttribute('aria-label',\n\t\t\ttip.textContent = disabled\n\t\t\t\t? (native.ariaLabel || this.i18n.t(\n\t\t\t\t\t'player.clip-button.disabled',\n\t\t\t\t\t'Clips are Disabled'\n\t\t\t\t))\n\t\t\t\t: this.i18n.t(\n\t\t\t\t\t'player.clip-button',\n\t\t\t\t\t'Clip (Alt+X)'\n\t\t\t\t));\n\t}\n\n\tclickClip(inst, e) {\n\t\tconsole.log('clicked clip', inst, e);\n\t}\n\n\n\taddResetButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS),\n\t\t\thas_reset = this.settings.get('player.button.reset');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_reset )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addResetButton.bind(this, inst, (tries || 0) + 1), 250);\n\n\t\t\treturn; // this.log.warn('Unable to find container element for Reset button.');\n\t\t}\n\n\t\tlet tip, btn, cont = container.querySelector('.ffz--player-reset');\n\t\tif ( ! has_reset ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-reset-button\"\n\t\t\t\t\tonClick={rotateButton}\n\t\t\t\t\tonDblClick={this.resetPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-player-icon ffz-i-t-reset\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tconst thing = container.querySelector('.ffz--player-pip button') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-theatre-mode-button\"]') ||\n\t\t\t\t//container.querySelector('div:not(:has(.tw-tooltip)) button:not([data-a-target])') ||\n\t\t\t\tcontainer.querySelector('button[aria-label*=\"Theat\"]') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-fullscreen-button\"]');\n\n\t\t\tif ( thing ) {\n\t\t\t\tcontainer.insertBefore(cont, thing.parentElement);\n\t\t\t} else\n\t\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tbtn.setAttribute('aria-label',\n\t\t\ttip.textContent = this.i18n.t(\n\t\t\t\t'player.reset_button',\n\t\t\t\t'Reset Player (Double-Click)'\n\t\t\t));\n\t}\n\n\n\taddErrorResetButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector('.content-overlay-gate'),\n\t\t\thas_reset = this.settings.get('player.button.reset');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_reset )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 2 )\n\t\t\t\tthis.parent.awaitElement(\n\t\t\t\t\t'.autoplay-vod__content-container button',\n\t\t\t\t\tthis.props.containerRef || t.fine.getChildNode(this),\n\t\t\t\t\t1000\n\t\t\t\t).then(() => {\n\t\t\t\t\tthis.addErrorResetButton(inst, (tries || 0) + 1);\n\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.log.warn('Unable to find container element for Error Reset button.');\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet tip, btn, cont = container.querySelector('.ffz--player-reset');\n\t\tif ( ! has_reset ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-reset-button\"\n\t\t\t\t\tonClick={rotateButton}\n\t\t\t\t\tonDblClick={this.resetPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-player-icon ffz-i-t-reset\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tbtn.setAttribute('aria-label',\n\t\t\ttip.textContent = this.i18n.t(\n\t\t\t\t'player.reset_button',\n\t\t\t\t'Double-Click to Reset Player'\n\t\t\t));\n\t}\n\n\n\tresetAllPlayers() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.resetPlayer(inst);\n\t}\n\n\n\tasync resetPlayer(inst, e) {\n\t\tconst player = inst ? ((inst.mediaSinkManager || inst.core?.mediaSinkManager) ? inst : inst?.props?.mediaPlayerInstance) : null;\n\n\t\tif ( e ) {\n\t\t\te.preventDefault();\n\t\t\tconst target = e.currentTarget,\n\t\t\t\ticon = target && target.querySelector('figure');\n\n\t\t\tif ( icon ) {\n\t\t\t\tif ( icon.classList.contains('loading') )\n\t\t\t\t\treturn;\n\n\t\t\t\ticon.classList.toggle('ffz-i-t-reset', true);\n\t\t\t\ticon.classList.toggle('ffz-i-t-reset-clicked', false);\n\n\t\t\t\ticon.classList.toggle('loading', true);\n\t\t\t\ticon._ffz_unspin = setTimeout(() => {\n\t\t\t\t\ticon._ffz_unspin = null;\n\t\t\t\t\ticon.classList.toggle('loading', false);\n\t\t\t\t}, 10000);\n\t\t\t}\n\t\t}\n\n\t\t// Are we dealing with a VOD?\n\t\tconst duration = player.getDuration?.() ?? Infinity;\n\t\tlet position = -1;\n\n\t\tconst core = player.core || player;\n\t\tif ( core._ffz_setVolume )\n\t\t\tcore.setVolume = core._ffz_setVolume;\n\n\t\tif ( isFinite(duration) && ! isNaN(duration) && duration > 0 )\n\t\t\tposition = player.getPosition();\n\n\t\tconst video = player.mediaSinkManager?.video || player.core?.mediaSinkManager?.video;\n\t\tif ( video?._ffz_compressor && player.attachHTMLVideoElement ) {\n\t\t\tconst new_vid = this.replaceVideoElement(player, video);\n\t\t\tnew_vid._ffz_maybe_compress = true;\n\t\t}\n\n\t\tthis.PlayerSource.check();\n\t\tfor(const inst of this.PlayerSource.instances) {\n\t\t\tif ( ! player || player === inst.props?.mediaPlayerInstance )\n\t\t\t\tawait inst.setSrc({isNewMediaPlayerInstance: false});\n\t\t}\n\n\t\tif ( position > 0 )\n\t\t\tsetTimeout(() => player.seekTo(position), 250);\n\t}\n\n\taddMetadata(inst) {\n\t\tif ( ! this.metadata )\n\t\t\treturn;\n\n\t\tif ( ! inst._ffz_md_update )\n\t\t\tinst._ffz_md_update = debounce(() => requestAnimationFrame(() => this._updateMetadata(inst)), 1000, 2);\n\n\t\tinst._ffz_md_update();\n\t}\n\n\twantsMetadata() { // eslint-disable-line class-methods-use-this\n\t\treturn false;\n\t}\n\n\t_updateMetadata(inst) {\n\t\tif ( inst._ffz_cont && ! document.contains(inst._ffz_cont) )\n\t\t\tinst._ffz_cont = null;\n\n\t\tconst wanted = this.wantsMetadata(inst);\n\n\t\tif ( ! inst._ffz_cont ) {\n\t\t\tif ( ! wanted )\n\t\t\t\treturn;\n\n\t\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS);\n\n\t\t\tif ( ! container )\n\t\t\t\treturn;\n\n\t\t\tinst._ffz_cont = (<div class=\"ffz--player-meta-tray\" />);\n\t\t\tcontainer.insertBefore(inst._ffz_cont, container.firstElementChild);\n\t\t}\n\n\t\tif ( ! wanted ) {\n\t\t\tinst._ffz_cont.remove();\n\t\t\tinst._ffz_cont = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateMetadata(inst);\n\t}\n\n\tupdateMetadata(inst, keys) {\n\t\tconst cont = inst._ffz_cont;\n\t\tif ( ! cont || ! document.contains(cont) )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = this.metadata.keys;\n\t\telse if ( ! Array.isArray(keys) )\n\t\t\tkeys = [keys];\n\n\t\tconst source = this.getData(),\n\t\t\tuser = source?.props?.data?.user;\n\n\t\tconst timers = inst._ffz_meta_timers = inst._ffz_meta_timers || {},\n\t\t\trefresh_fn = key => this.updateMetadata(inst, key),\n\t\t\tdata = {\n\t\t\t\tchannel: {\n\t\t\t\t\tid: user?.id,\n\t\t\t\t\tlogin: source?.props?.channelLogin,\n\t\t\t\t\tdisplay_name: user?.displayName,\n\t\t\t\t\tlive: user?.stream?.id != null,\n\t\t\t\t\tlive_since: user?.stream?.createdAt\n\t\t\t\t},\n\t\t\t\tinst,\n\t\t\t\tsource,\n\t\t\t\tgetViewerCount: () => 0,\n\t\t\t\tgetUserSelfImmediate: () => null,\n\t\t\t\tgetUserSelf: () => null,\n\t\t\t\tgetBroadcastID: () => user?.id ? this.getBroadcastID(inst, user.id) : null\n\t\t\t};\n\n\t\tfor(const key of keys)\n\t\t\tthis.metadata.renderPlayer(key, data, cont, timers, refresh_fn);\n\t}\n\n\n\tgetUptime(inst) {\n\t\t// TODO: Support multiple instances.\n\t\tconst source = this.getData(),\n\t\t\tuser = source?.props?.data?.user;\n\n\t\tlet created = user?.stream?.createdAt;\n\n\t\tif ( ! created )\n\t\t\treturn null;\n\n\t\tif ( !(created instanceof Date) )\n\t\t\tcreated = new Date(created);\n\n\t\tconst now = Date.now();\n\n\t\treturn (now - created.getTime()) / 1000;\n\t}\n\n\n\tgetBroadcastID(inst, channel_id) {\n\t\tif ( ! this.twitch_data )\n\t\t\treturn Promise.resolve(null);\n\n\t\tconst cache = inst._ffz_bcast_cache = inst._ffz_bcast_cache || {};\n\t\tif ( channel_id === cache.channel_id ) {\n\t\t\tif ( Date.now() - cache.saved < 60000 )\n\t\t\t\treturn Promise.resolve(cache.broadcast_id);\n\t\t}\n\n\t\treturn new Promise(async (s, f) => {\n\t\t\tif ( cache.updating ) {\n\t\t\t\tcache.updating.push([s, f]);\n\t\t\t\treturn ;\n\t\t\t}\n\n\t\t\tcache.channel_id = channel_id;\n\t\t\tcache.updating = [[s,f]];\n\t\t\tlet id, err;\n\n\t\t\ttry {\n\t\t\t\tid = await this.twitch_data.getBroadcastID(channel_id);\n\t\t\t} catch(error) {\n\t\t\t\tid = null;\n\t\t\t\terr = error;\n\t\t\t}\n\n\t\t\tconst waiters = cache.updating;\n\t\t\tcache.updating = null;\n\n\t\t\tif ( cache.channel_id !== channel_id ) {\n\t\t\t\terr = new Error('Outdated');\n\t\t\t\tcache.channel_id = null;\n\t\t\t\tcache.broadcast_id = null;\n\t\t\t\tcache.saved = 0;\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcache.broadcast_id = id;\n\t\t\tcache.saved = Date.now();\n\n\t\t\tfor(const pair of waiters)\n\t\t\t\terr ? pair[1](err) : pair[0](id);\n\t\t});\n\t}\n\n\n\tget playerUI() {\n\t\tconst container = this.fine.searchTree(this.Player.first, n => n.props && n.props.uiContext, 150);\n\t\treturn container?.props?.uiContext;\n\t}\n\n\tget current() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tif ( inst?.props?.mediaPlayerInstance )\n\t\t\t\treturn inst.props.mediaPlayerInstance;\n\n\t\treturn null;\n\t}\n}\n","'use strict';\n\nimport {parse as parse_path} from 'utilities/path-parser';\n\nlet MD, MILA, waiters;\nlet _md;\n\nfunction loadMD() {\n\tif ( MD )\n\t\treturn Promise.resolve(MD);\n\n\treturn new Promise((s,f) => {\n\t\tif ( waiters )\n\t\t\treturn waiters.push([s,f]);\n\n\t\twaiters = [[s,f]];\n\n\t\tPromise.all([\n\t\t\timport(/* webpackChunkName: 'markdown' */ 'markdown-it'),\n\t\t\timport(/* webpackChunkName: 'markdown' */ 'markdown-it-link-attributes')\n\t\t]).then(modules => {\n\t\t\tMD = modules[0]?.default;\n\t\t\tMILA = modules[1]?.default;\n\n\t\t\tconst waited = waiters;\n\t\t\twaiters = null;\n\n\t\t\tfor(const pair of waited)\n\t\t\t\tpair[0](MD);\n\n\t\t}).catch(err => {\n\t\t\tconst waited = waiters;\n\t\t\twaiters = null;\n\n\t\t\tfor(const pair of waited)\n\t\t\t\tpair[1](err);\n\t\t});\n\t});\n}\n\n\nfunction SettingsLinks(md) {\n\tconst default_render = md.renderer.rules.link_open || this.defaultRender;\n\n\tmd.renderer.rules.link_open = function(tokens, idx, options, env, self) {\n\t\tconst token = tokens[idx];\n\t\tif ( token && token.type === 'link_open' && Array.isArray(token.attrs) ) {\n\t\t\tlet href;\n\t\t\tfor(const attr of token.attrs) {\n\t\t\t\tif ( attr[0] === 'href' ) {\n\t\t\t\t\thref = attr[1];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( href.startsWith('~') ) {\n\t\t\t\tlet path;\n\n\t\t\t\tif ( href === '~' ) {\n\t\t\t\t\t// We don't have a path, make one from the bits.\n\t\t\t\t\tlet i = idx + 1;\n\t\t\t\t\tlet bits = [];\n\n\t\t\t\t\twhile(i < tokens.length) {\n\t\t\t\t\t\tconst tok = tokens[i],\n\t\t\t\t\t\t\ttype = tok?.type;\n\t\t\t\t\t\tif ( type === 'text' )\n\t\t\t\t\t\t\tbits.push(tok);\n\t\t\t\t\t\telse if ( type === 'link_close' )\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbits = bits.map(x => x.content).join('');\n\t\t\t\t\tconst toks = parse_path(bits);\n\t\t\t\t\tpath = toks.map(x => x.key).join('.');\n\t\t\t\t} else\n\t\t\t\t\tpath = href.slice(1);\n\n\t\t\t\tif ( path && path.length ) {\n\t\t\t\t\tfor(const attr of token.attrs) {\n\t\t\t\t\t\tif ( attr[0] === 'class' ) {\n\t\t\t\t\t\t\tattr[1] = attr[1].replace(/ffz-tooltip/g, '');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttoken.attrs.push([\n\t\t\t\t\t\t'data-settings-link',\n\t\t\t\t\t\tpath\n\t\t\t\t\t]);\n\t\t\t\t\ttoken.attrs.push([\n\t\t\t\t\t\t'onclick',\n\t\t\t\t\t\t'FrankerFaceZ.get().resolve(\"main_menu\").mdNavigate(this);return false'\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn default_render(tokens, idx, options, env, self);\n\t}\n}\n\nSettingsLinks.defaultRender = function(tokens, idx, options, env, self) {\n\treturn self.renderToken(tokens, idx, options);\n}\n\nexport default async function awaitMD() {\n\tif ( ! _md ) {\n\t\tconst MD = await loadMD();\n\t\tif ( ! MD )\n\t\t\treturn null;\n\n\t\tconst md = _md = new MD({\n\t\t\thtml: false,\n\t\t\tlinkify: true\n\t\t});\n\n\t\tmd.use(SettingsLinks);\n\t\tmd.use(MILA, {\n\t\t\tattrs: {\n\t\t\t\tclass: 'ffz-tooltip',\n\t\t\t\ttarget: '_blank',\n\t\t\t\trel: 'noopener',\n\t\t\t\t'data-tooltip-type': 'link'\n\t\t\t}\n\t\t});\n\t}\n\n\treturn _md;\n}\n\nexport function getMD(callback) {\n\tif ( _md )\n\t\treturn _md;\n\n\tif ( callback )\n\t\tawaitMD().then(md => callback(md));\n}","'use strict';\n\n// ============================================================================\n// Settings Profiles\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {isValidShortcut, fetchJSON} from 'utilities/object';\nimport {FilterData, createTester} from 'utilities/filtering';\nimport type SettingsManager from '.';\nimport type { SettingsProvider } from './providers';\nimport type { ContextData, ExportedSettingsProfile, SettingsProfileMetadata } from './types';\nimport type { Mousetrap } from '../utilities/types';\n\ndeclare global {\n\tinterface Window {\n\t\tMousetrap?: Mousetrap;\n\t}\n}\n\n\nexport type ProfileEvents = {\n\t'toggled': [profile: SettingsProfile, enabled: boolean];\n\t'changed': [key: string, value: unknown, deleted: boolean];\n}\n\n\n/**\n * Instances of SettingsProfile are used for getting and setting raw settings\n * values, enumeration, and emit events when the raw settings are changed.\n * @extends EventEmitter\n */\nexport default class SettingsProfile extends EventEmitter<ProfileEvents> {\n\n\tstatic Default: Partial<SettingsProfileMetadata> = {\n\t\tid: 0,\n\t\tuuid: 'ffz_profile_default',\n\t\tname: 'Default Profile',\n\t\ti18n_key: 'setting.profiles.default',\n\n\t\tdescription: 'Settings that apply everywhere on Twitch.'\n\t};\n\n\n\tstatic Moderation: Partial<SettingsProfileMetadata> = {\n\t\tid: 1,\n\t\tuuid: 'ffz_profile_moderation',\n\t\tname: 'Moderation',\n\t\ti18n_key: 'setting.profiles.moderation',\n\n\t\tdescription: 'Settings that apply when you are a moderator of the current channel.',\n\n\t\tcontext: [\n\t\t\t{\n\t\t\t\ttype: 'Moderator',\n\t\t\t\tdata: true\n\t\t\t}\n\t\t]\n\t};\n\n\n\tprivate manager: SettingsManager;\n\tprivate provider: SettingsProvider;\n\n\tprivate prefix: string;\n\tprivate enabled_key: string;\n\n\tprivate _enabled: boolean = false;\n\tprivate _storage?: Map<string, unknown>;\n\n\t/**\n\t * If this is true, the profile will not be persisted and the user will\n\t * not be able to edit it.\n\t */\n\tephemeral: boolean = false;\n\n\t/**\n\t * The ID number for this profile. ID numbers may be recycled as profiles\n\t * are deleted and created.\n\t */\n\tid: number = -1;\n\n\t/**\n\t * The unique ID for this profile. UUIDs should always be unique.\n\t */\n\tuuid: string = null as any;\n\n\t// Metadata\n\n\t/**\n\t * The name of this profile. A human-readable string that may be edited\n\t * by the user.\n\t */\n\tname: string = null as any;\n\n\t/**\n\t * The localization key for the name of this profile. If this is set,\n\t * the name will be localized. If this is not set, the name will be\n\t * displayed as-is. This value is cleared if the user edits the name.\n\t */\n\ti18n_key?: string | null;\n\n\t/**\n\t * The description of this profile. A human-readable string that may\n\t * be edited by the user.\n\t */\n\tdescription?: string | null;\n\n\t/**\n\t * The localization key for the description of this profile. If this\n\t * is set, the description will be localized. If this is not set, the\n\t * description will be displayed as-is. This value is cleared if\n\t * the user edits the description.\n\t */\n\tdesc_i18n_key?: string | null;\n\n\t/**\n\t * A URL for this profile. If this is set, the profile will potentially\n\t * be automatically updated from the URL.\n\t */\n\turl?: string | null;\n\n\t/**\n\t * Whether or not automatic updates should be processed. If this is\n\t * set to true, the profile will not be automatically updated.\n\t */\n\tpause_updates: boolean = false;\n\n\t// TODO: Document, check default value\n\tshow_toggle: boolean = false;\n\n\n\t// Profile Rules\n\n\tcontext?: FilterData[];\n\n\n\t// Hotkey Stuff\n\n\t/**\n\t * A user-set hotkey for toggling this profile on or off.\n\t * @see {@link hotkey}\n\t */\n\tprivate _hotkey?: string | null;\n\n\t/**\n\t * Whether or not the hotkey is currently enabled.\n\t * @see {@link hotkey_enabled}\n\t */\n\tprivate _hotkey_enabled?: boolean = false;\n\n\tprivate _bound_key?: string | null;\n\tprivate Mousetrap?: Mousetrap;\n\n\n\tprivate matcher?: ((ctx: ContextData) => boolean) | null;\n\n\n\tconstructor(manager: SettingsManager, data: Partial<SettingsProfileMetadata>) {\n\t\tsuper();\n\n\t\tthis.onShortcut = this.onShortcut.bind(this);\n\t\tthis._hotkey_enabled = false;\n\n\t\tthis.manager = manager;\n\t\tthis.provider = manager.provider;\n\n\t\tthis.data = data;\n\t\tthis.prefix = `p:${this.id}:`;\n\t\tthis.enabled_key = `${this.prefix}:enabled`;\n\n\t\tif ( this.ephemeral ) {\n\t\t\tthis._enabled = true;\n\t\t\tthis._storage = new Map;\n\t\t}\n\t}\n\n\tget data(): Partial<SettingsProfileMetadata> {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\t//parent: this.parent,\n\t\t\tuuid: this.uuid,\n\n\t\t\tname: this.name,\n\t\t\ti18n_key: this.i18n_key,\n\t\t\thotkey: this.hotkey,\n\t\t\tpause_updates: this.pause_updates,\n\n\t\t\tephemeral: this.ephemeral,\n\n\t\t\tdescription: this.description,\n\t\t\tdesc_i18n_key: this.desc_i18n_key,\n\n\t\t\turl: this.url,\n\t\t\tshow_toggle: this.show_toggle,\n\n\t\t\tcontext: this.context\n\t\t}\n\t}\n\n\tset data(val) {\n\t\tif ( typeof val !== 'object' )\n\t\t\tthrow new TypeError('data must be an object');\n\n\t\tthis.clearMatcher();\n\n\t\t// Make sure ephemeral is set first.\n\t\tif ( val.ephemeral )\n\t\t\tthis.ephemeral = true;\n\n\t\t// Copy the values to this profile.\n\t\tfor(const [key, value] of Object.entries(val))\n\t\t\t(this as any)[key] = value;\n\t}\n\n\n\tclearMatcher() {\n\t\tthis.matcher = null;\n\t}\n\n\n\tmatches(context: ContextData) {\n\t\tif ( ! this.matcher )\n\t\t\tthis.matcher = createTester(\n\t\t\t\tthis.context,\n\t\t\t\tthis.manager.filters,\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t\t() => this.manager.updateSoon()\n\t\t\t);\n\n\t\treturn this.matcher(context);\n\t}\n\n\n\tsave() {\n\t\tif ( ! this.ephemeral )\n\t\t\tthis.manager.saveProfile(this.id);\n\t}\n\n\n\tgetBackup(): ExportedSettingsProfile {\n\t\tconst out: ExportedSettingsProfile = {\n\t\t\tversion: 2,\n\t\t\ttype: 'profile',\n\t\t\tprofile: this.data,\n\t\t\ttoggled: this.toggled,\n\t\t\tvalues: {}\n\t\t};\n\n\t\tdelete out.profile.ephemeral;\n\n\t\tfor(const [key, value] of this.entries())\n\t\t\tout.values[key] = value;\n\n\t\treturn out;\n\t}\n\n\n\tasync checkUpdate() {\n\t\tif ( ! this.url || this.pause_updates )\n\t\t\treturn false;\n\n\t\tconst data = await fetchJSON<ExportedSettingsProfile>(this.url);\n\t\tif ( ! data || data.type !== 'profile' || ! data.profile || ! data.values )\n\t\t\treturn false;\n\n\t\t// We don't want to override general settings.\n\t\tdelete data.profile.ephemeral;\n\t\tdelete data.profile.id;\n\t\tdelete data.profile.uuid;\n\t\tdelete data.profile.name;\n\t\tdelete data.profile.i18n_key;\n\t\tdelete data.profile.hotkey;\n\t\tdelete data.profile.description;\n\t\tdelete data.profile.desc_i18n_key;\n\t\tdelete data.profile.url;\n\t\tdelete data.profile.pause_updates;\n\n\t\tthis.data = data.profile;\n\n\t\tconst old_keys = new Set(this.keys());\n\n\t\tfor(const [key, value] of Object.entries(data.values)) {\n\t\t\told_keys.delete(key);\n\t\t\tthis.set(key, value);\n\t\t}\n\n\t\tfor(const key of old_keys)\n\t\t\tthis.delete(key);\n\n\t\treturn true;\n\t}\n\n\n\t// ========================================================================\n\t// Hotkey\n\t// ========================================================================\n\n\tget hotkey() {\n\t\treturn this._hotkey;\n\t}\n\n\tset hotkey(key) {\n\t\tif ( key === this._hotkey )\n\t\t\treturn;\n\n\t\tthis._hotkey = key;\n\t\tif ( this._hotkey_enabled )\n\t\t\tthis._updateHotkey();\n\t}\n\n\tget hotkey_enabled() {\n\t\treturn this._hotkey_enabled;\n\t}\n\n\tset hotkey_enabled(val) {\n\t\tthis._hotkey_enabled = !! val;\n\t\tthis._updateHotkey();\n\t}\n\n\t_updateHotkey() {\n\t\tconst Mousetrap = this.Mousetrap = this.Mousetrap || window.Mousetrap;\n\t\tif ( ! Mousetrap )\n\t\t\treturn;\n\n\t\tconst key = this._hotkey;\n\n\t\tif ( this._bound_key && (this._bound_key !== key || ! this._hotkey_enabled) ) {\n\t\t\tMousetrap.unbind(this._bound_key);\n\t\t\tthis._bound_key = null;\n\t\t}\n\n\t\tif ( ! this._hotkey_enabled )\n\t\t\treturn;\n\n\t\tif ( key && isValidShortcut(key) ) {\n\t\t\tMousetrap.bind(key, this.onShortcut);\n\t\t\tthis._bound_key = key;\n\t\t}\n\t}\n\n\tonShortcut(event: KeyboardEvent) {\n\t\tthis.toggled = ! this.toggled;\n\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Toggled\n\t// ========================================================================\n\n\tget toggled() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._enabled;\n\t\treturn this.provider.get(this.enabled_key, true);\n\t}\n\n\tset toggled(val) {\n\t\tif ( val === this.toggled )\n\t\t\treturn;\n\n\t\tif ( this.ephemeral )\n\t\t\tthis._enabled = val;\n\t\telse\n\t\t\tthis.provider.set(this.enabled_key, val);\n\n\t\tthis.emit('toggled', this, val);\n\t}\n\n\n\t// ========================================================================\n\t// Context\n\t// ========================================================================\n\n\t// wtf is this method context is an array yo\n\t/*\n\tupdateContext(context) {\n\t\tif ( this.id === 0 )\n\t\t\tthrow new Error('cannot set context of default profile');\n\n\t\tthis.context = Object.assign(this.context || {}, context);\n\t\tthis.matcher = null;\n\t\tthis.save();\n\t}*/\n\n\tsetContext(context?: FilterData[]) {\n\t\tif ( this.id === 0 )\n\t\t\tthrow new Error('cannot set context of default profile');\n\n\t\tthis.context = context;\n\t\tthis.clearMatcher();\n\t\tthis.save();\n\t}\n\n\n\t// ========================================================================\n\t// Setting Access\n\t// ========================================================================\n\n\tget<T>(key: string, default_value: T): T;\n\tget<T>(key: string): T | null;\n\n\tget<T>(key: string, default_value?: T): T | null {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage && this._storage.has(key) )\n\t\t\t\treturn this._storage.get(key) as T;\n\n\t\t\treturn default_value ?? null;\n\t\t}\n\n\t\treturn this.provider.get<T>(this.prefix + key, default_value as T);\n\t}\n\n\tset(key: string, value: unknown) {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage )\n\t\t\t\tthis._storage.set(key, value);\n\t\t} else\n\t\t\tthis.provider.set(this.prefix + key, value);\n\n\t\tthis.emit('changed', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage )\n\t\t\t\tthis._storage.delete(key);\n\t\t} else\n\t\t\tthis.provider.delete(this.prefix + key);\n\t\tthis.emit('changed', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? this._storage.has(key): false;\n\t\treturn this.provider.has(this.prefix + key);\n\t}\n\n\tkeys() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? Array.from(this._storage.keys()) : [];\n\n\t\tconst out = [],\n\t\t\tp = this.prefix,\n\t\t\tlen = p.length;\n\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key )\n\t\t\t\tout.push(key.slice(len));\n\n\t\treturn out;\n\t}\n\n\tclear() {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage ) {\n\t\t\t\tconst keys = this.keys();\n\t\t\t\tthis._storage.clear();\n\t\t\t\tfor(const key of keys) {\n\t\t\t\t\tthis.emit('changed', key, undefined, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst p = this.prefix,\n\t\t\tlen = p.length;\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key ) {\n\t\t\t\tthis.provider.delete(key);\n\t\t\t\tthis.emit('changed', key.slice(len), undefined, true);\n\t\t\t}\n\t}\n\n\t*entries() {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage ) {\n\t\t\t\tfor(const entry of this._storage.entries())\n\t\t\t\t\tyield entry;\n\t\t\t}\n\n\t\t} else {\n\t\t\tconst p = this.prefix,\n\t\t\t\tlen = p.length;\n\n\t\t\tfor(const key of this.provider.keys())\n\t\t\t\tif ( key.startsWith(p) && key !== this.enabled_key ) {\n\t\t\t\t\tconst out: [string, unknown] = [key.slice(len), this.provider.get(key)];\n\t\t\t\t\tyield out;\n\t\t\t\t}\n\t\t}\n\t}\n\n\tget size() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? this._storage.size : 0;\n\n\t\tconst p = this.prefix;\n\t\tlet count = 0;\n\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key )\n\t\t\t\tcount++;\n\n\t\treturn count;\n\t}\n}\n","import Module, { GenericModule, ModuleEvents } from 'utilities/module';\nimport type { AddonInfo } from './types';\nimport type Logger from './logging';\nimport type TranslationManager from '../i18n';\nimport type SettingsManager from '../settings';\nimport type AddonManager from '../addons';\n\n/**\n * A special sub-class of {@link Module} used for the root module of an add-on.\n *\n * This sub-class has a static {@link register} method that add-ons should call\n * to properly inject themselves into FrankerFaceZ once their scripts have\n * loaded. {@link register} is called automatically by add-ons build from the\n * official add-ons repository.\n */\nexport class Addon<TPath extends string = '', TEventMap extends ModuleEvents = ModuleEvents> extends Module<TPath, TEventMap> {\n\n\tstatic info?: AddonInfo;\n\tstatic version: string;\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\tsettings: SettingsManager = null as any;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent, true);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see {@link loadFromContext}\n\t */\n\tpopulate(ctx: __WebpackModuleApi.RequireContext, log?: Logger) {\n\t\tthis.log.warn('[DEV-CHECK] populate() has been renamed to loadFromContext(). The populate() name is deprecated.');\n\t\treturn this.loadFromContext(ctx, log);\n\t}\n\n\t/**\n\t * Register this add-on with the FrankerFaceZ module system. This\n\t * should be called as soon as your add-on class is available and\n\t * ready to be enabled. The {@link AddonManager} class will then\n\t * call {@link enable} on this module (assuming the user wants\n\t * the add-on to be enabled.)\n\t * @param id This add-on's ID, or an {@link AddonInfo} object.\n\t * @param info An optional AddonInfo object if {@link id} was not set to an AddonInfo object.\n\t */\n\tstatic register(id?: string | AddonInfo, info?: AddonInfo, version?: string) {\n\t\tif ( typeof id === 'object' ) {\n\t\t\tinfo = id;\n\t\t\tid = info.id || undefined;\n\t\t}\n\n\t\tif ( ! id ) {\n\t\t\tif ( this.name )\n\t\t\t\tid = this.name.toSnakeCase();\n\t\t\telse\n\t\t\t\tthrow new Error(`Unable to register module without ID.`);\n\t\t}\n\n\t\tif ( ! info && this.info )\n\t\t\tinfo = this.info;\n\n\t\tif ( version )\n\t\t\tthis.version = version;\n\n\t\tconst ffz = window.FrankerFaceZ.get(),\n\t\t\taddons = (ffz as any)?.addons as AddonManager;\n\n\t\tif ( addons ) {\n\t\t\tif ( info ) {\n\t\t\t\tinfo.id = id;\n\t\t\t\taddons.addAddon(info);\n\n\t\t\t} else if ( ! addons.hasAddon(id) )\n\t\t\t\taddons.addAddon({\n\t\t\t\t\tid\n\t\t\t\t});\n\n\t\t\tif ( version )\n\t\t\t\taddons.setVersion(id, version);\n\t\t}\n\n\t\ttry {\n\t\t\tffz.register(`addon.${id}`, this);\n\t\t} catch(err) {\n\t\t\tif ( (err instanceof Error) && err.message && err.message.includes('Name Collision for Module') ) {\n\t\t\t\tconst module = ffz.resolve(`addon.${id}`);\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as any).external = true;\n\t\t\t}\n\n\t\t\tthrow err;\n\t\t}\n\t}\n}\n","\n/** A union of the various Blob types that are supported. */\nexport type BlobLike = Blob | File | ArrayBuffer | Uint8Array;\n\n/** A union of the various serialized blob types. */\nexport type SerializedBlobLike = SerializedBlob | SerializedFile | SerializedArrayBuffer | SerializedUint8Array;\n\n/** A serialized {@link Blob} representation. */\nexport type SerializedBlob = {\n\ttype: 'blob';\n\tmime: string;\n\tbuffer: ArrayBuffer\n};\n\n/** A serialized {@link File} representation. */\nexport type SerializedFile = {\n\ttype: 'file';\n\tmime: string;\n\tname: string;\n\tmodified: number;\n\tbuffer: ArrayBuffer\n};\n\n/** A serialized {@link ArrayBuffer} representation. */\nexport type SerializedArrayBuffer = {\n\ttype: 'ab';\n\tbuffer: ArrayBuffer;\n};\n\n/** A serialized {@link Uint8Array} representation. */\nexport type SerializedUint8Array = {\n\ttype: 'u8',\n\tbuffer: ArrayBuffer\n};\n\n/**\n * Determine if the provided object is a valid Blob that can be serialized\n * for transmission via a messaging API.\n */\nexport function isValidBlob(blob: any): blob is BlobLike {\n\treturn blob instanceof Blob || blob instanceof File || blob instanceof ArrayBuffer || blob instanceof Uint8Array;\n}\n\n/**\n * Serialize the provided {@link BlobLike} object into a format that can be\n * transmitted via a messaging API.\n */\nexport async function serializeBlob(blob?: BlobLike): Promise<SerializedBlobLike | null> {\n\tif ( ! blob )\n\t\treturn null;\n\n\tif ( blob instanceof Blob )\n\t\treturn {\n\t\t\ttype: 'blob',\n\t\t\tmime: blob.type,\n\t\t\tbuffer: await blob.arrayBuffer(),\n\t\t}\n\n\tif ( blob instanceof File )\n\t\treturn {\n\t\t\ttype: 'file',\n\t\t\tmime: blob.type,\n\t\t\tname: blob.name,\n\t\t\tmodified: blob.lastModified,\n\t\t\tbuffer: await blob.arrayBuffer()\n\t\t}\n\n\tif ( blob instanceof ArrayBuffer )\n\t\treturn {\n\t\t\ttype: 'ab',\n\t\t\tbuffer: blob\n\t\t}\n\n\tif ( blob instanceof Uint8Array )\n\t\treturn {\n\t\t\ttype: 'u8',\n\t\t\tbuffer: blob.buffer\n\t\t}\n\n\tthrow new TypeError('Invalid type');\n}\n\n/**\n * Deserialize the provided {@link SerializedBlobLike} object into a copy of\n * the original {@link BlobLike}.\n */\nexport function deserializeBlob(data: SerializedBlobLike): BlobLike | null {\n\tif ( ! data || ! data.type )\n\t\treturn null;\n\n\tif ( data.type === 'blob' )\n\t\treturn new Blob([data.buffer], {type: data.mime});\n\n\tif ( data.type === 'file' )\n\t\treturn new File([data.buffer], data.name, {type: data.mime, lastModified: data.modified});\n\n\tif ( data.type === 'ab' )\n\t\treturn data.buffer;\n\n\tif ( data.type === 'u8' )\n\t\treturn new Uint8Array(data.buffer);\n\n\tthrow new TypeError('Invalid type');\n}\n","'use strict';\n\n// ============================================================================\n// Fine Lib\n// It controls React.\n// ============================================================================\n\nimport {EventEmitter, EventListener, NamespacedEventArgs, NamespacedEventKey} from 'utilities/events';\nimport Module, { GenericModule } from 'utilities/module';\nimport type { ReactAccessor, ReactNode, ReactRoot, ReactStateNode } from './react-types';\nimport type { ClassType, ExtractFunctions, MaybeParameters, OptionalArray, RecursivePartial } from 'utilities/types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\t'site.fine': FineEvents;\n\t}\n\tinterface ModuleMap {\n\t\t'site.fine': Fine;\n\t}\n}\n\nexport type FineEvents = {\n\t'site:dom-update': [name: string, instance: ReactStateNode];\n};\n\nexport type NodeCriteria = (node: ReactNode) => boolean;\nexport type FineCriteria<TNode extends ReactStateNode = ReactStateNode> =\n\t(stateNode: RecursivePartial<TNode> | Node, node: ReactNode) => boolean;\n\ntype InputNode = Node | ReactNode | ReactStateNode | null;\n\nexport default class Fine extends Module<'site.fine', FineEvents> {\n\n\tselector?: string;\n\troot_element?: HTMLElement | null;\n\n\taccessor?: ReactAccessor | null;\n\treact_root?: ReactRoot | null;\n\treact?: ReactNode | null;\n\n\tprivate _route: string | null = null;\n\tprivate _wrappers: Map<string, FineWrapper<any>>;\n\tprivate _known_classes: Map<unknown, FineWrapper<any>>;\n\tprivate _observer: MutationObserver | null;\n\tprivate _waiting: FineWrapper<any>[];\n\n\tprivate _live_waiting: FineWrapper<any>[] | null;\n\tprivate _waiting_crit?: FineCriteria<any>[] | null;\n\tprivate _waiting_timer?: ReturnType<typeof setInterval> | null;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis._wrappers = new Map;\n\t\tthis._known_classes = new Map;\n\t\tthis._observer = null;\n\t\tthis._waiting = [];\n\t\tthis._live_waiting = null;\n\t}\n\n\t/** @internal */\n\tasync onEnable(tries=0): Promise<void> {\n\t\t// TODO: Move awaitElement to utilities/dom\n\t\tif ( ! this.root_element )\n\t\t\tthis.root_element = await (this.parent as any).awaitElement(this.selector || 'body #root');\n\n\t\tlet root = this.root_element?._reactRootContainer;\n\t\tif ( root?._internalRoot?.current )\n\t\t\troot = root?._internalRoot;\n\n\t\tif ( root?.current ) {\n\t\t\tthis.react_root = root;\n\t\t\tthis.react = root?.current?.child;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.root_element && ! root ) {\n\t\t\tlet key = Fine.findAccessor(this.root_element, '__reactContainer');\n\t\t\tif ( key ) {\n\t\t\t\tthis.react_root = null;\n\t\t\t\tthis.react = this.root_element[key];\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t//if ( ! this.root_element || ! this.root_element._reactRootContainer ) {\n\t\t\tif ( tries > 500 )\n\t\t\t\tthrow new Error('Unable to find React after 25 seconds');\n\n\t\t\tthis.root_element = null;\n\t\t\treturn new Promise<void>(r =>\n\t\t\t\tsetTimeout(r, 50)).then(() => this.onEnable(tries+1));\n\t\t//}\n\n\t\t/*this.react_root = this.root_element._reactRootContainer;\n\t\tif ( this.react_root._internalRoot && this.react_root._internalRoot.current )\n\t\t\tthis.react_root = this.react_root._internalRoot;\n\n\t\tthis.react = this.react_root.current?.child;*/\n\t}\n\n\t/** @internal */\n\tonDisable() {\n\t\tthis.react_root = this.root_element = this.react = this.accessor = null;\n\t}\n\n\n\tstatic findAccessor(node: Node, prefix?: string): ReactAccessor | null {\n\t\tfor(const key in node)\n\t\t\tif ( prefix ? key.startsWith(`${prefix}$`) : (key.startsWith('__reactInternalInstance$') || key.startsWith('__reactFiber$')) )\n\t\t\t\treturn key as ReactAccessor;\n\t\treturn null;\n\t}\n\n\n\t// ========================================================================\n\t// Low Level Accessors\n\t// ========================================================================\n\n\tresolveNode(input: InputNode) {\n\t\tif ( ! input && this.react )\n\t\t\treturn this.react;\n\t\telse if ( input instanceof Node )\n\t\t\treturn this.getReactInstance(input);\n\t\telse if ( (input as ReactStateNode)?._reactInternals )\n\t\t\treturn (input as ReactStateNode)._reactInternals;\n\t\telse if ( (input as ReactStateNode)?._reactInternalFiber )\n\t\t\treturn (input as ReactStateNode)._reactInternalFiber;\n\t\telse if ( input )\n\t\t\treturn input as ReactNode;\n\t\treturn null;\n\t}\n\n\tgetReactInstance(node: Node) {\n\t\tif ( ! this.accessor )\n\t\t\tthis.accessor = Fine.findAccessor(node);\n\t\tif ( ! this.accessor )\n\t\t\treturn null;\n\n\t\treturn node[this.accessor] ??\n\t\t\tnode._reactRootContainer?._internalRoot?.current ??\n\t\t\tnode._reactRootContainer?.current ?? null;\n\t}\n\n\tgetOwner(input: InputNode) {\n\t\tinput = this.resolveNode(input);\n\t\treturn input?.return ?? null;\n\t}\n\n\tgetParentNode<TNode extends Node = Node>(\n\t\tinput: InputNode,\n\t\tmax_depth = 100,\n\t\ttraverse_roots = false\n\t) {\n\t\treturn this.searchParent<TNode>(\n\t\t\tinput,\n\t\t\tn => n instanceof Node,\n\t\t\tmax_depth,\n\t\t\t0,\n\t\t\ttraverse_roots\n\t\t);\n\t}\n\n\tgetChildNode<TNode extends Node = Node>(\n\t\tinput: InputNode,\n\t\tmax_depth = 100,\n\t\ttraverse_roots = false\n\t) {\n\t\treturn this.searchTree<TNode>(\n\t\t\tinput,\n\t\t\tn => n instanceof Node,\n\t\t\tmax_depth,\n\t\t\t0,\n\t\t\ttraverse_roots\n\t\t);\n\t}\n\n\tgetHostNode<TNode extends Node = Node>(\n\t\tinput: InputNode,\n\t\tmax_depth = 100\n\t) {\n\t\treturn this.getChildNode<TNode>(input, max_depth);\n\t}\n\n\t// TODO: Why does this exist??\n\t/** @deprecated why does this exist? */\n\tgetParent(input: InputNode) {\n\t\treturn this.getOwner(input);\n\t}\n\n\tgetFirstChild(input: InputNode) {\n\t\tconst node = this.resolveNode(input);\n\t\treturn node?.child ?? null;\n\t}\n\n\tgetChildren(input: InputNode) {\n\t\tconst node = this.resolveNode(input);\n\t\tif ( ! node )\n\t\t\treturn [];\n\n\t\tconst children = [];\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tchildren.push(child);\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tsearchParent<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: string | FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\ttraverse_roots = true\n\t): TNode | null {\n\t\tif ( depth > max_depth )\n\t\t\treturn null;\n\n\t\tconst node = this.resolveNode(input);\n\n\t\t// If we don't have a node, then stop.\n\t\tif ( ! node )\n\t\t\treturn null;\n\n\t\tif ( typeof criteria === 'string' ) {\n\t\t\tconst wrapper = this._wrappers.get(criteria);\n\t\t\tif ( ! wrapper )\n\t\t\t\tthrow new Error('invalid critera');\n\n\t\t\tif ( ! wrapper.class )\n\t\t\t\treturn null;\n\n\t\t\tcriteria = n => n && n.constructor === wrapper.class;\n\t\t}\n\n\t\tconst inst = node.stateNode;\n\t\tif ( inst && criteria(inst as any, node) )\n\t\t\treturn inst as TNode;\n\n\t\t/*// If the node has opted out of scanning, then don't\n\t\t// Various conditions that could cause a stop.\n\t\tif ( ! node ||\n\t\t\t// Theoretically possible I guess?\n\t\t\t(node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn null;*/\n\n\t\tif ( node.return ) {\n\t\t\tconst result = this.searchParent<TNode>(node.return, criteria, max_depth, depth+1, traverse_roots);\n\t\t\tif ( result )\n\t\t\t\treturn result as TNode;\n\t\t}\n\n\t\t// Stupid code for traversing up into another React root.\n\t\tif ( traverse_roots && (inst as any)?.containerInfo ) {\n\t\t\tconst parent = (inst as any).containerInfo?.parentElement as Node | undefined,\n\t\t\t\tparent_node = parent && this.getReactInstance(parent);\n\n\t\t\tif ( parent_node ) {\n\t\t\t\tconst result = this.searchParent<TNode>(parent_node, criteria, max_depth, depth+1, traverse_roots);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn result as TNode;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tsearchParentNode<TNode extends ReactNode = ReactNode>(\n\t\tinput: InputNode,\n\t\tcriteria: NodeCriteria,\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\ttraverse_roots = true\n\t): TNode | null {\n\t\tif ( depth > max_depth )\n\t\t\treturn null;\n\n\t\tconst node = this.resolveNode(input);\n\n\t\t// If we don't have a node, then stop.\n\t\tif ( ! node )\n\t\t\treturn null;\n\n\t\tif ( criteria(node) )\n\t\t\treturn node as TNode;\n\n\t\tif ( node.return ) {\n\t\t\tconst result = this.searchParentNode<TNode>(node.return, criteria, max_depth, depth+1, traverse_roots);\n\t\t\tif ( result )\n\t\t\t\treturn result as TNode;\n\t\t}\n\n\t\t// Stupid code for traversing up into another React root.\n\t\tconst inst = node.stateNode;\n\t\tif ( traverse_roots && (inst as any)?.containerInfo ) {\n\t\t\tconst parent = (inst as any).containerInfo?.parentElement as Node | undefined,\n\t\t\t\tparent_node = parent && this.getReactInstance(parent);\n\n\t\t\tif ( parent_node ) {\n\t\t\t\tconst result = this.searchParentNode<TNode>(parent_node, criteria, max_depth, depth+1, traverse_roots);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn result as TNode;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tsearchNode<TNode extends ReactNode = ReactNode>(\n\t\tinput: InputNode,\n\t\tcriteria: NodeCriteria,\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\ttraverse_roots = true\n\t): TNode | null {\n\t\tif ( depth > max_depth )\n\t\t\treturn null;\n\n\t\tconst node = this.resolveNode(input);\n\n\t\t// No node? No result.\n\t\tif ( ! node )\n\t\t\treturn null;\n\n\t\tif ( criteria(node) )\n\t\t\treturn node as TNode;\n\n\t\t// If the node has disabled scanning, don't scan into its children.\n\t\tif ((node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn null;\n\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tconst result = this.searchNode<TNode>(child, criteria, max_depth, depth+1, traverse_roots);\n\t\t\tif ( result )\n\t\t\t\treturn result as TNode;\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\tconst inst = node.stateNode;\n\t\tif ( traverse_roots && (inst as any)?.props?.root ) {\n\t\t\tconst root = (inst as any).props.root._reactRootContainer as ReactRoot;\n\t\t\tif ( root ) {\n\t\t\t\tlet child = root._internalRoot?.current || root.current;\n\t\t\t\twhile(child) {\n\t\t\t\t\tconst result = this.searchNode<TNode>(child, criteria, max_depth, depth+1, traverse_roots);\n\t\t\t\t\tif ( result )\n\t\t\t\t\t\treturn result as TNode;\n\n\t\t\t\t\tchild = child.sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// TypeScript is great. You can't have optional parameters in overloads.\n\t// So here's some overloads.\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t\ttraverse_roots: boolean,\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t\ttraverse_roots: boolean,\n\t\tmulti?: false\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t\ttraverse_roots: boolean,\n\t\tmulti: Set<TNode> | true\n\t): Set<TNode>;\n\tsearchTree<\n\t\tTNode\n\t>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number = 15,\n\t\tdepth: number = 0,\n\t\ttraverse_roots: boolean = true,\n\t\tmulti?: Set<TNode> | boolean\n\t): TNode | Set<TNode> | null {\n\t\tconst node = this.resolveNode(input);\n\t\tif ( multi && ! (multi instanceof Set) )\n\t\t\tmulti = new Set;\n\n\t\t// No node? Scanned too deep? Stop.\n\t\tif ( ! node || depth > max_depth )\n\t\t\treturn multi ? multi : null;\n\n\t\tif ( typeof criteria === 'string' ) {\n\t\t\tconst wrapper = this._wrappers.get(criteria);\n\t\t\tif ( ! wrapper )\n\t\t\t\tthrow new Error('invalid critera');\n\n\t\t\tif ( ! wrapper.class )\n\t\t\t\treturn multi ? multi : null;\n\n\t\t\tcriteria = n => n && n.constructor === wrapper.class;\n\t\t}\n\n\t\tconst inst = node.stateNode;\n\t\tif ( inst && criteria(inst as any, node) ) {\n\t\t\tif ( multi )\n\t\t\t\tmulti.add(inst as TNode);\n\t\t\telse\n\t\t\t\treturn inst as TNode;\n\t\t}\n\n\t\t// If the node has disabled scanning, don't scan into its children.\n\t\tif ((node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn multi ? multi : null;\n\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tconst result = this.searchTree<TNode>(child, criteria, max_depth, depth+1, traverse_roots, multi as any);\n\t\t\tif ( result && ! multi )\n\t\t\t\treturn result as TNode;\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\tif ( traverse_roots && (inst as any)?.props?.root ) {\n\t\t\tconst root = (inst as any).props.root._reactRootContainer as ReactRoot;\n\t\t\tif ( root ) {\n\t\t\t\tlet child = root._internalRoot?.current || root.current;\n\t\t\t\twhile(child) {\n\t\t\t\t\tconst result = this.searchTree<TNode>(child, criteria, max_depth, depth+1, traverse_roots, multi as any);\n\t\t\t\t\tif ( result && ! multi )\n\t\t\t\t\t\treturn result as TNode;\n\n\t\t\t\t\tchild = child.sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn multi ? multi : null;\n\t}\n\n\n\tfindAllMatching<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth = 15,\n\t\tsingle_class = true,\n\t\tparents=false,\n\t\tdepth=0,\n\t\ttraverse_roots=true\n\t) {\n\t\tconst matches = new Set<TNode>;\n\t\tlet crit: FineCriteria = (inst, node) => ! matches.has(inst as TNode) && criteria(inst as any, node);\n\n\t\twhile(true) {\n\t\t\tconst match = parents ?\n\t\t\t\tthis.searchParent(input, crit, max_depth, depth, traverse_roots) :\n\t\t\t\tthis.searchTree(input, crit, max_depth, depth, traverse_roots);\n\n\t\t\tif ( ! match )\n\t\t\t\tbreak;\n\n\t\t\tif ( single_class && ! matches.size ) {\n\t\t\t\tconst klass = match.constructor;\n\t\t\t\tcrit = (inst, node) => ! matches.has(inst as TNode) && (inst instanceof klass) && criteria(inst as any, node);\n\t\t\t}\n\n\t\t\tmatches.add(match as TNode);\n\t\t}\n\n\t\treturn matches;\n\t}\n\n\n\tsearchAll(\n\t\tinput: InputNode,\n\t\tcriterias: FineCriteria[],\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\tdata: {\n\t\t\tseen: Set<any>;\n\t\t\tclasses: any[];\n\t\t\tmax_depth: number;\n\t\t\tout: {\n\t\t\t\tcls: any;\n\t\t\t\tinstances: Set<ReactStateNode | Node>;\n\t\t\t\tdepth: number | null;\n\t\t\t}[];\n\t\t} | null = null,\n\t\ttraverse_roots = true\n\t) {\n\t\tconst node = this.resolveNode(input);\n\n\t\tif ( ! data )\n\t\t\tdata = {\n\t\t\t\tseen: new Set,\n\t\t\t\tclasses: criterias.map(() => null),\n\t\t\t\tout: criterias.map(() => ({\n\t\t\t\t\tcls: null, instances: new Set, depth: null\n\t\t\t\t})),\n\t\t\t\tmax_depth: depth\n\t\t\t};\n\n\t\t// No node? Max depth? Bye.\n\t\tif ( ! node || depth > max_depth )\n\t\t\treturn data.out;\n\n\t\tif ( depth > data.max_depth )\n\t\t\tdata.max_depth = depth;\n\n\t\tconst inst = node.stateNode;\n\t\tif ( inst ) {\n\t\t\tconst cls = inst.constructor,\n\t\t\t\tidx = data.classes.indexOf(cls);\n\n\t\t\tif ( idx !== -1 )\n\t\t\t\tdata.out[idx].instances.add(inst);\n\n\t\t\telse if ( ! data.seen.has(cls) ) {\n\t\t\t\tlet i = criterias.length;\n\t\t\t\twhile(i-- > 0)\n\t\t\t\t\tif ( criterias[i](inst, node) ) {\n\t\t\t\t\t\tdata.classes[i] = data.out[i].cls = cls;\n\t\t\t\t\t\tdata.out[i].instances.add(inst);\n\t\t\t\t\t\tdata.out[i].depth = depth;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\tdata.seen.add(cls);\n\t\t\t}\n\t\t}\n\n\t\t// If the node has disabled scanning, don't scan into its children.\n\t\tif ((node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn data.out;\n\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tthis.searchAll(child, criterias, max_depth, depth+1, data, traverse_roots);\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\tif ( traverse_roots && (inst as any)?.props?.root ) {\n\t\t\tconst root = (inst as any).props.root._reactRootContainer as ReactRoot | null;\n\t\t\tif ( root ) {\n\t\t\t\tlet child = root._internalRoot && root._internalRoot.current || root.current;\n\t\t\t\twhile(child) {\n\t\t\t\t\tthis.searchAll(child, criterias, max_depth, depth+1, data, traverse_roots);\n\t\t\t\t\tchild = child.sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn data.out;\n\t}\n\n\n\t// ========================================================================\n\t// Class Wrapping\n\t// ========================================================================\n\n\troute(route: string) {\n\t\tthis._route = route;\n\t\tthis._updateLiveWaiting();\n\t}\n\n\n\t_updateLiveWaiting() {\n\t\tconst lw: FineWrapper[] = this._live_waiting = [],\n\t\t\tcrt: FineCriteria[] = this._waiting_crit = [],\n\t\t\troute = this._route;\n\n\t\tif ( this._waiting )\n\t\t\tfor(const waiter of this._waiting) {\n\t\t\t\t// false means never wait.\n\t\t\t\tif ( waiter.routes === false || ! waiter.criteria )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( ! route || ! waiter.routes?.length || waiter.routes.includes(route) ) {\n\t\t\t\t\tlw.push(waiter);\n\t\t\t\t\tcrt.push(waiter.criteria);\n\t\t\t\t}\n\t\t\t}\n\n\t\tif ( ! this._live_waiting.length )\n\t\t\tthis._stopWaiting();\n\t\telse if ( ! this._waiting_timer )\n\t\t\tthis._startWaiting();\n\t}\n\n\n\tdefine<TNode extends ReactStateNode = ReactStateNode>(\n\t\tkey: string,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\troutes: string[] | false | null = null\n\t) {\n\t\tif ( this._wrappers.has(key) )\n\t\t\treturn this._wrappers.get(key) as FineWrapper<TNode>;\n\n\t\tif ( ! criteria )\n\t\t\tthrow new Error('cannot find definition and no criteria provided');\n\n\t\tconst wrapper = new FineWrapper<TNode>(key, criteria as any, routes, this);\n\t\tthis._wrappers.set(key, wrapper);\n\n\t\tconst data = this.react\n\t\t\t? this.searchAll(this.react, [criteria as any], 1000)[0]\n\t\t\t: null;\n\n\t\tif ( data?.cls ) {\n\t\t\twrapper._set(data.cls, data.instances as Set<TNode>);\n\t\t\tthis._known_classes.set(data.cls, wrapper);\n\n\t\t} else if ( routes !== false ) {\n\t\t\tthis._waiting.push(wrapper);\n\t\t\tthis._updateLiveWaiting();\n\t\t}\n\n\t\treturn wrapper;\n\t}\n\n\n\twrap<TNode extends ReactStateNode = ReactStateNode>(\n\t\tkey: string,\n\t\tcls?: ClassType<TNode>\n\t) {\n\t\tlet wrapper: FineWrapper<TNode>;\n\t\tif ( this._wrappers.has(key) )\n\t\t\twrapper = this._wrappers.get(key) as FineWrapper<TNode>;\n\t\telse {\n\t\t\twrapper = new FineWrapper(key, null, null, this);\n\t\t\tthis._wrappers.set(key, wrapper);\n\t\t}\n\n\t\tif ( cls ) {\n\t\t\tif ( wrapper.class || wrapper.criteria )\n\t\t\t\tthrow new Error('tried setting a class on an already initialized FineWrapper');\n\n\t\t\twrapper._set(cls, new Set);\n\t\t\tthis._known_classes.set(cls, wrapper);\n\t\t}\n\n\t\treturn wrapper;\n\t}\n\n\n\t_checkWaiters(nodes: OptionalArray<Node | ReactNode | ReactStateNode | null> = null) {\n\t\tif ( ! this._live_waiting )\n\t\t\treturn;\n\n\t\tif ( ! Array.isArray(nodes) )\n\t\t\tnodes = [nodes];\n\n\t\tfor(let input of nodes) {\n\t\t\tif ( ! this._live_waiting.length || ! this._waiting_crit )\n\t\t\t\tbreak;\n\n\t\t\tlet node: ReactNode | null = null;\n\t\t\tif ( ! input && this.react )\n\t\t\t\tnode = this.react;\n\t\t\telse if ( input instanceof Node )\n\t\t\t\tnode = this.getReactInstance(input);\n\t\t\telse if ( (input as ReactStateNode)?._reactInternals )\n\t\t\t\tnode = (input as ReactStateNode)._reactInternals;\n\t\t\telse if ( (input as ReactStateNode)?._reactInternalFiber )\n\t\t\t\tnode = (input as ReactStateNode)._reactInternalFiber;\n\n\t\t\t// Sanity check the node.\n\t\t\tif (! node ||\n\t\t\t\t(node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\t\tnode.stateNode?._ffz_no_scan\n\t\t\t)\n\t\t\t\tcontinue;\n\n\t\t\tconst data = this.searchAll(\n\t\t\t\tnode, this._waiting_crit, 1000\n\t\t\t);\n\n\t\t\tlet i = data.length;\n\t\t\twhile(i-- > 0) {\n\t\t\t\tif ( data[i].cls ) {\n\t\t\t\t\tconst d = data[i],\n\t\t\t\t\t\tw = this._live_waiting.splice(i, 1)[0];\n\n\t\t\t\t\tthis._waiting_crit.splice(i, 1);\n\n\t\t\t\t\tconst idx = this._waiting.indexOf(w);\n\t\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\t\tthis._waiting.splice(idx, 1);\n\n\t\t\t\t\tthis.log.debug(`Found class for \"${w.name}\" at depth ${d.depth}`);\n\t\t\t\t\tw._set(d.cls, d.instances as Set<ReactStateNode>);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( ! this._live_waiting.length )\n\t\t\tthis._stopWaiting();\n\t}\n\n\n\t_startWaiting() {\n\t\tthis.log.info('Installing MutationObserver.');\n\t\tthis._waiting_timer = setInterval(() => this._checkWaiters(), 500);\n\n\t\tif ( ! this._observer )\n\t\t\tthis._observer = new MutationObserver(mutations =>\n\t\t\t\tthis._checkWaiters(mutations.map(x => x.target))\n\t\t\t);\n\n\t\tthis._observer.observe(document.body, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true\n\t\t});\n\t}\n\n\n\t_stopWaiting() {\n\t\tthis.log.info('Stopping MutationObserver.');\n\n\t\tif ( this._observer )\n\t\t\tthis._observer.disconnect();\n\n\t\tif ( this._waiting_timer )\n\t\t\tclearInterval(this._waiting_timer);\n\n\t\tthis._live_waiting = null;\n\t\tthis._waiting_crit = null;\n\t\tthis._waiting_timer = null;\n\t}\n}\n\n\n// TODO: Extract props and stuff\nexport type ComponentMethods<TNode extends ReactStateNode = ReactStateNode> =\n\tExtractFunctions<TNode, true>;\n\nexport type ComponentMethodArgs<TNode extends ReactStateNode, K extends string> =\n\tK extends keyof ComponentMethods<TNode>\n\t\t? MaybeParameters<ComponentMethods<TNode>[K]>\n\t\t: never[];\n\n\nconst EVENTS: Record<string, keyof ComponentMethods> = {\n\t'will-mount': 'UNSAFE_componentWillMount',\n\tmount: 'componentDidMount',\n\trender: 'render',\n\t'receive-props': 'UNSAFE_componentWillReceiveProps',\n\t'should-update': 'shouldComponentUpdate',\n\t'will-update': 'UNSAFE_componentWillUpdate',\n\tupdate: 'componentDidUpdate',\n\tunmount: 'componentWillUnmount'\n}\n\n\nexport type WrapperEvents<TNode extends ReactStateNode> = {\n\tset: [klass: ClassType<TNode>, instances: Set<TNode>];\n\n\t'will-mount': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>];\n\tmount: [instance: TNode, ...args: ComponentMethodArgs<TNode, 'componentDidMount'>];\n\t'late-mount': [instance: TNode];\n\n\t'receive-props': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillReceiveProps'>];\n\t'will-update': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillUpdate'>];\n\t'should-update': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'shouldComponentUpdate'>];\n\tupdate: [instance: TNode, ...args: ComponentMethodArgs<TNode, 'componentDidUpdate'>];\n\n\trender: [instance: TNode];\n\n\tunmount: [instance: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>];\n};\n\n\nexport class FineWrapper<TNode extends ReactStateNode = ReactStateNode> extends EventEmitter<WrapperEvents<TNode>> {\n\n\treadonly name: string;\n\treadonly criteria: FineCriteria<TNode> | null;\n\treadonly fine: Fine;\n\treadonly instances: Set<TNode>;\n\treadonly routes: string[] | false;\n\n\tprivate readonly _wrapped: Map<keyof TNode, [any, any]>;\n\tprivate _class: ClassType<TNode> | null;\n\n\tconstructor(name: string, criteria: FineCriteria<TNode> | null, routes: string[] | false | null, fine: Fine) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.criteria = criteria;\n\t\tthis.fine = fine;\n\n\t\tthis.instances = new Set;\n\t\tthis.routes = routes ?? [];\n\n\t\tthis._wrapped = new Map;\n\t\tthis._class = null;\n\n\t}\n\n\tget class() { return this._class; }\n\n\tget first() {\n\t\treturn this.toArray()[0];\n\t}\n\n\tprotected __cleanListeners(): string[] {\n\t\tconst out = super.__cleanListeners();\n\n\t\tfor(const event of out) {\n\t\t\tconst key = EVENTS[event];\n\t\t\tif ( key )\n\t\t\t\ttry {\n\t\t\t\t\tthis._unwrap(key as keyof ComponentMethods<TNode>);\n\t\t\t\t} catch(err) { /* do nothing */ }\n\t\t}\n\n\t\treturn out;\n\t}\n\n\ttoArray() {\n\t\treturn Array.from(this.instances);\n\t}\n\n\tcheck(\n\t\tnode: ReactNode | ReactStateNode | Node | null = null,\n\t\tmax_depth = 1000\n\t) {\n\t\tif ( this._class || ! this.criteria )\n\t\t\treturn;\n\n\t\tconst instances = this.fine.findAllMatching<TNode>(node, this.criteria as any, max_depth);\n\t\tif ( instances.size ) {\n\t\t\tconst insts = Array.from(instances);\n\t\t\tthis._set(insts[0].constructor as any, insts);\n\t\t}\n\t}\n\n\tready(fn: (klass: ClassType<TNode>, instances: Set<TNode>) => void) {\n\t\tif ( this._class )\n\t\t\tfn(this._class, this.instances);\n\t\telse\n\t\t\tthis.once('set', fn);\n\t}\n\n\teach(fn: (inst: TNode) => void) {\n\t\tfor(const inst of this.instances)\n\t\t\tfn(inst);\n\t}\n\n\tupdateInstances(\n\t\tnode: ReactNode | ReactStateNode | Node | null = null,\n\t\tmax_depth = 1000\n\t) {\n\t\tif ( ! this._class )\n\t\t\treturn;\n\n\t\tconst instances = this.fine.findAllMatching<TNode>(\n\t\t\tnode,\n\t\t\tn => n.constructor === this._class,\n\t\t\tmax_depth\n\t\t);\n\n\t\tfor(const inst of instances) {\n\t\t\tinst._ffz_mounted = true;\n\t\t\tthis.instances.add(inst);\n\t\t}\n\t}\n\n\t_set(cls: ClassType<TNode>, instances: Iterable<TNode>) {\n\t\tif ( this._class )\n\t\t\tthrow new Error('already have a class');\n\n\t\tthis._class = cls;\n\t\t(cls as any)._ffz_wrapper = this;\n\n\t\tconst t = this,\n\t\t\t_instances = this.instances,\n\t\t\tproto = cls.prototype,\n\t\t\to_mount = proto.UNSAFE_componentWillMount as (this: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>) => any,\n\t\t\to_unmount = proto.componentWillUnmount as (this: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>) => any,\n\n\t\t\tmount = proto.UNSAFE_componentWillMount = o_mount ?\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>) {\n\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t_instances.add(this);\n\t\t\t\t\tt.emit('will-mount', this, ...args);\n\t\t\t\t\treturn o_mount.apply(this, args);\n\t\t\t\t} :\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>) {\n\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t_instances.add(this);\n\t\t\t\t\tt.emit('will-mount', this, ...args);\n\t\t\t\t},\n\n\t\t\tunmount = proto.componentWillUnmount = o_unmount ?\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>) {\n\t\t\t\t\tt.emit('unmount', this, ...args);\n\t\t\t\t\t_instances.delete(this);\n\t\t\t\t\tthis._ffz_mounted = false;\n\t\t\t\t\treturn o_unmount.apply(this, args);\n\t\t\t\t} :\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>) {\n\t\t\t\t\tt.emit('unmount', this, ...args);\n\t\t\t\t\t_instances.delete(this);\n\t\t\t\t\tthis._ffz_mounted = false;\n\t\t\t\t};\n\n\t\tthis._wrapped.set('UNSAFE_componentWillMount', [mount, o_mount]);\n\t\tthis._wrapped.set('componentWillUnmount', [unmount, o_unmount]);\n\n\t\tfor(const event of this.events())\n\t\t\tthis._maybeWrap(event);\n\n\t\tif ( instances )\n\t\t\tfor(const inst of instances) {\n\t\t\t\t// How do we check mounted state for fibers?\n\t\t\t\t// Just assume they're mounted for now I guess.\n\t\t\t\tinst._ffz_mounted = true;\n\t\t\t\t_instances.add(inst);\n\t\t\t}\n\n\t\tthis.emit('set', cls, _instances);\n\t}\n\n\tprivate _add(instances: Iterable<TNode>) {\n\t\tfor(const inst of instances)\n\t\t\tthis.instances.add(inst);\n\t}\n\n\n\tprivate _maybeWrap(event: string) {\n\t\tconst key = EVENTS[event as keyof typeof EVENTS];\n\t\tif ( ! this._class || ! key || this._wrapped.has(key) )\n\t\t\treturn;\n\n\t\tthis._wrap(event, key as keyof ComponentMethods<TNode>);\n\t}\n\n\tprivate _wrap<K extends string>(event: K, key: keyof ComponentMethods<TNode>) {\n\t\tif ( this._wrapped.has(key) || ! this._class )\n\t\t\treturn;\n\n\t\tconst t = this,\n\t\t\tproto = this._class.prototype,\n\t\t\toriginal = proto[key] as (this: TNode, ...args: ComponentMethodArgs<TNode, K>) => any,\n\n\t\t\tfn = (proto as any)[key] = original ?\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, K>) {\n\t\t\t\t\tif ( ! this._ffz_mounted ) {\n\t\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t\tt.instances.add(this);\n\t\t\t\t\t\tt.emit('late-mount', this);\n\t\t\t\t\t}\n\n\t\t\t\t\tt.emit(event as any, this, ...args);\n\t\t\t\t\treturn original.apply(this, args);\n\t\t\t\t} :\n\n\t\t\t\tkey === 'shouldComponentUpdate' ?\n\t\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, K>) {\n\t\t\t\t\t\tif ( ! this._ffz_mounted ) {\n\t\t\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t\t\tt.instances.add(this);\n\t\t\t\t\t\t\tt.emit('late-mount', this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tt.emit(event as any, this, ...args);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\t:\n\t\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, K>) {\n\t\t\t\t\t\tif ( ! this._ffz_mounted ) {\n\t\t\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t\t\tt.instances.add(this);\n\t\t\t\t\t\t\tt.emit('late-mount', this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tt.emit(event as any, this, ...args);\n\t\t\t\t\t};\n\n\t\tthis._wrapped.set(key, [fn, original]);\n\t}\n\n\tprivate _unwrap(key: keyof ComponentMethods<TNode>) {\n\t\tconst pair = this._wrapped.get(key);\n\t\tif ( ! pair || ! this._class )\n\t\t\treturn;\n\n\t\tconst proto = this._class.prototype,\n\t\t\t[fn, original] = pair;\n\n\t\tif ( proto[key] !== fn )\n\t\t\tthrow new Error('unable to unwrap -- prototype modified');\n\n\t\tproto[key] = original;\n\t\tthis._wrapped.delete(key);\n\t}\n\n\n\tforceUpdate() {\n\t\tfor(const inst of this.instances)\n\t\t\ttry {\n\t\t\t\tinst.forceUpdate();\n\t\t\t\tthis.fine.emit('site:dom-update', this.name, inst);\n\n\t\t\t} catch(err) {\n\t\t\t\tif ( err instanceof Error )\n\t\t\t\t\tthis.fine.log.capture(err, {\n\t\t\t\t\t\ttags: {\n\t\t\t\t\t\t\tfine_wrapper: this.name\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\tthis.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`, err);\n\t\t\t}\n\t}\n\n\n\ton<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, '', WrapperEvents<TNode>>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.on(event, fn, ctx, priority, prepend);\n\t}\n\n\n\tonce<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, '', WrapperEvents<TNode>>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.once(event, fn, ctx, priority, prepend);\n\t}\n\n\tmany<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, '', WrapperEvents<TNode>>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.many(event, ttl, fn, ctx, priority, prepend);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.waitFor(event, ctx, priority, prepend);\n\t}\n}\n","declare global {\n\tlet __extension__: string | undefined;\n}\n\n/** Whether or not FrankerFaceZ was loaded from a development server. */\nexport const DEBUG = localStorage.ffzDebugMode === 'true' && document.body.classList.contains('ffz-dev');\n\n/** Whether or not FrankerFaceZ was loaded as a packed web extension. */\nexport const EXTENSION = !!__extension__;\n\n/** The base URL of the FrankerFaceZ CDN. */\nexport const SERVER = DEBUG ? 'https://localhost:8000' : 'https://cdn2.frankerfacez.com';\n\nlet path = `${SERVER}/script`;\n\nif ( EXTENSION ) {\n\tpath = __webpack_public_path__;\n\tif ( path.endsWith('/') )\n\t\tpath = path.slice(0, path.length - 1);\n}\n\n/** Either the base URL of the FrankerFaceZ CDN or, if FFZ was loaded as a packed web extension, the base URL of the web extension's web accessible files. */\nexport const SERVER_OR_EXT = path;\n\n/** The base URL of the FrankerFaceZ API. */\nexport const API_SERVER = 'https://api.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ staging API. */\nexport const STAGING_API = 'https://api-staging.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ staging CDN. */\nexport const STAGING_CDN = 'https://cdn-staging.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ testing API used for load testing. */\nexport const NEW_API = 'https://api2.frankerfacez.com';\n\n/** The base URL provided to Sentry integrations for automatic error reporting. */\nexport const SENTRY_ID = 'https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2';\n\nexport const WORD_SEPARATORS = '[\\\\s`~<>!-#%-\\\\x2A,-/:;\\\\x3F@\\\\x5B-\\\\x5D_\\\\x7B}\\\\u00A1\\\\u00A7\\\\u00AB\\\\u00B6\\\\u00B7\\\\u00BB\\\\u00BF\\\\u037E\\\\u0387\\\\u055A-\\\\u055F\\\\u0589\\\\u058A\\\\u05BE\\\\u05C0\\\\u05C3\\\\u05C6\\\\u05F3\\\\u05F4\\\\u0609\\\\u060A\\\\u060C\\\\u060D\\\\u061B\\\\u061E\\\\u061F\\\\u066A-\\\\u066D\\\\u06D4\\\\u0700-\\\\u070D\\\\u07F7-\\\\u07F9\\\\u0830-\\\\u083E\\\\u085E\\\\u0964\\\\u0965\\\\u0970\\\\u0AF0\\\\u0DF4\\\\u0E4F\\\\u0E5A\\\\u0E5B\\\\u0F04-\\\\u0F12\\\\u0F14\\\\u0F3A-\\\\u0F3D\\\\u0F85\\\\u0FD0-\\\\u0FD4\\\\u0FD9\\\\u0FDA\\\\u104A-\\\\u104F\\\\u10FB\\\\u1360-\\\\u1368\\\\u1400\\\\u166D\\\\u166E\\\\u169B\\\\u169C\\\\u16EB-\\\\u16ED\\\\u1735\\\\u1736\\\\u17D4-\\\\u17D6\\\\u17D8-\\\\u17DA\\\\u1800-\\\\u180A\\\\u1944\\\\u1945\\\\u1A1E\\\\u1A1F\\\\u1AA0-\\\\u1AA6\\\\u1AA8-\\\\u1AAD\\\\u1B5A-\\\\u1B60\\\\u1BFC-\\\\u1BFF\\\\u1C3B-\\\\u1C3F\\\\u1C7E\\\\u1C7F\\\\u1CC0-\\\\u1CC7\\\\u1CD3\\\\u2010-\\\\u2027\\\\u2030-\\\\u2043\\\\u2045-\\\\u2051\\\\u2053-\\\\u205E\\\\u207D\\\\u207E\\\\u208D\\\\u208E\\\\u2329\\\\u232A\\\\u2768-\\\\u2775\\\\u27C5\\\\u27C6\\\\u27E6-\\\\u27EF\\\\u2983-\\\\u2998\\\\u29D8-\\\\u29DB\\\\u29FC\\\\u29FD\\\\u2CF9-\\\\u2CFC\\\\u2CFE\\\\u2CFF\\\\u2D70\\\\u2E00-\\\\u2E2E\\\\u2E30-\\\\u2E3B\\\\u3001-\\\\u3003\\\\u3008-\\\\u3011\\\\u3014-\\\\u301F\\\\u3030\\\\u303D\\\\u30A0\\\\u30FB\\\\uA4FE\\\\uA4FF\\\\uA60D-\\\\uA60F\\\\uA673\\\\uA67E\\\\uA6F2-\\\\uA6F7\\\\uA874-\\\\uA877\\\\uA8CE\\\\uA8CF\\\\uA8F8-\\\\uA8FA\\\\uA92E\\\\uA92F\\\\uA95F\\\\uA9C1-\\\\uA9CD\\\\uA9DE\\\\uA9DF\\\\uAA5C-\\\\uAA5F\\\\uAADE\\\\uAADF\\\\uAAF0\\\\uAAF1\\\\uABEB\\\\uFD3E\\\\uFD3F\\\\uFE10-\\\\uFE19\\\\uFE30-\\\\uFE52\\\\uFE54-\\\\uFE61\\\\uFE63\\\\uFE68\\\\uFE6A\\\\uFE6B\\\\uFF01-\\\\uFF03\\\\uFF05-\\\\uFF0A\\\\uFF0C-\\\\uFF0F\\\\uFF1A\\\\uFF1B\\\\uFF1F\\\\uFF20\\\\uFF3B-\\\\uFF3D\\\\uFF3F\\\\uFF5B\\\\uFF5D\\\\uFF5F-\\\\uFF65]';\n\n/**\n * A map of default Twitch emotes with non-standard sizes, so they can be displayed\n * more accurately in certain situations.\n */\nexport const WEIRD_EMOTE_SIZES: Record<string, [width: number, height: number]> = {\n\t15: [21,27],\n\t16: [22,27],\n\t17: [20,27],\n\t18: [20,27],\n\t22: [19,27],\n\t25: [25,28],\n\t26: [20,27],\n\t28: [39,27],\n\t30: [29,27],\n\t32: [21,27],\n\t33: [25,32],\n\t34: [21,28],\n\t36: [36,30],\n\t40: [21,27],\n\t41: [19,27],\n\t46: [24,24],\n\t47: [24,24],\n\t50: [18,27],\n\t52: [32,32],\n\t65: [40,30],\n\t66: [20,27],\n\t69: [41,28],\n\t73: [21,30],\n\t74: [24,30],\n\t86: [36,30],\n\t87: [24,30],\n\t92: [23,30],\n\t244: [24,30],\n\t354: [20,30],\n\t357: [28,30],\n\t360: [22,30],\n\t483: [20,18],\n\t484: [20,22],\n\t485: [27,18],\n\t486: [21,32],\n\t487: [15,32],\n\t488: [29,24],\n\t489: [20,18],\n\t490: [20,18],\n\t491: [20,18],\n\t492: [20,18],\n\t493: [20,18],\n\t494: [20,18],\n\t495: [20,18],\n\t496: [20,18],\n\t497: [20,18],\n\t498: [20,18],\n\t499: [20,18],\n\t500: [20,18],\n\t501: [20,18],\n\t1896: [20,30],\n\t1898: [26,28],\n\t1899: [22,30],\n\t1900: [33,30],\n\t1901: [24,28],\n\t1902: [27,29],\n\t1904: [24,30],\n\t1906: [24,30]\n};\n\n/** A list of hotkey combinations that are not valid for one reason or another. */\nexport const BAD_HOTKEYS = [\n\t'f',\n\t'space',\n\t'k',\n\t'shift+up',\n\t'shift+down',\n\t'esc',\n\t'm',\n\t'?',\n\t'alt+t',\n\t'alt+x'\n];\n\n/** A list of setting keys that, when changed, cause chat messages to re-render. */\nexport const RERENDER_SETTINGS = [\n\t'chat.name-format',\n\t'chat.me-style',\n\t'chat.rituals.show',\n\t'chat.subs.show',\n\t'chat.subs.compact',\n\t'chat.actions.inline',\n\t'chat.actions.hover',\n\t'chat.timestamp-format',\n\t'chat.points.allow-highlight',\n\t'chat.filtering.display-deleted',\n\t'chat.filtering.display-mod-action',\n\t'chat.replies.style',\n\t'chat.bits.cheer-notice',\n\t'chat.filtering.hidden-tokens',\n\t'chat.hype.message-style',\n\t'chat.filtering.show-reasons',\n\t'chat.emotes.allow-gigantify',\n\t'chat.shared-chat.username-tooltip',\n\t'chat.shared-chat.style'\n] as const;\n\n/**\n * A list of setting keys that, when changed, cause chat messages to first clear\n * their badge caches and then re-render.\n */\nexport const UPDATE_BADGE_SETTINGS = [\n\t'chat.badges.style',\n\t'chat.badges.hidden',\n\t'chat.badges.custom-mod',\n\t'chat.badges.custom-vip',\n] as const;\n\n/**\n * A list of setting keys that, when changed, cause chat messages to first clear\n * their cached token lists and then re-render.\n */\nexport const UPDATE_TOKEN_SETTINGS = [\n\t'chat.emotes.enabled',\n\t'chat.emotes.2x',\n\t'chat.emotes.animated',\n\t'chat.emoji.style',\n\t'chat.emoji.replace-joiner',\n\t'chat.bits.stack',\n\t'chat.rich.enabled',\n\t'chat.rich.want-mid',\n\t'chat.rich.hide-tokens',\n\t'chat.rich.all-links',\n\t'chat.rich.minimum-level',\n\t'chat.filtering.process-own',\n\t'chat.filtering.mention-priority',\n\t'chat.filtering.debug',\n\t'chat.fix-bad-emotes',\n\t'__filter:highlight-terms',\n\t'__filter:highlight-users',\n\t'__filter:highlight-badges',\n\t'__filter:block-terms',\n\t'__filter:block-users',\n\t'__filter:block-badges'\n] as const;\n\n/**\n * A list of keycodes for specific keys, for use with\n * {@link KeyboardEvent} events.\n */\nexport const KEYS = {\n\tTab: 9,\n\tEnter: 13,\n\tShift: 16,\n\tControl: 17,\n\tAlt: 18,\n\tEscape: 27,\n\tSpace: 32,\n\tPageUp: 33,\n\tPageDown: 34,\n\tEnd: 35,\n\tHome: 36,\n\tArrowLeft: 37,\n\tArrowUp: 38,\n\tArrowRight: 39,\n\tArrowDown: 40,\n\tMeta: 91,\n\tContext: 93\n} as const;\n\n/** The base URL for Twitch emote images. */\nexport const TWITCH_EMOTE_V2 = '//static-cdn.jtvnw.net/emoticons/v2';\n\n/**\n * A map of regex-style Twitch emote codes into normal,\n * human-readable strings for display in UI.\n */\nexport const KNOWN_CODES: Record<string, string> = {\n\t'#-?[\\\\\\\\/]': '#-/',\n\t':-?(?:7|L)': ':-7',\n\t'\\\\&lt\\\\;\\\\]': '<]',\n\t'\\\\:-?(S|s)': ':-S',\n\t'\\\\:-?\\\\\\\\': ':-\\\\',\n\t'\\\\:\\\\&gt\\\\;': ':>',\n\t'B-?\\\\)': 'B-)',\n\t'\\\\:-?[z|Z|\\\\|]': ':-Z',\n\t'\\\\:-?\\\\)': ':-)',\n\t'\\\\:-?\\\\(': ':-(',\n\t'\\\\:-?(p|P)': ':-P',\n\t'\\\\;-?(p|P)': ';-P',\n\t'\\\\&lt\\\\;3': '<3',\n\t'\\\\:-?[\\\\\\\\/]': ':-/',\n\t'\\\\;-?\\\\)': ';-)',\n\t'R-?\\\\)': 'R-)',\n\t'[oO](_|\\\\.)[oO]': 'O.o',\n\t'[o|O](_|\\\\.)[o|O]': 'O.o',\n\t'\\\\:-?D': ':-D',\n\t'\\\\:-?(o|O)': ':-O',\n\t'\\\\&gt\\\\;\\\\(': '>(',\n\t'Gr(a|e)yFace': 'GrayFace'\n};\n\n/** The base URL for replacement images used for specific Twitch emotes. */\nexport const REPLACEMENT_BASE = `${SERVER}/static/replacements/`;\n\n/** A map of specific Twitch emotes that should use replacement images. */\nexport const REPLACEMENTS: Record<string, string> = {\n\t15: '15-JKanStyle.png',\n\t16: '16-OptimizePrime.png',\n\t17: '17-StoneLightning.png',\n\t18: '18-TheRinger.png',\n\t//19: '19-PazPazowitz.png',\n\t//20: '20-EagleEye.png',\n\t//21: '21-CougarHunt.png',\n\t22: '22-RedCoat.png',\n\t26: '26-JonCarnage.png',\n\t//27: '27-PicoMause.png',\n\t30: '30-BCWarrior.png',\n\t33: '33-DansGame.png',\n\t36: '36-PJSalt.png'\n};\n\n/**\n * A map of WebSocket servers for the original FrankerFaceZ socket\n * system. @deprecated\n */\nexport const WS_CLUSTERS = {\n\tProduction: [\n\t\t['wss://catbag.frankerfacez.com/', 0.25],\n\t\t['wss://andknuckles.frankerfacez.com/', 0.8],\n\t\t['wss://tuturu.frankerfacez.com/', 0.7],\n\t\t['wss://lilz.frankerfacez.com/', 1],\n\t\t['wss://yoohoo.frankerfacez.com/', 1],\n\t\t['wss://pog.frankerfacez.com/', 1],\n\t\t['wss://ayaya.frankerfacez.com/', 1],\n\t\t['wss://champ.frankerfacez.com/', 1]\n\t],\n\n\tDevelopment: [\n\t\t['ws://127.0.0.1:7999/', 1]\n\t]\n}\n\n\nexport const LINK_DATA_HOSTS = {\n\t/*socket: {\n\t\ttitle: 'Socket Cluster (Deprecated)',\n\t\tvalue: 'special:socket'\n\t},*/\n\tlocalhost: {\n\t\ttitle: 'Local Dev Server (Port 8002)',\n\t\tvalue: 'https://localhost:8002',\n\t\thas_sse: true\n\t},\n\t'localhost-cf': {\n\t\ttitle: 'Local Dev Worker (Wrangler, Port 8787)',\n\t\tvalue: 'https://localhost:8787'\n\t},\n\t/*test: {\n\t\ttitle: 'API Test Server',\n\t\tvalue: 'https://api-test.frankerfacez.com/v2/link'\n\t},\n\t'test-cf': {\n\t\ttitle: 'Cloudflare Test Worker',\n\t\tvalue: 'https://link-service.workers.frankerfacez.com'\n\t},*/\n\tProduction: {\n\t\ttitle: 'Production',\n\t\tvalue: 'https://link-service.workers.frankerfacez.com'\n\t}\n};\n\n\nexport const PUBSUB_CLUSTERS = {\n\tProduction: `https://pubsub.frankerfacez.com`,\n\tStaging: `https://pubsub-staging-alt.frankerfacez.com`,\n\tEMQXTest: 'emqx-test',\n\tDevelopment: `https://stendec.dev/ps/`\n}\n\nexport const EMQX_SERVERS = [\n\t//'catbag.frankerfacez.com',\n\t//'pubsub-staging.frankerfacez.com',\n\t'biblethump.frankerfacez.com',\n\t/*'ayaya.frankerfacez.com',\n\t'champ.frankerfacez.com',\n\t'lilz.frankerfacez.com',\n\t'pog.frankerfacez.com',\n\t'yoohoo.frankerfacez.com',\n\t'andknuckles.frankerfacez.com'*/\n];\n\n\n/** Whether or not we're running on macOS */\nexport const IS_OSX = navigator.platform ? navigator.platform.indexOf('Mac') !== -1 : /OS X/.test(navigator.userAgent);\n\n/** Whether or not we're running on Windows */\nexport const IS_WIN = navigator.platform ? navigator.platform.indexOf('Win') !== -1 : /Windows/.test(navigator.userAgent);\n\n/** Whether or not we're running on a Webkit-based browser. */\nexport const IS_WEBKIT = navigator.userAgent.indexOf('AppleWebKit/') !== -1 && navigator.userAgent.indexOf('Edge/') === -1;\n\n/** Whether or not we're running on a Firefox-based browser. */\nexport const IS_FIREFOX = (navigator.userAgent.indexOf('Firefox/') !== -1);\n\n/**\n * A -webkit- CSS prefix, if we're running on a Webkit-based browser.\n * Hopefully we don't need this anymore.\n * @deprecated\n */\nexport const WEBKIT_CSS = IS_WEBKIT ? '-webkit-' : '';\n\n/** A list of Twitch emote sets that are globally available. */\nexport const TWITCH_GLOBAL_SETS = [0, 33, 42] as const;\n\n/** A list of Twitch emote sets that are for emotes unlocked with channel points. */\nexport const TWITCH_POINTS_SETS = [300238151] as const;\n\n/** A list of Twitch emote sets that are for Twitch Prime subscribers. */\nexport const TWITCH_PRIME_SETS = [457, 793, 19151, 19194] as const;\n\n/** An enum of all possible Twitch emote types. */\nexport enum EmoteTypes {\n\t/** What kind of weird emote are you dragging in here */\n\tUnknown,\n\t/** Emotes unlocked via Twitch Prime */\n\tPrime,\n\t/** Emotes unlocked via Twitch Turbo */\n\tTurbo,\n\t/** Emotes unlocked via arbitrary condition, permanently available. */\n\tLimitedTime,\n\t/** Emotes unlocked via channel points. */\n\tChannelPoints,\n\t/** Emote no longer available. */\n\tUnavailable,\n\t/** Emote unlocked via subscription to channel. */\n\tSubscription,\n\t/** Emote permanently unlocked via cheering in channel. */\n\tBitsTier,\n\t/** Globally available emote. */\n\tGlobal,\n\t/** Emote unlocked via enabling two-factor authentication. */\n\tTwoFactor,\n\t/** Emote unlocked via following a channel. */\n\tFollower\n};\n\n\nexport const RESOLVERS_REQUIRE_TOS = {\n\t'YouTube': {\n\t\tlabel: 'You must agree to the YouTube Terms of Service to view this embed.',\n\t\ti18n_key: 'embed.warn.youtube',\n\n\t\ti18n_links: 'embed.warn.youtube.links',\n\t\tlinks: `To view YouTube embeds, you must agree to YouTube's Terms of Service:\n* [Terms of Service](https://www.youtube.com/t/terms)\n* [Privacy Policy](https://policies.google.com/privacy)`,\n\n\t\ti18n_accept: 'embed.warn.youtube.agree',\n\t\taccept: 'Yes, I accept the YouTube Terms of Service.'\n\t},\n\n} as Record<string, any>;\n","\nimport {has} from 'utilities/object';\nimport type { DomFragment } from './types';\nimport { DEBUG } from './constants';\n\nconst ATTRS = [\n\t'accept', 'accept-charset', 'accesskey', 'action', 'align', 'alt', 'async',\n\t'autocomplete', 'autofocus', 'autoplay', 'bgcolor', 'border', 'buffered',\n\t'challenge', 'charset', 'checked', 'cite', 'class', 'code', 'codebase',\n\t'color', 'cols', 'colspan', 'content', 'contenteditable', 'contextmenu',\n\t'controls', 'coords', 'crossorigin', 'data', 'data-*', 'datetime',\n\t'default', 'defer', 'dir', 'dirname', 'download', 'draggable',\n\t'dropzone', 'enctype', 'for', 'form', 'formaction', 'headers', 'height',\n\t'hidden', 'high', 'href', 'hreflang', 'http-equiv', 'icon', 'id',\n\t'integrity', 'ismap', 'itemprop', 'keytype', 'kind', 'label', 'lang',\n\t'language', 'list', 'loop', 'low', 'manifest', 'max', 'maxlength',\n\t'minlength', 'media', 'method', 'min', 'multiple', 'name',\n\t'novalidate', 'open', 'optimum', 'pattern', 'ping', 'placeholder', 'poster',\n\t'preload', 'radiogroup', 'readonly', 'rel', 'required', 'reversed', 'rows',\n\t'rowspan', 'sandbox', 'scope', 'scoped', 'seamless', 'selected', 'shape',\n\t'size', 'sizes', 'slot', 'span', 'spellcheck', 'src', 'srcdoc', 'srclang',\n\t'srcset', 'start', 'step', 'style', 'summary', 'tabindex', 'target',\n\t'title', 'type', 'usemap', 'value', 'width', 'wrap'\n];\n\nconst SVG_TAGS = [\n\t'svg', 'animate', 'animateMotion', 'animateTransform', 'circle', 'clipPath',\n\t'cursor', 'defs', 'desc', 'ellipse', 'feBlend', 'feColorMatrix', 'feComponentTransfer',\n\t'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight',\n\t'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur',\n\t'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight',\n\t'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence', 'filter', 'font-face-format',\n\t'font-face-name', 'font-face-src', 'font-face-uri', 'font-face', 'font', 'foreignObject',\n\t'g', 'glyph', 'glyphRef', 'hkern', 'image', 'line', 'linearGradient', 'marker', 'mask',\n\t'metadata', 'missing-glyph', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialGradient',\n\t'rect', 'set', 'stop', 'switch', 'symbol', 'text', 'textPath', 'tref',\n\t'tspan', 'use', 'view', 'vkern'\n];\n\n/*const SVG_ATTRS = [\n\t'accent-height', 'accumulate', 'additive', 'alignment-baseline', 'alphabetic',\n\t'amplitude', 'arabic-form', 'ascent', 'attributeName', 'attributeType', 'azimuth',\n\t'baseFrequency', 'baseline-shift', 'baseProfile', 'bbox', 'begin', 'bias', 'by',\n\t'calcMode', 'cap-height', 'class', 'clip', 'clipPathUnits', 'clip-path', 'clip-rule',\n\t'color', 'color-interpolation', 'color-interpolation-filters', 'crossorigin',\n\t'cursor', 'cx', 'cy', 'd', 'decoding', 'descent', 'diffuseConstant', 'direction', 'display',\n\t'divisor', 'dominant-baseline', 'dur', 'dx', 'dy', 'edgeMode', 'elevation', 'end', 'exponent',\n\t'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterUnits', 'flood-color', 'flood-opacity',\n\t'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant',\n\t'font-weight', 'fr', 'from', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyph-orientation-horizontal',\n\t'glyph-orientation-vertical', 'gradientTransform', 'gradientUnits', 'hanging',\n\t'horiz-adv-x', 'horiz-origin-x', 'ideographic', 'image-rendering', 'in', 'in2', 'intercept',\n\t'k', 'k1', 'k2', 'k3', 'k4', 'kernelMatrix', 'kernelUnitLength', 'keyPoints', 'keySplines',\n\t'keyTimes', 'lang', 'lengthAdjust', 'letter-spacing', 'lighting-color', 'limitingConeAngle',\n\t'local', 'marker-end', 'marker-mid', 'marker-start', 'markerHeight', 'markerUnits', 'markerWidth',\n\t'mask', 'maskContentUnits', 'maskUnits', 'mathematical', 'max', 'media', 'method', 'min', 'mode',\n\t'name', 'numOctaves', 'offset', 'opacity', 'operator', 'order', 'orient', 'orientation', 'origin',\n\t'overflow', 'overline-position', 'overline-thickness', 'paint-order', 'panose-1', 'path',\n\t'pathLength', 'patternContentUnits', 'patternTransform', 'patternUnits', 'ping', 'pointer-events',\n\t'points', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'preserveAlpha', 'preserveAspectRatio',\n\t'primitiveUnits', 'r', 'radius', 'refX', 'refY', 'result', 'rotate', 'rx', 'ry', 'scale', 'seed',\n\t'side', 'spacing', 'stop-color', 'stop-opacity', 'st'\n];*/\n\nconst BOOLEAN_ATTRS = [\n\t'controls', 'autoplay', 'loop'\n];\n\n\nconst range = document.createRange();\n\nfunction camelCase(name: string) {\n\treturn name.replace(/[-_]\\w/g, m => m[1].toUpperCase());\n}\n\n/**\n * A simple helper method for calling {@link EventTarget.addEventListener}\n * @internal\n */\nexport function on(obj: EventTarget, type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | AddEventListenerOptions) {\n\treturn obj.addEventListener(type, listener, options);\n}\n\n/**\n * A simple helper method for calling {@link EventTarget.removeEventListener}\n * @internal\n */\nexport function off(obj: EventTarget, type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | EventListenerOptions) {\n\treturn obj.removeEventListener(type, listener, options);\n}\n\n\n// TODO: Better fake React types.\n\ntype SimpleNodeLike = {\n\tprops?: {\n\t\tchildren?: SimpleNodeLike | SimpleNodeLike[]\n\t}\n}\n\n/**\n * Scan a React render tree, attempting to find a matching fragment.\n *\n * @param frag The initial point to start scanning the tree.\n * @param criteria A function that returns true if a fragment matches what\n * we want.\n * @param depth The maximum scanning depth, defaults to 25.\n * @param current For Internal Use. The current scanning depth.\n * @param visited For Internal Use. A Set of all visited fragments, to prevent\n * redundant checks.\n * @returns The matching fragment, or null if one was not found.\n */\nexport function findReactFragment<TNode extends SimpleNodeLike>(\n\tfrag: TNode,\n\tcriteria: (node: TNode) => boolean,\n\tdepth: number = 25,\n\tcurrent: number = 0,\n\tvisited?: Set<any>\n): TNode | null {\n\tif ( ! visited )\n\t\tvisited = new Set;\n\telse if ( visited.has(frag) )\n\t\treturn null;\n\n\tif ( criteria(frag) )\n\t\treturn frag;\n\n\tif ( current >= depth )\n\t\treturn null;\n\n\tvisited.add(frag);\n\n\tif ( frag?.props?.children ) {\n\t\tif ( Array.isArray(frag.props.children) ) {\n\t\t\tfor(const child of frag.props.children) {\n\t\t\t\tif ( ! child )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( Array.isArray(child) ) {\n\t\t\t\t\tfor(const f of child) {\n\t\t\t\t\t\tconst out = findReactFragment(f, criteria, depth, current + 1, visited);\n\t\t\t\t\t\tif ( out )\n\t\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst out = findReactFragment(child as TNode, criteria, depth, current + 1, visited);\n\t\t\t\t\tif ( out )\n\t\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst out = findReactFragment(frag.props.children as TNode, criteria, depth, current + 1, visited);\n\t\t\tif ( out )\n\t\t\t\treturn out;\n\t\t}\n\t}\n\n\treturn null;\n}\n\n\n// TODO: Stronger types.\n\n/**\n * This method allows you to create native DOM fragments using the same calling\n * syntax as React's `React.createElement` method. Because of this, we can use\n * JSX for creating native DOM fragments, as well as rendering functions that are\n * interchangable inside of and outside of a React context.\n *\n * @example Create a span containing a figure to render an icon.\n * ```typescript\n * return createElement('span', {\n *     className: 'ffz--icon-holder tw-mg-r-05'\n * }, createElement('figure', {\n *     className: 'ffz-i-zreknarf'\n * }));\n * ```\n *\n * @example Doing the same, but with JSX\n * ```typescript\n * // When using JSX, we still need to make sure createElement is available in\n * // the current context. It can be provided as an argument to a function, or\n * // imported at the top level of the module.\n *\n * import { createElement } from 'utilities/dom';\n * // or... if you're working with add-ons...\n * const { createElement } = FrankerFaceZ.utilities.dom;\n *\n * return (<span class=\"ffz--icon-holder tw-mg-r-05\">\n *     <figure class=\"ffz-i-zreknarf\" />\n * </span>);\n * ```\n *\n * @param tag The name of the tag to be created. Functions are not supported.\n * @param props The properties object.\n * @param children A child or list of children. These should be strings, `null`s,\n * or {@link Node}s that can be assigned as children of a {@link HTMLElement}.\n */\nexport function createElement<K extends keyof HTMLElementTagNameMap>(tag: K, props?: any, ...children: DomFragment[]): HTMLElementTagNameMap[K];\nexport function createElement<K extends keyof HTMLElementDeprecatedTagNameMap>(tag: K, props?: any, ...children: DomFragment[]): HTMLElementDeprecatedTagNameMap[K];\nexport function createElement(tag: string, props?: any, ...children: DomFragment[]): HTMLElement {\n\tconst isSvg = SVG_TAGS.includes(tag);\n\tconst el = isSvg\n\t\t// This is technically wrong. I do not really care.\n\t\t? document.createElementNS('http://www.w3.org/2000/svg', tag) as unknown as HTMLElement\n\t\t: document.createElement(tag);\n\n\tif ( children.length === 0)\n\t\tchildren = null as any;\n\telse if ( children.length === 1 )\n\t\tchildren = children[0] as any;\n\n\tif ( typeof props === 'string' )\n\t\tel.setAttribute('class', props);\n\telse if ( props )\n\t\tfor(const key in props)\n\t\t\tif ( has(props, key) ) {\n\t\t\t\tconst lk = key.toLowerCase(),\n\t\t\t\t\tprop = props[key];\n\n\t\t\t\tif ( key === 'className' ) {\n\t\t\t\t\tel.setAttribute('class', prop);\n\n\t\t\t\t} else if ( lk === 'style' ) {\n\t\t\t\t\tif ( typeof prop === 'string' )\n\t\t\t\t\t\tel.style.cssText = prop;\n\t\t\t\t\telse if ( prop && typeof prop === 'object' )\n\t\t\t\t\t\tfor(const [key, val] of Object.entries(prop)) {\n\t\t\t\t\t\t\tif ( has(el.style, key) || has(Object.getPrototypeOf(el.style), key) )\n\t\t\t\t\t\t\t\t(el.style as any)[key] = val;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tel.style.setProperty(key, prop[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\telse if ( DEBUG && prop != null )\n\t\t\t\t\t\tconsole.warn('unsupported style value', prop);\n\n\t\t\t\t} else if ( lk === 'dataset' ) {\n\t\t\t\t\tif ( prop && typeof prop === 'object' ) {\n\t\t\t\t\t\tfor(const k in prop)\n\t\t\t\t\t\t\tif ( has(prop, k) )\n\t\t\t\t\t\t\t\tel.dataset[camelCase(k)] = prop[k];\n\t\t\t\t\t} else if ( DEBUG && prop != null )\n\t\t\t\t\t\tconsole.warn('unsupported dataset value', prop);\n\n\t\t\t\t} else if ( key === 'dangerouslySetInnerHTML' ) {\n\t\t\t\t\t// React compatibility is cool. SeemsGood\n\t\t\t\t\tif ( prop && prop.__html )\n\t\t\t\t\t\tel.innerHTML = prop.__html;\n\n\t\t\t\t} else if ( lk.startsWith('on') )\n\t\t\t\t\tel.addEventListener(lk.slice(2), prop);\n\n\t\t\t\telse if ( lk.startsWith('data-') )\n\t\t\t\t\tel.dataset[camelCase(lk.slice(5))] = prop;\n\n\t\t\t\telse if ( BOOLEAN_ATTRS.includes(lk) ) {\n\t\t\t\t\tif ( prop && prop !== 'false' )\n\t\t\t\t\t\tel.setAttribute(key, prop);\n\n\t\t\t\t} else if ( lk.startsWith('aria-') || ATTRS.includes(lk) || SVG_TAGS.includes(tag) )\n\t\t\t\t\tel.setAttribute(key, prop);\n\n\t\t\t\telse\n\t\t\t\t\t(el as any)[key] = prop;\n\t\t\t}\n\n\tif ( children )\n\t\tsetChildren(el, children);\n\n\treturn el;\n}\n\n/**\n * Set the children of a {@link HTMLElement}. This is also used internally by\n * the {@link createElement} method.\n *\n * @param element The element to set the children of.\n * @param children The children to add to the element.\n * @param no_sanitize If this is set to true, any provided string values will\n * be treated as HTML rather than text and will not be sanitized. This is\n * NOT recommended.\n * @param no_empty If this is set to true, the element's previous contents\n * will not be discarded before setting the new children.\n */\nexport function setChildren(\n\telement: HTMLElement,\n\tchildren: DomFragment,\n\tno_sanitize: boolean = false,\n\tno_empty: boolean = false\n) {\n\tif (no_sanitize)\n\t\twindow.FrankerFaceZ.get().log.warn('call to setChildren with no_sanitize set to true -- this is no longer supported');\n\n\tif (children instanceof Node ) {\n\t\tif (! no_empty )\n\t\t\telement.innerHTML = '';\n\n\t\telement.appendChild(children);\n\n\t} else if ( Array.isArray(children) ) {\n\t\tif (! no_empty)\n\t\t\telement.innerHTML = '';\n\n\t\tfor(const child of children)\n\t\t\tif (child instanceof Node)\n\t\t\t\telement.appendChild(child);\n\t\t\telse if (Array.isArray(child))\n\t\t\t\tsetChildren(element, child, no_sanitize, true);\n\t\t\telse if (child) {\n\t\t\t\tconst val = typeof child === 'string' ? child : String(child);\n\n\t\t\t\t// We no longer support no_sanitize\n\t\t\t\t//element.appendChild(no_sanitize ?\n\t\t\t\t//\trange.createContextualFragment(val) : document.createTextNode(val));\n\n\t\t\t\telement.appendChild(document.createTextNode(val));\n\t\t\t}\n\n\t} else if (children) {\n\t\tconst val = typeof children === 'string' ? children : String(children);\n\n\t\t// We no longer support no_sanitize\n\t\t//element.appendChild(no_sanitize ?\n\t\t//\trange.createContextualFragment(val) : document.createTextNode(val));\n\t\telement.appendChild(document.createTextNode(val));\n\t}\n}\n\n/**\n * Determine if the two provided Nodes share a parent.\n *\n * @param element The first node.\n * @param other The second node.\n * @param selector A CSS selector to use. If this is set, only consider parents\n * that match the selector.\n */\nexport function hasSharedParent(element: Node | null, other: Node, selector?: string) {\n\twhile(element) {\n\t\tif ( element.contains(other) )\n\t\t\treturn true;\n\n\t\telement = element.parentElement;\n\t\tif ( selector )\n\t\t\telement = element instanceof Element\n\t\t\t\t? element.closest(selector)\n\t\t\t\t: null;\n\t}\n\n\treturn false;\n}\n\n\n/**\n * Display an Open File dialog to the user and return the selected\n * value. This may never return depending on the user agent's\n * behavior and should be used sparingly and never in a heavy\n * context to avoid excess memory usage.\n *\n * @param contentType The content type to filter by when selecting files.\n * @param multiple Whether or not multiple files should be returned.\n * @returns A file or list of files.\n */\nexport function openFile(contentType: string, multiple: boolean) {\n\treturn new Promise<File | File[] | null>(resolve => {\n\t\tconst input = document.createElement('input');\n\t\tinput.type = 'file';\n\t\tinput.accept = contentType;\n\t\tinput.multiple = multiple;\n\n\t\tlet resolved = false;\n\n\t\t// TODO: Investigate this causing issues\n\t\t// for some users.\n\t\t/*const focuser = () => {\n\t\t\toff(window, 'focus', focuser);\n\t\t\tsetTimeout(() => {\n\t\t\t\tif ( ! resolved ) {\n\t\t\t\t\tresolved = true;\n\t\t\t\t\tresolve(multiple ? [] : null);\n\t\t\t\t}\n\t\t\t}, 5000);\n\t\t};\n\n\t\ton(window, 'focus', focuser);*/\n\n\t\tinput.onchange = () => {\n\t\t\t//off(window, 'focus', focuser);\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tconst files = Array.from(input.files ?? []);\n\t\t\t\tresolve(multiple ? files : files[0])\n\t\t\t}\n\t\t}\n\n\t\tinput.click();\n\t});\n}\n\n/**\n * Read the contents of a {@link File} asynchronously.\n *\n * @param file The file to read\n * @param encoding The character encoding to use. Defaults to UTF-8.\n */\nexport function readFile(file: Blob, encoding = 'utf-8') {\n\treturn new Promise((resolve, reject) => {\n\t\tconst reader = new FileReader();\n\t\treader.readAsText(file, encoding);\n\t\treader.onload = () => resolve(reader.result);\n\t\treader.onerror = e => reject(e);\n\t});\n}\n\n\nconst el = document.createElement('span');\n\n/**\n * Sanitize a string, replacing all special HTML characters\n * with entities.\n *\n * Internally, this uses the browser's native DOM library\n * by setting `textContent` on an Element and returning its\n * `innerHTML`.\n *\n * @param text The text to sanitize.\n */\nexport function sanitize(text: string) {\n\tel.textContent = text;\n\tconst out = el.innerHTML;\n\t// Ensure we're not keeping large strings in memory.\n\tel.textContent = '';\n\treturn out;\n}\n\n\nlet last_id = 0;\n\nexport class ManagedStyle {\n\tid: number;\n\n\tprivate _blocks: Record<string, Text | null>;\n\tprivate _style: HTMLStyleElement;\n\n\tconstructor(id?: number) {\n\t\tthis.id = id || last_id++;\n\n\t\tthis._blocks = {};\n\n\t\tthis._style = createElement('style', {\n\t\t\ttype: 'text/css',\n\t\t\tid: `ffz--managed-style--${this.id}`\n\t\t});\n\n\t\tdocument.head.appendChild(this._style);\n\t}\n\n\tdestroy() {\n\t\tif ( this._style )\n\t\t\tthis._style.remove();\n\n\t\t// This is lazy typing, but I don't really care.\n\t\t// Rather do this than put checks in every other bit of code.\n\t\tthis._blocks = null as any;\n\t\tthis._style = null as any;\n\t}\n\n\tclear() {\n\t\tthis._blocks = {};\n\t\tthis._style.innerHTML = '';\n\t}\n\n\tget(key: string) {\n\t\tconst block = this._blocks[key];\n\t\tif ( block )\n\t\t\treturn block.textContent;\n\t\treturn undefined;\n\t}\n\n\thas(key: string) {\n\t\treturn !! this._blocks[key];\n\t}\n\n\tset(key: string, value: string, force: boolean = false) {\n\t\tconst block = this._blocks[key];\n\t\tif ( block ) {\n\t\t\tif ( ! force && block.textContent === value )\n\t\t\t\treturn;\n\n\t\t\tblock.textContent = value;\n\t\t} else\n\t\t\tthis._style.appendChild(this._blocks[key] = document.createTextNode(value));\n\t}\n\n\tdelete(key: string) {\n\t\tconst block = this._blocks[key];\n\t\tif ( block ) {\n\t\t\tif ( this._style.contains(block) )\n\t\t\t\tthis._style.removeChild(block);\n\n\t\t\tthis._blocks[key] = null;\n\t\t}\n\t}\n}\n\n\nexport class ClickOutside {\n\n\tel: HTMLElement | null;\n\tcb: ((event: MouseEvent) => void) | null;\n\t_fn: ((event: MouseEvent) => void) | null;\n\n\tconstructor(element: HTMLElement, callback: ((event: MouseEvent) => void)) {\n\t\tthis.el = element;\n\t\tthis.cb = callback;\n\n\t\tthis._fn = this.handleClick.bind(this);\n\t\tdocument.documentElement.addEventListener('click', this._fn);\n\t}\n\n\tdestroy() {\n\t\tif ( this._fn )\n\t\t\tdocument.documentElement.removeEventListener('click', this._fn);\n\n\t\tthis.cb = this.el = this._fn = null;\n\t}\n\n\thandleClick(event: MouseEvent) {\n\t\tif ( this.cb && this.el && ! this.el.contains(event.target as Node) )\n\t\t\tthis.cb(event);\n\t}\n\n}\n\n\n/**\n * Take an object that can be expressed as JSON and return a string of HTML\n * that can be used to display the object with highlighting and formatting.\n *\n * TODO: Rewrite this method to not use raw HTML.\n *\n * @deprecated You should not depend on this method, as its signature is expected to change.\n *\n * @param object The object to be formatted\n * @param pretty Whether or not to use indentation when rendering the object\n * @param depth The current rendering depth\n * @param max_depth The maximum depth to render, defaults to 30.\n * @returns A string of HTML.\n */\nexport function highlightJson(object: any, pretty = false, depth = 1, max_depth = 30): string {\n\tlet indent = '', indent_inner = '';\n\tif ( pretty ) {\n\t\tindent = '    '.repeat(depth - 1);\n\t\tindent_inner = '    '.repeat(depth);\n\t}\n\n\tif ( depth > max_depth )\n\t\treturn `<span class=\"ffz-ct--obj-literal\">&lt;nested&gt;</span>`;\n\n\tif (object == null)\n\t\treturn `<span class=\"ffz-ct--literal\" depth=\"${depth}\">null</span>`;\n\n\tif ( typeof object === 'number' || typeof object === 'boolean' )\n\t\treturn `<span class=\"ffz-ct--literal\" depth=\"${depth}\">${object}</span>`;\n\n\tif ( typeof object === 'string' )\n\t\treturn `<span class=ffz-ct--string depth=\"${depth}\">${sanitize(JSON.stringify(object))}</span>`;\n\n\tif ( Array.isArray(object) )\n\t\treturn `<span class=\"ffz-ct--obj-open\" depth=\"${depth}\">[</span>`\n\t\t\t+ (object.length > 0 ? (\n\t\t\t\tobject.map(x => (pretty ? `\\n${indent_inner}` : '') + highlightJson(x, pretty, depth + 1, max_depth)).join(`<span class=\"ffz-ct--obj-sep\" depth=\"${depth}\">, </span>`)\n\t\t\t\t+ (pretty ? `\\n${indent}` : '')\n\t\t\t) : '')\n\t\t\t+ `<span class=\"ffz-ct--obj-close\" depth=\"${depth}\">]</span>`;\n\n\tconst out = [];\n\n\tfor(const [key, val] of Object.entries(object)) {\n\t\tif ( out.length > 0 )\n\t\t\tout.push(`<span class=\"ffz-ct--obj-sep\" depth=\"${depth}\">, </span>`);\n\n\t\tif ( pretty )\n\t\t\tout.push(`\\n${indent_inner}`);\n\t\tout.push(`<span class=\"ffz-ct--obj-key\" depth=\"${depth}\">${sanitize(JSON.stringify(key))}</span><span class=\"ffz-ct--obj-key-sep\" depth=\"${depth}\">: </span>`);\n\t\tout.push(highlightJson(val, pretty, depth + 1, max_depth));\n\t}\n\n\treturn `<span class=\"ffz-ct--obj-open\" depth=\"${depth}\">{</span>${out.join('')}${out.length && pretty ? `\\n${indent}` : ''}<span class=\"ffz-ct--obj-close\" depth=\"${depth}\">}</span>`;\n}\n","// ============================================================================\n// EventEmitter\n// Homegrown for that lean feeling.\n// ============================================================================\n\n/**\n * A special value that, when returned from an event listener, will cause the\n * listener to be removed and no longer receive events.\n */\nexport const Detach = Symbol('Detach');\n\n/**\n * A special value that, when returned from an event listener, will stop\n * iteration and prevent any additional event listeners from receiving the\n * event themselves.\n */\nexport const StopPropagation = Symbol('StopPropagation');\n\ndeclare global {\n\tinterface String {\n\t\ttoSlug(separator: string): string;\n\t\ttoSnakeCase(): string;\n\t}\n}\n\nconst SNAKE_CAPS = /([a-z])([A-Z])/g,\n\tSNAKE_SPACE = /[ \\t\\W]/g,\n\tSNAKE_TRIM = /^_+|_+$/g;\n\nString.prototype.toSlug = function(this: string, separator: string = '-') {\n\tlet result = this;\n\tif (result.normalize)\n\t\tresult = result.normalize('NFD');\n\n\treturn result\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.trim()\n\t\t.toLowerCase()\n\t\t.replace(/[^a-z0-9 ]/g, '')\n\t\t.replace(/\\s+/g, separator);\n}\n\nString.prototype.toSnakeCase = function(this: string) {\n\tlet result = this;\n\tif (result.normalize)\n\t\tresult = result.normalize('NFD');\n\n\treturn result\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.trim()\n\t\t.replace(SNAKE_CAPS, '$1_$2')\n\t\t.replace(SNAKE_SPACE, '_')\n\t\t.replace(SNAKE_TRIM, '')\n\t\t.toLowerCase();\n}\n\n\nexport type ListenerReturnType = void | typeof Detach | typeof StopPropagation | Promise<void>;\n\nexport type EventListener<TArgs extends any[] = any[]> = (...args: TArgs) => ListenerReturnType;\n\nexport type ListenerInfo<TArgs extends any[] = any[]> = [\n\tlistener: EventListener<TArgs>,\n\tcontext: any,\n\tttl: number | false,\n\tpriority: number,\n\tprepend: boolean\n];\n\nexport interface EventMap {\n\t[event: string]: any[];\n};\n\nexport type EventKey<TEvent extends EventMap> = string & keyof TEvent;\n\nexport type AddEventKeyNamespace<\n\tTNamespace extends string,\n\tTKey extends string\n> = TKey extends `:${infer Rest}`\n\t? `${TNamespace}${TKey}`\n\t: TKey;\n\nexport type RemoveEventKeyNamespace<\n\tTNamespace extends string,\n\tTKey extends string\n> = TKey extends `${TNamespace}:${infer Rest}`\n\t? `:${Rest}`\n\t: TKey;\n\n\nexport type NamespacedEvents<TNamespace extends string, TEventMap extends EventMap> = {\n\t[K in keyof TEventMap & string as AddEventKeyNamespace<TNamespace, K>]: TEventMap[K]\n};\n\nexport type NamespacedEventKey<TNamespace extends string, TEventMap extends EventMap> =\n\tstring & keyof TEventMap | RemoveEventKeyNamespace<TNamespace, string & keyof TEventMap>;\n\n\nexport type NamespacedEventArgs<\n\tTKey extends string,\n\tTNamespace extends string,\n\tTEventMap extends EventMap\n> = TKey extends keyof TEventMap\n\t? TEventMap[TKey]\n\t: AddEventKeyNamespace<TNamespace, TKey> extends keyof TEventMap\n\t\t? TEventMap[AddEventKeyNamespace<TNamespace, TKey>]\n\t\t: never;\n\n\n/**\n * A custom event emitter implementation with support for priorities,\n * event listeners that only receive a certain number of events,\n * event listeners that can remove themselves by returning a special\n * symbol, and other useful behaviors.\n *\n * You'll likely not be using this class directly, instead relying\n * on {@link Module}s directly. Modules are subclasses of\n * {@link HierarchicalEventEmitter} which itself is a subclass of\n * this {@link EventEmitter}.\n */\nexport class EventEmitter<\n\tTEventMap extends EventMap = {},\n\tTNamespace extends string = ''\n> {\n\n\tstatic Detach = Detach;\n\tstatic StopPropagation = StopPropagation;\n\n\t/** @private */\n\tprotected __listeners: Record<string, ListenerInfo[] | null>;\n\tprotected __running: Set<string>;\n\tprivate __dead_events: number;\n\n\tconstructor() {\n\t\tthis.__listeners = {};\n\t\tthis.__running = new Set;\n\t\tthis.__dead_events = 0;\n\t}\n\n\tprotected __cleanListeners() {\n\t\tif ( ! this.__dead_events )\n\t\t\treturn [];\n\n\t\tconst new_listeners: Record<string, ListenerInfo[]> = {},\n\t\t\told_listeners = this.__listeners,\n\t\t\tremoved: string[] = [];\n\n\t\tfor(const [key, val] of Object.entries(old_listeners)) {\n\t\t\tif ( val?.length )\n\t\t\t\tnew_listeners[key] = val;\n\t\t\telse\n\t\t\t\tremoved.push(key);\n\t\t}\n\n\t\tthis.__listeners = new_listeners;\n\t\tthis.__dead_events = 0;\n\t\treturn removed;\n\t}\n\n\tprivate __sortListeners(event: string) {\n\t\t// Don't bother sorting while an event is running, since\n\t\t// we'll need to sort it at the end when the lists are\n\t\t// recombined.\n\t\tif ( this.__running.has(event) )\n\t\t\treturn;\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list )\n\t\t\tlist.sort((a, b) => a[3] - b[3]);\n\t}\n\n\n\t/**\n\t * Transfer all the event listeners from this EventEmitter to another\n\t * EventEmitter instance, removing them from this EventEmitter in\n\t * the process.\n\t *\n\t * @param other The EventEmitter to transfer our listeners to.\n\t */\n\ttransferListeners(other: EventEmitter<TEventMap, TNamespace>) {\n\t\tif ( !(other instanceof EventEmitter) )\n\t\t\tthrow new Error('other must also be EventEmitter');\n\n\t\t// If the existing listener has no live topics, we can just go ahead\n\t\t// and copy the listeners object directly.\n\t\tconst live_topics = other.events().length + other.__running.size;\n\t\tif ( ! live_topics ) {\n\t\t\tother.__listeners = this.__listeners;\n\t\t\tother.__dead_events = this.__dead_events;\n\t\t\tthis.__listeners = {};\n\t\t\tthis.__dead_events = 0;\n\t\t\treturn;\n\t\t}\n\n\t\t// Unfortuantely, since we got here, we'll need to do things the\n\t\t// old fashioned way.\n\t\tfor(const [key, val] of Object.entries(this.__listeners)) {\n\t\t\tif ( ! val || ! val.length )\n\t\t\t\tcontinue;\n\n\t\t\tlet other_val = other.__listeners[key];\n\t\t\tif ( Array.isArray(other_val) ) {\n\t\t\t\tother_val.push(...val);\n\t\t\t\tother.__sortListeners(key);\n\n\t\t\t} else\n\t\t\t\tother.__listeners[key] = val;\n\t\t}\n\n\t\t// Reset our state before we leave.\n\t\tthis.__listeners = {};\n\t\tthis.__dead_events = 0;\n\t}\n\n\n\t// ========================================================================\n\t// Public Methods\n\t// ========================================================================\n\n\t/**\n\t * Create a new {@link FFZEvent} instance. This is a convenience method that\n\t * wraps {@link FFZEvent.makeEvent}\n\t */\n\tmakeEvent<TData extends Record<string, any> = {}>(data: TData): TypedFFZEvent<TData> {\n\t\treturn FFZEvent.makeEvent(data);\n\t}\n\n\t/**\n\t * Create a new {@link FFZWaitableEvent} instance. This is a convenience\n\t * method that wraps {@link FFZWaitableEvent.makeEvent}\n\t */\n\tmakeWaitableEvent<TData extends Record<string, any> = {}, TReturn = void>(data: TData): TypedFFZWaitableEvent<TData, TReturn> {\n\t\treturn FFZWaitableEvent.makeEvent(data);\n\t}\n\n\t/**\n\t * Register an event listener for a given event.\n\t *\n\t * @param event The event to listen for.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\ton<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tif ( typeof fn !== 'function' )\n\t\t\tthrow new TypeError('fn must be a function');\n\n\t\tconst info: ListenerInfo = [\n\t\t\tfn as EventListener,\n\t\t\tctx,\n\t\t\tfalse,\n\t\t\tpriority ?? 0,\n\t\t\tprepend\n\t\t];\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list ) {\n\t\t\tif ( prepend )\n\t\t\t\tlist.unshift(info);\n\t\t\telse\n\t\t\t\tlist.push(info);\n\t\t\tthis.__sortListeners(event);\n\t\t} else\n\t\t\tthis.__listeners[event] = [info];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Register an event listener for a given event that will only fire\n\t * once before being automatically removed.\n\t *\n\t * @see {@link many}\n\t *\n\t * @param event The event to listen for.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\tonce<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn this.many(event, 1, fn, ctx, priority, prepend);\n\t}\n\n\t/**\n\t * Register an event listener for a given event that will only fire\n\t * a specific number of times before being automatically removed.\n\t *\n\t * @param event The event to listen for.\n\t * @param ttl The number of times the listener should fire.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\tmany<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tif ( typeof fn !== 'function' )\n\t\t\tthrow new TypeError('fn must be a function');\n\n\t\tif ( typeof ttl !== 'number' || isNaN(ttl) || ! isFinite(ttl) || ttl < 1 )\n\t\t\tthrow new TypeError('ttl must be a positive, finite number');\n\n\t\tconst info: ListenerInfo = [\n\t\t\tfn as EventListener,\n\t\t\tctx,\n\t\t\tttl,\n\t\t\tpriority ?? 0,\n\t\t\tprepend\n\t\t];\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list ) {\n\t\t\tif ( prepend )\n\t\t\t\tlist.unshift(info);\n\t\t\telse\n\t\t\t\tlist.push(info);\n\t\t\tthis.__sortListeners(event);\n\t\t} else\n\t\t\tthis.__listeners[event] = [info];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Wait for the given event to fire and return its value.\n\t *\n\t * Internally, this works by registering a temporary event listener\n\t * with a `ttl` of `1` that, when called, calls the `resolve` method\n\t * of the promise returned by this function.\n\t *\n\t * @param event The event to listen for.\n\t * @param ctx A context (aka `this`) to associate this with. While the\n\t * context is not used for calling any functions, it's used to track the\n\t * source of this event listener so that it can be removed easily by\n\t * context if necessary.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t * @returns A {@link Promise} that resolves with the first event of\n\t * this type to fire.\n\t */\n\twaitFor<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn new Promise<NamespacedEventArgs<K, TNamespace, TEventMap>>(resolve => {\n\t\t\tconst info: ListenerInfo = [\n\t\t\t\t((...args: NamespacedEventArgs<K, TNamespace, TEventMap>) => resolve(args)) as EventListener,\n\t\t\t\tctx,\n\t\t\t\t1,\n\t\t\t\tpriority ?? 0,\n\t\t\t\tprepend\n\t\t\t];\n\n\t\t\tconst list = this.__listeners[event];\n\t\t\tif ( list ) {\n\t\t\t\tif ( prepend )\n\t\t\t\t\tlist.unshift(info);\n\t\t\t\telse\n\t\t\t\t\tlist.push(info);\n\t\t\t\tthis.__sortListeners(event);\n\t\t\t} else\n\t\t\t\tthis.__listeners[event] = [info];\n\t\t});\n\t}\n\n\t/**\n\t * Remove one or more event listeners, across one or more events.\n\t * You must provide at least one of `event`, `fn`, and `ctx`. All\n\t * event listeners that match your provided criteria will be removed.\n\t *\n\t * This can be used to remove all event listeners for a given event\n\t * or to remove all event listeners registered by a given context,\n\t * in addition to the obvious ability to remove a specific\n\t * event listener.\n\t *\n\t * @param event Optional. The event to remove listener(s) of.\n\t * @param fn Optional. The event listener function to remove.\n\t * @param ctx Optional. The context to remove listeners of.\n\t */\n\toff<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent?: K,\n\t\tfn?: EventListener,\n\t\tctx?: any\n\t) {\n\t\tif ( event == null ) {\n\t\t\tif ( ! fn && ! ctx )\n\t\t\t\tthrow new Error('you must provide at least one constraint when removing listeners');\n\n\t\t\tfor(const evt in Object.keys(this.__listeners)) {\n\t\t\t\tif ( ! this.__running.has(evt) )\n\t\t\t\t\tthis.off(evt as any, fn, ctx);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif ( this.__running.has(event) )\n\t\t\tthrow new Error(`concurrent modification: tried removing event listener while event is running`);\n\n\t\tlet list = this.__listeners[event];\n\t\tif ( ! list )\n\t\t\treturn this;\n\n\t\t// If fn and ctx were both not provided, then clear the list.\n\t\tif ( ! fn && ! ctx )\n\t\t\tlist = null;\n\t\telse {\n\t\t\t// Remove any entries from the list where:\n\t\t\t// 1. fn and ctx both match if both were provided\n\t\t\t// 2. fn matches if only fn was provided\n\t\t\t// 3. ctx matches if only ctx was provided\n\t\t\tlist = list.filter(([f, c]) => !((! fn || f === fn) && (!ctx || ctx === c)));\n\t\t\tif ( ! list.length )\n\t\t\t\tlist = null;\n\t\t}\n\n\t\tthis.__listeners[event] = list;\n\n\t\t// We don't use delete since that triggers performance issues\n\t\t// when used on objects. Instead, we record that we have a\n\t\t// dead event so we can clean it up later.\n\t\tif ( ! list )\n\t\t\tthis.__dead_events++;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Remove all event listeners registered by a specific context.\n\t * This can now be handled by calling {@link off} directly and\n\t * it should be avoided.\n\t * @deprecated\n\t */\n\toffContext<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K, ctx?: any) {\n\t\treturn this.off(event, undefined, ctx);\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t */\n\tevents() {\n\t\tthis.__cleanListeners();\n\t\treturn Object.keys(this.__listeners);\n\t}\n\n\t/**\n\t * Return a list of all listeners for a given event. This\n\t * includes metadata including the listener's `ttl`.\n\t * @param event\n\t * @returns\n\t */\n\tlisteners<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K)\n\t: ListenerInfo<NamespacedEventArgs<K, TNamespace, TEventMap>> {\n\t\tconst list = this.__listeners[event];\n\t\treturn list ? Array.from(list) as any : [];\n\t}\n\n\t/**\n\t * Determine whether there are currently any listeners for\n\t * the specified event. */\n\thasListeners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn !! this.__listeners[event]\n\t}\n\n\t/**\n\t * Emit an event to all its listeners.\n\t *\n\t * This will call each listener of an event in order, and it handles\n\t * event listener lifetimes with `ttl` and `Detach`. It also supports\n\t * the `StopPropagation` return value or, if the event data is an\n\t * instance of {@link FFZEvent}, the {@link FFZEvent.propagationStopped}\n\t * property.\n\t *\n\t * If the event data is an instance of {@link FFZWaitableEvent} and\n\t * the event listener returns a {@link Promise}, that {@link Promise}\n\t * will automatically be waited for with {@link FFZWaitableEvent.waitFor}.\n\t *\n\t * @param event The event to emit.\n\t * @param data The data for the event. This will vary depending on\n\t * the event being emitted.\n\t */\n\temit<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\t...data: NamespacedEventArgs<K, TNamespace, TEventMap>\n\t) {\n\t\tlet list = this.__listeners[event];\n\t\tif ( ! list )\n\t\t\treturn;\n\n\t\tif ( this.__running.has(event) )\n\t\t\tthrow new Error(`concurrent access: tried to emit event while event is running`);\n\n\t\t// Track removals separately to make iteration over the event list\n\t\t// much, much simpler.\n\t\tconst removed = new Set<ListenerInfo>;\n\n\t\t// Set the current list of listeners to null because we don't want\n\t\t// to enter some kind of loop if a new listener is added as the result\n\t\t// of an existing listener.\n\t\tthis.__listeners[event] = null;\n\t\tthis.__running.add(event);\n\n\t\tfor(const item of list) {\n\t\t\tconst [fn, ctx, ttl] = item;\n\t\t\tlet ret: ListenerReturnType = undefined;\n\t\t\ttry {\n\t\t\t\tret = fn.apply(ctx, data);\n\t\t\t} catch(err) {\n\t\t\t\t// Abusing as any so we can have log as a getter/setter\n\t\t\t\t// on Module without complaint.\n\t\t\t\tif ( (this as any).log ) {\n\t\t\t\t\t(this as any).log.capture(err, {tags: {event}, extra:{args: data}});\n\t\t\t\t\t(this as any).log.error(err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ret === Detach )\n\t\t\t\tremoved.add(item);\n\t\t\telse if ( ttl !== false ) {\n\t\t\t\tif ( ttl <= 1 )\n\t\t\t\t\tremoved.add(item);\n\t\t\t\telse\n\t\t\t\t\titem[2] = ttl - 1;\n\t\t\t}\n\n\t\t\t// Automatically wait for a promise, if the return value is a promise\n\t\t\t// and we're dealing with a waitable event.\n\t\t\tif ( ret instanceof Promise ) {\n\t\t\t\tif ( (data[0] instanceof FFZWaitableEvent) )\n\t\t\t\t\tdata[0].waitFor(ret);\n\t\t\t}\n\n\t\t\tif ( (data[0] instanceof FFZEvent && data[0].propagationStopped) || ret === StopPropagation )\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Remove any dead listeners from the list.\n\t\tif ( removed.size ) {\n\t\t\tfor(const item of removed) {\n\t\t\t\tconst idx = list.indexOf(item);\n\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\tlist.splice(idx, 1);\n\t\t\t}\n\t\t}\n\n\t\tlet need_sort = false;\n\n\t\t// Were more listeners added while we were running? Just combine\n\t\t// the two lists if so.\n\t\tconst new_items = this.__listeners[event];\n\t\tif ( new_items ) {\n\t\t\tlist = list.concat(new_items);\n\t\t\tneed_sort = true;\n\t\t}\n\n\t\t// If we have items, store the list back. Otherwise, mark that we\n\t\t// have a dead listener.\n\t\tif ( list.length )\n\t\t\tthis.__listeners[event] = list;\n\t\telse {\n\t\t\tthis.__listeners[event] = null;\n\t\t\tthis.__dead_events++;\n\t\t}\n\n\t\tthis.__running.delete(event);\n\n\t\t// Finally, now that running is off, sort our listeners if we\n\t\t// have need.\n\t\tif ( need_sort )\n\t\t\tthis.__sortListeners(event);\n\t}\n\n}\n\n\n/**\n * FFZEvent is a convenience class for use when emitting events when you would\n * like to potentially receive feedback from event listeners. The event\n * object may be changed by event listeners, with the emitter checking the\n * event object for changes once the event is done.\n *\n * This also includes support for the standard {@link Event} interfaces of\n * {@link stopPropagation} and {@link preventDefault}.\n *\n * @param TData The custom data type the event should be constructed with.\n */\nexport class FFZEvent<TData> {\n\n\t/**\n\t * Create a new {@link FFZEvent} with proper type inheritence from the\n\t * supplied data. This should always be used to construct an event\n\t * instance, rather than creating the event manually.\n\t */\n\tstatic makeEvent<TData extends Record<string, any> = {}>(data: TData): TypedFFZEvent<TData> {\n\t\treturn new FFZEvent(data) as TypedFFZEvent<TData>;\n\t}\n\n\t/** Whether or not {@link preventDefault} has been called. */\n\tdefaultPrevented: boolean;\n\t/** Whether or not {@link stopPropagation} has been called. */\n\tpropagationStopped: boolean;\n\n\t/** Create a new FFZEvent instance with the provided data. */\n\tconstructor(data: TData) {\n\t\tthis.defaultPrevented = false;\n\t\tthis.propagationStopped = false;\n\n\t\tObject.assign(this, data);\n\t}\n\n\t/**\n\t * Intended for emitter use only.\n\t *\n\t * Reset this FFZEvent instance. This does not reset custom data,\n\t * but only returns {@link defaultPrevented} and {@link propagationStopped}\n\t * to their original values.\n\t *\n\t * Subclasses of FFZEvent may override this method to extend\n\t * its behavior.\n\t */\n\t_reset() {\n\t\tthis.defaultPrevented = false;\n\t\tthis.propagationStopped = false;\n\t}\n\n\t/**\n\t * Stop the propagation of this event, ensuring that no further\n\t * event listeners receive it.\n\t */\n\tstopPropagation() {\n\t\tthis.propagationStopped = true;\n\t}\n\n\t/**\n\t * Prevent whatever default behavior is associated with this event.\n\t */\n\tpreventDefault() {\n\t\tthis.defaultPrevented = true;\n\t}\n}\n\n/**\n * TypedFFZEvent is a convenience type returned by {@link FFZEvent.makeEvent}\n * so that custom data passed to the event can be accessed in a\n * type safe way.\n */\nexport type TypedFFZEvent<TData> = FFZEvent<TData> & {\n\t[K in keyof TData]: TData[K];\n}\n\n/**\n * TypedFFZWaitableEvent is a convenience type returned by {@link FFZWaitableEvent.makeEvent}\n * so that custom data passed to the event can be accessed in a\n * type safe way.\n */\nexport type TypedFFZWaitableEvent<TData, TReturn = void> = FFZWaitableEvent<TData, TReturn> & {\n\t[K in keyof TData]: TData[K];\n}\n\n/**\n * FFZWaitableEvent is a subclass of FFZEvent that adds a system for supporting\n * asynchronous return values.\n *\n * Event listeners may return a {@link Promise} or call {@link waitFor} directly\n * to register their promises, and the emitter is then responsible for calling\n * the {@link _wait} method after the event has been emitted.\n *\n * @param TData The custom data type the event should be constructed with.\n * @param TReturn The expected return type of {@link Promise}s used with\n * {@link waitFor} or by listeners returning {@link Promise}s.\n */\nexport class FFZWaitableEvent<TData, TReturn = void> extends FFZEvent<TData> {\n\n\t/**\n\t * Create a new {@link FFZWaitableEvent} with proper type inheritence from the\n\t * supplied data. This should always be used to construct an event\n\t * instance, rather than creating the event manually.\n\t */\n\tstatic makeEvent<TData extends Record<string, any> = {}, TReturn = void>(data: TData): TypedFFZWaitableEvent<TData, TReturn> {\n\t\treturn new FFZWaitableEvent<TData, TReturn>(data) as TypedFFZWaitableEvent<TData, TReturn>;\n\t}\n\n\tprivate __waiter?: Promise<Awaited<TReturn>[]> | null;\n\tprivate __waiter_results: Awaited<TReturn>[] | null = null;\n\tprivate __promises?: Promise<TReturn>[] | null;\n\n\t/**\n\t * Intended for emitter use only.\n\t *\n\t * Wait for all registered {@link Promise}s to return.\n\t *\n\t * @returns\n\t */\n\t_wait(): Promise<Awaited<TReturn>[]> | null {\n\t\t// If we're already waiting, keep on waiting.\n\t\tif ( this.__waiter )\n\t\t\treturn this.__waiter;\n\n\t\t// If we have no promises, just return\n\t\t// any pending results.\n\t\tif ( ! this.__promises ) {\n\t\t\tconst out = this.__waiter_results;\n\t\t\tthis.__waiter_results = null;\n\n\t\t\t// Make sure to return the results as a promise.\n\t\t\treturn out ? Promise.resolve(out) : null;\n\t\t}\n\n\t\t// We had promises, so we need to wait some more.\n\t\tconst promises = this.__promises;\n\t\tthis.__promises = null;\n\n\t\treturn this.__waiter = Promise.all(promises).then(results => {\n\t\t\t// Store the results for later return.\n\t\t\tif ( this.__waiter_results )\n\t\t\t\tthis.__waiter_results.push(...results);\n\t\t\telse\n\t\t\t\tthis.__waiter_results = results;\n\n\t\t\t// Now call _wait() again.\n\t\t\tthis.__waiter = null;\n\t\t\treturn this._wait() ?? [];\n\n\t\t}).catch(err => {\n\t\t\t// But if there was an error, oh no.\n\t\t\tthis.__waiter = null;\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\t/**\n\t * Reset the FFZWaitableEvent instance. In addition to calling\n\t * the super method {@link FFZEvent._reset}, this also clears\n\t * the Promise-related data stored on the event.\n\t */\n\t_reset() {\n\t\tsuper._reset();\n\t\tthis.__waiter = null;\n\t\tthis.__waiter_results = null;\n\t\tthis.__promises = null;\n\t}\n\n\t/**\n\t * Wait for a {@link Promise} to complete before considering the event\n\t * as completed.\n\t *\n\t * Event listeners should either call this method with their Promise\n\t * if performing asynchronous work, or else return the Promise directly\n\t * from their event listener.\n\t *\n\t * @param promise The Promise to wait for.\n\t */\n\twaitFor(promise: Promise<TReturn>) {\n\t\tif ( ! this.__promises )\n\t\t\tthis.__promises = [promise];\n\t\telse\n\t\t\tthis.__promises.push(promise);\n\t}\n\n}\n\n\n/**\n * HierarchicalEventEmitter is a subclass of {@link EventEmitter} that allows\n * you to create a tree of event emitters that all share the same pool of\n * event listeners.\n *\n * This is useful because the event emitter can then emit events using\n * a simplified name while other emitters can listen to that event using\n * its full name.\n *\n * For example, an emitter with the path `chat.emotes` could call {@link emit}\n * with the event key `:update-default-sets` while other emitters would then\n * have access to listen to that event with the full key\n * `chat.emotes:update-default-sets`.\n *\n * This behavior powers the {@link Module} system.\n */\nexport class HierarchicalEventEmitter<\n\tTNamespace extends string,\n\tTEventMap extends EventMap = {}\n> extends EventEmitter<TEventMap, TNamespace> {\n\t/** The local name of this event emitter, not including the names of its parents. */\n\tname: string;\n\n\t/** @private */\n\tprotected __path?: string;\n\tprivate __path_parts: string[];\n\n\t/** The parent of this event emitter, if it has one. */\n\tparent?: HierarchicalEventEmitter<any, any>;\n\t/** The root event emitter. */\n\troot: HierarchicalEventEmitter<any, any>;\n\n\tconstructor(name?: string, parent?: HierarchicalEventEmitter<any, any>) {\n\t\tsuper();\n\n\t\tthis.name = name || (this.constructor.name || '').toSnakeCase();\n\t\tthis.parent = parent;\n\n\t\tif ( parent ) {\n\t\t\tthis.root = parent.root;\n\t\t\tthis.__listeners = parent.__listeners;\n\t\t\tthis.__running = parent.__running;\n\t\t\tthis.__path = name && parent.__path ? `${parent.__path}.${name}` : name;\n\n\t\t} else {\n\t\t\tthis.root = this as any;\n\t\t\tthis.__path = undefined;\n\t\t}\n\n\t\tthis.__path_parts = this.__path ? this.__path.split('.') : [];\n\t}\n\n\n\t// ========================================================================\n\t// Public Properties\n\t// ========================================================================\n\n\t/**\n\t * The full path of this event emitter, including not just its own name\n\t * but its ancestors' names as well, separated by periods.\n\t */\n\tget path(): TNamespace {\n\t\treturn this.__path as TNamespace;\n\t}\n\n\n\t// ========================================================================\n\t// Public Methods\n\t// ========================================================================\n\n\ttransferListeners(other: EventEmitter<TEventMap, TNamespace>): void {\n\t\tif ( other instanceof HierarchicalEventEmitter && other.root === this.root )\n\t\t\treturn;\n\n\t\tthrow new Error('Transfering listeners from a HierarchicalEventEmitter is not supported.');\n\t}\n\n\t/**\n\t * Take an event path and convert it to an absolute path. For example,\n\t * if this emitter's path is `chat.emotes` and you call this with the\n\t * path `:update-default-sets` it will return `chat.emotes:update-default-sets`.\n\t *\n\t * You can also traverse to specific parents by using periods (`.`) at the\n\t * start of the path. A single period (`.`) is equal to the current emitter's\n\t * path, while each additional period moves up by one ancestor. For example,\n\t * to get this emitter's parent, you could use `..`. This can be combined\n\t * with other strings to access siblings, as well as events on ancestors\n\t * or siblings.\n\t *\n\t * For example, if this emitter's path is `chat.emotes` and you call this\n\t * with the path `..:update-line-tokens` it will return `chat:update-line-tokens`.\n\t *\n\t * As another example, assuming the same emitter path and you call this with\n\t * the path `..emoji:populated` it will return `chat.emoji:populated`.\n\t *\n\t * @param path The path to resolve.\n\t * @returns The resolved path.\n\t */\n\tabs_path(path: string): string {\n\t\tif ( typeof path !== 'string' || ! path.length )\n\t\t\tthrow new TypeError('path must be a non-empty string');\n\n\t\tlet i = 0, chr;\n\t\tconst parts = this.__path_parts,\n\t\t\tdepth = parts.length;\n\n\t\tdo {\n\t\t\tchr = path.charAt(i);\n\t\t\tif ( path.charAt(i) === '.' ) {\n\t\t\t\tif ( i > depth )\n\t\t\t\t\tthrow new Error('invalid path: reached top of stack');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbreak;\n\t\t} while ( ++i < path.length );\n\n\t\tconst event = chr === ':';\n\t\tif ( i === 0 )\n\t\t\treturn event && this.__path ? `${this.__path}${path}` : path;\n\n\t\tconst prefix = parts.slice(0, depth - (i-1)).join('.'),\n\t\t\tremain = path.slice(i);\n\n\t\tif ( ! prefix.length )\n\t\t\treturn remain;\n\n\t\telse if ( ! remain.length )\n\t\t\treturn prefix;\n\n\t\telse if ( event )\n\t\t\treturn prefix + remain;\n\n\t\treturn `${prefix}.${remain}`;\n\t}\n\n\ton<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.on(this.abs_path(event) as K, fn, ctx, priority, prepend);\n\t}\n\n\tonce<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.once(this.abs_path(event) as K, fn, ctx, priority, prepend);\n\t}\n\n\tmany<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.many(this.abs_path(event) as K, ttl, fn, ctx, priority, prepend);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.waitFor<K>(this.abs_path(event) as K, ctx, priority, prepend);\n\t}\n\n\toff<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent?: K, fn?: EventListener, ctx?: any\n\t) {\n\t\treturn super.off(event && this.abs_path(event) as K, fn, ctx);\n\t}\n\n\tlisteners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn super.listeners(this.abs_path(event) as K);\n\t}\n\n\thasListeners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn super.hasListeners(this.abs_path(event) as K);\n\t}\n\n\temit<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\t...args: NamespacedEventArgs<K, TNamespace, TEventMap>\n\t) {\n\t\treturn super.emit(this.abs_path(event) as K, ...args);\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t * This will only return events owned by this emitter, or by\n\t * descendents of this emitter.\n\t */\n\teventsWithChildren() {\n\t\tconst keys = super.events(),\n\t\t\tpath = this.__path || '',\n\t\t\tlen = path.length;\n\n\t\treturn keys.filter(x => {\n\t\t\tconst y = x.charAt(len);\n\t\t\treturn x.startsWith(path) && (y === '' || y === '.' || y === ':');\n\t\t});\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t * This will not return any events owned by other emitters.\n\t */\n\tevents() {\n\t\tconst keys = super.events(),\n\t\t\tpath = this.__path || '',\n\t\t\tlen = path.length;\n\n\t\treturn keys.filter(x => {\n\t\t\tconst y = x.charAt(len);\n\t\t\treturn x.startsWith(path) && (y === '' || y === ':');\n\t\t});\n\t}\n}\n\nexport default HierarchicalEventEmitter;\n","'use strict';\n\nimport type { OptionalPromise, OptionallyCallable } from \"./types\";\n\n// ============================================================================\n// Advanced Filter System\n// ============================================================================\n\ntype FilterMethod<TContext = unknown> = (ctx: TContext) => boolean;\n\nexport type FilterType<TConfig, TContext> = {\n\tcreateTest: (config: TConfig, filter_types: FilterTypeMap<TContext>, rebuild?: () => void) => FilterMethod<TContext>\n\n\tdefault: OptionallyCallable<[], TConfig>;\n\n\t// Editor Configuration\n\teditor?: OptionallyCallable<[], OptionalPromise<any>>;\n\n\ttitle: string;\n\ti18n?: string | null;\n\ttall?: boolean;\n\n\tmaxRules?: number;\n\tchildRules?: boolean;\n\n\n}\n\ntype FilterTypeMap<TContext> = {\n\t[key: string]: FilterType<any, TContext>;\n};\n\n\nexport type FilterData = {\n\tid?: string;\n\ttype: string;\n\tdata: any;\n}\n\n\nexport function createTester<TContext, Types extends FilterTypeMap<TContext>>(\n\trules: FilterData[] | null | undefined,\n\tfilter_types: Types,\n\tinverted: boolean = false,\n\tor: boolean = false,\n\trebuild?: () => void\n): (ctx: TContext) => boolean {\n\n\tif ( ! Array.isArray(rules) || ! filter_types )\n\t\treturn inverted ? () => false : () => true;\n\n\tconst tests: FilterMethod<TContext>[] = [],\n\t\tnames = [];\n\n\tlet i = 0;\n\tfor(const rule of rules) {\n\t\tif ( ! rule || ! rule.type )\n\t\t\tcontinue;\n\n\t\tconst type = filter_types[rule.type];\n\t\tif ( ! type ) {\n\t\t\t// Default to false if we cannot find a rule type.\n\t\t\t// Just to be safe.\n\t\t\ti++;\n\t\t\ttests.push(() => false);\n\t\t\tnames.push(`f${i}`);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Construct the test. If no test is returned, we skip this filter.\n\t\t// This can happen depending on configuration rendering a method\n\t\t// pointless.\n\t\tconst test = type.createTest(rule.data, filter_types, rebuild);\n\t\tif ( ! test )\n\t\t\tcontinue;\n\n\t\ti++;\n\t\ttests.push(test);\n\t\tnames.push(`f${i}`);\n\t}\n\n\tif ( ! tests.length )\n\t\treturn inverted ? () => false : () => true;\n\n\tif ( tests.length === 1 )\n\t\treturn inverted ? (ctx: TContext) => ! tests[0](ctx) : tests[0];\n\n\treturn new Function(...names, 'ctx',\n\t\t`return ${inverted ? `!(` : ''}${names.map(name => `${name}(ctx)`).join(or ? ' || ' : ' && ')}${inverted ? ')' : ''};`\n\t).bind(null, ...tests);\n}\n","export default __webpack_public_path__ + \"opendyslexic.css\";","import { createElement } from \"./dom\";\n\nconst KNOWN_FONTS = [\n\t'Roobert', // Twitch Default\n\t'Arial',\n\t'Arial Black',\n\t'Verdana',\n\t'Helvetica',\n\t'Tahoma',\n\t'Trebuchet MS',\n\t'Impact',\n\t'Didot',\n\t'American Typewriter',\n\t'Lucida Console',\n\t'Monaco',\n\t'Bradley Hand',\n\t'Times New Roman',\n\t'Georgia',\n\t'Garamond',\n\t'Courier New',\n\t'Brush Script MT',\n\t'Comic Sans MS',\n];\n\nexport const VALID_FONTS = document.fonts?.check\n\t? KNOWN_FONTS.filter(font => document.fonts.check(`16px ${font}`)).sort()\n\t: KNOWN_FONTS.sort();\n\n\n/* Google Font Handling */\n\nconst GOOGLE_FONTS = [\n\t'Roboto',\n\t'Open Sans',\n\t'Noto Sans JP',\n\t'Lato',\n\t'Montserrat',\n\t'Roboto Condensed',\n\t'Source Sans Pro',\n\t'Oswald',\n\t'Poppins',\n\t'Noto Sans',\n\t'Roboto Mono',\n\t'Raleway',\n\t'Ubuntu',\n\t'Merriweather',\n\t'Nunito',\n\t'PT Sans',\n\t'Roboto Slab',\n\t'Playfair Display',\n\t'Lora',\n\t'Rubik',\n\t'Mukta',\n\t'Noto Sans KR',\n\t'Work Sans',\n\t'Nunito Sans',\n\t'Nanum Gothic',\n\t'Inter',\n\t'Quicksand',\n\t'PT Serif',\n\t'Hind Siliguri',\n\t'Titilium Web',\n\t'Fira Sans',\n\t'Noto Serif',\n\t'Noto Sans TC',\n\t'Karla'\n];\n\nconst LOADED_GOOGLE = new Map<string, number>();\nconst LOADED_GOOGLE_LINKS = new Map<string, HTMLLinkElement>();\n\nfunction loadGoogleFont(font: string) {\n\tif ( LOADED_GOOGLE_LINKS.has(font) )\n\t\treturn;\n\n\tconst name = encodeURIComponent(font);\n\n\tconst link = createElement('link', {\n\t\tid: `ffz-font-${name}`,\n\t\trel: 'stylesheet',\n\t\thref: `https://fonts.googleapis.com/css2?family=${name}`\n\t});\n\n\tLOADED_GOOGLE_LINKS.set(font, link);\n\tdocument.head.appendChild(link);\n}\n\nfunction unloadGoogleFont(font: string) {\n\tconst link = LOADED_GOOGLE_LINKS.get(font);\n\tif ( ! link )\n\t\treturn;\n\n\tLOADED_GOOGLE_LINKS.delete(font);\n\tlink.remove();\n}\n\n\n/* OpenDyslexic Font */\n\nconst OD_FONTS = [\n\t'OpenDyslexic',\n\t'OpenDyslexicAlta',\n\t'OpenDyslexicMono'\n];\n\nimport OD_URL from 'styles/opendyslexic.scss';\n\nlet od_count = 0;\nlet od_link: HTMLLinkElement | null = null;\n\nfunction loadOpenDyslexic() {\n\tif ( od_link )\n\t\treturn;\n\n\tod_link = createElement('link', {\n\t\tid: `ffz-font-opendyslexic`,\n\t\trel: 'stylesheet',\n\t\ttype: 'text/css',\n\t\thref: OD_URL\n\t});\n\n\tdocument.head.appendChild(od_link);\n}\n\n\nfunction unloadOpenDyslexic() {\n\tif ( ! od_link )\n\t\treturn;\n\n\tod_link.remove();\n\tod_link = null;\n}\n\n\n/* Using and Listing Fonts */\n\n// TODO: Move this type somewhere more generic.\ntype SettingSelectOption<TValue> = {\n\tvalue: TValue;\n\n\ttitle: string;\n\ti18n_key?: string;\n\n\tseparator?: boolean;\n}\n\ntype SettingSelectSeparator = {\n\tseparator: true;\n\n\ttitle: string;\n\ti18n_key?: string;\n}\n\ntype SettingSelectEntry<TValue> = SettingSelectOption<TValue> | SettingSelectSeparator;\n\n\nexport function getFontsList(): SettingSelectEntry<string>[] {\n\tconst out: SettingSelectEntry<string>[] = [\n\t\t{value: '', i18n_key: 'setting.font.default', title: 'Default'},\n\t\t{separator: true, i18n_key: 'setting.font.builtin', title: 'Built-in Fonts'},\n\t];\n\n\tfor(const font of VALID_FONTS)\n\t\tout.push({value: font, title: font});\n\n\tout.push({\n\t\tseparator: true, i18n_key: 'setting.font.dyslexic', title: 'Dyslexia Fonts'\n\t});\n\n\tfor(const font of OD_FONTS)\n\t\tout.push({value: font, title: font});\n\n\tout.push({\n\t\tseparator: true, i18n_key: 'setting.font.google', title: 'Google Fonts'\n\t});\n\n\tfor(const font of GOOGLE_FONTS)\n\t\tout.push({value: `google:${font}`, title: font});\n\n\treturn out;\n}\n\n\nexport function useFont(font: string): [string, (() => void) | null] {\n\tif ( ! font )\n\t\treturn [font, null];\n\n\tif ( OD_FONTS.includes(font) ) {\n\t\tod_count++;\n\t\tif ( od_count === 1 )\n\t\t\tloadOpenDyslexic();\n\n\t\tlet unloaded = false;\n\t\tconst unloader = () => {\n\t\t\tif ( ! unloaded ) {\n\t\t\t\tunloaded = true;\n\t\t\t\tod_count--;\n\t\t\t\tif ( ! od_count )\n\t\t\t\t\tunloadOpenDyslexic();\n\t\t\t}\n\t\t}\n\n\t\treturn [font, unloader];\n\t}\n\n\tif ( font.startsWith('google:') ) {\n\t\tconst name = font.slice(7),\n\t\t\tcount = (LOADED_GOOGLE.get(name) ?? 0) + 1;\n\n\t\tLOADED_GOOGLE.set(name, count);\n\t\tif ( count === 1 )\n\t\t\tloadGoogleFont(name);\n\n\t\tlet unloaded = false;\n\t\tconst unloader = () => {\n\t\t\tif ( ! unloaded ) {\n\t\t\t\tunloaded = true;\n\t\t\t\tconst count = (LOADED_GOOGLE.get(name) ?? 0) - 1;\n\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\tLOADED_GOOGLE.set(name, count);\n\t\t\t\t} else {\n\t\t\t\t\tLOADED_GOOGLE.delete(name);\n\t\t\t\t\tunloadGoogleFont(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn [name, unloader];\n\t}\n\n\treturn [font, null];\n}","import type { ClientVersion } from \"./types\";\n\nconst RAVEN_LEVELS: Record<number, string> = {\n\t1: 'debug',\n\t2: 'info',\n\t4: 'warn',\n\t8: 'error'\n};\n\n\nexport enum LogLevel {\n\tVerbose = 0,\n\tDebug = 1,\n\tInfo = 2,\n\tWarning = 4,\n\tError = 8,\n\tOff = 99\n}\n\nfunction readLSLevel(): number | null {\n\tconst level = localStorage.ffzLogLevel;\n\tif ( ! level )\n\t\treturn null;\n\n\tconst upper = level.toUpperCase(),\n\t\tvalue = (Logger as any)[upper];\n\n\tif ( typeof value === 'number' )\n\t\treturn value;\n\n\tif ( /^\\d+$/.test(level) )\n\t\treturn parseInt(level, 10);\n\n\treturn null;\n}\n\n\ninterface Core {\n\n\thost: string;\n\tflavor: string;\n\n};\n\n\ntype InitItem = {\n\ttime: number;\n\tcategory: string | null;\n\tmessage: string;\n\tlevel: string | number;\n}\n\n\nexport class Logger {\n\tpublic static readonly Levels = LogLevel;\n\tpublic static readonly VERBOSE = LogLevel.Verbose;\n\tpublic static readonly DEBUG = LogLevel.Debug;\n\tpublic static readonly INFO = LogLevel.Info;\n\tpublic static readonly WARN = LogLevel.Warning;\n\tpublic static readonly WARNING = LogLevel.Warning;\n\tpublic static readonly ERROR = LogLevel.Error;\n\tpublic static readonly OFF = LogLevel.Off;\n\n\tpublic static readonly DEFAULT_LEVEL = LogLevel.Info;\n\n\tname: string | null;\n\tenabled: boolean;\n\tlevel: LogLevel;\n\n\tlabel?: string;\n\n\tinit?: boolean;\n\tcaptured_init?: InitItem[];\n\n\troot: Logger;\n\tparent: Logger | null;\n\tchildren: Record<string, Logger>;\n\n\traven: any;\n\n\tconstructor(parent: Logger | null, name: string | null, level?: LogLevel | null, raven?: any) {\n\t\tthis.root = parent ? parent.root : this;\n\t\tthis.parent = parent;\n\t\tthis.name = name;\n\n\t\tif ( this.root == this ) {\n\t\t\tthis.init = false;\n\t\t\tthis.captured_init = [];\n\t\t\tthis.label = 'FFZ';\n\t\t}\n\n\t\tthis.enabled = true;\n\t\tthis.level = level ?? (parent && parent.level) ?? readLSLevel() ?? Logger.DEFAULT_LEVEL;\n\t\tthis.raven = raven || (parent && parent.raven);\n\n\t\tthis.children = {};\n\t}\n\n\t/** @internal */\n\thi(core: Core, version?: ClientVersion) {\n\t\tconst VER = version ?? (core.constructor as any)?.version_info;\n\t\tthis.info(`FrankerFaceZ v${VER} (s:${core.host} f:${core.flavor} b:${VER?.build} c:${VER?.commit || 'null'})`);\n\n\t\ttry {\n\t\t\tconst loc = new URL(location.toString());\n\t\t\tloc.search = '';\n\t\t\tthis.info(`Initial URL: ${loc}`);\n\t\t} catch(err) {\n\t\t\tthis.warn(`Unable to read location.`, err);\n\t\t}\n\t}\n\n\tget(name: string, level?: LogLevel) {\n\t\tif ( ! this.children[name] )\n\t\t\tthis.children[name] = new Logger(this, (this.name ? `${this.name}.${name}` : name), level);\n\n\t\treturn this.children[name];\n\t}\n\n\tverbose(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(LogLevel.Verbose, message, optionalParams);\n\t}\n\n\tverboseColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.VERBOSE, message, colors, optionalParams);\n\t}\n\n\tdebug(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.DEBUG, message, optionalParams);\n\t}\n\n\tdebugColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.DEBUG, message, colors, optionalParams);\n\t}\n\n\tinfo(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.INFO, message, optionalParams);\n\t}\n\n\tinfoColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.INFO, message, colors, optionalParams);\n\t}\n\n\twarn(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.WARN, message, optionalParams);\n\t}\n\n\twarnColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.WARN, message, colors, optionalParams);\n\t}\n\n\twarning(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.WARN, message, optionalParams);\n\t}\n\n\twarningColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.WARN, message, colors, optionalParams);\n\t}\n\n\terror(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.ERROR, message, optionalParams);\n\t}\n\n\terrorColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.ERROR, message, colors, optionalParams);\n\t}\n\n\tcrumb(...args: any[]) {\n\t\tif ( this.raven )\n\t\t\treturn this.raven.captureBreadcrumb(...args);\n\t}\n\n\tcapture(exc: Error, opts?: any, ...args: any[]) {\n\t\tif ( this.raven ) {\n\t\t\topts = opts || {};\n\t\t\tif ( ! opts.logger )\n\t\t\t\topts.logger = this.name;\n\n\t\t\tthis.raven.captureException(exc, opts);\n\t\t}\n\n\t\tif ( args.length ) {\n\t\t\tconst msg = args.shift();\n\t\t\treturn this.error(msg, ...args);\n\t\t}\n\t}\n\n\tinvokeColor(level: number, message: any, colors: string | string[], ...optionalParams: any[]) {\n\t\tif ( ! this.enabled || level < this.level )\n\t\t\treturn;\n\n\t\tif ( ! Array.isArray(colors) )\n\t\t\tcolors = [colors];\n\n\t\t//const message = args ? Array.prototype.slice.call(args) : [];\n\n\t\tif ( level > LogLevel.Verbose ) {\n\t\t\tlet out = message;\n\t\t\tif ( typeof out === 'string' )\n\t\t\t\tout = out.replace(/%c/g, '');\n\n\t\t\tif ( optionalParams.length )\n\t\t\t\tout = `${out} ${optionalParams.join(' ')}`;\n\n\t\t\tif ( this.root.init && this.root.captured_init )\n\t\t\t\tthis.root.captured_init.push({\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tcategory: this.name,\n\t\t\t\t\tmessage: out,\n\t\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t\t});\n\n\t\t\tthis.crumb({\n\t\t\t\tmessage: out,\n\t\t\t\tcategory: this.name,\n\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t});\n\t\t}\n\n\t\tconst default_style = level < LogLevel.Info\n\t\t\t? 'color:#999999'\n\t\t\t: '';\n\n\t\tif ( this.name ) {\n\t\t\tif ( typeof message === 'string' )\n\t\t\t\tmessage = `%c${this.root.label} [%c${this.name}%c]:%c ${message}`;\n\t\t\telse {\n\t\t\t\toptionalParams.unshift(message);\n\t\t\t\tmessage = `%c${this.root.label} [%c${this.name}%c]:%c`;\n\t\t\t}\n\n\t\t\tcolors.unshift('color:#755000; font-weight:bold', default_style, 'color:#755000; font-weight:bold', default_style);\n\n\t\t} else {\n\t\t\tif ( typeof message === 'string' )\n\t\t\t\tmessage = `%c${this.root.label}:%c ${message}`;\n\t\t\telse {\n\t\t\t\toptionalParams.unshift(message);\n\t\t\t\tmessage = `%c${this.root.label}:%c`;\n\t\t\t}\n\n\t\t\tcolors.unshift('color:#755000; font-weight:bold', default_style);\n\t\t}\n\n\t\tif ( level < LogLevel.Info )\n\t\t\tconsole.debug(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Warning )\n\t\t\tconsole.info(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Error )\n\t\t\tconsole.warn(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Off )\n\t\t\tconsole.error(message, ...colors, ...optionalParams);\n\t}\n\n\t/* eslint no-console: \"off\" */\n\tinvoke(level: number, message: string, optionalParams?: any[]) {\n\t\tif ( ! this.enabled || level < this.level || level >= LogLevel.Off )\n\t\t\treturn;\n\n\t\tconst result = optionalParams ? [\n\t\t\tmessage,\n\t\t\t...optionalParams\n\t\t] : [message];\n\n\t\tif ( level > LogLevel.Verbose ) {\n\t\t\tconst out = result.join(' ');\n\n\t\t\tif ( this.root.init && this.root.captured_init )\n\t\t\t\tthis.root.captured_init.push({\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tcategory: this.name,\n\t\t\t\t\tmessage: out,\n\t\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t\t});\n\n\t\t\tthis.crumb({\n\t\t\t\tmessage: out,\n\t\t\t\tcategory: this.name,\n\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t});\n\t\t}\n\n\t\t// Chrome removed any sort of special styling from debug\n\t\t// logging, so let's add our own to make them visually distinct.\n\t\tconst default_style = level < LogLevel.Info\n\t\t\t? 'color:#999999'\n\t\t\t: '';\n\n\t\t// If we're adding our own style, we need to grab as many of\n\t\t// the strings as we can.\n\t\tlet strings = '';\n\t\tif ( default_style !== '' ) {\n\t\t\twhile(result.length > 0 && typeof result[0] === 'string') {\n\t\t\t\tstrings += ' ' + result.shift();\n\t\t\t}\n\t\t}\n\n\t\tif ( this.name ) {\n\t\t\tresult.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${strings}`, 'color:#755000; font-weight:bold', default_style, 'color:#755000; font-weight:bold', default_style);\n\t\t} else\n\t\t\tresult.unshift(`%c${this.root.label}:%c${strings}`, 'color:#755000; font-weight:bold', default_style);\n\n\t\tif ( level < LogLevel.Info )\n\t\t\tconsole.debug(...result);\n\n\t\telse if ( level < LogLevel.Warning )\n\t\t\tconsole.info(...result);\n\n\t\telse if ( level < LogLevel.Error )\n\t\t\tconsole.warn(...result);\n\n\t\telse if ( level < LogLevel.Off )\n\t\t\tconsole.error(...result);\n\t}\n}\n\nexport default Logger;\n","'use strict';\n\n// ============================================================================\n// Module System\n// Modules are cool.\n// ============================================================================\n\nimport EventEmitter, { EventListener, EventMap, NamespacedEventArgs, NamespacedEventKey, NamespacedEvents } from 'utilities/events';\nimport {has} from 'utilities/object';\nimport type Logger from './logging';\nimport type { AddonInfo, KnownEvents, ModuleKeys, ModuleMap, OptionalPromise } from './types';\nimport type { Addon } from './addon';\n\n\n// ============================================================================\n// Module\n// ============================================================================\n\n/** Represents the loading state of a Module. */\nexport enum LoadState {\n\t/** The module is currently unloaded. */\n\tUnloaded,\n\t/**\n\t * The module is in the process of loading. It may be waiting for its\n\t * load dependencies to become available, or it may be waiting for its\n\t * own {@link Module.onLoad} method to return.\n\t */\n\tLoading,\n\t/** The module is currently loaded. */\n\tLoaded,\n\t/**\n\t * The module is in the process of unloading. It may be waiting for other\n\t * modules that depend on it to be disabled, or it may be waiting for its\n\t * own {@link Module.onUnload} method to return.\n\t */\n\tUnloading\n};\n\nexport enum State {\n\t/** The module is currently disabled. */\n\tDisabled,\n\t/**\n\t * The module is in the process of being enabled. It may be waiting for\n\t * its dependencies to become available, or it may be waiting for its\n\t * own {@link Module.onEnable} method to return.\n\t */\n\tEnabling,\n\t/** The module is currently enabled. */\n\tEnabled,\n\t/**\n\t * The module is in the process of being disabled. It may be waiting for\n\t * other modules that depend on it to be disabled, or it may be waiting\n\t * for its own {@link Module.onDisable} method to return.\n\t */\n\tDisabling\n};\n\nexport type ModuleEvents = {\n\t':registered': [module: GenericModule],\n\t':loaded': [module: GenericModule],\n\t':unloaded': [module: GenericModule],\n\t':enabled': [module: GenericModule],\n\t':disabled': [module: GenericModule]\n};\n\nexport type GenericModule = Module<any, any, any, any>;\n\ntype PendingModule = [\n\tstring[],\n\tstring[],\n\t[string, string][]\n];\n\nconst EXTRACTOR = /^addon\\.([^.]+)(?:\\.|$)/i;\n\nfunction extractAddonId(path: string) {\n\treturn EXTRACTOR.exec(path)?.[1];\n}\n\n\n/**\n * A Module represents a distinct logical component of FrankerFaceZ. Modules\n * can be loaded or unloaded at runtime, and they have a robust event system.\n * Every add-on consists of one or more Module. There are separate modules\n * for every system in FrankerFaceZ, such as localization, emotes, badges,\n * chat rendering, etc.\n *\n * If you are creating an add-on, you might use Module directly if you're\n * using more than one module. If your add-on only has one module, then it\n * should use the {@link Addon} subclass.\n *\n * @param TNamespace The absolute path where this module will be mounted in\n * the module tree. Providing this string allows relative events to be used.\n * @param TEventMap A map of all event types that you're expecting to use.\n * This may include events from other modules that you plan to use. You\n * should import the type objects used by those other modules.\n */\nexport class Module<\n\tTNamespace extends string = '',\n\tTEventMap extends EventMap = {},\n\tTExtraEvents extends EventMap = KnownEvents,\n\tTActualEvents extends EventMap = TExtraEvents & NamespacedEvents<TNamespace, TEventMap> & NamespacedEvents<TNamespace, ModuleEvents>\n> extends EventEmitter<TNamespace, TActualEvents> {\n\n\tstatic buildAddonProxy = buildAddonProxy;\n\n\t/**\n\t * Optional. This method is called when a module belonging to an\n\t * {@link Addon} attempts to {@link resolve} or {@link inject} this\n\t * module. This can be used to return a {@link Proxy} for the purpose\n\t * of adjusting API responses or record keeping.\n\t *\n\t * @param addon_id The ID of the add-on requesting the module.\n\t * @param addon The manifest of the add-on requesting the module.\n\t * @param root The root {@link Addon} module.\n\t * @param caller The specific {@link Module} making the request.\n\t */\n\tgetAddonProxy?(addon_id: string, addon: AddonInfo, root: GenericModule, caller: GenericModule): Module<TNamespace, TEventMap>;\n\n\t/**\n\t * Optional. This method may be called when generating a diagnostic\n\t * log, and it can return a string to be included in the log.\n\t */\n\tgenerateLog?(): OptionalPromise<string>;\n\n\t// Some generic stuff...\n\t/**\n\t * For use in modules that are direct children of \"core\" or \"site\". If this\n\t * is set to true, the module will be enabled when FrankerFaceZ\n\t * is initialized.\n\t */\n\tshould_enable?: boolean;\n\n\t// Tracking module inter-dependency\n\tload_requires?: string[];\n\trequires?: string[];\n\n\t// These are always initialized when a module is being set up, but not\n\t// in the constructor. Just trick the type system.\n\tload_dependents: string[] = null as any;\n\tdependents: string[] = null as any;\n\treferences: [string, string][] = null as any;\n\n\n\tprivate __modules: Record<string, PendingModule | GenericModule>;\n\tprivate __log?: Logger;\n\n\tprivate __proxies?: Record<string, GenericModule>;\n\n\tprivate __load_state: LoadState;\n\tprivate __state: State;\n\n\tprivate __load_promise?: Promise<void> | null;\n\tprivate __state_promise?: Promise<void> | null;\n\n\tchildren: Record<string, GenericModule>;\n\n\t// Addon Metadata\n\tprivate __addon_id?: string;\n\tprivate __addon_root?: GenericModule;\n\n\tconstructor(name?: string, parent?: GenericModule, addon?: boolean) {\n\t\tif ( ! parent && (name as any) instanceof Module ) {\n\t\t\tparent = name as any;\n\t\t\tname = undefined;\n\t\t}\n\n\t\tsuper(name, parent);\n\t\tthis.__modules = parent ? parent.__modules : {};\n\t\tthis.children = {};\n\n\t\tif ( parent?.__addon_id ) {\n\t\t\tthis.__addon_id = parent.__addon_id;\n\t\t\tthis.__addon_root = parent.__addon_root;\n\t\t} else if ( addon ) {\n\t\t\tconst addon_id = extractAddonId(this.__path as string);\n\t\t\tif ( addon_id ) {\n\t\t\t\tthis.__addon_id = addon_id;\n\t\t\t\tthis.__addon_root = this;\n\t\t\t}\n\t\t}\n\n\t\tif ( parent && ! parent.children[this.name] )\n\t\t\tparent.children[this.name] = this;\n\n\t\tif ( this.root === this )\n\t\t\tthis.__modules[this.__path || ''] = this;\n\n\t\tlet is_loadable = !! this.onLoad;\n\t\tif ( ! is_loadable ) {\n\t\t\tconst load_requires = this.__get_load_requires();\n\t\t\tis_loadable = Array.isArray(load_requires) && load_requires.length > 0;\n\t\t}\n\n\t\tthis.__load_state = is_loadable ? LoadState.Unloaded : LoadState.Loaded;\n\t\tthis.__state = is_loadable || this.onEnable ?\n\t\t\tState.Disabled : State.Enabled;\n\n\t\tthis._time('instance');\n\t\t(this as any).emit(':registered', this);\n\t}\n\n\n\t// ========================================================================\n\t// Public Properties\n\t// ========================================================================\n\n\t/** The current {@link State} of this module. */\n\tget state() { return this.__state }\n\n\t/** The current {@link LoadState} of this module. */\n\tget load_state() { return this.__load_state }\n\n\t/** Whether or not the module is {@link LoadState.Loaded}. */\n\tget loaded() { return this.__load_state === LoadState.Loaded }\n\t/** Whether or not the module is {@link LoadState.Loading}. */\n\tget loading() { return this.__load_state === LoadState.Loading }\n\n\t/** Whether or not the module is {@link State.Enabled}. */\n\tget enabled() { return this.__state === State.Enabled }\n\t/** Whether or not the module is {@link State.Enabling}. */\n\tget enabling() { return this.__state === State.Enabling }\n\n\t/** If this module is part of an add-on, the add-on's ID. */\n\tget addon_id() { return this.__addon_id }\n\t/** If this module is part of an add-on, the add-on's root module. */\n\tget addon_root() { return this.__addon_root }\n\t/** If this module is part of an add-on, the add-on's manifest. */\n\tget addon_manifest() {\n\t\tif (this.__addon_id)\n\t\t\treturn this.resolve('addons')?.getAddon(this.__addon_id!) ??\n\t\t\t\t(this.__addon_root?.constructor as typeof Addon)?.info ??\n\t\t\t\tundefined;\n\t}\n\n\t/** A Logger instance for this module. */\n\tget log(): Logger {\n\t\t// In theory, this could be undefined. In practice, we will always\n\t\t// have a Logger set up. Additionally, it would be way too annoying\n\t\t// to need to put conditional checks literally everywhere we use the\n\t\t// logger system. Just no.\n\t\tif ( ! this.__log )\n\t\t\tthis.__log = this.parent && (this.parent as GenericModule).log?.get?.(this.name);\n\t\treturn this.__log as Logger;\n\t}\n\n\tset log(log) {\n\t\tthis.__log = log;\n\t}\n\n\n\t// ========================================================================\n\t// Timing\n\t// ========================================================================\n\n\t/**\n\t * Record a timing event. The timing system is not yet finished.\n\t * @param event The timing event to record.\n\t */\n\tprotected _time(event: string | any) {\n\t\tif ( (this.root as any).timing ) {\n\t\t\tif ( typeof event !== 'object' )\n\t\t\t\tevent = {event};\n\t\t\tevent.module = this.__path || 'core';\n\t\t\t(this.root as any).timing.addEvent(event);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// State! Glorious State\n\t// ========================================================================\n\n\t/**\n\t * Load this module. If the module has no {@link onLoad} method and no\n\t * {@link load_requires} modules listed, then it will be considered\n\t * {@link LoadState.Loaded} immediately.\n\t *\n\t * All of the module's {@link load_requires} dependencies will be\n\t * enabled before the load state updates and this returns.\n\t *\n\t * Modules are automatically loaded before being enabled.\n\t */\n\tload() {\n\t\treturn this.__load(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being loaded. The module will not be set to {@link LoadState.Loaded}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that this module {@link load_requires}\n\t * will already be enabled and injected modules will have been injected.\n\t */\n\tprotected onLoad?(): void | Promise<void>;\n\n\t/**\n\t * Unload this module. If the module has no {@link onUnload} method,\n\t * but it has an {@link onLoad} method, then this will throw an error.\n\t *\n\t * When this is called, if this module is currently enabled, it will\n\t * be disabled first. As part of that, all modules that depend on\n\t * this module will also be disabled first. All modules that depend\n\t * on this module as a load dependency will be unloaded first.\n\t *\n\t * Please note that, if any of those dependencies cannot be unloaded or\n\t * disabled, this will fail.\n\t */\n\tunload() {\n\t\treturn this.__unload(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being unloaded. The module will not be set to {@link LoadState.Unloaded}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that depend on this module will\n\t * already have been disabled.\n\t */\n\tprotected onUnload?(): void | Promise<void>;\n\n\t/**\n\t * Enable this module. If the module has no {@link onEnable} method\n\t * and the module is considered {@link LoadState.Loaded} immediately,\n\t * then the module will be considered {@link State.Enabled} immediately.\n\t *\n\t * All of the module's {@link requires} dependencies will be\n\t * enabled before the state updates and this returns.\n\t *\n\t * Modules are automatically loaded before being enabled.\n\t */\n\tenable() {\n\t\treturn this.__enable(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being enabled. The module will not be set to {@link State.Enabled}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that this module {@link requires}\n\t * will already be enabled and injected modules will have been injected.\n\t */\n\tprotected onEnable?(): void | Promise<void>;\n\n\t/**\n\t * Disable this module. If the module has no {@link onDisable} method,\n\t * but it has an {@link onEnable} method, then this will throw an error.\n\t *\n\t * As part of disabling this module, all modules that depend on this\n\t * module will be disabled first. All modules that depend on this module\n\t * as a load dependency will be unloaded first.\n\t *\n\t * Please note that, if any of those dependencies cannot be unloaded or\n\t * disabled, this will fail.\n\t */\n\tdisable() {\n\t\treturn this.__disable(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being disabled. The module will not be set to {@link State.Disabled}\n\t * until after this method returns. Promises are supported.\n\t */\n\tprotected onDisable?(): void | Promise<void>;\n\n\t/**\n\t * Determine whether or not this module can be unloaded. This checks\n\t * not only this module's state, but the state of all modules that\n\t * depend on this module.\n\t */\n\tcanUnload() {\n\t\treturn this.__canUnload(this.__path, []);\n\t}\n\n\t/**\n\t * Determine whether or not this module can be disabled. This checks\n\t * not only this module's state, but the state of all modules that\n\t * depend on this module.\n\t */\n\tcanDisable() {\n\t\treturn this.__canDisable(this.__path, []);\n\t}\n\n\tprivate __load(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${initial}`, [...chain, this]));\n\t\telse if ( this.load_requires )\n\t\t\tfor(const name of this.load_requires) {\n\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\tif ( (module instanceof Module) && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === LoadState.Loading )\n\t\t\treturn this.__load_promise;\n\n\t\telse if ( state === LoadState.Loaded )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( state === LoadState.Unloading )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to load module ${path} while module is being unloaded`));\n\n\t\tthis._time('load-start');\n\t\tthis.__load_state = LoadState.Loading;\n\t\treturn this.__load_promise = (async () => {\n\t\t\tif ( this.load_requires ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.load_requires) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\tthrow new ModuleError(`cannot find required module ${name} when loading ${path}`);\n\n\t\t\t\t\tpromises.push(module.__enable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tif ( this.onLoad ) {\n\t\t\t\tthis._time('load-self');\n\t\t\t\treturn this.onLoad();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__load_state = LoadState.Loaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('load-end');\n\t\t\t(this as any).emit(':loaded', this);\n\t\t\treturn ret;\n\t\t}).catch(err => {\n\t\t\tthis.__load_state = LoadState.Unloaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('load-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\tprivate __canUnload(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can unload ${initial}`, [...chain, this]);\n\t\telse if ( this.load_dependents ) {\n\t\t\tchain.push(this);\n\n\t\t\tfor(const dep of this.load_dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module ) {\n\t\t\t\t\tif ( chain.includes(module) )\n\t\t\t\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can unload ${initial}`, [...chain, this, module]);\n\n\t\t\t\t\tif ( ! module.__canUnload(initial, Array.from(chain)) )\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( state === LoadState.Unloading )\n\t\t\treturn true;\n\n\t\telse if ( state === LoadState.Unloaded )\n\t\t\treturn true;\n\n\t\telse if ( this.onLoad && ! this.onUnload )\n\t\t\treturn false;\n\n\t\telse if ( state === LoadState.Loading )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate __unload(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${initial}`, [...chain, this]));\n\t\telse if ( this.load_dependents )\n\t\t\tfor(const dep of this.load_dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === LoadState.Unloading )\n\t\t\treturn this.__load_promise;\n\n\t\telse if ( state === LoadState.Unloaded )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( this.onLoad && ! this.onUnload )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to unload module ${path} but module cannot be unloaded`));\n\n\t\telse if ( state === LoadState.Loading )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to unload module ${path} while module is being loaded`));\n\n\t\tthis._time('unload-start');\n\t\tthis.__load_state = LoadState.Unloading;\n\t\treturn this.__load_promise = (async () => {\n\t\t\tif ( this.__state !== State.Disabled )\n\t\t\t\tawait this.disable();\n\n\t\t\tif ( this.load_dependents ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.load_dependents) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\t//throw new ModuleError(`cannot find depending module ${name} when unloading ${path}`);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tpromises.push(module.__unload(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tthis._time('unload-self');\n\t\t\tif ( this.onUnload )\n\t\t\t\treturn this.onUnload();\n\n\t\t})().then(ret => {\n\t\t\tthis.__load_state = LoadState.Unloaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('unload-end');\n\t\t\t(this as any).emit(':unloaded', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__load_state = LoadState.Loaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('unload-end');\n\t\t\tthrow err;\n\n\t\t});\n\t}\n\n\n\tprivate __enable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${initial}`, [...chain, this]));\n\t\telse if ( this.requires )\n\t\t\tfor(const name of this.requires) {\n\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === State.Enabling )\n\t\t\treturn this.__state_promise;\n\n\t\telse if ( state === State.Enabled )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( state === State.Disabling )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to enable module ${path} while module is being disabled`));\n\n\t\tthis._time('enable-start');\n\t\tthis.__state = State.Enabling;\n\t\treturn this.__state_promise = (async () => {\n\t\t\tconst promises = [],\n\t\t\t\trequires = this.requires,\n\t\t\t\tload_state = this.__load_state;\n\n\t\t\tif ( load_state === LoadState.Unloading )\n\t\t\t\t// We'd abort for this later to, but kill it now before we start\n\t\t\t\t// any unnecessary work.\n\t\t\t\tthrow new ModuleError(`attempted to load module ${path} while module is being unloaded`);\n\n\t\t\telse if ( load_state === LoadState.Loading || load_state === LoadState.Unloaded )\n\t\t\t\tpromises.push(this.load());\n\n\t\t\tif ( requires )\n\t\t\t\tfor(const name of requires) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\tthrow new ModuleError(`cannot find required module ${name} when enabling ${path}`);\n\n\t\t\t\t\tpromises.push(module.__enable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\tawait Promise.all(promises);\n\t\t\tif ( this.onEnable ) {\n\t\t\t\tthis._time('enable-self');\n\t\t\t\treturn this.onEnable();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__state = State.Enabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('enable-end');\n\t\t\t(this as any).emit(':enabled', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__state = State.Disabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('enable-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\tprivate __canDisable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can disable ${initial}`, [...chain, this]);\n\t\telse if ( this.dependents ) {\n\t\t\tchain.push(this);\n\n\t\t\tfor(const dep of this.dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module && (module instanceof Module) ) {\n\t\t\t\t\tif ( chain.includes(module) )\n\t\t\t\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can disable ${initial}`, [...chain, this, module]);\n\n\t\t\t\t\tif ( ! module.__canDisable(initial, Array.from(chain)) )\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( state === State.Disabling || state === State.Disabled )\n\t\t\treturn true;\n\n\t\telse if ( ! this.onDisable )\n\t\t\treturn false;\n\n\t\telse if ( state === State.Enabling )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate __disable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${initial}`, [...chain, this]));\n\t\telse if ( this.dependents )\n\t\t\tfor(const dep of this.dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === State.Disabling )\n\t\t\treturn this.__state_promise;\n\n\t\telse if ( state === State.Disabled )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( ! this.onDisable )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to disable module ${path} but module cannot be disabled`));\n\n\t\telse if ( state === State.Enabling )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to disable module ${path} but module is being enabled`));\n\n\t\tthis._time('disable-start');\n\t\tthis.__state = State.Disabling;\n\t\treturn this.__state_promise = (async () => {\n\t\t\tif ( this.__load_state !== LoadState.Loaded )\n\t\t\t\t// We'd abort for this later to, but kill it now before we start\n\t\t\t\t// any unnecessary work.\n\t\t\t\tthrow new ModuleError(`attempted to disable module ${path} but module is unloaded -- weird state`);\n\n\t\t\tif ( this.dependents ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.dependents) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\t// Assume a non-existent module isn't enabled.\n\t\t\t\t\t\t//throw new ModuleError(`cannot find depending module ${name} when disabling ${path}`);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tpromises.push(module.__disable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tif ( this.onDisable ) {\n\t\t\t\tthis._time('disable-self');\n\t\t\t\treturn this.onDisable();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__state = State.Disabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('disable-end');\n\t\t\t(this as any).emit(':disabled', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__state = State.Enabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('disable-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\t// ========================================================================\n\t// Slightly Easier Events\n\t// ========================================================================\n\n\ton<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.on(\n\t\t\tevent,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\tonce<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.once(\n\t\t\tevent,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\tmany<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.many(\n\t\t\tevent,\n\t\t\tttl,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.waitFor<K>(\n\t\t\tevent,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\toff<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent?: K, fn?: EventListener, ctx?: any\n\t) {\n\t\treturn super.off(event, fn, ctx === undefined ? this : ctx);\n\t}\n\n\n\t// ========================================================================\n\t// Module Management\n\t// ========================================================================\n\n\tprivate __resolve(name: string | Module): Module | PendingModule | undefined {\n\t\tif ( name instanceof Module )\n\t\t\treturn name;\n\n\t\treturn this.__modules[this.abs_path(name)];\n\t}\n\n\tresolve<\n\t\tTPath extends string,\n\t\tTReturn = TPath extends keyof ModuleMap\n\t\t\t? ModuleMap[TPath]\n\t\t\t: GenericModule\n\t>(name: TPath): TReturn | null {\n\t\tlet module = this.__resolve(name);\n\t\tif ( !(module instanceof Module) )\n\t\t\treturn null;\n\n\t\tif ( this.__processModule )\n\t\t\tmodule = this.__processModule(module);\n\n\t\treturn module as TReturn;\n\t}\n\n\n\thasModule(name: string) {\n\t\tconst module = this.__modules[this.abs_path(name)];\n\t\treturn module instanceof Module;\n\t}\n\n\n\tprivate __get_requires() {\n\t\tif ( has(this, 'requires') )\n\t\t\treturn this.requires;\n\t\tif ( has(this.constructor, 'requires') )\n\t\t\treturn (this.constructor as any).requires as string[];\n\t\treturn null;\n\t}\n\n\n\tprivate __get_load_requires() {\n\t\tif ( has(this, 'load_requires') )\n\t\t\treturn this.load_requires;\n\t\tif ( has(this.constructor, 'load_requires') )\n\t\t\treturn (this.constructor as any).load_requires as string[];\n\t\treturn null;\n\t}\n\n\n\tprivate __processModule<TModule extends Module>(module: TModule): TModule {\n\t\tif ( this.__addon_id && module.getAddonProxy ) {\n\t\t\tconst addon_id = this.__addon_id;\n\t\t\tif ( ! module.__proxies )\n\t\t\t\tmodule.__proxies = {};\n\n\t\t\tif ( module.__proxies[addon_id] )\n\t\t\t\treturn module.__proxies[addon_id] as TModule;\n\n\t\t\t// TODO: Typing for the addons module.\n\t\t\tconst addon = (this.__resolve('addons') as any)?.getAddon?.(addon_id),\n\t\t\t\tout = module.getAddonProxy(addon_id, addon, this.__addon_root ?? this, this);\n\n\t\t\tif ( out !== module )\n\t\t\t\tmodule.__proxies[addon_id] = out;\n\n\t\t\treturn out as TModule;\n\t\t}\n\n\t\treturn module;\n\t}\n\n\n\tinject(name: string | Module | null, module?: GenericModule | typeof Module<any, any> | null, require: boolean = true) {\n\t\tif ( name instanceof Module || (name && (name as any).prototype instanceof Module) ) {\n\t\t\trequire = module != null ? module as any : true;\n\t\t\tmodule = name as Module;\n\t\t\tname = null;\n\t\t}\n\n\t\tconst requires = this.requires = this.__get_requires() || [];\n\n\t\tif ( module instanceof Module ) {\n\t\t\t// Existing Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.constructor.name.toSnakeCase();\n\n\t\t} else if ( module && module.prototype instanceof Module ) {\n\t\t\t// New Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.name.toSnakeCase();\n\n\t\t\tmodule = this.register(name, module);\n\n\t\t} else if ( name ) {\n\t\t\t// Just a Name\n\t\t\tconst full_name = name;\n\t\t\tname = name.replace(/^(?:[^.]*\\.)+/, '');\n\t\t\tmodule = this.__resolve(full_name) as Module | undefined;\n\n\t\t\t// Allow injecting a module that doesn't exist yet?\n\n\t\t\tif ( ! module || !(module instanceof Module) ) {\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as PendingModule)[2].push([this.__path as string, name]);\n\t\t\t\telse\n\t\t\t\t\tthis.__modules[this.abs_path(full_name)] = [[], [], [[this.__path as string, name]]]\n\n\t\t\t\trequires.push(this.abs_path(full_name));\n\n\t\t\t\treturn (this as any)[name] = null;\n\t\t\t}\n\n\t\t} else\n\t\t\tthrow new TypeError(`must provide a valid module name or class`);\n\n\t\tif ( ! module )\n\t\t\tthrow new Error(`cannot find module ${name} or no module provided`);\n\n\t\tif ( require )\n\t\t\trequires.push((module as Module).abs_path('.'));\n\n\t\tif ( this.enabled && ! (module as Module).enabled )\n\t\t\t(module as Module).enable();\n\n\t\t(module as Module).references.push([this.__path as string, name]);\n\n\t\tif ( (module instanceof Module) && this.__processModule )\n\t\t\tmodule = this.__processModule(module);\n\n\t\treturn (this as any)[name] = module;\n\t}\n\n\n\tinjectAs(variable: string, name: string | Module | null, module?: GenericModule | typeof Module<any, any> | null, require: boolean = true) {\n\t\tif ( name instanceof Module || (name && (name as any).prototype instanceof Module) ) {\n\t\t\trequire = module != null ? module as any : true;\n\t\t\tmodule = name as Module;\n\t\t\tname = null;\n\t\t}\n\n\t\tconst requires = this.requires = this.__get_requires() || [];\n\n\t\tif ( module instanceof Module ) {\n\t\t\t// Existing Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.constructor.name.toSnakeCase();\n\n\t\t} else if ( module && module.prototype instanceof Module ) {\n\t\t\t// New Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.name.toSnakeCase();\n\n\t\t\tmodule = this.register(name, module);\n\n\t\t} else if ( name ) {\n\t\t\t// Just a Name\n\t\t\tconst full_name = name;\n\t\t\tname = name.replace(/^(?:[^.]*\\.)+/, '');\n\t\t\tmodule = this.__resolve(full_name) as Module | undefined;\n\n\t\t\t// Allow injecting a module that doesn't exist yet?\n\n\t\t\tif ( ! module || !(module instanceof Module) ) {\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as PendingModule)[2].push([this.__path as string, variable]);\n\t\t\t\telse\n\t\t\t\t\tthis.__modules[this.abs_path(full_name)] = [[], [], [[this.__path as string, variable]]]\n\n\t\t\t\trequires.push(this.abs_path(full_name));\n\n\t\t\t\treturn (this as any)[variable] = null;\n\t\t\t}\n\n\t\t} else\n\t\t\tthrow new TypeError(`must provide a valid module name or class`);\n\n\t\tif ( ! module )\n\t\t\tthrow new Error(`cannot find module ${name} or no module provided`);\n\n\t\tif ( require )\n\t\t\trequires.push((module as Module).abs_path('.'));\n\n\n\t\tif ( this.enabled && ! (module as Module).enabled )\n\t\t\t(module as Module).enable();\n\n\t\t(module as Module).references.push([this.__path as string, variable]);\n\n\t\tif ( this.__processModule )\n\t\t\tmodule = this.__processModule(module as Module);\n\n\t\treturn (this as any)[variable] = module;\n\t}\n\n\n\tregister(name: string, module: typeof Module<any, any>, inject_reference: boolean = false) {\n\t\tif ( (name as any).prototype instanceof Module ) {\n\t\t\tinject_reference = module as any;\n\t\t\tmodule = name as any;\n\t\t\tname = module.name.toSnakeCase();\n\t\t}\n\n\t\tconst path = this.abs_path(`.${name}`),\n\t\t\tproto = module.prototype,\n\t\t\told_val = this.__modules[path];\n\n\t\tif ( !(proto instanceof Module) )\n\t\t\tthrow new TypeError(`Module ${name} is not subclass of Module.`);\n\n\t\tif ( old_val instanceof Module )\n\t\t\tthrow new ModuleError(`Name Collision for Module ${path}`);\n\n\t\tconst dependents = old_val || [[], [], []];\n\t\tlet inst = this.__modules[path] = new module(name, this);\n\t\tconst requires = inst.requires = inst.__get_requires() || [],\n\t\t\tload_requires = inst.load_requires = inst.__get_load_requires() || [];\n\n\t\tinst.dependents = dependents[0];\n\t\tinst.load_dependents = dependents[1];\n\t\tinst.references = dependents[2];\n\n\t\tfor(const req_name of requires) {\n\t\t\tconst req_path = inst.abs_path(req_name),\n\t\t\t\treq_mod = this.__modules[req_path];\n\n\t\t\tif ( ! req_mod )\n\t\t\t\tthis.__modules[req_path] = [[path],[],[]];\n\t\t\telse if ( Array.isArray(req_mod) )\n\t\t\t\treq_mod[0].push(path);\n\t\t\telse\n\t\t\t\treq_mod.dependents.push(path);\n\t\t}\n\n\t\tfor(const req_name of load_requires) {\n\t\t\tconst req_path = inst.abs_path(req_name),\n\t\t\t\treq_mod = this.__modules[req_path];\n\n\t\t\tif ( ! req_mod )\n\t\t\t\tthis.__modules[req_path] = [[], [path], []];\n\t\t\telse if ( Array.isArray(req_mod) )\n\t\t\t\treq_mod[1].push(path);\n\t\t\telse\n\t\t\t\treq_mod.load_dependents.push(path);\n\t\t}\n\n\t\tfor(const [in_path, in_name] of dependents[2]) {\n\t\t\tconst in_mod = this.__resolve(in_path);\n\t\t\tif ( in_mod && ! Array.isArray(in_mod) )\n\t\t\t\t(in_mod as any)[in_name] = inst;\n\t\t\telse\n\t\t\t\tthis.log.warn(`Unable to find module \"${in_path}\" that wanted \"${in_name}\".`);\n\t\t}\n\n\t\tif ( this.__processModule )\n\t\t\tinst = this.__processModule(inst as GenericModule);\n\n\t\tif ( inject_reference )\n\t\t\t(this as any)[name] = inst;\n\n\t\treturn inst;\n\t}\n\n\n\t/**\n\t * Attempt to load a set of child modules from a {@link require.context}\n\t * object. This searches the default exports, as well as exports named\n\t * `module` specifically. Each discovered module will be registered\n\t * and injected onto this module.\n\t *\n\t * @param ctx The context to load from.\n\t * @param log A logger to use for logging errors. If not provided, this\n\t * will default to this module's default logger.\n\t * @returns A map of all loaded modules.\n\t */\n\tasync loadFromContext(ctx: __WebpackModuleApi.RequireContext, log?: Logger) {\n\t\tlog = log ?? this.log;\n\t\tconst added: Record<string, GenericModule> = {};\n\t\tfor(const raw_path of ctx.keys()) {\n\t\t\tconst raw_module = await ctx(raw_path), // eslint-disable-line no-await-in-loop\n\t\t\t\tmodule = raw_module.module || raw_module.default,\n\t\t\t\tlix = raw_path.lastIndexOf('.'),\n\t\t\t\ttrimmed = lix > 2 ? raw_path.slice(2, lix) : raw_path,\n\t\t\t\tname = trimmed.endsWith('/index') ? trimmed.slice(0, -6) : trimmed;\n\n\t\t\ttry {\n\t\t\t\tadded[name] = this.register(name, module);\n\t\t\t} catch(err) {\n\t\t\t\tif ( log && err instanceof Error ) {\n\t\t\t\t\tlog.capture(err, {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tmodule: name,\n\t\t\t\t\t\t\tpath: raw_path\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlog.warn(err, `Skipping ${raw_path}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn added;\n\t}\n\n}\n\nexport default Module;\n\nexport function buildAddonProxy<TObj extends object, TNoProxy extends boolean = false>(\n\taccessor: Module | null,\n\tthing: TObj,\n\tname: string,\n\toverrides: Record<string, any>,\n\taccess_warnings?: Record<string, string | boolean>,\n\tno_proxy?: TNoProxy\n): TNoProxy extends true ? ProxyHandler<TObj> : TObj {\n\n\tconst handler = {\n\t\tget(obj: any, prop: string, receiver: unknown) {\n\t\t\t// First, handle basic overrides behavior.\n\t\t\tlet value = overrides[prop];\n\t\t\tif ( value !== undefined ) {\n\t\t\t\t// Check for functions, and bind their this.\n\t\t\t\tif ( typeof value === 'function' )\n\t\t\t\t\treturn value.bind(obj);\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\t// Next, handle access warnings.\n\t\t\tconst warning = access_warnings && access_warnings[prop];\n\t\t\tif ( accessor?.log && warning )\n\t\t\t\taccessor.log.warn(`[DEV-CHECK] Accessed ${name}.${prop} directly. ${typeof warning === 'string' ? warning : ''}`)\n\n\t\t\t// Check for functions, and bind their this.\n\t\t\tvalue = obj[prop];\n\t\t\tif ( typeof value === 'function' )\n\t\t\t\treturn value.bind(obj);\n\n\t\t\t// Make sure all module access is proxied.\n\t\t\tif ( accessor && (value instanceof Module) )\n\t\t\t\t// TypeScript thinks this doesn't work. It technically does,\n\t\t\t\t// we just don't want to encourage it.\n\t\t\t\treturn accessor.resolve(value as any);\n\n\t\t\t// Return whatever it would be normally.\n\t\t\treturn Reflect.get(obj, prop, receiver);\n\t\t}\n\t};\n\n\treturn no_proxy ? handler : new Proxy<TObj>(thing, handler) as any;\n\n}\n\n\n// ============================================================================\n// Errors\n// ============================================================================\n\n/**\n * A subclass of {@link Error} for errors directly related to {@link Module}\n * state. These may be thrown when attempting to enable, disable, load, or\n * unload a module.\n *\n * @noInheritDoc\n */\nexport class ModuleError extends Error { }\n\n/**\n * A subclass of {@link ModuleError} thrown in specific cases when attempting\n * to enable, disable, load, or unload a {@link Module} results in a cycle.\n * This happens if a module depends on a module that, directly or indirectly,\n * depends on itself.\n */\nexport class CyclicDependencyError extends ModuleError {\n\n\t/** The list of modules encountered, in the order they were encountered. */\n\tmodules: GenericModule[];\n\n\t/**\n\t * Create a new instance of CyclicDependencyError.\n\t *\n\t * @param message The message to display with the error.\n\t * @param modules The list of modules at fault.\n\t */\n\tconstructor(message: string, modules: GenericModule[]) {\n\t\tsuper(`${message} (${modules.map(x => (x as Module).path).join(' => ')})`);\n\t\tthis.modules = modules;\n\t}\n\n}\n","\nimport {BAD_HOTKEYS, TWITCH_EMOTE_V2, WORD_SEPARATORS} from 'utilities/constants';\nimport type { ExtractSegments, ExtractType } from 'utilities/types';\n\nconst HOP = Object.prototype.hasOwnProperty;\n\n/**\n * Get the URL for a Twitch emote.\n *\n * @param id The emote's ID.\n * @param scale The scale.\n * @param animated Whether or not to allow animated images.\n * @param dark Whether or not the image is to be displayed on a dark background.\n * Twitch, continuing to innovate in being behind the times, uses GIFs for\n * their animated emotes so matteing is a concern.\n */\nexport function getTwitchEmoteURL(\n\tid: string,\n\tscale: 1 | 2 | 4,\n\tanimated: boolean = false,\n\tdark: boolean = true\n) {\n\treturn `${TWITCH_EMOTE_V2}/${id}/${animated ? 'default' : 'static'}/${dark ? 'dark' : 'light'}/${scale == 4 ? 3 : scale}.0`\n}\n\n/**\n * Get an `srcset` for a Twitch emote. This is intended for use with\n * an image element's `srcset` attribute.\n *\n * @param id The emote's ID.\n * @param animated Whether or not to allow animated images.\n * @param dark Whether or not the image is to be displayed on a dark background.\n * Twitch, continuing to innovate in being behind the times, uses GIFs for\n * their animated emotes so matteing is a concern.\n * @param big If this is true, the emote's 2x image will be used for 1x\n * size, and its 4x image will be used for 2x size.\n */\nexport function getTwitchEmoteSrcSet(\n\tid: string,\n\tanimated: boolean = false,\n\tdark: boolean = true,\n\tbig: boolean = false\n) {\n\tif ( big )\n\t\treturn `${getTwitchEmoteURL(id, 2, animated, dark)} 1x, ${getTwitchEmoteURL(id, 4, animated, dark)} 2x`;\n\n\treturn `${getTwitchEmoteURL(id, 1, animated, dark)} 1x, ${getTwitchEmoteURL(id, 2, animated, dark)} 2x, ${getTwitchEmoteURL(id, 4, animated, dark)} 4x`;\n}\n\n/** Check if the provided shortkey key is valid. */\nexport function isValidShortcut(key: string) {\n\tif ( ! key )\n\t\treturn false;\n\n\tkey = key.toLowerCase().trim();\n\treturn ! BAD_HOTKEYS.includes(key);\n}\n\n/**\n * Generate a random UUIDv4.\n *\n * This method has a fallback implementation for people using\n * ancient browsers without {@link crypto.randomUUID}.\n */\nexport const generateUUID = crypto.randomUUID\n\t? () => crypto.randomUUID()\n\t: function generateUUID(input?: any): string {\n\t\treturn input           // if the placeholder was passed, return\n\t\t\t? (              // a random number from 0 to 15\n\t\t\t\tinput ^            // unless b is 8,\n\t\t\t\tMath.random()  // in which case\n\t\t\t\t* 16           // a random number from\n\t\t\t\t>> input/4         // 8 to 11\n\t\t\t).toString(16) // in hexadecimal\n\t\t\t: (              // or otherwise a concatenated string:\n\t\t\t\t[1e7] as any +        // 10000000 +\n\t\t\t\t-1e3 +         // -1000 +\n\t\t\t\t-4e3 +         // -4000 +\n\t\t\t\t-8e3 +         // -80000000 +\n\t\t\t\t-1e11          // -100000000000,\n\t\t\t).replace(     // replacing\n\t\t\t\t/[018]/g,    // zeroes, ones, and eights with\n\t\t\t\tgenerateUUID            // random hex digits\n\t\t\t);\n\t};\n\n\n/**\n * An error that can be localized using the i18n module.\n */\nexport class TranslatableError extends Error {\n\n\ti18n_key: string;\n\tdata: any;\n\n\tconstructor(message: string, key: string, data?: any) {\n\t\tsuper(message);\n\t\tthis.i18n_key = key;\n\t\tthis.data = data;\n\t}\n\n\ttoString() {\n\t\tconst ffz = window.FrankerFaceZ?.get(),\n\t\t\ti18n = ffz?.resolve('i18n');\n\n\t\tif ( i18n && this.i18n_key )\n\t\t\treturn i18n.t(this.i18n_key, this.message, this.data);\n\n\t\treturn this.message;\n\t}\n}\n\n\n/**\n * Get a SHA-256 hash of a string. Uses {@link crypto.subtle.digest}\n *\n * @param message The string to hash.\n */\nexport async function sha256(message: string) {\n\t// encode as UTF-8\n\tconst msgBuffer = new TextEncoder().encode(message);\n\n\t// hash the message\n\tconst hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n\n\t// convert ArrayBuffer to Array\n\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\n\t// convert bytes to hex string\n\tconst hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\treturn hashHex;\n}\n\n\nexport type ScreenDimensions = {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\theight: number;\n\tlabel: string;\n};\n\nexport type ScreenOptions = {\n\tindex?: number;\n\ttop?: number;\n\tleft?: number;\n\twidth?: number;\n\theight?: number;\n\tlabel?: string | null;\n}\n\n/**\n * Determine which screen from the provided array is the closest match to\n * the provided options. This is used by the settings profile rule for\n * Current Monitor.\n *\n * @param screens The screens to choose between.\n * @param options The options to choose with.\n */\nexport function matchScreen(screens: ScreenDimensions[], options: ScreenOptions) {\n\tlet match = undefined;\n\tlet mscore = 0;\n\n\tfor(let i = 0; i < screens.length; i++) {\n\t\tconst mon = screens[i];\n\t\tif ( mon.label !== options.label )\n\t\t\tcontinue;\n\n\t\tlet score = 1;\n\t\tif ( options.left && options.left === mon.left )\n\t\t\tscore += 15;\n\t\tif ( options.top && options.top === mon.top )\n\t\t\tscore += 15;\n\n\t\tif ( options.width && options.width === mon.width )\n\t\t\tscore += 10;\n\n\t\tif ( options.height && options.height === mon.height )\n\t\t\tscore += 10;\n\n\t\tif ( options.index )\n\t\t\tscore -= Math.abs(options.index - i);\n\n\t\tif ( score > mscore ) {\n\t\t\tmatch = mon;\n\t\t\tmscore = score;\n\t\t}\n\t}\n\n\treturn match;\n}\n\n/**\n * Determine if the provided object has a key with the given name.\n *\n * @param object The object to check.\n * @param key The key to search for.\n */\nexport function has<T>(object: T, key: PropertyKey): key is keyof T {\n\treturn object ? HOP.call(object, key) : false;\n}\n\n\n/**\n * Return a {@link Promise} that resolves after a set delay.\n *\n * @param delay The amount of time to wait, in milliseconds.\n */\nexport function sleep(delay: number): Promise<void> {\n\treturn new Promise(resolve => setTimeout(resolve, delay));\n}\n\n\nexport type FakeEnum<T extends string> = {\n\t[K in T | number]: K extends number ? T : number;\n};\n\n/**\n * Create an enum-like object from an array of strings.\n *\n * @deprecated This should no longer be used, as we now have access to\n * TypeScript's enum types.\n */\nexport function make_enum<T extends string>(...input: T[]): FakeEnum<T> {\n\tconst out: any = {};\n\n\tfor(let i = 0, l = input.length; i < l; i++) {\n\t\tconst word = input[i];\n\t\tout[word] = i;\n\t\tout[i] = word;\n\t}\n\n\treturn out;\n}\n\nexport type FakeEnumFlags<T extends string> = FakeEnum<T> & {\n\tNone: 0;\n}\n\n/**\n * Create an enum-like object from an array of strings, such that every\n * value is a power of two so that they can be processed using binary\n * operators.\n *\n * @deprecated This should no longer be used, as we now have access to\n * TypeScript's enum types.\n */\nexport function make_enum_flags<T extends string>(...input: T[]): FakeEnumFlags<T> {\n\tconst out: any = {};\n\n\tout.None = 0;\n\tout[0] = 'None';\n\n\tfor(let i = 0, l = input.length; i < l; i++) {\n\t\tconst word = input[i],\n\t\t\tvalue = Math.pow(2, i);\n\t\tout[word] = value;\n\t\tout[value] = word;\n\t}\n\n\treturn out;\n}\n\n/**\n * A simple {@link Error} subclass thrown from {@link timeout} if and\n * when the Promise times out.\n *\n * @noInheritDoc\n */\nexport class TimeoutError extends Error {\n\tconstructor(message?: string) {\n\t\tsuper(message ?? 'timeout')\n\t}\n}\n\n/**\n * Wrap a {@link Promise} with another Promise that, if the original\n * Promise fails to resolve or reject within the provided delay, will\n * be rejected with a {@link TimeoutError}.\n *\n * @param promise The Promise to wrap\n * @param delay The length of time, in milliseconds, to wait before timing out.\n */\nexport function timeout<TReturn = unknown>(promise: Promise<TReturn>, delay: number) {\n\treturn new Promise<TReturn>((resolve, fail) => {\n\t\tlet resolved = false;\n\t\tconst timer = setTimeout(() => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tfail(new TimeoutError());\n\t\t\t}\n\t\t}, delay);\n\n\t\tpromise.then(result => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tresolve(result);\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tfail(err);\n\t\t\t}\n\t\t});\n\t});\n}\n\n\n/**\n * TicketLock is a simple class that implements a [Ticket Lock](https://en.wikipedia.org/wiki/Ticket_lock)\n * pattern for cooperative waiting. This can be used for, among other things,\n * limiting the number of concurrent API requests to avoid overloading\n * browser or server limits.\n *\n * @example Using TicketLock to limit access to an API.\n * ```typescript\n * // In your constructor.\n * this.api_tickets = new TicketLock(5); // allow up to 5 simultaneous requests\n *\n * // In a method accessing your API\n * const ticket = await this.api_tickets.wait();\n *\n * const request = await fetch(url).finally(ticket);\n * if ( request.ok )\n *     // ...\n * ```\n */\nexport class TicketLock {\n\tlimit: number;\n\n\tprivate __active: number;\n\tprivate __waiting: ((done: () => void) => void)[];\n\n\tconstructor(limit = 1) {\n\t\tthis.limit = limit;\n\t\tthis.__active = 0;\n\t\tthis.__waiting = [];\n\t}\n\n\t/** Whether or not there is a ticket available. */\n\tget available() { return this.__active < this.limit }\n\n\tprivate __done() {\n\t\tthis.__active--;\n\n\t\twhile(this.__active < this.limit && this.__waiting.length > 0) {\n\t\t\tthis.__active++;\n\t\t\tconst waiter = this.__waiting.shift();\n\t\t\tif ( waiter )\n\t\t\t\twaiter(this.__getTicket());\n\t\t}\n\t}\n\n\t/**\n\t * Get a ticket function. This ensures that a bad caller can't call\n\t * its function multiple times to mess up the active tickets count.\n\t */\n\tprivate __getTicket() {\n\t\tlet held = true;\n\t\treturn () => {\n\t\t\tif ( held ) {\n\t\t\t\theld = false;\n\t\t\t\tthis.__done();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Wait for a ticket to become available. Once a ticket is\n\t * available, returns a function that **must** be called\n\t * after you're done with the ticket to return the ticket\n\t * to the pool.\n\t */\n\twait() {\n\t\tif ( this.__active < this.limit) {\n\t\t\tthis.__active++;\n\t\t\treturn Promise.resolve(this.__getTicket());\n\t\t}\n\n\t\treturn new Promise<() => void>(resolve => this.__waiting.push(resolve));\n\t}\n}\n\n/**\n * @deprecated Renamed to TicketLock to be more accurate.\n */\nexport const Mutex = TicketLock;\n\n\ntype AnyFunction = (...args: any[]) => any;\n\n/**\n * Return a wrapper for a function that will only execute the function\n * a period of time after it has stopped being called.\n *\n * Alternatively, by setting `immediate` to true, you can have the\n * function run immediately, but then wait a period of time before\n * being able to run again.\n *\n * By setting immediate to `2`, you can have the function run\n * immediately and, after a period of time, run again as long\n * as it was called again.\n *\n * @param fn The function to wrap.\n * @param delay The time to wait, in milliseconds\n * @param immediate If immediate is true, trigger the function immediately rather than eventually.\n * @returns The wrapped function\n */\nexport function debounce<TFunc extends AnyFunction>(\n\tfn: TFunc,\n\tdelay: number,\n\timmediate: boolean | 2 = false\n) {\n\n\tlet timer: ReturnType<typeof setTimeout> | null;\n\n\tif ( immediate ) {\n\t\tconst later = () => timer = null;\n\t\tif ( immediate === 2 )\n\t\t\t// Special Mode! Run immediately OR later.\n\t\t\treturn function debouncedFunction(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\t\t\tif ( timer ) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\ttimer = null;\n\t\t\t\t\t\tfn.apply(this, args);\n\t\t\t\t\t}, delay);\n\t\t\t\t} else {\n\t\t\t\t\tfn.apply(this, args);\n\t\t\t\t\ttimer = setTimeout(later, delay);\n\t\t\t\t}\n\t\t\t}\n\n\t\treturn function(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\t\tif ( ! timer )\n\t\t\t\tfn.apply(this, args);\n\t\t\telse\n\t\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = setTimeout(later, delay);\n\t\t}\n\t}\n\n\treturn function(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\tif ( timer )\n\t\t\tclearTimeout(timer);\n\n\t\ttimer = setTimeout(fn.bind(this, ...args), delay) as any;\n\t}\n}\n\n\n/**\n * Make sure that a given asynchronous function is only called once\n * at a time.\n */\nexport function once<TFunc extends AnyFunction, TReturn = Awaited<ReturnType<TFunc>>>(fn: TFunc) {\n\tlet promise: Promise<TReturn> | undefined;\n\n\treturn function onceFunction(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>): Promise<TReturn> {\n\t\tif ( promise )\n\t\t\treturn promise;\n\n\t\ttry {\n\t\t\tpromise = Promise.resolve<TReturn>(fn.call(this, ...args));\n\t\t} catch(err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn promise.finally(() => promise = undefined);\n\t}\n}\n\n\n/**\n * Check that two arrays are the same length and that each array has the same\n * items in the same indices.\n * @param a The first array\n * @param b The second array\n * @returns Whether or not they match\n */\nexport function array_equals(a?: any[] | null, b?: any[] | null) {\n\tif ( ! Array.isArray(a) || ! Array.isArray(b) || a.length !== b.length )\n\t\treturn false;\n\n\tlet i = a.length;\n\twhile(i--)\n\t\tif ( a[i] !== b[i] )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/**\n * Determine if two objects are equal, deeply comparing their values. This\n * will recurse into the objects as necessary, and has protection against\n * recursive structures.\n *\n * @param first The first object.\n * @param second The second object.\n * @param ignore_undefined Whether or not a missing value on one object\n * should be considered equal to an `undefined` value on the other object.\n * @param first_seen For internal use.\n * @param second_seen For internal use.\n */\nexport function deep_equals(\n\tfirst: any,\n\tsecond: any,\n\tignore_undefined = false,\n\tfirst_seen?: Set<PropertyKey>,\n\tsecond_seen?: Set<PropertyKey>\n) {\n\tif ( first === second )\n\t\treturn true;\n\tif ( typeof first !== typeof second )\n\t\treturn false;\n\tif ( typeof first !== 'object' )\n\t\treturn false;\n\tif ( (first === null) !== (second === null) )\n\t\treturn false;\n\n\tif ( ! first_seen )\n\t\tfirst_seen = new Set;\n\n\tif ( ! second_seen )\n\t\tsecond_seen = new Set;\n\n\tif ( first_seen.has(first) || second_seen.has(second) )\n\t\tthrow new Error('recursive structure detected');\n\n\tfirst_seen.add(first);\n\tsecond_seen.add(second);\n\n\t// TODO: Special logic for Sets and Maps\n\n\tconst source_keys = Object.keys(first),\n\t\tdest_keys = Object.keys(second);\n\n\tif ( ! ignore_undefined && ! set_equals(new Set(source_keys), new Set(dest_keys)) )\n\t\treturn false;\n\n\tfor(const key of source_keys)\n\t\tif ( ! deep_equals(first[key], second[key], ignore_undefined, new Set(first_seen), new Set(second_seen)) )\n\t\t\treturn false;\n\n\tif ( ignore_undefined )\n\t\tfor(const key of dest_keys)\n\t\t\tif ( ! source_keys.includes(key) ) {\n\t\t\t\tif ( ! deep_equals(first[key], second[key], ignore_undefined, new Set(first_seen), new Set(second_seen)) )\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\treturn true;\n}\n\n/**\n * Determine if two objects are equal, shallowly comparing their values.\n *\n * @param first The first object\n * @param second The second object\n */\nexport function shallow_object_equals(first: any, second: any) {\n\tif ( typeof first !== 'object' || typeof second !== 'object' )\n\t\treturn false;\n\n\tconst keys = Object.keys(first);\n\tif ( ! set_equals(new Set(keys), new Set(Object.keys(second))) )\n\t\treturn false;\n\n\tfor(const key of keys)\n\t\tif ( first[key] !== second[key] )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/**\n * Determine if two Maps are equal, shallowly comparing stored values.\n * @param first The first Map\n * @param second The second Map\n */\nexport function map_equals(first: Map<any, any>, second: Map<any, any>) {\n\tif ( !(first instanceof Map) || !(second instanceof Map) || first.size !== second.size )\n\t\treturn false;\n\n\tfor(const [key, val] of first)\n\t\tif ( ! second.has(key) || second.get(key) !== val )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n/**\n * Determine if two Sets are equal, shallowly comparing stored values.\n *\n * @param first The first Set\n * @param second The second Set\n */\nexport function set_equals(first: Set<any>, second: Set<any>) {\n\tif ( !(first instanceof Set) || !(second instanceof Set) || first.size !== second.size )\n\t\treturn false;\n\n\tfor(const v of first)\n\t\tif ( ! second.has(v) )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/* **\n * Special logic to ensure that a target object is matched by a filter.\n * @param {object} filter The filter object\n * @param {object} target The object to check it against\n * @returns {boolean} Whether or not it matches\n /\nexport function filter_match(filter, target) {\n\tfor(const key in filter) {\n\t\tif ( HOP.call(filter, key) ) {\n\t\t\tconst filter_value = filter[key],\n\t\t\t\ttarget_value = target[key],\n\t\t\t\ttype = typeof filter_value;\n\n\t\t\tif ( type === 'function' ) {\n\t\t\t\tif ( ! filter_value(target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( Array.isArray(filter_value) ) {\n\t\t\t\tif ( Array.isArray(target_value) ) {\n\t\t\t\t\tfor(const val of filter_value)\n\t\t\t\t\t\tif ( ! target_value.includes(val) )\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t} else if ( ! filter_value.include(target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( typeof target_value !== type )\n\t\t\t\treturn false;\n\n\t\t\telse if ( type === 'object' ) {\n\t\t\t\tif ( ! filter_match(filter_value, target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( filter_value !== target_value )\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}*/\n\n/**\n * Return the number of times a substring is found within a string.\n * @param str The string to search within.\n * @param needle The substring to search for.\n * @returns The number of matches found.\n */\nexport function substr_count(str: string, needle: string) {\n\tlet i = 0, idx = 0;\n\twhile( idx < str.length ) {\n\t\tconst x = str.indexOf(needle, idx);\n\t\tif ( x === -1 )\n\t\t\tbreak;\n\n\t\ti++;\n\t\tidx = x + 1;\n\t}\n\n\treturn i;\n}\n\n\n// These types are all used by get()\n\n/**\n * Get a value from an object at a path.\n * @param path The path to follow, using periods to go down a level.\n * @param object The starting object.\n * @returns The value at that point in the path, or undefined if part of the path doesn't exist.\n */\nexport function get<TPath extends string, TValue = any, TReturn = ExtractType<TValue, ExtractSegments<TPath>>>(path: TPath, object: TValue): TReturn {\n\tlet segments: string | string[] = path;\n\tif ( typeof segments === 'string' ) {\n\t\tif ( HOP.call(object, segments) )\n\t\t\treturn (object as any)[segments] as TReturn;\n\n\t\tsegments = segments.split('.');\n\t}\n\n\tfor(let i=0, l = segments.length; i < l; i++) {\n\t\tconst part = segments[i];\n\t\tif ( part === '@each' ) {\n\t\t\tconst p = segments.slice(i + 1);\n\t\t\tif ( p.length ) {\n\t\t\t\tif ( Array.isArray(object) )\n\t\t\t\t\tobject = object.map(x => get(p as any, x)) as any;\n\t\t\t\telse {\n\t\t\t\t\tconst new_object: any = {};\n\t\t\t\t\tfor(const key in object)\n\t\t\t\t\t\tif ( HOP.call(object, key) )\n\t\t\t\t\t\t\tnew_object[key] = get(p as any, object[key]);\n\t\t\t\t\tobject = new_object;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\t} else if ( part === '@last' )\n\t\t\tobject = (object as any)[(object as any).length - 1] as any;\n\t\telse\n\t\t\tobject = (object as any)[part] as any;\n\n\t\tif ( ! object )\n\t\t\tbreak;\n\t}\n\n\treturn object as any;\n}\n\n\n/**\n * Copy an object so that it can be safely serialized. If an object\n * is not serializable, such as a promise, returns null.\n *\n * @export\n * @param {*} object The thing to copy.\n * @param {Number} [depth=2] The maximum depth to explore the object.\n * @param {Set} [seen=null] A Set of seen objects. Internal use only.\n * @returns {Object} The copy to safely store or use.\n */\nexport function shallow_copy<T>(object: T, depth: number = 2, seen?: Set<any>): T {\n\tif ( object == null )\n\t\treturn object;\n\n\tif ( object instanceof Promise || typeof object === 'function' )\n\t\treturn null as T;\n\n\tif ( typeof object !== 'object' )\n\t\treturn object;\n\n\tif ( depth === 0 )\n\t\treturn null as T;\n\n\tif ( ! seen )\n\t\tseen = new Set;\n\n\tseen.add(object);\n\n\tif ( Array.isArray(object) ) {\n\t\tconst out = [];\n\t\tfor(const val of object) {\n\t\t\tif ( seen.has(val) )\n\t\t\t\tcontinue;\n\n\t\t\tout.push(shallow_copy(val, depth - 1, new Set(seen)));\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tconst out = {} as Record<string, any>;\n\tfor(const [key, val] of Object.entries(object) ) {\n\t\tif ( seen.has(val) )\n\t\t\tcontinue;\n\n\t\tout[key] = shallow_copy(val, depth - 1, new Set(seen));\n\t}\n\n\treturn out as T;\n}\n\n\n/**\n * Make a clone of an object, recursing into the object to copy its\n * values as well.\n *\n * @deprecated This was written before {@link structuredClone}. We should\n * probably start using that instead for new code.\n *\n * @param object The object to clone.\n * @param seen For internal use only.\n * @returns A clone of the object.\n */\nexport function deep_copy<T>(object: T, seen?: Set<any>): T {\n\tif ( object === null )\n\t\treturn null as T;\n\telse if ( object === undefined )\n\t\treturn undefined as T;\n\n\t// Wrap the promise, just in case.\n\tif ( object instanceof Promise )\n\t\treturn new Promise((resolve, fail) => object.then(resolve).catch(fail)) as T;\n\n\t// Wrap the function, just in case.\n\tif ( typeof object === 'function' )\n\t\treturn function(this: ThisParameterType<T>, ...args: any[]) { return object.apply(this, args); } as T // eslint-disable-line no-invalid-this\n\n\tif ( object instanceof RegExp )\n\t\treturn new RegExp(object.source, object.flags) as T;\n\n\tif ( object instanceof Date )\n\t\treturn new Date(object) as T;\n\n\tif ( typeof object !== 'object' )\n\t\treturn object as T;\n\n\tif ( ! seen )\n\t\tseen = new Set;\n\n\tif ( seen.has(object) )\n\t\tthrow new Error('recursive structure detected');\n\n\tseen.add(object);\n\n\tif ( Array.isArray(object) )\n\t\treturn object.map(x => deep_copy(x, new Set(seen))) as T;\n\n\tif ( object instanceof Set ) {\n\t\tconst out = new Set<any>();\n\t\tfor(const item of object) {\n\t\t\tif ( typeof item === 'object' )\n\t\t\t\tout.add(deep_copy(item));\n\t\t\telse\n\t\t\t\tout.add(item);\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tif ( object instanceof Map ) {\n\t\tconst out = new Map<any, any>();\n\t\tfor(const [key, val] of object.entries()) {\n\t\t\tlet k = typeof key === 'object' ? deep_copy(key) : key,\n\t\t\t\tv = typeof val === 'object' ? deep_copy(val) : val;\n\n\t\t\tout.set(k, v);\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tconst out: any = {};\n\tfor(const [key, val] of Object.entries(object)) {\n\t\tif ( typeof val === 'object' )\n\t\t\tout[key] = deep_copy(val, new Set(seen));\n\t\telse\n\t\t\tout[key] = val;\n\t}\n\n\treturn out as T;\n}\n\n\n/**\n * Normalize an add-on ID to make it more suitable for comparison\n * in certain contexts, such as inclusion in emote set IDs as\n * an example.\n */\nexport function normalizeAddonIdForComparison(input: string) {\n\treturn input.toLowerCase().replace(/[\\.\\_\\-]+/, '-');\n}\n\n/**\n * Create a regular expression for detecting the presence of\n * an add-on ID within a string. This uses {@link normalizeAddonIdForComparison}\n * along with a few hard-coded exceptions for current add-ons.\n *\n * @param input The add-on ID to test for.\n */\nexport function makeAddonIdChecker(input: string) {\n\tinput = escape_regex(normalizeAddonIdForComparison(input));\n\tinput = input.replace(/-+/g, '[\\.\\_\\-]+');\n\n\t// Special: ffzap-bttv\n\tinput = input.replace(/\\bbttv\\b/g, '(?:bttv|betterttv)');\n\n\t// Special: which seven tho\n\tinput = input.replace(/\\b7tv\\b/g, '(?:7tv|seventv)');\n\n\t// Special: pronouns (badges)\n\tinput = input.replace(/\\bpronouns\\b/g, '(?:pronouns|addon-pn)');\n\n\treturn new RegExp('\\\\b' + input + '\\\\b', 'i');\n}\n\n\ntype PossibleFunction<TReturn, TThis = unknown, TArgs extends any[] = any[]> =\n\t((this: TThis, ...args: TArgs) => TReturn) | TReturn;\n\n/**\n * Resolve a value that may be either a value, or a function that returns\n * the value.\n *\n * @param input The value to resolve.\n * @param ctx A context (this) to call the potential function with.\n * @param args\n * @returns\n */\nexport function maybe_call<TReturn, TThis, TArgs extends any[]>(\n\tinput: PossibleFunction<TReturn, TThis, TArgs>,\n\tctx: TThis,\n\t...args: TArgs\n): TReturn {\n\tif ( typeof input === 'function' ) {\n\t\tif ( ctx )\n\t\t\treturn (input as any).call(ctx, ...args);\n\t\treturn (input as any)(...args);\n\t}\n\n\treturn input;\n}\n\n\nconst SPLIT_REGEX = /[^\\uD800-\\uDFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDFFF]/g;\n\n/**\n * Split an input string into individual characters. This is used when\n * performing chat message tokenization due to the difference in how\n * JavaScript strings and strings on other platforms handle length and\n * offsets.\n *\n * @param str The string to split.\n */\nexport function split_chars(str: string) {\n\tif ( str === '' )\n\t\treturn [];\n\n\treturn str.match(SPLIT_REGEX);\n}\n\n/**\n * Pick a random value from an object or array and return it.\n *\n * @param obj The object or array to pick from.\n */\nexport function pick_random<T>(obj: T[]): T;\nexport function pick_random<T extends object, K extends keyof T>(obj: T): T[K];\nexport function pick_random(obj: any) {\n\tif ( ! obj )\n\t\treturn null;\n\n\tif ( ! Array.isArray(obj) ) {\n\t\tconst keys = Object.keys(obj);\n\t\treturn obj[pick_random(keys)];\n\t}\n\n\treturn obj[Math.floor(Math.random() * obj.length)];\n}\n\n/**\n * Escape a string for inclusion in a regular expression.\n */\nexport const escape_regex: (str: string) => string = /*(RegExp as any).escape\n\t? (str: string) => ((RegExp as any).escape(` ${str}`) as string).slice(1)\n\t:*/ function escape_regex(str: string) {\n\t\treturn str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\t};\n\n\nexport function addWordSeparators(str: string) {\n\treturn `(^|.*?${WORD_SEPARATORS})(?:${str})(?=$|${WORD_SEPARATORS})`\n}\n\n\nconst CONTROL_CHARS = '/$^+.()=!|';\n\n/**\n * Convert a glob into a regular expression.\n *\n * @param input The glob to convert.\n */\nexport function glob_to_regex(input: string) {\n\tif ( typeof input !== 'string' )\n\t\tthrow new TypeError('input must be a string');\n\n\tlet output = '',\n\t\tgroups = 0;\n\n\tfor(let i=0, l=input.length; i<l; i++) {\n\t\tconst char = input[i];\n\n\t\tif ( CONTROL_CHARS.includes(char) )\n\t\t\toutput += `\\\\${char}`;\n\n\t\telse if ( char === '\\\\' ) {\n\t\t\ti++;\n\t\t\tconst next = input[i];\n\t\t\tif ( next ) {\n\t\t\t\tif ( CONTROL_CHARS.includes(next) )\n\t\t\t\t\toutput += `\\\\${next}`;\n\t\t\t\telse\n\t\t\t\t\toutput += next;\n\t\t\t}\n\n\t\t} else if ( char === '?' )\n\t\t\toutput += '.';\n\n\t\telse if ( char === '[' ) {\n\t\t\toutput += char;\n\t\t\tconst next = input[i + 1];\n\t\t\tif ( next === '!' ) {\n\t\t\t\ti++;\n\t\t\t\toutput += '^';\n\t\t\t}\n\n\t\t} else if ( char === ']' )\n\t\t\toutput += char;\n\n\t\telse if ( char === '{' ) {\n\t\t\toutput += '(?:';\n\t\t\tgroups++;\n\n\t\t} else if ( char === '}' ) {\n\t\t\tif ( groups > 0 ) {\n\t\t\t\toutput += ')';\n\t\t\t\tgroups--;\n\t\t\t}\n\n\t\t} else if ( char === ',' && groups > 0 )\n\t\t\toutput += '|';\n\n\t\telse if ( char === '*' ) {\n\t\t\tlet count = 1;\n\t\t\twhile(input[i+1] === '*') {\n\t\t\t\tcount++;\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\tif ( count > 1 )\n\t\t\t\toutput += '.*?';\n\t\t\telse\n\t\t\t\toutput += '[^\\\\s]*?';\n\n\t\t} else\n\t\t\toutput += char;\n\t}\n\n\t/*while(groups > 0) {\n\t\toutput += ')';\n\t\tgroups--;\n\t}*/\n\n\treturn output;\n}\n\n\n/**\n * Truncate a string. Tries to intelligently break the string in white-space\n * if possible, without back-tracking. The returned string can be up to\n * `ellipsis.length + target + overage` characters long.\n * @param input The string to truncate.\n * @param target The target length for the result\n * @param overage Accept up to this many additional characters for a better result\n * @param ellipsis The string to append when truncating\n * @param break_line If true, attempt to break at the first LF\n * @param trim If true, runs trim() on the string before truncating\n * @returns The truncated string\n */\nexport function truncate(\n\tinput: string,\n\ttarget: number = 100,\n\toverage: number = 15,\n\tellipsis: string = '…',\n\tbreak_line: boolean = true,\n\ttrim: boolean = true\n) {\n\tif ( ! input || ! input.length )\n\t\treturn input;\n\n\tif ( trim )\n\t\tinput = input.trim();\n\n\tlet idx = break_line ? input.indexOf('\\n') : -1;\n\tif ( idx === -1 || idx > target )\n\t\tidx = target;\n\n\tif ( input.length <= idx )\n\t\treturn input;\n\n\tlet out = input.slice(0, idx).trimEnd();\n\tif ( overage > 0 && out.length >= idx ) {\n\t\tlet next_space = input.slice(idx).search(/\\s+/);\n\t\tif ( next_space === -1 && overage + idx > input.length )\n\t\t\tnext_space = input.length - idx;\n\n\t\tif ( next_space !== -1 && next_space <= overage ) {\n\t\t\tif ( input.length <= (idx + next_space) )\n\t\t\t\treturn input;\n\n\t\t\tout = input.slice(0, idx + next_space);\n\t\t}\n\t}\n\n\treturn out + ellipsis;\n}\n\n\n/**\n * Convert a number into a hexidecimal string, ensuring that the resulting\n * string is at least two characters.\n *\n * @param input The number to convert.\n */\nfunction decimalToHex(input: number) {\n\treturn input.toString(16).padStart(2, '0')\n}\n\n/**\n * Generate a random hexadecimal string of a given length. This uses\n * {@link crypto.getRandomValues} to generate randomness.\n *\n * @param length The desired string length.\n */\nexport function generateHex(length: number = 40) {\n\tconst arr = new Uint8Array(length / 2);\n\twindow.crypto.getRandomValues(arr);\n\treturn Array.from(arr, decimalToHex).join('')\n}\n\n\nexport type StringSortFn = (first: string, second: string) => number;\n\n/**\n * SourcedSet is similar to a Set, except that entries in the set are kept\n * track of based upon a `source`. This allows entries from a specific source\n * to be modified or removed without affecting entries added by other\n * sources.\n *\n * Note that this does **not** have the same API surface as a normal Set\n * and it should not be treated as such.\n *\n * This is used internally when tracking things like what emote sets or badges\n * are available in user and room contexts, with the `source` values being\n * the add-ons manipulating the data.\n *\n * @param T The type of object to hold.\n */\nexport class SourcedSet<T> {\n\n\tprivate _use_set: boolean;\n\n\t/**\n\t * The internal store used by the SourcedSet to hold its current state.\n\t * Depending on the value of `use_set` when you created the SourcedSet,\n\t * this may be either a Set or an array. This can be accessed directly\n\t * for better performance or iteration, but it should not be\n\t * modified directly.\n\t */\n\t_cache: Set<T> | T[];\n\n\tprivate _sources?: Map<string, T[]>;\n\tprivate _sorted_sources?: T[][] | null;\n\n\tprivate _sourceSortFn?: StringSortFn | null;\n\n\t/**\n\t * Create a new SourcedSet.\n\t *\n\t * @param use_set If this is set to true, use Set instances for holding\n\t * data, otherwise use arrays.\n\t *\n\t * @param T The type of object to hold.\n\t */\n\tconstructor(use_set = false, source_sorter?: StringSortFn) {\n\t\tthis._use_set = use_set;\n\t\tthis._cache = use_set ? new Set<T>() : [];\n\t\tthis._sourceSortFn = source_sorter;\n\t}\n\n\n\tresortSources() {\n\t\tthis._sorted_sources = null;\n\n\t\t// We don't need to rebuild if we have less than 2 sources\n\t\t// since sorting wouldn't change anything.\n\t\tif (this._sources && this._sources.size > 1)\n\t\t\tthis._rebuild();\n\t}\n\n\n\tsetSortFunction(fn: StringSortFn | null) {\n\t\t// If the method isn't changing, then we don't need\n\t\t// to do anything.\n\t\tif (this._sourceSortFn === fn)\n\t\t\treturn;\n\n\t\t// Set the new sort function.\n\t\tthis._sourceSortFn = fn;\n\n\t\t// And re-sort.\n\t\tthis.resortSources();\n\t}\n\n\n\t_sortSources() {\n\t\tif (!this._sources || this._sources.size === 0) {\n\t\t\tthis._sorted_sources = [];\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._sources.size === 1 || !this._sourceSortFn) {\n\t\t\tthis._sorted_sources = [...this._sources.values()];\n\t\t\treturn;\n\t\t}\n\n\t\tconst sources = [...this._sources?.entries()];\n\t\tsources.sort((a, b) => this._sourceSortFn!(a[0], b[0]));\n\n\t\tthis._sorted_sources = sources.map(entry => entry[1]);\n\t}\n\n\t/**\n\t * Trigger a rebuild of the SourcedSet. You should not need to\n\t * call this manually.\n\t */\n\t_rebuild() {\n\t\tif ( ! this._sources )\n\t\t\treturn;\n\n\t\tconst use_set = this._use_set,\n\t\t\tcache = this._cache = use_set ? new Set<T>() : ([] as T[]);\n\n\t\tif (!this._sorted_sources)\n\t\t\tthis._sortSources();\n\n\t\tfor(const items of this._sorted_sources!)\n\t\t\tfor(const i of items)\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t}\n\n\t/** Get the values added by a specific source. */\n\tget(source: string) { return this._sources && this._sources.get(source) }\n\t/** Check to see if a specific source has any values. */\n\thas(source: string) { return this._sources ? this._sources.has(source) : false }\n\n\t*iterateSources() {\n\t\tif ( this._sources )\n\t\t\tfor(const entry of this._sources)\n\t\t\t\tyield entry;\n\t}\n\n\t/** Check to see if a specific source has a specific value. */\n\tsourceIncludes(source: string, value: T) {\n\t\tconst src = this._sources && this._sources.get(source);\n\t\treturn src && src.includes(value);\n\t}\n\n\t/** Check to see if the SourcedSet contains a value. */\n\tincludes(value: T) {\n\t\treturn this._use_set\n\t\t\t? (this._cache as Set<T>).has(value)\n\t\t\t: (this._cache as T[]).includes(value);\n\t}\n\n\t/** Delete a specific source from the set. */\n\tdelete(source: string) {\n\t\tif ( this._sources && this._sources.has(source) ) {\n\t\t\tthis._sources.delete(source);\n\t\t\tthis._sorted_sources = null;\n\t\t\tthis._rebuild();\n\t\t}\n\t}\n\n\t/** Add the provided items to a specific source. */\n\textend(source: string, ...items: T[]) {\n\t\tif ( ! this._sources )\n\t\t\tthis._sources = new Map;\n\n\t\tconst existing = this._sources.get(source);\n\t\tif ( existing ) {\n\t\t\t// If there are existing items, add our new items\n\t\t\t// to the existing array.\n\t\t\tfor(const item of items)\n\t\t\t\tif (! existing.includes(item))\n\t\t\t\t\texisting.push(item);\n\n\t\t} else {\n\t\t\t// If there aren't existing items, just insert our\n\t\t\t// array into the sources list. Also, clear the\n\t\t\t// sorted sources cache.\n\t\t\tthis._sources.set(source, items);\n\t\t\tthis._sorted_sources = null;\n\t\t}\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\t// If we need sorting, do a rebuild, otherwise go ahead\n\t\t// and add the items normally.\n\t\tif ( need_sorting )\n\t\t\tthis._rebuild();\n\t\telse {\n\t\t\tconst use_set = this._use_set,\n\t\t\t\tcache = this._cache;\n\n\t\t\tfor(const i of items) {\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Set a specific source's items to the provided items,\n\t * removing any previous data in the process.\n\t */\n\tset(source: string, items: T | T[]) {\n\t\tif ( ! Array.isArray(items) )\n\t\t\titems = [items];\n\n\t\t// If we have no items, just delete the source instead.\n\t\tif ( ! items.length )\n\t\t\treturn this.delete(source);\n\n\t\tif ( ! this._sources )\n\t\t\tthis._sources = new Map;\n\n\t\tconst existing = this._sources.has(source);\n\t\tthis._sources.set(source, items);\n\t\tthis._sorted_sources = null;\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\t// If we need sorting, or if we replaced an existing source,\n\t\t// then we need a rebuild. Otherwise, go ahead and add the\n\t\t// items normally.\n\t\tif ( existing || need_sorting )\n\t\t\tthis._rebuild();\n\t\telse {\n\t\t\tconst use_set = this._use_set,\n\t\t\t\tcache = this._cache;\n\n\t\t\tfor(const i of items) {\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Add an item to a specific source. */\n\tpush(source: string, item: T) {\n\t\tif ( ! this._sources )\n\t\t\treturn this.set(source, item);\n\n\t\tconst existing = this._sources.get(source);\n\t\tif ( ! existing?.length )\n\t\t\treturn this.set(source, item);\n\n\t\telse if ( existing.includes(item) )\n\t\t\treturn;\n\n\t\texisting.push(item);\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\tif ( need_sorting )\n\t\t\tthis._rebuild();\n\t\telse if ( this._use_set )\n\t\t\t(this._cache as Set<T>).add(item);\n\t\telse if ( ! (this._cache as T[]).includes(item) )\n\t\t\t(this._cache as T[]).push(item);\n\t}\n\n\t/** Remove an item from a specific source. */\n\tremove(source: string, item: T) {\n\t\tif ( ! this._sources || ! this._sources.has(source) )\n\t\t\treturn;\n\n\t\tconst existing = this._sources.get(source),\n\t\t\tidx = existing ? existing.indexOf(item) : -1;\n\n\t\tif ( idx === -1 )\n\t\t\treturn;\n\n\t\t(existing as T[]).splice(idx, 1);\n\n\t\t// Removal always requires a rebuild.\n\t\tthis._rebuild();\n\t}\n}\n\n\n/**\n * Decode a base-64 input string into an ArrayBuffer.\n *\n * @param input The string to convert.\n */\nexport function b64ToArrayBuffer(input: string) {\n\tconst bin = atob(input),\n\t\tlen = bin.length,\n\t\tbuffer = new ArrayBuffer(len),\n\t\tview = new Uint8Array(buffer);\n\n\tfor(let i = 0, len = bin.length; i < len; i++)\n\t\tview[i] = bin.charCodeAt(i);\n\n\treturn buffer;\n}\n\n\nconst PEM_HEADER = /-----BEGIN (.+?) KEY-----/,\n\tPEM_FOOTER = /-----END (.+?) KEY-----/;\n\n/**\n * Import an RSA key that is using PEM encoding. This method will determine\n * if the key is a private key or not by searching the PEM header for\n * the string \"PRIVATE\" (case insensitive).\n *\n * If the key is a private key, it will be imported using PKCS8. If it\n * is a public key, it will be imported using SPKI.\n *\n * This uses {@link crypto.subtle.importKey} and is intended for use with\n * the Pub/Sub experiment's message signing feature.\n *\n * @param pem The certificate to import\n * @param uses The uses we will perform with this key\n */\nexport function importRsaKey(pem: string, uses: KeyUsage[] = ['verify']) {\n\tconst start_match = PEM_HEADER.exec(pem),\n\t\tend_match = PEM_FOOTER.exec(pem);\n\n\tif ( ! start_match || ! end_match || start_match[1] !== end_match[1] )\n\t\tthrow new Error('invalid key');\n\n\tconst is_private = /\\bPRIVATE\\b/i.test(start_match[1]),\n\t\tstart = start_match.index + start_match[0].length,\n\t\tend = end_match.index;\n\n\tconst content = pem.slice(start, end).replace(/\\n/g, '').trim();\n\t//console.debug('content', JSON.stringify(content));\n\n\tconst buffer = b64ToArrayBuffer(content);\n\n\treturn crypto.subtle.importKey(\n\t\tis_private ? 'pkcs8' : 'spki',\n\t\tbuffer,\n\t\t{\n\t\t\tname: \"RSA-PSS\",\n\t\t\thash: \"SHA-256\"\n\t\t},\n\t\ttrue,\n\t\tuses\n\t);\n}\n\n/**\n * Perform a {@link fetch} request, and return the response JSON if\n * the request is okay, or else return `null`.\n *\n * @param url The URL to fetch\n * @param init The optional parameters to provide to fetch, if any\n * @param error_value A value to return if an error is caught,\n * defaults to `null`.\n */\nexport function fetchJSON<T>(\n\turl: URL | string,\n\tinit?: RequestInit,\n\terror_value: T | null = null\n) {\n\treturn fetch(url, init)\n\t\t.then(resp => resp.ok ? resp.json() as Promise<T> : null)\n\t\t.catch(() => error_value);\n}\n","'use strict';\n\nexport function parse(path: string) {\n\treturn parseAST({\n\t\tpath,\n\t\ti: 0\n\t});\n}\n\ntype ParseContext = {\n\tpath: string;\n\ti: number;\n}\n\nexport type PathNode = {\n\ttitle: string;\n\tkey: string;\n\tpage?: boolean;\n\ttab?: boolean;\n}\n\nfunction parseAST(ctx: ParseContext) {\n\tconst path = ctx.path,\n\t\tlength = path.length,\n\t\tout = [];\n\n\tlet token: PathNode | null = null,\n\t\traw: string | null = null;\n\n\tlet old_tab = false,\n\t\told_page = false;\n\n\twhile ( ctx.i < length ) {\n\t\tconst start = ctx.i,\n\t\t\tchar = path[start],\n\t\t\tnext = path[start + 1];\n\n\t\tif ( ! token )\n\t\t\ttoken = {} as PathNode;\n\n\t\tif ( ! raw )\n\t\t\traw = '';\n\n\t\t// JSON\n\t\tif ( char === '@' && next === '{') {\n\t\t\tctx.i++;\n\t\t\tconst tag = parseJSON(ctx);\n\t\t\tif ( tag )\n\t\t\t\tObject.assign(token, tag);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Segment End?\n\t\tconst tab = char === `~` && next === '>',\n\t\t\tpage = char === '>' && next === '>',\n\t\t\tsegment = ! page && char === '>';\n\n\t\tif ( ! segment && ! page && ! tab ) {\n\t\t\traw += char;\n\t\t\tctx.i++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// We're at the end of a segment, so push\n\t\t// the token out.\n\t\tif ( tab || page )\n\t\t\tctx.i++;\n\n\t\ttoken.title = raw.trim();\n\t\ttoken.key = token.title.toSnakeCase();\n\n\t\ttoken.page = old_page;\n\t\ttoken.tab = old_tab;\n\n\t\told_page = page;\n\t\told_tab = tab;\n\n\t\tout.push(token);\n\t\ttoken = raw = null;\n\t\tctx.i++;\n\t}\n\n\tif ( token && raw ) {\n\t\ttoken.title = raw.trim();\n\t\ttoken.key = token.title.toSnakeCase();\n\t\ttoken.page = old_page;\n\t\ttoken.tab = old_tab;\n\t\tout.push(token);\n\t}\n\n\treturn out;\n}\n\nfunction parseJSON(ctx: ParseContext) {\n\tconst path = ctx.path,\n\t\tlength = path.length,\n\n\t\tstart = ctx.i;\n\n\tctx.i++;\n\n\tconst stack = ['{'];\n\tlet string: string | boolean = false;\n\n\twhile ( ctx.i < length && stack.length ) {\n\t\tconst start = ctx.i,\n\t\t\tchar = path[start];\n\n\t\tif ( string ) {\n\t\t\tif ( char === '\\\\' ) {\n\t\t\t\tctx.i++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( (char === '\"' || char === \"'\") && char === string ) {\n\t\t\t\tstack.pop();\n\t\t\t\tstring = false;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif ( char === '\"' || char === \"'\" ) {\n\t\t\t\tstring = char;\n\t\t\t\tstack.push(char);\n\t\t\t}\n\n\t\t\tif ( char === '{' || char === '[' )\n\t\t\t\tstack.push(char);\n\n\t\t\tif ( char === ']' ) {\n\t\t\t\tif ( stack.pop() !== '[' )\n\t\t\t\t\tthrow new SyntaxError('Invalid JSON');\n\t\t\t}\n\n\t\t\tif ( char === '}' ) {\n\t\t\t\tif ( stack.pop() !== '{' )\n\t\t\t\t\tthrow new SyntaxError('Invalid JSON');\n\t\t\t}\n\t\t}\n\n\t\tctx.i++;\n\t}\n\n\treturn JSON.parse(path.slice(start, ctx.i));\n}\n","\nexport function getBuster(resolution: number = 5) {\n\tconst now = Math.floor(Date.now() / 1000);\n\treturn now - (now % resolution);\n}\n\nexport function duration_to_string(\n\telapsed: number,\n\tseparate_days?: boolean,\n\tdays_only?: boolean,\n\tno_hours?: boolean,\n\tno_seconds?: boolean\n) {\n\tconst seconds = elapsed % 60;\n\tlet minutes = Math.floor(elapsed / 60),\n\t\thours = Math.floor(minutes / 60),\n\t\tdays = '';\n\n\tminutes = minutes % 60;\n\n\tif ( separate_days ) {\n\t\tconst day_count = Math.floor(hours / 24);\n\t\thours = hours % 24;\n\t\tif ( days_only && day_count > 0 )\n\t\t\treturn `${days} days`;\n\n\t\tdays = day_count > 0 ? `${day_count} days, ` : '';\n\t}\n\n\tconst show_hours = (no_hours === false || days?.length > 0 || hours > 0);\n\n\treturn `${days}${\n\t\tshow_hours ? `${days && hours < 10 ? '0' : ''}${hours}:` : ''\n\t}${show_hours && minutes < 10 ? '0' : ''}${minutes}${\n\t\tno_seconds ? '' : `:${seconds < 10 ? '0' : ''}${seconds}`}`;\n}\n\n\nexport function print_duration(seconds: number) {\n\tlet minutes = Math.floor(seconds / 60);\n\tconst hours = Math.floor(minutes / 60);\n\n\tminutes %= 60;\n\tseconds %= 60;\n\n\treturn `${hours > 0 ? `${hours}:${minutes < 10 ? '0' : ''}` : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;\n}\n\n\nexport function durationForChat(elapsed: number) {\n\tconst seconds = elapsed % 60;\n\tlet minutes = Math.floor(elapsed / 60);\n\tlet hours = Math.floor(minutes / 60);\n\tconst days = Math.floor(hours / 24);\n\n\tminutes = minutes % 60;\n\thours = hours % 24;\n\n\treturn `${days > 0 ? `${days}d` : ''}${hours > 0 ? `${hours}h` : ''}${minutes > 0 ? `${minutes}m` : ''}${seconds > 0 ? `${seconds}s` : ''}`;\n}\n\n\nexport function durationForURL(elapsed: number) {\n\tconst seconds = elapsed % 60;\n\tlet minutes = Math.floor(elapsed / 60);\n\tconst hours = Math.floor(minutes / 60);\n\n\tminutes = minutes % 60;\n\n\treturn `${hours > 0 ? `${hours}h` : ''}${minutes > 0 ? `${minutes}m` : ''}${seconds > 0 ? `${seconds}s` : ''}`;\n}\n","'use strict';\n\n// ============================================================================\n// Dynamic Tooltip Handling\n//\n// Better because you can assign arbitrary content.\n// Better because they are asynchronous with loading indication.\n// Better because they aren't hidden by parents with overflow: hidden;\n// ============================================================================\n\nimport {createElement, setChildren} from 'utilities/dom';\nimport {maybe_call, debounce, has} from 'utilities/object';\n\nimport {Instance, createPopper} from '@popperjs/core';\nimport type Logger from './logging';\nimport type { OptionallyCallable } from './types';\n\n// Extensions to things.\ndeclare global {\n\tinterface HTMLElement {\n\t\t_ffz_tooltip?: TooltipInstance | null;\n\n\t\t_ffz_move_handler?: MouseEventHandler | null;\n\t\t_ffz_over_handler?: MouseEventHandler | null;\n\t\t_ffz_out_handler?: MouseEventHandler | null;\n\t}\n}\n\nlet last_id = 0;\n\nexport const NoContent = Symbol('NoContent');\n\nexport const DefaultOptions = {\n\thtml: false,\n\tdelayShow: 0,\n\tdelayHide: 0,\n\n\tlive: true,\n\n\ttooltipClass: 'ffz__tooltip',\n\tinnerClass: 'ffz__tooltip--inner',\n\tarrowClass: 'ffz__tooltip--arrow'\n}\n\n\ntype TooltipOptional<TReturn> = OptionallyCallable<[target: HTMLElement, tip: TooltipInstance], TReturn>;\n\n\nexport type TooltipOptions = {\n\thtml: boolean;\n\tdelayShow: TooltipOptional<number>;\n\tdelayHide: TooltipOptional<number>;\n\tlive: boolean;\n\tmanual: boolean;\n\tcheck_modifiers: boolean;\n\n\tlogger?: Logger;\n\n\t// TODO: Replace this with proper i18n.\n\ti18n?: {\n\t\tt: (key: string, phrase: string, data: any) => string;\n\t};\n\n\tcontainer?: HTMLElement;\n\n\ttooltipClass: string;\n\tinnerClass: string;\n\tarrowClass: string;\n\tarrowInner?: string;\n\n\tsanitizeChildren: boolean;\n\n\tpopper?: any;\n\tpopperConfig?: TipFunction<any, [any]>;\n\n\tno_update?: boolean;\n\tno_auto_remove?: boolean;\n\n\tcontent: ContentFunction;\n\tinteractive: TooltipOptional<boolean>;\n\thover_events: TooltipOptional<boolean>;\n\n\tonShow: TipFunction<void>;\n\tonHide: TipFunction<void>;\n\n\tonMove: TipFunction<void, [MouseEvent]>;\n\tonHover: TipFunction<void, [MouseEvent]>;\n\tonLeave: TipFunction<void, [MouseEvent]>;\n\n}\n\n\nexport interface TooltipInstance {\n\n\ttarget: HTMLElement;\n\tvisible: boolean;\n\n\telement: HTMLElement | null;\n\touter: HTMLElement | null;\n\n\talign?: string;\n\tadd_class?: string | string[];\n\n\tstate: boolean;\n\t_show_timer?: ReturnType<typeof setTimeout> | null;\n\n\tpopper?: Instance | null;\n\n\t_update: () => void;\n\t_waiter: (() => void) | null;\n\t_wait_promise: Promise<void> | null;\n\n\twaitForDom: () => Promise<void>;\n\tupdate: () => void;\n\tshow: () => void;\n\thide: () => void;\n\trerender: () => void;\n\n}\n\n// TODO: Narrow the return type. Need better types for createElement / setChildren\ntype ContentFunction = TipFunction<any>;\n\ntype TipFunction<TReturn = unknown, TArgs extends any[] = []> = (target: HTMLElement, tip: TooltipInstance, ...extra: TArgs) => TReturn;\n\n\ntype MouseEventHandler = (event: MouseEvent) => void;\ntype KeyboardEventHandler = (event: KeyboardEvent) => void;\n\n// ============================================================================\n// Tooltip Class\n// ============================================================================\n\nexport class Tooltip {\n\n\tcls: Element | Element[] | string;\n\n\toptions: TooltipOptions;\n\tlive: boolean;\n\n\tparent: HTMLElement;\n\tcontainer: HTMLElement;\n\telements: Set<HTMLElement>;\n\n\tprivate _accessor: string;\n\n\tprivate _onMouseOut: MouseEventHandler;\n\tprivate _onMouseOver?: MouseEventHandler;\n\tprivate _keyUpdate?: KeyboardEventHandler | null;\n\n\tshift_state: boolean = false;\n\tctrl_state: boolean = false;\n\n\tprivate _shift_af?: ReturnType<typeof requestAnimationFrame> | null;\n\n\n\tconstructor(parent: HTMLElement | string | null, cls: HTMLElement | HTMLElement[] | string, options: Partial<TooltipOptions>) {\n\t\tif ( typeof parent === 'string' )\n\t\t\tparent = document.querySelector(parent) as HTMLElement;\n\n\t\tif (!( parent instanceof HTMLElement ))\n\t\t\tthrow new TypeError('invalid parent');\n\n\t\tthis.options = Object.assign({}, DefaultOptions, options) as TooltipOptions;\n\t\tthis.live = this.options.live;\n\n\t\tthis.parent = parent;\n\t\tthis.container = this.options.container || this.parent;\n\t\tthis.cls = cls;\n\n\t\tif ( this.options.check_modifiers )\n\t\t\tthis.installModifiers();\n\n\t\tif ( ! this.live ) {\n\t\t\tlet elements;\n\t\t\tif ( typeof cls === 'string' )\n\t\t\t\telements = Array.from(parent.querySelectorAll(cls)) as HTMLElement[];\n\t\t\telse if ( Array.isArray(cls) )\n\t\t\t\telements = cls;\n\t\t\telse if ( cls instanceof HTMLElement )\n\t\t\t\telements = [cls];\n\t\t\telse\n\t\t\t\tthrow new TypeError('invalid elements');\n\n\t\t\tthis.elements = new Set(elements);\n\n\t\t} else {\n\t\t\tthis.cls = cls;\n\t\t\tthis.elements = new Set;\n\t\t}\n\n\t\tthis._accessor = `_ffz_tooltip$${last_id++}`;\n\n\t\tthis._onMouseOut = e => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif ( target && target.dataset?.forceOpen !== 'true' )\n\t\t\t\treturn this._exit(target);\n\t\t};\n\n\t\tif ( this.options.manual ) {\n\t\t\t// Do nothing~!\n\n\t\t} else if ( this.live ) {\n\t\t\tthis._onMouseOver = e => {\n\t\t\t\tthis.updateShift(e.shiftKey, e.ctrlKey);\n\t\t\t\tconst target = e.target as HTMLElement;\n\t\t\t\tif ( target && target.classList && target.classList.contains(this.cls as string) && target.dataset?.forceOpen !== 'true' ) {\n\t\t\t\t\tthis._enter(target);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tparent.addEventListener('mouseover', this._onMouseOver);\n\t\t\tparent.addEventListener('mouseout', this._onMouseOut);\n\n\t\t} else {\n\t\t\tthis._onMouseOver = e => {\n\t\t\t\tthis.updateShift(e.shiftKey, e.ctrlKey);\n\t\t\t\tconst target = e.target as HTMLElement;\n\t\t\t\tif ( this.elements.has(target) && target.dataset.forceOpen !== 'true' )\n\t\t\t\t\tthis._enter(target);\n\t\t\t}\n\n\t\t\tif ( this.elements.size <= 5 )\n\t\t\t\tfor(const el of this.elements) {\n\t\t\t\t\tel.addEventListener('mouseenter', this._onMouseOver);\n\t\t\t\t\tel.addEventListener('mouseleave', this._onMouseOut);\n\t\t\t\t}\n\n\t\t\telse {\n\t\t\t\tparent.addEventListener('mouseover', this._onMouseOver);\n\t\t\t\tparent.addEventListener('mouseout', this._onMouseOut);\n\t\t\t}\n\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis.removeModifiers();\n\n\t\tif ( this.options.manual ) {\n\t\t\t// Do nothing~!\n\t\t} else if ( this.live || this.elements.size > 5 ) {\n\t\t\tif ( this._onMouseOver )\n\t\t\t\tthis.parent.removeEventListener('mouseover', this._onMouseOver);\n\t\t\tthis.parent.removeEventListener('mouseout', this._onMouseOut);\n\t\t} else\n\t\t\tfor(const el of this.elements) {\n\t\t\t\tif ( this._onMouseOver )\n\t\t\t\t\tel.removeEventListener('mouseenter', this._onMouseOver);\n\t\t\t\tel.removeEventListener('mouseleave', this._onMouseOut);\n\t\t\t}\n\n\t\tfor(const el of this.elements) {\n\t\t\tconst tip = (el as any)[this._accessor] as TooltipInstance;\n\t\t\tif ( tip && tip.visible )\n\t\t\t\tthis.hide(tip);\n\n\t\t\t(el as any)[this._accessor] = null;\n\t\t\tel._ffz_tooltip = null;\n\t\t}\n\n\t\t// Lazy types. We don't care.\n\t\tthis.elements = null as any;\n\t\tthis._onMouseOut = this._onMouseOver = null as any;\n\t\tthis.container = null as any;\n\t\tthis.parent = null as any;\n\t}\n\n\n\tinstallModifiers() {\n\t\tif ( this._keyUpdate )\n\t\t\treturn;\n\n\t\tthis._keyUpdate = e => this.updateShift(e.shiftKey, e.ctrlKey);\n\t\twindow.addEventListener('keydown', this._keyUpdate);\n\t\twindow.addEventListener('keyup', this._keyUpdate);\n\t}\n\n\tremoveModifiers() {\n\t\tif ( ! this._keyUpdate )\n\t\t\treturn;\n\n\t\twindow.removeEventListener('keydown', this._keyUpdate);\n\t\twindow.removeEventListener('keyup', this._keyUpdate);\n\t\tthis._keyUpdate = null;\n\t}\n\n\tupdateShift(state: boolean, ctrl_state: boolean) {\n\t\tif ( state === this.shift_state && ctrl_state === this.ctrl_state )\n\t\t\treturn;\n\n\t\tthis.shift_state = state;\n\t\tthis.ctrl_state = ctrl_state;\n\n\t\tif ( ! this._shift_af )\n\t\t\tthis._shift_af = requestAnimationFrame(() => {\n\t\t\t\tthis._shift_af = null;\n\t\t\t\tif ( this.elements )\n\t\t\t\t\tfor(const el of this.elements) {\n\t\t\t\t\t\tconst tip = (el as any)[this._accessor] as TooltipInstance;\n\t\t\t\t\t\tif ( tip && tip.outer ) {\n\t\t\t\t\t\t\ttip.outer.dataset.shift = `${this.shift_state}`;\n\t\t\t\t\t\t\ttip.outer.dataset.ctrl = `${this.ctrl_state}`;\n\t\t\t\t\t\t\ttip.update();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t});\n\t}\n\n\n\tcleanup() {\n\t\tif ( this.options.manual || ! this.elements )\n\t\t\treturn;\n\n\t\tfor(const el of this.elements) {\n\t\t\tconst tip = (el as any)[this._accessor] as TooltipInstance;\n\t\t\tif ( document.body.contains(el) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( tip && tip.visible )\n\t\t\t\tthis.hide(tip);\n\t\t}\n\t}\n\n\n\t_enter(target: HTMLElement) {\n\t\tlet tip = (target as any)[this._accessor] as TooltipInstance;\n\t\tif ( ! tip )\n\t\t\ttip = (target as any)[this._accessor] = {target} as TooltipInstance;\n\n\t\ttip.state = true;\n\n\t\tif ( tip._show_timer ) {\n\t\t\tclearTimeout(tip._show_timer);\n\t\t\ttip._show_timer = null;\n\t\t}\n\n\t\tif ( tip.visible )\n\t\t\treturn;\n\n\t\tconst delay = maybe_call(this.options.delayShow, null, target, tip);\n\n\t\tif ( delay === 0 )\n\t\t\tthis.show(tip);\n\n\t\telse\n\t\t\ttip._show_timer = setTimeout(() => {\n\t\t\t\ttip._show_timer = null;\n\t\t\t\tif ( tip.state )\n\t\t\t\t\tthis.show(tip);\n\t\t\t}, delay);\n\t}\n\n\t_exit(target: HTMLElement) {\n\t\tconst tip = (target as any)[this._accessor] as TooltipInstance;\n\t\tif ( ! tip )\n\t\t\treturn;\n\n\t\ttip.state = false;\n\n\t\tif ( tip._show_timer ) {\n\t\t\tclearTimeout(tip._show_timer);\n\t\t\ttip._show_timer = null;\n\t\t}\n\n\t\tif ( ! tip.visible )\n\t\t\treturn;\n\n\t\tconst delay = maybe_call(this.options.delayHide, null, target, tip);\n\n\t\tif ( delay === 0 )\n\t\t\tthis.hide(tip);\n\n\t\telse\n\t\t\ttip._show_timer = setTimeout(() => {\n\t\t\t\ttip._show_timer = null;\n\t\t\t\tif ( ! tip.state )\n\t\t\t\t\tthis.hide(tip);\n\n\t\t\t}, delay);\n\t}\n\n\n\tshow(tip: TooltipInstance) {\n\t\tconst opts = this.options,\n\t\t\ttarget = tip.target;\n\n\t\tthis.elements.add(target);\n\t\ttarget._ffz_tooltip = tip;\n\n\t\t// Set this early in case content uses it early.\n\t\ttip._wait_promise = null;\n\t\ttip.waitForDom = () => {\n\t\t\tif ( tip.element )\n\t\t\t\treturn Promise.resolve();\n\t\t\tif ( ! tip._wait_promise )\n\t\t\t\ttip._wait_promise = new Promise(resolve => tip._waiter = resolve);\n\t\t\treturn tip._wait_promise;\n\t\t};\n\t\ttip.update = () => tip._update(); // tip.popper && tip.popper.scheduleUpdate();\n\t\ttip.show = () => {\n\t\t\tlet tip = (target as any)[this._accessor] as TooltipInstance;\n\t\t\tif ( ! tip )\n\t\t\t\ttip = (target as any)[this._accessor] = {target} as TooltipInstance;\n\t\t\tthis.show(tip);\n\t\t};\n\t\ttip.hide = () => this.hide(tip);\n\t\ttip.rerender = () => {\n\t\t\tif ( tip.visible ) {\n\t\t\t\ttip.hide();\n\t\t\t\ttip.show();\n\t\t\t}\n\t\t};\n\n\t\tlet content = maybe_call(opts.content, null, target, tip);\n\t\tif ( content === undefined )\n\t\t\tcontent = tip.target.title;\n\n\t\tif ( tip.visible || content === NoContent || (! content && ! opts.onShow) )\n\t\t\treturn;\n\n\t\t// Build the DOM.\n\t\tconst arrow = createElement('div', {\n\t\t\tclassName: opts.arrowClass,\n\t\t\t'x-arrow': true\n\t\t}),\n\t\t\tinner = tip.element = createElement('div', opts.innerClass),\n\n\t\t\tel = tip.outer = createElement('div', {\n\t\t\t\tclassName: opts.tooltipClass,\n\t\t\t\t'data-shift': this.shift_state,\n\t\t\t\t'data-ctrl': this.ctrl_state\n\t\t\t}, [inner, arrow]);\n\n\t\tif ( opts.arrowInner )\n\t\t\tarrow.appendChild(createElement('div', opts.arrowInner));\n\n\t\tif ( tip.align )\n\t\t\tinner.classList.add(`${opts.innerClass}--align-${tip.align}`);\n\n\t\tif ( tip.add_class ) {\n\t\t\tfor(const cls of Array.isArray(tip.add_class) ? tip.add_class : [tip.add_class])\n\t\t\t\tinner.classList.add(cls);\n\t\t\ttip.add_class = undefined;\n\t\t}\n\n\t\tconst interactive = maybe_call(opts.interactive, null, target, tip),\n\t\t\thover_events = maybe_call(opts.hover_events, null, target, tip);\n\n\t\tel.classList.toggle('interactive', interactive || false);\n\n\t\tif ( ! opts.manual || (hover_events && (opts.onHover || opts.onLeave || opts.onMove)) ) {\n\t\t\tif ( hover_events && opts.onMove )\n\t\t\t\tel.addEventListener('mousemove', el._ffz_move_handler = event => {\n\t\t\t\t\tthis.updateShift(event.shiftKey, event.ctrlKey);\n\t\t\t\t\topts.onMove(target, tip, event);\n\t\t\t\t});\n\n\t\t\tel.addEventListener('mouseover', el._ffz_over_handler = event => {\n\t\t\t\tif ( ! opts.no_auto_remove && ! document.contains(target) )\n\t\t\t\t\tthis.hide(tip);\n\n\t\t\t\tif ( hover_events && opts.onHover )\n\t\t\t\t\topts.onHover(target, tip, event);\n\n\t\t\t\tif ( opts.manual ) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t} else if ( maybe_call(opts.interactive, null, target, tip) )\n\t\t\t\t\tthis._enter(target);\n\t\t\t\telse if ( target.dataset.forceOpen !== 'true' )\n\t\t\t\t\tthis._exit(target);\n\t\t\t});\n\n\t\t\tel.addEventListener('mouseout', el._ffz_out_handler = event => {\n\t\t\t\tif ( hover_events && opts.onLeave )\n\t\t\t\t\topts.onLeave(target, tip, event);\n\n\t\t\t\tif ( ! opts.manual && target.dataset.forceOpen !== 'true' )\n\t\t\t\t\tthis._exit(target);\n\t\t\t});\n\t\t}\n\n\t\t// Assign our content. If there's a Promise, we'll need\n\t\t// to do this weirdly.\n\t\tconst use_html = maybe_call(opts.html, null, target, tip),\n\t\t\tsetter = use_html ? 'innerHTML' : 'textContent';\n\n\t\tconst modifiers = {\n\t\t\tflip: {\n\t\t\t\tbehavior: ['top', 'bottom', 'left', 'right']\n\t\t\t},\n\t\t\toffset: {\n\t\t\t\toffset: [0, 10]\n\t\t\t},\n\t\t\tarrow: {\n\t\t\t\telement: arrow\n\t\t\t}\n\t\t};\n\n\t\tlet pop_opts = Object.assign({\n\t\t\tmodifiers\n\t\t}, opts.popper);\n\n\t\tpop_opts.modifiers = Object.assign(modifiers, pop_opts.modifiers);\n\n\t\tif ( opts.popperConfig )\n\t\t\tpop_opts = opts.popperConfig(target, tip, pop_opts) ?? pop_opts;\n\n\t\tpop_opts.onUpdate = debounce(() => {\n\t\t\tif ( ! opts.no_auto_remove && ! document.contains(tip.target) )\n\t\t\t\tthis.hide(tip);\n\t\t}, 250);\n\n\t\tlet popper_target: any = target;\n\t\tif ( opts.no_update )\n\t\t\tpopper_target = makeReference(target);\n\n\t\ttip._update = () => {\n\t\t\tif ( tip.popper ) {\n\t\t\t\ttip.popper.forceUpdate();\n\t\t\t}\n\t\t}\n\n\t\tif ( tip._waiter )\n\t\t\ttip._waiter();\n\n\t\ttip._waiter = null;\n\t\ttip._wait_promise = null;\n\n\t\tif ( content instanceof Promise ) { //} || (content?.then && content.toString() === '[object Promise]') ) {\n\t\t\tinner.innerHTML = '<div class=\"ffz-i-zreknarf loader\"></div>';\n\t\t\tcontent.then(content => {\n\t\t\t\tif ( ! content )\n\t\t\t\t\treturn this.hide(tip);\n\n\t\t\t\tif ( use_html && (content instanceof Node || Array.isArray(content)) ) {\n\t\t\t\t\tinner.innerHTML = '';\n\t\t\t\t\tsetChildren(inner, content, opts.sanitizeChildren);\n\t\t\t\t} else\n\t\t\t\t\tinner[setter] = content;\n\n\t\t\t\ttip._update();\n\n\t\t\t}).catch(err => {\n\t\t\t\tif ( this.options.logger )\n\t\t\t\t\tthis.options.logger.error('Error rendering tooltip content.', err);\n\n\t\t\t\tif ( this.options.i18n )\n\t\t\t\t\tinner.textContent = this.options.i18n.t('tooltip.render-error', 'There was an error rendering this tooltip.\\n{err}', {err});\n\t\t\t\telse\n\t\t\t\t\tinner.textContent = `There was an error rendering this tooltip.\\n${err}`;\n\t\t\t\ttip._update();\n\t\t\t});\n\n\t\t} else if ( content ) {\n\t\t\tif ( use_html && (content instanceof Node || Array.isArray(content)) )\n\t\t\t\tsetChildren(inner, content, opts.sanitizeChildren);\n\t\t\telse\n\t\t\t\tinner[setter] = content;\n\t\t}\n\n\t\t// Format the modifiers how Popper wants them now.\n\t\tpop_opts.modifiers = normalizeModifiers(pop_opts.modifiers);\n\n\t\t// Add everything to the DOM and create the Popper instance.\n\t\ttip.popper = createPopper(popper_target, el, pop_opts);\n\t\tthis.container.appendChild(el);\n\t\ttip.visible = true;\n\n\t\tif ( opts.onShow )\n\t\t\topts.onShow(target, tip);\n\t}\n\n\n\thide(tip: TooltipInstance) {\n\t\tconst opts = this.options;\n\t\tif ( opts.onHide )\n\t\t\topts.onHide(tip.target, tip);\n\n\t\tif ( tip.popper ) {\n\t\t\ttip.popper.destroy();\n\t\t\ttip.popper = null;\n\t\t}\n\n\t\tif ( tip.outer ) {\n\t\t\tconst el = tip.outer;\n\t\t\tif ( el._ffz_over_handler )\n\t\t\t\tel.removeEventListener('mouseover', el._ffz_over_handler);\n\n\t\t\tif ( el._ffz_out_handler )\n\t\t\t\tel.removeEventListener('mouseout', el._ffz_out_handler);\n\n\t\t\tif ( el._ffz_move_handler )\n\t\t\t\tel.removeEventListener('mousemove', el._ffz_move_handler);\n\n\t\t\tel.remove();\n\t\t\ttip.outer = el._ffz_out_handler = el._ffz_over_handler = null;\n\t\t}\n\n\t\tif ( this.live && this.elements )\n\t\t\tthis.elements.delete(tip.target);\n\n\t\tif ( tip.target._ffz_tooltip === tip )\n\t\t\ttip.target._ffz_tooltip = null;\n\n\t\t(tip.target as any)[this._accessor] = null;\n\t\ttip._update = tip.rerender = tip.update = noop;\n\t\ttip.element = null;\n\t\ttip.visible = false;\n\t}\n}\n\nexport default Tooltip;\n\n\n// Is this gross? Yes.\n// You know what else is gross?\n// Popper's type definitions.\nexport function normalizeModifiers(input: any) {\n\tconst output: any[] = [];\n\n\tfor(const [key, val] of Object.entries(input)) {\n\t\tconst thing: any = {\n\t\t\tname: key\n\t\t};\n\n\t\tif (val && typeof val === 'object' && ! Array.isArray(val)) {\n\t\t\tif (has(val, 'enabled'))\n\t\t\t\tthing.enabled = (val as any).enabled;\n\n\t\t\tconst keys = Object.keys(val);\n\t\t\tif (keys.length > 1 || (keys.length === 1 && keys[0] !== 'enabled'))\n\t\t\t\tthing.options = val;\n\t\t}\n\n\t\toutput.push(thing);\n\t}\n\n\treturn output;\n}\n\n\nexport function makeReference(x: HTMLElement | number, y?: number, height: number = 0, width: number = 0) {\n\tlet _x: number;\n\n\tif ( x instanceof HTMLElement ) {\n\t\tconst rect = x.getBoundingClientRect();\n\t\t_x = rect.x;\n\t\ty = rect.y;\n\t\theight = rect.height;\n\t\twidth = rect.width;\n\t} else\n\t\t_x = x;\n\n\tconst out = {\n\t\tgetBoundingClientRect: () => ({\n\t\t\ttop: y,\n\t\t\tbottom: (y as number) + height,\n\t\t\ty,\n\t\t\tleft: _x,\n\t\t\tright: _x + width,\n\t\t\tx,\n\t\t\theight,\n\t\t\twidth\n\t\t}),\n\t\tclientWidth: width,\n\t\tclientHeight: height\n\t};\n\n\treturn out;\n}\n\n\n// Function Intentionally Left Blank\nfunction noop() { }\n","'use strict';\n\n// ============================================================================\n// Imports\n// ============================================================================\n\nimport dayjs from 'dayjs';\nimport RelativeTime from 'dayjs/plugin/relativeTime';\n\nimport {get} from 'utilities/object';\nimport {duration_to_string} from 'utilities/time';\n\nimport Parser, { MessageAST, MessageNode, MessageVariable, ParserOptions } from '@ffz/icu-msgparser';\n\ndayjs.extend(RelativeTime);\n\nconst DEFAULT_PARSER_OPTIONS = {\n\tallowTags: false,\n\trequireOther: false\n} as Partial<ParserOptions>;\n\n\nexport type TypeFormatter = (this: TranslationCore, val: any, node: MessageVariable, locale: string, out: any[], ast: MessageAST, data: any) => any;\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport const DEFAULT_TYPES: Record<string, TypeFormatter> = {\n\ttostring(val) {\n\t\treturn `${val}`\n\t},\n\n\tselect(val, node, locale, out, ast, data) {\n\t\tconst sub_ast = node.o && (node.o[val] || node.o.other);\n\t\tif ( ! sub_ast )\n\t\t\treturn undefined;\n\n\t\treturn this._processAST(sub_ast, data, locale);\n\t},\n\n\tplural(val, node, locale, out, ast, data) {\n\t\tconst sub_ast = node.o && (node.o[`=${val}`] || node.o[getCardinalName(locale, val)] || node.o.other);\n\t\tif ( ! sub_ast )\n\t\t\treturn undefined;\n\n\t\treturn this._processAST(sub_ast, data, locale);\n\t},\n\n\tselectordinal(val, node, locale, out, ast, data) {\n\t\tconst sub_ast = node.o && (node.o[`=${val}`] || node.o[getOrdinalName(locale, val)] || node.o.other);\n\t\tif ( ! sub_ast )\n\t\t\treturn undefined;\n\n\t\treturn this._processAST(sub_ast, data, locale);\n\t},\n\n\tnumber(val, node) {\n\t\tif ( typeof val !== 'number' ) {\n\t\t\tlet new_val = parseFloat(val);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\tnew_val = parseInt(val, 10);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\treturn val;\n\n\t\t\tval = new_val;\n\t\t}\n\n\t\treturn this.formatNumber(val, node.f as string);\n\t},\n\n\tcurrency(val, node) {\n\t\tif ( typeof val !== 'number' ) {\n\t\t\tlet new_val = parseFloat(val);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\tnew_val = parseInt(val, 10);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\treturn val;\n\n\t\t\tval = new_val;\n\t\t}\n\n\t\treturn this.formatCurrency(val, node.f as string);\n\t},\n\n\tdate(val, node) {\n\t\treturn this.formatDate(val, node.f as string);\n\t},\n\n\ttime(val, node) {\n\t\treturn this.formatTime(val, node.f as string);\n\t},\n\n\tdatetime(val, node) {\n\t\treturn this.formatDateTime(val, node.f as string);\n\t},\n\n\tduration(val) {\n\t\treturn this.formatDuration(val);\n\t},\n\n\tlocalestring(val) {\n\t\treturn this.toLocaleString(val);\n\t},\n\n\trelativetime(val, node) {\n\t\treturn this.formatRelativeTime(val, node.f as string);\n\t},\n\n\thumantime(val, node) {\n\t\treturn this.formatRelativeTime(val, node.f as string);\n\t},\n\n\ten_plural: (v: number) => v !== 1 ? 's' : ''\n}\n\n\n\n\nexport const DEFAULT_FORMATS = {\n\tnumber: {\n\t\tcurrency: {\n\t\t\tstyle: 'currency'\n\t\t},\n\t\tpercent: {\n\t\t\tstyle: 'percent'\n\t\t},\n\t\tlong_percent: {\n\t\t\tstyle: 'percent',\n\t\t\tminimumFractionDigits: 2\n\t\t}\n\t},\n\n\tdate: {\n\t\tshort: {\n\t\t\tmonth: 'numeric',\n\t\t\tday: 'numeric',\n\t\t\tyear: '2-digit'\n\t\t},\n\n\t\tdefault: {},\n\n\t\tmedium: {\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t},\n\n\t\tlong: {\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t},\n\n\t\tfull: {\n\t\t\tweekday: 'long',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t}\n\t},\n\n\ttime: {\n\t\tshort: {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric'\n\t\t},\n\n\t\tmedium: {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric'\n\t\t},\n\n\t\tfull: {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric',\n\t\t\ttimeZoneName: 'short'\n\t\t}\n\t},\n\n\tdatetime: {\n\t\tshort: {\n\t\t\tmonth: 'numeric',\n\t\t\tday: 'numeric',\n\t\t\tyear: '2-digit',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric'\n\t\t},\n\n\t\tmedium: {},\n\n\t\tlong: {\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric',\n\t\t\ttimeZoneName: 'short'\n\t\t},\n\n\t\tfull: {\n\t\t\tweekday: 'long',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric',\n\t\t\ttimeZoneName: 'short'\n\t\t}\n\t}\n} as FormattingOptions;\n\n\n// ============================================================================\n// Options\n// ============================================================================\n\ntype WarningMethod = typeof console.warn;\n\ntype RecursivePhraseMap = {\n\t[key: string]: RecursivePhraseMap | string\n};\n\n\nexport type FormattingOptions = {\n\tnumber: Record<string, Intl.NumberFormatOptions>,\n\tdate: Record<string, Intl.DateTimeFormatOptions>,\n\ttime: Record<string, Intl.DateTimeFormatOptions>,\n\tdatetime: Record<string, Intl.DateTimeFormatOptions>\n};\n\n\nexport type TranslationOptions = {\n\twarn?: WarningMethod;\n\n\tlocale?: string;\n\tdayjsLocale?: string;\n\tdefaultLocale?: string;\n\n\ttypes?: Record<string, TypeFormatter>;\n\tformats?: Partial<FormattingOptions>;\n\tphrases?: RecursivePhraseMap;\n\n\tparserOptions?: Partial<ParserOptions>,\n\n\tdefaultDateFormat: string;\n\tdefaultTimeFormat: string;\n\tdefaultDateTimeFormat: string;\n}\n\nexport type ParseTranslationSettings = {\n\tnoCache?: boolean;\n\tthrowParse?: boolean;\n\tnoWarn?: boolean;\n}\n\n\n\n// ============================================================================\n// TranslationCore\n// ============================================================================\n\nexport class TranslationCore {\n\n\twarn?: WarningMethod;\n\n\tparser: Parser;\n\tphrases: Map<string, string>;\n\tcache: Map<string, MessageAST>;\n\n\ttransformation: ((key: string, ast: MessageAST) => MessageAST) | null;\n\n\ttypes: Record<string, TypeFormatter>;\n\tformats: FormattingOptions;\n\n\tprivate _locale: string;\n\tprivate _dayjs_locale: string;\n\n\tdefaultLocale: string;\n\tdefaultDateFormat: string;\n\tdefaultTimeFormat: string;\n\tdefaultDateTimeFormat: string;\n\n\tnumberFormats: Map<string, Intl.NumberFormat>;\n\tcurrencyFormats: Map<string, Intl.NumberFormat>;\n\n\tconstructor(options?: Partial<TranslationOptions>) {\n\t\toptions = options || {};\n\n\t\tthis.warn = options.warn;\n\t\tthis._locale = options.locale || 'en';\n\t\tthis._dayjs_locale = options.dayjsLocale || 'en';\n\t\tthis.defaultLocale = options.defaultLocale || this._locale;\n\t\tthis.transformation = null;\n\n\t\tthis.defaultDateFormat = options.defaultDateFormat ?? 'default';\n\t\tthis.defaultTimeFormat = options.defaultTimeFormat ?? 'short';\n\t\tthis.defaultDateTimeFormat = options.defaultDateTimeFormat ?? 'medium';\n\n\t\tthis.phrases = new Map;\n\t\tthis.cache = new Map;\n\n\t\tthis.numberFormats = new Map;\n\t\tthis.currencyFormats = new Map;\n\n\t\tthis.formats = Object.assign({}, DEFAULT_FORMATS);\n\t\tif ( options.formats ) {\n\t\t\t// I have no idea why the types are so picky here.\n\t\t\tconst keys = Object.keys(options.formats) as (keyof FormattingOptions)[];\n\t\t\tfor(const key of keys)\n\t\t\t\t(this.formats as any)[key] = Object.assign({}, this.formats[key], options.formats[key]);\n\t\t}\n\n\t\tthis.types = Object.assign({}, DEFAULT_TYPES, options.types || {});\n\t\tthis.parser = new Parser(Object.assign({}, DEFAULT_PARSER_OPTIONS, options.parserOptions));\n\n\t\tif ( options.phrases )\n\t\t\tthis.extend(options.phrases);\n\t}\n\n\tget locale() {\n\t\treturn this._locale;\n\t}\n\n\tset locale(val) {\n\t\tif ( val !== this._locale ) {\n\t\t\tthis._locale = val;\n\t\t\tthis.numberFormats.clear();\n\t\t\tthis.currencyFormats.clear();\n\t\t}\n\t}\n\n\ttoLocaleString(thing: any) {\n\t\tif ( thing?.toLocaleString )\n\t\t\treturn thing.toLocaleString(this._locale) as string;\n\t\telse if ( typeof thing !== 'string' )\n\t\t\treturn `${thing}`;\n\t\treturn thing;\n\t}\n\n\tformatRelativeTime(value: string | number | Date, format?: string) { // eslint-disable-line class-methods-use-this\n\t\tconst d = dayjs(value),\n\t\t\twithout_suffix = format === 'plain';\n\n\t\ttry {\n\t\t\treturn d.locale(this._dayjs_locale).fromNow(without_suffix);\n\t\t} catch(err) {\n\t\t\treturn d.fromNow(without_suffix);\n\t\t}\n\t}\n\n\tformatCurrency(value: number | bigint, currency: string) {\n\t\tlet formatter = this.currencyFormats.get(currency);\n\t\tif ( ! formatter ) {\n\t\t\tformatter = new Intl.NumberFormat(navigator.languages as string[], {\n\t\t\t\tstyle: 'currency',\n\t\t\t\tcurrency\n\t\t\t});\n\n\t\t\tthis.currencyFormats.set(currency, formatter);\n\t\t}\n\n\t\treturn formatter.format(value);\n\t}\n\n\tformatNumber(value: number | bigint, format: string) {\n\t\tlet formatter = this.numberFormats.get(format);\n\t\tif ( ! formatter ) {\n\t\t\tif ( this.formats.number[format] )\n\t\t\t\tformatter = new Intl.NumberFormat(this.locale, this.formats.number[format]);\n\t\t\telse if ( typeof format === 'number' )\n\t\t\t\tformatter = new Intl.NumberFormat(this.locale, {\n\t\t\t\t\tminimumFractionDigits: format,\n\t\t\t\t\tmaximumFractionDigits: format\n\t\t\t\t});\n\t\t\telse\n\t\t\t\tformatter = new Intl.NumberFormat(this.locale);\n\n\t\t\tthis.numberFormats.set(format, formatter);\n\t\t}\n\n\t\treturn formatter.format(value);\n\t}\n\n\tformatDuration(value: number) { // eslint-disable-line class-methods-use-this\n\t\treturn duration_to_string(value);\n\t}\n\n\tformatDate(value: string | number | Date, format?: string) {\n\t\tif ( ! format )\n\t\t\tformat = this.defaultDateFormat;\n\n\t\tif ( format && ! this.formats.date[format] ) {\n\t\t\tconst d = dayjs(value);\n\t\t\ttry {\n\t\t\t\treturn d.locale(this._dayjs_locale).format(format);\n\t\t\t} catch(err) {\n\t\t\t\treturn d.format(format);\n\t\t\t}\n\t\t}\n\n\t\tif ( !(value instanceof Date) )\n\t\t\tvalue = new Date(value);\n\n\t\treturn value.toLocaleDateString(this._locale, this.formats.date[format] || {});\n\t}\n\n\tformatTime(value: string | number | Date, format?: string) {\n\t\tif ( ! format )\n\t\t\tformat = this.defaultTimeFormat;\n\n\t\tif ( format && ! this.formats.time[format] ) {\n\t\t\tconst d = dayjs(value);\n\t\t\ttry {\n\t\t\t\treturn d.locale(this._dayjs_locale).format(format);\n\t\t\t} catch(err) {\n\t\t\t\treturn d.format(format);\n\t\t\t}\n\t\t}\n\n\t\tif ( !(value instanceof Date) )\n\t\t\tvalue = new Date(value);\n\n\t\treturn value.toLocaleTimeString(this._locale, this.formats.time[format] || {});\n\t}\n\n\tformatDateTime(value: string | number | Date, format?: string) {\n\t\tif ( ! format )\n\t\t\tformat = this.defaultDateTimeFormat;\n\n\t\tif ( format && ! this.formats.datetime[format] ) {\n\t\t\tconst d = dayjs(value);\n\t\t\ttry {\n\t\t\t\treturn d.locale(this._dayjs_locale).format(format);\n\t\t\t} catch(err) {\n\t\t\t\treturn d.format(format);\n\t\t\t}\n\t\t}\n\n\t\tif ( !(value instanceof Date) )\n\t\t\tvalue = new Date(value);\n\n\t\treturn value.toLocaleString(this._locale, this.formats.datetime[format] || {});\n\t}\n\n\textend(phrases: RecursivePhraseMap, prefix?: string) {\n\t\tconst added: string[] = [];\n\t\tif ( ! phrases || typeof phrases !== 'object' )\n\t\t\treturn added;\n\n\t\tfor(const key of Object.keys(phrases)) {\n\t\t\tconst full_key = prefix ? key === '_' ? prefix : `${prefix}.${key}` : key,\n\t\t\t\tphrase = phrases[key];\n\n\t\t\tif ( typeof phrase === 'object' )\n\t\t\t\tadded.push(...this.extend(phrase, full_key));\n\t\t\telse {\n\t\t\t\tlet parsed;\n\t\t\t\ttry {\n\t\t\t\t\tparsed = this.parser.parse(phrase);\n\t\t\t\t} catch(err) {\n\t\t\t\t\tif ( this.warn )\n\t\t\t\t\t\tthis.warn(`Error parsing i18n phrase for key \"${full_key}\": ${phrase}`, err);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.phrases.set(full_key, phrase);\n\t\t\t\tthis.cache.set(full_key, parsed);\n\t\t\t\tadded.push(full_key);\n\t\t\t}\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tunset(phrases: string | string[], prefix: string) {\n\t\tif ( typeof phrases === 'string' )\n\t\t\tphrases = [phrases];\n\n\t\tconst keys = Array.isArray(phrases) ? phrases : Object.keys(phrases);\n\t\tfor(const key of keys) {\n\t\t\tconst full_key = prefix ? key === '_' ? prefix : `${prefix}.${key}` : key,\n\t\t\t\tphrase = (phrases as any)[key];\n\n\t\t\tif ( typeof phrase === 'object' )\n\t\t\t\tthis.unset(phrases, full_key);\n\t\t\telse {\n\t\t\t\tthis.phrases.delete(full_key);\n\t\t\t\tthis.cache.delete(full_key);\n\t\t\t}\n\t\t}\n\t}\n\n\thas(key: string) {\n\t\treturn this.phrases.has(key);\n\t}\n\n\tset(key: string, phrase: string) {\n\t\tconst parsed = this.parser.parse(phrase);\n\t\tthis.phrases.set(key, phrase);\n\t\tthis.cache.set(key, parsed);\n\t}\n\n\tclear() {\n\t\tthis.phrases.clear();\n\t\tthis.cache.clear();\n\t}\n\n\treplace(phrases: RecursivePhraseMap) {\n\t\tthis.clear();\n\t\tthis.extend(phrases);\n\t}\n\n\t_preTransform(\n\t\tkey: string,\n\t\tphrase: string,\n\t\toptions: any,\n\t\tsettings: ParseTranslationSettings = {}\n\t): [MessageAST, any, string] {\n\t\tlet ast: MessageAST,\n\t\t\tlocale: string,\n\t\t\tdata = options == null ? {} : options;\n\t\tif ( typeof data === 'number' )\n\t\t\tdata = {count: data};\n\n\t\tif ( ! settings.noCache && this.phrases.has(key) ) {\n\t\t\t// TODO: Remind myself why this exists.\n\t\t\tast = this.cache.get(key) ?? [];\n\t\t\tlocale = this.locale;\n\n\t\t} else if ( ! settings.noCache && this.cache.has(key) ) {\n\t\t\tast = this.cache.get(key) ?? [];\n\t\t\tlocale = this.defaultLocale;\n\n\t\t} else {\n\t\t\tlet parsed: MessageAST | null = null;\n\t\t\ttry {\n\t\t\t\tparsed = this.parser.parse(phrase);\n\t\t\t} catch(err) {\n\t\t\t\tif ( settings.throwParse )\n\t\t\t\t\tthrow err;\n\n\t\t\t\tif ( ! settings.noWarn && this.warn )\n\t\t\t\t\tthis.warn(`Error parsing i18n phrase for key \"${key}\": ${phrase}`, err);\n\n\t\t\t\tast = ['parsing error'];\n\t\t\t\tlocale = this.defaultLocale;\n\t\t\t}\n\n\t\t\tif ( parsed ) {\n\t\t\t\tast = parsed;\n\t\t\t\tlocale = this.locale;\n\n\t\t\t\tif ( ! settings.noCache ) {\n\t\t\t\t\tif ( this.locale === this.defaultLocale )\n\t\t\t\t\t\tthis.phrases.set(key, phrase);\n\n\t\t\t\t\tthis.cache.set(key, parsed);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// This should never happen unless bad data is supplied.\n\t\t\t\tast = [];\n\t\t\t\tlocale = this.defaultLocale;\n\t\t\t}\n\t\t}\n\n\t\tif ( this.transformation )\n\t\t\tast = this.transformation(key, ast);\n\n\t\treturn [ast, data, locale];\n\t}\n\n\tt(key: string, phrase: string, data: any, settings?: ParseTranslationSettings) {\n\t\treturn listToString(this.tList(key, phrase, data, settings));\n\t}\n\n\ttList(key: string, phrase: string, data: any, settings?: ParseTranslationSettings) {\n\t\treturn this._processAST(...this._preTransform(key, phrase, data, settings));\n\t}\n\n\tformatNode(\n\t\tnode: MessageNode,\n\t\tdata: any,\n\t\tlocale: string | null,\n\t\tout: any[],\n\t\tast: MessageAST\n\t) {\n\t\tif ( ! node || typeof node !== 'object' )\n\t\t\treturn node;\n\n\t\tif ( locale == null )\n\t\t\tlocale = this.locale;\n\n\t\tconst val = get(node.v, data);\n\t\tif ( val == null )\n\t\t\treturn null;\n\n\t\tif ( node.t ) {\n\t\t\tconst handler = this.types[node.t];\n\t\t\tif ( handler )\n\t\t\t\treturn handler.call(this, val, node as MessageVariable, locale, out, ast, data);\n\t\t\telse if ( this.warn )\n\t\t\t\tthis.warn(`Encountered unknown type \"${(node as MessageVariable).t}\" when formatting node.`);\n\t\t}\n\n\t\treturn val;\n\t}\n\n\t_processAST(ast: MessageAST, data: any, locale: string) {\n\t\tconst out = [];\n\n\t\tfor(const node of ast) {\n\t\t\tconst val = this.formatNode(node, data, locale, out, ast);\n\t\t\tif( val != null )\n\t\t\t\tout.push(val);\n\t\t}\n\n\t\treturn out;\n\t}\n\n}\n\nexport default TranslationCore;\n\n\nfunction listToString(list: any[]): string {\n\tif ( ! Array.isArray(list) )\n\t\treturn `${list}`;\n\n\treturn list.map(listToString).join('');\n}\n\n\n// ============================================================================\n// Plural Handling\n// ============================================================================\n\nlet cardinal_i18n: Intl.PluralRules | null = null,\n\tcardinal_locale: string | null = null;\n\nexport function getCardinalName(locale: string, input: number) {\n\tif ( ! cardinal_i18n || locale !== cardinal_locale ) {\n\t\tcardinal_i18n = new Intl.PluralRules(locale, {\n\t\t\ttype: 'cardinal'\n\t\t});\n\t\tcardinal_locale = locale;\n\t}\n\n\treturn cardinal_i18n.select(input);\n}\n\nlet ordinal_i18n: Intl.PluralRules | null = null,\n\tordinal_locale: string | null = null;\n\nexport function getOrdinalName(locale: string, input: number) {\n\tif ( ! ordinal_i18n || locale !== ordinal_locale ) {\n\t\tordinal_i18n = new Intl.PluralRules(locale, {\n\t\t\ttype: 'ordinal'\n\t\t});\n\t\tordinal_locale = locale;\n\t}\n\n\treturn ordinal_i18n.select(input);\n}\n","var map = {\n\t\"./af.js\": [\n\t\t20179,\n\t\t1081\n\t],\n\t\"./am.js\": [\n\t\t61783,\n\t\t5380\n\t],\n\t\"./ar-dz.js\": [\n\t\t98136,\n\t\t5215\n\t],\n\t\"./ar-iq.js\": [\n\t\t82690,\n\t\t789\n\t],\n\t\"./ar-kw.js\": [\n\t\t62009,\n\t\t5151\n\t],\n\t\"./ar-ly.js\": [\n\t\t49408,\n\t\t1722\n\t],\n\t\"./ar-ma.js\": [\n\t\t87330,\n\t\t909\n\t],\n\t\"./ar-sa.js\": [\n\t\t66575,\n\t\t5012\n\t],\n\t\"./ar-tn.js\": [\n\t\t5742,\n\t\t8757\n\t],\n\t\"./ar.js\": [\n\t\t46567,\n\t\t3030\n\t],\n\t\"./az.js\": [\n\t\t14319,\n\t\t8736\n\t],\n\t\"./be.js\": [\n\t\t41737,\n\t\t2244\n\t],\n\t\"./bg.js\": [\n\t\t86835,\n\t\t6757\n\t],\n\t\"./bi.js\": [\n\t\t50045,\n\t\t8111\n\t],\n\t\"./bm.js\": [\n\t\t65561,\n\t\t9082\n\t],\n\t\"./bn.js\": [\n\t\t57602,\n\t\t4667\n\t],\n\t\"./bo.js\": [\n\t\t92594,\n\t\t3134\n\t],\n\t\"./br.js\": [\n\t\t34467,\n\t\t3968\n\t],\n\t\"./bs.js\": [\n\t\t53169,\n\t\t9248\n\t],\n\t\"./ca.js\": [\n\t\t97569,\n\t\t4178\n\t],\n\t\"./cs.js\": [\n\t\t30625,\n\t\t5123\n\t],\n\t\"./cv.js\": [\n\t\t6326,\n\t\t4060\n\t],\n\t\"./cy.js\": [\n\t\t49268,\n\t\t3166\n\t],\n\t\"./da.js\": [\n\t\t11559,\n\t\t4103\n\t],\n\t\"./de-at.js\": [\n\t\t12369,\n\t\t5954\n\t],\n\t\"./de-ch.js\": [\n\t\t71107,\n\t\t7168\n\t],\n\t\"./de.js\": [\n\t\t24569,\n\t\t300\n\t],\n\t\"./dv.js\": [\n\t\t25427,\n\t\t5528\n\t],\n\t\"./el.js\": [\n\t\t90524,\n\t\t1784\n\t],\n\t\"./en-au.js\": [\n\t\t29061,\n\t\t4634\n\t],\n\t\"./en-ca.js\": [\n\t\t31304,\n\t\t2928\n\t],\n\t\"./en-gb.js\": [\n\t\t84252,\n\t\t627\n\t],\n\t\"./en-ie.js\": [\n\t\t48757,\n\t\t2730\n\t],\n\t\"./en-il.js\": [\n\t\t98038,\n\t\t9\n\t],\n\t\"./en-in.js\": [\n\t\t7282,\n\t\t6644\n\t],\n\t\"./en-nz.js\": [\n\t\t97960,\n\t\t485\n\t],\n\t\"./en-sg.js\": [\n\t\t435,\n\t\t3949\n\t],\n\t\"./en-tt.js\": [\n\t\t90954,\n\t\t5818\n\t],\n\t\"./en.js\": [\n\t\t22039,\n\t\t427\n\t],\n\t\"./eo.js\": [\n\t\t39399,\n\t\t3923\n\t],\n\t\"./es-do.js\": [\n\t\t47688,\n\t\t4026\n\t],\n\t\"./es-mx.js\": [\n\t\t81773,\n\t\t2972\n\t],\n\t\"./es-pr.js\": [\n\t\t66106,\n\t\t5624\n\t],\n\t\"./es-us.js\": [\n\t\t18541,\n\t\t187\n\t],\n\t\"./es.js\": [\n\t\t23607,\n\t\t172\n\t],\n\t\"./et.js\": [\n\t\t29776,\n\t\t9040\n\t],\n\t\"./eu.js\": [\n\t\t20166,\n\t\t6960\n\t],\n\t\"./fa.js\": [\n\t\t28288,\n\t\t6633\n\t],\n\t\"./fi.js\": [\n\t\t88189,\n\t\t5928\n\t],\n\t\"./fo.js\": [\n\t\t49697,\n\t\t9627\n\t],\n\t\"./fr-ca.js\": [\n\t\t15296,\n\t\t7007\n\t],\n\t\"./fr-ch.js\": [\n\t\t53415,\n\t\t7063\n\t],\n\t\"./fr.js\": [\n\t\t4938,\n\t\t3674\n\t],\n\t\"./fy.js\": [\n\t\t7811,\n\t\t8733\n\t],\n\t\"./ga.js\": [\n\t\t3368,\n\t\t6020\n\t],\n\t\"./gd.js\": [\n\t\t53560,\n\t\t3017\n\t],\n\t\"./gl.js\": [\n\t\t85222,\n\t\t4466\n\t],\n\t\"./gom-latn.js\": [\n\t\t38546,\n\t\t6099\n\t],\n\t\"./gu.js\": [\n\t\t78309,\n\t\t6993\n\t],\n\t\"./he.js\": [\n\t\t41436,\n\t\t9706\n\t],\n\t\"./hi.js\": [\n\t\t463,\n\t\t7409\n\t],\n\t\"./hr.js\": [\n\t\t27147,\n\t\t3793\n\t],\n\t\"./ht.js\": [\n\t\t95139,\n\t\t3104\n\t],\n\t\"./hu.js\": [\n\t\t18224,\n\t\t6994\n\t],\n\t\"./hy-am.js\": [\n\t\t25976,\n\t\t365\n\t],\n\t\"./id.js\": [\n\t\t74970,\n\t\t2698\n\t],\n\t\"./is.js\": [\n\t\t799,\n\t\t1087\n\t],\n\t\"./it-ch.js\": [\n\t\t6071,\n\t\t8302\n\t],\n\t\"./it.js\": [\n\t\t97727,\n\t\t8744\n\t],\n\t\"./ja.js\": [\n\t\t78117,\n\t\t9418\n\t],\n\t\"./jv.js\": [\n\t\t22281,\n\t\t3496\n\t],\n\t\"./ka.js\": [\n\t\t87931,\n\t\t3099\n\t],\n\t\"./kk.js\": [\n\t\t52334,\n\t\t1494\n\t],\n\t\"./km.js\": [\n\t\t35155,\n\t\t6169\n\t],\n\t\"./kn.js\": [\n\t\t72879,\n\t\t9701\n\t],\n\t\"./ko.js\": [\n\t\t62905,\n\t\t5929\n\t],\n\t\"./ku.js\": [\n\t\t34078,\n\t\t8555\n\t],\n\t\"./ky.js\": [\n\t\t24026,\n\t\t2819\n\t],\n\t\"./lb.js\": [\n\t\t62619,\n\t\t8124\n\t],\n\t\"./lo.js\": [\n\t\t29979,\n\t\t1462\n\t],\n\t\"./lt.js\": [\n\t\t75887,\n\t\t6903\n\t],\n\t\"./lv.js\": [\n\t\t35493,\n\t\t2437\n\t],\n\t\"./me.js\": [\n\t\t50532,\n\t\t4518\n\t],\n\t\"./mi.js\": [\n\t\t73059,\n\t\t3883\n\t],\n\t\"./mk.js\": [\n\t\t17450,\n\t\t3512\n\t],\n\t\"./ml.js\": [\n\t\t66422,\n\t\t8996\n\t],\n\t\"./mn.js\": [\n\t\t16428,\n\t\t8753\n\t],\n\t\"./mr.js\": [\n\t\t35778,\n\t\t3294\n\t],\n\t\"./ms-my.js\": [\n\t\t40583,\n\t\t2593\n\t],\n\t\"./ms.js\": [\n\t\t33650,\n\t\t6881\n\t],\n\t\"./mt.js\": [\n\t\t6045,\n\t\t4863\n\t],\n\t\"./my.js\": [\n\t\t74361,\n\t\t3741\n\t],\n\t\"./nb.js\": [\n\t\t10697,\n\t\t3148\n\t],\n\t\"./ne.js\": [\n\t\t16608,\n\t\t3868\n\t],\n\t\"./nl-be.js\": [\n\t\t11377,\n\t\t7953\n\t],\n\t\"./nl.js\": [\n\t\t6987,\n\t\t9724\n\t],\n\t\"./nn.js\": [\n\t\t8758,\n\t\t9663\n\t],\n\t\"./oc-lnc.js\": [\n\t\t68064,\n\t\t9495\n\t],\n\t\"./pa-in.js\": [\n\t\t16767,\n\t\t838\n\t],\n\t\"./pl.js\": [\n\t\t28012,\n\t\t8705\n\t],\n\t\"./pt-br.js\": [\n\t\t19978,\n\t\t3639\n\t],\n\t\"./pt.js\": [\n\t\t51357,\n\t\t7479\n\t],\n\t\"./ro.js\": [\n\t\t71948,\n\t\t3905\n\t],\n\t\"./ru.js\": [\n\t\t3381,\n\t\t8700\n\t],\n\t\"./rw.js\": [\n\t\t79914,\n\t\t3128\n\t],\n\t\"./sd.js\": [\n\t\t90126,\n\t\t7087\n\t],\n\t\"./se.js\": [\n\t\t46319,\n\t\t8723\n\t],\n\t\"./si.js\": [\n\t\t99008,\n\t\t9797\n\t],\n\t\"./sk.js\": [\n\t\t84600,\n\t\t6512\n\t],\n\t\"./sl.js\": [\n\t\t64955,\n\t\t3951\n\t],\n\t\"./sq.js\": [\n\t\t74716,\n\t\t3392\n\t],\n\t\"./sr-cyrl.js\": [\n\t\t55854,\n\t\t1532\n\t],\n\t\"./sr.js\": [\n\t\t23534,\n\t\t1907\n\t],\n\t\"./ss.js\": [\n\t\t19239,\n\t\t7003\n\t],\n\t\"./sv-fi.js\": [\n\t\t57972,\n\t\t9047\n\t],\n\t\"./sv.js\": [\n\t\t43032,\n\t\t8919\n\t],\n\t\"./sw.js\": [\n\t\t60125,\n\t\t4176\n\t],\n\t\"./ta.js\": [\n\t\t1565,\n\t\t9872\n\t],\n\t\"./te.js\": [\n\t\t92516,\n\t\t5825\n\t],\n\t\"./tet.js\": [\n\t\t26712,\n\t\t4984\n\t],\n\t\"./tg.js\": [\n\t\t39351,\n\t\t4653\n\t],\n\t\"./th.js\": [\n\t\t89225,\n\t\t5389\n\t],\n\t\"./tk.js\": [\n\t\t48485,\n\t\t2355\n\t],\n\t\"./tl-ph.js\": [\n\t\t17517,\n\t\t2343\n\t],\n\t\"./tlh.js\": [\n\t\t35984,\n\t\t3508\n\t],\n\t\"./tr.js\": [\n\t\t33092,\n\t\t2661\n\t],\n\t\"./tzl.js\": [\n\t\t69109,\n\t\t6199\n\t],\n\t\"./tzm-latn.js\": [\n\t\t13637,\n\t\t6782\n\t],\n\t\"./tzm.js\": [\n\t\t38063,\n\t\t1785\n\t],\n\t\"./ug-cn.js\": [\n\t\t98490,\n\t\t8256\n\t],\n\t\"./uk.js\": [\n\t\t65589,\n\t\t6190\n\t],\n\t\"./ur.js\": [\n\t\t85859,\n\t\t3199\n\t],\n\t\"./uz-latn.js\": [\n\t\t96588,\n\t\t3290\n\t],\n\t\"./uz.js\": [\n\t\t45589,\n\t\t9238\n\t],\n\t\"./vi.js\": [\n\t\t41191,\n\t\t357\n\t],\n\t\"./x-pseudo.js\": [\n\t\t59018,\n\t\t6858\n\t],\n\t\"./yo.js\": [\n\t\t14163,\n\t\t8898\n\t],\n\t\"./zh-cn.js\": [\n\t\t9073,\n\t\t5352\n\t],\n\t\"./zh-hk.js\": [\n\t\t74828,\n\t\t8638\n\t],\n\t\"./zh-tw.js\": [\n\t\t78141,\n\t\t4101\n\t],\n\t\"./zh.js\": [\n\t\t42882,\n\t\t5235\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(() => {\n\t\treturn __webpack_require__.t(id, 7 | 16);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 73637;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./player-ext-mouse.scss\": 55743,\n\t\"./player-fade-paused.scss\": 5843,\n\t\"./player-hide-mouse.scss\": 95746,\n\t\"./player-hide-native-clip.scss\": 67862,\n\t\"./player-volume.scss\": 64978\n};\n\n\nfunction webpackAsyncContext(req) {\n\treturn webpackAsyncContextResolve(req).then(__webpack_require__);\n}\nfunction webpackAsyncContextResolve(req) {\n\treturn __webpack_require__.e(/* lazy-once context */ 6977).then(() => {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\t\treturn map[req];\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.resolve = webpackAsyncContextResolve;\nwebpackAsyncContext.id = 38621;\nmodule.exports = webpackAsyncContext;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"9\":\"i18n-33\",\"172\":\"i18n-44\",\"187\":\"i18n-43\",\"204\":\"menu-md4\",\"208\":\"rich_tokens\",\"300\":\"i18n-26\",\"357\":\"i18n-134\",\"365\":\"i18n-64\",\"427\":\"i18n-38\",\"485\":\"i18n-35\",\"627\":\"i18n-31\",\"789\":\"i18n-3\",\"838\":\"i18n-98\",\"909\":\"i18n-6\",\"935\":\"zip\",\"1081\":\"i18n-0\",\"1087\":\"i18n-66\",\"1462\":\"i18n-79\",\"1494\":\"i18n-72\",\"1532\":\"i18n-111\",\"1722\":\"i18n-5\",\"1784\":\"i18n-28\",\"1785\":\"i18n-128\",\"1871\":\"translation-ui\",\"1907\":\"i18n-112\",\"2009\":\"markdown\",\"2086\":\"main-menu\",\"2244\":\"i18n-11\",\"2343\":\"i18n-123\",\"2348\":\"chat\",\"2355\":\"i18n-122\",\"2437\":\"i18n-81\",\"2593\":\"i18n-88\",\"2597\":\"site-css-tweaks\",\"2661\":\"i18n-125\",\"2682\":\"tdata\",\"2698\":\"i18n-65\",\"2730\":\"i18n-32\",\"2819\":\"i18n-77\",\"2928\":\"i18n-30\",\"2972\":\"i18n-41\",\"3017\":\"i18n-55\",\"3030\":\"i18n-9\",\"3099\":\"i18n-71\",\"3104\":\"i18n-62\",\"3128\":\"i18n-104\",\"3134\":\"i18n-16\",\"3148\":\"i18n-92\",\"3166\":\"i18n-22\",\"3199\":\"i18n-131\",\"3224\":\"queries\",\"3290\":\"i18n-132\",\"3294\":\"i18n-87\",\"3392\":\"i18n-110\",\"3496\":\"i18n-70\",\"3508\":\"i18n-124\",\"3512\":\"i18n-84\",\"3639\":\"i18n-100\",\"3674\":\"i18n-52\",\"3741\":\"i18n-91\",\"3793\":\"i18n-61\",\"3868\":\"i18n-93\",\"3883\":\"i18n-83\",\"3905\":\"i18n-102\",\"3923\":\"i18n-39\",\"3949\":\"i18n-36\",\"3951\":\"i18n-109\",\"3968\":\"i18n-17\",\"4026\":\"i18n-40\",\"4060\":\"i18n-21\",\"4101\":\"i18n-139\",\"4103\":\"i18n-23\",\"4164\":\"menu-md1\",\"4176\":\"i18n-116\",\"4178\":\"i18n-19\",\"4466\":\"i18n-56\",\"4518\":\"i18n-82\",\"4634\":\"i18n-29\",\"4653\":\"i18n-120\",\"4667\":\"i18n-15\",\"4863\":\"i18n-90\",\"4984\":\"i18n-119\",\"5012\":\"i18n-7\",\"5123\":\"i18n-20\",\"5151\":\"i18n-4\",\"5215\":\"i18n-2\",\"5235\":\"i18n-140\",\"5352\":\"i18n-137\",\"5380\":\"i18n-1\",\"5389\":\"i18n-121\",\"5528\":\"i18n-27\",\"5624\":\"i18n-42\",\"5818\":\"i18n-37\",\"5825\":\"i18n-118\",\"5928\":\"i18n-48\",\"5929\":\"i18n-75\",\"5954\":\"i18n-24\",\"6020\":\"i18n-54\",\"6099\":\"i18n-57\",\"6169\":\"i18n-73\",\"6190\":\"i18n-130\",\"6199\":\"i18n-126\",\"6512\":\"i18n-108\",\"6530\":\"regex\",\"6633\":\"i18n-47\",\"6644\":\"i18n-34\",\"6757\":\"i18n-12\",\"6782\":\"i18n-127\",\"6858\":\"i18n-135\",\"6881\":\"i18n-89\",\"6903\":\"i18n-80\",\"6960\":\"i18n-46\",\"6993\":\"i18n-58\",\"6994\":\"i18n-63\",\"7003\":\"i18n-113\",\"7007\":\"i18n-50\",\"7063\":\"i18n-51\",\"7087\":\"i18n-105\",\"7168\":\"i18n-25\",\"7409\":\"i18n-60\",\"7479\":\"i18n-101\",\"7629\":\"menu-md0\",\"7953\":\"i18n-94\",\"8111\":\"i18n-13\",\"8124\":\"i18n-78\",\"8163\":\"menu-md5\",\"8256\":\"i18n-129\",\"8302\":\"i18n-67\",\"8555\":\"i18n-76\",\"8638\":\"i18n-138\",\"8700\":\"i18n-103\",\"8705\":\"i18n-99\",\"8723\":\"i18n-106\",\"8733\":\"i18n-53\",\"8736\":\"i18n-10\",\"8744\":\"i18n-68\",\"8753\":\"i18n-86\",\"8757\":\"i18n-8\",\"8898\":\"i18n-136\",\"8919\":\"i18n-115\",\"8996\":\"i18n-85\",\"9040\":\"i18n-45\",\"9047\":\"i18n-114\",\"9082\":\"i18n-14\",\"9238\":\"i18n-133\",\"9248\":\"i18n-18\",\"9418\":\"i18n-69\",\"9495\":\"i18n-97\",\"9627\":\"i18n-49\",\"9663\":\"i18n-96\",\"9701\":\"i18n-74\",\"9706\":\"i18n-59\",\"9724\":\"i18n-95\",\"9797\":\"i18n-107\",\"9872\":\"i18n-117\"}[chunkId] || chunkId) + \".js\";\n};","__webpack_require__.h = () => (\"76313c69f0d0df3a2768\")","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\nvar dataWebpackPrefix = \"frankerfacez:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t\tif (script.src.indexOf(window.location.origin + '/') !== 0) {\n\t\t\tscript.crossOrigin = \"anonymous\";\n\t\t}\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.j = 3035;","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t3035: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = globalThis[\"ffzWebpackJsonp\"] = globalThis[\"ffzWebpackJsonp\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","'use strict';\n\nimport type Logger from \"utilities/logging\";\nimport type SettingsProfile from \"./profile\";\nimport type { SettingDefinition, SettingsTypeHandler } from \"./types\";\nimport type SettingsContext from \"./context\";\n\n// ============================================================================\n// Settings Types\n// ============================================================================\n\nconst DEFAULT = Symbol('default');\n\n\nexport const basic: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[]) {\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) )\n\t\t\t\treturn [\n\t\t\t\t\tprofile.get(key) as T,\n\t\t\t\t\t[profile.id]\n\t\t\t\t]\n\t}\n}\n\n\nexport const object_merge: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[], definition: SettingDefinition<any>, log: Logger) {\n\t\tconst values: T[] = [],\n\t\t\tsources: number[] = [];\n\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) ) {\n\t\t\t\tconst val = profile.get<T>(key);\n\t\t\t\tif ( ! val || typeof val !== 'object' ) {\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\" of type ${typeof val}. Skipping.`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tsources.push(profile.id);\n\t\t\t\tvalues.unshift(val);\n\t\t\t}\n\n\t\tif ( sources.length )\n\t\t\treturn [\n\t\t\t\tObject.assign({}, ...values),\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\ntype UnwrapArray<T> = T extends Array<infer U> ? U : T;\n\nexport const basic_array_merge: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[], definition: SettingDefinition<any>, log: Logger) {\n\t\tconst values: UnwrapArray<T>[] = [],\n\t\t\tsources: number[] = [];\n\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) ) {\n\t\t\t\tconst val = profile.get<UnwrapArray<T>>(key);\n\t\t\t\tif ( ! Array.isArray(val) ) {\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\"`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tsources.push(profile.id);\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tvalues.push(v);\n\t\t\t}\n\n\t\tif ( sources.length )\n\t\t\treturn [\n\t\t\t\tvalues,\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\nexport const array_merge: SettingsTypeHandler = {\n\tdefault(val) {\n\t\tconst values = [];\n\t\tfor(const v of val)\n\t\t\tif ( v.t !== 'inherit' && v.t !== 'skip' && v.v )\n\t\t\t\tvalues.push(v.v);\n\n\t\treturn values;\n\t},\n\n\tget<T>(\n\t\tkey: string,\n\t\tprofiles: SettingsProfile[],\n\t\tdefinition: SettingDefinition<any>,\n\t\tlog: Logger,\n\t\tctx: SettingsContext\n\t) {\n\n\t\tconst values: UnwrapArray<T>[] = [],\n\t\t\tsources: number[] = [];\n\t\tlet trailing: UnwrapArray<T>[] = [];\n\t\tlet had_value = false;\n\n\t\tlet profs: (SettingsProfile | typeof DEFAULT)[] = profiles;\n\t\tif ( definition.inherit_default )\n\t\t\tprofs = [...profiles, DEFAULT];\n\n\t\tfor(const profile of profs) {\n\t\t\tlet value;\n\t\t\tif ( profile === DEFAULT ) {\n\t\t\t\tvalue = definition.default;\n\t\t\t\tif ( typeof value === 'function' )\n\t\t\t\t\tvalue = value(ctx);\n\n\t\t\t} else if ( profile.has(key) )\n\t\t\t\tvalue = profile.get(key);\n\t\t\telse\n\t\t\t\tcontinue;\n\n\t\t\tif ( ! Array.isArray(value) ) {\n\t\t\t\tif ( profile !== DEFAULT )\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\" of type ${typeof value}. Skipping.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst trail: UnwrapArray<T>[] = [];\n\n\t\t\tif ( profile !== DEFAULT )\n\t\t\t\tsources.push(profile.id);\n\n\t\t\tlet is_trailing = false;\n\t\t\tfor(const val of value) {\n\t\t\t\thad_value = true;\n\t\t\t\tif ( val.t === 'inherit' )\n\t\t\t\t\tis_trailing = true;\n\t\t\t\telse if ( val.t === 'skip' )\n\t\t\t\t\tcontinue;\n\t\t\t\telse if ( is_trailing )\n\t\t\t\t\ttrail.push(val.v);\n\t\t\t\telse\n\t\t\t\t\tvalues.push(val.v);\n\t\t\t}\n\n\t\t\ttrailing = trail.concat(trailing);\n\n\t\t\t// If we didn't run into an inherit, don't inherit.\n\t\t\tif ( ! is_trailing && ! definition.always_inherit )\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( had_value )\n\t\t\treturn [\n\t\t\t\tvalues.concat(trailing),\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\n\nexport default {\n\tbasic,\n\tobject_merge,\n\tbasic_array_merge,\n\tarray_merge\n} as Record<string, SettingsTypeHandler>;\n","'use strict';\n\n// ============================================================================\n// Settings Contexts\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {has, get as getter, array_equals, set_equals, map_equals, deep_equals} from 'utilities/object';\n\nimport DEFINITIONS from './typehandlers';\nimport type { AllSettingsKeys, ContextData, SettingMetadata, SettingType, SettingDefinition, SettingsKeys } from './types';\nimport type SettingsManager from '.';\nimport type SettingsProfile from './profile';\nimport type { SettingsTypeMap } from 'utilities/types';\n\n/**\n * Perform a basic check of a setting's requirements to see if they changed.\n * @param {Object} definition\n * @param {Map} cache\n * @param {Map} old_cache\n * @returns Whether or not they changed.\n */\nfunction compare_requirements(\n\tdefinition: SettingDefinition<any>,\n\tcache: Map<string, unknown>,\n\told_cache: Map<string, unknown>\n) {\n\tif ( ! definition || ! Array.isArray(definition.requires) )\n\t\treturn false;\n\n\tfor(const req of definition.requires) {\n\t\tconst old_value = old_cache.get(req),\n\t\t\tnew_value = cache.get(req);\n\n\t\tif ( typeof old_value !== typeof new_value )\n\t\t\treturn true;\n\n\t\tif ( Array.isArray(old_value) && Array.isArray(new_value) ) {\n\t\t\tif ( ! array_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if ( new_value instanceof Set && old_value instanceof Set ) {\n\t\t\tif ( ! set_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if( new_value instanceof Map && old_value instanceof Map ) {\n\t\t\tif ( ! map_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if ( new_value !== old_value )\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n\nexport type SettingsContextEvents = {\n\t[K in keyof SettingsTypeMap as `changed:${K}`]: [value: SettingsTypeMap[K], old_value: SettingsTypeMap[K]];\n} & {\n\t[K in keyof SettingsTypeMap as `uses_changed:${K}`]: [uses: number[] | null, old_uses: number[] | null];\n} & {\n\tchanged: [key: SettingsKeys, value: any, old_value: any];\n\tuses_changed: [key: SettingsKeys, uses: number[] | null, old_uses: number[] | null];\n\n\tcontext_changed: [];\n\tprofiles_changed: [];\n}\n\n\n/**\n * The SettingsContext class provides a context through which to read\n * settings values in addition to emitting events when settings values\n * are changed.\n */\nexport default class SettingsContext extends EventEmitter<SettingsContextEvents> {\n\n\tparent: SettingsContext | null;\n\tmanager: SettingsManager;\n\n\torder: number[];\n\n\t/** @internal */\n\t_context: ContextData;\n\tprivate __context: ContextData = null as any;\n\n\tprivate __profiles: SettingsProfile[];\n\n\tprivate __cache: Map<SettingsKeys, unknown>;\n\tprivate __meta: Map<SettingsKeys, SettingMetadata>;\n\n\tprivate __ls_listening: boolean;\n\tprivate __ls_wanted: Map<string, Set<string>>;\n\n\tconstructor(manager: SettingsContext | SettingsManager, context?: ContextData) {\n\t\tsuper();\n\n\t\tif ( manager instanceof SettingsContext ) {\n\t\t\tthis.parent = manager;\n\t\t\tthis.manager = manager.manager;\n\n\t\t\tthis.parent.on('context_changed', this._rebuildContext, this);\n\n\t\t} else {\n\t\t\tthis.parent = null;\n\t\t\tthis.manager = manager;\n\t\t}\n\n\t\t(this.manager as any).__contexts.push(this);\n\t\tthis._context = context || {};\n\n\t\t/*this._context_objects = new Set;\n\t\tif ( context )\n\t\t\tthis._updateContext(context, undefined, undefined, new Set);*/\n\n\t\tthis.__ls_listening = false;\n\t\tthis.__ls_wanted = new Map;\n\n\t\tthis.__cache = new Map;\n\t\tthis.__meta = new Map;\n\t\tthis.__profiles = [];\n\t\tthis.order = [];\n\n\t\tthis._rebuildContext();\n\t}\n\n\tdestroy() {\n\t\tif ( this.parent )\n\t\t\tthis.parent.off('context_changed', this._rebuildContext, this);\n\n\t\tfor(const profile of this.__profiles)\n\t\t\tprofile.off('changed', this._onChanged, this);\n\n\t\tconst contexts = (this.manager as any).__contexts,\n\t\t\tidx = contexts.indexOf(this);\n\n\t\tif ( idx !== -1 )\n\t\t\tcontexts.splice(idx, 1);\n\t}\n\n\n\t// ========================================================================\n\t// Local Storage Handling\n\t// ========================================================================\n\n\t_watchLS() {\n\t\tif ( this.__ls_listening )\n\t\t\treturn;\n\n\t\tthis.__ls_listening = true;\n\t\tthis.manager.on(':ls-update', this._onLSUpdate, this);\n\t}\n\n\t_unwatchLS() {\n\t\tif ( ! this.__ls_listening )\n\t\t\treturn;\n\n\t\tthis.__ls_listening = false;\n\t\tthis.manager.off(':ls-update', this._onLSUpdate, this);\n\t}\n\n\t_onLSUpdate(key: string) {\n\t\tconst keys = this.__ls_wanted.get(`ls.${key}`);\n\t\tif ( keys )\n\t\t\tfor(const key of keys)\n\t\t\t\tthis._update(key as SettingsKeys, key as SettingsKeys, []);\n\t}\n\n\n\t// ========================================================================\n\t// State Construction\n\t// ========================================================================\n\n\t_rebuildContext() {\n\t\tthis.__context = this.parent ?\n\t\t\tObject.assign({}, this.parent.__context || this.parent._context, this._context) :\n\t\t\tthis._context;\n\n\t\t// Make sure we re-build the cache. Dependency hell.\n\t\tif ( ! this.selectProfiles() )\n\t\t\tthis.rebuildCache();\n\n\t\tthis.emit('context_changed');\n\t}\n\n\n\tselectProfiles() {\n\t\tconst new_profiles: SettingsProfile[] = [],\n\t\t\torder: number[] = this.order = [];\n\n\t\tif ( ! this.manager.disable_profiles ) {\n\t\t\tfor(const profile of this.manager.__profiles)\n\t\t\t\tif ( profile.toggled && profile.matches(this.__context) ) {\n\t\t\t\t\tnew_profiles.push(profile);\n\t\t\t\t\torder.push(profile.id);\n\t\t\t\t}\n\t\t}\n\n\t\tif ( array_equals(this.__profiles, new_profiles) )\n\t\t\treturn false;\n\n\t\tconst changed_ids = new Set;\n\n\t\tfor(const profile of this.__profiles)\n\t\t\tif ( ! new_profiles.includes(profile) ) {\n\t\t\t\tprofile.off('changed', this._onChanged, this);\n\t\t\t\tchanged_ids.add(profile.id);\n\t\t\t}\n\n\t\tfor(const profile of new_profiles)\n\t\t\tif ( ! this.__profiles.includes(profile) ) {\n\t\t\t\tprofile.on('changed', this._onChanged as any, this);\n\t\t\t\tchanged_ids.add(profile.id);\n\t\t\t}\n\n\t\tthis.__profiles = new_profiles;\n\t\tthis.emit('profiles_changed');\n\t\tthis.rebuildCache(/*changed_ids*/);\n\t\treturn true;\n\t}\n\n\n\trebuildCache() {\n\t\tconst old_cache = this.__cache,\n\t\t\told_meta = this.__meta,\n\t\t\tmeta = this.__meta = new Map;\n\n\t\tthis.__cache = new Map;\n\n\t\t// TODO: Limit the values we recalculate to ones affected by the change\n\t\t// that happened to the profiles. This is harder because of setting\n\t\t// dependencies.\n\n\t\tfor(const [key, old_value] of old_cache) {\n\t\t\tconst new_value = this.get(key),\n\t\t\t\tnew_m = meta.get(key),\n\t\t\t\told_m = old_meta.get(key),\n\t\t\t\tnew_uses = new_m ? new_m.uses : null,\n\t\t\t\told_uses = old_m ? old_m.uses : null;\n\n\t\t\tconst definition = this.manager.definitions.get(key);\n\t\t\tlet changed = false;\n\n\t\t\tif ( ! Array.isArray(definition) && definition?.equals ) {\n\t\t\t\tif ( definition.equals === 'requirements' )\n\t\t\t\t\tchanged = compare_requirements(definition, this.__cache, old_cache);\n\t\t\t\telse if ( typeof definition.equals === 'function' )\n\t\t\t\t\tchanged = ! definition.equals(new_value, old_value, this.__cache, old_cache);\n\t\t\t}\n\n\t\t\telse if ( Array.isArray(new_value) && Array.isArray(old_value) )\n\t\t\t\tchanged = ! array_equals(new_value, old_value);\n\n\t\t\telse if ( new_value instanceof Set && old_value instanceof Set )\n\t\t\t\tchanged = ! set_equals(new_value, old_value);\n\n\t\t\telse if ( new_value instanceof Map && old_value instanceof Map )\n\t\t\t\tchanged = ! map_equals(new_value, old_value);\n\n\t\t\telse if ( new_value !== old_value )\n\t\t\t\tchanged = true;\n\n\t\t\tif ( changed ) {\n\t\t\t\tthis.emit('changed', key, new_value, old_value);\n\t\t\t\tthis.emit(`changed:${key}`, new_value, old_value as any);\n\t\t\t}\n\n\t\t\tif ( ! array_equals(new_uses, old_uses) ) {\n\t\t\t\tthis.emit('uses_changed', key, new_uses, old_uses);\n\t\t\t\tthis.emit(`uses_changed:${key}`, new_uses, old_uses);\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Context Control\n\t// ========================================================================\n\n\tcontext(context: ContextData) {\n\t\treturn new SettingsContext(this, context);\n\t}\n\n\n\tupdateContext(context: ContextData) {\n\t\tlet changed = false;\n\n\t\tfor(const key in context)\n\t\t\tif ( has(context, key) ) {\n\t\t\t\tconst val = context[key];\n\t\t\t\ttry {\n\t\t\t\t\tif ( deep_equals(val, this._context[key]) )\n\t\t\t\t\t\tcontinue;\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t\t// This can catch a recursive structure error.\n\t\t\t\t}\n\n\t\t\t\tthis._context[key] = val as any;\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\tif ( changed )\n\t\t\tthis._rebuildContext();\n\t}\n\n\n\t/*_updateContext(context, prefix, keys, changed) {\n\t\tif ( ! context || typeof context !== 'object' )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = Object.keys(context);\n\n\t\tif ( prefix && this._context_objects.has(prefix) ) {\n\t\t\tfor(const key of Object.keys(this._context) )\n\t\t\t\tif ( key.startsWith(prefix) ) {\n\t\t\t\t\tconst partial_key = key.substr(prefix.length);\n\t\t\t\t\tif ( ! keys.includes(partial_key) )\n\t\t\t\t\t\tkeys.push(partial_key);\n\t\t\t\t}\n\t\t}\n\n\t\tif ( prefix )\n\t\t\tthis._context_objects.add(prefix);\n\n\t\tfor(const key of keys) {\n\t\t\tconst full_key = prefix ? `${prefix}${key}` : key,\n\t\t\t\tpref = `${full_key}.`,\n\t\t\t\told_value = this._context[full_key],\n\t\t\t\tval = context[key];\n\n\t\t\tconst keys = val && (typeof val === 'object') && Object.keys(val);\n\t\t\tif ( keys && keys.length ) {\n\t\t\t\tthis._updateContext(val, pref, keys, changed);\n\n\t\t\t} else if ( this._context_objects.has(pref) ) {\n\t\t\t\tthis._updateContext({}, pref, [], changed);\n\t\t\t\tthis._context_objects.delete(pref);\n\n\t\t\t\tif ( (val || old_value) && val !== old_value ) {\n\t\t\t\t\tthis._context[full_key] = val;\n\t\t\t\t\tchanged.add(full_key);\n\t\t\t\t}\n\n\t\t\t} else if ( val !== old_value ) {\n\t\t\t\tthis._context[full_key] = val;\n\t\t\t\tchanged.add(full_key);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tupdateContext(context) {\n\t\tif ( ! context || typeof context !== 'object' )\n\t\t\treturn;\n\n\t\tconst changed = new Set;\n\t\tthis._updateContext(context, undefined, undefined, changed);\n\n\t\tif ( changed.size )\n\t\t\tthis._rebuildContext();\n\t}*/\n\n\n\tsetContext(context: ContextData) {\n\t\t//this._context_objects = new Set;\n\t\tthis._context = {};\n\t\tthis.updateContext(context);\n\t}\n\n\n\t// ========================================================================\n\t// Data Access\n\t// ========================================================================\n\n\t_onChanged(key: SettingsKeys) {\n\t\tthis._update(key, key, []);\n\t}\n\n\t_update<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, initial: SettingsKeys, visited: SettingsKeys[]) {\n\t\tif ( ! this.__cache.has(key) )\n\t\t\treturn;\n\n\t\telse if ( visited.includes(key) )\n\t\t\tthrow new Error(`cyclic dependent chain when updating setting \"${initial}\"`);\n\n\t\tvisited.push(key);\n\n\t\tconst old_value = this.__cache.get(key) as TValue | undefined,\n\t\t\told_meta = this.__meta.get(key),\n\t\t\tnew_value = this._get(key, key, []),\n\t\t\tnew_meta = this.__meta.get(key),\n\n\t\t\told_uses = old_meta ? old_meta.uses : null,\n\t\t\tnew_uses = new_meta ? new_meta.uses : null;\n\n\t\tif ( ! array_equals(new_uses, old_uses) ) {\n\t\t\tthis.emit('uses_changed', key, new_uses, old_uses);\n\t\t\tthis.emit(`uses_changed:${key}` as any, new_uses, old_uses);\n\t\t}\n\n\t\tif ( old_value === new_value )\n\t\t\treturn;\n\n\t\tthis.emit('changed', key, new_value, old_value);\n\t\tthis.emit(`changed:${key}` as any, new_value, old_value);\n\n\t\tconst definition = this.manager.definitions.get(key);\n\t\tif ( ! Array.isArray(definition) && definition?.required_by )\n\t\t\tfor(const req_key of definition.required_by)\n\t\t\t\tif ( ! req_key.startsWith('context.') && ! req_key.startsWith('ls.') )\n\t\t\t\t\tthis._update(req_key as SettingsKeys, initial, Array.from(visited));\n\t}\n\n\n\t_get<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, initial: SettingsKeys, visited: SettingsKeys[]): TValue {\n\t\tif ( visited.includes(key) )\n\t\t\tthrow new Error(`cyclic dependency when resolving setting \"${initial}\"`);\n\n\t\tvisited.push(key);\n\n\t\tconst definition = this.manager.definitions.get(key);\n\t\tconst raw_type = ! Array.isArray(definition) && definition?.type,\n\t\t\ttype = raw_type ? DEFINITIONS[raw_type] : DEFINITIONS.basic;\n\n\t\tif ( ! type )\n\t\t\tthrow new Error(`non-existent setting type \"${raw_type}\"`);\n\n\t\tconst raw_value = this._getRaw(key, type),\n\t\t\tmeta: SettingMetadata = {\n\t\t\t\tuses: raw_value ? raw_value[1] : null\n\t\t\t};\n\n\t\tlet value = raw_value ? raw_value[0] : undefined;\n\n\t\tif ( definition ) {\n\t\t\tif ( Array.isArray(definition) )\n\t\t\t\tthrow new Error(`non-existent setting \"${key}\" required when resolving setting \"${initial}\"`);\n\n\t\t\tif ( meta.uses === null ) {\n\t\t\t\tconst def_default = definition.default;\n\t\t\t\tif ( typeof def_default === 'function' )\n\t\t\t\t\tvalue = def_default(this);\n\t\t\t\telse\n\t\t\t\t\tvalue = def_default;\n\n\t\t\t\tif ( type.default )\n\t\t\t\t\tvalue = type.default(value, definition, this.manager.log);\n\t\t\t}\n\n\t\t\tif ( definition.requires )\n\t\t\t\tfor(const req_key of definition.requires)\n\t\t\t\t\tif ( req_key.startsWith('ls.') ) {\n\t\t\t\t\t\tthis._watchLS();\n\t\t\t\t\t\tlet keys = this.__ls_wanted.get(req_key);\n\t\t\t\t\t\tif ( ! keys )\n\t\t\t\t\t\t\tthis.__ls_wanted.set(req_key, keys = new Set);\n\n\t\t\t\t\t\tkeys.add(key);\n\n\t\t\t\t\t} else if ( ! req_key.startsWith('context.') && ! this.__cache.has(req_key as SettingsKeys) )\n\t\t\t\t\t\tthis._get(req_key as SettingsKeys, initial, Array.from(visited));\n\n\t\t\tif ( definition.process )\n\t\t\t\tvalue = definition.process(this, value, meta);\n\t\t}\n\n\t\tthis.__cache.set(key, value);\n\t\tthis.__meta.set(key, meta);\n\t\treturn value;\n\t}\n\n\n\t*profiles() {\n\t\tfor(const profile of this.__profiles)\n\t\t\tyield profile;\n\t}\n\n\n\thasProfile(profile: number | SettingsProfile) {\n\t\tif ( typeof profile === 'number' ) {\n\t\t\tfor(const prof of this.__profiles)\n\t\t\t\tif ( prof.id === profile )\n\t\t\t\t\treturn true;\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.__profiles.includes(profile);\n\t}\n\n\n\t_getRaw(key: SettingsKeys, type) {\n\t\tif ( ! type )\n\t\t\tthrow new Error(`non-existent type for ${key}`)\n\n\t\treturn type.get(\n\t\t\tkey,\n\t\t\tthis.profiles(),\n\t\t\tthis.manager.definitions.get(key),\n\t\t\tthis.manager.log,\n\t\t\tthis\n\t\t);\n\t}\n\n\n\t// ========================================================================\n\t// Data Access\n\t// ========================================================================\n\n\tupdate(key: SettingsKeys) {\n\t\tthis._update(key, key, []);\n\t}\n\n\tget<\n\t\tK extends AllSettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K): TValue {\n\t\tif ( key.startsWith('ls.') )\n\t\t\treturn this.manager.getLS(key.slice(3)) as TValue;\n\n\t\tif ( key.startsWith('context.') )\n\t\t\t//return this.__context[key.slice(8)];\n\t\t\treturn getter(key.slice(8), this.__context);\n\n\t\tif ( this.__cache.has(key as SettingsKeys) )\n\t\t\treturn this.__cache.get(key as SettingsKeys) as TValue;\n\n\t\treturn this._get(key as SettingsKeys, key as SettingsKeys, []);\n\t}\n\n\tgetChanges<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingsTypeMap[K]\n\t>(key: K, fn: (value: TValue, old_value: TValue | undefined) => void, ctx?: any) {\n\t\tthis.onChange(key, fn, ctx);\n\t\tfn.call(ctx, this.get(key), undefined as TValue);\n\t}\n\n\tonChange<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingsTypeMap[K]\n\t>(key: K, fn: (value: TValue, old_value: TValue) => void, ctx?: any) {\n\t\tthis.on(`changed:${key}`, fn as any, ctx);\n\t}\n\n\n\tuses(key: AllSettingsKeys) {\n\t\tif ( key.startsWith('ls.') )\n\t\t\treturn null;\n\n\t\tif ( key.startsWith('context.') )\n\t\t\treturn null;\n\n\t\tif ( ! this.__meta.has(key as SettingsKeys) )\n\t\t\tthis._get(key as SettingsKeys, key as SettingsKeys, []);\n\n\t\treturn this.__meta.get(key as SettingsKeys)?.uses ?? null;\n\t}\n}\n","'use strict';\n\nimport type { SettingDefinition, SettingProcessor, SettingUiDefinition } from \"./types\";\n\nconst BAD = Symbol('BAD');\ntype BadType = typeof BAD;\n\nfunction do_number(\n\tinput: number | BadType,\n\tdefault_value: number,\n\tdefinition: SettingUiDefinition<number>\n)  {\n\tif ( typeof input !== 'number' || isNaN(input) || ! isFinite(input) )\n\t\tinput = BAD;\n\n\tif ( input !== BAD ) {\n\t\tconst bounds = definition.bounds;\n\t\tif ( Array.isArray(bounds) ) {\n\t\t\tif ( bounds.length >= 3 ) {\n\t\t\t\t// [low, inclusive, high, inclusive]\n\t\t\t\tif ( (bounds[1] ? (input < bounds[0]) : (input <= bounds[0])) ||\n\t\t\t\t\t\t// TODO: Figure out why it doesn't like bounds[2] but bounds[3] is okay\n\t\t\t\t\t\t(bounds[3] ? (input > (bounds as any)[2]) : (input >= (bounds as any)[2])) )\n\t\t\t\t\tinput = BAD;\n\n\t\t\t} else if ( bounds.length === 2 ) {\n\t\t\t\t// [low, inclusive] or [low, high] ?\n\t\t\t\tif ( typeof bounds[1] === 'boolean' ) {\n\t\t\t\t\tif ( bounds[1] ? input < bounds[0] : input <= bounds[0] )\n\t\t\t\t\t\tinput = BAD;\n\t\t\t\t} else if ( input < bounds[0] || input > bounds[1] )\n\t\t\t\t\tinput = BAD;\n\t\t\t} else if ( bounds.length === 1 && input < bounds[0] )\n\t\t\t\tinput = BAD;\n\t\t}\n\t}\n\n\treturn input === BAD ? default_value : input;\n}\n\nexport const to_int: SettingProcessor<number> = (\n\tvalue,\n\tdefault_value,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?\\d+$/.test(value) )\n\t\tvalue = parseInt(value, 10);\n\telse if ( typeof value !== 'number' )\n\t\tvalue = BAD;\n\n\treturn do_number(value as number, default_value, definition);\n}\n\nexport const to_float: SettingProcessor<number> = (\n\tvalue: unknown,\n\tdefault_value,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?[\\d.]+$/.test(value) )\n\t\tvalue = parseFloat(value);\n\telse if ( typeof value !== 'number' )\n\t\tvalue = BAD;\n\n\treturn do_number(value as number, default_value, definition);\n}\n\n","'use strict';\n\nimport type { SettingUiDefinition, SettingValidator } from \"./types\";\n\n\nfunction do_number(value: any, definition: SettingUiDefinition<number>) {\n\tif ( typeof value !== 'number' || isNaN(value) || ! isFinite(value) )\n\t\treturn false;\n\n\tconst bounds = definition.bounds;\n\tif ( Array.isArray(bounds) ) {\n\t\tif ( bounds.length >= 3 ) {\n\t\t\t// [low, inclusive, high, inclusive]\n\t\t\tif ( (bounds[1] ? (value < bounds[0]) : (value <= bounds[0])) ||\n\t\t\t\t\t(bounds[3] ? (value > (bounds as any)[2]) : (value >= (bounds as any)[2])) )\n\t\t\t\treturn false;\n\n\t\t} else if ( bounds.length === 2 ) {\n\t\t\t// [low, inclusive] or [low, high] ?\n\t\t\tif ( typeof bounds[1] === 'boolean' ) {\n\t\t\t\tif ( bounds[1] ? value < bounds[0] : value <= bounds[0] )\n\t\t\t\t\treturn false;\n\t\t\t} else if ( value < bounds[0] || value > bounds[1] )\n\t\t\t\treturn false;\n\t\t} else if ( bounds.length === 1 && value < bounds[0] )\n\t\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport const process_to_int: SettingValidator<number> = (\n\tvalue,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?\\d+$/.test(value) )\n\t\tvalue = parseInt(value, 10);\n\telse if ( typeof value !== 'number' )\n\t\treturn false;\n\n\treturn do_number(value, definition);\n}\n\nexport const process_to_float: SettingValidator<number> = (\n\tvalue,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?[\\d.]+$/.test(value) )\n\t\tvalue = parseFloat(value);\n\telse if ( typeof value !== 'number' )\n\t\treturn false;\n\n\treturn do_number(value, definition);\n}\n","'use strict';\n\n// ============================================================================\n// Profile Filters for Settings\n// ============================================================================\n\nimport {glob_to_regex, escape_regex, matchScreen, ScreenOptions} from 'utilities/object';\nimport {FilterData, FilterType, createTester} from 'utilities/filtering';\nimport { DEBUG } from 'utilities/constants';\nimport type { ContextData } from './types';\nimport type { ScreenDetails } from 'root/types/getScreenDetails';\nimport SettingsManager from '.';\n\nlet safety: ((input: string | RegExp) => boolean) | null = null;\n\nfunction loadSafety(callback?: () => void) {\n\timport(/* webpackChunkName: 'regex' */ 'safe-regex').then(thing => {\n\t\tsafety = thing.default;\n\t\tif ( callback )\n\t\t\tcallback();\n\t})\n}\n\nconst NeverMatch = () => false;\n\n\n// Logical Components\n\nexport const Invert: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, true, false, rebuild)\n\t},\n\n\tmaxRules: 1,\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'Invert',\n\ti18n: 'settings.filter.invert',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\nexport const And: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, false, false, rebuild);\n\t},\n\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'And',\n\ti18n: 'settings.filter.and',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\nexport const Or: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, false, true, rebuild);\n\t},\n\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'Or',\n\ti18n: 'settings.filter.or',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\ntype IfData = [\n\tcondition: FilterData[],\n\tif_true: FilterData[],\n\tif_else: FilterData[]\n];\n\nexport const If: FilterType<IfData, ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\tconst cond = createTester(config[0], rule_types as any, false, false, rebuild),\n\t\t\tif_true = createTester(config[1], rule_types as any, false, false, rebuild),\n\t\t\tif_false = createTester(config[2], rule_types as any, false, false, rebuild);\n\n\t\treturn ctx => cond(ctx) ? if_true(ctx) : if_false(ctx)\n\t},\n\n\tchildRules: true,\n\ttall: true,\n\ttitle: 'If',\n\ti18n: 'settings.filter.if',\n\n\tdefault: () => [[], [], []],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/if.vue')\n};\n\nexport const Constant: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\tif ( config )\n\t\t\treturn () => true;\n\t\treturn NeverMatch;\n\t},\n\n\ttitle: 'True or False',\n\ti18n: 'settings.filter.true_false',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\n\n// Context Stuff\n\nfunction parseTime(time: string) {\n\tif ( typeof time !== 'string' || ! time.length )\n\t\treturn null;\n\n\tconst idx = time.indexOf(':');\n\tif ( idx === -1 )\n\t\treturn null;\n\n\tlet hours, minutes;\n\ttry {\n\t\thours = parseInt(time.slice(0, idx), 10);\n\t\tminutes = parseInt(time.slice(idx + 1), 10);\n\n\t} catch(err) {\n\t\treturn null;\n\t}\n\n\treturn hours * 60 + minutes;\n}\n\ntype TimeFilter = FilterType<[start: string, end: string], ContextData> & {\n\t_captured: Set<number>;\n\tcaptured: () => number[];\n};\n\nexport const Time: TimeFilter = {\n\t_captured: new Set,\n\n\tcreateTest(config) {\n\t\tconst start = parseTime(config[0]),\n\t\t\tend = parseTime(config[1]);\n\n\t\tif ( start == null || end == null )\n\t\t\treturn NeverMatch;\n\n\t\tif ( start <= end )\n\t\t\treturn () => {\n\t\t\t\tTime._captured.add(start);\n\t\t\t\tTime._captured.add(end + 1);\n\n\t\t\t\tconst d = new Date,\n\t\t\t\t\tv = d.getHours() * 60 + d.getMinutes();\n\n\t\t\t\treturn v >= start && v <= end;\n\t\t\t}\n\n\t\treturn () => {\n\t\t\tTime._captured.add(start + 1);\n\t\t\tTime._captured.add(end);\n\n\t\t\tconst d = new Date,\n\t\t\t\tv = d.getHours() * 60 + d.getMinutes();\n\n\t\t\treturn v >= start || v <= end;\n\t\t}\n\t},\n\n\tcaptured: () => {\n\t\tconst out = Array.from(Time._captured);\n\t\tTime._captured = new Set;\n\t\tout.sort((a, b) => a - b);\n\t\treturn out;\n\t},\n\n\ttitle: 'Time of Day',\n\ti18n: 'settings.filter.time',\n\n\tdefault: () => ['08:00', '18:00'],\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/time.vue')\n}\n\nexport const TheaterMode: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => {\n\t\t\tif ( ctx.fullscreen )\n\t\t\t\treturn config === false;\n\t\t\treturn ctx.ui?.theatreModeEnabled === config;\n\t\t}\n\t},\n\n\ttitle: 'Theater Mode',\n\ti18n: 'settings.filter.theater',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Fullscreen: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.fullscreen === config;\n\t},\n\n\ttitle: 'Fullscreen',\n\ti18n: 'settings.filter.fullscreen',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Moderator: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.moderator === config;\n\t},\n\n\ttitle: 'Is Moderator',\n\ti18n: 'settings.filter.moderator',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Debug: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn () => DEBUG === config;\n\t},\n\n\ttitle: 'Is Developer Mode',\n\ti18n: 'settings.filter.dev',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const AddonDebug: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.addonDev == config\n\t},\n\n\ttitle: 'Is Addon Developer Mode',\n\ti18n: 'settings.filter.addon-dev',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n}\n\nexport const SquadMode: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.ui?.squadModeEnabled === config;\n\t},\n\n\ttitle: 'Squad Mode',\n\ti18n: 'settings.filter.squad',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const NativeDarkTheme: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\tconst val = config ? 1 : 0;\n\t\treturn ctx => ctx.ui?.theme === val;\n\t},\n\n\ttitle: 'Dark Theme',\n\ti18n: 'settings.filter.native-dark',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\n// TODO: Add typing.\ntype PageData = {\n\troute: string;\n\tvalues: Record<string, string>;\n};\n\nexport const Page: FilterType<PageData, ContextData> = {\n\tcreateTest(config) {\n\t\tif ( ! config )\n\t\t\treturn NeverMatch;\n\n\t\tconst name = config.route,\n\t\t\tparts: [index: number, value: string][] = [];\n\n\t\tif ( Object.keys(config.values).length ) {\n\t\t\tconst ffz = window.FrankerFaceZ?.get(),\n\t\t\t\trouter = ffz && ffz.resolve('site.router') as any;\n\n\t\t\tif ( ! router )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tconst route = router.getRoute(name);\n\t\t\tif ( ! route || ! route.parts )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tlet i = 1;\n\t\t\tfor(const part of route.parts) {\n\t\t\t\tif ( typeof part === 'object' ) {\n\t\t\t\t\tconst val = config.values[part.name];\n\t\t\t\t\tif ( val && val.length )\n\t\t\t\t\t\tparts.push([i, val.toLowerCase()]);\n\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ctx => {\n\t\t\tif ( ! ctx.route || ! ctx.route_data || ctx.route.name !== name )\n\t\t\t\treturn false;\n\n\t\t\tfor(const [index, value] of parts) {\n\t\t\t\tlet thing = ctx.route_data[index];\n\t\t\t\tif ( typeof thing === 'string' )\n\t\t\t\t\tthing = thing.toLowerCase();\n\n\t\t\t\tif ( thing !== value )\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t},\n\n\ttall: true,\n\ttitle: 'Current Page',\n\ti18n: 'settings.filter.page',\n\n\tdefault: () => ({\n\t\troute: 'front-page',\n\t\tvalues: {}\n\t}),\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/page.vue')\n};\n\ntype ChannelData = {\n\tlogin: string | null;\n\tid: string | null;\n};\n\nexport const Channel: FilterType<ChannelData, ContextData> = {\n\tcreateTest(config) {\n\t\tconst login =  config?.login,\n\t\t\tid = config?.id;\n\n\t\tif ( ! id && ! login )\n\t\t\treturn NeverMatch;\n\n\t\telse if ( ! id )\n\t\t\treturn ctx => ctx.channel === login;\n\n\t\telse if ( ! login )\n\t\t\treturn ctx => ctx.channelID === id;\n\n\t\treturn ctx =>\n\t\t\tctx.channelID === id ||\n\t\t\t(ctx.channelID == null && ctx.channel === login);\n\t},\n\n\ttitle: 'Current Channel',\n\ti18n: 'settings.filter.channel',\n\n\tdefault: () => ({\n\t\tlogin: null,\n\t\tid: null\n\t}),\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/channel.vue')\n};\n\ntype CategoryData = {\n\tname: string | null;\n\tid: string | null;\n}\n\nexport const Category: FilterType<CategoryData, ContextData> = {\n\tcreateTest(config) {\n\t\tconst name = config?.name,\n\t\t\tid = config?.id;\n\n\t\tif ( ! id && ! name )\n\t\t\treturn NeverMatch;\n\n\t\telse if ( ! id )\n\t\t\treturn ctx => ctx.category === name;\n\n\t\telse if ( ! name )\n\t\t\treturn ctx => ctx.categoryID === id;\n\n\t\treturn ctx =>\n\t\t\tctx.categoryID === id ||\n\t\t\t(ctx.categoryID == null && ctx.category === name);\n\t},\n\n\ttitle: 'Current Category',\n\ti18n: 'settings.filter.category',\n\n\tdefault: () => ({\n\t\tname: null,\n\t\tid: null\n\t}),\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/category.vue')\n}\n\ntype TitleData = {\n\ttitle: string;\n\tmode: 'text' | 'glob' | 'raw' | 'regex';\n\tsensitive: boolean;\n};\n\nexport const Title: FilterType<TitleData, ContextData> = {\n\tcreateTest(config, _, reload) {\n\t\tconst mode = config?.mode;\n\t\tlet title = config?.title,\n\t\t\tneed_safety = true;\n\n\t\tif ( ! title || ! mode )\n\t\t\treturn NeverMatch;\n\n\t\tif ( mode === 'text' ) {\n\t\t\ttitle = escape_regex(title);\n\t\t\tneed_safety = false;\n\t\t} else if ( mode === 'glob' )\n\t\t\ttitle = glob_to_regex(title);\n\t\telse if ( mode !== 'raw' )\n\t\t\treturn NeverMatch;\n\n\t\tif ( need_safety ) {\n\t\t\tif ( ! safety )\n\t\t\t\tloadSafety(reload);\n\n\t\t\tif ( ! safety || ! safety(title) )\n\t\t\t\treturn NeverMatch;\n\t\t}\n\n\t\tlet regex: RegExp;\n\t\ttry {\n\t\t\tregex = new RegExp(title, `g${config.sensitive ? '' : 'i'}`);\n\t\t} catch(err) {\n\t\t\treturn NeverMatch;\n\t\t}\n\n\t\treturn ctx => {\n\t\t\tregex.lastIndex = 0;\n\t\t\treturn ctx.title ? regex.test(ctx.title): false;\n\t\t}\n\t},\n\n\ttitle: 'Current Title',\n\ti18n: 'settings.filter.title',\n\n\tdefault: () => ({\n\t\ttitle: '',\n\t\tmode: 'text',\n\t\tsensitive: false\n\t}),\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/title.vue')\n};\n\n// Monitor Stuff\n\ntype MonitorType = FilterType<ScreenOptions, ContextData> & {\n\t_used: boolean;\n\tdetails?: ScreenDetails | null | false;\n\n\tused: () => boolean;\n\n};\n\nexport let Monitor: MonitorType = null as any;\n\nif ( window.getScreenDetails ) {\n\n\tMonitor = {\n\t\t_used: false,\n\t\tdetails: undefined,\n\n\t\tused: () => {\n\t\t\tconst out = Monitor._used;\n\t\t\tMonitor._used = false;\n\t\t\treturn out;\n\t\t},\n\n\t\tcreateTest(config, _, reload) {\n\t\t\tif ( ! config?.label )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tMonitor._used = true;\n\t\t\tif ( reload && Monitor.details === undefined ) {\n\t\t\t\tconst FFZ = window.FrankerFaceZ ?? ((window as any).FFZBridge as any),\n\t\t\t\t\tffz = FFZ?.get(),\n\t\t\t\t\tsettings = ffz?.resolve('settings');\n\t\t\t\tif ( settings )\n\t\t\t\t\tsettings.createMonitorUpdate().then(() => {\n\t\t\t\t\t\treload();\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn () => {\n\t\t\t\tMonitor._used = true;\n\t\t\t\tconst details = Monitor.details;\n\t\t\t\tif ( ! details )\n\t\t\t\t\treturn false;\n\n\t\t\t\tconst sorted = details.screens,\n\t\t\t\t\tmatched = matchScreen(sorted, config);\n\n\t\t\t\treturn matched === details.currentScreen;\n\t\t\t};\n\t\t},\n\n\t\tdefault: () => ({\n\t\t\tlabel: null\n\t\t}),\n\n\t\ttitle: 'Current Monitor',\n\t\ti18n: 'settings.filter.monitor',\n\n\t\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/monitor.vue')\n\t};\n\n}\n","'use strict';\n\nimport { isValidBlob, deserializeBlob, serializeBlob, BlobLike, SerializedBlobLike } from 'utilities/blobs';\n\n\n// ============================================================================\n// Settings Providers\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {TicketLock, has, once} from 'utilities/object';\nimport type SettingsManager from '.';\nimport type { OptionalArray, OptionalPromise, ProviderTypeMap } from '../utilities/types';\nimport { EXTENSION } from '../utilities/constants';\n\nconst DB_VERSION = 1,\n\tNOT_WWW_TWITCH = window.location.host !== 'www.twitch.tv',\n\tNOT_WWW_YT = window.location.host !== 'www.youtube.com';\n\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ProviderEvents = {\n\t'change-provider': [];\n\t'set': [key: string, value: any, deleted: boolean];\n\t'changed': [key: string, value: any, deleted: boolean];\n\t'quota-exceeded': [error: any];\n\n\t'set-blob': [key: string, value: BlobLike | undefined, deleted: boolean];\n\t'changed-blob': [key: string, deleted: boolean];\n\t'clear-blobs': [];\n}\n\n\n// ============================================================================\n// SettingsProvider\n// ============================================================================\n\n/**\n * Base class for providers for the settings system. A provider is in charge\n * of reading and writing values from storage as well as sending events to\n * the {@link SettingsManager} when a value is changed remotely.\n */\nexport abstract class SettingsProvider extends EventEmitter<ProviderEvents> {\n\n\t// Static Stuff\n\n\tstatic priority: number = 0;\n\tstatic title: string;\n\tstatic description: string;\n\n\tstatic hasContent: () => OptionalPromise<boolean>;\n\n\n\tmanager: SettingsManager;\n\tdisabled: boolean;\n\n\tprotected ready: boolean = false;\n\n\t/**\n\t * Create a new SettingsProvider\n\t * @param {SettingsManager} manager - The manager that owns this provider.\n\t */\n\tconstructor(manager: SettingsManager) {\n\t\tsuper();\n\n\t\tthis.manager = manager;\n\t\tthis.disabled = false;\n\t}\n\n\tstatic supported() {\n\t\treturn false;\n\t}\n\n\tstatic allowTransfer = true;\n\tstatic shouldUpdate = true;\n\n\tawaitReady() {\n\t\tif ( this.ready )\n\t\t\treturn Promise.resolve();\n\n\t\treturn Promise.reject(new Error('Not Implemented'));\n\t}\n\n\tget allowTransfer() {\n\t\treturn (this.constructor as typeof SettingsProvider).allowTransfer;\n\t}\n\n\tget shouldUpdate() {\n\t\treturn (this.constructor as typeof SettingsProvider).shouldUpdate;\n\t}\n\n\tabstract broadcastTransfer(): void;\n\tabstract disableEvents(): void;\n\n\tabstract flush(): OptionalPromise<void>;\n\n\tabstract get<K extends keyof ProviderTypeMap>(\n\t\tkey: K,\n\t\tdefault_value: ProviderTypeMap[K]\n\t): ProviderTypeMap[K];\n\tabstract get<K extends keyof ProviderTypeMap>(\n\t\tkey: K\n\t): ProviderTypeMap[K] | null;\n\tabstract get<T>(\n\t\tkey: Exclude<string, keyof ProviderTypeMap>,\n\t\tdefault_value: T\n\t): T;\n\tabstract get<T>(\n\t\tkey: Exclude<string, keyof ProviderTypeMap>\n\t): T | null;\n\n\tabstract set<K extends keyof ProviderTypeMap>(key: K, value: ProviderTypeMap[K]): void;\n\tabstract set<K extends string>(key: Exclude<K, keyof ProviderTypeMap>, value: unknown): void;\n\tabstract delete(key: string): void;\n\tabstract clear(): void;\n\n\tabstract has(key: string): boolean;\n\n\tabstract keys(): Iterable<string>;\n\tabstract entries(): Iterable<[string, any]>;\n\n\tabstract get size(): number;\n\n}\n\n\nexport abstract class AdvancedSettingsProvider extends SettingsProvider {\n\n\tget supportsBlobs() { return true; }\n\n\tisValidBlob(blob: any): blob is BlobLike {\n\t\treturn this.supportsBlobs && isValidBlob(blob);\n\t}\n\n\tabstract getBlob(key: string): Promise<BlobLike | null>;\n\tabstract setBlob(key: string, value: BlobLike): Promise<void>;\n\tabstract deleteBlob(key: string): Promise<void>;\n\tabstract hasBlob(key: string): Promise<boolean>;\n\tabstract clearBlobs(): Promise<void>;\n\tabstract blobKeys(): Promise<Iterable<string>>;\n\n}\n\n\nexport abstract class RemoteSettingsProvider extends AdvancedSettingsProvider {\n\n\t// State and Storage\n\tprivate _start_time: number;\n\tprivate _cached: Map<string, any>;\n\n\tprivate _blobs: boolean | null;\n\tprivate _rpc: Map<number, [(input: any) => void, () => void]>;\n\tprivate _last_id: number;\n\n\tprivate resolved_ready: boolean;\n\tprivate _ready_wait_resolve?: (() => void) | null;\n\tprivate _ready_wait_fail?: ((err: any) => void) | null;\n\tprivate _ready_wait?: Promise<void> | null;\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tthis._start_time = performance.now();\n\n\t\tthis._rpc = new Map;\n\n\t\tthis._cached = new Map;\n\t\tthis.resolved_ready = false;\n\t\tthis.ready = false;\n\t\tthis._ready_wait = null;\n\n\t\tthis._blobs = null;\n\t\tthis._last_id = 0;\n\t}\n\n\tget supportsBlobs() {\n\t\treturn this._blobs ?? false;\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\tdisableEvents() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\n\t// Initialization\n\n\tprotected resolveReady(success: boolean, data?: any) {\n\t\tif ( this.manager )\n\t\t\tthis.manager.log.info(`${this.constructor.name} ready in ${(performance.now() - this._start_time).toFixed(5)}ms`);\n\n\t\tthis.resolved_ready = true;\n\t\tthis.ready = success;\n\n\t\tif ( success && this._ready_wait_resolve )\n\t\t\tthis._ready_wait_resolve();\n\t\telse if ( ! success && this._ready_wait_fail )\n\t\t\tthis._ready_wait_fail(data);\n\t}\n\n\tawaitReady() {\n\t\tif ( this.resolved_ready ) {\n\t\t\tif ( this.ready )\n\t\t\t\treturn Promise.resolve();\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tif ( this._ready_wait )\n\t\t\treturn this._ready_wait;\n\n\t\treturn this._ready_wait = new Promise<void>((resolve, fail) => {\n\t\t\tthis._ready_wait_resolve = resolve;\n\t\t\tthis._ready_wait_fail = fail;\n\n\t\t}).finally(() => {\n\t\t\tthis._ready_wait = null;\n\t\t\tthis._ready_wait_resolve = null;\n\t\t\tthis._ready_wait_fail = null;\n\t\t});\n\t}\n\n\n\t// Provider Methods\n\n\tget<T>(key: string, default_value?: T): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\tthis.rpc({ffz_type: 'set', key, value})\n\t\t\t.catch(err => this.manager.log.error('Error setting value', err));\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tthis._cached.delete(key);\n\t\tthis.rpc({ffz_type: 'delete', key})\n\t\t\t.catch(err => this.manager.log.error('Error deleting value', err));\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\tclear() {\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\t\tfor(const key of old_cache.keys())\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\tthis.rpc('clear')\n\t\t\t.catch(err => this.manager.log.error('Error clearing storage', err));\n\t}\n\n\thas(key: string) { return this._cached.has(key); }\n\tkeys() { return this._cached.keys(); }\n\tentries() { return this._cached.entries(); }\n\tget size() { return this._cached.size; }\n\n\tasync flush() {\n\t\tawait this.rpc('flush');\n\t}\n\n\n\t// Provider Methods: Blobs\n\n\tasync getBlob(key: string) {\n\t\tconst msg = await this.rpc({ffz_type: 'get-blob', key});\n\t\treturn msg ? deserializeBlob(msg) : null;\n\t}\n\n\tasync setBlob(key: string, value: BlobLike) {\n\t\tawait this.rpc({\n\t\t\tffz_type: 'set-blob',\n\t\t\tkey,\n\t\t\tvalue: await serializeBlob(value)\n\t\t});\n\t}\n\n\tasync deleteBlob(key: string) {\n\t\tawait this.rpc({\n\t\t\tffz_type: 'delete-blob',\n\t\t\tkey\n\t\t});\n\t}\n\n\tasync hasBlob(key: string) {\n\t\treturn this.rpc({ffz_type: 'has-blob', key});\n\t}\n\n\tasync clearBlobs() {\n\t\tawait this.rpc('clear-blobs');\n\t}\n\n\tasync blobKeys() {\n\t\treturn this.rpc('blob-keys');\n\t}\n\n\n\t// Communication\n\n\tabstract send(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>): void;\n\n\trpc<K extends keyof CorsRpcTypes>(\n\t\tmsg: K | RPCInputMessage<K>,\n\t\ttransfer?: OptionalArray<Transferable>\n\t) {\n\t\tconst id = ++this._last_id;\n\n\t\treturn new Promise<CorsOutput<K>>((resolve,fail) => {\n\t\t\tthis._rpc.set(id, [resolve, fail]);\n\t\t\tlet out: CorsMessage;\n\t\t\tif ( typeof msg === 'string' )\n\t\t\t\tout = {ffz_type: msg} as CorsMessage;\n\t\t\telse\n\t\t\t\tout = msg as unknown as CorsMessage;\n\n\t\t\tout.id = id;\n\t\t\tthis.send(out, transfer);\n\t\t});\n\t}\n\n\thandleMessage(msg: CorsMessage) {\n\t\tif ( msg.ffz_type === 'ready' )\n\t\t\tthis.rpc('init-load').then(msg => {\n\t\t\t\tthis._blobs = msg.blobs;\n\t\t\t\tfor(const [key, value] of Object.entries(msg.values))\n\t\t\t\t\tthis._cached.set(key, value);\n\n\t\t\t\tthis.resolveReady(true);\n\n\t\t\t}).catch(err => {\n\t\t\t\tthis.resolveReady(false, err);\n\t\t\t});\n\n\t\telse if ( msg.ffz_type === 'change' )\n\t\t\tthis.onChange(msg);\n\n\t\telse if ( msg.ffz_type === 'change-blob' )\n\t\t\tthis.emit('changed-blob', msg.key, msg.deleted);\n\n\t\telse if ( msg.ffz_type === 'clear-blobs' )\n\t\t\tthis.emit('clear-blobs');\n\n\t\telse if ( msg.ffz_type === 'reply' || msg.ffz_type === 'reply-error' )\n\t\t\tthis.onReply(msg);\n\n\t\telse\n\t\t\tthis.manager.log.warn('Unknown Message', msg.ffz_type, msg);\n\t}\n\n\tonChange(msg: RPCInputMessage<'change'>) {\n\t\tconst key = msg.key,\n\t\t\tvalue = msg.value,\n\t\t\tdeleted = msg.deleted;\n\n\t\tif ( deleted ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\t\t} else {\n\t\t\tthis._cached.set(key, value);\n\t\t\tthis.emit('changed', key, value, false);\n\t\t}\n\t}\n\n\tonReply(msg: CorsReplyMessage | CorsReplyErrorMessage) {\n\t\tconst id = msg.id,\n\t\t\tsuccess = msg.ffz_type === 'reply',\n\t\t\tcbs = this._rpc.get(id);\n\t\tif ( ! cbs )\n\t\t\treturn this.manager.log.warn('Received reply for unknown ID', id);\n\n\t\tthis._rpc.delete(id);\n\t\tif ( success )\n\t\t\tcbs[0](msg.reply);\n\t\telse\n\t\t\tcbs[1]();\n\t}\n}\n\n\n\n\n\n// ============================================================================\n// LocalStorage\n// ============================================================================\n\nexport class LocalStorageProvider extends SettingsProvider {\n\n\t// Static Stuff\n\tstatic priority = -1000;\n\tstatic title = 'Local Storage';\n\tstatic description = '[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.';\n\n\t// All environments that support FFZ support LocalStorage.\n\tstatic supported() {\n\t\treturn true;\n\t}\n\n\tstatic hasContent(prefix?: string) {\n\t\tif ( ! prefix )\n\t\t\tprefix = 'FFZ:setting:';\n\n\t\tfor(const key in localStorage)\n\t\t\tif ( key.startsWith(prefix) && has(localStorage, key) )\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\t// Config and Storage\n\treadonly prefix: string;\n\tprivate _cached: Map<string, any>;\n\n\t// Event Handling\n\tprivate _broadcaster?: BroadcastChannel | null;\n\tprivate _boundHandleMessage?: ((event: MessageEvent) => void) | null;\n\tprivate _boundHandleStorage?: ((event: StorageEvent) => void) | null;\n\n\tconstructor(manager: SettingsManager, prefix?: string) {\n\t\tsuper(manager);\n\t\tthis.prefix = prefix = prefix == null ? 'FFZ:setting:' : prefix;\n\n\t\tconst cache = this._cached = new Map,\n\t\t\tlen = prefix.length;\n\n\t\tfor(const key in localStorage)\n\t\t\tif ( has(localStorage, key) && key.startsWith(prefix) ) {\n\t\t\t\tconst val = localStorage.getItem(key);\n\t\t\t\tif ( val )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcache.set(key.slice(len), JSON.parse(val));\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.manager.log.warn(`unable to parse value for ${key}`, val);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\tthis.ready = true;\n\n\t\tif ( window.BroadcastChannel ) {\n\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-settings');\n\t\t\tbc.addEventListener('message',\n\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\n\t\t} else {\n\t\t\twindow.addEventListener('storage',\n\t\t\t\tthis._boundHandleStorage = this.handleStorage.bind(this));\n\t\t}\n\t}\n\n\tbroadcastTransfer() {\n\t\tthis.broadcast({type: 'change-provider'});\n\t}\n\n\tprivate removeListeners() {\n\t\tif ( this._broadcaster ) {\n\t\t\tif ( this._boundHandleMessage )\n\t\t\t\tthis._broadcaster.removeEventListener('message', this._boundHandleMessage);\n\t\t\tthis._broadcaster.close();\n\t\t\tthis._boundHandleMessage = this._broadcaster = null;\n\t\t}\n\n\t\tif ( this._boundHandleStorage ) {\n\t\t\twindow.removeEventListener('storage', this._boundHandleStorage);\n\t\t\tthis._boundHandleStorage = null;\n\t\t}\n\t}\n\n\tdisableEvents() {\n\t\tthis.removeListeners();\n\n\t\tthis.broadcast = () => {};\n\t\tthis.emit = () => {};\n\t}\n\n\tdestroy() {\n\t\tthis.disable();\n\t\tthis._cached.clear();\n\t}\n\n\tdisable() {\n\t\tthis.removeListeners();\n\t\tthis.disabled = true;\n\t}\n\n\n\tflush() { /* no-op */ } // eslint-disable-line class-methods-use-this\n\n\n\tbroadcast(msg: any) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\n\thandleMessage(event: MessageEvent) {\n\t\tif ( this.disabled || ! event.isTrusted || ! event.data )\n\t\t\treturn;\n\n\t\tthis.manager.log.debug('storage broadcast event', event.data);\n\t\tconst {type, key} = event.data;\n\n\t\tif ( type === 'change-provider') {\n\t\t\tthis.manager.log.info('Received notice of changed settings provider.');\n\t\t\tthis.emit('change-provider');\n\t\t\tthis.disable();\n\t\t\tthis.disableEvents();\n\n\t\t} else if ( type === 'set' ) {\n\t\t\tconst val = JSON.parse(localStorage.getItem(this.prefix + key) ?? 'null');\n\t\t\tthis._cached.set(key, val);\n\t\t\tthis.emit('changed', key, val, false);\n\n\t\t} else if ( type === 'delete' ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'clear' ) {\n\t\t\tconst old_keys = Array.from(this._cached.keys());\n\t\t\tthis._cached.clear();\n\t\t\tfor(const key of old_keys)\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\t\t}\n\t}\n\n\n\thandleStorage(event: StorageEvent) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis.manager.log.debug('storage event', event);\n\t\tif ( event.storageArea !== localStorage )\n\t\t\treturn;\n\n\t\tif ( event.key && event.key.startsWith(this.prefix) ) {\n\t\t\t// If value is null, the key was deleted.\n\t\t\tconst key = event.key.slice(this.prefix.length);\n\t\t\tlet val = event.newValue;\n\n\t\t\tif ( val === null ) {\n\t\t\t\tthis._cached.delete(key);\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t\t} else {\n\t\t\t\tval = JSON.parse(val);\n\t\t\t\tthis._cached.set(key, val);\n\t\t\t\tthis.emit('changed', key, val, false);\n\t\t\t}\n\t\t}\n\t}\n\n\tget<T>(\n\t\tkey: string,\n\t\tdefault_value?: T\n\t): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\ttry {\n\t\t\tlocalStorage.setItem(this.prefix + key, JSON.stringify(value));\n\t\t} catch(err) {\n\t\t\tif ( this.manager )\n\t\t\t\tthis.manager.log.error(`An error occurred while trying to save a value to localStorage for key \"${this.prefix + key}\"`);\n\n\t\t\tif ( err && /quota/i.test(err.toString()) )\n\t\t\t\tthis.emit('quota-exceeded', err);\n\n\t\t\tthrow err;\n\t\t}\n\n\t\tthis.broadcast({type: 'set', key});\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis._cached.delete(key);\n\t\tlocalStorage.removeItem(this.prefix + key);\n\t\tthis.broadcast({type: 'delete', key});\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\treturn this._cached.has(key);\n\t}\n\n\tkeys() {\n\t\treturn this._cached.keys();\n\t}\n\n\tclear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\n\t\tfor(const key of old_cache.keys()) {\n\t\t\tlocalStorage.removeItem(this.prefix + key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\t\t}\n\n\t\tthis.broadcast({type: 'clear'});\n\t}\n\n\tentries() {\n\t\treturn this._cached.entries();\n\t}\n\n\tget size() {\n\t\treturn this._cached.size;\n\t}\n}\n\n\nexport class IndexedDBProvider extends AdvancedSettingsProvider {\n\n\t// Static Stuff\n\tstatic priority = 10;\n\tstatic title = 'IndexedDB';\n\tstatic description = '[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.';\n\n\tstatic supported() {\n\t\treturn window.indexedDB != null;\n\t}\n\n\tstatic hasContent() {\n\t\treturn new Promise<boolean>((resolve) => {\n\t\t\tconst request = window.indexedDB.open('FFZ', DB_VERSION);\n\t\t\trequest.onerror = () => resolve(false);\n\n\t\t\trequest.onupgradeneeded = e => {\n\t\t\t\t// TODO: Logic to detect that the version updated.\n\t\t\t\t// Can wait to implement till we actually increment version.\n\t\t\t\tif ( e.target instanceof IDBRequest )\n\t\t\t\t\te.target.transaction?.abort();\n\n\t\t\t\tresolve(false);\n\t\t\t}\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tconst db = request.result;\n\n\t\t\t\t// We have a database, but does it contain anything?\n\t\t\t\tlet store;\n\t\t\t\ttry {\n\t\t\t\t\tconst trx = db.transaction(['settings'], 'readonly');\n\t\t\t\t\tstore = trx.objectStore('settings');\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// This indicates a bad database.\n\t\t\t\t\treturn resolve(false);\n\t\t\t\t}\n\n\t\t\t\tconst r2 = store.getAllKeys();\n\n\t\t\t\tr2.onerror = () => {\n\t\t\t\t\tdb.close();\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\n\t\t\t\tr2.onsuccess = () => {\n\t\t\t\t\tconst success = Array.isArray(r2.result) && r2.result.length > 0;\n\t\t\t\t\tdb.close();\n\t\t\t\t\treturn resolve(success);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\t// State and Storage\n\tprivate _start_time: number;\n\tprivate _cached: Map<string, any>;\n\tprivate _pending: Set<unknown> | null;\n\tprivate _flush_wait?: Promise<void> | null;\n\tprivate _flush_wait_resolve?: (() => void) | null;\n\tprivate _ready_wait?: Promise<void> | null;\n\n\tprivate _db_wait?: Promise<IDBDatabase> | null;\n\n\tprivate db?: IDBDatabase | null;\n\n\tprivate _last_tx: number = 0;\n\tprivate _lock: TicketLock;\n\n\t// Event Handling\n\tprivate _broadcaster?: BroadcastChannel | null;\n\tprivate _boundHandleMessage?: ((event: MessageEvent) => void) | null;\n\n\tconstructor(manager: SettingsManager, start: boolean = true) {\n\t\tsuper(manager);\n\n\t\tthis.getDB = once(this.getDB);\n\n\t\tthis._start_time = performance.now();\n\n\t\tthis._pending = new Set<unknown>;\n\t\tthis._flush_wait = null;\n\n\t\tthis._lock = new TicketLock();\n\n\t\tthis._cached = new Map;\n\t\tthis.ready = false;\n\t\tthis._ready_wait = null;\n\n\t\tif ( start ) {\n\t\t\tif ( window.BroadcastChannel ) {\n\t\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-settings');\n\t\t\t\tbc.addEventListener('message',\n\t\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\n\t\t\t}\n\n\t\t\tthis._ready_wait = this.loadSettings()\n\t\t\t\t.then(() => {\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.info(`IDB ready in ${(performance.now() - this._start_time).toFixed(5)}ms`);\n\t\t\t\t\tthis.ready = true;\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.error(`IDB failed after ${(performance.now() - this._start_time).toFixed(5)}ms:`, err);\n\t\t\t\t\tthis.ready = false;\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._ready_wait = null;\n\t\t\t\t});\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis.disable();\n\t\tthis._cached.clear();\n\t}\n\n\tdisable() {\n\t\tthis.disabled = true;\n\t\tthis.removeListeners();\n\n\t\tif ( this.db ) {\n\t\t\tthis.db.close();\n\t\t\tthis.db = null;\n\t\t}\n\t}\n\n\tprivate removeListeners() {\n\t\tif ( this._broadcaster ) {\n\t\t\tif ( this._boundHandleMessage )\n\t\t\t\tthis._broadcaster.removeEventListener('message', this._boundHandleMessage);\n\t\t\tthis._broadcaster.close();\n\t\t\tthis._boundHandleMessage = this._broadcaster = null;\n\t\t}\n\t}\n\n\tbroadcastTransfer() {\n\t\tthis.broadcast({type: 'change-provider'});\n\t}\n\n\tdisableEvents() {\n\t\tthis.removeListeners();\n\t\tthis.broadcast = () => {};\n\t\tthis.emit = () => {};\n\t}\n\n\n\t_onStart(obj: unknown) {\n\t\tif ( ! this._pending )\n\t\t\tthis._pending = new Set<any>;\n\n\t\tthis._pending.add(obj);\n\t}\n\n\t_onFinish(obj: unknown) {\n\t\tif ( this._pending ) {\n\t\t\tthis._pending.delete(obj);\n\n\t\t\tif ( this._pending.size )\n\t\t\t\treturn;\n\t\t}\n\n\t\tif ( this._flush_wait_resolve )\n\t\t\tthis._flush_wait_resolve();\n\t}\n\n\tflush() {\n\t\tif ( this._flush_wait )\n\t\t\treturn this._flush_wait;\n\n\t\tif ( ! this._pending || ! this._pending.size )\n\t\t\treturn Promise.resolve();\n\n\t\treturn this._flush_wait = new Promise<void>(resolve => {\n\t\t\tthis._flush_wait_resolve = resolve\n\t\t}).finally(() => {\n\t\t\tthis._flush_wait_resolve = null;\n\t\t\tthis._flush_wait = null;\n\t\t});\n\t}\n\n\n\tbroadcast(msg: any) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\n\thandleMessage(event: MessageEvent) {\n\t\tif ( this.disabled || ! event.isTrusted || ! event.data )\n\t\t\treturn;\n\n\t\tif ( this.manager )\n\t\t\tthis.manager.log.debug('storage broadcast event', event.data);\n\t\tconst {type, key} = event.data;\n\n\t\tif ( type === 'change-provider') {\n\t\t\tthis.manager.log.info('Received notice of changed settings provider.');\n\t\t\tthis.emit('change-provider');\n\t\t\tthis.disable();\n\t\t\tthis.disableEvents();\n\n\t\t} else if ( type === 'set' ) {\n\t\t\tthis._get(key).then(val => {\n\t\t\t\tthis._cached.set(key, val);\n\t\t\t\tthis.emit('changed', key, val, false);\n\t\t\t}).catch(err => this.manager && this.manager.log.error(`Error getting setting \"${key}\" from database`, err));\n\n\t\t} else if ( type === 'delete' ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'clear' ) {\n\t\t\tconst old_keys = Array.from(this._cached.keys());\n\t\t\tthis._cached.clear();\n\t\t\tfor(const key of old_keys)\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'set-blob' ) {\n\t\t\tthis.emit('changed-blob', key, false);\n\t\t} else if ( type === 'delete-blob' ) {\n\t\t\tthis.emit('changed-blob', key, true);\n\t\t} else if ( type === 'clear-blobs' ) {\n\t\t\tthis.emit('clear-blobs');\n\t\t}\n\t}\n\n\n\tawaitReady() {\n\t\tif ( this._ready_wait )\n\t\t\treturn this._ready_wait;\n\n\t\tif ( this.ready )\n\t\t\treturn Promise.resolve();\n\n\t\treturn Promise.reject();\n\t}\n\n\n\t// Synchronous Methods\n\n\tget<T>(key: string, default_value?: T): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\tthis._set(key, value)\n\t\t\t.then(() => this.broadcast({type: 'set', key}))\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error saving setting \"${key}\" to database`, err));\n\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis._cached.delete(key);\n\t\tthis._delete(key)\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error deleting setting \"${key}\" from database`, err))\n\t\t\t.then(() => this.broadcast({type: 'delete', key}));\n\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\treturn this._cached.has(key);\n\t}\n\n\tkeys() {\n\t\treturn this._cached.keys();\n\t}\n\n\tclear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\n\t\tfor(const key of old_cache.keys())\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\tthis._clear()\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error clearing database`, err))\n\t\t\t.then(() => this.broadcast({type: 'clear'}));\n\t}\n\n\tentries() {\n\t\treturn this._cached.entries();\n\t}\n\n\tget size() {\n\t\treturn this._cached.size;\n\t}\n\n\n\t// IDB Interaction\n\n\tgetDB(second = false) {\n\t\tif ( this.db )\n\t\t\treturn Promise.resolve(this.db);\n\n\t\tif ( this._db_wait )\n\t\t\treturn this._db_wait;\n\n\t\tlet this_wait: Promise<IDBDatabase>;\n\t\treturn this._db_wait = this_wait = new Promise<IDBDatabase>((resolve, reject) => {\n\n\t\t\tconst request = window.indexedDB.open('FFZ', DB_VERSION);\n\t\t\tthis._onStart(request);\n\n\t\t\trequest.onerror = event => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error opening database.', event);\n\n\t\t\t\treject(event);\n\t\t\t\tthis._onFinish(request);\n\t\t\t}\n\n\t\t\trequest.onupgradeneeded = event => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.info(`Upgrading database from version ${event.oldVersion} to ${DB_VERSION}`);\n\n\t\t\t\tconst db = request.result;\n\n\t\t\t\tdb.createObjectStore('settings', {keyPath: 'k'});\n\t\t\t\tdb.createObjectStore('blobs');\n\t\t\t}\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.info(`Database opened. (After: ${(performance.now() - this._start_time).toFixed(5)}ms)`);\n\n\t\t\t\tthis.db = request.result;\n\n\t\t\t\ttry {\n\t\t\t\t\tconst trx = this.db.transaction(['settings', 'blobs'], 'readonly');\n\t\t\t\t\ttrx.objectStore('settings');\n\t\t\t\t\ttrx.objectStore('blobs');\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// If this is an error, the database is in an invalid state.\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.error(`Database in invalid state.`, err);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.db.close();\n\t\t\t\t\t} catch(e) { /* no-op */ }\n\n\t\t\t\t\tthis._onFinish(request);\n\t\t\t\t\tthis.db = null;\n\n\t\t\t\t\tif ( second )\n\t\t\t\t\t\treject(err);\n\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Try deleting the database and making a new one.\n\t\t\t\t\t\tconst delreq = window.indexedDB.deleteDatabase('FFZ');\n\t\t\t\t\t\tthis._onStart(delreq);\n\n\t\t\t\t\t\tdelreq.onerror = event => {\n\t\t\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\t\t\tthis.manager.log.error('Error deleting invalid database.', event);\n\t\t\t\t\t\t\treject(event);\n\t\t\t\t\t\t\tthis._onFinish(delreq);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelreq.onsuccess = () => {\n\t\t\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\t\t\tthis.manager.log.info('Deleted invalid database.');\n\n\t\t\t\t\t\t\tthis._onFinish(delreq);\n\t\t\t\t\t\t\tthis._db_wait = null;\n\t\t\t\t\t\t\tthis.getDB(true)\n\t\t\t\t\t\t\t\t.then(resolve)\n\t\t\t\t\t\t\t\t.catch(reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tresolve(this.db);\n\t\t\t\tthis._onFinish(request);\n\t\t\t}\n\t\t}).finally(() => {\n\t\t\tif ( this_wait === this._db_wait )\n\t\t\t\tthis._db_wait = null;\n\t\t});\n\t}\n\n\n\tasync loadSettings() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading settings from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst request = store.getAll();\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tfor(const entry of request.result)\n\t\t\t\t\tthis._cached.set(entry.k, entry.v);\n\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\trequest.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading settings from database.', err);\n\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _getKeys() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<IDBValidKey[]>((resolve,fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading keys from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst request = store.getAllKeys();\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve(request.result);\n\t\t\t};\n\n\t\t\trequest.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading keys from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\t\t});\n\t}\n\n\n\tasync _get(key: string) {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<any>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading value from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.get(key);\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading value from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve(req.result.v);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _set(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted setting value to database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.put({k: key, v: value});\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error setting value to database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _delete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted deleting value from database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.delete(key);\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error deleting value from database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t}\n\n\n\tasync _clear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted clearing database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.clear();\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error clearing database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t}\n\n\t/* Blobs */\n\n\tasync getBlob(key: string) {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readonly'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<BlobLike>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.get(key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = e => {\n\t\t\t\tif ( isValidBlob(req.result) )\n\t\t\t\t\tresolve(req.result);\n\t\t\t\telse\n\t\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync setBlob(key: string, value: BlobLike) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( ! this.isValidBlob(value) )\n\t\t\tthrow new Error('Invalid blob type');\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.put(value, key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'set-blob', key});\n\t\t\t\tthis.emit('set-blob', key, value, false);\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync deleteBlob(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.delete(key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'delete-blob', key});\n\t\t\t\tthis.emit('set-blob', key, undefined, true);\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync hasBlob(key: string) {\n\t\tconst keys = await this.blobKeys();\n\t\treturn keys.includes(key);\n\t}\n\n\tasync clearBlobs() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = fail;\n\t\t\tconst req = store.clear();\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'clear-blobs'});\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync blobKeys() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readonly'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<string[]>((resolve, fail) => {\n\t\t\tconst req = store.getAllKeys();\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tif ( Array.isArray(req.result) )\n\t\t\t\t\tresolve(req.result as string[]);\n\t\t\t\telse\n\t\t\t\t\tfail();\n\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n}\n\n\n// ============================================================================\n// CrossOriginStorageBridge\n// ============================================================================\n\nexport class CrossOriginStorageBridge extends RemoteSettingsProvider {\n\n\t// Static Stuff\n\n\tstatic supported() { return NOT_WWW_TWITCH && NOT_WWW_YT; }\n\tstatic hasContent() {\n\t\treturn CrossOriginStorageBridge.supported();\n\t}\n\n\tstatic priority = 100;\n\tstatic title = 'Cross-Origin Storage Bridge';\n\tstatic description = 'This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don\\'t want your settings to automatically synchronize for some reason.';\n\n\tstatic allowTransfer = false;\n\tstatic shouldUpdate = false;\n\n\t// State and Storage\n\tprivate frame: HTMLIFrameElement | null;\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tconst frame = this.frame = document.createElement('iframe');\n\t\tframe.src = (this.manager.root as any).host === 'youtube' ?\n\t\t\t'//www.youtube.com/__ffz_bridge/' :\n\t\t\t'//www.twitch.tv/p/ffz_bridge/';\n\t\tframe.id = 'ffz-settings-bridge';\n\t\tframe.style.width = '0';\n\t\tframe.style.height = '0';\n\n\t\tthis.onMessage = this.onMessage.bind(this);\n\n\t\twindow.addEventListener('message', this.onMessage);\n\t\tdocument.body.appendChild(frame);\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\tdisableEvents() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\n\t// CORS Communication\n\n\tonMessage(event: MessageEvent) {\n\t\tconst msg = event.data;\n\t\tif ( ! msg || ! msg.ffz_type )\n\t\t\treturn;\n\n\t\tthis.handleMessage(msg);\n\t}\n\n\tsend(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>) {\n\t\tif ( typeof msg === 'string' )\n\t\t\tmsg = {ffz_type: msg} as any;\n\n\t\ttry {\n\t\t\t// as any, because we have an error catcher for a reason\n\t\t\t((this.frame as any).contentWindow as unknown as Window).postMessage(\n\t\t\t\tmsg,\n\t\t\t\t'*',\n\t\t\t\ttransfer ? (Array.isArray(transfer) ? transfer : [transfer]) : undefined\n\t\t\t);\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error('Error sending message to bridge.', err, msg, transfer);\n\t\t}\n\t}\n\n}\n\n\n// ============================================================================\n// ExtensionProvider\n// ============================================================================\n\nexport class ExtensionProvider extends RemoteSettingsProvider {\n\n\t// Static Stuff\n\n\tstatic supported() { return EXTENSION }\n\n\tstatic hasContent() {\n\t\tif ( ! ExtensionProvider.supported() )\n\t\t\treturn false;\n\n\t\t// We need a promise since we need to message the extension and\n\t\t// request to know if it has keys or not.\n\t\treturn new Promise<boolean>((resolve) => {\n\t\t\tlet responded = false,\n\t\t\t\ttimeout: ReturnType<typeof setTimeout> | null = null ;\n\n\t\t\tconst listener = (evt: MessageEvent<any>) => {\n\t\t\t\tif (evt.source !== window)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (evt.data && evt.data.type === 'ffz_from_ext') {\n\t\t\t\t\tconst msg = evt.data.data,\n\t\t\t\t\t\ttype = msg?.ffz_type;\n\n\t\t\t\t\tif (type === 'has-keys') {\n\t\t\t\t\t\tresponded = true;\n\t\t\t\t\t\tresolve(msg.value);\n\t\t\t\t\t\tcleanup();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst cleanup = () => {\n\t\t\t\tif (!responded) {\n\t\t\t\t\tresponded = true;\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\n\t\t\t\twindow.removeEventListener('message', listener);\n\t\t\t}\n\n\t\t\twindow.addEventListener('message', listener);\n\n\t\t\twindow.postMessage({\n\t\t\t\ttype: 'ffz_to_ext',\n\t\t\t\tdata: {\n\t\t\t\t\tffz_type: 'check-has-keys'\n\t\t\t\t}\n\t\t\t}, '*');\n\n\t\t\ttimeout = setTimeout(cleanup, 1000);\n\t\t});\n\t}\n\n\tstatic priority = 101;\n\tstatic title = 'Browser Extension Storage';\n\tstatic description = 'This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.';\n\n\tstatic allowTransfer = true;\n\tstatic shouldUpdate = true;\n\n\t// State and Storage\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tthis.onExtMessage = this.onExtMessage.bind(this);\n\t\twindow.addEventListener('message', this.onExtMessage);\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\n\t}\n\n\tdisableEvents() {\n\n\t}\n\n\t// Communication\n\n\tonExtMessage(evt: MessageEvent<any>) {\n\t\tif (evt.source !== window)\n\t\t\treturn;\n\n\t\tif (evt.data?.type === 'ffz_from_ext' && evt.data.data?.ffz_type)\n\t\t\tthis.handleMessage(evt.data.data);\n\t}\n\n\tsend(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>) {\n\t\tif ( typeof msg === 'string' )\n\t\t\tmsg = {ffz_type: msg} as any;\n\n\t\ttry {\n\t\t\twindow.postMessage(\n\t\t\t\t{\n\t\t\t\t\ttype: 'ffz_to_ext',\n\t\t\t\t\tdata: msg\n\t\t\t\t},\n\t\t\t\t'*',\n\t\t\t\ttransfer ? (Array.isArray(transfer) ? transfer : [transfer]) : undefined\n\t\t\t);\n\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error('Error sending message to extension.', err, msg, transfer);\n\t\t}\n\t}\n\n}\n\n\n\ntype CorsRpcTypes = {\n\n\t'ready': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'load': {\n\t\tinput: void;\n\t\toutput: Record<string, any>;\n\t};\n\n\t'change': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: any;\n\t\t\tdeleted: boolean;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'init-load': {\n\t\tinput: void;\n\t\toutput: {\n\t\t\tblobs: boolean;\n\t\t\tvalues: Record<string, any>;\n\t\t}\n\t};\n\n\t'set': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: any;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'delete': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'clear': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'get-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: SerializedBlobLike | null;\n\t};\n\n\t'set-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: SerializedBlobLike | null;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'change-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tdeleted: boolean;\n\t\t};\n\t\toutput: void;\n\t}\n\n\t'delete-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'has-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: boolean;\n\t};\n\n\t'clear-blobs': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'blob-keys': {\n\t\tinput: void;\n\t\toutput: string[];\n\t};\n\n\t'flush': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n};\n\ntype CorsInput<K extends keyof CorsRpcTypes> = CorsRpcTypes[K] extends { input: infer U } ? U : void;\ntype CorsOutput<K extends keyof CorsRpcTypes> = CorsRpcTypes[K] extends { output: infer U } ? U : void;\n\ntype RPCInputMessage<K extends keyof CorsRpcTypes> = {\n\tffz_type: K;\n\tid?: number;\n} & CorsInput<K>;\n\ntype CorsReplyMessage = {\n\tffz_type: 'reply';\n\tid: number;\n\treply: any;\n};\n\ntype CorsReplyErrorMessage = {\n\tffz_type: 'reply-error';\n\tid: number;\n};\n\ntype CorsMessage = CorsReplyMessage | CorsReplyErrorMessage | {\n\t[K in keyof CorsRpcTypes]: RPCInputMessage<K>\n}[keyof CorsRpcTypes];\n\n\n\n// ============================================================================\n// Available Providers Map\n// ============================================================================\n\nexport const Providers: Record<string, typeof SettingsProvider> = {\n\n\tlocal: LocalStorageProvider,\n\tidb: IndexedDBProvider,\n\tcosb: CrossOriginStorageBridge,\n\t//ext: ExtensionProvider\n\n};\n","'use strict';\n\nimport { AdvancedSettingsProvider } from \"./providers\";\nimport type { SettingsClearable } from \"./types\";\n\n// ============================================================================\n// Clearable Settings\n// ============================================================================\n\nexport const Experiments: SettingsClearable = {\n\tlabel: 'Experiment Overrides',\n\tkeys: [\n\t\t'exp-lock',\n\t\t'experiment-overrides'\n\t]\n};\n\nexport const HiddenEmotes: SettingsClearable = {\n\tlabel: 'Hidden Emotes',\n\tkeys(provider) {\n\t\tconst keys = ['emote-menu.hidden-sets'];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( key.startsWith('hidden-emotes.') )\n\t\t\t\tkeys.push(key);\n\n\t\treturn keys;\n\t}\n};\n\nexport const FavoriteEmotes: SettingsClearable = {\n\tlabel: 'Favorited Emotes',\n\tkeys(provider) {\n\t\tconst keys = [];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( key.startsWith('favorite-emotes.') )\n\t\t\t\tkeys.push(key);\n\n\t\treturn keys;\n\t}\n};\n\nexport const Overrides: SettingsClearable = {\n\tlabel: 'Name and Color Overrides',\n\tkeys: [\n\t\t'overrides.colors',\n\t\t'overrides.names'\n\t]\n};\n\nexport const Profiles: SettingsClearable = {\n\tlabel: 'Profiles',\n\tclear(provider, settings) {\n\t\tconst keys = ['profiles'];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( /^p:\\d+:/.test(key) )\n\t\t\t\tkeys.push(key);\n\n\t\tfor(const key of keys)\n\t\t\tprovider.delete(key);\n\n\t\tsettings.loadProfiles();\n\t}\n};\n\nexport const Everything: SettingsClearable = {\n\tlabel: 'Absolutely Everything',\n\tasync clear(provider, settings) {\n\t\tprovider.clear();\n\t\tif ( provider.supportsBlobs && provider instanceof AdvancedSettingsProvider )\n\t\t\tawait provider.clearBlobs();\n\n\t\tsettings.loadProfiles();\n\t}\n};\n","'use strict';\n\n// ============================================================================\n// Settings System\n// ============================================================================\n\nimport { DEBUG } from 'utilities/constants';\nimport Module, { GenericModule, buildAddonProxy } from 'utilities/module';\nimport {deep_equals, has, debounce, deep_copy, generateUUID} from 'utilities/object';\nimport {PathNode, parse as parse_path} from 'utilities/path-parser';\n\nimport SettingsProfile from './profile';\nimport SettingsContext from './context';\n\nimport * as PROCESSORS from './processors';\nimport * as VALIDATORS from './validators';\nimport * as FILTERS from './filters';\nimport * as CLEARABLES from './clearables';\n\nimport type { SettingsProfileMetadata, ContextData, ExportedFullDump, SettingsClearable, SettingDefinition, SettingProcessor, SettingUiDefinition, SettingValidator, SettingType, ExportedBlobMetadata, SettingsKeys, AllSettingsKeys, ConcreteLocalStorageData } from './types';\nimport type { FilterType } from 'utilities/filtering';\nimport { AdvancedSettingsProvider, IndexedDBProvider, LocalStorageProvider, Providers, type SettingsProvider } from './providers';\nimport type { AddonInfo, SettingsTypeMap } from 'utilities/types';\n\nexport {parse as parse_path} from 'utilities/path-parser';\n\n\n// TODO: Special types for msg.\nfunction postMessage(target: MessageEventSource, msg: any) {\n\ttry {\n\t\t(target as Window).postMessage(msg, '*');\n\t\treturn true;\n\t} catch(err) {\n\t\treturn false;\n\t}\n}\n\nexport const NO_SYNC_KEYS = ['session'];\n\n\n// ============================================================================\n// Registration\n// ============================================================================\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\tsettings: SettingsEvents;\n\t}\n\tinterface ModuleMap {\n\t\tsettings: SettingsManager;\n\t}\n}\n\n\n// ============================================================================\n// Events\n// ============================================================================\n\n// TODO: Check settings keys for better typing on events.\n\nexport type SettingsEvents = {\n\t[K in keyof SettingsTypeMap as `:changed:${K}`]: [value: SettingsTypeMap[K], old_value: SettingsTypeMap[K]];\n} & {\n\t[key: `:uses_changed:${string}`]: [uses: number[] | null, old_uses: number[] | null];\n\n\t':added-definition': [key: SettingsKeys, definition: SettingDefinition<any>];\n\t':removed-definition': [key: SettingsKeys, definition: SettingDefinition<any>];\n\n\t':quota-exceeded': [];\n\t':change-provider': [];\n\n\t':ls-update': [key: string, value: any];\n\n\t':profile-created': [profile: SettingsProfile];\n\t':profile-changed': [profile: SettingsProfile];\n\t':profile-deleted': [profile: SettingsProfile];\n\t':profile-toggled': [profile: SettingsProfile, enabled: boolean];\n\t':profiles-reordered': [];\n};\n\n\n// ============================================================================\n// SettingsManager\n// ============================================================================\n\n/**\n * The SettingsManager module creates all the necessary class instances\n * required for the settings system to operate, facilitates communication\n * and discovery, and emits events for other modules to react to.\n */\nexport default class SettingsManager extends Module<'settings', SettingsEvents> {\n\n\t_start_time: number;\n\n\t// localStorage Hooks\n\tprivate __ls_hooked: boolean;\n\tprivate __ls_scheduled: Set<string>;\n\tprivate __ls_cache: Map<string, unknown>;\n\tprivate __ls_timer?: ReturnType<typeof setTimeout> | null;\n\n\n\t// Storage of Things\n\tclearables: Record<string, SettingsClearable>;\n\tfilters: Record<string, FilterType<any, ContextData>>;\n\tprocessors: Record<string, SettingProcessor<any>>;\n\tproviders: Record<string, typeof SettingsProvider>;\n\tvalidators: Record<string, SettingValidator<any>>;\n\n\t// Storage of Settings\n\tui_structures: Map<string, SettingDefinition<any>>;\n\tdefinitions: Map<string, SettingDefinition<any> | string[]>;\n\n\t// Storage of State\n\t// The provider *can* technically be null but it won't ever be in practice.\n\t// So we don't set the type to null to avoid making annoying checks everywhere.\n\tprovider: SettingsProvider = null as any;\n\tmain_context: SettingsContext;\n\n\tprivate _context_proxies: Set<MessageEventSource>;\n\n\tprivate _update_timer?: ReturnType<typeof setTimeout> | null;\n\tprivate _time_timer?: ReturnType<typeof setTimeout> | null;\n\tprivate _time_next?: number | null;\n\n\tprivate _active_provider: string = 'local';\n\n\tprivate _provider_waiter?: Promise<SettingsProvider> | null;\n\tprivate _provider_resolve?: ((input: SettingsProvider) => void) | null;\n\n\t/** @internal */\n\t__contexts: SettingsContext[];\n\t/** @internal */\n\t__profiles: SettingsProfile[];\n\tprivate __profile_ids: Record<number, SettingsProfile | null>;\n\tprivate __profile_uuids: Record<string, SettingsProfile | null>;\n\n\t/**\n\t * Whether or not profiles have been disabled for this session\n\t */\n\tdisable_profiles: boolean = false;\n\n\tupdateSoon: () => void;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.providers = {};\n\t\tfor(const [key, provider] of Object.entries(Providers)) {\n\t\t\tif ( provider.supported() )\n\t\t\t\tthis.providers[key] = provider;\n\t\t}\n\n\t\t// This cannot be modified at a future time, as providers NEED\n\t\t// to be ready very early in FFZ intitialization. Seal it.\n\t\tObject.seal(this.providers);\n\n\t\tthis.updateSoon = debounce(() => this.updateRoutes(), 50, false);\n\n\t\t// Do we want to not enable any profiles?\n\t\ttry {\n\t\t\tconst params = new URL(window.location as any).searchParams;\n\t\t\tif ( params ) {\n\t\t\t\tif ( params.has('ffz-no-settings') )\n\t\t\t\t\tthis.disable_profiles = true;\n\t\t\t}\n\t\t} catch(err) { /* no-op */ }\n\n\t\t// Local Storage\n\t\tthis.__ls_scheduled = new Set;\n\t\tthis.__ls_cache = new Map;\n\t\tthis.__ls_hooked = false;\n\t\tthis._updateLS = this._updateLS.bind(this);\n\n\t\t// State\n\t\tthis.__contexts = [];\n\t\tthis.__profiles = [];\n\t\tthis.__profile_ids = {};\n\t\tthis.__profile_uuids = {};\n\n\t\tthis.ui_structures = new Map;\n\t\tthis.definitions = new Map;\n\n\t\t// Validators\n\t\tthis.validators = {};\n\n\t\tfor(const key in VALIDATORS)\n\t\t\tif ( has(VALIDATORS, key) )\n\t\t\t\tthis.validators[key] = VALIDATORS[key];\n\n\t\t// Processors\n\t\tthis.processors = {};\n\n\t\tfor(const key in PROCESSORS)\n\t\t\tif ( has(PROCESSORS, key) )\n\t\t\t\tthis.processors[key] = PROCESSORS[key];\n\n\t\t// Clearable Data Rules\n\t\tthis.clearables = {};\n\n\t\tfor(const key in CLEARABLES)\n\t\t\tif ( has(CLEARABLES, key) )\n\t\t\t\tthis.clearables[key] = CLEARABLES[key];\n\n\t\t// Filters\n\t\tthis.filters = {};\n\n\t\tfor(const key in FILTERS)\n\t\t\tif ( has(FILTERS, key) && FILTERS[key] )\n\t\t\t\tthis.filters[key] = FILTERS[key];\n\n\n\t\t// Create our provider as early as possible.\n\t\tthis._createProvider().then(provider => {\n\t\t\tthis.provider = provider;\n\t\t\tthis.log.info(`Using Provider: ${provider.constructor.name}`);\n\t\t\tprovider.on('changed', this._onProviderChange, this);\n\t\t\tprovider.on('quota-exceeded', (err) => {\n\t\t\t\tthis.emit(':quota-exceeded');\n\t\t\t});\n\t\t\tprovider.on('change-provider', () => {\n\t\t\t\tthis.emit(':change-provider');\n\t\t\t});\n\n\t\t\tif ( this._provider_resolve )\n\t\t\t\tthis._provider_resolve(provider);\n\t\t});\n\n\t\t//this.migrations = new MigrationManager(this);\n\n\t\t// Also create the main context as early as possible.\n\t\tthis.main_context = new SettingsContext(this);\n\n\t\tthis.main_context.on('changed', (key: keyof SettingsTypeMap, new_value, old_value) => {\n\t\t\tthis.emit(`:changed:${key}`, new_value, old_value);\n\t\t});\n\n\t\tthis.main_context.on('uses_changed', (key: keyof SettingsTypeMap, new_uses, old_uses) => {\n\t\t\tthis.emit(`:uses_changed:${key}`, new_uses, old_uses);\n\t\t});\n\n\t\tthis.main_context.on('context_changed', () => this._updateContextProxies());\n\t\tthis._context_proxies = new Set;\n\n\t\twindow.addEventListener('message', event => {\n\t\t\tconst type = event.data?.ffz_type;\n\n\t\t\tif ( type === 'open-settings' )\n\t\t\t\tthis.emit('main_menu:open');\n\n\t\t\telse if ( type === 'request-context' && event.source ) {\n\t\t\t\tthis._context_proxies.add(event.source);\n\t\t\t\tthis._updateContextProxies(event.source);\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('beforeunload', () => {\n\t\t\tfor(const proxy of this._context_proxies)\n\t\t\t\tpostMessage(proxy, {ffz_type: 'context-gone'});\n\t\t});\n\n\t\t// Don't wait around to be required.\n\t\tthis._start_time = performance.now();\n\t\tthis.enable();\n\t}\n\n\t_updateContextProxies(proxy?: MessageEventSource) {\n\t\tif ( ! proxy && ! this._context_proxies.size )\n\t\t\treturn;\n\n\t\tconst ctx = JSON.parse(JSON.stringify(this.main_context._context));\n\t\tfor(const key of NO_SYNC_KEYS)\n\t\t\tif ( has(ctx, key) )\n\t\t\t\tdelete ctx[key];\n\n\t\tif ( proxy )\n\t\t\tpostMessage(proxy, {ffz_type: 'context-update', ctx});\n\t\telse\n\t\t\tfor(const proxy of this._context_proxies)\n\t\t\t\tpostMessage(proxy, {ffz_type: 'context-update', ctx});\n\t}\n\n\n\taddFilter<T>(key: string, data: FilterType<T, ContextData>) {\n\t\tif ( this.filters[key] )\n\t\t\treturn this.log.warn('Tried to add already existing filter', key);\n\n\t\tthis.filters[key] = data;\n\t\tthis.updateRoutes();\n\t}\n\n\tgetFilterBasicEditor() { // eslint-disable-line class-methods-use-this\n\t\treturn () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = [];\n\t\tfor(const [key, value] of (this.main_context as any).__cache.entries())\n\t\t\tout.push(`${key}: ${JSON.stringify(value)}`);\n\n\t\treturn out.join('\\n');\n\t}\n\n\tawaitProvider() {\n\t\tif ( this.provider )\n\t\t\treturn Promise.resolve(this.provider);\n\n\t\tif ( this._provider_waiter )\n\t\t\treturn this._provider_waiter;\n\n\t\treturn this._provider_waiter = new Promise<SettingsProvider>((resolve, reject) => {\n\t\t\tthis._provider_resolve = resolve;\n\t\t}).finally(() => {\n\t\t\tthis._provider_waiter = null;\n\t\t\tthis._provider_resolve = null;\n\t\t});\n\t}\n\n\n\t/**\n\t * Called when the SettingsManager instance should be enabled.\n\t */\n\tasync onEnable() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\tthrow new Error('did not get provider');\n\n\t\tawait this.provider.awaitReady();\n\n\t\t// When the router updates we additional routes, make sure to\n\t\t// trigger a rebuild of profile context and re-select profiles.\n\t\tthis.on('site.router:updated-routes', this.updateRoutes, this);\n\n\t\t// Load profiles, but don't run any events because we haven't done\n\t\t// migrations yet.\n\t\tthis.loadProfiles(true);\n\n\t\t// Handle migrations.\n\t\t//await this.migrations.process('core');\n\n\t\t// Now we can tell our context(s) about the profiles we have.\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tconst duration = performance.now() - this._start_time;\n\t\tthis.log.info(`Initialization complete after ${duration.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`)\n\n\t\tthis.scheduleUpdates();\n\t\tthis.updateClock();\n\t}\n\n\n\tasync createMonitorUpdate() {\n\t\tconst Monitor = FILTERS?.Monitor;\n\t\tif ( ! Monitor || Monitor.details !== undefined )\n\t\t\treturn;\n\n\t\tMonitor.details = null;\n\t\ttry {\n\t\t\tif ( window.getScreenDetails ) {\n\t\t\t\tMonitor.details = await window.getScreenDetails();\n\t\t\t\tMonitor.details.addEventListener('currentscreenchange', () => {\n\t\t\t\t\tfor(const context of this.__contexts)\n\t\t\t\t\t\tcontext.selectProfiles();\n\t\t\t\t});\n\t\t\t} else\n\t\t\t\tMonitor.details = false;\n\n\t\t} catch(err) {\n\t\t\tthis.log.error('Unable to get monitor details', err);\n\t\t\tMonitor.details = false;\n\t\t}\n\t}\n\n\n\tupdateClock() {\n\t\tconst captured = FILTERS?.Time?.captured?.();\n\t\tif ( ! captured?.length )\n\t\t\treturn;\n\n\t\tif ( this._time_timer )\n\t\t\tclearTimeout(this._time_timer);\n\n\t\tconst d = new Date,\n\t\t\tnow = d.getHours() * 60 + d.getMinutes();\n\n\t\tlet next = this._time_next != null ? this._time_next : null;\n\t\tfor(const value of captured) {\n\t\t\tif ( value <= now )\n\t\t\t\tcontinue;\n\n\t\t\tif ( next == null || value < next )\n\t\t\t\tnext = value;\n\t\t}\n\n\t\t// There's no time waiting for today. Skip to the next day.\n\t\tif ( next == null )\n\t\t\tnext = captured[0] + 1440;\n\n\t\t// Determine how long it'll take to reach the next time period.\n\t\tconst delta = (next - now) * 60 * 1000 - 59750 + (60000 - Date.now() % 60000);\n\t\tthis._time_timer = setTimeout(() => {\n\t\t\tfor(const context of this.__contexts)\n\t\t\t\tcontext.selectProfiles();\n\n\t\t\tthis.updateClock();\n\t\t}, delta);\n\t}\n\n\n\t// ========================================================================\n\t// LocalStorage Management\n\t// ========================================================================\n\n\tprivate _updateLSKey(key: string) {\n\t\tif ( this.__ls_cache.has(key) || this.__ls_cache.has(`raw.${key}`) ) {\n\t\t\tthis.__ls_scheduled.add(key);\n\t\t\tif ( ! this.__ls_timer )\n\t\t\t\tthis.__ls_timer = setTimeout(this._updateLS, 0);\n\t\t}\n\n\n\n\t}\n\n\tprivate _hookLS() {\n\t\tif ( this.__ls_hooked )\n\t\t\treturn;\n\n\t\tthis.__ls_hooked = true;\n\t\tconst original = localStorage.setItem,\n\t\t\tt = this;\n\n\t\tlocalStorage.setItem = function(key, ...args) {\n\t\t\t// Guard this because we never want to break\n\t\t\t// localStorage, even if something really\n\t\t\t// weird happens.\n\t\t\ttry {\n\t\t\t\tt._updateLSKey(key);\n\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\treturn original.call(this, key, ...args);\n\t\t}\n\n\t\tthis._handleLSEvent = this._handleLSEvent.bind(this);\n\t\twindow.addEventListener('storage', this._handleLSEvent);\n\t}\n\n\tprivate _handleLSEvent(event: StorageEvent) {\n\t\tif ( event.key && event.storageArea === localStorage )\n\t\t\tthis._updateLSKey(event.key);\n\t}\n\n\tprivate _updateLS() {\n\t\tclearTimeout(this.__ls_timer as ReturnType<typeof setTimeout>);\n\t\tthis.__ls_timer = null;\n\t\tconst keys = this.__ls_scheduled;\n\t\tthis.__ls_scheduled = new Set;\n\n\t\tfor(const key of keys) {\n\t\t\tconst has_value = this.__ls_cache.has(key),\n\t\t\t\traw_key = `raw.${key}`,\n\t\t\t\thas_raw = this.__ls_cache.has(raw_key);\n\n\t\t\tif ( ! has_raw && ! has_value )\n\t\t\t\tcontinue;\n\n\t\t\tconst raw = localStorage.getItem(key);\n\n\t\t\tif ( has_raw ) {\n\t\t\t\tthis.__ls_cache.set(raw_key, raw);\n\t\t\t\tthis.emit(':ls-update', raw_key, raw);\n\t\t\t}\n\n\t\t\tif ( has_value ) {\n\t\t\t\tlet value;\n\t\t\t\tif ( raw )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = JSON.parse(raw);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.log.warn(`Unable to parse localStorage value as JSON for \"${key}\"`, err);\n\t\t\t\t\t}\n\n\t\t\t\tthis.__ls_cache.set(key, value);\n\t\t\t\tthis.emit(':ls-update', key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetLS<T>(key: string): T | null {\n\t\tif ( this.__ls_cache.has(key) )\n\t\t\treturn this.__ls_cache.get(key) as T;\n\n\t\tif ( ! this.__ls_hooked )\n\t\t\tthis._hookLS();\n\n\t\tconst is_raw = key.startsWith('raw.'),\n\t\t\traw = localStorage.getItem(is_raw ? key.slice(4) : key);\n\n\t\tlet value;\n\t\tif ( is_raw )\n\t\t\tvalue = raw;\n\t\telse\n\t\t\ttry {\n\t\t\t\tvalue = raw ? JSON.parse(raw) : null;\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn(`Unable to parse localStorage value as JSON for \"${key}\"`, err);\n\t\t\t}\n\n\t\tthis.__ls_cache.set(key, value);\n\t\treturn value;\n\t}\n\n\n\t// ========================================================================\n\t// Backup and Restore\n\t// ========================================================================\n\n\tasync generateBackupFile() {\n\t\tconst now = new Date(),\n\t\t\ttimestamp = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;\n\n\t\tif ( await this._needsZipBackup() ) {\n\t\t\tconst blob = await this._getZipBackup();\n\t\t\treturn new File([blob], `ffz-settings (${timestamp}).zip`, {type: 'application/zip'});\n\t\t}\n\n\t\tconst settings = await this.getSettingsDump();\n\t\treturn new File([JSON.stringify(settings)], `ffz-settings (${timestamp}).json`, {type: 'application/json;charset=utf-8'});\n\t}\n\n\n\tprivate async _needsZipBackup() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\treturn false;\n\n\t\tawait this.provider.awaitReady();\n\n\t\tif ( !(this.provider instanceof AdvancedSettingsProvider) || ! this.provider.supportsBlobs )\n\t\t\treturn false;\n\n\t\tconst keys = await this.provider.blobKeys();\n\t\treturn Array.isArray(keys) ? keys.length > 0 : false;\n\t}\n\n\n\tprivate async _getZipBackup() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\tthrow new Error('provider not available');\n\n\t\tawait this.provider.awaitReady();\n\n\t\t// Create our ZIP file.\n\t\tconst JSZip = (await import(/* webpackChunkName: \"zip\" */ 'jszip')).default,\n\t\t\tout = new JSZip();\n\n\t\t// Normal Settings\n\t\tconst settings = await this.getSettingsDump();\n\t\tout.file('settings.json', JSON.stringify(settings));\n\n\t\t// Blob Settings\n\t\tconst metadata: Record<string, ExportedBlobMetadata> = {};\n\n\t\tif ( this.provider instanceof AdvancedSettingsProvider && this.provider.supportsBlobs ) {\n\t\t\tconst keys = await this.provider.blobKeys();\n\t\t\tfor(const key of keys) {\n\t\t\t\tconst safe_key = encodeURIComponent(key),\n\t\t\t\t\tblob = await this.provider.getBlob(key); // eslint-disable-line no-await-in-loop\n\t\t\t\tif ( ! blob )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst md: ExportedBlobMetadata = {\n\t\t\t\t\tkey\n\t\t\t\t};\n\n\t\t\t\tif ( blob instanceof File ) {\n\t\t\t\t\tmd.type = 'file';\n\t\t\t\t\tmd.name = blob.name;\n\t\t\t\t\tmd.modified = blob.lastModified;\n\t\t\t\t\tmd.mime = blob.type;\n\n\t\t\t\t} else if ( blob instanceof Blob ) {\n\t\t\t\t\tmd.type = 'blob';\n\n\t\t\t\t} else if ( blob instanceof ArrayBuffer ) {\n\t\t\t\t\tmd.type = 'ab';\n\t\t\t\t} else if ( blob instanceof Uint8Array ) {\n\t\t\t\t\tmd.type = 'ui8';\n\t\t\t\t} else\n\t\t\t\t\tcontinue;\n\n\t\t\t\tmetadata[safe_key] = md;\n\t\t\t\tout.file(`blobs/${safe_key}`, blob);\n\t\t\t}\n\t\t}\n\n\t\tout.file('blobs.json', JSON.stringify(metadata));\n\n\t\treturn out.generateAsync({type: 'blob'});\n\t}\n\n\n\tasync getSettingsDump() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\treturn null;\n\n\t\tawait this.provider.awaitReady();\n\n\t\tconst out: ExportedFullDump = {\n\t\t\tversion: 2,\n\t\t\ttype: 'full',\n\t\t\tvalues: {}\n\t\t};\n\n\t\tfor(const [key, value] of this.provider.entries())\n\t\t\tout.values[key] = value;\n\n\t\treturn out;\n\t}\n\n\n\tscheduleUpdates() {\n\t\tif ( this._update_timer )\n\t\t\tclearTimeout(this._update_timer);\n\n\t\tthis._update_timer = setTimeout(() => this.checkUpdates(), 5000);\n\t}\n\n\n\tasync checkUpdates() {\n\t\tawait this.awaitProvider();\n\t\tawait this.provider?.awaitReady();\n\n\t\tif ( ! this.provider?.shouldUpdate )\n\t\t\treturn;\n\n\t\tconst promises = [];\n\t\tfor(const profile of this.__profiles) {\n\t\t\tif ( ! profile || ! profile.url || profile.pause_updates )\n\t\t\t\tcontinue;\n\n\t\t\tconst out = profile.checkUpdate();\n\t\t\tpromises.push(out instanceof Promise ? out : Promise.resolve(out));\n\t\t}\n\n\t\tconst data = await Promise.all(promises);\n\n\t\tlet success = 0;\n\t\tfor(const thing of data)\n\t\t\tif ( thing )\n\t\t\t\tsuccess++;\n\n\t\tthis.log.info(`Successfully refreshed ${success} of ${data.length} profiles from remote URLs.`);\n\t}\n\n\n\t// ========================================================================\n\t// Provider Interaction\n\t// ========================================================================\n\n\t/**\n\t * Return an object with all the known, supported providers.\n\t * @returns {Object} The object.\n\t */\n\tgetProviders() {\n\t\treturn this.providers;\n\t}\n\n\t/**\n\t * Return the key of the active provider.\n\t * @returns {String} The key for the active provider\n\t */\n\tgetActiveProvider() {\n\t\treturn this._active_provider;\n\t}\n\n\t/**\n\t * Evaluate the environment that FFZ is running in and then decide which\n\t * provider should be used to retrieve and store settings.\n\t *\n\t * @returns {SettingsProvider} The provider to store everything.\n\t */\n\tasync _createProvider() {\n\t\t// If we should be using Cross-Origin Storage Bridge, do so.\n\t\t//if ( this.providers.cosb && this.providers.cosb.supported() )\n\t\t//\treturn new this.providers.cosb(this);\n\n\t\tlet wanted = localStorage.ffzProviderv2;\n\t\tif ( wanted == null )\n\t\t\twanted = localStorage.ffzProviderv2 = await this.sniffProvider();\n\n\t\tif ( this.providers[wanted] ) {\n\t\t\tconst provider = new (this.providers[wanted] as any)(this) as SettingsProvider;\n\t\t\tthis._active_provider = wanted;\n\t\t\treturn provider;\n\t\t}\n\n\t\t// Fallback to localStorage if nothing else was wanted and available.\n\t\tthis._active_provider = 'local';\n\t\treturn new LocalStorageProvider(this);\n\t}\n\n\n\t/**\n\t * Evaluate the environment and attempt to guess which provider we should\n\t * use for storing settings. This is necessary in case localStorage is\n\t * cleared while we have settings stored in IndexedDB.\n\t *\n\t * In the future, this may default to IndexedDB for new users.\n\t *\n\t * @returns {String} The key for which provider we should use.\n\t */\n\tasync sniffProvider() {\n\t\tconst providers = Array.from(Object.entries(this.providers));\n\t\tproviders.sort((a, b) =>\n\t\t\t((b[1] as any).priority ?? 0) -\n\t\t\t((a[1] as any).priority ?? 0)\n\t\t);\n\n\t\tfor(const [key, provider] of providers) {\n\t\t\tif ( provider.supported() && await provider.hasContent() ) // eslint-disable-line no-await-in-loop\n\t\t\t\treturn key;\n\t\t}\n\n\t\t// Fallback to local if no provider indicated present settings.\n\t\treturn 'local';\n\t}\n\n\t/**\n\t * Change to a new settings provider. This immediately prevents changes\n\t * to the old provider, and will reload the page when settings have\n\t * been transfered over.\n\t *\n\t * @param {String} key The key of the new provider to swap to.\n\t * @param {Boolean} transfer Whether or not settings should be transferred\n\t * from the current provider.\n\t */\n\tasync changeProvider(key: string, transfer: boolean) {\n\t\tif ( ! this.providers[key] || ! this.providers[key].supported() )\n\t\t\tthrow new Error(`Invalid provider: ${key}`);\n\n\t\t// If we're changing to the current provider... well, that doesn't make\n\t\t// a lot of sense, does it? Abort!\n\t\tif ( key === this._active_provider || ! this.provider )\n\t\t\treturn;\n\n\t\tconst old_provider = this.provider;\n\t\tthis.provider = null as any;\n\n\t\t// Let all other tabs know what's up.\n\t\told_provider.broadcastTransfer();\n\n\t\t// Are we transfering settings?\n\t\tif ( transfer ) {\n\t\t\tconst new_provider = new (this.providers[key] as any)(this) as SettingsProvider;\n\t\t\tawait new_provider.awaitReady();\n\n\t\t\tif ( new_provider.allowTransfer && old_provider.allowTransfer ) {\n\t\t\t\told_provider.disableEvents();\n\n\t\t\t\t// When transfering, we clear all existing settings.\n\t\t\t\tnew_provider.clear();\n\t\t\t\tif ( new_provider instanceof AdvancedSettingsProvider && new_provider.supportsBlobs )\n\t\t\t\t\tawait new_provider.clearBlobs();\n\n\t\t\t\t// Wait for it to do that.\n\t\t\t\tawait new_provider.flush();\n\n\t\t\t\tfor(const [key,val] of old_provider.entries())\n\t\t\t\t\tnew_provider.set(key, val);\n\n\t\t\t\tif ( old_provider instanceof AdvancedSettingsProvider && old_provider.supportsBlobs && new_provider instanceof AdvancedSettingsProvider && new_provider.supportsBlobs ) {\n\t\t\t\t\tfor(const key of await old_provider.blobKeys() ) {\n\t\t\t\t\t\tconst blob = await old_provider.getBlob(key); // eslint-disable-line no-await-in-loop\n\t\t\t\t\t\tif ( blob )\n\t\t\t\t\t\t\tawait new_provider.setBlob(key, blob); // eslint-disable-line no-await-in-loop\n\t\t\t\t\t}\n\n\t\t\t\t\tawait old_provider.clearBlobs();\n\t\t\t\t}\n\n\t\t\t\told_provider.clear();\n\n\t\t\t\tawait old_provider.flush();\n\t\t\t\tawait new_provider.flush();\n\t\t\t}\n\t\t}\n\n\t\t// Change over.\n\t\tlocalStorage.ffzProviderv2 = key;\n\t\tlocation.reload();\n\t}\n\n\n\t/**\n\t * React to a setting that has changed elsewhere. Generally, this is\n\t * the result of a setting being changed in another tab or, when cloud\n\t * settings are enabled, on another computer.\n\t */\n\t_onProviderChange(key: string, new_value: any, deleted: boolean) {\n\t\t// If profiles have changed, reload our profiles.\n\t\tif ( key === 'profiles' )\n\t\t\treturn this.loadProfiles();\n\n\t\tif ( ! key.startsWith('p:') )\n\t\t\treturn;\n\n\t\t// If we're still here, it means an individual setting was changed.\n\t\t// Look up the profile it belongs to and emit a changed event from\n\t\t// that profile, thus notifying any contexts or UI instances.\n\t\tkey = key.slice(2);\n\n\t\t// Is it a value?\n\t\tconst idx = key.indexOf(':');\n\t\tif ( idx === -1 )\n\t\t\treturn;\n\n\t\tconst profile = this.__profile_ids[key.slice(0, idx) as any],\n\t\t\ts_key = key.slice(idx + 1);\n\n\t\tif ( profile && ! profile.ephemeral ) {\n\t\t\tif ( s_key === ':enabled' )\n\t\t\t\tprofile.emit('toggled', profile, deleted ? true : new_value);\n\t\t\telse\n\t\t\t\tprofile.emit('changed', s_key, new_value, deleted);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Profile Management\n\t// ========================================================================\n\n\tupdateRoutes() {\n\t\t// Clear the existing matchers.\n\t\tfor(const profile of this.__profiles)\n\t\t\tprofile.clearMatcher();\n\n\t\t// And then re-select the active profiles.\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t}\n\n\n\t_onProfileToggled(profile: SettingsProfile, enabled: boolean) {\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t\tthis.emit(':profile-toggled', profile, enabled);\n\t}\n\n\n\t/**\n\t * Get an existing {@link SettingsProfile} instance.\n\t * @param id  - The id or uuid of the profile.\n\t */\n\tprofile(id: number | string): SettingsProfile | null {\n\t\treturn this.__profile_uuids[id] ?? this.__profile_ids[id as number] ?? null;\n\t}\n\n\n\t/**\n\t * Build {@link SettingsProfile} instances for all of the profiles\n\t * defined in storage, re-using existing instances when possible.\n\t */\n\tloadProfiles(suppress_events: boolean = false) {\n\t\tconst old_profile_ids = this.__profile_ids,\n\t\t\told_profile_uuids = this.__profile_uuids,\n\t\t\told_profiles = this.__profiles,\n\n\t\t\tprofile_ids: Record<number, SettingsProfile> = this.__profile_ids = {},\n\t\t\tprofiles: SettingsProfile[] = this.__profiles = [],\n\t\t\tprofile_uuids: Record<string, SettingsProfile> = this.__profile_uuids = {},\n\n\t\t\t// Create a set of actual IDs with a map from the profiles\n\t\t\t// list rather than just getting the keys from the ID map\n\t\t\t// because the ID map is an object and coerces its strings\n\t\t\t// to keys.\n\t\t\told_ids = new Set(old_profiles.map(x => x.id)),\n\n\t\t\tnew_ids = new Set<number>,\n\t\t\tchanged_ids = new Set<number>;\n\n\t\tlet raw_profiles = this.provider?.get<SettingsProfileMetadata[]>('profiles') ?? [\n\t\t\tSettingsProfile.Moderation,\n\t\t\tSettingsProfile.Default\n\t\t];\n\n\t\t// Sanity check. If we have no profiles, delete the old data.\n\t\tif ( ! raw_profiles?.length ) {\n\t\t\tthis.provider?.delete('profiles');\n\t\t\traw_profiles = [\n\t\t\t\tSettingsProfile.Moderation,\n\t\t\t\tSettingsProfile.Default\n\t\t\t];\n\t\t}\n\n\t\t// Update: Add UUIDs to all profiles.\n\t\tlet need_save = false;\n\n\t\tfor(const profile of raw_profiles) {\n\t\t\tif ( ! profile.uuid ) {\n\t\t\t\tneed_save = true;\n\n\t\t\t\tif ( profile.i18n_key === SettingsProfile.Default.i18n_key )\n\t\t\t\t\tprofile.uuid = SettingsProfile.Default.uuid as string;\n\t\t\t\telse if ( profile.i18n_key === SettingsProfile.Moderation.i18n_key )\n\t\t\t\t\tprofile.uuid = SettingsProfile.Moderation.uuid as string;\n\t\t\t\telse\n\t\t\t\t\tprofile.uuid = generateUUID();\n\t\t\t}\n\t\t}\n\n\t\tif ( need_save )\n\t\t\tthis.provider?.set('profiles', raw_profiles);\n\n\t\tlet reordered = false,\n\t\t\tchanged = false;\n\n\t\tfor(const profile of old_profiles) {\n\t\t\tprofile.off('toggled', this._onProfileToggled, this);\n\t\t\tprofile.hotkey_enabled = false;\n\t\t}\n\n\t\tfor(const profile_data of raw_profiles) {\n\t\t\tconst id = profile_data.id as number,\n\t\t\t\tslot_id = profiles.length,\n\t\t\t\told_profile = old_profile_ids[id],\n\t\t\t\told_slot_id = old_profile ? old_profiles.indexOf(old_profile) : -1;\n\n\t\t\told_ids.delete(id);\n\n\t\t\tif ( old_slot_id !== slot_id )\n\t\t\t\treordered = true;\n\n\t\t\tif ( old_profile && deep_equals(old_profile.data, profile_data, true) ) {\n\t\t\t\t// Did the order change?\n\t\t\t\tif ( old_slot_id !== slot_id )\n\t\t\t\t\tchanged = true;\n\n\t\t\t\tprofiles.push(profile_ids[id] = old_profile);\n\t\t\t\tprofile_uuids[old_profile.uuid] = old_profile;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst new_profile = profile_ids[id] = new SettingsProfile(this, profile_data);\n\t\t\tif ( old_profile ) {\n\t\t\t\told_profile.transferListeners(new_profile);\n\t\t\t\tchanged_ids.add(id);\n\n\t\t\t} else\n\t\t\t\tnew_ids.add(id);\n\n\t\t\tprofiles.push(new_profile);\n\t\t\tprofile_uuids[new_profile.uuid] = new_profile;\n\t\t\tchanged = true;\n\t\t}\n\n\t\tfor(const profile of profiles) {\n\t\t\tprofile.on('toggled', this._onProfileToggled, this);\n\t\t\tprofile.hotkey_enabled = true;\n\t\t}\n\n\t\tif ( ! changed && ! old_ids.size || suppress_events )\n\t\t\treturn;\n\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\n\t\tfor(const id of new_ids)\n\t\t\tthis.emit(':profile-created', profile_ids[id]);\n\n\t\tfor(const id of changed_ids)\n\t\t\tthis.emit(':profile-changed', profile_ids[id]);\n\n\t\tif ( reordered )\n\t\t\tthis.emit(':profiles-reordered');\n\t}\n\n\n\t/**\n\t * Create a new profile and return the {@link SettingsProfile} instance\n\t * representing it.\n\t */\n\tcreateProfile(options: Partial<SettingsProfileMetadata> = {}) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to create profile before settings have initialized. Please await enable()');\n\n\t\tif ( options.id !== undefined )\n\t\t\tthrow new Error('You cannot specify an ID when creating a profile.');\n\n\t\tlet id = 0;\n\n\t\t// Find the next available profile ID.\n\t\twhile ( this.__profile_ids[id] ) {\n\t\t\t// Ephemeral profiles have negative IDs.\n\t\t\toptions.ephemeral ? id-- : id++;\n\t\t}\n\n\t\toptions.id = id;\n\t\toptions.uuid = generateUUID();\n\n\t\tif ( ! options.name )\n\t\t\toptions.name = `Unnamed Profile ${this.__profiles.length + 1}`;\n\n\t\tconst profile = this.__profile_ids[id] = new SettingsProfile(this, options);\n\t\tthis.__profile_uuids[options.uuid] = profile;\n\t\tthis.__profiles.unshift(profile);\n\n\t\tprofile.on('toggled', this._onProfileToggled, this);\n\t\tprofile.hotkey_enabled = true;\n\n\t\t// Don't bother saving if it's ephemeral.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-created', profile);\n\t\treturn profile;\n\t}\n\n\n\t/**\n\t * Delete a profile.\n\t *\n\t * @param id - The ID of the profile to delete, or just the profile itself.\n\t */\n\tdeleteProfile(id: number | SettingsProfile) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to delete profile before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\tif ( this.__profiles.length === 1 )\n\t\t\tthrow new Error('cannot delete only profile');\n\n\t\t/*if ( profile.id === 0 )\n\t\t\tthrow new Error('cannot delete default profile');*/\n\n\t\tprofile.off('toggled', this._onProfileToggled, this);\n\t\tprofile.clear();\n\t\tthis.__profile_ids[id] = null;\n\t\tthis.__profile_uuids[profile.uuid] = null;\n\n\t\tconst idx = this.__profiles.indexOf(profile);\n\t\tif ( idx !== -1 )\n\t\t\tthis.__profiles.splice(idx, 1);\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-deleted', profile);\n\t}\n\n\n\tmoveProfile(id: number | SettingsProfile, index: number) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to move profiles before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\tconst profiles = this.__profiles,\n\t\t\tidx = profiles.indexOf(profile);\n\t\tif ( idx === index )\n\t\t\treturn;\n\n\t\tprofiles.splice(index, 0, ...profiles.splice(idx, 1));\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profiles-reordered');\n\t}\n\n\n\tsaveProfile(id: number | SettingsProfile) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to save profile before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-changed', profile);\n\t}\n\n\n\t_saveProfiles() {\n\t\tconst out = this.__profiles\n\t\t\t.filter(prof => ! prof.ephemeral)\n\t\t\t.map(prof => prof.data);\n\n\t\t// Ensure that we always have a non-ephemeral profile.\n\t\tif ( ! out ) {\n\t\t\tthis.createProfile({\n\t\t\t\tname: 'Default Profile',\n\t\t\t\ti18n_key: 'setting.profiles.default',\n\t\t\t\tdescription: 'Settings that apply everywhere on Twitch.'\n\t\t\t});\n\n\t\t\t// Just return. Creating the profile will call this method again.\n\t\t\treturn;\n\t\t}\n\n\t\tthis.provider?.set('profiles', out);\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t}\n\n\n\t// ========================================================================\n\t// Context Helpers\n\t// ========================================================================\n\n\tcontext(env: ContextData) {\n\t\treturn this.main_context.context(env);\n\t}\n\n\tget<\n\t\tK extends AllSettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K): TValue {\n\t\treturn this.main_context.get(key);\n\t}\n\n\tgetChanges<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(\n\t\tkey: K,\n\t\tfn: (val: TValue) => void,\n\t\tctx?: any\n\t) { return this.main_context.getChanges(key, fn, ctx); }\n\n\tonChange<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(\n\t\tkey: K,\n\t\tfn: (val: TValue) => void,\n\t\tctx?: any\n\t) { return this.main_context.onChange(key, fn, ctx); }\n\n\tuses<K extends AllSettingsKeys>(key: K) { return this.main_context.uses(key) }\n\tupdate<K extends SettingsKeys>(key: K) { return this.main_context.update(key) }\n\n\tupdateContext(context: ContextData) { return this.main_context.updateContext(context) }\n\tsetContext(context: ContextData) { return this.main_context.setContext(context) }\n\n\n\t// ========================================================================\n\t// Add-On Proxy\n\t// ========================================================================\n\n\tgetAddonProxy(addon_id: string, addon: AddonInfo, module: GenericModule) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides: Record<string, any> = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\n\t\toverrides.add = <\n\t\t\tK extends SettingsKeys,\n\t\t\tTValue = SettingType<K>,\n\t\t>(key: K, definition: SettingDefinition<TValue>) => {\n\t\t\treturn this.add(key, definition, addon_id);\n\t\t};\n\n\t\t// TODO: Update addUI here too\n\t\toverrides.addUI = <\n\t\t\tK extends string,\n\t\t\tTValue = K extends SettingsKeys ? SettingType<K> : unknown,\n\t\t>(key: K, definition: SettingUiDefinition<TValue>) => {\n\t\t\treturn this.addUI(key, definition, addon_id);\n\t\t};\n\n\t\toverrides.addClearable = (key: string, definition: SettingsClearable) => {\n\t\t\treturn this.addClearable(key, definition, addon_id);\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'settings', overrides);\n\t}\n\n\t// ========================================================================\n\t// Definitions\n\t// ========================================================================\n\n\tadd<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, definition: SettingDefinition<TValue>, source?: string) {\n\n\t\tconst old_definition = this.definitions.get(key),\n\t\t\trequired_by = (Array.isArray(old_definition)\n\t\t\t\t? old_definition\n\t\t\t\t: old_definition?.required_by) ?? [];\n\n\t\tdefinition.required_by = required_by;\n\t\tdefinition.requires = definition.requires ?? [];\n\n\t\tdefinition.__source = source;\n\n\t\tfor(const req_key of definition.requires) {\n\t\t\tconst req = this.definitions.get(req_key);\n\t\t\tif ( Array.isArray(req) )\n\t\t\t\treq.push(key);\n\t\t\telse if ( req )\n\t\t\t\treq.required_by?.push(key);\n\t\t\telse\n\t\t\t\tthis.definitions.set(req_key, [key]);\n\t\t}\n\n\n\t\tif ( definition.ui ) {\n\t\t\tconst ui = definition.ui;\n\t\t\tui.path_tokens = ui.path_tokens ?\n\t\t\t\tformat_path_tokens(ui.path_tokens) :\n\t\t\t\tui.path ?\n\t\t\t\t\tparse_path(ui.path) :\n\t\t\t\t\tundefined;\n\n\t\t\tif ( source && ui.path_tokens && ui.path_tokens.length >= 2 && ui.path_tokens[0].key === 'add_ons' ) {\n\t\t\t\tconst addons = this.resolve('addons'),\n\t\t\t\t\taddon = addons?.getAddon(source);\n\n\t\t\t\tif ( addon ) {\n\t\t\t\t\tconst test = ui.path_tokens[1] as any,\n\t\t\t\t\t\tlinks: string[] = [];\n\n\t\t\t\t\tlinks.push(`add_ons.changelog.${source}`);\n\t\t\t\t\tif ( addon.short_name )\n\t\t\t\t\t\tlinks.push(`add_ons.changelog.${addon.short_name.toSnakeCase()}`);\n\t\t\t\t\tif ( addon.name )\n\t\t\t\t\t\tlinks.push(`add_ons.changelog.${addon.name.toSnakeCase()}`);\n\n\t\t\t\t\ttest.header_links = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnavigate: links,\n\t\t\t\t\t\t\ti18n_key: 'home.changelog',\n\t\t\t\t\t\t\ttitle: 'Changelog'\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! ui.key && key )\n\t\t\t\tui.key = key;\n\n\t\t\tif ( ! ui.key && ui.title )\n\t\t\t\tui.key = ui.title.toSnakeCase();\n\n\t\t\tif ( (ui.component === 'setting-select-box' ||\n\t\t\t\t  ui.component === 'setting-combo-box') &&\n\t\t\t\tArray.isArray(ui.data) && ! ui.no_i18n\n\t\t\t) {\n\t\t\t\tconst i18n_base = `${ui.i18n_key || `setting.entry.${key}`}.values`;\n\t\t\t\tfor(const value of ui.data) {\n\t\t\t\t\tif ( value.i18n_key === undefined && value.value !== undefined )\n\t\t\t\t\t\tvalue.i18n_key = `${i18n_base}.${value.value}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( definition.changed )\n\t\t\tthis.on(`:changed:${key}` as any, definition.changed);\n\n\t\tthis.definitions.set(key, definition);\n\n\t\t// Do not re-emit `added-definition` when re-adding an existing\n\t\t// setting. Prevents the settings UI from goofing up.\n\t\tif ( ! old_definition || Array.isArray(old_definition) )\n\t\t\tthis.emit(':added-definition', key, definition);\n\t}\n\n\n\tremove(key: string) {\n\t\tconst definition = this.definitions.get(key);\n\t\tif ( ! definition )\n\t\t\treturn;\n\n\t\t// If the definition is an array, we're already not defined.\n\t\tif ( Array.isArray(definition) )\n\t\t\treturn;\n\n\t\t// Remove this definition from the definitions list.\n\t\tif ( Array.isArray(definition.required_by) && definition.required_by.length > 0 )\n\t\t\tthis.definitions.set(key, definition.required_by);\n\t\telse\n\t\t\tthis.definitions.delete(key);\n\n\t\t// Remove it from all the things it required.\n\t\tif ( Array.isArray(definition.requires) )\n\t\t\tfor(const req_key of definition.requires) {\n\t\t\t\tlet req = this.definitions.get(req_key);\n\t\t\t\tif ( Array.isArray(req) ) {\n\t\t\t\t\tconst idx = req.indexOf(key);\n\t\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\t\treq.splice(idx, 1);\n\n\t\t\t\t} else if ( req?.required_by )\n\t\t\t\t\treq = req.required_by;\n\t\t\t}\n\n\t\tif ( definition.changed )\n\t\t\tthis.off(`:changed:${key}` as any, definition.changed);\n\n\t\tthis.emit(':removed-definition', key as any, definition);\n\t}\n\n\n\t// TODO: Update this because addUI doesn't use keys or types\n\taddUI<\n\t\tK extends string,\n\t\tTValue = K extends SettingsKeys ? SettingType<K> : unknown\n\t>(key: K, definition: Partial<SettingUiDefinition<TValue>>, source?: string) {\n\n\t\tlet def: SettingDefinition<TValue>;\n\t\tif ( (definition as any).ui )\n\t\t\tdef = (definition as any);\n\t\telse\n\t\t\tdef = {\n\t\t\t\tui: definition as SettingUiDefinition<TValue>\n\t\t\t} as SettingDefinition<TValue>;\n\n\t\tdef.__source = source;\n\n\t\tconst ui = def.ui as SettingUiDefinition<TValue>;\n\t\tui.path_tokens = ui.path_tokens ?\n\t\t\tformat_path_tokens(ui.path_tokens) :\n\t\t\tui.path ?\n\t\t\t\tparse_path(ui.path) :\n\t\t\t\tundefined;\n\n\t\tif ( ! ui.key && ui.title )\n\t\t\tui.key = ui.title.toSnakeCase();\n\n\t\tconst old_definition = this.ui_structures.get(key);\n\t\tthis.ui_structures.set(key, def);\n\n\t\t// Do not re-emit `added-definition` when re-adding an existing\n\t\t// setting. Prevents the settings UI from goofing up.\n\t\tif ( ! old_definition )\n\t\t\tthis.emit(':added-definition', key as any, def);\n\t}\n\n\n\taddClearable(key: string | Record<string, SettingsClearable>, definition?: SettingsClearable, source?: string) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addClearable(k, value, source);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( definition ) {\n\t\t\tdefinition.__source = source;\n\t\t\tthis.clearables[key] = definition;\n\t\t}\n\t}\n\n\tgetClearables() {\n\t\treturn deep_copy(this.clearables);\n\t}\n\n\n\taddProcessor(key: string | Record<string, SettingProcessor<any>>, processor?: SettingProcessor<any>) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addProcessor(k, value);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( processor )\n\t\t\tthis.processors[key] = processor;\n\t}\n\n\tgetProcessor<T>(key: string): SettingProcessor<T> | null {\n\t\treturn this.processors[key] ?? null;\n\t}\n\n\tgetProcessors() {\n\t\treturn deep_copy(this.processors);\n\t}\n\n\taddValidator(key: string | Record<string, SettingValidator<any>>, validator?: SettingValidator<any>) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addValidator(k, value);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( validator )\n\t\t\tthis.validators[key] = validator;\n\t}\n\n\tgetValidator<T>(key: string): SettingValidator<T> | null {\n\t\treturn this.validators[key] ?? null;\n\t}\n\n\tgetValidators() {\n\t\treturn deep_copy(this.validators);\n\t}\n}\n\n\nexport function format_path_tokens(tokens: (string | PathNode)[]) {\n\tfor(let i=0, l = tokens.length; i < l; i++) {\n\t\tconst token = tokens[i];\n\t\tif ( typeof token === 'string' ) {\n\t\t\ttokens[i] = {\n\t\t\t\tkey: token.toSnakeCase(),\n\t\t\t\ttitle: token\n\t\t\t};\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif ( ! token.key )\n\t\t\ttoken.key = token.title.toSnakeCase();\n\t}\n\n\treturn tokens as PathNode[];\n}\n","'use strict';\n\n// ============================================================================\n// Add-On System\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { EXTENSION, SERVER_OR_EXT } from 'utilities/constants';\nimport { createElement } from 'utilities/dom';\nimport { timeout, has, deep_copy, fetchJSON } from 'utilities/object';\nimport { getBuster } from 'utilities/time';\nimport type SettingsManager from './settings';\nimport type TranslationManager from './i18n';\nimport type LoadTracker from './load_tracker';\nimport type FrankerFaceZ from './main';\nimport type { AddonInfo, BasicAddonInfo } from 'utilities/types';\n\ndeclare global {\n\tinterface Window {\n\t\tffzAddonsWebpackJsonp: unknown;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\taddons: AddonManager;\n\t}\n\tinterface ModuleEventMap {\n\t\taddons: AddonManagerEvents;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'addons.dev.server': boolean;\n\t}\n};\n\ntype AddonManagerEvents = {\n\t':ready': [];\n\t':data-loaded': [];\n\t':reload-required': [];\n\n\t':added': [id: string, info: AddonInfo];\n\t':addon-loaded': [id: string];\n\t':addon-enabled': [id: string];\n\t':addon-disabled': [id: string];\n\t':fully-unload': [id: string];\n};\n\n\ntype FullAddonInfo = AddonInfo & {\n\t_search?: string | null;\n\tsrc: string;\n};\n\n\n// ============================================================================\n// AddonManager\n// ============================================================================\n\nexport default class AddonManager extends Module<'addons'> {\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\tload_tracker: LoadTracker = null as any;\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\thas_dev: boolean;\n\treload_required: boolean;\n\ttarget: string;\n\n\taddons: Record<string, FullAddonInfo | string[]>;\n\tenabled_addons: string[];\n\tversions: Record<string, string>;\n\n\tprivate _loader?: Promise<void>;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('load_tracker');\n\n\t\tthis.load_requires = ['settings'];\n\n\t\tthis.target = (this.parent as unknown as FrankerFaceZ).flavor || 'unknown';\n\n\t\tthis.has_dev = false;\n\t\tthis.reload_required = false;\n\t\tthis.addons = {};\n\t\tthis.enabled_addons = [];\n\t\tthis.versions = {};\n\n\t\tthis.load_tracker.schedule('chat-data', 'addon-initial');\n\t}\n\n\tonLoad() {\n\t\t// We don't actually *wait* for this, we just start it.\n\t\tthis._loader = this.loadAddonData();\n\t}\n\n\tonEnable() {\n\t\tthis.settings.addUI('add-ons', {\n\t\t\tpath: 'Add-Ons @{\"description\": \"Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.\", \"profile_warning\": false}',\n\t\t\tcomponent: 'addon-list',\n\t\t\ttitle: 'Add-Ons',\n\t\t\tno_filter: true,\n\n\t\t\tgetExtraTerms: () => Object.values(this.addons).map(addon => addon.search_terms),\n\n\t\t\tgetFFZ: () => this,\n\t\t\tisReady: () => this.enabled,\n\t\t\tgetAddons: () => Object.values(this.addons),\n\t\t\tgetVersions: () => deep_copy(this.versions),\n\t\t\thasAddon: (id: string) => this.hasAddon(id),\n\t\t\tgetVersion: (id: string) => this.getVersion(id),\n\t\t\tdoesAddonTarget: (id: string) => this.doesAddonTarget(id),\n\t\t\tisAddonEnabled: (id: string) => this.isAddonEnabled(id),\n\t\t\tisAddonExternal: (id: string) => this.isAddonExternal(id),\n\t\t\tenableAddon: (id: string) => this.enableAddon(id),\n\t\t\tdisableAddon: (id: string) => this.disableAddon(id),\n\t\t\treloadAddon: (id: string) => this.reloadAddon(id),\n\t\t\tcanReloadAddon: (id: string) => this.canReloadAddon(id),\n\t\t\tisReloadRequired: () => this.reload_required,\n\t\t\trefresh: () => window.location.reload(),\n\n\t\t\ton: (...args: Parameters<typeof this.on>) => this.on(...args),\n\t\t\toff: (...args: Parameters<typeof this.off>) => this.off(...args)\n\t\t});\n\n\t\tif ( ! EXTENSION )\n\t\t\tthis.settings.add('addons.dev.server', {\n\t\t\t\tdefault: false,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Add-Ons >> Development',\n\t\t\t\t\ttitle: 'Use Local Development Server',\n\t\t\t\t\tdescription: 'Attempt to load add-ons from local development server on port 8001.',\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.on('i18n:update', this.rebuildAddonSearch, this);\n\n\t\tthis.settings.provider.on('changed', this.onProviderChange, this);\n\n\t\tthis._loader?.then(() => {\n\t\t\tthis.enabled_addons = this.settings.provider.get('addons.enabled', []);\n\n\t\t\t// We do not await enabling add-ons because that would delay the\n\t\t\t// main script's execution.\n\t\t\tfor(const id of this.enabled_addons)\n\t\t\t\tif ( this.hasAddon(id) && this.doesAddonTarget(id) )\n\t\t\t\t\tthis._enableAddon(id).catch(err => {\n\t\t\t\t\t\tthis.log.error(`An error occured while enabling the add-on \"${id}\":` , err);\n\t\t\t\t\t\tthis.log.capture(err);\n\t\t\t\t\t});\n\n\t\t\tthis.load_tracker.notify('chat-data', 'addon-initial');\n\t\t\tthis.emit(':ready');\n\t\t});\n\t}\n\n\n\tdoesAddonTarget(id: string) {\n\t\tconst data = this.getAddon(id);\n\t\tif ( ! data )\n\t\t\treturn false;\n\n\t\tconst targets = data.targets ?? ['main'];\n\t\tif ( ! Array.isArray(targets) )\n\t\t\treturn false;\n\n\t\treturn targets.includes(this.target);\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = ['Known'];\n\t\tfor(const [id, addon] of Object.entries(this.addons)) {\n\t\t\tif ( Array.isArray(addon) )\n\t\t\t\tcontinue;\n\n\t\t\tconst version = this.versions[id];\n\n\t\t\tout.push(`${id} | ${this.isAddonEnabled(id) ? 'enabled' : 'disabled'} | ${version ? `${version} | ` : ''}${addon.dev ? 'dev | ' : ''}${this.isAddonExternal(id) ? 'external | ' : ''}${addon.short_name} v${addon.version}`);\n\t\t}\n\n\t\tout.push('');\n\t\tout.push('Modules');\n\t\tfor(const [key, module] of Object.entries((this as any).__modules as Record<string, GenericModule>)) {\n\t\t\tif ( module )\n\t\t\t\tout.push(`${module.loaded ? 'loaded  ' : module.loading ? 'loading ' : 'unloaded'} | ${module.enabled ? 'enabled ' : module.enabling ? 'enabling' : 'disabled'} | ${key}`)\n\t\t}\n\n\t\treturn out.join('\\n');\n\t}\n\n\tonProviderChange(key: string, value: unknown) {\n\t\tif ( key != 'addons.enabled' )\n\t\t\treturn;\n\n\t\tconst val: string[] = Array.isArray(value) ? value : [],\n\t\t\told_enabled = [...this.enabled_addons];\n\n\t\t// Add-ons to disable\n\t\tfor(const id of old_enabled)\n\t\t\tif ( ! val.includes(id) )\n\t\t\t\tthis.disableAddon(id, false);\n\n\t\t// Add-ons to enable\n\t\tfor(const id of val)\n\t\t\tif ( ! old_enabled.includes(id) )\n\t\t\t\tthis.enableAddon(id, false);\n\t}\n\n\tasync loadAddonData() {\n\t\tconst [cdn_data, local_data] = await Promise.all([\n\t\t\tfetchJSON(`${SERVER_OR_EXT}/addons.json?_=${getBuster(30)}`),\n\n\t\t\t// Do not attempt to load local add-ons if using the extension, as\n\t\t\t// loading external code is against the policy of basically everyone.\n\t\t\t(! EXTENSION && this.settings.get('addons.dev.server'))\n\t\t\t\t? fetchJSON(`https://localhost:8001/script/addons.json?_=${getBuster()}`)\n\t\t\t\t: null\n\t\t]);\n\n\t\tif ( Array.isArray(cdn_data) ) {\n\t\t\t// We need to handle relative URLs for addon logos.\n\t\t\tconst base_path = `${SERVER_OR_EXT}/addons/`;\n\n\t\t\tfor(const addon of cdn_data ) {\n\t\t\t\tif ( addon.icon )\n\t\t\t\taddon.icon = (new URL(addon.icon, base_path)).toString();\n\t\t\t\tthis.addAddon(addon, false);\n\t\t\t}\n\t\t}\n\n\t\tif ( Array.isArray(local_data) ) {\n\t\t\tthis.has_dev = true;\n\t\t\tfor(const addon of local_data)\n\t\t\t\tthis.addAddon(addon, true);\n\t\t}\n\n\t\tthis.settings.updateContext({\n\t\t\taddonDev: this.has_dev\n\t\t});\n\n\t\tthis.rebuildAddonSearch();\n\t\tthis.emit(':data-loaded');\n\t}\n\n\tsetVersion(addon_id: string, version: string) {\n\t\tthis.versions[addon_id] = version;\n\t}\n\n\taddAddon(input: BasicAddonInfo, is_dev: boolean = false) {\n\t\tlet addon = input as FullAddonInfo;\n\n\t\tconst old = this.addons[addon.id];\n\t\tthis.addons[addon.id] = addon;\n\n\t\t/*addon.name_i18n = addon.name_i18n || `addon.${addon.id}.name`;\n\t\taddon.short_name_i18n = addon.short_name_i18n || `addon.${addon.id}.short_name`;\n\t\taddon.author_i18n = addon.author_i18n || `addon.${addon.id}.author`;*/\n\n\t\taddon.name = addon.name ?? addon.id;\n\n\t\taddon.dev = is_dev;\n\t\taddon.requires = addon.requires || [];\n\t\taddon.required_by = Array.isArray(old) ? old : old && old.required_by || [];\n\n\t\tif ( addon.updated )\n\t\t\taddon.updated = new Date(addon.updated);\n\n\t\tif ( addon.created )\n\t\t\taddon.created = new Date(addon.created);\n\n\t\taddon._search = addon.search_terms;\n\n\t\tfor(const id of addon.requires) {\n\t\t\tconst target = this.addons[id];\n\t\t\tif ( Array.isArray(target) )\n\t\t\t\ttarget.push(addon.id);\n\t\t\telse if ( target )\n\t\t\t\ttarget.required_by.push(addon.id);\n\t\t\telse\n\t\t\t\tthis.addons[id] = [addon.id];\n\t\t}\n\n\t\tif ( ! old || Array.isArray(old) )\n\t\t\tthis.settings.addUI(`addon-changelog.${addon.id}`, {\n\t\t\t\tpath: `Add-Ons > Changelog > ${addon.name}`,\n\t\t\t\tcomponent: 'changelog',\n\t\t\t\tforce_seen: true,\n\t\t\t\taddons: true,\n\t\t\t\taddon: deep_copy(addon),\n\t\t\t\tgetFFZ: () => this,\n\t\t\t\tgetVersion: () => this.versions[addon.id]\n\t\t\t});\n\n\t\tthis.emit(':added', addon.id, addon);\n\t}\n\n\trebuildAddonSearch() {\n\t\tfor(const addon of Object.values(this.addons)) {\n\t\t\tif ( Array.isArray(addon) )\n\t\t\t\tcontinue;\n\n\t\t\tconst terms = new Set([\n\t\t\t\taddon._search,\n\t\t\t\taddon.name,\n\t\t\t\taddon.short_name,\n\t\t\t\taddon.author,\n\t\t\t\taddon.description,\n\t\t\t]);\n\n\t\t\tif ( this.i18n.locale !== 'en' ) {\n\t\t\t\tif ( addon.name_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.name_i18n, addon.name));\n\n\t\t\t\tif ( addon.short_name_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.short_name_i18n, addon.short_name));\n\n\t\t\t\tif ( addon.author_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.author_i18n, addon.author));\n\n\t\t\t\tif ( addon.maintainer_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.maintainer_i18n, addon.maintainer));\n\n\t\t\t\tif ( addon.description_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.description_i18n, addon.description));\n\t\t\t}\n\n\t\t\taddon.search_terms = [...terms]\n\t\t\t\t.map(term => term ? term.toLocaleLowerCase() : '').join('\\n');\n\t\t}\n\t}\n\n\tisAddonEnabled(id: string) {\n\t\tif ( this.isAddonExternal(id) )\n\t\t\treturn true;\n\n\t\treturn this.enabled_addons.includes(id);\n\t}\n\n\tgetAddon(id: string) {\n\t\tconst addon = this.addons[id] ?? null;\n\t\treturn Array.isArray(addon) ? null : addon;\n\t}\n\n\thasAddon(id: string) {\n\t\treturn this.getAddon(id) != null;\n\t}\n\n\tgetVersion(id: string) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\tif ( module ) {\n\t\t\tif ( 'version' in module ) // has(module, 'version') )\n\t\t\t\treturn module.version;\n\t\t\telse if ( module.constructor && 'version' in module.constructor ) // has(module.constructor, 'version') )\n\t\t\t\treturn module.constructor.version;\n\t\t}\n\n\t\treturn addon.version;\n\t}\n\n\tisAddonExternal(id: string) {\n\t\tif ( ! this.hasAddon(id) )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\t// If we can't find it, assume it isn't.\n\t\tif ( ! module )\n\t\t\treturn false;\n\n\t\t// Check for one of our script tags. If we didn't load\n\t\t// it ourselves, then it's external.\n\t\tconst script = document.head.querySelector(`script#ffz-loaded-addon-${id}`);\n\t\tif ( ! script )\n\t\t\treturn true;\n\n\t\t// Finally, let the module flag itself as external.\n\t\treturn (module as any).external || (module.constructor as any)?.external;\n\t}\n\n\tcanReloadAddon(id: string) {\n\t\t// Obviously we can't reload it if we don't have it.\n\t\tif ( ! this.hasAddon(id) )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\t// If the module isn't available, we can't reload it.\n\t\tlet module = this.resolve(`addon.${id}`);\n\t\tif ( ! module )\n\t\t\treturn false;\n\n\t\t// If the module cannot be disabled, or it cannot be unloaded, then\n\t\t// we can't reload it.\n\t\tif ( ! module.canDisable() || ! module.canUnload() )\n\t\t\treturn false;\n\n\t\t// Check each child.\n\t\tif ( module.children )\n\t\t\tfor(const child of Object.values(module.children))\n\t\t\t\tif ( ! child.canDisable() || ! child.canUnload() )\n\t\t\t\t\treturn false;\n\n\t\t// If we got here, we might be able to reload it.\n\t\treturn true;\n\t}\n\n\tasync fullyUnloadModule(module: GenericModule) {\n\t\tif ( ! module || ! module.addon_id )\n\t\t\treturn;\n\n\t\tif ( module.children )\n\t\t\tfor(const child of Object.values(module.children))\n\t\t\t\tawait this.fullyUnloadModule(child);\n\n\t\tawait module.disable();\n\t\tawait module.unload();\n\n\t\t// Clean up parent references.\n\t\tif ( module.parent instanceof Module && module.parent.children[module.name] === module )\n\t\t\tdelete module.parent.children[module.name];\n\n\t\t// Clean up all individual references.\n\t\tfor(const entry of module.references) {\n\t\t\tconst other = this.resolve(entry[0]),\n\t\t\t\tname = entry[1];\n\t\t\tif ( (other as any)[name] === module )\n\t\t\t\t(other as any)[name] = null;\n\t\t}\n\n\t\t// Send off a signal for other modules to unload related data.\n\t\tthis.emit(':fully-unload', module.addon_id);\n\n\t\t// Clean up the global reference.\n\t\tif ( (this as any).__modules[(module as any).__path] === module )\n\t\t\tdelete (this as any).__modules[(module as any).__path]; /* = [\n\t\t\t\tmodule.dependents,\n\t\t\t\tmodule.load_dependents,\n\t\t\t\tmodule.references\n\t\t\t];*/\n\n\t\t// Remove any events we didn't unregister.\n\t\tthis.off(undefined, undefined, module);\n\n\t\t// Do the same for settings.\n\t\tfor(const ctx of this.settings.__contexts)\n\t\t\tctx.off(undefined, undefined, module);\n\n\t\t// Clean up all settings.\n\t\tfor(const [key, def] of Array.from(this.settings.definitions.entries())) {\n\t\t\tif ( ! Array.isArray(def) && def?.__source === module.addon_id ) {\n\t\t\t\tthis.settings.remove(key);\n\t\t\t}\n\t\t}\n\n\t\t// Clean up the logger too.\n\t\t(module as any).__log = null;\n\t}\n\n\tasync reloadAddon(id: string) {\n\t\tconst addon = this.getAddon(id),\n\t\t\tbutton = this.resolve('site.menu_button');\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tconst start = performance.now();\n\n\t\t// Yeet the module into the abyss.\n\t\t// This will also yeet all children.\n\t\tlet module = this.resolve(`addon.${id}`);\n\t\tif ( module )\n\t\t\ttry {\n\t\t\t\tawait this.fullyUnloadModule(module);\n\t\t\t} catch(err) {\n\t\t\t\tif ( button )\n\t\t\t\t\tbutton.addToast({\n\t\t\t\t\t\ttitle_i18n: 'addons.reload.toast-error',\n\t\t\t\t\t\ttitle: 'Error Reloading Add-On',\n\t\t\t\t\t\ttext_i18n: 'addons.reload.toast-error.unload',\n\t\t\t\t\t\ttext: 'Unable to unload existing modules for add-on \"{addon_id}\":\\n\\n{error}',\n\t\t\t\t\t\ticon: 'ffz-i-attention',\n\t\t\t\t\t\taddon_id: id,\n\t\t\t\t\t\terror: String(err)\n\t\t\t\t\t});\n\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t// Is there a script tab?\n\t\tlet el = document.querySelector(`script#ffz-loaded-addon-${addon.id}`);\n\t\tif ( el )\n\t\t\tel.remove();\n\n\t\t// Do unnatural things to webpack.\n\t\tif ( window.ffzAddonsWebpackJsonp )\n\t\t\twindow.ffzAddonsWebpackJsonp = undefined;\n\n\t\t// Now, reload it all~\n\t\ttry {\n\t\t\tawait this._enableAddon(id);\n\t\t} catch(err) {\n\t\t\tif ( button )\n\t\t\t\tbutton.addToast({\n\t\t\t\t\ttitle_i18n: 'addons.reload.toast-error',\n\t\t\t\t\ttitle: 'Error Reloading Add-On',\n\t\t\t\t\ttext_i18n: 'addons.reload.toast-error.reload',\n\t\t\t\t\ttext: 'Unable to load new module for add-on \"{addon_id}\":\\n\\n{error}',\n\t\t\t\t\terror: String(err),\n\t\t\t\t\ticon: 'ffz-i-attention',\n\t\t\t\t\taddon_id: id\n\t\t\t\t});\n\t\t\tthrow err;\n\t\t}\n\n\t\tconst end = performance.now();\n\n\t\tif ( button )\n\t\t\tbutton.addToast({\n\t\t\t\ttitle_i18n: 'addons.reload.toast',\n\t\t\t\ttitle: 'Reloaded Add-On',\n\t\t\t\ttext_i18n: 'addons.reload.toast.text',\n\t\t\t\ttext: 'Successfully reloaded add-on \"{addon_id}\" in {duration}ms.',\n\t\t\t\ticon: 'ffz-i-info',\n\t\t\t\taddon_id: id,\n\t\t\t\ttimeout: 5000,\n\t\t\t\tduration: Math.round(100 * (end - start)) / 100\n\t\t\t});\n\t}\n\n\tprivate async _enableAddon(id: string) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tif ( Array.isArray(addon.load_events) )\n\t\t\tfor(const event of addon.load_events)\n\t\t\t\tthis.load_tracker.schedule(event, `addon.${id}`);\n\n\t\tawait this.loadAddon(id);\n\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\tif ( module && ! module.enabled )\n\t\t\tawait module.enable();\n\n\t\tif ( Array.isArray(addon.load_events) )\n\t\tfor(const event of addon.load_events)\n\t\t\tthis.load_tracker.notify(event, `addon.${id}`, false);\n\t}\n\n\tasync loadAddon(id: string) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tawait this.i18n.loadChunk(`addon.${id}`);\n\n\t\tlet module = this.resolve(`addon.${id}`);\n\t\tif ( module ) {\n\t\t\tif ( ! module.loaded )\n\t\t\t\tawait module.load();\n\n\t\t\tthis.emit(':addon-loaded', id);\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.head.appendChild(createElement('script', {\n\t\t\tid: `ffz-loaded-addon-${addon.id}`,\n\t\t\ttype: 'text/javascript',\n\t\t\tsrc: addon.src || `${addon.dev ? 'https://localhost:8001/script' : SERVER_OR_EXT}/addons/${addon.id}/script.js?_=${getBuster(30)}`,\n\t\t\tcrossorigin: 'anonymous'\n\t\t}));\n\n\t\t// Error if this takes more than 60 seconds.\n\t\tawait timeout(this.waitFor(`addon.${id}:registered` as any), 60000);\n\n\t\tmodule = this.resolve(`addon.${id}`);\n\t\tif ( module && ! module.loaded )\n\t\t\tawait module.load();\n\n\t\tthis.emit(':addon-loaded', id);\n\t}\n\n\tunloadAddon(id: string) {\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\tif ( module )\n\t\t\treturn module.unload();\n\t}\n\n\tenableAddon(id: string, save: boolean = true) {\n\t\tconst addon = this.getAddon(id);\n\t\tif( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tif ( this.isAddonEnabled(id) )\n\t\t\treturn;\n\n\t\tif ( Array.isArray(addon.requires) ) {\n\t\t\tfor(const id of addon.requires) {\n\t\t\t\tif ( ! this.hasAddon(id) )\n\t\t\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\t\t\tthis.enableAddon(id);\n\t\t\t}\n\t\t}\n\n\t\tthis.emit(':addon-enabled', id);\n\t\tthis.enabled_addons.push(id);\n\n\t\tif ( save )\n\t\t\tthis.settings.provider.set('addons.enabled', this.enabled_addons);\n\n\t\t// Actually load it.\n\t\tif ( this.doesAddonTarget(id) )\n\t\t\tthis._enableAddon(id).catch(err => {\n\t\t\t\tthis.log.error(`An error occured while enabling the add-on \"${id}\":` , err);\n\t\t\t\tthis.log.capture(err);\n\t\t\t});\n\t}\n\n\tasync disableAddon(id: string, save: boolean = true) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tif ( this.isAddonExternal(id) )\n\t\t\tthrow new Error(`Cannot disable external add-on with id: ${id}`);\n\n\t\tif ( ! this.isAddonEnabled(id) )\n\t\t\treturn;\n\n\t\tif ( Array.isArray(addon.required_by) ) {\n\t\t\tconst promises = [];\n\t\t\tfor(const id of addon.required_by)\n\t\t\t\tpromises.push(this.disableAddon(id));\n\n\t\t\tawait Promise.all(promises);\n\t\t}\n\n\t\tthis.emit(':addon-disabled', id);\n\t\tthis.enabled_addons.splice(this.enabled_addons.indexOf(id), 1);\n\n\t\tif ( save )\n\t\t\tthis.settings.provider.set('addons.enabled', this.enabled_addons);\n\n\t\t// Try disabling loaded modules.\n\t\ttry {\n\t\t\tconst module = this.resolve(`addon.${id}`);\n\t\t\tif ( module )\n\t\t\t\tawait module.disable();\n\t\t} catch(err) {\n\t\t\tthis.reload_required = true;\n\t\t\tthis.emit(':reload-required');\n\t\t}\n\t}\n}\n","/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n","'use strict';\n\n// ============================================================================\n// Experiments\n// ============================================================================\n\nimport {DEBUG, SERVER, SERVER_OR_EXT} from 'utilities/constants';\nimport Module, { GenericModule } from 'utilities/module';\nimport {has, deep_copy, fetchJSON} from 'utilities/object';\nimport { getBuster } from 'utilities/time';\n\nimport Cookie from 'js-cookie';\nimport SHA1 from 'crypto-js/sha1';\n\nimport type SettingsManager from './settings';\nimport type { ExperimentTypeMap } from 'utilities/types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\texperiments: ExperimentManager;\n\t}\n\tinterface ModuleEventMap {\n\t\texperiments: ExperimentEvents;\n\t}\n\tinterface ProviderTypeMap {\n\t\t'experiment-overrides': {\n\t\t\t[K in keyof ExperimentTypeMap]?: ExperimentTypeMap[K];\n\t\t}\n\t}\n\tinterface PubSubCommands {\n\t\treload_experiments: [];\n\t\tupdate_experiment: {\n\t\t\tkey: keyof ExperimentTypeMap,\n\t\t\tdata: FFZExperimentData | ExperimentGroup[]\n\t\t};\n\t}\n}\n\ndeclare global {\n\tinterface Window {\n\t\t__twilightSettings?: {\n\t\t\texperiments?: Record<string, TwitchExperimentData>;\n\t\t}\n\t}\n}\n\n\nconst OVERRIDE_COOKIE = 'experiment_overrides',\n\tCOOKIE_OPTIONS = {\n\t\texpires: 7,\n\t\tdomain: '.twitch.tv'\n\t};\n\n\n// We want to import this so that the file is included in the output.\n// We don't load using this because we might want a newer file from the\n// server. Because of our webpack settings, this is imported as a URL\n// and not an object.\nconst EXPERIMENTS: string = require('./experiments.json');\n\n// ============================================================================\n// Data Types\n// ============================================================================\n\nexport enum TwitchExperimentType {\n\tUnknown = 0,\n\tDevice = 1,\n\tUser = 2,\n\tChannel = 3\n};\n\nexport type ExperimentGroup = {\n\tvalue: unknown;\n\tweight: number;\n};\n\nexport type FFZExperimentData = {\n\tname: string;\n\tseed?: number;\n\tdescription: string;\n\tgroups: ExperimentGroup[];\n}\n\nexport type TwitchExperimentData = {\n\tname: string;\n\tt: TwitchExperimentType;\n\tv: number;\n\tgroups: ExperimentGroup[];\n};\n\nexport type ExperimentData = FFZExperimentData | TwitchExperimentData;\n\n\nexport type OverrideCookie = {\n\texperiments: Record<string, string>;\n\tdisabled: string[];\n};\n\n\ntype ExperimentEvents = {\n\t':changed': [key: string, new_value: any, old_value: any];\n\t':twitch-changed': [key: string, new_value: string | null, old_value: string | null];\n\t[key: `:twitch-changed:${string}`]: [new_value: string | null, old_value: string | null];\n} & {\n\t[K in keyof ExperimentTypeMap as `:changed:${K}`]: [new_value: ExperimentTypeMap[K], old_value: ExperimentTypeMap[K] | null];\n};\n\n\ntype ExperimentLogEntry = {\n\tkey: string;\n\tname: string;\n\tvalue: any;\n\toverride: boolean;\n\trarity: number;\n\ttype?: string;\n}\n\n\n// ============================================================================\n// Helper Methods\n// ============================================================================\n\nexport function isTwitchExperiment(exp: ExperimentData): exp is TwitchExperimentData {\n\treturn 't' in exp;\n}\n\nexport function isFFZExperiment(exp: ExperimentData): exp is FFZExperimentData {\n\treturn 'description' in exp;\n}\n\nfunction sortExperimentLog(a: ExperimentLogEntry, b: ExperimentLogEntry) {\n\tif ( a.rarity < b.rarity )\n\t\treturn -1;\n\telse if ( a.rarity > b.rarity )\n\t\treturn 1;\n\n\tif ( a.name < b.name )\n\t\treturn -1;\n\telse if ( a.name > b.name )\n\t\treturn 1;\n\n\treturn 0;\n}\n\n\n// ============================================================================\n// Experiment Manager\n// ============================================================================\n\nexport default class ExperimentManager extends Module<'experiments', ExperimentEvents> {\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\tunique_id?: string;\n\texperiments: Partial<{\n\t\t[K in keyof ExperimentTypeMap]: FFZExperimentData;\n\t}>;\n\n\tprivate cache: Map<keyof ExperimentTypeMap, unknown>;\n\n\n\t// Helpers\n\tCookie: typeof Cookie;\n\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.get = this.getAssignment;\n\n\t\tthis.inject('settings');\n\n\t\tthis.settings.addUI('experiments', {\n\t\t\tpath: 'Debugging > Experiments',\n\t\t\tcomponent: 'experiments',\n\t\t\tno_filter: true,\n\n\t\t\tgetExtraTerms: () => {\n\t\t\t\tconst values: string[] = [];\n\n\t\t\t\tfor(const [key, val] of Object.entries(this.experiments)) {\n\t\t\t\t\tvalues.push(key);\n\t\t\t\t\tif ( val.name )\n\t\t\t\t\t\tvalues.push(val.name);\n\t\t\t\t\tif ( val.description )\n\t\t\t\t\t\tvalues.push(val.description);\n\t\t\t\t}\n\n\t\t\t\tfor(const [key, val] of Object.entries(this.getTwitchExperiments())) {\n\t\t\t\t\tvalues.push(key);\n\t\t\t\t\tif ( val.name )\n\t\t\t\t\t\tvalues.push(val.name);\n\t\t\t\t}\n\n\t\t\t\treturn values;\n\t\t\t},\n\n\t\t\tis_locked: () => this.getControlsLocked(),\n\t\t\tunlock: () => this.unlockControls(),\n\n\t\t\tunique_id: () => this.unique_id,\n\n\t\t\tffz_data: () => deep_copy(this.experiments),\n\t\t\ttwitch_data: () => deep_copy(this.getTwitchExperiments()),\n\n\t\t\tusingTwitchExperiment: (key: string) => this.usingTwitchExperiment(key),\n\t\t\tgetTwitchAssignment: (key: string) => this.getTwitchAssignment(key),\n\t\t\tgetTwitchType: (type: TwitchExperimentType) => this.getTwitchType(type),\n\t\t\thasTwitchOverride: (key: string) => this.hasTwitchOverride(key),\n\t\t\tsetTwitchOverride: (key: string, val: string) => this.setTwitchOverride(key, val),\n\t\t\tdeleteTwitchOverride: (key: string) => this.deleteTwitchOverride(key),\n\n\t\t\tgetAssignment: <K extends keyof ExperimentTypeMap>(key: K) => this.getAssignment(key),\n\t\t\thasOverride: (key: keyof ExperimentTypeMap) => this.hasOverride(key),\n\t\t\tsetOverride: <K extends keyof ExperimentTypeMap>(key: K, val: ExperimentTypeMap[K]) => this.setOverride(key, val),\n\t\t\tdeleteOverride: (key: keyof ExperimentTypeMap) => this.deleteOverride(key),\n\n\t\t\ton: (...args: Parameters<typeof this.on>) => this.on(...args),\n\t\t\toff: (...args: Parameters<typeof this.off>) => this.off(...args)\n\t\t});\n\n\t\tthis.unique_id = Cookie.get('unique_id');\n\n\t\tthis.Cookie = Cookie;\n\n\t\tthis.experiments = {};\n\t\tthis.cache = new Map;\n\t}\n\n\n\tgetControlsLocked() {\n\t\tif ( DEBUG )\n\t\t\treturn false;\n\n\t\tconst ts = this.settings.provider.get<number>('exp-lock', 0);\n\t\tif ( isNaN(ts) || ! isFinite(ts) )\n\t\t\treturn true;\n\n\t\treturn Date.now() - ts >= 86400000;\n\t}\n\n\tunlockControls() {\n\t\tthis.settings.provider.set('exp-lock', Date.now());\n\t}\n\n\tasync onLoad() {\n\t\tawait this.loadExperiments();\n\t}\n\n\n\tasync loadExperiments() {\n\t\tlet data: Record<keyof ExperimentTypeMap, FFZExperimentData> | null;\n\n\t\ttry {\n\t\t\tdata = await fetchJSON(DEBUG\n\t\t\t\t? EXPERIMENTS\n\t\t\t\t: `${SERVER}/script/experiments.json?_=${getBuster()}`\n\t\t\t);\n\n\t\t} catch(err) {\n\t\t\tthis.log.warn('Unable to load experiment data.', err);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! data )\n\t\t\treturn;\n\n\t\tthis.experiments = data;\n\n\t\tconst old_cache = this.cache;\n\t\tthis.cache = new Map;\n\n\t\tlet changed = 0;\n\n\t\tfor(const [key, old_val] of old_cache.entries()) {\n\t\t\tconst new_val = this.getAssignment(key);\n\t\t\tif ( old_val !== new_val ) {\n\t\t\t\tchanged++;\n\t\t\t\tthis.emit(':changed', key, new_val, old_val);\n\t\t\t\tthis.emit(`:changed:${key as keyof ExperimentTypeMap}`, new_val as any, old_val as any);\n\t\t\t}\n\t\t}\n\n\t\tthis.log.info(`Loaded information on ${Object.keys(data).length} experiments.${changed > 0 ? ` ${changed} values updated.` : ''}`);\n\t\t//this.emit(':loaded');\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.on('pubsub:command:reload_experiments', this.loadExperiments, this);\n\t\tthis.on('pubsub:command:update_experiment', data => {\n\t\t\tthis.updateExperiment(data.key, data.data);\n\t\t}, this);\n\t}\n\n\n\tupdateExperiment(key: keyof ExperimentTypeMap, data: FFZExperimentData | ExperimentGroup[]) {\n\t\tthis.log.info(`Received updated data for experiment \"${key}\" via PubSub.`, data);\n\n\t\tif ( Array.isArray(data) ) {\n\t\t\tconst existing = this.experiments[key];\n\t\t\tif ( ! existing )\n\t\t\t\treturn;\n\n\t\t\texisting.groups = data;\n\n\t\t} else if ( data?.groups )\n\t\t\tthis.experiments[key] = data;\n\n\t\tthis._rebuildKey(key);\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = [\n\t\t\t`Unique ID: ${this.unique_id}`,\n\t\t\t''\n\t\t];\n\n\t\tconst ffz_assignments: ExperimentLogEntry[] = [];\n\t\tfor(const [key, value] of Object.entries(this.experiments) as [keyof ExperimentTypeMap, FFZExperimentData][]) {\n\t\t\tconst assignment = this.getAssignment(key),\n\t\t\t\toverride = this.hasOverride(key);\n\n\t\t\tlet weight = 0, total = 0;\n\t\t\tfor(const group of value.groups) {\n\t\t\t\tif ( group.value === assignment )\n\t\t\t\t\tweight = group.weight;\n\t\t\t\ttotal += group.weight;\n\t\t\t}\n\n\t\t\tif ( ! override && weight === total )\n\t\t\t\tcontinue;\n\n\t\t\tffz_assignments.push({\n\t\t\t\tkey,\n\t\t\t\tname: value.name,\n\t\t\t\tvalue: assignment,\n\t\t\t\toverride,\n\t\t\t\trarity: weight / total\n\t\t\t});\n\n\t\t\t//out.push(`FFZ | ${value.name}: ${this.getAssignment(key)}${this.hasOverride(key) ? ' (Overriden)' : ''}`);\n\t\t}\n\n\t\tffz_assignments.sort(sortExperimentLog);\n\n\t\tfor(const entry of ffz_assignments)\n\t\t\tout.push(`FFZ | ${entry.name}: ${entry.value}${entry.override ? ' (Override)' : ''} (r:${entry.rarity})`);\n\n\t\tconst twitch_assignments: ExperimentLogEntry[] = [],\n\t\t\tchannel = this.settings.get('context.channel');\n\n\t\tfor(const [key, value] of Object.entries(this.getTwitchExperiments())) {\n\t\t\tif ( ! this.usingTwitchExperiment(key) )\n\t\t\t\tcontinue;\n\n\t\t\tconst assignment = this.getTwitchAssignment(key),\n\t\t\t\toverride = this.hasTwitchOverride(key);\n\n\t\t\tlet weight = 0, total = 0;\n\t\t\tfor(const group of value.groups) {\n\t\t\t\tif ( group.value === assignment )\n\t\t\t\t\tweight = group.weight;\n\t\t\t\ttotal += group.weight;\n\t\t\t}\n\n\t\t\tif ( ! override && weight === total )\n\t\t\t\tcontinue;\n\n\t\t\ttwitch_assignments.push({\n\t\t\t\tkey,\n\t\t\t\tname: value.name,\n\t\t\t\tvalue: assignment,\n\t\t\t\toverride,\n\t\t\t\ttype: this.getTwitchTypeByKey(key),\n\t\t\t\trarity: weight / total\n\t\t\t});\n\n\t\t\t//out.push(`TWITCH | ${value.name}: ${this.getTwitchAssignment(key)}${this.hasTwitchOverride(key) ? ' (Overriden)' : ''}`)\n\t\t}\n\n\t\ttwitch_assignments.sort(sortExperimentLog);\n\n\t\tfor(const entry of twitch_assignments)\n\t\t\tout.push(`Twitch | ${entry.name}: ${entry.value}${entry.override ? ' (Override)' : ''} (r:${entry.rarity}, t:${entry.type}${entry.type === 'channel_id' ? `, c:${channel}`: ''})`);\n\n\t\treturn out.join('\\n');\n\t}\n\n\n\t// Twitch Experiments\n\n\tgetTwitchType(type: number) {\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\tif ( core?.experiments?.getExperimentType )\n\t\t\treturn core.experiments.getExperimentType(type);\n\n\t\tif ( type === 1 )\n\t\t\treturn 'device_id';\n\t\telse if ( type === 2 )\n\t\t\treturn 'user_id';\n\t\telse if ( type === 3 )\n\t\t\treturn 'channel_id';\n\t\treturn type;\n\t}\n\n\tgetTwitchTypeByKey(key: string) {\n\t\tconst exps = this.getTwitchExperiments(),\n\t\t\texp = exps?.[key];\n\n\t\tif ( exp?.t )\n\t\t\treturn this.getTwitchType(exp.t);\n\n\t\treturn null;\n\t}\n\n\tgetTwitchExperiments(): Record<string, TwitchExperimentData> {\n\t\tif ( window.__twilightSettings )\n\t\t\treturn window.__twilightSettings.experiments ?? {};\n\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\treturn core && core.experiments.experiments || {};\n\t}\n\n\n\tusingTwitchExperiment(key: string) {\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\treturn core && has(core.experiments.assignments, key)\n\t}\n\n\n\tprivate _getOverrideCookie() {\n\t\tconst raw = Cookie.get(OVERRIDE_COOKIE);\n\t\tlet out: OverrideCookie;\n\n\t\ttry {\n\t\t\tout = raw ? JSON.parse(raw) : {};\n\t\t} catch(err) {\n\t\t\tout = {} as OverrideCookie;\n\t\t}\n\n\t\tif ( ! out.experiments )\n\t\t\tout.experiments = {};\n\n\t\tif ( ! out.disabled )\n\t\t\tout.disabled = [];\n\n\t\treturn out;\n\t}\n\n\tprivate _saveOverrideCookie(value?: OverrideCookie) {\n\t\tif ( value ) {\n\t\t\tif ((! value.experiments || ! Object.keys(value.experiments).length) &&\n\t\t\t\t(! value.disabled || ! value.disabled.length)\n\t\t\t)\n\t\t\t\tvalue = undefined;\n\t\t}\n\n\t\tif ( value )\n\t\t\tCookie.set(OVERRIDE_COOKIE, JSON.stringify(value), COOKIE_OPTIONS);\n\t\telse\n\t\t\tCookie.remove(OVERRIDE_COOKIE, COOKIE_OPTIONS);\n\t}\n\n\n\tprivate _checkExternalAccess() {\n\t\tlet stack;\n\t\ttry {\n\t\t\tstack = new Error().stack;\n\t\t} catch(err) {\n\t\t\t/* :thinking: */\n\t\t\ttry {\n\t\t\t\tstack = err.stack;\n\t\t\t} catch(err_again) { /* aww */ }\n\t\t}\n\n\t\tif ( ! stack )\n\t\t\treturn;\n\n\t\tstack = stack.split(/\\s*\\n+\\s*/g).filter(x => x.startsWith('at '));\n\n\t\tlet external = false;\n\n\t\tfor(const line of stack) {\n\t\t\tif ( ! line.includes(SERVER_OR_EXT) ) {\n\t\t\t\texternal = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ( external )\n\t\t\tthis.log.warn('Detected access by external script.');\n\t}\n\n\n\tsetTwitchOverride(key: string, value: string) {\n\t\tconst overrides = this._getOverrideCookie(),\n\t\t\texperiments = overrides.experiments,\n\t\t\tdisabled = overrides.disabled;\n\n\t\tthis._checkExternalAccess();\n\n\t\texperiments[key] = value;\n\n\t\tconst idx = disabled.indexOf(key);\n\t\tif (idx != -1)\n\t\t\tdisabled.splice(idx, 1);\n\n\t\tthis._saveOverrideCookie(overrides);\n\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\tif ( core )\n\t\t\tcore.experiments.overrides[key] = value;\n\n\t\tthis._rebuildTwitchKey(key, true, value);\n\t}\n\n\tdeleteTwitchOverride(key: string) {\n\t\tconst overrides = this._getOverrideCookie(),\n\t\t\texperiments = overrides.experiments;\n\n\t\tthis._checkExternalAccess();\n\n\t\tif ( ! has(experiments, key) )\n\t\t\treturn;\n\n\t\tconst old_val = experiments[key];\n\t\tdelete experiments[key];\n\n\t\tthis._saveOverrideCookie(overrides);\n\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\tif ( core )\n\t\t\tdelete core.experiments.overrides[key];\n\n\t\tthis._rebuildTwitchKey(key, false, old_val);\n\t}\n\n\thasTwitchOverride(key: string) { // eslint-disable-line class-methods-use-this\n\t\tconst overrides = this._getOverrideCookie(),\n\t\t\texperiments = overrides.experiments;\n\n\t\treturn has(experiments, key);\n\t}\n\n\tgetTwitchAssignment(key: string, channel: string | null = null) {\n\t\tconst core = this.resolve('site')?.getCore?.(),\n\t\t\texps = core && core.experiments;\n\n\t\tif ( ! exps )\n\t\t\treturn null;\n\n\t\tif ( ! exps.hasInitialized && exps.initialize )\n\t\t\ttry {\n\t\t\t\texps.initialize();\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn('Error attempting to initialize Twitch experiments tracker.', err);\n\t\t\t}\n\n\t\tif ( exps.overrides && exps.overrides[key] )\n\t\t\treturn exps.overrides[key];\n\n\t\tconst exp_data = exps.experiments[key],\n\t\t\ttype = this.getTwitchType(exp_data?.t ?? 0);\n\n\t\t// channel_id experiments always use getAssignmentById\n\t\tif ( type === 'channel_id' ) {\n\t\t\treturn exps.getAssignmentById(key, {\n\t\t\t\tbucketing: {\n\t\t\t\t\ttype: 1,\n\t\t\t\t\tvalue: channel ?? this.settings.get('context.channelID')\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Otherwise, just use the default assignment?\n\t\tif ( exps.assignments?.[key] )\n\t\t\treturn exps.assignments[key];\n\n\t\t// If there is no default assignment, we should try to figure out\n\t\t// what assignment they *would* get.\n\n\t\tif ( type === 'device_id' )\n\t\t\treturn exps.selectTreatment(key, exp_data, this.unique_id);\n\n\t\telse if ( type === 'user_id' )\n\t\t\t// Technically, some experiments are expecting to get the user's\n\t\t\t// login rather than user ID. But we don't care that much if an\n\t\t\t// inactive legacy experiment is shown wrong. Meh.\n\t\t\treturn exps.selectTreatment(key, exp_data, this.resolve('site')?.getUser?.()?.id);\n\n\t\t// We don't know what kind of experiment this is.\n\t\t// Give up!\n\t\treturn null;\n\t}\n\n\tgetTwitchKeyFromName(name: string) {\n\t\tconst experiments = this.getTwitchExperiments();\n\t\tif ( ! experiments )\n\t\t\treturn;\n\n\t\tname = name.toLowerCase();\n\t\tfor(const key in experiments)\n\t\t\tif ( has(experiments, key) ) {\n\t\t\t\tconst data = experiments[key];\n\t\t\t\tif ( data && data.name && data.name.toLowerCase() === name )\n\t\t\t\t\treturn key;\n\t\t\t}\n\t}\n\n\tgetTwitchAssignmentByName(name: string, channel: string | null = null) {\n\t\tconst key = this.getTwitchKeyFromName(name);\n\t\tif ( ! key )\n\t\t\treturn null;\n\t\treturn this.getTwitchAssignment(key, channel);\n\t}\n\n\tprivate _rebuildTwitchKey(\n\t\tkey: string,\n\t\tis_set: boolean,\n\t\tnew_val: string | null\n\t) {\n\t\tconst core = this.resolve('site')?.getCore?.(),\n\t\t\texps = core.experiments,\n\n\t\t\told_val = has(exps.assignments, key) ?\n\t\t\t\texps.assignments[key] as string :\n\t\t\t\tnull;\n\n\t\tif ( old_val !== new_val ) {\n\t\t\tconst value = is_set ? new_val : old_val;\n\t\t\tthis.emit(':twitch-changed', key, value, old_val);\n\t\t\tthis.emit(`:twitch-changed:${key}`, value, old_val);\n\t\t}\n\t}\n\n\n\t// FFZ Experiments\n\n\tsetOverride<\n\t\tK extends keyof ExperimentTypeMap\n\t>(key: K, value: ExperimentTypeMap[K]) {\n\t\tconst overrides = this.settings.provider.get('experiment-overrides', {});\n\t\toverrides[key] = value;\n\n\t\tthis.settings.provider.set('experiment-overrides', overrides);\n\n\t\tthis._rebuildKey(key);\n\t}\n\n\tdeleteOverride(key: keyof ExperimentTypeMap) {\n\t\tconst overrides = this.settings.provider.get('experiment-overrides');\n\t\tif ( ! overrides || ! has(overrides, key) )\n\t\t\treturn;\n\n\t\tdelete overrides[key];\n\t\tif ( Object.keys(overrides).length )\n\t\t\tthis.settings.provider.set('experiment-overrides', overrides);\n\t\telse\n\t\t\tthis.settings.provider.delete('experiment-overrides');\n\n\t\tthis._rebuildKey(key);\n\t}\n\n\thasOverride(key: keyof ExperimentTypeMap) {\n\t\tconst overrides = this.settings.provider.get('experiment-overrides');\n\t\treturn overrides ? has(overrides, key): false;\n\t}\n\n\tget: <K extends keyof ExperimentTypeMap>(\n\t\tkey: K\n\t) => ExperimentTypeMap[K];\n\n\tgetAssignment<K extends keyof ExperimentTypeMap>(\n\t\tkey: K\n\t): ExperimentTypeMap[K] {\n\t\tif ( this.cache.has(key) )\n\t\t\treturn this.cache.get(key) as ExperimentTypeMap[K];\n\n\t\tconst experiment = this.experiments[key];\n\t\tif ( ! experiment ) {\n\t\t\tthis.log.warn(`Tried to get assignment for experiment \"${key}\" which is not known.`);\n\t\t\treturn null as ExperimentTypeMap[K];\n\t\t}\n\n\t\tconst overrides = this.settings.provider.get('experiment-overrides'),\n\t\t\tout = overrides && has(overrides, key) ?\n\t\t\t\toverrides[key] :\n\t\t\t\tExperimentManager.selectGroup<ExperimentTypeMap[K]>(key, experiment, this.unique_id ?? '');\n\n\t\tthis.cache.set(key, out);\n\t\treturn out as ExperimentTypeMap[K];\n\t}\n\n\tprivate _rebuildKey(key: keyof ExperimentTypeMap) {\n\t\tif ( ! this.cache.has(key) )\n\t\t\treturn;\n\n\t\tconst old_val = this.cache.get(key);\n\t\tthis.cache.delete(key);\n\t\tconst new_val = this.getAssignment(key);\n\n\t\tif ( new_val !== old_val ) {\n\t\t\tthis.emit(':changed', key, new_val, old_val);\n\t\t\tthis.emit(`:changed:${key}`, new_val, old_val);\n\t\t}\n\t}\n\n\n\tstatic selectGroup<T>(\n\t\tkey: string,\n\t\texperiment: FFZExperimentData,\n\t\tunique_id: string\n\t): T | null {\n\t\tconst seed = key + unique_id + (experiment.seed || ''),\n\t\t\ttotal = experiment.groups.reduce((a,b) => a + b.weight, 0);\n\n\t\tlet value = (SHA1(seed).words[0] >>> 0) / Math.pow(2, 32);\n\n\t\tfor(const group of experiment.groups) {\n\t\t\tvalue -= group.weight / total;\n\t\t\tif ( value <= 0 )\n\t\t\t\treturn group.value as T;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Localization\n// ============================================================================\n\nimport {DEBUG, SERVER} from 'utilities/constants';\nimport {get, pick_random, shallow_copy, deep_copy} from 'utilities/object';\nimport { getBuster } from 'utilities/time';\nimport Module from 'utilities/module';\n\nimport NewTransCore from 'utilities/translation-core';\n\nconst fetchJSON = (url, options) => fetch(url, options).then(r => r.ok ? r.json() : null).catch(() => null);\n\nconst STACK_SPLITTER = /\\s*at\\s+(.+?)\\s+\\((.+)\\)$/,\n\tSOURCE_SPLITTER = /^(.+):\\/\\/(.+?)(?:\\?[a-zA-Z0-9]+)?:(\\d+:\\d+)$/;\n\nconst MAP_OPTIONS = {\n\tfilter(line) {\n\t\treturn line.includes('.frankerfacez.com') || line.includes('localhost');\n\t},\n\tcacheGlobally: true\n};\n\nconst BAD_FRAMES = [\n\t'/src/i18n.js',\n\t'/src/utilities/vue.js'\n]\n\nconst FACES = ['(・`ω´・)', ';;w;;', 'owo', 'ono', 'oAo', 'oxo', 'ovo;', 'UwU', '>w<', '^w^', '> w >', 'v.v'],\n\n\ttransformText = (ast, fn) => ast.map(node => {\n\t\tif ( typeof node === 'string' )\n\t\t\treturn fn(node);\n\n\t\telse if ( typeof node === 'object' && node.o ) {\n\t\t\tconst out = Object.assign(node, {o: {}});\n\t\t\tfor(const key of Object.keys(node.o))\n\t\t\t\tout.o[key] = transformText(node.o[key], fn)\n\t\t}\n\n\t\treturn node;\n\t}),\n\n\towo = text => text\n\t\t.replace(/(?:r|l)/g, 'w')\n\t\t.replace(/(?:R|L)/g, 'W')\n\t\t.replace(/n([aeiou])/g, 'ny$1')\n\t\t.replace(/N([aeiou])/g, 'Ny$1')\n\t\t.replace(/N([AEIOU])/g, 'NY$1')\n\t\t.replace(/ove/g, 'uv')\n\t\t.replace(/!+/g, ` ${pick_random(FACES)} `),\n\n\n\tTRANSFORMATIONS = {\n\t\tdouble: (key, ast) => [...ast, ' ', ...ast],\n\t\tupper: (key, ast) => transformText(ast, n => n.toUpperCase()),\n\t\tlower: (key, ast) => transformText(ast, n => n.toLowerCase()),\n\t\tappend_key: (key, ast) => [...ast, ` (${key})`],\n\t\tset_key: key => [key],\n\t\towo: (key, ast) => transformText(ast, owo)\n\t};\n\n\n// ============================================================================\n// TranslationManager\n// ============================================================================\n\nexport default class TranslationManager extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis.inject('settings');\n\n\t\tthis._seen = new Set;\n\n\t\tthis.availableLocales = ['en'];\n\t\tthis.chunks = ['client'];\n\n\t\tthis.localeData = {\n\t\t\ten: { name: 'English' }\n\t\t}\n\n\t\tthis.loadLocales();\n\n\t\tthis.strings_loaded = false;\n\t\tthis.new_strings = 0;\n\t\tthis.changed_strings = 0;\n\t\tthis.capturing = false;\n\t\tthis.captured = new Map;\n\n\t\tthis.settings.addUI('i18n.debug.open', {\n\t\t\tpath: 'Debugging > Localization >> Editing',\n\t\t\tcomponent: 'i18n-open',\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.add('i18n.debug.capture', {\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val === null )\n\t\t\t\t\treturn DEBUG;\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Localization >> General',\n\t\t\t\ttitle: 'Enable message capture.',\n\t\t\t\tdescription: 'Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tforce_seen: true\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.capturing = val;\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('i18n.debug.transform', {\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Localization >> General',\n\t\t\t\ttitle: 'Transformation',\n\t\t\t\tdescription: 'Transform all localized strings to test string coverage as well as length.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: null, title: 'Disabled'},\n\t\t\t\t\t{value: 'upper', title: 'Upper Case'},\n\t\t\t\t\t{value: 'lower', title: 'Lower Case'},\n\t\t\t\t\t{value: 'append_key', title: 'Append Key'},\n\t\t\t\t\t{value: 'set_key', title: 'Set to Key'},\n\t\t\t\t\t{value: 'double', title: 'Double'},\n\t\t\t\t\t{value: 'owo', title: \"owo what's this\"}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.transformation = TRANSFORMATIONS[val];\n\t\t\t\tthis.emit(':transform');\n\t\t\t\tthis.emit(':update');\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('i18n.locale', {\n\t\t\tdefault: -1,\n\t\t\tprocess: (ctx, val) => {\n\t\t\t\tif ( val === -1 || typeof val !== 'string' )\n\t\t\t\t\tval = ctx.get('context.session.languageCode') || 'en';\n\n\t\t\t\tif ( this.availableLocales.includes(val) )\n\t\t\t\t\treturn val;\n\n\t\t\t\tif ( val === 'no' && this.availableLocales.includes('nb') )\n\t\t\t\t\treturn 'nb';\n\n\t\t\t\tconst idx = val.indexOf('-');\n\t\t\t\tif ( idx === -1 )\n\t\t\t\t\treturn 'en';\n\n\t\t\t\tval = val.slice(0, idx);\n\t\t\t\treturn this.availableLocales.includes(val) ? val : 'en';\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> General @{\"sort\":-100}',\n\t\t\t\ttitle: 'Language',\n\t\t\t\tdescription: `FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.`,\n\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: (profile, val) => this.getLocaleOptions(val)\n\t\t\t},\n\n\t\t\tchanged: val => this.locale = val\n\t\t});\n\n\n\t\tthis.settings.add('i18n.format.date', {\n\t\t\tdefault: 'default',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> Formatting',\n\t\t\t\ttitle: 'Date Format',\n\t\t\t\tdescription: 'The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\textra: {\n\t\t\t\t\tbefore: true,\n\t\t\t\t\tmode: 'date',\n\t\t\t\t\tcomponent: 'format-preview'\n\t\t\t\t},\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst out = [], now = new Date;\n\t\t\t\t\tfor (const [key, fmt] of Object.entries(this._.formats.date)) {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\tvalue: key, title: `${this.formatDate(now, key)} (${key})`\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.defaultDateFormat = val;\n\t\t\t\tthis.emit(':update')\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('i18n.format.time', {\n\t\t\tdefault: 'short',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> Formatting',\n\t\t\t\ttitle: 'Time Format',\n\t\t\t\tdescription: 'The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\textra: {\n\t\t\t\t\tbefore: true,\n\t\t\t\t\tmode: 'time',\n\t\t\t\t\tcomponent: 'format-preview'\n\t\t\t\t},\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst out = [], now = new Date;\n\t\t\t\t\tfor (const [key,fmt] of Object.entries(this._.formats.time)) {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\tvalue: key, title: `${this.formatTime(now, key)} (${key})`\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.defaultTimeFormat = val;\n\t\t\t\tthis.emit(':update')\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('i18n.format.datetime', {\n\t\t\tdefault: 'medium',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> Formatting',\n\t\t\t\ttitle: 'Date-Time Format',\n\t\t\t\tdescription: 'The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\textra: {\n\t\t\t\t\tbefore: true,\n\t\t\t\t\tmode: 'datetime',\n\t\t\t\t\tcomponent: 'format-preview'\n\t\t\t\t},\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst out = [], now = new Date;\n\t\t\t\t\tfor (const [key,fmt] of Object.entries(this._.formats.datetime)) {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\tvalue: key, title: `${this.formatDateTime(now, key)} (${key})`\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.defaultDateTimeFormat = val;\n\t\t\t\tthis.emit(':update')\n\t\t\t}\n\t\t});\n\t}\n\n\tgetLocaleOptions(val) {\n\t\tif( val === undefined )\n\t\t\tval = this.settings.get('i18n.locale');\n\n\t\tconst normal_out = [],\n\t\t\tjoke_out = [];\n\n\t\tfor(const locale of this.availableLocales) {\n\t\t\tconst data = this.localeData[locale];\n\t\t\tlet title = data?.native_name || data?.name || locale;\n\n\t\t\tif ( data?.coverage != null && data?.coverage < 100 )\n\t\t\t\ttitle = this.t('i18n.locale-coverage', '{name} ({coverage,number,percent} Complete)', {\n\t\t\t\t\tname: title,\n\t\t\t\t\tcoverage: data.coverage / 100\n\t\t\t\t});\n\n\t\t\tconst entry = {\n\t\t\t\tselected: val === locale,\n\t\t\t\tvalue: locale,\n\t\t\t\ttitle\n\t\t\t};\n\n\t\t\tif ( data?.joke )\n\t\t\t\tjoke_out.push(entry);\n\t\t\telse\n\t\t\t\tnormal_out.push(entry);\n\t\t}\n\n\t\tnormal_out.sort((a, b) => a.title.localeCompare(b.title));\n\t\tjoke_out.sort((a, b) => a.title.localeCompare(b.title));\n\n\t\tlet out = [{\n\t\t\tselected: val === -1,\n\t\t\tvalue: -1,\n\t\t\ti18n_key: 'setting.appearance.localization.general.language.twitch',\n\t\t\ttitle: \"Use Twitch's Language\"\n\t\t}];\n\n\t\tif ( normal_out.length ) {\n\t\t\tout.push({\n\t\t\t\tseparator: true,\n\t\t\t\ti18n_key: 'setting.appearance.localization.general.language.languages',\n\t\t\t\ttitle: 'Supported Languages'\n\t\t\t});\n\n\t\t\tout = out.concat(normal_out);\n\t\t}\n\n\t\tif ( joke_out.length ) {\n\t\t\tout.push({\n\t\t\t\tseparator: true,\n\t\t\t\ti18n_key: 'setting.appearance.localization.general.language.joke',\n\t\t\t\ttitle: 'Joke Languages'\n\t\t\t});\n\n\t\t\tout = out.concat(joke_out);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tonEnable() {\n\t\tthis.capturing = this.settings.get('i18n.debug.capture');\n\t\tif ( this.capturing )\n\t\t\tthis.loadStrings();\n\n\t\tthis._ = new NewTransCore({ //TranslationCore({\n\t\t\twarn: (...args) => this.log.warn(...args),\n\t\t\tdefaultDateFormat: this.settings.get('i18n.format.date'),\n\t\t\tdefaultTimeFormat: this.settings.get('i18n.format.time'),\n\t\t\tdefaultDateTimeFormat: this.settings.get('i18n.format.datetime')\n\t\t});\n\n\t\tif ( window.BroadcastChannel ) {\n\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-i18n');\n\t\t\tbc.addEventListener('message',\n\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\t\t}\n\n\t\tthis._.transformation = TRANSFORMATIONS[this.settings.get('i18n.debug.transform')];\n\t\tthis.locale = this.settings.get('i18n.locale');\n\t}\n\n\tasync loadChunk(name) {\n\t\tif (this.chunks.includes(name))\n\t\t\treturn [];\n\n\t\tthis.chunks.push(name);\n\n\t\tconst locale = this._.locale;\n\t\tconst phrases = await this.loadLocale(locale, name);\n\n\t\tconst added = this._.extend(phrases);\n\t\tif ( added.length ) {\n\t\t\tthis.log.info(`Loaded Chunk: ${name} -- Phrases: ${added.length}`);\n\t\t\tthis.emit(':loaded', added);\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tbroadcast(msg) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\tgetKeys() {\n\t\tconst out = [];\n\t\tfor(const entry of this.captured.values()) {\n\t\t\tconst thing = deep_copy(entry);\n\t\t\tthing.translation = this._.phrases.get(thing.key) || thing.phrase;\n\t\t\tout.push(thing);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\trequestKeys() {\n\t\tthis.broadcast({type: 'request-keys'});\n\t}\n\n\tupdatePhrase(key, phrase) {\n\t\tthis.broadcast({\n\t\t\ttype: 'update-key',\n\t\t\tkey,\n\t\t\tphrase\n\t\t});\n\n\t\tthis._.extend({\n\t\t\t[key]: phrase\n\t\t});\n\n\t\tthis.emit(':loaded', [key]);\n\t\tthis.emit(':update');\n\t}\n\n\thandleMessage(event) {\n\t\tconst msg = event.data;\n\t\tif ( ! msg )\n\t\t\treturn;\n\n\t\tif ( msg.type === 'update-key' ) {\n\t\t\tthis._.extend({\n\t\t\t\t[msg.key]: msg.phrase\n\t\t\t});\n\n\t\t\tthis.emit(':loaded', [msg.key]);\n\t\t\tthis.emit(':update');\n\n\t\t} else if ( msg.type === 'request-keys' )\n\t\t\tthis.broadcast({\n\t\t\t\ttype: 'keys',\n\t\t\t\tdata: Array.from(this.captured.values())\n\t\t\t});\n\n\t\telse if ( msg.type === 'keys' && Array.isArray(msg.data) ) {\n\t\t\tfor(const entry of msg.data) {\n\t\t\t\t// TODO: Merging logic.\n\t\t\t\tthis.captured.set(entry.key, entry);\n\t\t\t}\n\n\t\t\tthis.emit(':got-keys');\n\t\t}\n\t}\n\n\n\topenUI(popout = true) {\n\t\t// Override the capturing state when we open the UI.\n\t\tif ( ! this.capturing ) {\n\t\t\tthis.capturing = true;\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\tconst mod = this.resolve('translation_ui');\n\t\tif ( popout )\n\t\t\tmod.openPopout();\n\t\telse\n\t\t\tmod.enable();\n\t}\n\n\n\tget dayjsLocale() {\n\t\treturn this._?._dayjs_locale;\n\t}\n\n\tget locale() {\n\t\treturn this._ && this._.locale;\n\t}\n\n\tset locale(new_locale) {\n\t\tthis.setLocale(new_locale);\n\t}\n\n\n\tasync loadStrings(ignore_loaded = false) {\n\t\tif ( this.strings_loaded && ! ignore_loaded )\n\t\t\treturn;\n\n\t\tif ( this.strings_loading )\n\t\t\treturn;\n\n\t\tthis.strings_loading = true;\n\n\t\tconst resp = await fetch(`${SERVER}/script/locale/strings.json?_=${getBuster(30)}`);\n\t\tlet strings;\n\t\tif (! resp.ok ) {\n\t\t\tthis.log.warn(`Error Loading Strings -- Status: ${resp.status}`);\n\t\t\tstrings = [];\n\t\t} else\n\t\t\tstrings = await resp.json();\n\n\t\tfor(const str of strings) {\n\t\t\tconst key = str.id;\n\t\t\tlet store = this.captured.get(key);\n\t\t\tif ( ! store ) {\n\t\t\t\tthis.captured.set(key, store = {key, phrase: str.default, hits: 0, calls: []});\n\t\t\t\tif ( str.source?.length )\n\t\t\t\t\tstore.calls.push(str.source);\n\t\t\t}\n\n\t\t\tif ( ! store.options && str.context?.length )\n\t\t\t\ttry {\n\t\t\t\t\tstore.options = JSON.parse(str.context);\n\t\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\tstore.known = str.default;\n\t\t\tstore.different = str.default !== store.phrase;\n\t\t}\n\n\t\tthis.new_strings = 0;\n\t\tthis.changed_strings = 0;\n\n\t\tfor(const entry of this.captured.values()) {\n\t\t\tif ( ! entry.known )\n\t\t\t\tthis.new_strings++;\n\t\t\tif ( entry.different )\n\t\t\t\tthis.changed_strings++;\n\t\t}\n\n\t\tthis.strings_loaded = true;\n\t\tthis.strings_loading = false;\n\n\t\tthis.log.info(`Loaded ${strings.length} strings from the server.`);\n\t\tthis.emit(':strings-loaded');\n\t\tthis.emit(':new-strings', this.new_strings);\n\t\tthis.emit(':changed-strings', this.changed_strings);\n\t}\n\n\n\tsee(key, phrase, options) {\n\t\tif ( ! this.capturing )\n\t\t\treturn;\n\n\t\tlet stack;\n\t\ttry {\n\t\t\tstack = new Error().stack;\n\t\t} catch(err) {\n\t\t\t/* :thinking: */\n\t\t\ttry {\n\t\t\t\tstack = err.stack;\n\t\t\t} catch(err_again) { /* aww */ }\n\t\t}\n\n\t\tlet store = this.captured.get(key);\n\t\tif ( ! store ) {\n\t\t\tthis.captured.set(key, store = {key, phrase, hits: 0, calls: []});\n\t\t\tif ( this.strings_loaded ) {\n\t\t\t\tthis.new_strings++;\n\t\t\t\tthis.emit(':new-strings', this.new_strings);\n\t\t\t}\n\t\t}\n\n\t\tif ( phrase !== store.phrase ) {\n\t\t\tstore.phrase = phrase;\n\t\t\tif ( store.known && phrase !== store.known && ! store.different ) {\n\t\t\t\tstore.different = true;\n\t\t\t\tthis.changed_strings++;\n\t\t\t\tthis.emit(':changed-strings', this.changed_strings);\n\t\t\t}\n\t\t}\n\n\t\tstore.options = this.pluckVariables(key, options);\n\t\tstore.hits++;\n\n\t\tif ( stack ) {\n\t\t\tif ( this.mapStackTrace )\n\t\t\t\tthis.mapStackTrace(stack, result => this.recordCall(store, result), MAP_OPTIONS);\n\t\t\telse\n\t\t\t\timport(/* webpackChunkName: 'translation-ui' */ 'sourcemapped-stacktrace').then(mod => {\n\t\t\t\t\tthis.mapStackTrace = mod.mapStackTrace;\n\t\t\t\t\tthis.mapStackTrace(stack, result => this.recordCall(store, result), MAP_OPTIONS);\n\t\t\t\t});\n\t\t}\n\t}\n\n\n\tpluckVariables(key, options) {\n\t\tconst ast = this._.cache.get(key);\n\t\tif ( ! ast )\n\t\t\treturn null;\n\n\t\tconst out = {};\n\t\tthis._doPluck(ast, options, out);\n\t\tif ( Object.keys(out).length )\n\t\t\treturn out;\n\n\t\treturn null;\n\t}\n\n\t_doPluck(ast, options, out) {\n\t\tif ( Array.isArray(ast) ) {\n\t\t\tfor(const val of ast)\n\t\t\t\tthis._doPluck(val, options, out);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof ast === 'object' && ast.v ) {\n\t\t\tconst val = get(ast.v, options);\n\t\t\t// Skip React objects.\n\t\t\tif ( val && val['$$typeof'] )\n\t\t\t\treturn;\n\n\t\t\tout[ast.v] = shallow_copy(val);\n\t\t}\n\t}\n\n\n\trecordCall(store, stack) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! Array.isArray(stack) )\n\t\t\treturn;\n\n\t\tfor(const line of stack) {\n\t\t\tconst match = STACK_SPLITTER.exec(line);\n\t\t\tif ( ! match )\n\t\t\t\tcontinue;\n\n\t\t\tconst location = SOURCE_SPLITTER.exec(match[2]);\n\t\t\tif ( ! location || location[1] !== 'webpack' )\n\t\t\t\tcontinue;\n\n\t\t\tconst file = location[2];\n\t\t\tif ( file.includes('/node_modules/') || BAD_FRAMES.includes(file) )\n\t\t\t\tcontinue;\n\n\t\t\tlet out;\n\t\t\tif ( match[1] === 'MainMenu.getSettingsTree' )\n\t\t\t\tout = 'FFZ Control Center';\n\t\t\telse {\n\t\t\t\tlet label = match[1];\n\t\t\t\tif ( (label === 'Proxy.render' || label.startsWith('Proxy.push')) && location[2].includes('.vue') )\n\t\t\t\t\tlabel = 'Vue Component';\n\n\t\t\t\tout = `${label} (${location[2]}:${location[3]})`;\n\t\t\t}\n\n\t\t\tif ( ! store.calls.includes(out) )\n\t\t\t\tstore.calls.push(out);\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\n\tasync loadLocales() {\n\t\tconst resp = await fetch(`${SERVER}/script/locale/locales.json?_=${getBuster(30)}`);\n\t\tlet data;\n\t\tif ( ! resp.ok ) {\n\t\t\tthis.log.warn(`Error Populating Locales -- Status: ${resp.status}`);\n\t\t} else\n\t\t\tdata = await resp.json();\n\n\t\tif ( ! Array.isArray(data) || ! data.length )\n\t\t\tdata = [{\n\t\t\t\tid: 'en',\n\t\t\t\tname: 'English',\n\t\t\t\tcoverage: 100,\n\t\t\t\trtl: false,\n\t\t\t\thashes: {}\n\t\t\t}];\n\n\t\tthis.localeData = {};\n\t\tthis.availableLocales = [];\n\n\t\tfor(const locale of data) {\n\t\t\tconst key = locale.id.toLowerCase();\n\t\t\tthis.localeData[key] = locale;\n\t\t\tthis.availableLocales.push(key);\n\t\t}\n\n\t\tthis.emit(':locales-loaded');\n\t}\n\n\n\tasync loadLocale(locale, chunk = null) {\n\t\t// Normalize the locale.\n\t\tlocale = locale.toLowerCase();\n\n\t\tif ( locale === 'en' )\n\t\t\treturn {};\n\n\t\tconst hashes = this.localeData[locale]?.hashes;\n\t\tif (! hashes) {\n\t\t\tthis.log.info(`Cannot Load Locale: ${locale}`);\n\t\t\treturn {};\n\t\t}\n\n\t\tif (! chunk)\n\t\t\tchunk = this.chunks;\n\t\telse if (! Array.isArray(chunk))\n\t\t\tchunk = [chunk];\n\n\t\tconst id = this.localeData[locale].id;\n\t\tconst promises = [];\n\n\t\tfor(const chnk of chunk) {\n\t\t\tconst hash = hashes[chnk];\n\t\t\tif (! hash)\n\t\t\t\tcontinue;\n\n\t\t\tpromises.push(fetchJSON(`https://cdn2.frankerfacez.com/static/locale/${id}/${chnk}.${hash}.json`));\n\t\t}\n\n\t\tconst chunks = await Promise.all(promises);\n\t\tconst result = {};\n\n\t\tlet ignored = 0;\n\n\t\tfor(const chunk of chunks) {\n\t\t\tif (! chunk)\n\t\t\t\tcontinue;\n\n\t\t\tfor(const [key,val] of Object.entries(chunk)) {\n\t\t\t\tif (typeof val === 'string' && val.length > 0)\n\t\t\t\t\tresult[key] = val;\n\t\t\t\telse\n\t\t\t\t\tignored++;\n\t\t\t}\n\t\t}\n\n\t\tif (ignored > 0)\n\t\t\tthis.log.debug(`Ignored ${ignored} invalid values while loading ${locale} chunks.`);\n\n\t\treturn result;\n\t}\n\n\tasync setLocale(new_locale) {\n\t\t// Normalize the locale.\n\t\tnew_locale = new_locale.toLowerCase();\n\n\t\tconst old_locale = this._.locale;\n\t\tif ( new_locale === old_locale )\n\t\t\treturn [];\n\n\t\tthis._.locale = new_locale;\n\t\tthis._.clear();\n\t\tthis.log.info(`Changed Locale: ${new_locale} -- Old: ${old_locale}`);\n\t\tthis.emit(':changed', new_locale, old_locale);\n\t\tthis.emit(':update');\n\n\t\tif ( new_locale === 'en' ) {\n\t\t\t// All the built-in messages are English. We don't need special\n\t\t\t// logic to load the translations.\n\t\t\tthis.emit(':loaded', []);\n\t\t\tthis._._dayjs_locale = 'en';\n\t\t\treturn [];\n\t\t}\n\n\t\tconst data = this.localeData[new_locale];\n\t\tconst phrases = await this.loadLocale(data?.id || new_locale);\n\n\t\tlet djs;\n\t\ttry {\n\t\t\tdjs = data?.dayjs_override || new_locale;\n\t\t\tawait this.loadDayjsLocale(djs);\n\t\t} catch (err) {\n\t\t\tthis.log.warn(`Unable to load DayJS locale for ${new_locale}`);\n\t\t\tdjs = 'en';\n\t\t}\n\n\t\tif ( this._.locale !== new_locale )\n\t\t\tthrow new Error('locale has changed since we started loading');\n\n\t\tthis._._dayjs_locale = djs;\n\n\t\tconst added = this._.extend(phrases);\n\t\tif ( added.length ) {\n\t\t\tthis.log.info(`Loaded Locale: ${new_locale} -- Phrases: ${added.length}`);\n\t\t\tthis.emit(':loaded', added);\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tasync loadDayjsLocale(locale) {\n\t\tif ( locale === 'en' || locale === 'en-arrr' )\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tawait import(\n\t\t\t\t/* webpackMode: 'lazy' */\n\t\t\t\t/* webpackChunkName: 'i18n-[index]' */\n\t\t\t\t`dayjs/locale/${locale}.js`\n\t\t\t);\n\t\t} catch(err) {\n\t\t\tthis.log.warn(`Unable to load day.js locale data for locale \"${locale}\"`, err);\n\t\t}\n\t}\n\n\thas(key) {\n\t\treturn this._.has(key);\n\t}\n\n\tformatNode(...args) {\n\t\treturn this._.formatNode(...args);\n\t}\n\n\ttoLocaleString(...args) {\n\t\treturn this._.toLocaleString(...args);\n\t}\n\n\ttoRelativeTime(...args) {\n\t\treturn this._.formatRelativeTime(...args);\n\t}\n\n\tformatNumber(...args) {\n\t\treturn this._.formatNumber(...args);\n\t}\n\n\tformatCurrency(...args) {\n\t\treturn this._.formatCurrency(...args);\n\t}\n\n\tformatDuration(...args) {\n\t\treturn this._.formatDuration(...args);\n\t}\n\n\tformatDate(...args) {\n\t\treturn this._.formatDate(...args)\n\t}\n\n\tformatTime(...args) {\n\t\treturn this._.formatTime(...args)\n\t}\n\n\tformatDateTime(...args) {\n\t\treturn this._.formatDateTime(...args)\n\t}\n\n\tt(key, ...args) {\n\t\tthis.see(key, ...args);\n\t\treturn this._.t(key, ...args);\n\t}\n\n\ttList(key, ...args) {\n\t\tthis.see(key, ...args);\n\t\treturn this._.tList(key, ...args);\n\t}\n}\n\n\n// ============================================================================\n// Transformations\n// ============================================================================\n\nconst DOLLAR_REGEX = /\\$/g;\nconst REPLACE = String.prototype.replace;\n\nconst FORMAT_REGEX = /^\\s*([^(]+?)\\s*(?:\\(\\s*([^)]+?)\\s*\\))?\\s*$/;\n\nexport function parseFormatters(fmt) {\n\tif (!fmt || ! fmt.length)\n\t\treturn;\n\n\tconst result = [];\n\n\tfor(const token of fmt.split(/\\|/g)) {\n\t\tconst match = FORMAT_REGEX.exec(token);\n\t\tif (!match)\n\t\t\tcontinue;\n\n\t\tresult.push({\n\t\t\tfmt: match[1],\n\t\t\textra: match[2]\n\t\t});\n\t}\n\n\treturn result;\n}\n\nexport function transformPhrase(phrase, substitutions, locale, token_regex, formatters) {\n\tconst is_array = Array.isArray(phrase);\n\tif ( substitutions == null )\n\t\treturn is_array ? phrase[0] : phrase;\n\n\tlet result = phrase;\n\tconst options = typeof substitutions === 'number' ? {count: substitutions} : substitutions;\n\n\tif ( is_array )\n\t\tresult = result[0];\n\n\tif ( typeof result === 'string' )\n\t\tresult = REPLACE.call(result, token_regex, (expr, arg, fmt) => {\n\t\t\tlet val = get(arg.trim(), options);\n\t\t\tif ( val == null )\n\t\t\t\treturn '';\n\n\t\t\tconst fmts = parseFormatters(fmt);\n\t\t\tlet formatted = false;\n\t\t\tif (fmts) {\n\t\t\t\tfor(const format of fmts) {\n\t\t\t\t\tconst formatter = formatters[format.fmt];\n\t\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\t\tval = formatter(val, locale, options, format.extra);\n\t\t\t\t\t\tformatted = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (! formatted && typeof val === 'string' )\n\t\t\t\tval = REPLACE.call(val, DOLLAR_REGEX, '$$');\n\n\t\t\treturn val;\n\t\t});\n\n\treturn result;\n}\n","'use strict';\n\n// ============================================================================\n// Staging Selector\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { API_SERVER, SERVER, STAGING_API, STAGING_CDN } from './utilities/constants';\nimport type SettingsManager from './settings';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\tstaging: StagingSelector;\n\t}\n\tinterface ModuleEventMap {\n\t\tstaging: StagingEvents;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'data.use-staging': boolean;\n\t}\n}\n\ntype StagingEvents = {\n\t':updated': [api: string, cdn: string];\n}\n\nexport default class StagingSelector extends Module<'staging', StagingEvents> {\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\tapi: string = API_SERVER;\n\tcdn: string = SERVER;\n\tactive: boolean = false;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.inject('settings');\n\n\t\tthis.settings.add('data.use-staging', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Data Sources >> Staging @{\"sort\": -1}',\n\t\t\t\tforce_seen: true,\n\t\t\t\ttitle: 'Use staging as data source.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.updateStaging(false);\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.settings.getChanges('data.use-staging', this.updateStaging, this);\n\t}\n\n\tprivate updateStaging(val: boolean) {\n\t\tthis.active = val;\n\n\t\tthis.api = val\n\t\t\t? STAGING_API\n\t\t\t: API_SERVER;\n\n\t\tthis.cdn = val\n\t\t\t? STAGING_CDN\n\t\t\t: SERVER;\n\n\t\tthis.emit(':updated', this.api, this.cdn);\n\t}\n}\n","import { EventEmitter } from \"../utilities/events\";\nimport { set_equals, shallow_object_equals } from \"../utilities/object\";\n\nexport type PubSubClientEvents = {\n\tconnect: [event: Event];\n\tdisconnect: [event: Event | null];\n\terror: [event: Event];\n\tmessage: [event: {\n\t\ttopic: string,\n\t\tdata: any\n\t}];\n}\n\nenum State {\n\tDisconnected,\n\tConnecting,\n\tConnected\n}\n\n\nexport function enumerateSubs(topic: string) {\n\t// I initially tried using a generator for this, but\n\t// using an array builder is faster. Less function overhead\n\t// since we're iterating the whole thing anyways, and\n\t// as long as we don't hit our memory limit on the worker\n\t// I really don't care about memory.\n\tlet idx = topic.length;\n\tconst out = [topic];\n\twhile ((idx = topic.lastIndexOf('/', idx - 1)) !== -1)\n\t\tout.push(`${topic.slice(0, idx)}/*`);\n\tout.push('*');\n\treturn out;\n}\n\n\nexport class PubSubClient extends EventEmitter<PubSubClientEvents> {\n\n\t_ws: WebSocket | null = null;\n\t_topics: Set<string> = new Set();\n\t_live_topics: Set<string> = new Set();\n\n\t_want_connection = false;\n\t_state = State.Disconnected;\n\n\t_reconnectTimer: ReturnType<typeof setTimeout> | null = null;\n\t_failedConnections = 0;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis._performReconnect = this._performReconnect.bind(this);\n\n\t}\n\n\t_reconnect(wantDelay: boolean = true) {\n\t\tif ( this._reconnectTimer )\n\t\t\treturn;\n\n\t\tlet delay = 250 + (wantDelay\n\t\t\t? Math.floor(this._failedConnections * (Math.random() * 5000) + 5000)\n\t\t\t: 0);\n\t\tthis._reconnectTimer = setTimeout(this._performReconnect, delay);\n\t}\n\n\t_performReconnect() {\n\n\t\tthis._reconnectTimer = null;\n\n\t\tif (this._ws) {\n\t\t\tthis._ws.close();\n\t\t\tthis._ws = null;\n\t\t\tthis._state = State.Disconnected;\n\t\t}\n\n\t\tthis._live_topics = new Set(this._topics);\n\n\t\tif ( ! this._live_topics.size )\n\t\t\treturn;\n\n\t\tthis._state = State.Connecting;\n\n\t\tconst url = new URL(`wss://pubsub.workers.frankerfacez.com/ws`);\n\t\tif ( this._live_topics.size > 10 )\n\t\t\turl.searchParams.append('t', '*');\n\t\telse\n\t\t\tfor(const topic of this._live_topics)\n\t\t\t\turl.searchParams.append('t', topic);\n\n\t\tconst ws = this._ws = new WebSocket(url.toString());\n\n\t\tws.addEventListener('open', evt => {\n\t\t\tthis._state = State.Connected;\n\t\t\tthis._failedConnections = 0;\n\t\t\tthis.emit('connect', evt);\n\t\t});\n\n\t\tws.addEventListener('error', evt => {\n\t\t\tthis.emit('error', evt);\n\t\t});\n\n\t\tws.addEventListener('close', evt => {\n\t\t\tthis._ws = null;\n\t\t\tthis._state = State.Disconnected;\n\t\t\tthis.emit('disconnect', evt);\n\t\t\tif (this._want_connection)\n\t\t\t\tthis._reconnect();\n\t\t});\n\n\t\tws.addEventListener('message', evt => {\n\t\t\tif (typeof evt.data === 'string') {\n\t\t\t\tlet packet: {topic: string; data: any};\n\t\t\t\ttry {\n\t\t\t\t\tpacket = JSON.parse(evt.data);\n\t\t\t\t} catch(err) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!packet.topic || typeof packet.topic !== 'string')\n\t\t\t\t\treturn;\n\n\t\t\t\t// Validate that we really want this topic.\n\t\t\t\tif (this._live_topics.size > 10 && ! this._live_topics.has(packet.topic)) {\n\t\t\t\t\tlet found = false;\n\t\t\t\t\tfor(const sub of enumerateSubs(packet.topic)) {\n\t\t\t\t\t\tif (this._live_topics.has(sub)) {\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!found)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.emit('message', packet);\n\t\t\t}\n\t\t});\n\n\t}\n\n\tget connected() {\n\t\treturn this._state === State.Connected;\n\t}\n\n\tget connecting() {\n\t\treturn this._state === State.Connecting;\n\t}\n\n\tget disconnected() {\n\t\treturn this._state === State.Disconnected;\n\t}\n\n\tconnect() {\n\t\tthis._want_connection = true;\n\t\tthis._reconnect(false);\n\t}\n\n\tdisconnect() {\n\t\tthis._want_connection = false;\n\t\tthis._failedConnections = 0;\n\t\tif (this._reconnectTimer) {\n\t\t\tclearTimeout(this._reconnectTimer);\n\t\t\tthis._reconnectTimer = null;\n\t\t}\n\t\tif (this._ws) {\n\t\t\tthis._ws.close();\n\t\t\tthis._ws = null;\n\t\t\tthis._state = State.Disconnected;\n\t\t\tthis.emit('disconnect', null);\n\t\t}\n\t}\n\n\tsubscribe(topics: string | string[]) {\n\t\tif (!Array.isArray(topics))\n\t\t\ttopics = [topics];\n\n\t\tfor(const topic of topics)\n\t\t\tthis._topics.add(topic);\n\n\t\tif (this._want_connection && !set_equals(this._topics, this._live_topics))\n\t\t\tthis._reconnect();\n\t}\n\n\tunsubscribe(topics: string | string[]) {\n\t\tif (!Array.isArray(topics))\n\t\t\ttopics = [topics];\n\n\t\tfor(const topic of topics)\n\t\t\tthis._topics.delete(topic);\n\n\t\tif (this._want_connection && !set_equals(this._topics, this._live_topics))\n\t\t\tthis._reconnect();\n\t}\n\n\n}\n","'use strict';\n\n// ============================================================================\n// PubSub Client\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { PubSubClient } from './client';\nimport type ExperimentManager from '../experiments';\nimport type SettingsManager from '../settings';\nimport type { PubSubCommands } from 'utilities/types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\tpubsub: PubSub;\n\t}\n\tinterface ModuleEventMap {\n\t\tpubsub: PubSubEvents;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'pubsub.enabled': boolean;\n\t}\n\tinterface ExperimentTypeMap {\n\t\tworker_pubsub: boolean;\n\t}\n}\n\n\ntype PubSubCommandData<K extends keyof PubSubCommands> = {\n\ttopic: string;\n\tcmd: K;\n\tdata: PubSubCommands[K];\n};\n\ntype PubSubCommandKey = `:command:${keyof PubSubCommands}`;\n\ntype PubSubEvents = {\n\t':sub-change': [];\n\t':message': [topic: string, data: unknown];\n} & {\n\t[K in keyof PubSubCommands as `:command:${K}`]: [data: PubSubCommands[K], meta: PubSubCommandData<K>];\n}\n\n\nexport default class PubSub extends Module<'pubsub', PubSubEvents> {\n\n\t// Dependencies\n\texperiments: ExperimentManager = null as any;\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\t_topics: Map<string, Set<unknown>>;\n\t_client: PubSubClient | null;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('experiments');\n\n\t\tthis.settings.add('pubsub.enabled', {\n\t\t\tdefault: () => this.experiments.getAssignment('worker_pubsub') ?? false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging @{\"expanded\": false, \"sort\": 9999} > PubSub >> General',\n\t\t\t\ttitle: 'Enable PubSub.',\n\t\t\t\tdescription: 'Whether or not you want your client to connect to FrankerFaceZ\\'s PubSub system. This is still in testing and should be left alone unless you know what you\\'re doing.',\n\t\t\t\tforce_seen: true,\n\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\n\t\t\tchanged: val => val ? this.connect() : this.disconnect()\n\t\t});\n\n\t\tthis._topics = new Map;\n\t\tthis._client = null;\n\t}\n\n\tonEnable() {\n\t\tthis.subscribe(null, 'global');\n\t\tthis.connect();\n\n\t\tthis.on('experiments:changed:worker_pubsub', this._updateSetting, this);\n\t}\n\n\tonDisable() {\n\t\tthis.off('experiments:changed:worker_pubsub', this._updateSetting, this);\n\n\t\tthis.disconnect();\n\t\tthis.unsubscribe(null, 'global');\n\t}\n\n\t_updateSetting() {\n\t\tthis.settings.update('pubsub.enabled');\n\t}\n\n\n\t// ========================================================================\n\t// Properties\n\t// ========================================================================\n\n\tget connected() {\n\t\treturn this._client != null;\n\t}\n\n\n\t// ========================================================================\n\t// Connection Logic\n\t// ========================================================================\n\n\treconnect() {\n\t\tthis.disconnect();\n\t\tthis.connect();\n\t}\n\n\tasync connect() {\n\t\t// If there's already a client, or PubSub is disabled\n\t\t// then we have nothing to do.\n\t\tif ( this._client || ! this.settings.get('pubsub.enabled') )\n\t\t\treturn;\n\n\t\t// Create a new instance of the PubSubClient class.\n\t\tconst client = this._client = new PubSubClient();\n\n\t\t// Connect to the various events.\n\t\tclient.on('connect', () => {\n\t\t\tthis.log.info('Connected to PubSub.');\n\t\t});\n\n\t\tclient.on('disconnect', () => {\n\t\t\tthis.log.info('Disconnected from PubSub.');\n\t\t});\n\n\t\tclient.on('error', err => {\n\t\t\tthis.log.error('Error in PubSub', err);\n\t\t});\n\n\t\tclient.on('message', event => {\n\t\t\tconst topic = event.topic,\n\t\t\t\tdata = event.data as PubSubCommandData<any>;\n\n\t\t\tif ( ! data?.cmd ) {\n\t\t\t\tthis.log.debug(`Received message on topic \"${topic}\":`, data);\n\t\t\t\tthis.emit(`:message`, topic, data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata.topic = topic;\n\n\t\t\tthis.log.debug(`Received command on topic \"${topic}\" for command \"${data.cmd}\":`, data.data);\n\t\t\tthis.emit(`:command:${data.cmd}` as PubSubCommandKey, data.data, data);\n\t\t});\n\n\t\t// Subscribe to our topics.\n\t\tconst topics = [...this._topics.keys()];\n\t\tclient.subscribe(topics);\n\n\t\t// And start the client.\n\t\tawait client.connect();\n\t}\n\n\tdisconnect() {\n\t\tif ( ! this._client )\n\t\t\treturn;\n\n\t\tthis._client.disconnect();\n\t\tthis._client = null;\n\t}\n\n\n\t// ========================================================================\n\t// Topics\n\t// ========================================================================\n\n\tsubscribe(referrer: unknown, ...topics: string[]) {\n\t\tconst topic_map = this._topics;\n\t\tlet changed = false;\n\t\tfor(const topic of topics) {\n\t\t\tlet refs = topic_map.get(topic);\n\t\t\tif ( refs )\n\t\t\t\trefs.add(referrer);\n\t\t\telse {\n\t\t\t\tif ( this._client )\n\t\t\t\t\tthis._client.subscribe(topic);\n\n\t\t\t\trefs = new Set;\n\t\t\t\trefs.add(referrer);\n\n\t\t\t\ttopic_map.set(topic, refs);\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.emit(':sub-change');\n\t}\n\n\n\tunsubscribe(referrer: unknown, ...topics: string[]) {\n\t\tconst topic_map = this._topics;\n\t\tlet changed = false;\n\t\tfor(const topic of topics) {\n\t\t\tconst refs = topic_map.get(topic);\n\t\t\tif ( ! refs )\n\t\t\t\tcontinue;\n\n\t\t\trefs.delete(referrer);\n\n\t\t\tif ( ! refs.size ) {\n\t\t\t\tchanged = true;\n\t\t\t\ttopic_map.delete(topic);\n\t\t\t\tif ( this._client )\n\t\t\t\t\tthis._client.unsubscribe(topic);\n\t\t\t}\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.emit(':sub-change');\n\t}\n\n\n\tget topics() {\n\t\treturn Array.from(this._topics.keys());\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Loading Tracker\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport type SettingsManager from './settings';\n\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\tload_tracker: LoadEvents;\n\t}\n\tinterface ModuleMap {\n\t\tload_tracker: LoadTracker;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'chat.update-when-loaded': boolean;\n\t}\n}\n\n\ntype PendingLoadData = {\n\tpending: Set<string>;\n\ttimers: Record<string, ReturnType<typeof setTimeout> | null>;\n\tsuccess: boolean\n};\n\n\nexport type LoadEvents = {\n\t':schedule': [type: string, key: string],\n\t[key: `:complete:${string}`]: [keys: string[]]\n};\n\n\n/**\n * LoadTracker is a module used for coordinating loading events between\n * the core of FrankerFaceZ and any present add-ons. This allows for\n * enhanced performance by, for example, only refreshing chat messages\n * once emote data has been loaded by all of a user's add-ons.\n *\n * @example How to use load tracker if you're loading emotes.\n * ```typescript\n * // Inform the load tracker that we're trying to load data.\n * this.load_tracker.schedule('chat-data', 'my-addon--emotes-global');\n *\n * // Load our data.\n * let emotes;\n * try {\n *     emotes = await loadEmotesFromSomewhere();\n * } catch(err) {\n *     // Notify that we failed to load, so it stops waiting.\n *     this.load_tracker.notify('chat-data', 'my-addon--emotes-global', false);\n *     return;\n * }\n *\n * // Load the emote data.\n * this.emotes.addDefaultSet('my-addon', 'my-addon--global-emotes', emotes);\n *\n * // Notify that we succeeded.\n * this.load_tracker.notify('chat-data', 'my-addon--emotes-global', true);\n * ```\n *\n * @noInheritDoc\n */\nexport default class LoadTracker extends Module<'load_tracker', LoadEvents> {\n\n\t/** A map for storing information about pending loadables. */\n\tprivate pending_loads: Map<string, PendingLoadData> = new Map();\n\n\t// Dependencies.\n\tsettings: SettingsManager = null as any;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\n\t\tthis.settings.add('chat.update-when-loaded', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Update existing chat messages when loading new data.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: 'This may cause elements in chat to move, so you may wish to disable this when performing moderation.'\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.on(':schedule', this.schedule);\n\t}\n\n\t/**\n\t * Register our intent to perform a load. This lets the system know that\n\t * a load of {@link type} is pending, and it starts a wait of 15 seconds\n\t * for the load to complete.\n\t *\n\t * You must, after using this, call {@link notify} when your load\n\t * completes or fails. That ensures that the system does not wait\n\t * needlessly after your load process has finished.\n\t *\n\t * @param type The load type.\n\t * @param key A unique key for your load, on this load type. If you are\n\t * loading multiple times (for example, global emotes and channel-specific\n\t * emotes), you should use two distinct keys.\n\t */\n\tschedule(type: string, key: string) {\n\t\tlet data = this.pending_loads.get(type);\n\t\tif ( ! data || ! data.pending || ! data.timers ) {\n\t\t\tdata = {\n\t\t\t\tpending: new Set,\n\t\t\t\ttimers: {},\n\t\t\t\tsuccess: false\n\t\t\t};\n\t\t\tthis.pending_loads.set(type, data);\n\t\t}\n\n\t\tif ( data.pending.has(key) )\n\t\t\treturn;\n\n\t\tdata.pending.add(key);\n\t\tdata.timers[key] = setTimeout(() => this.notify(type, key, false), 15000);\n\t}\n\n\t/**\n\t * Notify the load tracker that your load has completed. If all loads\n\t * for the given type have been completed, and any of the loads were\n\t * a success, then a `:complete:${type}` event will be fired.\n\t * @param type The load type.\n\t * @param key A unique key for your load. The same that you use\n\t * with {@link schedule}.\n\t * @param success Whether or not your load was a success.\n\t */\n\tnotify(type: string, key: string, success = true) {\n\t\tconst data = this.pending_loads.get(type);\n\t\tif ( ! data || ! data.pending || ! data.timers )\n\t\t\treturn;\n\n\t\tif ( data.timers[key] ) {\n\t\t\tclearTimeout(data.timers[key] as any);\n\t\t\tdata.timers[key] = null;\n\t\t}\n\n\t\tif ( ! data.pending.has(key) )\n\t\t\treturn;\n\n\t\tdata.pending.delete(key);\n\t\tif ( success )\n\t\t\tdata.success = true;\n\n\t\tif ( ! data.pending.size ) {\n\t\t\tconst keys = Object.keys(data.timers);\n\n\t\t\tthis.log.debug('complete', type, keys);\n\t\t\tif ( data.success )\n\t\t\t\tthis.emit(`:complete:${type}`, keys);\n\t\t\tthis.pending_loads.delete(type);\n\t\t}\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Player Metadata\n// ============================================================================\n\nimport {createElement, ClickOutside, setChildren} from 'utilities/dom';\nimport {maybe_call} from 'utilities/object';\n\nimport {duration_to_string, durationForURL} from 'utilities/time';\n\nimport Module from 'utilities/module';\nimport Tooltip from 'utilities/tooltip';\n\nexport default class Metadata extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('site.tooltips');\n\n\t\tthis.definitions = {};\n\n\t\tthis.settings.add('metadata.player-stats', {\n\t\t\tdefault: false,\n\t\t\tchanged: () => this.updateMetadata('player-stats')\n\t\t});\n\n\t\tthis.settings.add('metadata.stream-delay-warning', {\n\t\t\tdefault: 0\n\t\t});\n\n\t\tthis.settings.add('metadata.uptime', {\n\t\t\tdefault: 2,\n\t\t\tchanged: () => this.updateMetadata('uptime')\n\t\t});\n\n\t\tthis.definitions.uptime = {\n\t\t\tinherit: true,\n\t\t\tno_arrow: true,\n\n\t\t\trefresh() { return this.settings.get('metadata.uptime') > 0 },\n\n\t\t\tsetup(data) {\n\t\t\t\tlet created = data?.channel?.live_since;\n\t\t\t\tif ( ! created )\n\t\t\t\t\treturn {};\n\n\t\t\t\tif ( !(created instanceof Date) )\n\t\t\t\t\tcreated = new Date(created);\n\n\t\t\t\tconst now = Date.now();\n\n\t\t\t\treturn {\n\t\t\t\t\tcreated,\n\t\t\t\t\tuptime: created ? Math.floor((now - created.getTime()) / 1000) : -1,\n\t\t\t\t\tgetBroadcastID: data.getBroadcastID\n\t\t\t\t}\n\t\t\t},\n\n\t\t\torder: 2,\n\t\t\ticon: 'ffz-i-clock',\n\n\t\t\tlabel(data) {\n\t\t\t\tconst setting = this.settings.get('metadata.uptime');\n\t\t\t\tif ( ! setting || ! data.created )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn duration_to_string(data.uptime, false, false, false, setting !== 2);\n\t\t\t},\n\n\t\t\tsubtitle: () => this.i18n.t('metadata.uptime.subtitle', 'Uptime'),\n\n\t\t\ttooltip(data) {\n\t\t\t\tif ( ! data.created )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn [\n\t\t\t\t\tthis.i18n.t(\n\t\t\t\t\t\t'metadata.uptime.tooltip',\n\t\t\t\t\t\t'Stream Uptime'\n\t\t\t\t\t),\n\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t\t'metadata.uptime.since',\n\t\t\t\t\t\t\t'(since {since,datetime})',\n\t\t\t\t\t\t\t{since: data.created}\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t];\n\t\t\t},\n\n\t\t\tasync popup(data, tip) {\n\t\t\t\tconst [permission, broadcast_id] = await Promise.all([\n\t\t\t\t\tnavigator?.permissions?.query?.({name: 'clipboard-write'}).then(perm => perm?.state).catch(() => null),\n\t\t\t\t\tdata.getBroadcastID()\n\t\t\t\t]);\n\t\t\t\tif ( ! broadcast_id )\n\t\t\t\t\treturn (<div>\n\t\t\t\t\t\t{ this.i18n.t('metadata.uptime-no-id', 'Sorry, we couldn\\'t find an archived video for the current broadcast.') }\n\t\t\t\t\t</div>);\n\n\t\t\t\tconst url = `https://www.twitch.tv/videos/${broadcast_id}${data.uptime > 0 ? `?t=${durationForURL(data.uptime)}` : ''}`,\n\t\t\t\t\tcan_copy = permission === 'granted' || permission === 'prompt';\n\n\t\t\t\tconst copy = can_copy ? e => {\n\t\t\t\t\tnavigator.clipboard.writeText(url);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t} : null;\n\n\t\t\t\ttip.element.classList.add('ffz-balloon--lg');\n\n\t\t\t\treturn (<div>\n\t\t\t\t\t<div class=\"tw-pd-b-1 tw-mg-b-1 tw-border-b tw-semibold\">\n\t\t\t\t\t\t{ this.i18n.t('metadata.uptime.link-to', 'Link to {time}', {\n\t\t\t\t\t\t\ttime: duration_to_string(data.uptime, false, false, false, false)\n\t\t\t\t\t\t}) }\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tw-flex tw-align-items-center\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass=\"tw-border-radius-medium tw-font-size-6 tw-pd-x-1 tw-pd-y-05 ffz-input tw-full-width\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tvalue={url}\n\t\t\t\t\t\t\tonFocus={e => e.target.select()}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{can_copy && <div class=\"tw-relative ffz-il-tooltip__container tw-mg-l-1\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\t\t\t\taria-label={ this.i18n.t('metadata.uptime.copy', 'Copy to Clipboard') }\n\t\t\t\t\t\t\t\tonClick={copy}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-docs\" />\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\">\n\t\t\t\t\t\t\t\t{ this.i18n.t('metadata.uptime.copy', 'Copy to Clipboard') }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>}\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\t\t\t}\n\t\t}\n\n\t\tthis.definitions['player-stats'] = {\n\t\t\tbutton: true,\n\t\t\tinherit: true,\n\t\t\tmodview: true,\n\n\t\t\trefresh() {\n\t\t\t\treturn this.settings.get('metadata.player-stats')\n\t\t\t},\n\n\t\t\tsetup() {\n\t\t\t\tconst Player = this.resolve('site.player'),\n\t\t\t\t\tplayer = Player.current;\n\n\t\t\t\tlet stats;\n\n\t\t\t\tif ( ! player )\n\t\t\t\t\tstats = null;\n\n\t\t\t\telse if ( typeof player.getPlaybackStats === 'function' ) {\n\t\t\t\t\tstats = player.getPlaybackStats();\n\n\t\t\t\t} else if ( typeof player.getVideoInfo === 'function' ) {\n\t\t\t\t\tconst temp = player.getVideoInfo();\n\t\t\t\t\tstats = {\n\t\t\t\t\t\tbackendVersion: maybe_call(player.getVersion, player),\n\t\t\t\t\t\tbufferSize: temp.video_buffer_size,\n\t\t\t\t\t\tdisplayResolution: `${temp.vid_display_width}x${temp.vid_display_height}`,\n\t\t\t\t\t\tfps: temp.current_fps,\n\t\t\t\t\t\thlsLatencyBroadcaster: temp.hls_latency_broadcaster / 1000,\n\t\t\t\t\t\thlsLatencyEncoder: temp.hls_latency_encoder / 1000,\n\t\t\t\t\t\tmemoryUsage: `${temp.totalMemoryNumber} MB`,\n\t\t\t\t\t\trate: maybe_call(player.getPlaybackRate, player) || 1,\n\t\t\t\t\t\tplaybackRate: temp.current_bitrate,\n\t\t\t\t\t\tskippedFrames: temp.dropped_frames,\n\t\t\t\t\t\tvideoResolution: `${temp.vid_width}x${temp.vid_height}`\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst videoHeight = maybe_call(player.getVideoHeight, player) || 0,\n\t\t\t\t\t\tvideoWidth = maybe_call(player.getVideoWidth, player) || 0,\n\t\t\t\t\t\tdisplayHeight = maybe_call(player.getDisplayHeight, player) || 0,\n\t\t\t\t\t\tdisplayWidth = maybe_call(player.getDisplayWidth, player) || 0;\n\n\t\t\t\t\tstats = {\n\t\t\t\t\t\tbackendVersion: maybe_call(player.getVersion, player),\n\t\t\t\t\t\tbufferSize: maybe_call(player.getBufferDuration, player),\n\t\t\t\t\t\tdisplayResolution: `${displayWidth}x${displayHeight}`,\n\t\t\t\t\t\tvideoResolution: `${videoWidth}x${videoHeight}`,\n\t\t\t\t\t\tvideoHeight,\n\t\t\t\t\t\tvideoWidth,\n\t\t\t\t\t\tdisplayHeight,\n\t\t\t\t\t\tdisplayWidth,\n\t\t\t\t\t\trate: maybe_call(player.getPlaybackRate, player),\n\t\t\t\t\t\tfps: Math.floor(maybe_call(player.getVideoFrameRate, player) || 0),\n\t\t\t\t\t\thlsLatencyBroadcaster: maybe_call(player.getLiveLatency, player) || 0,\n\t\t\t\t\t\t//hlsLatencyBroadcaster: player.stats?.broadcasterLatency || player.core?.stats?.broadcasterLatency,\n\t\t\t\t\t\t//hlsLatencyEncoder: player.stats?.transcoderLatency || player.core?.stats?.transcoderLatency,\n\t\t\t\t\t\tplaybackRate: Math.floor((maybe_call(player.getVideoBitRate, player) || 0) / 1000),\n\t\t\t\t\t\tskippedFrames: maybe_call(player.getDroppedFrames, player),\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet tampered = false;\n\t\t\t\ttry {\n\t\t\t\t\tconst url = player.core.state.path;\n\t\t\t\t\tif ( url.includes('/api/channel/hls/') ) {\n\t\t\t\t\t\tconst data = JSON.parse(new URL(url).searchParams.get('token'));\n\t\t\t\t\t\ttampered = data && data.player_type && (data.player_type !== 'site' && data.player_type !== 'popout' && data.player_type !== 'embed') ? data.player_type : false;\n\t\t\t\t\t}\n\t\t\t\t} catch(err) { /* no op */ }\n\n\n\t\t\t\tif ( ! stats || stats.hlsLatencyBroadcaster < -100 )\n\t\t\t\t\treturn {stats};\n\n\t\t\t\treturn {\n\t\t\t\t\tstats,\n\t\t\t\t\tdrift: 0,\n\t\t\t\t\trate: stats.rate == null ? 1 : stats.rate,\n\t\t\t\t\tdelay: stats.hlsLatencyBroadcaster,\n\t\t\t\t\told: stats.hlsLatencyBroadcaster > 180,\n\t\t\t\t\ttampered\n\t\t\t\t}\n\t\t\t},\n\n\t\t\torder: 3,\n\n\t\t\ticon(data) {\n\t\t\t\tif ( data.rate > 1 )\n\t\t\t\t\treturn 'ffz-i-fast-fw';\n\n\t\t\t\treturn 'ffz-i-gauge'\n\t\t\t},\n\n\t\t\tsubtitle: () => this.i18n.t('metadata.player-stats.subtitle', 'Latency'),\n\n\t\t\tlabel(data) {\n\t\t\t\tif ( ! this.settings.get('metadata.player-stats') || ! data.delay )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst delayed = data.drift > 5000 ? '(!) ' : '';\n\n\t\t\t\tif ( data.old )\n\t\t\t\t\treturn `${delayed}${data.delay.toFixed(2)}s old`;\n\t\t\t\telse\n\t\t\t\t\treturn `${delayed}${data.delay.toFixed(2)}s`;\n\t\t\t},\n\n\t\t\tclick() {\n\t\t\t\tconst Player = this.resolve('site.player'),\n\t\t\t\t\tui = Player.playerUI;\n\n\t\t\t\tif ( ! ui )\n\t\t\t\t\treturn;\n\n\t\t\t\tui.setStatsOverlay(ui.statsOverlay === 1 ? 0 : 1);\n\t\t\t},\n\n\t\t\tcolor(data) {\n\t\t\t\tconst setting = this.settings.get('metadata.stream-delay-warning');\n\t\t\t\tif ( setting === 0 || ! data.delay || data.old )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( data.delay > (setting * 2) )\n\t\t\t\t\treturn '#f9b6b6'; //'#ec1313';\n\n\t\t\t\telse if ( data.delay > setting )\n\t\t\t\t\treturn '#fcb896'; //'#fc7835';\n\t\t\t},\n\n\t\t\ttooltip(data) {\n\t\t\t\tconst tampered = data.tampered ? (<div class=\"tw-border-t tw-mg-t-05 tw-pd-t-05\">\n\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.tampered',\n\t\t\t\t\t\t'Your player has an unexpected player type ({type}), which may affect your viewing experience.',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: data.tampered\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t</div>) : null;\n\n\t\t\t\tconst delayed = data.drift > 5000 && (<div class=\"tw-border-b tw-mg-b-05 tw-pd-b-05\">\n\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.delay-warning',\n\t\t\t\t\t\t'Your local clock seems to be off by roughly {count,number} seconds, which could make this inaccurate.',\n\t\t\t\t\t\tMath.round(data.drift / 10) / 100\n\t\t\t\t\t)}\n\t\t\t\t</div>);\n\n\t\t\t\tconst ff = data.rate > 1 && (<div class=\"tw-border-b tw-mg-b-05 tw-pd-b-05\">\n\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.rate-warning',\n\t\t\t\t\t\t'Playing at {rate,number}x speed to reduce delay.',\n\t\t\t\t\t\t{rate: data.rate.toFixed(2)}\n\t\t\t\t\t)}\n\t\t\t\t</div>);\n\n\t\t\t\tif ( ! data.stats || ! data.delay )\n\t\t\t\t\treturn [\n\t\t\t\t\t\tdelayed,\n\t\t\t\t\t\tff,\n\t\t\t\t\t\tthis.i18n.t('metadata.player-stats.latency-tip', 'Stream Latency'),\n\t\t\t\t\t\ttampered\n\t\t\t\t\t];\n\n\t\t\t\tconst stats = data.stats,\n\t\t\t\t\tvideo_info = this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.video-info',\n\t\t\t\t\t\t'Video: {videoResolution}p{fps}\\nPlayback Rate: {playbackRate,number} Kbps\\nDropped Frames:{skippedFrames,number}',\n\t\t\t\t\t\tstats\n\t\t\t\t\t);\n\n\t\t\t\tconst buffer = stats.bufferSize > 0\n\t\t\t\t\t? (<div>{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.buffered',\n\t\t\t\t\t\t'Buffered: {buffered} seconds',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbuffered: stats.bufferSize.toFixed(2)\n\t\t\t\t\t\t}\n\t\t\t\t\t)}</div>)\n\t\t\t\t\t: null;\n\n\t\t\t\tif ( data.old )\n\t\t\t\t\treturn [\n\t\t\t\t\t\tdelayed,\n\t\t\t\t\t\tthis.i18n.t(\n\t\t\t\t\t\t\t'metadata.player-stats.video-tip',\n\t\t\t\t\t\t\t'Video Information'\n\t\t\t\t\t\t),\n\t\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t\t\t'metadata.player-stats.broadcast-ago',\n\t\t\t\t\t\t\t\t'Broadcast {count,number}s Ago',\n\t\t\t\t\t\t\t\tdata.delay\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>,\n\t\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t\t{video_info}\n\t\t\t\t\t\t</div>,\n\t\t\t\t\t\tbuffer,\n\t\t\t\t\t\ttampered\n\t\t\t\t\t];\n\n\t\t\t\treturn [\n\t\t\t\t\tdelayed, ff,\n\t\t\t\t\tthis.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.latency-tip',\n\t\t\t\t\t\t'Stream Latency'\n\t\t\t\t\t),\n\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t{video_info}\n\t\t\t\t\t</div>,\n\t\t\t\t\tbuffer,\n\t\t\t\t\ttampered\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\t}\n\n\tonEnable() {\n\t\tconst md = this.tooltips.types.metadata = target => {\n\t\t\tlet el = target;\n\t\t\tif ( el._ffz_stat )\n\t\t\t\tel = el._ffz_stat;\n\t\t\telse if ( ! el.classList.contains('ffz-stat') ) {\n\t\t\t\tel = target.closest('.ffz-stat');\n\t\t\t\ttarget._ffz_stat = el;\n\t\t\t}\n\n\t\t\tif ( ! el )\n\t\t\t\treturn;\n\n\t\t\tconst key = el.dataset.key,\n\t\t\t\tdef = this.definitions[key];\n\n\t\t\treturn maybe_call(def.tooltip, this, el._ffz_data)\n\t\t};\n\n\t\tmd.onShow = (target, tip) => {\n\t\t\tconst el = target._ffz_stat || target;\n\t\t\tel.tip = tip;\n\t\t};\n\n\t\tmd.onHide = target => {\n\t\t\tconst el = target._ffz_stat || target;\n\t\t\tel.tip = null;\n\t\t\tel.tip_content = null;\n\t\t}\n\n\t\tmd.popperConfig = (target, tip, opts) => {\n\t\t\topts.placement = 'bottom';\n\t\t\topts.modifiers.flip = {behavior: ['bottom','top']};\n\t\t\treturn opts;\n\t\t}\n\t}\n\n\tget keys() {\n\t\treturn Object.keys(this.definitions);\n\t}\n\n\tdefine(key, definition) {\n\t\tthis.definitions[key] = definition;\n\t\tthis.updateMetadata(key);\n\t}\n\n\tupdateMetadata(keys) {\n\t\tconst player = this.resolve('site.player');\n\t\tif ( player )\n\t\t\tfor(const inst of player.Player.instances)\n\t\t\t\tplayer.updateMetadata(inst, keys);\n\t}\n\n\tasync renderPlayer(key, data, container, timers, refresh_fn) {\n\t\tif ( timers[key] )\n\t\t\tclearTimeout(timers[key]);\n\n\t\tlet el = container.querySelector(`.ffz-stat[data-key=\"${key}\"]`);\n\n\t\tconst def = this.definitions[key],\n\t\t\tdestroy = () => {\n\t\t\t\tif ( el ) {\n\t\t\t\t\tif ( el.tooltip )\n\t\t\t\t\t\tel.tooltip.destroy();\n\n\t\t\t\t\tif ( el.popper )\n\t\t\t\t\t\tel.popper.destroy();\n\n\t\t\t\t\tif ( el._ffz_destroy )\n\t\t\t\t\t\tel._ffz_destroy();\n\n\t\t\t\t\tel._ffz_destroy = el.tooltip = el.popper = null;\n\t\t\t\t\tel.remove();\n\t\t\t\t}\n\t\t\t};\n\n\t\tif ( ! def || (data._mt || 'channel') !== (def.type || 'channel') )\n\t\t\treturn destroy();\n\n\t\ttry {\n\t\t\tconst ref_fn = () => refresh_fn(key);\n\t\t\tdata = {\n\t\t\t\t...data,\n\t\t\t\trefresh: ref_fn\n\t\t\t};\n\n\t\t\t// Process the data if a setup method is defined.\n\t\t\tif ( def.setup )\n\t\t\t\tdata = await def.setup.call(this, data);\n\n\t\t\t// Let's get refresh logic out of the way now.\n\t\t\tconst refresh = maybe_call(def.refresh, this, data);\n\t\t\tif ( refresh )\n\t\t\t\ttimers[key] = setTimeout(\n\t\t\t\t\tref_fn,\n\t\t\t\t\ttypeof refresh === 'number' ? refresh : 1000\n\t\t\t\t);\n\n\n\t\t\t// Grab the element again in case it changed, somehow.\n\t\t\tel = container.querySelector(`.ffz-stat[data-key=\"${key}\"]`);\n\n\t\t\tlet stat, old_color, old_icon;\n\n\t\t\tconst label = maybe_call(def.label, this, data);\n\n\t\t\tif ( ! label )\n\t\t\t\treturn destroy();\n\n\t\t\tconst order = maybe_call(def.order, this, data),\n\t\t\t\tcolor = maybe_call(def.color, this, data) || '';\n\n\t\t\tif ( ! el ) {\n\t\t\t\tlet icon = old_icon = maybe_call(def.icon, this, data);\n\t\t\t\tlet button = false;\n\n\t\t\t\tif ( def.button !== false && (def.popup || def.click) ) {\n\t\t\t\t\tbutton = true;\n\n\t\t\t\t\tlet btn, popup;\n\t\t\t\t\tconst border = maybe_call(def.border, this, data),\n\t\t\t\t\t\tinherit = maybe_call(def.inherit, this, data);\n\n\t\t\t\t\tif ( typeof icon === 'string' )\n\t\t\t\t\t\ticon = (<span class=\"tw-mg-r-05\">\n\t\t\t\t\t\t\t<figure class={icon} />\n\t\t\t\t\t\t</span>);\n\n\t\t\t\t\tif ( def.popup && def.click ) {\n\t\t\t\t\t\tel = (<div\n\t\t\t\t\t\t\tclass={`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat ffz-stat--fix-padding ${border ? 'tw-mg-r-1' : 'tw-mg-r-05'}`}\n\t\t\t\t\t\t\tdata-key={key}\n\t\t\t\t\t\t\ttip_content={null}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{btn = (<button\n\t\t\t\t\t\t\t\tclass={`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium ffz-core-button ffz-core-button--padded ffz-core-button--text ${inherit ? 'ffz-c-text-inherit' : 'tw-c-text-base'} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${border ? 'tw-border-l tw-border-t tw-border-b' : 'tw-regular'}${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center tw-pd-x-1\">\n\t\t\t\t\t\t\t\t\t{icon}\n\t\t\t\t\t\t\t\t\t{stat = (<span class=\"ffz-stat-text\" />)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>)}\n\t\t\t\t\t\t\t{popup = (<button\n\t\t\t\t\t\t\t\tclass={`tw-align-items-center tw-align-middle tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${inherit ? 'ffz-c-text-inherit' : 'tw-c-text-base'} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${border ? 'tw-border' : 'tw-regular'}${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center\">\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-down-dir\" />\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>)}\n\t\t\t\t\t\t</div>);\n\n\t\t\t\t\t} else\n\t\t\t\t\t\tbtn = popup = el = (<button\n\t\t\t\t\t\t\tclass={`ffz-stat tw-align-items-center tw-align-middle ${inherit ? 'ffz-c-text-inherit' : ''} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ffz-stat--fix-padding ${border ? 'tw-border tw-mg-r-1' : 'tw-regular tw-mg-r-05'}${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\t\tdata-key={key}\n\t\t\t\t\t\t\ttip_content={null}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center\">\n\t\t\t\t\t\t\t\t{icon}\n\t\t\t\t\t\t\t\t{stat = (<span class=\"ffz-stat-text\" />)}\n\t\t\t\t\t\t\t\t{def.popup && ! def.no_arrow && <span class=\"tw-mg-l-05\">\n\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-down-dir\" />\n\t\t\t\t\t\t\t\t</span>}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>);\n\n\t\t\t\t\tif ( def.click )\n\t\t\t\t\t\tbtn.addEventListener('click', e => {\n\t\t\t\t\t\t\tif ( el._ffz_fading || btn.disabled || btn.classList.contains('disabled') || el.disabled || el.classList.contains('disabled') )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tdef.click.call(this, el._ffz_data, e, () => refresh_fn(key));\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif ( def.popup )\n\t\t\t\t\t\tpopup.addEventListener('click', () => {\n\t\t\t\t\t\t\tif ( popup.disabled || popup.classList.contains('disabled') || el.disabled || el.classList.contains('disabled') )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tif ( el._ffz_popup )\n\t\t\t\t\t\t\t\treturn el._ffz_destroy();\n\n\t\t\t\t\t\t\tconst listeners = [],\n\t\t\t\t\t\t\t\tadd_close_listener = cb => listeners.push(cb);\n\n\t\t\t\t\t\t\tconst destroy = el._ffz_destroy = () => {\n\t\t\t\t\t\t\t\tfor(const cb of listeners) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\t\t\t\tthis.log.capture(err, {\n\t\t\t\t\t\t\t\t\t\t\ttags: {\n\t\t\t\t\t\t\t\t\t\t\t\tmetadata: key\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tthis.log.error('Error when running a callback for pop-up destruction for metadata:', key, err);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( el._ffz_outside )\n\t\t\t\t\t\t\t\t\tel._ffz_outside.destroy();\n\n\t\t\t\t\t\t\t\tif ( el._ffz_popup ) {\n\t\t\t\t\t\t\t\t\tconst fp = el._ffz_popup;\n\t\t\t\t\t\t\t\t\tel._ffz_popup = null;\n\t\t\t\t\t\t\t\t\tfp.destroy();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tel._ffz_destroy = el._ffz_outside = null;\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tconst parent = el.closest('.video-player__overlay') || document.fullscreenElement || document.body.querySelector('#root>div') || document.body,\n\t\t\t\t\t\t\t\ttt = el._ffz_popup = new Tooltip(parent, el, {\n\t\t\t\t\t\t\t\t\tlogger: this.log,\n\t\t\t\t\t\t\t\t\ti18n: this.i18n,\n\t\t\t\t\t\t\t\t\tmanual: true,\n\t\t\t\t\t\t\t\t\tlive: false,\n\t\t\t\t\t\t\t\t\thtml: true,\n\n\t\t\t\t\t\t\t\t\ttooltipClass: 'ffz-metadata-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base',\n\t\t\t\t\t\t\t\t\t// Hide the arrow for now, until we re-do our CSS to make it render correctly.\n\t\t\t\t\t\t\t\t\tarrowClass: 'ffz-balloon__tail tw-overflow-hidden tw-absolute',\n\t\t\t\t\t\t\t\t\tarrowInner: 'ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute',\n\t\t\t\t\t\t\t\t\tinnerClass: 'tw-pd-1',\n\n\t\t\t\t\t\t\t\t\tpopper: {\n\t\t\t\t\t\t\t\t\t\tplacement: 'top-end',\n\t\t\t\t\t\t\t\t\t\tmodifiers: {\n\t\t\t\t\t\t\t\t\t\t\tpreventOverflow: {\n\t\t\t\t\t\t\t\t\t\t\t\tboundariesElement: parent\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tflip: {\n\t\t\t\t\t\t\t\t\t\t\t\tbehavior: ['top', 'bottom', 'left', 'right']\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcontent: (t, tip) => def.popup.call(this, el._ffz_data, tip, () => refresh_fn(key), add_close_listener),\n\t\t\t\t\t\t\t\t\tonShow: (t, tip) =>\n\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\tel._ffz_outside = new ClickOutside(tip.outer, destroy);\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tonHide: destroy\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\ttt._enter(el);\n\t\t\t\t\t\t});\n\n\t\t\t\t} else {\n\t\t\t\t\tif ( typeof icon === 'string' )\n\t\t\t\t\t\ticon = (<span class=\"tw-stat__icon\"><figure class={icon} /></span>);\n\n\t\t\t\t\tel = (<div\n\t\t\t\t\t\tclass={`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat tw-mg-r-1${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\tdata-key={key}\n\t\t\t\t\t\ttip_content={null}\n\t\t\t\t\t>\n\t\t\t\t\t\t{icon}\n\t\t\t\t\t\t{stat = <span class={`${icon ? 'tw-mg-l-05 ' : ''}ffz-stat-text tw-stat__value`} />}\n\t\t\t\t\t</div>);\n\n\t\t\t\t\tif ( def.click )\n\t\t\t\t\t\tel.addEventListener('click', e => {\n\t\t\t\t\t\t\tif ( el._ffz_fading || el.disabled || el.classList.contains('disabled') )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tdef.click.call(this, el._ffz_data, e, () => refresh_fn(key));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tel._ffz_order = order;\n\n\t\t\t\tif ( order != null )\n\t\t\t\t\tel.style.order = order;\n\n\t\t\t\tlet subcontainer = container;\n\n\t\t\t\t/*if ( button )\n\t\t\t\t\tsubcontainer = container.querySelector('.tw-flex:last-child') || container;\n\t\t\t\telse\n\t\t\t\t\tsubcontainer = container.querySelector('.tw-flex:first-child') || container;*/\n\n\t\t\t\tsubcontainer.appendChild(el);\n\n\t\t\t\t/*if ( def.tooltip ) {\n\t\t\t\t\tconst parent = document.body.querySelector('#root>div') || document.body;\n\t\t\t\t\tel.tooltip = new Tooltip(parent, el, {\n\t\t\t\t\t\tlogger: this.log,\n\t\t\t\t\t\tlive: false,\n\t\t\t\t\t\thtml: true,\n\t\t\t\t\t\tcontent: () => maybe_call(def.tooltip, this, el._ffz_data),\n\t\t\t\t\t\tonShow: (t, tip) => el.tip = tip,\n\t\t\t\t\t\tonHide: () => {\n\t\t\t\t\t\t\tel.tip = null;\n\t\t\t\t\t\t\tel.tip_content = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpopper: {\n\t\t\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\t\t\tmodifiers: {\n\t\t\t\t\t\t\t\tflip: {\n\t\t\t\t\t\t\t\t\tbehavior: ['bottom', 'top']\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpreventOverflow: {\n\t\t\t\t\t\t\t\t\tboundariesElement: parent\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}*/\n\n\t\t\t} else {\n\t\t\t\tstat = el.querySelector('.ffz-stat-text');\n\t\t\t\tif ( ! stat )\n\t\t\t\t\treturn destroy();\n\n\t\t\t\told_icon = el.dataset.icon || '';\n\t\t\t\told_color = el.dataset.color || '';\n\n\t\t\t\tif ( el._ffz_order !== order )\n\t\t\t\t\tel.style.order = el._ffz_order = order;\n\n\t\t\t\tif ( el.tip ) {\n\t\t\t\t\tconst tooltip = maybe_call(def.tooltip, this, data);\n\t\t\t\t\tif ( el.tip_content !== tooltip ) {\n\t\t\t\t\t\tel.tip_content = tooltip;\n\t\t\t\t\t\tsetChildren(el.tip.element, tooltip);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( typeof def.icon === 'function' ) {\n\t\t\t\tconst icon = maybe_call(def.icon, this, data);\n\t\t\t\tif ( typeof icon === 'string' && icon !== old_icon ) {\n\t\t\t\t\tel.dataset.icon = icon;\n\t\t\t\t\tconst figure = el.querySelector('figure');\n\t\t\t\t\tif ( figure )\n\t\t\t\t\t\tfigure.className = icon;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( old_color !== color ) {\n\t\t\t\tel.dataset.color = color;\n\t\t\t\tel.style.setProperty('color', color, 'important');\n\t\t\t}\n\n\t\t\tel._ffz_data = data;\n\t\t\tstat.innerHTML = label;\n\n\t\t\tif ( def.disabled !== undefined )\n\t\t\t\tel.disabled = maybe_call(def.disabled, this, data);\n\n\t\t} catch(err) {\n\t\t\tthis.log.capture(err, {\n\t\t\t\ttags: {\n\t\t\t\t\tmetadata: key\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.log.error(`Error rendering metadata for ${key}`, err);\n\t\t\treturn destroy();\n\t\t}\n\t}\n}","'use strict';\n\n// ============================================================================\n// Twitch Player\n// ============================================================================\n\nimport PlayerBase from 'src/sites/shared/player';\n\nimport Metadata from './metadata';\n\nexport default class Player extends PlayerBase {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('metadata', Metadata);\n\n\t\tthis.Player = this.fine.define(\n\t\t\t'highwind-player',\n\t\t\tn => n.setPlayerActive && n.props?.playerEvents && n.props?.mediaPlayerInstance\n\t\t);\n\n\t\tthis.PlayerSource = this.fine.define(\n\t\t\t'player-source',\n\t\t\tn => n.setSrc && n.setInitialPlaybackSettings\n\t\t);\n\t}\n\n\twantsMetadata() {\n\t\treturn this.settings.get('player.embed-metadata');\n\t}\n\n\tgetData() {\n\t\treturn this.parent.data;\n\t}\n\n\tasync getBroadcastID(inst, channel_id) {\n\t\tthis.twitch_data = await this.parent.awaitTwitchData();\n\t\treturn super.getBroadcastID(inst, channel_id);\n\t}\n}","'use strict';\n\n// ============================================================================\n// CSS Tweaks\n// Tweak some CSS\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport {ManagedStyle} from 'utilities/dom';\nimport {has, once} from 'utilities/object';\n\ndeclare module \"utilities/types\" {\n\tinterface ModuleMap {\n\t\t'site.css_tweaks': CSSTweaks;\n\t}\n}\n\n/**\n * CSS Tweaks is a somewhat generic module for handling FrankerFaceZ's CSS\n * injection. It can load and unload specific blocks of CSS, as well as\n * automatically generate rules to hide specific elements based on their\n * selectors.\n *\n * Generally, this module is loaded by the current site module and is\n * available as `site.css_tweaks`.\n *\n * @noInheritDoc\n */\nexport default class CSSTweaks<TPath extends string = 'site.css_tweaks'> extends Module<TPath> {\n\n\t/** Stores CSS rules used with the {@link toggleHide} method. */\n\trules: Record<string, string> = {};\n\n\t/** Stores CSS chunks loaded by the provided loader, and used with the {@link toggle} method. */\n\tchunks: Record<string, string> = {};\n\n\tprivate _toggle_state: Record<string, boolean> = {};\n\tprivate _chunk_loader?: __WebpackModuleApi.RequireContext | null;\n\tprivate _chunks_loaded: boolean = false;\n\tprivate _style?: ManagedStyle;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis._loadChunks = once(this._loadChunks);\n\t}\n\n\t/** Whether or not chunks have been loaded using the {@link loader}. */\n\tget chunks_loaded() {\n\t\treturn this._chunks_loaded;\n\t}\n\n\t/** An optional require context that can be used for loading arbitrary, named CSS chunks. */\n\tget loader() {\n\t\treturn this._chunk_loader;\n\t}\n\n\tset loader(value: __WebpackModuleApi.RequireContext | null | undefined) {\n\t\tif ( value === this._chunk_loader )\n\t\t\treturn;\n\n\t\tthis._chunks_loaded = false;\n\t\tthis._chunk_loader = value;\n\t}\n\n\t/** The {@link ManagedStyle} instance used internally by this {@link CSSTweaks} instance. */\n\tget style() {\n\t\tif ( ! this._style )\n\t\t\tthis._style = new ManagedStyle;\n\n\t\treturn this._style;\n\t}\n\n\t/**\n\t * If {@link force} is not set, this toggles a specific element hiding rule,\n\t * enabling it if it was not previously enabled and vice versa. If force is\n\t * provided, it will either enable or disable the specific element hiding\n\t * rule based on the boolean value of {@link force}.\n\t *\n\t * @param key The key for the element hiding rule in {@link rules}.\n\t * @param force Optional. The desired state.\n\t * @throws If the provided {@link key} is not within {@link rules}.\n\t */\n\ttoggleHide(key: string, force?: boolean) {\n\t\tconst k = `hide--${key}`;\n\t\tforce = force != null ? !! force : ! this._toggle_state[k];\n\t\tif ( this._toggle_state[k] === force )\n\t\t\treturn;\n\n\t\tthis._toggle_state[k] = force;\n\n\t\tif ( ! force ) {\n\t\t\tif ( this._style )\n\t\t\t\tthis._style.delete(k);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! has(this.rules, key) )\n\t\t\tthrow new Error(`unknown rule \"${key}\" for toggleHide`);\n\n\t\tthis.style.set(k, `${this.rules[key]}{display:none !important}`);\n\t}\n\n\t/**\n\t * If {@link force} is not set, this toggles a specific CSS chunk,\n\t * enabling it if it was not previously enabled and vice versa. If force is\n\t * provide, it will either enable or disable the specific CSS chunk based\n\t * on the boolean value of {@link force}.\n\t *\n\t * @param key The key for the CSS block in {@link chunks}.\n\t * @param force Optional. The desired state.\n\t */\n\ttoggle(key: string, force?: boolean) {\n\t\tforce = force != null ? !! force : ! this._toggle_state[key];\n\n\t\tif ( this._toggle_state[key] == force )\n\t\t\treturn;\n\n\t\tthis._toggle_state[key] = force;\n\t\tthis._apply(key);\n\t}\n\n\t/**\n\t * Actually perform the update for {@link toggle}. This method may\n\t * have to wait and then call itself again if the chunks have not yet\n\t * been loaded.\n\t *\n\t * @param key The key for the CSS block to toggle.\n\t */\n\tprivate _apply(key: string): void {\n\t\tconst val = this._toggle_state[key];\n\t\tif ( ! val ) {\n\t\t\tif ( this._style )\n\t\t\t\tthis._style.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.style.has(key) )\n\t\t\treturn;\n\n\t\telse if ( ! this._chunks_loaded ) {\n\t\t\tthis._loadChunks().then(() => this._apply(key));\n\n\t\t} else if ( ! has(this.chunks, key) ) {\n\t\t\tthis.log.warn(`Unknown chunk name \"${key}\" for toggle()`);\n\n\t\t} else\n\t\t\tthis.style.set(key, this.chunks[key]);\n\t}\n\n\t/**\n\t * Include an arbitrary string of CSS using this CSSTweak instance's\n\t * {@link ManagedStyle} instance. This will override any existing\n\t * CSS block using the same key.\n\t *\n\t * @see {@link ManagedStyle.set}\n\t * @param key The key for the CSS block.\n\t * @param value The text content of the CSS block.\n\t */\n\tset(key: string, value: string) { return this.style.set(key, value); }\n\n\t/**\n\t * Delete a CSS block from this CSSTweak instance's {@link ManagedStyle}\n\t * instance. This can be used to delete managed blocks including\n\t * those set by {@link toggle}, {@link toggleHide}, and\n\t * {@link setVariable} to please use caution.\n\t *\n\t * @see {@link ManagedStyle.delete}\n\t * @param key The key to be deleted.\n\t */\n\tdelete(key: string) { this._style && this._style.delete(key) }\n\n\t/**\n\t * Set a CSS variable. The variable's name will be prefixed with `ffz-`\n\t * so, for example, if {@link key} is `\"link-color\"` then the resulting\n\t * CSS variable will be `--ffz-link-color` and can be used with\n\t * `var(--ffz-link-color)`.\n\t *\n\t * @param key The key for the variable.\n\t * @param value The value of the variable.\n\t * @param scope The scope this variable should be set on. Defaults\n\t * to `\"body\"`.\n\t */\n\tsetVariable(key: string, value: string, scope: string = 'body') {\n\t\tthis.style.set(`var--${key}`, `${scope}{--ffz-${key}:${value};}`);\n\t}\n\n\t/**\n\t * Delete a CSS variable.\n\t * @param key The key for the variable\n\t */\n\tdeleteVariable(key: string) {\n\t\tif ( this._style )\n\t\t\tthis._style.delete(`var--${key}`);\n\t}\n\n\t/**\n\t * This method is used internally to load CSS chunks from the\n\t * provided {@link loader} instance.\n\t */\n\tprivate async _loadChunks() {\n\t\tif ( this._chunks_loaded )\n\t\t\treturn;\n\n\t\tif ( ! this._chunk_loader ) {\n\t\t\tthis._chunks_loaded = true;\n\t\t\treturn;\n\t\t}\n\n\t\tconst promises = [];\n\t\tfor(const key of this._chunk_loader.keys()) {\n\t\t\tconst k = key.slice(2, key.length - (key.endsWith('.scss') ? 5 : 4));\n\t\t\tpromises.push(this._chunk_loader(key).then((data: any) => {\n\t\t\t\tif ( typeof data?.default === 'string' )\n\t\t\t\t\tthis.chunks[k] = data.default;\n\t\t\t}));\n\t\t}\n\n\t\tawait Promise.all(promises);\n\t\tthis._chunks_loaded = true;\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Tooltip Handling\n// ============================================================================\n\nimport {createElement, sanitize} from 'utilities/dom';\nimport {has, maybe_call} from 'utilities/object';\n\nimport Tooltip, { TooltipInstance } from 'utilities/tooltip';\nimport Module, { GenericModule, buildAddonProxy } from 'utilities/module';\nimport awaitMD, {getMD} from 'utilities/markdown';\nimport { DEBUG } from 'src/utilities/constants';\nimport type { AddonInfo, DomFragment, OptionallyCallable } from '../utilities/types';\nimport type TranslationManager from '../i18n';\n\ndeclare global {\n\tinterface HTMLElement {\n\t\t_ffz_child: Element | null;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\ttooltips: TooltipEvents;\n\t}\n\tinterface ModuleMap {\n\t\ttooltips: TooltipProvider;\n\t}\n}\n\n\nexport type TooltipEvents = {\n\t/**\n\t * When this event is emitted, the tooltip provider will attempt to remove\n\t * old, invalid tool-tips.\n\t */\n\t':cleanup': [],\n\n\t':hover': [target: HTMLElement, tip: TooltipInstance, event: MouseEvent];\n\t':leave': [target: HTMLElement, tip: TooltipInstance, event: MouseEvent];\n};\n\ntype TooltipOptional<TReturn> = OptionallyCallable<[target: HTMLElement, tip: TooltipInstance], TReturn>;\n\ntype TooltipExtra = {\n\t__source?: string;\n\n\tpopperConfig(target: HTMLElement, tip: TooltipInstance, options: any): any;\n\n\tdelayShow: TooltipOptional<number>;\n\tdelayHide: TooltipOptional<number>;\n\n\tinteractive: TooltipOptional<boolean>;\n\thover_events: TooltipOptional<boolean>;\n\n\tonShow(target: HTMLElement, tip: TooltipInstance): void;\n\tonHide(target: HTMLElement, tip: TooltipInstance): void;\n\n};\n\nexport type TooltipDefinition = Partial<TooltipExtra> &\n\t((target: HTMLElement, tip: TooltipInstance) => DomFragment);\n\n\nexport default class TooltipProvider extends Module<'tooltips', TooltipEvents> {\n\n\t// Storage\n\ttypes: Record<string, TooltipDefinition | undefined>;\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\n\t// State\n\tcontainer?: HTMLElement | null;\n\ttip_element?: HTMLElement | null;\n\ttips?: Tooltip | null;\n\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.types = {};\n\n\t\tthis.inject('i18n');\n\n\t\tthis.should_enable = true;\n\n\t\tthis.types.json = target => {\n\t\t\tconst title = target.dataset.title;\n\t\t\treturn [\n\t\t\t\ttitle && createElement('strong', null, title),\n\t\t\t\tcreateElement('code', {\n\t\t\t\t\tclassName: `block${title ? ' pd-t-05 border-t mg-t-05' : ''}`,\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontFamily: 'monospace',\n\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t}\n\t\t\t\t}, target.dataset.data)\n\t\t\t]\n\t\t};\n\n\t\tthis.types.child = target => {\n\t\t\tconst child = target.querySelector(':scope > .ffz-tooltip-child');\n\t\t\tif ( ! child )\n\t\t\t\treturn null;\n\n\t\t\ttarget._ffz_child = child;\n\t\t\tchild.remove();\n\t\t\tchild.classList.remove('ffz-tooltip-child');\n\t\t\treturn child;\n\t\t};\n\n\t\tthis.types.child.onHide = target => {\n\t\t\tconst child = target._ffz_child;\n\t\t\tif ( child ) {\n\t\t\t\ttarget._ffz_child = null;\n\t\t\t\tchild.remove();\n\n\t\t\t\tif ( ! target.querySelector(':scope > .ffz-tooltip-child') ) {\n\t\t\t\t\tchild.classList.add('ffz-tooltip-child');\n\t\t\t\t\ttarget.appendChild(child);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.types.markdown = (target, tip) => {\n\t\t\ttip.add_class = 'ffz-tooltip--markdown';\n\n\t\t\tconst md = getMD();\n\t\t\tif ( ! md )\n\t\t\t\treturn awaitMD().then(md => md.render(target.dataset.title));\n\n\t\t\treturn md.render(target.dataset.title);\n\t\t};\n\n\t\tthis.types.text = target => sanitize(target.dataset.title ?? '');\n\t\tthis.types.html = target => target.dataset.title;\n\n\t\tthis.onFSChange = this.onFSChange.bind(this);\n\t}\n\n\n\tgetAddonProxy(addon_id: string, addon: AddonInfo, module: GenericModule) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides: Record<string, any> = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\t\tlet warnings: Record<string, boolean | string> | undefined;\n\n\t\toverrides.define = (key: string, handler: TooltipDefinition) => {\n\t\t\tif ( handler )\n\t\t\t\thandler.__source = addon_id;\n\n\t\t\treturn this.define(key, handler);\n\t\t};\n\n\t\tif ( is_dev ) {\n\t\t\toverrides.cleanup = () => {\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Instead of calling tooltips.cleanup(), you can emit the event \"tooltips:cleanup\"');\n\t\t\t\treturn this.cleanup();\n\t\t\t};\n\n\t\t\twarnings = {\n\t\t\t\ttypes: 'Please use tooltips.define()'\n\t\t\t};\n\t\t}\n\n\t\treturn buildAddonProxy(\n\t\t\tmodule,\n\t\t\tthis,\n\t\t\t'tooltips',\n\t\t\toverrides,\n\t\t\twarnings\n\t\t);\n\t}\n\n\n\tonEnable() {\n\t\tconst container = this.getRoot();\n\n\t\twindow.addEventListener('fullscreenchange', this.onFSChange);\n\n\t\t//\tis_minimal = false; //container && container.classList.contains('twilight-minimal-root');\n\n\t\tthis.container = container;\n\t\tthis.tip_element = container;\n\t\tthis.tips = this._createInstance(container);\n\n\t\tthis.on(':cleanup', this.cleanup);\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tlet removed = 0;\n\t\t\tfor(const [key, handler] of Object.entries(this.types)) {\n\t\t\t\tif ( handler?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.types[key] = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( removed ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed} entries when unloading addon:`, addon_id);\n\t\t\t\tthis.cleanup();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tdefine(key: string, handler: TooltipDefinition) {\n\t\t// TODO: Determine if any tooltips are already open.\n\t\t// If so, we need to close them / maybe re-open them?\n\t\tthis.types[key] = handler;\n\t}\n\n\n\tgetRoot() { // eslint-disable-line class-methods-use-this\n\t\treturn document.querySelector<HTMLElement>('.sunlight-root') ||\n\t\t\t//document.querySelector('#root>div') ||\n\t\t\tdocument.querySelector('#root') ||\n\t\t\tdocument.querySelector('.clips-root') ||\n\t\t\tdocument.body;\n\t}\n\n\t_createInstance(container: HTMLElement, klass = 'ffz-tooltip', default_type = 'text', tip_container?: HTMLElement) {\n\t\treturn new Tooltip(container, klass, {\n\t\t\thtml: true,\n\t\t\ti18n: this.i18n,\n\t\t\tlive: true,\n\t\t\tcheck_modifiers: true,\n\t\t\tcontainer: tip_container || container,\n\n\t\t\tdelayHide: this.checkDelayHide.bind(this, default_type),\n\t\t\tdelayShow: this.checkDelayShow.bind(this, default_type),\n\t\t\tcontent: this.process.bind(this, default_type),\n\t\t\tinteractive: this.checkInteractive.bind(this, default_type),\n\t\t\thover_events: this.checkHoverEvents.bind(this, default_type),\n\n\t\t\tonShow: this.delegateOnShow.bind(this, default_type),\n\t\t\tonHide: this.delegateOnHide.bind(this, default_type),\n\n\t\t\tpopperConfig: this.delegatePopperConfig.bind(this, default_type),\n\t\t\tpopper: {\n\t\t\t\tplacement: 'top',\n\t\t\t\tmodifiers: {\n\t\t\t\t\tflip: {}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonHover: (target, tip, event) => {\n\t\t\t\tthis.emit(':hover', target, tip, event)\n\t\t\t},\n\n\t\t\tonLeave: (target, tip, event) => {\n\t\t\t\tthis.emit(':leave', target, tip, event);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tonFSChange() {\n\t\tif ( ! this.container )\n\t\t\tthis.container = this.getRoot();\n\n\t\tlet tip_element = this.container;\n\t\tif ( document.fullscreenElement instanceof HTMLElement )\n\t\t\ttip_element = document.fullscreenElement;\n\n\t\tif ( tip_element !== this.tip_element ) {\n\t\t\tthis.tip_element = tip_element;\n\t\t\tif ( this.tips ) {\n\t\t\t\tthis.tips.destroy();\n\t\t\t\tthis.tips = this._createInstance(tip_element);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tcleanup() {\n\t\tif ( this.tips )\n\t\t\tthis.tips.cleanup();\n\t}\n\n\n\tdelegatePopperConfig(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance,\n\t\toptions: any\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( target.dataset.tooltipSide )\n\t\t\toptions.placement = target.dataset.tooltipSide;\n\n\t\tif ( handler && handler.popperConfig )\n\t\t\treturn handler.popperConfig(target, tip, options);\n\n\t\treturn options;\n\t}\n\n\tdelegateOnShow(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler && handler.onShow )\n\t\t\thandler.onShow(target, tip);\n\t}\n\n\tdelegateOnHide(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler && handler.onHide )\n\t\t\thandler.onHide(target, tip);\n\t}\n\n\tcheckDelayShow(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.delayShow != null )\n\t\t\treturn maybe_call(handler.delayShow, null, target, tip);\n\n\t\treturn 0;\n\t}\n\n\tcheckDelayHide(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.delayHide != null )\n\t\t\treturn maybe_call(handler.delayHide, null, target, tip);\n\n\t\treturn 0;\n\t}\n\n\tcheckInteractive(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.interactive != null )\n\t\t\treturn maybe_call(handler.interactive, null, target, tip);\n\n\t\treturn false;\n\t}\n\n\tcheckHoverEvents(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.hover_events != null )\n\t\t\treturn maybe_call(handler.hover_events, null, target, tip);\n\n\t\treturn false;\n\t}\n\n\tprocess(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type || 'text',\n\t\t\talign = target.dataset.tooltipAlign,\n\t\t\thandler = this.types[type];\n\n\t\tif ( align )\n\t\t\ttip.align = align;\n\n\t\tif ( ! handler )\n\t\t\treturn [\n\t\t\t\tcreateElement('strong', null, 'Unhandled Tooltip Type'),\n\t\t\t\tcreateElement('code', {\n\t\t\t\t\tclassName: 'tw-block pd-t-05 border-t mg-t-05',\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontFamily: 'monospace',\n\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t}\n\t\t\t\t}, JSON.stringify(target.dataset, null, 4))\n\t\t\t];\n\n\t\treturn handler(target, tip);\n\t}\n}\n","export default __webpack_public_path__ + \"player-main.css\";","'use strict';\n\n// ============================================================================\n// Standalone Player\n// ============================================================================\n\nimport {createElement} from 'utilities/dom';\n\nimport BaseSite from '../base';\n\nimport Fine from 'utilities/compat/fine';\nimport Player from './player';\nimport CSSTweaks from 'utilities/css-tweaks';\nimport Tooltips from 'src/modules/tooltips';\n\nimport MAIN_URL from './styles/player-main.scss';\n\n// ============================================================================\n// The Site\n// ============================================================================\n\nexport default class PlayerSite extends BaseSite {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject(Fine);\n\t\tthis.inject(Player);\n\t\tthis.inject('tooltips', Tooltips);\n\t\tthis.inject('css_tweaks', CSSTweaks);\n\n\t\tthis.css_tweaks.loader = require.context(\n\t\t\t'./css_tweaks?css_tweaks', false, /\\.s?css$/, 'lazy-once'\n\t\t);\n\n\t\tthis.css_tweaks.rules = {\n\t\t\t'unfollow-button': '.follow-btn--following',\n\t\t\t'player-cast': '.video-player button:has(.tw-chromecast-button__icon)',\n\t\t\t'player-gain-volume': '.video-player__overlay[data-compressed=\"true\"] .volume-slider__slider-container:not(.ffz--player-gain)',\n\t\t\t'player-ext': '.video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout',\n\t\t\t'player-ext-hover': '.video-player__overlay[data-controls=\"false\"] .extension-taskbar,.video-player__overlay[data-controls=\"false\"] .extension-container,.video-player__overlay[data-controls=\"false\"] .extensions-dock__layout,.video-player__overlay[data-controls=\"false\"] .extensions-notifications,.video-player__overlay[data-controls=\"false\"] .extensions-video-overlay-size-container'\n\t\t};\n\n\t\tthis.DataSource = this.fine.define(\n\t\t\t'data-source',\n\t\t\tn => n.consentMetadata && n.onPlaying && n.props && n.props.data\n\t\t);\n\n\t\tthis.PlayerMenu = this.fine.define(\n\t\t\t'player-menu',\n\t\t\tn => n.closeSettingsMenu && n.state && n.state.activeMenu && n.getMaxMenuHeight\n\t\t);\n\n\t\tdocument.head.appendChild(createElement('link', {\n\t\t\thref: MAIN_URL,\n\t\t\trel: 'stylesheet',\n\t\t\ttype: 'text/css',\n\t\t\tcrossOrigin: 'anonymous'\n\t\t}));\n\t}\n\n\tonEnable() {\n\t\tthis.settings = this.resolve('settings');\n\n\t\tthis.settings.getChanges('channel.hide-unfollow', val =>\n\t\t\tthis.css_tweaks.toggleHide('unfollow-button', val));\n\n\t\tthis.DataSource.on('mount', this.updateData, this);\n\t\tthis.DataSource.on('update', this.updateData, this);\n\t\tthis.DataSource.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateData(inst);\n\t\t});\n\n\t\tthis.PlayerMenu.on('mount', this.updateMenu, this);\n\t\tthis.PlayerMenu.on('update', this.updateMenu, this);\n\t\tthis.PlayerMenu.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateMenu(inst);\n\t\t});\n\n\t\tthis.on('i18n:update', () => {\n\t\t\tfor(const inst of this.PlayerMenu.instances)\n\t\t\t\tthis.updateMenu(inst);\n\t\t});\n\n\t\t// Window Size\n\t\tconst update_size = () => this.settings.updateContext({\n\t\t\tsize: {\n\t\t\t\theight: window.innerHeight,\n\t\t\t\twidth: window.innerWidth\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('resize', update_size);\n\t\tupdate_size();\n\n\t\tthis.settings.updateContext({\n\t\t\troute: {\n\t\t\t\tname: 'popout-player',\n\t\t\t\tparts: ['/'],\n\t\t\t\tdomain: 'player.twitch.tv'\n\t\t\t},\n\t\t\troute_data: ['/']\n\t\t});\n\t}\n\n\tawaitTwitchData() {\n\t\tif ( this.twitch_data )\n\t\t\treturn Promise.resolve(this.twitch_data);\n\n\t\tif ( this._loading_td )\n\t\t\treturn new Promise((s,f) => {\n\t\t\t\tthis._loading_td.push([s,f]);\n\t\t\t});\n\n\t\tconst loads = this._loading_td = [];\n\t\treturn new Promise((s,f) => {\n\t\t\tloads.push([s,f]);\n\n\t\t\tPromise.all([\n\t\t\t\timport(/* webpackChunkName: 'tdata' */ 'utilities/compat/apollo'),\n\t\t\t\timport(/* webpackChunkName: 'tdata' */ 'utilities/twitch-data')\n\t\t\t]).then(modules => {\n\t\t\t\tconst Apollo = modules[0].default,\n\t\t\t\t\tTwitchData = modules[1].default;\n\n\t\t\t\tthis.inject('apollo', Apollo);\n\t\t\t\tthis.inject('twitch_data', TwitchData);\n\n\t\t\t\tthis.twitch_data.enable().then(() => {\n\t\t\t\t\tthis._loading_td = null;\n\t\t\t\t\tfor(const pair of loads)\n\t\t\t\t\t\tpair[0](this.twitch_data);\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tthis._loading_td = null;\n\t\t\t\t\tfor(const pair of loads)\n\t\t\t\t\t\tpair[1](err);\n\t\t\t\t});\n\t\t\t})\n\t\t})\n\t}\n\n\tget data() {\n\t\treturn this.DataSource.first;\n\t}\n\n\tupdateData(inst) {\n\t\tconst user = inst?.props?.data?.user,\n\n\t\t\tbcast = user?.broadcastSettings,\n\t\t\tgame = user?.stream?.game;\n\n\t\tthis.settings.updateContext({\n\t\t\ttitle: bcast?.title,\n\t\t\tchannelID: user?.id,\n\t\t\tcategory: game?.name,\n\t\t\tcategoryID: game?.id\n\t\t});\n\t}\n\n\tupdateMenu(inst) {\n\t\tconst outer = this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector('div[data-a-target=\"player-settings-menu\"]');\n\n\t\tif ( ! container )\n\t\t\treturn;\n\n\t\tconst should_render = inst.state.activeMenu === 'settings-menu__main';\n\n\t\tlet lbl, btn, ver, cont = container.querySelector('.ffz--cc-button');\n\t\tif ( ! cont ) {\n\t\t\tif ( ! should_render )\n\t\t\t\treturn;\n\n\t\t\tconst handler = () => {\n\t\t\t\tconst win = window.open(\n\t\t\t\t\t'https://twitch.tv/popout/frankerfacez/chat?ffz-settings=player',\n\t\t\t\t\t'_blank',\n\t\t\t\t\t'resizable=yes,scrollbars=yes,width=850,height=600'\n\t\t\t\t);\n\n\t\t\t\tif ( win )\n\t\t\t\t\twin.focus();\n\t\t\t}\n\n\t\t\tcont = (<div class=\"tw-mg-t-1 tw-border-t tw-pd-t-1 tw-full-width tw-relative ffz--cc-button\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive\"\n\t\t\t\t\tonclick={handler}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-pd-05 tw-relative\">\n\t\t\t\t\t\t{lbl = <div class=\"ffz--label tw-flex-grow-1 tw-ellipsis\" />}\n\t\t\t\t\t\t{ver = <div class=\"ffz--version tw-align-items-center tw-mg-l-05 tw-c-text-alt-2 tw-white-space-nowrap\"></div>}\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t</div>);\n\n\t\t\tcontainer.appendChild(cont);\n\n\t\t} else if ( ! should_render ) {\n\t\t\tcont.remove();\n\t\t\treturn;\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\tlbl = cont.querySelector('.ffz--label');\n\t\t\tver = cont.querySelector('.ffz--version');\n\t\t}\n\n\t\tlbl.textContent = btn.title = this.i18n.t('site.menu_button', 'FrankerFaceZ Control Center');\n\t\tver.textContent = this.resolve('core').constructor.version_info.toString();\n\t}\n}\n\n\nPlayerSite.CHAT_ROUTES = [];\n","'use strict';\n\nimport dayjs from 'dayjs';\n//import RavenLogger from './raven';\n\nimport Logger from 'utilities/logging';\nimport Module from 'utilities/module';\n\nimport {DEBUG} from 'utilities/constants';\nimport {timeout} from 'utilities/object';\n\nimport SettingsManager from './settings/index';\nimport AddonManager from './addons';\nimport ExperimentManager from './experiments';\nimport TranslationManager from './i18n';\nimport StagingSelector from './staging';\nimport PubSubClient from './pubsub';\nimport LoadTracker from './load_tracker';\nimport Site from './sites/player';\n\nclass FrankerFaceZ extends Module {\n\tconstructor() {\n\t\tsuper();\n\t\tconst start_time = performance.now();\n\n\t\tFrankerFaceZ.instance = this;\n\n\t\tthis.host = 'twitch';\n\t\tthis.flavor = 'player';\n\t\tthis.name = 'ffz_player';\n\t\tthis.__state = 0;\n\t\tthis.__modules.core = this;\n\n\t\t// ========================================================================\n\t\t// Error Reporting and Logging\n\t\t// ========================================================================\n\n\t\t//this.inject('raven', RavenLogger);\n\n\t\tthis.log = new Logger(null, null, null); //, this.raven);\n\t\tthis.log.label = 'FFZPlayer';\n\t\tthis.log.init = true;\n\n\t\tthis.core_log = this.log.get('core');\n\t\tthis.log.hi(this);\n\n\n\t\t// ========================================================================\n\t\t// Core Systems\n\t\t// ========================================================================\n\n\t\tthis.inject('settings', SettingsManager);\n\t\tthis.inject('experiments', ExperimentManager);\n\t\tthis.inject('i18n', TranslationManager);\n\t\tthis.inject('staging', StagingSelector);\n\t\tthis.inject('load_tracker', LoadTracker);\n\t\tthis.inject('pubsub', PubSubClient);\n\t\tthis.inject('site', Site);\n\t\tthis.inject('addons', AddonManager);\n\n\t\t// ========================================================================\n\t\t// Startup\n\t\t// ========================================================================\n\n\t\tthis.enable().then(() => {\n\t\t\tconst duration = performance.now() - start_time;\n\t\t\tthis.core_log.info(`Initialization complete in ${duration.toFixed(5)}ms.`);\n\t\t\tthis.log.init = false;\n\t\t}).catch(err => {\n\t\t\tthis.core_log.error(`An error occurred during initialization.`, err);\n\t\t\tthis.log.init = false;\n\t\t});\n\t}\n\n\tstatic get() {\n\t\treturn FrankerFaceZ.instance;\n\t}\n\n\t// ========================================================================\n\t// Generate Log\n\t// ========================================================================\n\n\tasync generateLog() {\n\t\tconst promises = [];\n\t\tfor(const key in this.__modules) { // eslint-disable-line guard-for-in\n\t\t\tconst module = this.__modules[key];\n\t\t\tif ( module instanceof Module && module.generateLog && module != this )\n\t\t\t\tpromises.push((async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tawait timeout(Promise.resolve(module.generateLog()), 5000)\n\t\t\t\t\t\t];\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t`Error: ${err}`\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t})());\n\t\t}\n\n\t\tconst out = await Promise.all(promises);\n\n\t\tif ( this.log.captured_init && this.log.captured_init.length > 0 ) {\n\t\t\tconst logs = [];\n\t\t\tfor(const msg of this.log.captured_init) {\n\t\t\t\tconst time = dayjs(msg.time).locale('en').format('H:mm:ss');\n\t\t\t\tlogs.push(`[${time}] ${msg.level} | ${msg.category || 'core'}: ${msg.message}`);\n\t\t\t}\n\n\t\t\tout.unshift(['initialization', logs.join('\\n')]);\n\t\t}\n\n\t\treturn out.map(x => `${x[0]}\n-------------------------------------------------------------------------------\n${typeof x[1] === 'string' ? x[1] : JSON.stringify(x[1], null, 4)}`).join('\\n\\n');\n\t}\n}\n\n\nFrankerFaceZ.Logger = Logger;\n\nconst VER = FrankerFaceZ.version_info = Object.freeze({\n\tmajor: __version_major__,\n\tminor: __version_minor__,\n\trevision: __version_patch__,\n\textra: __version_prerelease__?.length && __version_prerelease__[0],\n\tcommit: __git_commit__,\n\tbuild: __version_build__,\n\thash: __webpack_hash__,\n\ttoString: () =>\n\t\t`${VER.major}.${VER.minor}.${VER.revision}${VER.build ? `.${VER.build}` : ''}${VER.extra || ''}${DEBUG ? '-dev' : ''}`\n});\n\n// We don't support addons in the player right now, so a few\n// of these are unavailable.\nFrankerFaceZ.utilities = {\n\taddon: require('utilities/addon'),\n\tblobs: require('utilities/blobs'),\n\t//color: require('utilities/color'),\n\tconstants: require('utilities/constants'),\n\tdom: require('utilities/dom'),\n\tevents: require('utilities/events'),\n\t//fontAwesome: require('utilities/font-awesome'),\n\t//graphql: require('utilities/graphql'),\n\tlogging: require('utilities/logging'),\n\tmodule: require('utilities/module'),\n\tobject: require('utilities/object'),\n\ttime: require('utilities/time'),\n\ttooltip: require('utilities/tooltip'),\n\ti18n: require('utilities/translation-core'),\n\tdayjs: require('dayjs'),\n\tpopper: require('@popperjs/core')\n}\n\n\nwindow.FrankerFaceZ = FrankerFaceZ;\nwindow.ffz = new FrankerFaceZ();\n"],"names":["SPACE","SYMBOLS","SUBNUM","SUBMSG","KEYS","CLOSE_TAG","Parser","exports","module","options","i","key","val","j","k2","p","msg","context","parent","opts","length","special_hash","out","start","char","mergePush","element","unexpected","include_separator","include_space","include_tags","tags","next","closing","skipSpace","name","expected","tag","contents","id","type","offset","submessages","req","format","selector","OFFSET","found","index","list","item","l","getHTMLElementScroll","getNodeScroll","node","getWindow","getWindowScroll","isElementScaled","rect","scaleX","scaleY","getCompositeRect","elementOrVirtualElement","offsetParent","isFixed","isOffsetParentAnElement","offsetParentIsScaled","documentElement","getDocumentElement","getBoundingClientRect","scroll","offsets","getNodeName","isScrollParent","getWindowScrollBarX","order","modifiers","map","visited","result","modifier","sort","requires","dep","depModifier","orderModifiers","orderedModifiers","acc","phase","debounce","fn","pending","resolve","mergeByName","merged","current","existing","DEFAULT_OPTIONS","areValidElements","_len","args","_key","popperGenerator","generatorOptions","_generatorOptions","_generatorOptions$def","defaultModifiers","_generatorOptions$def2","defaultOptions","reference","popper","state","effectCleanupFns","isDestroyed","instance","setOptionsAction","cleanupModifierEffects","listScrollParents","m","runModifierEffects","_state$elements","getOffsetParent","getLayoutRect","_state$orderedModifie","_state$orderedModifie2","_options","_ref","_ref$options","effect","cleanupFn","noopFn","createPopper","contains","child","rootNode","includeScale","isFixedStrategy","clientRect","visualViewport","addVisualOffsets","x","y","width","height","getComputedStyle","isTableElement","getTrueOffsetParent","getContainingBlock","isFirefox","isIE","elementCss","currentNode","getParentNode","css","window","ownerDocument","win","scrollLeft","scrollTop","isElement","OwnElement","isHTMLElement","isShadowRoot","isLayoutViewport","_getComputedStyle","overflow","overflowX","overflowY","getScrollParent","_element$ownerDocumen","scrollParent","isBody","target","updatedList","top","bottom","right","left","auto","basePlacements","end","clippingParents","viewport","variationPlacements","placement","placements","beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite","modifierPhases","eventListeners","popperOffsets","computeStyles","applyStyles","style","attributes","value","_ref2","initialStyles","styleProperties","property","attribute","toPaddingObject","padding","arrow","_state$modifiersData$","arrowElement","basePlacement","axis","isVertical","len","paddingObject","arrowRect","minProp","maxProp","endDiff","startDiff","arrowOffsetParent","clientSize","centerToReference","min","max","center","axisProp","_options$element","unsetSides","roundOffsetsByDPR","dpr","mapToStyles","_Object$assign2","popperRect","variation","position","gpuAcceleration","adaptive","roundOffsets","_offsets$x","_offsets$y","_ref3","hasX","hasY","sideX","sideY","heightProp","widthProp","offsetY","offsetX","commonStyles","_ref4","_Object$assign","_ref5","_options$gpuAccelerat","_options$adaptive","_options$roundOffsets","passive","_options$scroll","_options$resize","resize","scrollParents","hash","getOppositePlacement","matched","getOppositeVariationPlacement","computeAutoPlacement","boundary","rootBoundary","flipVariations","_options$allowedAutoP","allowedAutoPlacements","getVariation","allowedPlacements","overflows","detectOverflow","getBasePlacement","a","b","getExpandedFallbackPlacements","oppositePlacement","flip","_options$mainAxis","checkMainAxis","_options$altAxis","checkAltAxis","specifiedFallbackPlacements","altBoundary","_options$flipVariatio","preferredPlacement","isBasePlacement","fallbackPlacements","referenceRect","checksMap","makeFallbackChecks","firstFittingPlacement","_basePlacement","isStartVariation","mainVariationSide","altVariationSide","checks","check","numberOfChecks","_loop","_i","fittingPlacement","_ret","getSideOffsets","preventedOffsets","isAnySideFullyClipped","side","hide","referenceOverflow","popperAltOverflow","referenceClippingOffsets","popperEscapeOffsets","isReferenceHidden","hasPopperEscaped","distanceAndSkiddingToXY","rects","invertDistance","skidding","distance","_options$offset","data","_data$state$placement","getAltAxis","preventOverflow","_options$tether","tether","_options$tetherOffset","tetherOffset","mainAxis","getMainAxisFromPlacement","altAxis","tetherOffsetValue","normalizedTetherOffsetValue","offsetModifierState","_offsetModifierState$","mainSide","altSide","additive","minLen","maxLen","arrowPaddingObject","getFreshSideObject","arrowPaddingMin","arrowPaddingMax","arrowLen","within","minOffset","maxOffset","clientOffset","offsetModifierValue","tetherMin","tetherMax","preventedOffset","math","_offsetModifierState$2","_mainSide","_altSide","_offset","_min","_max","isOriginSide","_offsetModifierValue","_tetherMin","_tetherMax","_preventedOffset","computeOffsets","commonX","commonY","getViewportRect","strategy","html","layoutViewport","getDocumentRect","winScroll","body","rectToClientRect","getInnerBoundingClientRect","getClientRectFromMixedType","clippingParent","getClippingParents","canEscapeClipping","clipperElement","getClippingRect","mainClippingParents","firstClippingParent","clippingRect","accRect","_options$placement","_options$strategy","_options$boundary","_options$rootBoundary","_options$elementConte","elementContext","_options$altBoundary","_options$padding","mergePaddingObject","expandToHashMap","altContext","clippingClientRect","referenceClientRect","popperClientRect","elementClientRect","overflowOffsets","offsetData","multiply","keys","hashMap","round","getUAString","uaData","withinMaxClamp","v","root","factory","CryptoJS","Math","undefined","crypto","cryptoSecureRandomInt","create","F","obj","subtype","C","C_lib","Base","overrides","properties","propertyName","WordArray","words","sigBytes","encoder","Hex","wordArray","thisWords","thatWords","thisSigBytes","thatSigBytes","thatByte","clone","nBytes","C_enc","hexChars","bite","hexStr","hexStrLength","Latin1","latin1Chars","latin1Str","latin1StrLength","Utf8","utf8Str","BufferedBlockAlgorithm","doFlush","processedWords","dataWords","dataSigBytes","blockSize","blockSizeBytes","nBlocksReady","nWordsReady","nBytesReady","Hasher","cfg","messageUpdate","hasher","message","C_algo","W","SHA1","M","H","c","d","e","n","t","nBitsTotal","nBitsLeft","r","s","u","o","f","h","$","g","D","_","S","w","O","last_site","last_call","react","reactDom","munch","timeout","el","reject","observer_name","call_id","timer","observer","selectors","BaseSite","STYLE_VALIDATOR","LEFT_CONTROLS","RIGHT_CONTROLS","HAS_COMPRESSOR","HAS_GAIN","SCROLL_I18N","SCROLL_OPTIONS","getNativeClipButton","container","wantsRMB","setting","matchesEvent","event","has_rmb","rotateButton","icon","ctx","inst","cls","instances","events","Mousetrap","old_attach","old_active","old_inactive","cont","icons","ds","player","video","vol_scroll","gain_scroll","click_pause","wants_rmb","muted","no_vol","matches_gain","matches_vol","delta","has_gain","doing_gain","amount","old_volume","volume","err","fs","pip","immediatePause","font_out","font_size","font_family","processed","unloader","btn","visible_only","tries","outer","gain","tip","tipcont","input","extra","fill","on_change","core","range","has_comp","comp_active","can_apply","label","new_vid","vol","vid","compressed","wanted","want_gain","comp","src","evt","update_gui","pbrate","installProperty","rate","is_fs","has_pip","thing","pip_active","pip_swap","has_clip_button","on_click","native","disabled","has_reset","duration","source","user","timers","refresh_fn","created","channel_id","cache","error","waiters","pair","PlayerBase","MD","MILA","_md","loadMD","modules","waited","SettingsLinks","md","default_render","tokens","idx","env","self","token","href","attr","path","bits","tok","awaitMD","getMD","callback","manager","old_keys","default_value","entry","count","SettingsProfile","log","info","version","ffz","addons","Addon","isValidBlob","blob","serializeBlob","deserializeBlob","prefix","max_depth","traverse_roots","children","criteria","depth","wrapper","parent_node","multi","single_class","parents","matches","crit","match","klass","criterias","route","lw","crt","waiter","routes","FineWrapper","nodes","mutations","Fine","EVENTS","fine","insts","_instances","proto","o_mount","o_unmount","mount","unmount","original","priority","prepend","ttl","DEBUG","EXTENSION","SERVER","SERVER_OR_EXT","API_SERVER","STAGING_API","STAGING_CDN","NEW_API","SENTRY_ID","WORD_SEPARATORS","WEIRD_EMOTE_SIZES","BAD_HOTKEYS","RERENDER_SETTINGS","UPDATE_BADGE_SETTINGS","UPDATE_TOKEN_SETTINGS","TWITCH_EMOTE_V2","KNOWN_CODES","REPLACEMENT_BASE","REPLACEMENTS","WS_CLUSTERS","LINK_DATA_HOSTS","PUBSUB_CLUSTERS","EMQX_SERVERS","IS_OSX","IS_WIN","IS_WEBKIT","IS_FIREFOX","WEBKIT_CSS","TWITCH_GLOBAL_SETS","TWITCH_POINTS_SETS","TWITCH_PRIME_SETS","EmoteTypes","RESOLVERS_REQUIRE_TOS","ATTRS","SVG_TAGS","BOOLEAN_ATTRS","camelCase","on","listener","off","findReactFragment","frag","createElement","props","lk","prop","k","setChildren","no_sanitize","no_empty","hasSharedParent","other","openFile","contentType","multiple","resolved","files","readFile","file","encoding","reader","sanitize","text","last_id","block","force","ManagedStyle","ClickOutside","highlightJson","object","pretty","indent","indent_inner","Detach","StopPropagation","SNAKE_CAPS","SNAKE_SPACE","SNAKE_TRIM","separator","new_listeners","old_listeners","removed","other_val","FFZEvent","FFZWaitableEvent","ret","need_sort","new_items","EventEmitter","promises","results","promise","chr","parts","remain","HierarchicalEventEmitter","createTester","rules","filter_types","inverted","or","rebuild","tests","names","rule","test","KNOWN_FONTS","VALID_FONTS","font","GOOGLE_FONTS","LOADED_GOOGLE","LOADED_GOOGLE_LINKS","loadGoogleFont","link","unloadGoogleFont","OD_FONTS","od_count","od_link","loadOpenDyslexic","unloadOpenDyslexic","getFontsList","useFont","unloaded","RAVEN_LEVELS","LogLevel","readLSLevel","level","upper","Logger","raven","VER","loc","optionalParams","colors","exc","default_style","strings","LoadState","State","EXTRACTOR","extractAddonId","addon","addon_id","is_loadable","load_requires","initial","chain","CyclicDependencyError","ModuleError","load_state","require","full_name","variable","inject_reference","old_val","dependents","req_name","req_path","req_mod","in_path","in_name","in_mod","added","raw_path","raw_module","lix","trimmed","buildAddonProxy","Module","accessor","access_warnings","no_proxy","handler","receiver","warning","HOP","getTwitchEmoteURL","scale","animated","dark","getTwitchEmoteSrcSet","big","isValidShortcut","generateUUID","i18n","TranslatableError","sha256","msgBuffer","hashBuffer","matchScreen","screens","mscore","mon","score","has","sleep","delay","make_enum","word","make_enum_flags","TimeoutError","fail","limit","held","TicketLock","Mutex","immediate","later","once","array_equals","deep_equals","first","second","ignore_undefined","first_seen","second_seen","source_keys","dest_keys","set_equals","shallow_object_equals","map_equals","substr_count","str","needle","get","segments","part","new_object","shallow_copy","seen","deep_copy","normalizeAddonIdForComparison","makeAddonIdChecker","escape_regex","maybe_call","SPLIT_REGEX","split_chars","pick_random","addWordSeparators","CONTROL_CHARS","glob_to_regex","output","groups","truncate","overage","ellipsis","break_line","trim","next_space","decimalToHex","generateHex","arr","use_set","source_sorter","sources","items","need_sorting","SourcedSet","b64ToArrayBuffer","bin","buffer","view","PEM_HEADER","PEM_FOOTER","importRsaKey","pem","uses","start_match","end_match","is_private","content","fetchJSON","url","init","error_value","resp","parse","parseAST","raw","old_tab","old_page","parseJSON","tab","page","stack","string","getBuster","resolution","now","duration_to_string","elapsed","separate_days","days_only","no_hours","no_seconds","seconds","minutes","hours","days","day_count","show_hours","print_duration","durationForChat","durationForURL","NoContent","DefaultOptions","elements","ctrl_state","inner","interactive","hover_events","use_html","setter","pop_opts","popper_target","makeReference","normalizeModifiers","noop","Tooltip","_x","DEFAULT_PARSER_OPTIONS","DEFAULT_TYPES","locale","ast","sub_ast","getCardinalName","getOrdinalName","new_val","DEFAULT_FORMATS","without_suffix","currency","formatter","phrases","full_key","phrase","parsed","settings","listToString","TranslationCore","cardinal_i18n","cardinal_locale","ordinal_i18n","ordinal_locale","webpackAsyncContext","__webpack_require__","ids","webpackAsyncContextResolve","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","getter","getProto","leafPrototypes","mode","ns","def","definition","chunkId","inProgress","dataWebpackPrefix","done","script","needAttach","scripts","onScriptComplete","prev","doneFns","scriptUrl","document","installedChunks","installedChunkData","loadingEnded","errorType","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","DEFAULT","profiles","profile","values","trailing","had_value","profs","trail","is_trailing","compare_requirements","old_cache","old_value","new_value","contexts","new_profiles","changed_ids","old_meta","meta","new_m","old_m","new_uses","old_uses","changed","new_meta","req_key","raw_type","raw_value","def_default","prof","SettingsContext","BAD","do_number","bounds","to_int","to_float","process_to_int","process_to_float","safety","loadSafety","NeverMatch","Invert","config","rule_types","And","Or","If","cond","if_true","if_false","Constant","parseTime","time","Time","TheaterMode","Fullscreen","Moderator","Debug","AddonDebug","SquadMode","NativeDarkTheme","Page","router","Channel","login","Category","Title","reload","title","need_safety","regex","Monitor","FFZ","details","sorted","DB_VERSION","NOT_WWW_TWITCH","NOT_WWW_YT","SettingsProvider","AdvancedSettingsProvider","success","transfer","cbs","RemoteSettingsProvider","LocalStorageProvider","request","db","store","r2","this_wait","trx","delreq","release","IndexedDBProvider","frame","CrossOriginStorageBridge","responded","cleanup","ExtensionProvider","Providers","Experiments","HiddenEmotes","provider","FavoriteEmotes","Overrides","Profiles","Everything","postMessage","NO_SYNC_KEYS","params","proxy","captured","has_value","raw_key","has_raw","is_raw","timestamp","JSZip","metadata","safe_key","providers","old_provider","new_provider","deleted","s_key","enabled","suppress_events","old_profile_ids","old_profile_uuids","old_profiles","profile_ids","profile_uuids","old_ids","new_ids","raw_profiles","need_save","reordered","profile_data","slot_id","old_profile","old_slot_id","new_profile","is_dev","old_definition","required_by","ui","format_path_tokens","links","i18n_base","processor","validator","SettingsManager","targets","old_enabled","cdn_data","local_data","base_path","old","terms","term","button","save","AddonManager","defaultConverter","converter","defaultAttributes","set","stringifiedAttributes","attributeName","cookies","jar","api","OVERRIDE_COOKIE","COOKIE_OPTIONS","EXPERIMENTS","TwitchExperimentType","isTwitchExperiment","exp","isFFZExperiment","sortExperimentLog","ts","ffz_assignments","assignment","override","weight","total","group","twitch_assignments","channel","exps","external","line","experiments","exp_data","is_set","experiment","unique_id","seed","ExperimentManager","STACK_SPLITTER","SOURCE_SPLITTER","MAP_OPTIONS","BAD_FRAMES","FACES","transformText","owo","TRANSFORMATIONS","fmt","normal_out","joke_out","popout","mod","new_locale","ignore_loaded","location","chunk","hashes","chnk","chunks","ignored","old_locale","djs","TranslationManager","DOLLAR_REGEX","REPLACE","FORMAT_REGEX","parseFormatters","transformPhrase","substitutions","token_regex","formatters","is_array","expr","arg","fmts","formatted","StagingSelector","enumerateSubs","topic","wantDelay","ws","packet","sub","topics","PubSubClient","client","referrer","topic_map","refs","PubSub","LoadTracker","permission","broadcast_id","perm","can_copy","copy","Player","stats","temp","videoHeight","videoWidth","displayHeight","displayWidth","tampered","delayed","ff","video_info","destroy","ref_fn","refresh","stat","old_color","old_icon","color","tooltip","popup","border","inherit","listeners","add_close_listener","cb","fp","figure","Metadata","scope","CSSTweaks","warnings","default_type","tip_container","tip_element","align","TooltipProvider","update_size","loads","Apollo","TwitchData","bcast","game","should_render","lbl","ver","PlayerSite","start_time","logs","FrankerFaceZ"],"sourceRoot":""}