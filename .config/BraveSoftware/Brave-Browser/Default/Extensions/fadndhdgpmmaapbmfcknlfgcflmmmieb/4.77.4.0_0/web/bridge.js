(()=>{var ut=Object.defineProperty;var y=(ke,De)=>ut(ke,"name",{value:De,configurable:!0});var et=[];(()=>{"use strict";var ke={81011:(F,O,P)=>{P.d(O,{Z:()=>S});var B=P(17159),U=P(46949),N=P(37087);const I=class I extends B.EventEmitter{constructor(g,w){super(),this._enabled=!1,this.ephemeral=!1,this.id=-1,this.uuid=null,this.name=null,this.pause_updates=!1,this.show_toggle=!1,this._hotkey_enabled=!1,this.onShortcut=this.onShortcut.bind(this),this._hotkey_enabled=!1,this.manager=g,this.provider=g.provider,this.data=w,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`,this.ephemeral&&(this._enabled=!0,this._storage=new Map)}get data(){return{id:this.id,uuid:this.uuid,name:this.name,i18n_key:this.i18n_key,hotkey:this.hotkey,pause_updates:this.pause_updates,ephemeral:this.ephemeral,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(g){if(typeof g!="object")throw new TypeError("data must be an object");this.clearMatcher(),g.ephemeral&&(this.ephemeral=!0);for(const[w,k]of Object.entries(g))this[w]=k}clearMatcher(){this.matcher=null}matches(g){return this.matcher||(this.matcher=(0,N.createTester)(this.context,this.manager.filters,!1,!1,()=>this.manager.updateSoon())),this.matcher(g)}save(){this.ephemeral||this.manager.saveProfile(this.id)}getBackup(){const g={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};delete g.profile.ephemeral;for(const[w,k]of this.entries())g.values[w]=k;return g}async checkUpdate(){if(!this.url||this.pause_updates)return!1;const g=await(0,U.fetchJSON)(this.url);if(!g||g.type!=="profile"||!g.profile||!g.values)return!1;delete g.profile.ephemeral,delete g.profile.id,delete g.profile.uuid,delete g.profile.name,delete g.profile.i18n_key,delete g.profile.hotkey,delete g.profile.description,delete g.profile.desc_i18n_key,delete g.profile.url,delete g.profile.pause_updates,this.data=g.profile;const w=new Set(this.keys());for(const[k,R]of Object.entries(g.values))w.delete(k),this.set(k,R);for(const k of w)this.delete(k);return!0}get hotkey(){return this._hotkey}set hotkey(g){g!==this._hotkey&&(this._hotkey=g,this._hotkey_enabled&&this._updateHotkey())}get hotkey_enabled(){return this._hotkey_enabled}set hotkey_enabled(g){this._hotkey_enabled=!!g,this._updateHotkey()}_updateHotkey(){const g=this.Mousetrap=this.Mousetrap||window.Mousetrap;if(!g)return;const w=this._hotkey;this._bound_key&&(this._bound_key!==w||!this._hotkey_enabled)&&(g.unbind(this._bound_key),this._bound_key=null),this._hotkey_enabled&&w&&(0,U.isValidShortcut)(w)&&(g.bind(w,this.onShortcut),this._bound_key=w)}onShortcut(g){this.toggled=!this.toggled,g&&(g.stopPropagation(),g.preventDefault())}get toggled(){return this.ephemeral?this._enabled:this.provider.get(this.enabled_key,!0)}set toggled(g){g!==this.toggled&&(this.ephemeral?this._enabled=g:this.provider.set(this.enabled_key,g),this.emit("toggled",this,g))}setContext(g){if(this.id===0)throw new Error("cannot set context of default profile");this.context=g,this.clearMatcher(),this.save()}get(g,w){return this.ephemeral?this._storage&&this._storage.has(g)?this._storage.get(g):w??null:this.provider.get(this.prefix+g,w)}set(g,w){this.ephemeral?this._storage&&this._storage.set(g,w):this.provider.set(this.prefix+g,w),this.emit("changed",g,w,!1)}delete(g){this.ephemeral?this._storage&&this._storage.delete(g):this.provider.delete(this.prefix+g),this.emit("changed",g,void 0,!0)}has(g){return this.ephemeral?this._storage?this._storage.has(g):!1:this.provider.has(this.prefix+g)}keys(){if(this.ephemeral)return this._storage?Array.from(this._storage.keys()):[];const g=[],w=this.prefix,k=w.length;for(const R of this.provider.keys())R.startsWith(w)&&R!==this.enabled_key&&g.push(R.slice(k));return g}clear(){if(this.ephemeral){if(this._storage){const k=this.keys();this._storage.clear();for(const R of k)this.emit("changed",R,void 0,!0)}return}const g=this.prefix,w=g.length;for(const k of this.provider.keys())k.startsWith(g)&&k!==this.enabled_key&&(this.provider.delete(k),this.emit("changed",k.slice(w),void 0,!0))}*entries(){if(this.ephemeral){if(this._storage)for(const g of this._storage.entries())yield g}else{const g=this.prefix,w=g.length;for(const k of this.provider.keys())k.startsWith(g)&&k!==this.enabled_key&&(yield[k.slice(w),this.provider.get(k)])}}get size(){if(this.ephemeral)return this._storage?this._storage.size:0;const g=this.prefix;let w=0;for(const k of this.provider.keys())k.startsWith(g)&&k!==this.enabled_key&&w++;return w}};y(I,"SettingsProfile");let S=I;S.Default={id:0,uuid:"ffz_profile_default",name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},S.Moderation={id:1,uuid:"ffz_profile_moderation",name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},24431:(F,O,P)=>{P.d(O,{BAD_HOTKEYS:()=>v,DEBUG:()=>B,EXTENSION:()=>U});const B=localStorage.ffzDebugMode==="true"&&document.body.classList.contains("ffz-dev"),U=!0;let S=`${B?"https://localhost:8000":"https://cdn2.frankerfacez.com"}/script`;U&&(S=P.p,S.endsWith("/")&&(S=S.slice(0,S.length-1)));const I=null,H="https://api.frankerfacez.com",g="https://api-staging.frankerfacez.com",w="https://cdn-staging.frankerfacez.com",k="https://api2.frankerfacez.com",R="https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2",q="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]",j={15:[21,27],16:[22,27],17:[20,27],18:[20,27],22:[19,27],25:[25,28],26:[20,27],28:[39,27],30:[29,27],32:[21,27],33:[25,32],34:[21,28],36:[36,30],40:[21,27],41:[19,27],46:[24,24],47:[24,24],50:[18,27],52:[32,32],65:[40,30],66:[20,27],69:[41,28],73:[21,30],74:[24,30],86:[36,30],87:[24,30],92:[23,30],244:[24,30],354:[20,30],357:[28,30],360:[22,30],483:[20,18],484:[20,22],485:[27,18],486:[21,32],487:[15,32],488:[29,24],489:[20,18],490:[20,18],491:[20,18],492:[20,18],493:[20,18],494:[20,18],495:[20,18],496:[20,18],497:[20,18],498:[20,18],499:[20,18],500:[20,18],501:[20,18],1896:[20,30],1898:[26,28],1899:[22,30],1900:[33,30],1901:[24,28],1902:[27,29],1904:[24,30],1906:[24,30]},v=["f","space","k","shift+up","shift+down","esc","m","?","alt+t","alt+x"],X=null,Z=null,z=null,r={Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Meta:91,Context:93},n="//static-cdn.jtvnw.net/emoticons/v2",d={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},_=null,m={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},x={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",.7],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1],["wss://ayaya.frankerfacez.com/",1],["wss://champ.frankerfacez.com/",1]],Development:[["ws://127.0.0.1:7999/",1]]},T={localhost:{title:"Local Dev Server (Port 8002)",value:"https://localhost:8002",has_sse:!0},"localhost-cf":{title:"Local Dev Worker (Wrangler, Port 8787)",value:"https://localhost:8787"},Production:{title:"Production",value:"https://link-service.workers.frankerfacez.com"}},$={Production:"https://pubsub.frankerfacez.com",Staging:"https://pubsub-staging-alt.frankerfacez.com",EMQXTest:"emqx-test",Development:"https://stendec.dev/ps/"},G=null,V=navigator.platform?navigator.platform.indexOf("Mac")!==-1:/OS X/.test(navigator.userAgent),Q=navigator.platform?navigator.platform.indexOf("Win")!==-1:/Windows/.test(navigator.userAgent),ee=navigator.userAgent.indexOf("AppleWebKit/")!==-1&&navigator.userAgent.indexOf("Edge/")===-1,te=navigator.userAgent.indexOf("Firefox/")!==-1,$e=null,Oe=null,ae=null,fe=null;var ye=(J=>(J[J.Unknown=0]="Unknown",J[J.Prime=1]="Prime",J[J.Turbo=2]="Turbo",J[J.LimitedTime=3]="LimitedTime",J[J.ChannelPoints=4]="ChannelPoints",J[J.Unavailable=5]="Unavailable",J[J.Subscription=6]="Subscription",J[J.BitsTier=7]="BitsTier",J[J.Global=8]="Global",J[J.TwoFactor=9]="TwoFactor",J[J.Follower=10]="Follower",J))(ye||{});const re={YouTube:{label:"You must agree to the YouTube Terms of Service to view this embed.",i18n_key:"embed.warn.youtube",i18n_links:"embed.warn.youtube.links",links:`To view YouTube embeds, you must agree to YouTube's Terms of Service:
* [Terms of Service](https://www.youtube.com/t/terms)
* [Privacy Policy](https://policies.google.com/privacy)`,i18n_accept:"embed.warn.youtube.agree",accept:"Yes, I accept the YouTube Terms of Service."}}},17159:(F,O,P)=>{var j;P.d(O,{EventEmitter:()=>g,default:()=>q});const B=Symbol("Detach"),U=Symbol("StopPropagation"),N=/([a-z])([A-Z])/g,S=/[ \t\W]/g,I=/^_+|_+$/g;String.prototype.toSlug=function(z="-"){let r=this;return r.normalize&&(r=r.normalize("NFD")),r.replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,z)},String.prototype.toSnakeCase=function(){let z=this;return z.normalize&&(z=z.normalize("NFD")),z.replace(/[\u0300-\u036f]/g,"").trim().replace(N,"$1_$2").replace(S,"_").replace(I,"").toLowerCase()};const H=(j=class{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return[];const r={},n=this.__listeners,d=[];for(const[_,m]of Object.entries(n))m?.length?r[_]=m:d.push(_);return this.__listeners=r,this.__dead_events=0,d}__sortListeners(r){if(this.__running.has(r))return;const n=this.__listeners[r];n&&n.sort((d,_)=>d[3]-_[3])}transferListeners(r){if(!(r instanceof j))throw new Error("other must also be EventEmitter");if(!(r.events().length+r.__running.size)){r.__listeners=this.__listeners,r.__dead_events=this.__dead_events,this.__listeners={},this.__dead_events=0;return}for(const[d,_]of Object.entries(this.__listeners)){if(!_||!_.length)continue;let m=r.__listeners[d];Array.isArray(m)?(m.push(..._),r.__sortListeners(d)):r.__listeners[d]=_}this.__listeners={},this.__dead_events=0}makeEvent(r){return w.makeEvent(r)}makeWaitableEvent(r){return k.makeEvent(r)}on(r,n,d,_,m=!1){if(typeof n!="function")throw new TypeError("fn must be a function");const x=[n,d,!1,_??0,m],T=this.__listeners[r];return T?(m?T.unshift(x):T.push(x),this.__sortListeners(r)):this.__listeners[r]=[x],this}once(r,n,d,_,m=!1){return this.many(r,1,n,d,_,m)}many(r,n,d,_,m,x=!1){if(typeof d!="function")throw new TypeError("fn must be a function");if(typeof n!="number"||isNaN(n)||!isFinite(n)||n<1)throw new TypeError("ttl must be a positive, finite number");const T=[d,_,n,m??0,x],$=this.__listeners[r];return $?(x?$.unshift(T):$.push(T),this.__sortListeners(r)):this.__listeners[r]=[T],this}waitFor(r,n,d,_=!1){return new Promise(m=>{const x=[(...$)=>m($),n,1,d??0,_],T=this.__listeners[r];T?(_?T.unshift(x):T.push(x),this.__sortListeners(r)):this.__listeners[r]=[x]})}off(r,n,d){if(r==null){if(!n&&!d)throw new Error("you must provide at least one constraint when removing listeners");for(const m in Object.keys(this.__listeners))this.__running.has(m)||this.off(m,n,d);return this}if(this.__running.has(r))throw new Error("concurrent modification: tried removing event listener while event is running");let _=this.__listeners[r];return _?(!n&&!d?_=null:(_=_.filter(([m,x])=>!((!n||m===n)&&(!d||d===x))),_.length||(_=null)),this.__listeners[r]=_,_||this.__dead_events++,this):this}offContext(r,n){return this.off(r,void 0,n)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(r){const n=this.__listeners[r];return n?Array.from(n):[]}hasListeners(r){return!!this.__listeners[r]}emit(r,...n){let d=this.__listeners[r];if(!d)return;if(this.__running.has(r))throw new Error("concurrent access: tried to emit event while event is running");const _=new Set;this.__listeners[r]=null,this.__running.add(r);for(const T of d){const[$,G,V]=T;let Q;try{Q=$.apply(G,n)}catch(ee){this.log&&(this.log.capture(ee,{tags:{event:r},extra:{args:n}}),this.log.error(ee))}if(Q===B?_.add(T):V!==!1&&(V<=1?_.add(T):T[2]=V-1),Q instanceof Promise&&n[0]instanceof k&&n[0].waitFor(Q),n[0]instanceof w&&n[0].propagationStopped||Q===U)break}if(_.size)for(const T of _){const $=d.indexOf(T);$!==-1&&d.splice($,1)}let m=!1;const x=this.__listeners[r];x&&(d=d.concat(x),m=!0),d.length?this.__listeners[r]=d:(this.__listeners[r]=null,this.__dead_events++),this.__running.delete(r),m&&this.__sortListeners(r)}},y(j,"_EventEmitter2"),j);H.Detach=B,H.StopPropagation=U;let g=H;const v=class v{static makeEvent(r){return new v(r)}constructor(r){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,r)}_reset(){this.defaultPrevented=!1,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}};y(v,"FFZEvent");let w=v;const X=class X extends w{constructor(){super(...arguments),this.__waiter_results=null}static makeEvent(r){return new X(r)}_wait(){if(this.__waiter)return this.__waiter;if(!this.__promises){const n=this.__waiter_results;return this.__waiter_results=null,n?Promise.resolve(n):null}const r=this.__promises;return this.__promises=null,this.__waiter=Promise.all(r).then(n=>(this.__waiter_results?this.__waiter_results.push(...n):this.__waiter_results=n,this.__waiter=null,this._wait()??[])).catch(n=>{throw this.__waiter=null,n})}_reset(){super._reset(),this.__waiter=null,this.__waiter_results=null,this.__promises=null}waitFor(r){this.__promises?this.__promises.push(r):this.__promises=[r]}};y(X,"FFZWaitableEvent");let k=X;const Z=class Z extends g{constructor(r,n){super(),this.name=r||(this.constructor.name||"").toSnakeCase(),this.parent=n,n?(this.root=n.root,this.__listeners=n.__listeners,this.__running=n.__running,this.__path=r&&n.__path?`${n.__path}.${r}`:r):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}transferListeners(r){if(!(r instanceof Z&&r.root===this.root))throw new Error("Transfering listeners from a HierarchicalEventEmitter is not supported.")}abs_path(r){if(typeof r!="string"||!r.length)throw new TypeError("path must be a non-empty string");let n=0,d;const _=this.__path_parts,m=_.length;do{if(d=r.charAt(n),r.charAt(n)==="."){if(n>m)throw new Error("invalid path: reached top of stack");continue}break}while(++n<r.length);const x=d===":";if(n===0)return x&&this.__path?`${this.__path}${r}`:r;const T=_.slice(0,m-(n-1)).join("."),$=r.slice(n);if(T.length)if($.length){if(x)return T+$}else return T;else return $;return`${T}.${$}`}on(r,n,d,_,m=!1){return super.on(this.abs_path(r),n,d,_,m)}once(r,n,d,_,m=!1){return super.once(this.abs_path(r),n,d,_,m)}many(r,n,d,_,m,x=!1){return super.many(this.abs_path(r),n,d,_,m,x)}waitFor(r,n,d,_=!1){return super.waitFor(this.abs_path(r),n,d,_)}off(r,n,d){return super.off(r&&this.abs_path(r),n,d)}listeners(r){return super.listeners(this.abs_path(r))}hasListeners(r){return super.hasListeners(this.abs_path(r))}emit(r,...n){return super.emit(this.abs_path(r),...n)}eventsWithChildren(){const r=super.events(),n=this.__path||"",d=n.length;return r.filter(_=>{const m=_.charAt(d);return _.startsWith(n)&&(m===""||m==="."||m===":")})}events(){const r=super.events(),n=this.__path||"",d=n.length;return r.filter(_=>{const m=_.charAt(d);return _.startsWith(n)&&(m===""||m===":")})}};y(Z,"HierarchicalEventEmitter");let R=Z;const q=R},37087:(F,O,P)=>{P.d(O,{createTester:()=>B});function B(U,N,S=!1,I=!1,H){if(!Array.isArray(U)||!N)return S?()=>!1:()=>!0;const g=[],w=[];let k=0;for(const R of U){if(!R||!R.type)continue;const q=N[R.type];if(!q){k++,g.push(()=>!1),w.push(`f${k}`);continue}const j=q.createTest(R.data,N,H);j&&(k++,g.push(j),w.push(`f${k}`))}return g.length?g.length===1?S?R=>!g[0](R):g[0]:new Function(...w,"ctx",`return ${S?"!(":""}${w.map(R=>`${R}(ctx)`).join(I?" || ":" && ")}${S?")":""};`).bind(null,...g):S?()=>!1:()=>!0}y(B,"createTester")},22527:(F,O,P)=>{var v;P.d(O,{buildAddonProxy:()=>R,default:()=>k});var B=P(17159),U=P(46949),N=(z=>(z[z.Unloaded=0]="Unloaded",z[z.Loading=1]="Loading",z[z.Loaded=2]="Loaded",z[z.Unloading=3]="Unloading",z))(N||{}),S=(z=>(z[z.Disabled=0]="Disabled",z[z.Enabling=1]="Enabling",z[z.Enabled=2]="Enabled",z[z.Disabling=3]="Disabling",z))(S||{});const I=/^addon\.([^.]+)(?:\.|$)/i;function H(z){return I.exec(z)?.[1]}y(H,"extractAddonId");const g=(v=class extends B.default{constructor(r,n,d){if(!n&&r instanceof v&&(n=r,r=void 0),super(r,n),this.load_dependents=null,this.dependents=null,this.references=null,this.__modules=n?n.__modules:{},this.children={},n?.__addon_id)this.__addon_id=n.__addon_id,this.__addon_root=n.__addon_root;else if(d){const m=H(this.__path);m&&(this.__addon_id=m,this.__addon_root=this)}n&&!n.children[this.name]&&(n.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this);let _=!!this.onLoad;if(!_){const m=this.__get_load_requires();_=Array.isArray(m)&&m.length>0}this.__load_state=_?0:2,this.__state=_||this.onEnable?0:2,this._time("instance"),this.emit(":registered",this)}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===2}get loading(){return this.__load_state===1}get enabled(){return this.__state===2}get enabling(){return this.__state===1}get addon_id(){return this.__addon_id}get addon_root(){return this.__addon_root}get addon_manifest(){if(this.__addon_id)return this.resolve("addons")?.getAddon(this.__addon_id)??this.__addon_root?.constructor?.info??void 0}get log(){return this.__log||(this.__log=this.parent&&this.parent.log?.get?.(this.name)),this.__log}set log(r){this.__log=r}_time(r){this.root.timing&&(typeof r!="object"&&(r={event:r}),r.module=this.__path||"core",this.root.timing.addEvent(r))}load(){return this.__load(this.__path,[])}unload(){return this.__unload(this.__path,[])}enable(){return this.__enable(this.__path,[])}disable(){return this.__disable(this.__path,[])}canUnload(){return this.__canUnload(this.__path,[])}canDisable(){return this.__canDisable(this.__path,[])}__load(r,n){const d=this.__path||this.name,_=this.__load_state;if(n.includes(this))return Promise.reject(new j(`cyclic load requirements when loading ${r}`,[...n,this]));if(this.load_requires)for(const m of this.load_requires){const x=this.__resolve(m);if(x instanceof v&&n.includes(x))return Promise.reject(new j(`cyclic load requirements when loading ${r}`,[...n,this,x]))}return n.push(this),_===1?this.__load_promise:_===2?Promise.resolve():_===3?Promise.reject(new q(`attempted to load module ${d} while module is being unloaded`)):(this._time("load-start"),this.__load_state=1,this.__load_promise=(async()=>{if(this.load_requires){const m=[];for(const x of this.load_requires){const T=this.__resolve(x);if(!T||!(T instanceof v))throw new q(`cannot find required module ${x} when loading ${d}`);m.push(T.__enable(r,Array.from(n)))}await Promise.all(m)}if(this.onLoad)return this._time("load-self"),this.onLoad()})().then(m=>(this.__load_state=2,this.__load_promise=null,this._time("load-end"),this.emit(":loaded",this),m)).catch(m=>{throw this.__load_state=0,this.__load_promise=null,this._time("load-end"),m}))}__canUnload(r,n){const d=this.__path||this.name,_=this.__load_state;if(n.includes(this))throw new j(`cyclic load requirements when checking if can unload ${r}`,[...n,this]);if(this.load_dependents){n.push(this);for(const m of this.load_dependents){const x=this.__resolve(m);if(x instanceof v){if(n.includes(x))throw new j(`cyclic load requirements when checking if can unload ${r}`,[...n,this,x]);if(!x.__canUnload(r,Array.from(n)))return!1}}}return _===3||_===0?!0:this.onLoad&&!this.onUnload?!1:_!==1}__unload(r,n){const d=this.__path||this.name,_=this.__load_state;if(n.includes(this))return Promise.reject(new j(`cyclic load requirements when unloading ${r}`,[...n,this]));if(this.load_dependents)for(const m of this.load_dependents){const x=this.__resolve(m);if(x instanceof v&&n.includes(x))return Promise.reject(new j(`cyclic load requirements when unloading ${r}`,[...n,this,x]))}return n.push(this),_===3?this.__load_promise:_===0?Promise.resolve():this.onLoad&&!this.onUnload?Promise.reject(new q(`attempted to unload module ${d} but module cannot be unloaded`)):_===1?Promise.reject(new q(`attempted to unload module ${d} while module is being loaded`)):(this._time("unload-start"),this.__load_state=3,this.__load_promise=(async()=>{if(this.__state!==0&&await this.disable(),this.load_dependents){const m=[];for(const x of this.load_dependents){const T=this.__resolve(x);!T||!(T instanceof v)||m.push(T.__unload(r,Array.from(n)))}await Promise.all(m)}if(this._time("unload-self"),this.onUnload)return this.onUnload()})().then(m=>(this.__load_state=0,this.__load_promise=null,this._time("unload-end"),this.emit(":unloaded",this),m)).catch(m=>{throw this.__load_state=2,this.__load_promise=null,this._time("unload-end"),m}))}__enable(r,n){const d=this.__path||this.name,_=this.__state;if(n.includes(this))return Promise.reject(new j(`cyclic requirements when enabling ${r}`,[...n,this]));if(this.requires)for(const m of this.requires){const x=this.__resolve(m);if(x instanceof v&&n.includes(x))return Promise.reject(new j(`cyclic requirements when enabling ${r}`,[...n,this,x]))}return n.push(this),_===1?this.__state_promise:_===2?Promise.resolve():_===3?Promise.reject(new q(`attempted to enable module ${d} while module is being disabled`)):(this._time("enable-start"),this.__state=1,this.__state_promise=(async()=>{const m=[],x=this.requires,T=this.__load_state;if(T===3)throw new q(`attempted to load module ${d} while module is being unloaded`);if((T===1||T===0)&&m.push(this.load()),x)for(const $ of x){const G=this.__resolve($);if(!G||!(G instanceof v))throw new q(`cannot find required module ${$} when enabling ${d}`);m.push(G.__enable(r,Array.from(n)))}if(await Promise.all(m),this.onEnable)return this._time("enable-self"),this.onEnable()})().then(m=>(this.__state=2,this.__state_promise=null,this._time("enable-end"),this.emit(":enabled",this),m)).catch(m=>{throw this.__state=0,this.__state_promise=null,this._time("enable-end"),m}))}__canDisable(r,n){const d=this.__path||this.name,_=this.__state;if(n.includes(this))throw new j(`cyclic load requirements when checking if can disable ${r}`,[...n,this]);if(this.dependents){n.push(this);for(const m of this.dependents){const x=this.__resolve(m);if(x&&x instanceof v){if(n.includes(x))throw new j(`cyclic load requirements when checking if can disable ${r}`,[...n,this,x]);if(!x.__canDisable(r,Array.from(n)))return!1}}}if(_===3||_===0)return!0;if(this.onDisable){if(_===1)return!1}else return!1;return!0}__disable(r,n){const d=this.__path||this.name,_=this.__state;if(n.includes(this))return Promise.reject(new j(`cyclic requirements when disabling ${r}`,[...n,this]));if(this.dependents)for(const m of this.dependents){const x=this.__resolve(m);if(x instanceof v&&n.includes(x))return Promise.reject(new j(`cyclic requirements when disabling ${r}`,[...n,this,x]))}if(n.push(this),_===3)return this.__state_promise;if(_===0)return Promise.resolve();if(this.onDisable){if(_===1)return Promise.reject(new q(`attempted to disable module ${d} but module is being enabled`))}else return Promise.reject(new q(`attempted to disable module ${d} but module cannot be disabled`));return this._time("disable-start"),this.__state=3,this.__state_promise=(async()=>{if(this.__load_state!==2)throw new q(`attempted to disable module ${d} but module is unloaded -- weird state`);if(this.dependents){const m=[];for(const x of this.dependents){const T=this.__resolve(x);!T||!(T instanceof v)||m.push(T.__disable(r,Array.from(n)))}await Promise.all(m)}if(this.onDisable)return this._time("disable-self"),this.onDisable()})().then(m=>(this.__state=0,this.__state_promise=null,this._time("disable-end"),this.emit(":disabled",this),m)).catch(m=>{throw this.__state=2,this.__state_promise=null,this._time("disable-end"),m})}on(r,n,d,_,m=!1){return super.on(r,n,d===void 0?this:d,_,m)}once(r,n,d,_,m=!1){return super.once(r,n,d===void 0?this:d,_,m)}many(r,n,d,_,m,x=!1){return super.many(r,n,d,_===void 0?this:_,m,x)}waitFor(r,n,d,_=!1){return super.waitFor(r,n===void 0?this:n,d,_)}off(r,n,d){return super.off(r,n,d===void 0?this:d)}__resolve(r){return r instanceof v?r:this.__modules[this.abs_path(r)]}resolve(r){let n=this.__resolve(r);return n instanceof v?(this.__processModule&&(n=this.__processModule(n)),n):null}hasModule(r){return this.__modules[this.abs_path(r)]instanceof v}__get_requires(){return(0,U.has)(this,"requires")?this.requires:(0,U.has)(this.constructor,"requires")?this.constructor.requires:null}__get_load_requires(){return(0,U.has)(this,"load_requires")?this.load_requires:(0,U.has)(this.constructor,"load_requires")?this.constructor.load_requires:null}__processModule(r){if(this.__addon_id&&r.getAddonProxy){const n=this.__addon_id;if(r.__proxies||(r.__proxies={}),r.__proxies[n])return r.__proxies[n];const d=this.__resolve("addons")?.getAddon?.(n),_=r.getAddonProxy(n,d,this.__addon_root??this,this);return _!==r&&(r.__proxies[n]=_),_}return r}inject(r,n,d=!0){(r instanceof v||r&&r.prototype instanceof v)&&(d=n??!0,n=r,r=null);const _=this.requires=this.__get_requires()||[];if(n instanceof v)r||(r=n.constructor.name.toSnakeCase());else if(n&&n.prototype instanceof v)r||(r=n.name.toSnakeCase()),n=this.register(r,n);else if(r){const m=r;if(r=r.replace(/^(?:[^.]*\.)+/,""),n=this.__resolve(m),!n||!(n instanceof v))return n?n[2].push([this.__path,r]):this.__modules[this.abs_path(m)]=[[],[],[[this.__path,r]]],_.push(this.abs_path(m)),this[r]=null}else throw new TypeError("must provide a valid module name or class");if(!n)throw new Error(`cannot find module ${r} or no module provided`);return d&&_.push(n.abs_path(".")),this.enabled&&!n.enabled&&n.enable(),n.references.push([this.__path,r]),n instanceof v&&this.__processModule&&(n=this.__processModule(n)),this[r]=n}injectAs(r,n,d,_=!0){(n instanceof v||n&&n.prototype instanceof v)&&(_=d??!0,d=n,n=null);const m=this.requires=this.__get_requires()||[];if(d instanceof v)n||(n=d.constructor.name.toSnakeCase());else if(d&&d.prototype instanceof v)n||(n=d.name.toSnakeCase()),d=this.register(n,d);else if(n){const x=n;if(n=n.replace(/^(?:[^.]*\.)+/,""),d=this.__resolve(x),!d||!(d instanceof v))return d?d[2].push([this.__path,r]):this.__modules[this.abs_path(x)]=[[],[],[[this.__path,r]]],m.push(this.abs_path(x)),this[r]=null}else throw new TypeError("must provide a valid module name or class");if(!d)throw new Error(`cannot find module ${n} or no module provided`);return _&&m.push(d.abs_path(".")),this.enabled&&!d.enabled&&d.enable(),d.references.push([this.__path,r]),this.__processModule&&(d=this.__processModule(d)),this[r]=d}register(r,n,d=!1){r.prototype instanceof v&&(d=n,n=r,r=n.name.toSnakeCase());const _=this.abs_path(`.${r}`),m=n.prototype,x=this.__modules[_];if(!(m instanceof v))throw new TypeError(`Module ${r} is not subclass of Module.`);if(x instanceof v)throw new q(`Name Collision for Module ${_}`);const T=x||[[],[],[]];let $=this.__modules[_]=new n(r,this);const G=$.requires=$.__get_requires()||[],V=$.load_requires=$.__get_load_requires()||[];$.dependents=T[0],$.load_dependents=T[1],$.references=T[2];for(const Q of G){const ee=$.abs_path(Q),te=this.__modules[ee];te?Array.isArray(te)?te[0].push(_):te.dependents.push(_):this.__modules[ee]=[[_],[],[]]}for(const Q of V){const ee=$.abs_path(Q),te=this.__modules[ee];te?Array.isArray(te)?te[1].push(_):te.load_dependents.push(_):this.__modules[ee]=[[],[_],[]]}for(const[Q,ee]of T[2]){const te=this.__resolve(Q);te&&!Array.isArray(te)?te[ee]=$:this.log.warn(`Unable to find module "${Q}" that wanted "${ee}".`)}return this.__processModule&&($=this.__processModule($)),d&&(this[r]=$),$}async loadFromContext(r,n){n=n??this.log;const d={};for(const _ of r.keys()){const m=await r(_),x=m.module||m.default,T=_.lastIndexOf("."),$=T>2?_.slice(2,T):_,G=$.endsWith("/index")?$.slice(0,-6):$;try{d[G]=this.register(G,x)}catch(V){n&&V instanceof Error&&(n.capture(V,{extra:{module:G,path:_}}),n.warn(V,`Skipping ${_}`))}}return d}},y(v,"_Module2"),v);g.buildAddonProxy=R;let w=g;const k=w;function R(z,r,n,d,_,m){const x={get(T,$,G){let V=d[$];if(V!==void 0)return typeof V=="function"?V.bind(T):V;const Q=_&&_[$];return z?.log&&Q&&z.log.warn(`[DEV-CHECK] Accessed ${n}.${$} directly. ${typeof Q=="string"?Q:""}`),V=T[$],typeof V=="function"?V.bind(T):z&&V instanceof w?z.resolve(V):Reflect.get(T,$,G)}};return m?x:new Proxy(r,x)}y(R,"buildAddonProxy");const X=class X extends Error{};y(X,"ModuleError");let q=X;const Z=class Z extends q{constructor(r,n){super(`${r} (${n.map(d=>d.path).join(" => ")})`),this.modules=n}};y(Z,"CyclicDependencyError");let j=Z},46949:(F,O,P)=>{P.d(O,{TicketLock:()=>z,array_equals:()=>_,debounce:()=>n,deep_copy:()=>ee,deep_equals:()=>m,escape_regex:()=>re,fetchJSON:()=>Ue,generateUUID:()=>H,get:()=>V,glob_to_regex:()=>Be,has:()=>R,isValidShortcut:()=>I,map_equals:()=>T,matchScreen:()=>k,once:()=>d,set_equals:()=>$});var B=P(24431);const U=Object.prototype.hasOwnProperty;function N(u,a,c=!1,p=!0){return`${TWITCH_EMOTE_V2}/${u}/${c?"default":"static"}/${p?"dark":"light"}/${a==4?3:a}.0`}y(N,"getTwitchEmoteURL");function S(u,a=!1,c=!0,p=!1){return p?`${N(u,2,a,c)} 1x, ${N(u,4,a,c)} 2x`:`${N(u,1,a,c)} 1x, ${N(u,2,a,c)} 2x, ${N(u,4,a,c)} 4x`}y(S,"getTwitchEmoteSrcSet");function I(u){return u?(u=u.toLowerCase().trim(),!B.BAD_HOTKEYS.includes(u)):!1}y(I,"isValidShortcut");const H=crypto.randomUUID?()=>crypto.randomUUID():y(function u(a){return a?(a^Math.random()*16>>a/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,u)},"generateUUID2"),ve=class ve extends null{constructor(a,c,p){super(a),this.i18n_key=c,this.data=p}toString(){const a=window.FrankerFaceZ?.get(),c=a?.resolve("i18n");return c&&this.i18n_key?c.t(this.i18n_key,this.message,this.data):this.message}};y(ve,"TranslatableError");let g=ve;async function w(u){const a=new TextEncoder().encode(u),c=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(c)).map(D=>D.toString(16).padStart(2,"0")).join("")}y(w,"sha256");function k(u,a){let c,p=0;for(let A=0;A<u.length;A++){const D=u[A];if(D.label!==a.label)continue;let C=1;a.left&&a.left===D.left&&(C+=15),a.top&&a.top===D.top&&(C+=15),a.width&&a.width===D.width&&(C+=10),a.height&&a.height===D.height&&(C+=10),a.index&&(C-=Math.abs(a.index-A)),C>p&&(c=D,p=C)}return c}y(k,"matchScreen");function R(u,a){return u?U.call(u,a):!1}y(R,"has");function q(u){return new Promise(a=>setTimeout(a,u))}y(q,"sleep");function j(...u){const a={};for(let c=0,p=u.length;c<p;c++){const A=u[c];a[A]=c,a[c]=A}return a}y(j,"make_enum");function v(...u){const a={};a.None=0,a[0]="None";for(let c=0,p=u.length;c<p;c++){const A=u[c],D=Math.pow(2,c);a[A]=D,a[D]=A}return a}y(v,"make_enum_flags");const Ee=class Ee extends null{constructor(a){super(a??"timeout")}};y(Ee,"TimeoutError");let X=Ee;function Z(u,a){return new Promise((c,p)=>{let A=!1;const D=setTimeout(()=>{A||(A=!0,p(new X))},a);u.then(C=>{A||(A=!0,clearTimeout(D),c(C))}).catch(C=>{A||(A=!0,clearTimeout(D),p(C))})})}y(Z,"timeout");const Se=class Se{constructor(a=1){this.limit=a,this.__active=0,this.__waiting=[]}get available(){return this.__active<this.limit}__done(){for(this.__active--;this.__active<this.limit&&this.__waiting.length>0;){this.__active++;const a=this.__waiting.shift();a&&a(this.__getTicket())}}__getTicket(){let a=!0;return()=>{a&&(a=!1,this.__done())}}wait(){return this.__active<this.limit?(this.__active++,Promise.resolve(this.__getTicket())):new Promise(a=>this.__waiting.push(a))}};y(Se,"TicketLock");let z=Se;const r=null;function n(u,a,c=!1){let p;if(c){const A=y(()=>p=null,"later");return c===2?y(function(...C){p?(clearTimeout(p),p=setTimeout(()=>{p=null,u.apply(this,C)},a)):(u.apply(this,C),p=setTimeout(A,a))},"debouncedFunction"):function(...D){p?clearTimeout(p):u.apply(this,D),p=setTimeout(A,a)}}return function(...A){p&&clearTimeout(p),p=setTimeout(u.bind(this,...A),a)}}y(n,"debounce");function d(u){let a;return y(function(...p){if(a)return a;try{a=Promise.resolve(u.call(this,...p))}catch(A){return Promise.reject(A)}return a.finally(()=>a=void 0)},"onceFunction")}y(d,"once");function _(u,a){if(!Array.isArray(u)||!Array.isArray(a)||u.length!==a.length)return!1;let c=u.length;for(;c--;)if(u[c]!==a[c])return!1;return!0}y(_,"array_equals");function m(u,a,c=!1,p,A){if(u===a)return!0;if(typeof u!=typeof a||typeof u!="object"||u===null!=(a===null))return!1;if(p||(p=new Set),A||(A=new Set),p.has(u)||A.has(a))throw new Error("recursive structure detected");p.add(u),A.add(a);const D=Object.keys(u),C=Object.keys(a);if(!c&&!$(new Set(D),new Set(C)))return!1;for(const W of D)if(!m(u[W],a[W],c,new Set(p),new Set(A)))return!1;if(c){for(const W of C)if(!D.includes(W)&&!m(u[W],a[W],c,new Set(p),new Set(A)))return!1}return!0}y(m,"deep_equals");function x(u,a){if(typeof u!="object"||typeof a!="object")return!1;const c=Object.keys(u);if(!$(new Set(c),new Set(Object.keys(a))))return!1;for(const p of c)if(u[p]!==a[p])return!1;return!0}y(x,"shallow_object_equals");function T(u,a){if(!(u instanceof Map)||!(a instanceof Map)||u.size!==a.size)return!1;for(const[c,p]of u)if(!a.has(c)||a.get(c)!==p)return!1;return!0}y(T,"map_equals");function $(u,a){if(!(u instanceof Set)||!(a instanceof Set)||u.size!==a.size)return!1;for(const c of u)if(!a.has(c))return!1;return!0}y($,"set_equals");function G(u,a){let c=0,p=0;for(;p<u.length;){const A=u.indexOf(a,p);if(A===-1)break;c++,p=A+1}return c}y(G,"substr_count");function V(u,a){let c=u;if(typeof c=="string"){if(U.call(a,c))return a[c];c=c.split(".")}for(let p=0,A=c.length;p<A;p++){const D=c[p];if(D==="@each"){const C=c.slice(p+1);if(C.length)if(Array.isArray(a))a=a.map(W=>V(C,W));else{const W={};for(const ie in a)U.call(a,ie)&&(W[ie]=V(C,a[ie]));a=W}break}else D==="@last"?a=a[a.length-1]:a=a[D];if(!a)break}return a}y(V,"get");function Q(u,a=2,c){if(u==null)return u;if(u instanceof Promise||typeof u=="function")return null;if(typeof u!="object")return u;if(a===0)return null;if(c||(c=new Set),c.add(u),Array.isArray(u)){const A=[];for(const D of u)c.has(D)||A.push(Q(D,a-1,new Set(c)));return A}const p={};for(const[A,D]of Object.entries(u))c.has(D)||(p[A]=Q(D,a-1,new Set(c)));return p}y(Q,"shallow_copy");function ee(u,a){if(u===null)return null;if(u===void 0)return;if(u instanceof Promise)return new Promise((p,A)=>u.then(p).catch(A));if(typeof u=="function")return function(...p){return u.apply(this,p)};if(u instanceof RegExp)return new RegExp(u.source,u.flags);if(u instanceof Date)return new Date(u);if(typeof u!="object")return u;if(a||(a=new Set),a.has(u))throw new Error("recursive structure detected");if(a.add(u),Array.isArray(u))return u.map(p=>ee(p,new Set(a)));if(u instanceof Set){const p=new Set;for(const A of u)typeof A=="object"?p.add(ee(A)):p.add(A);return p}if(u instanceof Map){const p=new Map;for(const[A,D]of u.entries()){let C=typeof A=="object"?ee(A):A,W=typeof D=="object"?ee(D):D;p.set(C,W)}return p}const c={};for(const[p,A]of Object.entries(u))typeof A=="object"?c[p]=ee(A,new Set(a)):c[p]=A;return c}y(ee,"deep_copy");function te(u){return u.toLowerCase().replace(/[\.\_\-]+/,"-")}y(te,"normalizeAddonIdForComparison");function $e(u){return u=re(te(u)),u=u.replace(/-+/g,"[._-]+"),u=u.replace(/\bbttv\b/g,"(?:bttv|betterttv)"),u=u.replace(/\b7tv\b/g,"(?:7tv|seventv)"),u=u.replace(/\bpronouns\b/g,"(?:pronouns|addon-pn)"),new RegExp("\\b"+u+"\\b","i")}y($e,"makeAddonIdChecker");function Oe(u,a,...c){return typeof u=="function"?a?u.call(a,...c):u(...c):u}y(Oe,"maybe_call");const ae=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function fe(u){return u===""?[]:u.match(ae)}y(fe,"split_chars");function ye(u){if(!u)return null;if(!Array.isArray(u)){const a=Object.keys(u);return u[ye(a)]}return u[Math.floor(Math.random()*u.length)]}y(ye,"pick_random");const re=y(function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},"escape_regex2");function J(u){return`(^|.*?${WORD_SEPARATORS})(?:${u})(?=$|${WORD_SEPARATORS})`}y(J,"addWordSeparators");const Ce="/$^+.()=!|";function Be(u){if(typeof u!="string")throw new TypeError("input must be a string");let a="",c=0;for(let p=0,A=u.length;p<A;p++){const D=u[p];if(Ce.includes(D))a+=`\\${D}`;else if(D==="\\"){p++;const C=u[p];C&&(Ce.includes(C)?a+=`\\${C}`:a+=C)}else if(D==="?")a+=".";else if(D==="[")a+=D,u[p+1]==="!"&&(p++,a+="^");else if(D==="]")a+=D;else if(D==="{")a+="(?:",c++;else if(D==="}")c>0&&(a+=")",c--);else if(D===","&&c>0)a+="|";else if(D==="*"){let C=1;for(;u[p+1]==="*";)C++,p++;C>1?a+=".*?":a+="[^\\s]*?"}else a+=D}return a}y(Be,"glob_to_regex");function Ze(u,a=100,c=15,p="\u2026",A=!0,D=!0){if(!u||!u.length)return u;D&&(u=u.trim());let C=A?u.indexOf(`
`):-1;if((C===-1||C>a)&&(C=a),u.length<=C)return u;let W=u.slice(0,C).trimEnd();if(c>0&&W.length>=C){let ie=u.slice(C).search(/\s+/);if(ie===-1&&c+C>u.length&&(ie=u.length-C),ie!==-1&&ie<=c){if(u.length<=C+ie)return u;W=u.slice(0,C+ie)}}return W+p}y(Ze,"truncate");function Me(u){return u.toString(16).padStart(2,"0")}y(Me,"decimalToHex");function ze(u=40){const a=new Uint8Array(u/2);return window.crypto.getRandomValues(a),Array.from(a,Me).join("")}y(ze,"generateHex");const Ae=class Ae{constructor(a=!1,c){this._use_set=a,this._cache=a?new Set:[],this._sourceSortFn=c}resortSources(){this._sorted_sources=null,this._sources&&this._sources.size>1&&this._rebuild()}setSortFunction(a){this._sourceSortFn!==a&&(this._sourceSortFn=a,this.resortSources())}_sortSources(){if(!this._sources||this._sources.size===0){this._sorted_sources=[];return}if(this._sources.size===1||!this._sourceSortFn){this._sorted_sources=[...this._sources.values()];return}const a=[...this._sources?.entries()];a.sort((c,p)=>this._sourceSortFn(c[0],p[0])),this._sorted_sources=a.map(c=>c[1])}_rebuild(){if(!this._sources)return;const a=this._use_set,c=this._cache=a?new Set:[];this._sorted_sources||this._sortSources();for(const p of this._sorted_sources)for(const A of p)a?c.add(A):c.includes(A)||c.push(A)}get(a){return this._sources&&this._sources.get(a)}has(a){return this._sources?this._sources.has(a):!1}*iterateSources(){if(this._sources)for(const a of this._sources)yield a}sourceIncludes(a,c){const p=this._sources&&this._sources.get(a);return p&&p.includes(c)}includes(a){return this._use_set?this._cache.has(a):this._cache.includes(a)}delete(a){this._sources&&this._sources.has(a)&&(this._sources.delete(a),this._sorted_sources=null,this._rebuild())}extend(a,...c){this._sources||(this._sources=new Map);const p=this._sources.get(a);if(p)for(const D of c)p.includes(D)||p.push(D);else this._sources.set(a,c),this._sorted_sources=null;if(this._sourceSortFn!=null&&this._sources.size>1)this._rebuild();else{const D=this._use_set,C=this._cache;for(const W of c)D?C.add(W):C.includes(W)||C.push(W)}}set(a,c){if(Array.isArray(c)||(c=[c]),!c.length)return this.delete(a);this._sources||(this._sources=new Map);const p=this._sources.has(a);this._sources.set(a,c),this._sorted_sources=null;const A=this._sourceSortFn!=null&&this._sources.size>1;if(p||A)this._rebuild();else{const D=this._use_set,C=this._cache;for(const W of c)D?C.add(W):C.includes(W)||C.push(W)}}push(a,c){if(!this._sources)return this.set(a,c);const p=this._sources.get(a);if(p?.length){if(p.includes(c))return}else return this.set(a,c);p.push(c),this._sourceSortFn!=null&&this._sources.size>1?this._rebuild():this._use_set?this._cache.add(c):this._cache.includes(c)||this._cache.push(c)}remove(a,c){if(!this._sources||!this._sources.has(a))return;const p=this._sources.get(a),A=p?p.indexOf(c):-1;A!==-1&&(p.splice(A,1),this._rebuild())}};y(Ae,"SourcedSet");let oe=Ae;function qe(u){const a=atob(u),c=a.length,p=new ArrayBuffer(c),A=new Uint8Array(p);for(let D=0,C=a.length;D<C;D++)A[D]=a.charCodeAt(D);return p}y(qe,"b64ToArrayBuffer");const Re=/-----BEGIN (.+?) KEY-----/,Ie=/-----END (.+?) KEY-----/;function Ge(u,a=["verify"]){const c=Re.exec(u),p=Ie.exec(u);if(!c||!p||c[1]!==p[1])throw new Error("invalid key");const A=/\bPRIVATE\b/i.test(c[1]),D=c.index+c[0].length,C=p.index,W=u.slice(D,C).replace(/\n/g,"").trim(),ie=qe(W);return crypto.subtle.importKey(A?"pkcs8":"spki",ie,{name:"RSA-PSS",hash:"SHA-256"},!0,a)}y(Ge,"importRsaKey");function Ue(u,a,c=null){return fetch(u,a).then(p=>p.ok?p.json():null).catch(()=>c)}y(Ue,"fetchJSON")},20857:(F,O,P)=>{P.d(O,{Q:()=>B});function B(S){return U({path:S,i:0})}y(B,"parse");function U(S){const I=S.path,H=I.length,g=[];let w=null,k=null,R=!1,q=!1;for(;S.i<H;){const j=S.i,v=I[j],X=I[j+1];if(w||(w={}),k||(k=""),v==="@"&&X==="{"){S.i++;const n=N(S);n&&Object.assign(w,n);continue}const Z=v==="~"&&X===">",z=v===">"&&X===">";if(!(!z&&v===">")&&!z&&!Z){k+=v,S.i++;continue}(Z||z)&&S.i++,w.title=k.trim(),w.key=w.title.toSnakeCase(),w.page=q,w.tab=R,q=z,R=Z,g.push(w),w=k=null,S.i++}return w&&k&&(w.title=k.trim(),w.key=w.title.toSnakeCase(),w.page=q,w.tab=R,g.push(w)),g}y(U,"parseAST");function N(S){const I=S.path,H=I.length,g=S.i;S.i++;const w=["{"];let k=!1;for(;S.i<H&&w.length;){const R=S.i,q=I[R];if(k){if(q==="\\"){S.i++;continue}(q==='"'||q==="'")&&q===k&&(w.pop(),k=!1)}else{if((q==='"'||q==="'")&&(k=q,w.push(q)),(q==="{"||q==="[")&&w.push(q),q==="]"&&w.pop()!=="[")throw new SyntaxError("Invalid JSON");if(q==="}"&&w.pop()!=="{")throw new SyntaxError("Invalid JSON")}S.i++}return JSON.parse(I.slice(g,S.i))}y(N,"parseJSON")}},De={};function f(F){var O=De[F];if(O!==void 0)return O.exports;var P=De[F]={exports:{}};return ke[F].call(P.exports,P,P.exports,f),P.exports}y(f,"__webpack_require__"),f.m=ke,f.n=F=>{var O=F&&F.__esModule?()=>F.default:()=>F;return f.d(O,{a:O}),O},(()=>{var F=Object.getPrototypeOf?P=>Object.getPrototypeOf(P):P=>P.__proto__,O;f.t=function(P,B){if(B&1&&(P=this(P)),B&8||typeof P=="object"&&P&&(B&4&&P.__esModule||B&16&&typeof P.then=="function"))return P;var U=Object.create(null);f.r(U);var N={};O=O||[null,F({}),F([]),F(F)];for(var S=B&2&&P;typeof S=="object"&&!~O.indexOf(S);S=F(S))Object.getOwnPropertyNames(S).forEach(I=>N[I]=()=>P[I]);return N.default=()=>P,f.d(U,N),U}})(),f.d=(F,O)=>{for(var P in O)f.o(O,P)&&!f.o(F,P)&&Object.defineProperty(F,P,{enumerable:!0,get:O[P]})},f.f={},f.e=F=>Promise.all(Object.keys(f.f).reduce((O,P)=>(f.f[P](F,O),O),[])),f.u=F=>""+({204:"menu-md4",208:"rich_tokens",935:"zip",2009:"markdown",2086:"main-menu",2348:"chat",2597:"site-css-tweaks",3224:"queries",4164:"menu-md1",6530:"regex",7629:"menu-md0",8163:"menu-md5"}[F]||F)+".js",f.h=()=>"76313c69f0d0df3a2768",f.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),f.o=(F,O)=>Object.prototype.hasOwnProperty.call(F,O),(()=>{var F={},O="frankerfacez:";f.l=(P,B,U,N)=>{if(F[P]){F[P].push(B);return}var S,I;if(U!==void 0)for(var H=document.getElementsByTagName("script"),g=0;g<H.length;g++){var w=H[g];if(w.getAttribute("src")==P||w.getAttribute("data-webpack")==O+U){S=w;break}}S||(I=!0,S=document.createElement("script"),S.charset="utf-8",S.timeout=120,f.nc&&S.setAttribute("nonce",f.nc),S.setAttribute("data-webpack",O+U),S.src=P,S.src.indexOf(window.location.origin+"/")!==0&&(S.crossOrigin="anonymous")),F[P]=[B];var k=y((q,j)=>{S.onerror=S.onload=null,clearTimeout(R);var v=F[P];if(delete F[P],S.parentNode&&S.parentNode.removeChild(S),v&&v.forEach(X=>X(j)),q)return q(j)},"onScriptComplete"),R=setTimeout(k.bind(null,void 0,{type:"timeout",target:S}),12e4);S.onerror=k.bind(null,S.onerror),S.onload=k.bind(null,S.onload),I&&document.head.appendChild(S)}})(),f.r=F=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},f.j=4609,(()=>{var F;f.g.importScripts&&(F=f.g.location+"");var O=f.g.document;if(!F&&O&&(O.currentScript&&(F=O.currentScript.src),!F)){var P=O.getElementsByTagName("script");if(P.length)for(var B=P.length-1;B>-1&&!F;)F=P[B--].src}if(!F)throw new Error("Automatic publicPath is not supported in this browser");F=F.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),f.p=F})(),(()=>{var F={4609:0};f.f.j=(B,U)=>{var N=f.o(F,B)?F[B]:void 0;if(N!==0)if(N)U.push(N[2]);else{var S=new Promise((w,k)=>N=F[B]=[w,k]);U.push(N[2]=S);var I=f.p+f.u(B),H=new Error,g=y(w=>{if(f.o(F,B)&&(N=F[B],N!==0&&(F[B]=void 0),N)){var k=w&&(w.type==="load"?"missing":w.type),R=w&&w.target&&w.target.src;H.message="Loading chunk "+B+` failed.
(`+k+": "+R+")",H.name="ChunkLoadError",H.type=k,H.request=R,N[1](H)}},"loadingEnded");f.l(I,g,"chunk-"+B,B)}};var O=y((B,U)=>{var[N,S,I]=U,H,g,w=0;if(N.some(R=>F[R]!==0)){for(H in S)f.o(S,H)&&(f.m[H]=S[H]);if(I)var k=I(f)}for(B&&B(U);w<N.length;w++)g=N[w],f.o(F,g)&&F[g]&&F[g][0](),F[g]=0},"webpackJsonpCallback"),P=globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[];P.forEach(O.bind(null,0)),P.push=O.bind(null,P.push.bind(P))})();var ft={};(()=>{var se,ge,me;var F={};f.r(F),f.d(F,{to_float:()=>ee,to_int:()=>Q});var O={};f.r(O),f.d(O,{process_to_float:()=>Oe,process_to_int:()=>$e});var P={};f.r(P),f.d(P,{AddonDebug:()=>Ue,And:()=>Ce,Category:()=>u,Channel:()=>Ae,Constant:()=>Me,Debug:()=>Ge,Fullscreen:()=>Re,If:()=>Ze,Invert:()=>J,Moderator:()=>Ie,Monitor:()=>c,NativeDarkTheme:()=>Ee,Or:()=>Be,Page:()=>Se,SquadMode:()=>ve,TheaterMode:()=>qe,Time:()=>oe,Title:()=>a});var B={};f.r(B),f.d(B,{Everything:()=>lt,Experiments:()=>it,FavoriteEmotes:()=>nt,HiddenEmotes:()=>rt,Overrides:()=>ot,Profiles:()=>at});const U={1:"debug",2:"info",4:"warn",8:"error"};var N=(o=>(o[o.Verbose=0]="Verbose",o[o.Debug=1]="Debug",o[o.Info=2]="Info",o[o.Warning=4]="Warning",o[o.Error=8]="Error",o[o.Off=99]="Off",o))(N||{});function S(){const o=localStorage.ffzLogLevel;if(!o)return null;const e=o.toUpperCase(),t=H[e];return typeof t=="number"?t:/^\d+$/.test(o)?parseInt(o,10):null}y(S,"readLSLevel");const I=(se=class{constructor(e,t,s,i){this.root=e?e.root:this,this.parent=e,this.name=t,this.root==this&&(this.init=!1,this.captured_init=[],this.label="FFZ"),this.enabled=!0,this.level=s??(e&&e.level)??S()??se.DEFAULT_LEVEL,this.raven=i||e&&e.raven,this.children={}}hi(e,t){const s=t??e.constructor?.version_info;this.info(`FrankerFaceZ v${s} (s:${e.host} f:${e.flavor} b:${s?.build} c:${s?.commit||"null"})`);try{const i=new URL(location.toString());i.search="",this.info(`Initial URL: ${i}`)}catch(i){this.warn("Unable to read location.",i)}}get(e,t){return this.children[e]||(this.children[e]=new se(this,this.name?`${this.name}.${e}`:e,t)),this.children[e]}verbose(e,...t){return this.invoke(0,e,t)}verboseColor(e,t,...s){return this.invokeColor(se.VERBOSE,e,t,s)}debug(e,...t){return this.invoke(se.DEBUG,e,t)}debugColor(e,t,...s){return this.invokeColor(se.DEBUG,e,t,s)}info(e,...t){return this.invoke(se.INFO,e,t)}infoColor(e,t,...s){return this.invokeColor(se.INFO,e,t,s)}warn(e,...t){return this.invoke(se.WARN,e,t)}warnColor(e,t,...s){return this.invokeColor(se.WARN,e,t,s)}warning(e,...t){return this.invoke(se.WARN,e,t)}warningColor(e,t,...s){return this.invokeColor(se.WARN,e,t,s)}error(e,...t){return this.invoke(se.ERROR,e,t)}errorColor(e,t,...s){return this.invokeColor(se.ERROR,e,t,s)}crumb(...e){if(this.raven)return this.raven.captureBreadcrumb(...e)}capture(e,t,...s){if(this.raven&&(t=t||{},t.logger||(t.logger=this.name),this.raven.captureException(e,t)),s.length){const i=s.shift();return this.error(i,...s)}}invokeColor(e,t,s,...i){if(!this.enabled||e<this.level)return;if(Array.isArray(s)||(s=[s]),e>0){let l=t;typeof l=="string"&&(l=l.replace(/%c/g,"")),i.length&&(l=`${l} ${i.join(" ")}`),this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:l,level:U[e]||e}),this.crumb({message:l,category:this.name,level:U[e]||e})}const h=e<2?"color:#999999":"";this.name?(typeof t=="string"?t=`%c${this.root.label} [%c${this.name}%c]:%c ${t}`:(i.unshift(t),t=`%c${this.root.label} [%c${this.name}%c]:%c`),s.unshift("color:#755000; font-weight:bold",h,"color:#755000; font-weight:bold",h)):(typeof t=="string"?t=`%c${this.root.label}:%c ${t}`:(i.unshift(t),t=`%c${this.root.label}:%c`),s.unshift("color:#755000; font-weight:bold",h)),e<2?console.debug(t,...s,...i):e<4?console.info(t,...s,...i):e<8?console.warn(t,...s,...i):e<99&&console.error(t,...s,...i)}invoke(e,t,s){if(!this.enabled||e<this.level||e>=99)return;const i=s?[t,...s]:[t];if(e>0){const b=i.join(" ");this.root.init&&this.root.captured_init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:b,level:U[e]||e}),this.crumb({message:b,category:this.name,level:U[e]||e})}const h=e<2?"color:#999999":"";let l="";if(h!=="")for(;i.length>0&&typeof i[0]=="string";)l+=" "+i.shift();this.name?i.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${l}`,"color:#755000; font-weight:bold",h,"color:#755000; font-weight:bold",h):i.unshift(`%c${this.root.label}:%c${l}`,"color:#755000; font-weight:bold",h),e<2?console.debug(...i):e<4?console.info(...i):e<8?console.warn(...i):e<99&&console.error(...i)}},y(se,"_Logger2"),se);I.Levels=N,I.VERBOSE=0,I.DEBUG=1,I.INFO=2,I.WARN=4,I.WARNING=4,I.ERROR=8,I.OFF=99,I.DEFAULT_LEVEL=2;let H=I;const g=H;var w=f(22527),k=f(24431);function R(o){return o instanceof Blob||o instanceof File||o instanceof ArrayBuffer||o instanceof Uint8Array}y(R,"isValidBlob");async function q(o){if(!o)return null;if(o instanceof Blob)return{type:"blob",mime:o.type,buffer:await o.arrayBuffer()};if(o instanceof File)return{type:"file",mime:o.type,name:o.name,modified:o.lastModified,buffer:await o.arrayBuffer()};if(o instanceof ArrayBuffer)return{type:"ab",buffer:o};if(o instanceof Uint8Array)return{type:"u8",buffer:o.buffer};throw new TypeError("Invalid type")}y(q,"serializeBlob");function j(o){if(!o||!o.type)return null;if(o.type==="blob")return new Blob([o.buffer],{type:o.mime});if(o.type==="file")return new File([o.buffer],o.name,{type:o.mime,lastModified:o.modified});if(o.type==="ab")return o.buffer;if(o.type==="u8")return new Uint8Array(o.buffer);throw new TypeError("Invalid type")}y(j,"deserializeBlob");var v=f(46949),X=f(20857),Z=f(81011),z=f(17159);const r=Symbol("default"),x={basic:{get(o,e){for(const t of e)if(t.has(o))return[t.get(o),[t.id]]}},object_merge:{get(o,e,t,s){const i=[],h=[];for(const l of e)if(l.has(o)){const b=l.get(o);if(!b||typeof b!="object"){s.warn(`Profile #${l.id} has an invalid value for "${o}" of type ${typeof b}. Skipping.`);continue}h.push(l.id),i.unshift(b)}if(h.length)return[Object.assign({},...i),h]}},basic_array_merge:{get(o,e,t,s){const i=[],h=[];for(const l of e)if(l.has(o)){const b=l.get(o);if(!Array.isArray(b)){s.warn(`Profile #${l.id} has an invalid value for "${o}"`);continue}h.push(l.id);for(const E of b)i.push(E)}if(h.length)return[i,h]}},array_merge:{default(o){const e=[];for(const t of o)t.t!=="inherit"&&t.t!=="skip"&&t.v&&e.push(t.v);return e},get(o,e,t,s,i){const h=[],l=[];let b=[],E=!1,M=e;t.inherit_default&&(M=[...e,r]);for(const L of M){let K;if(L===r)K=t.default,typeof K=="function"&&(K=K(i));else if(L.has(o))K=L.get(o);else continue;if(!Array.isArray(K)){L!==r&&s.warn(`Profile #${L.id} has an invalid value for "${o}" of type ${typeof K}. Skipping.`);continue}const ne=[];L!==r&&l.push(L.id);let be=!1;for(const he of K)if(E=!0,he.t==="inherit")be=!0;else{if(he.t==="skip")continue;be?ne.push(he.v):h.push(he.v)}if(b=ne.concat(b),!be&&!t.always_inherit)break}if(E)return[h.concat(b),l]}}};function T(o,e,t){if(!o||!Array.isArray(o.requires))return!1;for(const s of o.requires){const i=t.get(s),h=e.get(s);if(typeof i!=typeof h)return!0;if(Array.isArray(i)&&Array.isArray(h)){if(!(0,v.array_equals)(h,i))return!0}else if(h instanceof Set&&i instanceof Set){if(!(0,v.set_equals)(h,i))return!0}else if(h instanceof Map&&i instanceof Map){if(!(0,v.map_equals)(h,i))return!0}else if(h!==i)return!0}return!1}y(T,"compare_requirements");const Pe=class Pe extends z.EventEmitter{constructor(e,t){super(),this.__context=null,e instanceof Pe?(this.parent=e,this.manager=e.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=e),this.manager.__contexts.push(this),this._context=t||{},this.__ls_listening=!1,this.__ls_wanted=new Map,this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const s of this.__profiles)s.off("changed",this._onChanged,this);const e=this.manager.__contexts,t=e.indexOf(this);t!==-1&&e.splice(t,1)}_watchLS(){this.__ls_listening||(this.__ls_listening=!0,this.manager.on(":ls-update",this._onLSUpdate,this))}_unwatchLS(){this.__ls_listening&&(this.__ls_listening=!1,this.manager.off(":ls-update",this._onLSUpdate,this))}_onLSUpdate(e){const t=this.__ls_wanted.get(`ls.${e}`);if(t)for(const s of t)this._update(s,s,[])}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const e=[],t=this.order=[];if(!this.manager.disable_profiles)for(const i of this.manager.__profiles)i.toggled&&i.matches(this.__context)&&(e.push(i),t.push(i.id));if((0,v.array_equals)(this.__profiles,e))return!1;const s=new Set;for(const i of this.__profiles)e.includes(i)||(i.off("changed",this._onChanged,this),s.add(i.id));for(const i of e)this.__profiles.includes(i)||(i.on("changed",this._onChanged,this),s.add(i.id));return this.__profiles=e,this.emit("profiles_changed"),this.rebuildCache(),!0}rebuildCache(){const e=this.__cache,t=this.__meta,s=this.__meta=new Map;this.__cache=new Map;for(const[i,h]of e){const l=this.get(i),b=s.get(i),E=t.get(i),M=b?b.uses:null,L=E?E.uses:null,K=this.manager.definitions.get(i);let ne=!1;!Array.isArray(K)&&K?.equals?K.equals==="requirements"?ne=T(K,this.__cache,e):typeof K.equals=="function"&&(ne=!K.equals(l,h,this.__cache,e)):Array.isArray(l)&&Array.isArray(h)?ne=!(0,v.array_equals)(l,h):l instanceof Set&&h instanceof Set?ne=!(0,v.set_equals)(l,h):l instanceof Map&&h instanceof Map?ne=!(0,v.map_equals)(l,h):l!==h&&(ne=!0),ne&&(this.emit("changed",i,l,h),this.emit(`changed:${i}`,l,h)),(0,v.array_equals)(M,L)||(this.emit("uses_changed",i,M,L),this.emit(`uses_changed:${i}`,M,L))}}context(e){return new Pe(this,e)}updateContext(e){let t=!1;for(const s in e)if((0,v.has)(e,s)){const i=e[s];try{if((0,v.deep_equals)(i,this._context[s]))continue}catch{}this._context[s]=i,t=!0}t&&this._rebuildContext()}setContext(e){this._context={},this.updateContext(e)}_onChanged(e){this._update(e,e,[])}_update(e,t,s){if(this.__cache.has(e)){if(s.includes(e))throw new Error(`cyclic dependent chain when updating setting "${t}"`)}else return;s.push(e);const i=this.__cache.get(e),h=this.__meta.get(e),l=this._get(e,e,[]),b=this.__meta.get(e),E=h?h.uses:null,M=b?b.uses:null;if((0,v.array_equals)(M,E)||(this.emit("uses_changed",e,M,E),this.emit(`uses_changed:${e}`,M,E)),i===l)return;this.emit("changed",e,l,i),this.emit(`changed:${e}`,l,i);const L=this.manager.definitions.get(e);if(!Array.isArray(L)&&L?.required_by)for(const K of L.required_by)!K.startsWith("context.")&&!K.startsWith("ls.")&&this._update(K,t,Array.from(s))}_get(e,t,s){if(s.includes(e))throw new Error(`cyclic dependency when resolving setting "${t}"`);s.push(e);const i=this.manager.definitions.get(e),h=!Array.isArray(i)&&i?.type,l=h?x[h]:x.basic;if(!l)throw new Error(`non-existent setting type "${h}"`);const b=this._getRaw(e,l),E={uses:b?b[1]:null};let M=b?b[0]:void 0;if(i){if(Array.isArray(i))throw new Error(`non-existent setting "${e}" required when resolving setting "${t}"`);if(E.uses===null){const L=i.default;typeof L=="function"?M=L(this):M=L,l.default&&(M=l.default(M,i,this.manager.log))}if(i.requires)for(const L of i.requires)if(L.startsWith("ls.")){this._watchLS();let K=this.__ls_wanted.get(L);K||this.__ls_wanted.set(L,K=new Set),K.add(e)}else!L.startsWith("context.")&&!this.__cache.has(L)&&this._get(L,t,Array.from(s));i.process&&(M=i.process(this,M,E))}return this.__cache.set(e,M),this.__meta.set(e,E),M}*profiles(){for(const e of this.__profiles)yield e}hasProfile(e){if(typeof e=="number"){for(const t of this.__profiles)if(t.id===e)return!0;return!1}return this.__profiles.includes(e)}_getRaw(e,t){if(!t)throw new Error(`non-existent type for ${e}`);return t.get(e,this.profiles(),this.manager.definitions.get(e),this.manager.log,this)}update(e){this._update(e,e,[])}get(e){return e.startsWith("ls.")?this.manager.getLS(e.slice(3)):e.startsWith("context.")?(0,v.get)(e.slice(8),this.__context):this.__cache.has(e)?this.__cache.get(e):this._get(e,e,[])}getChanges(e,t,s){this.onChange(e,t,s),t.call(s,this.get(e),void 0)}onChange(e,t,s){this.on(`changed:${e}`,t,s)}uses(e){return e.startsWith("ls.")||e.startsWith("context.")?null:(this.__meta.has(e)||this._get(e,e,[]),this.__meta.get(e)?.uses??null)}};y(Pe,"SettingsContext");let $=Pe;const G=Symbol("BAD");function V(o,e,t){if((typeof o!="number"||isNaN(o)||!isFinite(o))&&(o=G),o!==G){const s=t.bounds;Array.isArray(s)&&(s.length>=3?((s[1]?o<s[0]:o<=s[0])||(s[3]?o>s[2]:o>=s[2]))&&(o=G):s.length===2?typeof s[1]=="boolean"?(s[1]?o<s[0]:o<=s[0])&&(o=G):(o<s[0]||o>s[1])&&(o=G):s.length===1&&o<s[0]&&(o=G))}return o===G?e:o}y(V,"do_number");const Q=y((o,e,t)=>(typeof o=="string"&&/^-?\d+$/.test(o)?o=parseInt(o,10):typeof o!="number"&&(o=G),V(o,e,t)),"to_int"),ee=y((o,e,t)=>(typeof o=="string"&&/^-?[\d.]+$/.test(o)?o=parseFloat(o):typeof o!="number"&&(o=G),V(o,e,t)),"to_float");function te(o,e){if(typeof o!="number"||isNaN(o)||!isFinite(o))return!1;const t=e.bounds;if(Array.isArray(t)){if(t.length>=3){if((t[1]?o<t[0]:o<=t[0])||(t[3]?o>t[2]:o>=t[2]))return!1}else if(t.length===2){if(typeof t[1]=="boolean"){if(t[1]?o<t[0]:o<=t[0])return!1}else if(o<t[0]||o>t[1])return!1}else if(t.length===1&&o<t[0])return!1}return!0}y(te,"validators_do_number");const $e=y((o,e)=>{if(typeof o=="string"&&/^-?\d+$/.test(o))o=parseInt(o,10);else if(typeof o!="number")return!1;return te(o,e)},"process_to_int"),Oe=y((o,e)=>{if(typeof o=="string"&&/^-?[\d.]+$/.test(o))o=parseFloat(o);else if(typeof o!="number")return!1;return te(o,e)},"process_to_float");var ae=f(37087);let fe=null;function ye(o){f.e(6530).then(f.t.bind(f,28820,23)).then(e=>{fe=e.default,o&&o()})}y(ye,"loadSafety");const re=y(()=>!1,"NeverMatch"),J={createTest(o,e,t){return(0,ae.createTester)(o,e,!0,!1,t)},maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,9786))},Ce={createTest(o,e,t){return(0,ae.createTester)(o,e,!1,!1,t)},childRules:!0,tall:!0,title:"And",i18n:"settings.filter.and",default:()=>[],editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,9786))},Be={createTest(o,e,t){return(0,ae.createTester)(o,e,!1,!0,t)},childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,9786))},Ze={createTest(o,e,t){const s=(0,ae.createTester)(o[0],e,!1,!1,t),i=(0,ae.createTester)(o[1],e,!1,!1,t),h=(0,ae.createTester)(o[2],e,!1,!1,t);return l=>s(l)?i(l):h(l)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,17907))},Me={createTest(o){return o?()=>!0:re},title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))};function ze(o){if(typeof o!="string"||!o.length)return null;const e=o.indexOf(":");if(e===-1)return null;let t,s;try{t=parseInt(o.slice(0,e),10),s=parseInt(o.slice(e+1),10)}catch{return null}return t*60+s}y(ze,"parseTime");const oe={_captured:new Set,createTest(o){const e=ze(o[0]),t=ze(o[1]);return e==null||t==null?re:e<=t?()=>{oe._captured.add(e),oe._captured.add(t+1);const s=new Date,i=s.getHours()*60+s.getMinutes();return i>=e&&i<=t}:()=>{oe._captured.add(e+1),oe._captured.add(t);const s=new Date,i=s.getHours()*60+s.getMinutes();return i>=e||i<=t}},captured:()=>{const o=Array.from(oe._captured);return oe._captured=new Set,o.sort((e,t)=>e-t),o},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,64e3))},qe={createTest(o){return e=>e.fullscreen?o===!1:e.ui?.theatreModeEnabled===o},title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},Re={createTest(o){return e=>e.fullscreen===o},title:"Fullscreen",i18n:"settings.filter.fullscreen",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},Ie={createTest(o){return e=>e.moderator===o},title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},Ge={createTest(o){return()=>k.DEBUG===o},title:"Is Developer Mode",i18n:"settings.filter.dev",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},Ue={createTest(o){return e=>e.addonDev==o},title:"Is Addon Developer Mode",i18n:"settings.filter.addon-dev",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},ve={createTest(o){return e=>e.ui?.squadModeEnabled===o},title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},Ee={createTest(o){const e=o?1:0;return t=>t.ui?.theme===e},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))},Se={createTest(o){if(!o)return re;const e=o.route,t=[];if(Object.keys(o.values).length){const s=window.FrankerFaceZ?.get(),i=s&&s.resolve("site.router");if(!i)return re;const h=i.getRoute(e);if(!h||!h.parts)return re;let l=1;for(const b of h.parts)if(typeof b=="object"){const E=o.values[b.name];E&&E.length&&t.push([l,E.toLowerCase()]),l++}}return s=>{if(!s.route||!s.route_data||s.route.name!==e)return!1;for(const[i,h]of t){let l=s.route_data[i];if(typeof l=="string"&&(l=l.toLowerCase()),l!==h)return!1}return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,38961))},Ae={createTest(o){const e=o?.login,t=o?.id;if(!t&&!e)return re;if(t){if(!e)return s=>s.channelID===t}else return s=>s.channel===e;return s=>s.channelID===t||s.channelID==null&&s.channel===e},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,69370))},u={createTest(o){const e=o?.name,t=o?.id;if(!t&&!e)return re;if(t){if(!e)return s=>s.categoryID===t}else return s=>s.category===e;return s=>s.categoryID===t||s.categoryID==null&&s.category===e},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,94344))},a={createTest(o,e,t){const s=o?.mode;let i=o?.title,h=!0;if(!i||!s)return re;if(s==="text")i=(0,v.escape_regex)(i),h=!1;else if(s==="glob")i=(0,v.glob_to_regex)(i);else if(s!=="raw")return re;if(h&&(fe||ye(t),!fe||!fe(i)))return re;let l;try{l=new RegExp(i,`g${o.sensitive?"":"i"}`)}catch{return re}return b=>(l.lastIndex=0,b.title?l.test(b.title):!1)},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,43922))};let c=null;window.getScreenDetails&&(c={_used:!1,details:void 0,used:()=>{const o=c._used;return c._used=!1,o},createTest(o,e,t){if(!o?.label)return re;if(c._used=!0,t&&c.details===void 0){const s=window.FrankerFaceZ??window.FFZBridge,i=s?.get(),h=i?.resolve("settings");h&&h.createMonitorUpdate().then(()=>{t()})}return()=>{c._used=!0;const s=c.details;if(!s)return!1;const i=s.screens;return(0,v.matchScreen)(i,o)===s.currentScreen}},default:()=>({label:null}),title:"Current Monitor",i18n:"settings.filter.monitor",editor:()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,57049))});const p=1,A=window.location.host!=="www.twitch.tv",D=window.location.host!=="www.youtube.com",We=class We extends z.EventEmitter{constructor(e){super(),this.ready=!1,this.manager=e,this.disabled=!1}static supported(){return!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get allowTransfer(){return this.constructor.allowTransfer}get shouldUpdate(){return this.constructor.shouldUpdate}};y(We,"SettingsProvider");let C=We;C.priority=0,C.allowTransfer=!0,C.shouldUpdate=!0;const je=class je extends C{get supportsBlobs(){return!0}isValidBlob(e){return this.supportsBlobs&&R(e)}};y(je,"AdvancedSettingsProvider");let W=je;const Ke=class Ke extends W{constructor(e){super(e),this._start_time=performance.now(),this._rpc=new Map,this._cached=new Map,this.resolved_ready=!1,this.ready=!1,this._ready_wait=null,this._blobs=null,this._last_id=0}get supportsBlobs(){return this._blobs??!1}broadcastTransfer(){}disableEvents(){}resolveReady(e,t){this.manager&&this.manager.log.info(`${this.constructor.name} ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.resolved_ready=!0,this.ready=e,e&&this._ready_wait_resolve?this._ready_wait_resolve():!e&&this._ready_wait_fail&&this._ready_wait_fail(t)}awaitReady(){return this.resolved_ready?this.ready?Promise.resolve():Promise.reject():this._ready_wait?this._ready_wait:this._ready_wait=new Promise((e,t)=>{this._ready_wait_resolve=e,this._ready_wait_fail=t}).finally(()=>{this._ready_wait=null,this._ready_wait_resolve=null,this._ready_wait_fail=null})}get(e,t){return this._cached.has(e)?this._cached.get(e):t}set(e,t){if(t===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,t),this.rpc({ffz_type:"set",key:e,value:t}).catch(s=>this.manager.log.error("Error setting value",s)),this.emit("set",e,t,!1)}delete(e){this._cached.delete(e),this.rpc({ffz_type:"delete",key:e}).catch(t=>this.manager.log.error("Error deleting value",t)),this.emit("set",e,void 0,!0)}clear(){const e=this._cached;this._cached=new Map;for(const t of e.keys())this.emit("changed",t,void 0,!0);this.rpc("clear").catch(t=>this.manager.log.error("Error clearing storage",t))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}entries(){return this._cached.entries()}get size(){return this._cached.size}async flush(){await this.rpc("flush")}async getBlob(e){const t=await this.rpc({ffz_type:"get-blob",key:e});return t?j(t):null}async setBlob(e,t){await this.rpc({ffz_type:"set-blob",key:e,value:await q(t)})}async deleteBlob(e){await this.rpc({ffz_type:"delete-blob",key:e})}async hasBlob(e){return this.rpc({ffz_type:"has-blob",key:e})}async clearBlobs(){await this.rpc("clear-blobs")}async blobKeys(){return this.rpc("blob-keys")}rpc(e,t){const s=++this._last_id;return new Promise((i,h)=>{this._rpc.set(s,[i,h]);let l;typeof e=="string"?l={ffz_type:e}:l=e,l.id=s,this.send(l,t)})}handleMessage(e){e.ffz_type==="ready"?this.rpc("init-load").then(t=>{this._blobs=t.blobs;for(const[s,i]of Object.entries(t.values))this._cached.set(s,i);this.resolveReady(!0)}).catch(t=>{this.resolveReady(!1,t)}):e.ffz_type==="change"?this.onChange(e):e.ffz_type==="change-blob"?this.emit("changed-blob",e.key,e.deleted):e.ffz_type==="clear-blobs"?this.emit("clear-blobs"):e.ffz_type==="reply"||e.ffz_type==="reply-error"?this.onReply(e):this.manager.log.warn("Unknown Message",e.ffz_type,e)}onChange(e){const t=e.key,s=e.value;e.deleted?(this._cached.delete(t),this.emit("changed",t,void 0,!0)):(this._cached.set(t,s),this.emit("changed",t,s,!1))}onReply(e){const t=e.id,s=e.ffz_type==="reply",i=this._rpc.get(t);if(!i)return this.manager.log.warn("Received reply for unknown ID",t);this._rpc.delete(t),s?i[0](e.reply):i[1]()}};y(Ke,"RemoteSettingsProvider");let ie=Ke;const He=class He extends C{constructor(e,t){super(e),this.prefix=t=t??"FFZ:setting:";const s=this._cached=new Map,i=t.length;for(const h in localStorage)if((0,v.has)(localStorage,h)&&h.startsWith(t)){const l=localStorage.getItem(h);if(l)try{s.set(h.slice(i),JSON.parse(l))}catch{this.manager.log.warn(`unable to parse value for ${h}`,l)}}this.ready=!0,window.BroadcastChannel?(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)):window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}static supported(){return!0}static hasContent(e){e||(e="FFZ:setting:");for(const t in localStorage)if(t.startsWith(e)&&(0,v.has)(localStorage,t))return!0;return!1}broadcastTransfer(){this.broadcast({type:"change-provider"})}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}destroy(){this.disable(),this._cached.clear()}disable(){this.removeListeners(),this.disabled=!0}flush(){}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager.log.debug("storage broadcast event",e.data);const{type:t,key:s}=e.data;if(t==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(t==="set"){const i=JSON.parse(localStorage.getItem(this.prefix+s)??"null");this._cached.set(s,i),this.emit("changed",s,i,!1)}else if(t==="delete")this._cached.delete(s),this.emit("changed",s,void 0,!0);else if(t==="clear"){const i=Array.from(this._cached.keys());this._cached.clear();for(const h of i)this.emit("changed",h,void 0,!0)}}handleStorage(e){if(!this.disabled&&(this.manager.log.debug("storage event",e),e.storageArea===localStorage&&e.key&&e.key.startsWith(this.prefix))){const t=e.key.slice(this.prefix.length);let s=e.newValue;s===null?(this._cached.delete(t),this.emit("changed",t,void 0,!0)):(s=JSON.parse(s),this._cached.set(t,s),this.emit("changed",t,s,!1))}}get(e,t){return this._cached.has(e)?this._cached.get(e):t}set(e,t){if(!this.disabled){if(t===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,t);try{localStorage.setItem(this.prefix+e,JSON.stringify(t))}catch(s){throw this.manager&&this.manager.log.error(`An error occurred while trying to save a value to localStorage for key "${this.prefix+e}"`),s&&/quota/i.test(s.toString())&&this.emit("quota-exceeded",s),s}this.broadcast({type:"set",key:e}),this.emit("set",e,t,!1)}}delete(e){this.disabled||(this._cached.delete(e),localStorage.removeItem(this.prefix+e),this.broadcast({type:"delete",key:e}),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const t of e.keys())localStorage.removeItem(this.prefix+t),this.emit("changed",t,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}};y(He,"LocalStorageProvider");let ue=He;ue.priority=-1e3,ue.title="Local Storage",ue.description="[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.";const Ve=class Ve extends W{constructor(e,t=!0){super(e),this._last_tx=0,this.getDB=(0,v.once)(this.getDB),this._start_time=performance.now(),this._pending=new Set,this._flush_wait=null,this._lock=new v.TicketLock,this._cached=new Map,this.ready=!1,this._ready_wait=null,t&&(window.BroadcastChannel&&(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this)),this._ready_wait=this.loadSettings().then(()=>{this.manager&&this.manager.log.info(`IDB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.ready=!0}).catch(s=>{this.manager&&this.manager.log.error(`IDB failed after ${(performance.now()-this._start_time).toFixed(5)}ms:`,s),this.ready=!1}).finally(()=>{this._ready_wait=null}))}static supported(){return window.indexedDB!=null}static hasContent(){return new Promise(e=>{const t=window.indexedDB.open("FFZ",p);t.onerror=()=>e(!1),t.onupgradeneeded=s=>{s.target instanceof IDBRequest&&s.target.transaction?.abort(),e(!1)},t.onsuccess=()=>{const s=t.result;let i;try{i=s.transaction(["settings"],"readonly").objectStore("settings")}catch{return e(!1)}const h=i.getAllKeys();h.onerror=()=>{s.close(),e(!1)},h.onsuccess=()=>{const l=Array.isArray(h.result)&&h.result.length>0;return s.close(),e(l)}}})}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this.removeListeners(),this.db&&(this.db.close(),this.db=null)}removeListeners(){this._broadcaster&&(this._boundHandleMessage&&this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null)}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this.removeListeners(),this.broadcast=()=>{},this.emit=()=>{}}_onStart(e){this._pending||(this._pending=new Set),this._pending.add(e)}_onFinish(e){this._pending&&(this._pending.delete(e),this._pending.size)||this._flush_wait_resolve&&this._flush_wait_resolve()}flush(){return this._flush_wait?this._flush_wait:!this._pending||!this._pending.size?Promise.resolve():this._flush_wait=new Promise(e=>{this._flush_wait_resolve=e}).finally(()=>{this._flush_wait_resolve=null,this._flush_wait=null})}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager&&this.manager.log.debug("storage broadcast event",e.data);const{type:t,key:s}=e.data;if(t==="change-provider")this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if(t==="set")this._get(s).then(i=>{this._cached.set(s,i),this.emit("changed",s,i,!1)}).catch(i=>this.manager&&this.manager.log.error(`Error getting setting "${s}" from database`,i));else if(t==="delete")this._cached.delete(s),this.emit("changed",s,void 0,!0);else if(t==="clear"){const i=Array.from(this._cached.keys());this._cached.clear();for(const h of i)this.emit("changed",h,void 0,!0)}else t==="set-blob"?this.emit("changed-blob",s,!1):t==="delete-blob"?this.emit("changed-blob",s,!0):t==="clear-blobs"&&this.emit("clear-blobs")}awaitReady(){return this._ready_wait?this._ready_wait:this.ready?Promise.resolve():Promise.reject()}get(e,t){return this._cached.has(e)?this._cached.get(e):t}set(e,t){if(!this.disabled){if(t===void 0){this.has(e)&&this.delete(e);return}this._cached.set(e,t),this._set(e,t).then(()=>this.broadcast({type:"set",key:e})).catch(s=>this.manager&&this.manager.log.error(`Error saving setting "${e}" to database`,s)),this.emit("set",e,t,!1)}}delete(e){this.disabled||(this._cached.delete(e),this._delete(e).catch(t=>this.manager&&this.manager.log.error(`Error deleting setting "${e}" from database`,t)).then(()=>this.broadcast({type:"delete",key:e})),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const t of e.keys())this.emit("changed",t,void 0,!0);this._clear().catch(t=>this.manager&&this.manager.log.error("Error clearing database",t)).then(()=>this.broadcast({type:"clear"}))}entries(){return this._cached.entries()}get size(){return this._cached.size}getDB(e=!1){if(this.db)return Promise.resolve(this.db);if(this._db_wait)return this._db_wait;let t;return this._db_wait=t=new Promise((s,i)=>{const h=window.indexedDB.open("FFZ",p);this._onStart(h),h.onerror=l=>{this.manager&&this.manager.log.error("Error opening database.",l),i(l),this._onFinish(h)},h.onupgradeneeded=l=>{this.manager&&this.manager.log.info(`Upgrading database from version ${l.oldVersion} to ${p}`);const b=h.result;b.createObjectStore("settings",{keyPath:"k"}),b.createObjectStore("blobs")},h.onsuccess=()=>{this.manager&&this.manager.log.info(`Database opened. (After: ${(performance.now()-this._start_time).toFixed(5)}ms)`),this.db=h.result;try{const l=this.db.transaction(["settings","blobs"],"readonly");l.objectStore("settings"),l.objectStore("blobs")}catch(l){this.manager&&this.manager.log.error("Database in invalid state.",l);try{this.db.close()}catch{}if(this._onFinish(h),this.db=null,e)i(l);else{const b=window.indexedDB.deleteDatabase("FFZ");this._onStart(b),b.onerror=E=>{this.manager&&this.manager.log.error("Error deleting invalid database.",E),i(E),this._onFinish(b)},b.onsuccess=()=>{this.manager&&this.manager.log.info("Deleted invalid database."),this._onFinish(b),this._db_wait=null,this.getDB(!0).then(s).catch(i)}}return}s(this.db),this._onFinish(h)}}).finally(()=>{t===this._db_wait&&(this._db_wait=null)})}async loadSettings(){const e=await this.getDB(),t=e.transaction(["settings"],"readonly"),s=t.objectStore("settings"),i=this._last_tx++;return this._onStart(i),new Promise((h,l)=>{t.onabort=E=>{this.manager&&this.manager.log.error("Transaction aborted reading settings from database.",E),this._onFinish(i),l()};const b=s.getAll();b.onsuccess=()=>{for(const E of b.result)this._cached.set(E.k,E.v);this._onFinish(i),h()},b.onerror=E=>{this.manager&&this.manager.log.error("Error reading settings from database.",E),this._onFinish(i),l()}})}async _getKeys(){const e=await this.getDB(),t=e.transaction(["settings"],"readonly"),s=t.objectStore("settings"),i=this._last_tx++;return this._onStart(i),new Promise((h,l)=>{t.onabort=E=>{this.manager&&this.manager.log.error("Transaction aborted reading keys from database.",E),this._onFinish(i),l()};const b=s.getAllKeys();b.onsuccess=()=>{this._onFinish(i),h(b.result)},b.onerror=E=>{this.manager&&this.manager.log.error("Error reading keys from database.",E),this._onFinish(i),l()}})}async _get(e){const t=await this.getDB(),s=t.transaction(["settings"],"readonly"),i=s.objectStore("settings"),h=this._last_tx++;return this._onStart(h),new Promise((l,b)=>{s.onabort=M=>{this.manager&&this.manager.log.error("Transaction aborted reading value from database.",M),this._onFinish(h),b()};const E=i.get(e);E.onerror=M=>{this.manager&&this.manager.log.error("Error reading value from database.",M),this._onFinish(h),b()},E.onsuccess=()=>{this._onFinish(h),l(E.result.v)}})}async _set(e,t){if(this.disabled)return;const s=this._last_tx++;this._onStart(s);const i=await this._lock.wait(),h=await this.getDB(),l=h.transaction(["settings"],"readwrite"),b=l.objectStore("settings");return new Promise((E,M)=>{l.onabort=K=>{this.manager&&this.manager.log.error("Transaction aborted setting value to database.",K),i(),this._onFinish(s),M()};const L=b.put({k:e,v:t});L.onerror=K=>{this.manager&&this.manager.log.error("Error setting value to database.",K),i(),this._onFinish(s),M()},L.onsuccess=()=>{i(),this._onFinish(s),E()}})}async _delete(e){if(this.disabled)return;const t=this._last_tx++;this._onStart(t);const s=await this._lock.wait(),i=await this.getDB(),h=i.transaction(["settings"],"readwrite"),l=h.objectStore("settings");return new Promise((b,E)=>{h.onabort=L=>{this.manager&&this.manager.log.error("Transaction aborted deleting value from database.",L),s(),this._onFinish(t),E()};const M=l.delete(e);M.onerror=L=>{this.manager&&this.manager.log.error("Error deleting value from database.",L),s(),this._onFinish(t),E()},M.onsuccess=()=>{s(),this._onFinish(t),b()}})}async _clear(){if(this.disabled)return;const e=this._last_tx++;this._onStart(e);const t=await this._lock.wait(),s=await this.getDB(),i=s.transaction(["settings"],"readwrite"),h=i.objectStore("settings");return new Promise((l,b)=>{i.onabort=M=>{this.manager&&this.manager.log.error("Transaction aborted clearing database.",M),t(),this._onFinish(e),b()};const E=h.clear();E.onerror=M=>{this.manager&&this.manager.log.error("Error clearing database.",M),t(),this._onFinish(e),b()},E.onsuccess=()=>{t(),this._onFinish(e),l()}})}async getBlob(e){const t=await this.getDB(),s=t.transaction(["blobs"],"readonly"),i=s.objectStore("blobs");return new Promise((h,l)=>{const b=i.get(e);this._onStart(b),b.onerror=()=>{l(),this._onFinish(b)},b.onsuccess=E=>{R(b.result)?h(b.result):l(),this._onFinish(b)}})}async setBlob(e,t){if(this.disabled)return;if(!this.isValidBlob(t))throw new Error("Invalid blob type");const s=await this.getDB(),i=s.transaction(["blobs"],"readwrite"),h=i.objectStore("blobs");return new Promise((l,b)=>{const E=h.put(t,e);this._onStart(E),E.onerror=()=>{b(),this._onFinish(E)},E.onsuccess=()=>{l(),this.broadcast({type:"set-blob",key:e}),this.emit("set-blob",e,t,!1),this._onFinish(E)}})}async deleteBlob(e){if(this.disabled)return;const t=await this.getDB(),s=t.transaction(["blobs"],"readwrite"),i=s.objectStore("blobs");return new Promise((h,l)=>{const b=i.delete(e);this._onStart(b),b.onerror=()=>{l(),this._onFinish(b)},b.onsuccess=()=>{h(),this.broadcast({type:"delete-blob",key:e}),this.emit("set-blob",e,void 0,!0),this._onFinish(b)}})}async hasBlob(e){return(await this.blobKeys()).includes(e)}async clearBlobs(){if(this.disabled)return;const e=await this.getDB(),t=e.transaction(["blobs"],"readwrite"),s=t.objectStore("blobs");return new Promise((i,h)=>{const l=s.clear();this._onStart(l),l.onerror=()=>{h(),this._onFinish(l)},l.onsuccess=()=>{i(),this.broadcast({type:"clear-blobs"}),this._onFinish(l)}})}async blobKeys(){const e=await this.getDB(),t=e.transaction(["blobs"],"readonly"),s=t.objectStore("blobs");return new Promise((i,h)=>{const l=s.getAllKeys();this._onStart(l),l.onerror=()=>{h(),this._onFinish(l)},l.onsuccess=()=>{Array.isArray(l.result)?i(l.result):h(),this._onFinish(l)}})}};y(Ve,"IndexedDBProvider");let ce=Ve;ce.priority=10,ce.title="IndexedDB",ce.description="[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.";const de=(ge=class extends ie{constructor(e){super(e);const t=this.frame=document.createElement("iframe");t.src=this.manager.root.host==="youtube"?"//www.youtube.com/__ffz_bridge/":"//www.twitch.tv/p/ffz_bridge/",t.id="ffz-settings-bridge",t.style.width="0",t.style.height="0",this.onMessage=this.onMessage.bind(this),window.addEventListener("message",this.onMessage),document.body.appendChild(t)}static supported(){return A&&D}static hasContent(){return ge.supported()}broadcastTransfer(){}disableEvents(){}onMessage(e){const t=e.data;!t||!t.ffz_type||this.handleMessage(t)}send(e,t){typeof e=="string"&&(e={ffz_type:e});try{this.frame.contentWindow.postMessage(e,"*",t?Array.isArray(t)?t:[t]:void 0)}catch(s){this.manager.log.error("Error sending message to bridge.",s,e,t)}}},y(ge,"_CrossOriginStorageBridge2"),ge);de.priority=100,de.title="Cross-Origin Storage Bridge",de.description="This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don't want your settings to automatically synchronize for some reason.",de.allowTransfer=!1,de.shouldUpdate=!1;let tt=de;const xe=(me=class extends ie{static supported(){return k.EXTENSION}static hasContent(){return me.supported()?new Promise(e=>{let t=!1,s=null;const i=y(l=>{if(l.source===window&&l.data&&l.data.type==="ffz_from_ext"){const b=l.data.data;b?.ffz_type==="has-keys"&&(t=!0,e(b.value),h())}},"listener"),h=y(()=>{t||(t=!0,e(!1)),s&&(clearTimeout(s),s=null),window.removeEventListener("message",i)},"cleanup");window.addEventListener("message",i),window.postMessage({type:"ffz_to_ext",data:{ffz_type:"check-has-keys"}},"*"),s=setTimeout(h,1e3)}):!1}constructor(e){super(e),this.onExtMessage=this.onExtMessage.bind(this),window.addEventListener("message",this.onExtMessage)}broadcastTransfer(){}disableEvents(){}onExtMessage(e){e.source===window&&e.data?.type==="ffz_from_ext"&&e.data.data?.ffz_type&&this.handleMessage(e.data.data)}send(e,t){typeof e=="string"&&(e={ffz_type:e});try{window.postMessage({type:"ffz_to_ext",data:e},"*",t?Array.isArray(t)?t:[t]:void 0)}catch(s){this.manager.log.error("Error sending message to extension.",s,e,t)}}},y(me,"_ExtensionProvider2"),me);xe.priority=101,xe.title="Browser Extension Storage",xe.description="This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.",xe.allowTransfer=!0,xe.shouldUpdate=!0;let ct=null;const st={local:ue,idb:ce,cosb:tt},it={label:"Experiment Overrides",keys:["exp-lock","experiment-overrides"]},rt={label:"Hidden Emotes",keys(o){const e=["emote-menu.hidden-sets"];for(const t of o.keys())t.startsWith("hidden-emotes.")&&e.push(t);return e}},nt={label:"Favorited Emotes",keys(o){const e=[];for(const t of o.keys())t.startsWith("favorite-emotes.")&&e.push(t);return e}},ot={label:"Name and Color Overrides",keys:["overrides.colors","overrides.names"]},at={label:"Profiles",clear(o,e){const t=["profiles"];for(const s of o.keys())/^p:\d+:/.test(s)&&t.push(s);for(const s of t)o.delete(s);e.loadProfiles()}},lt={label:"Absolutely Everything",async clear(o,e){o.clear(),o.supportsBlobs&&o instanceof W&&await o.clearBlobs(),e.loadProfiles()}};function Le(o,e){try{return o.postMessage(e,"*"),!0}catch{return!1}}y(Le,"postMessage");const ht=["session"],Je=class Je extends w.default{constructor(e,t){super(e,t),this.provider=null,this._active_provider="local",this.disable_profiles=!1,this.providers={};for(const[s,i]of Object.entries(st))i.supported()&&(this.providers[s]=i);Object.seal(this.providers),this.updateSoon=(0,v.debounce)(()=>this.updateRoutes(),50,!1);try{const s=new URL(window.location).searchParams;s&&s.has("ffz-no-settings")&&(this.disable_profiles=!0)}catch{}this.__ls_scheduled=new Set,this.__ls_cache=new Map,this.__ls_hooked=!1,this._updateLS=this._updateLS.bind(this),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.__profile_uuids={},this.ui_structures=new Map,this.definitions=new Map,this.validators={};for(const s in O)(0,v.has)(O,s)&&(this.validators[s]=O[s]);this.processors={};for(const s in F)(0,v.has)(F,s)&&(this.processors[s]=F[s]);this.clearables={};for(const s in B)(0,v.has)(B,s)&&(this.clearables[s]=B[s]);this.filters={};for(const s in P)(0,v.has)(P,s)&&P[s]&&(this.filters[s]=P[s]);this._createProvider().then(s=>{this.provider=s,this.log.info(`Using Provider: ${s.constructor.name}`),s.on("changed",this._onProviderChange,this),s.on("quota-exceeded",i=>{this.emit(":quota-exceeded")}),s.on("change-provider",()=>{this.emit(":change-provider")}),this._provider_resolve&&this._provider_resolve(s)}),this.main_context=new $(this),this.main_context.on("changed",(s,i,h)=>{this.emit(`:changed:${s}`,i,h)}),this.main_context.on("uses_changed",(s,i,h)=>{this.emit(`:uses_changed:${s}`,i,h)}),this.main_context.on("context_changed",()=>this._updateContextProxies()),this._context_proxies=new Set,window.addEventListener("message",s=>{const i=s.data?.ffz_type;i==="open-settings"?this.emit("main_menu:open"):i==="request-context"&&s.source&&(this._context_proxies.add(s.source),this._updateContextProxies(s.source))}),window.addEventListener("beforeunload",()=>{for(const s of this._context_proxies)Le(s,{ffz_type:"context-gone"})}),this._start_time=performance.now(),this.enable()}_updateContextProxies(e){if(!e&&!this._context_proxies.size)return;const t=JSON.parse(JSON.stringify(this.main_context._context));for(const s of ht)(0,v.has)(t,s)&&delete t[s];if(e)Le(e,{ffz_type:"context-update",ctx:t});else for(const s of this._context_proxies)Le(s,{ffz_type:"context-update",ctx:t})}addFilter(e,t){if(this.filters[e])return this.log.warn("Tried to add already existing filter",e);this.filters[e]=t,this.updateRoutes()}getFilterBasicEditor(){return()=>Promise.all([f.e(6530),f.e(6940),f.e(2086)]).then(f.bind(f,47178))}generateLog(){const e=[];for(const[t,s]of this.main_context.__cache.entries())e.push(`${t}: ${JSON.stringify(s)}`);return e.join(`
`)}awaitProvider(){return this.provider?Promise.resolve(this.provider):this._provider_waiter?this._provider_waiter:this._provider_waiter=new Promise((e,t)=>{this._provider_resolve=e}).finally(()=>{this._provider_waiter=null,this._provider_resolve=null})}async onEnable(){if(await this.awaitProvider(),!this.provider)throw new Error("did not get provider");await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const t of this.__contexts)t.selectProfiles();const e=performance.now()-this._start_time;this.log.info(`Initialization complete after ${e.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}async createMonitorUpdate(){const e=P?.Monitor;if(!(!e||e.details!==void 0)){e.details=null;try{window.getScreenDetails?(e.details=await window.getScreenDetails(),e.details.addEventListener("currentscreenchange",()=>{for(const t of this.__contexts)t.selectProfiles()})):e.details=!1}catch(t){this.log.error("Unable to get monitor details",t),e.details=!1}}}updateClock(){const e=P?.Time?.captured?.();if(!e?.length)return;this._time_timer&&clearTimeout(this._time_timer);const t=new Date,s=t.getHours()*60+t.getMinutes();let i=this._time_next!=null?this._time_next:null;for(const l of e)l<=s||(i==null||l<i)&&(i=l);i==null&&(i=e[0]+1440);const h=(i-s)*60*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout(()=>{for(const l of this.__contexts)l.selectProfiles();this.updateClock()},h)}_updateLSKey(e){(this.__ls_cache.has(e)||this.__ls_cache.has(`raw.${e}`))&&(this.__ls_scheduled.add(e),this.__ls_timer||(this.__ls_timer=setTimeout(this._updateLS,0)))}_hookLS(){if(this.__ls_hooked)return;this.__ls_hooked=!0;const e=localStorage.setItem,t=this;localStorage.setItem=function(s,...i){try{t._updateLSKey(s)}catch{}return e.call(this,s,...i)},this._handleLSEvent=this._handleLSEvent.bind(this),window.addEventListener("storage",this._handleLSEvent)}_handleLSEvent(e){e.key&&e.storageArea===localStorage&&this._updateLSKey(e.key)}_updateLS(){clearTimeout(this.__ls_timer),this.__ls_timer=null;const e=this.__ls_scheduled;this.__ls_scheduled=new Set;for(const t of e){const s=this.__ls_cache.has(t),i=`raw.${t}`,h=this.__ls_cache.has(i);if(!h&&!s)continue;const l=localStorage.getItem(t);if(h&&(this.__ls_cache.set(i,l),this.emit(":ls-update",i,l)),s){let b;if(l)try{b=JSON.parse(l)}catch(E){this.log.warn(`Unable to parse localStorage value as JSON for "${t}"`,E)}this.__ls_cache.set(t,b),this.emit(":ls-update",t,b)}}}getLS(e){if(this.__ls_cache.has(e))return this.__ls_cache.get(e);this.__ls_hooked||this._hookLS();const t=e.startsWith("raw."),s=localStorage.getItem(t?e.slice(4):e);let i;if(t)i=s;else try{i=s?JSON.parse(s):null}catch(h){this.log.warn(`Unable to parse localStorage value as JSON for "${e}"`,h)}return this.__ls_cache.set(e,i),i}async generateBackupFile(){const e=new Date,t=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;if(await this._needsZipBackup()){const i=await this._getZipBackup();return new File([i],`ffz-settings (${t}).zip`,{type:"application/zip"})}const s=await this.getSettingsDump();return new File([JSON.stringify(s)],`ffz-settings (${t}).json`,{type:"application/json;charset=utf-8"})}async _needsZipBackup(){if(await this.awaitProvider(),!this.provider||(await this.provider.awaitReady(),!(this.provider instanceof W)||!this.provider.supportsBlobs))return!1;const e=await this.provider.blobKeys();return Array.isArray(e)?e.length>0:!1}async _getZipBackup(){if(await this.awaitProvider(),!this.provider)throw new Error("provider not available");await this.provider.awaitReady();const e=(await f.e(935).then(f.t.bind(f,29597,23))).default,t=new e,s=await this.getSettingsDump();t.file("settings.json",JSON.stringify(s));const i={};if(this.provider instanceof W&&this.provider.supportsBlobs){const h=await this.provider.blobKeys();for(const l of h){const b=encodeURIComponent(l),E=await this.provider.getBlob(l);if(!E)continue;const M={key:l};if(E instanceof File)M.type="file",M.name=E.name,M.modified=E.lastModified,M.mime=E.type;else if(E instanceof Blob)M.type="blob";else if(E instanceof ArrayBuffer)M.type="ab";else if(E instanceof Uint8Array)M.type="ui8";else continue;i[b]=M,t.file(`blobs/${b}`,E)}}return t.file("blobs.json",JSON.stringify(i)),t.generateAsync({type:"blob"})}async getSettingsDump(){if(await this.awaitProvider(),!this.provider)return null;await this.provider.awaitReady();const e={version:2,type:"full",values:{}};for(const[t,s]of this.provider.entries())e.values[t]=s;return e}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout(()=>this.checkUpdates(),5e3)}async checkUpdates(){if(await this.awaitProvider(),await this.provider?.awaitReady(),!this.provider?.shouldUpdate)return;const e=[];for(const i of this.__profiles){if(!i||!i.url||i.pause_updates)continue;const h=i.checkUpdate();e.push(h instanceof Promise?h:Promise.resolve(h))}const t=await Promise.all(e);let s=0;for(const i of t)i&&s++;this.log.info(`Successfully refreshed ${s} of ${t.length} profiles from remote URLs.`)}getProviders(){return this.providers}getActiveProvider(){return this._active_provider}async _createProvider(){let e=localStorage.ffzProviderv2;if(e==null&&(e=localStorage.ffzProviderv2=await this.sniffProvider()),this.providers[e]){const t=new this.providers[e](this);return this._active_provider=e,t}return this._active_provider="local",new ue(this)}async sniffProvider(){const e=Array.from(Object.entries(this.providers));e.sort((t,s)=>(s[1].priority??0)-(t[1].priority??0));for(const[t,s]of e)if(s.supported()&&await s.hasContent())return t;return"local"}async changeProvider(e,t){if(!this.providers[e]||!this.providers[e].supported())throw new Error(`Invalid provider: ${e}`);if(e===this._active_provider||!this.provider)return;const s=this.provider;if(this.provider=null,s.broadcastTransfer(),t){const i=new this.providers[e](this);if(await i.awaitReady(),i.allowTransfer&&s.allowTransfer){s.disableEvents(),i.clear(),i instanceof W&&i.supportsBlobs&&await i.clearBlobs(),await i.flush();for(const[h,l]of s.entries())i.set(h,l);if(s instanceof W&&s.supportsBlobs&&i instanceof W&&i.supportsBlobs){for(const h of await s.blobKeys()){const l=await s.getBlob(h);l&&await i.setBlob(h,l)}await s.clearBlobs()}s.clear(),await s.flush(),await i.flush()}}localStorage.ffzProviderv2=e,location.reload()}_onProviderChange(e,t,s){if(e==="profiles")return this.loadProfiles();if(!e.startsWith("p:"))return;e=e.slice(2);const i=e.indexOf(":");if(i===-1)return;const h=this.__profile_ids[e.slice(0,i)],l=e.slice(i+1);h&&!h.ephemeral&&(l===":enabled"?h.emit("toggled",h,s?!0:t):h.emit("changed",l,t,s))}updateRoutes(){for(const e of this.__profiles)e.clearMatcher();for(const e of this.__contexts)e.selectProfiles();this.updateClock()}_onProfileToggled(e,t){for(const s of this.__contexts)s.selectProfiles();this.updateClock(),this.emit(":profile-toggled",e,t)}profile(e){return this.__profile_uuids[e]??this.__profile_ids[e]??null}loadProfiles(e=!1){const t=this.__profile_ids,s=this.__profile_uuids,i=this.__profiles,h=this.__profile_ids={},l=this.__profiles=[],b=this.__profile_uuids={},E=new Set(i.map(Y=>Y.id)),M=new Set,L=new Set;let K=this.provider?.get("profiles")??[Z.Z.Moderation,Z.Z.Default];K?.length||(this.provider?.delete("profiles"),K=[Z.Z.Moderation,Z.Z.Default]);let ne=!1;for(const Y of K)Y.uuid||(ne=!0,Y.i18n_key===Z.Z.Default.i18n_key?Y.uuid=Z.Z.Default.uuid:Y.i18n_key===Z.Z.Moderation.i18n_key?Y.uuid=Z.Z.Moderation.uuid:Y.uuid=(0,v.generateUUID)());ne&&this.provider?.set("profiles",K);let be=!1,he=!1;for(const Y of i)Y.off("toggled",this._onProfileToggled,this),Y.hotkey_enabled=!1;for(const Y of K){const we=Y.id,Xe=l.length,le=t[we],Qe=le?i.indexOf(le):-1;if(E.delete(we),Qe!==Xe&&(be=!0),le&&(0,v.deep_equals)(le.data,Y,!0)){Qe!==Xe&&(he=!0),l.push(h[we]=le),b[le.uuid]=le;continue}const Te=h[we]=new Z.Z(this,Y);le?(le.transferListeners(Te),L.add(we)):M.add(we),l.push(Te),b[Te.uuid]=Te,he=!0}for(const Y of l)Y.on("toggled",this._onProfileToggled,this),Y.hotkey_enabled=!0;if(!(!he&&!E.size||e)){for(const Y of this.__contexts)Y.selectProfiles();this.updateClock();for(const Y of M)this.emit(":profile-created",h[Y]);for(const Y of L)this.emit(":profile-changed",h[Y]);be&&this.emit(":profiles-reordered")}}createProfile(e={}){if(!this.enabled)throw new Error("Unable to create profile before settings have initialized. Please await enable()");if(e.id!==void 0)throw new Error("You cannot specify an ID when creating a profile.");let t=0;for(;this.__profile_ids[t];)e.ephemeral?t--:t++;e.id=t,e.uuid=(0,v.generateUUID)(),e.name||(e.name=`Unnamed Profile ${this.__profiles.length+1}`);const s=this.__profile_ids[t]=new Z.Z(this,e);return this.__profile_uuids[e.uuid]=s,this.__profiles.unshift(s),s.on("toggled",this._onProfileToggled,this),s.hotkey_enabled=!0,s.ephemeral||this._saveProfiles(),this.emit(":profile-created",s),s}deleteProfile(e){if(!this.enabled)throw new Error("Unable to delete profile before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const t=this.__profile_ids[e];if(!t)return;if(this.__profiles.length===1)throw new Error("cannot delete only profile");t.off("toggled",this._onProfileToggled,this),t.clear(),this.__profile_ids[e]=null,this.__profile_uuids[t.uuid]=null;const s=this.__profiles.indexOf(t);s!==-1&&this.__profiles.splice(s,1),t.ephemeral||this._saveProfiles(),this.emit(":profile-deleted",t)}moveProfile(e,t){if(!this.enabled)throw new Error("Unable to move profiles before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const s=this.__profile_ids[e];if(!s)return;const i=this.__profiles,h=i.indexOf(s);h!==t&&(i.splice(t,0,...i.splice(h,1)),s.ephemeral||this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(e){if(!this.enabled)throw new Error("Unable to save profile before settings have initialized. Please await enable()");if(typeof e=="object"&&typeof e.id=="number")e=e.id;else if(typeof e!="number")throw new Error("Invalid profile");const t=this.__profile_ids[e];t&&(t.ephemeral||this._saveProfiles(),this.emit(":profile-changed",t))}_saveProfiles(){const e=this.__profiles.filter(t=>!t.ephemeral).map(t=>t.data);if(!e){this.createProfile({name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."});return}this.provider?.set("profiles",e);for(const t of this.__contexts)t.selectProfiles();this.updateClock()}context(e){return this.main_context.context(e)}get(e){return this.main_context.get(e)}getChanges(e,t,s){return this.main_context.getChanges(e,t,s)}onChange(e,t,s){return this.main_context.onChange(e,t,s)}uses(e){return this.main_context.uses(e)}update(e){return this.main_context.update(e)}updateContext(e){return this.main_context.updateContext(e)}setContext(e){return this.main_context.setContext(e)}getAddonProxy(e,t,s){if(!e)return this;const i={},h=k.DEBUG||t?.dev;return i.add=(l,b)=>this.add(l,b,e),i.addUI=(l,b)=>this.addUI(l,b,e),i.addClearable=(l,b)=>this.addClearable(l,b,e),(0,w.buildAddonProxy)(s,this,"settings",i)}add(e,t,s){const i=this.definitions.get(e),h=(Array.isArray(i)?i:i?.required_by)??[];t.required_by=h,t.requires=t.requires??[],t.__source=s;for(const l of t.requires){const b=this.definitions.get(l);Array.isArray(b)?b.push(e):b?b.required_by?.push(e):this.definitions.set(l,[e])}if(t.ui){const l=t.ui;if(l.path_tokens=l.path_tokens?Ye(l.path_tokens):l.path?(0,X.Q)(l.path):void 0,s&&l.path_tokens&&l.path_tokens.length>=2&&l.path_tokens[0].key==="add_ons"){const b=this.resolve("addons"),E=b?.getAddon(s);if(E){const M=l.path_tokens[1],L=[];L.push(`add_ons.changelog.${s}`),E.short_name&&L.push(`add_ons.changelog.${E.short_name.toSnakeCase()}`),E.name&&L.push(`add_ons.changelog.${E.name.toSnakeCase()}`),M.header_links=[{navigate:L,i18n_key:"home.changelog",title:"Changelog"}]}}if(!l.key&&e&&(l.key=e),!l.key&&l.title&&(l.key=l.title.toSnakeCase()),(l.component==="setting-select-box"||l.component==="setting-combo-box")&&Array.isArray(l.data)&&!l.no_i18n){const b=`${l.i18n_key||`setting.entry.${e}`}.values`;for(const E of l.data)E.i18n_key===void 0&&E.value!==void 0&&(E.i18n_key=`${b}.${E.value}`)}}t.changed&&this.on(`:changed:${e}`,t.changed),this.definitions.set(e,t),(!i||Array.isArray(i))&&this.emit(":added-definition",e,t)}remove(e){const t=this.definitions.get(e);if(t&&!Array.isArray(t)){if(Array.isArray(t.required_by)&&t.required_by.length>0?this.definitions.set(e,t.required_by):this.definitions.delete(e),Array.isArray(t.requires))for(const s of t.requires){let i=this.definitions.get(s);if(Array.isArray(i)){const h=i.indexOf(e);h!==-1&&i.splice(h,1)}else i?.required_by&&(i=i.required_by)}t.changed&&this.off(`:changed:${e}`,t.changed),this.emit(":removed-definition",e,t)}}addUI(e,t,s){let i;t.ui?i=t:i={ui:t},i.__source=s;const h=i.ui;h.path_tokens=h.path_tokens?Ye(h.path_tokens):h.path?(0,X.Q)(h.path):void 0,!h.key&&h.title&&(h.key=h.title.toSnakeCase());const l=this.ui_structures.get(e);this.ui_structures.set(e,i),l||this.emit(":added-definition",e,i)}addClearable(e,t,s){if(typeof e=="object"){for(const[i,h]of Object.entries(e))this.addClearable(i,h,s);return}else if(typeof e!="string")throw new Error("invalid key");t&&(t.__source=s,this.clearables[e]=t)}getClearables(){return(0,v.deep_copy)(this.clearables)}addProcessor(e,t){if(typeof e=="object"){for(const[s,i]of Object.entries(e))this.addProcessor(s,i);return}else if(typeof e!="string")throw new Error("invalid key");t&&(this.processors[e]=t)}getProcessor(e){return this.processors[e]??null}getProcessors(){return(0,v.deep_copy)(this.processors)}addValidator(e,t){if(typeof e=="object"){for(const[s,i]of Object.entries(e))this.addValidator(s,i);return}else if(typeof e!="string")throw new Error("invalid key");t&&(this.validators[e]=t)}getValidator(e){return this.validators[e]??null}getValidators(){return(0,v.deep_copy)(this.validators)}};y(Je,"SettingsManager");let Ne=Je;function Ye(o){for(let e=0,t=o.length;e<t;e++){const s=o[e];if(typeof s=="string"){o[e]={key:s.toSnakeCase(),title:s};continue}s.key||(s.key=s.title.toSnakeCase())}return o}y(Ye,"format_path_tokens");const Fe=class Fe extends w.default{constructor(){super();const e=performance.now();Fe.instance=this,this.host="null",this.flavor="bridge",this.name="ffz_bridge",this.__state=0,this.__modules.core=this,this.log=new g(null,null,null),this.log.label="FFZBridge",this.log.init=!0,this.core_log=this.log.get("core"),this.log.hi(this),this.inject("settings",Ne),this.enable().then(()=>{const t=performance.now()-e;this.core_log.info(`Initialization complete in ${t.toFixed(5)}ms.`),this.log.init=!1}).catch(t=>{this.core_log.error("An error occurred during initialization.",t),this.log.init=!1})}static get(){return Fe.instance}async onEnable(){window.addEventListener("message",this.onMessage.bind(this)),this.settings.provider.on("changed",this.onProviderChange,this),this.settings.provider.on("changed-blob",this.onProviderBlobChange,this),this.settings.provider.on("clear-blobs",this.onProviderClearBlobs,this),await this.settings.awaitProvider(),await this.settings.provider.awaitReady(),this.send({ffz_type:"ready"})}async onMessage(e){const t=e.data;if(!t||!t.ffz_type)return;if(t.ffz_type==="load"){const h={};for(const[l,b]of this.settings.provider.entries())h[l]=b;this.send({ffz_type:"loaded",data:h});return}else if(t.ffz_type==="change"){this.onChange(t);return}if(!t.id)return this.log.warn("Received command with no reply ID");let s,i;try{if(t.ffz_type==="init-load"){s={blobs:this.settings.provider.supportsBlobs,values:{}};for(const[h,l]of this.settings.provider.entries())s.values[h]=l}else if(t.ffz_type==="set")this.settings.provider.set(t.key,t.value);else if(t.ffz_type==="delete")this.settings.provider.delete(t.key);else if(t.ffz_type==="clear")this.settings.provider.clear();else if(t.ffz_type==="get-blob")s=await q(await this.settings.provider.getBlob(t.key)),s&&(i=s.buffer);else if(t.ffz_type==="set-blob"){const h=j(t.value);await this.settings.provider.setBlob(t.key,h)}else if(t.ffz_type==="delete-blob")await this.settings.provider.deleteBlob(t.key);else if(t.ffz_type==="has-blob")s=await this.settings.provider.hasBlob(t.key);else if(t.ffz_type==="clear-blobs")await this.settings.provider.clearBlobs();else if(t.ffz_type==="blob-keys")s=await this.settings.provider.blobKeys();else if(t.ffz_type==="flush")await this.settings.provider.flush();else return this.send({ffz_type:"reply-error",id:t.id,error:"bad-command"});this.send({ffz_type:"reply",id:t.id,reply:s},i)}catch(h){this.log.error("Error handling command.",h),this.send({ffz_type:"reply-error",id:t.id})}}send(e,t){try{window.parent.postMessage(e,"*",t?[t]:void 0)}catch(s){this.log.error("send error",s)}}onChange(e){const t=e.key,s=e.value;e.deleted?this.settings.provider.delete(t):this.settings.provider.set(t,s)}onProviderChange(e,t,s){this.send({ffz_type:"change",key:e,value:t,deleted:s})}onProviderBlobChange(e,t){this.send({ffz_type:"change-blob",key:e,deleted:t})}onProviderClearBlobs(){this.send({ffz_type:"clear-blobs"})}};y(Fe,"FFZBridge");let _e=Fe;_e.Logger=g;const pe=_e.version_info=Object.freeze({major:4,minor:77,revision:4,extra:et?.length&&et[0],commit:"b250075813ef4902b5a303fc7290d6429703feef",build:"0",hash:f.h(),toString:()=>`${pe.major}.${pe.minor}.${pe.revision}${pe.build?`.${pe.build}`:""}${pe.extra||""}${k.DEBUG?"-dev":""}`});window.FFZBridge=_e,window.ffz_bridge=new _e})()})();})();

//# sourceMappingURL=bridge.js.map