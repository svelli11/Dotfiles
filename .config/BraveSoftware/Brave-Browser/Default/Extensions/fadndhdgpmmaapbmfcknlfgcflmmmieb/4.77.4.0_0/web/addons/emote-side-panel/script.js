(()=>{var x=Object.defineProperty;var f=(o,u)=>x(o,"name",{value:u,configurable:!0});(()=>{"use strict";var o={};o.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),(()=>{var n;o.g.importScripts&&(n=o.g.location+"");var t=o.g.document;if(!n&&t&&(t.currentScript&&(n=t.currentScript.src),!n)){var s=t.getElementsByTagName("script");if(s.length)for(var e=s.length-1;e>-1&&!n;)n=s[e--].src}if(!n)throw new Error("Automatic publicPath is not supported in this browser");n=n.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=n+"../"})();var u={};const _=o.p+"emote-side-panel/styles.css",{createElement:d}=FrankerFaceZ.utilities.dom,c=class c extends FrankerFaceZ.utilities.addon.Addon{getContainer(){return document.querySelector(".chat-list--default,.chat-list--other")}getPanel(){const t=document.querySelector("#emote_side_panel");if(t)return t;const s=d("div",{id:"emote_side_panel",class:"ffz--esp"}),e=this.getContainer();return e.style.setProperty("position","relative"),e.append(s),this.settings.get("emote_side_panel.override_width")&&(s.style.width=this.settings.get("emote_side_panel.width_in_px")+"px"),s}updatePadding(){const t=(this.emotes.length>0,50);this.getContainer().querySelector(".simplebar-content").style.setProperty("padding-right",t+"px")}updateCount(t){const s=t.instances.length,e=t.element.querySelector("span");e&&(e.textContent=s<=1?"":`x${s}`)}updateElement(t){const s=this.getPanel(),e=t.element;s.lastChild!==e&&(s.removeChild(e),s.appendChild(e),e.classList.add("animate"),this.setRemoveAnimation(e)),this.updateCount(t)}updatePanel(){this.updateTimer=null;const t=new Date().getTime()-this.timeout*1e3,s=this.getPanel();for(let e=this.emotes.length-1;e>=0;e--){const i=this.emotes[e];i.instances=i.instances.filter(l=>l.time>t),i.instances.length==0?(s.removeChild(i.element),this.emotes.splice(e,1)):this.updateCount(i)}this.sortEmotes(),this.updatePadding(),this.setUpdatePanel()}sortEmotes(){const t=this.getPanel();if(this.settings.get("emote_side_panel.sort_by_count")&&this.emotes.length>1){const s=this.settings.get("emote_side_panel.sort_order");if(s==="ascending"?this.emotes.sort((e,i)=>e.instances.length-i.instances.length):s==="descending"&&this.emotes.sort((e,i)=>i.instances.length-e.instances.length),s!=="none"){for(;t.firstChild;)t.removeChild(t.firstChild);for(let e of this.emotes)t.appendChild(e.element)}}}setUpdatePanel(){this.updateTimer||(this.updateTimer=window.setTimeout(()=>this.updatePanel(),350))}createEmoteElement(t){return d("div",{class:"animate"},d("span",{class:"mult"}),this.chat.renderTokens([t]))}clearEmotes(){this.emotes=[],this.getPanel().innerHTML=""}setRemoveAnimation(t){window.setTimeout(()=>t.classList.remove("animate"),200)}handleMessage(t,s,e){if(e.esp_handled)return s;e.esp_handled=!0;let i=!1,l=!0;for(const a of s)if(!(a.type==="emote"||a.type==="text"&&/^(\s|[^\x20-\x7E])+$/g.test(a.text))){l=!1;break}const y=t.context.get("emote_side_panel.capture_all");if(!l&&!y)return s;const v=t.context.get("emote_side_panel.keep_messages");l&&!v&&(e.ffz_removed=!0);for(const a of s)if(a.type==="emote"){this.log.debug(a);const p={user:e.user,time:e.timestamp},g=a.text,m=this.emotes.find(r=>r.text==g);if(m)m.instances.push(p),this.updateElement(m);else{const r=this.createEmoteElement(a,1);this.getPanel().appendChild(r),this.setRemoveAnimation(r),this.emotes.push({text:g,element:r,firstTime:p.timestamp,instances:[p]})}}return this.updatePadding(),this.sortEmotes(),this.setUpdatePanel(),s}constructor(...t){super(...t),this.inject("chat"),this.injectAs("site_chat","site.chat"),this.settings.add("emote_side_panel.capture_all",{default:!1,ui:{path:"Add-Ons > Emote Side Panel",title:"Capture all",description:"Capture emotes from all messages, even those that are not emote only",component:"setting-check-box"}}),this.settings.add("emote_side_panel.sort_order",{default:"none",ui:{path:"Add-Ons > Emote Side Panel",title:"Sort Order",description:"Sort emotes by count",component:"setting-select-box",data:[{value:"none",title:"None"},{value:"ascending",title:"Ascending"},{value:"descending",title:"Descending"}]}}),this.settings.add("emote_side_panel.keep_messages",{default:!1,ui:{path:"Add-Ons > Emote Side Panel",title:"Keep messages",description:"Capture emotes but do not remove emote only messages",component:"setting-check-box"}}),this.settings.add("emote_side_panel.timeout",{default:15,ui:{path:"Add-Ons > Emote Side Panel",title:"Timeout",description:"Time in seconds that the emote is visible on the side panel",component:"setting-text-box"},changed:e=>this.timeout=parseInt(e)==0?30:parseInt(e)}),this.settings.add("emote_side_panel.override_width",{default:!1,ui:{path:"Add-Ons > Emote Side Panel",title:"Override Panel Width",description:"Enable to set a custom width for the emote panel",component:"setting-check-box"}}),this.settings.add("emote_side_panel.width_in_px",{default:32,ui:{path:"Add-Ons > Emote Side Panel",title:"Panel Width in Pixels",description:"Set the width of the emote panel in pixels",component:"setting-text-box"}}),this.emotes=[],this.updateTimer=null,this.style_link=null,this.timeout=parseInt(this.settings.get("emote_side_panel.timeout"));const s=this;this.messageFilter={type:"emote_side_panel",priority:9,process(e,i){return s.handleMessage(this,e,i)}}}onEnable(){this.on("site.router:route",this.clearEmotes,this),this.chat.addTokenizer(this.messageFilter),this.emit("chat:update-lines"),this.style_link||document.head.appendChild(this.style_link=d("link",{href:_,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}))}onDisable(){this.off("site.router:route",this.clearEmotes,this),this.chat.removeTokenizer(this.messageFilter),this.emit("chat:update-lines")}};f(c,"EmoteSidePanel");let h=c;h.register("emote-side-panel",null,"1.1.1")})();})();

//# sourceMappingURL=script.js.map