"use strict";(()=>{var O=Object.defineProperty;var E=(U,M)=>O(U,"name",{value:M,configurable:!0});(globalThis.ffzWebpackJsonp=globalThis.ffzWebpackJsonp||[]).push([[2682],{29632:(U,M,n)=>{n.r(M),n.d(M,{ApolloEvent:()=>f,GQLError:()=>i,default:()=>o});var P=n(22527),m=n(46949),v=n(5286),r=n(17159);const s=class s extends r.FFZEvent{constructor(t){super(t),this._changed=!1}markChanged(){return this._changed=!0,this}};E(s,"ApolloEvent");let f=s;const a=class a extends Error{constructor(t){super(`${t.message}; Location: ${t.locations}`)}};E(a,"GQLError");let i=a;const d=class d extends P.default{constructor(...t){super(...t),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){if(this._gql_print)return this._gql_print;const t=this.resolve("site.web_munch");return this._gql_print=t?.getModule?.("gql-printer")}onEnable(){let t=this.client;if(!t){const g=this.fine.react;if(t=(g&&g.stateNode)?.props?.client,g&&!t){let S=0,w=g;for(;!t?.queryManager&&w&&S++<20;)t=w?.memoizedProps?.client,w=w?.child;if(!t){const p=this.fine.searchTree(null,A=>A.props?.client?.queryManager,500);p&&(t=p.props.client)}}this.client=t}if(!t)return new Promise(()=>this.onEnable(),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link){this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");return}this.hooked_query_init=!1;const e=this,l=this.client.queryManager.constructor.prototype,u=l.getCurrentQueryResult;if(l.getCurrentQueryResult=function(g,y=!0){const S=u.call(this,g,y);if(S&&S.partial)try{try{const w=g.getLastResult(),p=g.options;this.dataStore.getCache().read({query:p.query,variables:p.variables,previousResult:w?w.data:void 0,optimistic:y})}catch(w){if(w.toString().includes("Can't find field")&&g.lastResult&&!g.lastResult.loading&&!g.lastError&&Date.now()-(g._ffz_last_retry||0)>=12e4){const p=(0,m.get)("options.query.definitions.0.name",g),A=p&&p.kind==="Name"?p.value:`#${g.queryId}`;e.log.info("Forcing query to refetch due to missing field:",A),g._ffz_last_retry=Date.now(),g.refetch()}}}catch(w){e.log.capture(w)}return S},this.client.queryManager.queryStore){const g=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(y){const S=this.store[y.queryId];return S&&S.queryString!==y.queryString&&(S.queryString=y.queryString),g.call(this,y)}}const c=this.ApolloLink=this.client.link.constructor;this.link=new c((g,y)=>{if(!this.enabled)return y(g);let S=g.variables;Object.keys(S).length||(S=void 0);try{this.hooked_query_init&&this.apolloPreFlight(g)}catch(w){return this.log.capture(w,{tags:{operation:g.operationName},extra:{variables:S}}),this.log.error("Error running Pre-Flight",w,g),y(g)}return y(g).map(w=>{w.extensions&&w.extensions.operationName===g.operationName&&this.log.crumb({level:"info",category:"gql",message:`${g.operationName} [${w.extensions&&w.extensions.durationMilliseconds||"??"}ms]`,data:{variables:S}});try{this.apolloPostFlight(w)}catch(p){this.log.capture(p,{tags:{operation:g.operationName},extra:{variables:S}}),this.log.error("Error running Post-Flight",p,w)}return w})}),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=c.from([this.link,this.old_link]),this.client.queryManager.link=c.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(t){const e=t.operationName,l=this.modifiers[e],u=`:request.${e}`,c=this.hasListeners(u);if(!l&&!c)return;const g=this.client.queryManager,y=g&&g.queryIdsByName,S=g&&g.queries,w=y&&y[e],p=Array.isArray(w)?w[0]:w,A=S&&S.get(p);if(l)for(const C of l)typeof C=="function"?C(t):C[1]&&this.applyModifier(t,C[1]);let L=!!l;if(c){const C=new f({operation:e,request:t});this.emit(u,C),C._changed&&(L=!0)}if(L){const C=this.client.queryManager.queryStore.store[p],D=this.gqlPrint&&this.gqlPrint(t.query);C&&(D?(C.queryString=D,t.query.loc.source.body=D,t.query.loc.end=D.length,A&&(A.document=t.query,A.observableQuery&&A.observableQuery.options&&(A.observableQuery.options.query=t.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",e),this.client.queryManager.queryStore.store[p]=null))}}apolloPostFlight(t){if(!t.extensions)return;const e=t.extensions.operationName,l=this.post_modifiers[e];if(l)for(const u of l)u(t);this.emit(`:response.${e}`,t.data)}applyModifier(t,e){t.query=(0,v.default)(t.query,e)}registerModifier(t,e,l=!0){if(typeof e!="function"){if(!l)throw new Error("post modifiers must be functions");e=[e,e]}(l?this.modifiers[t]=this.modifiers[t]||[]:this.post_modifiers[t]=this.post_modifiers[t]||[]).push(e)}unregisterModifier(t,e,l=!0){const u=l?this.modifiers[t]:this.post_modifiers[t];if(u){if(typeof e!="function")throw new Error("graphql modifiers cannot be removed");for(let c=0;c<u.length;c++){const g=u[c];if(typeof g=="function"?g===e:g[0]===e){u.splice(c,1);return}}}}getQuery(t){const e=this.client.queryManager?.queries;if(e)for(const l of e.values()){const u=l?.observableQuery;if(u?.queryName===t)return u}}maybeRefetch(t){const e=this.getQuery(t);!e||!e.lastResult||e.lastResult.stale||e.refetch()}ensureQuery(t,e,l=500,u=12e4){const c=this.getQuery(t);if(c){const g=c.lastResult;let y;g?g.loading?y=!0:typeof e=="function"?y=e(g):y=(0,m.get)(e,g)!==void 0:y=!1,!y&&Date.now()-(c._ffz_last_retry||0)>=u&&(c._ffz_last_retry=Date.now(),c.options.query=Object.assign({},c.options.query),l===0?c.refetch():l>0&&setTimeout(()=>{c.refetch()},l))}return c}getFromQuery(t,e,l=500,u=12e4){const c=this.getQuery(t),g=c&&c.lastResult;if(!c)return;let y;if(!(g&&(typeof e=="function"?y=e(g):y=(0,m.get)(e,g),g.loading)))return y===void 0&&Date.now()-(c._ffz_last_retry||0)>=u&&(c._ffz_last_retry=Date.now(),c.options.query=Object.assign({},c.options.query),l===0?c.refetch():l>0&&setTimeout(()=>c.refetch(),l)),y}};E(d,"Apollo");let o=d},5286:(U,M,n)=>{n.d(M,{default:()=>v});const P={Document:(r,f)=>(r.definitions&&f.definitions?r.definitions=m(r.definitions,f.definitions):f.definitions&&(r.definitions=f.definitions),r),Field:(r,f)=>(r.name&&(!f.name||f.name.value!==r.name.value)||(r.selectionSet&&f.selectionSet?r.selectionSet=v(r.selectionSet,f.selectionSet):f.selectionSet&&(r.selectionSet=f.selectionSet)),r),OperationDefinition:(r,f)=>(r.operation!==f.operation||(r.selectionSet&&f.selectionSet?r.selectionSet=v(r.selectionSet,f.selectionSet):f.selectionSet&&(r.selectionSet=f.selectionSet)),r),FragmentDefinition:(r,f)=>(r.typeCondition&&f.typeCondition&&(r.typeCondition.kind!==f.typeCondition.kind||r.typeCondition.name.value!=f.typeCondition.name.value)||(r.selectionSet&&f.selectionSet?r.selectionSet=v(r.selectionSet,f.selectionSet):f.selectionSet&&(r.selectionSet=f.selectionSet)),r),SelectionSet:(r,f)=>(r.selections&&f.selections?r.selections=m(r.selections,f.selections):f.selections&&(r.selections=f.selections),r)};function m(r,f){let i=!1;const o={};for(const s of r)!s||!s.name||s.name.kind!=="Name"||(s.operation&&(i=!0),o[s.name.value]=s);for(const s of f){if(!s||!s.name||s.name.kind!=="Name")continue;const a=s.name.value,d=o[a]?r.indexOf(o[a]):-1;if(d!==-1){if(r[d].operation&&s.operation&&r[d].operation!==s.operation)continue;r[d]=v(r[d],s),r[d].operation&&(i=!0)}else{if(i&&s.operation)continue;r.push(s)}}return r}E(m,"mergeList");function v(r,f){return r.kind!==f.kind?r:P[r.kind]?P[r.kind](r,f):r}E(v,"merge")},27040:(U,M,n)=>{n.r(M),n.d(M,{default:()=>v});var P=n(22527),m=n(46949);const r=class r extends P.default{constructor(i,o){super(i,o),this.apollo=null,this.site=null,this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this._waiting_flag_ids=new Map,this._waiting_flag_logins=new Map,this._loadStreams=(0,m.debounce)(this._loadStreams,50),this._loadStreamFlags=(0,m.debounce)(this._loadStreamFlags,50),this._loadUsers=(0,m.debounce)(this._loadUsers,50)}queryApollo(i,o,s){let a;return!o&&!s&&"query"in i&&i.query?a=i:(a={query:i,variables:o},s&&(a=Object.assign(a,s))),this.apollo.client.query(a)}mutate(i,o,s){let a;return!o&&!s&&"mutation"in i&&i.mutation?a=i:(a={mutation:i,variables:o},s&&(a=Object.assign(a,s))),this.apollo.client.mutate(a)}get languageCode(){const i=this.site.getSession();return i&&i.languageCode||"en"}get locale(){const i=this.site.getSession();return i&&i.locale||"en-US"}async getBadges(){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,68905,23))))?.data?.badges}async getMatchingCategories(i,o=15,s=null){const a=await this.queryApollo(await n.e(3224).then(n.t.bind(n,29817,23)),{query:i,first:o,cursor:s}),d=(0,m.get)("data.searchCategories.edges.@each.node",a)??[],h=i.toLowerCase();return Array.isArray(d)&&d.sort((t,e)=>{const l=t&&(t.name?.toLowerCase?.()===h||t?.displayName?.toLowerCase?.()===h),u=t&&(e.name?.toLowerCase?.()===h||e?.displayName?.toLowerCase?.()===h);return l&&!u?-1:!l&&u?1:0}),{cursor:(0,m.get)("data.searchCategories.edges.@last.cursor",a),items:d,finished:!(0,m.get)("data.searchCategories.pageInfo.hasNextPage",a),count:(0,m.get)("data.searchCategories.totalCount",a)||0}}async getCategory(i,o){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,95373,23)),{id:i,name:o}))?.data?.game}async deleteChatMessage(i,o){i=String(i);const s=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,4223,23)),variables:{input:{channelID:i,messageID:o}}}),a=s?.data?.deleteChatMessage?.responseCode;if(a==="TARGET_IS_BROADCASTER")throw new m.TranslatableError("You cannot delete the broadcaster's messages.","chat.delete.forbidden.broadcaster");if(a==="TARGET_IS_MODERATOR")throw new m.TranslatableError("You cannot delete messages from moderator {displayName}.","chat.delete.forbidden.moderator",(0,m.get)("data.deleteChatMessage.message.sender",s));if(a!=="SUCCESS")throw new m.TranslatableError("You don't have permission to delete messages.","chat.delete.forbidden");return!0}async getMatchingUsers(i,o=15,s=null){const a=await this.queryApollo(await n.e(3224).then(n.t.bind(n,4176,23)),{query:i,first:o,cursor:s}),d=(0,m.get)("data.searchUsers.edges.@each.node",a)??[],h=i.toLowerCase();return Array.isArray(d)&&d.sort((t,e)=>{const l=t&&(t.login?.toLowerCase?.()===h||t?.displayName?.toLowerCase?.()===h),u=t&&(e.login?.toLowerCase?.()===h||e?.displayName?.toLowerCase?.()===h);return l&&!u?-1:!l&&u?1:0}),{cursor:(0,m.get)("data.searchUsers.edges.@last.cursor",a),items:d,finished:!(0,m.get)("data.searchUsers.pageInfo.hasNextPage",a),count:(0,m.get)("data.searchUsers.totalCount",a)||0}}async getUser(i,o){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,2247,23)),{id:i,login:o}))?.data?.user}async getUserGame(i,o){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,34489,23)),{id:i,login:o}))?.data?.user?.broadcastSettings?.game}async getUserSelf(i,o){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,23333,23)),{id:i,login:o}))?.data?.user?.self}async getUserFollowed(i,o){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,70470,23)),{id:i,login:o}))?.data?.user?.self?.follower}async followUser(i,o=!1){i=String(i),o=!!o;const s=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,33886,23)),variables:{input:{targetID:i,disableNotifications:o}}});console.log("follow result",s);const a=s?.data?.followUser?.error;if(a?.code)throw new Error(a.code);return s?.data?.followUser?.follow}async unfollowUser(i){i=String(i);const o=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,65199,23)),variables:{input:{targetID:i}}});return console.log("unfollow result",o),o?.data?.unfollowUser?.follow}async getLastBroadcast(i,o){return(await this.queryApollo(await n.e(3224).then(n.t.bind(n,82042,23)),{id:i,login:o,type:"ARCHIVE",sort:"TIME",limit:1}))?.data?.user?.videos?.edges?.[0]?.node}getUserBasic(i,o){let s,a,d;if(i)s=this._waiting_user_ids,d=String(i);else if(o)s=this._waiting_user_logins,d=o;else return Promise.reject("id and login cannot both be null");let h=s.get(d);if(h)return h[0];let t,e;return a=new Promise((l,u)=>{t=l,e=u}),s.set(d,[a,t,e]),this._loading_users||this._loadUsers(),a}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const i=[...this._waiting_user_ids.keys()].slice(0,50),o=50-i.length,s=o>0?[...this._waiting_user_logins.keys()].slice(0,o):[];let a;try{a=(await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,59649,23)),variables:{ids:i.length?i:null,logins:s.length?s:null}}))?.data?.users??[]}catch(t){for(const e of i){const l=this._waiting_user_ids.get(e);this._waiting_user_ids.delete(e),l&&l[2](t)}for(const e of s){const l=this._waiting_user_logins.get(e);this._waiting_user_logins.delete(e),l&&l[2](t)}return}const d=new Set(i),h=new Set(s);if(Array.isArray(a))for(const t of a){if(!t||!t.id)continue;d.delete(t.id),h.delete(t.login);let e=this._waiting_user_ids.get(t.id);e&&(this._waiting_user_ids.delete(t.id),e[1](t)),e=this._waiting_user_logins.get(t.login),e&&(this._waiting_user_logins.delete(t.login),e[1](t))}for(const t of d){const e=this._waiting_user_ids.get(t);e&&(this._waiting_user_ids.delete(t),e[1](null))}for(const t of h){const e=this._waiting_user_logins.get(t);e&&(this._waiting_user_logins.delete(t),e[1](null))}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(i,o){return(await this.getLastBroadcast(i,o))?.id}async getChannelColor(i,o){return(await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,30252,23)),variables:{id:i,login:o}}))?.data?.user?.primaryColorHex}async getPoll(i){const o=await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,89218,23)),variables:{id:i}});return(0,m.get)("data.poll",o)}async createPoll(i,o,s,a={}){if(typeof o!="string")throw new TypeError("title must be string");if(!Array.isArray(s)||s.some(e=>typeof e!="string"))throw new TypeError("choices must be array of strings");let d=a.bits||0,h=a.duration||60;(typeof d!="number"||d<0)&&(d=0),(typeof h!="number"||h<0)&&(h=60);const t=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,31902,23)),variables:{input:{bitsCost:d,bitsVoting:d>0,choices:s.map(e=>({title:e})),durationSeconds:h,ownedBy:`${i}`,subscriberMultiplier:a.subscriberMultiplier||!1,subscriberOnly:a.subscriberOnly||!1,title:o}}});return(0,m.get)("data.createPoll.poll",t)}async archivePoll(i){const o=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,83852,23)),variables:{id:i}});return(0,m.get)("data.archivePoll.poll",o)}async terminatePoll(i){const o=await this.mutate({mutation:await n.e(3224).then(n.t.bind(n,20685,23)),variables:{id:i}});return(0,m.get)("data.terminatePoll.poll",o)}getStreamMeta(i,o){let s,a,d;if(i)s=this._waiting_stream_ids,d=String(i);else if(o)s=this._waiting_stream_logins,d=o;else return Promise.reject("id and login cannot both be null");let h=s.get(d);if(h)return h[0];let t,e;return a=new Promise((l,u)=>{t=l,e=u}),s.set(d,[a,t,e]),this._loading_streams||this._loadStreams(),a}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const i=[...this._waiting_stream_ids.keys()].slice(0,50),o=50-i.length,s=o>0?[...this._waiting_stream_logins.keys()].slice(0,o):[];let a;try{a=(await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,61421,23)),variables:{ids:i.length?i:null,logins:s.length?s:null}}))?.data?.users}catch(t){for(const e of i){const l=this._waiting_stream_ids.get(e);this._waiting_stream_ids.delete(e),l&&l[2](t)}for(const e of s){const l=this._waiting_stream_logins.get(e);this._waiting_stream_logins.delete(e),l&&l[2](t)}return}const d=new Set(i),h=new Set(s);if(Array.isArray(a))for(const t of a){if(!t||!t.id)continue;d.delete(t.id),h.delete(t.login);let e=this._waiting_stream_ids.get(t.id);e&&(this._waiting_stream_ids.delete(t.id),e[1](t.stream)),e=this._waiting_stream_logins.get(t.login),e&&(this._waiting_stream_logins.delete(t.login),e[1](t.stream))}for(const t of d){const e=this._waiting_stream_ids.get(t);e&&(this._waiting_stream_ids.delete(t),e[1](null))}for(const t of h){const e=this._waiting_stream_logins.get(t);e&&(this._waiting_stream_logins.delete(t),e[1](null))}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}getStreamFlags(i,o){let s,a,d;if(i)s=this._waiting_flag_ids,d=String(i);else if(o)s=this._waiting_flag_logins,d=o;else return Promise.reject("id and login cannot both be null");let h=s.get(d);if(h)return h[0];let t,e;return a=new Promise((l,u)=>{t=l,e=u}),s.set(d,[a,t,e]),this._loading_flags||this._loadStreamFlags(),a}async _loadStreamFlags(){if(this._loading_flags)return;this._loading_flags=!0;const i=[...this._waiting_flag_ids.keys()].slice(0,50),o=50-i.length,s=o>0?[...this._waiting_flag_logins.keys()].slice(0,o):[];let a;try{a=(await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,9808,23)),variables:{ids:i.length?i:null,logins:s.length?s:null}}))?.data?.users}catch(t){for(const e of i){const l=this._waiting_flag_ids.get(e);l&&(this._waiting_flag_ids.delete(e),l[2](t))}for(const e of s){const l=this._waiting_flag_logins.get(e);l&&(this._waiting_flag_logins.delete(e),l[2](t))}return}const d=new Set(i),h=new Set(s);if(Array.isArray(a))for(const t of a){if(!t||!t.id)continue;d.delete(t.id),h.delete(t.login);let e=this._waiting_flag_ids.get(t.id);e&&(this._waiting_flag_ids.delete(t.id),e[1](t.stream?.contentClassificationLabels??null)),e=this._waiting_flag_logins.get(t.login),e&&(this._waiting_flag_logins.delete(t.login),e[1](t.stream?.contentClassificationLabels??null))}for(const t of d){const e=this._waiting_flag_ids.get(t);e&&(this._waiting_flag_ids.delete(t),e[1](null))}for(const t of h){const e=this._waiting_flag_logins.get(t);e&&(this._waiting_flag_logins.delete(t),e[1](null))}this._loading_flags=!1,(this._waiting_flag_ids.size||this._waiting_flag_logins.size)&&this._loadStreamFlags()}async getMatchingTags(i){const s=(await this.queryApollo({query:await n.e(3224).then(n.t.bind(n,50873,23)),variables:{query:i,first:100}}))?.data?.searchFreeformTags?.edges;if(!Array.isArray(s)||!s.length)return[];const a=[];for(const d of s){const h=d?.node?.tagName;h&&a.push(h)}return a}};E(r,"TwitchData");let v=r}}]);})();

//# sourceMappingURL=tdata.js.map