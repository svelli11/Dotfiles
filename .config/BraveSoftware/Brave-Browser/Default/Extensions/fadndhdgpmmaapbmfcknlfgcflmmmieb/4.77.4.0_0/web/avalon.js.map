{"version":3,"file":"avalon.js","mappings":"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BAAyB;AAAA,sKACsHuQ,CAAK;AAAA,yFAClFA,CAAK;AAAA,qBACzEvQ,CAAK;AAAA,EACxB,CACA,MACC,KAAK,WAAW,OAAO,uBAAuB,CAChD,CAEA,WAAWwmB,EAAM,CAChB,KAAK,YAAYA,EAAK,OAASA,EAAK,MAAM,WAAW,CACtD,CAEA,aAAc,CACb,KAAK,YAAY,CAClB,CACD,EAxFgD,oBAAjC,IAAM+b,GAAN,GCwCf,MAAMC,MAAgB,aACrB,OACA,QACD,EAEMC,MAAY,aACjB,MACA,UACA,QACD,EAEMC,MAAgB,aACrB,wBACA,6BACA,kBACA,iBACA,gBACA,qBACA,sBACA,qBACA,kBACD,EAEMC,GAAoB,CACzB,UACA,SACA,aACA,mBACA,2BACA,UACA,qBACA,mBACA,WACA,gBACA,UACA,YACA,eACA,YACA,WACA,YACA,eACD,EAEMC,MAAa,aAClB,UACA,mBACA,aACA,mBACA,2BACA,UACA,qBACA,mBACA,WACA,gBACA,UACA,YACA,eACA,YACA,eACA,iBACA,kBACA,sBACA,mBACA,kCACA,qBACA,UACA,cACA,QACA,WACA,YACA,OACA,SACA,SACA,OACA,gBACA,WACA,cACA,YACA,aACA,iBACA,qBACA,qBACA,sBACA,oBACA,wBACA,uBACA,uBACA,sBACA,iCACA,uBACA,gCACA,wBACA,WACA,sBACA,kBACA,kBACA,kBACA,kBACD,EAGMC,GAAa,CAClB,YACA,YACA,gBACA,OACD,EAGMC,GAAuB,CAC5B,cAAiB,cACjB,wBAA2B,2BAC3B,6BAAgC,kBAChC,kBAAqB,iBACtB,EAEMC,GAAgB,CACrB,mBAAsB,sBACtB,cAAiB,kBACjB,aAAgB,iBAChB,cAAiB,kBACjB,gBAAmB,mBACnB,uBAA0B,2BAC1B,YAAe,eACf,qBAAwB,wBACxB,KAAQ,OACR,eAAkB,mBAClB,qBAAwB,yBACxB,oBAAuB,wBACvB,kBAAqB,sBACrB,iBAAoB,sBACpB,iBAAoB,qBACpB,eAAkB,mBAClB,uBAA0B,6BAC1B,gBAAmB,oBACnB,sBAAyB,2BACzB,QAAW,WACX,WAAc,cACd,mBAAsB,uBACtB,eAAkB,mBAClB,sBAAyB,2BACzB,WAAc,aACf,EAEMC,GAAuB,CAAC,EAGxBC,GAAqB,CAC1B,sBACD,EAGqB,GAAN,MAAM,WAAiB,SAAO,CAC5C,eAAeviD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,iBAAmB,IAAI,IAC5B,KAAK,aAAe,CAAC,EAErB,KAAK,OAAS,IAAI,gBAClB,KAAK,eAAiB,IAAI,gBAE1B,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,aAAa,EAEzB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,gBAAgB,EAC5B,KAAK,OAAO,iBAAiB,EAC7B,KAAK,OAAO,cAAc,EAG1B,KAAK,OAAO,MAAM,EAElB,KAAK,OAAOuxC,CAAQ,EACpB,KAAK,OAAOoE,CAAQ,EACpB,KAAK,OAAOM,CAAY,EACxB,KAAK,OAAOuI,CAAS,EACrB,KAAK,OAAOzvB,CAAK,EACjB,KAAK,OAAO8yB,EAAW,EAEvB,KAAK,gBAAkB,KAAK,KAAK,OAChC,mBACA/pC,GAAKA,EAAE,OAAO,aAAY,OAAIA,EAAE,MAAO,eAAe,MAAK,OAAIA,EAAE,MAAO,iBAAiB,EACzF,IAAS,WACV,EAEA,KAAK,YAAc,KAAK,KAAK,OAC5B,eACAA,GAAKA,EAAE,MAAQA,EAAE,QAAUA,EAAE,MAAM,qBACnC,IAAS,WACV,EAEA,KAAK,WAAa,KAAK,KAAK,OAC3B,cACAA,GAAKA,EAAE,gBAAkBA,EAAE,sBAAwBA,EAAE,cACrD,IAAS,WACV,EAEA,KAAK,eAAiB,KAAK,KAAK,OAC/B,kBACAA,GAAKA,EAAE,sBAAwBA,EAAE,oBAAsBA,EAAE,oBACzD,IAAS,WACV,EAEA,KAAK,aAAe,KAAK,KAAK,OAC7B,gBACAA,GAAKA,EAAE,wBAA0BA,EAAE,qBACnC,IAAS,WACV,EAEA,KAAK,cAAgB,KAAK,KAAK,OAC9B,iBACAA,GAAKA,EAAE,kBAAoBA,EAAE,iBAC7B,IAAS,WACV,EAEA,KAAK,oBAAsB,KAAK,KAAK,OACpC,wBACAA,GAAKA,EAAE,mBAAqBA,EAAE,qBAC9B,IAAS,WACV,EAEA,KAAK,uBAAyB,KAAK,KAAK,OACvC,4BACAA,GAAKA,EAAE,aAAeA,EAAE,eAAiBA,EAAE,OAAO,mBAAqBA,EAAE,OAAO,UAChF,IAAS,WACV,EAEA,KAAK,aAAe,IAAI,IAExB,KAAK,eAAiB,KAAK,KAAK,OAC/B,kBACAA,GAAKA,EAAE,iBAAmBA,EAAE,eAC5B,IAAS,WACV,EAEA,KAAK,cAAgB,KAAK,KAAK,OAC9B,iBACAA,GAAKA,EAAE,SAAWA,EAAE,mBAAqBA,EAAE,YAC3C,IAAS,WACV,EAEA,KAAK,cAAgB,KAAK,KAAK,OAC9B,iBACAA,GAAKA,EAAE,iBAAmBA,EAAE,mBAAqBA,EAAE,IACnD,IAAS,WACV,EAEA,KAAK,gBAAkB,KAAK,KAAK,OAChC,mBACAA,GAAKA,EAAE,wBAA0BA,EAAE,UAAS,OAAIA,EAAE,MAAO,UAAU,EACnE,IAAS,WACV,EAEA,KAAK,aAAe,KAAK,KAAK,OAC7B,gBACAA,GAAKA,EAAE,YAAcA,EAAE,aAAeA,EAAE,4BACxC,IAAS,WACV,EAEA,KAAK,kBAAoB,KAAK,KAAK,OAClC,sBACAA,GAAKA,EAAE,UAAYA,EAAE,SAAWA,EAAE,OAASA,EAAE,MAAM,qBACnD,IAAS,WACV,EAEA,KAAK,qBAAuB,KAAK,KAAK,OACrC,yBACAA,GAAKA,EAAE,mBAAqBA,EAAE,kBAAiB,OAAIA,EAAG,YAAY,EAClE,IAAS,WACV,EAEA,KAAK,WAAa,KAAK,KAAK,OAC3B,cACAA,GAAKA,EAAE,YAAc,QAAaA,EAAE,YAAc,OAClD,IAAS,WACV,EAEA,KAAK,WAAa,KAAK,KAAK,OAC3B,cACAA,GAAKA,EAAE,eAAiBA,EAAE,gBAC1B,IAAS,WACV,EAIA,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,GACT,GAAI,CACH,KAAM,qCACN,MAAO,yDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,GACT,GAAI,CACH,KAAM,2CACN,MAAO,kBACP,YAAa,8RACb,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,GAAO,MAAO,UAAU,EAChC,CAAC,MAAO,EAAG,MAAO,eAAe,EACjC,CAAC,MAAO,EAAG,MAAO,QAAQ,CAC3B,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,KACT,SAAU,CAAC,iCAAiC,EAC5C,QAAQ+B,EAAKrf,EAAK,CACjB,OAAKA,GAAO,KACJ,CAAEA,EACL,EAAAqf,EAAI,IAAI,iCAAiC,CAG/C,EACA,GAAI,CACH,KAAM,iCACN,MAAO,sCACP,UAAW,oBACX,WAAY,EACb,CACD,CAAC,EAED,KAAK,SAAS,MAAM,kBAAmB,CACtC,KAAM,2BACN,UAAW,cACX,QAAS,IAAM,KACf,WAAY,EACb,CAAC,EAED,KAAK,SAAS,IAAI,kCAAmC,CACpD,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,QAAS,CAACA,EAAKrf,IAAQ,CACtB,MAAMU,EAAM,IAAI,IACfsnD,EAAW,KAAK,eAAiBH,GAClC,UAAU3pC,KAAKle,EACTke,GAAG,GAAK8pC,EAAS9pC,EAAE,CAAC,GAAK,CAAE4pC,GAAqB,SAAS5pC,EAAE,CAAC,GAChExd,EAAI,IAAIsnD,EAAS9pC,EAAE,CAAC,CAAC,EAEvB,OAAOxd,CACR,EAEA,GAAI,CACH,KAAM,4SACN,UAAW,gBACX,cAAe,IAAM,OAAO,KAAK,KAAK,aAAa,EAAE,OAAOX,GAAO,CAAE+nD,GAAqB,SAAS/nD,CAAG,CAAC,EACvG,KAAM,IAAM,OACV,KAAK,KAAK,aAAa,EACvB,OAAOA,GAAO,CAAE+nD,GAAqB,SAAS/nD,CAAG,CAAC,EAClD,KAAK,CACR,CACD,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,QAAQsf,EAAKrf,EAAK,CACjB,MAAMU,EAAM,IAAI,IAChB,UAAUwd,KAAKle,EACTke,GAAG,GAAK,CAAEupC,GAAkB,SAASvpC,EAAE,CAAC,GAC5Cxd,EAAI,IAAIwd,EAAE,CAAC,EAEb,OAAOxd,CACR,EAEA,GAAI,CACH,KAAM,0TACN,UAAW,gBACX,cAAe,IAAM,OAAO,KAAK,KAAK,UAAU,EAAE,OAAOX,GAAO,CAAE0nD,GAAkB,SAAS1nD,CAAG,GAAK,CAAE,QAAQ,KAAKA,CAAG,CAAC,EACxH,KAAM,IAAM,OACV,KAAK,KAAK,UAAU,EACpB,OAAOA,GAAO,CAAE0nD,GAAkB,SAAS1nD,CAAG,GAAK,CAAE,QAAQ,KAAKA,CAAG,CAAC,EACtE,KAAK,CACR,CACD,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,EACT,GAAI,CACH,KAAM,+BACN,MAAO,QACP,YAAa,uRACb,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,UAAU,EAC5B,CAAC,MAAO,EAAG,MAAO,kBAAkB,EACpC,CAAC,MAAO,EAAG,MAAO,cAAc,CACjC,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,8BACN,MAAO,mCACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,sDACP,UAAW,oBACX,YAAa,0GACd,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,GAAI,CACH,KAAM,mIACN,UAAW,cACX,MAAO,EACR,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0CAA2C,CAC5D,SAAU,CAAC,gCAAgC,EAC3C,OAAQ,eACR,QAAQsf,EAAK,CACZ,MAAMrf,EAAMqf,EAAI,IAAI,gCAAgC,EACpD,GAAK,CAAErf,GAAO,CAAEA,EAAI,OACnB,OAAO,KAER,MAAMU,EAAM,CAAC,EAEb,UAAU4B,KAAQtC,EAAK,CACtB,MAAMud,EAAIjb,EAAK,EACf,IAAI4b,EAAI5b,EAAK,EAERib,IAAM,OACVW,KAAI,iBAAcA,CAAC,EAEVX,IAAM,QACfW,KAAI,gBAAaA,CAAC,GAEd,GAAEA,GAAK,CAAEA,EAAE,SAGhBxd,EAAI,KAAKwd,CAAC,CACX,CAEA,OAAKxd,EAAI,OACD,IAAI,OAAO,OAAOA,EAAI,KAAK,GAAG,CAAC,KAAM,IAAI,EAE1C,IACR,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,sDACP,UAAW,oBACX,YAAa,kIACd,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,oEACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,2DACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,iEACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,+EACP,UAAW,oBACX,YAAa,8KACd,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,gDACP,UAAW,mBACZ,CACD,CAAC,EAYD,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,sFACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,iDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,sDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,uCACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,6CACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,0EACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,2CACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,EACT,GAAI,CACH,KAAM,sCACN,MAAO,2EACP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,UAAU,EAC5B,CAAC,MAAO,EAAG,MAAO,cAAc,EAChC,CAAC,MAAO,EAAG,MAAO,WAAW,CAC9B,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,mCACN,MAAO,yDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,mCACN,MAAO,8CACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,SAAU,CAAC,0BAA0B,EACrC,QAAQ2e,EAAKrf,EAAK,CACjB,OAAKqf,EAAI,IAAI,0BAA0B,EAC/B,GAEDrf,CACR,EACA,GAAI,CACH,KAAM,oCACN,MAAO,uEACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,GAAI,CACH,KAAM,oCACN,MAAO,qCACP,UAAW,oBACX,WAAY,EACb,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,2BACN,MAAO,6BACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,kBAAmB,CACpC,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,sDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,KACT,GAAI,CACH,KAAM,mCACN,MAAO,aACP,UAAW,qBACX,YAAa,+MACb,KAAM,CACL,CAAC,MAAO,KAAM,MAAO,WAAW,EAChC,CAAC,MAAO,EAAG,MAAO,QAAQ,EAC1B,CAAC,MAAO,EAAG,MAAO,cAAc,EAChC,CAAC,MAAO,EAAG,MAAO,QAAQ,CAC3B,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,oCAAqC,CACtD,QAAS,GACT,GAAI,CACH,KAAM,mCACN,UAAW,oBACX,MAAO,wFACR,CACD,CAAC,EAED,KAAK,SAAS,IAAI,aAAc,CAC/B,QAAS,KACT,GAAI,CACH,KAAM,6CACN,MAAO,QACP,YAAa,0GACb,UAAW,mBACX,QAAQA,EAAK,CAEZ,OADAA,EAAM,SAASA,EAAK,EAAE,EACjB,MAAMA,CAAG,GAAK,CAAE,SAASA,CAAG,GAAKA,GAAO,EACrC,KAEDA,CACR,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,SAAU,CAAC,aAAc,6BAA6B,EACtD,QAAQqf,EAAK,CACZ,MAAMrf,EAAMqf,EAAI,IAAI,YAAY,EAChC,OAAOrf,IAAeqf,EAAI,IAAI,6BAA6B,GAAK,IACjE,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iBAAkB,CACnC,SAAU,CAAC,aAAc,iCAAkC,sBAAsB,EACjF,QAAQA,EAAK,CACZ,MAAK,CAAEA,EAAI,IAAI,gCAAgC,GAAKA,EAAI,IAAI,sBAAsB,EAC1E,GAEDA,EAAI,IAAI,YAAY,GAAK,IACjC,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,SAAU,CAAC,gBAAgB,EAC3B,QAAS,KACT,QAAQA,EAAKrf,EAAK,CACjB,OAAKA,GAGEqf,EAAI,IAAI,gBAAgB,CAChC,EAEA,GAAI,CACH,KAAM,iCACN,MAAO,sBACP,YAAa;AAAA;AAAA,+IACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,SAAU,CAAC,gBAAgB,EAC3B,QAAS,KACT,QAAQA,EAAKrf,EAAK,CACjB,OAAKA,GAGEqf,EAAI,IAAI,gBAAgB,CAChC,EAEA,GAAI,CACH,KAAM,uCACN,MAAO,kEACP,YAAa,2GACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,GACT,GAAI,CACH,KAAM,yCACN,MAAO,yDACP,YAAa,uRACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,oBAAqB,CACtC,QAAS,GACT,GAAI,CACH,KAAM,wCACN,MAAO,kEACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,iCACP,YAAa,uFACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,EACT,GAAI,CACH,KAAM,iCACN,MAAO,kBACP,UAAW,qBACX,YAAa,mLACb,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,gBAAgB,EAClC,CAAC,MAAO,EAAG,MAAO,uDAAuD,EACzE,CAAC,MAAO,EAAG,MAAO,iDAAkD,CACrE,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iBAAkB,CACnC,QAAS,EACT,GAAI,CACH,KAAM,qCACN,MAAO,uBACP,UAAW,qBACX,YAAa,yHACb,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,gBAAgB,EAClC,CAAC,MAAO,EAAG,MAAO,4BAA4B,EAC9C,CAAC,MAAO,EAAG,MAAO,cAAc,EAChC,CAAC,MAAO,EAAG,MAAO,aAAa,CAChC,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,oBAAqB,CACtC,QAAS,GACT,GAAI,CACH,KAAM,qCACN,MAAO,uEACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,IACT,GAAI,CACH,KAAM,qCACN,MAAO,uBACP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,IAAM,MAAO,UAAU,EAC/B,CAAC,MAAO,GAAI,MAAO,cAAc,EACjC,CAAC,MAAO,GAAI,MAAO,cAAc,EACjC,CAAC,MAAO,GAAI,MAAO,cAAc,EACjC,CAAC,MAAO,EAAG,MAAO,aAAa,EAC/B,CAAC,MAAO,EAAG,MAAO,QAAQ,CAC3B,EACA,YAAa;AAAA,0CACd,CACD,CAAC,EAED,KAAK,SAAS,IAAI,mCAAoC,CACrD,QAAS,GACT,GAAI,CACH,KAAM,qCACN,MAAO,mDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,oDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,+BACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,EACT,GAAI,CACH,KAAM,kCACN,MAAO,aACP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,UAAU,EAC5B,CAAC,MAAO,EAAG,MAAO,wBAAwB,EAC1C,CAAC,MAAO,EAAG,MAAO,sBAAsB,EACxC,CAAC,MAAO,EAAG,MAAO,4BAA4B,EAC9C,CAAC,MAAO,EAAG,MAAO,uBAAuB,CAC1C,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,8DACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,6EACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,iEACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uCAAwC,CACzD,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,2DACP,UAAW,mBACZ,CACD,CAAC,CACF,CAEA,IAAI,aAAc,CACjB,UAAUisB,KAAQ,KAAK,eAAe,UACrC,GAAKA,GAAQA,EAAK,YACjB,OAAOA,EAET,OAAO,IACR,CAGA,cAAe,CACd,MAAM3iB,EAAU,KAAK,KAAK,QAAQ,IAAI,eAAe,EACpD4C,EAAO,KAAK,KAAK,QAAQ,IAAI,sBAAsB,EACnD08B,EAAW,KAAK,KAAK,QAAQ,IAAI,0BAA0B,EAC3D9qC,EAAI,KAAK,OACT+qC,EAAK,KAAK,eAEX,IAAIC,EAAYx/B,EACfy/B,EAAa,QAAM,KAAK,QACvB,KAAK,KAAK,QAAQ,IAAI,6BAA6B,GACnD,KAAK,KAAK,QAAQ,IAAI,wBAAwB,CAC/C,EAEIA,IACJD,EAAYC,EAAW,OAAO,EAAE,EAAI,IAErCA,EAAaD,EAAY,UAAY,UAErC,IAAIE,EAAY,CAAEF,EACjBG,EAAY,QAAM,KAAK,QACtB,KAAK,KAAK,QAAQ,IAAI,uBAAuB,GAC7C,KAAK,KAAK,QAAQ,IAAI,kBAAkB,CACzC,EAEIA,IACJD,EAAYC,EAAU,OAAO,EAAE,EAAI,IAEpCA,EAAYD,EAAY,UAAY,UAIpClrC,EAAE,MAAQirC,EACVjrC,EAAE,KAAOoO,EACTpO,EAAE,SAAW8qC,EAEbC,EAAG,MAAQI,EACXJ,EAAG,KAAO38B,EACV28B,EAAG,SAAWD,EAEd,KAAK,UAAU,cAAc,EAE7B,KAAK,iBAAiB,EACtB,KAAK,KAAK,gBAAgB,CAC3B,CAGA,eAAgB,CACR,KAAK,qBACX,KAAK,mBAAqB,sBAAsB,IAAM,KAAK,eAAe,CAAC,EAC7E,CAEA,gBAAiB,CAChB,qBAAqB,KAAK,kBAAkB,EAC5C,KAAK,mBAAqB,KAE1B,MAAM//C,EAAQ,KAAK,KAAK,QAAQ,IAAI,sBAAsB,EACzDqgD,EAAc,KAAK,KAAK,QAAQ,IAAI,mBAAmB,EACvDC,EAAoB,KAAK,KAAK,QAAQ,IAAI,yBAAyB,EACnEC,EAAU,KAAK,KAAK,QAAQ,IAAI,qBAAqB,EACrDxzB,EAAO,KAAK,KAAK,QAAQ,IAAI,gBAAgB,EAC7CyzB,EAAkB,KAAK,KAAK,QAAQ,IAAI,4BAA4B,EACpEC,EAAK,KAAK,MAAO,GAAG,GAAM1zB,CAAI,EAEzB2zB,EAAoB,KAAK,MAAMJ,GAAqB,EAAE,EAAE,EAC7DK,EAAuBL,EAAoBI,EAE5C,IAAIE,EAAO,KAAK,KAAK,QAAQ,IAAI,kBAAkB,GAAK,UACxD,KAAM,CAAC72B,GAAWkb,EAAQ,KAAI,MAAQ2b,CAAI,EAC1CA,EAAO72B,GAEF,KAAK,gBACT,KAAK,eAAe,EAErB,KAAK,eAAiBkb,GAEjB2b,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,KAC9GA,EAAO,IAAIA,CAAI,KAEXL,EACJ,KAAK,WAAW,IAAI,UAAW,mCAAmCA,EAAQ,EAAE,MAAM,EAElF,KAAK,WAAW,OAAO,SAAS,EAEjC,KAAK,WAAW,YAAY,oBAAqB,GAAGF,EAAY,EAAE,KAAK,EACvE,KAAK,WAAW,YAAY,0BAA2B,GAAGK,EAAkB,EAAE,KAAK,EACnF,KAAK,WAAW,YAAY,6BAA8B,GAAGC,EAAqB,EAAE,KAAK,EACzF,KAAK,WAAW,YAAY,iBAAkB,GAAG5zB,EAAK,EAAE,KAAK,EAC7D,KAAK,WAAW,YAAY,mBAAoB,GAAG0zB,EAAG,EAAE,KAAK,EAC7D,KAAK,WAAW,YAAY,mBAAoBG,CAAI,EACpD,KAAK,WAAW,YAAY,aAAc,GAAG5gD,EAAM,EAAE,KAAK,EAC1D,KAAK,WAAW,YAAY,sBAAuB,GAAG,CAACA,EAAM,EAAE,KAAK,EAEpE,KAAK,WAAW,OAAO,YAAa+sB,IAAS,IAAM6zB,IAAS,SAAS,EACrE,KAAK,WAAW,OAAO,aAAc,KAAK,SAAS,IAAI,gBAAgB,CAAC,EACxE,KAAK,WAAW,OAAO,wBAAyB,KAAK,SAAS,IAAI,sBAAsB,CAAC,EAEzF,KAAK,WAAW,OAAO,yBAA0BJ,IAAoB,CAAC,EACtE,KAAK,WAAW,OAAO,2BAA4BA,IAAoB,CAAC,EAExE,KAAK,KAAK,kBAAkB,EAC5B,KAAK,KAAK,wBAAwB,EAClC,KAAK,KAAK,oBAAoB,CAC/B,CAEA,mBAAoB,CACnB,MAAMn9B,EAAO,KAAK,KAAK,QAAQ,IAAI,oBAAoB,EAEvD,KAAK,WAAW,OAAO,eAAgBA,EAAO,CAAC,EAC/C,KAAK,WAAW,OAAO,kBAAmBA,IAAS,CAAC,EACpD,KAAK,WAAW,OAAO,wBAAyBA,IAAS,CAAC,EAC1D,KAAK,WAAW,OAAO,oBAAqBA,IAAS,CAAC,CACvD,CAEA,kBAAmB,CAClB,MAAMkI,EAAU,KAAK,KAAK,QAAQ,IAAI,mCAAmC,EACzE,KAAK,WAAW,OAAO,qBAAsB,KAAK,KAAK,QAAQ,IAAI,iCAAiC,CAAC,EAErG,MAAMklB,EAAY,KAAK,KAAK,QAAQ,IAAI,8BAA8B,EACjEA,GACJ,KAAK,WAAW,OAAO,kBAAmB,EAAK,EAC/C,KAAK,WAAW,OAAO,sBAAuB,EAAK,EAEnD,KAAK,WAAW,OAAO,yBAA0B,EAAI,EACrD,KAAK,WAAW,YAAY,qBAAsB,KAAK,eAAe,QAAQA,CAAS,CAAC,IAGxF,KAAK,WAAW,OAAO,yBAA0B,EAAK,EACtD,KAAK,WAAW,OAAO,kBAAmBllB,CAAO,EACjD,KAAK,WAAW,OAAO,sBAAuBA,GAAW,KAAK,KAAK,QAAQ,IAAI,sBAAsB,CAAC,EAExG,CAGA,iBAAiB6X,EAAM,CACtB,MAAM/kB,EAAO+kB,GAAM,UAClB/pC,EAAO+pC,GAAM,UAET/kB,EACJ,KAAK,WAAW,IAAI,cAAe;AAAA;AAAA;AAAA;AAAA,0BAIZA,EAAK,GAAG;AAAA,qBACb,YAAM,kBAAkBA,EAAK,GAAG,eAAeA,EAAK,KAAK,eAAeA,EAAK,KAAK;AAAA,EACrG,EAEC,KAAK,WAAW,OAAO,aAAa,EAErC,KAAK,WAAahlB,GAAQ,IAC3B,CAGA,WAAY,CACX,GAAK,KAAK,aACT,OAED,MAAMw4B,EAAK,KAAK,UAAU,UAAU,YAAY,EAC/CgvB,EAAW,KAAK,UAAU,UAAU,eAAe,EAQpD,GANA,KAAK,cAAgBA,GAAYlB,GACjC,KAAK,cAAgB9tB,GAAI,SAAWytB,GACpC,KAAK,WAAaztB,GAAI,MAAQ2tB,GAC9B,KAAK,cAAgB3tB,GAAI,SAAWutB,GACpC,KAAK,UAAYvtB,GAAI,KAAOwtB,GAEvB,CAAExtB,EACN,OAEIgvB,GACJ,KAAK,KAAK,QAAQ,OAAO,iCAAiC,EAE3D,KAAK,aAAe,GACpB,MAAM71B,EAAU,CAAC,KAEV,yBAAsB,KAAK,cAAe20B,EAAa,GAC7D30B,EAAQ,KAAK,eAAe,KAEtB,yBAAsB,KAAK,cAAes0B,EAAa,GAC7Dt0B,EAAQ,KAAK,eAAe,KAEtB,yBAAsB,KAAK,WAAYw0B,EAAU,GACvDx0B,EAAQ,KAAK,YAAY,KAEnB,yBAAsB,KAAK,cAAeo0B,EAAa,GAC7Dp0B,EAAQ,KAAK,eAAe,KAEtB,yBAAsB,KAAK,UAAWq0B,EAAS,GACrDr0B,EAAQ,KAAK,WAAW,EAEpBA,EAAQ,QACZ,KAAK,IAAI,KAAK,+DAAgEA,EAAQ,KAAK,GAAG,CAAC,CACjG,CAGA,uBAAwB,CACvB,KAAK,iBAAmB,KAAK,KAAK,QAAQ,IAAI,uBAAuB,CACtE,CAkBA,UAAW,CACV,KAAK,GAAG,2BAA4B,KAAK,SAAS,EAClD,KAAK,GAAG,2BAA4B,KAAK,aAAa,EACtD,KAAK,UAAU,EACf,KAAK,cAAc,EAEnB,KAAK,KAAK,QAAQ,GAAG,6BAA8B,KAAK,eAAgB,IAAI,EAC5E,KAAK,KAAK,QAAQ,GAAG,0CAA2C,KAAK,eAAgB,IAAI,EACzF,KAAK,KAAK,QAAQ,GAAG,oCAAqC,KAAK,eAAgB,IAAI,EACnF,KAAK,KAAK,QAAQ,GAAG,kCAAmC,IAAM,KAAK,aAAa,YAAY,CAAC,EAC7F,KAAK,KAAK,QAAQ,GAAG,mCAAoC,IAAM,CAC9D,KAAK,aAAa,YAAY,EAC9B,KAAK,kBAAkB,YAAY,CACpC,CAAC,EACD,KAAK,KAAK,QAAQ,GAAG,yBAA0B,IAAM,CACpD,KAAK,aAAa,YAAY,CAC/B,CAAC,EAED,KAAK,KAAK,QAAQ,GAAG,kCAAmC,KAAK,gBAAiB,IAAI,EAClF,KAAK,KAAK,QAAQ,GAAG,gCAAiC,KAAK,gBAAiB,IAAI,EAChF,KAAK,KAAK,QAAQ,GAAG,6BAA8B,KAAK,gBAAiB,IAAI,EAC7E,KAAK,KAAK,QAAQ,GAAG,kCAAmC,KAAK,gBAAiB,IAAI,EAClF,KAAK,KAAK,QAAQ,GAAG,6BAA8B,KAAK,gBAAiB,IAAI,EAC7E,KAAK,KAAK,QAAQ,GAAG,sCAAuC,KAAK,gBAAiB,IAAI,EACtF,KAAK,KAAK,QAAQ,GAAG,sCAAuC,KAAK,gBAAiB,IAAI,EACtF,KAAK,KAAK,QAAQ,GAAG,mCAAoC,KAAK,gBAAiB,IAAI,EAEnF,KAAK,KAAK,QAAQ,GAAG,gCAAiC,KAAK,sBAAuB,IAAI,EAEtF,KAAK,KAAK,QAAQ,GAAG,+BAAgC,IAAM,CAC1D,KAAK,cAAc,YAAY,CAChC,CAAC,EAED,KAAK,KAAK,QAAQ,GAAG,gCAAiC,IAAM,KAAK,WAAW,YAAY,EAAG,IAAI,EAC/F,KAAK,KAAK,QAAQ,GAAG,+BAAgC,KAAK,cAAe,IAAI,EAC7E,KAAK,SAAS,aAAa,GAAG,yBAA0B,KAAK,cAAe,IAAI,EAChF,KAAK,KAAK,QAAQ,GAAG,4BAA6B,KAAK,cAAe,IAAI,EAC1E,KAAK,KAAK,QAAQ,GAAG,kCAAmC,KAAK,cAAe,IAAI,EAChF,KAAK,KAAK,QAAQ,GAAG,yBAA0B,KAAK,cAAe,IAAI,EACvE,KAAK,KAAK,QAAQ,GAAG,8BAA+B,KAAK,cAAe,IAAI,EAC5E,KAAK,KAAK,QAAQ,GAAG,2BAA4B,KAAK,cAAe,IAAI,EACzE,KAAK,KAAK,QAAQ,GAAG,qCAAsC,KAAK,cAAe,IAAI,EACnF,KAAK,KAAK,QAAQ,GAAG,+BAAgC,KAAK,aAAc,IAAI,EAC5E,KAAK,KAAK,QAAQ,GAAG,mCAAoC,KAAK,aAAc,IAAI,EAChF,KAAK,KAAK,QAAQ,GAAG,wBAAyB,KAAK,aAAc,IAAI,EACrE,KAAK,KAAK,QAAQ,GAAG,iCAAkC,KAAK,aAAc,IAAI,EAC9E,KAAK,KAAK,QAAQ,GAAG,sCAAuC,KAAK,aAAc,IAAI,EACnF,KAAK,KAAK,QAAQ,GAAG,2BAA4B,KAAK,aAAc,IAAI,EACxE,KAAK,KAAK,QAAQ,GAAG,gCAAiC,KAAK,aAAc,IAAI,EAC7E,KAAK,KAAK,QAAQ,GAAG,6BAA8B,KAAK,kBAAmB,IAAI,EAC/E,KAAK,KAAK,QAAQ,GAAG,4CAA6C,KAAK,iBAAkB,IAAI,EAC7F,KAAK,KAAK,QAAQ,GAAG,0CAA2C,KAAK,iBAAkB,IAAI,EAC3F,KAAK,KAAK,QAAQ,GAAG,uCAAwC,KAAK,iBAAkB,IAAI,EACxF,KAAK,KAAK,QAAQ,GAAG,0BAA2BlzB,GAAO,CACjDA,IACJ,KAAK,qBAAqB,EAC1B,KAAK,qBAAqB,EAE5B,EAAG,IAAI,EAEP,KAAK,KAAK,QAAQ,GAAG,oCAAqC,IAAM,CAC/D,KAAK,qBAAqB,YAAY,EACtC,KAAK,eAAe,CACrB,EAAG,IAAI,EAEP,KAAK,KAAK,QAAQ,WAAW,iBAAkBA,GAAO,CACrD,KAAK,WAAW,OAAO,YAAaA,EAAM,CAAC,EAC3C,KAAK,gBAAgB,CACtB,CAAC,EAED,KAAK,KAAK,QAAQ,WAAW,yBAA0B,IACtD,KAAK,gBAAgB,CAAC,EAEvB,KAAK,KAAK,QAAQ,WAAW,2BAA4BA,GACxD,KAAK,WAAW,WAAW,gBAAiB,CAAEA,CAAG,CAAC,EAEnD,KAAK,KAAK,QAAQ,WAAW,2BAA4BA,GACxD,KAAK,WAAW,WAAW,cAAe,CAAEA,CAAG,CAAC,EAEjD,KAAK,KAAK,QAAQ,WAAW,4BAA6BA,GACzD,KAAK,WAAW,WAAW,wBAAyB,CAACA,CAAG,CAAC,EAE1D,KAAK,KAAK,QAAQ,WAAW,yBAA0BA,GACtD,KAAK,WAAW,WAAW,iBAAkB,CAAEA,CAAG,CAAC,EAEpD,KAAK,KAAK,QAAQ,WAAW,qBAAsBA,GAClD,KAAK,WAAW,OAAO,eAAgBA,CAAG,CAAC,EAE5C,KAAK,KAAK,QAAQ,WAAW,iBAAkBA,GAC9C,KAAK,WAAW,OAAO,YAAa,CAACA,CAAG,CAAC,EAE1C,KAAK,KAAK,QAAQ,GAAG,gCAAiC,IACrD,KAAK,gBAAgB,YAAY,CAAC,EAEnC,KAAK,KAAK,QAAQ,WAAW,+BAAgCA,GAAO,CACnE,KAAK,WAAW,OAAO,sBAAuBA,IAAQ,GAAKA,IAAQ,CAAC,EACpE,KAAK,WAAW,OAAO,oBAAqBA,EAAM,CAAC,CACpD,CAAC,EAED,KAAK,KAAK,QAAQ,WAAW,oCAAqCA,GACjE,KAAK,WAAW,OAAO,qBAAsBA,CAAG,CAAC,EAElD,KAAK,KAAK,QAAQ,WAAW,+BAAgCA,GAC5D,KAAK,WAAW,OAAO,uBAAwB,CAAEA,CAAG,CAAC,EAEtD,KAAK,KAAK,QAAQ,WAAW,iCAAkCA,GAC9D,KAAK,WAAW,WAAW,uBAAwBA,CAAG,CAAC,EAExD,KAAK,KAAK,QAAQ,WAAW,uBAAwBA,GAAO,CAC3D,KAAK,WAAW,OAAO,YAAaA,CAAG,EACvC,KAAK,iBAAiB,CACvB,CAAC,EAED,KAAK,KAAK,QAAQ,WAAW,uCAAwCA,GACpE,KAAK,WAAW,WAAW,uBAAwB,CAAEA,CAAG,CAAC,EAE1D,KAAK,sBAAsB,EAC3B,KAAK,cAAc,EACnB,KAAK,aAAa,EAClB,KAAK,kBAAkB,EAGvB,KAAK,GAAG,yBAA0B,CAACi5B,EAAcC,EAAiBC,EAAeC,IAAa,CAC7F,GAAK,CAAEH,EACN,OAED,MAAM+vB,EAAU,IAAI,IAAI5vB,EAAS,IAAI,GAAK,EAAE,SAAS,EAAE,CAAC,EAExD,UAAUkS,KAAQ,KAAK,WAAW,UAAW,CAC5C,UAAUlrC,KAAOkrC,EAAK,OAAQ,CAC7B,MAAM2d,EAAS7oD,GAAK,GACf,CAAE6oD,GAAUD,EAAQ,IAAIC,CAAM,GAAK,CAAE7oD,EAAI,mBAG9C4oD,EAAQ,IAAIC,CAAM,EAClB7vB,EAAS,KAAK,CACb,QAASh5B,EACT,UAAW,KACX,OAAQ,IAAM,IACf,CAAC,EACF,CAEA,UAAUyvB,KAAOyb,EAAK,qBAAsB,CAC3C,MAAMlrC,EAAMyvB,GAAK,MAChBo5B,EAAS7oD,GAAK,GACV,CAAE6oD,GAAUD,EAAQ,IAAIC,CAAM,GAAK,CAAE7oD,EAAI,mBAG9C4oD,EAAQ,IAAIC,CAAM,EAClB7vB,EAAS,KAAK,CACb,QAASh5B,EACT,UAAW,KACX,OAAQ,IAAM,IACf,CAAC,EACF,CACD,CACD,CAAC,EAED,KAAK,GAAG,wBAAyBid,GAAK,CACrCA,EAAE,SAAS,KAAK,CACf,KAAM,YACN,YAAa,2BACb,gBAAiB,EACjB,UAAW,cACZ,CAAC,CACF,CAAC,EAED,KAAK,GAAG,wBAAyBA,GAAK,CACrC,MAAMjd,EAAMid,EAAE,QACbiuB,EAAOjuB,EAAE,MAEH,kBAAkB,KAAKjd,CAAG,IAGjCid,EAAE,eAAe,EAEViuB,EAAK,QAAQ,WAMnBA,EAAK,WAAW,CACf,KAAM/tB,EAAE,WAAW,OACnB,QAASA,EAAE,KAAK,EAAE,iBAAkB,qCAAqC,CAC1E,CAAC,EAED+tB,EAAK,OAAO,UAAU,GAVtBA,EAAK,WAAW,CACf,KAAM/tB,EAAE,WAAW,OACnB,QAASA,EAAE,KAAK,EAAE,wBAAyB,2CAA2C,CACvF,CAAC,EASH,CAAC,EA6BD,KAAK,eAAe,GAAG,QAAS,KAAK,mBAAoB,IAAI,EAC7D,KAAK,eAAe,GAAG,SAAU,KAAK,YAAa,IAAI,EACvD,KAAK,eAAe,MAAM,CAACguB,EAAKC,IAAc,CAC7C,UAAUF,KAAQE,EACjB,KAAK,mBAAmBF,CAAI,CAC9B,CAAC,EAED,KAAK,cAAc,GAAG,QAAS,KAAK,gBAAiB,IAAI,EACzD,KAAK,cAAc,GAAG,SAAU,KAAK,gBAAiB,IAAI,EAC1D,KAAK,cAAc,MAAM,IAAM,KAAK,qBAAqB,CAAC,EAE1D,KAAK,cAAc,GAAG,QAAS,KAAK,gBAAiB,IAAI,EACzD,KAAK,cAAc,GAAG,SAAU,KAAK,gBAAiB,IAAI,EAC1D,KAAK,cAAc,MAAM,IAAM,KAAK,qBAAqB,CAAC,EAE1D,MAAM/tB,EAAI,KAEV,KAAK,WAAW,GAAG,QAAS,KAAK,iBAAkB,IAAI,EACvD,KAAK,WAAW,GAAG,SAAU,KAAK,iBAAkB,IAAI,EACxD,KAAK,WAAW,GAAG,UAAW,IAAM,KAAK,iBAAiB,IAAI,CAAC,EAC/D,KAAK,WAAW,MAAM,IAAM,KAAK,iBAAiB,KAAK,WAAW,KAAK,CAAC,EAExE,KAAK,gBAAgB,MAAMguB,GAAO,CACjC,MAAM4I,EAAa5I,EAAI,UAAU,OACjCA,EAAI,UAAU,OAAS,UAAW,CACjC,OAAOhuB,EAAE,KAAK,QAAQ,IAAI,uBAAuB,EAG1C42B,EAAW,KAAK,IAAI,EAFnB,IAGT,EAEA,KAAK,gBAAgB,YAAY,CAClC,CAAC,EAED,KAAK,WAAW,MAAM5I,GAAO,CAC5B,MAAM4I,EAAa5I,EAAI,UAAU,OACjCA,EAAI,UAAU,OAAS,UAAW,CACjC,OAAOhuB,EAAE,KAAK,QAAQ,IAAI,uBAAuB,EAG1C42B,EAAW,KAAK,IAAI,EAFnB,IAGT,EAEA,KAAK,WAAW,YAAY,CAC7B,CAAC,EAED,KAAK,qBAAqB,MAAM5I,GAAO,CACtC,MAAM4I,EAAa5I,EAAI,UAAU,OACjCA,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CACH,GAAK,CAAEhuB,EAAE,KAAK,QAAQ,IAAI,2BAA2B,EACpD,OAAO,IACT,OAAQsD,EAAK,CACZtD,EAAE,IAAI,QAAQsD,CAAG,EACjBtD,EAAE,IAAI,MAAMsD,CAAG,CAChB,CAEA,OAAOszB,EAAW,KAAK,IAAI,CAC5B,EAEA,KAAK,qBAAqB,YAAY,CACvC,CAAC,EAED,KAAK,aAAa,MAAM5I,GAAO,CAC9B,MAAM4I,EAAa5I,EAAI,UAAU,OAEjCA,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CACH,GAAK,CAAEhuB,EAAE,KAAK,QAAQ,IAAI,yBAAyB,EAClD,OAAO,KAER,MAAM2rC,EAAS,KAAK,MAAM,eACzBC,EAAW,KAAK,MAAM,YAEhB5rC,EAAE,KAAK,QAAQ,IAAI,0BAA0B,IACnD,KAAK,MAAM,eAAiB,CAAC,GAEvBA,EAAE,KAAK,QAAQ,IAAI,gBAAgB,IACzC,KAAK,MAAM,YAAc,IAE1B,MAAM7c,EAAMyzC,EAAW,KAAK,IAAI,EAEhC,YAAK,MAAM,eAAiB+U,EAC5B,KAAK,MAAM,YAAcC,EAClBzoD,CAER,OAAQmgB,EAAK,CACZtD,EAAE,IAAI,QAAQsD,CAAG,EACjBtD,EAAE,IAAI,MAAMsD,CAAG,CAChB,CAEA,OAAOszB,EAAW,KAAK,IAAI,CAC5B,EAEA,KAAK,aAAa,YAAY,CAC/B,CAAC,EAED,KAAK,kBAAkB,MAAM5I,GAAO,CACnCA,EAAI,UAAU,YAAc,UAAW,CACtC,MAAO,CAAE,KAAK,MAAM,QAAU,CAAE,KAAK,OAAO,OAAS,KAAK,SAAS,GAAK,IACzE,EAEA,MAAM4I,EAAa5I,EAAI,UAAU,OACjCA,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CAQH,GAPK,KAAK,YAAY,GAAK,CAAE,KAAK,YAAchuB,EAAE,KAAK,QAAQ,IAAI,0BAA0B,IAC5F,KAAK,WAAa,WAAW,IAAM,CAClC,KAAK,WAAa,KACb,KAAK,SAAW,KAAK,YAAY,GACrC,KAAK,QAAQ,CACf,EAAG,IAAO,KAAK,MAAM,KAAK,OAAO,EAAI,GAAI,CAAC,GAEtC,CAAEA,EAAE,KAAK,QAAQ,IAAI,0BAA0B,EACnD,OAAO,IAET,OAAQsD,EAAK,CACZtD,EAAE,IAAI,QAAQsD,CAAG,EACjBtD,EAAE,IAAI,MAAMsD,CAAG,CAChB,CAEA,OAAOszB,EAAW,KAAK,IAAI,CAC5B,EAEA,KAAK,kBAAkB,YAAY,CACpC,CAAC,EAED,KAAK,eAAe,GAAG,QAAS,KAAK,YAAa,IAAI,EACtD,KAAK,eAAe,GAAG,UAAW,KAAK,cAAe,IAAI,EAE1D,KAAK,eAAe,GAAG,SAAU,KAAK,YAAa,IAAI,EAEvD,KAAK,YAAY,MAAM,CAAC5I,EAAKC,IAAc,CAC1C,KAAK,gBAAgBD,CAAG,EAExB,UAAUD,KAAQE,EAAW,CAC5BF,EAAK,OAAO,OAAO,UAAU,EAE7BA,EAAK,YAAY,EAEjB,MAAM/U,EAAU+U,EAAK,cACpBnlC,EAAQmlC,EAAK,QAAQ,SAAS,eAAe,IAAI/U,CAAO,EAAE,GAAG,UAEzDpwB,GACJ,KAAK,gBAAgBA,CAAK,EAE3BmlC,EAAK,kBAAkB,EAEvBA,EAAK,MAAM,qBAAqB,CAC/B,YAAaA,EAAK,YAClB,UAAWA,CACZ,CAAC,CACF,CACD,CAAC,EAED,KAAK,WAAW,MAAM,CAACC,EAAKC,IAAc,CACzC,KAAK,eAAeD,CAAG,EAEvB,UAAUD,KAAQE,EAAW,CAC5B,MAAMkK,EAAUpK,EAAK,MAAM,kBACtBoK,GACJA,EAAQ,qBAAqBpK,EAAK,aAAa,EAEhDA,EAAK,YAAY,EAEZoK,GACJA,EAAQ,kBAAkBpK,EAAK,aAAa,EAgB7CA,EAAK,MAAM,oBAAoB,CAC9B,iBAAkBA,EAAK,iBACvB,oBAAqBA,EAAK,oBAC1B,eAAgBA,EAAK,eACrB,YAAaA,EAAK,YAClB,wBAAyBA,EAAK,wBAC9B,4BAA6BA,EAAK,4BAClC,SAAUA,EAAK,SACf,UAAWA,EAAK,UAChB,aAAcA,EAAK,aACnB,UAAWA,EAAK,UAChB,WAAYA,EAAK,WACjB,UAAWA,CACZ,CAAC,CACF,CACD,CAAC,EAED,KAAK,uBAAuB,MAAM,CAACC,EAAKC,IAAc,CACrD,MAAMjuB,EAAI,KACT6rC,EAAgB7d,EAAI,UAAU,UAE/BA,EAAI,UAAU,WAAa,UAAW,CACrC,GAAI,KAAK,eACR,OAED,KAAK,eAAiB,GACtB,MAAMD,EAAO,KACP+d,EAAa,KAAK,cACxB,KAAK,cAAgB,SAASjpD,EAAK,CAElC,GAAKmd,EAAE,iBACN,OAAO8rC,EAAW,KAAK,KAAMjpD,CAAG,EAEjC,GAAI,CACH,GAAK,CAAEkrC,EAAK,OAAO,WAAa,CAAElrC,EACjC,OAEDmd,EAAE,0BAA0Bnd,CAAG,EAC/B,MAED,OAAQygB,EAAK,CACZtD,OAAAA,EAAE,IAAI,MAAM,+BAAgCsD,CAAG,EACxCwoC,EAAW,KAAK,KAAMjpD,CAAG,CACjC,CACD,CACD,EAEAmrC,EAAI,UAAU,UAAY,YAAY/lC,EAAM,CAC3C,GAAI,CACH,KAAK,WAAW,CACjB,OAAQqb,EAAK,CACZtD,EAAE,IAAI,MAAM,6CAA8CsD,CAAG,CAC9D,CACA,OAAOuoC,EAAc,KAAK,KAAM,GAAG5jD,CAAI,CACxC,EAEA,UAAU8lC,KAAQE,EACjBF,EAAK,UAAU,CACjB,CAAC,EAED,KAAK,oBAAoB,GAAG,QAAS,KAAK,iBAAkB,IAAI,EAChE,KAAK,oBAAoB,GAAG,SAAU,KAAK,iBAAkB,IAAI,EACjE,KAAK,oBAAoB,GAAG,UAAW,KAAK,mBAAoB,IAAI,EAEpE,KAAK,oBAAoB,MAAM,CAACC,EAAKC,IAAc,CAClD,UAAUF,KAAQE,EACjB,KAAK,iBAAiBF,CAAI,CAC5B,CAAC,EAED,KAAK,eAAe,MAAM,CAACC,EAAKC,IAAc,CAC7C,MAAMjuB,EAAI,KACTi4B,EAAYjK,EAAI,UAAU,kBAC1B4I,EAAa5I,EAAI,UAAU,OAI5BA,EAAI,UAAU,kBAAoB,SAAS1qB,EAAKkN,EAAM,CAErD,MAAM0nB,EAAO,KAAK,MAAM,YAAc,EAMtC,GALKA,EAAO,MACX,KAAK,SAAS,CAAC,WAAYA,EAAO,CAAC,CAAC,EACpCl4B,EAAE,IAAI,KAAK,oBAAqBsD,EAAKkN,EAAM0nB,CAAI,GAG3CD,EACJ,OAAOA,EAAU,KAAK,KAAM30B,EAAKkN,CAAI,CACvC,EAEAwd,EAAI,UAAU,OAAS,UAAW,CACjC,GAAK,KAAK,MAAM,WAAa,EAAI,CAChC,MAAMgK,EAAQh4B,EAAE,KAAK,SAAS,EAC7BgH,EAAgBgxB,GAASA,EAAM,cAEhC,OAAOhxB,EAGAA,EAAc,MAAO,CAC3B,UAAW,kKACZ,EAAG,qCAAqC,EAJhC,IAMT,CAEA,OAAO4vB,EAAW,KAAK,IAAI,CAC5B,EAEA,UAAU7I,KAAQE,EACjB,KAAK,YAAYF,CAAI,CACvB,CAAC,EAED,KAAK,aAAa,GAAG,QAAS,KAAK,gBAAiB,IAAI,EACxD,KAAK,aAAa,GAAG,UAAW,KAAK,kBAAmB,IAAI,EAC5D,KAAK,aAAa,GAAG,SAAU,KAAK,gBAAiB,IAAI,EAEzD,KAAK,aAAa,MAAM,CAACC,EAAKC,IAAc,CAC3C,UAAUF,KAAQE,EACjB,KAAK,gBAAgBF,CAAI,CAC3B,CAAC,EAED,KAAK,cAAc,GAAG,QAAS,KAAK,iBAAkB,IAAI,EAC1D,KAAK,cAAc,GAAG,UAAW,KAAK,mBAAoB,IAAI,EAC9D,KAAK,cAAc,GAAG,SAAU,KAAK,iBAAkB,IAAI,EAE3D,KAAK,gBAAgB,MAAM,CAACC,EAAKC,IAAc,CAC9C,MAAMjuB,EAAI,KACT42B,EAAa5I,EAAI,UAAU,OAE5BA,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CACH,GAAKhuB,EAAE,oBAAsB,CAC5B,MAAMg4B,EAAQh4B,EAAE,KAAK,SAAS,EAC7B7c,EAAMyzC,EAAW,KAAK,IAAI,EAC1Bl0B,EAAQvf,GAAK,OAAO,SAErB,OAAK,MAAM,QAAQuf,CAAK,GACvBA,EAAM,KAAKs1B,EAAM,cAAch4B,EAAE,mBAAmB,CAAC,EAE/C7c,CACR,CACD,MAAa,CAEb,CAEA,OAAOyzC,EAAW,KAAK,IAAI,CAC5B,EAEA,UAAU7I,KAAQE,EACjBF,EAAK,YAAY,CACnB,CAAC,EAED,KAAK,cAAc,MAAM,CAACC,EAAKC,IAAc,CAC5C,MAAMjuB,EAAI,KACT42B,EAAa5I,EAAI,UAAU,OAC3BiK,EAAYjK,EAAI,UAAU,kBAE3BA,EAAI,UAAU,UAAY,UAAW,CACpC,GAAKhuB,EAAE,KAAK,QAAQ,IAAI,sBAAsB,EAC7C,OAAO42B,EAAW,KAAK,IAAI,EAE5B,MAAMhY,EAAK,KAAK,MAAM,aACtB,KAAK,MAAM,aAAe,KAC1B,IAAIh4B,EAEJ,GAAI,CACHA,EAASgwC,EAAW,KAAK,IAAI,CAC9B,OAAQtzB,EAAK,CACZ,WAAK,MAAM,aAAesb,EACpBtb,CACP,CAEA,YAAK,MAAM,aAAesb,EACnBh4B,CACR,EAEAonC,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CACH,GAAKhuB,EAAE,sBAAwB,CAC9B,MAAMg4B,EAAQh4B,EAAE,KAAK,SAAS,EAC7B7c,EAAM,KAAK,UAAU,EACrBuf,EAAQvf,GAAK,OAAO,UAAU,OAAO,SAEtC,OAAK60C,GAAS,MAAM,QAAQt1B,CAAK,GAChCA,EAAM,KAAKs1B,EAAM,cAAch4B,EAAE,qBAAqB,CAAC,EAEjD7c,CACR,CAED,MAAa,CAEb,CAEA,OAAO,KAAK,UAAU,CACvB,EAIA6qC,EAAI,UAAU,kBAAoB,SAAS1qB,EAAKkN,EAAM,CAErD,MAAM0nB,EAAO,KAAK,MAAM,YAAc,EAMtC,GALKA,EAAO,MACX,KAAK,SAAS,CAAC,WAAYA,EAAO,CAAC,CAAC,EACpCl4B,EAAE,IAAI,KAAK,8BAA+BsD,EAAKkN,EAAM0nB,CAAI,GAGrDD,EACJ,OAAOA,EAAU,KAAK,KAAM30B,EAAKkN,CAAI,CACvC,EAGA,UAAUud,KAAQE,EACjB,KAAK,iBAAiBF,CAAI,CAC5B,CAAC,EAED,KAAK,QAAQ,GAAG,kBAAmBnrB,GAAS,CAC3C,GAAKA,EAAM,SAAW,+BAAiC,KAAK,iBAC3D,OAED,GAAKA,EAAM,SAAW,yBAA2B,CAChD,KAAK,IAAI,MAAM,cAAeA,CAAK,EACnC,MACD,CAEA,MAAMwb,EAAU,KAAK,YAAY,MAChC9e,EAAUsD,EAAM,QAChBxM,EAAOkJ,GAAS,MAAM,WAClB,CAAEA,GAAW,CAAE8e,GAAW9e,EAAQ,OAAS,mBAAqB8e,EAAQ,MAAM,WAAahoB,GAAM,YAGtG,KAAK,0BAA0BkJ,CAAO,CACvC,CAAC,CACF,CAEA,0BAA0Bzc,EAAK,CAC9B,MAAMu7B,EAAU,KAAK,YAAY,MAChChoB,EAAOvT,GAAK,MAAM,WAClBwB,EAAOxB,GAAK,KACZkpD,EAAa1nD,IAAS,kBACtB2nD,EAAoB3nD,IAAS,4BAK9B,GAHK,CAAE+R,GAAM,QAAU,CAAEgoB,GAAY,CAAC4tB,GAAqB,CAACD,GAAe3tB,EAAQ,MAAM,WAAahoB,GAAM,YAGvG21C,GAAc31C,EAAK,YAAgB41C,GAAqB51C,EAAK,OAAO,cAAgB,cACxF,OAED,IAAI61C,EACAD,EACHC,EAAW,GAAG,KAAK,MAAM,SAAS,IAAI71C,EAAK,OAAO,WAAW,GAE7D61C,EAAW71C,EAAK,OAAO,GAExB,MAAMikC,EAASjc,EAAQ,MAAM,UAAU6tB,CAAQ,EACxC5R,IAGF,KAAK,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,qBAAqB,GAG/E,KAAK,qBAAuBjkC,EAAK,KAGtC,KAAK,mBAAqBA,EAAK,GAE/BgoB,EAAQ,4BAA4B,CAAC,EAAG,CACvC,GAAIhoB,EAAK,GACT,KAAM,KAAK,WAAW,QACtB,SAAU,SACV,WAAYikC,EACZ,wBAAsB,MAAoBA,CAAM,EAChD,aAAc,CAAC,EACf,KAAM,CACL,GAAIjkC,EAAK,KAAK,GACd,MAAOA,EAAK,KAAK,MACjB,YAAaA,EAAK,KAAK,YACxB,EACA,UAAW,IAAI,KAAKvT,EAAI,KAAK,WAAauT,EAAK,WAAW,EAAE,QAAQ,CACrE,CAAC,GACF,CAGA,kBAAkB/R,EAAM,CACvB,GAAK,CAAEA,EACN,OAEDA,EAAOgmD,GAAqBhmD,CAAI,GAAKA,EAAK,QAAQ,KAAM,GAAG,EAE3D,MAAM6nD,EAAM,KAAK,eAAiB5B,GACjC6B,EAAU,KAAK,KAAK,QAAQ,IAAI,iCAAiC,EAoBlE,MAlBK,GAAAA,GAAWA,EAAQ,IAAI9nD,CAAI,GAG3BA,IAAS6nD,EAAI,wBACjB,CAAE,KAAK,KAAK,QAAQ,IAAI,2BAA2B,GAI/C7nD,IAAS6nD,EAAI,eACjB,CAAE,KAAK,KAAK,QAAQ,IAAI,oBAAoB,GAIxC7nD,IAAS,mBACb,CAAE,KAAK,KAAK,QAAQ,IAAI,2BAA2B,GAI/CA,IAAS,6BACb,CAAE,EAAE,KAAK,QAAQ,IAAI,wBAAwB,EAK/C,CAGA,gBAAiB,CAChB,KAAK,qBAAqB,EAC1B,KAAK,qBAAqB,CAC3B,CAGA,sBAAuB,CACtB,UAAU0pC,KAAQ,KAAK,cAAc,UACpC,KAAK,gBAAgBA,CAAI,CAC3B,CAEA,gBAAgBA,EAAM,CACrB,MAAM1kB,EAAQ0kB,EAAK,MAClBnrB,EAAQyG,GAAO,MACfhlB,EAAOue,GAAO,KAKV,KAAK,kBAAkBve,CAAI,IAC1B0pC,EAAK,MAAM,OACfA,EAAK,MAAM,EAEXA,EAAK,KAAK,GAIP1pC,IAAS,eAAiB,CAAEglB,EAAM,QAAU,KAAK,KAAK,QAAQ,IAAI,iBAAiB,GAAK,CAAE0kB,EAAK,cACnG,KAAK,IAAI,KAAK,sCAAsC,EACpDA,EAAK,YAAc,GACnBA,EAAK,IAAI,GAIL1pC,IAAS,QACb,KAAK,cAAc0pC,CAAI,CACzB,CAEA,sBAAuB,CACtB,UAAUA,KAAQ,KAAK,cAAc,UACpC,KAAK,gBAAgBA,CAAI,CAC3B,CAEA,gBAAgBA,EAAM,CAErB,GAAKA,EAAK,MAAM,SACf,OAED,MAAMqe,EAAmBre,EAAK,OAAO,OAAO,SAAS,iBACpDnrB,EAAQwpC,GAAkB,OAASre,EAAK,OAAO,MAC/C1pC,EAAOue,GAAO,KAKf,GAAK,KAAK,kBAAkBve,CAAI,GAAK,KAAK,kBAAkB0pC,EAAK,OAAO,OAAO,YAAY,EAAI,CAC9FA,EAAK,SAAS,CAAC,SAAU,EAAI,CAAC,EAC9B,MACD,CAGA,GAAK1pC,IAAS,eAAiB,KAAK,KAAK,QAAQ,IAAI,iBAAiB,GAAK,CAAE0pC,EAAK,YAAc,CAC/F,MAAMse,EAAQD,GAAkB,MAC3BC,IACJ,KAAK,IAAI,KAAK,sCAAsC,EACpDte,EAAK,YAAc,GACdA,EAAK,wBACTA,EAAK,wBAAwBse,CAAK,EAAE,EAEpCA,EAAM,EAET,CAGKhoD,IAAS,QACb,KAAK,cAAc0pC,CAAI,CACzB,CAGA,cAAcA,EAAM,CAInB,IAHcA,EAAK,OAAO,OAAO,SAAS,kBAAkB,OAASA,EAAK,OAAO,QAClE,OAED,QAAUA,EAAK,eAAiB,CAAE,KAAK,KAAK,QAAQ,IAAI,yBAAyB,EAC9F,OAGDA,EAAK,cAAgB,GAGN,KAAK,QAAQ,MAAM,EAAE,aACnC,+DACA,KAAK,KAAK,YAAYA,CAAI,EAC1B,GACD,EAEO,KAAK5lB,GAAO,CAClB4lB,EAAK,cAAgB,GAMhB1pC,GAHS0pC,EAAK,OAAO,OAAO,SAAS,kBAAkB,OAASA,EAAK,OAAO,QAClE,OAED,QAAU,CAAE,KAAK,KAAK,QAAQ,IAAI,yBAAyB,IAGzE5lB,EAAI,MAAM,CAEX,CAAC,EAAE,MAAM,IAAM,CACd4lB,EAAK,cAAgB,EACtB,CAAC,CACF,CAGA,mBAAmBA,EAAM,CACxB,GAAKA,EAAK,aACT,OAAO,KAAK,YAAYA,CAAI,EAE7BA,EAAK,aAAe,GAEpB,MAAM/tB,EAAI,KACTssC,EAAkBve,EAAK,eAExBA,EAAK,eAAiB,SAASnrB,KAAU3a,EAAM,CAC9C,MAAMskD,EAAUxe,EAAK,OAASA,EAAK,MAAM,MAAQA,EAAK,MAAM,KAAK,GACjE,OAAKnrB,GAASA,EAAM,MAAQ2pC,GAC3BvsC,EAAE,aAAa,IAAIusC,CAAO,EAEpBD,EAAgB,KAAK,KAAM1pC,EAAO,GAAG3a,CAAI,CACjD,EAEA,KAAK,YAAY8lC,CAAI,CACtB,CAEA,YAAYA,EAAM,CACZA,EAAK,eAGVA,EAAK,aAAe,WAAW,IAAM,CAGpC,GAFAA,EAAK,aAAe,KAEfA,EAAK,OAASA,EAAK,MAAM,MAAQ,CAAEA,EAAK,eAAiBA,EAAK,qBAAuB,CACzF,MAAM3pC,EAAK2pC,EAAK,MAAM,KAAK,GAC3B,GAAK,KAAK,aAAa,IAAI3pC,CAAE,EAC5B,OAED,IAAIooD,EAAQ,KAAK,SAAS,IAAI,2BAA2B,EAEzD,GAAK,CAAEA,EAAQ,CACd,MAAML,EAAU,KAAK,SAAS,IAAI,yCAAyC,EAI3E,GAHKA,IAAape,EAAK,MAAM,KAAK,aAAeoe,EAAQ,KAAKpe,EAAK,MAAM,KAAK,WAAW,GAAOA,EAAK,MAAM,KAAK,mBAAqBoe,EAAQ,KAAKpe,EAAK,MAAM,KAAK,iBAAiB,KAClLye,EAAQ,IAEJ,CAAEA,EACN,MACF,CAEA,KAAK,IAAI,KAAK,8BAA+BpoD,CAAE,EAC/C2pC,EAAK,gBAAgB,CACtB,CACD,CAAC,EACF,CAEA,iBAAkB,CACjB,MAAM0e,EAAS,KAAK,KAAK,QAAQ,IAAI,gBAAgB,EACpDv2B,EAAU,KAAK,KAAK,QAAQ,IAAI,wBAAwB,EAEzD,KAAK,WAAW,OAAO,iBAAkBA,GAAW,CAAEu2B,CAAM,EAC5D,KAAK,WAAW,OAAO,oBAAqBv2B,GAAWu2B,CAAM,CAC9D,CAEA,iBAAkB,CACjB,MAAM1R,EAAQ,CACb,mBAAsB,KAAK,KAAK,QAAQ,IAAI,uBAAuB,EACnE,UAAa,KAAK,KAAK,QAAQ,IAAI,gBAAgB,EACnD,WAAc,KAAK,KAAK,QAAQ,IAAI,yBAAyB,EAC7D,WAAc,KAAK,KAAK,QAAQ,IAAI,yBAAyB,EAC7D,KAAQ,KAAK,KAAK,QAAQ,IAAI,oBAAoB,EAClD,YAAe,KAAK,KAAK,QAAQ,IAAI,6BAA6B,EAClE,oBAAqB,KAAK,KAAK,QAAQ,IAAI,oBAAoB,EAC/D,YAAe,KAAK,KAAK,QAAQ,IAAI,0BAA0B,CAChE,EAEMpgB,EAAa,KAAK,iBAAiB,WACzC,GAAO,MAAM,QAAQA,CAAU,EAG/B,UAAUpY,KAASoY,EAAY,CAC9B,GAAK,CAAEpY,GAAS,CAAEA,EAAM,OAAS,CAAEA,EAAM,GACxC,SAED,MAAMle,EAAOke,EAAM,MAAM,KACpBle,MAAQ,OAAI02C,EAAO12C,CAAI,GAAK,CAAE02C,EAAM12C,CAAI,IAK5C,KAAK,IAAI,KAAK,iCAAkCA,EAAM,IAAKke,EAAM,EAAE,EACnE,KAAK,mBAAmB,CACvB,KAAM,mBACN,GAAIA,EAAM,EACX,CAAC,GAGEle,IAAS,qBACZke,EAAM,MAAM,aAAe,2DAC3B,KAAK,KAAK,QAAQ,IAAI,6BAA6B,IAEnD,KAAK,IAAI,KAAK,iCAAkCle,EAAM,IAAKke,EAAM,EAAE,EACnE,KAAK,mBAAmB,CACvB,KAAM,mBACN,GAAIA,EAAM,EACX,CAAC,EAGH,CACD,CAEA,eAAgB,CACf,MAAMc,EAAQ,KAAK,cACfA,GAAO,eAAe,OAAO,MAAQ,KAAK,kBAAkBA,EAAM,cAAc,MAAM,IAAI,GAC7FA,EAAM,aAAa,EAEhBA,GAAO,WAAW,CAAC,GAAG,OAAO,MAAQ,KAAK,kBAAkBA,EAAM,SAAS,CAAC,EAAE,MAAM,IAAI,GAC3FA,EAAM,iBAAiBA,EAAM,SAAS,CAAC,EAAE,MAAM,IAAI,CACrD,CAEA,eAAgB,CACf,GAAK,KAAK,uBAAyB,KAAK,oBACvC,MAAO,GAER,MAAMrD,EAAI,KACTg4B,EAAQ,KAAK,KAAK,SAAS,EAC3BhxB,EAAgBgxB,GAAO,cACvB0U,EAAW,KAAK,UAAU,UAAU,gBAAgB,EACpDC,EAAa,KAAK,UAAU,UAAU,cAAc,EAErD,OAAO3lC,GAGF,CAAE,KAAK,qBAAuB2lC,IAClC,KAAK,oBAAsB,UAAW,CACrC,MAAMtpC,EAAQ20B,EAAM,WAAW2U,EAAW,KAAK,EAE/C3sC,OAAAA,EAAE,cAAgBqD,EAClBrD,EAAE,cAAc,EACT,IACR,EAEA,KAAK,gBAAgB,YAAY,GAG7B,CAAE,KAAK,uBAAyB0sC,IACpC,KAAK,sBAAwB,UAAW,CACvC,MAAMrpC,EAAQ20B,EAAM,WAAW0U,EAAS,KAAK,EAC5CE,EAAW5U,EAAM,WAAW0U,EAAS,QAAQ,EAE9C1sC,OAAAA,EAAE,gBAAkBqD,EACpBrD,EAAE,mBAAqB4sC,EAEvB5sC,EAAE,gBAAgB,EAEX,IACR,EAEA,KAAK,cAAc,YAAY,GAGzB,IA9BC,EA+BT,CAGA,gBAAgBpX,EAAO,CACtB,MAAMu4C,EAAY,KAAK,KAAK,QAAQ,IAAI,oBAAoB,GAAK,CAAC,KAC7D,eAAYv4C,EAAOu4C,CAAS,IAGjC,KAAK,KAAK,QAAQ,cAAc,CAC/B,WAAYv4C,CACb,CAAC,EAED,KAAK,MAAM,YAAY,EACxB,CAGA,iBAAkB,CACX,KAAK,eACV,KAAK,aAAe,WAAW,IAAM,KAAK,iBAAiB,EAAG,CAAC,EACjE,CAEA,kBAAmB,CACb,KAAK,cACT,aAAa,KAAK,YAAY,EAC/B,KAAK,aAAe,KAEpB,KAAK,IAAI,KAAK,sDAAsD,EACpE,MAAMmlC,EAAO,KAAK,cAAc,MAC3BA,GACJ,KAAK,iBAAiBA,EAAMA,EAAK,KAAK,CACxC,CAGA,eAAeC,EAAK,CACnB,GAAKA,EAAI,UAAU,cAClB,OAED,MAAMhuB,EAAI,KACT6sC,EAAY7e,EAAI,UAAU,MAC1B8e,EAAY9e,EAAI,UAAU,iBAC1B+e,EAAY/e,EAAI,UAAU,kBAE3BA,EAAI,UAAU,YAAc,UAAW,CACtC,GAAK,KAAK,eACT,OAED,KAAK,eAAiB,GAEtB,MAAMD,EAAO,KACZ+d,EAAa/d,EAAK,cAClB1V,EAAU0V,EAAK,MAAM,oBAEtBA,EAAK,MAAM,oBAAsB,SAASif,EAAK,CAC9C,OAAKA,IACJA,EAAI,UAAYjf,GAEV1V,EAAQ20B,CAAG,CACnB,EAEAjf,EAAK,cAAgB,SAASlrC,EAAK,CAClC,GAAKA,EACJ,GAAI,CACH,MAAMk4C,EAAQ/6B,EAAE,YAAc,CAAC,EAC9BitC,GAAYjtC,EAAE,WAAa,CAAC,EAS7B,GARiBA,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAE/C,IAAI+6B,EAAMl4C,EAAI,IAAI,CAAC,GAGjCA,EAAI,OAASk4C,EAAM,qBAAuB,IAAE,MAAgBl4C,EAAI,MAAM,GAGtEA,EAAI,OAASk4C,EAAM,YAAc,CAAE/6B,EAAE,KAAK,QAAQ,IAAI,wBAAwB,EAClF,OAED,GAAKnd,EAAI,OAASk4C,EAAM,QAAU,CACjC,MAAM5xC,GAAI6W,EAAE,KAAK,mBAAmBnd,CAAG,EACtC0rC,EAAOR,EAAK,gBAAkBA,EAAK,gBAAgB,EAEpD,IAAIpgB,GAAUxkB,GAAE,OAASA,GAAE,OAASA,GAAE,OAASolC,GAAM,OAAO,UACxDtoB,GAAO9c,GAAE,UAAYA,GAAE,UAAYA,GAAE,UAAYA,GAAE,QAAUA,GAAE,QAAQ,MAAM,CAAC,EAAIolC,GAAM,OAAO,aAEnG,GAAK,CAAEtoB,IAAQ0H,GAAU,CACxB,MAAMxN,GAAIH,EAAE,KAAK,QAAQ2N,GAAS,KAAM,EAAI,EACvCxN,IAAKA,GAAE,QACX8F,GAAO9c,GAAE,UAAYgX,GAAE,MACzB,CAEA,GAAK,CAAEwN,IAAW1H,GAAO,CACxB,MAAM9F,GAAIH,EAAE,KAAK,QAAQ,KAAMiG,GAAM,EAAI,EACpC9F,IAAKA,GAAE,KACXwN,GAAUxkB,GAAE,OAASgX,GAAE,GACzB,CAEA,MAAME,GAAIL,EAAE,KAAK,QAAQ,EAOzB,GANKK,IAAKkuB,IACTluB,GAAE,UAAYkuB,EAAK,MAAM,uBACzBluB,GAAE,MAAQkuB,EAAK,MAAM,SAGtBplC,GAAE,WAAaA,GAAE,YAAc6W,EAAE,KAAK,gBAAgB7W,GAAGkX,GAAG,EAAI,EAC3DlX,GAAE,YACN,OAED,GAAK6W,EAAE,aAAa,sBAAsB,EAAI,CAC7C,MAAM4C,GAAQ5C,EAAE,UAAU,CACzB,QAAS7W,GACT,KAAA4kC,EACA,QAAS9nB,GACT,UAAW0H,EACZ,CAAC,EAGD,GADA3N,EAAE,KAAK,uBAAwB4C,EAAK,EAC/BA,GAAM,kBAAoBzZ,GAAE,YAChC,MACF,CAED,SAGetG,EAAI,OAASk4C,EAAM,YAIjC,GAHA/6B,EAAE,KAAK,gBAAiBnd,EAAI,eAAgBA,EAAI,UAAWA,EAAI,gBAAiBA,CAAG,EAG9E,CAAEkrC,EAAK,MAAM,uBAAyB,CAC1C,MAAM1pC,GAAOxB,EAAI,eAChB4J,EAAS5J,EAAI,UAGd,IAAIqqD,GAaJ,GAZK7oD,KAAS4oD,GAAU,IACvBC,GAAM,MACG7oD,KAAS4oD,GAAU,QAC5BC,GAAM,UACG7oD,KAAS4oD,GAAU,SAC5BC,GAAM,UAEFA,KACJrqD,EAAI,qBAAuBqqD,IAIvB,CAAEnf,EAAK,eAAe,IAAIthC,CAAM,GAAKpI,KAAS4oD,GAAU,OAAS,CACrElf,EAAK,gBACJ,CACCA,EAAK,OACLA,EAAK,qBAAqB,IAAIjuB,IAAKA,GAAE,KAAK,CAC3C,EACArT,EACA5J,CACD,EAEAkrC,EAAK,qBAAqB,KAAK,CAC9B,MAAOlrC,EACP,KAAM,KAAK,IAAI,EACf,YAAa,EACd,CAAC,EAED,MACD,CACD,OAiGcA,EAAI,OAASk4C,EAAM,QAC5B/6B,EAAE,KAAK,QAAQ,IAAI,6BAA6B,EACpDnd,EAAM,CACL,KAAMk4C,EAAM,KACZ,QAAS/6B,EAAE,KAAK,EAAE,oBAAqB,sDAAsD,CAC9F,EAEAA,EAAE,KAAK,kBAAmBnd,CAAG,EAGhC,OAAQygB,EAAK,CACZtD,EAAE,IAAI,MAAM,+BAAgCsD,CAAG,EAC/CtD,EAAE,IAAI,QAAQsD,EAAK,CAAC,MAAO,CAAC,IAAAzgB,CAAG,CAAC,CAAC,CAClC,CAGD,OAAOipD,EAAW,KAAK/d,EAAMlrC,CAAG,CACjC,EA0DAkrC,EAAK,UAAY,SAASof,EAAQ,CAC5Bpf,EAAK,SAAWof,IAGrBpf,EAAK,OAASof,EACPA,IACNpf,EAAK,iBAAmB,KAAK,IAAIA,EAAK,OAAO,OAAQ/tB,EAAE,KAAK,QAAQ,IAAI,wBAAwB,CAAC,EAC1F+tB,EAAK,MAAM,cACjBA,EAAK,kBAAkB,GAE1B,EAEAA,EAAK,UAAY,UAAW,CAC3B,GAAK,CAAEA,EAAK,aAAa,EACxB,OAED,MAAM9gC,EAAM,KAAK,IAAI8gC,EAAK,OAAO,OAAQA,EAAK,iBAAmB,EAAE,EAClE3qC,EAAQ,KAAK,IAAI,EAAG6J,EAAM+S,EAAE,KAAK,QAAQ,IAAI,wBAAwB,CAAC,EAEvE+tB,EAAK,MAAMA,EAAK,OAAO,OAAS3qC,CAAK,EACrC2qC,EAAK,iBAAmB9gC,EAAM7J,EACvB2qC,EAAK,MAAM,cACjBA,EAAK,kBAAkB,CACzB,EAEAA,EAAK,WAAa,UAAW,CAC5B,GAAK,CAAEA,EAAK,aAAa,EACxB,OAED,MAAMqf,EAAWptC,EAAE,KAAK,QAAQ,IAAI,wBAAwB,EAE5D+tB,EAAK,MAAMqf,CAAQ,EACnBrf,EAAK,iBAAmB,KAAK,IAAIqf,EAAUrf,EAAK,OAAO,MAAM,EACtDA,EAAK,MAAM,cACjBA,EAAK,kBAAkB,CACzB,EAEAA,EAAK,YAAc,UAAW,CAC7B,OAAOA,EAAK,OAAO,MAAM,EAAGA,EAAK,kBAAoBA,EAAK,WAAa,EAAE,CAC1E,CACD,EAEAC,EAAI,UAAU,kBAAoB,UAAW,CAC5C,GAAI,CACH,KAAK,YAAY,CAClB,OAAQ1qB,EAAK,CACZtD,EAAE,IAAI,MAAM,kDAAmDsD,CAAG,CACnE,CAEA,OAAOypC,EAAU,KAAK,IAAI,CAC3B,EAEA/e,EAAI,UAAU,MAAQ,SAAS5Y,EAAO,CACrC,GAAI,CACEA,GAAS,OACbA,EAAQ,GAET,MAAMg4B,EAAWptC,EAAE,KAAK,QAAQ,IAAI,wBAAwB,EAI5D,GAHK,CAAE,KAAK,SAAS,GAAKoV,EAAQg4B,IACjCh4B,EAAQg4B,GAEJh4B,GAAS,EACb,KAAK,UAAY,EACjB,KAAK,OAAS,CAAC,EACf,KAAK,qBAAuB,CAAC,EAC7B,KAAK,OAAS,OAER,CACN,MAAMi4B,EAAS,KAAK,OACnB7wB,EAAKxc,EAAE,YAAcmqC,GACrB19C,EAAS4gD,EAAO,OAASj4B,EAE1B,GAAK3oB,EAAS,EAAI,CACjB,IAAI8Y,GAAU,EAAG+nC,GACjB,QAAQ/4C,GAAE,EAAGA,GAAI9H,EAAQ8H,KACnB84C,EAAO94C,EAAC,GAAK,CAAE61C,GAAW,SAAS5tB,EAAG6wB,EAAO94C,EAAC,EAAE,IAAI,CAAC,IACzDgR,KACA+nC,GAAO/4C,IAKT,KAAK,OAAS84C,EAAO,MAAM9nC,GAAU,IAAM,EAAI,KAAK,IAAI9Y,EAAS,EAAG6gD,EAAI,EAAI7gD,CAAM,EAClF,KAAK,UAAY4gD,EAAO,OAASj4B,CAElC,MACC,KAAK,UAAY,EACjB,KAAK,OAAS,KAAK,OAAO,MAAM,CAAC,EAG7B,KAAK,QAAU,KAAK,OAAO,QAAU,KACzC,KAAK,UAAU,EAAK,CACtB,CACD,OAAQ9R,EAAK,CACZtD,OAAAA,EAAE,IAAI,MAAM,sBAAuBsD,CAAG,EAC/BupC,EAAU,KAAK,KAAMz3B,CAAK,CAClC,CACD,EAEA4Y,EAAI,UAAU,gBAAkB,UAAW,CAC1C,GAAK,KAAK,eACT,OAAO,KAAK,eAEb,MAAM/rB,EAAM,KAAK,IAAI,EACrB,GAAKA,GAAO,KAAK,oBAAsB,GAAK,IAAO,CAClD,KAAK,mBAAqBA,EAC1B,MAAMS,EAAQ1C,EAAE,oBAAoB,MACpC,GAAK0C,GAAO,OAAO,kBAAkB,YAAc,KAClD,OAAO,KAAK,eAAiBA,CAC/B,CACD,EAEAsrB,EAAI,UAAU,iBAAmB,UAAW,CAC3C,GAAI,CACH,MAAM7qC,EAAM,CAAC,EACZq5B,EAAKxc,EAAE,YAAcmqC,GACrBloC,EAAM,KAAK,IAAI,EACfsrC,EAAYvtC,EAAE,KAAK,QAAQ,IAAI,YAAY,EAC3CwtC,EAAQD,IAAc,GAAK,KAAK,cAAgBA,EAChD14B,GAAQ5S,EAAMurC,EACdC,GAAc,KAAK,oCAAsC,KAAK,OAAS,KAAK,MAAM,mCAClFC,GAAY,KAAK,aAAa,EAC9BP,EAAS,KAAK,SAAS,EACvBC,GAAWptC,EAAE,KAAK,QAAQ,IAAI,wBAAwB,EACtDqjB,GAAYrjB,EAAE,KAAK,QAAQ,IAAI,+BAA+B,EAE9D2tC,GAAa3tC,EAAE,aAAa,qBAAqB,EAElD,IAAIyC,GAAQ,EACXmrC,GAAW,KAAK,iBAChBhoC,GAAU,GACVhD,GAED,UAAU/f,MAAO,KAAK,qBACrB,GAAKA,GAAI,MAAQgyB,IAAS,CAAEhyB,GAAI,YAAc,CAC7C,GAAKwgC,KAAc,IAAMA,GAAY,GAAK,CAAEoqB,KAAgB,KAAK,YAAY5qD,GAAI,KAAK,GAAKA,GAAI,MAAM,QACpG,SAED,GAAK8qD,GAAa,CACjB,GAAO/qC,GAoBNA,GAAM,OAAO,MApBC,CACdA,GAAQ5C,EAAE,UAAU,CACnB,KAAM,KACN,QAAS,OACT,UAAW,OACX,QAAS,MACV,CAAC,EAED,MAAMuuB,GAAO,KAAK,gBAAkB,KAAK,gBAAgB,EACxD5gB,GAAU4gB,IAAQA,GAAK,MAAM,UAI9B,GAFA3rB,GAAM,UAAY+K,GAEbA,GAAU,CACd,MAAMxN,GAAIH,EAAE,KAAK,QAAQ2N,GAAS,KAAM,EAAI,EACvCxN,IAAKA,GAAE,QACXyC,GAAM,QAAUzC,GAAE,MACpB,CAED,CAKA,GAFAyC,GAAM,QAAU/f,GAAI,MACpBmd,EAAE,KAAK,sBAAuB4C,EAAK,EAC9BA,GAAM,kBAAoB/f,GAAI,MAAM,YACxC,QACF,CAEA,MAAMyqD,GAAO,KAAK,OAAO,KAAK,OAAO,OAAS,CAAC,EAC9CjpD,GAAOipD,IAAM,KAGb,CAAE,KAAK,MAAM,6BACZ,CAAE,KAAK,MAAM,oBACbjpD,KAASm4B,EAAG,WACZ35B,GAAI,MAAM,OAAS25B,EAAG,WACtB,KAAK,OAAO,KAAK1c,IAAKA,GAAE,OAAS0c,EAAG,oBAAoB,GAEzD,KAAK,OAAO,KAAK,CAChB,KAAMA,EAAG,qBACT,GAAI,wBACL,CAAC,EAWF,KAAK,OAAO,KAAK35B,GAAI,KAAK,EAC1B+iB,GAAU,GAEH,KAAK,SACN,KAAK,OAAO,OAASwnC,GACzB3qC,KAEAmrC,KAGH,MACCzqD,EAAI,KAAKN,EAAG,EAGd,KAAK,qBAAuBM,EACvByiB,KACJ,KAAK,MAAM,KAAK,IAAI,IAAK,KAAK,OAAO,OAASnD,EAAK,CAAC,EAC7CA,KAAU,GAAKmrC,KAAa,KAAK,kBAAoBF,KAAc,KAAK,aAAa,GAAKP,IAAW,KAAK,SAAS,IACzH,KAAK,iBAAmBS,GACjB,KAAK,MAAM,cACjB,KAAK,kBAAkB,IAIrB,KAAK,uBACT,KAAK,sBAAsB,CAE7B,OAAQtqC,EAAK,CACZtD,OAAAA,EAAE,IAAI,MAAM,uBAAwBsD,CAAG,EAChCwpC,EAAU,KAAK,IAAI,CAC3B,CACD,CACD,CAGA,UAAU7mC,EAAM3G,EAAS,CACxB,GAAK,CAAE2G,EACN,MAAO,GAEHA,EAAK,WAAW,GAAG,IACvBA,EAAOA,EAAK,MAAM,CAAC,GAEpBA,EAAOA,EAAK,YAAY,EAExB,UAAU8nB,KAAQ,KAAK,YAAY,UAClC,GAAK9nB,IAAS,KAAO8nB,EAAK,MAAM,aAAa,YAAY,IAAM9nB,EAAO,CACrE,GAAK,OAAO3G,GAAY,SACvByuB,EAAK,WAAW,CACf,MAAO,KAAK,YAAcoc,IAAY,OACtC,QAAA7qC,CACD,CAAC,MACG,CACJ,MAAM+J,EAAQ0kB,EAAK,MAClBjW,EAAQzO,EAAM,aACdjlB,EAAKilB,EAAM,UAEP/J,EAAQ,cACD,KAAM,MAEhB,KAAQ,GAGVyuB,EAAK,WAAW,CACf,MAAO,KAAK,YAAcoc,IAAY,QACtC,QAAS,IAAIryB,CAAK,GAClB,OAAQ1zB,EACR,UAAW0zB,EACX,GAAI,iBAAc,gBAAa,CAAC,GAChC,SAAU,SACV,eAAgB,GAChB,SAAUxY,EACV,QAAS,KACT,aAAc,CAAC,EACf,UAAW,KAAK,IAAI,EACpB,KAAM,CACL,OAAQlb,EACR,UAAW0zB,CACZ,CACD,CAAC,CACF,CAEA,MAAO,EACR,CAGD,MAAO,EACR,CAGA,YAAY7R,EAAM3G,EAAS,CAC1B,MAAM8e,EAAU,KAAK,YAAY,MAEjC,GAAK,CAAEA,GAAW,CAAEnY,EACnB,OAAO,KAKR,GAHKA,EAAK,WAAW,GAAG,IACvBA,EAAOA,EAAK,MAAM,CAAC,GAEfA,EAAK,YAAY,IAAMmY,EAAQ,MAAM,aAAa,YAAY,EAClE,OAAOA,EAAQ,OAAO,YAAYnY,EAAM3G,CAAO,EAEhD8e,EAAQ,YAAY9e,CAAO,CAC5B,CAGA,gBAAgBq7B,EAAS,CACjBA,EAAQ,OAGVA,EAAQ,SAGbA,EAAQ,OAAS,WAAW,IAAM,sBAAsB,IAAM,CAC7DA,EAAQ,OAAS,KACZA,EAAQ,MACZA,EAAQ,KAAK,YAAY,CAC3B,CAAC,EAAG,GAAG,GACR,CAGA,gBAAgB3M,EAAK,CACpB,MAAMhuB,EAAI,KACT+sC,EAAY/e,EAAI,UAAU,kBAC1B6f,EAAc7f,EAAI,UAAU,kBAE7BA,EAAI,UAAU,cAAgB,GAE9BA,EAAI,UAAU,YAAc,UAAW,CACtC,GAAK,KAAK,eACT,OAED,KAAK,eAAiB,GAEtB,MAAMD,EAAO,KACZ+f,EAAW,KAAK,YAChBC,EAAa,MAAI9lD,IAAS8lC,EAAK,WAAW,GAAG9lC,CAAI,EAApC,cACb+lD,EAAc,GAACnrD,EAAKgjB,IAAUkoB,EAAK,YAAYlrC,EAAKgjB,CAAK,EAA3C,eAEfkoB,EAAK,YAAc,SAASlrC,EAAKgjB,EAAO,CAGvC,GAFAhjB,EAAMA,EAAI,QAAQ,OAAQ,GAAG,EAExBA,EAAI,WAAW,OAAO,EAAI,CAC9BA,EAAMA,EAAI,MAAM,CAAC,EAAE,KAAK,EACxB,MAAMkf,GAAMlf,EAAI,QAAQ,GAAG,EAC3B,IAAIorD,GACClsC,KAAQ,IACZksC,GAASprD,EACTA,EAAM,KAENorD,GAASprD,EAAI,MAAM,EAAGkf,EAAG,EACzBlf,EAAMA,EAAI,MAAMkf,GAAM,CAAC,EAAE,UAAU,GAGpC,MAAMa,EAAQ5C,EAAE,UAAU,CACzB,QAASiuC,GACT,QAASprD,EACT,MAAAgjB,EACA,QAAS7F,EAAE,KAAK,QAChB,QAAS+tB,EAAK,MAAM,aACpB,MAAOA,EACP,WAAAggB,EACA,YAAAC,CACD,CAAC,EAEKjY,GAAQ,oBAAoBkY,EAAM,GAGxC,OAFajuC,EAAE,UAAU+1B,EAAK,GAEd,OAAS,EACxB/1B,EAAE,KAAK+1B,GAAOnzB,CAAK,EAEnBmrB,EAAK,WAAW,CACf,KAAM/tB,EAAE,WAAW,OACnB,QAASA,EAAE,KAAK,EAAE,2BAA4B,iCAAkC,CAAC,OAAAiuC,EAAM,CAAC,CACzF,CAAC,EAEK,EACR,CAEA,MAAMrrC,GAAQ5C,EAAE,UAAU,CACzB,QAASnd,EACT,MAAAgjB,EACA,QAAS7F,EAAE,KAAK,QAChB,QAAS+tB,EAAK,MAAM,aACpB,MAAOA,EACP,WAAAggB,EACA,YAAAC,CACD,CAAC,EAID,GAFAhuC,EAAE,KAAK,wBAAyB4C,EAAK,EAEhC,CAAAA,GAAM,iBAGX,OAAOkrC,EAAS,KAAK,KAAMlrC,GAAM,QAASA,GAAM,KAAK,CACtD,CACD,EAGAorB,EAAI,UAAU,kBAAoB,UAAW,CAC5C,GAAI,CACH,KAAK,YAAY,CAClB,OAAQ1qB,EAAK,CACZtD,EAAE,IAAI,MAAM,mDAAoDsD,CAAG,CACpE,CAEA,OAAOypC,EAAU,KAAK,IAAI,CAC3B,EAGA/e,EAAI,UAAU,kBAAoB,YAAY/lC,EAAM,CACnD,GAAK,CAAE,KAAK,UAAY,CACvB,MAAMsM,EAAI,KAEV,UAAU/R,MAAOgoD,GAAoB,CACpC,MAAM0D,GAAW,KAAK1rD,EAAG,EACpB0rD,KACJ,KAAK1rD,EAAG,EAAI,SAASsd,GAAGE,GAAG,CAC1BzL,EAAE,SAAWuL,GACb,MAAMwc,GAAM4xB,GAAS,KAAK35C,EAAGuL,GAAGE,EAAC,EACjC,OAAAzL,EAAE,SAAW,KACN+nB,EACR,EACF,CAEA,MAAM6xB,EAAe,KAAK,oBAC1B,KAAK,oBAAsB,SAASruC,GAAG,CAEtC,OAAOquC,EAAa,KAAK,KAAMruC,EAAC,CACjC,EAGA,MAAMsuC,EAAU,KAAK,oBACrB,KAAK,oBAAsB,SAAStuC,GAAG,CACtC,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,cAAc,EACzE,OAED,GAAKA,EAAE,kBAAoBA,EAAE,KAAK,QAAQ,IAAI,kBAAkB,EAC/D,OAAOouC,EAAQ,KAAK75C,EAAGuL,EAAC,EAEzB,GAAKE,EAAE,KAAK,QAAQ,IAAI,gBAAgB,EAAI,EAC3C,OAEDF,GAAE,KAAO,GACT,MAAM3c,GAAMoR,EAAE,eAAe,CAAC,QAASuL,EAAC,CAAC,EACzC,OAAA3c,GAAI,SAAW,QACfA,GAAI,WAAa2c,GAAE,UACnB3c,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,SAAWoR,EAAE,YAAcA,EAAE,YAAYuL,GAAE,QAAQ,EAAI,KAC3D3c,GAAI,SAAW2c,GAAE,QACjB3c,GAAI,UAAY2c,GAAE,gBAAgB,mBAAqB,CACtD,MAAOA,GAAE,eAAe,mBACxB,OAAQA,GAAE,eAAe,gBAC1B,EAAI,KAEGvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtBsuC,EAAQ,KAAK75C,EAAGuL,EAAC,CACzB,CACD,EAEA,MAAMqhC,EAAY,KAAK,iBACvB,KAAK,iBAAmB,SAASrhC,GAAG,CACnC,GAAI,CACH,MAAMkZ,GAAUlZ,GAAE,QACjBlY,GAAUoY,EAAE,KAAK,QAAQ,IAAI,iBAAiB,EAE1CgZ,KAAYA,KAAYpxB,IAAWoxB,KAAY,IAAIpxB,EAAO,KAC9DoY,EAAE,gBAAgBF,GAAE,KAAK,CAE3B,OAAQwD,GAAK,CACZtD,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,CAC9B,CAEA,OAAOqhC,EAAU,KAAK5sC,EAAGuL,EAAC,CAC3B,EAEA,MAAMuuC,EAAa,KAAK,kBACxB,KAAK,kBAAoB,SAASvuC,GAAG,CACpC,GAAI,CACH,MAAMoU,GAAUlU,EAAE,KAAK,QAAQ,IAAI,yBAAyB,EAC5D,GAAKkU,KAAY,EAAI,CAEpB,GAAKpU,GAAE,iBAAmBoU,KAAY,EACrC,OAED,MAAM/wB,GAAMoR,EAAE,eAAeuL,EAAC,EAC9B,OAAA3c,GAAI,SAAW,OACfA,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,YAAc2c,GAAE,OACpB3c,GAAI,sBAAwB2c,GAAE,iBAC9B3c,GAAI,cAAgB2c,GAAE,SACtB3c,GAAI,cAAgB2c,GAAE,SACtB3c,GAAI,WAAa2c,GAAE,MAEdA,GAAE,kBAEN3c,GAAI,QAAU,GACdA,GAAI,YAAc,GAClBA,GAAI,aAAe,CAAC,EACpB2c,GAAE,QAAQ,KAAO,IAKXvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAC5C,CAED,OAAQmgB,GAAK,CACZtD,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,CAC9B,CAEA,OAAOuuC,EAAW,KAAK95C,EAAGuL,EAAC,CAC5B,EAEA,MAAMwuC,GAAY,KAAK,sBACvB,KAAK,sBAAwB,SAASxuC,GAAG,CACxC,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,gBAAgB,EAC3E,OAED,GAAKA,EAAE,kBAAoBA,EAAE,KAAK,QAAQ,IAAI,kBAAkB,EAC/D,OAAOsuC,GAAU,KAAK/5C,EAAGuL,EAAC,EAE3B,GAAKE,EAAE,KAAK,QAAQ,IAAI,gBAAgB,EAAI,GAAK,CAAEF,GAAE,KACpD,OAED,MAAM3c,GAAMoR,EAAE,eAAe,CAAC,QAASuL,EAAC,CAAC,EACzC,OAAA3c,GAAI,SAAW,QACfA,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,WAAa2c,GAAE,UACnB3c,GAAI,SAAWoR,EAAE,YAAcA,EAAE,YAAYuL,GAAE,QAAQ,EAAI,KAC3D3c,GAAI,eAAiB2c,GAAE,kBAAoB,EAC3C3c,GAAI,WAAa2c,GAAE,cAAgB,EACnC3c,GAAI,iBAAmB2c,GAAE,wBACzB3c,GAAI,WAAa2c,GAAE,OACnB3c,GAAI,SAAW2c,GAAE,QACjB3c,GAAI,UAAY2c,GAAE,gBAAgB,mBAAqB,CACtD,MAAOA,GAAE,eAAe,mBACxB,OAAQA,GAAE,eAAe,gBAC1B,EAAI,KAIGvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtBwuC,GAAU,KAAK/5C,EAAGuL,EAAC,CAC3B,CACD,EAEA,MAAMyuC,GAAY,KAAK,cAAgB,CAAC,EAElCC,GAAc,KAAK,wBACzB,KAAK,wBAA0B,SAAS1uC,GAAG,CAC1C,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,SAAS,EACpE,OAED,GAAKA,EAAE,kBAAoBA,EAAE,KAAK,QAAQ,IAAI,kBAAkB,EAC/D,OAAOwuC,GAAY,KAAKj6C,EAAGuL,EAAC,EAE7B,MAAMtd,GAAM,GAAGsd,GAAE,OAAO,IAAIA,GAAE,KAAK,MAAM,GACxC66B,GAAU4T,GAAU/rD,EAAG,EAExB,GAAKm4C,GACJ,GAAKA,GAAQ,QAAU,KAAK,IAAI,EAC/B4T,GAAU/rD,EAAG,EAAI,SACX,CACNm4C,GAAQ,WAAW,KAAK,CACvB,GAAI76B,GAAE,YACN,MAAOA,GAAE,eACT,YAAaA,GAAE,aAChB,CAAC,EAEG66B,GAAQ,WAAW,QAAUA,GAAQ,OACxC4T,GAAU/rD,EAAG,EAAI,MAEbm4C,GAAQ,MACZ36B,EAAE,gBAAgB26B,EAAO,EAE1B,MACD,CAGD76B,GAAE,KAAO,GACT,MAAM3c,GAAMoR,EAAE,eAAe,CAAC,QAASuL,EAAC,CAAC,EACzC,OAAA3c,GAAI,SAAW,WACfA,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,cAAgB,CACnB,GAAI2c,GAAE,YACN,MAAOA,GAAE,eACT,YAAaA,GAAE,aAChB,EACA3c,GAAI,WAAa2c,GAAE,UACnB3c,GAAI,SAAWoR,EAAE,YAAcA,EAAE,YAAYuL,GAAE,QAAQ,EAAI,KAC3D3c,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,SAAW2c,GAAE,QACjB3c,GAAI,UAAY2c,GAAE,YAGXvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtB0uC,GAAY,KAAKj6C,EAAGuL,EAAC,CAC7B,CACD,EAEA,MAAM2uC,EAAqB,KAAK,6BAChC,KAAK,6BAA+B,SAAS3uC,GAAG,CAC/C,GAAI,CACH,GAAKE,EAAE,iBACN,OAAOyuC,EAAmB,KAAK,KAAM3uC,EAAC,EAEvC,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,uBAAuB,EAAI,CACtF,MAAM7c,GAAMoR,EAAE,eAAeuL,EAAC,EAC9B,OAAA3c,GAAI,WAAa2c,GAAE,WACZvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAC5C,CAED,OAAQmgB,GAAK,CACZtD,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EAC7BE,EAAE,IAAI,MAAMsD,EAAG,CAChB,CAEA,OAAOmrC,EAAmB,KAAK,KAAM3uC,EAAC,CACvC,EAEA,MAAM4uC,GAAkB,KAAK,4BAC7B,KAAK,4BAA8B,SAAS5uC,GAAG,CAC9C,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,aAAa,EACxE,OAED,GAAKA,EAAE,kBAAoBA,EAAE,KAAK,QAAQ,IAAI,kBAAkB,EAC/D,OAAO0uC,GAAgB,KAAKn6C,EAAGuL,EAAC,EAEjC,MAAMtd,GAAM,GAAGsd,GAAE,OAAO,QACvB66B,GAAU4T,GAAU/rD,EAAG,EAExB,GAAKm4C,GACJ,GAAKA,GAAQ,QAAU,KAAK,IAAI,EAC/B4T,GAAU/rD,EAAG,EAAI,SACb,CACJm4C,GAAQ,WAAW,KAAK,CACvB,GAAI76B,GAAE,YACN,MAAOA,GAAE,eACT,YAAaA,GAAE,aAChB,CAAC,EAEG66B,GAAQ,WAAW,QAAUA,GAAQ,OACxC4T,GAAU/rD,EAAG,EAAI,MAEbm4C,GAAQ,MACZ36B,EAAE,gBAAgB26B,EAAO,EAE1B,MACD,CAGD76B,GAAE,KAAO,GACT,MAAM3c,GAAMoR,EAAE,eAAe,CAAC,QAASuL,EAAC,CAAC,EACzC,OAAA3c,GAAI,SAAW,WACfA,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,WAAa2c,GAAE,UACnB3c,GAAI,SAAWoR,EAAE,YAAcA,EAAE,YAAYuL,GAAE,QAAQ,EAAI,KAC3D3c,GAAI,SAAW,GACfA,GAAI,cAAgB,CACnB,GAAI2c,GAAE,YACN,MAAOA,GAAE,eACT,YAAaA,GAAE,aAChB,EACA3c,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,SAAW2c,GAAE,QACjB3c,GAAI,UAAY2c,GAAE,YAGXvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtB4uC,GAAgB,KAAKn6C,EAAGuL,EAAC,CACjC,CACD,EAEA,MAAM6uC,GAAiB,KAAK,+BAC5B,KAAK,+BAAiC,SAAS7uC,GAAG,CACjD,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,gBAAgB,EAC3E,OAED,GAAKA,EAAE,kBAAoBA,EAAE,KAAK,QAAQ,IAAI,kBAAkB,EAC/D,OAAO2uC,GAAe,KAAKp6C,EAAGuL,EAAC,EAEhC,IAAI66B,GAAU,KACd,GAAK76B,GAAE,cAAgBE,EAAE,KAAK,QAAQ,IAAI,uBAAuB,EAAI,CACpE,MAAMxd,GAAM,GAAGsd,GAAE,OAAO,IAAIA,GAAE,KAAK,MAAM,GACzC66B,GAAU4T,GAAU/rD,EAAG,EAAI,CAC1B,WAAY,CAAC,EACb,KAAMsd,GAAE,cACR,QAAS,KAAK,IAAI,EAAI,GACvB,CACD,CAEAA,GAAE,KAAO,GACT,MAAM3c,GAAMoR,EAAE,eAAe,CAAC,QAASuL,EAAC,CAAC,EACzC,OAAA3c,GAAI,SAAW,cACfA,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,WAAa2c,GAAE,UACnB3c,GAAI,SAAWoR,EAAE,YAAcA,EAAE,YAAYuL,GAAE,QAAQ,EAAI,KAC3D3c,GAAI,QAAUw3C,GACdx3C,GAAI,SAAW2c,GAAE,KACjB3c,GAAI,UAAY2c,GAAE,cAClB3c,GAAI,UAAY2c,GAAE,YAGXvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtB6uC,GAAe,KAAKp6C,EAAGuL,EAAC,CAChC,CACD,EAEA,MAAM8uC,GAAqB,KAAK,mCAChC,KAAK,mCAAqC,SAAS9uC,GAAG,CACrD,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,oBAAoB,EAC/E,OAED,GAAKA,EAAE,kBAAoBA,EAAE,KAAK,QAAQ,IAAI,kBAAkB,EAC/D,OAAO4uC,GAAmB,KAAKr6C,EAAGuL,EAAC,EAEpC,IAAI66B,GAAU,KACd,GAAK76B,GAAE,cAAgBE,EAAE,KAAK,QAAQ,IAAI,uBAAuB,EAAI,CACpE,MAAMxd,GAAM,GAAGsd,GAAE,OAAO,QACxB66B,GAAU4T,GAAU/rD,EAAG,EAAI,CAC1B,WAAY,CAAC,EACb,KAAMsd,GAAE,cACR,QAAS,KAAK,IAAI,EAAI,GACvB,CACD,CAEAA,GAAE,KAAO,GACT,MAAM3c,GAAMoR,EAAE,eAAe,CAAC,QAASuL,EAAC,CAAC,EACzC,OAAA3c,GAAI,SAAW,cACfA,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,SAAW,GACfA,GAAI,QAAUw3C,GACdx3C,GAAI,SAAW2c,GAAE,KACjB3c,GAAI,UAAY2c,GAAE,cAClB3c,GAAI,UAAY2c,GAAE,YAGXvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtB8uC,GAAmB,KAAKr6C,EAAGuL,EAAC,CACpC,CACD,EAEA,MAAM+uC,GAAa,KAAK,cACxB,KAAK,cAAgB,SAAS/uC,GAAG,CAChC,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,QAAQ,EACnE,OAED,GAAKA,EAAE,iBACN,OAAO6uC,GAAW,KAAKt6C,EAAGuL,EAAC,EAE5B,MAAM3c,GAAMoR,EAAE,eAAeuL,EAAC,EAC9B,OAAA3c,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,SAAW,SACfA,GAAI,OAAS2c,GAAE,KAERvL,EAAE,4BAA4BuL,GAAG3c,EAAG,CAE5C,OAAQmgB,GAAK,CACZtD,OAAAA,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,EACtB+uC,GAAW,KAAKt6C,EAAGuL,EAAC,CAC5B,CACD,EAEA,MAAMgvC,GAAa,KAAK,2BACxB,KAAK,2BAA6B,SAAShvC,GAAG,CAC7C,GAAI,CACH,GAAKE,EAAE,KAAK,QAAQ,IAAI,8BAA8B,EAAE,IAAI,qBAAqB,EAChF,OAED,GAAKA,EAAE,iBACN,OAAO8uC,GAAW,KAAKv6C,EAAGuL,EAAC,EAE5B,MAAMu6B,GAASv6B,GAAE,aAAY,OAAIA,GAAE,SAAUvL,EAAE,MAAM,SAAS,EAC9D,GAAK8lC,GAAS,CACb,MAAMl3C,GAAMoR,EAAE,eAAeuL,EAAC,EAE9B,OAAKE,EAAE,KAAK,QAAQ,IAAI,sBAAsB,MAAK,MAAgBq6B,EAAM,GAAKv6B,GAAE,YACxEvL,EAAE,4BAA4BuL,GAAG,CACvC,KAAME,EAAE,WAAW,oBACnB,GAAI7c,GAAI,GACR,YAAaA,GAAI,KAAK,gBACtB,MAAOA,GAAI,KAAK,UAChB,OAAAk3C,GACA,QAASl3C,GACT,OAAQA,GAAI,KAAK,OACjB,YAAa2c,GAAE,YACf,WAAYA,GAAE,UACf,CAAC,GAED3c,GAAI,iBAAmB2c,GAAE,YACzB3c,GAAI,WAAa2c,GAAE,WACnB3c,GAAI,SAAW,SACfA,GAAI,WAAak3C,GACjBl3C,GAAI,wBAAuB,MAAoBk3C,EAAM,EAE9C9lC,EAAE,4BAA4BuL,GAAG3c,EAAG,EAE7C,CAED,OAAQmgB,GAAK,CACZtD,EAAE,IAAI,MAAMsD,EAAG,EACftD,EAAE,IAAI,QAAQsD,GAAK,CAAC,MAAOxD,EAAC,CAAC,CAC9B,CAEA,OAAOgvC,GAAW,KAAKv6C,EAAGuL,EAAC,CAC5B,EAcA,MAAMivC,GAAU,KAAK,WACrB,KAAK,WAAa,SAASjvC,GAAG,CAC7B,MAAMouC,GAAW35C,EAAE,SACnB,OAAK25C,IAAY,CAAEpuC,GAAE,aACbvL,EAAE,4BAA4B25C,GAAUpuC,EAAC,EAE1CivC,GAAQ,KAAKx6C,EAAGuL,EAAC,CACzB,EAEA,KAAK,UAAY,EAClB,CAEA,OAAO+tC,EAAY,MAAM,KAAM,GAAG5lD,CAAI,CACvC,EAEA+lC,EAAI,UAAU,4BAA8B,SAASkgB,EAAU5uC,EAAS,CACvE,MAAM0vC,EAAe1vC,EASrB,GARAA,EAAQ,aAAe,IAIlBA,EAAQ,OAASU,EAAE,WAAW,qBAAuBV,EAAQ,OAASU,EAAE,WAAW,uBAA0BV,EAAQ,SAAS,KAAOA,EAAQ,SAAS,oBAC1JA,EAAUA,EAAQ,SAGd4uC,EAAS,QAAU,CACvB,IAAI7K,EAAO/jC,EAAQ,QAAU4uC,EAAS,QAAQ,YAAY,EAI1D,GAHK7K,EAAK,WAAW,GAAG,IACvBA,EAAOA,EAAK,MAAM,CAAC,GAEfA,IAAS,KAAK,MAAM,aAAa,YAAY,EACjD,OAED/jC,EAAQ,UAAY+jC,CACrB,CAKA,GAHA/jC,EAAQ,cAAgBA,EAAQ,YAAc4uC,EAAS,SAAS,YAAc,GAC9E5uC,EAAQ,cAAgB4uC,EAAS,SAAS,oBAAsB,GAE3DA,EAAS,QAAU,CACvB,MAAMvnC,EAAOunC,EAAS,QAAQ,KAC7BlhC,EAAQkhC,EAAS,QAAQ,MAI1B,GAHKvnC,IACJrH,EAAQ,OAASqH,EAAK,QAElBqG,GAAS,KAAK,qBAAuB,CACzC,MAAMiiC,EAAY,KAAK,MAAM,wBAA0BjvC,EAAE,KAAK,QAAQ,IAAI,yBAAyB,EAC9FivC,IACJ,KAAK,MAAM,uBAAyB,IACrC3vC,EAAQ,MAAQ,KAAK,qBAAqB0N,CAAK,EAC1CiiC,IACJ,KAAK,MAAM,uBAAyB,GACtC,EAEI,CAAE3vC,EAAQ,SAAW,OAAOA,EAAQ,SAAY,YAC9C,OAAO4uC,EAAS,QAAW,SAC/B5uC,EAAQ,QAAU4uC,EAAS,OAE3B5uC,EAAQ,QAAU4uC,EAAS,QAAQ,KAEtC,CAEA,KAAK,WAAWc,CAAY,CAC7B,CACD,CAYA,QAAQtsC,EAAO2G,EAAO,CAIrB,GAHOA,IACNA,EAAQ3G,EAAM,OAEV,CAAE2G,EAAM,UACZ,OAAO,KAER,MAAMpD,EAAOvD,EAAM,UAAY,KAAK,KAAK,QAAQ2G,EAAM,UAAWA,EAAM,cAAgBA,EAAM,aAAa,YAAY,EAAG,GAAO,EAAI,EACrI,OAAApD,EAAK,IAAIvD,CAAK,EACPuD,CACR,CAGA,WAAWvD,EAAO,CACVA,EAAM,YAGbA,EAAM,UAAU,MAAMA,CAAK,EAC3BA,EAAM,UAAY,KACnB,CAOA,YAAY0C,EAAMiE,EAAO,CACnBjE,EAAK,aACTA,EAAK,WAAW,cAAgBA,GAE1BiE,IACNA,EAAQjE,EAAK,OAEP,KAAK,QAAQA,EAAMiE,CAAK,IAG/B,KAAK,qBAAqBjE,EAAMiE,EAAM,UAAU,EAIhD,KAAK,SAAS,cAAc,CAC3B,UAAWA,EAAM,uBACjB,WAAYA,EAAM,QACnB,CAAC,GAEIA,EAAM,YAAcA,EAAM,WAC9B,KAAK,SAAS,cAAc,CAC3B,QAASA,EAAM,cAAgBA,EAAM,aAAa,YAAY,EAC9D,UAAWA,EAAM,SAClB,CAAC,EAEF,KAAK,KAAK,QAAQ,cAAc,CAC/B,UAAWA,EAAM,uBACjB,QAASA,EAAM,cAAgBA,EAAM,aAAa,YAAY,EAC9D,UAAWA,EAAM,SAIlB,CAAC,EACF,CAGA,cAAcjE,EAAM,CACdA,EAAK,YAAcA,EAAK,WAAW,gBAAkB,OACzDA,EAAK,WAAW,cAAgB,OAE5BA,EAAK,MAAM,YAAcA,EAAK,MAAM,WACxC,KAAK,SAAS,cAAc,CAC3B,QAAS,KACT,UAAW,IACZ,CAAC,EAEF,KAAK,SAAS,cAAc,CAC3B,UAAW,GACX,WAAY,EACb,CAAC,EAED,KAAK,KAAK,QAAQ,cAAc,CAC/B,UAAW,GACX,QAAS,KACT,UAAW,IACZ,CAAC,EAED,KAAK,WAAWA,CAAI,CACrB,CAGA,YAAYA,EAAMiE,EAAO,CAIxB,GAHKjE,EAAK,aACTA,EAAK,WAAW,cAAgBA,GAE5B,CAAEA,EAAK,WAAaiE,EAAM,WAAajE,EAAK,UAAU,GAAK,CAC/D,KAAK,WAAWA,CAAI,EACfA,EAAK,cACT,KAAK,YAAYA,CAAI,EACtB,MACD,CAEKiE,EAAM,aAAejE,EAAK,MAAM,YACpC,KAAK,qBAAqBA,EAAMA,EAAK,MAAM,UAAU,EAItD,IAAI0S,EAAQ1S,EAAK,MAAM,aAClB0S,IACJA,EAAQA,EAAM,YAAY,IAEtB1S,EAAK,MAAM,YAAcA,EAAK,MAAM,WACxC,KAAK,SAAS,cAAc,CAC3B,QAAS0S,EACT,UAAW1S,EAAK,MAAM,SACvB,CAAC,EAEF,KAAK,SAAS,cAAc,CAC3B,UAAWA,EAAK,MAAM,uBACtB,WAAYA,EAAK,MAAM,QACxB,CAAC,EAED,KAAK,KAAK,QAAQ,cAAc,CAC/B,UAAWA,EAAK,MAAM,uBACtB,QAAS0S,EACT,UAAW1S,EAAK,MAAM,SAIvB,CAAC,CACF,CAGA,qBAAqBA,EAAM8a,EAAQ,CAClC,MAAMja,EAAOb,EAAK,UAClB,GAAK,CAAEa,EACN,OAID,IAAIipC,EAAW,KACf,GAAKhvB,GAAU,MAAM,QAAQA,EAAO,cAAc,EAAI,CACrDgvB,EAAW,IAAI,IACf,UAAUvmC,KAAUuX,EAAO,eACrBvX,GAAUA,EAAO,QACrBumC,EAAS,IAAIvmC,EAAO,MAAM,CAC7B,CAEM,CAAE,KAAK,eAAiB,CAAEumC,MAAa,cAAW,KAAK,cAAeA,CAAQ,IAGpF,KAAK,cAAgBA,EAErBjpC,EAAK,iBAAiBkpC,GAAiBjvB,CAAM,CAAC,EAC9C,KAAK,UAAU,iBAAiB,EAEjC,CAOA,iBAAiB6N,EAAM,CACtB,MAAMsf,EAAStf,EAAK,MAAM,iBACrBsf,GAAUA,EAAO,WAAaA,EAAO,UAAU,iBAAmBtf,IACtEsf,EAAO,UAAU,eAAiBtf,EACpC,CAEA,iBAAiBA,EAAM1kB,EAAO,CAC7B,MAAMgkC,EAAShkC,EAAM,iBACpB+lC,EAAarhB,EAAK,MAAM,iBAEpBsf,IAAW+B,IAGX/B,GAAUA,EAAO,WAAaA,EAAO,UAAU,iBAAmBtf,IACtEsf,EAAO,UAAU,eAAiB,MAE9B+B,GAAcA,EAAW,WAAaA,EAAW,UAAU,iBAAmBrhB,IAClFsf,EAAO,UAAU,eAAiBtf,GACpC,CAEA,mBAAmBA,EAAM,CACxB,MAAMsf,EAAStf,EAAK,MAAM,iBACrBsf,GAAUA,EAAO,WAAaA,EAAO,UAAU,iBAAmBtf,IACtEsf,EAAO,UAAU,eAAiB,KACpC,CAOA,gBAAgB9e,EAAMllB,EAAO,CACrBA,IACNA,EAAQklB,EAAK,OAId,KAAK,0BAA0BA,EAAMllB,GAAO,yBAAyB,CACtE,CAGA,0BAA0BklB,EAAMn4B,EAAM,CAGrC,GAFAA,IAAAA,EAASm4B,EAAK,MAAM,2BAEfA,EAAK,qBAAuBn4B,EAChC,OAED,KAAK,iBAAmBm4B,EAAK,mBAAqBn4B,EAClD,KAAK,aAAem4B,EAAK,kBAAoBA,EAAK,mBAAqB,CAAC,EAExE,MAAM/qC,EAAa,IAAI,IAAI,OAAO,KAAK+qC,EAAK,iBAAiB,CAAC,EAC9D,IAAI8gB,EAAiB,GAErB,GAAIj5C,GAAQ,KACX,SAAU,CAACuX,EAAS2hC,CAAE,IAAKl5C,EAAK,QAAQ,EAAG,CAC1C5S,EAAW,OAAOmqB,CAAO,EAEzB,IAAI1H,EAAOsoB,EAAK,kBAAkB5gB,CAAO,EAClC1H,IAENA,EAAO,KAAK,KAAK,QAAQ0H,EAAS2hC,EAAG,KAAK,EAC1CrpC,EAAK,IAAIsoB,CAAI,EACbA,EAAK,kBAAkB5gB,CAAO,EAAI1H,GAInC,MAAMkH,EAAKmiC,EAAG,QAAQ,cAItB,IAAIl6B,EAAQ,EACZ,GAAIjI,EACH,UAAU5K,MAAS4K,EAAG,OAAO,EAC5B,UAAUvM,MAAK2B,GAAM,OAAO,EAC3B6S,IAKEnP,EAAK,WAAW,IAAMmP,IAC1Bi6B,EAAiB,GACjBppC,EAAK,aAAakH,CAAE,EAEtB,CAGD,UAAUQ,KAAWnqB,EAAY,CAChC,MAAMyiB,EAAOsoB,EAAK,kBAAkB5gB,CAAO,EACtC1H,GACJA,EAAK,MAAMsoB,CAAI,EAEhBtoB,EAAK,YAAY,EACjB,OAAOsoB,EAAK,kBAAkB5gB,CAAO,CACtC,CAEA,MAAM4hC,EAAS,OAAO,KAAKhhB,EAAK,iBAAiB,EAEjD,UAAUtoB,KAAQ,OAAO,OAAOsoB,EAAK,iBAAiB,EACrDtoB,EAAK,WAAWspC,CAAM,EAIlBA,EAAO,OAAS,GAAK,KAAK,SAAS,SAAS,IAAI,oBAAoB,IAAM,IAC9E,KAAK,SAAS,SAAS,IAAI,qBAAsB,CAAC,EAClD,KAAK,UAAU,IAAK,CACnB,KAAM,iBACN,QAAS,KAAK,KAAK,EAAE,2BAA4B,0MAA0M,CAC5P,CAAC,GAGGF,GACJ,KAAK,UAAU,iBAAiB,CAClC,CAEA,kBAAkB9gB,EAAM,CAEvB,GAAIA,EAAK,kBACR,UAAUtoB,KAAQ,OAAO,OAAOsoB,EAAK,iBAAiB,EACrDtoB,EAAK,MAAMsoB,CAAI,EAEjBA,EAAK,kBAAoB,KACzBA,EAAK,mBAAqB,KAC1B,KAAK,iBAAmB,IAAI,IAC5B,KAAK,aAAe,CAAC,CACtB,CAEA,gBAAgBA,EAAMllB,EAAO,CAC5B,KAAK,0BAA0BklB,EAAMllB,GAAO,yBAAyB,CACtE,CAOA,IAAI,qBAAsB,CACzB,MAAMqrB,EAAQ,KAAK,OAAO,aAC1B,OAAO,IAAS,cAAc,SAASA,CAAK,GAAK,IAAS,gBAAgB,SAASA,CAAK,CACzF,CAEA,iBAAiBnG,EAAMllB,EAAO,CAI7B,GAHOA,IACNA,EAAQklB,EAAK,OAET,EAAE,KAAK,QAAQA,EAAMllB,CAAK,IAG/B,KAAK,qBAAqBklB,EAAMllB,EAAM,UAAU,EAE3CA,EAAM,iBAAiB,OAC3B,KAAK,KAAK,OAAO,mBAAmBA,EAAM,gBAAgB,MAAM,EACxDA,EAAM,MAAM,QACpB,KAAK,KAAK,OAAO,mBAAmBA,EAAM,KAAK,MAAM,EAEjDA,EAAM,MAAO,CACjB,GAAK,KAAK,oBAAqB,CAC9B,MAAM9B,EAAQ8B,EAAM,KAAK,MAAM,gBAC/B,KAAK,QAAQ,cAAc,EAAE,mBAAmB9B,CAAK,EAErD,KAAK,SAAS,cAAc,CAC3B,QAAS8B,EAAM,aACf,UAAWA,EAAM,UACjB,aAAc9B,CACf,CAAC,CACF,CAEA,KAAK,iBAAiBgnB,EAAMllB,EAAM,KAAK,MAAQA,EAAM,KAAK,KAAK,eAAe,EAC9E,KAAK,gBAAgBklB,EAAMllB,EAAM,SAAS,CAC3C,CACD,CAGA,mBAAmBklB,EAAM,CACnB,KAAK,sBACT,KAAK,QAAQ,cAAc,EAAE,mBAAmB,EAEhD,KAAK,SAAS,cAAc,CAC3B,QAAS,KACT,UAAW,KACX,aAAc,IACf,CAAC,GAGF,KAAK,WAAWA,CAAI,CACrB,CAGA,iBAAiBA,EAAMllB,EAAO,CAG7B,GAAK,CAAEklB,EAAK,WAAallB,EAAM,WAAaklB,EAAK,UAAU,GAAK,CAC/D,KAAK,WAAWA,CAAI,EACfA,EAAK,cACT,KAAK,iBAAiBA,EAAMllB,CAAK,EAClC,MACD,CAKA,GAHKA,EAAM,aAAeklB,EAAK,MAAM,YACpC,KAAK,qBAAqBA,EAAMllB,EAAM,UAAU,EAE5CA,EAAM,MAAQ,IAAS,cAAc,SAAS,KAAK,OAAO,YAAY,EAAI,CAC9E,MAAM9B,EAAQ8B,EAAM,KAAK,MAAM,gBAC/B,KAAK,QAAQ,cAAc,EAAE,mBAAmB9B,CAAK,EAErD,KAAK,SAAS,cAAc,CAC3B,QAAS8B,EAAM,aACf,UAAWA,EAAM,UACjB,aAAc9B,CACf,CAAC,CACF,CAMA,MAAM2sB,EAAK7qB,EAAM,MAAM,MAAM,iBAAmB,CAAC,EAChDmmC,EAAMjhB,EAAK,MAAM,MAAM,MAAM,iBAAmB,CAAC,EAE5Cxd,EAAK1H,EAAM,iBAAiB,QAAU,CAAC,EAC5ComC,EAAMlhB,EAAK,MAAM,iBAAiB,QAAU,CAAC,GAWzC,KAAK,KAAK,OAAO,oBAAoB,IAAMxd,EAAG,QAAUA,EAAG,SAAW0+B,EAAI,SAC9E,KAAK,KAAK,OAAO,mBAAmB1+B,CAAE,GAElCwd,EAAK,UAAU,WAAW,IAAM2F,EAAG,QAAUA,EAAG,SAAWsb,EAAI,SACnE,KAAK,iBAAiBjhB,EAAM2F,CAAE,EAE/B,KAAK,gBAAgB3F,EAAMllB,EAAM,SAAS,CAC3C,CAEA,cAAcklB,EAAM,CACnB,MAAMtoB,EAAOsoB,EAAK,UAClB,OAAOtoB,EAGAA,EAAK,UAAU,EAFd,EAGT,CAEA,iBAAiBsoB,EAAMzf,EAAQ,CAC9B,MAAM7I,EAAOsoB,EAAK,UACXtoB,IAGPA,EAAK,aAAa6I,CAAM,EACxB,KAAK,UAAU,iBAAiB,EAEjC,CAEA,gBAAgByf,EAAMroB,EAAO,CAC5B,MAAMD,EAAOsoB,EAAK,UACXtoB,IAGPA,EAAK,MAAQC,EACd,CACD,EAvkH6C,iBAA9B,IAAMwpC,GAAN,GA8kHR,SAASP,GAAiBjvB,GAAQ,CACxC,GAAK,CAAEA,GACN,OAED,MAAM/8B,EAAM,CAAC,EACZskB,EAAUyY,GAAO,eACjByvB,EAAc,CAAC,EAEhB,GAAK,MAAM,QAAQzvB,GAAO,KAAK,EAC9B,UAAU7S,KAAQ6S,GAAO,MACxByvB,EAAYtiC,EAAK,IAAI,EAAIA,EAAK,MAEhC,UAAU7qB,KAAOilB,EAChB,MAAK,OAAIA,EAASjlB,CAAG,EAAI,CACxB,MAAMmmB,EAASlB,EAAQjlB,CAAG,EACzBotD,EAAUzsD,EAAIX,CAAG,EAAI,CACpB,GAAImmB,EAAO,GACX,OAAQA,EAAO,OACf,MAAO,CAAC,CACT,EAED,GAAKuX,IAAQ,SACZ,UAAU7S,KAAQ1E,EAAO,aAAc,CACtC,MAAM6X,EAAS,CAAC,EAEhB,UAAUH,IAAS,CAAC,QAAS,MAAM,EAAG,CACrC,MAAMwvB,EAASrvB,EAAOH,CAAK,EAAIG,EAAOH,CAAK,GAAK,CAAC,EAChDyvB,GAAOD,EAAO,OAASA,EAAO,QAAU,CAAC,EACzC7yB,GAAW6yB,EAAO,SAAWA,EAAO,UAAY,CAAC,EAElD,UAAUrkC,KAAS,CAAC,EAAG,EAAG,CAAC,EAE1BskC,GAAKtkC,EAAK,EAAI0U,GAAO,SAASvX,EAAO,OAAQ0X,EAAO,SAAUhT,EAAK,KAAM7B,GAAO,KAAK,EAGrFwR,GAASxR,EAAK,EAAI0U,GAAO,SAASvX,EAAO,OAAQ0X,EAAO,WAAYhT,EAAK,KAAM7B,GAAO,KAAK,CAE7F,CAEAokC,EAAQ,MAAM,KAAK,CAClB,OAAQviC,EAAK,KACb,MAAOA,EAAK,OAASsiC,EAAYtiC,EAAK,IAAI,GAAK,UAC/C,GAAIA,EAAK,GACT,OAAAmT,CACD,CAAC,CACF,SAEW7X,EAAO,aAAa,CAAC,GAAG,OACnC,UAAU0E,KAAQ1E,EAAO,aAAc,CACtC,MAAM6X,EAAS,CAAC,EAEhB,UAAUuvB,KAAM1iC,EAAK,OAAQ,CAC5B,MAAMwiC,EAASrvB,EAAOuvB,EAAG,KAAK,EAAIvvB,EAAOuvB,EAAG,KAAK,GAAK,CAAC,EACtDC,GAAKD,EAAG,WAAa,WAAa,SAClCxpB,GAAOspB,EAAOG,EAAE,EAAIH,EAAOG,EAAE,GAAK,CAAC,EAEpCzpB,GAAKwpB,EAAG,QAAQ,EAAIA,EAAG,GACxB,CAEAH,EAAQ,MAAM,KAAK,CAClB,OAAQviC,EAAK,KACb,MAAOA,EAAK,OAASsiC,EAAYtiC,EAAK,IAAI,GAAK,UAC/C,GAAIA,EAAK,GACT,OAAAmT,CACD,CAAC,CACF,CAEF,CAED,OAAOr9B,CACR,CAtEgB,EAAAgsD,GAAA,mB,+FCtxHT,SAASc,EAAmB5V,EAAQ,CAC1C,OAAOA,EAAO,cAAgB,MAC/B,CAFgB,EAAA4V,EAAA,sBAIT,SAASjE,EAAkB3R,EAAQ,CACzC,OAAOA,GAAQ,aAAe,gCAC/B,CAFgB,EAAA2R,EAAA,qBAIT,SAASkE,EAAe7V,EAAQ,CACtC,OAAOA,GAAQ,aAAe,6BAC/B,CAFgB,EAAA6V,EAAA,kBAIT,SAASC,EAAoB9V,EAAQ,CAC3C,OAAO2R,EAAkB3R,CAAM,GAAKA,EAAO,OAAS,0BACrD,CAFgB,EAAA8V,EAAA,uBAIT,SAASC,EAAmB/V,EAAQ,CAC1C,OAAOA,IAAWA,EAAO,OAAO,WAAW,QAAQ,GAClDA,EAAO,QAAQ,WAAW,QAAQ,EACpC,CAHgB,EAAA+V,EAAA,sBAKT,SAASC,EAAgBhW,EAAQ,CACvC,OAAOA,GAAQ,OAAS,uBACzB,CAFgB,EAAAgW,EAAA,mBAIT,SAASC,EAAcjW,EAAQ,CACrC,MAAMD,EAAU6V,EAAmB5V,CAAM,EACzC,OAAK2R,EAAkB3R,CAAM,EACrBD,EACHC,EAAO,UAAYA,EAAO,gBAC1BA,EAAO,MAAQA,EAAO,YAEpBD,EACJC,EAAO,SACPA,EAAO,IACX,CAVgB,EAAAiW,EAAA,iBAYT,SAASC,EAAelW,EAAQ,CACtC,OAAK2R,EAAkB3R,CAAM,EACrBA,EAAO,iBAAmBA,EAAO,uBAElCA,EAAO,eACf,CALgB,EAAAkW,EAAA,kBAOT,SAASC,EAAenW,EAAQoW,EAAM,CAC5C,GAAKP,EAAe7V,CAAM,EACzB,OAAOA,EAAO,MAEf,OAAOA,EAAO,KAAM,CACnB,IAAK,wBACJ,OAAOoW,EAAK,EAAE,uBAAwB,iBAAiB,EACxD,IAAK,2BACJ,OAAOA,EAAK,EAAE,0BAA2B,sBAAsB,EAChE,IAAK,iCACJ,OAAOA,EAAK,EAAE,yBAA0B,iCAAiC,EAC1E,IAAK,0BACJ,OAAOA,EAAK,EAAE,2BAA4B,2BAA2B,EACtE,IAAK,0BACJ,OAAOA,EAAK,EAAE,2BAA4B,2BAA2B,EACtE,IAAK,mCACJ,OAAOA,EAAK,EAAE,2BAA4B,uBAAuB,EAClE,QACC,OAAOA,EAAK,EAAE,qBAAsB,QAAQ,CAC9C,CACD,CApBgB,EAAAD,EAAA,iB,uFChCD,MAAM,EAAN,MAAM,UAAwB,SAAO,CACnD,eAAevoD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,aAAa,CAC1B,CAEA,UAAW,CACV,KAAK,cAAc,CACpB,CAEA,MAAM,eAAgB,CACrB,MAAMyqB,EAAK,MAAM,KAAK,cAAc,EACpC,GAAK,CAAEA,EACN,OAAO,KAAK,IAAI,KAAK,uDAAuD,EAE7EA,EAAG,oBAAoB,eAAgB,IAAM,CAG5C,MAAM6b,EAAO,KAAK,KAAK,cAAc,MACpCllB,EAAQklB,GAAQA,EAAK,MAEtB,GAAK,CAAEllB,EACN,OAED,MAAMmM,EAAO,KAAK,OAAO,QAAQnM,EAAM,OAAQA,EAAM,iBAAkBA,EAAM,UAAWA,EAAM,YAAY,EACzGjE,EAAO,KAAK,QAAQ,MAAM,EAC1BmhB,GAAQnhB,GAAM,SAAW,KAAK,WAAW,MAAM,sBAAsB,EAAI,EACzE8P,EAAS,CAAC,EAEX,UAAU9E,KAAOoF,EAChB,GAAK,GAAEpF,GAAO,CAAEA,EAAI,SAGpB,UAAUuE,KAAYvE,EAAI,OACzB,MAAK,OAAIA,EAAI,OAAQuE,CAAQ,EAAI,CAChC,MAAM5L,EAAQqH,EAAI,OAAOuE,CAAQ,EACjC,GAAK5L,EAAM,OACV,SAEDmM,EAAO,KAAK,CACX,KAAMnM,EAAM,KACZ,IAAKwd,GAAQxd,EAAM,WAAW,CAAC,GAAKA,EAAM,KAAK,CAAC,EAChD,QAAS,GAAGqH,EAAI,QAAU,cAAc,IAAIA,EAAI,KAAK,GACrD,MAAOA,EAAI,MAAQ,2CACpB,CAAC,CACF,EAGF,OAAO8E,CACR,CAAC,CACF,CAEA,MAAM,cAAcs4B,EAAQ,EAAG,CAC9B,OAAK,OAAO,WAAa,UAAU,oBAC3B,UAEHA,GAAS,IACN,MAER,QAAM,SAAM,GAAG,EACR,KAAK,cAAcA,EAAQ,GAAG,EACtC,CACD,EAnEoD,uBAArC,IAAMkD,EAAN,C,8GCDf,MAAMvjB,EAAkB,SAAS,cAAc,MAAM,EAE/CwjB,EAAU,CAGf,WAAY,qBACZ,mBAAoB,8BACpB,oBAAqB,uHAErB,eAAgB,4BAChB,sBAAuB,uCACvB,2BAA4B,6IAC5B,wBAAyB,8BACzB,sBAAuB,sCACvB,oBAAqB,2CAErB,uBAAwB,mCACxB,uBAAwB,gEAExB,eAAgB,kBAChB,gBAAiB,2DAEjB,UAAa,sBAEb,qBAAsB,2GAEtB,aAAc,mPACd,mBAAoB,sXACpB,cAAe,wDAEf,mBAAoB,8CACpB,mBAAoB,iGAEpB,eAAgB,2IAChB,SAAY,kGAEZ,eAAgB,oPAChB,gBAAiB,uDACjB,eAAgB,yDAChB,mBAAoB,oGACpB,YAAe,6BAEf,gBAAiB,2BAEjB,mBAAoB,iCAEpB,eAAgB,uDAEhB,cAAe,uDACf,wBAAyB,4FACzB,iBAAkB,mIACnB,EAGqB,EAAN,MAAM,UAAkB,SAAO,CAC7C,eAAe1oD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,OAAO,UAAU,EAEtB,KAAK,MAAQ,IAAI,eACjB,KAAK,OAAS,CAAC,EACf,KAAK,cAAgB,GAErB,KAAK,OAAS,CAAC,EAIf,KAAK,SAAS,IAAI,6BAA8B,CAC/C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,yCACP,UAAW,mBACZ,EACA,QAASxF,GAAO,KAAK,WAAW,oBAAqBA,CAAG,CACzD,CAAC,EAED,KAAK,SAAS,IAAI,6BAA8B,CAC/C,SAAU,CAAC,kBAAkB,EAC7B,QAAS,KACT,QAAQqf,EAAKrf,EAAK,CACjB,OAAOA,GAAcqf,EAAI,IAAI,kBAAkB,CAChD,EACA,QAASrf,GAAO,KAAK,OAAO,sBAAuBA,CAAG,EACtD,GAAI,CACH,KAAM,+BACN,MAAO,qCACP,YAAa,iHACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,SAAU,CAAC,iBAAiB,EAC5B,QAAS,KACT,QAAQqf,EAAKrf,EAAK,CACjB,OAAOA,GAAcqf,EAAI,IAAI,iBAAiB,IAAM,CACrD,EACA,QAASrf,GAAO,KAAK,OAAO,qBAAsBA,CAAG,EACrD,GAAI,CACH,KAAM,+BACN,MAAO,sCACP,YAAa,kHACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,sBAAuB,CACxC,SAAU,CAAC,yBAA0B,uBAAwB,sBAAuB,iBAAkB,sBAAsB,EAC5H,QAAQqf,EAAK,CACZ,OAAKA,EAAI,IAAI,sBAAsB,EAC3B,GAEDA,EAAI,IAAI,wBAAwB,GAAKA,EAAI,IAAI,sBAAsB,GAAKA,EAAI,IAAI,qBAAqB,GAAKA,EAAI,IAAI,gBAAgB,CAC1I,EACA,QAASrf,GAAO,CACVA,EACJ,KAAK,OAAO,kBAAmB,EAAI,EAC1B,CAAEA,GAAO,CAAE,KAAK,iBACzB,KAAK,eAAiB,sBAAsB,IAAM,CACjD,KAAK,eAAiB,KACf,KAAK,SAAS,IAAI,qBAAqB,GAC7C,KAAK,OAAO,kBAAmB,EAAK,CACtC,CAAC,GAEF,KAAK,OAAO,WAAYA,CAAG,EAC3B,KAAK,KAAK,wBAAwB,EAClC,KAAK,KAAK,oBAAoB,CAC/B,CACD,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,GACT,GAAI,CACH,KAAM,yCACN,MAAO,eACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,EACT,SAAU,CAAC,qBAAqB,EAChC,QAAQqf,EAAKrf,EAAK,CACjB,OAAKA,IAAQ,EACL,CAAEqf,EAAI,IAAI,qBAAqB,EAEhCrf,CACR,EAEA,GAAI,CACH,KAAM,GACN,KAAM,yCACN,MAAO,0BAEP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,OAAO,EACzB,CAAC,MAAO,EAAG,MAAO,QAAQ,EAC1B,CAAC,MAAO,EAAG,MAAO,kBAAkB,CACrC,CACD,EAEA,QAASA,GAAO,CACf,KAAK,OAAO,gBAAiB,CAACA,CAAG,EACjC,KAAK,KAAK,oBAAoB,CAC/B,CACD,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,GACT,GAAI,CACH,KAAM,yCACN,MAAO,2BACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,mBAAoBA,CAAG,CACxD,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,GACT,GAAI,CACH,KAAM,yCACN,MAAO,0BACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,OAAO,wBAAyB,CAACA,CAAG,CAC1D,CAAC,EAED,KAAK,SAAS,IAAI,oCAAqC,CACtD,QAAS,EACT,GAAI,CACH,KAAM,yCACN,MAAO,yCACP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,OAAO,EACzB,CAAC,MAAO,EAAG,MAAO,QAAQ,EAC1B,CAAC,MAAO,EAAG,MAAO,8BAA8B,CACjD,CACD,EACA,QAASA,GAAO,CACf,KAAK,WAAW,oBAAqBA,IAAQ,CAAC,EAC9C,KAAK,WAAW,2BAA4BA,IAAQ,CAAC,CACtD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,EACT,GAAI,CACH,KAAM,yCACN,MAAO,yBACP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,OAAO,EACzB,CAAC,MAAO,EAAG,MAAO,QAAQ,EAC1B,CAAC,MAAO,EAAG,MAAO,8BAA8B,CACjD,CACD,EACA,QAASA,GAAO,CACf,KAAK,WAAW,eAAgBA,IAAQ,CAAC,EACzC,KAAK,WAAW,sBAAuBA,IAAQ,CAAC,CACjD,CACD,CAAC,EAYD,KAAK,SAAS,IAAI,+BAAgC,CACjD,QAAS,GACT,GAAI,CACH,KAAM,yCACN,MAAO,wBACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,wBAAyBA,CAAG,CAC7D,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,EACT,GAAI,CACH,KAAM,yCACN,MAAO,iBACP,UAAW,qBACX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,gBAAgB,EAClC,CAAC,MAAO,EAAG,MAAO,UAAU,EAC5B,CAAC,MAAO,EAAG,MAAO,qBAAqB,CACxC,CACD,EACA,QAASA,GAAO,CACf,KAAK,WAAW,sBAAuBA,IAAQ,CAAC,EAChD,KAAK,OAAO,qBAAsBA,IAAQ,CAAC,CAC5C,CACD,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GACT,SAAU,CAAC,sBAAsB,EACjC,QAAQqf,EAAKrf,EAAK,CACjB,OAAOqf,EAAI,IAAI,sBAAsB,EAAI,GAAQrf,CAClD,EACA,GAAI,CACH,KAAM,yCACN,MAAO,gBACP,YAAa,gEAEb,UAAW,mBACZ,EACA,QAASA,GAAO,CACf,KAAK,OAAO,gBAAiBA,CAAG,EAChC,KAAK,KAAK,oBAAoB,CAC/B,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,SAAU,CAAC,4BAA6B,sBAAsB,EAC9D,QAAS,GACT,QAAQqf,EAAKrf,EAAK,CACjB,OAAKqf,EAAI,IAAI,sBAAsB,EAC3B,GAEDA,EAAI,IAAI,2BAA2B,EACzC,GAAOrf,CACT,EACA,GAAI,CACH,KAAM,wCACN,MAAO,sBACP,YAAa,qEAEb,UAAW,mBACZ,EACA,QAASA,GAAO,CACf,KAAK,OAAO,qBAAsBA,CAAG,EACrC,KAAK,KAAK,oBAAoB,CAC/B,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,SAAU,CAAC,wBAAwB,EACnC,QAAS,GACT,QAAQqf,EAAKrf,EAAK,CACjB,OAAOqf,EAAI,IAAI,wBAAwB,EAAIrf,EAAM,EAClD,EACA,GAAI,CACH,KAAM,wCACN,MAAO,0DACP,UAAW,mBACZ,EACA,QAASA,GAAO,CACf,KAAK,OAAO,cAAeA,CAAG,EAC9B,KAAK,KAAK,oBAAoB,CAC/B,CACD,CAAC,EAED,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,+CACP,UAAW,mBACZ,CACD,CAAC,EAeD,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,GACT,GAAI,CACH,KAAM,wCACN,MAAO,2CACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,sBAAuB,CACxC,QAAS,GACT,GAAI,CACH,KAAM,wCACN,MAAO,0BACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,eAAgB,CAACA,CAAG,CACrD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,wCACN,MAAO,iCACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,gBAAiBA,CAAG,CACrD,CAAC,EAID,KAAK,SAAS,IAAI,gBAAiB,CAClC,QAAS,GACT,GAAI,CACH,KAAM,6BACN,MAAO,mBACP,UAAW,mBACZ,EACA,QAASA,GAAO,CACf,KAAK,WAAW,WAAY,CAACA,CAAG,EAChC,KAAK,KAAK,oBAAoB,CAC/B,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,gEACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,mBAAoB,CAAEA,CAAG,CAC1D,CAAC,EAED,KAAK,SAAS,IAAI,iBAAkB,CACnC,QAAS,GACT,GAAI,CACH,MAAO,GACP,KAAM,yCACN,MAAO,eACP,YAAa,uFACb,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,OAAO,YAAa,CAACA,CAAG,CAC9C,CAAC,EAID,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,gCACP,YAAa,iEACb,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,cAAe,CAAEA,CAAG,CACrD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,GAAI,CACH,KAAM,8BACN,MAAO,cACP,YAAa,6PACb,UAAW,oBACX,KAAM,OAAM,MAAa,CAC1B,EACA,QAAS,IAAM,KAAK,WAAW,CAChC,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,4BACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,OAAO,uBAAwBA,CAAG,CACxD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,SAAU,CAAC,oBAAoB,EAC/B,QAAQqf,EAAKrf,EAAK,CACjB,OAAQqf,EAAI,IAAI,oBAAoB,IAAM,QAAUA,EAAI,IAAI,oBAAoB,IAAM,YAAerf,EAAM,EAC5G,EACA,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,mDACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,mBAAoBA,CAAG,CACxD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,qCACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,OAAO,iBAAkB,CAACA,CAAG,CACnD,CAAC,CAYF,CAEA,UAAW,CACV,KAAK,WAAW,oBAAqB,KAAK,SAAS,IAAI,4BAA4B,CAAC,EACpF,KAAK,WAAW,mBAAoB,KAAK,SAAS,IAAI,8BAA8B,CAAC,EACrF,KAAK,OAAO,qBAAsB,KAAK,SAAS,IAAI,2BAA2B,CAAC,EAChF,KAAK,OAAO,sBAAuB,KAAK,SAAS,IAAI,4BAA4B,CAAC,EAClF,KAAK,OAAO,WAAY,KAAK,SAAS,IAAI,qBAAqB,CAAC,EAChE,KAAK,OAAO,gBAAiB,KAAK,SAAS,IAAI,sBAAsB,CAAC,EACtE,KAAK,OAAO,qBAAsB,KAAK,SAAS,IAAI,2BAA2B,CAAC,EAChF,KAAK,OAAO,cAAe,KAAK,SAAS,IAAI,2BAA2B,CAAC,EAEzE,KAAK,OAAO,wBAAyB,CAAE,KAAK,SAAS,IAAI,8BAA8B,CAAC,EACxF,KAAK,OAAO,gBAAiB,CAAC,KAAK,SAAS,IAAI,sBAAsB,CAAC,EAEvE,KAAK,WAAW,wBAAyB,KAAK,SAAS,IAAI,8BAA8B,CAAC,EAC1F,KAAK,WAAW,gBAAiB,KAAK,SAAS,IAAI,2BAA2B,CAAC,EAC/E,KAAK,WAAW,eAAgB,CAAC,KAAK,SAAS,IAAI,qBAAqB,CAAC,EAEzE,KAAK,OAAO,uBAAwB,KAAK,SAAS,IAAI,uBAAuB,CAAC,EAE9E,KAAK,WAAW,mBAAoB,CAAE,KAAK,SAAS,IAAI,uBAAuB,CAAC,EAEhF,KAAK,OAAO,iBAAkB,CAAE,KAAK,SAAS,IAAI,uBAAuB,CAAC,EAE1E,KAAK,WAAW,mBAAoB,KAAK,SAAS,IAAI,6BAA6B,CAAC,EAEpF,MAAMmuD,EAAS,KAAK,SAAS,IAAI,6BAA6B,EAC9D,KAAK,WAAW,sBAAuBA,IAAW,CAAC,EACnD,KAAK,OAAO,qBAAsBA,IAAW,CAAC,EAE9C,MAAMC,EAAO,KAAK,SAAS,IAAI,mCAAmC,EAClE,KAAK,WAAW,oBAAqBA,IAAS,CAAC,EAC/C,KAAK,WAAW,2BAA4BA,IAAS,CAAC,EAEtD,MAAMC,EAAU,KAAK,SAAS,IAAI,8BAA8B,EAChE,KAAK,WAAW,eAAgBA,IAAY,CAAC,EAC7C,KAAK,WAAW,sBAAuBA,IAAY,CAAC,EAEpD,KAAK,WAAW,WAAY,CAAC,KAAK,SAAS,IAAI,eAAe,CAAC,EAC/D,KAAK,WAAW,cAAe,CAAE,KAAK,SAAS,IAAI,2BAA2B,CAAC,EAE/E,KAAK,SAAS,WAAW,mBAAoBruD,GAAO,KAAK,WAAW,YAAa,CAACA,CAAG,CAAC,EACtF,KAAK,SAAS,WAAW,+BAAgCA,GAAO,KAAK,WAAW,eAAgBA,CAAG,CAAC,EAEpG,KAAK,WAAW,EAChB,KAAK,aAAa,EAElB,KAAK,KAAK,wBAAwB,EAClC,KAAK,KAAK,oBAAoB,CAC/B,CAEA,cAAe,CACd,sBAAsB,IAAM,KAAK,KAAK,wBAAwB,CAAC,CAChE,CAEA,YAAa,CACZ,IAAI8oD,EAAO,KAAK,SAAS,IAAI,0BAA0B,EACvD,GAAKA,GAAQA,EAAK,OAAS,CAC1B,KAAM,CAAC72B,EAAWkb,CAAQ,KAAI,MAAQ2b,CAAI,EAc1C,GAbAA,EAAO72B,EAEF,KAAK,gBACT,KAAK,eAAe,EAErB,KAAK,eAAiBkb,EAEjB2b,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,KAC9GA,EAAO,IAAIA,CAAI,KAEhBpe,EAAgB,MAAM,WAAa,GACnCA,EAAgB,MAAM,WAAaoe,EAE9Bpe,EAAgB,MAAM,WAAa,CACvC,KAAK,YAAY,cAAeoe,CAAI,EACpC,KAAK,OAAO,cAAe,EAAI,EAC/B,MACD,CACD,CAEA,KAAK,OAAO,cAAe,EAAK,EAChC,KAAK,eAAe,aAAa,CAClC,CAEA,WAAW/oD,EAAKC,EAAK,CACpB,MAAMwxC,EAAI,SAASzxC,CAAG,GACtB,GAAK,CAAEC,EAAM,CACZ,KAAK,MAAM,OAAOwxC,CAAC,EACnB,MACD,CAEA,GAAK,IAAE,OAAI0c,EAASnuD,CAAG,EACtB,MAAM,IAAI,MAAM,0BAA0BA,CAAG,GAAG,EAEjD,KAAK,MAAM,IAAIyxC,EAAG,GAAG0c,EAAQnuD,CAAG,CAAC,+BAA+B,CACjE,CAGA,OAAOA,EAAKC,EAAK,CAChBA,EAAM,CAAC,CAAEA,GACH,KAAK,OAAOD,CAAG,GAAK,MAAWC,IAGrC,KAAK,OAAOD,CAAG,EAAIC,EACnB,KAAK,OAAOD,CAAG,EAChB,CAEA,OAAOA,EAAK,CAEX,GAAK,CADO,KAAK,OAAOA,CAAG,EACd,CACP,KAAK,OACT,KAAK,MAAM,OAAOA,CAAG,EACtB,MACD,CAEA,GAAK,MAAK,MAAM,IAAIA,CAAG,EAGvB,IAAK,CAAE,KAAK,cACX,OAAO,KAAK,gBAAgB,EAAE,KAAK,IAAM,KAAK,OAAOA,CAAG,CAAC,EAE1D,GAAK,IAAE,OAAI,KAAK,OAAQA,CAAG,EAAI,CAC9B,KAAK,IAAI,KAAK,uBAAuBA,CAAG,gBAAgB,EACxD,MACD,CAEA,KAAK,MAAM,IAAIA,EAAK,KAAK,OAAOA,CAAG,CAAC,EACrC,CAGA,IAAIA,EAAKC,EAAK,CAAE,OAAO,KAAK,MAAM,IAAID,EAAKC,CAAG,CAAE,CAChD,OAAOD,EAAK,CAAE,OAAO,KAAK,MAAM,OAAOA,CAAG,CAAE,CAE5C,YAAYA,EAAKC,EAAKsuD,EAAQ,OAAQ,CACrC,KAAK,MAAM,IAAI,QAAQvuD,CAAG,GAAI,GAAGuuD,CAAK,YAAYvuD,CAAG,KAAKC,CAAG,KAAK,CACnE,CAEA,eAAeD,EAAK,CAAE,KAAK,MAAM,OAAO,QAAQA,CAAG,EAAE,CAAE,CAGvD,iBAAkB,CACjB,GAAK,MAAK,cAGV,OAAO,IAAI,QAAQ,MAAM2d,GAAK,CAC7B,MAAMmS,GAAO,MAAM,iCAAiE,QACpF,UAAU9vB,KAAO8vB,EAAI,KAAK,EAAG,CAC5B,MAAM2hB,EAAIzxC,EAAI,MAAM,EAAGA,EAAI,QAAUA,EAAI,SAAS,OAAO,EAAI,EAAI,EAAE,EACnE,KAAK,OAAOyxC,CAAC,EAAI3hB,EAAI9vB,CAAG,EAAE,OAC3B,CAEA,KAAK,KAAK,oBAAoB,EAE9B,KAAK,cAAgB,GACrB2d,EAAE,CACH,CAAC,CACF,CACD,EAzkB8C,iBAA/B,IAAM6wC,EAAN,C,mGCtDA,MAAM,EAAN,MAAM,UAAkB,SAAO,CAC7C,eAAe/oD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,cAAc,EAE1B,KAAK,kBAAoB,KAAK,KAAK,OAClC,iBACA8X,GAAKA,EAAE,SAAWA,EAAE,UAAYA,EAAE,OAAO,KACzC,IAAS,eACV,EAEA,KAAK,gBAAkB,KAAK,KAAK,OAChC,mBACAA,GAAKA,EAAE,OAAO,WAAaA,EAAE,MAAM,iBAAgB,OAAIA,EAAE,MAAO,eAAe,EAC/E,IAAS,eACV,CACD,CAEA,UAAW,CACV,KAAK,gBAAgB,GAAG,QAAS,KAAK,eAAgB,IAAI,EAC1D,KAAK,gBAAgB,GAAG,SAAU,KAAK,eAAgB,IAAI,EAC3D,KAAK,gBAAgB,GAAG,UAAW,KAAK,eAAgB,IAAI,EAC5D,KAAK,gBAAgB,MAAM,CAACiuB,EAAKC,IAAc,CAC9C,UAAUF,KAAQE,EACjB,KAAK,eAAeF,CAAI,CAC1B,CAAC,EAED,KAAK,kBAAkB,GAAG,QAAS,KAAK,gBAAiB,IAAI,EAC7D,KAAK,kBAAkB,GAAG,SAAU,KAAK,gBAAiB,IAAI,EAC9D,KAAK,kBAAkB,GAAG,UAAW,KAAK,gBAAiB,IAAI,EAC/D,KAAK,kBAAkB,MAAM,CAACC,EAAKC,IAAc,CAChD,UAAUF,KAAQE,EACjB,KAAK,gBAAgBF,CAAI,CAC3B,CAAC,CACF,CAEA,eAAeA,EAAM,CACpB,KAAK,SAAS,cAAc,CAC3B,WAAS,OAAI,qBAAsBA,CAAI,EACvC,aAAW,OAAI,kBAAmBA,CAAI,CAEvC,CAAC,CACF,CAEA,gBAAiB,CAChB,KAAK,SAAS,cAAc,CAC3B,QAAS,KACT,UAAW,IAEZ,CAAC,CACF,CAEA,gBAAgBA,EAAM,CACrB,MAAM33B,EAAO23B,EAAK,OAAO,MAAM,MAAM,kBACpCxhB,EAAOnW,GAAM,KAEd,KAAK,SAAS,cAAc,CAC3B,SAAUmW,GAAM,KAChB,WAAYA,GAAM,GAClB,MAAOnW,GAAM,KACd,CAAC,CACF,CAEA,iBAAkB,CACjB,KAAK,SAAS,cAAc,CAC3B,SAAU,KACV,WAAY,KACZ,MAAO,IACR,CAAC,CACF,CACD,EA3E8C,iBAA/B,IAAM66C,EAAN,C,sJCAA,MAAM,EAAN,MAAM,UAAa,SAAO,CACxC,eAAehpD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,aAAa,EAEzB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EAEtB,KAAK,WAAa,KAAK,KAAK,OAC3B,cACA8X,GAAKA,EAAE,OAASA,EAAE,MAAM,MAAQA,EAAE,gBAAkBA,EAAE,yBACtD,CAAC,iBAAkB,gBAAiB,kBAAmB,iBAAkB,kBAAkB,CAC5F,EAEA,KAAK,SAAS,MAAM,+BAAgC,CACnD,KAAM,wQACN,UAAW,mBACX,QAAS,CAAC,EACV,WAAY,IAAM,KAAK,OAAO,YAAY,CAC3C,CAAC,EAED,KAAK,SAAS,MAAM,mCAAoC,CACvD,KAAM,8CACN,UAAW,mBACX,QAAS,CAAC,EACV,WAAY,IAAM,KAAK,OAAO,YAAY,CAC3C,CAAC,CACF,CAEA,UAAW,CACV,KAAK,WAAW,GAAG,QAAS,KAAK,iBAAkB,IAAI,EACvD,KAAK,WAAW,GAAG,SAAU,KAAK,iBAAkB,IAAI,EACxD,KAAK,WAAW,GAAG,UAAW,IAAM,CACnC,KAAK,SAAS,cAAc,CAC3B,SAAU,KACV,WAAY,IACb,CAAC,CACF,CAAC,EAED,KAAK,SAAS,SAAS,GAAG,UAAWvd,GAAO,CAC3C,GAAKA,IAAQ,gCAAkCA,IAAQ,mCAAqC,CAC3F,KAAK,OAAO,YAAY,EAExB,UAAUurC,KAAQ,KAAK,WAAW,UACjC,KAAK,iBAAiBA,CAAI,CAC5B,CACD,CAAC,EAED,KAAK,WAAW,MAAM,CAACC,EAAKC,IAAc,CACzC,UAAUF,KAAQE,EACjB,KAAK,iBAAiBF,CAAI,CAC5B,CAAC,EAED,KAAK,GAAG,oBAAqB2G,GAAS,CAChCA,GAASA,EAAM,OAAS,kBAC5B,KAAK,iBAAiB,CACxB,CAAC,CACF,CAGA,iBAAiB3G,EAAM,CACtB,GAAKA,IAAS,OAAY,CACzB,UAAUA,KAAQ,KAAK,WAAW,UACjC,KAAK,iBAAiBA,CAAI,EAE3B,MACD,CAEA,KAAK,cAAcA,CAAI,EAEvB,MAAM1H,EAAW0H,GAAM,OAAO,MAAM,KAEpC,KAAK,SAAS,cAAc,CAC3B,SAAU1H,GAAU,KACpB,WAAYA,GAAU,EACvB,CAAC,CACF,CAGA,cAAc0H,EAAM,CACnB,MAAMrgB,EAAY,KAAK,KAAK,aAAaqgB,CAAI,EAC7C,MAAK,OAAI,YAAaA,EAAK,KAAK,GAAK,MAAQ,CAAErgB,GAAa,CAAEA,EAAU,cACvE,OAED,MAAMwjC,EAAcxjC,EAAU,cAAc,wBAAwB,EAC/DwjC,GACJA,EAAY,OAAO,EAEpB,MAAMC,EAAUzjC,EAAU,cAAc,+CAA+C,EACvF,GAAK,CAAEyjC,EACN,OAED,IAAIC,EAAWC,EACdC,EAAYC,EAEb,MAAMhlC,KAAO,OAAI,iBAAkBwhB,EAAK,KAAK,GAAKA,EAAK,MAAM,cAC5DyjB,EAAe,MAAM,CACpB,MAAMC,EAAgB,KAAK,SAAS,SAAS,IAAI,+BAAgC,CAAC,CAAC,EAClFtF,EAAUsF,EAAc,SAASllC,CAAI,EAEtC6kC,EAAU,UAAU,OAAO,SAAUjF,CAAO,EAC5CkF,EAAY,YAAclF,EACzB,KAAK,KAAK,EAAE,oBAAqB,SAAS,EAC1C,KAAK,KAAK,EAAE,kBAAmB,OAAO,CACxC,EARe,gBASfuF,EAAgB,MAAM,CACrB,MAAMC,EAAe,KAAK,SAAS,SAAS,IAAI,mCAAoC,CAAC,CAAC,EACrFr7B,EAASq7B,EAAa,SAASplC,CAAI,EAEpC+kC,EAAW,UAAU,OAAO,SAAUh7B,CAAM,EAC5Ci7B,EAAa,YAAcj7B,EAC1B,KAAK,KAAK,EAAE,4BAA6B,iBAAiB,EAC1D,KAAK,KAAK,EAAE,4BAA6B,iBAAiB,CAC5D,EARgB,iBAUjB86B,KAAa,iBAAC,UACb,MAAM,iDACN,QAAS,KAAK,qBAAqB,+BAAgC7kC,EAAMilC,CAAY,GAEpFH,KAAc,iBAAC,QAAK,MAAM,iBAAkB,EAC9C,EAEAG,EAAa,EAEbF,KAAc,iBAAC,UACd,MAAM,2CACN,QAAS,KAAK,qBAAqB,mCAAoC/kC,EAAMmlC,CAAa,GAEzFH,KAAe,iBAAC,QAAK,MAAM,iBAAkB,EAC/C,EAEAG,EAAc,EAEdP,EAAQ,eAAY,iBAAC,OAAI,MAAM,mCAC7BC,EACAE,CACF,CAAM,CACP,CAEA,qBAAqBp9B,EAAS3H,EAAMqlC,EAAa,CAChD,OAAO9xC,GAAK,CACXA,EAAE,eAAe,EACjB,MAAM+xC,EAAS,KAAK,SAAS,SAAS,IAAI39B,CAAO,GAAK,CAAC,EACtDnS,EAAM8vC,EAAO,QAAQtlC,CAAI,EAErBxK,IAAQ,GACZ8vC,EAAO,KAAKtlC,CAAI,EAEhBslC,EAAO,OAAO9vC,EAAK,CAAC,EAErB,KAAK,SAAS,SAAS,IAAImS,EAAS29B,CAAM,EAC1C,KAAK,OAAO,YAAY,EACxBD,EAAY,CACb,CACD,CACD,EA9JyC,YAA1B,IAAME,EAAN,ECER,MAAMC,GAAiB,CAACjyC,EAAG,CAAC,KAClCA,EAAEA,EAAE,eAAiB,CAAC,EAAI,iBAC1BA,EAAEA,EAAE,kBAAoB,CAAC,EAAI,oBAC7BA,EAAEA,EAAE,wBAA0B,CAAC,EAAI,0BAC5BA,IACL,EAEUkyC,EAAgB,CAC5B,oBACA,WACA,aACA,qBACA,eACA,gBACD,EAEA,SAASl4B,EAAY1jB,EAAM4W,EAAO,CAIjC,OAHK5W,EAAK,CAAC,EAAE,QACZA,EAAK,CAAC,EAAE,QAAK,qBAAkBA,EAAK,CAAC,EAAE,KAAK,GAAG,CAAC,CAAC,EAE3CA,EAAK,CAAC,EAAE,OAGR,IAAI,OAAOA,EAAK,CAAC,EAAE,KAAK,GAAG,EAAG4W,CAAK,EAFlC,IAGT,CARS,EAAA8M,EAAA,eAYT,MAAMm4B,EAAa,CAAC,aAAc,MAAO,gBAAiB,sBAAuB,eAAgB,gBAAiB,iBAAkB,iBAAkB,kBAAmB,UAAW,eAAgB,cAAe,YAAY,EAG1M,EAAN,MAAM,UAAkB,SAAO,CAC7C,eAAehqD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,gBAAgB,EAC5B,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,iBAAiB,EAC7B,KAAK,OAAO,kBAAkB,EAE9B,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EAEtB,KAAK,OAAO6pD,CAAI,EAEhB,KAAK,cAAgB,KAAK,UAAU,OACnC,iBACA,iRACAG,EAAY,KAAM,EAAG,CACtB,EAEA,KAAK,wBAA0B,KAAK,UAAU,OAC7C,4BACA,yDACAA,EAAY,KAAM,EAAG,CACtB,EAEA,KAAK,kBAAoB,KAAK,UAAU,OACvC,sBAAuB,wBACvBA,EAAY,KAAM,EAAG,CACtB,EAEA,KAAK,eAAiB,KAAK,KAAK,OAC/B,kBACAlyC,GAAKA,EAAE,kBAAoBA,EAAE,OAASA,EAAE,MAAM,MAC9CkyC,CACD,EAEA,KAAK,gBAAkB,KAAK,KAAK,OAChC,mBACAlyC,GAAKA,EAAE,mBAAqBA,EAAE,mBAAqBA,EAAE,sBAAwBA,EAAE,aAC/EkyC,CACD,EAEA,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,EAET,GAAI,CACH,KAAM,kEACN,MAAO,eACP,UAAW,qBACX,KAAM,IAEN,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,eAAe,EACjC,CAAC,MAAO,EAAG,MAAO,8BAA8B,EAChD,CAAC,MAAO,EAAG,MAAO,YAAY,EAC9B,CAAC,MAAO,EAAG,MAAO,sBAAsB,CACzC,CACD,EAEA,QAASxvD,GAAO,CACf,KAAK,WAAW,OAAO,cAAeA,EAAM,CAAC,EAC7C,KAAK,WAAW,OAAO,iBAAkBA,IAAQ,GAAKA,IAAQ,CAAC,CAChE,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,QAAS,GAET,GAAI,CACH,KAAM,qCACN,MAAO,2CACP,UAAW,oBACX,cAAe,IAAM,CAAC,WAAY,WAAW,CAC9C,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GAET,GAAI,CACH,KAAM,mDACN,MAAO,wCACP,UAAW,oBACX,KAAM,GACP,EAEA,QAASA,GAAO,KAAK,WAAW,OAAO,aAAcA,CAAG,CACzD,CAAC,EAGD,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,EAET,GAAI,CACH,KAAM,qCACN,MAAO,gBACP,YAAa,kDACb,UAAW,qBAEX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,UAAU,EAC5B,CAAC,MAAO,EAAG,MAAO,SAAS,EAC3B,CAAC,MAAO,EAAG,MAAO,wBAAwB,CAC3C,CACD,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GAET,GAAI,CACH,KAAM,qCACN,MAAO,0CACP,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAeD,KAAK,SAAS,IAAI,sBAAuB,CACxC,QAAS,GACT,GAAI,CACH,KAAM,qCACN,MAAO,4DACP,UAAW,mBACZ,EAEA,QAAS2L,GAAS,KAAK,WAAW,WAAW,eAAgBA,CAAK,CACnE,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GAET,GAAI,CACH,KAAM,qCACN,MAAO,iDACP,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAGD,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GAET,GAAI,CACH,KAAM,qCACN,MAAO,uCACP,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,6BAA8B,CAC/C,QAAS,GACT,GAAI,CACH,KAAM,sCACN,MAAO,sEACP,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,eAAe,YAAY,CAChD,CAAC,EAGD,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,GAAI,CACH,KAAM,4CACN,UAAW,cACX,MAAO,EACR,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,SAAU,CAAC,uBAAuB,EAClC,OAAQ,eACR,QAAQ0T,EAAK,CACZ,MAAMrf,EAAMqf,EAAI,IAAI,uBAAuB,EAC3C,GAAK,CAAErf,GAAO,CAAEA,EAAI,OACnB,OAAO,KAER,MAAMU,EAAM,CAAC,CAAC,EAAG,CAAC,CAAC,EAEnB,UAAU4B,KAAQtC,EAAK,CACtB,MAAMud,EAAIjb,EAAK,EACf,IAAI4b,EAAI5b,EAAK,EAERib,IAAM,OACVW,KAAI,iBAAcA,CAAC,EAEVX,IAAM,QACfW,KAAI,gBAAaA,CAAC,GAEd,GAAEA,GAAK,CAAEA,EAAE,SAGhBxd,EAAI4B,EAAK,EAAI,EAAI,CAAC,EAAE,KAAK4b,CAAC,CAC3B,CAEA,MAAO,CACNxd,EAAI,CAAC,EAAE,OACJ,IAAI,OAAO,OAAOA,EAAI,CAAC,EAAE,KAAK,GAAG,CAAC,IAAI,EACtC,KACHA,EAAI,CAAC,EAAE,OACJ,IAAI,OAAO,OAAOA,EAAI,CAAC,EAAE,KAAK,GAAG,CAAC,KAAM,GAAG,EAC3C,IACJ,CACD,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,GAAI,CACH,KAAM,yCACN,UAAW,aACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,kCAAmC,CACpD,SAAU,CAAC,wBAAwB,EACnC,OAAQ,eACR,QAAQ2e,EAAK,CACZ,MAAMrf,EAAMqf,EAAI,IAAI,wBAAwB,EAC5C,GAAK,CAAErf,GAAO,CAAEA,EAAI,OACnB,OAAO,KAER,MAAMU,EAAM,CACX,CACC,CAAC,EAAG,CAAC,CACN,EACA,CACC,CAAC,EAAG,CAAC,CACN,CACD,EAEA,UAAU4B,KAAQtC,EAAK,CACtB,MAAMud,EAAIjb,EAAK,EACf,IAAI4b,EAAI5b,EAAK,EAERib,IAAM,OACVW,KAAI,iBAAcA,CAAC,EAEVX,IAAM,QACfW,KAAI,gBAAaA,CAAC,GAEd,GAAEA,GAAK,CAAEA,EAAE,SAGhBxd,EAAI4B,EAAK,EAAI,EAAI,CAAC,EAAEA,EAAK,EAAI,EAAI,CAAC,EAAE,KAAK4b,CAAC,CAC3C,CAEA,MAAO,CACNmZ,EAAY32B,EAAI,CAAC,EAAG,GAAG,EACvB22B,EAAY32B,EAAI,CAAC,EAAG,IAAI,CACzB,CACD,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,CAAC,EACV,KAAM,oBACN,eAAgB,GAChB,GAAI,CACH,KAAM,uCACN,UAAW,iBACZ,EACA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAGD,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,GAAI,CACH,KAAM,mDACN,UAAW,aACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,SAAU,CAAC,uBAAuB,EAClC,OAAQ,eACR,QAAQ2e,EAAK,CACZ,MAAMrf,EAAMqf,EAAI,IAAI,uBAAuB,EAC3C,GAAK,CAAErf,GAAO,CAAEA,EAAI,OACnB,OAAO,KAER,MAAMU,EAAM,CACX,CACC,CAAC,EAAG,CAAC,CACN,EACA,CACC,CAAC,EAAG,CAAC,CACN,CACD,EAEA,UAAU4B,KAAQtC,EAAK,CACtB,MAAMud,EAAIjb,EAAK,EACf,IAAI4b,EAAI5b,EAAK,EAERib,IAAM,OACVW,KAAI,iBAAcA,CAAC,EAEVX,IAAM,QACfW,KAAI,gBAAaA,CAAC,GAEd,GAAEA,GAAK,CAAEA,EAAE,SAGhBxd,EAAI4B,EAAK,EAAI,EAAI,CAAC,EAAEA,EAAK,EAAI,EAAI,CAAC,EAAE,KAAK4b,CAAC,CAC3C,CAEA,MAAO,CACNmZ,EAAY32B,EAAI,CAAC,EAAG,GAAG,EACvB22B,EAAY32B,EAAI,CAAC,EAAG,IAAI,CACzB,CACD,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,sBAAuB,CACxC,QAAS,CAAC,EACV,KAAM,oBACN,eAAgB,GAChB,GAAI,CACH,KAAM,iDACN,UAAW,iBACZ,EACA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GACT,GAAI,CACH,KAAM,qCACN,MAAO,yEACP,YAAa,8VACb,UAAW,mBACZ,EACA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,QAAQ2e,EAAKrf,EAAK,CACjB,MAAMU,EAAM,IAAI,IAChB,UAAUwd,KAAKle,EAAK,CACnB,IAAIsC,EAAO4b,GAAG,EACT5b,IAAS,mBACbA,EAAO,kBACHA,GACJ5B,EAAI,IAAI4B,CAAI,CACd,CAEA,OAAO5B,CACR,EAEA,GAAI,CACH,KAAM,wCACN,UAAW,gBACX,cAAe,IAAM,CAAC,GAAG6uD,CAAa,EACtC,KAAM,IAAM,CAAC,GAAGA,CAAa,EAC3B,KAAK,CACR,EAEA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAED,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,CAAC,EACV,KAAM,cACN,eAAgB,GAChB,QAAQlwC,EAAKrf,EAAK,CACjB,MAAMU,EAAM,IAAI,IAChB,UAAUwd,KAAKle,EACTke,GAAG,GACPxd,EAAI,IAAIwd,EAAE,CAAC,EAEb,OAAOxd,CACR,EAEA,GAAI,CACH,KAAM,kDACN,UAAW,gBACX,cAAe,IAAM,CAAC,GAAG6uD,CAAa,EACtC,KAAM,IAAM,CAAC,GAAGA,CAAa,EAC3B,KAAK,CACR,EACA,QAAS,IAAM,KAAK,YAAY,CACjC,CAAC,EAwBD,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,wBACP,UAAW,qBACX,KAAM,CACL,CACC,MAAO,GACP,MAAO,UACR,EACA,CACC,MAAO,YACP,MAAO,qBACR,EACA,CACC,MAAO,eACP,MAAO,uBACR,EACA,CACC,MAAO,mBACP,MAAO,uBACR,EACA,CACC,MAAO,SACP,MAAO,kBACR,CACD,CACD,EACA,QAAS,IAAM,KAAK,cAAc,CACnC,CAAC,EAED,KAAK,WAAa,KAAK,WAAW,KAAK,IAAI,CAC5C,CAGA,UAAW,CACV,KAAK,WAAW,WAAW,gBAAiB,KAAK,SAAS,IAAI,gCAAgC,IAAM,CAAC,EACrG,KAAK,WAAW,WAAW,eAAgB,KAAK,SAAS,IAAI,qBAAqB,CAAC,EACnF,KAAK,WAAW,OAAO,aAAc,KAAK,SAAS,IAAI,yBAAyB,CAAC,EACjF,KAAK,SAAS,WAAW,iCAAkCvvD,GAAO,KAAK,WAAW,OAAO,uBAAwBA,CAAG,CAAC,EAErH,MAAMyvD,EAAO,KAAK,SAAS,IAAI,wBAAwB,EAEvD,KAAK,WAAW,OAAO,cAAeA,EAAO,CAAC,EAC9C,KAAK,WAAW,OAAO,iBAAkBA,IAAS,GAAKA,IAAS,CAAC,EAEjE,KAAK,GAAG,cAAe,IAAM,KAAK,YAAY,CAAC,EAE/C,KAAK,wBAAwB,GAAG,QAAS,KAAK,cAAe,IAAI,EACjE,KAAK,wBAAwB,GAAG,SAAU,KAAK,cAAe,IAAI,EAClE,KAAK,wBAAwB,GAAG,UAAW,KAAK,aAAc,IAAI,EAClE,KAAK,wBAAwB,KAAKjpB,GAAM,KAAK,cAAcA,CAAE,CAAC,EAE9D,KAAK,cAAc,GAAG,QAAS,KAAK,WAAY,IAAI,EACpD,KAAK,cAAc,GAAG,SAAU,KAAK,WAAY,IAAI,EACrD,KAAK,cAAc,GAAG,UAAW,KAAK,UAAW,IAAI,EACrD,KAAK,cAAc,KAAKA,GAAM,KAAK,WAAWA,CAAE,CAAC,EAEjD,KAAK,kBAAkB,GAAG,QAAS,KAAK,eAAgB,IAAI,EAC5D,KAAK,kBAAkB,GAAG,SAAU,KAAK,eAAgB,IAAI,EAE7D,KAAK,kBAAkB,KAAKA,GAAM,KAAK,eAAeA,CAAE,CAAC,EAEzD,KAAK,gBAAgB,GAAG,QAAS,KAAK,cAAe,IAAI,EACzD,KAAK,gBAAgB,MAAM,IAAM,KAAK,cAAc,CAAC,EAErD,MAAMjpB,EAAI,KAEV,KAAK,eAAe,MAAMguB,GAAO,CAChC,MAAMmkB,EAAoBnkB,EAAI,UAAU,iBACxCA,EAAI,UAAU,iBAAmB,SAAS7oC,KAAS8C,EAAM,CACxD,GAAI,CACH,IAAIskB,EAMJ,GALKpnB,EAAK,aAAe,OACxBonB,EAAOpnB,EAAK,KACHA,EAAK,OACdonB,EAAOpnB,EAAK,KAAK,MAEbonB,GAAQvM,EAAE,SAAS,SAAS,IAAI,+BAAgC,CAAC,CAAC,EAAE,SAASuM,CAAI,EACrF,MAAO,EAET,OAAQjJ,EAAK,CACZtD,EAAE,IAAI,QAAQsD,CAAG,EACjBtD,EAAE,IAAI,MAAMsD,CAAG,CAChB,CAEA,OAAO6uC,EAAkB,KAAK,KAAMhtD,EAAM,GAAG8C,CAAI,CAClD,EAEA,MAAM2uC,EAAa5I,EAAI,UAAU,OACjCA,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CACH,GAAKhuB,EAAE,SAAS,IAAI,4BAA4B,MACnC,OAAI,wBAAyB,IAAI,IAChC,sBACZ,OAAO,IAGV,OAAQsD,EAAK,CACZtD,EAAE,IAAI,QAAQsD,CAAG,CAClB,CAEA,OAAOszB,EAAW,KAAK,IAAI,CAC5B,EAEA,KAAK,eAAe,YAAY,CACjC,CAAC,CACF,CAEA,cAAc7I,EAAM,CACnB,GAAK,CAAEA,EAAO,CACb,UAAUA,KAAQ,KAAK,gBAAgB,UACtC,KAAK,cAAcA,CAAI,EACxB,MACD,CAEA,MAAM/f,EAAO,KAAK,SAAS,IAAI,wBAAwB,EACvD,GAAK,CAAEA,GAAQA,IAAS+f,EAAK,OAAO,aACnC,OAED,MAAM3E,EAAO2E,EAAK,kBAAkB/f,EAAM,GAAO+f,EAAK,KAAK,EACpD3E,GAAM,OAAO,SAKfA,EAAK,MAAM,SACfA,EAAK,MAAM,QAAQ,EAGpB,KAAK,OAAO,KAAKA,EAAK,MAAM,MAAM,EACnC,CAEA,eAAeH,EAAI,CAClB,MAAMyD,EAAQ,KAAK,KAAK,iBAAiBzD,CAAE,EAC3C,GAAK,CAAEyD,EACN,OAED,MAAMrjB,EAAQqjB,EAAM,QAAQ,cAC5B,GAAK,CAAErjB,GAAO,eAAe,SAC5B,OAED,MAAMkD,EAAOlD,EAAM,cAAc,SAChCzlB,EAAOylB,EAAM,cAAc,KAE5B,IAAI+oC,EAAU,GAEd,GAAK,MAAM,QAAQxuD,CAAI,EAAI,CAC1B,MAAMyuD,EAAW,KAAK,SAAS,IAAI,yBAA0B,CAAC,CAAC,EAC/D,GAAKA,EAAS,QACb,UAAUnuD,KAAON,EAChB,GAAKM,GAAK,IAAMmuD,EAAS,SAASnuD,EAAI,EAAE,EAAI,CAC3CkuD,EAAU,GACV,KACD,EAGH,CAEA,MAAME,EAAcF,GAAW,KAAK,SAAS,SAAS,IAAI,+BAAgC,CAAC,CAAC,EAAE,SAAS7lC,CAAI,EAE3G,IAAIgmC,EAAiBtpB,EAAG,QAAQ,iBAAiB,EAC1CspB,IACNA,EAAiBtpB,GAEbspB,EAAe,iBAAiB,yCAAyC,EAAE,OAAS,GACxFA,EAAe,UAAU,OAAO,UAAWD,CAAW,CACxD,CAEA,aAAc,CACb,KAAK,cAAc,KAAKrpB,GAAM,KAAK,WAAWA,CAAE,CAAC,EACjD,KAAK,wBAAwB,KAAKA,GAAM,KAAK,cAAcA,CAAE,CAAC,EAC9D,KAAK,kBAAkB,KAAKA,GAAM,KAAK,eAAeA,CAAE,CAAC,EACzD,KAAK,eAAe,YAAY,EAEhC,KAAK,KAAK,eAAe,CAC1B,CAEA,UAAUA,EAAIupB,EAAU,GAAO,CAC9B,KAAK,YAAYvpB,CAAE,EACnB,KAAK,WAAWA,CAAE,EAElB,MAAMsF,EAAO,KAAK,sBAAsBtF,EAAIupB,CAAO,EAC9CjkB,GACJA,EAAK,OAAO,EAEbtF,EAAG,eAAiB,IACrB,CAEA,aAAaA,EAAI,CAChB,OAAO,KAAK,UAAUA,EAAI,EAAI,CAC/B,CAEA,WAAWA,EAAI,CACd,MAAMlmC,EAAS,KAAK,KAAK,iBAAiBkmC,EAAIlpB,GAAKA,EAAE,eAAe,YAAY,EAChF,GAAK,CAAEhd,EACN,OAED,MAAMsmB,EAAQtmB,EAAO,cACrB,OAAO,KAAK,YAAYkmC,EAAI,GAAO5f,EAAOA,EAAM,aAAa,CAC9D,CAEA,cAAc4f,EAAI,CACjB,MAAMlmC,EAAS,KAAK,KAAK,iBAAiBkmC,EAAIlpB,GAAKA,EAAE,eAAe,MAAM,SAAS,EACnF,GAAK,CAAEhd,EACN,OAED,MAAMsmB,EAAQtmB,EAAO,cACpBgC,EAAOskB,EAAM,KAEd,OAAO,KAAK,YAAY4f,EAAI,GAAMlkC,EAAMskB,EAAM,QAAQ,CACvD,CAEA,YAAY4f,EAAIupB,EAASztD,EAAM0tD,EAAU,CACxC,MAAMlmC,EAAOxnB,EAAK,cAAgBA,EAAK,WAAa0tD,GAAU,MAAQA,GAAU,cAAgBA,GAAU,SACzG7uD,EAAOmB,EAAK,MAAQA,EAAK,cAAc,aAElC2tD,EAAa,KAAK,SAAS,IAAI,sBAAsB,EAC1DC,EAAa,KAAK,SAAS,IAAI,sBAAsB,EACrDC,EAAa,KAAK,SAAS,IAAI,uBAAwB,CAAC,CAAC,EACzDC,EAAc,KAAK,SAAS,IAAI,wBAAyB,CAAC,CAAC,EAC3DC,EAAeF,EAAW,KAAO,GAAKC,EAAY,KAAO,EACzDE,EAAYJ,GAAcG,EAEtB7pB,EAAG,aAAe,QAAa8pB,IACnC9pB,EAAG,WAAa,KAGXlkC,EAAK,MAAQA,EAAK,OAAS,QAG/BkkC,EAAG,WAAa,CAAC,EAENlkC,EAAK,OAASA,EAAK,OAAS,SAGvCkkC,EAAG,WAAa,CAAC,EAKjB,KAAK,YAAY,eAAelkC,EAAK,UAAWA,EAAK,UAAY,KAAOA,EAAK,YAAY,EAAE,KAAKqR,GAAQ,CACvG6yB,EAAG,WAAa7yB,GAAQ,CAAC,EACzBo8C,EACG,KAAK,cAAcvpB,CAAE,EACrB,KAAK,WAAWA,CAAE,CACtB,CAAC,GAIH,IAAImpB,EAAU,GACbY,EAAW,GAEZ,GAAK,MAAM,QAAQpvD,CAAI,EAAI,CAC1B,MAAMyuD,EAAW,KAAK,SAAS,IAAI,yBAA0B,CAAC,CAAC,EAC9DY,EAAY,KAAK,SAAS,IAAI,sBAAuB,CAAC,CAAC,EAExD,GAAKZ,EAAS,QAAUY,EAAU,OACjC,UAAU/uD,KAAON,EAAM,CACtB,GAAKM,GAAK,KAAO,CAChB,MAAMgvD,EAAQhvD,EAAI,KAAK,YAAY,EAC9BmuD,EAAS,SAASa,CAAK,IAC3Bd,EAAU,IACNa,EAAU,SAASC,CAAK,IAC5BF,EAAW,GACb,CACA,IAAMZ,GAAW,CAAEC,EAAS,UAAYW,GAAY,CAAEC,EAAU,QAC/D,KACF,CAEF,CAEA,IAAIE,EAAcH,EAKlB,GAJKN,GAAcI,GAAgB7pB,EAAG,YAAc,OACnDkqB,EAAc,IACRA,IACNA,EAAc,KAAK,SAAS,SAAS,IAAI,mCAAoC,CAAC,CAAC,EAAE,SAAS5mC,CAAI,GAC1F,CAAE4mC,GAAeP,EAAW,MAAQ3pB,EAAG,YAC3C,UAAU1H,KAAQ0H,EAAG,WACpB,GAAK1H,GAAM,IAAMqxB,EAAW,IAAIrxB,EAAK,EAAE,EAAI,CAC1C4xB,EAAc,GACd,KACD,EAEF,GAAK,CAAEA,EAAc,CACpB,MAAMtwB,EAAU,KAAK,SAAS,IAAI,gCAAgC,EAC7DA,IACCA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,IACnBA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,KAElBA,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK99B,EAAK,KAAK,GAAS89B,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK99B,EAAK,KAAK,KAC9FouD,EAAc,IAEjB,CAEA,MAAM9uD,EAAOU,EAAK,MAAQA,EAAK,WAE/BkkC,EAAG,UAAU,OAAO,qBAAsBkqB,CAAW,EACrDlqB,EAAG,QAAQ,QAAU5kC,EAErB,IAAIiuD,EAAc,GAClB,GAAKF,EACJE,EAAc,WACLjuD,IAAS,SAAW,KAAK,SAAS,IAAI,yBAAyB,EACxEiuD,EAAc,WACLvtD,EAAK,SAAW,MAAQA,EAAK,UAAYgtD,EAAc,gBAAkB,KAAK,SAAS,SAAS,IAAI,+BAAgC,CAAC,CAAC,EAAE,SAASxlC,CAAI,EAC9J+lC,EAAc,YACJvtD,EAAK,aAAeA,EAAK,aAAe,mBAAqBA,EAAK,aAAe,aAAeA,EAAK,aAAe,cAAgB,KAAK,SAAS,IAAI,yBAAyB,EACzLutD,EAAc,OACV,CACJ,GAAKO,EAAY,MAAQ5pB,EAAG,YAC3B,UAAU1H,KAAQ0H,EAAG,WACpB,GAAK1H,GAAM,IAAMsxB,EAAY,IAAItxB,EAAK,EAAE,EAAI,CAC3C+wB,EAAc,GACd,KACD,EAGF,GAAK,CAAEA,EAAc,CACpB,MAAMzvB,EAAU,KAAK,SAAS,IAAI,gCAAgC,EAC7DA,IACCA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,IACnBA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,KAElBA,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK99B,EAAK,YAAY,GAAS89B,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK99B,EAAK,YAAY,KAC5GutD,EAAc,IAEjB,CAEA,GAAK,CAAEA,EAAc,CACpB,MAAMzvB,EAAU,KAAK,SAAS,IAAI,iCAAiC,EAC9DA,IACCA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,IACnBA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,KAElBA,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK99B,EAAK,KAAK,GAAS89B,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK99B,EAAK,KAAK,KAC9FutD,EAAc,IAEjB,CACD,CAEA,IAAIC,EAAiBtpB,EAAG,QAAQ,iBAAiB,EAC1CspB,IACNA,EAAiBtpB,GAEbspB,EAAe,iBAAiB,4CAA4C,EAAE,OAAS,GAC3FA,EAAe,UAAU,OAAO,UAAWD,CAAW,EAEvD,KAAK,aAAarpB,EAAIlkC,EAAMytD,CAAO,EACnC,KAAK,YAAYvpB,EAAIupB,CAAO,CAC7B,CAEA,YAAYvpB,EAAIupB,EAAU,GAAO,CAChC,GAAK,CAAE,SAAS,SAASvpB,CAAE,EAC1B,OAAO,KAAK,WAAWA,CAAE,EAI1B,GAAK,CAFW,KAAK,SAAS,IAAI,sBAAsB,GAEtC,CAAEA,EAAG,YAAY,OAClC,OAAO,KAAK,WAAWA,CAAE,EAE1B,MAAMvb,EAAY,KAAK,sBAAsBub,EAAI,GAAMupB,CAAO,EAC9D,GAAK,CAAE9kC,EACN,OAAO,KAAK,WAAWub,CAAE,EAEnBA,EAAG,aAQEA,EAAG,SAASA,EAAG,YAAY,GACtCvb,EAAU,YAAYub,EAAG,YAAY,EARrCvb,EAAU,YAAYub,EAAG,gBAAgB,iBAAC,OAAI,MAAM,yEACnD,iBAAC,OAAI,MAAM,0FACV,iBAAC,UAAO,MAAM,YAAa,EAC5B,EACCA,EAAG,gBAAe,iBAAC,OAAI,MAAM,qFAAsF,EACrH,CAAO,EAKRA,EAAG,aAAa,YAAc,KAAK,KAAK,EAAE,yBAA0B,8CAA8C,EAC/G;AAAA;AAAA,EACAA,EAAG,WAAW,IAAIx+B,GAAKA,EAAE,aAAa,EAAE,KAAK;AAAA,CAAI,CACrD,CAEA,WAAWw+B,EAAI,CACTA,EAAG,eACPA,EAAG,aAAa,OAAO,EACvBA,EAAG,aAAe,KAClBA,EAAG,aAAe,KAEpB,CAGA,sBAAsBA,EAAImqB,EAAgB,GAAMZ,EAAU,GAAO,CAChE,IAAIjkB,EAAOtF,EAAG,gBAAkBA,EAAG,cAAc,gBAAgB,EACjE,GAAKsF,GAAQ,CAAE6kB,EACd,OAAO7kB,EAER,IAAI7gB,EAAY8kC,EACbvpB,EAAG,cAAc,sBAAsB,EACvCA,EAAG,cAAc,kDAAkD,EAGtE,OAFKvb,GAAa8kC,IACjB9kC,EAAYA,EAAU,eAAe,eAC/BA,GAGP6gB,KAAQ,iBAAC,OACR,qBAAmB,qBACnB,MAAM,kGACP,EACAtF,EAAG,eAAiBsF,EAEpB7gB,EAAU,YAAY6gB,CAAI,EACnBA,GATC,IAUT,CAGA,aAAatF,EAAI5f,EAAOmpC,EAAU,GAAO,CACxC,GAAK,CAAE,SAAS,SAASvpB,CAAE,EAC1B,OAAO,KAAK,YAAYA,CAAE,EAE3B,MAAM/U,EAAU,KAAK,SAAS,IAAI,kBAAkB,EACnDxG,EAAY,KAAK,sBAAsBub,EAAI/U,EAAU,EAAGs+B,CAAO,EAKhE,GAAK,CAAE9kC,GAAawG,IAAY,GAAK7K,EAAM,WAAaA,EAAM,oBAAsBA,EAAM,OAAS,UAAYA,EAAM,OAAS,QAC7H,OAAO,KAAK,YAAY4f,CAAE,EAE3B,IAAIoqB,EAAahqC,EAAM,UAEhBgqC,IACDpqB,EAAG,kBAAoB,SAC3BA,EAAG,gBAAkB,KACrB,KAAK,YAAY,cAAc,KAAM5f,EAAM,YAAY,EAAE,KAAKjT,GAAQ,CACrE6yB,EAAG,gBAAkB7yB,EACrB,KAAK,aAAa6yB,EAAI5f,EAAOmpC,CAAO,CACrC,CAAC,GAGFa,EAAapqB,EAAG,iBAAiB,WAGlC,MAAMqqB,EAAWD,GAAc,IAAI,KAAKA,CAAU,EACjDE,EAASD,GAAY,KAAK,OAAO,KAAK,IAAI,EAAIA,GAAY,GAAI,GAAK,EAEpE,GAAKC,EAAS,EACb,OAAO,KAAK,YAAYtqB,CAAE,EAE3B,MAAMuqB,KAAU,sBAAmBD,EAAQ,GAAO,GAAO,GAAOr/B,IAAY,CAAC,EA0B7E,GAxBO+U,EAAG,gBACTA,EAAG,cAAgBvb,EAAU,cAAc,qBAAqB,GAE1Dub,EAAG,cAgBEA,EAAG,SAASA,EAAG,aAAa,GACvCvb,EAAU,YAAYub,EAAG,aAAa,EAhBtCvb,EAAU,YAAYub,EAAG,iBACxB,iBAAC,OAAI,MAAM,+DACV,iBAAC,OAAI,MAAM,0FACV,iBAAC,OAAI,MAAM,6BACV,iBAAC,UAAO,MAAM,aAAc,EAC7B,EACCA,EAAG,mBAAkB,iBAAC,QAAE,CAC1B,KACA,iBAAC,OAAI,MAAM,mEACT,KAAK,KAAK,EAAE,0BAA2B,eAAe,EACtDA,EAAG,iBAAgB,iBAAC,OAAI,MAAM,YAAa,EAC7C,CACD,CACA,EAKKA,EAAG,kBACTA,EAAG,gBAAkBA,EAAG,cAAc,cAAc,GAAG,GACnD,CAAEA,EAAG,gBACT,OAAO,KAAK,YAAYA,CAAE,EAI3B,GAFOA,EAAG,gBACTA,EAAG,cAAgBA,EAAG,cAAc,cAAc,uBAAuB,GACrE,CAAEA,EAAG,cACT,OAAO,KAAK,YAAYA,CAAE,EAEpBA,EAAG,mBACTA,EAAG,iBAAmB,YAAY,KAAK,aAAa,KAAK,KAAMA,EAAI5f,EAAOmpC,CAAO,EAAG,GAAI,GAEzFvpB,EAAG,gBAAgB,YAAcuqB,EAE5BvqB,EAAG,sBAAwBoqB,IAC/BpqB,EAAG,cAAc,YAAc,KAAK,KAAK,EACxC,wBACA,2BACA,CAAC,MAAOqqB,CAAQ,CACjB,EAEArqB,EAAG,oBAAsBoqB,EAE3B,CAGA,YAAYtlB,EAAM,CACZA,EAAK,mBACT,cAAcA,EAAK,gBAAgB,EACnCA,EAAK,iBAAmB,MAGpBA,EAAK,gBACTA,EAAK,cAAc,OAAO,EAC1BA,EAAK,cAAgB,KACrBA,EAAK,gBAAkB,KACvBA,EAAK,cAAgB,KACrBA,EAAK,oBAAsB,KAE7B,CAGA,WAAWnrB,EAAO1B,EAAK,CAItB,GAHA0B,EAAM,eAAe,EACrBA,EAAM,gBAAgB,EAEjB,CAAE1B,EAAM,CACZ,MAAMzU,EAASmW,EAAM,cAErB,GAAKnW,EAAS,CACb,MAAMgc,EAAKhc,EAAO,QACbgc,GAAMA,EAAG,KACbvH,EAAMuH,EAAG,KAEAhc,EAAO,OAChByU,EAAMzU,EAAO,KACf,CACD,CAEKyU,GACJ,KAAK,OAAO,KAAKA,CAAG,CACtB,CAGA,gBAAgB0B,EAAO+D,EAAM8sC,EAAa,KAAM,CAC/C7wC,EAAM,eAAe,EACrBA,EAAM,gBAAgB,EAEjB6wC,GACJA,EAAW7wC,EAAO+D,CAAI,EAEvB,KAAK,OAAO,SAAS,OAAQ,CAAE,SAAUA,CAAK,CAAC,CAChD,CACD,EAx+B8C,iBAA/B,IAAM+sC,EAAN,C,mGClCf,MAAMC,EAAkB,CAAC,OAAQ,QAAS,aAAc,YAAa,cAAe,aAAc,mBAAoB,cAAe,iBAAkB,gBAAgB,EACjKC,EAAiB,CAAC,SAAU,aAAc,WAAW,EAEtC,EAAN,MAAM,UAAe,SAAO,CAC1C,eAAe3rD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,iBAAiB,EAC7B,KAAK,OAAO,gBAAgB,EAY5B,KAAK,eAAiB,KAAK,KAAK,OAC/B,kBACA8X,GAAKA,EAAE,uBAAyBA,EAAE,eAAiBA,EAAE,MAAM,QAC5D,EAEA,KAAK,QAAU,KAAK,UAAU,OAC7B,UACA,qBACA,KACA,CAAC,WAAY,GAAM,QAAS,EAAI,EAAG,CACpC,EAOA,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,6DACP,YAAa,6HACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,kBAAmB,CACpC,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,uBACP,YAAa,yGACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,gDACP,UAAW,mBACZ,EACA,QAAStd,GAAO,SAAS,KAAK,UAAU,OAAO,uBAAwBA,CAAG,CAC3E,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,KACT,GAAI,CACH,KAAM,iCACN,MAAO,0BACP,YAAa,yFACb,UAAW,mBACX,QAAQA,EAAK,CAEZ,OADAA,EAAM,WAAWA,EAAK,EAAE,EACnB,MAAMA,CAAG,GAAK,CAAE,SAASA,CAAG,GAAKA,GAAO,EACrC,KAEDA,CACR,CACD,CACD,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,SAAU,CAAC,qBAAqB,EAChC,QAAQqf,EAAKrf,EAAK,CACjB,OAAOqf,EAAI,IAAI,qBAAqB,EAG7Brf,EAFC,EAGT,EACA,GAAI,CACH,KAAM,iCACN,MAAO,qCACP,YAAa,2MACb,UAAW,mBACZ,CAED,CAAC,EAED,KAAK,SAAS,IAAI,sBAAuB,CACxC,SAAU,CAAC,kBAAmB,4BAA6B,qBAAsB,eAAgB,sBAAsB,EACvH,QAAQqf,EAAK,CACZ,GAAKA,EAAI,IAAI,sBAAsB,EAClC,MAAO,GAER,MAAM4V,EAAO5V,EAAI,IAAI,cAAc,EACnC,MAAK,CAAE4V,GAAQ,CAAE5V,EAAI,IAAI,iBAAiB,GAAK,CAAE6xC,EAAgB,SAAS7xC,EAAI,IAAI,oBAAoB,CAAC,EAC/F,GAEM4V,EAAK,MAAQA,EAAK,QAChB5V,EAAI,IAAI,2BAA2B,CACpD,EACA,QAAS,IAAM,KAAK,mBAAmB,CACxC,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,SAAU,CAAC,sBAAuB,gCAAgC,EAClE,QAAQA,EAAK,CACZ,OAAOA,EAAI,IAAI,qBAAqB,GAAKA,EAAI,IAAI,gCAAgC,CAClF,CAED,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,SAAU,CAAC,yBAA0B,iBAAkB,sBAAsB,EAC7E,QAAQA,EAAK,CACZ,OAAOA,EAAI,IAAI,wBAAwB,GAAKA,EAAI,IAAI,gBAAgB,GAAKA,EAAI,IAAI,sBAAsB,CACxG,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,SAAU,CAAC,yBAA0B,sBAAsB,EAC3D,QAAQA,EAAK,CACZ,OAAOA,EAAI,IAAI,wBAAwB,GAAKA,EAAI,IAAI,sBAAsB,CAC3E,CAED,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,SAAU,CAAC,yBAA0B,yBAAyB,EAC9D,QAAQA,EAAK,CACZ,OAAOA,EAAI,IAAI,wBAAwB,GAAKA,EAAI,IAAI,yBAAyB,CAC9E,CAED,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,SAAU,CAAC,2BAA4B,wBAAwB,EAC/D,QAAQA,EAAK,CACZ,OAAOA,EAAI,IAAI,0BAA0B,GAAK,CAAEA,EAAI,IAAI,wBAAwB,CACjF,CAED,CAAC,EAED,KAAK,SAAS,IAAI,yBAA0B,CAC3C,SAAU,CAAC,gCAAiC,oBAAoB,EAChE,QAAQA,EAAK,CACZ,OAAKA,EAAI,IAAI,oBAAoB,EACzB,GACDA,EAAI,IAAI,+BAA+B,CAC/C,CACD,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,SAAU,CAAC,sBAAuB,+BAAgC,6BAA6B,EAC/F,SAAU,CAET,MAAO,EACR,EACA,QAAS,IAAM,KAAK,mBAAmB,CACxC,CAAC,EAED,KAAK,SAAS,IAAI,+BAAgC,CACjD,SAAU,CAAC,sBAAuB,oBAA4C,yBAA0B,6BAA8B,gBAAiB,2BAA2B,EAClL,QAAQA,EAAK,CACZ,IAAIlX,EAAS,EACb,OAAKkX,EAAI,IAAI,wBAAwB,GAC/BA,EAAI,IAAI,2BAA2B,IACvClX,GAAU,GAENkX,EAAI,IAAI,eAAe,GAAK,CAAEA,EAAI,IAAI,4BAA4B,IACtElX,GAAU,KAGXA,EAASkX,EAAI,IAAI,2BAA2B,EAAI,EAAI,EAC/CA,EAAI,IAAI,eAAe,IAC3BlX,GAAU,GAENkX,EAAI,IAAI,mBAAmB,IAC/BlX,GAAU,GAEXA,GAAUkX,EAAI,IAAI,qBAAqB,EAAI,EAAI,GAMzClX,CACR,CAGD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,CAAC,uBAAwB,yBAA0B,4BAA4B,EACxF,QAAQkX,EAAK,CACZ,MAAK,CAAEA,EAAI,IAAI,sBAAsB,GAAKA,EAAI,IAAI,wBAAwB,EAClE,EAEDA,EAAI,IAAI,4BAA4B,EAAI,GAAK,CACrD,CAGD,CAAC,EAED,KAAK,SAAS,IAAI,oBAAqB,CACtC,QAAS,CAAC,oBAAoB,EAC9B,QAAQA,EAAK,CACZ,OAAO8xC,EAAe,SAAS9xC,EAAI,IAAI,oBAAoB,CAAC,CAC7D,CACD,CAAC,CACF,CAEA,UAAW,CACV,SAAS,KAAK,UAAU,OAAO,uBAAwB,KAAK,SAAS,IAAI,wBAAwB,CAAC,EAElG,KAAK,GAAG,cAAe,KAAK,eAAgB,IAAI,EAChD,KAAK,GAAG,UAAW,KAAK,aAAc,IAAI,EAE1C,KAAK,SAAS,WAAW,2BAA4Brf,GAAO,KAAK,WAAW,OAAO,gBAAiBA,CAAG,CAAC,EACxG,KAAK,SAAS,WAAW,yBAA0BA,GAAO,KAAK,WAAW,OAAO,WAAYA,CAAG,CAAC,EACjG,KAAK,SAAS,WAAW,8BAA+BA,GAAO,KAAK,WAAW,OAAO,mBAAoBA,CAAG,CAAC,EAC9G,KAAK,SAAS,WAAW,2BAA4BA,GAAO,KAAK,WAAW,OAAO,oBAAqBA,CAAG,CAAC,EAC5G,KAAK,SAAS,WAAW,+BAAgCA,GAAO,KAAK,WAAW,OAAO,wBAAyBA,CAAG,CAAC,EAEpH,KAAK,SAAS,WAAW,8BAA+BA,GAAO,KAAK,WAAW,YAAY,uBAAwB,GAAGA,CAAG,KAAK,CAAC,EAC/H,KAAK,SAAS,WAAW,+BAAgCA,GAAO,KAAK,WAAW,YAAY,wBAAyB,GAAGA,CAAG,KAAK,CAAC,EACjI,KAAK,SAAS,WAAW,yBAA0BA,GAAO,KAAK,WAAW,OAAO,cAAeA,CAAG,CAAC,EAUpG,KAAK,GAAG,8BAA+B,IAAM,CAC5C,KAAK,QAAQ,KAAKwmC,GAAM,KAAK,eAAeA,CAAE,CAAC,CAGhD,CAAC,EAED,KAAK,eAAe,MAAM,IAAM,CAC1B,KAAK,gBACT,KAAK,cAAgB,GACrB,KAAK,aAAa,EAEpB,CAAC,EAED,KAAK,QAAQ,GAAG,QAAS,KAAK,cAAe,IAAI,EACjD,KAAK,QAAQ,GAAG,SAAU,KAAK,cAAe,IAAI,EAClD,KAAK,QAAQ,KAAKA,GAAM,KAAK,cAAcA,CAAE,CAAC,CAsD/C,CAEA,cAAe,CACT,KAAK,gBAGV,KAAK,cAAgB,WAAW,IAAM,KAAK,cAAc,EAAG,aAAa,IAAM,GAAG,EACnF,CAEA,eAAgB,CAIf,GAHA,aAAa,KAAK,aAAa,EAC/B,KAAK,cAAgB,KAEhB,CAAE,KAAK,eAAe,UAAU,KACpC,KAAK,cAAgB,OACjB,CACJ,UAAU8E,KAAQ,KAAK,eAAe,UACrCA,GAAM,WAAW,EAIlB,KAAK,KAAK,wBAAwB,CACnC,CACD,CAEA,IAAI,YAAa,CAChB,OAAO,KAAK,SAAS,IAAI,mBAAmB,CAC7C,CAEA,cAAc9E,EAAI,CACVA,IAGAA,EAAG,cACTA,EAAG,eAAc,YAAS,IAAM,sBAAsB,IAAM,KAAK,eAAeA,CAAE,CAAC,EAAG,IAAM,CAAC,GAE9FA,EAAG,YAAY,EAChB,CAEA,eAAeA,EAAI,CAClB,GAAK,CAAEA,EACN,OAED,MAAM4qB,EAAQ5qB,EAAG,iBAAiB,gBAAgB,EACjDwoB,EAAgB,KAAK,SAAS,SAAS,IAAI,+BAAgC,CAAC,CAAC,EAE9E,UAAU1oB,KAAQ8qB,EAAO,CACxB,MAAMnnB,EAAQ,KAAK,KAAK,iBAAiB3D,CAAI,EAC5C1f,EAAQqjB,GAAO,QAAQ,QAAQ,cAC/BonB,EAASzqC,GAAO,eAAe,OAAO,OACtC0qC,EAAQD,GAAQ,OAAS,QACzBvnC,EAAOunC,GAAQ,MAAM,YACrBE,EAAU3qC,GAAO,SAAW,GAE7B,IAAIipC,EAAc,GAGlB,GAFK/lC,GAAQklC,EAAc,SAASllC,CAAI,IACvC+lC,EAAc,IACVjpC,GAAO,YAAc,KAAK,SAAS,IAAI,yBAAyB,EACpEipC,EAAc,OACV,CACJ,GAAK,CAAEA,EAAc,CACpB,MAAMzvB,EAAU,KAAK,SAAS,IAAI,gCAAgC,EAC5D/K,EAAQzO,GAAO,UAChBwZ,GAAW/K,IACV+K,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,IACnBA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,KAClBA,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK/K,CAAK,GAAO+K,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAK/K,CAAK,KAClFw6B,EAAc,IAEjB,CAEA,GAAK,CAAEA,EAAa,CACnB,MAAMzvB,EAAU,KAAK,SAAS,IAAI,iCAAiC,EAC7DvgB,EAAQwxC,GAAQ,aAAa,mBAAmB,MACjDjxB,GAAWvgB,IACVugB,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,IACnBA,EAAQ,CAAC,IACbA,EAAQ,CAAC,EAAE,UAAY,KAClBA,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAKvgB,CAAK,GAAOugB,EAAQ,CAAC,GAAKA,EAAQ,CAAC,EAAE,KAAKvgB,CAAK,KAClFgwC,EAAc,IAEjB,CACD,CAEAvpB,EAAK,UAAU,OAAO,2BAA4BgrB,CAAK,EACvDhrB,EAAK,UAAU,OAAO,6BAA8BirB,CAAO,EAC3DjrB,EAAK,UAAU,OAAO,UAAWupB,CAAW,CAC7C,CACD,CAkBA,gBAAiB,CAEjB,CAEA,oBAAqB,CAErB,CACD,EApb2C,cAA5B,IAAM2B,EAAN,C,wHCCA,MAAM,EAAN,MAAM,UAAmB,SAAO,CAC9C,eAAehsD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,gBAAgB,EAG5B,KAAK,YAAc,KAAK,YAAY,KAAK,IAAI,EAC7C,KAAK,cAAgB,KAAK,cAAc,KAAK,IAAI,EAEjD,KAAK,cAAgB,GACrB,KAAK,cAAgB,KACrB,KAAK,YAAc,GACnB,KAAK,kBAAoB,GACzB,KAAK,cAAgB,EACrB,KAAK,SAAW,GAChB,KAAK,OAAS,CAAC,EAEf,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,wCACN,MAAO,+GACP,UAAW,mBACZ,EACA,QAAS,IAAM,KAAK,OAAO,CAC5B,CAAC,EAED,KAAK,OAAS,KAAK,KAAK,OACvB,eACA8X,GAAKA,EAAE,SAAWA,EAAE,YAAcA,EAAE,aACpC,CAAC,UAAU,CACZ,EAQA,KAAK,YAAc,KAAK,UAAU,OACjC,eAAgB,6DAChB,IAAS,gBACT,CAAC,WAAY,EAAI,EAAG,CACrB,EAEA,KAAK,OAAS,KAAK,KAAK,OACvB,UACAA,GAAKA,EAAE,2BAA6BA,EAAE,sBACvC,EAEA,KAAK,SAAW,KAAK,KAAK,OACzB,gBACAA,GAAKA,EAAE,eAAiBA,EAAE,OAASA,EAAE,MAAM,QAC3C,CAAC,OAAO,CACT,EAEA,KAAK,gBAAkB,KAAK,KAAK,OAChC,mBACAA,GAAKA,EAAE,iBAAmBA,EAAE,oBAAsBA,EAAE,uBACpD,CAAC,gBAAgB,CAClB,CACD,CAEA,IAAI,SAAU,CACb,OAAO,KAAK,QACb,CAEA,IAAI,QAAQtd,EAAK,CACXA,IAAQ,KAAK,WAGlB,KAAK,SAAWA,EAChB,KAAK,OAAO,EACb,CAEA,IAAI,cAAe,CAClB,OAAO,KAAK,aACb,CAEA,IAAI,aAAaA,EAAK,CAChBA,IAAQ,KAAK,gBAGlB,KAAK,cAAgBA,EACrB,KAAK,OAAO,EACb,CAEA,IAAI,SAAU,CACb,OAAO,KAAK,SAAS,IAAI,uBAAuB,GAAK,KAAK,cAAgB,CAC3E,CAEA,IAAI,kBAAmB,CACtB,OAAO,KAAK,iBACb,CAEA,IAAI,iBAAiBA,EAAK,CACzB,KAAK,kBAAoB,GACzB,KAAK,OAAO,CACb,CAEA,IAAI,YAAa,CAChB,OAAO,KAAK,WACb,CAEA,IAAI,aAAc,CACjB,OAAO,KAAK,KAAK,YAAc,GAAK,KAAK,KAAK,gBAAkB,CACjE,CAEA,IAAI,WAAWA,EAAK,CACdA,GAAO,CAAE,KAAK,cAClB,KAAK,kBAAoB,IAE1B,KAAK,YAAcA,EACnB,KAAK,OAAO,CACb,CAEA,IAAI,MAAO,CACV,OAAO,KAAK,aACb,CAEA,IAAI,KAAKA,EAAK,CACb,KAAK,cAAgBA,EACrB,KAAK,OAAO,CACb,CAEA,YAAa,CACZ,MAAMA,EAAM,KAAK,cACjB,OAAK,OAAOA,GAAQ,SACZ,KAAK,KAAK,aAAaA,CAAG,EAE7BA,GAAO,MAAQ,KAAK,QACjB,KAAK,KAAK,aAAa,KAAK,aAAa,EAE1CA,CACR,CAEA,iBAAkB,CACjB,GAAK,KAAK,WACT,OAAO,KAER,GAAK,KAAK,SAAS,iBAClB,SAAO,iBAAC,UAAO,MAAM,WAAY,GAElC,GAAK,KAAK,YACT,OAAO,KAAK,KAAK,aAAa,KAAK,KAAK,YAAc,KAAK,KAAK,eAAe,EAEhF,MAAMqqB,EAAS,KAAK,QAAQ,QAAQ,EAEpC,OAAK,SAASA,EAAO,QACb,KAAK,KAAK,EAAE,uBAAwB,KAAK,EAE5C,SAAS,CAAEA,EAAO,QACf,KAAK,KAAK,EAAE,4BAA6B,OAAO,EAEnD,CAAE,SAASA,EAAO,QACf,KAAK,KAAK,EAAE,6BAA8B,OAAO,EAElD,IACR,CAEA,cAAe,CACd,sBAAsB,IAAM,KAAK,cAAc,CAAC,CACjD,CAEA,eAAgB,CACf,UAAUihB,KAAQ,KAAK,OAAO,UAC7B,KAAK,kBAAkBA,CAAI,EAE5B,UAAUA,KAAQ,KAAK,SAAS,UAC/B,KAAK,kBAAkBA,CAAI,EAE5B,UAAUA,KAAQ,KAAK,gBAAgB,UACtC,KAAK,kBAAkBA,CAAI,EAK5B,UAAU9E,KAAM,KAAK,YAAY,UAChC,KAAK,kBAAkB,KAAMA,EAAI,EAAI,EAEtC,UAAU8E,KAAQ,KAAK,OAAO,UAC7B,KAAK,kBAAkBA,CAAI,CAC7B,CAEA,QAAS,CACR,sBAAsB,IAAM,KAAK,QAAQ,CAAC,CAC3C,CAEA,SAAU,CACT,UAAUA,KAAQ,KAAK,OAAO,UAC7B,KAAK,aAAaA,CAAI,EAEvB,UAAUA,KAAQ,KAAK,SAAS,UAC/B,KAAK,aAAaA,CAAI,EAEvB,UAAUA,KAAQ,KAAK,gBAAgB,UACtC,KAAK,aAAaA,CAAI,EAKvB,UAAU9E,KAAM,KAAK,YAAY,UAChC,KAAK,aAAa,KAAMA,EAAI,EAAI,EAEjC,UAAU8E,KAAQ,KAAK,OAAO,UAC7B,KAAK,aAAaA,CAAI,CACxB,CAGA,UAAW,CACV,KAAK,OAAO,MAAM,IAAM,KAAK,OAAO,CAAC,EACrC,KAAK,OAAO,GAAG,QAAS,KAAK,aAAc,IAAI,EAC/C,KAAK,OAAO,GAAG,SAAU,KAAK,aAAc,IAAI,EAEhD,KAAK,SAAS,MAAM,IAAM,KAAK,OAAO,CAAC,EACvC,KAAK,SAAS,GAAG,QAAS,KAAK,aAAc,IAAI,EACjD,KAAK,SAAS,GAAG,SAAU,KAAK,aAAc,IAAI,EAElD,KAAK,gBAAgB,MAAM,IAAM,KAAK,OAAO,CAAC,EAC9C,KAAK,gBAAgB,GAAG,QAAS,KAAK,aAAc,IAAI,EACxD,KAAK,gBAAgB,GAAG,SAAU,KAAK,aAAc,IAAI,EAMzD,KAAK,YAAY,GAAG,QAAS9E,GAAM,KAAK,aAAa,KAAMA,EAAI,EAAI,CAAC,EACpE,KAAK,YAAY,GAAG,SAAUA,GAAM,KAAK,aAAa,KAAMA,EAAI,EAAI,CAAC,EACrE,KAAK,YAAY,KAAKA,GAAM,KAAK,aAAa,KAAMA,EAAI,EAAI,CAAC,EAE7D,KAAK,OAAO,MAAM,IAAM,KAAK,OAAO,CAAC,EACrC,KAAK,OAAO,GAAG,QAAS,KAAK,aAAc,IAAI,EAC/C,KAAK,OAAO,GAAG,SAAU,KAAK,aAAc,IAAI,EAEhD,KAAK,GAAG,WAAY,IAAM,KAAK,iBAAmB,EAAK,EAEvD,KAAK,KAAK,WAAY,KAAK,QAAQ,EAEnC,KAAK,GAAG,mBAAoB,KAAK,MAAM,EACvC,KAAK,GAAG,uBAAwB,KAAK,MAAM,EAC3C,KAAK,GAAG,cAAe,KAAK,MAAM,EAClC,KAAK,GAAG,qBAAsB,KAAK,MAAM,EAEzC,KAAK,KAAK,0BAA2B,IAAM,CAC1C,KAAK,SACJ,kCACA,4OACA,kBACA,EACD,EACA,KAAK,OAAO,CACb,CAAC,EAED,KAAK,GAAG,2BAA4B,IAAM,CACzC,KAAK,SAAS,2BACb,oGACD,EACA,KAAK,OAAO,CACb,CAAC,CACF,CAGA,SAASwnB,EAAM7uC,EAAMoH,EAAO,kBAAmBkrC,EAAe,GAAO,CACpE,KAAK,SAAS,CACb,KAAAlrC,EACA,UAAWynC,EACX,KAAA7uC,EACA,SAAUsyC,CACX,CAAC,CACF,CAGA,SAAS99C,EAAM,CAId,GAAKA,EAAK,UAEJ,IADM,KAAM,EAEhB,SAAO,KAAQ,EAAE,KAAK,IAAM,KAAK,SAASA,CAAI,CAAC,EAGjD,KAAK,OAAO,KAAKA,CAAI,EAEhB,OAAK,OAAO,OAAS,IAG1B,KAAK,aAAa,CACnB,CAGA,aAAc,CACb,MAAMnT,EAAS,KAAK,IAAI,EAAG,KAAK,OAAO,MAAM,EAC5Cgf,EAAM,YAAY,IAAI,EAEvB,KAAK,eAAiB,GAEtB,QAAQ1N,EAAE,EAAGA,EAAItR,EAAQsR,IAAK,CAC7B,MAAM4/C,EAAQ,KAAK,OAAO5/C,CAAC,EAC3B,GAAK,CAAE4/C,GAAS,CAAEA,EAAM,QACvB,SAEIA,EAAM,SACV,aAAaA,EAAM,MAAM,EACzBA,EAAM,OAAS,MAGhB,MAAMC,EAAUnyC,EAAMkyC,EAAM,QAC3BE,EAAYF,EAAM,QAAUC,EAE7BD,EAAM,UAAYE,EAClBF,EAAM,WAAa,IAAME,EAAYF,EAAM,QAEtCA,EAAM,IACVA,EAAM,GAAG,YAAY,KAAK,YAAYA,CAAK,CAAC,CAC9C,CACD,CAGA,eAAgB,CACf,MAAMlxD,EAAS,KAAK,IAAI,EAAG,KAAK,OAAO,MAAM,EAC5Cgf,EAAM,YAAY,IAAI,EACvB,KAAK,eAAiB,GAEtB,QAAQ1N,EAAE,EAAGA,EAAItR,EAAQsR,IAAK,CAC7B,MAAM4/C,EAAQ,KAAK,OAAO5/C,CAAC,EAC3B,GAAK,GAAE4/C,GAAS,CAAEA,EAAM,SAGxB,IAAKA,EAAM,UAAY,CACtB,MAAMC,EAAUD,EAAM,QAAUA,EAAM,UACtCA,EAAM,QAAUlyC,EAAMmyC,CACvB,CAEKD,EAAM,IACVA,EAAM,GAAG,YAAY,KAAK,YAAYA,CAAK,CAAC,EAC9C,CACD,CAGA,cAAe,CACd,MAAMlxD,EAAS,KAAK,IAAI,EAAG,KAAK,OAAO,MAAM,EAC7C,GAAK,CAAEA,EACN,OAAO,KAER,MAAME,EAAM,CAAC,EACb,QAAQoR,EAAE,EAAGA,EAAItR,EAAQsR,IACxBpR,EAAI,KAAK,KAAK,YAAY,KAAK,OAAOoR,CAAC,CAAC,CAAC,EAG1C,OAAOpR,CACR,CAGA,YAAYiT,EAAM,CACVA,EAAK,UACXA,EAAK,QAAU,IAAM,CACfA,EAAK,SACT,aAAaA,EAAK,MAAM,EACxBA,EAAK,OAAS,MAGfA,EAAK,GAAK,KAEV,MAAM2L,EAAM,KAAK,OAAO,QAAQ3L,CAAI,EAC/B2L,IAAQ,KACZ,KAAK,OAAO,OAAOA,EAAK,CAAC,EAClB,KAAK,OAAO,SAClB,KAAK,eAAiB,IAEvB,KAAK,aAAa,EAEpB,GAED,IAAIuyC,EAAe,KACnB,MAAMC,EAAKn+C,EAAK,YAAW,KAAM,EAAI,KACrC,GAAKA,EAAK,UAAY,CAAEm+C,EACvB,OAAO,KAER,GAAKn+C,EAAK,QAAU,CACnB,MAAM6L,EAAM,YAAY,IAAI,EACrB7L,EAAK,UACXA,EAAK,QAAU6L,GAEhB,MAAMmyC,EAAUnyC,EAAM7L,EAAK,QAC1Bi+C,EAAYj+C,EAAK,QAAUg+C,EAC5B,IAAII,EAEC,KAAK,eACTA,EAAap+C,EAAK,WAEPA,EAAK,SAChBA,EAAK,OAAS,WAAWA,EAAK,QAASi+C,CAAS,GAE5CG,GAAc,OAClBA,EAAap+C,EAAK,WAAa,IAAMi+C,EAAYj+C,EAAK,SAEvDk+C,KAAgB,iBAAC,OAAI,MAAM,oEAC1B,iBAAC,OACA,MAAM,yHACN,KAAK,cACL,gBAAeE,EACf,gBAAc,IACd,gBAAc,UAEd,iBAAC,OACA,MAAO,yGACP,gBAAc,4BACd,MAAO,CACN,MAAO,GAAGA,CAAU,IACpB,qBAAsB,GAAGH,EAAY,GAAI,GAC1C,EACA,CACF,CACD,CACD,CAEA,OAAAj+C,EAAK,MAAM,iBAAC,OAAI,MAAO,kDAAkD,KAAK,eAAiB,qBAAuB,EAAE,OACvH,iBAAC,OAAI,MAAM,uGACV,iBAAC,OAAI,MAAM,gCACTA,EAAK,OACL,OAAOA,EAAK,MAAS,YACpB,iBAAC,UAAO,MAAO,4BAA4BA,EAAK,IAAI,GAAI,EACxDA,EAAK,MAELA,EAAK,OAASA,EAAK,OAAO,KAAK,KAAMA,CAAI,EAAI,KAC5CA,EAAK,OAASA,EAAK,QAAS,iBAAC,OAAI,MAAM,kBACvCA,EAAK,SAAS,iBAAC,UAAO,MAAM,yCAC3BA,EAAK,WAAa,KAAK,KAAK,MAAMA,EAAK,WAAYA,EAAK,MAAOA,CAAI,EAAIA,EAAK,KAC/E,EAAa,KACXA,EAAK,QAAQ,iBAAC,QAAK,MAAO,GAAGA,EAAK,MAAQ,kBAAoB,EAAE,GAAI,MAAO,CAAC,cAAeA,EAAK,KAAK,GACpGA,EAAK,YAAW,iBAAC,QAAK,wBAAyB,CAAC,UAAQ,KAAM,EAAE,OAAOA,EAAK,UAAY,KAAK,KAAK,EAAEA,EAAK,UAAWA,EAAK,KAAMA,CAAI,EAAIA,EAAK,IAAI,CAAE,EAAG,EAAK,KAC1JA,EAAK,SAAW,KAAQA,EAAK,UAAY,KAAK,KAAK,MAAMA,EAAK,UAAWA,EAAK,KAAMA,CAAI,EAAIA,EAAK,IACpG,EAAW,IACZ,EAAU,KACR,CAAEA,EAAK,eAAe,iBAAC,UACxB,MAAM,kEACN,QAASA,EAAK,YAEd,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,cAAe,EAC9B,CACD,CACD,EACCk+C,CACF,CACD,EAEOl+C,EAAK,EACb,CAGA,kBAAkB23B,EAAMrgB,EAAW+mC,EAAa,CAC/C,MAAMC,GAAY3mB,GAAQrgB,GAAW,cACrC,GAAKgnC,EAAW,CACfA,EAAS,UAAY,MACrB,eAAYA,EAAU,KAAK,aAAa,EAAG,GAAO,EAAI,EACtD,MACD,CAEA,KAAK,aAAa3mB,EAAMrgB,EAAW+mC,CAAW,CAC/C,CAGA,aAAa1mB,EAAMrgB,EAAW+mC,EAAa,CAC1C,MAAM14C,EAAO,KAAK,KAAK,aAAagyB,CAAI,EACxC,IAAI4mB,EAAW,GAEdC,EAAS,GAiCV,GA/BOlnC,IACNA,EAAY3R,GAAQA,EAAK,cAAc,gBAAgB,GAEjD2R,IACD3R,GAAQA,EAAK,UAAU,SAAS,iCAAiC,EACrE2R,EAAY3R,EAEZ2R,EAAY3R,GAAQA,EAAK,cAAc,kCAAkC,EAErE2R,IACJinC,EAAW,KAGR,CAAEjnC,GAAaqgB,EAAK,kBACxBrgB,EAAY,KAAK,KAAK,WAAWqgB,EAAMhuB,GAAKA,EAAE,WAAaA,EAAE,UAAU,SAAS,+BAA+B,CAAC,EAC3G2N,IACJinC,EAAW,KAGR,CAAEjnC,GAAaqgB,EAAK,kBACxBrgB,EAAY3R,GAAQA,EAAK,cAAc,8EAA8E,EAChH2R,IACJ+mC,EAAc,KAGX,CAAE/mC,GAAaqgB,EAAK,eACxBrgB,EAAY3R,GAAQA,EAAK,cAAc,gCAAgC,EAClE2R,IACJknC,EAAS,KAGN,CAAElnC,EACN,OAED,GAAK,CAAEinC,GAAY,CAAEC,GAAU,CAAEH,EAAc,CAC9C,IAAII,EAAa,KACjB,GAAI,CACHA,EAAannC,EAAU,cAAc,6CAA6C,CACnF,MAAa,CAA8C,CAEtDmnC,EACJnnC,EAAYmnC,EAEZnnC,EAAYA,EAAU,gBACxB,CAEA,IAAIvF,EAAK8gB,EAAKvb,EAAU,cAAc,cAAc,EAC/Cub,GACJA,EAAG,OAAO,EAEX,MAAMnc,EAAS,KAAK,QAAQ,QAAQ,EACnCgoC,EAAS,KAAK,aAAa,EAC3BC,EAAO,KAAK,WAAW,EACvBC,EAAa,KAAK,gBAAgB,EAqFnC,GAnFA/rB,KAAM,iBAAC,OACN,MAAO,eAAe2rB,EAAS,4CAA8C,mFAAmFH,EAAc,uBAAyB,YAAY,EAAE,OAErN,iBAAC,OAAI,MAAM,wDACTtsC,KAAO,iBAAC,UACR,MAAO,kUAAkU,KAAK,QAAU,WAAa,EAAE,GACvW,QAASrI,GAAK,KAAK,YAAYA,EAAGqI,CAAG,EACrC,cAAerI,GAAK,KAAK,cAAcA,EAAGqI,CAAG,MAE7C,iBAAC,OAAI,MAAM,mDACV,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,gBAAiB,EAChC,CACD,CACD,EACC,KAAK,cAAc,iBAAC,OAAI,MAAO,oDAAoDysC,EAAS,gDAAkD,kDAAkD,OAChM,iBAAC,OAAI,MAAM,2FACV,iBAAC,OAAI,MAAM,oCACV,iBAAC,OAAI,MAAM,kBACR,KAAK,MAAM,KAAO,KAAK,KAAK,EAAE,KAAK,MAAM,KAAM,KAAK,MAAM,IAAI,EAAI,KAAK,MAAM,IAChF,EACC,KAAK,MAAM,UAAY,QAAQ,iBAAC,UAChC,MAAM,kEACN,QAAS,IAAM,KAAK,MAAQ,SAE5B,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,cAAe,EAC9B,CACD,CACD,CACD,CACD,KACA,iBAAC,OAAI,MAAO,kBAAkBA,EAAS,gDAAkD,kDAAkD,IACzI,KAAK,KAAK,EAAE,mBAAoB,6BAA6B,EAC7D,KAAK,eAAe,iBAAC,OAAI,MAAM,aAC9B,KAAK,KAAK,EAAE,+BAAgC,yDAAyD,CACvG,EACC,KAAK,SAAS,qBAAqB,iBAAC,OAAI,MAAM,aAC7C,KAAK,KAAK,MAAM,+BAAgC,kFAAmF,CACnI,SAAO,iBAAC,QAAK,MAAM,iBAAgB,kBAAgB,CACpD,CAAC,CACF,EACC,KAAK,cAAgB,MAAM,iBAAC,OAAI,MAAM,aACrC,KAAK,KAAK,EAAE,4BAA6B,4EAA6E,CAAC,MAAO,KAAK,aAAa,CAAC,CACnJ,EACC,KAAK,gBAAgB,iBAAC,OAAI,MAAM,aAC/B,KAAK,KAAK,EAAE,2BAA4B,8IAA+I,CACvL,MAAO,KAAK,KAAK,YACjB,QAAS,KAAK,KAAK,eACpB,CAAC,CACF,EACC,YAAU,iBAAC,OAAI,MAAM,aACpB,KAAK,KAAK,EAAE,iCAAkC,oDAAoD,CACpG,EACC9nC,EAAO,YAAY,iBAAC,OAAI,MAAM,aAC7B,KAAK,KAAK,EAAE,kCAAmC,8DAA8D,CAC/G,CACD,CACD,GACEihB,GAAQrgB,GAAW,iBAAiB,iBAAC,OACtC,MAAO,6CAA6CknC,EAAS,gDAAkD,kDAAkD,GACjK,aAAc,KAAK,YACnB,aAAc,KAAK,eAElBE,CACF,EACC,KAAK,eAAe,iBAAC,OAAI,MAAM,uCAC/B,iBAAC,OAAI,MAAO,WAAW,KAAK,iBAAmB,wBAA0B,EAAE,OAC1E,iBAAC,UAAO,MAAM,iBAAkB,EACjC,CACD,EACCE,MAAe,iBAAC,OAAI,MAAM,uCAC1B,iBAAC,OAAI,MAAM,WACTA,CACF,CACD,EACCD,MAAS,iBAAC,OAAI,MAAM,iCACpB,iBAAC,OAAI,MAAM,WACTA,CACF,CACD,CACD,EAEKH,EACJlnC,EAAU,aAAaub,EAAIvb,EAAU,iBAAiB,MAClD,CACJ,IAAIunC,EAASvnC,EAAU,iBAClBunC,GAAUA,EAAO,UAAU,SAAS,iBAAiB,IACzDA,EAASA,EAAO,wBAEZA,EACJvnC,EAAU,aAAaub,EAAIgsB,CAAM,EAEjCvnC,EAAU,YAAYub,CAAE,CAC1B,CAEK,KAAK,WACT,KAAK,cAAc,KAAM9gB,CAAG,CAC9B,CAEA,YAAYvF,EAAOuF,EAAK,CACvB,GAAKvF,EAAM,SACV,OAAK,SAASA,EAAM,QACZ,sBAAsB,IAAM,KAAK,KAAK,OAAO,CAAC,EAE/C,KAAK,QAAQ,WAAW,EAAE,WAAW,EAG7C,KAAK,KAAK,WAAYA,EAAOuF,CAAG,CACjC,CAEA,iBAAiBnG,EAAS,CACzB,MAAMkzC,EAAO,KAAK,SAAS,aAAa,WAAWlzC,CAAO,EAC1D,SAAQ,iBAAC,UAAO,MAAO,sBAAsBkzC,EAAO,WAAalzC,EAAQ,QAAU,cAAgB,cAAc,GAAI,CACtH,CAEA,gBAAgBA,EAAS,CACxB,OAAOA,EAAQ,QAGV,KAAK,SAAS,aAAa,WAAWA,CAAO,EAC1C,KAAK,KAAK,EAAE,0BAA2B,qCAAqC,EAE7E,KAAK,KAAK,EAAE,kCAAmC,yDAAyD,EALvG,KAAK,KAAK,EAAE,4BAA6B,2BAA2B,CAM7E,CAEA,cAAcY,EAAOuF,EAAK,CACzB,GAAKvF,EAAQ,CACZ,GAAKA,EAAM,UAAYA,EAAM,QAC5B,OAEDA,EAAM,eAAe,CACtB,CAEA,MAAM8K,EAAYvF,EAAI,cAAc,cACnCysC,EAASlnC,EAAU,UAAU,SAAS,qBAAqB,EAC5D,IAAI5L,EAAM4L,EAAU,cAAc,oBAAoB,EACtD,GAAK5L,EACJ,GAAKA,EAAI,aACRA,EAAI,aAAa,MAEjB,QAGF,MAAM2E,EAAU,MAAM,CACrB,KAAK,UAAY,GAEZ3E,EAAI,cACRA,EAAI,aAAa,QAAQ,EAE1BA,EAAI,OAAO,CACZ,EAPgB,WASVwpB,EAAW,CAAC,EAElB,UAAUtpB,KAAW,KAAK,SAAS,WAAY,CAC9C,MAAMmzC,KAAU,iBAAC,UAChB,MAAM,kRACN,aAAY,KAAK,gBAAgBnzC,CAAO,EACxC,QAAS,GAAK,CACbA,EAAQ,QAAU,CAAEA,EAAQ,WAE5B,eAAYmzC,EAAQ,KAAK,iBAAiBnzC,CAAO,CAAC,EAClDmzC,EAAO,QAAQ,MAAQ,KAAK,gBAAgBnzC,CAAO,EAE9CmzC,EAAO,cAAiB,UAC5BA,EAAO,aAAgB,SAAS,EAEjC,KAAK,KAAK,kBAAkB,EAE5B,EAAE,eAAe,EACjB,EAAE,gBAAgB,CACnB,GAEE,KAAK,iBAAiBnzC,CAAO,CAChC,EAEMozC,EAAWpzC,EAAQ,eAAiBA,EAAQ,UAAY,GAAGA,EAAQ,QAAQ,eAEjFspB,EAAS,QAAK,iBAAC,OAAI,MAAM,wDACvB6pB,KACD,iBAAC,cACA,iBAAC,UAAKnzC,EAAQ,SAAW,KAAK,KAAK,EAAEA,EAAQ,SAAUA,EAAQ,KAAMA,CAAO,EAAIA,EAAQ,KAAOA,EAAQ,cAAc,iBAAC,OACrH,MAAM,0GAEN,iBAAC,OAAI,MAAM,oEACR,KAAK,KAAK,EAAE,6BAA8B,4BAA4B,CACzE,CACD,CAAQ,EACPA,EAAQ,gBAAgB,iBAAC,OAAI,MAAM,eACjCozC,EAAW,KAAK,KAAK,EAAEA,EAAUpzC,EAAQ,YAAaA,CAAO,EAAIA,EAAQ,WAC5E,CACD,CACD,CAAM,CACP,CAGAF,KAAO,iBAAC,OAAI,MAAO,4BAA4B8yC,EAAS,sCAAwC,wCAAwC,OACvI,iBAAC,OAAI,MAAO,6DACX,iBAAC,OAAI,MAAM,mFACV,iBAAC,OAAI,MAAM,oGACV,iBAAC,OAAI,MAAM,qGACV,iBAAC,OAAI,MAAM,2DACV,iBAAC,UACA,MAAM,4NACN,WAAY,IAAM,CAAC,KAAK,KAAK,mBAAmB,EAAGnuC,EAAQ,CAAC,MAE5D,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,eAAgB,EAC/B,CACD,KACA,iBAAC,OAAI,MAAM,kEACR,KAAK,KAAK,EAAE,0BAA2B,kCAAkC,CAC5E,CACD,CACD,KACA,iBAAC,OAAI,MAAM,4FACV,iBAAC,MAAG,MAAM,6CACP,KAAK,KAAK,EAAE,4BAA6B,UAAU,CACtD,CACD,KACA,iBAAC,OAAI,MAAM,sGACV,iBAAC,OAAI,MAAM,2DACV,iBAAC,UACA,MAAM,4NACN,QAAS3G,GAAK,CAAC,KAAK,aAAaA,EAAGqI,CAAG,EAAG1B,EAAQ,CAAC,MAEnD,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,WAAY,EAC3B,CACD,KACA,iBAAC,OAAI,MAAM,oEACR,KAAK,KAAK,EAAE,6BAA8B,WAAW,CACxD,CACD,CACD,KACA,iBAAC,OAAI,MAAM,sGACV,iBAAC,UACA,MAAM,wOACN,QAASA,CAAA,KAET,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,cAAe,EAC9B,CACD,CACD,CACD,KACA,iBAAC,OAAI,MAAM,yFAAyF,iBAAc,IAChH6kB,CACF,CACD,CACD,CACD,EAEAxpB,EAAI,aAAe2E,EACnB3E,EAAI,aAAe,IAAI,eAAaA,EAAK2E,CAAO,EAChDiH,EAAU,YAAY5L,CAAG,EAEzB,KAAK,UAAY,EAClB,CAGA,aAAac,EAAOuF,EAAK,CACxB,MAAM+O,EAAO,KAAK,QAAQ,WAAW,EAC9BA,IAGPA,EAAK,YAAY,0BAA0B,EACtC,CAAAA,EAAK,SAGV,KAAK,KAAK,WAAYtU,EAAOuF,CAAG,EACjC,CAGA,SAASvF,EAAOuF,EAAKqhB,EAAM,CAC1B,MAAMtS,EAAO,KAAK,QAAQ,WAAW,EAC9BA,IAGFsS,GACJtS,EAAK,YAAYsS,CAAI,EACjB,CAAAtS,EAAK,UAGV,KAAK,QAAU,GAEfA,EAAK,OAAOtU,CAAK,EAAE,KAAK,IAAM,CAC7B,KAAK,QAAU,EAEhB,CAAC,EAAE,MAAMU,GAAO,CACf,KAAK,IAAI,QAAQA,CAAG,EACpB,KAAK,IAAI,MAAM,4BAA6BA,CAAG,EAE/C,KAAK,SACJ,yBACA,kFACD,EAEA,KAAK,QAAU,GACf,KAAK,KAAK,WAAY,KAAK,QAAQ,CACpC,CAAC,GACF,CAEA,WAAY,CACX,KAAK,IAAI,cAAe,KAAK,MAAM,EACnC,KAAK,IAAI,WAAY,KAAK,QAAQ,CACnC,CACD,EAt0B+C,kBAAhC,IAAM+xC,EAAN,C,wFCJA,MAAM,EAAN,MAAM,UAAgB,SAAO,CAC3C,eAAeptD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,cAAc,EAC1B,KAAK,OAAO,iBAAiB,EAC7B,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,gBAAgB,EAC5B,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,kBAAkB,EAC9B,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,QAAQ,EACpB,KAAK,OAAO,QAAQ,EAEpB,KAAK,cAAgB,GAErB,KAAK,cAAgB,KACrB,KAAK,gBAAkB,KACvB,KAAK,WAAa,KAElB,KAAK,KAAO,KAAK,UAAU,OAC1B,gBAAiB,wBACjB,CAAC,UAAU,EACX,CAAC,WAAY,EAAI,EAAG,CACrB,EAEA,KAAK,WAAa,KAAK,UAAU,OAChC,eAAgB,yDAChB,CAAC,UAAU,EACX,CAAC,WAAY,GAAM,QAAS,EAAI,EAAG,EAAG,IAAO,EAC9C,EAEA,KAAK,aAAY,YAAS,KAAK,UAAW,GAAG,EAC7C,KAAK,YAAW,YAAS,KAAK,SAAU,GAAG,CAC5C,CAEA,UAAW,CACV,KAAK,KAAK,GAAG,QAAS,KAAK,WAAY,IAAI,EAC3C,KAAK,KAAK,GAAG,SAAU,KAAK,WAAY,IAAI,EAC5C,KAAK,KAAK,GAAG,UAAW,KAAK,WAAY,IAAI,EAC7C,KAAK,KAAK,KAAKghC,GAAM,KAAK,WAAWA,CAAE,CAAC,EAExC,KAAK,WAAW,GAAG,QAAS,KAAK,UAAW,IAAI,EAChD,KAAK,WAAW,GAAG,SAAU,KAAK,UAAW,IAAI,EACjD,KAAK,WAAW,GAAG,UAAW,KAAK,UAAW,IAAI,EAClD,KAAK,WAAW,KAAKA,GAAM,KAAK,UAAUA,CAAE,CAAC,EAE7C,KAAK,OAAO,GAAG,SAAU,KAAK,gBAAiB,IAAI,EACnD,KAAK,gBAAgB,CACtB,CAEA,mBAAmB7kC,EAAI0zB,EAAO,CACxB,KAAK,gBAAkBA,GAAS,KAAK,aAAe1zB,IAGpD,KAAK,aACT,KAAK,OAAO,YAAY,KAAM,UAAU,KAAK,UAAU,EAAE,EACzD,KAAK,WAAa,MAGd,KAAK,gBACT,KAAK,OAAO,YAAY,KAAM,WAAW,KAAK,aAAa,EAAE,EAC7D,KAAK,cAAgB,MAGjBA,IACJ,KAAK,OAAO,UAAU,KAAM,UAAUA,CAAE,EAAE,EAC1C,KAAK,WAAaA,GAGd0zB,IACJ,KAAK,OAAO,UAAU,KAAM,WAAWA,CAAK,EAAE,EAC9C,KAAK,cAAgBA,GAEvB,CAEA,iBAAkB,CACZ,KAAK,OAAO,eAAiB,aACjC,KAAK,QAAQ,mBAAmB,KAAK,aAAa,EAClD,KAAK,UAAU,EAEjB,CAEA,UAAW,CACV,KAAK,WAAW,MAAM,CACvB,CAEA,WAAY,CACX,KAAK,KAAK,KAAKmR,GAAM,KAAK,WAAWA,CAAE,CAAC,CACzC,CAEA,WAAWA,EAAI,CACd,MAAMltB,EAAO,KAAK,KAAK,iBAAiBktB,CAAE,EAE1C,IAAIjQ,EAAU,KACV7zB,EAAO,KAAK,KAAK,WAAW4W,EAAMgE,GAAK,CAC1C,IAAIxL,EAAI,EACJ3L,EAAQmX,EAAE,cACd,KAAMnX,GAAS,MAAQowB,GAAW,MAAQzkB,EAAI,IAC7CykB,EAAUpwB,GAAO,eAAe,SAAS,QAAQ,MAAM,MACtDA,GAAO,eAAe,SAAS,cAAc,MAE1C,CAACowB,GAAS,IAAM,CAACA,GAAS,SAC7BA,EAAU,MAEXpwB,EAAQA,GAAO,KACf2L,IAED,GAAIykB,EACH,MAAO,EACT,CAAC,EAEIA,GAAS,GACR,KAAK,YAAcA,EAAQ,KAC/B,KAAK,WAAaA,EAAQ,GAC1B,KAAK,gBAAkBA,EACvB,KAAK,cAAgB,KACrB,KAAK,mBAAmBA,EAAQ,GAAIA,EAAQ,KAAK,EAEjD,KAAK,gBAAgBiQ,EAAIjQ,EAAQ,EAAE,EAAE,KAAKzR,GAAS,CAC7C,KAAK,YAAcyR,EAAQ,KAGhC,KAAK,cAAgBzR,EACrB,KAAK,QAAQ,mBAAmBA,CAAK,EACrC,KAAK,SAAS,cAAc,CAC3B,aAAcA,CACf,CAAC,EAEF,CAAC,EAAE,MAAM,IAAM,CACT,KAAK,YAAcyR,EAAQ,KAGhC,KAAK,cAAgB,KACrB,KAAK,QAAQ,mBAAmB,EAChC,KAAK,SAAS,cAAc,CAC3B,aAAc,IACf,CAAC,EACF,CAAC,EAED,KAAK,SAAS,cAAc,CAC3B,QAASA,EAAQ,MACjB,UAAWA,EAAQ,EACpB,CAAC,GAGF,KAAK,WAAW,CAElB,CAEA,gBAAgBiQ,EAAI8I,EAAY4F,EAAY,CAC3C,MAAM3F,EAAQ/I,EAAG,iBAAmBA,EAAG,kBAAoB,CAAC,EAC5D,OAAK8I,IAAeC,EAAM,YACpB,KAAK,IAAI,EAAIA,EAAM,MAAQ,IAC1B2F,EACG3F,EAAM,KACP,QAAQ,QAAQA,EAAM,IAAI,EAI5B,IAAI,QAAQ,MAAO5xB,EAAGY,IAAM,CAClC,GAAKgxB,EAAM,SAAW,CACrBA,EAAM,SAAS,KAAK,CAAC5xB,EAAGY,CAAC,CAAC,EAC1B,MACD,CAEAgxB,EAAM,WAAaD,EACnBC,EAAM,SAAW,CAAC,CAAC5xB,EAAEY,CAAC,CAAC,EACvB,IAAI5K,EAAMkN,EAEV,GAAI,CACHlN,EAAO,MAAM,KAAK,YAAY,gBAAgB27B,CAAU,CACzD,OAAQtW,EAAO,CACdrlB,EAAO,KACPkN,EAAMmY,CACP,CAEA,MAAMwW,EAAUD,EAAM,SAGtB,GAFAA,EAAM,SAAW,KAEZA,EAAM,aAAeD,EAAa,CACtCzuB,EAAM,IAAI,MAAM,UAAU,EAC1B0uB,EAAM,WAAa,KACnBA,EAAM,KAAO,KACbA,EAAM,MAAQ,EACd,UAAU5U,KAAQ6U,EACjB7U,EAAK,CAAC,EAAE9Z,CAAG,EAEZ,MACD,CAEA0uB,EAAM,KAAO57B,EACb47B,EAAM,MAAQ,KAAK,IAAI,EAEvB,UAAU5U,KAAQ6U,EACjB3uB,EAAM8Z,EAAK,CAAC,EAAE9Z,CAAG,EAAI8Z,EAAK,CAAC,EAAEhnB,CAAI,CACnC,CAAC,CACF,CAEA,YAAa,CACZ,KAAK,WAAa,KAClB,KAAK,gBAAkB,KACvB,KAAK,cAAgB,KACrB,KAAK,mBAAmB,EACxB,KAAK,QAAQ,mBAAmB,EAChC,KAAK,SAAS,cAAc,CAC3B,QAAS,KACT,UAAW,KACX,aAAc,IACf,CAAC,CACF,CAEA,UAAU6yB,EAAI,CACb,MAAMvb,EAAYub,EAAG,QAAQ,qCAAqC,EACjEltB,EAAO2R,GAAa,KAAK,KAAK,iBAAiBA,CAAS,EAEzD,IAAIsL,EAAU,KAAMpwB,EAAQmT,GAAM,QAAQ,cAAexH,EAAI,EAC7D,KAAM3L,GAAS,MAAQowB,GAAW,MAAQzkB,EAAI,IAC7CykB,EAAUpwB,GAAO,eAAe,SAAS,QAAQ,MAAM,SACtDA,GAAO,eAAe,SAAS,cAAc,QAC9CA,EAAQA,GAAO,KACf2L,IAGD,MAAM+gD,EAAQt8B,GAAS,cACtB1W,EAAQgzC,GAAO,MACf/oC,EAAO+oC,GAAO,KAsBf,GAhBK,KAAK,gBAAkBt8B,GAAS,KACpC,KAAK,eAAiBA,GAAS,GAC/B,KAAK,oBAAsBA,IAGvB1W,GAAS2mB,EAAG,eAAiB1c,GAAM,IAAM0c,EAAG,gBAChDA,EAAG,cAAgB3mB,EACnB2mB,EAAG,aAAe1c,GAAM,GAExB,KAAK,SAAS,cAAc,CAC3B,SAAUA,GAAM,KAChB,WAAYA,GAAM,GAClB,MAAAjK,CACD,CAAC,GAGGoL,EAAY,CAChB,GAAK,CAAEA,EAAU,UAAY,CAC5B,MAAM5N,EAAI4N,EAAU,UAAYA,EAAU,cAAc,mCAAmC,EACtF5N,GACJA,EAAE,UAAU,IAAI,eAAe,CACjC,CAEA,KAAK,eAAe4N,CAAS,CAC9B,CACD,CAEA,UAAUub,EAAI,CACb,KAAK,SAAS,cAAc,CAC3B,SAAU,KACV,WAAY,KACZ,MAAO,IACR,CAAC,EAED,MAAMvb,EAAYub,EAAG,QAAQ,qCAAqC,EAClE,GAAOvb,EAOP,IAJKA,EAAU,WACdA,EAAU,UAAU,UAAU,OAAO,eAAe,EAErDA,EAAU,UAAY,KACjBA,EAAU,iBAAmB,CACjC,UAAUjrB,KAAO,OAAO,OAAOirB,EAAU,gBAAgB,EACxD,aAAajrB,CAAG,EAEjBirB,EAAU,iBAAmB,IAC9B,CAEAA,EAAU,YAAc,KACzB,CAEA,eAAeub,EAAIxtB,EAAM,CACxB,MAAM8yB,EAAOtF,EAAG,UACfjQ,EAAU,KAAK,oBAUhB,GAAK,CAAEuV,GAAQ,CAAE,SAAS,SAASA,CAAI,EAAI,CAC1C,KAAK,SAAS,EACd,MACD,CAEA,GAAK,CAAEvV,GAAS,GACf,OAEMvd,EAEK,MAAM,QAAQA,CAAI,IAC7BA,EAAO,CAACA,CAAI,GAFZA,EAAO,KAAK,SAAS,KAItB,MAAMm2B,EAAS3I,EAAG,iBAAmBA,EAAG,kBAAoB,CAAC,EAC5D4I,EAAa,EAAArvC,GAAO,KAAK,eAAeymC,EAAIzmC,CAAG,EAAlC,cACb4T,EAAO,CACN,QAAS,CACR,GAAI4iB,EAAQ,GACZ,MAAOA,EAAQ,MACf,aAAcA,EAAQ,WACvB,EACA,GAAAiQ,EACA,eAAgB,IAAM,EACtB,qBAAsB,IAAM,KAC5B,YAAa,IAAM,KACnB,eAAgB,IAAM,IACvB,EAED,UAAUzmC,KAAOiZ,EACX,KAAK,SAAS,YAAYjZ,CAAG,EAAE,SACnC,KAAK,SAAS,aAAaA,EAAK4T,EAAMm4B,EAAMqD,EAAQC,CAAU,CAEjE,CAED,EA5U4C,eAA7B,IAAM0jB,EAAN,C,iGCFR,MAAMC,EAAgB,CAC5B,aAAc,OAAQ,QAAS,aAAc,YAAa,cAC1D,aAAc,mBAAoB,cAAe,iBACjD,iBAAkB,OAAQ,QAAS,iBAAkB,sBACrD,WAAY,WACb,EAOqB,EAAN,MAAM,UAAe,GAAW,CAC9C,eAAevtD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAGrB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,UAAU,EAetB,KAAK,WAAa,KAAK,KAAK,OAC3B,cACA8X,GAAKA,EAAE,iBAAmBA,EAAE,WAAaA,EAAE,OAASA,EAAE,MAAM,KAC5Dy1C,CACD,EAEA,KAAK,OAAS,KAAK,KAAK,OACvB,kBACAz1C,GAAKA,EAAE,iBAAmBA,EAAE,OAAO,cAAgBA,EAAE,OAAO,oBAC5Dy1C,CACD,EAEA,KAAK,YAAc,KAAK,KAAK,OAC5B,eACAz1C,GAAKA,EAAE,mBAAqBA,EAAE,OAASA,EAAE,MAAM,qBAC/C,CAAC,OAAQ,YAAa,QAAS,aAAc,WAAW,CACzD,EAEA,KAAK,aAAe,KAAK,KAAK,OAC7B,gBACAA,GAAKA,EAAE,QAAUA,EAAE,2BACnBy1C,CACD,CACD,CAGA,kBAAmB,CAClB,GAAK,CAAE,KAAK,OAAS,CACpB,MAAMvsB,EAAK,SAAS,cAAc,uBAAuB,EACzD,KAAK,OAAS,KAAK,KAAK,WACvBA,EACAlpB,GAAKA,EAAE,eAAe,wBACtB,EACD,CACD,CAEK,KAAK,QACT,KAAK,OAAO,cAAc,wBAAwB,CACpD,CAGA,kBAAmB,CAClB,MAAM,iBAAiB,EAEvB,KAAK,SAAS,IAAI,uBAAwB,CACzC,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,qDACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,6BAA8B,CAC/C,QAAS,GACT,SAAU,CAAC,eAAe,EAC1B,QAAQ+B,EAAKrf,EAAK,CACjB,OAAOqf,EAAI,IAAI,eAAe,EAGvBrf,EAFC,EAGT,EAEA,GAAI,CACH,KAAM,mCACN,MAAO,8CACP,UAAW,mBACZ,EACA,QAASA,GAAO,KAAK,WAAW,OAAO,sBAAuBA,CAAG,CAClE,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,SAAU,CAAC,qBAAsB,wBAAwB,EACzD,QAAQqf,EAAKrf,EAAK,CACjB,MAAK,CAAEqf,EAAI,IAAI,wBAAwB,GAAKA,EAAI,IAAI,oBAAoB,IAAM,QACtE,GACDrf,CACR,EACA,GAAI,CACH,KAAM,mCACN,MAAO,8CACP,UAAW,mBACZ,EAEA,QAASA,GAAO,KAAK,WAAW,OAAO,mBAAoBA,CAAG,CAC/D,CAAC,EAED,KAAK,SAAS,IAAI,4BAA6B,CAC9C,QAAS,GACT,GAAI,CACH,KAAM,mCACN,MAAO,2DACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,GACT,GAAI,CACH,KAAM,iCACN,MAAO,2DACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,kCACN,MAAO,qBACP,YAAa,4GACb,UAAW,mBACZ,EACA,QAASA,GAAO,CACf,KAAK,WAAW,WAAW,mBAAoBA,CAAG,EAClD,KAAK,iBAAiB,CACvB,CACD,CAAC,CAeF,CAGA,MAAM,UAAW,CAChB,MAAM,MAAM,SAAS,EAErB,KAAK,WAAW,OAAO,sBAAuB,KAAK,SAAS,IAAI,4BAA4B,CAAC,EAC7F,KAAK,WAAW,OAAO,mBAAoB,KAAK,SAAS,IAAI,yBAAyB,CAAC,EACvF,KAAK,WAAW,WAAW,mBAAoB,KAAK,SAAS,IAAI,uBAAuB,CAAC,EAGzF,KAAK,GAAG,cAAe,KAAK,iBAAkB,IAAI,EAElD,KAAK,GAAG,kBAAmB,KAAK,cAAe,IAAI,EAEnD,KAAK,YAAY,GAAG,QAASsrC,GAAQ,CACpCA,EAAK,mBAAqB,KAAK,IAAI,EACnC,KAAK,eAAeA,CAAI,CACzB,CAAC,EACD,KAAK,YAAY,GAAG,SAAU,KAAK,eAAgB,IAAI,EACvD,KAAK,YAAY,MAAM,CAACC,EAAKC,IAAc,CAC1C,MAAMhsB,EAAM,KAAK,IAAI,EACrB,UAAU8rB,KAAQE,EACjBF,EAAK,mBAAqB9rB,EAC1B,KAAK,eAAe8rB,CAAI,CAE1B,CAAC,EAED,KAAK,aAAa,GAAG,QAAS,KAAK,cAAe,IAAI,EACtD,KAAK,aAAa,GAAG,SAAU,KAAK,cAAe,IAAI,CACxD,CAEA,eAAgB,CACR,KAAK,SAAS,IAAI,6BAA6B,GAGtD,KAAK,OAAO,aAAa,mEAAoE,SAAS,kBAAmB,GAAI,EAC3H,KAAK9E,GAAMA,EAAG,MAAM,CAAC,CACxB,CAEA,oBAAqB,CACpB,OAAO,KAAK,SAAS,IAAI,oBAAoB,GAC3C,CAAE,KAAK,SAAS,IAAI,sBAAsB,GAAK,KAAK,OAAO,SAAS,OAAS,YAChF,CAGA,cAAc8E,EAAM,CAiBpB,CAGA,SAAU,CACT,OAAO,KAAK,WAAW,KACxB,CAGA,eAAeA,EAAM,CACbA,EAAK,qBACXA,EAAK,mBAAqB,WAAW,IAAM,CAC1CA,EAAK,mBAAqB,KAErB,GAAE,KAAK,SAAS,IAAI,2BAA2B,GAAK,CAAEA,EAAK,eAG3D,KAAK,OAAO,eAAiB,SAG7BA,EAAK,MAAM,iBAAmBA,EAAK,MAAM,qBAAuBA,EAAK,MAAM,oBAG3E,KAAK,IAAI,GAAKA,EAAK,oBAAqB,GAAK,KAG7CA,EAAK,MAAM,sBACfA,EAAK,MAAM,qBAAqB,EAClC,EAAG,GAAG,EACR,CAUA,kBAAmB,CAEnB,CAEA,oBAAqB,CACpB,KAAK,SAAS,cAAc,CAC3B,UAAW,KAAK,WACjB,CAAC,CACF,CAEA,IAAI,aAAc,CAEjB,MAAO,EACR,CACD,EA/Q+C,cAAhC,IAAM0nB,EAAN,C,mGCpBf,QAAe,IAA0B,uBCanCC,EAAa,CAAC,UAAW,QAAS,OAAO,EAEzCC,EAAS,CACd,KAAO,MAAQ,MAAQ,MAAQ,IAAM,KAAO,KAAO,MACnD,EACA,IAAM,KAAO,KAAO,KAAO,IAAM,IAClC,EAEMC,EAAe,kCACpBC,EAAkB,mCAGbC,EAAgB,CAKrB,KAAM,CAAC,EAAI,CAAC,mBAAmB,GAAG,oBAAoB,EAAE,wBAAwB,EAAE,0BAA0B,EAAE,oBAAoB,EAAE,2BAA2B,EAAE,0BAA0B,EAAE,0BAA0B,EAAE,mCAAmC,EAAE,oCAAoC,EAAE,kCAAkC,EAAE,kBAAkB,EAAE,sBAAsB,EAAE,yBAAyB,EAAE,mBAAmB,EAAE,wBAAwB,EAAE,oCAAoC,GAAG,2BAA2B,EAAE,mCAAmC,EAAE,mBAAmB,EAAE,uCAAuC,EAAE,6BAA6B,EAAE,wBAAwB,GAAG,0CAA0C,EAAE,2CAA2C,EAAE,yCAAyC,EAAE,4BAA4B,EAAE,mCAAmC,GAAG,qBAAqB,EAAE,eAAe,EAAE,gBAAgB,EAAE,uBAAuB,EAAE,sBAAsB,EAAE,sBAAsB,EAAE,gCAAgC,GAAG,8BAA8B,GAAG,qBAAqB,GAAG,+BAA+B,GAAG,sBAAsB,GAAG,+BAA+B,EAAE,oBAAoB,GAAG,mBAAmB,GAAG,mBAAmB,GAAG,wBAAwB,GAAG,sBAAsB,GAAG,0BAA0B,GAAG,aAAa,EAAE,0BAA0B,KAAK,YAAY,GAAG,mBAAmB,GAAG,kBAAkB,GAAG,kBAAkB,GAAG,oBAAoB,GAAG,2BAA2B,GAAG,0BAA0B,GAAG,0BAA0B,GAAG,kBAAkB,GAAG,2BAA2B,GAAG,eAAe,EAAE,mBAAmB,EAAE,EAAE,EAAI,CAAC,gBAAgB,CAAC,EAAE,aAAa,EAAE,EAAE,eAAe,CAAC,EAAE,aAAa,EAAE,EAAE,MAAQ,CAAC,EAAE,mBAAmB,EAAE,EAAE,cAAc,CAAC,EAAE,iBAAiB,EAAE,EAAE,qBAAqB,CAAC,EAAE,aAAa,EAAE,EAAE,YAAY,CAAC,GAAG,kBAAkB,EAAE,CAAC,CAAC,EACh2D,MAAO,CAAC,EAAI,CAAC,oBAAoB,EAAE,wBAAwB,EAAE,0BAA0B,EAAE,oBAAoB,EAAE,2BAA2B,EAAE,0BAA0B,EAAE,0BAA0B,EAAE,mCAAmC,EAAE,oCAAoC,EAAE,kCAAkC,EAAE,kBAAkB,EAAE,sBAAsB,EAAE,yBAAyB,EAAE,mBAAmB,GAAG,wBAAwB,EAAE,oCAAoC,EAAE,2BAA2B,EAAE,mCAAmC,EAAE,mBAAmB,EAAE,uCAAuC,EAAE,6BAA6B,EAAE,wBAAwB,EAAE,0CAA0C,GAAG,2CAA2C,GAAG,yCAAyC,GAAG,4BAA4B,GAAG,qBAAqB,EAAE,mCAAmC,GAAG,eAAe,EAAE,gBAAgB,EAAE,uBAAuB,EAAE,sBAAsB,EAAE,sBAAsB,EAAE,gCAAgC,EAAE,8BAA8B,EAAE,qBAAqB,EAAE,+BAA+B,EAAE,sBAAsB,EAAE,+BAA+B,GAAG,oBAAoB,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,wBAAwB,EAAE,sBAAsB,EAAE,0BAA0B,GAAG,aAAa,EAAE,0BAA0B,KAAK,YAAY,EAAE,mBAAmB,EAAE,kBAAkB,EAAE,kBAAkB,EAAE,oBAAoB,EAAE,2BAA2B,GAAG,0BAA0B,GAAG,0BAA0B,GAAG,kBAAkB,EAAE,2BAA2B,EAAE,eAAe,EAAE,mBAAmB,EAAE,qBAAqB,EAAE,yBAAyB,KAAK,yBAAyB,IAAI,EAAE,EAAI,CAAC,gBAAgB,CAAC,EAAE,aAAa,EAAE,EAAE,eAAe,CAAC,EAAE,aAAa,EAAE,EAAE,MAAQ,CAAC,EAAE,mBAAmB,EAAE,EAAE,cAAc,CAAC,GAAG,iBAAiB,EAAE,EAAE,qBAAqB,CAAC,EAAE,eAAe,EAAE,EAAE,YAAY,CAAC,EAAE,kBAAkB,EAAE,CAAC,CAAC,EACl5D,YAAa,CAAC,EAAI,CAAC,eAAe,GAAG,OAAS,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,CAAC,EAAE,EAAI,CAAC,CAAC,EAChK,aAAc,CAAC,EAAI,CAAC,eAAe,GAAG,OAAS,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,CAAC,EAAE,EAAI,CAAC,CAAC,CAClK,EAGqB,EAAN,MAAM,UAAoB,SAAO,CAC/C,eAAe7tD,EAAM,CACpB,MAAM,GAAGA,CAAI,EACb,KAAK,OAAO,UAAU,EAEtB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,iBAAiB,EAC7B,KAAK,OAAO,aAAa,EAEzB,KAAK,cAAgB,GAKrB,KAAK,SAAS,IAAI,6BAA8B,CAC/C,QAAS,KACT,SAAU,CAAC,2BAA4B,6BAA6B,EACpE,QAAQ6Z,EAAKrf,EAAK,CACjB,OAAKA,IAAQ,KACPqf,EAAI,IAAI,6BAA6B,EAClC,GACDA,EAAI,IAAI,0BAA0B,GAAK,GAExCrf,CACR,EACA,GAAI,CACH,KAAM,+BACN,MAAO,0CACP,YAAa,wJACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,0CACP,UAAW,oBACX,YAAa,sLACd,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,6CACN,MAAO,0BACP,UAAW,oBACX,YAAa,sOACd,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,gDACP,UAAW,mBACZ,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAID,KAAK,SAAS,IAAI,kBAAmB,CACpC,QAAS,GACT,QAAQqf,EAAKrf,EAAK,CACjB,GAAK,OAAOA,GAAQ,SACnB,GAAI,CACHA,EAAM,WAAWA,CAAG,CACrB,MAAa,CAAEA,EAAM,IAAM,CAE5B,OAAK,CAAEA,GAAOA,EAAM,GAAK,MAAMA,CAAG,GAAK,CAAE,SAASA,CAAG,GAAKA,EAAM,MAC/DA,EAAM,IAEAA,CACR,EACA,GAAI,CACH,KAAM,2CACN,MAAO,YACP,YAAa,yKACb,UAAW,mBACX,KAAM,QACP,EACA,QAAS,IAAM,KAAK,WAAW,CAChC,CAAC,EAKD,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,GACT,GAAI,CACH,KAAM,uOACN,MAAO,aACP,YAAa,8HACb,UAAW,oBACX,KAAM,EACN,MAAO,EACR,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,OACP,YAAa,0GACb,UAAW,oBACX,KAAM,CACP,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,qBAAsB,CACvC,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,SACP,YAAa,oDACb,UAAW,oBACX,MAAO,GACP,KAAM,CACP,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,iCAAkC,CACnD,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,qBACP,YAAa,6GACb,UAAW,oBACX,MAAO,GACP,KAAM,EACP,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,2BAA4B,CAC7C,QAAS,GACT,GAAI,CACH,KAAM,+BACN,MAAO,eACP,UAAW,oBACX,KAAM,EACP,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAGD,KAAK,SAAS,IAAI,8BAA+B,CAChD,QAAS,GACT,GAAI,CACH,KAAM,gDACN,MAAO,aACP,UAAW,oBACX,KAAM,EACN,MAAO,EACR,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GACT,GAAI,CACH,KAAM,oCACN,MAAO,OACP,YAAa,0GACb,UAAW,oBACX,KAAM,CACP,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,oCACN,MAAO,SACP,YAAa,oDACb,UAAW,oBACX,MAAO,GACP,KAAM,CACP,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,iBAAkB,CACnC,SAAU,CAAC,oBAAoB,EAC/B,QAAQqf,EAAK,CACZ,MAAO,CAAE4zC,EAAW,SAAS5zC,EAAI,IAAI,oBAAoB,CAAC,CAC3D,CACD,CAAC,EAED,KAAK,SAAS,IAAI,gBAAiB,CAClC,SAAU,CAAC,qBAAsB,iBAAkB,mBAAoB,gCAAiC,qBAAsB,yBAAyB,EACvJ,QAAQA,EAAK,CACZ,MAAM2W,EAAQ3W,EAAI,IAAI,qBAAqB,EAC3C,OAAK2W,IAGA3W,EAAI,IAAI,oBAAoB,IAAM,cAC9BA,EAAI,IAAI,yBAAyB,GAAG,IAAI,SAAS,MAAM,EAEzDA,EAAI,IAAI,+BAA+B,GAAMA,EAAI,IAAI,gBAAgB,GAAKA,EAAI,IAAI,kBAAkB,IAAM,EAClH,EACA,QAAS,IAAM,KAAK,UAAU,CAC/B,CAAC,EAED,KAAK,SAAS,IAAI,sBAAuB,CACxC,SAAU,CAAC,eAAe,EAC1B,QAAQA,EAAK,CACZ,MAAO,CAAEA,EAAI,IAAI,eAAe,CACjC,CACD,CAAC,EAED,KAAK,OAAS,KACd,KAAK,YAAc,IACpB,CAGA,YAAa,CACZ,IAAI4V,EAAO,KAAK,SAAS,IAAI,iBAAiB,EAM9C,GALK,OAAOA,GAAS,UAAY,YAAY,KAAKA,CAAI,EACrDA,EAAO,WAAWA,CAAI,EACb,OAAOA,GAAS,WACzBA,EAAO,MAEH,CAAEA,GAAQ,MAAMA,CAAI,GAAK,CAAE,SAASA,CAAI,GAAKA,EAAO,GAAKA,IAAS,GAAK,CAC3E,KAAK,WAAW,OAAO,WAAW,EAClC,MACD,CAEAA,EAAOA,EAAO,GAEd,KAAK,WAAW,IAAI,YAAa;AAAA,kBAChB,kBAASA,CAAI;AAAA,kBACb,kBAASA,CAAI;AAAA,kBACb,mBAASA,CAAI;AAAA,kBACb,mBAASA,CAAI;AAAA,kBACb,mBAASA,CAAI;AAAA,kBACdA,CAAI;AAAA,kBACH,kBAASA,CAAI;AAAA,kBACb,kBAASA,CAAI;AAAA,qBACXA,CAAI;AAAA;AAAA,CAExB,CACA,CAGA,2BAA2BnQ,EAAO,CACjC,MAAMwuC,EAAOxuC,EAAM,OAAO,EACzByuC,EAAOD,EAAK,EACZE,EAAOD,EAAO,GAEf,OAAO,KAAK,uBAAuBzuC,CAAK,EAAI,KAAK,iBAAiB,QAAM,KAAK,QAAQ0uC,EAAO,OAAS,MAAM,CAAC,CAC7G,CAGA,uBAAuB1uC,EAAO,CAC7B,MAAMwuC,EAAOxuC,EAAM,OAAO,EACzByuC,EAAOD,EAAK,EACZE,EAAOD,EAAO,GAEf,MAAO,CACN,2BAA2BzuC,EAAM,MAAM,CAAC,IACxC,kCAAkCA,EAAM,MAAM,CAAC,IAC/C,2BAA2BwuC,EAAK,GAAGC,GAAQC,EAAO,IAAO,KAAM,EAAE,MAAM,CAAC,IACxE,0BAA0BF,EAAK,GAAGC,GAAQC,EAAO,GAAM,IAAK,EAAE,MAAM,CAAC,IACrE,wDACA,4BAA4BF,EAAK,GAAGC,GAAQC,EAAO,IAAO,KAAM,EAAE,MAAM,CAAC,GAC1E,EAAE,KAAK,EAAE,CACV,CAGA,iBAAiB1uC,EAAO,CAClBA,EAAM,EAAI,KACdA,EAAQA,EAAM,GAAG,EAAG,GAErB,MAAM2uC,EAAQ3uC,EAAM,EAEpB,MAAO,CACN,qBAAqBA,EAAM,MAAM,CAAC,IAClC,sBAAsBA,EAAM,MAAM,CAAC,IACnC,sBAAsBA,EAAM,MAAM,CAAC,IACnC,+BAA+BA,EAAM,GAAG2uC,EAAQ,EAAG,EAAE,MAAM,CAAC,IAC5D,oBAAoB3uC,EAAM,GAAG2uC,EAAQ,EAAG,EAAE,MAAM,CAAC,IACjD,sBAAsB3uC,EAAM,GAAG2uC,EAAQ,EAAG,EAAE,MAAM,CAAC,GACpD,EAAE,KAAK,EAAE,CACV,CAGA,mBAAmB3uC,EAAO0uC,EAAM,CAC1B1uC,EAAM,EAAI,IACdA,EAAQA,EAAM,GAAG,CAAC,GAEnB,MAAMwuC,EAAOxuC,EAAM,OAAO,EACzByuC,EAAOD,EAAK,EAEP57B,EAASw7B,EAAO,IAAIlrD,GACpBA,IAAM,EACH8c,EAAM,MAAM,EAEbwuC,EAAK,GAAGC,EAAOvrD,CAAC,EAAE,MAAM,CAC/B,EAEKtH,EAAM,CAAC,EACZgzD,EAAa,CAAC,EAEf,QAAQ5hD,EAAE,EAAGA,EAAI4lB,EAAO,OAAQ5lB,IAC/BpR,EAAI,KAAK,sBAAsBoR,EAAE,CAAC,IAAI4lB,EAAO5lB,CAAC,CAAC,GAAG,EAEnD,IAAIkZ,EAASwoC,EAAOH,EAAc,KAAOA,EAAc,MAEvD,SAAU,CAACtzD,EAAIC,CAAG,IAAK,OAAO,QAAQgrB,EAAO,CAAC,EACxC,OAAOhrB,GAAQ,UAGpBU,EAAI,KAAK,WAAWX,CAAG,IAAI23B,EAAO13B,EAAI,CAAC,CAAC,GAAG,EAG5CgrB,EAASwoC,EAAOH,EAAc,YAAcA,EAAc,aAE1D,SAAU,CAACtzD,EAAIC,CAAG,IAAK,OAAO,QAAQgrB,EAAO,CAAC,EACxC,OAAOhrB,GAAQ,UAGpB0zD,EAAW,KAAK,WAAW3zD,CAAG,IAAI23B,EAAO13B,EAAI,CAAC,CAAC,cAAc,EAG9D,MAAO,CAACU,EAAI,KAAK,EAAE,EAAGgzD,EAAW,KAAK,EAAE,CAAC,CAC1C,CAGA,WAAY,CAeX,GAZK,KAAK,SAAS,IAAI,6BAA6B,EACnD,KAAK,WAAW,IAAI,OAAQN,CAAe,EAE3C,KAAK,WAAW,OAAO,MAAM,EAEzB,KAAK,SAAS,IAAI,yBAAyB,EAC/C,KAAK,WAAW,IAAI,SAAUD,CAAY,EAE1C,KAAK,WAAW,OAAO,QAAQ,EAEhC,KAAK,WAAW,YAAY,eAAgB,0BAA0B,EAEjE,CAAE,KAAK,SAAS,IAAI,gBAAgB,EAAI,CAC5C,KAAK,iBAAiB,EAAK,EAC3B,KAAK,mBAAmB,EAAI,EAC5B,KAAK,WAAW,OAAO,QAAQ,EAC/B,MACD,CAEA,IAAIK,EAAO,KAAK,SAAS,IAAI,eAAe,EAC5C,MAAMnwC,EAAO,CAAC,EAAGswC,EAAc,CAAC,EAE1BC,EAAa,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,wBAAwB,CAAC,EACjF,GAAKA,EAAa,CACjBA,EAAW,EAAI,EAGf,MAAMN,EAAOM,EAAW,OAAO,EAE/BJ,EADQF,EAAK,EACC,GAGd,GAAI,CACH,MAAM3yC,EAAQ,KAAK,QAAQ,MAAM,EAAE,MAClCid,EAAQjd,EAAM,SAAS,EAAE,GAAG,MAC5BkzC,EAAeL,EAAO,EAAI,EAEvB51B,IAAUi2B,GACblzC,EAAM,SAAS,CACd,KAAM,wBACN,MAAOkzC,CACR,CAAC,CACH,OAAQhzC,EAAK,CACZ,KAAK,IAAI,QAAQ,2DAA4DA,CAAG,CACjF,CAEAwC,EAAK,KAAK,KAAK,uBAAuBiwC,CAAI,CAAC,EAGtCE,IACJnwC,EAAK,KAAK,8CAA8C,EACxDA,EAAK,KAAK,gEAAgE,EAC1EA,EAAK,KAAK,iEAAiE,EAC3EA,EAAK,KAAK,+DAA+D,EACzEA,EAAK,KAAK,gEAAgE,EAE5E,CAEA,IAAIlE,EAAO,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,kBAAkB,CAAC,EAC9D,CAAEA,GAAQy0C,IACdz0C,EAAO,QAAM,KAAK,QAAQq0C,EAAO,OAAS,MAAM,GAC5Cr0C,GACJkE,EAAK,KAAK,KAAK,iBAAiBlE,CAAI,CAAC,EAGjCq0C,GAAQ,KAAK,SAAS,IAAI,yBAAyB,GACvDnwC,EAAK,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wDAW2C,EAItD,MAAMywC,EAAS,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,oBAAoB,CAAC,EAEzE,GADA,KAAK,mBAAmB,CAAEA,CAAM,EAC3BA,EAAS,CACb,MAAMngD,EAAO,KAAK,mBAAmBmgD,EAAQN,CAAI,EACjDnwC,EAAK,KAAK1P,EAAK,CAAC,CAAC,EACjBggD,EAAY,KAAKhgD,EAAK,CAAC,CAAC,CACzB,CAGA,IAAIogD,EAAa,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,gCAAgC,CAAC,EACtFC,EACI,CAAED,GAAcH,IACpBG,EAAa,QAAM,KAAK,QAAQP,EAAO,OAAS,MAAM,GAElDO,GACJ1wC,EAAK,KAAK,+BAA+B0wC,EAAW,MAAM,CAAC,GAAG,EAK9DC,EAHaD,EAAW,OAAO,EAClB,EAES,IAEtBC,EAAe,CAAER,EAElB,IAAIS,EAAe,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,0BAA0B,CAAC,EACnF,MAAMC,EAAcD,GAAgBF,EAIpC,GAHOE,IACNA,EAAe,QAAM,KAAK,QAAQD,EAAe,OAAS,MAAM,GAE5DC,EAAe,CACdC,GACJ7wC,EAAK,KAAK,yBAAyB4wC,EAAa,MAAM,CAAC,GAAG,EAE3D,MAAMX,EAAOW,EAAa,OAAO,EAChCR,EAAQH,EAAK,EAEdjwC,EAAK,KAAK,6BAA6BiwC,EAAK,GAAGG,EAAQ,EAAG,EAAE,MAAM,CAAC,GAAG,EACtEpwC,EAAK,KAAK,+BAA+BiwC,EAAK,GAAGG,EAAQ,EAAG,EAAE,MAAM,CAAC,GAAG,CACzE,CAIA,MAAMU,EAAY,CAAC,EAClBC,EAAkB,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,6BAA6B,CAAC,EACtF,IAAIjM,EAAYqL,EAChB,GAAKY,EAAkB,CACtBA,EAAgB,EAAI,EACpB,MAAMd,EAAOc,EAAgB,OAAO,EAEpCjM,EADQmL,EAAK,EACM,GAEnBa,EAAU,KAAK,KAAK,uBAAuBb,CAAI,CAAC,CACjD,CAEA,IAAIhL,EAAY,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,uBAAuB,CAAC,EACxE,CAAEA,GAAa8L,IACnB9L,EAAY,QAAM,KAAK,QAAQH,EAAY,OAAS,MAAM,GACtDG,GACJ6L,EAAU,KAAK,KAAK,iBAAiB7L,CAAS,CAAC,EAIhD,MAAM+L,EAAc,QAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,yBAAyB,CAAC,EAClFC,EAAmB,CAAC,EAErB,GAAKD,EAAc,CAClB,MAAM1gD,EAAO,KAAK,mBAAmB0gD,EAAalM,CAAS,EAC3DgM,EAAU,KAAKxgD,EAAK,CAAC,CAAC,EACtB2gD,EAAiB,KAAK3gD,EAAK,CAAC,CAAC,CAC9B,CAEKwgD,EAAU,OACd,KAAK,WAAW,IAAI,cAAe,0DAA0DA,EAAU,KAAK;AAAA,CAAI,CAAC,8FAA8FG,EAAiB,KAAK;AAAA,CAAI,CAAC,GAAG,EAE7O,KAAK,WAAW,OAAO,aAAa,EAErC,KAAK,iBAAiBH,EAAU,QAAU9wC,EAAK,MAAM,EAErD,MAAMphB,EAAWuxD,EAAO,GAAK,2DAExBnwC,EAAK,OACT,KAAK,WAAW,IAAI,SAAU,4DAA4DphB,CAAQ,KAAKohB,EAAK,KAAK;AAAA,CAAI,CAAC,+FAA+FswC,EAAY,KAAK;AAAA,CAAI,CAAC,GAAG,EAE9O,KAAK,WAAW,OAAO,QAAQ,CACjC,CAEA,mBAAmBY,EAAQ,CAC1B,GAAKA,EAAS,CACb,MAAMlxC,EAAO,CAAC,EACd,QAAQvR,EAAE,EAAGA,EAAI,GAAIA,IACpBuR,EAAK,KAAK,sBAAsBvR,EAAE,CAAC,8BAA8BA,EAAE,CAAC,IAAI,EAEzE,KAAK,WAAW,IAAI,gBAAiB,SAASuR,EAAK,KAAK;AAAA,CAAI,CAAC,GAAG,CACjE,MACC,KAAK,WAAW,OAAO,eAAe,CACxC,CAEA,iBAAiBkxC,EAAQ,CACxB,GAAO,KAAK,aASL,GAAK,CAAEA,EAAS,CACtB,KAAK,YAAY,OAAO,EACxB,MACD,MAZ0B,CACzB,GAAK,CAAEA,EACN,OAED,KAAK,eAAc,iBAAc,OAAQ,CACxC,IAAK,aACL,KAAM,WACN,KAAM,CACP,CAAC,CACF,CAKO,SAAS,KAAK,SAAS,KAAK,WAAW,GAC7C,SAAS,KAAK,YAAY,KAAK,WAAW,CAC5C,CAEA,UAAW,CAEV,IAAIC,EACJ,GAAI,CACHA,EAAa,OAAO,WAAW,yBAAyB,GAAG,OAC5D,MAAa,CAAc,CAE3B,KAAK,SAAS,cAAc,CAC3B,mBAAoBA,GAAc,EACnC,CAAC,EAED,KAAK,SAAS,WAAW,6BAA8Bx0D,GAAO,CAC7D,KAAK,WAAW,OAAO,YAAaA,CAAG,CACxC,CAAC,EAED,KAAK,UAAU,EACf,KAAK,WAAW,CACjB,CACD,EA/iBgD,mBAAjC,IAAMy0D,EAAN,C,uHCvBf,MAAMC,EAAY,sFACZld,EAAY,CACjB,IAAM,EACN,IAAM,EACN,IAAM,CACP,EAEA,SAASmd,EAAcC,EAAO,CAC7B,GAAI,CACE,WAAW,KAAKA,CAAK,IACzBA,EAAQ,SAASA,EAAO,EAAE,EAC5B,MAAa,CAAc,CAE3B,OAAK,OAAOA,GAAU,UAAY,MAAMA,CAAK,GAAK,CAAE,SAASA,CAAK,KACjEA,EAAQ,GAEFA,CACR,CAVS,EAAAD,EAAA,iBAaM,MAAM,EAAN,MAAM,UAAsB,SAAO,CACjD,eAAenvD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,cAAgB,GAErB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EAEtB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,WAAW,EAEvB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,aAAa,EACzB,KAAK,OAAO,gBAAgB,EAC5B,KAAK,SAAS,YAAa,WAAW,EACtC,KAAK,OAAO,kCAAkC,EAE9C,KAAK,oBAAsB,KAAK,KAAK,OACpC,wBACA8X,GAAKA,EAAE,SAAWA,EAAE,WAAaA,EAAE,OAAO,SAC1C,CAAC,aAAc,YAAa,OAAO,CACpC,EAQA,KAAK,cAAgB,KAAK,KAAK,OAC9B,kBACAA,GAAKA,EAAE,yBAA2BA,EAAE,OAAO,eAC3C,CAAC,aAAc,YAAa,OAAO,CACpC,EAIA,KAAK,SAAS,IAAI,6BAA8B,CAC/C,QAAS,GACT,GAAI,CACH,KAAM,sCACN,MAAO,8CACP,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GACT,GAAI,CACH,KAAM,0KACN,MAAO,mDACP,YAAa,iIACb,UAAW,mBACZ,CACD,CAAC,EAED,KAAK,YAAc,IACpB,CAGA,MAAM,UAAW,C7GhGlB,M6GiGE,KAAK,KAAK,QAAQ,GAAG,kCAAmC,KAAK,cAAe,IAAI,EAChF,KAAK,KAAK,QAAQ,GAAG,qCAAsC,KAAK,cAAe,IAAI,EACnF,KAAK,GAAG,yBAA0B3b,GAAM,KAAK,kBAAkBA,EAAI,KAAM,GAAO,EAAK,EAAG,IAAI,EAC5F,KAAK,GAAG,4BAA6B,KAAK,kBAAmB,IAAI,EACjE,KAAK,GAAG,mBAAoB,KAAK,eAAgB,IAAI,EACrD,KAAK,GAAG,oBAAqB,KAAK,YAAa,IAAI,EACnD,KAAK,GAAG,sBAAuB,KAAK,cAAe,IAAI,EACvD,KAAK,GAAG,0BAA2B,KAAK,iBAAkB,IAAI,EAC9D,KAAK,GAAG,0BAA2B,KAAK,iBAAkB,IAAI,EAC9D,KAAK,GAAG,cAAe,KAAK,cAAe,IAAI,EAC/C,KAAK,GAAG,6BAA8B,KAAK,aAAc,IAAI,EAE7D,UAAU8vB,KAAW,oBACpB,KAAK,KAAK,QAAQ,GAAG,WAAWA,CAAO,GAAI,KAAK,cAAe,IAAI,EAEpE,UAAUA,KAAW,wBACpB,KAAK,KAAK,QAAQ,GAAG,WAAWA,CAAO,GAAI,KAAK,iBAAkB,IAAI,EAEvE,UAAUA,KAAW,wBACpB,KAAK,KAAK,QAAQ,GAAG,WAAWA,CAAO,GAAI,KAAK,iBAAkB,IAAI,EAEvE,KAAK,GAAG,oBAAqB,CAACwH,EAAcC,EAAiBC,EAAeC,IAAa,CACxF,GAAKD,EACJ,UAAUmS,KAAQ,KAAK,cAAc,UAAW,CAC/C,MAAMjrC,EAAUirC,EAAK,MAAM,eACpBjrC,EAAQ,SAAS,cAGxB+4B,EAAS,KAAK,CACb,QAAS/4B,EAAQ,QAAQ,aACzB,UAAWirC,EACX,OAAQ,IAAMA,EAAK,YAAY,CAChC,CAAC,CACF,CACF,CAAC,EAED,KAAK,oBAAoB,GAAG,QAAS,KAAK,YAAa,IAAI,EAC3D,KAAK,oBAAoB,GAAG,UAAW,KAAK,cAAe,IAAI,EAC/D,KAAK,oBAAoB,GAAG,gBAAiB,KAAK,YAAa,IAAI,EAEnE,KAAK,oBAAoB,MAAM,CAACC,EAAKC,IAAc,CAClD,UAAUF,KAAQE,EACjB,KAAK,YAAYF,CAAI,CAEvB,CAAC,EAED,MAAM/tB,EAAI,KACTg4B,EAAQ,MAAM,KAAK,KAAK,UAAU,EACnC,GAAK,CAAEA,EACN,OAED,MAAMhxB,EAAgBgxB,EAAM,cAC3BgD,EAAiB,KAAK,cAAgB,KAAK,aAAa,YAEzD,KAAK,eAAgB,gBAA+BhD,EAAM,SAAU,CACnE,YAAY3uB,EAAO,CAClB,MAAMA,CAAK,EAEX,KAAK,UAAY,IAAM,CACtB,KAAK,MAAM,eAAe,CACzB,WAAY,KAAK,MAAM,QAAQ,QAAQ,UACvC,cAAe,KAAK,MAAM,QAAQ,QAAQ,UAC1C,QAAS,KAAK,MAAM,QAAQ,OAC7B,CAAC,CACF,EAEA,KAAK,gBAAkB,IAAM,CAC5B,KAAK,MAAM,qBAAqB,KAAK,MAAM,QAAQ,OAAO,CAC3D,EAEA,KAAK,OAAS,IAAM,CACnB,KAAK,MAAM,cAAc,EACzB,KAAK,SAAS,CACb,MAAO,EACR,CAAC,CACF,EAEA,KAAK,QAAU,IAAM,CACpB,KAAK,SAAS,CACb,MAAO,EACR,CAAC,CACF,EAEA,KAAK,MAAQ,CACZ,MAAO,EACR,CACD,CAEA,QAAS,CAEP,OAAO,IAcT,CACD,EAnDoE,wBAA/C,GAqDrB,KAAK,cAAc,MAAM2kB,GAAO,CAC/B,MAAM4I,EAAa5I,EAAI,UAAU,OAEjCA,EAAI,UAAU,iBAAmB,SAASnrC,EAAKumB,EAAO,CACrD,MAAM0S,EAAYj5B,EAAI,UACrBo4C,EAAenf,EAAY9b,EAAE,KAAK,QAAQ,IAAI,eAAe,EAAI,EACjEk7B,EAAgBD,GAAgB,EAChCE,EAAeF,IAAiB,GAAKA,IAAiB,EACtDt0B,EAAO9jB,EAAI,KACXu4C,EAAYp7B,EAAE,UAAU,SAAS2G,EAAK,EAAE,GAAKA,EAAK,MAClDY,EAAQvH,EAAE,UAAU,OAAO,QAAQo7B,CAAS,EAE5C/6B,EAAIL,EAAE,KAAK,QAAQ,EAEfK,IACJA,EAAE,UAAY,KAAK,MAAM,uBACzBA,EAAE,MAAQA,EAAE,OAASA,EAAE,MAAM,SAG9B,IAAIi3C,EAEJ,GAAKz0D,EAAI,aAAe,GAAO,CAC9B,MAAMsnC,GAAStnC,EAAI,QAAU,CAAC,EAE9B,GADUsnC,GAAO,QAAQ,IACT,QAAU,CACzB,MAAMjW,EAAUlU,EAAE,KAAK,QAAQ,IAAI,gBAAgB,EAElDu3C,GAAaH,EAAcjtB,GAAO,kBAAkB,CAAC,EACrDqtB,GAAoBJ,EAAcjtB,GAAO,6BAA6B,CAAC,EACvEoQ,GAASid,IAAqBD,GAK/B,GAHAv3C,EAAE,IAAI,KAAK,wBAAyBkU,EAAS,UAAWqmB,GAAQ,cAAeid,GAAmB,OAAQD,EAAU,EACpHv3C,EAAE,IAAI,KAAK,aAAcmqB,EAAM,EAE1BjW,IAAY,GAAMqmB,GAAS,GAAKrmB,EAAU,EAAK,CACnD,MAAMujC,GAAQL,EAAcjtB,GAAO,+BAA+B,CAAC,IAAM,EACxEqQ,GAAOrQ,GAAO,oBAAoB,EAClCutB,GAAQld,KAAS,QACjBntB,GAAO4sB,EAAUO,EAAI,GAAK,EAE3Bx6B,EAAE,IAAI,KAAK,YAAay3C,GAAO,QAASjd,GAAM,QAASntB,EAAI,EAE3DiqC,EAAat3C,EAAE,KAAK,MAAM,gBAAiB,6BAA8B,CACxE,KAAM,EAAC,QAAK,MAAM,4BAA4B2G,EAAK,WAAY,EAC/D,KAAM+wC,GACL13C,EAAE,KAAK,EAAE,wBAAyB,mBAAmB,EACrDA,EAAE,KAAK,EAAE,gBAAiB,iBAAkB,CAAC,KAAAqN,EAAI,CAAC,CACpD,CAAC,EAEIoqC,IAASF,GAAa,EAC1BD,EAAW,KAAKt3C,EAAE,KAAK,EACtB,6BACA,kGACA,CACC,WAAYw3C,GACZ,OAAQD,EACT,CACD,CAAC,EACQhd,GAAS,GAClB+c,EAAW,KAAKt3C,EAAE,KAAK,EACtB,kBACA,gDACA,CACC,MAAOu6B,EACR,CACD,CAAC,CACH,CACD,CAED,MAAY13C,EAAI,aACfy0D,EAAaz0D,EAAI,YAElB,MAAMg6B,EAASh6B,EAAI,WAAaA,EAAI,YAAcmd,EAAE,KAAK,gBAAgBnd,EAAKwd,CAAC,EAC9Ew8B,EAAe7B,GAAkBh7B,EAAE,KAAK,iBAAiB6c,EAAQh6B,CAAG,EAE/D44C,EAAaz7B,EAAE,KAAK,WAAW2G,EAAMK,CAAa,EAClDq0B,EAAgBr7B,EAAE,UAAU,QAAQ2G,EAAK,EAAE,EAEjD,IAAIq2B,EAAan6C,EAAI,eAChBm6C,aAAsB,IAC1BA,EAAa,CAAC,GAAGA,CAAU,EAAE,KAAK,GAAG,EAC5B,MAAM,QAAQA,CAAU,IACjCA,EAAaA,EAAW,KAAK,GAAG,GAEjC,MAAME,EAAa,CAClB,UAAW,yCAAyC7B,EAAgB,4DAA8D,EAAE,IAAI2B,GAAc,EAAE,GACxJ,qBAAsB,0BACtB,KAAM,IAAIr2B,EAAK,KAAK,GACpB,IAAK,sBACL,OAAQ,SACR,MAAO,CAAE,MAAAY,CAAM,CAChB,EAEK1kB,EAAI,gBACR,OAAO,OAAOq6C,EAAYr6C,EAAI,cAAc,EAExCA,EAAI,gBACR,OAAO,OAAOq6C,EAAW,MAAOr6C,EAAI,cAAc,EAEnD,MAAM80D,EAAY3wC,EAAc,IAAKk2B,EAAY7B,EAAgB,CAChEr0B,EAAc,OAAQ,CACrB,UAAW,2BACZ,EAAGq0B,CAAa,EAChBr0B,EAAc,MAAO,CACpB,UAAW,kEACZ,EAAGy0B,CAAU,CACd,EAAIA,CAAU,EAEd,IAAIt4C,EAAO,EAAC,OAAI,MAAM,iBAAiB,eAAcN,EAAI,OAAQ,YAAWA,EAAI,UAAW,eAAc8jB,EAAK,GAAI,YAAWA,EAAK,OACjI,EAAC,QAAK,MAAM,8BACX3G,EAAE,KAAK,OAAO,OAAOnd,EAAKmkB,CAAa,CACvC,EACA2wC,EACD,EAAC,OAAI,qBAAmB,2BAA2B,MAAM,iCACxD,EAAC,YAAM77B,EAAY,IAAM,IAAK,EAC9B,EAAC,QACA,MAAO,WAAWof,EAAgB,sCAAwC,EAAE,GAC5E,MAAO,CAAC,MAAOC,EAAe5zB,EAAQ,IAAI,GAExCvH,EAAE,KAAK,aAAa6c,EAAQ7V,CAAa,CAC5C,EACC61B,GAAgB71B,EAAcg0B,EAAgB6B,CAAY,CAC5D,CACD,EAEA,OAAKya,IACJn0D,EAAO,EAAC,OAAI,MAAM,kBACjB,EAAC,OAAI,MAAM,2BACV,EAAC,WAAKm0D,CAAW,CAClB,EACCn0D,CACF,GAEO,EAAC,OAAI,MAAM,8DAChBA,EACAimB,EAAS,EAACpJ,EAAE,cAAF,CACX,QAASoJ,EACT,uBAAwB,KAAK,MAAM,uBACnC,iBAAkB,KAAK,MAAM,iBAC7B,eAAgB,KAAK,MAAM,eAC3B,qBAAsB,KAAK,MAAM,qBACjC,cAAe,KAAK,MAAM,cAC1B,aAAc,KAAK,oBACpB,EAAM,IACP,CACD,EAEA4kB,EAAI,UAAU,kBAAoB,SAASnrC,EAAK,CAC/C,OAAOA,EAAI,iBACVA,EAAI,eAAiB,IAAM,KAAK,oBAAoBA,EAAI,KAAK,KAAK,GAE3D,EAAC,OAAI,MAAM,4CAClB,EAAC,UAAO,MAAM,4BAA4B,qBAAmB,sBAAsB,QAASA,EAAI,gBAC/F,EAAC,QAAK,MAAM,2BAA4Bmd,EAAE,KAAK,EAAE,mBAAoB,OAAO,CAAG,CAChF,EACA,EAAC,QAAK,MAAM,mFAAkF,UACzFA,EAAE,KAAK,EAAE,kBAAmB,uBAAwB,CACvD,KAAMnd,EAAI,SACX,CAAC,EACD,EAAC,OAAI,MAAM,iEAAiE,KAAK,WAC9Emd,EAAE,KAAK,eAAend,EAAI,UAAW,MAAM,CAC9C,CACD,CACD,CACD,EAEAmrC,EAAI,UAAU,OAAS,UAAW,CACjC,GAAI,CAGH,GAFA,KAAK,aAAe,GAEf,KAAK,OAAO,eAAiB,CAAEhuB,EAAE,KAAK,QAAQ,IAAI,yBAAyB,EAC/E,OAAO42B,EAAW,KAAK,IAAI,EAE5B,MAAM9zC,EAAU,KAAK,MAAM,eAC1BD,EAAMmd,EAAE,mBAAmBld,EAAQ,QAASA,EAAQ,MAAM,EAC1D80D,EAAe,KAAK,iBAAiB/0D,EAAKC,CAAO,EACjD+0D,EAAkB,KAAK,MAAM,eAAiB,CAAE73C,EAAE,KAAK,QAAQ,IAAI,4BAA4B,EAE/Fq8B,EAASx5C,EAAI,WAAaA,EAAI,cAAgBmd,EAAE,UAAU,eAAe,QAAQnd,EAAI,aAAa,EAAI,KAEvG,GAAKA,EAAI,YACR,OAAO,KAER,MAAM43B,EAAY,CAAE4hB,GAAUx5C,EAAI,WAAamd,EAAE,KAAK,QAAQ,IAAI,6BAA6B,EAE/F,OAAQ,EAAC,OACR,qBAAmB,iBACnB,MAAO,8FAA8Fnd,EAAI,OAAS,uCAAyC,EAAE,GAAGA,EAAI,UAAY,oCAAsC,EAAE,GAAG43B,EAAY,0CAA4C,EAAE,GAAG53B,EAAI,UAAY,iBAAmB,EAAE,GAAGw5C,EAAS,oBAAsB,EAAE,GACjW,MAAO,CAAC,gBAAiBA,CAAM,GAE9Bwb,GAAoB,EAAC,OAAI,qBAAmB,oBAAoB,MAAM,+DACtE,EAAC,OAAI,MAAM,cACV,EAAC,OAAI,MAAM,wDACV,EAAC,UAAO,MAAM,mHAAmH,QAAS,KAAK,yBAC9I,EAAC,OAAI,MAAM,cACV,EAAC,KAAE,MAAM,qBAAkB,kBAAe/0D,EAAQ,QAAQ,aAAa,CAAE,CAC1E,CACD,EACA,EAAC,OAAI,MAAM,+DAA+D,KAAK,WAC7Ekd,EAAE,KAAK,EAAE,kBAAmB,eAAe,CAC7C,CACD,CACD,CACD,EACA,EAAC,OAAI,MAAM,iBACR43C,EACA,KAAK,MAAM,kBAAoB,KAAK,kBAAkB/0D,CAAG,EACzDC,EAAQ,SAAWA,EAAQ,QAAQ,OAAS,GAAM,EAAC,OAAI,MAAM,8DAC5DA,EAAQ,QAAQ,aAAgB,EAAC,OAAI,MAAM,kDAC5C,EAAC,UAAO,MAAM,2CAA2C,QAAS,KAAK,+BACtE,EAAC,QAAK,MAAM,kBAAkB,gBAAc,kBAC3Ckd,EAAE,KAAK,EAAE,uBAAwB,sBAAsB,CACvD,CACF,CACD,EACA,EAAC,UACAld,EAAQ,QAAQ,IAAIsmB,GAAU,EAAC,MAAG,IAAKA,EAAM,SAAWA,EAAM,QAAQ,GAAI,MAAM,cAC7E,KAAK,iBAAiBpJ,EAAE,mBAAmBoJ,EAAM,QAASA,EAAM,MAAM,EAAGA,CAAK,EAC9E,KAAK,MAAM,kBAAoB,KAAK,kBAAkBvmB,CAAG,CAC5D,CAAM,CACN,CACF,CACD,CACD,CAED,OAAQygB,EAAK,CACZtD,OAAAA,EAAE,IAAI,MAAM,yBAA0BsD,CAAG,EAClCszB,EAAW,KAAK,IAAI,CAC5B,CACD,EAIA,WAAW,IAAM,KAAK,cAAc,YAAY,CAAC,CAClD,CAAC,CACF,CAGA,aAAc,CACb,OAAO,KAAK,aAAa,CAC1B,CAEA,eAAgB,CACf,KAAK,cAAc,YAAY,CAChC,CAEA,kBAAmB,CAClB,OAAO,KAAK,aAAa,GAAM,EAAK,CACrC,CAEA,kBAAmB,CAClB,OAAO,KAAK,aAAa,GAAO,EAAI,CACrC,CAEA,aAAa8G,EAAe,GAAMC,EAAe,GAAM,CACtD,UAAU5P,KAAQ,KAAK,cAAc,UAAW,CAC/C,MAAMjrC,EAAUirC,EAAK,MAAM,eAC3B,GAAOjrC,EAAQ,UAGfA,EAAQ,QAAQ,aAAe,KAE1B,MAAM,QAAQA,EAAQ,OAAO,GACjC,UAAUsmB,KAAStmB,EAAQ,QACrBsmB,EAAM,UACVA,EAAM,QAAQ,aAAe,KACjC,CAEA,KAAK,cAAc,YAAY,CAChC,CAGA,kBAAkBhlB,EAAI0zB,EAAO,CAC5B,UAAUiW,KAAQ,KAAK,cAAc,UAAW,CAC/C,MAAMjrC,EAAUirC,EAAK,MAAM,eAC3B,GAAK,CAAEjrC,EAAQ,QACd,SAED,MAAMg1D,EAASh1D,EAAQ,OAClBg1D,IAAY1zD,GAAMA,GAAM0zD,EAAO,IAAQhgC,GAASA,GAASggC,EAAO,QACpEh1D,EAAQ,QAAQ,aAAe,KAC/BirC,EAAK,YAAY,EAEnB,CACD,CAGA,eAAe3pC,EAAIs5C,EAAe,GAAMC,EAAe,KAAM,CACvDA,GAAgB,OACpBA,EAAeD,GAEhB,UAAU3P,KAAQ,KAAK,cAAc,UAAW,CAC/C,MAAMjrC,EAAUirC,EAAK,MAAM,eAC3B,GAAOjrC,EAAQ,SAGVA,EAAQ,SAAS,KAAOsB,EAAK,EAE5Bs5C,GAAgBC,KACpB76C,EAAQ,QAAQ,aAAe,MAEhCirC,EAAK,YAAY,EACjB,MACD,CACD,CACD,CAGA,cAAe,CACd,UAAUA,KAAQ,KAAK,cAAc,UAAW,CAC/C,MAAMjrC,EAAUirC,EAAK,MAAM,eAC1BlrC,EAAMC,GAAS,SAAS,aACxB+5B,EAASh6B,GAAK,WAEf,GAAKg6B,EACJ,UAAUrY,KAASqY,EACbrY,EAAM,OAAS,SAAWA,EAAM,gBACpC,KAAK,OAAO,aAAaA,EAAM,cAAc,CAEjD,CACD,CAOA,mBAAmBuzC,EAASD,EAAQ,CACnC,GAAKC,EAAQ,aACZ,OAAOA,EAAQ,aAEhB,MAAM9xC,EAAO,KAAK,aAAe,KAAK,KAAK,QAAQ8xC,EAAQ,UAAW,KAAM,GAAM,EAAI,EACrF5tB,EAAS4tB,EAAQ,QAAQ,iBACzBrM,EAASvhB,GAAUA,EAAO,QAAQ,EAE7BhnC,EAAM40D,EAAQ,aAAe,CAClC,GAAIA,EAAQ,GACZ,KAAM,CACL,MAAOA,EAAQ,QAAQ,UACvB,GAAID,EAAO,GACX,MAAOA,EAAO,KACd,YAAaA,EAAO,YACpB,OAAQA,EAAO,MAAQA,EAAO,aAAeA,EAAO,YAAY,KAAK,EAAE,YAAY,IAAMA,EAAO,KAChG,KAAMA,EAAO,IACd,EACA,UAAW7xC,GAAQA,EAAK,MACxB,OAAQA,GAAQA,EAAK,IAAM8xC,EAAQ,UACnC,WAAY,KAAK,KAAK,OAAO,UAAUD,EAAO,GAAIA,EAAO,MAAO7xC,GAAM,GAAIA,GAAM,KAAK,EACrF,OAAQ8xC,EAAQ,WAChB,aAAcA,EAAQ,QAAQ,OAC9B,UAAWA,EAAQ,QAAQ,SAC3B,aAAcA,EAAQ,YACtB,UAAWA,EAAQ,UACnB,YAAa,QACb,OAAQrM,IAAW,OAASA,IAAW,QACvC,UAAWA,IAAW,sBACtB,OAAAvhB,CACD,EAKA,GAAK,MAAM,QAAQhnC,EAAI,YAAY,GAAKA,EAAI,aAAa,QAAUuoD,IAAW,QAAU,CACvF,IAAIllC,EAAUrjB,EAAI,aAAa,CAAC,EAAE,QAClC,GAAK,OAAOqjB,GAAY,SAAW,CAClC,MAAMjD,EAAQ4zC,EAAU,KAAK3wC,CAAO,EAC/BjD,IACJiD,EAAUA,EAAQ,MAAMjD,EAAM,CAAC,EAAE,MAAM,EAAE,SAAS,EAC7CiD,EAAQ,SACZrjB,EAAI,aAAa,CAAC,EAAE,YAAcqjB,EAClCrjB,EAAI,WAAa,IAGpB,CACD,CAGA,YAAK,KAAK,kBAAkBA,CAAG,EAExBA,CACR,CAOA,QAAQuf,EAAO2G,EAAO,CACdA,IACNA,EAAQ3G,EAAM,OAEf,MAAMsW,KAAU,OAAI,mBAAoB3P,CAAK,EAC7C,GAAK,CAAE2P,GAAW,CAAEA,EAAQ,GAC3B,OAAO,KAER,MAAM/S,EAAOvD,EAAM,UAAY,KAAK,KAAK,QAAQsW,EAAQ,GAAIA,EAAQ,OAASA,EAAQ,MAAM,YAAY,EAAG,GAAO,EAAI,EACtH,OAAA/S,EAAK,IAAIvD,CAAK,EACPuD,CACR,CAGA,WAAWvD,EAAO,CACVA,EAAM,YAGbA,EAAM,UAAU,MAAMA,CAAK,EAC3BA,EAAM,UAAY,KACnB,CAOA,YAAY0C,EAAMiE,EAAO,CACjBA,IACNA,EAAQjE,EAAK,OAEP,KAAK,QAAQA,EAAMiE,CAAK,IAG/B,KAAK,YAAcjE,EAAK,UACxB,KAAK,KAAK,OAAO,sBAAmB,OAAI,cAAeiE,CAAK,CAAC,EAE7D,KAAK,iBAAiBjE,KAAM,OAAI,mCAAoCiE,CAAK,CAAC,EAC1E,KAAK,qBAAqBjE,EAAMiE,EAAM,UAAU,EACjD,CAGA,YAAYjE,EAAMiE,EAAO,CACxB,MAAK,OAAI,sBAAuBA,CAAK,OAAM,OAAI,sBAAuBjE,EAAK,KAAK,EAAI,CACnF,KAAK,WAAWA,CAAI,EACpB,KAAK,YAAYA,EAAMiE,CAAK,EAC5B,MACD,CAEA,MAAM2uC,KAAa,OAAI,cAAe3uC,CAAK,EAC1C0W,KAAa,OAAI,cAAe3a,EAAK,KAAK,EAE1C6yC,KAAkB,OAAI,mCAAoC5uC,CAAK,EAC/D6uC,KAAkB,OAAI,mCAAoC9yC,EAAK,KAAK,EAEhE4yC,IAAej4B,GACnB,KAAK,KAAK,OAAO,mBAAmBi4B,CAAU,EAE1CC,IAAoBC,GACxB,KAAK,iBAAiB9yC,EAAM6yC,CAAe,EAEvC5uC,EAAM,aAAejE,EAAK,MAAM,YACpC,KAAK,qBAAqBA,EAAMiE,EAAM,UAAU,EAEjD,MAAM2P,KAAU,OAAI,mBAAoB3P,CAAK,EAE7C,KAAK,SAAS,cAAc,CAC3B,UAAWA,EAAM,sBAClB,CAAC,EAED,KAAK,KAAK,QAAQ,cAAc,CAC/B,UAAWA,EAAM,uBACjB,QAAS2P,EAAUA,EAAQ,MAAQ,KACnC,UAAWA,EAAUA,EAAQ,GAAK,IACnC,CAAC,CACF,CAGA,cAAc5T,EAAM,CACf,KAAK,cAAgBA,EAAK,YAC7B,KAAK,YAAc,MAEpB,KAAK,WAAWA,CAAI,CACrB,CAGA,iBAAiBA,EAAM0J,EAAQ,CAC9B,MAAM7I,EAAOb,EAAK,UACXa,GAGPA,EAAK,aAAa6I,CAAM,CACzB,CAGA,qBAAqB1J,EAAM8a,EAAQ,CAClC,MAAMja,EAAOb,EAAK,UACXa,GAGPA,EAAK,oBAAiB,oBAAiBia,CAAM,CAAC,CAC/C,CACD,EAnpBkD,qBAAnC,IAAMi4B,EAAN,C,sGCIR,MAAM,EAAN,MAAM,UAAoB,UAAS,CACzC,YAAY/hD,EAAM,CACjB,MAAMA,CAAI,EAEV,KAAK,SAAW,EACjB,CAEA,aAAc,CACb,YAAK,SAAW,GACT,IACR,CACD,EAX0C,mBAAnC,IAAMgiD,EAAN,EAcA,MAAM,EAAN,MAAM,UAAiB,IAAM,CACnC,YAAY90C,EAAK,CAChB,MAAM,GAAGA,EAAI,OAAO,eAAeA,EAAI,SAAS,EAAE,CACnD,CACD,EAJoC,gBAA7B,IAAM+0C,EAAN,EAOQ,MAAM,EAAN,MAAM,UAAe,SAAO,CAC1C,eAAepwD,EAAM,CACpB,MAAM,GAAGA,CAAI,EAEb,KAAK,UAAY,CAAC,EAClB,KAAK,eAAiB,CAAC,EAEvB,KAAK,OAAO,QAAQ,CACrB,CAEA,IAAI,UAAW,CACd,GAAK,KAAK,WACT,OAAO,KAAK,WAEb,MAAMmgC,EAAY,KAAK,QAAQ,gBAAgB,EAG/C,OAFW,KAAK,WAAaA,GAAW,YAAY,aAAa,CAGlE,CAEA,UAAW,CAEV,IAAIuN,EAAS,KAAK,OAElB,GAAK,CAAEA,EAAS,CACf,MAAM55B,EAAO,KAAK,KAAK,MAIvB,GADA45B,GAFQ55B,GAAQA,EAAK,YAEN,OAAO,OACjBA,GAAQ,CAAE45B,EAAS,CACvB,IAAIphC,EAAE,EAAGpP,EAAO4W,EAChB,KAAO,CAAE45B,GAAQ,cAAgBxwC,GAAQoP,IAAM,IAC9CohC,EAASxwC,GAAM,eAAe,OAC9BA,EAAOA,GAAM,MAGd,GAAK,CAAEwwC,EAAS,CACf,MAAM2iB,EAAO,KAAK,KAAK,WAAW,KAAMv4C,GAAKA,EAAE,OAAO,QAAQ,aAAc,GAAG,EAC1Eu4C,IACJ3iB,EAAS2iB,EAAK,MAAM,OACtB,CACD,CAEA,KAAK,OAAS3iB,CACf,CAEA,GAAK,CAAEA,EACN,OAAO,IAAI,QAAQ,IAAM,KAAK,SAAS,EAAG,EAAE,EAG7C,GAAK,CAAE,KAAK,OAAO,MAAQ,CAAE,KAAK,OAAO,cAAgB,CAAE,KAAK,OAAO,aAAa,KAAO,CAC1F,KAAK,IAAI,MAAM,mEAAmE,EAClF,MACD,CAEA,KAAK,kBAAoB,GAEzB,MAAM31B,EAAI,KACTu4C,EAAQ,KAAK,OAAO,aAAa,YAAY,UAC7CC,EAAaD,EAAM,sBAqCpB,GAnCAA,EAAM,sBAAwB,SAASE,EAAOC,EAAa,GAAM,CAChE,MAAMv1D,EAAMq1D,EAAW,KAAK,KAAMC,EAAOC,CAAU,EACnD,GAAKv1D,GAAOA,EAAI,QACf,GAAI,CACH,GAAI,CACH,MAAMw1D,EAAOF,EAAM,cAAc,EAChCz1D,EAAOy1D,EAAM,QACd,KAAK,UAAU,SAAS,EAAE,KAAK,CAC9B,MAAOz1D,EAAK,MACZ,UAAWA,EAAK,UAChB,eAAgB21D,EAAOA,EAAK,KAAO,OACnC,WAAAD,CACD,CAAC,CAEF,OAAQp1C,EAAK,CAEZ,GAAKA,EAAI,SAAS,EAAE,SAAS,kBAAkB,GAAKm1C,EAAM,YAAc,CAAEA,EAAM,WAAW,SAAW,CAAEA,EAAM,WACxG,KAAK,IAAI,GAAKA,EAAM,iBAAmB,IAAM,KAAS,CAC1D,MAAMG,KAAW,OAAI,mCAAoCH,CAAK,EAC7Dz0D,EAAO40D,GAAYA,EAAS,OAAS,OAASA,EAAS,MAAQ,IAAIH,EAAM,OAAO,GAEjFz4C,EAAE,IAAI,KAAK,iDAAkDhc,CAAI,EACjEy0D,EAAM,gBAAkB,KAAK,IAAI,EACjCA,EAAM,QAAQ,CACf,CAEF,CAED,OAAQn1C,EAAK,CACZtD,EAAE,IAAI,QAAQsD,CAAG,CAClB,CAED,OAAOngB,CACR,EAEK,KAAK,OAAO,aAAa,WAAa,CAC1C,MAAM01D,EAAc,KAAK,OAAO,aAAa,WAAW,UACxD,KAAK,kBAAoB,GACzB,KAAK,OAAO,aAAa,WAAW,UAAY,SAAS/4C,EAAG,CAC3D,MAAME,EAAI,KAAK,MAAMF,EAAE,OAAO,EAC9B,OAAKE,GAAKA,EAAE,cAAgBF,EAAE,cAC7BE,EAAE,YAAcF,EAAE,aAEZ+4C,EAAY,KAAK,KAAM/4C,CAAC,CAChC,CACD,CAEA,MAAMg5C,EAAa,KAAK,WAAa,KAAK,OAAO,KAAK,YAEtD,KAAK,KAAO,IAAIA,EAAW,CAACC,EAAWC,IAAY,CAClD,GAAK,CAAE,KAAK,QACX,OAAOA,EAAQD,CAAS,EAEzB,IAAItmC,EAAOsmC,EAAU,UACd,OAAO,KAAKtmC,CAAI,EAAE,SACxBA,EAAO,QAER,GAAI,CAGE,KAAK,mBACT,KAAK,gBAAgBsmC,CAAS,CAEhC,OAAQz1C,EAAK,CACZ,YAAK,IAAI,QAAQA,EAAK,CACrB,KAAM,CACL,UAAWy1C,EAAU,aACtB,EACA,MAAO,CACN,UAAWtmC,CACZ,CACD,CAAC,EACD,KAAK,IAAI,MAAM,2BAA4BnP,EAAKy1C,CAAS,EAClDC,EAAQD,CAAS,CACzB,CAEA,OAAOC,EAAQD,CAAS,EAAE,IAAInyD,GAAU,CAClCA,EAAO,YAAcA,EAAO,WAAW,gBAAkBmyD,EAAU,eACvE,KAAK,IAAI,MAAM,CACd,MAAO,OACP,SAAU,MACV,QAAS,GAAGA,EAAU,aAAa,KAAKnyD,EAAO,YAAcA,EAAO,WAAW,sBAAwB,IAAI,MAC3G,KAAM,CACL,UAAW6rB,CACZ,CACD,CAAC,EAEF,GAAI,CACH,KAAK,iBAAiB7rB,CAAM,CAC7B,OAAQ0c,EAAK,CACZ,KAAK,IAAI,QAAQA,EAAK,CACrB,KAAM,CACL,UAAWy1C,EAAU,aACtB,EACA,MAAO,CACN,UAAWtmC,CACZ,CACD,CAAC,EACD,KAAK,IAAI,MAAM,4BAA6BnP,EAAK1c,CAAM,CACxD,CAEA,OAAOA,CACR,CAAC,CACF,CAAC,EAED,KAAK,SAAW,KAAK,OAAO,KAC5B,KAAK,YAAc,KAAK,OAAO,aAAa,KAG5C,KAAK,OAAO,KAAOkyD,EAAW,KAAK,CAClC,KAAK,KACL,KAAK,QACN,CAAC,EAED,KAAK,OAAO,aAAa,KAAOA,EAAW,KAAK,CAC/C,KAAK,KACL,KAAK,WACN,CAAC,CAUF,CAGA,WAAY,CAEX,KAAK,OAAS,KAAK,QAAU,KAAK,WAAa,KAAK,SAAW,KAAK,aAAe,KAAK,YAAc,IACvG,CAGA,gBAAgBG,EAAS,CACxB,MAAMF,EAAYE,EAAQ,cACzBxyD,EAAY,KAAK,UAAUsyD,CAAS,EACpCn2C,EAAQ,YAAYm2C,CAAS,GAC7BG,EAAgB,KAAK,aAAat2C,CAAK,EAExC,GAAK,CAAEnc,GAAa,CAAEyyD,EACrB,OAED,MAAMC,EAAK,KAAK,OAAO,aACtBC,EAASD,GAAMA,EAAG,eAClBE,EAAYF,GAAMA,EAAG,QACrB5R,EAAS6R,GAAUA,EAAOL,CAAS,EACnC30D,EAAK,MAAM,QAAQmjD,CAAM,EAAIA,EAAO,CAAC,EAAIA,EACzCkR,EAAQY,GAAaA,EAAU,IAAIj1D,CAAE,EAEtC,GAAKqC,EACJ,UAAUqc,KAAOrc,EACX,OAAOqc,GAAQ,WACnBA,EAAIm2C,CAAO,EACFn2C,EAAI,CAAC,GACd,KAAK,cAAcm2C,EAASn2C,EAAI,CAAC,CAAC,EAIrC,IAAIwF,EAAW,CAAC,CAAE7hB,EAElB,GAAKyyD,EAAgB,CACpB,MAAMp5C,EAAI,IAAIs4C,EAAY,CACzB,UAAAW,EACA,QAAAE,CACD,CAAC,EAED,KAAK,KAAKr2C,EAAO9C,CAAC,EACbA,EAAE,WACNwI,EAAW,GACb,CAEA,GAAKA,EAAW,CAIf,MAAMgxC,EAAI,KAAK,OAAO,aAAa,WAAW,MAAMl1D,CAAE,EACrDm1D,EAAK,KAAK,UAAY,KAAK,SAASN,EAAQ,KAAK,EAE7CK,IACCC,GACJD,EAAE,YAAcC,EAChBN,EAAQ,MAAM,IAAI,OAAO,KAAOM,EAChCN,EAAQ,MAAM,IAAI,IAAMM,EAAG,OAEtBd,IACJA,EAAM,SAAWQ,EAAQ,MACpBR,EAAM,iBAAmBA,EAAM,gBAAgB,UACnDA,EAAM,gBAAgB,QAAQ,MAAQQ,EAAQ,UAIhD,KAAK,IAAI,KAAK,sDAAuDF,CAAS,EAC9E,KAAK,OAAO,aAAa,WAAW,MAAM30D,CAAE,EAAI,MAEnD,CACD,CAEA,iBAAiBksB,EAAU,CAC1B,GAAK,CAAEA,EAAS,WACf,OAED,MAAMyoC,EAAYzoC,EAAS,WAAW,cACrC7pB,EAAY,KAAK,eAAesyD,CAAS,EAE1C,GAAKtyD,EACJ,UAAUqc,KAAOrc,EAChBqc,EAAIwN,CAAQ,EAEd,KAAK,KAAK,aAAayoC,CAAS,GAAIzoC,EAAS,IAAI,CAClD,CAGA,cAAc2oC,EAASpyD,EAAU,CAChCoyD,EAAQ,SAAQ,WAAMA,EAAQ,MAAOpyD,CAAQ,CAC9C,CAGA,iBAAiBkyD,EAAWlyD,EAAU2yD,EAAI,GAAM,CAC/C,GAAK,OAAO3yD,GAAa,WAAa,CACrC,GAAK,CAAE2yD,EACN,MAAM,IAAI,MAAM,kCAAkC,EAUnD3yD,EAAW,CAACA,EAAUA,CAAQ,CAC/B,EAEa2yD,EACT,KAAK,UAAUT,CAAS,EAAI,KAAK,UAAUA,CAAS,GAAK,CAAC,EAC1D,KAAK,eAAeA,CAAS,EAAI,KAAK,eAAeA,CAAS,GAAK,CAAC,GAEnE,KAAKlyD,CAAQ,CACnB,CAEA,mBAAmBkyD,EAAWlyD,EAAU2yD,EAAI,GAAM,CACjD,MAAMr0B,EAAOq0B,EAAM,KAAK,UAAUT,CAAS,EAAI,KAAK,eAAeA,CAAS,EAC5E,GAAO5zB,EAGP,IAAK,OAAOt+B,GAAa,WACxB,MAAM,IAAI,MAAM,qCAAqC,EAEtD,QAAQ0N,EAAE,EAAGA,EAAI4wB,EAAK,OAAQ5wB,IAAK,CAClC,MAAMuO,EAAMqiB,EAAK5wB,CAAC,EAClB,GAAK,OAAOuO,GAAQ,WAAaA,IAAQjc,EAAWic,EAAI,CAAC,IAAMjc,EAAW,CACzEs+B,EAAK,OAAO5wB,EAAG,CAAC,EAChB,MACD,CACD,EACD,CAOA,SAASwkD,EAAW,CACnB,MAAMM,EAAY,KAAK,OAAO,cAAc,QAE5C,GAAOA,EAGP,UAAU52D,KAAO42D,EAAU,OAAO,EAAG,CACpC,MAAM5J,EAAMhtD,GAAK,gBACjB,GAAKgtD,GAAK,YAAcsJ,EACvB,OAAOtJ,CACT,CACD,CAGA,aAAasJ,EAAW,CACvB,MAAMN,EAAQ,KAAK,SAASM,CAAS,EAChC,CAAEN,GAAS,CAAEA,EAAM,YAAcA,EAAM,WAAW,OAGvDA,EAAM,QAAQ,CACf,CAGA,YAAYM,EAAW/kB,EAAWwZ,EAAQ,IAAKiM,EAAa,KAAQ,CACnE,MAAMhB,EAAQ,KAAK,SAASM,CAAS,EAErC,GAAKN,EAAQ,CACZ,MAAM7xD,EAAS6xD,EAAM,WACrB,IAAIiB,EACG9yD,EAEGA,EAAO,QAChB8yD,EAAS,GACA,OAAO1lB,GAAc,WAC9B0lB,EAAS1lB,EAAUptC,CAAM,EAEzB8yD,KAAS,OAAI1lB,EAAWptC,CAAM,IAAM,OANpC8yD,EAAS,GAQL,CAAEA,GAAU,KAAK,IAAI,GAAKjB,EAAM,iBAAmB,IAAMgB,IAC7DhB,EAAM,gBAAkB,KAAK,IAAI,EAIjCA,EAAM,QAAQ,MAAQ,OAAO,OAAO,CAAC,EAAGA,EAAM,QAAQ,KAAK,EAEtDjL,IAAU,EACdiL,EAAM,QAAQ,EACLjL,EAAQ,GACjB,WAAW,IAAM,CAEhBiL,EAAM,QAAQ,CACf,EAAGjL,CAAK,EAEX,CAEA,OAAOiL,CACR,CAGA,aAAaM,EAAW/kB,EAAWwZ,EAAQ,IAAKiM,EAAa,KAAQ,CACpE,MAAMhB,EAAQ,KAAK,SAASM,CAAS,EACpCnyD,EAAS6xD,GAASA,EAAM,WAEzB,GAAK,CAAEA,EACN,OAED,IAAIt1D,EAEJ,GAAK,EAAAyD,IACC,OAAOotC,GAAc,WACzB7wC,EAAM6wC,EAAUptC,CAAM,EAEtBzD,KAAM,OAAI6wC,EAAWptC,CAAM,EAEvBA,EAAO,UAIb,OAAKzD,IAAQ,QAAa,KAAK,IAAI,GAAKs1D,EAAM,iBAAmB,IAAMgB,IACtEhB,EAAM,gBAAkB,KAAK,IAAI,EAIjCA,EAAM,QAAQ,MAAQ,OAAO,OAAO,CAAC,EAAGA,EAAM,QAAQ,KAAK,EAEtDjL,IAAU,EACdiL,EAAM,QAAQ,EACLjL,EAAQ,GACjB,WAAW,IAAMiL,EAAM,QAAQ,EAAGjL,CAAK,GAGlCrqD,CACR,CAED,EApa2C,cAA5B,IAAMw2D,EAAN,C,uECvDf,IAAIC,EAAIC,EAAM5nB,EACV6nB,EAEJ,SAASC,GAAS,CACjB,OAAKH,EACG,QAAQ,QAAQA,CAAE,EAEnB,IAAI,QAAQ,CAACx5C,EAAEY,IAAM,CAC3B,GAAKixB,EACJ,OAAOA,EAAQ,KAAK,CAAC7xB,EAAEY,CAAC,CAAC,EAE1BixB,EAAU,CAAC,CAAC7xB,EAAEY,CAAC,CAAC,EAEhB,QAAQ,IAAI,CACX,qCACA,oCACD,CAAC,EAAE,KAAKoyB,GAAW,CAClBwmB,EAAKxmB,EAAQ,CAAC,GAAG,QACjBymB,EAAOzmB,EAAQ,CAAC,GAAG,QAEnB,MAAM4mB,EAAS/nB,EACfA,EAAU,KAEV,UAAU7U,KAAQ48B,EACjB58B,EAAK,CAAC,EAAEw8B,CAAE,CAEZ,CAAC,EAAE,MAAMt2C,GAAO,CACf,MAAM02C,EAAS/nB,EACfA,EAAU,KAEV,UAAU7U,KAAQ48B,EACjB58B,EAAK,CAAC,EAAE9Z,CAAG,CACb,CAAC,CACF,CAAC,CACF,CA/BS,EAAAy2C,EAAA,UAkCT,SAASE,EAAc1F,EAAI,CAC1B,MAAM2F,EAAiB3F,EAAG,SAAS,MAAM,WAAa,KAAK,cAE3DA,EAAG,SAAS,MAAM,UAAY,SAAS13B,EAAQ9a,EAAKxf,EAAS43D,EAAKC,EAAM,CACvE,MAAM51C,EAAQqY,EAAO9a,CAAG,EACxB,GAAKyC,GAASA,EAAM,OAAS,aAAe,MAAM,QAAQA,EAAM,KAAK,EAAI,CACxE,IAAI61C,EACJ,UAAUC,KAAQ91C,EAAM,MACvB,GAAK81C,EAAK,CAAC,IAAM,OAAS,CACzBD,EAAOC,EAAK,CAAC,EACb,KACD,CAGD,GAAKD,EAAK,WAAW,GAAG,EAAI,CAC3B,IAAI3wB,EAEJ,GAAK2wB,IAAS,IAAM,CAEnB,IAAI9lD,EAAIwN,EAAM,EACV+D,EAAO,CAAC,EAEZ,KAAMvR,EAAIsoB,EAAO,QAAQ,CACxB,MAAMoO,EAAMpO,EAAOtoB,CAAC,EACnBlQ,EAAO4mC,GAAK,KACb,GAAK5mC,IAAS,OACbyhB,EAAK,KAAKmlB,CAAG,UACJ5mC,IAAS,aAClB,MAEDkQ,GACD,CAEAuR,EAAOA,EAAK,IAAIrb,GAAKA,EAAE,OAAO,EAAE,KAAK,EAAE,EAEvCi/B,KADa,KAAW5jB,CAAI,EAChB,IAAIrb,GAAKA,EAAE,GAAG,EAAE,KAAK,GAAG,CACrC,MACCi/B,EAAO2wB,EAAK,MAAM,CAAC,EAEpB,GAAK3wB,GAAQA,EAAK,OAAS,CAC1B,UAAU4wB,KAAQ91C,EAAM,MACvB,GAAK81C,EAAK,CAAC,IAAM,QAAU,CAC1BA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAE,QAAQ,eAAgB,EAAE,EAC5C,KACD,CAGD91C,EAAM,MAAM,KAAK,CAChB,qBACAklB,CACD,CAAC,EACDllB,EAAM,MAAM,KAAK,CAChB,UACA,uEACD,CAAC,CACF,CACD,CACD,CAEA,OAAO01C,EAAer9B,EAAQ9a,EAAKxf,EAAS43D,EAAKC,CAAI,CACtD,CACD,CA7DS,EAAAH,EAAA,iBA+DTA,EAAc,cAAgB,SAASp9B,EAAQ9a,EAAKxf,EAAS43D,EAAKC,EAAM,CACvE,OAAOA,EAAK,YAAYv9B,EAAQ9a,EAAKxf,CAAO,CAC7C,EAEe,eAAeg4D,GAAU,CACvC,GAAK,CAAET,EAAM,CACZ,MAAMF,EAAK,MAAMG,EAAO,EACxB,GAAK,CAAEH,EACN,OAAO,KAER,MAAMrF,EAAKuF,EAAM,IAAIF,EAAG,CACvB,KAAM,GACN,QAAS,EACV,CAAC,EAEDrF,EAAG,IAAI0F,CAAa,EACpB1F,EAAG,IAAIsF,EAAM,CACZ,MAAO,CACN,MAAO,cACP,OAAQ,SACR,IAAK,WACL,oBAAqB,MACtB,CACD,CAAC,CACF,CAEA,OAAOC,CACR,CAvB8B,EAAAS,EAAA,WAyBvB,SAASC,EAAMtuC,EAAU,CAC/B,GAAK4tC,EACJ,OAAOA,EAEH5tC,GACJquC,EAAQ,EAAE,KAAKhG,GAAMroC,EAASqoC,CAAE,CAAC,CACnC,CANgB,EAAAiG,EAAA,Q,qFCtGD,MAAM,EAAN,MAAM,UAAkB,SAAyB,CAU/D,YAAYx2D,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EARnB,cAA4B,KAU3B,KAAK,OAAO,UAAU,EAEtB,KAAK,YAAc,KACnB,KAAK,WAAa,IAiBnB,CAGA,UAAW,CACV,KAAK,SAAS,SAAS,GAAG,UAAW,KAAK,iBAAkB,IAAI,CACjE,CAEA,iBAAiB4jB,EAAWla,EAAqB,CAChD,IAAIguD,EACHC,EACAC,EAED,MAAMl0C,EAAU,MAAM,CACrB,MAAMnG,EAAIm6C,EAAS73D,EAAI83D,EAAO/5C,EAAIg6C,EAClCF,EAAUC,EAAQC,EAAK,KAElBr6C,GACJA,EAAE,QAAQ,EAEN1d,GACJA,EAAE,QAAQ,EAEN+d,GACJA,EAAE,SAAS,CACb,EAZgB,WAcV5d,EACL,SAAS,mBACN,SAAS,KAAK,cAA2B,WAAW,GACpD,SAAS,KAEb23D,EAAQ,IAAI,UAAQ33D,EAAQ,CAAC,EAAG,CAC/B,OAAQ,KAAK,IACb,OAAQ,GACR,KAAM,GACN,KAAM,GACN,aAAc,GACd,UAAW,GACX,eAAgB,GAEhB,aAAc,+GACd,WAAY,GACZ,WAAY,GACZ,WAAY,GAEZ,OAAQ,CACP,UAAW,SACX,UAAW,CACV,gBAAiB,CAChB,kBAAmBA,CACpB,EACA,KAAM,CACL,SAAU,CAAC,SAAU,MAAO,OAAQ,OAAO,CAC5C,CACD,CACD,EAEA,QAAS,MAAOid,EAAGqF,IAAQ,CAC1B,MAAMykB,EAAM,KAAK,QAAQ,KAAK,EAC7B8wB,EAAU,gCAEX,GAAK,CAAE9wB,EACN,MAAM,IAAI,MAAM,oBAAoB,EAErC,KAAM,CAAC,CAAE+d,CAAM,EAAI,MAAM,QAAQ,IAAI,CAAC/d,EAAI,OAAO,EAAG8wB,CAAO,CAAC,EAC5D,OAAA9wB,EAAI,UAAU,kBAAmB+d,EAAO,OAAO,EAE/C8S,EAAK,IAAI7wB,EAAI,IAAI,CAChB,MAAI,iBAAc,KAAK,EACvB,OAAQvpB,GAAKA,EAAE,kBAAmB,CACjC,KAAAoG,EAEA,KAAM,KAAK,QAAQA,EAAK,EAAE,EAC1B,MAAO,KAAK,SAASA,EAAK,EAAE,EAE5B,aAAcA,EAAK,aAAeA,EAAK,MACvC,cAAeA,EAAK,MAEpB,UAAW,IAAMtB,EAAI,OAAO,EAC5B,SAAU5iB,GAAO,KAAK,SAASkkB,EAAK,GAAIlkB,CAAG,EAC3C,YAAa,IAAM,KAAK,YAAYkkB,EAAK,EAAE,EAC3C,QAASlkB,GAAO,KAAK,QAAQkkB,EAAK,GAAIlkB,CAAG,EACzC,WAAY,IAAM,KAAK,WAAWkkB,EAAK,EAAE,EAEzC,MAAO,IAAMtB,EAAI,KAAK,CACvB,CAAC,CACF,CAAC,EAEMs1C,EAAG,GACX,EAEA,OAAQ,MAAO36C,EAAGqF,IAAQ,CACzB,MAAMA,EAAI,WAAW,EACrB,sBAAsB,IAAM,CACtBA,EAAI,QACRo1C,EAAU,IAAI,eAAap1C,EAAI,MAAOoB,CAAO,EAC/C,CAAC,CACF,EAEA,OAAQ,CAACha,EAAQ4Y,EAAKzC,IAAU,CAC/B,KAAK,KAAK,iBAAkBnW,EAAQ4Y,EAAKzC,CAAK,CAC/C,EAEA,QAAS,CAACnW,EAAQ4Y,EAAKzC,IAAU,CAChC,KAAK,KAAK,iBAAkBnW,EAAQ4Y,EAAKzC,CAAK,CAC/C,EAEA,OAAQ6D,CACT,CAAC,EAEDi0C,EAAM,OAAOjuD,CAAM,CACpB,CAGA,iBAAiBjK,EAAa,CACxBA,IAAQ,oBAAsB,KAAK,YACvC,KAAK,WAAW,EACPA,IAAQ,mBAAqB,KAAK,YAC3C,KAAK,UAAU,CACjB,CAEA,IAAI,QAAS,CACZ,OAAO,KAAK,aAAe,KAAK,WAAW,CAC5C,CAEA,IAAI,OAAQ,CACX,OAAO,KAAK,YAAc,KAAK,UAAU,CAC1C,CAEA,YAAa,CACZ,IAAI29B,EACHvX,EAAS,GAEH,KAAK,YAKXuX,EAAW,IAAI,IAAI,OAAO,KAAK,KAAK,WAAW,CAAC,GAJhDvX,EAAS,GACT,KAAK,YAAc,CAAC,EACpBuX,EAAW,IAAI,KAIhB,MAAMhQ,EAAU,KAAK,SAAS,SAAS,IAAI,kBAAkB,EAC7D,GAAKA,EACJ,SAAU,CAAC3tB,EAAKC,CAAG,IAAK,OAAO,QAAQ0tB,CAAO,EAC7CgQ,EAAS,OAAO39B,CAAG,EACd,KAAK,YAAYA,CAAG,IAAMC,IAC9B,KAAK,YAAYD,CAAG,EAAIC,EACnBmmB,GACJ,KAAK,KAAK,WAAYpmB,EAAK,QAASC,CAAG,GAI3C,UAAUD,KAAO29B,EAChB,KAAK,YAAY39B,CAAG,EAAI,OACnBomB,GACJ,KAAK,KAAK,WAAYpmB,EAAK,QAAS,MAAS,EAG/C,OAAO,KAAK,WACb,CAEA,WAAY,CACX,IAAI29B,EACHvX,EAAS,GACH,KAAK,WAKXuX,EAAW,IAAI,IAAI,OAAO,KAAK,KAAK,UAAU,CAAC,GAJ/CvX,EAAS,GACT,KAAK,WAAa,CAAC,EACnBuX,EAAW,IAAI,KAIhB,MAAMhQ,EAAU,KAAK,SAAS,SAAS,IAAI,iBAAiB,EAC5D,GAAKA,EACJ,SAAU,CAAC3tB,EAAKC,CAAG,IAAK,OAAO,QAAQ0tB,CAAO,EAC7CgQ,EAAS,OAAO39B,CAAG,EACd,KAAK,WAAWA,CAAG,IAAMC,IAC7B,KAAK,WAAWD,CAAG,EAAIC,EAClBmmB,GACJ,KAAK,KAAK,WAAYpmB,EAAK,OAAQC,CAAG,GAI1C,UAAUD,KAAO29B,EAChB,KAAK,WAAW39B,CAAG,EAAI,OAClBomB,GACJ,KAAK,KAAK,WAAYpmB,EAAK,OAAQ,MAAS,EAG9C,OAAO,KAAK,UACb,CAEA,SAAS4B,EAA2B,CACnC,OAAO,KAAK,OAAOA,CAAE,GAAK,IAC3B,CAEA,QAAQA,EAAY,CACnB,OAAO,KAAK,MAAMA,CAAE,GAAK,IAC1B,CAEA,SAASA,EAAYmjB,EAAgB,CAC/B,KAAK,OAAOnjB,CAAE,IAAMmjB,IACxB,KAAK,OAAOnjB,CAAE,EAAImjB,EAClB,KAAK,SAAS,SAAS,IAAI,mBAAoB,KAAK,MAAM,EAC1D,KAAK,KAAK,WAAYnjB,EAAI,QAASmjB,CAAK,EAE1C,CAEA,QAAQnjB,EAAYJ,EAAe,CAC7B,KAAK,MAAMI,CAAE,IAAMJ,IACvB,KAAK,MAAMI,CAAE,EAAIJ,EACjB,KAAK,SAAS,SAAS,IAAI,kBAAmB,KAAK,KAAK,EACxD,KAAK,KAAK,WAAYI,EAAI,OAAQJ,CAAI,EAExC,CAEA,YAAYI,EAAY,CACvB,KAAK,SAASA,EAAI,MAAS,CAC5B,CAEA,WAAWA,EAAY,CACtB,KAAK,QAAQA,EAAI,MAAS,CAC3B,CACD,EA9PgE,iBAAjD,IAAMy2D,EAAN,C,gECpBA,MAAM,EAAN,MAAM,CAAK,CAiBzB,YAAYn7B,EAAezZ,EAAmB7hB,EAAmB0zB,EAAsB,CAVvF,eAAqB,GAGrB,YAAwB,KAQvB,KAAK,QAAU4H,EACf,KAAK,KAAOzZ,EAEZ,KAAK,WAAa,KAClB,KAAK,OAAS,KAEd,KAAK,IAAM7hB,EACX,KAAK,MAAQ0zB,EAER1zB,KACH6hB,GAAQyZ,GAAS,SAASt7B,CAAE,EAAI,KACnC,CAEA,SAAU,CAGT,GAFA,KAAK,UAAY,GAEZ,KAAK,WAAa,CACtB,UAAUiwB,KAAU,KAAK,WAAW,OACnC,KAAK,QAAQ,OAAO,SAASA,CAAM,EAEpC,KAAK,WAAa,IACnB,CAGK,KAAK,SACT,KAAK,OAAS,MAEf,MAAMtxB,EAAS,KAAK,MAAQ,KAAK,QAE5BA,IACC,KAAK,QAAUA,EAAO,OAASA,EAAO,MAAM,KAAK,MAAM,IAAM,OACjEA,EAAO,MAAM,KAAK,MAAM,EAAI,MAExBA,EAAO,UAAYA,EAAO,SAAS,KAAK,GAAG,IAAM,OACrDA,EAAO,SAAS,KAAK,GAAG,EAAI,MAE/B,CAEA,MAAMqpB,EAAa,CAIlB,GAHK,CAAE,KAAK,OAASA,EAAM,QAC1B,KAAK,MAAQA,EAAM,OAEfA,EAAM,WACV,SAAU,CAACgI,EAAUoB,CAAI,IAAKpJ,EAAM,WAAW,eAAe,EAC7D,UAAUiI,KAAUmB,EACnB,KAAK,OAAOpB,EAAUC,CAAM,EAG/B,GAAKjI,EAAM,OACV,SAAU,CAACgI,EAAUtF,CAAM,IAAK1C,EAAM,OAAO,eAAe,EAC3D,UAAUlB,KAAS4D,EAClB,KAAK,SAASsF,EAAUlJ,EAAM,GAAIA,CAAK,CAE3C,CAEA,aAAa5F,EAAkB,CAE9B,MAAO,EACR,CAEA,IAAI,IAAK,CACR,OAAO,KAAK,GACb,CAEA,IAAI,OAAQ,CACX,OAAO,KAAK,MACb,CAEA,IAAI,MAAM7iB,EAAK,CACd,GAAK,KAAK,SAAWA,EACpB,OAED,MAAM+Z,EAAM,KAAK,MAAQ,KAAK,QAS9B,GAPK,KAAK,QACQA,EAAI,MAAM,KAAK,MAAM,IACpB,OACjBA,EAAI,MAAM,KAAK,MAAM,EAAI,MAG3B,KAAK,OAAS/Z,EACT,CAAEA,EACN,OAED,MAAMq4D,EAAWt+C,EAAI,MAAM/Z,CAAG,EACzBq4D,GAAYA,IAAa,OAC7BA,EAAS,MAAQ,MAGlB,KAAK,OAASr4D,EACd+Z,EAAI,MAAM/Z,CAAG,EAAI,IAClB,CAOA,SAAS2xB,EAAkB5G,EAAkBpX,EAAwB,CACpE,GAAK,KAAK,UACT,MAAO,GAEH,OAAOoX,GAAa,WACxBA,EAAW,GAAGA,CAAQ,IAElBpX,EACJA,EAAK,GAAKoX,EAEVpX,EAAO,CAAC,GAAIoX,CAAQ,EAEd,KAAK,SACX,KAAK,OAAS,IAAI,aAAW,GAAO,KAAK,QAAQ,OAAO,YAAY,GAErE,MAAM3lB,EAAW,KAAK,OAAO,IAAIusB,CAAQ,EACzC,GAAKvsB,GACJ,UAAUkzD,KAASlzD,EAClB,GAAKkzD,EAAM,IAAMvtC,EAChB,cAAO,OAAOutC,EAAO3kD,CAAI,EAClB,GAGV,YAAK,OAAO,KAAKge,EAAUhe,CAAI,EAExB,EACR,CAGA,WAAY,CACX,OAAK,KAAK,OACF,CAAC,GAAG,KAAK,OAAO,MAAM,EACvB,CAAC,CACT,CAGA,SAASoX,EAAkB,CAC1B,GAAK,KAAK,QACT,UAAUtC,KAAS,KAAK,OAAO,OAC9B,GAAKA,EAAM,IAAMsC,EAChB,OAAOtC,EAEV,OAAO,IACR,CAGA,YAAYkJ,EAAkB5G,EAAkB,CAC/C,GAAK,CAAE,KAAK,OACX,MAAO,GAER,MAAM3lB,EAAW,KAAK,OAAO,IAAIusB,CAAQ,EACzC,GAAKvsB,GACJ,UAAUkzD,KAASlzD,EAClB,GAAKkzD,EAAM,IAAMvtC,EAChB,YAAK,OAAO,OAAO4G,EAAU2mC,CAAK,EAE3B,GAGV,MAAO,EACR,CAGA,gBAAgB3mC,EAAkB,CAIjC,MAHK,CAAE,KAAK,QAGP,CAAE,KAAK,OAAO,IAAIA,CAAQ,EACvB,IAGR,KAAK,OAAO,OAAOA,CAAQ,EACpB,GACR,CAOA,OAAOA,EAAkBC,EAAgBje,EAAgB,CACxD,GAAK,KAAK,UACT,OAEM,KAAK,aACX,KAAK,WAAa,IAAI,cAElB,OAAOie,GAAW,WACtBA,EAAS,GAAGA,CAAM,IAEnB,IAAIzO,EAAU,GAAOnD,EAAQ,GAC7B,OAAO,KAAK,WAAW,eAAe2R,EAAUC,CAAM,IACrDzO,EAAU,CAAE,KAAK,WAAW,SAASyO,CAAM,EAC3C,KAAK,WAAW,KAAKD,EAAUC,CAAM,EACrC5R,EAAQ,IAGJrM,GACJ,KAAK,QAAQ,OAAO,YAAYie,EAAQje,CAAI,EAExCwP,IACJ,KAAK,QAAQ,OAAO,OAAOyO,CAAM,EACjC,KAAK,QAAQ,OAAO,KAAK,oBAAqB,KAAMD,EAAUC,EAAQ,EAAI,GAGpE5R,CACR,CAEA,cAAc2R,EAAkB,CAC/B,GAAK,CAAE,KAAK,WACX,MAAO,GAER,MAAMoB,EAAO,KAAK,WAAW,IAAIpB,CAAQ,EACzC,GAAK,CAAE,MAAM,QAAQoB,CAAI,GAAK,CAAEA,EAAK,OACpC,MAAO,GAER,UAAUnB,KAAUmB,EACnB,KAAK,UAAUpB,EAAUC,CAAM,EAEhC,MAAO,EACR,CAEA,UAAUD,EAAkBC,EAAgB,CAC3C,GAAO,KAAK,WAMZ,OAHK,OAAOA,GAAW,WACtBA,EAAS,GAAGA,CAAM,IAEd,KAAK,WAAW,eAAeD,EAAUC,CAAM,GACnD,KAAK,WAAW,OAAOD,EAAUC,CAAM,EAChC,KAAK,WAAW,SAASA,CAAM,IACrC,KAAK,QAAQ,OAAO,SAASA,CAAM,EACnC,KAAK,QAAQ,OAAO,KAAK,oBAAqB,KAAMD,EAAUC,EAAQ,EAAK,GAErE,IAGD,EACR,CACD,EAhQ0B,YAAX,IAAM6K,EAAN,C,mICSf,MAAMZ,EAAW,sEAmMI,EAAN,MAAM,UAAiB,SAAO,CAU5C,YAAYt6B,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EANnB,cAA4B,KAC5B,UAA2B,KAC3B,cAA4B,KAM3B,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EAEtB,KAAK,cAAgB,GACrB,KAAK,YAAc,CAAC,EAEpB,KAAK,SAAS,IAAI,yBAA0B,CAC3C,QAAS,GAET,GAAI,CACH,KAAM,8BACN,MAAO,mDACP,YAAa,6IACb,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,eAAe,eAAe,CACnD,CAAC,EAED,KAAK,SAAS,IAAI,wBAAyB,CAC1C,QAAS,GAET,GAAI,CACH,KAAM,+BACN,MAAO,sBACP,YAAa,uFACb,UAAW,oBAEX,cAAe,IAAO,CACrB,UACA,SACD,CACD,EAEA,QAAS,IAAM,KAAK,eAAe,cAAc,CAClD,CAAC,EAED,KAAK,SAAS,IAAI,gCAAiC,CAClD,QAAS,EAET,GAAI,CACH,KAAM,+BACN,MAAO,uBACP,YAAa,0KAEb,UAAW,mBACX,QAAS,WACT,OAAQ,CAAC,EAAG,EAAI,CACjB,CACD,CAAC,EAED,KAAK,SAAS,IAAI,kBAAmB,CACpC,QAAS,EAET,GAAI,CACH,KAAM,+BACN,MAAO,gBAEP,UAAW,qBAEX,KAAM,CACL,CAAC,MAAO,EAAG,MAAO,UAAU,EAC5B,CAAC,MAAO,EAAG,MAAO,SAAS,EAC3B,CAAC,MAAO,EAAG,MAAO,wBAAwB,CAC3C,CACD,EAEA,QAAS,IAAM,KAAK,eAAe,QAAQ,CAC5C,CAAC,EAED,KAAK,SAAS,IAAI,mBAAoB,CACrC,QAAS,GAET,GAAI,CACH,KAAM,+BACN,MAAO,2BACP,YAAa,yFAEb,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,eAAe,SAAS,CAC7C,CAAC,EAGD,KAAK,OAAO,UAAW,CAEtB,SAAU,CAAE,OAAO,KAAK,SAAS,IAAI,kBAAkB,CAAE,EAEzD,MAAMqT,EAAM,CACX,MAAO,CACN,KAAMA,EAAK,SAAS,MAAQA,EAAK,SAAS,YAAc,KACxD,MAAOA,EAAK,eAAe,CAC5B,CACD,EAEA,MAAO,EACP,KAAM,gBAEN,MAAMA,EAAM,CACX,MAAK,CAAE,KAAK,SAAS,IAAI,kBAAkB,GAAK,CAAEA,EAAK,KAC/C,KAED,KAAK,KAAK,aAAaA,EAAK,KAAK,CACzC,EAEA,SAAU,CACT,OAAO,KAAK,KAAK,EAAE,mBAAoB,cAAc,CACtD,EAEA,MAAO,wBAER,CAAC,EAGD,KAAK,OAAO,SAAU,CACrB,QAAS,GACT,SAAU,GACV,OAAQ,GAER,SAAU,CAAE,OAAO,KAAK,SAAS,IAAI,iBAAiB,EAAI,CAAE,EAE5D,MAAMA,EAAM,CACX,IAAI07B,EAAU17B,GAAM,SAAS,WAC7B,GAAK,CAAE07B,EACL,OAAO,KAEFA,aAAmB,OACzBA,EAAU,IAAI,KAAKA,CAAO,GAE3B,MAAMkpB,EAAS,KAAK,QAAQ,QAAQ,EAC9B/4C,EAAM,KAAK,IAAI,GAAK+4C,GAAQ,aAAe,GAEjD,MAAO,CACN,QAAAlpB,EACA,OAAQA,EAAU,KAAK,OAAO7vB,EAAM6vB,EAAQ,QAAQ,GAAK,GAAI,EAAI,GACjE,eAAgB17B,EAAK,cACtB,CACD,EAEA,MAAO,EACP,KAAM,cAEN,MAAMA,EAAM,CACX,MAAM8d,EAAU,KAAK,SAAS,IAAI,iBAAiB,EACnD,MAAK,CAAEA,GAAW,CAAE9d,GAAM,QAClB,QAED,sBAAmBA,EAAK,OAAQ,GAAO,GAAO,GAAO8d,IAAY,CAAC,CAC1E,EAEA,QAAQ9d,EAAM,CACb,OAAOA,GAAM,QAGN,CACN,KAAK,KAAK,EACT,0BACA,eACD,KACA,iBAAC,OAAI,MAAM,cACT,KAAK,KAAK,EACV,wBACA,2BACA,CAAC,MAAOA,EAAK,OAAO,CACrB,CACD,CACD,EAdQ,IAeT,EAEA,MAAM,MAAMA,EAAMiP,EAAK,CACtB,GAAK,CAAEjP,EACN,OAED,KAAM,CAAC6kD,EAAYC,CAAY,EAAI,MAAM,QAAQ,IAAI,CAGpD,WAAW,aAAa,QAAQ,CAAC,KAAM,iBAAmC,CAAC,EAAE,KAAKC,GAAQA,GAAM,KAAK,EAAE,MAAM,IAAM,IAAI,EACvH/kD,EAAK,eAAe,GAAG,MAAMkN,GAAO,IAAI,CACzC,CAAC,EACD,GAAK,CAAE43C,EACN,SAAQ,iBAAC,WACN,KAAK,KAAK,EAAE,wBAAyB,sEAAuE,CAC/G,EAED,MAAMh6C,EAAM,gCAAgCg6C,CAAY,GAAG9kD,EAAK,OAAS,EAAI,SAAM,kBAAeA,EAAK,MAAM,CAAC,GAAK,EAAE,GACpHglD,EAAWH,IAAe,WAAaA,IAAe,SAEjDI,EAAOD,EAAYx4C,IACxB,UAAU,UAAU,UAAU1B,CAAG,EACjC0B,EAAM,eAAe,EACd,IACJ,KAEJ,OAAAyC,EAAI,SAAS,UAAU,IAAI,iBAAiB,KAEpC,iBAAC,cACR,iBAAC,OAAI,MAAM,+CACR,KAAK,KAAK,EAAE,0BAA2B,iBAAkB,CAC1D,QAAM,sBAAmBjP,EAAK,OAAQ,GAAO,GAAO,GAAO,EAAK,CACjE,CAAC,CACF,KACA,iBAAC,OAAI,MAAM,oCACV,iBAAC,SACA,MAAM,sFACN,KAAK,OACL,MAAO8K,EACP,QAAUpB,GAAmBA,EAAE,QAA6B,OAAO,EACpE,EACCs7C,MAAY,iBAAC,OAAI,MAAM,sDACvB,iBAAC,UACA,MAAM,kUACN,aAAa,KAAK,KAAK,EAAE,uBAAwB,mBAAmB,EACpE,QAASC,CAAA,KAET,iBAAC,OAAI,MAAM,mDACV,iBAAC,QAAK,MAAM,2BACX,iBAAC,UAAO,MAAM,YAAa,EAC5B,CACD,CACD,KACA,iBAAC,OAAI,MAAM,iEACR,KAAK,KAAK,EAAE,uBAAwB,mBAAmB,CAC1D,CACD,CACD,CACD,CACD,CACD,CAAC,EAED,KAAK,OAAO,gBAAiB,CAC5B,OAAQ,GACR,QAAS,GAET,MAAMjlD,EAAM,CACX,GAAK,CAAE,KAAK,SAAS,IAAI,wBAAwB,EAChD,OAGD,MAAMq/C,EAAS,KAAK,QAAQ,aAAa,EACxChnB,EAASgnB,EAAO,QACjB,GAAK,CAAEhnB,EACN,OAED,MAAM6sB,EAAO7sB,EAAO,kBAAoBA,EAAO,MAAM,iBACpDvR,EAAMo+B,GAAM,OAAO,IAEpB,GAAK,CAAEp+B,GAAO,CAAEoB,EAAS,KAAKpB,CAAG,EAChC,OASD,GAPK,KAAK,SAAS,IAAI,8BAA8B,GAIvC,KAAK,QAAQ,MAAM,EAAU,UAAU,GACpC,IAAM9mB,EAAK,QAAQ,IAEpBA,EAAK,qBAAqBA,EAAK,OAAO,GAAG,SACxD,OAAO8mB,CACT,EAEA,MAAMA,EAAK,CACV,GAAKA,EACJ,OAAO,KAAK,KAAK,EAAE,yBAA0B,UAAU,CACzD,EAEA,KAAM,iBAEN,MAAMA,EAAK,CAEV,MAAMl5B,GADQ,KAAK,SAAS,IAAI,eAAe,GAAK,YACjC,QAAQ,gBAAiB,GAAG,EAAI,OAE7ColC,KAAO,iBAAc,IAAK,CAC/B,OAAQ,SACR,SAAUplC,EACV,KAAMk5B,EACN,MAAO,CACN,QAAS,MACV,CACD,CAAC,EAED,SAAS,KAAK,YAAYkM,CAAI,EAC9BA,EAAK,MAAM,EACXA,EAAK,OAAO,CACb,CACD,CAAC,EAED,KAAK,OAAO,eAAgB,CAC3B,OAAQ,GACR,QAAS,GACT,QAAS,GACT,OAAQ,GAER,SAAU,CACT,OAAO,KAAK,SAAS,IAAI,uBAAuB,CACjD,EAEA,MAAMhzB,EAAM,CACX,MAAMq/C,EAAS,KAAK,QAAQ,aAAa,EACxCuF,EAAS,KAAK,QAAQ,QAAQ,EAC9BvsB,EAASgnB,EAAO,QAEjB,IAAI8F,EAEJ,GAAK,CAAE9sB,EACN8sB,EAAQ,aAEC,OAAO9sB,EAAO,kBAAqB,WAC5C8sB,EAAQ9sB,EAAO,iBAAiB,UAErB,OAAOA,EAAO,cAAiB,WAAa,CACvD,MAAMvU,EAAOuU,EAAO,aAAa,EACjC8sB,EAAQ,CACP,kBAAgB,cAAW9sB,EAAO,WAAYA,CAAM,EACpD,WAAYvU,EAAK,kBACjB,kBAAmB,GAAGA,EAAK,iBAAiB,IAAIA,EAAK,kBAAkB,GACvE,IAAKA,EAAK,YACV,sBAAuBA,EAAK,wBAA0B,IACtD,kBAAmBA,EAAK,oBAAsB,IAC9C,YAAa,GAAGA,EAAK,iBAAiB,MACtC,QAAM,cAAWuU,EAAO,gBAAiBA,CAAM,GAAK,EACpD,aAAcvU,EAAK,gBACnB,cAAeA,EAAK,eACpB,gBAAiB,GAAGA,EAAK,SAAS,IAAIA,EAAK,UAAU,EACtD,CACD,KAAO,CACN,MAAMshC,KAAc,cAAW/sB,EAAO,eAAgBA,CAAM,GAAK,EAChEgtB,KAAa,cAAWhtB,EAAO,cAAeA,CAAM,GAAK,EACzDitB,KAAgB,cAAWjtB,EAAO,iBAAkBA,CAAM,GAAK,EAC/DktB,KAAe,cAAWltB,EAAO,gBAAiBA,CAAM,GAAK,EAE9D8sB,EAAQ,CACP,kBAAgB,cAAW9sB,EAAO,WAAYA,CAAM,EACpD,cAAY,cAAWA,EAAO,kBAAmBA,CAAM,EACvD,kBAAmB,GAAGktB,CAAY,IAAID,CAAa,GACnD,gBAAiB,GAAGD,CAAU,IAAID,CAAW,GAC7C,YAAAA,EACA,WAAAC,EACA,cAAAC,EACA,aAAAC,EACA,QAAM,cAAWltB,EAAO,gBAAiBA,CAAM,EAC/C,IAAK,KAAK,SAAM,cAAWA,EAAO,kBAAmBA,CAAM,GAAK,CAAC,EACjE,yBAAuB,cAAWA,EAAO,eAAgBA,CAAM,GAAK,EAGpE,aAAc,KAAK,UAAO,cAAWA,EAAO,gBAAiBA,CAAM,GAAK,GAAK,GAAI,EACjF,iBAAe,cAAWA,EAAO,iBAAkBA,CAAM,CAC1D,CACD,CAGA,GAAK8sB,EAAQ,CACZ,MAAM/7B,EAAQiP,MAAU,cAAWA,EAAO,oBAAqBA,CAAM,EACrE8sB,EAAM,SAAW,EACZ/7B,GAAO,eACX+7B,EAAM,UAAY/7B,EAAM,qBAAuB,GAAKA,EAAM,aAAa,YAAcA,EAAM,YAC7F,CAEA,IAAIo8B,EAAW,GACf,GAAI,CACH,MAAM16C,EAAMutB,EAAO,KAAK,MAAM,KAC9B,GAAKvtB,EAAI,SAAS,mBAAmB,EAAI,CACxC,MAAM9K,EAAO,KAAK,MAAM,IAAI,IAAI8K,CAAG,EAAE,aAAa,IAAI,OAAO,CAAW,EACxE06C,EAAWxlD,GAAQA,EAAK,aAAeA,EAAK,cAAgB,OAASA,EAAK,YAAc,EACzF,CACD,MAAa,CAAc,CAE3B,GAAK,CAAEmlD,GAASA,EAAM,sBAAwB,KAC7C,OAAO,KAER,IAAIM,EAAQ,EAEZ,OAAKb,GAAUA,EAAO,YACrBa,EAAQb,EAAO,aAET,CACN,UAAW5kD,EAAK,UAChB,MAAAmlD,EACA,MAAAM,EACA,KAAMN,EAAM,MAAQ,KAAO,EAAIA,EAAM,KACrC,MAAOA,EAAM,sBACb,IAAKA,EAAM,sBAAwB,IACnC,SAAAK,CACD,CACD,EAEA,MAAO,EAEP,KAAKxlD,EAAM,CACV,OAAKA,GAAM,KAAO,EACV,gBAED,aACR,EAEA,MAAMA,EAAM,CAIX,GAHK,CAAE,KAAK,SAAS,IAAI,uBAAuB,GAAK,CAAEA,GAAM,OAGxDA,EAAK,IACT,OAAO,KAER,MAAM0lD,EAAU1lD,EAAK,MAAQ,IAAO,OAAS,GAE7C,OAAKA,EAAK,IACF,GAAG0lD,CAAO,GAAG1lD,EAAK,MAAM,QAAQ,CAAC,CAAC,QAElC,GAAG0lD,CAAO,GAAG1lD,EAAK,MAAM,QAAQ,CAAC,CAAC,GAC3C,EAEA,OAAQ,CACP,MAAMq/C,EAAS,KAAK,QAAQ,aAAa,EACxC/tC,EAAO,KAAK,QAAQ,WAAW,EAC/B+mB,EAASgnB,EAAO,QAAQ,MACxB1nB,EAAOrmB,GAAQ+mB,GAAU/mB,EAAK,WAAW+mB,EAAS1uB,GAAWA,EAAE,OAAO,gBAAiB,GAAG,EAC1FwuB,EAAOR,GAAQrmB,EAAK,aAAa+mB,CAAM,EACvCxF,EAAKsF,GAAQA,EAAK,cAAc,8CAA8C,EAExER,GAGPA,EAAK,MAAM,gBAAgB9E,EAAK,EAAI,CAAC,CACtC,EAYA,MAAM7yB,EAAM,CACX,MAAM8d,EAAU,KAAK,SAAS,IAAI,+BAA+B,EACjE,GAAK,EAAAA,IAAY,GAAK,CAAE9d,GAAM,OAASA,EAAK,KAG5C,IAAKA,EAAK,MAAS8d,EAAU,EAC5B,OAAO9d,EAAK,UAAY,UAAY,aAE3BA,EAAK,MAAQ8d,EACtB,OAAO9d,EAAK,UAAY,UAAY,UACtC,EAEA,QAAQA,EAAM,CACb,GAAK,CAAEA,EACN,OAAO,KAER,MAAMwlD,EAAWxlD,EAAK,YAAY,iBAAC,OAAI,MAAM,qCAC3C,KAAK,KAAK,EACV,iCACA,gGACA,CACC,KAAMA,EAAK,QACZ,CACD,CACD,EAAU,KAEJ0lD,EAAU1lD,EAAK,MAAQ,OAAQ,iBAAC,OAAI,MAAM,qCAC9C,KAAK,KAAK,EACV,sCACA,wGACA,KAAK,MAAMA,EAAK,MAAQ,EAAE,EAAI,GAC/B,CACD,EAAU,KAEJ2lD,EAAK3lD,EAAK,KAAO,KAAK,iBAAC,OAAI,MAAM,qCACrC,KAAK,KAAK,EACV,qCACA,mDACA,CAAC,KAAMA,EAAK,KAAK,QAAQ,CAAC,CAAC,CAC5B,CACD,EAAU,KAEV,GAAK,CAAEA,EAAK,OAAS,CAAEA,EAAK,MAC3B,MAAO,CACN0lD,EACAC,EACA,KAAK,KAAK,EAAE,oCAAqC,gBAAgB,EACjEH,CACD,EAED,MAAML,EAAQnlD,EAAK,MAClB4lD,EAAa,KAAK,KAAK,EACtB,mCACA;AAAA;AAAA,yCACAT,CACD,EAEKU,EAMA,KAEA5O,EAASkO,EAAM,WAAa,KAC7B,iBAAC,WAAK,KAAK,KAAK,EAClB,iCACA,+BACA,CACC,SAAUA,EAAM,WAAW,QAAQ,CAAC,CACrC,CACD,CAAE,EACA,KAEJ,OAAKnlD,EAAK,IACF,CACN0lD,EACA,KAAK,KAAK,EACT,kCACA,mBACD,KACA,iBAAC,OAAI,MAAM,cACT,KAAK,KAAK,EACV,sCACA,gCACA1lD,EAAK,KACN,CACD,KACA,iBAAC,OAAI,MAAM,cACT4lD,CACF,EACAC,EACA5O,EACAuO,CACD,EAEM,CACNE,EAASC,EACT,KAAK,KAAK,EACT,oCACA,gBACD,KACA,iBAAC,OAAI,MAAM,cACTC,CACF,EACAC,EACA5O,EACAuO,CACD,CACD,CACD,CAAC,CACF,CAGA,cAAct2C,EAAkBG,EAAkBnjB,EAAuB,CACxE,GAAK,CAAEgjB,EACN,OAAO,KAER,MAAMzI,EAAiC,CAAC,EACvC8I,EAAS,SAASF,GAAO,IAE1B,OAAA5I,EAAU,OAAS,CAASra,EAAa+jB,KACnCA,IACJA,EAAW,SAAWjB,GAEhB,KAAK,OAAO9iB,EAAK+jB,CAAU,MAG5B,mBAAgBjkB,EAAQ,KAAM,WAAYua,CAAS,CAC3D,CAIA,UAAW,CACV,MAAM03C,EAAW,KAAK,SAAS,MAAc,SAAY9nD,GAAwB,CAChF,IAAIw8B,EAAyBx8B,EAQ7B,GAPKw8B,EAAG,UACPA,EAAKA,EAAG,UACGA,EAAG,UAAU,SAAS,UAAU,IAC3CA,EAAKx8B,EAAO,QAAQ,WAAW,EAC/BA,EAAO,UAAYw8B,GAGf,CAAEA,EACN,OAED,MAAMzmC,EAAMymC,EAAG,QAAQ,IACtBzjB,EAAMhjB,GAAK,OAAS,KAAK,YAAYA,CAAG,EAAI,KAE7C,SAAO,cAAWgjB,GAAK,QAAS,KAAMyjB,EAAG,SAAS,CACnD,EAEAsrB,EAAG,OAAS,CAAC9nD,EAAqB4Y,IAAyB,CAC1D,MAAM4jB,EAAKx8B,EAAO,WAAaA,EAC/Bw8B,EAAG,IAAM5jB,CACV,EAEAkvC,EAAG,OAAU9nD,GAAwB,CACpC,MAAMw8B,EAAKx8B,EAAO,WAAaA,EAC/Bw8B,EAAG,IAAM,KACTA,EAAG,YAAc,IAClB,EAEAsrB,EAAG,aAAe,CAAC9nD,EAAqB4Y,EAAsBriB,KAC7DA,EAAK,UAAY,SACjBA,EAAK,UAAU,KAAO,CAAC,SAAU,CAAC,SAAS,KAAK,CAAC,EAC1CA,GAGR,KAAK,GAAG,qBAAsBsiB,GAAY,CACzC,MAAMC,EAAU,IAAI,IACpB,SAAU,CAAC/iB,EAAKgjB,CAAG,IAAK,OAAO,QAAQ,KAAK,WAAW,EACjDA,GAAK,WAAaF,IACtBC,EAAQ,IAAI/iB,CAAG,EACf,KAAK,YAAYA,CAAG,EAAI,QAIrB+iB,EAAQ,OACZ,KAAK,IAAI,MAAM,cAAcA,EAAQ,IAAI,iCAAkCD,CAAQ,EACnF,KAAK,eAAe,CAAC,GAAGC,CAAO,CAAC,EAElC,CAAC,CACF,CAMA,IAAI,MAAO,CACV,OAAO,OAAO,KAAK,KAAK,WAAW,CACpC,CAuBA,OAAc/iB,EAAa+jB,EAA+C,CACzE,KAAK,YAAY/jB,CAAG,EAAI+jB,EACxB,KAAK,eAAe/jB,CAAG,CACxB,CAQA,eAAeiZ,EAA0B,CAGxC,MAAMud,EAAU,KAAK,QAAQ,cAAc,EAC3C,GAAKA,EACJ,UAAUiQ,KAAMjQ,EAAQ,QAAQ,UAC/BA,EAAQ,eAAeiQ,EAAIxtB,CAAI,EAEjC,MAAMgzB,EAAS,KAAK,QAAQ,aAAa,EACzC,GAAKA,EACJ,UAAUV,KAAQU,EAAO,OAAO,UAC/BA,EAAO,eAAeV,EAAMtyB,CAAI,CACnC,CAYA,MAAM,aACLjZ,EACA4T,EACAsX,EACAkkB,EACAC,EACC,CACID,EAAOpvC,CAAG,GACd,aAAaovC,EAAOpvC,CAAG,CAAC,EAEzB,IAAIymC,EAAKvb,EAAU,cAA2B,uBAAuBlrB,CAAG,IAAI,EAE5E,MAAMgjB,EAAM,KAAK,YAAYhjB,CAAG,EAC/BikB,EAAU,MAAM,CACVwiB,IAOCA,EAAG,cACPA,EAAG,aAAa,EAEjBA,EAAG,aAA4C,KAC/CA,EAAG,OAAO,EAEZ,EAdU,WAgBX,GAAK,CAAEzjB,EACN,OAAOiB,EAAQ,EAEhB,GAAI,CACH,MAAMy1C,EAAS,MAAMrqB,EAAWrvC,CAAG,EAApB,UACf4T,EAAO,CACN,GAAGA,EACH,UAAW,GACX,QAAS8lD,CACV,EAGK12C,EAAI,QACRpP,EAAO,MAAMoP,EAAI,MAAM,KAAK,KAAMpP,CAAI,GAGvC,MAAMqnB,KAAU,cAAWjY,EAAI,QAAS,KAAMpP,CAAI,EAC7CqnB,IACJmU,EAAOpvC,CAAG,EAAI,WACb05D,EACA,OAAOz+B,GAAY,SAAWA,EAAU,GACzC,GAIDwL,EAAKvb,EAAU,cAA2B,uBAAuBlrB,CAAG,IAAI,EAExE,IAAIstD,EACHqM,EAAWC,EAEZ,MAAM14C,KAAQ,cAAW8B,EAAI,MAAO,KAAMpP,CAAI,EAE9C,GAAK,CAAEsN,EACN,OAAO+C,EAAQ,EAEhB,MAAMjgB,KAAQ,cAAWgf,EAAI,MAAO,KAAMpP,CAAI,EAC7CmR,KAAQ,cAAW/B,EAAI,MAAO,KAAMpP,CAAI,GAAK,GAE9C,GAAO6yB,EAyLA,CAEN,GADA6mB,EAAO7mB,EAAG,cAAc,gBAAgB,EACnC,CAAE6mB,EACN,OAAOrpC,EAAQ,EAQhB,GANA21C,EAAWnzB,EAAG,QAAQ,MAAQ,GAC9BkzB,EAAYlzB,EAAG,QAAQ,OAAS,GAE3BA,EAAG,aAAeziC,IACtByiC,EAAG,MAAM,MAAQ,GAAGA,EAAG,WAAaziC,CAAK,IAErCyiC,EAAG,IAAM,CACb,MAAM8Q,KAAU,cAAWv0B,EAAI,QAAS,KAAMpP,CAAI,EAC7C6yB,EAAG,cAAgB8Q,IACvB9Q,EAAG,YAAc8Q,EACZ9Q,EAAG,KAAK,UACZA,EAAG,IAAI,QAAQ,UAAY,MAC3B,eAAYA,EAAG,IAAI,QAAS8Q,CAAO,GAGtC,CACD,KA9MY,CACX,IAAI/wB,EAAOozC,KAAW,cAAW52C,EAAI,KAAM,KAAMpP,CAAI,EACjD4gC,EAAS,GAEb,GAAKxxB,EAAI,SAAW,KAAUA,EAAI,OAASA,EAAI,OAAS,CACvDwxB,EAAS,GAET,IAAI7uB,EACHuyC,EAED,MAAM2B,KAAS,cAAW72C,EAAI,OAAQ,KAAMpP,CAAI,EAC/CkmD,KAAU,cAAW92C,EAAI,QAAS,KAAMpP,CAAI,EAExC,OAAO4S,GAAS,WACpBA,KAAQ,iBAAC,QAAK,MAAM,iBACnB,iBAAC,UAAO,MAAOA,CAAA,CAAM,CACtB,GAEIxD,EAAI,OAASA,EAAI,MACrByjB,KAAM,iBAAC,OACN,MAAO,qHAAqHozB,EAAS,YAAc,yBAAyB,GAC5K,WAAU75D,EAGV,YAAa,MAEZ2lB,KAAO,iBAAC,UACR,MAAO,4KAA4Km0C,EAAU,qBAAuB,gBAAgB,2FAA2FD,EAAS,sCAAwC,2BAA2B,GAAG72C,EAAI,QAAU,qCAAuC,EAAE,GACrc,oBAAkB,eAElB,iBAAC,OAAI,MAAM,4EACTwD,EACA8mC,KAAQ,iBAAC,QAAK,MAAM,eAAgB,EACtC,CACD,EACC4K,KAAS,iBAAC,UACV,MAAO,sJAAsJ4B,EAAU,qBAAuB,gBAAgB,2FAA2FD,EAAS,YAAc,2BAA2B,GAAG72C,EAAI,QAAU,qCAAuC,EAAE,GACrZ,oBAAkB,eAElB,iBAAC,OAAI,MAAM,qEACV,iBAAC,eACA,iBAAC,UAAO,MAAM,gBAAiB,EAChC,CACD,CACD,CACD,EAGA2C,EAAMuyC,EAAQzxB,KAAM,iBAAC,UACpB,MAAO,oOAAoOqzB,EAAU,qBAAuB,gBAAgB,4HAA4HD,EAAS,sBAAwB,mDAAmD,GAAG72C,EAAI,QAAU,qCAAuC,EAAE,GACtiB,oBAAkB,WAClB,WAAUhjB,EAGV,YAAa,SAEb,iBAAC,OAAI,MAAM,kEACTwmB,EACA8mC,KAAQ,iBAAC,QAAK,MAAM,eAAgB,GACpCtqC,EAAI,OAAS,CAAEA,EAAI,aAAY,iBAAC,QAAK,MAAM,iBAC3C,iBAAC,UAAO,MAAM,gBAAiB,EAChC,CACD,CACD,EAEIA,EAAI,OACR2C,EAAI,iBAAiB,QAAUvF,GACzB,CAAEqmB,GAAM,CAAE9gB,GAAOA,EAAI,UAAYA,EAAI,UAAU,SAAS,UAAU,GAAM8gB,EAAW,UAAYA,EAAG,UAAU,SAAS,UAAU,EAC5H,GAEDzjB,EAAI,OAAO,OAAO,KAAMyjB,EAAG,UAAWrmB,EAAO,IAAM,CAAEivB,EAAWrvC,CAAG,CAAG,CAAC,CAC9E,EAEGgjB,EAAI,OACRk1C,EAAM,iBAAiB,QAAS,IAAM,CACrC,GAAK,CAAEzxB,GAAM,CAAEyxB,GAASA,EAAM,UAAYA,EAAM,UAAU,SAAS,UAAU,GAAMzxB,EAAW,UAAYA,EAAG,UAAU,SAAS,UAAU,EACzI,MAAO,GAER,GAAKA,EAAG,YAAcA,EAAG,aACxB,OAAOA,EAAG,aAAa,EAExB,MAAMszB,EAA4B,CAAC,EAClCC,EAAqB,EAACxwC,IAAmB,CACxCuwC,EAAU,KAAKvwC,EAAE,CAClB,EAFqB,sBAIhBvF,EAAUwiB,EAAG,aAAe,IAAM,CACvC,UAAUjd,MAAMuwC,EACf,GAAI,CACHvwC,GAAG,CACJ,OAAQ1I,EAAK,CACPA,aAAe,OACnB,KAAK,IAAI,QAAQA,EAAK,CACrB,KAAM,CACL,SAAU9gB,CACX,CACD,CAAC,EACF,KAAK,IAAI,MAAM,qEAAsEA,EAAK8gB,CAAG,CAC9F,CAMD,GAAK2lB,EAAK,CAIT,GAHKA,EAAG,cACPA,EAAG,aAAa,QAAQ,EAEpBA,EAAG,WAAa,CACpB,MAAMviB,GAAKuiB,EAAG,WACdA,EAAG,WAAa,KAChBviB,GAAG,QAAQ,CACZ,CAEAuiB,EAAG,aAAeA,EAAG,aAAe,IACrC,CACD,EAEMlmC,EAAS,SAAS,mBAAqB,SAAS,KAAK,cAA2B,WAAW,GAAK,SAAS,MACzGkmC,EAAG,WAAa,IAAI,UAAQlmC,EAAuBkmC,EAAI,CAC3D,OAAQ,KAAK,IACb,KAAM,KAAK,KACX,OAAQ,GACR,KAAM,GACN,KAAM,GAEN,aAAc,iHAEd,WAAY,mDACZ,WAAY,mIACZ,WAAY,UAEZ,OAAQ,CACP,UAAW,UACX,UAAW,CACV,gBAAiB,CAChB,kBAAmBlmC,CACpB,EACA,KAAM,CACL,SAAU,CAAC,MAAO,SAAU,OAAQ,OAAO,CAC5C,CACD,CACD,EACA,QAAS,CAACid,GAAGqF,IAAQG,EAAI,OAAO,KAAK,KAAMyjB,GAAI,UAAW5jB,EAAK,IAAMwsB,EAAWrvC,CAAG,EAAGg6D,CAAkB,EACxG,OAAQ,CAACx8C,GAAGqF,IACX,WAAW,IAAM,CACX4jB,GAAM5jB,EAAI,QACd4jB,EAAG,aAAe,IAAI,eAAa5jB,EAAI,MAAOoB,CAAO,EACvD,CAAC,EACF,OAAQA,CACT,CAAC,GAEC,OAAOwiB,CAAE,CACb,CAAC,CAEH,MACM,OAAOjgB,GAAS,WACpBA,KAAQ,iBAAC,QAAK,MAAM,oBAAgB,iBAAC,UAAO,MAAOA,CAAA,CAAM,CAAE,GAE5DigB,KAAM,iBAAC,OACN,MAAO,wGAAwGzjB,EAAI,QAAU,qCAAuC,EAAE,GACtK,oBAAkB,WAClB,WAAUhjB,EACV,YAAa,MAEZwmB,EACA8mC,KAAO,iBAAC,QAAK,MAAO,GAAG9mC,EAAO,cAAgB,EAAE,+BAAgC,CAClF,EAEKxD,EAAI,OACRyjB,EAAG,iBAAiB,QAAUrmB,GAAsB,CACnD,GAAK,CAAEqmB,GAAOA,EAAW,UAAYA,EAAG,UAAU,SAAS,UAAU,EACpE,MAAO,GAERzjB,EAAI,OAAO,OAAO,KAAMyjB,EAAG,UAAWrmB,EAAO,IAAMivB,EAAWrvC,CAAG,CAAC,CACnE,CAAC,EAGHymC,EAAG,WAAaziC,EAEXA,GAAS,OACbyiC,EAAG,MAAM,MAAQ,GAAGziC,CAAK,IAE1BknB,EAAU,YAAYub,CAAE,CAEzB,CAuBA,GAAK,OAAOzjB,EAAI,MAAS,WAAa,CACrC,MAAMwD,KAAO,cAAWxD,EAAI,KAAM,KAAMpP,CAAI,EAC5C,GAAK,OAAO4S,GAAS,UAAYA,IAASozC,EAAW,CACpDnzB,EAAG,QAAQ,KAAOjgB,EAClB,MAAMyzC,EAASxzB,EAAG,cAAc,QAAQ,EACnCwzB,IACJA,EAAO,UAAYzzC,EACrB,CACD,CAEKmzC,IAAc50C,IAClB0hB,EAAG,QAAQ,MAAQ1hB,EACnB0hB,EAAG,MAAM,YAAY,QAAS1hB,EAAO,WAAW,GAGjD0hB,EAAG,UAAY7yB,EACf05C,EAAK,UAAY,MACjB,eAAYA,EAAMpsC,CAAK,EAElB8B,EAAI,WAAa,SACpByjB,EAAW,YAAW,cAAWzjB,EAAI,SAAU,KAAMpP,CAAI,EAE5D,OAAQkN,EAAK,CACZ,OAAKA,aAAe,OACnB,KAAK,IAAI,QAAQA,EAAK,CACrB,KAAM,CACL,SAAU9gB,CACX,CACD,CAAC,EACF,KAAK,IAAI,MAAM,gCAAgCA,CAAG,GAAI8gB,CAAG,EAClDmD,EAAQ,CAChB,CACD,CACD,EA9+B6C,gBAA9B,IAAMi2C,EAAN,C,kICtJA,MAAM,EAAN,MAAM,UAAwB,SAAkC,CAc9E,YAAY14D,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EATnB,UAA2B,KAW1B,KAAK,MAAQ,CAAC,EAEd,KAAK,OAAO,MAAM,EAElB,KAAK,cAAgB,GAErB,KAAK,MAAM,KAAO0J,GAAU,CAC3B,MAAM6V,EAAQ7V,EAAO,QAAQ,MAC7B,MAAO,CACN6V,MAAS,iBAAc,SAAU,KAAMA,CAAK,KAC5C,iBAAc,OAAQ,CACrB,UAAW,QAAQA,EAAQ,4BAA8B,EAAE,GAC3D,MAAO,CACN,WAAY,YACZ,UAAW,MACZ,CACD,EAAG7V,EAAO,QAAQ,IAAI,CACvB,CACD,EAEA,KAAK,MAAM,MAAQA,GAAU,CAC5B,MAAMvC,EAAQuC,EAAO,cAAc,6BAA6B,EAChE,OAAOvC,GAGPuC,EAAO,WAAavC,EACpBA,EAAM,OAAO,EACbA,EAAM,UAAU,OAAO,mBAAmB,EACnCA,GALC,IAMT,EAEA,KAAK,MAAM,MAAM,OAASuC,GAAU,CACnC,MAAMvC,EAAQuC,EAAO,WAChBvC,IACJuC,EAAO,WAAa,KACpBvC,EAAM,OAAO,EAENuC,EAAO,cAAc,6BAA6B,IACxDvC,EAAM,UAAU,IAAI,mBAAmB,EACvCuC,EAAO,YAAYvC,CAAK,GAG3B,EAEA,KAAK,MAAM,SAAW,CAACuC,EAAQ4Y,IAAQ,CACtCA,EAAI,UAAY,wBAEhB,MAAMkvC,KAAK,KAAM,EACjB,OAAOA,EAGAA,EAAG,OAAO9nD,EAAO,QAAQ,KAAK,KAF7B,KAAQ,EAAE,KAAK8nD,GAAMA,EAAG,OAAO9nD,EAAO,QAAQ,KAAK,CAAC,CAG7D,EAEA,KAAK,MAAM,KAAOA,MAAU,YAASA,EAAO,QAAQ,OAAS,EAAE,EAC/D,KAAK,MAAM,KAAOA,GAAUA,EAAO,QAAQ,MAE3C,KAAK,WAAa,KAAK,WAAW,KAAK,IAAI,CAC5C,CAGA,cAAc6Y,EAAkBG,EAAkBnjB,EAAuB,CACxE,GAAK,CAAEgjB,EACN,OAAO,KAER,MAAMzI,EAAiC,CAAC,EACvC8I,EAAS,SAASF,GAAO,IAC1B,IAAIC,EAEJ,OAAA7I,EAAU,OAAS,CAACra,EAAa21C,KAC3BA,IACJA,EAAQ,SAAW7yB,GAEb,KAAK,OAAO9iB,EAAK21C,CAAO,GAG3BxyB,IACJ9I,EAAU,QAAU,KACnBva,EAAO,IAAI,KAAK,8FAA8F,EACvG,KAAK,QAAQ,GAGrBojB,EAAW,CACV,MAAO,8BACR,MAGM,mBACNpjB,EACA,KACA,WACAua,EACA6I,CACD,CACD,CAGA,UAAW,CACV,MAAMgI,EAAY,KAAK,QAAQ,EAE/B,OAAO,iBAAiB,mBAAoB,KAAK,UAAU,EAI3D,KAAK,UAAYA,EACjB,KAAK,YAAcA,EACnB,KAAK,KAAO,KAAK,gBAAgBA,CAAS,EAE1C,KAAK,GAAG,WAAY,KAAK,OAAO,EAEhC,KAAK,GAAG,qBAAsBpI,GAAY,CACzC,IAAIC,EAAU,EACd,SAAU,CAAC/iB,EAAK21C,CAAO,IAAK,OAAO,QAAQ,KAAK,KAAK,EAC/CA,GAAS,WAAa7yB,IAC1BC,IACA,KAAK,MAAM/iB,CAAG,EAAI,QAIf+iB,IACJ,KAAK,IAAI,MAAM,cAAcA,CAAO,iCAAkCD,CAAQ,EAC9E,KAAK,QAAQ,EAEf,CAAC,CACF,CAGA,OAAO9iB,EAAa21C,EAA4B,CAG/C,KAAK,MAAM31C,CAAG,EAAI21C,CACnB,CAGA,SAAU,CACT,OAAO,SAAS,cAA2B,gBAAgB,GAE1D,SAAS,cAAc,OAAO,GAC9B,SAAS,cAAc,aAAa,GACpC,SAAS,IACX,CAEA,gBAAgBzqB,EAAwB0uB,EAAQ,cAAeugB,EAAe,OAAQC,EAA6B,CAClH,OAAO,IAAI,UAAQlvC,EAAW0uB,EAAO,CACpC,KAAM,GACN,KAAM,KAAK,KACX,KAAM,GACN,gBAAiB,GACjB,UAAWwgB,GAAiBlvC,EAE5B,UAAW,KAAK,eAAe,KAAK,KAAMivC,CAAY,EACtD,UAAW,KAAK,eAAe,KAAK,KAAMA,CAAY,EACtD,QAAS,KAAK,QAAQ,KAAK,KAAMA,CAAY,EAC7C,YAAa,KAAK,iBAAiB,KAAK,KAAMA,CAAY,EAC1D,aAAc,KAAK,iBAAiB,KAAK,KAAMA,CAAY,EAE3D,OAAQ,KAAK,eAAe,KAAK,KAAMA,CAAY,EACnD,OAAQ,KAAK,eAAe,KAAK,KAAMA,CAAY,EAEnD,aAAc,KAAK,qBAAqB,KAAK,KAAMA,CAAY,EAC/D,OAAQ,CACP,UAAW,MACX,UAAW,CACV,KAAM,CAAC,CACR,CACD,EAEA,QAAS,CAAClwD,EAAQ4Y,EAAKzC,IAAU,CAChC,KAAK,KAAK,SAAUnW,EAAQ4Y,EAAKzC,CAAK,CACvC,EAEA,QAAS,CAACnW,EAAQ4Y,EAAKzC,IAAU,CAChC,KAAK,KAAK,SAAUnW,EAAQ4Y,EAAKzC,CAAK,CACvC,CACD,CAAC,CACF,CAGA,YAAa,CACL,KAAK,YACX,KAAK,UAAY,KAAK,QAAQ,GAE/B,IAAIi6C,EAAc,KAAK,UAClB,SAAS,6BAA6B,cAC1CA,EAAc,SAAS,mBAEnBA,IAAgB,KAAK,cACzB,KAAK,YAAcA,EACd,KAAK,OACT,KAAK,KAAK,QAAQ,EAClB,KAAK,KAAO,KAAK,gBAAgBA,CAAW,GAG/C,CAGA,SAAU,CACJ,KAAK,MACT,KAAK,KAAK,QAAQ,CACpB,CAGA,qBACCF,EACAlwD,EACA4Y,EACA9iB,EACC,CACD,MAAM8B,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAK1B,OAHKoI,EAAO,QAAQ,cACnBlK,EAAQ,UAAYkK,EAAO,QAAQ,aAE/B0rC,GAAWA,EAAQ,aAChBA,EAAQ,aAAa1rC,EAAQ4Y,EAAK9iB,CAAO,EAE1CA,CACR,CAEA,eACCo6D,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAErB8zC,GAAWA,EAAQ,QACvBA,EAAQ,OAAO1rC,EAAQ4Y,CAAG,CAC5B,CAEA,eACCs3C,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAErB8zC,GAAWA,EAAQ,QACvBA,EAAQ,OAAO1rC,EAAQ4Y,CAAG,CAC5B,CAEA,eACCs3C,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAE1B,OAAK8zC,GAAS,WAAa,QACnB,cAAWA,EAAQ,UAAW,KAAM1rC,EAAQ4Y,CAAG,EAEhD,CACR,CAEA,eACCs3C,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAE1B,OAAK8zC,GAAS,WAAa,QACnB,cAAWA,EAAQ,UAAW,KAAM1rC,EAAQ4Y,CAAG,EAEhD,CACR,CAEA,iBACCs3C,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAE1B,OAAK8zC,GAAS,aAAe,QACrB,cAAWA,EAAQ,YAAa,KAAM1rC,EAAQ4Y,CAAG,EAElD,EACR,CAEA,iBACCs3C,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,EAC1CxkB,EAAU,KAAK,MAAM9zC,CAAI,EAE1B,OAAK8zC,GAAS,cAAgB,QACtB,cAAWA,EAAQ,aAAc,KAAM1rC,EAAQ4Y,CAAG,EAEnD,EACR,CAEA,QACCs3C,EACAlwD,EACA4Y,EACC,CACD,MAAMhhB,EAAOoI,EAAO,QAAQ,aAAekwD,GAAgB,OAC1DG,EAAQrwD,EAAO,QAAQ,aACvB0rC,EAAU,KAAK,MAAM9zC,CAAI,EAK1B,OAHKy4D,IACJz3C,EAAI,MAAQy3C,GAEN3kB,EAYAA,EAAQ1rC,EAAQ4Y,CAAG,EAXlB,IACN,iBAAc,SAAU,KAAM,wBAAwB,KACtD,iBAAc,OAAQ,CACrB,UAAW,oCACX,MAAO,CACN,WAAY,YACZ,UAAW,MACZ,CACD,EAAG,KAAK,UAAU5Y,EAAO,QAAS,KAAM,CAAC,CAAC,CAC3C,CAGF,CACD,EAvV+E,uBAAhE,IAAMswD,EAAN,C,yKCxDR,MAAMC,EAAiC,CAC7C,MAAO,uBACP,KAAM,CACL,WACA,sBACD,CACD,EAEaC,EAAkC,CAC9C,MAAO,gBACP,KAAK7oC,EAAU,CACd,MAAM3Y,EAAO,CAAC,wBAAwB,EACtC,UAAUjZ,KAAO4xB,EAAS,KAAK,EACzB5xB,EAAI,WAAW,gBAAgB,GACnCiZ,EAAK,KAAKjZ,CAAG,EAEf,OAAOiZ,CACR,CACD,EAEayhD,EAAoC,CAChD,MAAO,mBACP,KAAK9oC,EAAU,CACd,MAAM3Y,EAAO,CAAC,EACd,UAAUjZ,KAAO4xB,EAAS,KAAK,EACzB5xB,EAAI,WAAW,kBAAkB,GACrCiZ,EAAK,KAAKjZ,CAAG,EAEf,OAAOiZ,CACR,CACD,EAEao/C,EAA+B,CAC3C,MAAO,2BACP,KAAM,CACL,mBACA,iBACD,CACD,EAEasC,EAA8B,CAC1C,MAAO,WACP,MAAM/oC,EAAU9J,EAAU,CACzB,MAAM7O,EAAO,CAAC,UAAU,EACxB,UAAUjZ,KAAO4xB,EAAS,KAAK,EACzB,UAAU,KAAK5xB,CAAG,GACtBiZ,EAAK,KAAKjZ,CAAG,EAEf,UAAUA,KAAOiZ,EAChB2Y,EAAS,OAAO5xB,CAAG,EAEpB8nB,EAAS,aAAa,CACvB,CACD,EAEa8yC,EAAgC,CAC5C,MAAO,wBACP,MAAM,MAAMhpC,EAAU9J,EAAU,CAC/B8J,EAAS,MAAM,EACVA,EAAS,eAAiBA,aAAoB,MAClD,MAAMA,EAAS,WAAW,EAE3B9J,EAAS,aAAa,CACvB,CACD,C,sFCnDA,SAAS+yC,EACR92C,EACAyrB,EACAsrB,EACC,CACD,GAAK,CAAE/2C,GAAc,CAAE,MAAM,QAAQA,EAAW,QAAQ,EACvD,MAAO,GAER,UAAU/hB,KAAO+hB,EAAW,SAAU,CACrC,MAAMg3C,EAAYD,EAAU,IAAI94D,CAAG,EAClCg5D,EAAYxrB,EAAM,IAAIxtC,CAAG,EAE1B,GAAK,OAAO+4D,GAAc,OAAOC,EAChC,MAAO,GAER,GAAK,MAAM,QAAQD,CAAS,GAAK,MAAM,QAAQC,CAAS,GACvD,GAAK,IAAE,gBAAaA,EAAWD,CAAS,EACvC,MAAO,WAEGC,aAAqB,KAAOD,aAAqB,KAC5D,GAAK,IAAE,cAAWC,EAAWD,CAAS,EACrC,MAAO,WAEEC,aAAqB,KAAOD,aAAqB,KAC3D,GAAK,IAAE,cAAWC,EAAWD,CAAS,EACrC,MAAO,WAEGC,IAAcD,EACzB,MAAO,EACT,CAEA,MAAO,EACR,CAhCS,EAAAF,EAAA,wBAqDM,MAAM,EAAN,MAAM,UAAwB,cAAoC,CAmBhF,YAAY39B,EAA4C58B,EAAuB,CAC9E,MAAM,EAXP,KAAQ,UAAyB,KAa3B48B,aAAmB,GACvB,KAAK,OAASA,EACd,KAAK,QAAUA,EAAQ,QAEvB,KAAK,OAAO,GAAG,kBAAmB,KAAK,gBAAiB,IAAI,IAG5D,KAAK,OAAS,KACd,KAAK,QAAUA,GAGf,KAAK,QAAgB,WAAW,KAAK,IAAI,EAC1C,KAAK,SAAW58B,GAAW,CAAC,EAM5B,KAAK,eAAiB,GACtB,KAAK,YAAc,IAAI,IAEvB,KAAK,QAAU,IAAI,IACnB,KAAK,OAAS,IAAI,IAClB,KAAK,WAAa,CAAC,EACnB,KAAK,MAAQ,CAAC,EAEd,KAAK,gBAAgB,CACtB,CAEA,SAAU,CACJ,KAAK,QACT,KAAK,OAAO,IAAI,kBAAmB,KAAK,gBAAiB,IAAI,EAE9D,UAAUkf,KAAW,KAAK,WACzBA,EAAQ,IAAI,UAAW,KAAK,WAAY,IAAI,EAE7C,MAAMy7C,EAAY,KAAK,QAAgB,WACtC17C,EAAM07C,EAAS,QAAQ,IAAI,EAEvB17C,IAAQ,IACZ07C,EAAS,OAAO17C,EAAK,CAAC,CACxB,CAOA,UAAW,CACL,KAAK,iBAGV,KAAK,eAAiB,GACtB,KAAK,QAAQ,GAAG,aAAc,KAAK,YAAa,IAAI,EACrD,CAEA,YAAa,CACL,KAAK,iBAGZ,KAAK,eAAiB,GACtB,KAAK,QAAQ,IAAI,aAAc,KAAK,YAAa,IAAI,EACtD,CAEA,YAAYvf,EAAa,CACxB,MAAMiZ,EAAO,KAAK,YAAY,IAAI,MAAMjZ,CAAG,EAAE,EAC7C,GAAKiZ,EACJ,UAAUjZ,KAAOiZ,EAChB,KAAK,QAAQjZ,EAAqBA,EAAqB,CAAC,CAAC,CAC5D,CAOA,iBAAkB,CACjB,KAAK,UAAY,KAAK,OACrB,OAAO,OAAO,CAAC,EAAG,KAAK,OAAO,WAAa,KAAK,OAAO,SAAU,KAAK,QAAQ,EAC9E,KAAK,SAGC,KAAK,eAAe,GAC1B,KAAK,aAAa,EAEnB,KAAK,KAAK,iBAAiB,CAC5B,CAGA,gBAAiB,CAChB,MAAMk7D,EAAkC,CAAC,EACxCl3D,EAAkB,KAAK,MAAQ,CAAC,EAEjC,GAAK,CAAE,KAAK,QAAQ,iBACnB,UAAUwb,KAAW,KAAK,QAAQ,WAC5BA,EAAQ,SAAWA,EAAQ,QAAQ,KAAK,SAAS,IACrD07C,EAAa,KAAK17C,CAAO,EACzBxb,EAAM,KAAKwb,EAAQ,EAAE,GAIxB,MAAK,gBAAa,KAAK,WAAY07C,CAAY,EAC9C,MAAO,GAER,MAAMC,EAAc,IAAI,IAExB,UAAU37C,KAAW,KAAK,WAClB07C,EAAa,SAAS17C,CAAO,IACnCA,EAAQ,IAAI,UAAW,KAAK,WAAY,IAAI,EAC5C27C,EAAY,IAAI37C,EAAQ,EAAE,GAG5B,UAAUA,KAAW07C,EACb,KAAK,WAAW,SAAS17C,CAAO,IACtCA,EAAQ,GAAG,UAAW,KAAK,WAAmB,IAAI,EAClD27C,EAAY,IAAI37C,EAAQ,EAAE,GAG5B,YAAK,WAAa07C,EAClB,KAAK,KAAK,kBAAkB,EAC5B,KAAK,aAA4B,EAC1B,EACR,CAGA,cAAe,CACd,MAAMJ,EAAY,KAAK,QACtBM,EAAW,KAAK,OAChBC,EAAO,KAAK,OAAS,IAAI,IAE1B,KAAK,QAAU,IAAI,IAMnB,SAAU,CAACr7D,EAAK+6D,CAAS,IAAKD,EAAW,CACxC,MAAME,EAAY,KAAK,IAAIh7D,CAAG,EAC7Bs7D,EAAQD,EAAK,IAAIr7D,CAAG,EACpBu7D,EAAQH,EAAS,IAAIp7D,CAAG,EACxBw7D,EAAWF,EAAQA,EAAM,KAAO,KAChCG,EAAWF,EAAQA,EAAM,KAAO,KAE3Bx3C,EAAa,KAAK,QAAQ,YAAY,IAAI/jB,CAAG,EACnD,IAAIojB,EAAU,GAET,CAAE,MAAM,QAAQW,CAAU,GAAKA,GAAY,OAC1CA,EAAW,SAAW,eAC1BX,EAAUy3C,EAAqB92C,EAAY,KAAK,QAAS+2C,CAAS,EACzD,OAAO/2C,EAAW,QAAW,aACtCX,EAAU,CAAEW,EAAW,OAAOi3C,EAAWD,EAAW,KAAK,QAASD,CAAS,GAGnE,MAAM,QAAQE,CAAS,GAAK,MAAM,QAAQD,CAAS,EAC5D33C,EAAU,IAAE,gBAAa43C,EAAWD,CAAS,EAEpCC,aAAqB,KAAOD,aAAqB,IAC1D33C,EAAU,IAAE,cAAW43C,EAAWD,CAAS,EAElCC,aAAqB,KAAOD,aAAqB,IAC1D33C,EAAU,IAAE,cAAW43C,EAAWD,CAAS,EAElCC,IAAcD,IACvB33C,EAAU,IAENA,IACJ,KAAK,KAAK,UAAWpjB,EAAKg7D,EAAWD,CAAS,EAC9C,KAAK,KAAK,WAAW/6D,CAAG,GAAIg7D,EAAWD,CAAgB,MAGjD,gBAAaS,EAAUC,CAAQ,IACrC,KAAK,KAAK,eAAgBz7D,EAAKw7D,EAAUC,CAAQ,EACjD,KAAK,KAAK,gBAAgBz7D,CAAG,GAAIw7D,EAAUC,CAAQ,EAErD,CACD,CAOA,QAAQn7D,EAAsB,CAC7B,OAAO,IAAI,EAAgB,KAAMA,CAAO,CACzC,CAGA,cAAcA,EAAsB,CACnC,IAAI8iB,EAAU,GAEd,UAAUpjB,KAAOM,EAChB,MAAK,OAAIA,EAASN,CAAG,EAAI,CACxB,MAAMC,EAAMK,EAAQN,CAAG,EACvB,GAAI,CACH,MAAK,eAAYC,EAAK,KAAK,SAASD,CAAG,CAAC,EACvC,QACF,MAAa,CAGb,CAEA,KAAK,SAASA,CAAG,EAAIC,EACrBmjB,EAAU,EACX,CAEIA,GACJ,KAAK,gBAAgB,CACvB,CA6DA,WAAW9iB,EAAsB,CAEhC,KAAK,SAAW,CAAC,EACjB,KAAK,cAAcA,CAAO,CAC3B,CAOA,WAAWN,EAAmB,CAC7B,KAAK,QAAQA,EAAKA,EAAK,CAAC,CAAC,CAC1B,CAEA,QAGEA,EAAQ07D,EAAuBv3D,EAAyB,CACzD,GAAO,KAAK,QAAQ,IAAInE,CAAG,GAC1B,GAESmE,EAAQ,SAASnE,CAAG,EAC7B,MAAM,IAAI,MAAM,iDAAiD07D,CAAO,GAAG,MAH3E,QAKDv3D,EAAQ,KAAKnE,CAAG,EAEhB,MAAM+6D,EAAY,KAAK,QAAQ,IAAI/6D,CAAG,EACrCo7D,EAAW,KAAK,OAAO,IAAIp7D,CAAG,EAC9Bg7D,EAAY,KAAK,KAAKh7D,EAAKA,EAAK,CAAC,CAAC,EAClC27D,EAAW,KAAK,OAAO,IAAI37D,CAAG,EAE9By7D,EAAWL,EAAWA,EAAS,KAAO,KACtCI,EAAWG,EAAWA,EAAS,KAAO,KAOvC,MALO,gBAAaH,EAAUC,CAAQ,IACrC,KAAK,KAAK,eAAgBz7D,EAAKw7D,EAAUC,CAAQ,EACjD,KAAK,KAAK,gBAAgBz7D,CAAG,GAAWw7D,EAAUC,CAAQ,GAGtDV,IAAcC,EAClB,OAED,KAAK,KAAK,UAAWh7D,EAAKg7D,EAAWD,CAAS,EAC9C,KAAK,KAAK,WAAW/6D,CAAG,GAAWg7D,EAAWD,CAAS,EAEvD,MAAMh3C,EAAa,KAAK,QAAQ,YAAY,IAAI/jB,CAAG,EACnD,GAAK,CAAE,MAAM,QAAQ+jB,CAAU,GAAKA,GAAY,YAC/C,UAAU63C,KAAW73C,EAAW,YAC1B,CAAE63C,EAAQ,WAAW,UAAU,GAAK,CAAEA,EAAQ,WAAW,KAAK,GAClE,KAAK,QAAQA,EAAyBF,EAAS,MAAM,KAAKv3D,CAAO,CAAC,CACtE,CAGA,KAGEnE,EAAQ07D,EAAuBv3D,EAAiC,CACjE,GAAKA,EAAQ,SAASnE,CAAG,EACxB,MAAM,IAAI,MAAM,6CAA6C07D,CAAO,GAAG,EAExEv3D,EAAQ,KAAKnE,CAAG,EAEhB,MAAM+jB,EAAa,KAAK,QAAQ,YAAY,IAAI/jB,CAAG,EAC7C67D,EAAW,CAAE,MAAM,QAAQ93C,CAAU,GAAKA,GAAY,KAC3DliB,EAAOg6D,EAAW,KAAYA,CAAQ,EAAI,WAE3C,GAAK,CAAEh6D,EACN,MAAM,IAAI,MAAM,8BAA8Bg6D,CAAQ,GAAG,EAE1D,MAAMC,EAAY,KAAK,QAAQ97D,EAAK6B,CAAI,EACvCw5D,EAAwB,CACvB,KAAMS,EAAYA,EAAU,CAAC,EAAI,IAClC,EAED,IAAIlwD,EAAQkwD,EAAYA,EAAU,CAAC,EAAI,OAEvC,GAAK/3C,EAAa,CACjB,GAAK,MAAM,QAAQA,CAAU,EAC5B,MAAM,IAAI,MAAM,yBAAyB/jB,CAAG,sCAAsC07D,CAAO,GAAG,EAE7F,GAAKL,EAAK,OAAS,KAAO,CACzB,MAAMU,EAAch4C,EAAW,QAC1B,OAAOg4C,GAAgB,WAC3BnwD,EAAQmwD,EAAY,IAAI,EAExBnwD,EAAQmwD,EAEJl6D,EAAK,UACT+J,EAAQ/J,EAAK,QAAQ+J,EAAOmY,EAAY,KAAK,QAAQ,GAAG,EAC1D,CAEA,GAAKA,EAAW,SACf,UAAU63C,KAAW73C,EAAW,SAC/B,GAAK63C,EAAQ,WAAW,KAAK,EAAI,CAChC,KAAK,SAAS,EACd,IAAI3iD,EAAO,KAAK,YAAY,IAAI2iD,CAAO,EAChC3iD,GACN,KAAK,YAAY,IAAI2iD,EAAS3iD,EAAO,IAAI,GAAG,EAE7CA,EAAK,IAAIjZ,CAAG,CAEb,KAAY,CAAE47D,EAAQ,WAAW,UAAU,GAAK,CAAE,KAAK,QAAQ,IAAIA,CAAuB,GACzF,KAAK,KAAKA,EAAyBF,EAAS,MAAM,KAAKv3D,CAAO,CAAC,EAE7D4f,EAAW,UACfnY,EAAQmY,EAAW,QAAQ,KAAMnY,EAAOyvD,CAAI,EAC9C,CAEA,YAAK,QAAQ,IAAIr7D,EAAK4L,CAAK,EAC3B,KAAK,OAAO,IAAI5L,EAAKq7D,CAAI,EAClBzvD,CACR,CAGA,CAAC,UAAW,CACX,UAAU4T,KAAW,KAAK,WACzB,MAAMA,CACR,CAGA,WAAWA,EAAmC,CAC7C,GAAK,OAAOA,GAAY,SAAW,CAClC,UAAUw8C,KAAQ,KAAK,WACtB,GAAKA,EAAK,KAAOx8C,EAChB,MAAO,GAET,MAAO,EACR,CAEA,OAAO,KAAK,WAAW,SAASA,CAAO,CACxC,CAGA,QAAQxf,EAAmB6B,EAAM,CAChC,GAAK,CAAEA,EACN,MAAM,IAAI,MAAM,yBAAyB7B,CAAG,EAAE,EAE/C,OAAO6B,EAAK,IACX7B,EACA,KAAK,SAAS,EACd,KAAK,QAAQ,YAAY,IAAIA,CAAG,EAChC,KAAK,QAAQ,IACb,IACD,CACD,CAOA,OAAOA,EAAmB,CACzB,KAAK,QAAQA,EAAKA,EAAK,CAAC,CAAC,CAC1B,CAEA,IAGEA,EAAgB,CACjB,OAAKA,EAAI,WAAW,KAAK,EACjB,KAAK,QAAQ,MAAMA,EAAI,MAAM,CAAC,CAAC,EAElCA,EAAI,WAAW,UAAU,KAEtB,OAAOA,EAAI,MAAM,CAAC,EAAG,KAAK,SAAS,EAEtC,KAAK,QAAQ,IAAIA,CAAmB,EACjC,KAAK,QAAQ,IAAIA,CAAmB,EAErC,KAAK,KAAKA,EAAqBA,EAAqB,CAAC,CAAC,CAC9D,CAEA,WAGEA,EAAQ+E,EAA4Dua,EAAW,CAChF,KAAK,SAAStf,EAAK+E,EAAIua,CAAG,EAC1Bva,EAAG,KAAKua,EAAK,KAAK,IAAItf,CAAG,EAAG,MAAmB,CAChD,CAEA,SAGEA,EAAQ+E,EAAgDua,EAAW,CACpE,KAAK,GAAG,WAAWtf,CAAG,GAAI+E,EAAWua,CAAG,CACzC,CAGA,KAAKtf,EAAsB,CAI1B,OAHKA,EAAI,WAAW,KAAK,GAGpBA,EAAI,WAAW,UAAU,EACtB,MAED,KAAK,OAAO,IAAIA,CAAmB,GACzC,KAAK,KAAKA,EAAqBA,EAAqB,CAAC,CAAC,EAEhD,KAAK,OAAO,IAAIA,CAAmB,GAAG,MAAQ,KACtD,CACD,EA3eiF,uBAAlE,IAAMi8D,EAAN,C,2VC9Df,IAAIC,EAAuD,KAE3D,SAASC,EAAWzyC,EAAuB,CAC1C,qCAAqD,KAAKxJ,GAAS,CAClEg8C,EAASh8C,EAAM,QACVwJ,GACJA,EAAS,CACX,CAAC,CACF,CANS,EAAAyyC,EAAA,cAQT,MAAMC,EAAa,MAAM,GAAN,cAKNC,EAAgD,CAC5D,WAAW3+B,EAAQ4+B,EAAY7f,EAAS,CACvC,SAAO,gBAAa/e,EAAQ4+B,EAAY,GAAM,GAAO7f,CAAO,CAC7D,EAEA,SAAU,EACV,WAAY,GAEZ,KAAM,GACN,MAAO,SACP,KAAM,yBAEN,QAAS,IAAM,CAAC,EAChB,OAAQ,IAAM,iEACf,EAEa8f,EAA6C,CACzD,WAAW7+B,EAAQ4+B,EAAY7f,EAAS,CACvC,SAAO,gBAAa/e,EAAQ4+B,EAAY,GAAO,GAAO7f,CAAO,CAC9D,EAEA,WAAY,GAEZ,KAAM,GACN,MAAO,MACP,KAAM,sBAEN,QAAS,IAAM,CAAC,EAChB,OAAQ,IAAM,iEACf,EAEa+f,EAA4C,CACxD,WAAW9+B,EAAQ4+B,EAAY7f,EAAS,CACvC,SAAO,gBAAa/e,EAAQ4+B,EAAY,GAAO,GAAM7f,CAAO,CAC7D,EAEA,WAAY,GAEZ,KAAM,GACN,MAAO,KACP,KAAM,qBAEN,QAAS,IAAM,CAAC,EAChB,OAAQ,IAAM,iEACf,EAQaggB,EAAsC,CAClD,WAAW/+B,EAAQ4+B,EAAY7f,EAAS,CACvC,MAAMigB,KAAO,gBAAah/B,EAAO,CAAC,EAAG4+B,EAAmB,GAAO,GAAO7f,CAAO,EAC5EkgB,KAAU,gBAAaj/B,EAAO,CAAC,EAAG4+B,EAAmB,GAAO,GAAO7f,CAAO,EAC1EmgB,KAAW,gBAAal/B,EAAO,CAAC,EAAG4+B,EAAmB,GAAO,GAAO7f,CAAO,EAE5E,OAAOn9B,GAAOo9C,EAAKp9C,CAAG,EAAIq9C,EAAQr9C,CAAG,EAAIs9C,EAASt9C,CAAG,CACtD,EAEA,WAAY,GACZ,KAAM,GACN,MAAO,KACP,KAAM,qBAEN,QAAS,IAAM,CAAC,CAAC,EAAG,CAAC,EAAG,CAAC,CAAC,EAC1B,OAAQ,IAAM,kEACf,EAEau9C,EAA6C,CACzD,WAAWn/B,EAAQ,CAClB,OAAKA,EACG,IAAM,GACP0+B,CACR,EAEA,MAAO,gBACP,KAAM,6BAEN,QAAS,GAET,OAAQ,IAAM,kEACf,EAKA,SAASU,EAAU5iC,EAAc,CAChC,GAAK,OAAOA,GAAS,UAAY,CAAEA,EAAK,OACvC,OAAO,KAER,MAAM3a,EAAM2a,EAAK,QAAQ,GAAG,EAC5B,GAAK3a,IAAQ,GACZ,OAAO,KAER,IAAIw9C,EAAOC,EACX,GAAI,CACHD,EAAQ,SAAS7iC,EAAK,MAAM,EAAG3a,CAAG,EAAG,EAAE,EACvCy9C,EAAU,SAAS9iC,EAAK,MAAM3a,EAAM,CAAC,EAAG,EAAE,CAE3C,MAAa,CACZ,OAAO,IACR,CAEA,OAAOw9C,EAAQ,GAAKC,CACrB,CAlBS,EAAAF,EAAA,aAyBF,MAAMG,EAAmB,CAC/B,UAAW,IAAI,IAEf,WAAWv/B,EAAQ,CAClB,MAAM98B,EAAQk8D,EAAUp/B,EAAO,CAAC,CAAC,EAChCjzB,EAAMqyD,EAAUp/B,EAAO,CAAC,CAAC,EAE1B,OAAK98B,GAAS,MAAQ6J,GAAO,KACrB2xD,EAEHx7D,GAAS6J,EACN,IAAM,CACZwyD,EAAK,UAAU,IAAIr8D,CAAK,EACxBq8D,EAAK,UAAU,IAAIxyD,EAAM,CAAC,EAE1B,MAAM4S,EAAI,IAAI,KACbc,EAAId,EAAE,SAAS,EAAI,GAAKA,EAAE,WAAW,EAEtC,OAAOc,GAAKvd,GAASud,GAAK1T,CAC3B,EAEM,IAAM,CACZwyD,EAAK,UAAU,IAAIr8D,EAAQ,CAAC,EAC5Bq8D,EAAK,UAAU,IAAIxyD,CAAG,EAEtB,MAAM4S,EAAI,IAAI,KACbc,EAAId,EAAE,SAAS,EAAI,GAAKA,EAAE,WAAW,EAEtC,OAAOc,GAAKvd,GAASud,GAAK1T,CAC3B,CACD,EAEA,SAAU,IAAM,CACf,MAAM9J,EAAM,MAAM,KAAKs8D,EAAK,SAAS,EACrC,OAAAA,EAAK,UAAY,IAAI,IACrBt8D,EAAI,KAAK,CAACiQ,EAAGC,IAAMD,EAAIC,CAAC,EACjBlQ,CACR,EAEA,MAAO,cACP,KAAM,uBAEN,QAAS,IAAM,CAAC,QAAS,OAAO,EAEhC,OAAQ,IAAM,iEACf,EAEau8D,EAAgD,CAC5D,WAAWx/B,EAAQ,CAClB,OAAOpe,GACDA,EAAI,WACDoe,IAAW,GACZpe,EAAI,IAAI,qBAAuBoe,CAExC,EAEA,MAAO,eACP,KAAM,0BAEN,QAAS,GAET,OAAQ,IAAM,kEACf,EAEay/B,EAA+C,CAC3D,WAAWz/B,EAAQ,CAClB,OAAOpe,GAAOA,EAAI,aAAeoe,CAClC,EAEA,MAAO,aACP,KAAM,6BAEN,QAAS,GAET,OAAQ,IAAM,kEACf,EAEa0/B,EAA8C,CAC1D,WAAW1/B,EAAQ,CAClB,OAAOpe,GAAOA,EAAI,YAAcoe,CACjC,EAEA,MAAO,eACP,KAAM,4BAEN,QAAS,GACT,OAAQ,IAAM,kEACf,EAEa2/B,EAA0C,CACtD,WAAW3/B,EAAQ,CAClB,MAAO,IAAM,UAAUA,CACxB,EAEA,MAAO,oBACP,KAAM,sBAEN,QAAS,GACT,OAAQ,IAAM,kEACf,EAEa4/B,EAA+C,CAC3D,WAAW5/B,EAAQ,CAClB,OAAOpe,GAAOA,EAAI,UAAYoe,CAC/B,EAEA,MAAO,0BACP,KAAM,4BAEN,QAAS,GACT,OAAQ,IAAM,kEACf,EAEa6/B,EAA8C,CAC1D,WAAW7/B,EAAQ,CAClB,OAAOpe,GAAOA,EAAI,IAAI,mBAAqBoe,CAC5C,EAEA,MAAO,aACP,KAAM,wBAEN,QAAS,GACT,OAAQ,IAAM,kEACf,EAEa8/B,EAAoD,CAChE,WAAW9/B,EAAQ,CAClB,MAAMz9B,EAAMy9B,EAAS,EAAI,EACzB,OAAOpe,GAAOA,EAAI,IAAI,QAAUrf,CACjC,EAEA,MAAO,aACP,KAAM,8BAEN,QAAS,GACT,OAAQ,IAAM,kEACf,EAQaw9D,EAA0C,CACtD,WAAW//B,EAAQ,CAClB,GAAK,CAAEA,EACN,OAAO0+B,EAER,MAAM56D,EAAOk8B,EAAO,MACnB7D,EAA0C,CAAC,EAE5C,GAAK,OAAO,KAAK6D,EAAO,MAAM,EAAE,OAAS,CACxC,MAAM7V,EAAM,OAAO,cAAc,IAAI,EACpC61C,EAAS71C,GAAOA,EAAI,QAAQ,aAAa,EAE1C,GAAK,CAAE61C,EACN,OAAOtB,EAER,MAAMlqB,EAAQwrB,EAAO,SAASl8D,CAAI,EAClC,GAAK,CAAE0wC,GAAS,CAAEA,EAAM,MACvB,OAAOkqB,EAER,IAAIrqD,EAAI,EACR,UAAUgoB,KAAQmY,EAAM,MACvB,GAAK,OAAOnY,GAAS,SAAW,CAC/B,MAAM95B,EAAMy9B,EAAO,OAAO3D,EAAK,IAAI,EAC9B95B,GAAOA,EAAI,QACf45B,EAAM,KAAK,CAAC9nB,EAAG9R,EAAI,YAAY,CAAC,CAAC,EAElC8R,GACD,CAEF,CAEA,OAAOuN,GAAO,CACb,GAAK,CAAEA,EAAI,OAAS,CAAEA,EAAI,YAAcA,EAAI,MAAM,OAAS9d,EAC1D,MAAO,GAER,SAAU,CAACa,EAAOuJ,CAAK,IAAKiuB,EAAO,CAClC,IAAI3Z,EAAQZ,EAAI,WAAWjd,CAAK,EAIhC,GAHK,OAAO6d,GAAU,WACrBA,EAAQA,EAAM,YAAY,GAEtBA,IAAUtU,EACd,MAAO,EACT,CAEA,MAAO,EACR,CACD,EAEA,KAAM,GACN,MAAO,eACP,KAAM,uBAEN,QAAS,KAAO,CACf,MAAO,aACP,OAAQ,CAAC,CACV,GACA,OAAQ,IAAM,kEACf,EAOawpC,EAAgD,CAC5D,WAAW1X,EAAQ,CAClB,MAAMpI,EAASoI,GAAQ,MACtB97B,EAAK87B,GAAQ,GAEd,GAAK,CAAE97B,GAAM,CAAE0zB,EACd,OAAO8mC,EAAA,GAEIx6D,GACmB,GAErB,CAAE0zB,EACX,OAAOhW,GAAOA,EAAI,YAAc1d,MAHhC,QAAO0d,GAAOA,EAAI,UAAYgW,EAK/B,OAAOhW,GACNA,EAAI,YAAc1d,GACjB0d,EAAI,WAAa,MAAQA,EAAI,UAAYgW,CAC5C,EAEA,MAAO,kBACP,KAAM,0BAEN,QAAS,KAAO,CACf,MAAO,KACP,GAAI,IACL,GACA,OAAQ,IAAM,kEACf,EAOaqoC,EAAkD,CAC9D,WAAWjgC,EAAQ,CAClB,MAAMl8B,EAAOk8B,GAAQ,KACpB97B,EAAK87B,GAAQ,GAEd,GAAK,CAAE97B,GAAM,CAAEJ,EACd,OAAO46D,EAAA,GAEIx6D,GACoB,GAEtB,CAAEJ,EACX,OAAO8d,GAAOA,EAAI,aAAe1d,MAHjC,QAAO0d,GAAOA,EAAI,WAAa9d,EAKhC,OAAO8d,GACNA,EAAI,aAAe1d,GAClB0d,EAAI,YAAc,MAAQA,EAAI,WAAa9d,CAC9C,EAEA,MAAO,mBACP,KAAM,2BAEN,QAAS,KAAO,CACf,KAAM,KACN,GAAI,IACL,GAEA,OAAQ,IAAM,kEACf,EAQao8D,EAA4C,CACxD,WAAWlgC,EAAQtf,EAAGy/C,EAAQ,CAC7B,MAAMryC,EAAOkS,GAAQ,KACrB,IAAI5d,EAAQ4d,GAAQ,MACnBogC,EAAc,GAEf,GAAK,CAAEh+C,GAAS,CAAE0L,EACjB,OAAO4wC,EAER,GAAK5wC,IAAS,OACb1L,KAAQ,gBAAaA,CAAK,EAC1Bg+C,EAAc,WACHtyC,IAAS,OACpB1L,KAAQ,iBAAcA,CAAK,UAClB0L,IAAS,MAClB,OAAO4wC,EAER,GAAK0B,IACG5B,GACNC,EAAW0B,CAAM,EAEb,CAAE3B,GAAU,CAAEA,EAAOp8C,CAAK,GAC9B,OAAOs8C,EAGT,IAAIn8B,EACJ,GAAI,CACHA,EAAQ,IAAI,OAAOngB,EAAO,IAAI4d,EAAO,UAAY,GAAK,GAAG,EAAE,CAC5D,MAAa,CACZ,OAAO0+B,CACR,CAEA,OAAO98C,IACN2gB,EAAM,UAAY,EACX3gB,EAAI,MAAQ2gB,EAAM,KAAK3gB,EAAI,KAAK,EAAG,GAE5C,EAEA,MAAO,gBACP,KAAM,wBAEN,QAAS,KAAO,CACf,MAAO,GACP,KAAM,OACN,UAAW,EACZ,GAEA,OAAQ,IAAM,kEACf,EAYO,IAAIy+C,EAAuB,KAE7B,OAAO,mBAEXA,EAAU,CACT,MAAO,GACP,QAAS,OAET,KAAM,IAAM,CACX,MAAMp9D,EAAMo9D,EAAQ,MACpB,OAAAA,EAAQ,MAAQ,GACTp9D,CACR,EAEA,WAAW+8B,EAAQtf,EAAGy/C,EAAQ,CAC7B,GAAK,CAAEngC,GAAQ,MACd,OAAO0+B,EAGR,GADA2B,EAAQ,MAAQ,GACXF,GAAUE,EAAQ,UAAY,OAAY,CAC9C,MAAMC,EAAM,OAAO,cAAkB,OAAe,UACnDn2C,EAAMm2C,GAAK,IAAI,EACfl2C,EAAWD,GAAK,QAAQ,UAAU,EAC9BC,GACJA,EAAS,oBAAoB,EAAE,KAAK,IAAM,CACzC+1C,EAAO,CACR,CAAC,CACH,CAEA,MAAO,IAAM,CACZE,EAAQ,MAAQ,GAChB,MAAMv9B,EAAUu9B,EAAQ,QACxB,GAAK,CAAEv9B,EACN,MAAO,GAER,MAAMilB,EAASjlB,EAAQ,QAGvB,SAFW,eAAYilB,EAAQ/nB,CAAM,IAElB8C,EAAQ,aAC5B,CACD,EAEA,QAAS,KAAO,CACf,MAAO,IACR,GAEA,MAAO,kBACP,KAAM,0BAEN,OAAQ,IAAM,kEACf,E,mMCrfD,SAASy9B,EAAYh0D,EAA4B5J,EAAU,CAC1D,GAAI,CACF,OAAA4J,EAAkB,YAAY5J,EAAK,GAAG,EAChC,EACR,MAAa,CACZ,MAAO,EACR,CACD,CAPS,EAAA49D,EAAA,eASF,MAAMC,EAAe,CAAC,SAAS,EAqDjB,EAAN,MAAM,UAAwB,SAAmC,CAsD/E,YAAY18D,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EA9BnB,cAA6B,KAS7B,KAAQ,iBAA2B,QAenC,sBAA4B,GAQ3B,KAAK,UAAY,CAAC,EAClB,SAAU,CAACP,EAAK4xB,CAAQ,IAAK,OAAO,QAAQ,IAAS,EAC/CA,EAAS,UAAU,IACvB,KAAK,UAAU5xB,CAAG,EAAI4xB,GAKxB,OAAO,KAAK,KAAK,SAAS,EAE1B,KAAK,cAAa,YAAS,IAAM,KAAK,aAAa,EAAG,GAAI,EAAK,EAG/D,GAAI,CACH,MAAM+V,EAAS,IAAI,IAAI,OAAO,QAAe,EAAE,aAC1CA,GACCA,EAAO,IAAI,iBAAiB,IAChC,KAAK,iBAAmB,GAE3B,MAAa,CAAc,CAG3B,KAAK,eAAiB,IAAI,IAC1B,KAAK,WAAa,IAAI,IACtB,KAAK,YAAc,GACnB,KAAK,UAAY,KAAK,UAAU,KAAK,IAAI,EAGzC,KAAK,WAAa,CAAC,EACnB,KAAK,WAAa,CAAC,EACnB,KAAK,cAAgB,CAAC,EACtB,KAAK,gBAAkB,CAAC,EAExB,KAAK,cAAgB,IAAI,IACzB,KAAK,YAAc,IAAI,IAGvB,KAAK,WAAa,CAAC,EAEnB,UAAU3nC,KAAO,KACX,OAAI,EAAYA,CAAG,IACvB,KAAK,WAAWA,CAAG,EAAI,EAAWA,CAAG,GAGvC,KAAK,WAAa,CAAC,EAEnB,UAAUA,KAAO,KACX,OAAI,EAAYA,CAAG,IACvB,KAAK,WAAWA,CAAG,EAAI,EAAWA,CAAG,GAGvC,KAAK,WAAa,CAAC,EAEnB,UAAUA,KAAO,KACX,OAAI,EAAYA,CAAG,IACvB,KAAK,WAAWA,CAAG,EAAI,EAAWA,CAAG,GAGvC,KAAK,QAAU,CAAC,EAEhB,UAAUA,KAAO,KACX,OAAI,EAASA,CAAG,GAAK,EAAQA,CAAG,IACpC,KAAK,QAAQA,CAAG,EAAI,EAAQA,CAAG,GAIjC,KAAK,gBAAgB,EAAE,KAAK4xB,GAAY,CACvC,KAAK,SAAWA,EAChB,KAAK,IAAI,KAAK,mBAAmBA,EAAS,YAAY,IAAI,EAAE,EAC5DA,EAAS,GAAG,UAAW,KAAK,kBAAmB,IAAI,EACnDA,EAAS,GAAG,iBAAmB9Q,GAAQ,CACtC,KAAK,KAAK,iBAAiB,CAC5B,CAAC,EACD8Q,EAAS,GAAG,kBAAmB,IAAM,CACpC,KAAK,KAAK,kBAAkB,CAC7B,CAAC,EAEI,KAAK,mBACT,KAAK,kBAAkBA,CAAQ,CACjC,CAAC,EAKD,KAAK,aAAe,IAAI,IAAgB,IAAI,EAE5C,KAAK,aAAa,GAAG,UAAW,CAAC5xB,EAA4Bg7D,EAAWD,IAAc,CACrF,KAAK,KAAK,YAAY/6D,CAAG,GAAIg7D,EAAWD,CAAS,CAClD,CAAC,EAED,KAAK,aAAa,GAAG,eAAgB,CAAC/6D,EAA4Bw7D,EAAUC,IAAa,CACxF,KAAK,KAAK,iBAAiBz7D,CAAG,GAAIw7D,EAAUC,CAAQ,CACrD,CAAC,EAED,KAAK,aAAa,GAAG,kBAAmB,IAAM,KAAK,sBAAsB,CAAC,EAC1E,KAAK,iBAAmB,IAAI,IAE5B,OAAO,iBAAiB,UAAWr7C,GAAS,CAC3C,MAAMve,EAAOue,EAAM,MAAM,SAEpBve,IAAS,gBACb,KAAK,KAAK,gBAAgB,EAEjBA,IAAS,mBAAqBue,EAAM,SAC7C,KAAK,iBAAiB,IAAIA,EAAM,MAAM,EACtC,KAAK,sBAAsBA,EAAM,MAAM,EAEzC,CAAC,EAED,OAAO,iBAAiB,eAAgB,IAAM,CAC7C,UAAU+9C,KAAS,KAAK,iBACvBF,EAAYE,EAAO,CAAC,SAAU,cAAc,CAAC,CAC/C,CAAC,EAGD,KAAK,YAAc,YAAY,IAAI,EACnC,KAAK,OAAO,CACb,CAEA,sBAAsBA,EAA4B,CACjD,GAAK,CAAEA,GAAS,CAAE,KAAK,iBAAiB,KACvC,OAED,MAAM7+C,EAAM,KAAK,MAAM,KAAK,UAAU,KAAK,aAAa,QAAQ,CAAC,EACjE,UAAUtf,KAAOk+D,KACX,OAAI5+C,EAAKtf,CAAG,GAChB,OAAOsf,EAAItf,CAAG,EAEhB,GAAKm+D,EACJF,EAAYE,EAAO,CAAC,SAAU,iBAAkB,IAAA7+C,CAAG,CAAC,MAEpD,WAAU6+C,KAAS,KAAK,iBACvBF,EAAYE,EAAO,CAAC,SAAU,iBAAkB,IAAA7+C,CAAG,CAAC,CACvD,CAGA,UAAatf,EAAa4T,EAAkC,CAC3D,GAAK,KAAK,QAAQ5T,CAAG,EACpB,OAAO,KAAK,IAAI,KAAK,uCAAwCA,CAAG,EAEjE,KAAK,QAAQA,CAAG,EAAI4T,EACpB,KAAK,aAAa,CACnB,CAEA,sBAAuB,CACtB,MAAO,IAAM,kEACd,CAGA,aAAc,CACb,MAAMjT,EAAM,CAAC,EACb,SAAU,CAACX,EAAK4L,CAAK,IAAM,KAAK,aAAqB,QAAQ,QAAQ,EACpEjL,EAAI,KAAK,GAAGX,CAAG,KAAK,KAAK,UAAU4L,CAAK,CAAC,EAAE,EAE5C,OAAOjL,EAAI,KAAK;AAAA,CAAI,CACrB,CAEA,eAAgB,CACf,OAAK,KAAK,SACF,QAAQ,QAAQ,KAAK,QAAQ,EAEhC,KAAK,iBACF,KAAK,iBAEN,KAAK,iBAAmB,IAAI,QAA0B,CAACsE,EAASi2B,IAAW,CACjF,KAAK,kBAAoBj2B,CAC1B,CAAC,EAAE,QAAQ,IAAM,CAChB,KAAK,iBAAmB,KACxB,KAAK,kBAAoB,IAC1B,CAAC,CACF,CAMA,MAAM,UAAW,CAGhB,GADA,MAAM,KAAK,cAAc,EACpB,CAAE,KAAK,SACX,MAAM,IAAI,MAAM,sBAAsB,EAEvC,MAAM,KAAK,SAAS,WAAW,EAI/B,KAAK,GAAG,6BAA8B,KAAK,aAAc,IAAI,EAI7D,KAAK,aAAa,EAAI,EAMtB,UAAU3E,KAAW,KAAK,WACzBA,EAAQ,eAAe,EAExB,MAAM6uC,EAAW,YAAY,IAAI,EAAI,KAAK,YAC1C,KAAK,IAAI,KAAK,iCAAiCA,EAAS,QAAQ,CAAC,CAAC,iBAAiB,KAAK,SAAS,IAAI,iBAAiB,KAAK,WAAW,MAAM,EAAE,EAE9I,KAAK,gBAAgB,EACrB,KAAK,YAAY,CAClB,CAGA,MAAM,qBAAsB,CAC3B,MAAM4uB,EAAU,GAAS,QACzB,GAAK,GAAEA,GAAWA,EAAQ,UAAY,QAGtC,CAAAA,EAAQ,QAAU,KAClB,GAAI,CACE,OAAO,kBACXA,EAAQ,QAAU,MAAM,OAAO,iBAAiB,EAChDA,EAAQ,QAAQ,iBAAiB,sBAAuB,IAAM,CAC7D,UAAUz9D,KAAW,KAAK,WACzBA,EAAQ,eAAe,CACzB,CAAC,GAEDy9D,EAAQ,QAAU,EAEpB,OAAQj9C,EAAK,CACZ,KAAK,IAAI,MAAM,gCAAiCA,CAAG,EACnDi9C,EAAQ,QAAU,EACnB,EACD,CAGA,aAAc,CACb,MAAMK,EAAW,GAAS,MAAM,WAAW,EAC3C,GAAK,CAAEA,GAAU,OAChB,OAEI,KAAK,aACT,aAAa,KAAK,WAAW,EAE9B,MAAM/gD,EAAI,IAAI,KACboC,EAAMpC,EAAE,SAAS,EAAI,GAAKA,EAAE,WAAW,EAExC,IAAIhc,EAAO,KAAK,YAAc,KAAO,KAAK,WAAa,KACvD,UAAUuK,KAASwyD,EACbxyD,GAAS6T,IAGTpe,GAAQ,MAAQuK,EAAQvK,KAC5BA,EAAOuK,GAIJvK,GAAQ,OACZA,EAAO+8D,EAAS,CAAC,EAAI,MAGtB,MAAM1xB,GAASrrC,EAAOoe,GAAO,GAAK,IAAO,OAAS,IAAQ,KAAK,IAAI,EAAI,KACvE,KAAK,YAAc,WAAW,IAAM,CACnC,UAAUnf,KAAW,KAAK,WACzBA,EAAQ,eAAe,EAExB,KAAK,YAAY,CAClB,EAAGosC,CAAK,CACT,CAOQ,aAAa1sC,EAAa,EAC5B,KAAK,WAAW,IAAIA,CAAG,GAAK,KAAK,WAAW,IAAI,OAAOA,CAAG,EAAE,KAChE,KAAK,eAAe,IAAIA,CAAG,EACpB,KAAK,aACX,KAAK,WAAa,WAAW,KAAK,UAAW,CAAC,GAKjD,CAEQ,SAAU,CACjB,GAAK,KAAK,YACT,OAED,KAAK,YAAc,GACnB,MAAM0rD,EAAW,aAAa,QAC7BluC,EAAI,KAEL,aAAa,QAAU,SAASxd,KAAQyF,EAAM,CAI7C,GAAI,CACH+X,EAAE,aAAaxd,CAAG,CACnB,MAAa,CAAc,CAE3B,OAAO0rD,EAAS,KAAK,KAAM1rD,EAAK,GAAGyF,CAAI,CACxC,EAEA,KAAK,eAAiB,KAAK,eAAe,KAAK,IAAI,EACnD,OAAO,iBAAiB,UAAW,KAAK,cAAc,CACvD,CAEQ,eAAe2a,EAAqB,CACtCA,EAAM,KAAOA,EAAM,cAAgB,cACvC,KAAK,aAAaA,EAAM,GAAG,CAC7B,CAEQ,WAAY,CACnB,aAAa,KAAK,UAA2C,EAC7D,KAAK,WAAa,KAClB,MAAMnH,EAAO,KAAK,eAClB,KAAK,eAAiB,IAAI,IAE1B,UAAUjZ,KAAOiZ,EAAM,CACtB,MAAMolD,EAAY,KAAK,WAAW,IAAIr+D,CAAG,EACxCs+D,EAAU,OAAOt+D,CAAG,GACpBu+D,EAAU,KAAK,WAAW,IAAID,CAAO,EAEtC,GAAK,CAAEC,GAAW,CAAEF,EACnB,SAED,MAAMvuC,EAAM,aAAa,QAAQ9vB,CAAG,EAOpC,GALKu+D,IACJ,KAAK,WAAW,IAAID,EAASxuC,CAAG,EAChC,KAAK,KAAK,aAAcwuC,EAASxuC,CAAG,GAGhCuuC,EAAY,CAChB,IAAIzyD,EACJ,GAAKkkB,EACJ,GAAI,CACHlkB,EAAQ,KAAK,MAAMkkB,CAAG,CACvB,OAAQhP,EAAK,CACZ,KAAK,IAAI,KAAK,mDAAmD9gB,CAAG,IAAK8gB,CAAG,CAC7E,CAED,KAAK,WAAW,IAAI9gB,EAAK4L,CAAK,EAC9B,KAAK,KAAK,aAAc5L,EAAK4L,CAAK,CACnC,CACD,CACD,CAEA,MAAS5L,EAAuB,CAC/B,GAAK,KAAK,WAAW,IAAIA,CAAG,EAC3B,OAAO,KAAK,WAAW,IAAIA,CAAG,EAExB,KAAK,aACX,KAAK,QAAQ,EAEd,MAAM86C,EAAS96C,EAAI,WAAW,MAAM,EACnC8vB,EAAM,aAAa,QAAQgrB,EAAS96C,EAAI,MAAM,CAAC,EAAIA,CAAG,EAEvD,IAAI4L,EACJ,GAAKkvC,EACJlvC,EAAQkkB,MAER,IAAI,CACHlkB,EAAQkkB,EAAM,KAAK,MAAMA,CAAG,EAAI,IACjC,OAAQhP,EAAK,CACZ,KAAK,IAAI,KAAK,mDAAmD9gB,CAAG,IAAK8gB,CAAG,CAC7E,CAED,YAAK,WAAW,IAAI9gB,EAAK4L,CAAK,EACvBA,CACR,CAOA,MAAM,oBAAqB,CAC1B,MAAM6T,EAAM,IAAI,KACfk7B,EAAY,GAAGl7B,EAAI,YAAY,CAAC,IAAIA,EAAI,SAAS,EAAE,CAAC,IAAIA,EAAI,QAAQ,CAAC,GAEtE,GAAK,MAAM,KAAK,gBAAgB,EAAI,CACnC,MAAM++C,EAAO,MAAM,KAAK,cAAc,EACtC,OAAO,IAAI,KAAK,CAACA,CAAI,EAAG,iBAAiB7jB,CAAS,QAAS,CAAC,KAAM,iBAAiB,CAAC,CACrF,CAEA,MAAM7yB,EAAW,MAAM,KAAK,gBAAgB,EAC5C,OAAO,IAAI,KAAK,CAAC,KAAK,UAAUA,CAAQ,CAAC,EAAG,iBAAiB6yB,CAAS,SAAU,CAAC,KAAM,gCAAgC,CAAC,CACzH,CAGA,MAAc,iBAAkB,CAQ/B,GANA,MAAM,KAAK,cAAc,EACpB,CAAE,KAAK,WAGZ,MAAM,KAAK,SAAS,WAAW,EAE1B,EAAE,KAAK,oBAAoB,OAA6B,CAAE,KAAK,SAAS,eAC5E,MAAO,GAER,MAAM1hC,EAAO,MAAM,KAAK,SAAS,SAAS,EAC1C,OAAO,MAAM,QAAQA,CAAI,EAAIA,EAAK,OAAS,EAAI,EAChD,CAGA,MAAc,eAAgB,CAG7B,GADA,MAAM,KAAK,cAAc,EACpB,CAAE,KAAK,SACX,MAAM,IAAI,MAAM,wBAAwB,EAEzC,MAAM,KAAK,SAAS,WAAW,EAG/B,MAAMwlD,GAAS,MAAM,qCAA+C,QACnE99D,EAAM,IAAI89D,EAGL32C,EAAW,MAAM,KAAK,gBAAgB,EAC5CnnB,EAAI,KAAK,gBAAiB,KAAK,UAAUmnB,CAAQ,CAAC,EAGlD,MAAM42C,EAAiD,CAAC,EAExD,GAAK,KAAK,oBAAoB,MAA4B,KAAK,SAAS,cAAgB,CACvF,MAAMzlD,EAAO,MAAM,KAAK,SAAS,SAAS,EAC1C,UAAUjZ,KAAOiZ,EAAM,CACtB,MAAM0lD,EAAW,mBAAmB3+D,CAAG,EACtCw+D,EAAO,MAAM,KAAK,SAAS,QAAQx+D,CAAG,EACvC,GAAK,CAAEw+D,EACN,SAED,MAAMzM,EAA2B,CAChC,IAAA/xD,CACD,EAEA,GAAKw+D,aAAgB,KACpBzM,EAAG,KAAO,OACVA,EAAG,KAAOyM,EAAK,KACfzM,EAAG,SAAWyM,EAAK,aACnBzM,EAAG,KAAOyM,EAAK,aAEJA,aAAgB,KAC3BzM,EAAG,KAAO,eAECyM,aAAgB,YAC3BzM,EAAG,KAAO,aACCyM,aAAgB,WAC3BzM,EAAG,KAAO,UAEV,UAED2M,EAASC,CAAQ,EAAI5M,EACrBpxD,EAAI,KAAK,SAASg+D,CAAQ,GAAIH,CAAI,CACnC,CACD,CAEA,OAAA79D,EAAI,KAAK,aAAc,KAAK,UAAU+9D,CAAQ,CAAC,EAExC/9D,EAAI,cAAc,CAAC,KAAM,MAAM,CAAC,CACxC,CAGA,MAAM,iBAAkB,CAGvB,GADA,MAAM,KAAK,cAAc,EACpB,CAAE,KAAK,SACX,OAAO,KAER,MAAM,KAAK,SAAS,WAAW,EAE/B,MAAMA,EAAwB,CAC7B,QAAS,EACT,KAAM,OACN,OAAQ,CAAC,CACV,EAEA,SAAU,CAACX,EAAK4L,CAAK,IAAK,KAAK,SAAS,QAAQ,EAC/CjL,EAAI,OAAOX,CAAG,EAAI4L,EAEnB,OAAOjL,CACR,CAGA,iBAAkB,CACZ,KAAK,eACT,aAAa,KAAK,aAAa,EAEhC,KAAK,cAAgB,WAAW,IAAM,KAAK,aAAa,EAAG,GAAI,CAChE,CAGA,MAAM,cAAe,CAIpB,GAHA,MAAM,KAAK,cAAc,EACzB,MAAM,KAAK,UAAU,WAAW,EAE3B,CAAE,KAAK,UAAU,aACrB,OAED,MAAM0gB,EAAW,CAAC,EAClB,UAAU7B,KAAW,KAAK,WAAY,CACrC,GAAK,CAAEA,GAAW,CAAEA,EAAQ,KAAOA,EAAQ,cAC1C,SAED,MAAM7e,EAAM6e,EAAQ,YAAY,EAChC6B,EAAS,KAAK1gB,aAAe,QAAUA,EAAM,QAAQ,QAAQA,CAAG,CAAC,CAClE,CAEA,MAAMiT,EAAO,MAAM,QAAQ,IAAIyN,CAAQ,EAEvC,IAAI+Z,EAAU,EACd,UAAUlb,KAAStM,EACbsM,GACJkb,IAEF,KAAK,IAAI,KAAK,0BAA0BA,CAAO,OAAOxnB,EAAK,MAAM,6BAA6B,CAC/F,CAWA,cAAe,CACd,OAAO,KAAK,SACb,CAMA,mBAAoB,CACnB,OAAO,KAAK,gBACb,CAQA,MAAM,iBAAkB,CAKvB,IAAIw6B,EAAS,aAAa,cAI1B,GAHKA,GAAU,OACdA,EAAS,aAAa,cAAgB,MAAM,KAAK,cAAc,GAE3D,KAAK,UAAUA,CAAM,EAAI,CAC7B,MAAMxc,EAAW,IAAK,KAAK,UAAUwc,CAAM,EAAU,IAAI,EACzD,YAAK,iBAAmBA,EACjBxc,CACR,CAGA,YAAK,iBAAmB,QACjB,IAAI,KAAqB,IAAI,CACrC,CAYA,MAAM,eAAgB,CACrB,MAAMiC,EAAY,MAAM,KAAK,OAAO,QAAQ,KAAK,SAAS,CAAC,EAC3DA,EAAU,KAAK,CAACjjB,EAAGC,KAChBA,EAAE,CAAC,EAAU,UAAY,IACzBD,EAAE,CAAC,EAAU,UAAY,EAC5B,EAEA,SAAU,CAAC5Q,EAAK4xB,CAAQ,IAAKiC,EAC5B,GAAKjC,EAAS,UAAU,GAAK,MAAMA,EAAS,WAAW,EACtD,OAAO5xB,EAIT,MAAO,OACR,CAWA,MAAM,eAAeA,EAAa4+D,EAAmB,CACpD,GAAK,CAAE,KAAK,UAAU5+D,CAAG,GAAK,CAAE,KAAK,UAAUA,CAAG,EAAE,UAAU,EAC7D,MAAM,IAAI,MAAM,qBAAqBA,CAAG,EAAE,EAI3C,GAAKA,IAAQ,KAAK,kBAAoB,CAAE,KAAK,SAC5C,OAED,MAAM6+D,EAAe,KAAK,SAO1B,GANA,KAAK,SAAW,KAGhBA,EAAa,kBAAkB,EAG1BD,EAAW,CACf,MAAME,EAAe,IAAK,KAAK,UAAU9+D,CAAG,EAAU,IAAI,EAG1D,GAFA,MAAM8+D,EAAa,WAAW,EAEzBA,EAAa,eAAiBD,EAAa,cAAgB,CAC/DA,EAAa,cAAc,EAG3BC,EAAa,MAAM,EACdA,aAAwB,MAA4BA,EAAa,eACrE,MAAMA,EAAa,WAAW,EAG/B,MAAMA,EAAa,MAAM,EAEzB,SAAU,CAAC9+D,EAAIC,CAAG,IAAK4+D,EAAa,QAAQ,EAC3CC,EAAa,IAAI9+D,EAAKC,CAAG,EAE1B,GAAK4+D,aAAwB,MAA4BA,EAAa,eAAiBC,aAAwB,MAA4BA,EAAa,cAAgB,CACvK,UAAU9+D,KAAO,MAAM6+D,EAAa,SAAS,EAAI,CAChD,MAAML,EAAO,MAAMK,EAAa,QAAQ7+D,CAAG,EACtCw+D,GACJ,MAAMM,EAAa,QAAQ9+D,EAAKw+D,CAAI,CACtC,CAEA,MAAMK,EAAa,WAAW,CAC/B,CAEAA,EAAa,MAAM,EAEnB,MAAMA,EAAa,MAAM,EACzB,MAAMC,EAAa,MAAM,CAC1B,CACD,CAGA,aAAa,cAAgB9+D,EAC7B,SAAS,OAAO,CACjB,CAQA,kBAAkBA,EAAag7D,EAAgBrxB,EAAkB,CAEhE,GAAK3pC,IAAQ,WACZ,OAAO,KAAK,aAAa,EAE1B,GAAK,CAAEA,EAAI,WAAW,IAAI,EACzB,OAKDA,EAAMA,EAAI,MAAM,CAAC,EAGjB,MAAMuf,EAAMvf,EAAI,QAAQ,GAAG,EAC3B,GAAKuf,IAAQ,GACZ,OAED,MAAMC,EAAU,KAAK,cAAcxf,EAAI,MAAM,EAAGuf,CAAG,CAAQ,EAC1Dw/C,EAAQ/+D,EAAI,MAAMuf,EAAM,CAAC,EAErBC,GAAW,CAAEA,EAAQ,YACpBu/C,IAAU,WACdv/C,EAAQ,KAAK,UAAWA,EAASmqB,EAAU,GAAOqxB,CAAS,EAE3Dx7C,EAAQ,KAAK,UAAWu/C,EAAO/D,EAAWrxB,CAAO,EAEpD,CAOA,cAAe,CAEd,UAAUnqB,KAAW,KAAK,WACzBA,EAAQ,aAAa,EAGtB,UAAUlf,KAAW,KAAK,WACzBA,EAAQ,eAAe,EAExB,KAAK,YAAY,CAClB,CAGA,kBAAkBkf,EAA0BkU,EAAkB,CAC7D,UAAUpzB,KAAW,KAAK,WACzBA,EAAQ,eAAe,EAExB,KAAK,YAAY,EACjB,KAAK,KAAK,mBAAoBkf,EAASkU,CAAO,CAC/C,CAOA,QAAQ9xB,EAA6C,CACpD,OAAO,KAAK,gBAAgBA,CAAE,GAAK,KAAK,cAAcA,CAAY,GAAK,IACxE,CAOA,aAAao9D,EAA2B,GAAO,CAC9C,MAAMC,EAAkB,KAAK,cAC5BC,EAAoB,KAAK,gBACzBC,EAAe,KAAK,WAEpBC,EAA+C,KAAK,cAAgB,CAAC,EACrEt2B,EAA8B,KAAK,WAAa,CAAC,EACjDu2B,EAAiD,KAAK,gBAAkB,CAAC,EAMzEC,EAAU,IAAI,IAAIH,EAAa,IAAIl3D,GAAKA,EAAE,EAAE,CAAC,EAE7Cs3D,EAAU,IAAI,IACdpE,EAAc,IAAI,IAEnB,IAAIqE,EAAe,KAAK,UAAU,IAA+B,UAAU,GAAK,CAC/E,IAAgB,WAChB,IAAgB,OACjB,EAGOA,GAAc,SACpB,KAAK,UAAU,OAAO,UAAU,EAChCA,EAAe,CACd,IAAgB,WAChB,IAAgB,OACjB,GAID,IAAIC,EAAY,GAEhB,UAAUjgD,KAAWggD,EACbhgD,EAAQ,OACdigD,EAAY,GAEPjgD,EAAQ,WAAa,IAAgB,QAAQ,SACjDA,EAAQ,KAAO,IAAgB,QAAQ,KAC9BA,EAAQ,WAAa,IAAgB,WAAW,SACzDA,EAAQ,KAAO,IAAgB,WAAW,KAE1CA,EAAQ,QAAO,gBAAa,GAI1BigD,GACJ,KAAK,UAAU,IAAI,WAAYD,CAAY,EAE5C,IAAIE,EAAY,GACft8C,EAAU,GAEX,UAAU5D,KAAW2/C,EACpB3/C,EAAQ,IAAI,UAAW,KAAK,kBAAmB,IAAI,EACnDA,EAAQ,eAAiB,GAG1B,UAAUmgD,KAAgBH,EAAc,CACvC,MAAM59D,EAAK+9D,EAAa,GACvBC,EAAU92B,EAAS,OACnB+2B,EAAcZ,EAAgBr9D,CAAE,EAChCk+D,EAAcD,EAAcV,EAAa,QAAQU,CAAW,EAAI,GAOjE,GALAP,EAAQ,OAAO19D,CAAE,EAEZk+D,IAAgBF,IACpBF,EAAY,IAERG,MAAe,eAAYA,EAAY,KAAMF,EAAc,EAAI,EAAI,CAElEG,IAAgBF,IACpBx8C,EAAU,IAEX0lB,EAAS,KAAKs2B,EAAYx9D,CAAE,EAAIi+D,CAAW,EAC3CR,EAAcQ,EAAY,IAAI,EAAIA,EAClC,QACD,CAEA,MAAME,EAAcX,EAAYx9D,CAAE,EAAI,IAAI,IAAgB,KAAM+9D,CAAY,EACvEE,GACJA,EAAY,kBAAkBE,CAAW,EACzC5E,EAAY,IAAIv5D,CAAE,GAGlB29D,EAAQ,IAAI39D,CAAE,EAEfknC,EAAS,KAAKi3B,CAAW,EACzBV,EAAcU,EAAY,IAAI,EAAIA,EAClC38C,EAAU,EACX,CAEA,UAAU5D,KAAWspB,EACpBtpB,EAAQ,GAAG,UAAW,KAAK,kBAAmB,IAAI,EAClDA,EAAQ,eAAiB,GAG1B,GAAK,GAAE4D,GAAW,CAAEk8C,EAAQ,MAAQN,GAGpC,WAAU1+D,KAAW,KAAK,WACzBA,EAAQ,eAAe,EAExB,KAAK,YAAY,EAEjB,UAAUsB,KAAM29D,EACf,KAAK,KAAK,mBAAoBH,EAAYx9D,CAAE,CAAC,EAE9C,UAAUA,KAAMu5D,EACf,KAAK,KAAK,mBAAoBiE,EAAYx9D,CAAE,CAAC,EAEzC89D,GACJ,KAAK,KAAK,qBAAqB,EACjC,CAOA,cAAc3/D,EAA4C,CAAC,EAAG,CAC7D,GAAK,CAAE,KAAK,QACX,MAAM,IAAI,MAAM,kFAAkF,EAEnG,GAAKA,EAAQ,KAAO,OACnB,MAAM,IAAI,MAAM,mDAAmD,EAEpE,IAAI6B,EAAK,EAGT,KAAQ,KAAK,cAAcA,CAAE,GAE5B7B,EAAQ,UAAY6B,IAAOA,IAG5B7B,EAAQ,GAAK6B,EACb7B,EAAQ,QAAO,gBAAa,EAErBA,EAAQ,OACdA,EAAQ,KAAO,mBAAmB,KAAK,WAAW,OAAS,CAAC,IAE7D,MAAMyf,EAAU,KAAK,cAAc5d,CAAE,EAAI,IAAI,IAAgB,KAAM7B,CAAO,EAC1E,YAAK,gBAAgBA,EAAQ,IAAI,EAAIyf,EACrC,KAAK,WAAW,QAAQA,CAAO,EAE/BA,EAAQ,GAAG,UAAW,KAAK,kBAAmB,IAAI,EAClDA,EAAQ,eAAiB,GAGlBA,EAAQ,WACd,KAAK,cAAc,EAEpB,KAAK,KAAK,mBAAoBA,CAAO,EAC9BA,CACR,CAQA,cAAc5d,EAA8B,CAC3C,GAAK,CAAE,KAAK,QACX,MAAM,IAAI,MAAM,kFAAkF,EAEnG,GAAK,OAAOA,GAAO,UAAY,OAAOA,EAAG,IAAO,SAC/CA,EAAKA,EAAG,WACC,OAAOA,GAAO,SACvB,MAAM,IAAI,MAAM,iBAAiB,EAElC,MAAM4d,EAAU,KAAK,cAAc5d,CAAE,EACrC,GAAK,CAAE4d,EACN,OAED,GAAK,KAAK,WAAW,SAAW,EAC/B,MAAM,IAAI,MAAM,4BAA4B,EAK7CA,EAAQ,IAAI,UAAW,KAAK,kBAAmB,IAAI,EACnDA,EAAQ,MAAM,EACd,KAAK,cAAc5d,CAAE,EAAI,KACzB,KAAK,gBAAgB4d,EAAQ,IAAI,EAAI,KAErC,MAAMD,EAAM,KAAK,WAAW,QAAQC,CAAO,EACtCD,IAAQ,IACZ,KAAK,WAAW,OAAOA,EAAK,CAAC,EAGvBC,EAAQ,WACd,KAAK,cAAc,EAEpB,KAAK,KAAK,mBAAoBA,CAAO,CACtC,CAGA,YAAY5d,EAA8BS,EAAe,CACxD,GAAK,CAAE,KAAK,QACX,MAAM,IAAI,MAAM,iFAAiF,EAElG,GAAK,OAAOT,GAAO,UAAY,OAAOA,EAAG,IAAO,SAC/CA,EAAKA,EAAG,WACC,OAAOA,GAAO,SACvB,MAAM,IAAI,MAAM,iBAAiB,EAElC,MAAM4d,EAAU,KAAK,cAAc5d,CAAE,EACrC,GAAK,CAAE4d,EACN,OAED,MAAMspB,EAAW,KAAK,WACrBvpB,EAAMupB,EAAS,QAAQtpB,CAAO,EAC1BD,IAAQld,IAGbymC,EAAS,OAAOzmC,EAAO,EAAG,GAAGymC,EAAS,OAAOvpB,EAAK,CAAC,CAAC,EAG7CC,EAAQ,WACd,KAAK,cAAc,EAEpB,KAAK,KAAK,qBAAqB,EAChC,CAGA,YAAY5d,EAA8B,CACzC,GAAK,CAAE,KAAK,QACX,MAAM,IAAI,MAAM,gFAAgF,EAEjG,GAAK,OAAOA,GAAO,UAAY,OAAOA,EAAG,IAAO,SAC/CA,EAAKA,EAAG,WACC,OAAOA,GAAO,SACvB,MAAM,IAAI,MAAM,iBAAiB,EAElC,MAAM4d,EAAU,KAAK,cAAc5d,CAAE,EAC9B4d,IAIAA,EAAQ,WACd,KAAK,cAAc,EAEpB,KAAK,KAAK,mBAAoBA,CAAO,EACtC,CAGA,eAAgB,CACf,MAAM7e,EAAM,KAAK,WACf,OAAOq7D,GAAQ,CAAEA,EAAK,SAAS,EAC/B,IAAIA,GAAQA,EAAK,IAAI,EAGvB,GAAK,CAAEr7D,EAAM,CACZ,KAAK,cAAc,CAClB,KAAM,kBACN,SAAU,2BACV,YAAa,2CACd,CAAC,EAGD,MACD,CAEA,KAAK,UAAU,IAAI,WAAYA,CAAG,EAClC,UAAUL,KAAW,KAAK,WACzBA,EAAQ,eAAe,EAExB,KAAK,YAAY,CAClB,CAOA,QAAQq3D,EAAkB,CACzB,OAAO,KAAK,aAAa,QAAQA,CAAG,CACrC,CAEA,IAGE33D,EAAgB,CACjB,OAAO,KAAK,aAAa,IAAIA,CAAG,CACjC,CAEA,WAICA,EACA+E,EACAua,EACC,CAAE,OAAO,KAAK,aAAa,WAAWtf,EAAK+E,EAAIua,CAAG,CAAG,CAEvD,SAICtf,EACA+E,EACAua,EACC,CAAE,OAAO,KAAK,aAAa,SAAStf,EAAK+E,EAAIua,CAAG,CAAG,CAErD,KAAgCtf,EAAQ,CAAE,OAAO,KAAK,aAAa,KAAKA,CAAG,CAAE,CAC7E,OAA+BA,EAAQ,CAAE,OAAO,KAAK,aAAa,OAAOA,CAAG,CAAE,CAE9E,cAAcM,EAAsB,CAAE,OAAO,KAAK,aAAa,cAAcA,CAAO,CAAE,CACtF,WAAWA,EAAsB,CAAE,OAAO,KAAK,aAAa,WAAWA,CAAO,CAAE,CAOhF,cAAcwiB,EAAkBG,EAAkBnjB,EAAuB,CACxE,GAAK,CAAEgjB,EACN,OAAO,KAER,MAAMzI,EAAiC,CAAC,EACvC8I,EAAS,SAASF,GAAO,IAE1B,OAAA5I,EAAU,IAAM,CAGdra,EAAQ+jB,IACF,KAAK,IAAI/jB,EAAK+jB,EAAYjB,CAAQ,EAI1CzI,EAAU,MAAQ,CAGhBra,EAAQ+jB,IACF,KAAK,MAAM/jB,EAAK+jB,EAAYjB,CAAQ,EAG5CzI,EAAU,aAAe,CAACra,EAAa+jB,IAC/B,KAAK,aAAa/jB,EAAK+jB,EAAYjB,CAAQ,KAG5C,mBAAgBhjB,EAAQ,KAAM,WAAYua,CAAS,CAC3D,CAMA,IAGEra,EAAQ+jB,EAAuCkH,EAAiB,CAEjE,MAAM+0C,EAAiB,KAAK,YAAY,IAAIhgE,CAAG,EAC9CigE,GAAe,MAAM,QAAQD,CAAc,EACxCA,EACAA,GAAgB,cAAgB,CAAC,EAErCj8C,EAAW,YAAck8C,EACzBl8C,EAAW,SAAWA,EAAW,UAAY,CAAC,EAE9CA,EAAW,SAAWkH,EAEtB,UAAU2wC,KAAW73C,EAAW,SAAU,CACzC,MAAM/hB,EAAM,KAAK,YAAY,IAAI45D,CAAO,EACnC,MAAM,QAAQ55D,CAAG,EACrBA,EAAI,KAAKhC,CAAG,EACHgC,EACTA,EAAI,aAAa,KAAKhC,CAAG,EAEzB,KAAK,YAAY,IAAI47D,EAAS,CAAC57D,CAAG,CAAC,CACrC,CAGA,GAAK+jB,EAAW,GAAK,CACpB,MAAMm8C,EAAKn8C,EAAW,GAOtB,GANAm8C,EAAG,YAAcA,EAAG,YACnBC,EAAmBD,EAAG,WAAW,EACjCA,EAAG,QACF,KAAWA,EAAG,IAAI,EAClB,OAEGj1C,GAAUi1C,EAAG,aAAeA,EAAG,YAAY,QAAU,GAAKA,EAAG,YAAY,CAAC,EAAE,MAAQ,UAAY,CACpG,MAAM51C,EAAS,KAAK,QAAQ,QAAQ,EACnCrH,EAAQqH,GAAQ,SAASW,CAAM,EAEhC,GAAKhI,EAAQ,CACZ,MAAM2U,EAAOsoC,EAAG,YAAY,CAAC,EAC5BE,EAAkB,CAAC,EAEpBA,EAAM,KAAK,qBAAqBn1C,CAAM,EAAE,EACnChI,EAAM,YACVm9C,EAAM,KAAK,qBAAqBn9C,EAAM,WAAW,YAAY,CAAC,EAAE,EAC5DA,EAAM,MACVm9C,EAAM,KAAK,qBAAqBn9C,EAAM,KAAK,YAAY,CAAC,EAAE,EAE3D2U,EAAK,aAAe,CACnB,CACC,SAAUwoC,EACV,SAAU,iBACV,MAAO,WACR,CACD,CACD,CACD,CAQA,GANK,CAAEF,EAAG,KAAOlgE,IAChBkgE,EAAG,IAAMlgE,GAEL,CAAEkgE,EAAG,KAAOA,EAAG,QACnBA,EAAG,IAAMA,EAAG,MAAM,YAAY,IAEzBA,EAAG,YAAc,sBACpBA,EAAG,YAAc,sBACnB,MAAM,QAAQA,EAAG,IAAI,GAAK,CAAEA,EAAG,QAC9B,CACD,MAAMG,EAAY,GAAGH,EAAG,UAAY,iBAAiBlgE,CAAG,EAAE,UAC1D,UAAU4L,KAASs0D,EAAG,KAChBt0D,EAAM,WAAa,QAAaA,EAAM,QAAU,SACpDA,EAAM,SAAW,GAAGy0D,CAAS,IAAIz0D,EAAM,KAAK,GAE/C,CACD,CAEKmY,EAAW,SACf,KAAK,GAAG,YAAY/jB,CAAG,GAAW+jB,EAAW,OAAO,EAErD,KAAK,YAAY,IAAI/jB,EAAK+jB,CAAU,GAI/B,CAAEi8C,GAAkB,MAAM,QAAQA,CAAc,IACpD,KAAK,KAAK,oBAAqBhgE,EAAK+jB,CAAU,CAChD,CAGA,OAAO/jB,EAAa,CACnB,MAAM+jB,EAAa,KAAK,YAAY,IAAI/jB,CAAG,EAC3C,GAAO+jB,GAIF,OAAM,QAAQA,CAAU,EAU7B,IANK,MAAM,QAAQA,EAAW,WAAW,GAAKA,EAAW,YAAY,OAAS,EAC7E,KAAK,YAAY,IAAI/jB,EAAK+jB,EAAW,WAAW,EAEhD,KAAK,YAAY,OAAO/jB,CAAG,EAGvB,MAAM,QAAQ+jB,EAAW,QAAQ,EACrC,UAAU63C,KAAW73C,EAAW,SAAU,CACzC,IAAI/hB,EAAM,KAAK,YAAY,IAAI45D,CAAO,EACtC,GAAK,MAAM,QAAQ55D,CAAG,EAAI,CACzB,MAAMud,EAAMvd,EAAI,QAAQhC,CAAG,EACtBuf,IAAQ,IACZvd,EAAI,OAAOud,EAAK,CAAC,CAEnB,MAAYvd,GAAK,cAChBA,EAAMA,EAAI,YACZ,CAEI+hB,EAAW,SACf,KAAK,IAAI,YAAY/jB,CAAG,GAAW+jB,EAAW,OAAO,EAEtD,KAAK,KAAK,sBAAuB/jB,EAAY+jB,CAAU,EACxD,CAIA,MAGE/jB,EAAQ+jB,EAAkDkH,EAAiB,CAE5E,IAAIjI,EACEe,EAAmB,GACxBf,EAAOe,EAEPf,EAAM,CACL,GAAIe,CACL,EAEDf,EAAI,SAAWiI,EAEf,MAAMi1C,EAAKl9C,EAAI,GACfk9C,EAAG,YAAcA,EAAG,YACnBC,EAAmBD,EAAG,WAAW,EACjCA,EAAG,QACF,KAAWA,EAAG,IAAI,EAClB,OAEG,CAAEA,EAAG,KAAOA,EAAG,QACnBA,EAAG,IAAMA,EAAG,MAAM,YAAY,GAE/B,MAAMF,EAAiB,KAAK,cAAc,IAAIhgE,CAAG,EACjD,KAAK,cAAc,IAAIA,EAAKgjB,CAAG,EAIxBg9C,GACN,KAAK,KAAK,oBAAqBhgE,EAAYgjB,CAAG,CAChD,CAGA,aAAahjB,EAAiD+jB,EAAgCkH,EAAiB,CAC9G,GAAK,OAAOjrB,GAAQ,SAAW,CAC9B,SAAU,CAACyxC,EAAG7lC,CAAK,IAAK,OAAO,QAAQ5L,CAAG,EACzC,KAAK,aAAayxC,EAAG7lC,EAAOqf,CAAM,EACnC,MACD,SAAY,OAAOjrB,GAAQ,SAC1B,MAAM,IAAI,MAAM,aAAa,EAEzB+jB,IACJA,EAAW,SAAWkH,EACtB,KAAK,WAAWjrB,CAAG,EAAI+jB,EAEzB,CAEA,eAAgB,CACf,SAAO,aAAU,KAAK,UAAU,CACjC,CAGA,aAAa/jB,EAAqDsgE,EAAmC,CACpG,GAAK,OAAOtgE,GAAQ,SAAW,CAC9B,SAAU,CAACyxC,EAAG7lC,CAAK,IAAK,OAAO,QAAQ5L,CAAG,EACzC,KAAK,aAAayxC,EAAG7lC,CAAK,EAC3B,MACD,SAAY,OAAO5L,GAAQ,SAC1B,MAAM,IAAI,MAAM,aAAa,EAEzBsgE,IACJ,KAAK,WAAWtgE,CAAG,EAAIsgE,EACzB,CAEA,aAAgBtgE,EAAyC,CACxD,OAAO,KAAK,WAAWA,CAAG,GAAK,IAChC,CAEA,eAAgB,CACf,SAAO,aAAU,KAAK,UAAU,CACjC,CAEA,aAAaA,EAAqDugE,EAAmC,CACpG,GAAK,OAAOvgE,GAAQ,SAAW,CAC9B,SAAU,CAACyxC,EAAG7lC,CAAK,IAAK,OAAO,QAAQ5L,CAAG,EACzC,KAAK,aAAayxC,EAAG7lC,CAAK,EAC3B,MACD,SAAY,OAAO5L,GAAQ,SAC1B,MAAM,IAAI,MAAM,aAAa,EAEzBugE,IACJ,KAAK,WAAWvgE,CAAG,EAAIugE,EACzB,CAEA,aAAgBvgE,EAAyC,CACxD,OAAO,KAAK,WAAWA,CAAG,GAAK,IAChC,CAEA,eAAgB,CACf,SAAO,aAAU,KAAK,UAAU,CACjC,CACD,EAz0CgF,uBAAjE,IAAMwgE,EAAN,EA40CR,SAASL,EAAmB9lC,EAA+B,CACjE,QAAQtoB,EAAE,EAAGvP,EAAI63B,EAAO,OAAQtoB,EAAIvP,EAAGuP,IAAK,CAC3C,MAAMiQ,EAAQqY,EAAOtoB,CAAC,EACtB,GAAK,OAAOiQ,GAAU,SAAW,CAChCqY,EAAOtoB,CAAC,EAAI,CACX,IAAKiQ,EAAM,YAAY,EACvB,MAAOA,CACR,EAEA,QACD,CAEOA,EAAM,MACZA,EAAM,IAAMA,EAAM,MAAM,YAAY,EACtC,CAEA,OAAOqY,CACR,CAjBgB,EAAA8lC,EAAA,qB,4ECl6ChB,MAAMM,EAAM,OAAO,KAAK,EAGxB,SAASC,EACR5uC,EACA6uC,EACA58C,EACE,CAIF,IAHK,OAAO+N,GAAU,UAAY,MAAMA,CAAK,GAAK,CAAE,SAASA,CAAK,KACjEA,EAAQ2uC,GAEJ3uC,IAAU2uC,EAAM,CACpB,MAAMG,EAAS78C,EAAW,OACrB,MAAM,QAAQ68C,CAAM,IACnBA,EAAO,QAAU,IAEfA,EAAO,CAAC,EAAK9uC,EAAQ8uC,EAAO,CAAC,EAAM9uC,GAAS8uC,EAAO,CAAC,KAEvDA,EAAO,CAAC,EAAK9uC,EAAS8uC,EAAe,CAAC,EAAM9uC,GAAU8uC,EAAe,CAAC,MACxE9uC,EAAQ2uC,GAEEG,EAAO,SAAW,EAExB,OAAOA,EAAO,CAAC,GAAM,WACpBA,EAAO,CAAC,EAAI9uC,EAAQ8uC,EAAO,CAAC,EAAI9uC,GAAS8uC,EAAO,CAAC,KACrD9uC,EAAQ2uC,IACE3uC,EAAQ8uC,EAAO,CAAC,GAAK9uC,EAAQ8uC,EAAO,CAAC,KAChD9uC,EAAQ2uC,GACEG,EAAO,SAAW,GAAK9uC,EAAQ8uC,EAAO,CAAC,IAClD9uC,EAAQ2uC,GAEX,CAEA,OAAO3uC,IAAU2uC,EAAME,EAAgB7uC,CACxC,CA/BS,EAAA4uC,EAAA,aAiCF,MAAMG,EAAmC,GAC/Cj1D,EACA+0D,EACA58C,KAEK,OAAOnY,GAAU,UAAY,UAAU,KAAKA,CAAK,EACrDA,EAAQ,SAASA,EAAO,EAAE,EACjB,OAAOA,GAAU,WAC1BA,EAAQ60D,GAEFC,EAAU90D,EAAiB+0D,EAAe58C,CAAU,GAVZ,UAanC+8C,EAAqC,GACjDl1D,EACA+0D,EACA58C,KAEK,OAAOnY,GAAU,UAAY,aAAa,KAAKA,CAAK,EACxDA,EAAQ,WAAWA,CAAK,EACf,OAAOA,GAAU,WAC1BA,EAAQ60D,GAEFC,EAAU90D,EAAiB+0D,EAAe58C,CAAU,GAVV,W,sFCrBnC,MAAM,EAAN,MAAM,UAAwB,cAA4B,CA8HxE,YAAYmZ,EAA0BtpB,EAAwC,CAC7E,MAAM,EA5FP,KAAQ,SAAoB,GAO5B,eAAqB,GAMrB,QAAa,GAKb,UAAe,KAQf,UAAe,KAiCf,mBAAyB,GAGzB,iBAAuB,GAoBvB,KAAQ,gBAA4B,GAYnC,KAAK,WAAa,KAAK,WAAW,KAAK,IAAI,EAC3C,KAAK,gBAAkB,GAEvB,KAAK,QAAUspB,EACf,KAAK,SAAWA,EAAQ,SAExB,KAAK,KAAOtpB,EACZ,KAAK,OAAS,KAAK,KAAK,EAAE,IAC1B,KAAK,YAAc,GAAG,KAAK,MAAM,WAE5B,KAAK,YACT,KAAK,SAAW,GAChB,KAAK,SAAW,IAAI,IAEtB,CAEA,IAAI,MAAyC,CAC5C,MAAO,CACN,GAAI,KAAK,GAET,KAAM,KAAK,KAEX,KAAM,KAAK,KACX,SAAU,KAAK,SACf,OAAQ,KAAK,OACb,cAAe,KAAK,cAEpB,UAAW,KAAK,UAEhB,YAAa,KAAK,YAClB,cAAe,KAAK,cAEpB,IAAK,KAAK,IACV,YAAa,KAAK,YAElB,QAAS,KAAK,OACf,CACD,CAEA,IAAI,KAAK3T,EAAK,CACb,GAAK,OAAOA,GAAQ,SACnB,MAAM,IAAI,UAAU,wBAAwB,EAE7C,KAAK,aAAa,EAGbA,EAAI,YACR,KAAK,UAAY,IAGlB,SAAU,CAACD,EAAK4L,CAAK,IAAK,OAAO,QAAQ3L,CAAG,EAC1C,KAAaD,CAAG,EAAI4L,CACvB,CAGA,cAAe,CACd,KAAK,QAAU,IAChB,CAGA,QAAQtL,EAAsB,CAC7B,OAAO,KAAK,UACX,KAAK,WAAU,gBACd,KAAK,QACL,KAAK,QAAQ,QACb,GACA,GACA,IAAM,KAAK,QAAQ,WAAW,CAC/B,GAEM,KAAK,QAAQA,CAAO,CAC5B,CAGA,MAAO,CACC,KAAK,WACX,KAAK,QAAQ,YAAY,KAAK,EAAE,CAClC,CAGA,WAAqC,CACpC,MAAMK,EAA+B,CACpC,QAAS,EACT,KAAM,UACN,QAAS,KAAK,KACd,QAAS,KAAK,QACd,OAAQ,CAAC,CACV,EAEA,OAAOA,EAAI,QAAQ,UAEnB,SAAU,CAACX,EAAK4L,CAAK,IAAK,KAAK,QAAQ,EACtCjL,EAAI,OAAOX,CAAG,EAAI4L,EAEnB,OAAOjL,CACR,CAGA,MAAM,aAAc,CACnB,GAAK,CAAE,KAAK,KAAO,KAAK,cACvB,MAAO,GAER,MAAMiT,EAAO,QAAM,aAAmC,KAAK,GAAG,EAC9D,GAAK,CAAEA,GAAQA,EAAK,OAAS,WAAa,CAAEA,EAAK,SAAW,CAAEA,EAAK,OAClE,MAAO,GAGR,OAAOA,EAAK,QAAQ,UACpB,OAAOA,EAAK,QAAQ,GACpB,OAAOA,EAAK,QAAQ,KACpB,OAAOA,EAAK,QAAQ,KACpB,OAAOA,EAAK,QAAQ,SACpB,OAAOA,EAAK,QAAQ,OACpB,OAAOA,EAAK,QAAQ,YACpB,OAAOA,EAAK,QAAQ,cACpB,OAAOA,EAAK,QAAQ,IACpB,OAAOA,EAAK,QAAQ,cAEpB,KAAK,KAAOA,EAAK,QAEjB,MAAM+pB,EAAW,IAAI,IAAI,KAAK,KAAK,CAAC,EAEpC,SAAU,CAAC39B,EAAK4L,CAAK,IAAK,OAAO,QAAQgI,EAAK,MAAM,EACnD+pB,EAAS,OAAO39B,CAAG,EACnB,KAAK,IAAIA,EAAK4L,CAAK,EAGpB,UAAU5L,KAAO29B,EAChB,KAAK,OAAO39B,CAAG,EAEhB,MAAO,EACR,CAOA,IAAI,QAAS,CACZ,OAAO,KAAK,OACb,CAEA,IAAI,OAAOA,EAAK,CACVA,IAAQ,KAAK,UAGlB,KAAK,QAAUA,EACV,KAAK,iBACT,KAAK,cAAc,EACrB,CAEA,IAAI,gBAAiB,CACpB,OAAO,KAAK,eACb,CAEA,IAAI,eAAeC,EAAK,CACvB,KAAK,gBAAkB,CAAC,CAAEA,EAC1B,KAAK,cAAc,CACpB,CAEA,eAAgB,CACf,MAAM0rC,EAAY,KAAK,UAAY,KAAK,WAAa,OAAO,UAC5D,GAAK,CAAEA,EACN,OAED,MAAM3rC,EAAM,KAAK,QAEZ,KAAK,aAAe,KAAK,aAAeA,GAAO,CAAE,KAAK,mBAC1D2rC,EAAU,OAAO,KAAK,UAAU,EAChC,KAAK,WAAa,MAGZ,KAAK,iBAGP3rC,MAAO,mBAAgBA,CAAG,IAC9B2rC,EAAU,KAAK3rC,EAAK,KAAK,UAAU,EACnC,KAAK,WAAaA,EAEpB,CAEA,WAAWogB,EAAsB,CAChC,KAAK,QAAU,CAAE,KAAK,QAEjBA,IACJA,EAAM,gBAAgB,EACtBA,EAAM,eAAe,EAEvB,CAOA,IAAI,SAAU,CACb,OAAK,KAAK,UACF,KAAK,SACN,KAAK,SAAS,IAAI,KAAK,YAAa,EAAI,CAChD,CAEA,IAAI,QAAQngB,EAAK,CACXA,IAAQ,KAAK,UAGb,KAAK,UACT,KAAK,SAAWA,EAEhB,KAAK,SAAS,IAAI,KAAK,YAAaA,CAAG,EAExC,KAAK,KAAK,UAAW,KAAMA,CAAG,EAC/B,CAkBA,WAAWK,EAAwB,CAClC,GAAK,KAAK,KAAO,EAChB,MAAM,IAAI,MAAM,uCAAuC,EAExD,KAAK,QAAUA,EACf,KAAK,aAAa,EAClB,KAAK,KAAK,CACX,CAUA,IAAON,EAAa2gE,EAA6B,CAChD,OAAK,KAAK,UACJ,KAAK,UAAY,KAAK,SAAS,IAAI3gE,CAAG,EACnC,KAAK,SAAS,IAAIA,CAAG,EAEtB2gE,GAAiB,KAGlB,KAAK,SAAS,IAAO,KAAK,OAAS3gE,EAAK2gE,CAAkB,CAClE,CAEA,IAAI3gE,EAAa4L,EAAgB,CAC3B,KAAK,UACJ,KAAK,UACT,KAAK,SAAS,IAAI5L,EAAK4L,CAAK,EAE7B,KAAK,SAAS,IAAI,KAAK,OAAS5L,EAAK4L,CAAK,EAE3C,KAAK,KAAK,UAAW5L,EAAK4L,EAAO,EAAK,CACvC,CAEA,OAAO5L,EAAa,CACd,KAAK,UACJ,KAAK,UACT,KAAK,SAAS,OAAOA,CAAG,EAEzB,KAAK,SAAS,OAAO,KAAK,OAASA,CAAG,EACvC,KAAK,KAAK,UAAWA,EAAK,OAAW,EAAI,CAC1C,CAEA,IAAIA,EAAa,CAChB,OAAK,KAAK,UACF,KAAK,SAAW,KAAK,SAAS,IAAIA,CAAG,EAAG,GACzC,KAAK,SAAS,IAAI,KAAK,OAASA,CAAG,CAC3C,CAEA,MAAO,CACN,GAAK,KAAK,UACT,OAAO,KAAK,SAAW,MAAM,KAAK,KAAK,SAAS,KAAK,CAAC,EAAI,CAAC,EAE5D,MAAMW,EAAM,CAAC,EACZP,EAAI,KAAK,OACTuM,EAAMvM,EAAE,OAET,UAAUJ,KAAO,KAAK,SAAS,KAAK,EAC9BA,EAAI,WAAWI,CAAC,GAAKJ,IAAQ,KAAK,aACtCW,EAAI,KAAKX,EAAI,MAAM2M,CAAG,CAAC,EAEzB,OAAOhM,CACR,CAEA,OAAQ,CACP,GAAK,KAAK,UAAY,CACrB,GAAK,KAAK,SAAW,CACpB,MAAMsY,EAAO,KAAK,KAAK,EACvB,KAAK,SAAS,MAAM,EACpB,UAAUjZ,KAAOiZ,EAChB,KAAK,KAAK,UAAWjZ,EAAK,OAAW,EAAI,CAE3C,CAEA,MACD,CAEA,MAAMI,EAAI,KAAK,OACduM,EAAMvM,EAAE,OACT,UAAUJ,KAAO,KAAK,SAAS,KAAK,EAC9BA,EAAI,WAAWI,CAAC,GAAKJ,IAAQ,KAAK,cACtC,KAAK,SAAS,OAAOA,CAAG,EACxB,KAAK,KAAK,UAAWA,EAAI,MAAM2M,CAAG,EAAG,OAAW,EAAI,EAEvD,CAEA,CAAC,SAAU,CACV,GAAK,KAAK,WACT,GAAK,KAAK,SACT,UAAUoT,KAAS,KAAK,SAAS,QAAQ,EACxC,MAAMA,MAGF,CACN,MAAM3f,EAAI,KAAK,OACduM,EAAMvM,EAAE,OAET,UAAUJ,KAAO,KAAK,SAAS,KAAK,EAC9BA,EAAI,WAAWI,CAAC,GAAKJ,IAAQ,KAAK,cAEtC,KAD+B,CAACA,EAAI,MAAM2M,CAAG,EAAG,KAAK,SAAS,IAAI3M,CAAG,CAAC,EAGzE,CACD,CAEA,IAAI,MAAO,CACV,GAAK,KAAK,UACT,OAAO,KAAK,SAAW,KAAK,SAAS,KAAO,EAE7C,MAAMI,EAAI,KAAK,OACf,IAAIwyB,EAAQ,EAEZ,UAAU5yB,KAAO,KAAK,SAAS,KAAK,EAC9BA,EAAI,WAAWI,CAAC,GAAKJ,IAAQ,KAAK,aACtC4yB,IAEF,OAAOA,CACR,CACD,EAheyE,uBAA1D,IAAMmuC,EAAN,EAAMA,EAEb,QAA4C,CAClD,GAAI,EACJ,KAAM,sBACN,KAAM,kBACN,SAAU,2BAEV,YAAa,2CACd,EAToBA,EAYb,WAA+C,CACrD,GAAI,EACJ,KAAM,yBACN,KAAM,aACN,SAAU,8BAEV,YAAa,uEAEb,QAAS,CACR,CACC,KAAM,YACN,KAAM,EACP,CACD,CACD,C,mBzH1DD,Q,iG0HeA,MAAMC,EAAa,EAClBC,EAAiB,OAAO,SAAS,OAAS,gBAC1CC,EAAa,OAAO,SAAS,OAAS,kBA4BjB,EAAf,MAAe,UAAyB,cAA6B,CAoB3E,YAAYhkC,EAA0B,CACrC,MAAM,EAPP,KAAU,MAAiB,GAS1B,KAAK,QAAUA,EACf,KAAK,SAAW,EACjB,CAEA,OAAO,WAAY,CAClB,MAAO,EACR,CAKA,YAAa,CACZ,OAAK,KAAK,MACF,QAAQ,QAAQ,EAEjB,QAAQ,OAAO,IAAI,MAAM,iBAAiB,CAAC,CACnD,CAEA,IAAI,eAAgB,CACnB,OAAQ,KAAK,YAAwC,aACtD,CAEA,IAAI,cAAe,CAClB,OAAQ,KAAK,YAAwC,YACtD,CAkCD,EAjF4E,wBAArE,IAAeikC,EAAf,EAAeA,EAId,SAAmB,EAJLA,EA+Bd,cAAgB,GA/BFA,EAgCd,aAAe,GAoDhB,MAAe,EAAf,MAAe,UAAiCA,CAAiB,CAEvE,IAAI,eAAgB,CAAE,MAAO,EAAM,CAEnC,YAAY3C,EAA6B,CACxC,OAAO,KAAK,kBAAiB,eAAYA,CAAI,CAC9C,CASD,EAfwE,gCAAjE,IAAe4C,EAAf,EAkBA,MAAe,EAAf,MAAe,UAA+BA,CAAyB,CAe7E,YAAYlkC,EAA0B,CACrC,MAAMA,CAAO,EAEb,KAAK,YAAc,YAAY,IAAI,EAEnC,KAAK,KAAO,IAAI,IAEhB,KAAK,QAAU,IAAI,IACnB,KAAK,eAAiB,GACtB,KAAK,MAAQ,GACb,KAAK,YAAc,KAEnB,KAAK,OAAS,KACd,KAAK,SAAW,CACjB,CAEA,IAAI,eAAgB,CACnB,OAAO,KAAK,QAAU,EACvB,CAIA,mBAAoB,CAEpB,CAEA,eAAgB,CAEhB,CAKU,aAAa9B,EAAkBxnB,EAAY,CAC/C,KAAK,SACT,KAAK,QAAQ,IAAI,KAAK,GAAG,KAAK,YAAY,IAAI,cAAc,YAAY,IAAI,EAAI,KAAK,aAAa,QAAQ,CAAC,CAAC,IAAI,EAEjH,KAAK,eAAiB,GACtB,KAAK,MAAQwnB,EAERA,GAAW,KAAK,oBACpB,KAAK,oBAAoB,EAChB,CAAEA,GAAW,KAAK,kBAC3B,KAAK,iBAAiBxnB,CAAI,CAC5B,CAEA,YAAa,CACZ,OAAK,KAAK,eACJ,KAAK,MACF,QAAQ,QAAQ,EACjB,QAAQ,OAAO,EAGlB,KAAK,YACF,KAAK,YAEN,KAAK,YAAc,IAAI,QAAc,CAAC3O,EAASo8D,IAAS,CAC9D,KAAK,oBAAsBp8D,EAC3B,KAAK,iBAAmBo8D,CAEzB,CAAC,EAAE,QAAQ,IAAM,CAChB,KAAK,YAAc,KACnB,KAAK,oBAAsB,KAC3B,KAAK,iBAAmB,IACzB,CAAC,CACF,CAKA,IAAOrhE,EAAa2gE,EAAsB,CACzC,OAAO,KAAK,QAAQ,IAAI3gE,CAAG,EACxB,KAAK,QAAQ,IAAIA,CAAG,EACpB2gE,CACJ,CAEA,IAAI3gE,EAAa4L,EAAY,CAC5B,GAAKA,IAAU,OAAY,CACrB,KAAK,IAAI5L,CAAG,GAChB,KAAK,OAAOA,CAAG,EAChB,MACD,CAEA,KAAK,QAAQ,IAAIA,EAAK4L,CAAK,EAC3B,KAAK,IAAI,CAAC,SAAU,MAAO,IAAA5L,EAAK,MAAA4L,CAAK,CAAC,EACpC,MAAMkV,GAAO,KAAK,QAAQ,IAAI,MAAM,sBAAuBA,CAAG,CAAC,EACjE,KAAK,KAAK,MAAO9gB,EAAK4L,EAAO,EAAK,CACnC,CAEA,OAAO5L,EAAa,CACnB,KAAK,QAAQ,OAAOA,CAAG,EACvB,KAAK,IAAI,CAAC,SAAU,SAAU,IAAAA,CAAG,CAAC,EAChC,MAAM8gB,GAAO,KAAK,QAAQ,IAAI,MAAM,uBAAwBA,CAAG,CAAC,EAClE,KAAK,KAAK,MAAO9gB,EAAK,OAAW,EAAI,CACtC,CAEA,OAAQ,CACP,MAAM86D,EAAY,KAAK,QACvB,KAAK,QAAU,IAAI,IACnB,UAAU96D,KAAO86D,EAAU,KAAK,EAC/B,KAAK,KAAK,UAAW96D,EAAK,OAAW,EAAI,EAE1C,KAAK,IAAI,OAAO,EACd,MAAM8gB,GAAO,KAAK,QAAQ,IAAI,MAAM,yBAA0BA,CAAG,CAAC,CACrE,CAEA,IAAI9gB,EAAa,CAAE,OAAO,KAAK,QAAQ,IAAIA,CAAG,CAAG,CACjD,MAAO,CAAE,OAAO,KAAK,QAAQ,KAAK,CAAG,CACrC,SAAU,CAAE,OAAO,KAAK,QAAQ,QAAQ,CAAG,CAC3C,IAAI,MAAO,CAAE,OAAO,KAAK,QAAQ,IAAM,CAEvC,MAAM,OAAQ,CACb,MAAM,KAAK,IAAI,OAAO,CACvB,CAKA,MAAM,QAAQA,EAAa,CAC1B,MAAMK,EAAM,MAAM,KAAK,IAAI,CAAC,SAAU,WAAY,IAAAL,CAAG,CAAC,EACtD,OAAOK,KAAM,mBAAgBA,CAAG,EAAI,IACrC,CAEA,MAAM,QAAQL,EAAa4L,EAAiB,CAC3C,MAAM,KAAK,IAAI,CACd,SAAU,WACV,IAAA5L,EACA,MAAO,QAAM,iBAAc4L,CAAK,CACjC,CAAC,CACF,CAEA,MAAM,WAAW5L,EAAa,CAC7B,MAAM,KAAK,IAAI,CACd,SAAU,cACV,IAAAA,CACD,CAAC,CACF,CAEA,MAAM,QAAQA,EAAa,CAC1B,OAAO,KAAK,IAAI,CAAC,SAAU,WAAY,IAAAA,CAAG,CAAC,CAC5C,CAEA,MAAM,YAAa,CAClB,MAAM,KAAK,IAAI,aAAa,CAC7B,CAEA,MAAM,UAAW,CAChB,OAAO,KAAK,IAAI,WAAW,CAC5B,CAOA,IACCK,EACAu+D,EACC,CACD,MAAMh9D,EAAK,EAAE,KAAK,SAElB,OAAO,IAAI,QAAuB,CAACqD,EAAQo8D,IAAS,CACnD,KAAK,KAAK,IAAIz/D,EAAI,CAACqD,EAASo8D,CAAI,CAAC,EACjC,IAAI1gE,EACC,OAAON,GAAQ,SACnBM,EAAM,CAAC,SAAUN,CAAG,EAEpBM,EAAMN,EAEPM,EAAI,GAAKiB,EACT,KAAK,KAAKjB,EAAKi+D,CAAQ,CACxB,CAAC,CACF,CAEA,cAAcv+D,EAAkB,CAC1BA,EAAI,WAAa,QACrB,KAAK,IAAI,WAAW,EAAE,KAAKA,GAAO,CACjC,KAAK,OAASA,EAAI,MAClB,SAAU,CAACL,EAAK4L,CAAK,IAAK,OAAO,QAAQvL,EAAI,MAAM,EAClD,KAAK,QAAQ,IAAIL,EAAK4L,CAAK,EAE5B,KAAK,aAAa,EAAI,CAEvB,CAAC,EAAE,MAAMkV,GAAO,CACf,KAAK,aAAa,GAAOA,CAAG,CAC7B,CAAC,EAEQzgB,EAAI,WAAa,SAC1B,KAAK,SAASA,CAAG,EAERA,EAAI,WAAa,cAC1B,KAAK,KAAK,eAAgBA,EAAI,IAAKA,EAAI,OAAO,EAErCA,EAAI,WAAa,cAC1B,KAAK,KAAK,aAAa,EAEdA,EAAI,WAAa,SAAWA,EAAI,WAAa,cACtD,KAAK,QAAQA,CAAG,EAGhB,KAAK,QAAQ,IAAI,KAAK,kBAAmBA,EAAI,SAAUA,CAAG,CAC5D,CAEA,SAASA,EAAgC,CACxC,MAAML,EAAMK,EAAI,IACfuL,EAAQvL,EAAI,MACFA,EAAI,SAGd,KAAK,QAAQ,OAAOL,CAAG,EACvB,KAAK,KAAK,UAAWA,EAAK,OAAW,EAAI,IAEzC,KAAK,QAAQ,IAAIA,EAAK4L,CAAK,EAC3B,KAAK,KAAK,UAAW5L,EAAK4L,EAAO,EAAK,EAExC,CAEA,QAAQvL,EAA+C,CACtD,MAAMuB,EAAKvB,EAAI,GACd+6B,EAAU/6B,EAAI,WAAa,QAC3Bi7B,EAAM,KAAK,KAAK,IAAI15B,CAAE,EACvB,GAAK,CAAE05B,EACN,OAAO,KAAK,QAAQ,IAAI,KAAK,gCAAiC15B,CAAE,EAEjE,KAAK,KAAK,OAAOA,CAAE,EACdw5B,EACJE,EAAI,CAAC,EAAEj7B,EAAI,KAAK,EAEhBi7B,EAAI,CAAC,EAAE,CACT,CACD,EArP8E,8BAAvE,IAAegmC,EAAf,EA+PA,MAAM,EAAN,MAAM,UAA6BH,CAAiB,CAgC1D,YAAYjkC,EAA0BtE,EAAiB,CACtD,MAAMsE,CAAO,EACb,KAAK,OAAStE,EAASA,GAAiB,eAExC,MAAM4W,EAAQ,KAAK,QAAU,IAAI,IAChC7iC,EAAMisB,EAAO,OAEd,UAAU54B,KAAO,aAChB,MAAK,OAAI,aAAcA,CAAG,GAAKA,EAAI,WAAW44B,CAAM,EAAI,CACvD,MAAM34B,EAAM,aAAa,QAAQD,CAAG,EACpC,GAAKC,EACJ,GAAI,CACHuvC,EAAM,IAAIxvC,EAAI,MAAM2M,CAAG,EAAG,KAAK,MAAM1M,CAAG,CAAC,CAC1C,MAAa,CACZ,KAAK,QAAQ,IAAI,KAAK,6BAA6BD,CAAG,GAAIC,CAAG,CAC9D,CACF,CAED,KAAK,MAAQ,GAER,OAAO,kBACA,KAAK,aAAe,IAAI,iBAAiB,cAAc,GAC/D,iBAAiB,UACnB,KAAK,oBAAsB,KAAK,cAAc,KAAK,IAAI,CAAC,EAGzD,OAAO,iBAAiB,UACvB,KAAK,oBAAsB,KAAK,cAAc,KAAK,IAAI,CAAC,CAE3D,CArDA,OAAO,WAAY,CAClB,MAAO,EACR,CAEA,OAAO,WAAW24B,EAAiB,CAC3BA,IACNA,EAAS,gBAEV,UAAU54B,KAAO,aAChB,GAAKA,EAAI,WAAW44B,CAAM,MAAK,OAAI,aAAc54B,CAAG,EACnD,MAAO,GAET,MAAO,EACR,CA0CA,mBAAoB,CACnB,KAAK,UAAU,CAAC,KAAM,iBAAiB,CAAC,CACzC,CAEQ,iBAAkB,CACpB,KAAK,eACJ,KAAK,qBACT,KAAK,aAAa,oBAAoB,UAAW,KAAK,mBAAmB,EAC1E,KAAK,aAAa,MAAM,EACxB,KAAK,oBAAsB,KAAK,aAAe,MAG3C,KAAK,sBACT,OAAO,oBAAoB,UAAW,KAAK,mBAAmB,EAC9D,KAAK,oBAAsB,KAE7B,CAEA,eAAgB,CACf,KAAK,gBAAgB,EAErB,KAAK,UAAY,IAAM,CAAC,EACxB,KAAK,KAAO,IAAM,CAAC,CACpB,CAEA,SAAU,CACT,KAAK,QAAQ,EACb,KAAK,QAAQ,MAAM,CACpB,CAEA,SAAU,CACT,KAAK,gBAAgB,EACrB,KAAK,SAAW,EACjB,CAGA,OAAQ,CAAc,CAGtB,UAAUK,EAAU,CACd,KAAK,cACT,KAAK,aAAa,YAAYA,CAAG,CACnC,CAGA,cAAc+f,EAAqB,CAClC,GAAK,KAAK,UAAY,CAAEA,EAAM,WAAa,CAAEA,EAAM,KAClD,OAED,KAAK,QAAQ,IAAI,MAAM,0BAA2BA,EAAM,IAAI,EAC5D,KAAM,CAAC,KAAAve,EAAM,IAAA7B,CAAG,EAAIogB,EAAM,KAE1B,GAAKve,IAAS,kBACb,KAAK,QAAQ,IAAI,KAAK,+CAA+C,EACrE,KAAK,KAAK,iBAAiB,EAC3B,KAAK,QAAQ,EACb,KAAK,cAAc,UAERA,IAAS,MAAQ,CAC5B,MAAM5B,EAAM,KAAK,MAAM,aAAa,QAAQ,KAAK,OAASD,CAAG,GAAK,MAAM,EACxE,KAAK,QAAQ,IAAIA,EAAKC,CAAG,EACzB,KAAK,KAAK,UAAWD,EAAKC,EAAK,EAAK,CAErC,SAAY4B,IAAS,SACpB,KAAK,QAAQ,OAAO7B,CAAG,EACvB,KAAK,KAAK,UAAWA,EAAK,OAAW,EAAI,UAE9B6B,IAAS,QAAU,CAC9B,MAAM87B,EAAW,MAAM,KAAK,KAAK,QAAQ,KAAK,CAAC,EAC/C,KAAK,QAAQ,MAAM,EACnB,UAAU39B,KAAO29B,EAChB,KAAK,KAAK,UAAW39B,EAAK,OAAW,EAAI,CAC3C,CACD,CAGA,cAAcogB,EAAqB,CAClC,GAAK,MAAK,WAGV,KAAK,QAAQ,IAAI,MAAM,gBAAiBA,CAAK,EACxCA,EAAM,cAAgB,cAGtBA,EAAM,KAAOA,EAAM,IAAI,WAAW,KAAK,MAAM,GAAI,CAErD,MAAMpgB,EAAMogB,EAAM,IAAI,MAAM,KAAK,OAAO,MAAM,EAC9C,IAAIngB,EAAMmgB,EAAM,SAEXngB,IAAQ,MACZ,KAAK,QAAQ,OAAOD,CAAG,EACvB,KAAK,KAAK,UAAWA,EAAK,OAAW,EAAI,IAGzCC,EAAM,KAAK,MAAMA,CAAG,EACpB,KAAK,QAAQ,IAAID,EAAKC,CAAG,EACzB,KAAK,KAAK,UAAWD,EAAKC,EAAK,EAAK,EAEtC,CACD,CAEA,IACCD,EACA2gE,EACI,CACJ,OAAO,KAAK,QAAQ,IAAI3gE,CAAG,EACxB,KAAK,QAAQ,IAAIA,CAAG,EACpB2gE,CACJ,CAEA,IAAI3gE,EAAa4L,EAAY,CAC5B,GAAK,MAAK,SAGV,IAAKA,IAAU,OAAY,CACrB,KAAK,IAAI5L,CAAG,GAChB,KAAK,OAAOA,CAAG,EAChB,MACD,CAEA,KAAK,QAAQ,IAAIA,EAAK4L,CAAK,EAC3B,GAAI,CACH,aAAa,QAAQ,KAAK,OAAS5L,EAAK,KAAK,UAAU4L,CAAK,CAAC,CAC9D,OAAQkV,EAAK,CACZ,MAAK,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,2EAA2E,KAAK,OAAS9gB,CAAG,GAAG,EAElH8gB,GAAO,SAAS,KAAKA,EAAI,SAAS,CAAC,GACvC,KAAK,KAAK,iBAAkBA,CAAG,EAE1BA,CACP,CAEA,KAAK,UAAU,CAAC,KAAM,MAAO,IAAA9gB,CAAG,CAAC,EACjC,KAAK,KAAK,MAAOA,EAAK4L,EAAO,EAAK,EACnC,CAEA,OAAO5L,EAAa,CACd,KAAK,WAGV,KAAK,QAAQ,OAAOA,CAAG,EACvB,aAAa,WAAW,KAAK,OAASA,CAAG,EACzC,KAAK,UAAU,CAAC,KAAM,SAAU,IAAAA,CAAG,CAAC,EACpC,KAAK,KAAK,MAAOA,EAAK,OAAW,EAAI,EACtC,CAEA,IAAIA,EAAa,CAChB,OAAO,KAAK,QAAQ,IAAIA,CAAG,CAC5B,CAEA,MAAO,CACN,OAAO,KAAK,QAAQ,KAAK,CAC1B,CAEA,OAAQ,CACP,GAAK,KAAK,SACT,OAED,MAAM86D,EAAY,KAAK,QACvB,KAAK,QAAU,IAAI,IAEnB,UAAU96D,KAAO86D,EAAU,KAAK,EAC/B,aAAa,WAAW,KAAK,OAAS96D,CAAG,EACzC,KAAK,KAAK,UAAWA,EAAK,OAAW,EAAI,EAG1C,KAAK,UAAU,CAAC,KAAM,OAAO,CAAC,CAC/B,CAEA,SAAU,CACT,OAAO,KAAK,QAAQ,QAAQ,CAC7B,CAEA,IAAI,MAAO,CACV,OAAO,KAAK,QAAQ,IACrB,CACD,EAhP2D,4BAApD,IAAMuhE,EAAN,EAAMA,EAGL,SAAW,KAHNA,EAIL,MAAQ,gBAJHA,EAKL,YAAc,gTA8Of,MAAM,EAAN,MAAM,UAA0BH,CAAyB,CA0E/D,YAAYlkC,EAA0Bt8B,EAAiB,GAAM,CAC5D,MAAMs8B,CAAO,EARd,KAAQ,SAAmB,EAU1B,KAAK,SAAQ,QAAK,KAAK,KAAK,EAE5B,KAAK,YAAc,YAAY,IAAI,EAEnC,KAAK,SAAW,IAAI,IACpB,KAAK,YAAc,KAEnB,KAAK,MAAQ,IAAI,aAEjB,KAAK,QAAU,IAAI,IACnB,KAAK,MAAQ,GACb,KAAK,YAAc,KAEdt8B,IACC,OAAO,mBACA,KAAK,aAAe,IAAI,iBAAiB,cAAc,GAC/D,iBAAiB,UACnB,KAAK,oBAAsB,KAAK,cAAc,KAAK,IAAI,CAAC,EAI1D,KAAK,YAAc,KAAK,aAAa,EACnC,KAAK,IAAM,CACN,KAAK,SACT,KAAK,QAAQ,IAAI,KAAK,iBAAiB,YAAY,IAAI,EAAI,KAAK,aAAa,QAAQ,CAAC,CAAC,IAAI,EAC5F,KAAK,MAAQ,EACd,CAAC,EACA,MAAMkgB,GAAO,CACR,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,qBAAqB,YAAY,IAAI,EAAI,KAAK,aAAa,QAAQ,CAAC,CAAC,MAAOA,CAAG,EACvG,KAAK,MAAQ,EACd,CAAC,EACA,QAAQ,IAAM,CACd,KAAK,YAAc,IACpB,CAAC,EAEJ,CA1GA,OAAO,WAAY,CAClB,OAAO,OAAO,WAAa,IAC5B,CAEA,OAAO,YAAa,CACnB,OAAO,IAAI,QAAkB7b,GAAY,CACxC,MAAMwxD,EAAU,OAAO,UAAU,KAAK,MAAOuK,CAAU,EACvDvK,EAAQ,QAAU,IAAMxxD,EAAQ,EAAK,EAErCwxD,EAAQ,gBAAkBn5C,GAAK,CAGzBA,EAAE,kBAAkB,YACxBA,EAAE,OAAO,aAAa,MAAM,EAE7BrY,EAAQ,EAAK,CACd,EAEAwxD,EAAQ,UAAY,IAAM,CACzB,MAAM+K,EAAK/K,EAAQ,OAGnB,IAAI71C,EACJ,GAAI,CAEHA,EADY4gD,EAAG,YAAY,CAAC,UAAU,EAAG,UAAU,EACvC,YAAY,UAAU,CACnC,MAAa,CAEZ,OAAOv8D,EAAQ,EAAK,CACrB,CAEA,MAAMw8D,EAAK7gD,EAAM,WAAW,EAE5B6gD,EAAG,QAAU,IAAM,CAClBD,EAAG,MAAM,EACTv8D,EAAQ,EAAK,CACd,EAEAw8D,EAAG,UAAY,IAAM,CACpB,MAAMrmC,EAAU,MAAM,QAAQqmC,EAAG,MAAM,GAAKA,EAAG,OAAO,OAAS,EAC/D,OAAAD,EAAG,MAAM,EACFv8D,EAAQm2B,CAAO,CACvB,CACD,CACD,CAAC,CACF,CA+DA,SAAU,CACT,KAAK,QAAQ,EACb,KAAK,QAAQ,MAAM,CACpB,CAEA,SAAU,CACT,KAAK,SAAW,GAChB,KAAK,gBAAgB,EAEhB,KAAK,KACT,KAAK,GAAG,MAAM,EACd,KAAK,GAAK,KAEZ,CAEQ,iBAAkB,CACpB,KAAK,eACJ,KAAK,qBACT,KAAK,aAAa,oBAAoB,UAAW,KAAK,mBAAmB,EAC1E,KAAK,aAAa,MAAM,EACxB,KAAK,oBAAsB,KAAK,aAAe,KAEjD,CAEA,mBAAoB,CACnB,KAAK,UAAU,CAAC,KAAM,iBAAiB,CAAC,CACzC,CAEA,eAAgB,CACf,KAAK,gBAAgB,EACrB,KAAK,UAAY,IAAM,CAAC,EACxB,KAAK,KAAO,IAAM,CAAC,CACpB,CAGA,SAASphB,EAAc,CACf,KAAK,WACX,KAAK,SAAW,IAAI,KAErB,KAAK,SAAS,IAAIA,CAAG,CACtB,CAEA,UAAUA,EAAc,CAClB,KAAK,WACT,KAAK,SAAS,OAAOA,CAAG,EAEnB,KAAK,SAAS,OAIf,KAAK,qBACT,KAAK,oBAAoB,CAC3B,CAEA,OAAQ,CACP,OAAK,KAAK,YACF,KAAK,YAER,CAAE,KAAK,UAAY,CAAE,KAAK,SAAS,KAChC,QAAQ,QAAQ,EAEjB,KAAK,YAAc,IAAI,QAAc/U,GAAW,CACtD,KAAK,oBAAsBA,CAC5B,CAAC,EAAE,QAAQ,IAAM,CAChB,KAAK,oBAAsB,KAC3B,KAAK,YAAc,IACpB,CAAC,CACF,CAGA,UAAU5E,EAAU,CACd,KAAK,cACT,KAAK,aAAa,YAAYA,CAAG,CACnC,CAGA,cAAc+f,EAAqB,CAClC,GAAK,KAAK,UAAY,CAAEA,EAAM,WAAa,CAAEA,EAAM,KAClD,OAEI,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,0BAA2BA,EAAM,IAAI,EAC7D,KAAM,CAAC,KAAAve,EAAM,IAAA7B,CAAG,EAAIogB,EAAM,KAE1B,GAAKve,IAAS,kBACb,KAAK,QAAQ,IAAI,KAAK,+CAA+C,EACrE,KAAK,KAAK,iBAAiB,EAC3B,KAAK,QAAQ,EACb,KAAK,cAAc,UAERA,IAAS,MACpB,KAAK,KAAK7B,CAAG,EAAE,KAAKC,GAAO,CAC1B,KAAK,QAAQ,IAAID,EAAKC,CAAG,EACzB,KAAK,KAAK,UAAWD,EAAKC,EAAK,EAAK,CACrC,CAAC,EAAE,MAAM6gB,GAAO,KAAK,SAAW,KAAK,QAAQ,IAAI,MAAM,0BAA0B9gB,CAAG,kBAAmB8gB,CAAG,CAAC,UAEhGjf,IAAS,SACpB,KAAK,QAAQ,OAAO7B,CAAG,EACvB,KAAK,KAAK,UAAWA,EAAK,OAAW,EAAI,UAE9B6B,IAAS,QAAU,CAC9B,MAAM87B,EAAW,MAAM,KAAK,KAAK,QAAQ,KAAK,CAAC,EAC/C,KAAK,QAAQ,MAAM,EACnB,UAAU39B,KAAO29B,EAChB,KAAK,KAAK,UAAW39B,EAAK,OAAW,EAAI,CAE3C,MAAY6B,IAAS,WACpB,KAAK,KAAK,eAAgB7B,EAAK,EAAK,EACzB6B,IAAS,cACpB,KAAK,KAAK,eAAgB7B,EAAK,EAAI,EACxB6B,IAAS,eACpB,KAAK,KAAK,aAAa,CAEzB,CAGA,YAAa,CACZ,OAAK,KAAK,YACF,KAAK,YAER,KAAK,MACF,QAAQ,QAAQ,EAEjB,QAAQ,OAAO,CACvB,CAKA,IAAO7B,EAAa2gE,EAAsB,CACzC,OAAO,KAAK,QAAQ,IAAI3gE,CAAG,EACxB,KAAK,QAAQ,IAAIA,CAAG,EACpB2gE,CACJ,CAEA,IAAI3gE,EAAa4L,EAAY,CAC5B,GAAK,MAAK,SAGV,IAAKA,IAAU,OAAY,CACrB,KAAK,IAAI5L,CAAG,GAChB,KAAK,OAAOA,CAAG,EAChB,MACD,CAEA,KAAK,QAAQ,IAAIA,EAAK4L,CAAK,EAC3B,KAAK,KAAK5L,EAAK4L,CAAK,EAClB,KAAK,IAAM,KAAK,UAAU,CAAC,KAAM,MAAO,IAAA5L,CAAG,CAAC,CAAC,EAC7C,MAAM8gB,GAAO,KAAK,SAAW,KAAK,QAAQ,IAAI,MAAM,yBAAyB9gB,CAAG,gBAAiB8gB,CAAG,CAAC,EAEvG,KAAK,KAAK,MAAO9gB,EAAK4L,EAAO,EAAK,EACnC,CAEA,OAAO5L,EAAa,CACd,KAAK,WAGV,KAAK,QAAQ,OAAOA,CAAG,EACvB,KAAK,QAAQA,CAAG,EACd,MAAM8gB,GAAO,KAAK,SAAW,KAAK,QAAQ,IAAI,MAAM,2BAA2B9gB,CAAG,kBAAmB8gB,CAAG,CAAC,EACzG,KAAK,IAAM,KAAK,UAAU,CAAC,KAAM,SAAU,IAAA9gB,CAAG,CAAC,CAAC,EAElD,KAAK,KAAK,MAAOA,EAAK,OAAW,EAAI,EACtC,CAEA,IAAIA,EAAa,CAChB,OAAO,KAAK,QAAQ,IAAIA,CAAG,CAC5B,CAEA,MAAO,CACN,OAAO,KAAK,QAAQ,KAAK,CAC1B,CAEA,OAAQ,CACP,GAAK,KAAK,SACT,OAED,MAAM86D,EAAY,KAAK,QACvB,KAAK,QAAU,IAAI,IAEnB,UAAU96D,KAAO86D,EAAU,KAAK,EAC/B,KAAK,KAAK,UAAW96D,EAAK,OAAW,EAAI,EAE1C,KAAK,OAAO,EACV,MAAM8gB,GAAO,KAAK,SAAW,KAAK,QAAQ,IAAI,MAAM,0BAA2BA,CAAG,CAAC,EACnF,KAAK,IAAM,KAAK,UAAU,CAAC,KAAM,OAAO,CAAC,CAAC,CAC7C,CAEA,SAAU,CACT,OAAO,KAAK,QAAQ,QAAQ,CAC7B,CAEA,IAAI,MAAO,CACV,OAAO,KAAK,QAAQ,IACrB,CAKA,MAAMwR,EAAS,GAAO,CACrB,GAAK,KAAK,GACT,OAAO,QAAQ,QAAQ,KAAK,EAAE,EAE/B,GAAK,KAAK,SACT,OAAO,KAAK,SAEb,IAAIovC,EACJ,OAAO,KAAK,SAAWA,EAAY,IAAI,QAAqB,CAACz8D,EAASi2B,IAAW,CAEhF,MAAMu7B,EAAU,OAAO,UAAU,KAAK,MAAOuK,CAAU,EACvD,KAAK,SAASvK,CAAO,EAErBA,EAAQ,QAAUr2C,GAAS,CACrB,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,0BAA2BA,CAAK,EAExD8a,EAAO9a,CAAK,EACZ,KAAK,UAAUq2C,CAAO,CACvB,EAEAA,EAAQ,gBAAkBr2C,GAAS,CAC7B,KAAK,SACT,KAAK,QAAQ,IAAI,KAAK,mCAAmCA,EAAM,UAAU,OAAO4gD,CAAU,EAAE,EAE7F,MAAMQ,EAAK/K,EAAQ,OAEnB+K,EAAG,kBAAkB,WAAY,CAAC,QAAS,GAAG,CAAC,EAC/CA,EAAG,kBAAkB,OAAO,CAC7B,EAEA/K,EAAQ,UAAY,IAAM,CACpB,KAAK,SACT,KAAK,QAAQ,IAAI,KAAK,6BAA6B,YAAY,IAAI,EAAI,KAAK,aAAa,QAAQ,CAAC,CAAC,KAAK,EAEzG,KAAK,GAAKA,EAAQ,OAElB,GAAI,CACH,MAAMkL,EAAM,KAAK,GAAG,YAAY,CAAC,WAAY,OAAO,EAAG,UAAU,EACjEA,EAAI,YAAY,UAAU,EAC1BA,EAAI,YAAY,OAAO,CACxB,OAAQ7gD,EAAK,CAEP,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,6BAA8BA,CAAG,EAEzD,GAAI,CACH,KAAK,GAAG,MAAM,CACf,MAAW,CAAc,CAKzB,GAHA,KAAK,UAAU21C,CAAO,EACtB,KAAK,GAAK,KAELnkC,EACJ4I,EAAOpa,CAAG,MAEN,CAEJ,MAAM8gD,EAAS,OAAO,UAAU,eAAe,KAAK,EACpD,KAAK,SAASA,CAAM,EAEpBA,EAAO,QAAUxhD,GAAS,CACpB,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,mCAAoCA,CAAK,EACjE8a,EAAO9a,CAAK,EACZ,KAAK,UAAUwhD,CAAM,CACtB,EAEAA,EAAO,UAAY,IAAM,CACnB,KAAK,SACT,KAAK,QAAQ,IAAI,KAAK,2BAA2B,EAElD,KAAK,UAAUA,CAAM,EACrB,KAAK,SAAW,KAChB,KAAK,MAAM,EAAI,EACb,KAAK38D,CAAO,EACZ,MAAMi2B,CAAM,CACf,CACD,CAEA,MACD,CAEAj2B,EAAQ,KAAK,EAAE,EACf,KAAK,UAAUwxD,CAAO,CACvB,CACD,CAAC,EAAE,QAAQ,IAAM,CACXiL,IAAc,KAAK,WACvB,KAAK,SAAW,KAClB,CAAC,CACF,CAGA,MAAM,cAAe,CACpB,MAAMF,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,UAAU,EAAG,UAAU,EAC7C5gD,EAAQ+gD,EAAI,YAAY,UAAU,EAClC//D,EAAK,KAAK,WAEX,YAAK,SAASA,CAAE,EAET,IAAI,QAAc,CAACqD,EAASo8D,IAAS,CAE3CM,EAAI,QAAU7gD,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,sDAAuDA,CAAG,EAClF,KAAK,UAAUlf,CAAE,EACjBy/D,EAAK,CACN,EAEA,MAAM5K,EAAU71C,EAAM,OAAO,EAE7B61C,EAAQ,UAAY,IAAM,CACzB,UAAU12C,KAAS02C,EAAQ,OAC1B,KAAK,QAAQ,IAAI12C,EAAM,EAAGA,EAAM,CAAC,EAElC,KAAK,UAAUne,CAAE,EACjBqD,EAAQ,CACT,EAEAwxD,EAAQ,QAAU31C,GAAO,CACnB,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,wCAAyCA,CAAG,EAEpE,KAAK,UAAUlf,CAAE,EACjBy/D,EAAK,CACN,CACD,CAAC,CACF,CAGA,MAAM,UAAW,CAChB,MAAMG,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,UAAU,EAAG,UAAU,EAC7C5gD,EAAQ+gD,EAAI,YAAY,UAAU,EAClC//D,EAAK,KAAK,WAEX,YAAK,SAASA,CAAE,EAET,IAAI,QAAuB,CAACqD,EAAQo8D,IAAS,CAEnDM,EAAI,QAAU7gD,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,kDAAmDA,CAAG,EAC9E,KAAK,UAAUlf,CAAE,EACjBy/D,EAAK,CACN,EAEA,MAAM5K,EAAU71C,EAAM,WAAW,EAEjC61C,EAAQ,UAAY,IAAM,CACzB,KAAK,UAAU70D,CAAE,EACjBqD,EAAQwxD,EAAQ,MAAM,CACvB,EAEAA,EAAQ,QAAU31C,GAAO,CACnB,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,oCAAqCA,CAAG,EAChE,KAAK,UAAUlf,CAAE,EACjBy/D,EAAK,CACN,CACD,CAAC,CACF,CAGA,MAAM,KAAKrhE,EAAa,CACvB,MAAMwhE,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,UAAU,EAAG,UAAU,EAC7C5gD,EAAQ+gD,EAAI,YAAY,UAAU,EAClC//D,EAAK,KAAK,WAEX,YAAK,SAASA,CAAE,EAET,IAAI,QAAa,CAACqD,EAASo8D,IAAS,CAE1CM,EAAI,QAAU7gD,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,mDAAoDA,CAAG,EAC/E,KAAK,UAAUlf,CAAE,EACjBy/D,EAAK,CACN,EAEA,MAAMr/D,EAAM4e,EAAM,IAAI5gB,CAAG,EAEzBgC,EAAI,QAAU8e,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,qCAAsCA,CAAG,EACjE,KAAK,UAAUlf,CAAE,EACjBy/D,EAAK,CACN,EAEAr/D,EAAI,UAAY,IAAM,CACrB,KAAK,UAAUJ,CAAE,EACjBqD,EAAQjD,EAAI,OAAO,CAAC,CACrB,CACD,CAAC,CACF,CAGA,MAAM,KAAKhC,EAAa4L,EAAY,CACnC,GAAK,KAAK,SACT,OAGD,MAAMhK,EAAK,KAAK,WAChB,KAAK,SAASA,CAAE,EAChB,MAAMigE,EAAU,MAAM,KAAK,MAAM,KAAK,EAEhCL,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,UAAU,EAAG,WAAW,EAC9C5gD,EAAQ+gD,EAAI,YAAY,UAAU,EAEnC,OAAO,IAAI,QAAc,CAAC18D,EAASo8D,IAAS,CAG3CM,EAAI,QAAU7gD,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,iDAAkDA,CAAG,EAC7E+gD,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBy/D,EAAK,CACN,EAEA,MAAMr/D,EAAM4e,EAAM,IAAI,CAAC,EAAG5gB,EAAK,EAAG4L,CAAK,CAAC,EAExC5J,EAAI,QAAU8e,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,mCAAoCA,CAAG,EAC/D+gD,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBy/D,EAAK,CACN,EAEAr/D,EAAI,UAAY,IAAM,CACrB6/D,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBqD,EAAQ,CACT,CACD,CAAC,CACF,CAGA,MAAM,QAAQjF,EAAa,CAC1B,GAAK,KAAK,SACT,OAGD,MAAM4B,EAAK,KAAK,WAChB,KAAK,SAASA,CAAE,EAChB,MAAMigE,EAAU,MAAM,KAAK,MAAM,KAAK,EAEhCL,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,UAAU,EAAG,WAAW,EAC9C5gD,EAAQ+gD,EAAI,YAAY,UAAU,EAEnC,OAAO,IAAI,QAAc,CAAC18D,EAASo8D,IAAS,CAE3CM,EAAI,QAAU7gD,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,oDAAqDA,CAAG,EAChF+gD,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBy/D,EAAK,CACN,EAEA,MAAMr/D,EAAM4e,EAAM,OAAO5gB,CAAG,EAE5BgC,EAAI,QAAU8e,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,sCAAuCA,CAAG,EAClE+gD,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBy/D,EAAK,CACN,EAEAr/D,EAAI,UAAY,IAAM,CACrB6/D,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBqD,EAAQ,CACT,CACD,CAAC,CACF,CAGA,MAAM,QAAS,CACd,GAAK,KAAK,SACT,OAGD,MAAMrD,EAAK,KAAK,WAChB,KAAK,SAASA,CAAE,EAChB,MAAMigE,EAAU,MAAM,KAAK,MAAM,KAAK,EAEhCL,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,UAAU,EAAG,WAAW,EAC9C5gD,EAAQ+gD,EAAI,YAAY,UAAU,EAEnC,OAAO,IAAI,QAAc,CAAC18D,EAASo8D,IAAS,CAE3CM,EAAI,QAAU7gD,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,yCAA0CA,CAAG,EACrE+gD,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBy/D,EAAK,CACN,EAEA,MAAMr/D,EAAM4e,EAAM,MAAM,EAExB5e,EAAI,QAAU8e,GAAO,CACf,KAAK,SACT,KAAK,QAAQ,IAAI,MAAM,2BAA4BA,CAAG,EACvD+gD,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBy/D,EAAK,CACN,EAEAr/D,EAAI,UAAY,IAAM,CACrB6/D,EAAQ,EACR,KAAK,UAAUjgE,CAAE,EACjBqD,EAAQ,CACT,CACD,CAAC,CACF,CAIA,MAAM,QAAQjF,EAAa,CAC1B,MAAMwhE,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,OAAO,EAAG,UAAU,EAC1C5gD,EAAQ+gD,EAAI,YAAY,OAAO,EAEhC,OAAO,IAAI,QAAkB,CAAC18D,EAASo8D,IAAS,CAE/C,MAAMr/D,EAAM4e,EAAM,IAAI5gB,CAAG,EACzB,KAAK,SAASgC,CAAG,EAEjBA,EAAI,QAAU,IAAM,CACnBq/D,EAAK,EACL,KAAK,UAAUr/D,CAAG,CACnB,EACAA,EAAI,UAAYsb,GAAK,IACf,eAAYtb,EAAI,MAAM,EAC1BiD,EAAQjD,EAAI,MAAM,EAElBq/D,EAAK,EACN,KAAK,UAAUr/D,CAAG,CACnB,CACD,CAAC,CACF,CAEA,MAAM,QAAQhC,EAAa4L,EAAiB,CAC3C,GAAK,KAAK,SACT,OAED,GAAK,CAAE,KAAK,YAAYA,CAAK,EAC5B,MAAM,IAAI,MAAM,mBAAmB,EAEpC,MAAM41D,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,OAAO,EAAG,WAAW,EAC3C5gD,EAAQ+gD,EAAI,YAAY,OAAO,EAEhC,OAAO,IAAI,QAAc,CAAC18D,EAASo8D,IAAS,CAE3C,MAAMr/D,EAAM4e,EAAM,IAAIhV,EAAO5L,CAAG,EAChC,KAAK,SAASgC,CAAG,EAEjBA,EAAI,QAAU,IAAM,CACnBq/D,EAAK,EACL,KAAK,UAAUr/D,CAAG,CACnB,EACAA,EAAI,UAAY,IAAM,CACrBiD,EAAQ,EAER,KAAK,UAAU,CAAC,KAAM,WAAY,IAAAjF,CAAG,CAAC,EACtC,KAAK,KAAK,WAAYA,EAAK4L,EAAO,EAAK,EACvC,KAAK,UAAU5J,CAAG,CACnB,CACD,CAAC,CACF,CAEA,MAAM,WAAWhC,EAAa,CAC7B,GAAK,KAAK,SACT,OAED,MAAMwhE,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,OAAO,EAAG,WAAW,EAC3C5gD,EAAQ+gD,EAAI,YAAY,OAAO,EAEhC,OAAO,IAAI,QAAc,CAAC18D,EAASo8D,IAAS,CAE3C,MAAMr/D,EAAM4e,EAAM,OAAO5gB,CAAG,EAC5B,KAAK,SAASgC,CAAG,EAEjBA,EAAI,QAAU,IAAM,CACnBq/D,EAAK,EACL,KAAK,UAAUr/D,CAAG,CACnB,EACAA,EAAI,UAAY,IAAM,CACrBiD,EAAQ,EAER,KAAK,UAAU,CAAC,KAAM,cAAe,IAAAjF,CAAG,CAAC,EACzC,KAAK,KAAK,WAAYA,EAAK,OAAW,EAAI,EAC1C,KAAK,UAAUgC,CAAG,CACnB,CACD,CAAC,CACF,CAEA,MAAM,QAAQhC,EAAa,CAE1B,OADa,MAAM,KAAK,SAAS,GACrB,SAASA,CAAG,CACzB,CAEA,MAAM,YAAa,CAClB,GAAK,KAAK,SACT,OAED,MAAMwhE,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,OAAO,EAAG,WAAW,EAC3C5gD,EAAQ+gD,EAAI,YAAY,OAAO,EAEhC,OAAO,IAAI,QAAc,CAAC18D,EAASo8D,IAAS,CAE3C,MAAMr/D,EAAM4e,EAAM,MAAM,EACxB,KAAK,SAAS5e,CAAG,EAEjBA,EAAI,QAAU,IAAM,CACnBq/D,EAAK,EACL,KAAK,UAAUr/D,CAAG,CACnB,EACAA,EAAI,UAAY,IAAM,CACrBiD,EAAQ,EAER,KAAK,UAAU,CAAC,KAAM,aAAa,CAAC,EACpC,KAAK,UAAUjD,CAAG,CACnB,CACD,CAAC,CACF,CAEA,MAAM,UAAW,CAChB,MAAMw/D,EAAK,MAAM,KAAK,MAAM,EAC3BG,EAAMH,EAAG,YAAY,CAAC,OAAO,EAAG,UAAU,EAC1C5gD,EAAQ+gD,EAAI,YAAY,OAAO,EAEhC,OAAO,IAAI,QAAkB,CAAC18D,EAASo8D,IAAS,CAC/C,MAAMr/D,EAAM4e,EAAM,WAAW,EAC7B,KAAK,SAAS5e,CAAG,EAEjBA,EAAI,QAAU,IAAM,CACnBq/D,EAAK,EACL,KAAK,UAAUr/D,CAAG,CACnB,EACAA,EAAI,UAAY,IAAM,CAChB,MAAM,QAAQA,EAAI,MAAM,EAC5BiD,EAAQjD,EAAI,MAAkB,EAE9Bq/D,EAAK,EAEN,KAAK,UAAUr/D,CAAG,CACnB,CACD,CAAC,CACF,CAED,EAzwBgE,yBAAzD,IAAM8/D,EAAN,EAAMA,EAGL,SAAW,GAHNA,EAIL,MAAQ,YAJHA,EAKL,YAAc,uQA2wBf,MAAM,GAAN,gBAAuCR,CAAuB,CAmBpE,YAAYpkC,EAA0B,CACrC,MAAMA,CAAO,EAEb,MAAM6kC,EAAQ,KAAK,MAAQ,SAAS,cAAc,QAAQ,EAC1DA,EAAM,IAAO,KAAK,QAAQ,KAAa,OAAS,UAC/C,kCACA,gCACDA,EAAM,GAAK,sBACXA,EAAM,MAAM,MAAQ,IACpBA,EAAM,MAAM,OAAS,IAErB,KAAK,UAAY,KAAK,UAAU,KAAK,IAAI,EAEzC,OAAO,iBAAiB,UAAW,KAAK,SAAS,EACjD,SAAS,KAAK,YAAYA,CAAK,CAChC,CA9BA,OAAO,WAAY,CAAE,OAAOd,GAAkBC,CAAY,CAC1D,OAAO,YAAa,CACnB,OAAO,EAAyB,UAAU,CAC3C,CA+BA,mBAAoB,CAEpB,CAEA,eAAgB,CAEhB,CAKA,UAAU9gD,EAAqB,CAC9B,MAAM/f,EAAM+f,EAAM,KACb,CAAE/f,GAAO,CAAEA,EAAI,UAGpB,KAAK,cAAcA,CAAG,CACvB,CAEA,KAAKA,EAA2Bu+D,EAAwC,CAClE,OAAOv+D,GAAQ,WACnBA,EAAM,CAAC,SAAUA,CAAG,GAErB,GAAI,CAED,KAAK,MAAc,cAAoC,YACxDA,EACA,IACAu+D,EAAY,MAAM,QAAQA,CAAQ,EAAIA,EAAW,CAACA,CAAQ,EAAK,MAChE,CACD,OAAQ99C,EAAK,CACZ,KAAK,QAAQ,IAAI,MAAM,mCAAoCA,EAAKzgB,EAAKu+D,CAAQ,CAC9E,CACD,CAED,EAzEqE,kCAA9D,GAAM,EASL,SAAW,IATN,EAUL,MAAQ,8BAVH,EAWL,YAAc,gVAXT,EAaL,cAAgB,GAbX,EAcL,aAAe,GAdhB,IAAMoD,EAAN,EAgFA,MAAM,GAAN,gBAAgCV,CAAuB,CAI7D,OAAO,WAAY,CAAE,OAAO,WAAU,CAEtC,OAAO,YAAa,CACnB,OAAO,EAAkB,UAAU,EAK5B,IAAI,QAAkBr8D,GAAY,CACxC,IAAIg9D,EAAY,GACf96C,EAAgD,KAEjD,MAAM+6C,EAAW,EAAC5tC,GAA2B,CAC5C,GAAIA,EAAI,SAAW,QAGfA,EAAI,MAAQA,EAAI,KAAK,OAAS,eAAgB,CACjD,MAAMj0B,EAAMi0B,EAAI,KAAK,KACbj0B,GAAK,WAEA,aACZ4hE,EAAY,GACZh9D,EAAQ5E,EAAI,KAAK,EACjB8hE,EAAQ,EAEV,CACD,EAdiB,YAgBXA,EAAU,MAAM,CAChBF,IACJA,EAAY,GACZh9D,EAAQ,EAAK,GAGVkiB,IACH,aAAaA,CAAO,EACpBA,EAAU,MAGX,OAAO,oBAAoB,UAAW+6C,CAAQ,CAC/C,EAZgB,WAchB,OAAO,iBAAiB,UAAWA,CAAQ,EAE3C,OAAO,YAAY,CAClB,KAAM,aACN,KAAM,CACL,SAAU,gBACX,CACD,EAAG,GAAG,EAEN/6C,EAAU,WAAWg7C,EAAS,GAAI,CACnC,CAAC,EAhDO,EAiDT,CAWA,YAAYjlC,EAA0B,CACrC,MAAMA,CAAO,EAEb,KAAK,aAAe,KAAK,aAAa,KAAK,IAAI,EAC/C,OAAO,iBAAiB,UAAW,KAAK,YAAY,CACrD,CAIA,mBAAoB,CAEpB,CAEA,eAAgB,CAEhB,CAIA,aAAa5I,EAAwB,CAChCA,EAAI,SAAW,QAGfA,EAAI,MAAM,OAAS,gBAAkBA,EAAI,KAAK,MAAM,UACvD,KAAK,cAAcA,EAAI,KAAK,IAAI,CAClC,CAEA,KAAKj0B,EAA2Bu+D,EAAwC,CAClE,OAAOv+D,GAAQ,WACnBA,EAAM,CAAC,SAAUA,CAAG,GAErB,GAAI,CACH,OAAO,YACN,CACC,KAAM,aACN,KAAMA,CACP,EACA,IACAu+D,EAAY,MAAM,QAAQA,CAAQ,EAAIA,EAAW,CAACA,CAAQ,EAAK,MAChE,CAED,OAAQ99C,EAAK,CACZ,KAAK,QAAQ,IAAI,MAAM,sCAAuCA,EAAKzgB,EAAKu+D,CAAQ,CACjF,CACD,CAED,EAlH8D,2BAAvD,GAAM,EA2DL,SAAW,IA3DN,EA4DL,MAAQ,4BA5DH,EA6DL,YAAc,0KA7DT,EA+DL,cAAgB,GA/DX,EAgEL,aAAe,GAhEhB,IAAMwD,EAAN,KA0PA,MAAMC,EAAqD,CAEjE,MAAOd,EACP,IAAKO,EACL,KAAME,CAGP,C,kDC3tDA,MAAMM,EAAU,OAAO,SAAS,EAsJhC,EAAe,CACd,MApJyC,CACzC,IAAOtiE,EAAa8oC,EAA6B,CAChD,UAAUtpB,KAAWspB,EACpB,GAAKtpB,EAAQ,IAAIxf,CAAG,EACnB,MAAO,CACNwf,EAAQ,IAAIxf,CAAG,EACf,CAACwf,EAAQ,EAAE,CACZ,CACH,CACD,EA4IC,aAzIgD,CAChD,IAAOxf,EAAa8oC,EAA6B/kB,EAAoCw+C,EAAa,CACjG,MAAMlT,EAAc,CAAC,EACpBmT,EAAoB,CAAC,EAEtB,UAAUhjD,KAAWspB,EACpB,GAAKtpB,EAAQ,IAAIxf,CAAG,EAAI,CACvB,MAAMC,EAAMuf,EAAQ,IAAOxf,CAAG,EAC9B,GAAK,CAAEC,GAAO,OAAOA,GAAQ,SAAW,CACvCsiE,EAAI,KAAK,YAAY/iD,EAAQ,EAAE,8BAA8Bxf,CAAG,aAAa,OAAOC,CAAG,aAAa,EACpG,QACD,CAEAuiE,EAAQ,KAAKhjD,EAAQ,EAAE,EACvB6vC,EAAO,QAAQpvD,CAAG,CACnB,CAED,GAAKuiE,EAAQ,OACZ,MAAO,CACN,OAAO,OAAO,CAAC,EAAG,GAAGnT,CAAM,EAC3BmT,CACD,CACF,CACD,EAmHC,kBA9GqD,CACrD,IAAOxiE,EAAa8oC,EAA6B/kB,EAAoCw+C,EAAa,CACjG,MAAMlT,EAA2B,CAAC,EACjCmT,EAAoB,CAAC,EAEtB,UAAUhjD,KAAWspB,EACpB,GAAKtpB,EAAQ,IAAIxf,CAAG,EAAI,CACvB,MAAMC,EAAMuf,EAAQ,IAAoBxf,CAAG,EAC3C,GAAK,CAAE,MAAM,QAAQC,CAAG,EAAI,CAC3BsiE,EAAI,KAAK,YAAY/iD,EAAQ,EAAE,8BAA8Bxf,CAAG,GAAG,EACnE,QACD,CAEAwiE,EAAQ,KAAKhjD,EAAQ,EAAE,EACvB,UAAUrB,KAAKle,EACdovD,EAAO,KAAKlxC,CAAC,CACf,CAED,GAAKqkD,EAAQ,OACZ,MAAO,CACNnT,EACAmT,CACD,CACF,CACD,EAuFC,YApF+C,CAC/C,QAAQviE,EAAK,CACZ,MAAMovD,EAAS,CAAC,EAChB,UAAUlxC,KAAKle,EACTke,EAAE,IAAM,WAAaA,EAAE,IAAM,QAAUA,EAAE,GAC7CkxC,EAAO,KAAKlxC,EAAE,CAAC,EAEjB,OAAOkxC,CACR,EAEA,IACCrvD,EACA8oC,EACA/kB,EACAw+C,EACAjjD,EACC,CAED,MAAM+vC,EAA2B,CAAC,EACjCmT,EAAoB,CAAC,EACtB,IAAIC,EAA6B,CAAC,EAC9BC,EAAY,GAEZC,EAA8C75B,EAC7C/kB,EAAW,kBACf4+C,EAAQ,CAAC,GAAG75B,EAAUw5B,CAAO,GAE9B,UAAU9iD,KAAWmjD,EAAO,CAC3B,IAAI/2D,EACJ,GAAK4T,IAAY8iD,EAChB12D,EAAQmY,EAAW,QACd,OAAOnY,GAAU,aACrBA,EAAQA,EAAM0T,CAAG,WAEPE,EAAQ,IAAIxf,CAAG,EAC1B4L,EAAQ4T,EAAQ,IAAIxf,CAAG,MAEvB,UAED,GAAK,CAAE,MAAM,QAAQ4L,CAAK,EAAI,CACxB4T,IAAY8iD,GAChBC,EAAI,KAAK,YAAY/iD,EAAQ,EAAE,8BAA8Bxf,CAAG,aAAa,OAAO4L,CAAK,aAAa,EACvG,QACD,CAEA,MAAMsnC,EAA0B,CAAC,EAE5B1zB,IAAY8iD,GAChBE,EAAQ,KAAKhjD,EAAQ,EAAE,EAExB,IAAIojD,EAAc,GAClB,UAAU3iE,KAAO2L,EAEhB,GADA82D,EAAY,GACPziE,EAAI,IAAM,UACd2iE,EAAc,WACL3iE,EAAI,IAAM,OACnB,SACS2iE,EACT1vB,EAAM,KAAKjzC,EAAI,CAAC,EAEhBovD,EAAO,KAAKpvD,EAAI,CAAC,EAMnB,GAHAwiE,EAAWvvB,EAAM,OAAOuvB,CAAQ,EAG3B,CAAEG,GAAe,CAAE7+C,EAAW,eAClC,KACF,CAEA,GAAK2+C,EACJ,MAAO,CACNrT,EAAO,OAAOoT,CAAQ,EACtBD,CACD,CACF,CACD,CASA,C,4FCjKA,SAAS9B,EAAU90D,EAAYmY,EAAyC,CACvE,GAAK,OAAOnY,GAAU,UAAY,MAAMA,CAAK,GAAK,CAAE,SAASA,CAAK,EACjE,MAAO,GAER,MAAMg1D,EAAS78C,EAAW,OAC1B,GAAK,MAAM,QAAQ68C,CAAM,GACxB,GAAKA,EAAO,QAAU,GAErB,IAAMA,EAAO,CAAC,EAAKh1D,EAAQg1D,EAAO,CAAC,EAAMh1D,GAASg1D,EAAO,CAAC,KACvDA,EAAO,CAAC,EAAKh1D,EAASg1D,EAAe,CAAC,EAAMh1D,GAAUg1D,EAAe,CAAC,GACxE,MAAO,WAEGA,EAAO,SAAW,GAE7B,GAAK,OAAOA,EAAO,CAAC,GAAM,WACzB,GAAKA,EAAO,CAAC,EAAIh1D,EAAQg1D,EAAO,CAAC,EAAIh1D,GAASg1D,EAAO,CAAC,EACrD,MAAO,WACGh1D,EAAQg1D,EAAO,CAAC,GAAKh1D,EAAQg1D,EAAO,CAAC,EAChD,MAAO,WACGA,EAAO,SAAW,GAAKh1D,EAAQg1D,EAAO,CAAC,EAClD,MAAO,GAGT,MAAO,EACR,CAxBS,EAAAF,EAAA,aA0BF,MAAMmC,EAA2C,GACvDj3D,EACAmY,IACI,CACJ,GAAK,OAAOnY,GAAU,UAAY,UAAU,KAAKA,CAAK,EACrDA,EAAQ,SAASA,EAAO,EAAE,UACjB,OAAOA,GAAU,SAC1B,MAAO,GAER,OAAO80D,EAAU90D,EAAOmY,CAAU,CACnC,EAVwD,kBAY3C++C,EAA6C,GACzDl3D,EACAmY,IACI,CACJ,GAAK,OAAOnY,GAAU,UAAY,aAAa,KAAKA,CAAK,EACxDA,EAAQ,WAAWA,CAAK,UACf,OAAOA,GAAU,SAC1B,MAAO,GAER,OAAO80D,EAAU90D,EAAOmY,CAAU,CACnC,EAV0D,mB,6ECE3C,MAAM,EAAN,MAAM,UAAiB,SAAO,CAc5C,YAAYviB,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EAZnB,cAA4B,KAC5B,UAAiB,KACjB,UAAa,KAYZ,KAAK,cAAgB,GAErB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,WAAW,EACvB,KAAK,OAAO,MAAM,EAElB,KAAK,kBAAoB,KAAK,KAAK,OAClC,qBACAgd,GACEA,EAAmB,OAAO,WAC1BA,EAAmB,MAAM,MAC5B,EAEA,KAAK,uBAAyB,KAAK,KAAK,OACvC,2BACAA,GACEA,EAAwB,OAAO,MAC/BA,EAAwB,OAAO,SAC/BA,EAAwB,OAAO,UAC/BA,EAAwB,uBAC3B,EAEA,KAAK,UAAY,IAAI,GAEtB,CAEA,UAAW,CACV,KAAK,SAAS,WAAW,wBAAyBtd,GAAO,CACxD,KAAK,OAAO,4BAA6BA,CAAG,CAC7C,CAAC,EAED,KAAK,SAAS,WAAW,mBAAoBA,GAAO,CACnD,KAAK,OAAO,gCAAiCA,CAAG,CACjD,CAAC,EAED,KAAK,uBAAuB,MAAM,CAACurC,EAAKC,IAAc,CACrD,KAAK,IAAI,MAAM,yCAAyC,EAExD,MAAMjuB,EAAI,KACTu4C,EAAQvqB,EAAI,UACZ4I,EAAa2hB,EAAM,OAEnBA,EAAc,oBAAsB3hB,EACrC2hB,EAAM,OAAS,UAAW,CACzB,GAAI,CACH,MAAMl0D,EAAO,KAAK,MAAM,KACxB,GAAK2b,EAAE,UAAU,IAAI3b,CAAI,GAAK,CAAE2b,EAAE,aAAa3b,CAAI,EAClD,OAAO,IACT,OAAQif,EAAK,CAEZ,QAAQ,MAAMA,CAAG,CAClB,CAEA,OAAOszB,EAAW,KAAK,IAAI,CAC5B,EAEA,KAAK,uBAAuB,gBAAgB,CAC7C,CAAC,EAED,KAAK,kBAAkB,MAAM,CAAC5I,EAAKC,IAAc,CAChD,KAAK,IAAI,MAAM,mCAAmC,EAElD,MAAMjuB,EAAI,KACTu4C,EAAQvqB,EAAI,UACZ4I,EAAa2hB,EAAM,OAEpBA,EAAM,OAAS,UAAW,CACzB,GAAI,CACH,MAAMl0D,EAAO,KAAK,MAAM,UACxB,GAAK2b,EAAE,UAAU,IAAI3b,CAAI,GAAK,KAAK,MAAQ,CAC1C,IAAIkhE,EAAM,KAAK,MAAM,UACrB,GAAK,OAAOA,GAAQ,YAAc,CAAGA,EAAY,WAAa,CAC7D,MAAMvtB,EAAQh4B,EAAE,KAAK,SAAS,EAC7BgH,EAAgBgxB,GAASA,EAAM,cAEhC,GAAKhxB,EAAgB,CACpB,GAAK,CAAGu+C,EAAY,WAAa,CAEhC,IAASC,EAAT,WAAoBn8C,EAAY,CAC/B,OAAKrJ,EAAE,aAAaylD,EAAG,MAAM,SAAS,EAC9Bz+C,EAAcu+C,EAAKl8C,CAAK,EACzB,IACR,EAJA,cADA,MAAMo8C,EAAK,KAOXD,EAAW,WAAa,GACxBA,EAAW,YAAc,cAAc,KAAK,MAAM,SAAS,IAC1DD,EAAY,WAAaC,CAC3B,CAEA,KAAK,MAAM,UAAaD,EAAY,UACrC,CACD,CACD,CACD,OAAQjiD,EAAK,CAEZ,QAAQ,MAAMA,CAAG,CAClB,CAEA,OAAOszB,EAAW,KAAK,IAAI,CAC5B,EAEA,KAAK,kBAAkB,gBAAgB,CACxC,CAAC,CACF,CAEA,OAAO2uB,EAAa38D,EAAwB,KAAM,CACjD,MAAMf,EAAW,KAAK,UAAU,IAAI09D,CAAG,GAAK,GAEvC38D,GAAS,KACbA,EAAQ,CAAEf,EAEVe,EAAQ,CAAC,CAAEA,EAEPA,IAAUf,IACd,KAAK,UAAU,IAAI09D,EAAK38D,CAAK,EAC7B,KAAK,OAAO28D,CAAG,EAEjB,CAEA,OAAOA,EAAa,CACnB,UAAUx3B,KAAQ,KAAK,kBAAkB,UAAW,CACnD,MAAM1pC,EAAO0pC,EAAK,OAAO,UACpB1pC,GAAQA,IAASkhE,GACrBx3B,EAAK,YAAY,CAEnB,CAEA,UAAUA,KAAQ,KAAK,uBAAuB,UAAW,CACxD,MAAM/pC,EAAO+pC,EAAK,OAAO,KACpB/pC,GAAQA,IAASuhE,GACrBx3B,EAAK,YAAY,CAEnB,CACD,CAEA,aAAaw3B,EAAa,CACzB,OAAO,KAAK,UAAU,IAAIA,CAAG,GAAK,EACnC,CAED,EA5J6C,gBAA9B,IAAMG,EAAN,C,wFCPA,MAAM,EAAN,MAAM,UAAkB,SAAO,CAU7C,YAAY1hE,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EARnB,UAA2B,KAC3B,UAAa,KACb,cAA4B,KAQ3B,KAAK,cAAgB,GAErB,KAAK,OAAO,MAAM,EAClB,KAAK,OAAO,UAAU,EACtB,KAAK,OAAO,WAAW,EAEvB,KAAK,SAAS,IAAI,0BAA2B,CAC5C,QAAS,GAET,GAAI,CACH,KAAM,qCACN,MAAO,sBACP,YAAa,8FACb,UAAW,mBACZ,EAEA,QAAS,IAAM,KAAK,UAAU,YAAY,CAC3C,CAAC,EAED,KAAK,UAAY,KAAK,KAAK,OAC1B,aACAgd,GACEA,EAAoB,qBACpBA,EAAoB,aACtB,CAAC,OAAQ,YAAa,aAAc,YAAa,QAAS,cAAe,aAAc,mBAAoB,cAAe,iBAAkB,gBAAgB,CAC7J,CACD,CAEA,UAAW,CACV,KAAK,SAAS,GAAG,gCAAiC,IACjD,KAAK,UAAU,YAAY,CAAC,EAE7B,KAAK,UAAU,MAAM,CAACiuB,EAAKC,IAAc,CACxC,UAAUF,KAAQE,EACjB,KAAK,gBAAgBF,CAAI,CAC3B,CAAC,EAED,KAAK,UAAU,GAAG,QAAS,KAAK,gBAAiB,IAAI,EACrD,KAAK,UAAU,GAAG,SAAU,KAAK,gBAAiB,IAAI,CACvD,CAGA,gBAAgBA,EAAqB,CACpC,MAAMrgB,EAAY,KAAK,KAAK,aAA0BqgB,CAAI,EACzD5lB,EAAMuF,GAAW,cAAc,0CAA0C,EAC1E,GAAK,CAAEvF,EACN,OAED,MAAMkB,EAAQ0kB,EAAK,MAClB33B,EAAOiT,EAAM,MAAQA,EAAM,KAAK,KAChC+wC,EAAOhkD,GAAQA,EAAK,KACpBuvD,EAAc,KAAK,SAAS,IAAI,yBAAyB,GAAKvL,GAAQA,EAAK,mBAAqB,CAAEA,EAAK,oBAEvGpxC,EAAOb,EAAI,cAAc,iBAAiB,EAE3C,GAAKw9C,GAAe,CAAE38C,EACrBb,EAAI,gBAAa,iBAAC,QAAK,MAAM,2DAC5B,iBAAC,UACA,MAAM,0BACN,aAAY,KAAK,KAAK,EAAE,mBAAoB,gDAAgD,EAC7F,CACD,EAASA,EAAI,iBAAiB,EAE9BA,EAAI,eAAY,iBAAC,QAAK,MAAM,iBAAkB,EAAE,UAErC,CAAEw9C,GAAe38C,EAAO,CACnCA,EAAK,OAAO,EACZ,MAAM48C,EAAOz9C,EAAI,cAAc,kBAAkB,EAC5Cy9C,GACJA,EAAK,OAAO,CACd,CACD,CACD,EArF8C,iBAA/B,IAAMC,EAAN,C,4GCCR,SAASC,EAAY9E,EAA6B,CACxD,OAAOA,aAAgB,MAAQA,aAAgB,MAAQA,aAAgB,aAAeA,aAAgB,UACvG,CAFgB,EAAA8E,EAAA,eAQT,eAAeC,EAAc/E,EAAqD,CACxF,GAAK,CAAEA,EACN,OAAO,KAER,GAAKA,aAAgB,KACpB,MAAO,CACN,KAAM,OACN,KAAMA,EAAK,KACX,OAAQ,MAAMA,EAAK,YAAY,CAChC,EAED,GAAKA,aAAgB,KACpB,MAAO,CACN,KAAM,OACN,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,SAAUA,EAAK,aACf,OAAQ,MAAMA,EAAK,YAAY,CAChC,EAED,GAAKA,aAAgB,YACpB,MAAO,CACN,KAAM,KACN,OAAQA,CACT,EAED,GAAKA,aAAgB,WACpB,MAAO,CACN,KAAM,KACN,OAAQA,EAAK,MACd,EAED,MAAM,IAAI,UAAU,cAAc,CACnC,CAjCsB,EAAA+E,EAAA,iBAuCf,SAASC,EAAgB5vD,EAA2C,CAC1E,GAAK,CAAEA,GAAQ,CAAEA,EAAK,KACrB,OAAO,KAER,GAAKA,EAAK,OAAS,OAClB,OAAO,IAAI,KAAK,CAACA,EAAK,MAAM,EAAG,CAAC,KAAMA,EAAK,IAAI,CAAC,EAEjD,GAAKA,EAAK,OAAS,OAClB,OAAO,IAAI,KAAK,CAACA,EAAK,MAAM,EAAGA,EAAK,KAAM,CAAC,KAAMA,EAAK,KAAM,aAAcA,EAAK,QAAQ,CAAC,EAEzF,GAAKA,EAAK,OAAS,KAClB,OAAOA,EAAK,OAEb,GAAKA,EAAK,OAAS,KAClB,OAAO,IAAI,WAAWA,EAAK,MAAM,EAElC,MAAM,IAAI,UAAU,cAAc,CACnC,CAjBgB,EAAA4vD,EAAA,kB,mB/HtFhB,M,6GgIIO,SAASC,EAAQrjE,EAAW02D,EAAWt5C,EAAW,CAGxD,OAFKA,EAAI,IAAIA,GAAK,GACbA,EAAI,IAAIA,GAAK,GACbA,EAAI,mBACDpd,GAAK02D,EAAE12D,GAAK,EAAIod,EACnBA,EAAI,GACDs5C,EACHt5C,EAAI,kBACDpd,GAAK02D,EAAE12D,IAAM,kBAAMod,GAAK,EACzBpd,CACR,CAVgB,EAAAqjE,EAAA,WAYT,SAASC,EAAWltC,EAAiB,CAM3C,OAAQA,GAAW,OAAWA,EAAU,MAAQ,KAAK,KAAKA,EAAU,MAAS,MAAO,GAAG,CACxF,CAPgB,EAAAktC,EAAA,cAST,SAASC,EAAWntC,EAAiB,CAK3C,OAAQA,GAAW,SAAaA,EAAU,MAAQ,KAAK,IAAI,MAAQA,EAAS,iBAAK,EAAI,IACtF,CANgB,EAAAmtC,EAAA,cAuBhB,MAAM,EAAN,MAAM,CAA+B,CAOpC,YAAYhmD,EAAWM,EAAWpN,EAAWD,EAAY,CACxD,KAAK,EAAI+M,GAAK,EACd,KAAK,EAAIM,GAAK,EACd,KAAK,EAAIpN,GAAK,EACd,KAAK,EAAID,GAAK,CACf,CAEA,GAAGgZ,EAA0Bg6C,EAAc,GAAgB,CAC1D,OAAKh6C,aAAiB,EACd,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,IAAMg6C,GAAe,KAAK,IAAMh6C,EAAM,GACpGA,EAAQ,KAAK,GAAGA,EAAM,OAAO,EAAGg6C,CAAW,EAAI,EACvD,CAMA,GAAGjmD,EAAW,CAAE,OAAO,IAAI,EAAUA,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGM,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAGA,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGpN,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAGA,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGD,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAG,KAAK,EAAGA,CAAC,CAAG,CAMjE,OAAO,SAASpP,EAAc,CAC7B,MAAM8d,EAAMukD,EAAM,WAAW,EAC7BvkD,EAAI,UAAU,EAAG,EAAG,EAAG,CAAC,EACxBA,EAAI,UAAY9d,EAChB8d,EAAI,SAAS,EAAG,EAAG,EAAG,CAAC,EACvB,MAAM1L,EAAO0L,EAAI,aAAa,EAAG,EAAG,EAAG,CAAC,EACxC,OAAK1L,GAAM,MAAM,SAAW,EACpB,KAED,IAAI,EAAUA,EAAK,KAAK,CAAC,EAAGA,EAAK,KAAK,CAAC,EAAGA,EAAK,KAAK,CAAC,EAAGA,EAAK,KAAK,CAAC,EAAI,GAAG,CAClF,CAEA,OAAO,QAAQke,EAAe,CAE7B,OADAA,EAAQA,GAASA,EAAM,KAAK,EACrBA,GAAO,OAGTA,EAAM,OAAO,CAAC,IAAM,IACjB,EAAU,QAAQA,CAAK,EA0CxB,EAAU,SAASA,CAAK,EA7CvB,IA8CT,CAEA,OAAO,QAAQA,EAAe,CACxBA,EAAM,OAAO,CAAC,IAAM,MACxBA,EAAQA,EAAM,MAAM,CAAC,GAEtB,IAAIhC,EACA4jC,EAAgB,IAEpB,OAAK5hC,EAAM,SAAW,GACrB4hC,EAAQ,SAAS5hC,EAAM,CAAC,EAAG,EAAE,EAAI,GACjCA,EAAQA,EAAM,MAAM,EAAG,CAAC,GACbA,EAAM,SAAW,IAC5B4hC,EAAQ,SAAS5hC,EAAM,MAAM,CAAC,EAAG,EAAE,EACnCA,EAAQA,EAAM,MAAM,EAAG,CAAC,GAGpBA,EAAM,SAAW,EACrBhC,GACG,SAASgC,EAAM,CAAC,EAAG,EAAE,EAAI,IAAO,KAChC,SAASA,EAAM,CAAC,EAAG,EAAE,EAAI,IAAO,GAClC,SAASA,EAAM,CAAC,EAAG,EAAE,EAAI,GAG1BhC,EAAM,SAASgC,EAAO,EAAE,EAElB,IAAI,EACThC,GAAO,GACPA,GAAO,EAAI,IACXA,EAAM,IACP4jC,EAAQ,GACT,CACD,CAEA,OAAO,SAAS31C,EAAWH,EAAWO,EAAWvN,EAAY,CAC5D,IAAI+M,EAAWM,EAAWpN,EAE1B,MAAMkB,EAAI,KAAK,MAAMgM,EAAI,CAAC,EACzBS,EAAIT,EAAI,EAAIhM,EACZ3R,EAAI+d,GAAK,EAAIP,GACbk5C,EAAI34C,GAAK,EAAIK,EAAIZ,GACjBJ,EAAIW,GAAK,GAAK,EAAIK,GAAKZ,GAExB,OAAO7L,EAAI,EAAG,CACb,IAAK,GAAG4L,EAAIQ,EAAGF,EAAIT,EAAG3M,EAAIzQ,EAAG,MAC7B,IAAK,GAAGud,EAAIm5C,EAAG74C,EAAIE,EAAGtN,EAAIzQ,EAAG,MAC7B,IAAK,GAAGud,EAAIvd,EAAG6d,EAAIE,EAAGtN,EAAI2M,EAAG,MAC7B,IAAK,GAAGG,EAAIvd,EAAG6d,EAAI64C,EAAGjmD,EAAIsN,EAAG,MAC7B,IAAK,GAAGR,EAAIH,EAAGS,EAAI7d,EAAGyQ,EAAIsN,EAAG,MAC7B,QACCR,EAAIQ,EAAGF,EAAI7d,EAAGyQ,EAAIimD,CACpB,CAEA,OAAO,IAAI,EACV,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAGn5C,EAAE,GAAG,EAAG,GAAG,CAAC,EAC5C,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAGM,EAAE,GAAG,EAAG,GAAG,CAAC,EAC5C,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAGpN,EAAE,GAAG,EAAG,GAAG,CAAC,EAC5CD,IAAM,OAAY,EAAIA,CACvB,CACD,CAEA,OAAO,SAASmN,EAAWH,EAAWpb,EAAWoO,EAAY,CAC5D,GAAKgN,IAAM,EAAI,CACd,MAAMO,EAAI,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAG,IAAI3b,CAAC,EAAG,GAAG,CAAC,EACtD,OAAO,IAAI,EAAU2b,EAAGA,EAAGA,EAAGvN,IAAM,OAAY,EAAIA,CAAC,CACtD,CAEA,MAAMkmD,EAAIt0D,EAAI,GAAMA,GAAK,EAAIob,GAAKpb,EAAIob,EAAIpb,EAAIob,EAC7Cxd,EAAI,EAAIoC,EAAIs0D,EAEb,OAAO,IAAI,EACV,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAG,IAAM2M,EAAQrjE,EAAG02D,EAAG/4C,EAAI,iBAAG,CAAC,EAAG,GAAG,CAAC,EACnE,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAG,IAAM0lD,EAAQrjE,EAAG02D,EAAG/4C,CAAC,CAAC,EAAG,GAAG,CAAC,EAC7D,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,EAAG,IAAM0lD,EAAQrjE,EAAG02D,EAAG/4C,EAAI,iBAAG,CAAC,EAAG,GAAG,CAAC,EACnEnN,IAAM,OAAY,EAAIA,CACvB,CACD,CAEA,OAAO,SAAS3I,EAAWC,EAAW47D,EAAWlzD,EAAY,CAC5D,MAAMmzD,EAAK,SAAW97D,EAAI,QAAWC,EAAI,QAAW47D,EACnDE,EAAI,SAAY/7D,EAAI,SAAWC,EAAI,QAAW47D,EAC9CG,EAAK,QAAWh8D,EAAI,QAAWC,EAAI,SAAW47D,EAG/C,OAAO,IAAI,EACV,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,IAAMH,EAAWI,CAAC,CAAC,CAAC,EAC9C,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,IAAMJ,EAAWK,CAAC,CAAC,CAAC,EAC9C,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,IAAML,EAAWM,CAAC,CAAC,CAAC,EAC9CrzD,IAAM,OAAY,EAAIA,CACvB,CACD,CAOA,OAAQ,CACP,OAAK,KAAK,IAAM,EACR,QAAQ,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,IAC7C,KAAK,MAAM,CACnB,CAEA,OAAQ,CAEP,MAAO,MADQ,KAAK,MAAM,KAAK,CAAC,GAAK,KAAO,KAAK,MAAM,KAAK,CAAC,GAAK,GAAK,KAAK,MAAM,KAAK,CAAC,GACvE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,EAC/C,CAGA,QAAS,CAAE,OAAO,IAAM,CACxB,QAAS,CAAE,OAAOszD,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAOC,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAOC,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAM1C,OAAQ,CACP,OAAS,KAAQ,KAAK,EAAO,KAAQ,KAAK,EAAO,KAAQ,KAAK,GAAM,GACrE,CAEA,WAAY,CACX,MAAMzmD,EAAI+lD,EAAW,KAAK,EAAI,GAAG,EAChCzlD,EAAIylD,EAAW,KAAK,EAAI,GAAG,EAC3B7yD,EAAI6yD,EAAW,KAAK,EAAI,GAAG,EAE5B,MAAQ,OAAS/lD,EAAM,MAASM,EAAM,MAASpN,CAChD,CAGA,SAAS8wB,EAAiB,CACzB,OAAAA,EAAS,OAAOA,GAAW,SAAWA,EAAS,EAC/CA,EAAS,KAAK,MAAM,KAAOA,EAAS,IAAI,EAEjC,IAAI,EACV,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,KAAK,EAAIA,CAAM,CAAC,EAC1C,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,KAAK,EAAIA,CAAM,CAAC,EAC1C,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,KAAK,EAAIA,CAAM,CAAC,EAC1C,KAAK,CACN,CACD,CAEA,UAAU9/B,EAA0B,CACnC,IAAIwiE,EACJ,GAAK,OAAOxiE,GAAS,SACpB,GAAKgiE,EAAM,UAAU,eAAehiE,CAAI,EACvCwiE,EAAMR,EAAM,UAAUhiE,CAAI,MAE1B,OAAM,IAAI,MAAM,oBAAoB,OAErCwiE,EAAMxiE,EAEP,MAAMyiE,EAAQD,EAAI,CAAC,EAAGE,EAAQF,EAAI,CAAC,EAAGG,EAAQH,EAAI,CAAC,EAClDI,EAAQJ,EAAI,CAAC,EAAGK,EAAQL,EAAI,CAAC,EAAGM,EAAQN,EAAI,CAAC,EAC7CO,EAAQP,EAAI,CAAC,EAAGQ,EAAQR,EAAI,CAAC,EAAGS,EAAQT,EAAI,CAAC,EAKxCU,EAAK,QAAU,KAAK,EAAM,QAAU,KAAK,EAAM,QAAU,KAAK,EACnE7nD,EAAK,QAAU,KAAK,EAAM,QAAU,KAAK,EAAM,QAAU,KAAK,EAC9DmB,EAAK,SAAY,KAAK,EAAM,QAAW,KAAK,EAAM,QAAU,KAAK,EAG5D7b,EAAK8hE,EAAQS,EAAMR,EAAQrnD,EAAMsnD,EAAQnmD,EAC9C1X,EAAK89D,EAAQM,EAAML,EAAQxnD,EAAMynD,EAAQtmD,EACzCT,EAAKgnD,EAAQG,EAAMF,EAAQ3nD,EAAM4nD,EAAQzmD,EAG1C,IAAI0lD,EAAK,YAAevhE,EAAM,YAAemE,EAAM,WAAciX,EAChEomD,EAAK,aAAgBxhE,EAAM,YAAemE,EAAM,YAAeiX,EAC/DqmD,GAAK,eAAkBzhE,EAAM,cAAiBmE,EAAM,WAAciX,EAGnEmmD,EAAI,KAAK,EAAIA,EACbC,EAAI,KAAK,EAAIA,EACbC,GAAI,KAAK,EAAIA,GAGb,MAAMe,EAAM,EAAMjB,EAAM,EAAMC,EAAM,EAAMC,GACzCgB,EAAM,GAAMlB,EAAM,EAAMC,EAAM,EAAMC,GACpCiB,GAAM,GAAMnB,EAAM,EAAMC,EAAM,EAAMC,GAGrC,OAAAF,EAAI,KAAK,IAAI,KAAK,IAAI,EAAGiB,EAAK,KAAK,CAAC,EAAG,GAAG,EAC1ChB,EAAI,KAAK,IAAI,KAAK,IAAI,EAAGiB,EAAK,KAAK,CAAC,EAAG,GAAG,EAC1ChB,GAAI,KAAK,IAAI,KAAK,IAAI,EAAGiB,GAAK,KAAK,CAAC,EAAG,GAAG,EAEnC,IAAI,EAAUnB,EAAGC,EAAGC,GAAG,KAAK,CAAC,CACrC,CAED,EA/RqC,iBAArC,IAAMkB,EAAN,EAkSA,MAAM,EAAN,MAAM,CAA+B,CAOpC,YAAYpnD,EAAWH,EAAWO,EAAWvN,EAAY,CACxD,KAAK,EAAImN,GAAK,EACd,KAAK,EAAIH,GAAK,EACd,KAAK,EAAIO,GAAK,EACd,KAAK,EAAIvN,GAAK,CACf,CAEA,GAAGgZ,EAA0Bg6C,EAAc,GAAgB,CAC1D,OAAKh6C,aAAiB,EACd,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,IAAMg6C,GAAe,KAAK,IAAMh6C,EAAM,GACpGA,EAAQ,KAAK,GAAGA,EAAM,OAAO,EAAGg6C,CAAW,EAAI,EACvD,CAMA,GAAG7lD,EAAW,CAAE,OAAO,IAAI,EAAUA,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGH,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAGA,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGO,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAGA,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGvN,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAG,KAAK,EAAGA,CAAC,CAAG,CAMjE,OAAO,SAAS+M,EAAWM,EAAWpN,EAAWD,EAAY,CAC5D+M,GAAK,IAAKM,GAAK,IAAKpN,GAAK,IAEzB,MAAMvD,EAAM,KAAK,IAAIqQ,EAAGM,EAAGpN,CAAC,EAC3BxD,EAAM,KAAK,IAAIsQ,EAAGM,EAAGpN,CAAC,EACtBwM,EAAI,KAAK,IAAI,KAAK,IAAI,EAAG/P,EAAMD,CAAG,EAAG,CAAC,EAEtCuQ,EAAItQ,IAAQ,EAAI,EAAI+P,EAAI/P,EACxB6Q,EAAI7Q,EAEL,IAAIyQ,EAEJ,GAAKV,IAAM,EACVU,EAAI,MACA,CACJ,OAAOzQ,EAAK,CACX,KAAKqQ,EACJI,GAAKE,EAAIpN,GAAKwM,GAAKY,EAAIpN,EAAI,EAAI,GAC/B,MACD,KAAKoN,EACJF,GAAKlN,EAAI8M,GAAKN,EAAI,EAClB,MACD,QACCU,GAAKJ,EAAIM,GAAKZ,EAAI,CACpB,CACAU,GAAK,CACN,CAEA,OAAO,IAAI,EACVA,EACAH,EACAO,EACAvN,IAAM,OAAY,EAAIA,CACvB,CACD,CAMA,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CACxC,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CAExC,QAAS,CAAE,OAAOu0D,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAO,IAAM,CACxB,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAE3C,EAlFqC,iBAArC,IAAMjB,EAAN,EAqFA,MAAM,EAAN,MAAM,CAA+B,CAOpC,YAAYnmD,EAAWH,EAAWpb,EAAWoO,EAAY,CACxD,KAAK,EAAImN,GAAK,EACd,KAAK,EAAIH,GAAK,EACd,KAAK,EAAIpb,GAAK,EACd,KAAK,EAAIoO,GAAK,CACf,CAEA,GAAGgZ,EAA0Bg6C,EAAc,GAAgB,CAC1D,OAAKh6C,aAAiB,EACd,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,IAAMg6C,GAAe,KAAK,IAAMh6C,EAAM,GACpGA,EAAQ,KAAK,GAAGA,EAAM,OAAO,EAAGg6C,CAAW,EAAI,EACvD,CAMA,GAAG7lD,EAAW,CAAE,OAAO,IAAI,EAAUA,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGH,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAGA,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGpb,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAGA,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGoO,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAG,KAAK,EAAGA,CAAC,CAAG,CAMjE,OAAO,SAAS+M,EAAWM,EAAWpN,EAAWD,EAAY,CAC5D+M,GAAK,IAAKM,GAAK,IAAKpN,GAAK,IAEzB,MAAMvD,EAAM,KAAK,IAAIqQ,EAAEM,EAAEpN,CAAC,EACzBxD,EAAM,KAAK,IAAIsQ,EAAEM,EAAEpN,CAAC,EAEpBrO,EAAI,KAAK,IAAI,KAAK,IAAI,GAAI8K,EAAID,GAAO,CAAC,EAAG,CAAC,EAC1CgQ,EAAI,KAAK,IAAI,KAAK,IAAI,EAAG/P,EAAMD,CAAG,EAAG,CAAC,EAEvC,IAAI0Q,EAAGH,EAEP,GAAKP,IAAM,EACVU,EAAIH,EAAI,MACJ,CAEJ,OADAA,EAAIpb,EAAI,GAAM6a,GAAK,EAAI/P,EAAMD,GAAOgQ,GAAK/P,EAAMD,GACxCC,EAAK,CACX,KAAKqQ,EACJI,GAAKE,EAAIpN,GAAKwM,GAAKY,EAAIpN,EAAI,EAAI,GAC/B,MACD,KAAKoN,EACJF,GAAKlN,EAAI8M,GAAKN,EAAI,EAClB,MACD,QACCU,GAAKJ,EAAIM,GAAKZ,EAAI,CACpB,CACAU,GAAK,CACN,CAEA,OAAO,IAAI,EAAUA,EAAGH,EAAGpb,EAAGoO,IAAM,OAAY,EAAIA,CAAC,CACtD,CAOA,OAAQ,CACP,MAAMA,EAAI,KAAK,EACf,MAAO,MAAMA,IAAM,EAAI,IAAM,EAAE,IAAI,KAAK,MAAM,KAAK,EAAE,GAAG,CAAC,IAAI,KAAK,MAAM,KAAK,EAAE,GAAG,CAAC,KAAK,KAAK,MAAM,KAAK,EAAE,GAAG,CAAC,IAAIA,IAAM,EAAI,IAAI,KAAK,CAAC,GAAK,EAAE,GAC9I,CAEA,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CAExC,QAAS,CAAE,OAAOu0D,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAO,IAAM,CACxB,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAM1C,gBAAgBl7D,EAAgB,CAC/B,IAAI2T,EAAI,KAAK,EACZvQ,EAAM,EACNC,EAAM,EAEPsQ,GAAK,KAAK,IAAI,KAAK,EAAI,GAAM,CAAC,KAAK,EAAI,KAAK,EAAI,EAAG,CAAC,EAAI,EAExD,IAAIP,GAAK/P,EAAMD,GAAO,EACrB+3D,EAAM/3D,EAAMgQ,EAEb,KAAOA,EAAI,iBAASA,GAAK,EAAG+nD,EAAM/3D,EAAMgQ,EACrB8nD,EAAU,SAAS,KAAK,EAAGvnD,EAAGwnD,EAAK,CAAC,EAAE,UAAU,EAClDn7D,EACfqD,EAAM83D,EAEN/3D,EAAM+3D,EAIR,OAAO,IAAI,EAAU,KAAK,EAAGxnD,EAAGwnD,EAAK,KAAK,CAAC,CAC5C,CAGD,EA7GqC,iBAArC,IAAMjB,EAAN,EAgHA,MAAM,GAAN,OAAqC,CAOpC,YAAYl8D,EAAWC,EAAW47D,EAAWlzD,EAAY,CACxD,KAAK,EAAI3I,GAAK,EACd,KAAK,EAAIC,GAAK,EACd,KAAK,EAAI47D,GAAK,EACd,KAAK,EAAIlzD,GAAK,CACf,CAEA,GAAGgZ,EAAmBg6C,EAAc,GAAgB,CACnD,OAAKh6C,aAAiB,EACd,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,IAAMg6C,GAAe,KAAK,IAAMh6C,EAAM,GACpGA,EAAQ,KAAK,GAAGA,EAAM,OAAO,EAAGg6C,CAAW,EAAI,EACvD,CAMA,GAAG37D,EAAW,CAAE,OAAO,IAAI,EAAUA,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGC,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAGA,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAG47D,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAGA,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGlzD,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAG,KAAK,EAAGA,CAAC,CAAG,CAUjE,OAAO,SAAS+M,EAAWM,EAAWpN,EAAWD,EAAY,CAC5D,MAAMmzD,EAAIL,EAAW/lD,EAAI,GAAG,EAC3BqmD,EAAIN,EAAWzlD,EAAI,GAAG,EACtBgmD,EAAIP,EAAW7yD,EAAI,GAAG,EAEvB,OAAO,IAAI,EACV,QAAWkzD,EAAI,OAAWC,EAAI,QAAWC,EACzC,QAAWF,EAAI,OAAWC,EAAI,QAAWC,EACzC,QAAWF,EAAI,QAAWC,EAAI,QAAWC,EACzCrzD,IAAM,OAAY,EAAIA,CACvB,CACD,CAEA,OAAO,SAASpO,EAAWqb,EAAWM,EAAWu1C,EAAgB,CAChE,MAAM2R,EAAmB,GAAK,EAAU,MAAM,EAAI,GAAK,EAAU,MAAM,EAAI,EAAI,EAAU,MAAM,GAC9FC,EAAc,EAAI,EAAU,MAAM,EAAID,EACtCE,EAAc,EAAI,EAAU,MAAM,EAAIF,EAGjCG,EAAKhjE,EAAI,EAAK,KAAK,KAAKA,EAAI,IAAM,IAAK,CAAC,EAAIA,EAAI,EAAU,MAC/DoO,EAAI,EAAE,GAAO,GAAKpO,GAAMqb,EAAI,GAAKrb,EAAI8iE,GAAgB,GACrDz0D,EAAI,GAAK20D,EACTpoD,EAAI,GAAG,EACPC,EAAImoD,GAAO,GAAKhjE,GAAM2b,EAAI,GAAK3b,EAAI+iE,GAAgB,GAEnDE,GAAKpoD,EAAIxM,IAAMD,EAAIwM,GACnBsoD,EAAID,EAAI70D,EAAIC,EAEb,OAAO,IAAI,EAAU40D,EAAGD,EAAGE,EAAGhS,IAAU,OAAY,EAAIA,CAAK,CAC9D,CAMA,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CACxC,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CAExC,QAAS,CAAE,OAAOyR,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,IAAM,CACxB,QAAS,CAAE,OAAOQ,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACvE,EAhFqC,mBAArC,GAAM,EAiCE,QAAU,KAAK,IAAI,mBAAQ,CAAC,EAjC9B,EAkCE,MAAQ,KAAK,IAAI,kBAAQ,CAAC,EAlC5B,EAmCE,MAAQ,KAnChB,IAAMvB,EAAN,EAmFAA,EAAU,MAAQ,IAAIe,EAAU,IAAI,IAAI,IAAI,CAAC,EAAE,OAAO,EAGtD,MAAM,EAAN,MAAM,CAA+B,CAOpC,YAAY3iE,EAAWqb,EAAWM,EAAWvN,EAAY,CACxD,KAAK,EAAIpO,GAAK,EACd,KAAK,EAAIqb,GAAK,EACd,KAAK,EAAIM,GAAK,EACd,KAAK,EAAIvN,GAAK,CACf,CAEA,GAAGgZ,EAA0Bg6C,EAAc,GAAgB,CAC1D,OAAKh6C,aAAiB,EACd,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,GAAK,KAAK,IAAMA,EAAM,IAAMg6C,GAAe,KAAK,IAAMh6C,EAAM,GACpGA,EAAQ,KAAK,GAAGA,EAAM,OAAO,EAAGg6C,CAAW,EAAI,EACvD,CAMA,GAAGphE,EAAW,CAAE,OAAO,IAAI,EAAUA,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGqb,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAGA,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGM,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAGA,EAAG,KAAK,CAAC,CAAG,CACjE,GAAGvN,EAAW,CAAE,OAAO,IAAI,EAAU,KAAK,EAAG,KAAK,EAAG,KAAK,EAAGA,CAAC,CAAG,CAMjE,OAAO,SAAS60D,EAAWD,EAAWE,EAAW90D,EAAY,CAC5D,MAAMy0D,EAAmB,GAAKjB,EAAU,MAAM,EAAI,GAAKA,EAAU,MAAM,EAAI,EAAIA,EAAU,MAAM,GAC9FkB,EAAc,EAAIlB,EAAU,MAAM,EAAIiB,EACtCE,EAAc,EAAInB,EAAU,MAAM,EAAIiB,EAEtCO,EAASJ,EAAIpB,EAAU,MAAM,EAE9B,IAAIyB,EAAgBJ,EAAI,GAAKD,EAAI,EAAIE,EACjCG,IAAiB,IACpBA,EAAe,GAGhB,MAAMC,EAAc,EAAID,EAEvBE,EAAS,EAAIN,EAAIK,EACjBE,EAAS,EAAIR,EAAIM,EAEjBf,EAAKa,EAASxB,EAAU,QAAW,IAAM,KAAK,IAAIwB,EAAQ,EAAE,CAAC,EAAI,GAAKxB,EAAU,MAAQwB,EACxF/nD,EAAI,GAAKknD,GAAKgB,EAAST,GACvBnnD,EAAI,GAAK4mD,GAAKiB,EAAST,GAExB,OAAO,IAAI,EAAUR,EAAGlnD,EAAGM,EAAGvN,IAAM,OAAY,EAAIA,CAAC,CACtD,CAMA,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CACxC,OAAQ,CAAE,OAAO,KAAK,OAAO,EAAE,MAAM,CAAG,CAExC,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAO,KAAK,OAAO,EAAE,OAAO,CAAG,CAC1C,QAAS,CAAE,OAAOwzD,EAAU,SAAS,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAAG,CACtE,QAAS,CAAE,OAAO,IAAK,CAExB,EAtEqC,iBAArC,IAAMuB,EAAN,EA8FO,MAAM9B,EAAmB,CAC/B,UAAW,CACV,UAAW,CACV,EAAK,QAAS,SACd,EAAK,EAAU,EACf,EAAK,EAAU,CAChB,EACA,YAAa,CACZ,EAAU,EAAK,EACf,QAAU,EAAK,QACf,EAAU,EAAK,CAChB,EACA,UAAW,CACV,EAAW,EAAU,EACrB,EAAW,EAAU,EACrB,SAAW,QAAU,CACtB,CACD,EAEA,WAAY,CACX,OAAOA,EAAM,UACZA,EAAM,QAAU,SAAS,cAAc,QAAQ,GACzCA,EAAM,OACd,EACA,WAAY,KACJA,EAAM,WACZA,EAAM,SAAWA,EAAM,UAAU,EAAE,WAAW,IAAI,GAC5CA,EAAM,UAGd,KAAMsB,EACN,KAAMjB,EACN,KAAMC,EACN,KAAMC,EACN,KAAMuB,EAEN,QAAQ7zC,EAAe,CACtB,OAAOqzC,EAAU,QAAQrzC,CAAK,CAC/B,CACD,EAGa,EAAN,MAAM,CAAc,CAY1B,YAAY4qB,EAAO,UAAWlxB,EAAO,EAAG08B,EAAW,IAAK,CANxD,KAAQ,MAAiB,GACzB,KAAQ,OAA8B,IAAI,IAE1C,KAAQ,KAAe,EACvB,KAAQ,MAAgB,EAGvB,KAAK,UAAYA,EACjB,KAAK,MAAQxL,EACb,KAAK,MAAQlxB,EAEb,KAAK,gBAAgB,CACtB,CAEA,IAAI,UAAW,CAAE,OAAO,KAAK,SAAU,CACvC,IAAI,SAASvrB,EAAK,CAAE,KAAK,UAAYA,EAAK,KAAK,gBAAgB,CAAE,CAEjE,IAAI,MAAO,CAAE,OAAO,KAAK,KAAM,CAC/B,IAAI,KAAKA,EAAK,CAAE,KAAK,MAAQA,EAAK,KAAK,gBAAgB,CAAE,CAEzD,IAAI,MAAO,CAAE,OAAO,KAAK,KAAM,CAE/B,IAAI,MAAO,CAAE,OAAO,KAAK,KAAM,CAC/B,IAAI,KAAKA,EAAK,CAAE,KAAK,MAAQA,EAAK,KAAK,gBAAgB,CAAE,CAGzD,iBAAkB,CACjB,KAAK,OAAS,IAAI,IAElB,MAAMy8C,EAAOyoB,EAAU,QAAQ,KAAK,KAAK,EACzC,GAAK,CAAEzoB,EACN,MAAM,IAAI,MAAM,oBAAoB,EAErC,MAAMupB,EAAMvpB,EAAK,UAAU,GACnB,KAAK,MAAQupB,EAAM,KAG1B,KAAK,KAAO,IAAI7B,EACf,EACC,KAAK,WAAa1nB,EAAK,OAAO,EAAE,EAAI,KAAQ,IAC7C,EACA,CACD,EAAE,OAAO,EAAE,EAEX,KAAK,MAAQ,KAAK,WAAaA,EAAK,UAAU,EAAI,KAAQ,MAG1D,KAAK,KAAO,IAAI0nB,EACf,GACC1nB,EAAK,OAAO,EAAE,EAAI,KAAQ,KAAK,UAAY,IAC5C,EACA,CACD,EAAE,OAAO,EAAE,EAEX,KAAK,OAASA,EAAK,UAAU,EAAI,KAAQ,KAAK,UAAY,IAE5D,CAEA,QAAQ33B,EAA2BmhD,EAAe,GAAO,CACxD,GAAK,CAAEnhD,EACN,OAAO,KAER,GAAK,KAAK,QAAU,GACnB,MAAO,GAKR,GAHK,OAAOA,GAAU,WACrBA,EAAQA,EAAM,MAAM,GAEhB,KAAK,QAAU,EACnB,OAAOA,EAER,GAAK,KAAK,OAAO,IAAIA,CAAK,EACzB,OAAO,KAAK,OAAO,IAAIA,CAAK,EAE7B,IAAIohD,EAEJ,GAAI,CACHA,EAAMhB,EAAU,QAAQpgD,CAAK,CAC9B,OAAQjE,EAAK,CACZ,GAAKolD,EACJ,MAAMplD,EAEP,OAAO,IACR,CAEA,GAAK,CAAEqlD,EACN,OAAO,KAER,GAAK,KAAK,QAAU,EAAI,CAEvB,MAAM3S,EAAO2S,EAAI,UAAU,GAEtB,KAAK,MAAQ3S,EAAO,KAAK,MAAQA,EAAO,KAAK,SACjD2S,EAAMA,EAAI,OAAO,EAAE,gBAAgB,KAAK,KAAK,EAAE,OAAO,EAExD,SAAY,KAAK,QAAU,EAAI,CAE9B,MAAMC,EAAMD,EAAI,OAAO,GAClB,KAAK,MAAQC,EAAI,EAAI,KAAK,KAAOA,EAAI,EAAI,KAAK,QAClDD,EAAMC,EAAI,GAAG,KAAK,IAAI,EAAE,OAAO,EAEjC,SAAY,KAAK,QAAU,EAE1B,GAAK,KAAK,MACT,KAAQD,EAAI,MAAM,EAAI,IAAM,CAC3B,MAAME,EAAMF,EAAI,OAAO,EACvBA,EAAME,EAAI,GAAG,KAAK,IAAI,KAAK,IAAI,EAAG,GAAM,GAAMA,EAAI,CAAC,EAAG,CAAC,CAAC,EAAE,OAAO,CAClE,KAGA,MAAQF,EAAI,MAAM,GAAK,IAAM,CAC5B,MAAME,EAAMF,EAAI,OAAO,EACvBA,EAAME,EAAI,GAAG,KAAK,IAAI,KAAK,IAAI,EAAG,GAAMA,EAAI,CAAC,EAAG,CAAC,CAAC,EAAE,OAAO,CAC5D,SAEU,KAAK,QAAU,EAAI,CAE9B,IAAIt0D,EAAI,EACR,GAAK,KAAK,MACT,KAAQo0D,EAAI,UAAU,EAAI,KAAQp0D,IAAM,KACvCo0D,EAAMA,EAAI,SAAS,MAGpB,MAAQA,EAAI,UAAU,EAAI,IAAOp0D,IAAM,KACtCo0D,EAAMA,EAAI,SAAS,EAAE,CACxB,CAEA,MAAMxlE,EAAMwlE,EAAI,MAAM,EACtB,YAAK,OAAO,IAAIphD,EAAOpkB,CAAG,EACnBA,CACR,CACD,EAzI2B,qBAApB,IAAM2lE,EAAN,C,+FClrBQ,MAAM,EAAN,MAAM,UAAmB,SAAwC,CAuB/E,YAAY9kE,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EArBnB,UAAa,KAsBZ,KAAK,OAAO,QAAQ,EAEpB,KAAK,SAAW,CAAC,EAEjB,KAAK,OAAS,CAAC,EACf,KAAK,YAAc,CAAC,EACpB,KAAK,QAAU,KACf,KAAK,aAAe,KACpB,KAAK,cAAgB,KACrB,KAAK,MAAQ,KACb,KAAK,SAAW,IACjB,CAGA,SAASstB,EAAQ,EAA0B,CAC1C,MAAM3N,EAAQ,KAAK,KAAK,WAAqD,KAAM,GAAK,GAAG,OAAO,OAAO,EAGzG,GAFA,KAAK,QAAUA,GAAO,OAAO,QAExB,KAAK,QAAU,CACnB,KAAK,QAAQ,OAAOc,GAAY,CAC1B,KAAK,SACT,KAAK,YAAYA,CAAQ,CAC3B,CAAC,EAED,KAAK,YAAY,KAAK,QAAQ,QAAQ,EACtC,MACD,CAGA,MAAM4I,EAAQ,KAAK,KAAK,WAAW,KAAM,GAAK,GAAG,cAAc,QAAQ,SAAS,EAChF,KAAK,OAASA,GAAO,cAAc,OAEnC,MAAM28C,EAAM,KAAK,KAAK,WAAW,KAAM,GAAK,GAAG,cAAc,WAAW,IAAI,EAG5E,GAFA,KAAK,UAAYA,GAAK,cAAc,UAE/B,CAAE,KAAK,QAAU,CAAE,KAAK,UAC5B,OAAI14C,EAAQ,MACX,KAAK,IAAI,KAAK,+CAAgD,EAC9DA,EAAQ,SAGF,SAAM,EAAE,EAAE,KAAK,IAAM,KAAK,SAASA,EAAQ,CAAC,CAAC,EAGrD,KAAK,OAAO,UAAUyG,GAAO,CACvB,KAAK,SAAWA,GAAK,UACzB,KAAK,YAAYA,EAAI,QAAQ,CAC/B,CAAC,EAED,KAAK,YAAY,KAAK,OAAO,OAAO,MAAM,QAAQ,CACnD,CAEA,SAAS4d,EAAOt+B,EAAMpT,EAAM4F,EAAO,CAClC,MAAMsY,EAAM,KAAK,OAAOwzB,EAAOt+B,EAAMpT,CAAI,EACzC,KAAK,KAAKke,EAAKtY,CAAK,CACrB,CAEA,IAAI,eAAgB,CACnB,GAAI,KAAK,QACR,OAAO,KAAK,QAAQ,YACZ,KAAK,OACb,OAAO,KAAK,OAAO,OAAO,MAAM,QAClC,CAEA,KAAKsY,EAAatY,EAAgB,CACjC,GAAI,KAAK,QACR,KAAK,QAAQ,KAAKsY,EAAKtY,CAAK,UACpB,KAAK,UACb,KAAK,UAAU,KAAKsY,EAAKtY,CAAK,MAE9B,OAAM,IAAI,MAAM,0BAA0B,CAC5C,CAEA,QAAQsY,EAAatY,EAAgB,CACpC,GAAI,KAAK,QACR,KAAK,QAAQ,QAAQsY,EAAKtY,CAAK,UACvB,KAAK,UACb,KAAK,UAAU,QAAQsY,EAAKtY,CAAK,MAEjC,OAAM,IAAI,MAAM,yBAAyB,CAC3C,CAEQ,YAAY4a,EAAyB,CAC5C,KAAK,IAAI,MAAM,eAAgBA,CAAQ,EACvC,MAAM80C,EAAO,OAAO,SAAS,KAC5B5uB,EAAOlmB,EAAS,SAChBmmC,EAASnmC,EAAS,OAClB5a,EAAQ4a,EAAS,MAEbkmB,IAAS,KAAK,UAAY4uB,IAAS,KAAK,QAAU3O,IAAW,KAAK,WAAU,eAAY/gD,EAAO,KAAK,aAAa,IAGtH,KAAK,aAAe,KAAK,SACzB,KAAK,WAAa,KAAK,OACvB,KAAK,WAAa,KAAK,OACvB,KAAK,UAAY,KAAK,cAEtB,KAAK,SAAW8gC,EAChB,KAAK,OAASigB,EACd,KAAK,OAAS2O,EACd,KAAK,cAAgB1vD,EAErB,KAAK,WAAW,EACjB,CAEQ,YAAa,CACpB,MAAM8gC,EAAO,KAAK,SACjB4uB,EAAO,KAAK,OAEb,KAAK,UAAY,KAAK,QACtB,KAAK,SAAW,KAAK,aACrB,KAAK,UAAY,KAAK,MAEtB,UAAU5jB,KAAS,KAAK,SAAU,CACjC,GAAKA,EAAM,QAAUA,EAAM,SAAW4jB,EACrC,SAED,MAAM/0C,EAAQmxB,EAAM,MAAM,KAAKhL,CAAI,EACnC,GAAKnmB,IAAU,CAAEmxB,EAAM,UAAYA,EAAM,SAAS,KAAK,aAAa,GAAK,CACxE,KAAK,IAAI,MAAM,iBAAkBA,EAAOnxB,CAAK,EAC7C,KAAK,QAAUmxB,EACf,KAAK,aAAeA,EAAM,KAC1B,KAAK,MAAQnxB,EACb,KAAK,KAAK,SAAUmxB,EAAOnxB,CAAK,EAChC,MACD,CACD,CAEA,KAAK,QAAU,KAAK,aAAe,KAAK,MAAQ,KAChD,KAAK,KAAK,SAAU,KAAM,IAAI,CAC/B,CAEA,OAAOmxB,EAAOt+B,EAAMpT,KAASiF,EAAM,CAClC,MAAMkY,EAAI,KAAK,OAAOu0B,CAAK,EAC3B,GAAK,CAAEv0B,EACN,MAAM,IAAI,MAAM,yBAAyBu0B,CAAK,GAAG,EAElD,GAAK,OAAOt+B,GAAS,SAAW,CAC/B,MAAMimB,EAAQ,CAACjmB,EAAMpT,EAAM,GAAGiF,CAAI,EAClCmO,EAAO,CAAC,EAER,IAAI,EAAI,EACR,UAAUmmB,KAAQpc,EAAE,MACnB,GAAKoc,GAAQA,EAAK,OACjBnmB,EAAKmmB,EAAK,IAAI,EAAIF,EAAM,CAAC,EACzB,IACK,GAAKA,EAAM,QACf,KAGJ,CAEA,OAAOlc,EAAE,IAAI/J,EAAMpT,CAAI,CACxB,CAEA,SAASgB,EAAc,CACtB,OAAO,KAAK,OAAOA,CAAI,CACxB,CAEA,WAAY,CACX,OAAO,KAAK,MACb,CAEA,eAAgB,CACf,UAAU0wC,KAAS,OAAO,KAAK,KAAK,UAAU,CAAC,EAC9C,KAAK,aAAaA,CAAK,EAExB,OAAO,KAAK,WACb,CAEA,aAAaA,EAAe,CAC3B,OAAO,KAAK,YAAYA,CAAK,IAC5B,KAAK,YAAYA,CAAK,EAAIA,EACxB,QAAQ,gBAAiB,CAAC9zB,EAAGooD,IAC7B,cAAcA,EAAO,kBAAkB,CAAC,EAAE,EAC1C,QAAQ,gBAAiB,CAACpoD,EAAGqoD,EAAQD,IACrC,GAAGC,EAAS,IAAM,EAAE,GAAGD,EAAO,kBAAkB,CAAC,EAAE,GAE/C,KAAK,YAAYt0B,CAAK,CAC9B,CAEA,UAAUA,EAAwC1wC,EAAeqoC,EAAmB,GAAM,CACzF,GAAK,OAAOqI,GAAU,SAAW,CAChC,UAAUlyC,KAAOkyC,KACX,OAAIA,EAAOlyC,CAAG,GAClB,KAAK,UAAUA,EAAKkyC,EAAMlyC,CAAG,EAAG,EAAK,EAElC6pC,GACJ,KAAK,KAAK,sBAAsB,EACjC,MACD,CAEKroC,IACJ,KAAK,YAAY0wC,CAAK,EAAI1wC,EAErBqoC,GACJ,KAAK,KAAK,sBAAsB,EAEnC,CAEA,MAAMroC,EAAM0lC,EAAMw/B,EAAS,KAAMC,EAAW,KAAM98B,EAAU,GAAM,CACjE,GAAK,OAAOroC,GAAS,SAAW,CAC/BklE,EAASx/B,EACT,UAAUlnC,KAAOwB,KACX,OAAIA,EAAMxB,CAAG,GACjB,KAAK,MAAMA,EAAKwB,EAAKxB,CAAG,EAAG0mE,EAAQC,EAAU,EAAK,EAE/C98B,IACJ,KAAK,SAAS,KAAK,CAACj5B,EAAE,IAAM,EAAE,MAAQA,EAAE,KAAK,EACxC,KAAK,UACT,KAAK,WAAW,EACjB,KAAK,KAAK,iBAAiB,GAG5B,MACD,CAEA,MAAMipB,KAAQ,SAAMqN,CAAI,EACvB0/B,EAAQ/sC,EAAM,OAAO,CAACgtC,EAAO5mE,IAAQ4mE,GACpC,OAAO5mE,GAAQ,SACdA,EAAI,MAAM,GAAG,EAAE,OAAS,EACxB,GACC,CAAC,EACJiyC,EAAQ,KAAK,OAAO1wC,CAAI,EAAI,CAC3B,KAAAA,EACA,MAAAq4B,EACA,MAAA+sC,EACA,OAAAF,EACA,SAAAC,EACA,SAAO,kBAAe9sC,CAAK,EAC3B,OAAK,oBAAiBA,CAAK,CAC5B,EAED,KAAK,SAAS,KAAKqY,CAAK,EACnBrI,IACJ,KAAK,SAAS,KAAK,CAACj5B,EAAE,IAAM,EAAE,MAAQA,EAAE,KAAK,EACxC,KAAK,UACT,KAAK,WAAW,EACjB,KAAK,KAAK,iBAAiB,EAE7B,CACD,EA1QgF,kBAAjE,IAAMk2D,EAAN,C,2ECpCA,MAAM,EAAN,MAAM,UAAa,SAAgC,CAoBjE,YAAYtlE,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EAZnB,KAAQ,OAAwB,KAc/B,KAAK,UAAY,IAAI,IACrB,KAAK,eAAiB,IAAI,IAC1B,KAAK,UAAY,KACjB,KAAK,SAAW,CAAC,EACjB,KAAK,cAAgB,IACtB,CAGA,MAAM,SAASstB,EAAM,EAAkB,CAE/B,KAAK,eACX,KAAK,aAAe,MAAO,KAAK,OAAe,aAAa,KAAK,UAAY,YAAY,GAE1F,IAAItU,EAAO,KAAK,cAAc,oBAI9B,GAHKA,GAAM,eAAe,UACzBA,EAAOA,GAAM,eAETA,GAAM,QAAU,CACpB,KAAK,WAAaA,EAClB,KAAK,MAAQA,GAAM,SAAS,MAC5B,MACD,CAEA,GAAK,KAAK,cAAgB,CAAEA,EAAO,CAClC,IAAIvZ,EAAM,EAAK,aAAa,KAAK,aAAc,kBAAkB,EACjE,GAAKA,EAAM,CACV,KAAK,WAAa,KAClB,KAAK,MAAQ,KAAK,aAAaA,CAAG,EAClC,MACD,CACD,CAGC,GAAK6tB,EAAQ,IACZ,MAAM,IAAI,MAAM,uCAAuC,EAExD,YAAK,aAAe,KACb,IAAI,QAAclQ,GACxB,WAAWA,EAAG,EAAE,CAAC,EAAE,KAAK,IAAM,KAAK,SAASkQ,EAAM,CAAC,CAAC,CAQvD,CAGA,WAAY,CACX,KAAK,WAAa,KAAK,aAAe,KAAK,MAAQ,KAAK,SAAW,IACpE,CAGA,OAAO,aAAalrB,EAAYi2B,EAAuC,CACtE,UAAU54B,KAAO2C,EAChB,GAAKi2B,EAAS54B,EAAI,WAAW,GAAG44B,CAAM,GAAG,EAAK54B,EAAI,WAAW,0BAA0B,GAAKA,EAAI,WAAW,eAAe,EACzH,OAAOA,EACT,OAAO,IACR,CAOA,YAAY8xB,EAAkB,CAC7B,MAAK,CAAEA,GAAS,KAAK,MACb,KAAK,MACHA,aAAiB,KACnB,KAAK,iBAAiBA,CAAK,EACxBA,GAA0B,gBAC5BA,EAAyB,gBACvBA,GAA0B,oBAC5BA,EAAyB,oBACxBA,GAEH,IACR,CAEA,iBAAiBnvB,EAAY,CAG5B,OAFO,KAAK,WACX,KAAK,SAAW,EAAK,aAAaA,CAAI,GAChC,KAAK,SAGLA,EAAK,KAAK,QAAQ,GACxBA,EAAK,qBAAqB,eAAe,SACzCA,EAAK,qBAAqB,SAAW,KAJ9B,IAKT,CAEA,SAASmvB,EAAkB,CAC1B,OAAAA,EAAQ,KAAK,YAAYA,CAAK,EACvBA,GAAO,QAAU,IACzB,CAEA,cACCA,EACAi1C,EAAY,IACZC,EAAiB,GAChB,CACD,OAAO,KAAK,aACXl1C,EACA,GAAK,aAAa,KAClBi1C,EACA,EACAC,CACD,CACD,CAEA,aACCl1C,EACAi1C,EAAY,IACZC,EAAiB,GAChB,CACD,OAAO,KAAK,WACXl1C,EACA,GAAK,aAAa,KAClBi1C,EACA,EACAC,CACD,CACD,CAEA,YACCl1C,EACAi1C,EAAY,IACX,CACD,OAAO,KAAK,aAAoBj1C,EAAOi1C,CAAS,CACjD,CAIA,UAAUj1C,EAAkB,CAC3B,OAAO,KAAK,SAASA,CAAK,CAC3B,CAEA,cAAcA,EAAkB,CAE/B,OADa,KAAK,YAAYA,CAAK,GACtB,OAAS,IACvB,CAEA,YAAYA,EAAkB,CAC7B,MAAMnvB,EAAO,KAAK,YAAYmvB,CAAK,EACnC,GAAK,CAAEnvB,EACN,MAAO,CAAC,EAET,MAAMizC,EAAW,CAAC,EAClB,IAAIluC,EAAQ/E,EAAK,MACjB,KAAM+E,GACLkuC,EAAS,KAAKluC,CAAK,EACnBA,EAAQA,EAAM,QAGf,OAAOkuC,CACR,CAEA,aACC9jB,EACAm1C,EACAF,EAAY,GACZG,EAAQ,EACRF,EAAiB,GACF,CACf,GAAKE,EAAQH,EACZ,OAAO,KAER,MAAMpkE,EAAO,KAAK,YAAYmvB,CAAK,EAGnC,GAAK,CAAEnvB,EACN,OAAO,KAER,GAAK,OAAOskE,GAAa,SAAW,CACnC,MAAMj1B,EAAU,KAAK,UAAU,IAAIi1B,CAAQ,EAC3C,GAAK,CAAEj1B,EACN,MAAM,IAAI,MAAM,iBAAiB,EAElC,GAAK,CAAEA,EAAQ,MACd,OAAO,KAERi1B,EAAW,EAAA1pD,GAAKA,GAAKA,EAAE,cAAgBy0B,EAAQ,MAApC,WACZ,CAEA,MAAMzG,EAAO5oC,EAAK,UAClB,GAAK4oC,GAAQ07B,EAAS17B,EAAa5oC,CAAI,EACtC,OAAO4oC,EAWR,GAAK5oC,EAAK,OAAS,CAClB,MAAMyB,EAAS,KAAK,aAAoBzB,EAAK,OAAQskE,EAAUF,EAAWG,EAAM,EAAGF,CAAc,EACjG,GAAK5iE,EACJ,OAAOA,CACT,CAGA,GAAK4iE,GAAmBz7B,GAAc,cAAgB,CACrD,MAAMhrC,EAAUgrC,EAAa,eAAe,cAC3C47B,EAAc5mE,GAAU,KAAK,iBAAiBA,CAAM,EAErD,GAAK4mE,EAAc,CAClB,MAAM/iE,EAAS,KAAK,aAAoB+iE,EAAaF,EAAUF,EAAWG,EAAM,EAAGF,CAAc,EACjG,GAAK5iE,EACJ,OAAOA,CACT,CACD,CAEA,OAAO,IACR,CAEA,iBACC0tB,EACAm1C,EACAF,EAAY,GACZG,EAAQ,EACRF,EAAiB,GACF,CACf,GAAKE,EAAQH,EACZ,OAAO,KAER,MAAMpkE,EAAO,KAAK,YAAYmvB,CAAK,EAGnC,GAAK,CAAEnvB,EACN,OAAO,KAER,GAAKskE,EAAStkE,CAAI,EACjB,OAAOA,EAER,GAAKA,EAAK,OAAS,CAClB,MAAMyB,EAAS,KAAK,iBAAwBzB,EAAK,OAAQskE,EAAUF,EAAWG,EAAM,EAAGF,CAAc,EACrG,GAAK5iE,EACJ,OAAOA,CACT,CAGA,MAAMmnC,EAAO5oC,EAAK,UAClB,GAAKqkE,GAAmBz7B,GAAc,cAAgB,CACrD,MAAMhrC,EAAUgrC,EAAa,eAAe,cAC3C47B,EAAc5mE,GAAU,KAAK,iBAAiBA,CAAM,EAErD,GAAK4mE,EAAc,CAClB,MAAM/iE,EAAS,KAAK,iBAAwB+iE,EAAaF,EAAUF,EAAWG,EAAM,EAAGF,CAAc,EACrG,GAAK5iE,EACJ,OAAOA,CACT,CACD,CAEA,OAAO,IACR,CAEA,WACC0tB,EACAm1C,EACAF,EAAY,GACZG,EAAQ,EACRF,EAAiB,GACF,CACf,GAAKE,EAAQH,EACZ,OAAO,KAER,MAAMpkE,EAAO,KAAK,YAAYmvB,CAAK,EAGnC,GAAK,CAAEnvB,EACN,OAAO,KAER,GAAKskE,EAAStkE,CAAI,EACjB,OAAOA,EAGR,GAAKA,EAAmC,cACvCA,EAAK,WAAW,aAEhB,OAAO,KAER,IAAI+E,EAAQ/E,EAAK,MACjB,KAAM+E,GAAO,CACZ,MAAMtD,EAAS,KAAK,WAAkBsD,EAAOu/D,EAAUF,EAAWG,EAAM,EAAGF,CAAc,EACzF,GAAK5iE,EACJ,OAAOA,EACRsD,EAAQA,EAAM,OACf,CAEA,MAAM6jC,EAAO5oC,EAAK,UAClB,GAAKqkE,GAAmBz7B,GAAc,OAAO,KAAO,CACnD,MAAMhyB,EAAQgyB,EAAa,MAAM,KAAK,oBACtC,GAAKhyB,EAAO,CACX,IAAI7R,EAAQ6R,EAAK,eAAe,SAAWA,EAAK,QAChD,KAAM7R,GAAO,CACZ,MAAMtD,EAAS,KAAK,WAAkBsD,EAAOu/D,EAAUF,EAAWG,EAAM,EAAGF,CAAc,EACzF,GAAK5iE,EACJ,OAAOA,EAERsD,EAAQA,EAAM,OACf,CACD,CACD,CAEA,OAAO,IACR,CA0CA,WAGCoqB,EACAm1C,EACAF,EAAoB,GACpBG,EAAgB,EAChBF,EAA0B,GAC1Bj2C,EAC4B,CAC5B,MAAMpuB,EAAO,KAAK,YAAYmvB,CAAK,EAKnC,GAJKf,GAAS,EAAGA,aAAiB,OACjCA,EAAQ,IAAI,KAGR,CAAEpuB,GAAQukE,EAAQH,EACtB,OAAOh2C,GAAgB,KAExB,GAAK,OAAOk2C,GAAa,SAAW,CACnC,MAAMj1B,EAAU,KAAK,UAAU,IAAIi1B,CAAQ,EAC3C,GAAK,CAAEj1B,EACN,MAAM,IAAI,MAAM,iBAAiB,EAElC,GAAK,CAAEA,EAAQ,MACd,OAAOjhB,GAAgB,KAExBk2C,EAAW,EAAA1pD,GAAKA,GAAKA,EAAE,cAAgBy0B,EAAQ,MAApC,WACZ,CAEA,MAAMzG,EAAO5oC,EAAK,UAClB,GAAK4oC,GAAQ07B,EAAS17B,EAAa5oC,CAAI,EACtC,GAAKouB,EACJA,EAAM,IAAIwa,CAAa,MAEvB,QAAOA,EAIT,GAAK5oC,EAAmC,cACvCA,EAAK,WAAW,aAEhB,OAAOouB,GAAgB,KAExB,IAAIrpB,EAAQ/E,EAAK,MACjB,KAAM+E,GAAO,CACZ,MAAMtD,EAAS,KAAK,WAAkBsD,EAAOu/D,EAAUF,EAAWG,EAAM,EAAGF,EAAgBj2C,CAAY,EACvG,GAAK3sB,GAAU,CAAE2sB,EAChB,OAAO3sB,EACRsD,EAAQA,EAAM,OACf,CAEA,GAAKs/D,GAAmBz7B,GAAc,OAAO,KAAO,CACnD,MAAMhyB,EAAQgyB,EAAa,MAAM,KAAK,oBACtC,GAAKhyB,EAAO,CACX,IAAI7R,EAAQ6R,EAAK,eAAe,SAAWA,EAAK,QAChD,KAAM7R,GAAO,CACZ,MAAMtD,EAAS,KAAK,WAAkBsD,EAAOu/D,EAAUF,EAAWG,EAAM,EAAGF,EAAgBj2C,CAAY,EACvG,GAAK3sB,GAAU,CAAE2sB,EAChB,OAAO3sB,EAERsD,EAAQA,EAAM,OACf,CACD,CACD,CAEA,OAAOqpB,GAAgB,IACxB,CAGA,gBACCe,EACAm1C,EACAF,EAAY,GACZK,EAAe,GACfC,EAAQ,GACRH,EAAM,EACNF,EAAe,GACd,CACD,MAAMp0B,EAAU,IAAI,IACpB,IAAI00B,EAAqB,GAAC/7B,EAAM5oC,IAAS,CAAEiwC,EAAQ,IAAIrH,CAAa,GAAK07B,EAAS17B,EAAa5oC,CAAI,EAA1E,QAEzB,OAAY,CACX,MAAMoe,EAAQsmD,EACb,KAAK,aAAav1C,EAAOw1C,EAAMP,EAAWG,EAAOF,CAAc,EAC/D,KAAK,WAAWl1C,EAAOw1C,EAAMP,EAAWG,EAAOF,CAAc,EAE9D,GAAK,CAAEjmD,EACN,MAED,GAAKqmD,GAAgB,CAAEx0B,EAAQ,KAAO,CACrC,MAAMgH,EAAQ74B,EAAM,YACpBumD,EAAO,GAAC/7B,EAAM5oC,IAAS,CAAEiwC,EAAQ,IAAIrH,CAAa,GAAMA,aAAgBqO,GAAUqtB,EAAS17B,EAAa5oC,CAAI,EAArG,OACR,CAEAiwC,EAAQ,IAAI7xB,CAAc,CAC3B,CAEA,OAAO6xB,CACR,CAGA,UACC9gB,EACAy1C,EACAR,EAAY,GACZG,EAAQ,EACRtzD,EASW,KACXozD,EAAiB,GAChB,CACD,MAAMrkE,EAAO,KAAK,YAAYmvB,CAAK,EAanC,GAXOle,IACNA,EAAO,CACN,KAAM,IAAI,IACV,QAAS2zD,EAAU,IAAI,IAAM,IAAI,EACjC,IAAKA,EAAU,IAAI,KAAO,CACzB,IAAK,KAAM,UAAW,IAAI,IAAK,MAAO,IACvC,EAAE,EACF,UAAWL,CACZ,GAGI,CAAEvkE,GAAQukE,EAAQH,EACtB,OAAOnzD,EAAK,IAERszD,EAAQtzD,EAAK,YACjBA,EAAK,UAAYszD,GAElB,MAAM37B,EAAO5oC,EAAK,UAClB,GAAK4oC,EAAO,CACX,MAAMC,EAAMD,EAAK,YAChBhsB,EAAM3L,EAAK,QAAQ,QAAQ43B,CAAG,EAE/B,GAAKjsB,IAAQ,GACZ3L,EAAK,IAAI2L,CAAG,EAAE,UAAU,IAAIgsB,CAAI,UAEvB,CAAE33B,EAAK,KAAK,IAAI43B,CAAG,EAAI,CAChC,IAAIz5B,EAAIw1D,EAAU,OAClB,KAAMx1D,KAAM,GACX,GAAKw1D,EAAUx1D,CAAC,EAAEw5B,EAAM5oC,CAAI,EAAI,CAC/BiR,EAAK,QAAQ7B,CAAC,EAAI6B,EAAK,IAAI7B,CAAC,EAAE,IAAMy5B,EACpC53B,EAAK,IAAI7B,CAAC,EAAE,UAAU,IAAIw5B,CAAI,EAC9B33B,EAAK,IAAI7B,CAAC,EAAE,MAAQm1D,EACpB,KACD,CAEDtzD,EAAK,KAAK,IAAI43B,CAAG,CAClB,CACD,CAGA,GAAK7oC,EAAmC,cACvCA,EAAK,WAAW,aAEhB,OAAOiR,EAAK,IAEb,IAAIlM,EAAQ/E,EAAK,MACjB,KAAM+E,GACL,KAAK,UAAUA,EAAO6/D,EAAWR,EAAWG,EAAM,EAAGtzD,EAAMozD,CAAc,EACzEt/D,EAAQA,EAAM,QAGf,GAAKs/D,GAAmBz7B,GAAc,OAAO,KAAO,CACnD,MAAMhyB,EAAQgyB,EAAa,MAAM,KAAK,oBACtC,GAAKhyB,EAAO,CACX,IAAI7R,EAAQ6R,EAAK,eAAiBA,EAAK,cAAc,SAAWA,EAAK,QACrE,KAAM7R,GACL,KAAK,UAAUA,EAAO6/D,EAAWR,EAAWG,EAAM,EAAGtzD,EAAMozD,CAAc,EACzEt/D,EAAQA,EAAM,OAEhB,CACD,CAEA,OAAOkM,EAAK,GACb,CAOA,MAAMs+B,EAAe,CACpB,KAAK,OAASA,EACd,KAAK,mBAAmB,CACzB,CAGA,oBAAqB,CACpB,MAAME,EAAoB,KAAK,cAAgB,CAAC,EAC/Co1B,EAAsB,KAAK,cAAgB,CAAC,EAC5Ct1B,EAAQ,KAAK,OAEd,GAAK,KAAK,SACT,UAAUqC,KAAU,KAAK,SAEnBA,EAAO,SAAW,IAAS,CAAEA,EAAO,WAGpC,CAAErC,GAAS,CAAEqC,EAAO,QAAQ,QAAUA,EAAO,OAAO,SAASrC,CAAK,KACtEE,EAAG,KAAKmC,CAAM,EACdizB,EAAI,KAAKjzB,EAAO,QAAQ,GAIpB,KAAK,cAAc,OAEd,KAAK,gBAChB,KAAK,cAAc,EAFnB,KAAK,aAAa,CAGpB,CAGA,OACCv0C,EACAinE,EACAl1B,EAAkC,KACjC,CACD,GAAK,KAAK,UAAU,IAAI/xC,CAAG,EAC1B,OAAO,KAAK,UAAU,IAAIA,CAAG,EAE9B,GAAK,CAAEinE,EACN,MAAM,IAAI,MAAM,iDAAiD,EAElE,MAAMj1B,EAAU,IAAIy1B,EAAmBznE,EAAKinE,EAAiBl1B,EAAQ,IAAI,EACzE,KAAK,UAAU,IAAI/xC,EAAKgyC,CAAO,EAE/B,MAAMp+B,EAAO,KAAK,MACf,KAAK,UAAU,KAAK,MAAO,CAACqzD,CAAe,EAAG,GAAI,EAAE,CAAC,EACrD,KAEH,OAAKrzD,GAAM,KACVo+B,EAAQ,KAAKp+B,EAAK,IAAKA,EAAK,SAAuB,EACnD,KAAK,eAAe,IAAIA,EAAK,IAAKo+B,CAAO,GAE9BD,IAAW,KACtB,KAAK,SAAS,KAAKC,CAAO,EAC1B,KAAK,mBAAmB,GAGlBA,CACR,CAGA,KACChyC,EACAwrC,EACC,CACD,IAAIwG,EAQJ,GAPK,KAAK,UAAU,IAAIhyC,CAAG,EAC1BgyC,EAAU,KAAK,UAAU,IAAIhyC,CAAG,GAEhCgyC,EAAU,IAAIy1B,EAAYznE,EAAK,KAAM,KAAM,IAAI,EAC/C,KAAK,UAAU,IAAIA,EAAKgyC,CAAO,GAG3BxG,EAAM,CACV,GAAKwG,EAAQ,OAASA,EAAQ,SAC7B,MAAM,IAAI,MAAM,6DAA6D,EAE9EA,EAAQ,KAAKxG,EAAK,IAAI,GAAG,EACzB,KAAK,eAAe,IAAIA,EAAKwG,CAAO,CACrC,CAEA,OAAOA,CACR,CAGA,cAAc6R,EAAiE,KAAM,CACpF,GAAO,KAAK,cAGZ,CAAO,MAAM,QAAQA,CAAK,IACzBA,EAAQ,CAACA,CAAK,GAEf,QAAQ/xB,KAAS+xB,EAAO,CACvB,GAAK,CAAE,KAAK,cAAc,QAAU,CAAE,KAAK,cAC1C,MAED,IAAIlhD,EAAyB,KAW7B,GAVK,CAAEmvB,GAAS,KAAK,MACpBnvB,EAAO,KAAK,MACHmvB,aAAiB,KAC1BnvB,EAAO,KAAK,iBAAiBmvB,CAAK,EACxBA,GAA0B,gBACpCnvB,EAAQmvB,EAAyB,gBACvBA,GAA0B,sBACpCnvB,EAAQmvB,EAAyB,qBAG9B,CAAEnvB,GACJA,EAAmC,cACpCA,EAAK,WAAW,aAEhB,SAED,MAAMiR,EAAO,KAAK,UACjBjR,EAAM,KAAK,cAAe,GAC3B,EAEA,IAAIoP,EAAI6B,EAAK,OACb,KAAM7B,KAAM,GACX,GAAK6B,EAAK7B,CAAC,EAAE,IAAM,CAClB,MAAMsL,EAAIzJ,EAAK7B,CAAC,EACfuM,EAAI,KAAK,cAAc,OAAOvM,EAAG,CAAC,EAAE,CAAC,EAEtC,KAAK,cAAc,OAAOA,EAAG,CAAC,EAE9B,MAAMwN,EAAM,KAAK,SAAS,QAAQjB,CAAC,EAC9BiB,IAAQ,IACZ,KAAK,SAAS,OAAOA,EAAK,CAAC,EAE5B,KAAK,IAAI,MAAM,oBAAoBjB,EAAE,IAAI,cAAcjB,EAAE,KAAK,EAAE,EAChEiB,EAAE,KAAKjB,EAAE,IAAKA,EAAE,SAAgC,CACjD,CAEF,CAEO,KAAK,cAAc,QACzB,KAAK,aAAa,EACpB,CAGA,eAAgB,CACf,KAAK,IAAI,KAAK,8BAA8B,EAC5C,KAAK,eAAiB,YAAY,IAAM,KAAK,cAAc,EAAG,GAAG,EAE1D,KAAK,YACX,KAAK,UAAY,IAAI,iBAAiBk1B,GACrC,KAAK,cAAcA,EAAU,IAAItqC,GAAKA,EAAE,MAAM,CAAC,CAChD,GAED,KAAK,UAAU,QAAQ,SAAS,KAAM,CACrC,UAAW,GACX,QAAS,EACV,CAAC,CACF,CAGA,cAAe,CACd,KAAK,IAAI,KAAK,4BAA4B,EAErC,KAAK,WACT,KAAK,UAAU,WAAW,EAEtB,KAAK,gBACT,cAAc,KAAK,cAAc,EAElC,KAAK,cAAgB,KACrB,KAAK,cAAgB,KACrB,KAAK,eAAiB,IACvB,CACD,EA5tBkE,YAAnD,IAAMy/D,EAAN,EAyuBf,MAAMC,EAAiD,CACtD,aAAc,4BACd,MAAO,oBACP,OAAQ,SACR,gBAAiB,mCACjB,gBAAiB,wBACjB,cAAe,6BACf,OAAQ,qBACR,QAAS,sBACV,EAqBa,EAAN,MAAM,UAAmE,cAAmC,CAWlH,YAAYnmE,EAAcylE,EAAsCl1B,EAAiC7sB,EAAY,CAC5G,MAAM,EAEN,KAAK,KAAO1jB,EACZ,KAAK,SAAWylE,EAChB,KAAK,KAAO/hD,EAEZ,KAAK,UAAY,IAAI,IACrB,KAAK,OAAS6sB,GAAU,CAAC,EAEzB,KAAK,SAAW,IAAI,IACpB,KAAK,OAAS,IAEf,CAEA,IAAI,OAAQ,CAAE,OAAO,KAAK,MAAQ,CAElC,IAAI,OAAQ,CACX,OAAO,KAAK,QAAQ,EAAE,CAAC,CACxB,CAEU,kBAA6B,CACtC,MAAMpxC,EAAM,MAAM,iBAAiB,EAEnC,UAAUyf,KAASzf,EAAK,CACvB,MAAMX,EAAM2nE,EAAOvnD,CAAK,EACxB,GAAKpgB,EACJ,GAAI,CACH,KAAK,QAAQA,CAAoC,CAClD,MAAa,CAAmB,CAClC,CAEA,OAAOW,CACR,CAEA,SAAU,CACT,OAAO,MAAM,KAAK,KAAK,SAAS,CACjC,CAEA,MACCgC,EAAiD,KACjDokE,EAAY,IACX,CACD,GAAK,KAAK,QAAU,CAAE,KAAK,SAC1B,OAED,MAAMt7B,EAAY,KAAK,KAAK,gBAAuB9oC,EAAM,KAAK,SAAiBokE,CAAS,EACxF,GAAKt7B,EAAU,KAAO,CACrB,MAAMm8B,EAAQ,MAAM,KAAKn8B,CAAS,EAClC,KAAK,KAAKm8B,EAAM,CAAC,EAAE,YAAoBA,CAAK,CAC7C,CACD,CAEA,MAAM7iE,EAA8D,CAC9D,KAAK,OACTA,EAAG,KAAK,OAAQ,KAAK,SAAS,EAE9B,KAAK,KAAK,MAAOA,CAAE,CACrB,CAEA,KAAKA,EAA2B,CAC/B,UAAUwmC,KAAQ,KAAK,UACtBxmC,EAAGwmC,CAAI,CACT,CAEA,gBACC5oC,EAAiD,KACjDokE,EAAY,IACX,CACD,GAAK,CAAE,KAAK,OACX,OAED,MAAMt7B,EAAY,KAAK,KAAK,gBAC3B9oC,EACA,GAAK,EAAE,cAAgB,KAAK,OAC5BokE,CACD,EAEA,UAAUx7B,KAAQE,EACjBF,EAAK,aAAe,GACpB,KAAK,UAAU,IAAIA,CAAI,CAEzB,CAEA,KAAKC,EAAuBC,EAA4B,CACvD,GAAK,KAAK,OACT,MAAM,IAAI,MAAM,sBAAsB,EAEvC,KAAK,OAASD,EACbA,EAAY,aAAe,KAE5B,MAAMhuB,EAAI,KACTqqD,EAAa,KAAK,UAClB9R,EAAQvqB,EAAI,UACZs8B,EAAU/R,EAAM,0BAChBgS,EAAYhS,EAAM,qBAElBiS,EAAQjS,EAAM,0BAA4B+R,EACzC,YAAyBriE,EAA+D,CACvF,YAAK,aAAe,GACpBoiE,EAAW,IAAI,IAAI,EACnBrqD,EAAE,KAAK,aAAc,KAAM,GAAG/X,CAAI,EAC3BqiE,EAAQ,MAAM,KAAMriE,CAAI,CAChC,EACA,YAAyBA,EAA+D,CACvF,KAAK,aAAe,GACpBoiE,EAAW,IAAI,IAAI,EACnBrqD,EAAE,KAAK,aAAc,KAAM,GAAG/X,CAAI,CACnC,EAEDwiE,EAAUlS,EAAM,qBAAuBgS,EACtC,YAAyBtiE,EAA0D,CAClF+X,OAAAA,EAAE,KAAK,UAAW,KAAM,GAAG/X,CAAI,EAC/BoiE,EAAW,OAAO,IAAI,EACtB,KAAK,aAAe,GACbE,EAAU,MAAM,KAAMtiE,CAAI,CAClC,EACA,YAAyBA,EAA0D,CAClF+X,EAAE,KAAK,UAAW,KAAM,GAAG/X,CAAI,EAC/BoiE,EAAW,OAAO,IAAI,EACtB,KAAK,aAAe,EACrB,EAEF,KAAK,SAAS,IAAI,4BAA6B,CAACG,EAAOF,CAAO,CAAC,EAC/D,KAAK,SAAS,IAAI,uBAAwB,CAACG,EAASF,CAAS,CAAC,EAE9D,UAAU3nD,KAAS,KAAK,OAAO,EAC9B,KAAK,WAAWA,CAAK,EAEtB,GAAKqrB,EACJ,UAAUF,KAAQE,EAGjBF,EAAK,aAAe,GACpBs8B,EAAW,IAAIt8B,CAAI,EAGrB,KAAK,KAAK,MAAOC,EAAKq8B,CAAU,CACjC,CAEQ,KAAKp8B,EAA4B,CACxC,UAAUF,KAAQE,EACjB,KAAK,UAAU,IAAIF,CAAI,CACzB,CAGQ,WAAWnrB,EAAe,CACjC,MAAMpgB,EAAM2nE,EAAOvnD,CAA4B,EAC1C,CAAE,KAAK,QAAU,CAAEpgB,GAAO,KAAK,SAAS,IAAIA,CAAG,GAGpD,KAAK,MAAMogB,EAAOpgB,CAAoC,CACvD,CAEQ,MAAwBogB,EAAUpgB,EAAoC,CAC7E,GAAK,KAAK,SAAS,IAAIA,CAAG,GAAK,CAAE,KAAK,OACrC,OAED,MAAMwd,EAAI,KACTu4C,EAAQ,KAAK,OAAO,UACpBrK,EAAWqK,EAAM/1D,CAAG,EAEpB+E,EAAMgxD,EAAc/1D,CAAG,EAAI0rD,EAC1B,YAAyBjmD,EAAqC,CAC7D,OAAO,KAAK,eACX,KAAK,aAAe,GACpB+X,EAAE,UAAU,IAAI,IAAI,EACpBA,EAAE,KAAK,aAAc,IAAI,GAG1BA,EAAE,KAAK4C,EAAc,KAAM,GAAG3a,CAAI,EAC3BimD,EAAS,MAAM,KAAMjmD,CAAI,CACjC,EAEAzF,IAAQ,wBACP,YAAyByF,EAAqC,CAC7D,OAAO,KAAK,eACX,KAAK,aAAe,GACpB+X,EAAE,UAAU,IAAI,IAAI,EACpBA,EAAE,KAAK,aAAc,IAAI,GAG1BA,EAAE,KAAK4C,EAAc,KAAM,GAAG3a,CAAI,EAC3B,EACR,EAEA,YAAyBA,EAAqC,CACtD,KAAK,eACX,KAAK,aAAe,GACpB+X,EAAE,UAAU,IAAI,IAAI,EACpBA,EAAE,KAAK,aAAc,IAAI,GAG1BA,EAAE,KAAK4C,EAAc,KAAM,GAAG3a,CAAI,CACnC,EAEH,KAAK,SAAS,IAAIzF,EAAK,CAAC+E,EAAI2mD,CAAQ,CAAC,CACtC,CAEQ,QAAQ1rD,EAAoC,CACnD,MAAM46B,EAAO,KAAK,SAAS,IAAI56B,CAAG,EAClC,GAAK,CAAE46B,GAAQ,CAAE,KAAK,OACrB,OAED,MAAMm7B,EAAQ,KAAK,OAAO,UACzB,CAAChxD,EAAI2mD,CAAQ,EAAI9wB,EAElB,GAAKm7B,EAAM/1D,CAAG,IAAM+E,EACnB,MAAM,IAAI,MAAM,wCAAwC,EAEzDgxD,EAAM/1D,CAAG,EAAI0rD,EACb,KAAK,SAAS,OAAO1rD,CAAG,CACzB,CAGA,aAAc,CACb,UAAUurC,KAAQ,KAAK,UACtB,GAAI,CACHA,EAAK,YAAY,EACjB,KAAK,KAAK,KAAK,kBAAmB,KAAK,KAAMA,CAAI,CAElD,OAAQzqB,EAAK,CACPA,aAAe,OACnB,KAAK,KAAK,IAAI,QAAQA,EAAK,CAC1B,KAAM,CACL,aAAc,KAAK,IACpB,CACD,CAAC,EAEF,KAAK,KAAK,IAAI,MAAM,gEAAgE,KAAK,IAAI,GAAIA,CAAG,CACrG,CACF,CAGA,GACCV,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,YAAK,WAAW9nD,CAAK,EACd,MAAM,GAAGA,EAAOrb,EAAIua,EAAKuY,EAAUqwC,CAAO,CAClD,CAGA,KACC9nD,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,YAAK,WAAW9nD,CAAK,EACd,MAAM,KAAKA,EAAOrb,EAAIua,EAAKuY,EAAUqwC,CAAO,CACpD,CAEA,KACC9nD,EACA+nD,EACApjE,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,YAAK,WAAW9nD,CAAK,EACd,MAAM,KAAKA,EAAO+nD,EAAKpjE,EAAIua,EAAKuY,EAAUqwC,CAAO,CACzD,CAEA,QACC9nD,EACAd,EACAuY,EACAqwC,EAAmB,GAClB,CACD,YAAK,WAAW9nD,CAAK,EACd,MAAM,QAAQA,EAAOd,EAAKuY,EAAUqwC,CAAO,CACnD,CACD,EAjSmH,mBAA5G,IAAMT,EAAN,C,isBCjyBA,MAAMW,EAAQ,aAAa,eAAiB,QAAU,SAAS,KAAK,UAAU,SAAS,SAAS,EAG1FC,EAAY,GAGZC,EAASF,EAAQ,yBAA2B,gCAEzD,IAAIlhC,EAAO,GAAGohC,CAAM,UAEfD,IACJnhC,EAAO,IACFA,EAAK,SAAS,GAAG,IACrBA,EAAOA,EAAK,MAAM,EAAGA,EAAK,OAAS,CAAC,IAI/B,MAAMqhC,EAAgBrhC,EAGhBshC,EAAa,+BAGbC,EAAc,uCAGdC,EAAc,uCAGdC,EAAU,gCAGVC,EAAY,qEAEZC,EAAkB,w7CAMlBC,EAAqE,CACjF,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,GAAI,CAAC,GAAG,EAAE,EACV,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,IAAK,CAAC,GAAG,EAAE,EACX,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,EACZ,KAAM,CAAC,GAAG,EAAE,CACb,EAGaC,EAAc,CAC1B,IACA,QACA,IACA,WACA,aACA,MACA,IACA,IACA,QACA,OACD,EAGaC,EAAoB,CAChC,mBACA,gBACA,oBACA,iBACA,oBACA,sBACA,qBACA,wBACA,8BACA,iCACA,oCACA,qBACA,yBACA,+BACA,0BACA,8BACA,8BACA,oCACA,wBACD,EAMaC,EAAwB,CACpC,oBACA,qBACA,yBACA,wBACD,EAMaC,EAAwB,CACpC,sBACA,iBACA,uBACA,mBACA,4BACA,kBACA,oBACA,qBACA,wBACA,sBACA,0BACA,6BACA,kCACA,uBACA,sBACA,2BACA,2BACA,4BACA,uBACA,uBACA,uBACD,EAMaxpE,EAAO,CACnB,IAAK,EACL,MAAO,GACP,MAAO,GACP,QAAS,GACT,IAAK,GACL,OAAQ,GACR,MAAO,GACP,OAAQ,GACR,SAAU,GACV,IAAK,GACL,KAAM,GACN,UAAW,GACX,QAAS,GACT,WAAY,GACZ,UAAW,GACX,KAAM,GACN,QAAS,EACV,EAGaypE,EAAkB,sCAMlBC,EAAsC,CAClD,aAAc,MACd,aAAc,MACd,cAAe,KACf,aAAc,MACd,YAAa,OACb,cAAe,KACf,SAAU,MACV,iBAAkB,MAClB,WAAY,MACZ,WAAY,MACZ,aAAc,MACd,aAAc,MACd,YAAa,KACb,eAAgB,MAChB,WAAY,MACZ,SAAU,MACV,kBAAmB,MACnB,oBAAqB,MACrB,SAAU,MACV,aAAc,MACd,cAAe,KACf,eAAgB,UACjB,EAGaC,EAAmB,GAAGf,CAAM,wBAG5BgB,EAAuC,CACnD,GAAI,mBACJ,GAAI,uBACJ,GAAI,wBACJ,GAAI,mBAIJ,GAAI,iBACJ,GAAI,oBAEJ,GAAI,mBACJ,GAAI,kBACJ,GAAI,eACL,EAMaC,EAAc,CAC1B,WAAY,CACX,CAAC,iCAAkC,GAAI,EACvC,CAAC,sCAAuC,EAAG,EAC3C,CAAC,iCAAkC,EAAG,EACtC,CAAC,+BAAgC,CAAC,EAClC,CAAC,iCAAkC,CAAC,EACpC,CAAC,8BAA+B,CAAC,EACjC,CAAC,gCAAiC,CAAC,EACnC,CAAC,gCAAiC,CAAC,CACpC,EAEA,YAAa,CACZ,CAAC,uBAAwB,CAAC,CAC3B,CACD,EAGaC,EAAkB,CAK9B,UAAW,CACV,MAAO,+BACP,MAAO,yBACP,QAAS,EACV,EACA,eAAgB,CACf,MAAO,yCACP,MAAO,wBACR,EASA,WAAY,CACX,MAAO,aACP,MAAO,+CACR,CACD,EAGaC,EAAkB,CAC9B,WAAY,kCACZ,QAAS,8CACT,SAAU,YACV,YAAa,yBACd,EAEaC,EAAe,CAG3B,6BAOD,EAIaC,EAAS,UAAU,SAAW,UAAU,SAAS,QAAQ,KAAK,IAAM,GAAK,OAAO,KAAK,UAAU,SAAS,EAGxGC,EAAS,UAAU,SAAW,UAAU,SAAS,QAAQ,KAAK,IAAM,GAAK,UAAU,KAAK,UAAU,SAAS,EAG3GC,EAAY,UAAU,UAAU,QAAQ,cAAc,IAAM,IAAM,UAAU,UAAU,QAAQ,OAAO,IAAM,GAG3GC,EAAc,UAAU,UAAU,QAAQ,UAAU,IAAM,GAO1DC,EAAaF,EAAY,WAAa,GAGtCG,EAAqB,CAAC,EAAG,GAAI,EAAE,EAG/BC,EAAqB,CAAC,SAAS,EAG/BC,EAAoB,CAAC,IAAK,IAAK,MAAO,KAAK,EAGjD,IAAKC,GAAAA,IAEXA,EAAAA,EAAA,qBAEAA,EAAAA,EAAA,iBAEAA,EAAAA,EAAA,iBAEAA,EAAAA,EAAA,6BAEAA,EAAAA,EAAA,iCAEAA,EAAAA,EAAA,6BAEAA,EAAAA,EAAA,+BAEAA,EAAAA,EAAA,uBAEAA,EAAAA,EAAA,mBAEAA,EAAAA,EAAA,yBAEAA,EAAAA,EAAA,wBAtBWA,IAAAA,GAAA,IA0BL,MAAMC,EAAwB,CACpC,QAAW,CACV,MAAO,qEACP,SAAU,qBAEV,WAAY,2BACZ,MAAO;AAAA;AAAA,yDAIP,YAAa,2BACb,OAAQ,6CACT,CAED,C,mBnI9YA,M,uGoIWA,IAAIC,EAAS,IAEN,SAASC,GAAiB,CAChC,OAAOD,GACR,CAFgB,EAAAC,EAAA,kBA4BT,MAAM,GAAN,gBAAqB,cAA2B,CAiBtD,YAAYvpE,EAAoChB,EAAkC,CAAC,EAAG,CACrF,MAAM,EAEN,KAAK,UAAY,CAChB,UAAW,EAAO,UAClB,UAAW,EAAO,UAClB,OAAQ,EAAO,QAChB,EAEKA,EAAQ,YACZ,KAAK,UAAY,OAAO,OAAO,KAAK,UAAWA,EAAQ,SAAS,GAEjE,KAAK,WAAaA,EAAQ,WAAa,GACvC,KAAK,WAAaA,EAAQ,WAAa,GAEvC,KAAK,QAAUA,EAAQ,SAAW,GAElC,KAAK,SAAW,KAChB,KAAK,SAAW,GAEX,OAAOgB,GAAY,WACvB,KAAK,QAAUA,EAEf,KAAK,QAAUA,CACjB,CAMA,IAAI,WAAY,CACf,OAAO,KAAK,YAAc,KAAK,UAChC,CAEA,IAAI,UAAUd,EAAK,CAClBA,EAAM,EAAQA,EACTA,IAAQ,KAAK,aAGb,KAAK,SACT,KAAK,WAAW,EAEhB,KAAK,WAAaA,EACpB,CAEA,IAAI,SAAU,CACb,OAAO,KAAK,QACb,CAEA,IAAI,QAAQA,EAAK,CAChBA,EAAM,EAAQA,EACTA,IAAQ,KAAK,UAGlB,KAAK,cAAc,CACpB,CAEA,IAAI,WAAY,CACf,OAAO,KAAK,UACb,CAEA,IAAI,UAAUA,EAAK,CAClB,GAAK,KAAK,SACT,MAAM,IAAI,MAAM,uDAAuD,EAExE,KAAK,WAAaA,CACnB,CAEA,IAAI,SAAU,CACb,OAAO,KAAK,QACb,CAEA,IAAI,QAAQA,EAAK,CAChB,GAAK,KAAK,SACT,MAAM,IAAI,MAAM,mDAAmD,EAEpE,GAAK,EAAEA,aAAe,MACrB,MAAM,IAAI,MAAM,qCAAqC,EAEtD,KAAK,SAAWA,CACjB,CAEA,MAAO,CACN,KAAK,QAAU,EAChB,CAEA,MAAO,CACN,KAAK,QAAU,EAChB,CAEA,UAAW,CACV,KAAK,UAAY,EAClB,CAEA,SAAU,CACT,KAAK,UAAY,EAClB,CAOA,cAAe,CACd,OAAO,SAAS,cACf,KAAK,WAAa,KAAK,UAAU,UAChC,KAAK,WAAa,KAAK,UAAU,UAChC,KAAK,UAAU,MAClB,CACD,CAEA,cAAcmgB,EAAoB,CACjC,GAAKA,GAASA,EAAM,SAAW,EAC9B,OAED,MAAMmqD,EAAY,KAAK,UACtBC,EAAU,KAAK,SAAW,CAAE,KAAK,SACjCt/C,EAAY,KAAK,aAAa,EAK/B,GAHKq/C,GAAar/C,GACjBA,EAAU,UAAU,OAAO,iBAAkBs/C,CAAO,EAEhD,CAAEA,EAAU,CACX,KAAK,UACT,KAAK,SAAS,OAAO,EAEtB,KAAK,KAAK,MAAM,EAEX,KAAK,UACT,KAAK,SAAW,MAEjB,MACD,CAEA,GAAOt/C,EAGP,IAAK,KAAK,QAAU,CACnB,MAAMub,EAAK,KAAK,QAAQ,EACxB,GAAKA,aAAc,QAAU,CAC5BA,EAAG,KAAKnpB,GAAK,CACZ,KAAK,SAAWA,EACX,KAAK,QACT4N,EAAU,aAAa5N,EAAG4N,EAAU,UAAU,EAE9CA,EAAU,YAAY5N,CAAC,EACxB,KAAK,KAAK,MAAM,CACjB,CAAC,EAAE,MAAMwD,GAAO,CACf,KAAK,KAAK,QAASA,CAAG,CACvB,CAAC,EAED,MAED,MACC,KAAK,SAAW2lB,CAClB,CAEO,KAAK,WAGP,KAAK,QACTvb,EAAU,aAAa,KAAK,SAAUA,EAAU,UAAU,EAE1DA,EAAU,YAAY,KAAK,QAAQ,EAEpC,KAAK,KAAK,MAAM,GACjB,CAEA,WAAW9K,EAAoB,CAC9B,GAAK,CAAE,KAAK,UAAYA,GAASA,EAAM,SAAW,GAAK,CAAE,KAAK,SAC7D,OAED,KAAK,WAAa,CAAC,KAAK,WAExB,MAAMmqD,EAAY,KAAK,UACtBr/C,EAAY,KAAK,aAAa,EAC9Bu/C,EAAgB,KAAK,SAAS,cAE1Bv/C,IAAcu/C,IAGdF,EACCr/C,GACJA,EAAU,UAAU,IAAI,gBAAgB,EAC9Bu/C,GACXA,EAAc,UAAU,OAAO,gBAAgB,EAEhD,KAAK,SAAS,OAAO,EAChBv/C,IACC,KAAK,QACTA,EAAU,aAAa,KAAK,SAAUA,EAAU,UAAU,EAE1DA,EAAU,YAAY,KAAK,QAAQ,GAGrC,KAAK,KAAK,QAAQ,EACnB,CACD,EAtNuD,gBAAhD,GAAM,EAEL,UAAY,IAAK,iBAFZ,EAGL,UAAY,IAAK,iBAHZ,EAIL,SAAW,IAAK,gBAJjB,IAAMw/C,EAAN,EAyNP,QAAeA,C,wRC7Pf,MAAMC,EAAQ,CACb,SAAU,iBAAkB,YAAa,SAAU,QAAS,MAAO,QACnE,eAAgB,YAAa,WAAY,UAAW,SAAU,WAC9D,YAAa,UAAW,UAAW,OAAQ,QAAS,OAAQ,WAC5D,QAAS,OAAQ,UAAW,UAAW,kBAAmB,cAC1D,WAAY,SAAU,cAAe,OAAQ,SAAU,WACvD,UAAW,QAAS,MAAO,UAAW,WAAY,YAClD,WAAY,UAAW,MAAO,OAAQ,aAAc,UAAW,SAC/D,SAAU,OAAQ,OAAQ,WAAY,aAAc,OAAQ,KAC5D,YAAa,QAAS,WAAY,UAAW,OAAQ,QAAS,OAC9D,WAAY,OAAQ,OAAQ,MAAO,WAAY,MAAO,YACtD,YAAa,QAAS,SAAU,MAAO,WAAY,OACnD,aAAc,OAAQ,UAAW,UAAW,OAAQ,cAAe,SACnE,UAAW,aAAc,WAAY,MAAO,WAAY,WAAY,OACpE,UAAW,UAAW,QAAS,SAAU,WAAY,WAAY,QACjE,OAAQ,QAAS,OAAQ,OAAQ,aAAc,MAAO,SAAU,UAChE,SAAU,QAAS,OAAQ,QAAS,UAAW,WAAY,SAC3D,QAAS,OAAQ,SAAU,QAAS,QAAS,MAC9C,EAEMC,EAAW,CAChB,MAAO,UAAW,gBAAiB,mBAAoB,SAAU,WACjE,SAAU,OAAQ,OAAQ,UAAW,UAAW,gBAAiB,sBACjE,cAAe,mBAAoB,oBAAqB,oBAAqB,iBAC7E,eAAgB,UAAW,UAAW,UAAW,UAAW,UAAW,iBACvE,UAAW,UAAW,cAAe,eAAgB,WAAY,eACjE,qBAAsB,cAAe,SAAU,eAAgB,SAAU,mBACzE,iBAAkB,gBAAiB,gBAAiB,YAAa,OAAQ,gBACzE,IAAK,QAAS,WAAY,QAAS,QAAS,OAAQ,iBAAkB,SAAU,OAChF,WAAY,gBAAiB,QAAS,OAAQ,UAAW,UAAW,WAAY,iBAChF,OAAQ,MAAO,OAAQ,SAAU,SAAU,OAAQ,WAAY,OAC/D,QAAS,MAAO,OAAQ,OACzB,EA2BMC,EAAgB,CACrB,WAAY,WAAY,MACzB,EAGMj9B,EAAQ,SAAS,YAAY,EAEnC,SAASk9B,EAAUtpE,EAAc,CAChC,OAAOA,EAAK,QAAQ,UAAWmF,GAAKA,EAAE,CAAC,EAAE,YAAY,CAAC,CACvD,CAFS,EAAAmkE,EAAA,aAQF,SAASC,EAAG/wD,EAAkBnY,EAAcqgE,EAAqDniE,EAA6C,CACpJ,OAAOia,EAAI,iBAAiBnY,EAAMqgE,EAAUniE,CAAO,CACpD,CAFgB,EAAAgrE,EAAA,MAQT,SAASC,EAAIhxD,EAAkBnY,EAAcqgE,EAAqDniE,EAA0C,CAClJ,OAAOia,EAAI,oBAAoBnY,EAAMqgE,EAAUniE,CAAO,CACvD,CAFgB,EAAAirE,EAAA,OAyBT,SAASC,EACftmB,EACAsiB,EACAC,EAAgB,GAChB9hE,EAAkB,EAClBjB,EACe,CACf,GAAK,CAAEA,EACNA,EAAU,IAAI,YACLA,EAAQ,IAAIwgD,CAAI,EACzB,OAAO,KAER,GAAKsiB,EAAStiB,CAAI,EACjB,OAAOA,EAER,GAAKv/C,GAAW8hE,EACf,OAAO,KAIR,GAFA/iE,EAAQ,IAAIwgD,CAAI,EAEXA,GAAM,OAAO,SACjB,GAAK,MAAM,QAAQA,EAAK,MAAM,QAAQ,GACrC,UAAUj9C,KAASi9C,EAAK,MAAM,SAC7B,GAAOj9C,EAGP,GAAK,MAAM,QAAQA,CAAK,EACvB,UAAU8W,KAAK9W,EAAO,CACrB,MAAM/G,EAAMsqE,EAAkBzsD,EAAGyoD,EAAUC,EAAO9hE,EAAU,EAAGjB,CAAO,EACtE,GAAKxD,EACJ,OAAOA,CACT,KACM,CACN,MAAMA,EAAMsqE,EAAkBvjE,EAAgBu/D,EAAUC,EAAO9hE,EAAU,EAAGjB,CAAO,EACnF,GAAKxD,EACJ,OAAOA,CACT,MAEK,CACN,MAAMA,EAAMsqE,EAAkBtmB,EAAK,MAAM,SAAmBsiB,EAAUC,EAAO9hE,EAAU,EAAGjB,CAAO,EACjG,GAAKxD,EACJ,OAAOA,CACT,CAGD,OAAO,IACR,CA9CgB,EAAAsqE,EAAA,qBAwFT,SAASzmD,EAAc9iB,EAAamlB,KAAgB+uB,EAAsC,CAEhG,MAAMnP,EADQmkC,EAAS,SAASlpE,CAAG,EAGhC,SAAS,gBAAgB,6BAA8BA,CAAG,EAC1D,SAAS,cAAcA,CAAG,EAO7B,GALKk0C,EAAS,SAAW,EACxBA,EAAW,KACFA,EAAS,SAAW,IAC7BA,EAAWA,EAAS,CAAC,GAEjB,OAAO/uB,GAAU,SACrB4f,EAAG,aAAa,QAAS5f,CAAK,UACrBA,GACT,UAAU7mB,KAAO6mB,EAChB,MAAK,OAAIA,EAAO7mB,CAAG,EAAI,CACtB,MAAM2oC,EAAK3oC,EAAI,YAAY,EAC1BkrE,EAAOrkD,EAAM7mB,CAAG,EAEjB,GAAKA,IAAQ,YACZymC,EAAG,aAAa,QAASykC,CAAI,UAElBviC,IAAO,QAClB,GAAK,OAAOuiC,GAAS,SACpBzkC,EAAG,MAAM,QAAUykC,UACVA,GAAQ,OAAOA,GAAS,SACjC,SAAU,CAAClrE,EAAKC,CAAG,IAAK,OAAO,QAAQirE,CAAI,KACrC,OAAIzkC,EAAG,MAAOzmC,CAAG,MAAK,OAAI,OAAO,eAAeymC,EAAG,KAAK,EAAGzmC,CAAG,EACjEymC,EAAG,MAAczmC,CAAG,EAAIC,EAEzBwmC,EAAG,MAAM,YAAYzmC,EAAKkrE,EAAKlrE,CAAG,CAAC,OAE5B,SAASkrE,GAAQ,MAC1B,QAAQ,KAAK,0BAA2BA,CAAI,UAElCviC,IAAO,UAClB,GAAKuiC,GAAQ,OAAOA,GAAS,SAC5B,UAAUz5B,KAAKy5B,KACT,OAAIA,EAAMz5B,CAAC,IACfhL,EAAG,QAAQqkC,EAAUr5B,CAAC,CAAC,EAAIy5B,EAAKz5B,CAAC,QACxB,SAASy5B,GAAQ,MAC5B,QAAQ,KAAK,4BAA6BA,CAAI,OAEpClrE,IAAQ,0BAEdkrE,GAAQA,EAAK,SACjBzkC,EAAG,UAAYykC,EAAK,QAEVviC,EAAG,WAAW,IAAI,EAC7BlC,EAAG,iBAAiBkC,EAAG,MAAM,CAAC,EAAGuiC,CAAI,EAE5BviC,EAAG,WAAW,OAAO,EAC9BlC,EAAG,QAAQqkC,EAAUniC,EAAG,MAAM,CAAC,CAAC,CAAC,EAAIuiC,EAE5BL,EAAc,SAASliC,CAAE,EAC7BuiC,GAAQA,IAAS,SACrBzkC,EAAG,aAAazmC,EAAKkrE,CAAI,EAEfviC,EAAG,WAAW,OAAO,GAAKgiC,EAAM,SAAShiC,CAAE,GAAKiiC,EAAS,SAASlpE,CAAG,EAChF+kC,EAAG,aAAazmC,EAAKkrE,CAAI,EAGxBzkC,EAAWzmC,CAAG,EAAIkrE,CACrB,EAEF,OAAKt1B,GACJu1B,EAAY1kC,EAAImP,CAAQ,EAElBnP,CACR,CAtEgB,EAAAjiB,EAAA,iBAoFT,SAAS2mD,EACfpqE,EACA60C,EACAw1B,EAAuB,GACvBC,EAAoB,GACnB,CAID,GAHID,GACH,OAAO,aAAa,IAAI,EAAE,IAAI,KAAK,iFAAiF,EAEjHx1B,aAAoB,KACjBy1B,IACLtqE,EAAQ,UAAY,IAErBA,EAAQ,YAAY60C,CAAQ,UAEjB,MAAM,QAAQA,CAAQ,EAAI,CAC/By1B,IACLtqE,EAAQ,UAAY,IAErB,UAAU2G,KAASkuC,EAClB,GAAIluC,aAAiB,KACpB3G,EAAQ,YAAY2G,CAAK,UACjB,MAAM,QAAQA,CAAK,EAC3ByjE,EAAYpqE,EAAS2G,EAAO0jE,EAAa,EAAI,UACrC1jE,EAAO,CACf,MAAMzH,EAAM,OAAOyH,GAAU,SAAWA,EAAQ,OAAOA,CAAK,EAM5D3G,EAAQ,YAAY,SAAS,eAAed,CAAG,CAAC,CACjD,CAEF,SAAW21C,EAAU,CACpB,MAAM31C,EAAM,OAAO21C,GAAa,SAAWA,EAAW,OAAOA,CAAQ,EAKrE70C,EAAQ,YAAY,SAAS,eAAed,CAAG,CAAC,CACjD,CACD,CA1CgB,EAAAkrE,EAAA,eAoDT,SAASG,EAAgBvqE,EAAsB6oB,EAAa1nB,EAAmB,CACrF,KAAMnB,GAAS,CACd,GAAKA,EAAQ,SAAS6oB,CAAK,EAC1B,MAAO,GAER7oB,EAAUA,EAAQ,cACbmB,IACJnB,EAAUA,aAAmB,QAC1BA,EAAQ,QAAQmB,CAAQ,EACxB,KACL,CAEA,MAAO,EACR,CAbgB,EAAAopE,EAAA,mBA0BT,SAASC,EAASC,EAAqBC,EAAmB,CAChE,OAAO,IAAI,QAA8BxmE,GAAW,CACnD,MAAM6sB,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,KAAO,OACbA,EAAM,OAAS05C,EACf15C,EAAM,SAAW25C,EAEjB,IAAIC,EAAW,GAgBf55C,EAAM,SAAW,IAAM,CAEtB,GAAK,CAAE45C,EAAW,CACjBA,EAAW,GACX,MAAMC,EAAQ,MAAM,KAAK75C,EAAM,OAAS,CAAC,CAAC,EAC1C7sB,EAAQwmE,EAAWE,EAAQA,EAAM,CAAC,CAAC,CACpC,CACD,EAEA75C,EAAM,MAAM,CACb,CAAC,CACF,CAlCgB,EAAAy5C,EAAA,YA0CT,SAASK,EAAS3qD,EAAY4qD,EAAW,QAAS,CACxD,OAAO,IAAI,QAAQ,CAAC5mE,EAASi2B,IAAW,CACvC,MAAM4wC,EAAS,IAAI,WACnBA,EAAO,WAAW7qD,EAAM4qD,CAAQ,EAChCC,EAAO,OAAS,IAAM7mE,EAAQ6mE,EAAO,MAAM,EAC3CA,EAAO,QAAUxuD,GAAK4d,EAAO5d,CAAC,CAC/B,CAAC,CACF,CAPgB,EAAAsuD,EAAA,YAUhB,MAAMnlC,EAAK,SAAS,cAAc,MAAM,EAYjC,SAASslC,EAAS3sD,EAAc,CACtCqnB,EAAG,YAAcrnB,EACjB,MAAMze,EAAM8lC,EAAG,UAEf,OAAAA,EAAG,YAAc,GACV9lC,CACR,CANgB,EAAAorE,EAAA,YAShB,IAAIz2B,EAAU,EAEP,MAAM,EAAN,MAAM,CAAa,CAMzB,YAAY1zC,EAAa,CACxB,KAAK,GAAKA,GAAM0zC,IAEhB,KAAK,QAAU,CAAC,EAEhB,KAAK,OAAS9wB,EAAc,QAAS,CACpC,KAAM,WACN,GAAI,uBAAuB,KAAK,EAAE,EACnC,CAAC,EAED,SAAS,KAAK,YAAY,KAAK,MAAM,CACtC,CAEA,SAAU,CACJ,KAAK,QACT,KAAK,OAAO,OAAO,EAIpB,KAAK,QAAU,KACf,KAAK,OAAS,IACf,CAEA,OAAQ,CACP,KAAK,QAAU,CAAC,EAChB,KAAK,OAAO,UAAY,EACzB,CAEA,IAAIxkB,EAAa,CAChB,MAAMgsE,EAAQ,KAAK,QAAQhsE,CAAG,EAC9B,GAAKgsE,EACJ,OAAOA,EAAM,WAEf,CAEA,IAAIhsE,EAAa,CAChB,MAAO,CAAC,CAAE,KAAK,QAAQA,CAAG,CAC3B,CAEA,IAAIA,EAAa4L,EAAeqqB,EAAiB,GAAO,CACvD,MAAM+1C,EAAQ,KAAK,QAAQhsE,CAAG,EAC9B,GAAKgsE,EAAQ,CACZ,GAAK,CAAE/1C,GAAS+1C,EAAM,cAAgBpgE,EACrC,OAEDogE,EAAM,YAAcpgE,CACrB,MACC,KAAK,OAAO,YAAY,KAAK,QAAQ5L,CAAG,EAAI,SAAS,eAAe4L,CAAK,CAAC,CAC5E,CAEA,OAAO5L,EAAa,CACnB,MAAMgsE,EAAQ,KAAK,QAAQhsE,CAAG,EACzBgsE,IACC,KAAK,OAAO,SAASA,CAAK,GAC9B,KAAK,OAAO,YAAYA,CAAK,EAE9B,KAAK,QAAQhsE,CAAG,EAAI,KAEtB,CACD,EAjE0B,oBAAnB,IAAMisE,EAAN,EAoEA,MAAM,EAAN,MAAM,CAAa,CAMzB,YAAYlrE,EAAsB2oB,EAAyC,CAC1E,KAAK,GAAK3oB,EACV,KAAK,GAAK2oB,EAEV,KAAK,IAAM,KAAK,YAAY,KAAK,IAAI,EACrC,SAAS,gBAAgB,iBAAiB,QAAS,KAAK,GAAG,CAC5D,CAEA,SAAU,CACJ,KAAK,KACT,SAAS,gBAAgB,oBAAoB,QAAS,KAAK,GAAG,EAE/D,KAAK,GAAK,KAAK,GAAK,KAAK,IAAM,IAChC,CAEA,YAAYtJ,EAAmB,CACzB,KAAK,IAAM,KAAK,IAAM,CAAE,KAAK,GAAG,SAASA,EAAM,MAAc,GACjE,KAAK,GAAGA,CAAK,CACf,CAED,EA1B0B,oBAAnB,IAAM8rD,EAAN,EA2CA,SAASC,EAAcC,EAAaC,EAAS,GAAOnF,EAAQ,EAAGH,EAAY,GAAY,CAC7F,IAAIuF,EAAS,GAAIC,EAAe,GAMhC,GALKF,IACJC,EAAS,OAAO,OAAOpF,EAAQ,CAAC,EAChCqF,EAAe,OAAO,OAAOrF,CAAK,GAG9BA,EAAQH,EACZ,MAAO,0DAER,GAAIqF,GAAU,KACb,MAAO,wCAAwClF,CAAK,gBAErD,GAAK,OAAOkF,GAAW,UAAY,OAAOA,GAAW,UACpD,MAAO,wCAAwClF,CAAK,KAAKkF,CAAM,UAEhE,GAAK,OAAOA,GAAW,SACtB,MAAO,qCAAqClF,CAAK,KAAK6E,EAAS,KAAK,UAAUK,CAAM,CAAC,CAAC,UAEvF,GAAK,MAAM,QAAQA,CAAM,EACxB,MAAO,yCAAyClF,CAAK,cACjDkF,EAAO,OAAS,EAClBA,EAAO,IAAInkE,IAAMokE,EAAS;AAAA,EAAKE,CAAY,GAAK,IAAMJ,EAAclkE,EAAGokE,EAAQnF,EAAQ,EAAGH,CAAS,CAAC,EAAE,KAAK,wCAAwCG,CAAK,aAAa,GAClKmF,EAAS;AAAA,EAAKC,CAAM,GAAK,IACzB,IACF,0CAA0CpF,CAAK,aAEnD,MAAMvmE,EAAM,CAAC,EAEb,SAAU,CAACX,EAAKC,CAAG,IAAK,OAAO,QAAQmsE,CAAM,EACvCzrE,EAAI,OAAS,GACjBA,EAAI,KAAK,wCAAwCumE,CAAK,aAAa,EAE/DmF,GACJ1rE,EAAI,KAAK;AAAA,EAAK4rE,CAAY,EAAE,EAC7B5rE,EAAI,KAAK,wCAAwCumE,CAAK,KAAK6E,EAAS,KAAK,UAAU/rE,CAAG,CAAC,CAAC,mDAAmDknE,CAAK,aAAa,EAC7JvmE,EAAI,KAAKwrE,EAAclsE,EAAKosE,EAAQnF,EAAQ,EAAGH,CAAS,CAAC,EAG1D,MAAO,yCAAyCG,CAAK,aAAavmE,EAAI,KAAK,EAAE,CAAC,GAAGA,EAAI,QAAU0rE,EAAS;AAAA,EAAKC,CAAM,GAAK,EAAE,0CAA0CpF,CAAK,YAC1K,CAxCgB,EAAAiF,EAAA,gB,mBrIpiBhB,M,sKsISO,MAAMK,EAAS,OAAO,QAAQ,EAOxBC,EAAkB,OAAO,iBAAiB,EASjDC,EAAa,kBAClBC,EAAc,WACdC,EAAa,WAEd,OAAO,UAAU,OAAS,SAAuBC,EAAoB,IAAK,CACzE,IAAIzoE,EAAS,KACb,OAAIA,EAAO,YACVA,EAASA,EAAO,UAAU,KAAK,GAEzBA,EACL,QAAQ,mBAAoB,EAAE,EAC9B,KAAK,EACL,YAAY,EACZ,QAAQ,cAAe,EAAE,EACzB,QAAQ,OAAQyoE,CAAS,CAC5B,EAEA,OAAO,UAAU,YAAc,UAAuB,CACrD,IAAIzoE,EAAS,KACb,OAAIA,EAAO,YACVA,EAASA,EAAO,UAAU,KAAK,GAEzBA,EACL,QAAQ,mBAAoB,EAAE,EAC9B,KAAK,EACL,QAAQsoE,EAAY,OAAO,EAC3B,QAAQC,EAAa,GAAG,EACxB,QAAQC,EAAY,EAAE,EACtB,YAAY,CACf,EAkEO,MAAM,GAAN,OAGL,CAUD,aAAc,CACb,KAAK,YAAc,CAAC,EACpB,KAAK,UAAY,IAAI,IACrB,KAAK,cAAgB,CACtB,CAEU,kBAAmB,CAC5B,GAAK,CAAE,KAAK,cACX,MAAO,CAAC,EAET,MAAME,EAAgD,CAAC,EACtDC,EAAgB,KAAK,YACrBhqD,EAAoB,CAAC,EAEtB,SAAU,CAAC/iB,EAAKC,CAAG,IAAK,OAAO,QAAQ8sE,CAAa,EAC9C9sE,GAAK,OACT6sE,EAAc9sE,CAAG,EAAIC,EAErB8iB,EAAQ,KAAK/iB,CAAG,EAGlB,YAAK,YAAc8sE,EACnB,KAAK,cAAgB,EACd/pD,CACR,CAEQ,gBAAgB3C,EAAe,CAItC,GAAK,KAAK,UAAU,IAAIA,CAAK,EAC5B,OAED,MAAM9d,EAAO,KAAK,YAAY8d,CAAK,EAC9B9d,GACJA,EAAK,KAAK,CAACsO,EAAGC,IAAMD,EAAE,CAAC,EAAIC,EAAE,CAAC,CAAC,CACjC,CAUA,kBAAkB+Y,EAA4C,CAC7D,GAAK,EAAEA,aAAiB,GACvB,MAAM,IAAI,MAAM,iCAAiC,EAKlD,GAAK,EADeA,EAAM,OAAO,EAAE,OAASA,EAAM,UAAU,MACvC,CACpBA,EAAM,YAAc,KAAK,YACzBA,EAAM,cAAgB,KAAK,cAC3B,KAAK,YAAc,CAAC,EACpB,KAAK,cAAgB,EACrB,MACD,CAIA,SAAU,CAAC5pB,EAAKC,CAAG,IAAK,OAAO,QAAQ,KAAK,WAAW,EAAG,CACzD,GAAK,CAAEA,GAAO,CAAEA,EAAI,OACnB,SAED,IAAI+sE,EAAYpjD,EAAM,YAAY5pB,CAAG,EAChC,MAAM,QAAQgtE,CAAS,GAC3BA,EAAU,KAAK,GAAG/sE,CAAG,EACrB2pB,EAAM,gBAAgB5pB,CAAG,GAGzB4pB,EAAM,YAAY5pB,CAAG,EAAIC,CAC3B,CAGA,KAAK,YAAc,CAAC,EACpB,KAAK,cAAgB,CACtB,CAWA,UAAkD2T,EAAmC,CACpF,OAAOq5D,EAAS,UAAUr5D,CAAI,CAC/B,CAMA,kBAA0EA,EAAoD,CAC7H,OAAOs5D,EAAiB,UAAUt5D,CAAI,CACvC,CAYA,GACCwM,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,GAAK,OAAOnjE,GAAO,WAClB,MAAM,IAAI,UAAU,uBAAuB,EAE5C,MAAMipB,EAAqB,CAC1BjpB,EACAua,EACA,GACAuY,GAAY,EACZqwC,CACD,EAEM5lE,EAAO,KAAK,YAAY8d,CAAK,EACnC,OAAK9d,GACC4lE,EACJ5lE,EAAK,QAAQ0rB,CAAI,EAEjB1rB,EAAK,KAAK0rB,CAAI,EACf,KAAK,gBAAgB5N,CAAK,GAE1B,KAAK,YAAYA,CAAK,EAAI,CAAC4N,CAAI,EAEzB,IACR,CAeA,KACC5N,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,KAAK,KAAK9nD,EAAO,EAAGrb,EAAIua,EAAKuY,EAAUqwC,CAAO,CACtD,CAcA,KACC9nD,EACA+nD,EACApjE,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,GAAK,OAAOnjE,GAAO,WAClB,MAAM,IAAI,UAAU,uBAAuB,EAE5C,GAAK,OAAOojE,GAAQ,UAAY,MAAMA,CAAG,GAAK,CAAE,SAASA,CAAG,GAAKA,EAAM,EACtE,MAAM,IAAI,UAAU,uCAAuC,EAE5D,MAAMn6C,EAAqB,CAC1BjpB,EACAua,EACA6oD,EACAtwC,GAAY,EACZqwC,CACD,EAEM5lE,EAAO,KAAK,YAAY8d,CAAK,EACnC,OAAK9d,GACC4lE,EACJ5lE,EAAK,QAAQ0rB,CAAI,EAEjB1rB,EAAK,KAAK0rB,CAAI,EACf,KAAK,gBAAgB5N,CAAK,GAE1B,KAAK,YAAYA,CAAK,EAAI,CAAC4N,CAAI,EAEzB,IACR,CAoBA,QACC5N,EACAd,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,IAAI,QAAuDjjE,GAAW,CAC5E,MAAM+oB,EAAqB,CACzB,IAAIvoB,IAAwDR,EAAQQ,CAAI,EACzE6Z,EACA,EACAuY,GAAY,EACZqwC,CACD,EAEM5lE,EAAO,KAAK,YAAY8d,CAAK,EAC9B9d,GACC4lE,EACJ5lE,EAAK,QAAQ0rB,CAAI,EAEjB1rB,EAAK,KAAK0rB,CAAI,EACf,KAAK,gBAAgB5N,CAAK,GAE1B,KAAK,YAAYA,CAAK,EAAI,CAAC4N,CAAI,CACjC,CAAC,CACF,CAgBA,IACC5N,EACArb,EACAua,EACC,CACD,GAAKc,GAAS,KAAO,CACpB,GAAK,CAAErb,GAAM,CAAEua,EACd,MAAM,IAAI,MAAM,kEAAkE,EAEnF,UAAUgV,KAAO,OAAO,KAAK,KAAK,WAAW,EACrC,KAAK,UAAU,IAAIA,CAAG,GAC5B,KAAK,IAAIA,EAAYvvB,EAAIua,CAAG,EAG9B,OAAO,IACR,CAEA,GAAK,KAAK,UAAU,IAAIc,CAAK,EAC5B,MAAM,IAAI,MAAM,+EAA+E,EAEhG,IAAI9d,EAAO,KAAK,YAAY8d,CAAK,EACjC,OAAO9d,GAIF,CAAEyC,GAAM,CAAEua,EACdhd,EAAO,MAMPA,EAAOA,EAAK,OAAO,CAAC,CAACkc,EAAGpB,CAAC,IAAM,GAAG,CAAErY,GAAMyZ,IAAMzZ,KAAQ,CAACua,GAAOA,IAAQlC,GAAG,EACpE9a,EAAK,SACXA,EAAO,OAGT,KAAK,YAAY8d,CAAK,EAAI9d,EAKnBA,GACN,KAAK,gBAEC,MAvBC,IAwBT,CAQA,WAAgE8d,EAAUd,EAAW,CACpF,OAAO,KAAK,IAAIc,EAAO,OAAWd,CAAG,CACtC,CAKA,QAAS,CACR,YAAK,iBAAiB,EACf,OAAO,KAAK,KAAK,WAAW,CACpC,CAQA,UACCc,EAC6D,CAC7D,MAAM9d,EAAO,KAAK,YAAY8d,CAAK,EACnC,OAAO9d,EAAO,MAAM,KAAKA,CAAI,EAAW,CAAC,CAC1C,CAKA,aAAkE8d,EAAU,CAC3E,MAAO,CAAC,CAAE,KAAK,YAAYA,CAAK,CACjC,CAmBA,KACCA,KACGxM,EACF,CACD,IAAItR,EAAO,KAAK,YAAY8d,CAAK,EACjC,GAAK,CAAE9d,EACN,OAED,GAAK,KAAK,UAAU,IAAI8d,CAAK,EAC5B,MAAM,IAAI,MAAM,+DAA+D,EAIhF,MAAM2C,EAAU,IAAI,IAKpB,KAAK,YAAY3C,CAAK,EAAI,KAC1B,KAAK,UAAU,IAAIA,CAAK,EAExB,UAAU7d,KAAQD,EAAM,CACvB,KAAM,CAACyC,EAAIua,EAAK6oD,CAAG,EAAI5lE,EACvB,IAAIu3B,EACJ,GAAI,CACHA,EAAM/0B,EAAG,MAAMua,EAAK1L,CAAI,CACzB,OAAQkN,EAAK,CAGN,KAAa,MACjB,KAAa,IAAI,QAAQA,EAAK,CAAC,KAAM,CAAC,MAAAV,CAAK,EAAG,MAAM,CAAC,KAAMxM,CAAI,CAAC,CAAC,EACjE,KAAa,IAAI,MAAMkN,CAAG,EAE7B,CAkBA,GAhBKgZ,IAAQ0yC,EACZzpD,EAAQ,IAAIxgB,CAAI,EACP4lE,IAAQ,KACZA,GAAO,EACXplD,EAAQ,IAAIxgB,CAAI,EAEhBA,EAAK,CAAC,EAAI4lE,EAAM,GAKbruC,aAAe,SACblmB,EAAK,CAAC,YAAas5D,GACxBt5D,EAAK,CAAC,EAAE,QAAQkmB,CAAG,EAGflmB,EAAK,CAAC,YAAaq5D,GAAYr5D,EAAK,CAAC,EAAE,oBAAuBkmB,IAAQ2yC,EAC3E,KACF,CAGA,GAAK1pD,EAAQ,KACZ,UAAUxgB,KAAQwgB,EAAS,CAC1B,MAAMxD,EAAMjd,EAAK,QAAQC,CAAI,EACxBgd,IAAQ,IACZjd,EAAK,OAAOid,EAAK,CAAC,CACpB,CAGD,IAAI4tD,EAAY,GAIhB,MAAMC,EAAY,KAAK,YAAYhtD,CAAK,EACnCgtD,IACJ9qE,EAAOA,EAAK,OAAO8qE,CAAS,EAC5BD,EAAY,IAKR7qE,EAAK,OACT,KAAK,YAAY8d,CAAK,EAAI9d,GAE1B,KAAK,YAAY8d,CAAK,EAAI,KAC1B,KAAK,iBAGN,KAAK,UAAU,OAAOA,CAAK,EAItB+sD,GACJ,KAAK,gBAAgB/sD,CAAK,CAC5B,CAED,EA5dE,sBAHK,GAAM,EAKL,OAASosD,EALJ,EAML,gBAAkBC,EANnB,IAAMY,EAAN,EA6eA,MAAM,EAAN,MAAM,CAAgB,CAO5B,OAAO,UAAkDz5D,EAAmC,CAC3F,OAAO,IAAI,EAASA,CAAI,CACzB,CAQA,YAAYA,EAAa,CACxB,KAAK,iBAAmB,GACxB,KAAK,mBAAqB,GAE1B,OAAO,OAAO,KAAMA,CAAI,CACzB,CAYA,QAAS,CACR,KAAK,iBAAmB,GACxB,KAAK,mBAAqB,EAC3B,CAMA,iBAAkB,CACjB,KAAK,mBAAqB,EAC3B,CAKA,gBAAiB,CAChB,KAAK,iBAAmB,EACzB,CACD,EArD6B,gBAAtB,IAAMq5D,EAAN,EAqFA,MAAM,EAAN,MAAM,UAAgDA,CAAgB,CAAtE,kCAYN,KAAQ,iBAA8C,KALtD,OAAO,UAAkEr5D,EAAoD,CAC5H,OAAO,IAAI,EAAiCA,CAAI,CACjD,CAaA,OAA4C,CAE3C,GAAK,KAAK,SACT,OAAO,KAAK,SAIb,GAAK,CAAE,KAAK,WAAa,CACxB,MAAMjT,EAAM,KAAK,iBACjB,YAAK,iBAAmB,KAGjBA,EAAM,QAAQ,QAAQA,CAAG,EAAI,IACrC,CAGA,MAAM0gB,EAAW,KAAK,WACtB,YAAK,WAAa,KAEX,KAAK,SAAW,QAAQ,IAAIA,CAAQ,EAAE,KAAK2kC,IAE5C,KAAK,iBACT,KAAK,iBAAiB,KAAK,GAAGA,CAAO,EAErC,KAAK,iBAAmBA,EAGzB,KAAK,SAAW,KACT,KAAK,MAAM,GAAK,CAAC,EAExB,EAAE,MAAMllC,GAAO,CAEf,WAAK,SAAW,KACVA,CACP,CAAC,CACF,CAOA,QAAS,CACR,MAAM,OAAO,EACb,KAAK,SAAW,KAChB,KAAK,iBAAmB,KACxB,KAAK,WAAa,IACnB,CAYA,QAAQgW,EAA2B,CAC3B,KAAK,WAGX,KAAK,WAAW,KAAKA,CAAO,EAF5B,KAAK,WAAa,CAACA,CAAO,CAG5B,CAED,EAxF6E,wBAAtE,IAAMo2C,EAAN,EA2GA,MAAM,EAAN,MAAM,UAGHG,CAAoC,CAa7C,YAAY7rE,EAAejB,EAA6C,CACvE,MAAM,EAEN,KAAK,KAAOiB,IAAS,KAAK,YAAY,MAAQ,IAAI,YAAY,EAC9D,KAAK,OAASjB,EAETA,GACJ,KAAK,KAAOA,EAAO,KACnB,KAAK,YAAcA,EAAO,YAC1B,KAAK,UAAYA,EAAO,UACxB,KAAK,OAASiB,GAAQjB,EAAO,OAAS,GAAGA,EAAO,MAAM,IAAIiB,CAAI,GAAKA,IAGnE,KAAK,KAAO,KACZ,KAAK,OAAS,QAGf,KAAK,aAAe,KAAK,OAAS,KAAK,OAAO,MAAM,GAAG,EAAI,CAAC,CAC7D,CAWA,IAAI,MAAmB,CACtB,OAAO,KAAK,MACb,CAOA,kBAAkBooB,EAAkD,CACnE,GAAK,EAAAA,aAAiB,GAA4BA,EAAM,OAAS,KAAK,MAGtE,MAAM,IAAI,MAAM,yEAAyE,CAC1F,CAuBA,SAASsd,EAAsB,CAC9B,GAAK,OAAOA,GAAS,UAAY,CAAEA,EAAK,OACvC,MAAM,IAAI,UAAU,iCAAiC,EAEtD,IAAIn1B,EAAI,EAAGotB,EACX,MAAMtF,EAAQ,KAAK,aAClBqtC,EAAQrtC,EAAM,OAEf,EAAG,CAEF,GADAsF,EAAM+H,EAAK,OAAOn1B,CAAC,EACdm1B,EAAK,OAAOn1B,CAAC,IAAM,IAAM,CAC7B,GAAKA,EAAIm1D,EACR,MAAM,IAAI,MAAM,oCAAoC,EACrD,QACD,CAEA,KACD,OAAU,EAAEn1D,EAAIm1B,EAAK,QAErB,MAAM9mB,EAAQ+e,IAAQ,IACtB,GAAKptB,IAAM,EACV,OAAOqO,GAAS,KAAK,OAAS,GAAG,KAAK,MAAM,GAAG8mB,CAAI,GAAKA,EAEzD,MAAMtO,EAASiB,EAAM,MAAM,EAAGqtC,GAASn1D,EAAE,EAAE,EAAE,KAAK,GAAG,EACpDu7D,EAASpmC,EAAK,MAAMn1B,CAAC,EAEtB,GAAO6mB,EAAO,OACN,GAEI00C,EAAO,QACX,GAEEltD,EACT,OAAOwY,EAAS00C,MAHhB,QAAO10C,MAHP,QAAO00C,EAQR,MAAO,GAAG10C,CAAM,IAAI00C,CAAM,EAC3B,CAEA,GACCltD,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,GAAG,KAAK,SAAS9nD,CAAK,EAAQrb,EAAIua,EAAKuY,EAAUqwC,CAAO,CACtE,CAEA,KACC9nD,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,KAAK,KAAK,SAAS9nD,CAAK,EAAQrb,EAAIua,EAAKuY,EAAUqwC,CAAO,CACxE,CAEA,KACC9nD,EACA+nD,EACApjE,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,KAAK,KAAK,SAAS9nD,CAAK,EAAQ+nD,EAAKpjE,EAAIua,EAAKuY,EAAUqwC,CAAO,CAC7E,CAEA,QACC9nD,EACAd,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,QAAW,KAAK,SAAS9nD,CAAK,EAAQd,EAAKuY,EAAUqwC,CAAO,CAC1E,CAEA,IACC9nD,EAAWrb,EAAoBua,EAC9B,CACD,OAAO,MAAM,IAAIc,GAAS,KAAK,SAASA,CAAK,EAAQrb,EAAIua,CAAG,CAC7D,CAEA,UAA+Dc,EAAU,CACxE,OAAO,MAAM,UAAU,KAAK,SAASA,CAAK,CAAM,CACjD,CAEA,aAAkEA,EAAU,CAC3E,OAAO,MAAM,aAAa,KAAK,SAASA,CAAK,CAAM,CACpD,CAEA,KACCA,KACG3a,EACF,CACD,OAAO,MAAM,KAAK,KAAK,SAAS2a,CAAK,EAAQ,GAAG3a,CAAI,CACrD,CAOA,oBAAqB,CACpB,MAAMwT,EAAO,MAAM,OAAO,EACzBiuB,EAAO,KAAK,QAAU,GACtBv6B,EAAMu6B,EAAK,OAEZ,OAAOjuB,EAAK,OAAOhR,GAAK,CACvB,MAAMC,EAAID,EAAE,OAAO0E,CAAG,EACtB,OAAO1E,EAAE,WAAWi/B,CAAI,IAAMh/B,IAAM,IAAMA,IAAM,KAAOA,IAAM,IAC9D,CAAC,CACF,CAMA,QAAS,CACR,MAAM+Q,EAAO,MAAM,OAAO,EACzBiuB,EAAO,KAAK,QAAU,GACtBv6B,EAAMu6B,EAAK,OAEZ,OAAOjuB,EAAK,OAAOhR,GAAK,CACvB,MAAMC,EAAID,EAAE,OAAO0E,CAAG,EACtB,OAAO1E,EAAE,WAAWi/B,CAAI,IAAMh/B,IAAM,IAAMA,IAAM,IACjD,CAAC,CACF,CACD,EAhN8C,gCAHvC,IAAMqlE,EAAN,EAqNP,QAAeA,C,mECl9BR,SAASC,EACf9pD,EACA+pD,EACAC,EAAoB,GACpBC,EAAc,GACdlxB,EAC6B,CAE7B,GAAK,CAAE,MAAM,QAAQ/4B,CAAK,GAAK,CAAE+pD,EAChC,OAAOC,EAAW,IAAM,GAAQ,IAAM,GAEvC,MAAME,EAAkC,CAAC,EACxCh+C,EAAQ,CAAC,EAEV,IAAI7d,EAAI,EACR,UAAU8R,KAAQH,EAAO,CACxB,GAAK,CAAEG,GAAQ,CAAEA,EAAK,KACrB,SAED,MAAMhiB,EAAO4rE,EAAa5pD,EAAK,IAAI,EACnC,GAAK,CAAEhiB,EAAO,CAGbkQ,IACA67D,EAAM,KAAK,IAAM,EAAK,EACtBh+C,EAAM,KAAK,IAAI7d,CAAC,EAAE,EAClB,QACD,CAKA,MAAM6lB,EAAO/1B,EAAK,WAAWgiB,EAAK,KAAM4pD,EAAchxB,CAAO,EACtD7kB,IAGP7lB,IACA67D,EAAM,KAAKh2C,CAAI,EACfhI,EAAM,KAAK,IAAI7d,CAAC,EAAE,EACnB,CAEA,OAAO67D,EAAM,OAGRA,EAAM,SAAW,EACdF,EAAYpuD,GAAkB,CAAEsuD,EAAM,CAAC,EAAEtuD,CAAG,EAAIsuD,EAAM,CAAC,EAExD,IAAI,SAAS,GAAGh+C,EAAO,MAC7B,UAAU89C,EAAW,KAAO,EAAE,GAAG99C,EAAM,IAAIpuB,GAAQ,GAAGA,CAAI,OAAO,EAAE,KAAKmsE,EAAK,OAAS,MAAM,CAAC,GAAGD,EAAW,IAAM,EAAE,GACpH,EAAE,KAAK,KAAM,GAAGE,CAAK,EAPbF,EAAW,IAAM,GAAQ,IAAM,EAQxC,CAlDgB,EAAAF,EAAA,e,oHCxChB,QAAe,IAA0B,mBCa5BK,EAAU,CACtB,IAAO,CAAC,MAAO,OAAO,EACtB,GAAM,CAAC,KAAM,QAAS,WAAW,EACjC,UAAW,CAAC,UAAW,QAAS,SAAS,EACzC,MAAS,CAAC,SAAS,QAAQ,OAAO,EAClC,IAAO,CAAC,OAAO,KAAK,EACpB,OAAU,CAAC,eAAe,QAAQ,EAClC,QAAW,CAAC,SAAS,SAAS,EAC9B,YAAa,CAAC,QAAQ,QAAQ,WAAW,EACzC,kBAAmB,CAAC,OAAO,iBAAiB,EAC5C,MAAS,CAAC,eAAe,OAAO,EAChC,uBAAwB,CAAC,UAAU,sBAAsB,EACzD,YAAa,CAAC,cAAc,WAAW,EACvC,KAAQ,CAAC,QAAQ,MAAM,EACvB,SAAY,CAAC,aAAa,UAAU,EACpC,IAAO,CAAC,OAAO,KAAK,EACpB,MAAS,CAAC,QAAQ,OAAO,EACzB,KAAQ,CAAC,QAAQ,MAAM,EACvB,SAAY,CAAC,MAAM,UAAU,EAC7B,UAAW,CAAC,OAAO,SAAS,EAC5B,WAAY,CAAC,OAAO,UAAU,EAC9B,KAAQ,CAAC,UAAU,UAAU,MAAM,EACnC,KAAQ,CAAC,WAAW,MAAM,EAC1B,YAAa,CAAC,YAAY,WAAW,EACrC,WAAY,CAAC,UAAU,UAAU,EACjC,KAAQ,CAAC,cAAc,MAAM,EAC7B,MAAS,CAAC,QAAQ,OAAO,EACzB,WAAc,CAAC,YAAY,YAAY,EACvC,KAAQ,CAAC,QAAQ,MAAM,EACvB,UAAa,CAAC,QAAQ,WAAW,EACjC,OAAU,CAAC,eAAe,QAAQ,EAClC,MAAS,CAAC,aAAa,OAAO,EAC9B,YAAa,CAAC,iBAAiB,WAAW,EAC1C,cAAe,CAAC,kBAAkB,iBAAiB,aAAa,EAChE,eAAgB,CAAC,SAAS,cAAc,EACxC,sBAAuB,CAAC,cAAc,qBAAqB,EAC3D,oBAAqB,CAAC,YAAY,mBAAmB,EACrD,uBAAwB,CAAC,eAAe,sBAAsB,EAC9D,IAAO,CAAC,OAAO,KAAK,EACpB,IAAO,CAAC,SAAS,KAAK,EACtB,IAAO,CAAC,QAAQ,KAAK,EACrB,IAAO,CAAC,MAAM,MAAM,MAAM,KAAK,EAC/B,IAAO,CAAC,QAAQ,SAAS,KAAK,EAC9B,IAAO,CAAC,MAAM,KAAK,EACnB,IAAO,CAAC,UAAU,KAAK,EACvB,SAAY,CAAC,SAAS,UAAU,EAChC,sBAAuB,CAAC,cAAc,qBAAqB,EAC3D,IAAO,CAAC,eAAe,KAAK,EAC5B,WAAc,CAAC,cAAc,OAAO,YAAY,EAChD,iBAAkB,CAAC,eAAe,gBAAgB,EAClD,IAAO,CAAC,aAAa,KAAK,EAC1B,KAAQ,CAAC,MAAM,MAAM,EACrB,eAAgB,CAAC,eAAe,iBAAiB,cAAc,EAC/D,iBAAkB,CAAC,aAAa,gBAAgB,EAChD,eAAgB,CAAC,eAAe,cAAc,EAC9C,eAAgB,CAAC,eAAe,cAAc,EAC9C,YAAa,CAAC,YAAY,YAAY,aAAa,UAAU,WAAW,EACxE,MAAS,CAAC,KAAK,aAAa,OAAO,EACnC,OAAU,CAAC,KAAK,QAAQ,EACxB,cAAe,CAAC,sBAAsB,YAAY,aAAa,EAC/D,OAAU,CAAC,SAAS,QAAQ,EAC5B,cAAe,CAAC,OAAO,aAAa,EACpC,gBAAiB,CAAC,SAAS,eAAe,EAC1C,WAAY,CAAC,gBAAgB,UAAU,EACvC,IAAO,CAAC,SAAS,SAAS,KAAK,EAC/B,YAAe,CAAC,WAAW,aAAa,EACxC,IAAO,CAAC,QAAQ,KAAK,EACrB,eAAgB,CAAC,KAAK,cAAc,EACpC,eAAgB,CAAC,YAAY,UAAU,cAAc,EACrD,yBAA0B,CAAC,YAAY,wBAAwB,EAC/D,eAAgB,CAAC,YAAY,cAAc,EAC3C,kBAAmB,CAAC,YAAY,iBAAiB,EACjD,gBAAiB,CAAC,YAAY,eAAe,EAC7C,kBAAmB,CAAC,cAAc,iBAAiB,EACnD,iBAAkB,CAAC,cAAc,gBAAgB,EACjD,gBAAiB,CAAC,cAAc,eAAe,EAC/C,cAAe,CAAC,cAAc,aAAa,EAC3C,eAAgB,CAAC,cAAc,cAAc,EAC7C,WAAc,CAAC,KAAK,YAAY,EAChC,sCAAuC,CAAC,mBAAmB,qCAAqC,EAChG,KAAQ,CAAC,WAAW,kBAAkB,MAAM,EAC5C,gBAAiB,CAAC,UAAU,eAAe,EAC3C,uBAAwB,CAAC,qBAAqB,sBAAsB,EACpE,eAAgB,CAAC,KAAK,cAAc,EACpC,eAAgB,CAAC,QAAQ,cAAc,EACvC,iBAAkB,CAAC,UAAU,gBAAgB,EAC7C,UAAW,CAAC,kBAAkB,SAAS,EACvC,YAAa,CAAC,oBAAoB,WAAW,EAC7C,mBAAoB,CAAC,gBAAgB,cAAc,kBAAkB,EACrE,6BAA8B,CAAC,gBAAgB,4BAA4B,EAC3E,mBAAoB,CAAC,gBAAgB,kBAAkB,EACvD,sBAAuB,CAAC,gBAAgB,qBAAqB,EAC7D,oBAAqB,CAAC,gBAAgB,mBAAmB,EACzD,KAAQ,CAAC,UAAU,MAAM,MAAM,EAC/B,eAAgB,CAAC,kBAAkB,cAAc,EACjD,iBAAkB,CAAC,oBAAoB,gBAAgB,CACxD,EAMaC,EAAQ,CACpB,QAAQ,QAAQ,SAAS,aAAa,QAAQ,OAAO,SAAS,OAC9D,OAAO,WAAW,KAAK,UAAU,QAAQ,QAAQ,cACjD,eAAe,YAAY,SAAS,MAAM,UAAU,OAAO,SAC3D,UAAU,OAAO,WAAW,sBAAsB,oBAClD,QAAQ,gBAAgB,SAAS,UAAU,WAAW,OAAO,OAC7D,aAAa,aAAa,cAAc,YAAY,SAAS,UAC7D,MAAM,OAAO,OAAO,WAAW,QAAQ,SAAS,OAAO,OAAO,SAC9D,cAAc,aAAa,aAAa,eAAe,cACvD,gBAAgB,OAAO,UAAU,SAAS,eAAe,YACzD,SAAS,aAAa,SAAS,OAAO,kBAAkB,iBACxD,iBAAiB,SAAS,gBAAgB,gBAAgB,WAC1D,OAAO,QAAQ,OAAO,UAAU,eAAe,eAAe,QAC9D,eAAe,gBAAgB,cAAc,eAAe,eAC5D,eAAe,kBAAkB,cAAc,aAC/C,iBAAiB,iBAAiB,MAAM,aAAa,cACrD,WAAW,aAAa,QAAQ,SAAS,WAAW,OAAO,QAC3D,WAAW,qBAAqB,OAAO,OAAO,OAAO,MAAM,YAC3D,uBAAuB,QAAQ,WAAW,SAAS,UAAU,SAC7D,aAAa,eAAe,UAAU,gBAAgB,SAAS,cAC/D,WAAW,WAAW,YAAY,iBAAiB,kBACnD,eAAe,MAAM,OAAO,WAAW,cAAc,gBACrD,YAAY,UAAU,WAAW,kBAAkB,aAAa,gBAChE,UAAU,SAAS,gBAAgB,SAAS,UAAU,QAAQ,WAC9D,aAAa,eAAe,UAAU,WAAW,SAAS,SAC1D,cAAc,MAAM,QAAQ,WAAW,OAAO,cAAc,eAC5D,cAAc,YAAY,cAAc,oBAAoB,qBAC5D,kBAAkB,oBAAoB,QAAQ,SAAS,QAAQ,SAC/D,YAAY,aAAa,QAAQ,OAAO,QAAQ,QAAQ,WAAW,UACnE,YAAY,WAAW,SAAS,OAAO,UAAU,UAAU,gBAC3D,YAAY,QAAQ,QAAQ,QAAQ,YAAY,mBAChD,qBAAqB,cAAc,QAAQ,aAAa,WACxD,aAAa,cAAc,UAAU,OAAO,YAAY,WACxD,WAAW,WAAW,OAAO,QAAQ,aAAa,YAAY,aAC9D,OAAO,UAAU,WAAW,YAAY,cAAc,WACtD,iBAAiB,eAAe,UAAU,cAAc,WAAW,SACnE,SAAS,UAAU,cAAc,aAAa,aAAa,YAC3D,SAAS,cAAc,OAAO,WAAW,cAAc,oBACvD,qBAAqB,kBAAkB,oBAAoB,aAC3D,cAAc,WAAW,aAAa,UAAU,SAAS,SAAS,SAClE,WAAW,aAAa,cAAc,UAAU,SAAS,QAAQ,aACjE,WAAW,gBAAgB,UAAU,UAAU,QAAQ,UAAU,aACjE,SAAS,iBAAiB,WAAW,OAAO,YAAY,cACxD,iBAAiB,OAAO,YAAY,eAAe,WAAW,OAC9D,cAAc,cAAc,YAAY,SAAS,eAAe,aAChE,mBAAmB,SAAS,aAAa,oBAAoB,SAC7D,SAAS,sBAAsB,uBAAuB,oBACtD,sBAAsB,QAAQ,OAAO,SAAS,aAAa,WAC3D,aAAa,aAAa,aAAa,cAAc,SAAS,eAC9D,iBAAiB,WAAW,aAAa,eAAe,gBACxD,uBAAuB,eAAe,UAAU,sBAChD,oBAAoB,uBAAuB,MAAM,MAAM,MAAM,MAAM,MAAM,MACzE,MAAM,MAAM,OAAO,YAAY,iBAAiB,kBAChD,kBAAkB,mBAAmB,mBAAmB,oBACxD,YAAY,cAAc,iBAAiB,UAAU,OAAO,cAC5D,eAAe,UAAU,iBAAiB,YAAY,SAAS,MAAM,YACrE,mBAAmB,SAAS,gBAAgB,kBAAkB,gBAC9D,kBAAkB,mBAAmB,QAAQ,UAAU,UAAU,QACjE,WAAW,QAAQ,aAAa,SAAS,SAAS,OAAO,WAAW,QACpE,SAAS,UAAU,MAAM,KAAK,QAAQ,SAAS,YAAY,iBAC3D,uBAAuB,sBAAsB,sBAAsB,eACnE,aAAa,eAAe,MAAM,gBAAgB,gBAAgB,QAClE,kBAAkB,YAAY,SAAS,aAAa,iBAAiB,QACrE,SAAS,SAAS,gBAAgB,qBAAqB,cAAc,YACrE,OAAO,gBAAgB,iBAAiB,SAAS,SAAS,WAAW,MACrE,WAAW,QAAQ,MAAM,QAAQ,OAAO,QAAQ,UAAU,iBAC1D,QAAQ,eAAe,UAAU,MAAM,OAAO,OAAO,UAAU,aAC/D,aAAa,WAAW,aAAa,cAAc,eACnD,oBAAoB,eAAe,iBAAiB,eAAe,eACnE,cAAc,OAAO,UAAU,WAAW,YAAY,iBAAiB,QACvE,SAAS,aAAa,MAAM,cAAc,gBAAgB,KAAK,SAC/D,cAAc,gBAAgB,UAAU,cAAc,SAAS,YAC/D,UAAU,YAAY,mBAAmB,OAAO,WAAW,MAAM,aACjE,OAAO,aAAa,SAAS,OAAO,cAAc,OAAO,aAAa,SACtE,gBAAgB,UAAU,gBAAgB,cAAc,UAAU,YAClE,YAAY,aAAa,eAAe,QAAQ,YAAY,KAAK,aACjE,cAAc,gBAAgB,aAAa,YAAY,aAAa,SACpE,gBAAgB,aAAa,YAAY,UAAU,MAAM,UAAU,YACnE,KAAK,MAAM,WAAW,aAAa,iBAAiB,WAAW,WAC/D,UAAU,SAAS,eAAe,cAAc,WAAW,YAC3D,kBAAkB,UAAU,OAAO,cAAc,aAAa,cAC9D,YAAY,QAAQ,OAAO,UAAU,cAAc,kBAAkB,eACrE,cAAc,aAAa,cAAc,gBAAgB,gBAAgB,SACzE,aAAa,oBAAoB,cAAc,WAAW,SAAS,YACnE,aAAa,MAAM,UAAU,QAAQ,SAAS,SAAS,eAAe,gBACtE,WAAW,eAAe,eAAe,yBAAyB,eAClE,kBAAkB,gBAAgB,gBAAgB,WAAW,eAC7D,iBAAiB,cAAc,gBAAgB,SAAS,iBAAiB,QACzE,gBAAgB,cAAc,kBAAkB,iBAAiB,gBACjE,YAAY,cAAc,eAAe,kBAAkB,gBAC3D,eAAe,iBAAiB,eAAe,YAAY,aAC3D,mBAAmB,KAAK,YAAY,cAAc,gBAClD,uBAAuB,aAAa,cAAc,SAAS,SAAS,UACpE,QAAQ,oBAAoB,aAAa,SAAS,QAAQ,SAC1D,kBAAkB,mBAAmB,mBAAmB,mBACxD,WAAW,UAAU,YAAY,QAAQ,MAAM,aAAa,eAC5D,QAAQ,QAAQ,YAAY,YAAY,eAAe,OAAO,kBAC9D,WAAW,OAAO,eAAe,MAAM,eAAe,WAAW,SACjE,eAAe,iBAAiB,cAAc,gBAAgB,eAC9D,kBAAkB,UAAU,YAAY,cAAc,UAAU,SAChE,aAAa,UAAU,SAAS,mBAAmB,iBACnD,oBAAoB,QAAQ,oBAAoB,uBAAuB,UACvE,8BAA8B,sCAAsC,OACpE,QAAQ,UAAU,gBAAgB,aAAa,SAAS,gBACxD,WAAW,iBAAiB,kBAAkB,aAAa,cAC3D,QAAQ,YAAY,uBAAuB,eAAe,cAC1D,gBAAgB,kBAAkB,SAAS,eAAe,iBAC1D,eAAe,iBAAiB,cAAc,gBAAgB,SAC9D,WAAW,UAAU,YAAY,QAAQ,iBAAiB,WAC1D,mBAAmB,6BAA6B,mBAChD,sBAAsB,oBAAoB,SAAS,OAAO,UAC1D,kBAAkB,kBAAkB,iBAAiB,eACrD,iBAAiB,WAAW,OAAO,OAAO,OAAO,UAAU,UAC3D,YAAY,cAAc,cAAc,aAAa,QACtD,EAEA,IAAI1nD,EAAS,GAQN,MAAM2nD,EAAO,MAAM,CACpB3nD,IAGLA,EAAS,GAET,SAAS,KAAK,eAAY,iBAAc,OAAQ,CAC/C,KAAM,EACN,IAAK,aACL,KAAM,WACN,YAAa,WACd,CAAC,CAAC,EACH,EAZoB,QAmBP4nD,EAAY,EAACxnD,GAAiB,CACrCJ,GAAU,CAAE,OAAOI,CAAI,EAAE,WAAW,KAAK,GAAK,CAAE,OAAOA,CAAI,EAAE,WAAW,QAAQ,GAGrFunD,EAAK,CACN,EALyB,Y,0EClQzB,QAAe,IAA0B,mBCEnCE,EAAc,CACnB,UACA,QACA,cACA,UACA,YACA,SACA,eACA,SACA,QACA,sBACA,iBACA,SACA,eACA,kBACA,UACA,WACA,cACA,kBACA,eACD,EAEaC,EAAc,SAAS,OAAO,MACxCD,EAAY,OAAOllB,GAAQ,SAAS,MAAM,MAAM,QAAQA,CAAI,EAAE,CAAC,EAAE,KAAK,EACtEklB,EAAY,KAAK,EAKdE,EAAe,CACpB,SACA,YACA,eACA,OACA,aACA,mBACA,kBACA,SACA,UACA,YACA,cACA,UACA,SACA,eACA,SACA,UACA,cACA,mBACA,OACA,QACA,QACA,eACA,YACA,cACA,eACA,QACA,YACA,WACA,gBACA,eACA,YACA,aACA,eACA,OACD,EAEMC,EAAgB,IAAI,IACpBC,EAAsB,IAAI,IAEhC,SAASC,EAAevlB,EAAc,CACrC,GAAKslB,EAAoB,IAAItlB,CAAI,EAChC,OAED,MAAMvnD,EAAO,mBAAmBunD,CAAI,EAE9BniB,KAAO,iBAAc,OAAQ,CAClC,GAAI,YAAYplC,CAAI,GACpB,IAAK,aACL,KAAM,4CAA4CA,CAAI,EACvD,CAAC,EAED6sE,EAAoB,IAAItlB,EAAMniB,CAAI,EAClC,SAAS,KAAK,YAAYA,CAAI,CAC/B,CAdS,EAAA0nC,EAAA,kBAgBT,SAASC,EAAiBxlB,EAAc,CACvC,MAAMniB,EAAOynC,EAAoB,IAAItlB,CAAI,EAClCniB,IAGPynC,EAAoB,OAAOtlB,CAAI,EAC/BniB,EAAK,OAAO,EACb,CAPS,EAAA2nC,EAAA,oBAYT,MAAMC,EAAW,CAChB,eACA,mBACA,kBACD,EAIA,IAAIC,EAAW,EACXC,EAAkC,KAEtC,SAASC,GAAmB,CACtBD,IAGLA,KAAU,iBAAc,OAAQ,CAC/B,GAAI,wBACJ,IAAK,aACL,KAAM,WACN,KAAM,CACP,CAAC,EAED,SAAS,KAAK,YAAYA,CAAO,EAClC,CAZS,EAAAC,EAAA,oBAeT,SAASC,GAAqB,CACtBF,IAGPA,EAAQ,OAAO,EACfA,EAAU,KACX,CANS,EAAAE,EAAA,sBA+BF,SAASC,GAA6C,CAC5D,MAAMluE,EAAoC,CACzC,CAAC,MAAO,GAAI,SAAU,uBAAwB,MAAO,SAAS,EAC9D,CAAC,UAAW,GAAM,SAAU,uBAAwB,MAAO,gBAAgB,CAC5E,EAEA,UAAUooD,KAAQmlB,EACjBvtE,EAAI,KAAK,CAAC,MAAOooD,EAAM,MAAOA,CAAI,CAAC,EAEpCpoD,EAAI,KAAK,CACR,UAAW,GAAM,SAAU,wBAAyB,MAAO,gBAC5D,CAAC,EAED,UAAUooD,KAAQylB,EACjB7tE,EAAI,KAAK,CAAC,MAAOooD,EAAM,MAAOA,CAAI,CAAC,EAEpCpoD,EAAI,KAAK,CACR,UAAW,GAAM,SAAU,sBAAuB,MAAO,cAC1D,CAAC,EAED,UAAUooD,KAAQolB,EACjBxtE,EAAI,KAAK,CAAC,MAAO,UAAUooD,CAAI,GAAI,MAAOA,CAAI,CAAC,EAEhD,OAAOpoD,CACR,CAxBgB,EAAAkuE,EAAA,gBA2BT,SAASC,EAAQ/lB,EAA6C,CACpE,GAAK,CAAEA,EACN,MAAO,CAACA,EAAM,IAAI,EAEnB,GAAKylB,EAAS,SAASzlB,CAAI,EAAI,CAC9B0lB,IACKA,IAAa,GACjBE,EAAiB,EAElB,IAAII,EAAW,GAUf,MAAO,CAAChmB,EATS,MAAM,CACfgmB,IACNA,EAAW,GACXN,IACOA,GACNG,EAAmB,EAEtB,EAPiB,WASK,CACvB,CAEA,GAAK7lB,EAAK,WAAW,SAAS,EAAI,CACjC,MAAMvnD,EAAOunD,EAAK,MAAM,CAAC,EACxBn2B,GAASw7C,EAAc,IAAI5sE,CAAI,GAAK,GAAK,EAE1C4sE,EAAc,IAAI5sE,EAAMoxB,CAAK,EACxBA,IAAU,GACd07C,EAAe9sE,CAAI,EAEpB,IAAIutE,EAAW,GAcf,MAAO,CAACvtE,EAbS,MAAM,CACtB,GAAK,CAAEutE,EAAW,CACjBA,EAAW,GACX,MAAMn8C,GAASw7C,EAAc,IAAI5sE,CAAI,GAAK,GAAK,EAC1CoxB,EAAQ,EACZw7C,EAAc,IAAI5sE,EAAMoxB,CAAK,GAE7Bw7C,EAAc,OAAO5sE,CAAI,EACzB+sE,EAAiB/sE,CAAI,EAEvB,CACD,EAXiB,WAaK,CACvB,CAEA,MAAO,CAACunD,EAAM,IAAI,CACnB,CAhDgB,EAAA+lB,EAAA,U,iGC9KT,MAAME,EAAyD,CACrE,SAAU,CAACp+D,EAAiBC,KACtBD,EAAE,aAAeC,EAAE,YACtBD,EAAU,YAAcq+D,EAAUr+D,EAAE,YAAiCC,EAAE,WAAkB,EACjFA,EAAE,cACVD,EAAU,YAAcC,EAAE,aAErBD,GAGR,MAAO,CAACA,EAAcC,KAChBD,EAAE,OAAS,CAAEC,EAAE,MAAQA,EAAE,KAAK,QAAUD,EAAE,KAAK,SAM/CA,EAAE,cAAgBC,EAAE,aACvBD,EAAU,aAAes+D,EAAMt+D,EAAE,aAAcC,EAAE,YAAY,EACrDA,EAAE,eACVD,EAAU,aAAeC,EAAE,eAEtBD,GAGR,oBAAqB,CAACA,EAA4BC,KAC5CD,EAAE,YAAcC,EAAE,YAMlBD,EAAE,cAAgBC,EAAE,aACvBD,EAAU,aAAes+D,EAAMt+D,EAAE,aAAcC,EAAE,YAAY,EACrDA,EAAE,eACVD,EAAU,aAAeC,EAAE,eAEtBD,GAGR,mBAAoB,CAACA,EAA2BC,KAC1CD,EAAE,eAAiBC,EAAE,gBACpBD,EAAE,cAAc,OAASC,EAAE,cAAc,MAGzCD,EAAE,cAAc,KAAK,OAASC,EAAE,cAAc,KAAK,SAMpDD,EAAE,cAAgBC,EAAE,aACvBD,EAAU,aAAes+D,EAAMt+D,EAAE,aAAcC,EAAE,YAAY,EACrDA,EAAE,eACVD,EAAU,aAAeC,EAAE,eAEtBD,GAGR,aAAc,CAACA,EAAqBC,KAC9BD,EAAE,YAAcC,EAAE,WACtBD,EAAE,WAAaq+D,EAAUr+D,EAAE,WAA+BC,EAAE,UAAiB,EACpEA,EAAE,aACXD,EAAE,WAAaC,EAAE,YAEXD,EAET,EAGO,SAASq+D,EAAUr+D,EAAUC,EAAU,CAC7C,IAAIs+D,EAAgB,GACpB,MAAMC,EAA+B,CAAC,EACtC,UAAU7sE,KAAQqO,EACZ,CAAErO,GAAQ,CAAEA,EAAK,MAAQA,EAAK,KAAK,OAAS,SAG5CA,EAAK,YACT4sE,EAAgB,IAEjBC,EAAQ7sE,EAAK,KAAK,KAAK,EAAIA,GAG5B,UAAUA,KAAQsO,EAAG,CACpB,GAAK,CAAEtO,GAAQ,CAAEA,EAAK,MAAQA,EAAK,KAAK,OAAS,OAChD,SAED,MAAMf,EAAOe,EAAK,KAAK,MACtBgd,EAAM6vD,EAAQ5tE,CAAI,EAAIoP,EAAE,QAAQw+D,EAAQ5tE,CAAI,CAAC,EAAI,GAElD,GAAK+d,IAAQ,GAAK,CACjB,GAAK3O,EAAE2O,CAAG,EAAE,WAAahd,EAAK,WAAaqO,EAAE2O,CAAG,EAAE,YAAchd,EAAK,UACpE,SAEDqO,EAAE2O,CAAG,EAAI2vD,EAAMt+D,EAAE2O,CAAG,EAAGhd,CAAI,EACtBqO,EAAE2O,CAAG,EAAE,YACX4vD,EAAgB,GAElB,KAAO,CACN,GAAKA,GAAiB5sE,EAAK,UAC1B,SAEDqO,EAAE,KAAKrO,CAAI,CACZ,CACD,CAEA,OAAOqO,CACR,CArCgB,EAAAq+D,EAAA,aAwCD,SAASC,EAAMt+D,EAAQC,EAAQ,CAC7C,OAAKD,EAAE,OAASC,EAAE,KACVD,EAEHo+D,EAAcp+D,EAAE,IAAI,EACjBo+D,EAAcp+D,EAAE,IAAI,EAAEA,EAAGC,CAAC,EAE3BD,CACR,CARwB,EAAAs+D,EAAA,Q,mB5IvHxB,M,kL6ImBYG,GAAAA,IAEXA,EAAAA,EAAA,uBAMAA,EAAAA,EAAA,qBAEAA,EAAAA,EAAA,mBAMAA,EAAAA,EAAA,yBAhBWA,IAAAA,GAAA,IAmBAC,GAAAA,IAEXA,EAAAA,EAAA,uBAMAA,EAAAA,EAAA,uBAEAA,EAAAA,EAAA,qBAMAA,EAAAA,EAAA,yBAhBWA,IAAAA,GAAA,IAmCZ,MAAMC,EAAY,2BAElB,SAASC,EAAetoC,EAAc,CACrC,OAAOqoC,EAAU,KAAKroC,CAAI,IAAI,CAAC,CAChC,CAFS,EAAAsoC,EAAA,kBAsBF,MAAM,GAAN,gBAKG,SAAwC,CA2DjD,YAAYhuE,EAAejB,EAAwB0iB,EAAiB,CAUnE,GATK,CAAE1iB,GAAWiB,aAAwB,IACzCjB,EAASiB,EACTA,EAAO,QAGR,MAAMA,EAAMjB,CAAM,EA5BnB,qBAA4B,KAC5B,gBAAuB,KACvB,gBAAiC,KA2BhC,KAAK,UAAYA,EAASA,EAAO,UAAY,CAAC,EAC9C,KAAK,SAAW,CAAC,EAEZA,GAAQ,WACZ,KAAK,WAAaA,EAAO,WACzB,KAAK,aAAeA,EAAO,qBAChB0iB,EAAQ,CACnB,MAAMH,EAAW0sD,EAAe,KAAK,MAAgB,EAChD1sD,IACJ,KAAK,WAAaA,EAClB,KAAK,aAAe,KAEtB,CAEKviB,GAAU,CAAEA,EAAO,SAAS,KAAK,IAAI,IACzCA,EAAO,SAAS,KAAK,IAAI,EAAI,MAEzB,KAAK,OAAS,OAClB,KAAK,UAAU,KAAK,QAAU,EAAE,EAAI,MAErC,IAAIkvE,EAAc,CAAC,CAAE,KAAK,OAC1B,GAAK,CAAEA,EAAc,CACpB,MAAMC,EAAgB,KAAK,oBAAoB,EAC/CD,EAAc,MAAM,QAAQC,CAAa,GAAKA,EAAc,OAAS,CACtE,CAEA,KAAK,aAAeD,EAAc,EAAqB,EACvD,KAAK,QAAUA,GAAe,KAAK,SAClC,EAAiB,EAElB,KAAK,MAAM,UAAU,EACpB,KAAa,KAAK,cAAe,IAAI,CACvC,CAQA,IAAI,OAAQ,CAAE,OAAO,KAAK,OAAQ,CAGlC,IAAI,YAAa,CAAE,OAAO,KAAK,YAAa,CAG5C,IAAI,QAAS,CAAE,OAAO,KAAK,eAAiB,CAAiB,CAE7D,IAAI,SAAU,CAAE,OAAO,KAAK,eAAiB,CAAkB,CAG/D,IAAI,SAAU,CAAE,OAAO,KAAK,UAAY,CAAc,CAEtD,IAAI,UAAW,CAAE,OAAO,KAAK,UAAY,CAAe,CAGxD,IAAI,UAAW,CAAE,OAAO,KAAK,UAAW,CAExC,IAAI,YAAa,CAAE,OAAO,KAAK,YAAa,CAE5C,IAAI,gBAAiB,CACpB,GAAI,KAAK,WACR,OAAO,KAAK,QAAQ,QAAQ,GAAG,SAAS,KAAK,UAAW,GACtD,KAAK,cAAc,aAA8B,MAClD,MACH,CAGA,IAAI,KAAc,CAKjB,OAAO,KAAK,QACX,KAAK,MAAQ,KAAK,QAAW,KAAK,OAAyB,KAAK,MAAM,KAAK,IAAI,GACzE,KAAK,KACb,CAEA,IAAI,IAAIlN,EAAK,CACZ,KAAK,MAAQA,CACd,CAWU,MAAMniD,EAAqB,CAC9B,KAAK,KAAa,SAClB,OAAOA,GAAU,WACrBA,EAAQ,CAAC,MAAAA,CAAK,GACfA,EAAM,OAAS,KAAK,QAAU,OAC7B,KAAK,KAAa,OAAO,SAASA,CAAK,EAE1C,CAiBA,MAAO,CACN,OAAO,KAAK,OAAO,KAAK,OAAQ,CAAC,CAAC,CACnC,CAwBA,QAAS,CACR,OAAO,KAAK,SAAS,KAAK,OAAQ,CAAC,CAAC,CACrC,CAsBA,QAAS,CACR,OAAO,KAAK,SAAS,KAAK,OAAQ,CAAC,CAAC,CACrC,CAuBA,SAAU,CACT,OAAO,KAAK,UAAU,KAAK,OAAQ,CAAC,CAAC,CACtC,CAcA,WAAY,CACX,OAAO,KAAK,YAAY,KAAK,OAAQ,CAAC,CAAC,CACxC,CAOA,YAAa,CACZ,OAAO,KAAK,aAAa,KAAK,OAAQ,CAAC,CAAC,CACzC,CAEQ,OAAOs7C,EAA6BiU,EAAwB,CACnE,MAAMzoC,EAAO,KAAK,QAAU,KAAK,KAChC9gC,EAAQ,KAAK,aAEd,GAAKupE,EAAM,SAAS,IAAI,EACvB,OAAO,QAAQ,OAAO,IAAIC,EAAsB,yCAAyClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,IAAI,CAAC,CAAC,KAC5G,KAAK,cACd,UAAUnuE,KAAQ,KAAK,cAAe,CACrC,MAAM1B,EAAS,KAAK,UAAU0B,CAAI,EAClC,GAAM1B,aAAkB,GAAW6vE,EAAM,SAAS7vE,CAAM,EACvD,OAAO,QAAQ,OAAO,IAAI8vE,EAAsB,yCAAyClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,KAAM7vE,CAAM,CAAC,CAAC,CAC/H,CAID,OAFA6vE,EAAM,KAAK,IAAI,EAEVvpE,IAAU,EACP,KAAK,eAEHA,IAAU,EACZ,QAAQ,QAAQ,EAEdA,IAAU,EACZ,QAAQ,OAAO,IAAIypE,EAAY,4BAA4B3oC,CAAI,iCAAiC,CAAC,GAEzG,KAAK,MAAM,YAAY,EACvB,KAAK,aAAe,EACb,KAAK,gBAAkB,SAAY,CACzC,GAAK,KAAK,cAAgB,CACzB,MAAM7lB,EAAW,CAAC,EAClB,UAAU7f,KAAQ,KAAK,cAAe,CACrC,MAAM1B,EAAS,KAAK,UAAU0B,CAAI,EAClC,GAAK,CAAE1B,GAAU,EAAEA,aAAkB,GACpC,MAAM,IAAI+vE,EAAY,+BAA+BruE,CAAI,iBAAiB0lC,CAAI,EAAE,EAEjF7lB,EAAS,KAAKvhB,EAAO,SAAS47D,EAAS,MAAM,KAAKiU,CAAK,CAAC,CAAC,CAC1D,CAEA,MAAM,QAAQ,IAAItuD,CAAQ,CAC3B,CAEA,GAAK,KAAK,OACT,YAAK,MAAM,WAAW,EACf,KAAK,OAAO,CAGrB,GAAG,EAAE,KAAKyY,IACT,KAAK,aAAe,EACpB,KAAK,eAAiB,KACtB,KAAK,MAAM,UAAU,EACpB,KAAa,KAAK,UAAW,IAAI,EAC3BA,EACP,EAAE,MAAMhZ,GAAO,CACf,WAAK,aAAe,EACpB,KAAK,eAAiB,KACtB,KAAK,MAAM,UAAU,EACfA,CACP,CAAC,EACF,CAGQ,YAAY46C,EAA6BiU,EAAwB,CACxE,MAAMzoC,EAAO,KAAK,QAAU,KAAK,KAChC9gC,EAAQ,KAAK,aAEd,GAAKupE,EAAM,SAAS,IAAI,EACvB,MAAM,IAAIC,EAAsB,wDAAwDlU,CAAO,GAAI,CAAC,GAAGiU,EAAO,IAAI,CAAC,KAC1G,KAAK,gBAAkB,CAChCA,EAAM,KAAK,IAAI,EAEf,UAAUnrE,KAAO,KAAK,gBAAiB,CACtC,MAAM1E,EAAS,KAAK,UAAU0E,CAAG,EACjC,GAAK1E,aAAkB,EAAS,CAC/B,GAAK6vE,EAAM,SAAS7vE,CAAM,EACzB,MAAM,IAAI8vE,EAAsB,wDAAwDlU,CAAO,GAAI,CAAC,GAAGiU,EAAO,KAAM7vE,CAAM,CAAC,EAE5H,GAAK,CAAEA,EAAO,YAAY47D,EAAS,MAAM,KAAKiU,CAAK,CAAC,EACnD,MAAO,EACT,CACD,CACD,CAEA,OAAKvpE,IAAU,GAGLA,IAAU,EAFZ,GAKE,KAAK,QAAU,CAAE,KAAK,SACxB,GAEEA,IAAU,CAIrB,CAGQ,SAASs1D,EAA6BiU,EAAwB,CACrE,MAAMzoC,EAAO,KAAK,QAAU,KAAK,KAChC9gC,EAAQ,KAAK,aAEd,GAAKupE,EAAM,SAAS,IAAI,EACvB,OAAO,QAAQ,OAAO,IAAIC,EAAsB,2CAA2ClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,IAAI,CAAC,CAAC,KAC9G,KAAK,gBACd,UAAUnrE,KAAO,KAAK,gBAAiB,CACtC,MAAM1E,EAAS,KAAK,UAAU0E,CAAG,EACjC,GAAK1E,aAAkB,GAAU6vE,EAAM,SAAS7vE,CAAM,EACrD,OAAO,QAAQ,OAAO,IAAI8vE,EAAsB,2CAA2ClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,KAAM7vE,CAAM,CAAC,CAAC,CACjI,CAID,OAFA6vE,EAAM,KAAK,IAAI,EAEVvpE,IAAU,EACP,KAAK,eAEHA,IAAU,EACZ,QAAQ,QAAQ,EAEd,KAAK,QAAU,CAAE,KAAK,SACxB,QAAQ,OAAO,IAAIypE,EAAY,8BAA8B3oC,CAAI,gCAAgC,CAAC,EAEhG9gC,IAAU,EACZ,QAAQ,OAAO,IAAIypE,EAAY,8BAA8B3oC,CAAI,+BAA+B,CAAC,GAEzG,KAAK,MAAM,cAAc,EACzB,KAAK,aAAe,EACb,KAAK,gBAAkB,SAAY,CAIzC,GAHK,KAAK,UAAY,GACrB,MAAM,KAAK,QAAQ,EAEf,KAAK,gBAAkB,CAC3B,MAAM7lB,EAAW,CAAC,EAClB,UAAU7f,KAAQ,KAAK,gBAAiB,CACvC,MAAM1B,EAAS,KAAK,UAAU0B,CAAI,EAC7B,CAAE1B,GAAU,EAAEA,aAAkB,IAIrCuhB,EAAS,KAAKvhB,EAAO,SAAS47D,EAAS,MAAM,KAAKiU,CAAK,CAAC,CAAC,CAC1D,CAEA,MAAM,QAAQ,IAAItuD,CAAQ,CAC3B,CAGA,GADA,KAAK,MAAM,aAAa,EACnB,KAAK,SACT,OAAO,KAAK,SAAS,CAEvB,GAAG,EAAE,KAAKyY,IACT,KAAK,aAAe,EACpB,KAAK,eAAiB,KACtB,KAAK,MAAM,YAAY,EACtB,KAAa,KAAK,YAAa,IAAI,EAC7BA,EAEP,EAAE,MAAMhZ,GAAO,CACf,WAAK,aAAe,EACpB,KAAK,eAAiB,KACtB,KAAK,MAAM,YAAY,EACjBA,CAEP,CAAC,EACF,CAGQ,SAAS46C,EAA6BiU,EAAwB,CACrE,MAAMzoC,EAAO,KAAK,QAAU,KAAK,KAChC9gC,EAAQ,KAAK,QAEd,GAAKupE,EAAM,SAAS,IAAI,EACvB,OAAO,QAAQ,OAAO,IAAIC,EAAsB,qCAAqClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,IAAI,CAAC,CAAC,KACxG,KAAK,SACd,UAAUnuE,KAAQ,KAAK,SAAU,CAChC,MAAM1B,EAAS,KAAK,UAAU0B,CAAI,EAClC,GAAK1B,aAAkB,GAAU6vE,EAAM,SAAS7vE,CAAM,EACrD,OAAO,QAAQ,OAAO,IAAI8vE,EAAsB,qCAAqClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,KAAM7vE,CAAM,CAAC,CAAC,CAC3H,CAID,OAFA6vE,EAAM,KAAK,IAAI,EAEVvpE,IAAU,EACP,KAAK,gBAEHA,IAAU,EACZ,QAAQ,QAAQ,EAEdA,IAAU,EACZ,QAAQ,OAAO,IAAIypE,EAAY,8BAA8B3oC,CAAI,iCAAiC,CAAC,GAE3G,KAAK,MAAM,cAAc,EACzB,KAAK,QAAU,EACR,KAAK,iBAAmB,SAAY,CAC1C,MAAM7lB,EAAW,CAAC,EACjB9c,EAAW,KAAK,SAChBurE,EAAa,KAAK,aAEnB,GAAKA,IAAe,EAGnB,MAAM,IAAID,EAAY,4BAA4B3oC,CAAI,iCAAiC,EAKxF,IAHU4oC,IAAe,GAAqBA,IAAe,IAC5DzuD,EAAS,KAAK,KAAK,KAAK,CAAC,EAErB9c,EACJ,UAAU/C,KAAQ+C,EAAU,CAC3B,MAAMzE,EAAS,KAAK,UAAU0B,CAAI,EAClC,GAAK,CAAE1B,GAAU,EAAEA,aAAkB,GACpC,MAAM,IAAI+vE,EAAY,+BAA+BruE,CAAI,kBAAkB0lC,CAAI,EAAE,EAElF7lB,EAAS,KAAKvhB,EAAO,SAAS47D,EAAS,MAAM,KAAKiU,CAAK,CAAC,CAAC,CAC1D,CAGD,GADA,MAAM,QAAQ,IAAItuD,CAAQ,EACrB,KAAK,SACT,YAAK,MAAM,aAAa,EACjB,KAAK,SAAS,CAGvB,GAAG,EAAE,KAAKyY,IACT,KAAK,QAAU,EACf,KAAK,gBAAkB,KACvB,KAAK,MAAM,YAAY,EACtB,KAAa,KAAK,WAAY,IAAI,EAC5BA,EAEP,EAAE,MAAMhZ,GAAO,CACf,WAAK,QAAU,EACf,KAAK,gBAAkB,KACvB,KAAK,MAAM,YAAY,EACjBA,CACP,CAAC,EACF,CAGQ,aAAa46C,EAA6BiU,EAAwB,CACzE,MAAMzoC,EAAO,KAAK,QAAU,KAAK,KAChC9gC,EAAQ,KAAK,QAEd,GAAKupE,EAAM,SAAS,IAAI,EACvB,MAAM,IAAIC,EAAsB,yDAAyDlU,CAAO,GAAI,CAAC,GAAGiU,EAAO,IAAI,CAAC,KAC3G,KAAK,WAAa,CAC3BA,EAAM,KAAK,IAAI,EAEf,UAAUnrE,KAAO,KAAK,WAAY,CACjC,MAAM1E,EAAS,KAAK,UAAU0E,CAAG,EACjC,GAAK1E,GAAWA,aAAkB,EAAU,CAC3C,GAAK6vE,EAAM,SAAS7vE,CAAM,EACzB,MAAM,IAAI8vE,EAAsB,yDAAyDlU,CAAO,GAAI,CAAC,GAAGiU,EAAO,KAAM7vE,CAAM,CAAC,EAE7H,GAAK,CAAEA,EAAO,aAAa47D,EAAS,MAAM,KAAKiU,CAAK,CAAC,EACpD,MAAO,EACT,CACD,CACD,CAEA,GAAKvpE,IAAU,GAAmBA,IAAU,EAC3C,MAAO,MAEI,KAAK,WACT,GAEEA,IAAU,EACnB,MAAO,OAHP,OAAO,GAKR,MAAO,EACR,CAGQ,UAAUs1D,EAA6BiU,EAAwB,CACtE,MAAMzoC,EAAO,KAAK,QAAU,KAAK,KAChC9gC,EAAQ,KAAK,QAEd,GAAKupE,EAAM,SAAS,IAAI,EACvB,OAAO,QAAQ,OAAO,IAAIC,EAAsB,sCAAsClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,IAAI,CAAC,CAAC,KACzG,KAAK,WACd,UAAUnrE,KAAO,KAAK,WAAY,CACjC,MAAM1E,EAAS,KAAK,UAAU0E,CAAG,EACjC,GAAK1E,aAAkB,GAAU6vE,EAAM,SAAS7vE,CAAM,EACrD,OAAO,QAAQ,OAAO,IAAI8vE,EAAsB,sCAAsClU,CAAO,GAAI,CAAC,GAAGiU,EAAO,KAAM7vE,CAAM,CAAC,CAAC,CAC5H,CAID,GAFA6vE,EAAM,KAAK,IAAI,EAEVvpE,IAAU,EACd,OAAO,KAAK,mBAEHA,IAAU,EACnB,OAAO,QAAQ,QAAQ,KAEZ,KAAK,WAC0F,GAEjGA,IAAU,EACnB,OAAO,QAAQ,OAAO,IAAIypE,EAAY,+BAA+B3oC,CAAI,8BAA8B,CAAC,MAHxG,QAAO,QAAQ,OAAO,IAAI2oC,EAAY,+BAA+B3oC,CAAI,gCAAgC,CAAC,EAK3G,YAAK,MAAM,eAAe,EAC1B,KAAK,QAAU,EACR,KAAK,iBAAmB,SAAY,CAC1C,GAAK,KAAK,eAAiB,EAG1B,MAAM,IAAI2oC,EAAY,+BAA+B3oC,CAAI,wCAAwC,EAElG,GAAK,KAAK,WAAa,CACtB,MAAM7lB,EAAW,CAAC,EAClB,UAAU7f,KAAQ,KAAK,WAAY,CAClC,MAAM1B,EAAS,KAAK,UAAU0B,CAAI,EAC7B,CAAE1B,GAAU,EAAEA,aAAkB,IAKrCuhB,EAAS,KAAKvhB,EAAO,UAAU47D,EAAS,MAAM,KAAKiU,CAAK,CAAC,CAAC,CAC3D,CAEA,MAAM,QAAQ,IAAItuD,CAAQ,CAC3B,CAEA,GAAK,KAAK,UACT,YAAK,MAAM,cAAc,EAClB,KAAK,UAAU,CAGxB,GAAG,EAAE,KAAKyY,IACT,KAAK,QAAU,EACf,KAAK,gBAAkB,KACvB,KAAK,MAAM,aAAa,EACvB,KAAa,KAAK,YAAa,IAAI,EAC7BA,EAEP,EAAE,MAAMhZ,GAAO,CACf,WAAK,QAAU,EACf,KAAK,gBAAkB,KACvB,KAAK,MAAM,aAAa,EAClBA,CACP,CAAC,CACF,CAOA,GACCV,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,GACZ9nD,EACArb,EACAua,IAAQ,OAAY,KAAOA,EAC3BuY,EACAqwC,CACD,CACD,CAEA,KACC9nD,EACArb,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,KACZ9nD,EACArb,EACAua,IAAQ,OAAY,KAAOA,EAC3BuY,EACAqwC,CACD,CACD,CAEA,KACC9nD,EACA+nD,EACApjE,EACAua,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,KACZ9nD,EACA+nD,EACApjE,EACAua,IAAQ,OAAY,KAAOA,EAC3BuY,EACAqwC,CACD,CACD,CAEA,QACC9nD,EACAd,EACAuY,EACAqwC,EAAmB,GAClB,CACD,OAAO,MAAM,QACZ9nD,EACAd,IAAQ,OAAY,KAAOA,EAC3BuY,EACAqwC,CACD,CACD,CAEA,IACC9nD,EAAWrb,EAAoBua,EAC9B,CACD,OAAO,MAAM,IAAIc,EAAOrb,EAAIua,IAAQ,OAAY,KAAOA,CAAG,CAC3D,CAOQ,UAAU9d,EAA2D,CAC5E,OAAKA,aAAgB,EACbA,EAED,KAAK,UAAU,KAAK,SAASA,CAAI,CAAC,CAC1C,CAEA,QAKEA,EAA6B,CAC9B,IAAI1B,EAAS,KAAK,UAAU0B,CAAI,EAChC,OAAO1B,aAAkB,GAGpB,KAAK,kBACTA,EAAS,KAAK,gBAAgBA,CAAM,GAE9BA,GALC,IAMT,CAGA,UAAU0B,EAAc,CAEvB,OADe,KAAK,UAAU,KAAK,SAASA,CAAI,CAAC,YACxB,CAC1B,CAGQ,gBAAiB,CACxB,SAAK,OAAI,KAAM,UAAU,EACjB,KAAK,YACR,OAAI,KAAK,YAAa,UAAU,EAC5B,KAAK,YAAoB,SAC3B,IACR,CAGQ,qBAAsB,CAC7B,SAAK,OAAI,KAAM,eAAe,EACtB,KAAK,iBACR,OAAI,KAAK,YAAa,eAAe,EACjC,KAAK,YAAoB,cAC3B,IACR,CAGQ,gBAAwC1B,EAA0B,CACzE,GAAK,KAAK,YAAcA,EAAO,cAAgB,CAC9C,MAAMgjB,EAAW,KAAK,WAItB,GAHOhjB,EAAO,YACbA,EAAO,UAAY,CAAC,GAEhBA,EAAO,UAAUgjB,CAAQ,EAC7B,OAAOhjB,EAAO,UAAUgjB,CAAQ,EAGjC,MAAMG,EAAS,KAAK,UAAU,QAAQ,GAAW,WAAWH,CAAQ,EACnEniB,EAAMb,EAAO,cAAcgjB,EAAUG,EAAO,KAAK,cAAgB,KAAM,IAAI,EAE5E,OAAKtiB,IAAQb,IACZA,EAAO,UAAUgjB,CAAQ,EAAIniB,GAEvBA,CACR,CAEA,OAAOb,CACR,CAGA,OAAO0B,EAA8B1B,EAAyDgxC,EAAmB,GAAM,EACjHtvC,aAAgB,GAAWA,GAASA,EAAa,qBAAqB,KAC1EsvC,EAAUhxC,GAAiC,GAC3CA,EAAS0B,EACTA,EAAO,MAGR,MAAM+C,EAAW,KAAK,SAAW,KAAK,eAAe,GAAK,CAAC,EAE3D,GAAKzE,aAAkB,EAEf0B,IACNA,EAAO1B,EAAO,YAAY,KAAK,YAAY,WAEjCA,GAAUA,EAAO,qBAAqB,EAE1C0B,IACNA,EAAO1B,EAAO,KAAK,YAAY,GAEhCA,EAAS,KAAK,SAAS0B,EAAM1B,CAAM,UAExB0B,EAAO,CAElB,MAAMuuE,EAAYvuE,EAMlB,GALAA,EAAOA,EAAK,QAAQ,gBAAiB,EAAE,EACvC1B,EAAS,KAAK,UAAUiwE,CAAS,EAI5B,CAAEjwE,GAAU,EAAEA,aAAkB,GACpC,OAAKA,EACHA,EAAyB,CAAC,EAAE,KAAK,CAAC,KAAK,OAAkB0B,CAAI,CAAC,EAE/D,KAAK,UAAU,KAAK,SAASuuE,CAAS,CAAC,EAAI,CAAC,CAAC,EAAG,CAAC,EAAG,CAAC,CAAC,KAAK,OAAkBvuE,CAAI,CAAC,CAAC,EAEpF+C,EAAS,KAAK,KAAK,SAASwrE,CAAS,CAAC,EAE9B,KAAavuE,CAAI,EAAI,IAG/B,KACC,OAAM,IAAI,UAAU,2CAA2C,EAEhE,GAAK,CAAE1B,EACN,MAAM,IAAI,MAAM,sBAAsB0B,CAAI,wBAAwB,EAEnE,OAAKsvC,GACJvsC,EAAS,KAAMzE,EAAkB,SAAS,GAAG,CAAC,EAE1C,KAAK,SAAW,CAAGA,EAAkB,SACxCA,EAAkB,OAAO,EAE1BA,EAAkB,WAAW,KAAK,CAAC,KAAK,OAAkB0B,CAAI,CAAC,EAE1D1B,aAAkB,GAAW,KAAK,kBACvCA,EAAS,KAAK,gBAAgBA,CAAM,GAE7B,KAAa0B,CAAI,EAAI1B,CAC9B,CAGA,SAASkwE,EAAkBxuE,EAA8B1B,EAAyDgxC,EAAmB,GAAM,EACrItvC,aAAgB,GAAWA,GAASA,EAAa,qBAAqB,KAC1EsvC,EAAUhxC,GAAiC,GAC3CA,EAAS0B,EACTA,EAAO,MAGR,MAAM+C,EAAW,KAAK,SAAW,KAAK,eAAe,GAAK,CAAC,EAE3D,GAAKzE,aAAkB,EAEf0B,IACNA,EAAO1B,EAAO,YAAY,KAAK,YAAY,WAEjCA,GAAUA,EAAO,qBAAqB,EAE1C0B,IACNA,EAAO1B,EAAO,KAAK,YAAY,GAEhCA,EAAS,KAAK,SAAS0B,EAAM1B,CAAM,UAExB0B,EAAO,CAElB,MAAMuuE,EAAYvuE,EAMlB,GALAA,EAAOA,EAAK,QAAQ,gBAAiB,EAAE,EACvC1B,EAAS,KAAK,UAAUiwE,CAAS,EAI5B,CAAEjwE,GAAU,EAAEA,aAAkB,GACpC,OAAKA,EACHA,EAAyB,CAAC,EAAE,KAAK,CAAC,KAAK,OAAkBkwE,CAAQ,CAAC,EAEnE,KAAK,UAAU,KAAK,SAASD,CAAS,CAAC,EAAI,CAAC,CAAC,EAAG,CAAC,EAAG,CAAC,CAAC,KAAK,OAAkBC,CAAQ,CAAC,CAAC,EAExFzrE,EAAS,KAAK,KAAK,SAASwrE,CAAS,CAAC,EAE9B,KAAaC,CAAQ,EAAI,IAGnC,KACC,OAAM,IAAI,UAAU,2CAA2C,EAEhE,GAAK,CAAElwE,EACN,MAAM,IAAI,MAAM,sBAAsB0B,CAAI,wBAAwB,EAEnE,OAAKsvC,GACJvsC,EAAS,KAAMzE,EAAkB,SAAS,GAAG,CAAC,EAG1C,KAAK,SAAW,CAAGA,EAAkB,SACxCA,EAAkB,OAAO,EAE1BA,EAAkB,WAAW,KAAK,CAAC,KAAK,OAAkBkwE,CAAQ,CAAC,EAE/D,KAAK,kBACTlwE,EAAS,KAAK,gBAAgBA,CAAgB,GAEvC,KAAakwE,CAAQ,EAAIlwE,CAClC,CAGA,SAAS0B,EAAc1B,EAAiCmwE,EAA4B,GAAO,CACpFzuE,EAAa,qBAAqB,IACvCyuE,EAAmBnwE,EACnBA,EAAS0B,EACTA,EAAO1B,EAAO,KAAK,YAAY,GAGhC,MAAMonC,EAAO,KAAK,SAAS,IAAI1lC,CAAI,EAAE,EACpCu0D,EAAQj2D,EAAO,UACfowE,EAAU,KAAK,UAAUhpC,CAAI,EAE9B,GAAK,EAAE6uB,aAAiB,GACvB,MAAM,IAAI,UAAU,UAAUv0D,CAAI,6BAA6B,EAEhE,GAAK0uE,aAAmB,EACvB,MAAM,IAAIL,EAAY,6BAA6B3oC,CAAI,EAAE,EAE1D,MAAMipC,EAAaD,GAAW,CAAC,CAAC,EAAG,CAAC,EAAG,CAAC,CAAC,EACzC,IAAI3kC,EAAO,KAAK,UAAUrE,CAAI,EAAI,IAAIpnC,EAAO0B,EAAM,IAAI,EACvD,MAAM+C,EAAWgnC,EAAK,SAAWA,EAAK,eAAe,GAAK,CAAC,EAC1DmkC,EAAgBnkC,EAAK,cAAgBA,EAAK,oBAAoB,GAAK,CAAC,EAErEA,EAAK,WAAa4kC,EAAW,CAAC,EAC9B5kC,EAAK,gBAAkB4kC,EAAW,CAAC,EACnC5kC,EAAK,WAAa4kC,EAAW,CAAC,EAE9B,UAAUC,KAAY7rE,EAAU,CAC/B,MAAM8rE,EAAW9kC,EAAK,SAAS6kC,CAAQ,EACtCE,EAAU,KAAK,UAAUD,CAAQ,EAE3BC,EAEG,MAAM,QAAQA,CAAO,EAC9BA,EAAQ,CAAC,EAAE,KAAKppC,CAAI,EAEpBopC,EAAQ,WAAW,KAAKppC,CAAI,EAJ5B,KAAK,UAAUmpC,CAAQ,EAAI,CAAC,CAACnpC,CAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAK1C,CAEA,UAAUkpC,KAAYV,EAAe,CACpC,MAAMW,EAAW9kC,EAAK,SAAS6kC,CAAQ,EACtCE,EAAU,KAAK,UAAUD,CAAQ,EAE3BC,EAEG,MAAM,QAAQA,CAAO,EAC9BA,EAAQ,CAAC,EAAE,KAAKppC,CAAI,EAEpBopC,EAAQ,gBAAgB,KAAKppC,CAAI,EAJjC,KAAK,UAAUmpC,CAAQ,EAAI,CAAC,CAAC,EAAG,CAACnpC,CAAI,EAAG,CAAC,CAAC,CAK5C,CAEA,SAAU,CAACqpC,EAASC,CAAO,IAAKL,EAAW,CAAC,EAAG,CAC9C,MAAMM,EAAS,KAAK,UAAUF,CAAO,EAChCE,GAAU,CAAE,MAAM,QAAQA,CAAM,EACnCA,EAAeD,CAAO,EAAIjlC,EAE3B,KAAK,IAAI,KAAK,0BAA0BglC,CAAO,kBAAkBC,CAAO,IAAI,CAC9E,CAEA,OAAK,KAAK,kBACTjlC,EAAO,KAAK,gBAAgBA,CAAqB,GAE7C0kC,IACH,KAAazuE,CAAI,EAAI+pC,GAEhBA,CACR,CAcA,MAAM,gBAAgBjsB,EAAwCijD,EAAc,CAC3EA,EAAMA,GAAO,KAAK,IAClB,MAAMtiD,EAAuC,CAAC,EAC9C,UAAUywD,KAAYpxD,EAAI,KAAK,EAAG,CACjC,MAAMqxD,EAAa,MAAMrxD,EAAIoxD,CAAQ,EACpC5wE,EAAS6wE,EAAW,QAAUA,EAAW,QACzCC,EAAMF,EAAS,YAAY,GAAG,EAC9BG,EAAUD,EAAM,EAAIF,EAAS,MAAM,EAAGE,CAAG,EAAIF,EAC7ClvE,EAAOqvE,EAAQ,SAAS,QAAQ,EAAIA,EAAQ,MAAM,EAAG,EAAE,EAAIA,EAE5D,GAAI,CACH5wD,EAAMze,CAAI,EAAI,KAAK,SAASA,EAAM1B,CAAM,CACzC,OAAQghB,EAAK,CACPyhD,GAAOzhD,aAAe,QAC1ByhD,EAAI,QAAQzhD,EAAK,CAChB,MAAO,CACN,OAAQtf,EACR,KAAMkvE,CACP,CACD,CAAC,EAEDnO,EAAI,KAAKzhD,EAAK,YAAY4vD,CAAQ,EAAE,EAEtC,CACD,CAEA,OAAOzwD,CACR,CAED,EA9+BkD,gBAL3C,GAAM,EAOL,gBAAkB6wD,EAPnB,IAAMC,EAAN,EAq/BP,QAAeA,EAER,SAASD,EACfE,EACA9wD,EACA1e,EACA6Y,EACA42D,EACAC,EACoD,CAEpD,MAAMv7B,EAAU,CACf,IAAI37B,EAAUkxD,EAAciG,EAAmB,CAE9C,IAAIvlE,EAAQyO,EAAU6wD,CAAI,EAC1B,GAAKt/D,IAAU,OAEd,OAAK,OAAOA,GAAU,WACdA,EAAM,KAAKoO,CAAG,EACfpO,EAIR,MAAMwlE,EAAUH,GAAmBA,EAAgB/F,CAAI,EAMvD,OALK8F,GAAU,KAAOI,GACrBJ,EAAS,IAAI,KAAK,wBAAwBxvE,CAAI,IAAI0pE,CAAI,cAAc,OAAOkG,GAAY,SAAWA,EAAU,EAAE,EAAE,EAGjHxlE,EAAQoO,EAAIkxD,CAAI,EACX,OAAOt/D,GAAU,WACdA,EAAM,KAAKoO,CAAG,EAGjBg3D,GAAaplE,aAAiBmlE,EAG3BC,EAAS,QAAQplE,CAAY,EAG9B,QAAQ,IAAIoO,EAAKkxD,EAAMiG,CAAQ,CACvC,CACD,EAEA,OAAOD,EAAWv7B,EAAU,IAAI,MAAYz1B,EAAOy1B,CAAO,CAE3D,CA3CgB,EAAAm7B,EAAA,mBAyDT,MAAM,EAAN,MAAM,UAAoB,KAAM,CAAE,EAAF,mBAAhC,IAAMjB,EAAN,EAQA,MAAM,EAAN,MAAM,UAA8BA,CAAY,CAWtD,YAAY/yD,EAAiB8zB,EAA0B,CACtD,MAAM,GAAG9zB,CAAO,KAAK8zB,EAAQ,IAAI3oC,GAAMA,EAAa,IAAI,EAAE,KAAK,MAAM,CAAC,GAAG,EACzE,KAAK,QAAU2oC,CAChB,CAED,EAhBuD,6BAAhD,IAAMg/B,EAAN,C,4yBCrpCP,MAAMyB,EAAM,OAAO,UAAU,eAYtB,SAASC,EACf1vE,GACAonB,GACAwR,GAAoB,GACpBi5B,GAAgB,GACf,CACD,MAAO,GAAG,iBAAe,IAAI7xD,EAAE,IAAI44B,GAAW,UAAY,QAAQ,IAAIi5B,GAAO,OAAS,OAAO,IAAIzqC,IAAS,EAAI,EAAIA,EAAK,IACxH,CAPgB,EAAAsoD,EAAA,qBAqBT,SAASC,EACf3vE,GACA44B,GAAoB,GACpBi5B,GAAgB,GAChBnxB,GAAe,GACd,CACD,OAAKA,GACG,GAAGgvC,EAAkB1vE,GAAI,EAAG44B,GAAUi5B,EAAI,CAAC,QAAQ6d,EAAkB1vE,GAAI,EAAG44B,GAAUi5B,EAAI,CAAC,MAE5F,GAAG6d,EAAkB1vE,GAAI,EAAG44B,GAAUi5B,EAAI,CAAC,QAAQ6d,EAAkB1vE,GAAI,EAAG44B,GAAUi5B,EAAI,CAAC,QAAQ6d,EAAkB1vE,GAAI,EAAG44B,GAAUi5B,EAAI,CAAC,KACnJ,CAVgB,EAAA8d,EAAA,wBAaT,SAASC,EAAgBxxE,GAAa,CAC5C,OAAOA,IAGPA,GAAMA,GAAI,YAAY,EAAE,KAAK,EACtB,CAAE,cAAY,SAASA,EAAG,GAHzB,EAIT,CANgB,EAAAwxE,EAAA,mBAcT,MAAMC,EAAe,OAAO,WAChC,IAAM,OAAO,WAAW,EACxB,WAASA,GAAa3/C,GAAqB,CAC5C,OAAOA,IAELA,GACA,KAAK,OAAO,EACV,IACCA,GAAM,GACR,SAAS,EAAE,GAEZ,CAAC,GAAG,EACJ,KACA,KACA,KACA,OACC,QACD,SACA2/C,EACD,CACF,EAlBE,iBAwBU,GAAN,MAAM,WAA0B,KAAM,CAK5C,YAAY30D,GAAiB9c,GAAa4T,GAAY,CACrD,MAAMkJ,EAAO,EACb,KAAK,SAAW9c,GAChB,KAAK,KAAO4T,EACb,CAEA,UAAW,CACV,MAAMiU,GAAM,OAAO,cAAc,IAAI,EACpComC,GAAOpmC,IAAK,QAAQ,MAAM,EAE3B,OAAKomC,IAAQ,KAAK,SACVA,GAAK,EAAE,KAAK,SAAU,KAAK,QAAS,KAAK,IAAI,EAE9C,KAAK,OACb,CACD,EApB6C,0BAAtC,IAAMyjB,EAAN,GA4BA,eAAeC,EAAO70D,GAAiB,CAE7C,MAAM80D,GAAY,IAAI,YAAY,EAAE,OAAO90D,EAAO,EAG5C+0D,GAAa,MAAM,OAAO,OAAO,OAAO,UAAWD,EAAS,EAOlE,OAJkB,MAAM,KAAK,IAAI,WAAWC,EAAU,CAAC,EAG7B,IAAIhhE,IAAKA,GAAE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,EAAE,KAAK,EAAE,CAE5E,CAbsB,EAAA8gE,EAAA,UAyCf,SAASG,EAAYC,GAA6BhyE,GAAwB,CAChF,IAAIghB,GACAixD,GAAS,EAEb,QAAQjgE,GAAI,EAAGA,GAAIggE,GAAQ,OAAQhgE,KAAK,CACvC,MAAMkgE,GAAMF,GAAQhgE,EAAC,EACrB,GAAKkgE,GAAI,QAAUlyE,GAAQ,MAC1B,SAED,IAAI6mE,GAAQ,EACP7mE,GAAQ,MAAQA,GAAQ,OAASkyE,GAAI,OACzCrL,IAAS,IACL7mE,GAAQ,KAAOA,GAAQ,MAAQkyE,GAAI,MACvCrL,IAAS,IAEL7mE,GAAQ,OAASA,GAAQ,QAAUkyE,GAAI,QAC3CrL,IAAS,IAEL7mE,GAAQ,QAAUA,GAAQ,SAAWkyE,GAAI,SAC7CrL,IAAS,IAEL7mE,GAAQ,QACZ6mE,IAAS,KAAK,IAAI7mE,GAAQ,MAAQgS,EAAC,GAE/B60D,GAAQoL,KACZjxD,GAAQkxD,GACRD,GAASpL,GAEX,CAEA,OAAO7lD,EACR,CA/BgB,EAAA+wD,EAAA,eAuCT,SAASI,EAAO9F,GAAWpsE,GAAkC,CACnE,OAAOosE,GAASiF,EAAI,KAAKjF,GAAQpsE,EAAG,EAAI,EACzC,CAFgB,EAAAkyE,EAAA,OAUT,SAASC,EAAMnnB,GAA8B,CACnD,OAAO,IAAI,QAAQ/lD,IAAW,WAAWA,GAAS+lD,EAAK,CAAC,CACzD,CAFgB,EAAAmnB,EAAA,SAeT,SAASC,KAA+BtgD,GAAyB,CACvE,MAAMnxB,GAAW,CAAC,EAElB,QAAQoR,GAAI,EAAGvP,GAAIsvB,GAAM,OAAQ/f,GAAIvP,GAAGuP,KAAK,CAC5C,MAAM6iB,GAAO9C,GAAM/f,EAAC,EACpBpR,GAAIi0B,EAAI,EAAI7iB,GACZpR,GAAIoR,EAAC,EAAI6iB,EACV,CAEA,OAAOj0B,EACR,CAVgB,EAAAyxE,EAAA,aAwBT,SAASC,KAAqCvgD,GAA8B,CAClF,MAAMnxB,GAAW,CAAC,EAElBA,GAAI,KAAO,EACXA,GAAI,CAAC,EAAI,OAET,QAAQoR,GAAI,EAAGvP,GAAIsvB,GAAM,OAAQ/f,GAAIvP,GAAGuP,KAAK,CAC5C,MAAM6iB,GAAO9C,GAAM/f,EAAC,EACnBnG,GAAQ,KAAK,IAAI,EAAGmG,EAAC,EACtBpR,GAAIi0B,EAAI,EAAIhpB,GACZjL,GAAIiL,EAAK,EAAIgpB,EACd,CAEA,OAAOj0B,EACR,CAdgB,EAAA0xE,EAAA,mBAsBT,MAAM,GAAN,MAAM,WAAqB,KAAM,CACvC,YAAYv1D,GAAkB,CAC7B,MAAMA,IAAW,SAAS,CAC3B,CACD,EAJwC,qBAAjC,IAAMw1D,EAAN,GAcA,SAASnrD,EAA2B2P,GAA2Bk0B,GAAe,CACpF,OAAO,IAAI,QAAiB,CAAC/lD,GAASo8D,KAAS,CAC9C,IAAIqK,GAAW,GACf,MAAMnhC,GAAQ,WAAW,IAAM,CACvBmhC,KACNA,GAAW,GACXrK,GAAK,IAAIiR,CAAc,EAEzB,EAAGtnB,EAAK,EAERl0B,GAAQ,KAAK1yB,IAAU,CACfsnE,KACNA,GAAW,GACX,aAAanhC,EAAK,EAClBtlC,GAAQb,EAAM,EAGhB,CAAC,EAAE,MAAM0c,IAAO,CACR4qD,KACNA,GAAW,GACX,aAAanhC,EAAK,EAClB82B,GAAKvgD,EAAG,EAEV,CAAC,CACF,CAAC,CACF,CAzBgB,EAAAqG,EAAA,WA+CT,MAAM,GAAN,MAAM,EAAW,CAMvB,YAAYgc,GAAQ,EAAG,CACtB,KAAK,MAAQA,GACb,KAAK,SAAW,EAChB,KAAK,UAAY,CAAC,CACnB,CAGA,IAAI,WAAY,CAAE,OAAO,KAAK,SAAW,KAAK,KAAM,CAE5C,QAAS,CAGhB,IAFA,KAAK,WAEC,KAAK,SAAW,KAAK,OAAS,KAAK,UAAU,OAAS,GAAG,CAC9D,KAAK,WACL,MAAMoR,GAAS,KAAK,UAAU,MAAM,EAC/BA,IACJA,GAAO,KAAK,YAAY,CAAC,CAC3B,CACD,CAMQ,aAAc,CACrB,IAAIg+B,GAAO,GACX,MAAO,IAAM,CACPA,KACJA,GAAO,GACP,KAAK,OAAO,EAEd,CACD,CAQA,MAAO,CACN,OAAK,KAAK,SAAW,KAAK,OACzB,KAAK,WACE,QAAQ,QAAQ,KAAK,YAAY,CAAC,GAGnC,IAAI,QAAoBttE,IAAW,KAAK,UAAU,KAAKA,EAAO,CAAC,CACvE,CACD,EAtDwB,mBAAjB,IAAMutE,EAAN,GA2DA,MAAMC,EAAQD,EAsBd,SAAS1tE,EACfC,GACAimD,GACA0nB,GAAyB,GACxB,CAED,IAAInoC,GAEJ,GAAKmoC,GAAY,CAChB,MAAMC,GAAQ,MAAMpoC,GAAQ,KAAd,SACd,OAAKmoC,KAAc,EAEX,cAA8DjtE,GAAyB,CACxF8kC,IACJ,aAAaA,EAAK,EAClBA,GAAQ,WAAW,IAAM,CACxBA,GAAQ,KACRxlC,GAAG,MAAM,KAAMU,EAAI,CACpB,EAAGulD,EAAK,IAERjmD,GAAG,MAAM,KAAMU,EAAI,EACnB8kC,GAAQ,WAAWooC,GAAO3nB,EAAK,EAEjC,EAXO,qBAaD,YAA4CvlD,GAAyB,CACpE8kC,GAGN,aAAaA,EAAK,EAFlBxlC,GAAG,MAAM,KAAMU,EAAI,EAIpB8kC,GAAQ,WAAWooC,GAAO3nB,EAAK,CAChC,CACD,CAEA,OAAO,YAA4CvlD,GAAyB,CACtE8kC,IACJ,aAAaA,EAAK,EAEnBA,GAAQ,WAAWxlC,GAAG,KAAK,KAAM,GAAGU,EAAI,EAAGulD,EAAK,CACjD,CACD,CAzCgB,EAAAlmD,EAAA,YAgDT,SAAS8tE,EAAsE7tE,GAAW,CAChG,IAAI+xB,GAEJ,OAAO,cAAyDrxB,GAA2C,CAC1G,GAAKqxB,GACJ,OAAOA,GAER,GAAI,CACHA,GAAU,QAAQ,QAAiB/xB,GAAG,KAAK,KAAM,GAAGU,EAAI,CAAC,CAC1D,OAAQqb,GAAK,CACZ,OAAO,QAAQ,OAAOA,EAAG,CAC1B,CAEA,OAAOgW,GAAQ,QAAQ,IAAMA,GAAU,MAAS,CACjD,EAXO,eAYR,CAfgB,EAAA87C,EAAA,QAyBT,SAASC,EAAajiE,GAAkBC,GAAkB,CAChE,GAAK,CAAE,MAAM,QAAQD,EAAC,GAAK,CAAE,MAAM,QAAQC,EAAC,GAAKD,GAAE,SAAWC,GAAE,OAC/D,MAAO,GAER,IAAIkB,GAAInB,GAAE,OACV,KAAMmB,MACL,GAAKnB,GAAEmB,EAAC,IAAMlB,GAAEkB,EAAC,EAChB,MAAO,GAET,MAAO,EACR,CAVgB,EAAA8gE,EAAA,gBAyBT,SAASC,EACfzgD,GACAC,GACAygD,GAAmB,GACnBC,GACAC,GACC,CACD,GAAK5gD,KAAUC,GACd,MAAO,GAKR,GAJK,OAAOD,IAAU,OAAOC,IAExB,OAAOD,IAAU,UAEhBA,KAAU,OAAWC,KAAW,MACrC,MAAO,GAQR,GANO0gD,KACNA,GAAa,IAAI,KAEXC,KACNA,GAAc,IAAI,KAEdD,GAAW,IAAI3gD,EAAK,GAAK4gD,GAAY,IAAI3gD,EAAM,EACnD,MAAM,IAAI,MAAM,8BAA8B,EAE/C0gD,GAAW,IAAI3gD,EAAK,EACpB4gD,GAAY,IAAI3gD,EAAM,EAItB,MAAM4gD,GAAc,OAAO,KAAK7gD,EAAK,EACpC8gD,GAAY,OAAO,KAAK7gD,EAAM,EAE/B,GAAK,CAAEygD,IAAoB,CAAEK,EAAW,IAAI,IAAIF,EAAW,EAAG,IAAI,IAAIC,EAAS,CAAC,EAC/E,MAAO,GAER,UAAUnzE,MAAOkzE,GAChB,GAAK,CAAEJ,EAAYzgD,GAAMryB,EAAG,EAAGsyB,GAAOtyB,EAAG,EAAG+yE,GAAkB,IAAI,IAAIC,EAAU,EAAG,IAAI,IAAIC,EAAW,CAAC,EACtG,MAAO,GAET,GAAKF,IACJ,UAAU/yE,MAAOmzE,GAChB,GAAK,CAAED,GAAY,SAASlzE,EAAG,GACzB,CAAE8yE,EAAYzgD,GAAMryB,EAAG,EAAGsyB,GAAOtyB,EAAG,EAAG+yE,GAAkB,IAAI,IAAIC,EAAU,EAAG,IAAI,IAAIC,EAAW,CAAC,EACtG,MAAO,GAGX,MAAO,EACR,CAhDgB,EAAAH,EAAA,eAwDT,SAASO,EAAsBhhD,GAAYC,GAAa,CAC9D,GAAK,OAAOD,IAAU,UAAY,OAAOC,IAAW,SACnD,MAAO,GAER,MAAMrZ,GAAO,OAAO,KAAKoZ,EAAK,EAC9B,GAAK,CAAE+gD,EAAW,IAAI,IAAIn6D,EAAI,EAAG,IAAI,IAAI,OAAO,KAAKqZ,EAAM,CAAC,CAAC,EAC5D,MAAO,GAER,UAAUtyB,MAAOiZ,GAChB,GAAKoZ,GAAMryB,EAAG,IAAMsyB,GAAOtyB,EAAG,EAC7B,MAAO,GAET,MAAO,EACR,CAbgB,EAAAqzE,EAAA,yBAqBT,SAASC,EAAWjhD,GAAsBC,GAAuB,CACvE,GAAK,EAAED,cAAiB,MAAQ,EAAEC,cAAkB,MAAQD,GAAM,OAASC,GAAO,KACjF,MAAO,GAER,SAAU,CAACtyB,GAAKC,EAAG,IAAKoyB,GACvB,GAAK,CAAEC,GAAO,IAAItyB,EAAG,GAAKsyB,GAAO,IAAItyB,EAAG,IAAMC,GAC7C,MAAO,GAET,MAAO,EACR,CATgB,EAAAqzE,EAAA,cAiBT,SAASF,EAAW/gD,GAAiBC,GAAkB,CAC7D,GAAK,EAAED,cAAiB,MAAQ,EAAEC,cAAkB,MAAQD,GAAM,OAASC,GAAO,KACjF,MAAO,GAER,UAAUnU,MAAKkU,GACd,GAAK,CAAEC,GAAO,IAAInU,EAAC,EAClB,MAAO,GAET,MAAO,EACR,CATgB,EAAAi1D,EAAA,cA2DT,SAASG,EAAa5yD,GAAa6yD,GAAgB,CACzD,IAAIzhE,GAAI,EAAGwN,GAAM,EACjB,KAAOA,GAAMoB,GAAI,QAAS,CACzB,MAAM1Y,GAAI0Y,GAAI,QAAQ6yD,GAAQj0D,EAAG,EACjC,GAAKtX,KAAM,GACV,MAED8J,KACAwN,GAAMtX,GAAI,CACX,CAEA,OAAO8J,EACR,CAZgB,EAAAwhE,EAAA,gBAuBT,SAASE,EAA+FvsC,GAAaklC,GAAyB,CACpJ,IAAIsH,GAA8BxsC,GAClC,GAAK,OAAOwsC,IAAa,SAAW,CACnC,GAAKrC,EAAI,KAAKjF,GAAQsH,EAAQ,EAC7B,OAAQtH,GAAesH,EAAQ,EAEhCA,GAAWA,GAAS,MAAM,GAAG,CAC9B,CAEA,QAAQ3hE,GAAE,EAAGvP,GAAIkxE,GAAS,OAAQ3hE,GAAIvP,GAAGuP,KAAK,CAC7C,MAAMgoB,GAAO25C,GAAS3hE,EAAC,EACvB,GAAKgoB,KAAS,QAAU,CACvB,MAAM35B,GAAIszE,GAAS,MAAM3hE,GAAI,CAAC,EAC9B,GAAK3R,GAAE,OACN,GAAK,MAAM,QAAQgsE,EAAM,EACxBA,GAASA,GAAO,IAAInkE,IAAKwrE,EAAIrzE,GAAU6H,EAAC,CAAC,MACrC,CACJ,MAAM0rE,GAAkB,CAAC,EACzB,UAAU3zE,MAAOosE,GACXiF,EAAI,KAAKjF,GAAQpsE,EAAG,IACxB2zE,GAAW3zE,EAAG,EAAIyzE,EAAIrzE,GAAUgsE,GAAOpsE,EAAG,CAAC,GAC7CosE,GAASuH,EACV,CAGD,KAED,MAAY55C,KAAS,QACpBqyC,GAAUA,GAAgBA,GAAe,OAAS,CAAC,EAEnDA,GAAUA,GAAeryC,EAAI,EAE9B,GAAK,CAAEqyC,GACN,KACF,CAEA,OAAOA,EACR,CArCgB,EAAAqH,EAAA,OAkDT,SAASG,EAAgBxH,GAAWlF,GAAgB,EAAGlyC,GAAoB,CACjF,GAAKo3C,IAAU,KACd,OAAOA,GAER,GAAKA,cAAkB,SAAW,OAAOA,IAAW,WACnD,OAAO,KAER,GAAK,OAAOA,IAAW,SACtB,OAAOA,GAER,GAAKlF,KAAU,EACd,OAAO,KAOR,GALOlyC,KACNA,GAAO,IAAI,KAEZA,GAAK,IAAIo3C,EAAM,EAEV,MAAM,QAAQA,EAAM,EAAI,CAC5B,MAAMzrE,GAAM,CAAC,EACb,UAAUV,MAAOmsE,GACXp3C,GAAK,IAAI/0B,EAAG,GAGjBU,GAAI,KAAKizE,EAAa3zE,GAAKinE,GAAQ,EAAG,IAAI,IAAIlyC,EAAI,CAAC,CAAC,EAGrD,OAAOr0B,EACR,CAEA,MAAMA,GAAM,CAAC,EACb,SAAU,CAACX,GAAKC,EAAG,IAAK,OAAO,QAAQmsE,EAAM,EACvCp3C,GAAK,IAAI/0B,EAAG,IAGjBU,GAAIX,EAAG,EAAI4zE,EAAa3zE,GAAKinE,GAAQ,EAAG,IAAI,IAAIlyC,EAAI,CAAC,GAGtD,OAAOr0B,EACR,CAvCgB,EAAAizE,EAAA,gBAqDT,SAASC,EAAazH,GAAWp3C,GAAoB,CAC3D,GAAKo3C,KAAW,KACf,OAAO,QACEA,KAAW,OACpB,OAGD,GAAKA,cAAkB,QACtB,OAAO,IAAI,QAAQ,CAACnnE,GAASo8D,KAAS+K,GAAO,KAAKnnE,EAAO,EAAE,MAAMo8D,EAAI,CAAC,EAGvE,GAAK,OAAO+K,IAAW,WACtB,OAAO,YAAwC3mE,GAAa,CAAE,OAAO2mE,GAAO,MAAM,KAAM3mE,EAAI,CAAG,EAEhG,GAAK2mE,cAAkB,OACtB,OAAO,IAAI,OAAOA,GAAO,OAAQA,GAAO,KAAK,EAE9C,GAAKA,cAAkB,KACtB,OAAO,IAAI,KAAKA,EAAM,EAEvB,GAAK,OAAOA,IAAW,SACtB,OAAOA,GAKR,GAHOp3C,KACNA,GAAO,IAAI,KAEPA,GAAK,IAAIo3C,EAAM,EACnB,MAAM,IAAI,MAAM,8BAA8B,EAI/C,GAFAp3C,GAAK,IAAIo3C,EAAM,EAEV,MAAM,QAAQA,EAAM,EACxB,OAAOA,GAAO,IAAInkE,IAAK4rE,EAAU5rE,GAAG,IAAI,IAAI+sB,EAAI,CAAC,CAAC,EAEnD,GAAKo3C,cAAkB,IAAM,CAC5B,MAAMzrE,GAAM,IAAI,IAChB,UAAU4B,MAAQ6pE,GACZ,OAAO7pE,IAAS,SACpB5B,GAAI,IAAIkzE,EAAUtxE,EAAI,CAAC,EAEvB5B,GAAI,IAAI4B,EAAI,EAGd,OAAO5B,EACR,CAEA,GAAKyrE,cAAkB,IAAM,CAC5B,MAAMzrE,GAAM,IAAI,IAChB,SAAU,CAACX,GAAKC,EAAG,IAAKmsE,GAAO,QAAQ,EAAG,CACzC,IAAI36B,GAAI,OAAOzxC,IAAQ,SAAW6zE,EAAU7zE,EAAG,EAAIA,GAClDme,GAAI,OAAOle,IAAQ,SAAW4zE,EAAU5zE,EAAG,EAAIA,GAEhDU,GAAI,IAAI8wC,GAAGtzB,EAAC,CACb,CAEA,OAAOxd,EACR,CAEA,MAAMA,GAAW,CAAC,EAClB,SAAU,CAACX,GAAKC,EAAG,IAAK,OAAO,QAAQmsE,EAAM,EACvC,OAAOnsE,IAAQ,SACnBU,GAAIX,EAAG,EAAI6zE,EAAU5zE,GAAK,IAAI,IAAI+0B,EAAI,CAAC,EAEvCr0B,GAAIX,EAAG,EAAIC,GAGb,OAAOU,EACR,CAnEgB,EAAAkzE,EAAA,aA2ET,SAASC,EAA8BhiD,GAAe,CAC5D,OAAOA,GAAM,YAAY,EAAE,QAAQ,YAAa,GAAG,CACpD,CAFgB,EAAAgiD,EAAA,iCAWT,SAASC,EAAmBjiD,GAAe,CACjD,OAAAA,GAAQkiD,EAAaF,EAA8BhiD,EAAK,CAAC,EACzDA,GAAQA,GAAM,QAAQ,MAAO,QAAW,EAGxCA,GAAQA,GAAM,QAAQ,YAAa,oBAAoB,EAGvDA,GAAQA,GAAM,QAAQ,WAAY,iBAAiB,EAGnDA,GAAQA,GAAM,QAAQ,gBAAiB,uBAAuB,EAEvD,IAAI,OAAO,MAAQA,GAAQ,MAAO,GAAG,CAC7C,CAdgB,EAAAiiD,EAAA,sBA6BT,SAASE,EACfniD,GACAxS,MACG7Z,GACO,CACV,OAAK,OAAOqsB,IAAU,WAChBxS,GACIwS,GAAc,KAAKxS,GAAK,GAAG7Z,EAAI,EAChCqsB,GAAc,GAAGrsB,EAAI,EAGvBqsB,EACR,CAZgB,EAAAmiD,EAAA,cAehB,MAAMC,EAAc,mEAUb,SAASC,EAAYxzD,GAAa,CACxC,OAAKA,KAAQ,GACL,CAAC,EAEFA,GAAI,MAAMuzD,CAAW,CAC7B,CALgB,EAAAC,EAAA,eAcT,SAASC,EAAYp6D,GAAU,CACrC,GAAK,CAAEA,GACN,OAAO,KAER,GAAK,CAAE,MAAM,QAAQA,EAAG,EAAI,CAC3B,MAAMf,GAAO,OAAO,KAAKe,EAAG,EAC5B,OAAOA,GAAIo6D,EAAYn7D,EAAI,CAAC,CAC7B,CAEA,OAAOe,GAAI,KAAK,MAAM,KAAK,OAAO,EAAIA,GAAI,MAAM,CAAC,CAClD,CAVgB,EAAAo6D,EAAA,eAeT,MAAMJ,EAER,WAAsBrzD,GAAa,CACtC,OAAOA,GAAI,QAAQ,sBAAuB,MAAM,CACjD,EAFI,iBAKE,SAAS0zD,EAAkB1zD,GAAa,CAC9C,MAAO,SAAS,iBAAe,OAAOA,EAAG,SAAS,iBAAe,GAClE,CAFgB,EAAA0zD,EAAA,qBAKhB,MAAMC,EAAgB,aAOf,SAASC,GAAcziD,GAAe,CAC5C,GAAK,OAAOA,IAAU,SACrB,MAAM,IAAI,UAAU,wBAAwB,EAE7C,IAAIoE,GAAS,GACZs+C,GAAS,EAEV,QAAQziE,GAAE,EAAGvP,GAAEsvB,GAAM,OAAQ/f,GAAEvP,GAAGuP,KAAK,CACtC,MAAMlR,GAAOixB,GAAM/f,EAAC,EAEpB,GAAKuiE,EAAc,SAASzzE,EAAI,EAC/Bq1B,IAAU,KAAKr1B,EAAI,WAEVA,KAAS,KAAO,CACzBkR,KACA,MAAM1Q,GAAOywB,GAAM/f,EAAC,EACf1Q,KACCizE,EAAc,SAASjzE,EAAI,EAC/B60B,IAAU,KAAK70B,EAAI,GAEnB60B,IAAU70B,GAGb,SAAYR,KAAS,IACpBq1B,IAAU,YAEDr1B,KAAS,IAClBq1B,IAAUr1B,GACGixB,GAAM/f,GAAI,CAAC,IACV,MACbA,KACAmkB,IAAU,aAGAr1B,KAAS,IACpBq1B,IAAUr1B,WAEDA,KAAS,IAClBq1B,IAAU,MACVs+C,aAEW3zE,KAAS,IACf2zE,GAAS,IACbt+C,IAAU,IACVs+C,cAGU3zE,KAAS,KAAO2zE,GAAS,EACpCt+C,IAAU,YAEDr1B,KAAS,IAAM,CACxB,IAAI+xB,GAAQ,EACZ,KAAMd,GAAM/f,GAAE,CAAC,IAAM,KACpB6gB,KACA7gB,KAGI6gB,GAAQ,EACZsD,IAAU,MAEVA,IAAU,UAEZ,MACCA,IAAUr1B,EACZ,CAOA,OAAOq1B,EACR,CAxEgB,EAAAq+C,GAAA,iBAuFT,SAASE,EACf3iD,GACA7nB,GAAiB,IACjByqE,GAAkB,GAClBC,GAAmB,SACnBC,GAAsB,GACtBC,GAAgB,GACf,CACD,GAAK,CAAE/iD,IAAS,CAAEA,GAAM,OACvB,OAAOA,GAEH+iD,KACJ/iD,GAAQA,GAAM,KAAK,GAEpB,IAAIvS,GAAMq1D,GAAa9iD,GAAM,QAAQ;AAAA,CAAI,EAAI,GAI7C,IAHKvS,KAAQ,IAAMA,GAAMtV,MACxBsV,GAAMtV,IAEF6nB,GAAM,QAAUvS,GACpB,OAAOuS,GAER,IAAInxB,GAAMmxB,GAAM,MAAM,EAAGvS,EAAG,EAAE,QAAQ,EACtC,GAAKm1D,GAAU,GAAK/zE,GAAI,QAAU4e,GAAM,CACvC,IAAIu1D,GAAahjD,GAAM,MAAMvS,EAAG,EAAE,OAAO,KAAK,EAI9C,GAHKu1D,KAAe,IAAMJ,GAAUn1D,GAAMuS,GAAM,SAC/CgjD,GAAahjD,GAAM,OAASvS,IAExBu1D,KAAe,IAAMA,IAAcJ,GAAU,CACjD,GAAK5iD,GAAM,QAAWvS,GAAMu1D,GAC3B,OAAOhjD,GAERnxB,GAAMmxB,GAAM,MAAM,EAAGvS,GAAMu1D,EAAU,CACtC,CACD,CAEA,OAAOn0E,GAAMg0E,EACd,CApCgB,EAAAF,EAAA,YA6ChB,SAASM,EAAajjD,GAAe,CACpC,OAAOA,GAAM,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAC1C,CAFS,EAAAijD,EAAA,gBAUF,SAASC,GAAYv0E,GAAiB,GAAI,CAChD,MAAMw0E,GAAM,IAAI,WAAWx0E,GAAS,CAAC,EACrC,cAAO,OAAO,gBAAgBw0E,EAAG,EAC1B,MAAM,KAAKA,GAAKF,CAAY,EAAE,KAAK,EAAE,CAC7C,CAJgB,EAAAC,GAAA,eAwBT,MAAM,GAAN,MAAM,EAAc,CA0B1B,YAAYE,GAAU,GAAOC,GAA8B,CAC1D,KAAK,SAAWD,GAChB,KAAK,OAASA,GAAU,IAAI,IAAW,CAAC,EACxC,KAAK,cAAgBC,EACtB,CAGA,eAAgB,CACf,KAAK,gBAAkB,KAInB,KAAK,UAAY,KAAK,SAAS,KAAO,GACzC,KAAK,SAAS,CAChB,CAGA,gBAAgBpwE,GAAyB,CAGpC,KAAK,gBAAkBA,KAI3B,KAAK,cAAgBA,GAGrB,KAAK,cAAc,EACpB,CAGA,cAAe,CACd,GAAI,CAAC,KAAK,UAAY,KAAK,SAAS,OAAS,EAAG,CAC/C,KAAK,gBAAkB,CAAC,EACxB,MACD,CAEA,GAAI,KAAK,SAAS,OAAS,GAAK,CAAC,KAAK,cAAe,CACpD,KAAK,gBAAkB,CAAC,GAAG,KAAK,SAAS,OAAO,CAAC,EACjD,MACD,CAEA,MAAMy9D,GAAU,CAAC,GAAG,KAAK,UAAU,QAAQ,CAAC,EAC5CA,GAAQ,KAAK,CAAC5xD,GAAGC,KAAM,KAAK,cAAeD,GAAE,CAAC,EAAGC,GAAE,CAAC,CAAC,CAAC,EAEtD,KAAK,gBAAkB2xD,GAAQ,IAAIziD,IAASA,GAAM,CAAC,CAAC,CACrD,CAMA,UAAW,CACV,GAAK,CAAE,KAAK,SACX,OAED,MAAMm1D,GAAU,KAAK,SACpB1lC,GAAQ,KAAK,OAAS0lC,GAAU,IAAI,IAAY,CAAC,EAE7C,KAAK,iBACT,KAAK,aAAa,EAEnB,UAAUtsC,MAAS,KAAK,gBACvB,UAAU72B,MAAK62B,GACTssC,GACH1lC,GAAiB,IAAIz9B,EAAC,EACXy9B,GAAc,SAASz9B,EAAC,GACnCy9B,GAAc,KAAKz9B,EAAC,CACzB,CAGA,IAAIkZ,GAAgB,CAAE,OAAO,KAAK,UAAY,KAAK,SAAS,IAAIA,EAAM,CAAE,CAExE,IAAIA,GAAgB,CAAE,OAAO,KAAK,SAAW,KAAK,SAAS,IAAIA,EAAM,EAAI,EAAM,CAE/E,CAAC,gBAAiB,CACjB,GAAK,KAAK,SACT,UAAUlL,MAAS,KAAK,SACvB,MAAMA,EACT,CAGA,eAAekL,GAAgBrf,GAAU,CACxC,MAAM8uB,GAAM,KAAK,UAAY,KAAK,SAAS,IAAIzP,EAAM,EACrD,OAAOyP,IAAOA,GAAI,SAAS9uB,EAAK,CACjC,CAGA,SAASA,GAAU,CAClB,OAAO,KAAK,SACR,KAAK,OAAkB,IAAIA,EAAK,EAChC,KAAK,OAAe,SAASA,EAAK,CACvC,CAGA,OAAOqf,GAAgB,CACjB,KAAK,UAAY,KAAK,SAAS,IAAIA,EAAM,IAC7C,KAAK,SAAS,OAAOA,EAAM,EAC3B,KAAK,gBAAkB,KACvB,KAAK,SAAS,EAEhB,CAGA,OAAOA,MAAmB2d,GAAY,CAC9B,KAAK,WACX,KAAK,SAAW,IAAI,KAErB,MAAMvjC,GAAW,KAAK,SAAS,IAAI4lB,EAAM,EACzC,GAAK5lB,GAGJ,UAAU9C,MAAQqmC,GACXvjC,GAAS,SAAS9C,EAAI,GAC3B8C,GAAS,KAAK9C,EAAI,OAMpB,KAAK,SAAS,IAAI0oB,GAAQ2d,EAAK,EAC/B,KAAK,gBAAkB,KASxB,GAJqB,KAAK,eAAiB,MAAQ,KAAK,SAAS,KAAO,EAKvE,KAAK,SAAS,MACV,CACJ,MAAMssC,GAAU,KAAK,SACpB1lC,GAAQ,KAAK,OAEd,UAAUz9B,MAAK62B,GACTssC,GACH1lC,GAAiB,IAAIz9B,EAAC,EACXy9B,GAAc,SAASz9B,EAAC,GACnCy9B,GAAc,KAAKz9B,EAAC,CAExB,CACD,CAMA,IAAIkZ,GAAgB2d,GAAgB,CAKnC,GAJO,MAAM,QAAQA,EAAK,IACzBA,GAAQ,CAACA,EAAK,GAGV,CAAEA,GAAM,OACZ,OAAO,KAAK,OAAO3d,EAAM,EAEnB,KAAK,WACX,KAAK,SAAW,IAAI,KAErB,MAAM5lB,GAAW,KAAK,SAAS,IAAI4lB,EAAM,EACzC,KAAK,SAAS,IAAIA,GAAQ2d,EAAK,EAC/B,KAAK,gBAAkB,KAIvB,MAAMwsC,GAAe,KAAK,eAAiB,MAAQ,KAAK,SAAS,KAAO,EAKxE,GAAK/vE,IAAY+vE,GAChB,KAAK,SAAS,MACV,CACJ,MAAMF,GAAU,KAAK,SACpB1lC,GAAQ,KAAK,OAEd,UAAUz9B,MAAK62B,GACTssC,GACH1lC,GAAiB,IAAIz9B,EAAC,EACXy9B,GAAc,SAASz9B,EAAC,GACnCy9B,GAAc,KAAKz9B,EAAC,CAExB,CACD,CAGA,KAAKkZ,GAAgB1oB,GAAS,CAC7B,GAAK,CAAE,KAAK,SACX,OAAO,KAAK,IAAI0oB,GAAQ1oB,EAAI,EAE7B,MAAM8C,GAAW,KAAK,SAAS,IAAI4lB,EAAM,EACzC,GAAO5lB,IAAU,QACY,GAEnBA,GAAS,SAAS9C,EAAI,EAC/B,WAHA,QAAO,KAAK,IAAI0oB,GAAQ1oB,EAAI,EAK7B8C,GAAS,KAAK9C,EAAI,EAIG,KAAK,eAAiB,MAAQ,KAAK,SAAS,KAAO,EAGvE,KAAK,SAAS,EACL,KAAK,SACb,KAAK,OAAkB,IAAIA,EAAI,EACpB,KAAK,OAAe,SAASA,EAAI,GAC5C,KAAK,OAAe,KAAKA,EAAI,CAChC,CAGA,OAAO0oB,GAAgB1oB,GAAS,CAC/B,GAAK,CAAE,KAAK,UAAY,CAAE,KAAK,SAAS,IAAI0oB,EAAM,EACjD,OAED,MAAM5lB,GAAW,KAAK,SAAS,IAAI4lB,EAAM,EACxC1L,GAAMla,GAAWA,GAAS,QAAQ9C,EAAI,EAAI,GAEtCgd,KAAQ,KAGZla,GAAiB,OAAOka,GAAK,CAAC,EAG/B,KAAK,SAAS,EACf,CACD,EA9P2B,mBAApB,IAAM81D,GAAN,GAsQA,SAASC,GAAiBxjD,GAAe,CAC/C,MAAMyjD,GAAM,KAAKzjD,EAAK,EACrBnlB,GAAM4oE,GAAI,OACV1qB,GAAS,IAAI,YAAYl+C,EAAG,EAC5B6oE,GAAO,IAAI,WAAW3qB,EAAM,EAE7B,QAAQ94C,GAAI,EAAGpF,GAAM4oE,GAAI,OAAQxjE,GAAIpF,GAAKoF,KACzCyjE,GAAKzjE,EAAC,EAAIwjE,GAAI,WAAWxjE,EAAC,EAE3B,OAAO84C,EACR,CAVgB,EAAAyqB,GAAA,oBAahB,MAAMG,GAAa,4BAClBC,GAAa,0BAgBP,SAASC,GAAaC,GAAa9rC,GAAmB,CAAC,QAAQ,EAAG,CACxE,MAAM+rC,GAAcJ,GAAW,KAAKG,EAAG,EACtCE,GAAYJ,GAAW,KAAKE,EAAG,EAEhC,GAAK,CAAEC,IAAe,CAAEC,IAAaD,GAAY,CAAC,IAAMC,GAAU,CAAC,EAClE,MAAM,IAAI,MAAM,aAAa,EAE9B,MAAMC,GAAa,eAAe,KAAKF,GAAY,CAAC,CAAC,EACpDj1E,GAAQi1E,GAAY,MAAQA,GAAY,CAAC,EAAE,OAC3CprE,GAAMqrE,GAAU,MAEX9xD,GAAU4xD,GAAI,MAAMh1E,GAAO6J,EAAG,EAAE,QAAQ,MAAO,EAAE,EAAE,KAAK,EAGxDogD,GAASyqB,GAAiBtxD,EAAO,EAEvC,OAAO,OAAO,OAAO,UACpB+xD,GAAa,QAAU,OACvBlrB,GACA,CACC,KAAM,UACN,KAAM,SACP,EACA,GACA/gB,EACD,CACD,CA1BgB,EAAA6rC,GAAA,gBAqCT,SAASl3D,GACfC,GACAs3D,GACAC,GAAwB,KACvB,CACD,OAAO,MAAMv3D,GAAKs3D,EAAI,EACpB,KAAKv1D,IAAQA,GAAK,GAAKA,GAAK,KAAK,EAAkB,IAAI,EACvD,MAAM,IAAMw1D,EAAW,CAC1B,CARgB,EAAAx3D,GAAA,Y,iDC77CT,SAASy3D,EAAMhvC,EAAc,CACnC,OAAOivC,EAAS,CACf,KAAAjvC,EACA,EAAG,CACJ,CAAC,CACF,CALgB,EAAAgvC,EAAA,SAmBhB,SAASC,EAAS72D,EAAmB,CACpC,MAAM4nB,EAAO5nB,EAAI,KAChB7e,EAASymC,EAAK,OACdvmC,EAAM,CAAC,EAER,IAAIqhB,EAAyB,KAC5B8N,EAAqB,KAElBsmD,EAAU,GACbC,EAAW,GAEZ,KAAQ/2D,EAAI,EAAI7e,GAAS,CACxB,MAAMG,EAAQ0e,EAAI,EACjBze,EAAOqmC,EAAKtmC,CAAK,EACjBS,EAAO6lC,EAAKtmC,EAAQ,CAAC,EAStB,GAPOohB,IACNA,EAAQ,CAAC,GAEH8N,IACNA,EAAM,IAGFjvB,IAAS,KAAOQ,IAAS,IAAK,CAClCie,EAAI,IACJ,MAAM5d,EAAM40E,EAAUh3D,CAAG,EACpB5d,GACJ,OAAO,OAAOsgB,EAAOtgB,CAAG,EAEzB,QACD,CAGA,MAAM6nC,EAAM1oC,IAAS,KAAOQ,IAAS,IACpC2lC,EAAOnmC,IAAS,KAAOQ,IAAS,IAGjC,GAAK,EAFM,CAAE2lC,GAAQnmC,IAAS,MAEZ,CAAEmmC,GAAQ,CAAEuC,EAAM,CACnCzZ,GAAOjvB,EACPye,EAAI,IACJ,QACD,EAIKiqB,GAAOvC,IACX1nB,EAAI,IAEL0C,EAAM,MAAQ8N,EAAI,KAAK,EACvB9N,EAAM,IAAMA,EAAM,MAAM,YAAY,EAEpCA,EAAM,KAAOq0D,EACbr0D,EAAM,IAAMo0D,EAEZC,EAAWrvC,EACXovC,EAAU7sC,EAEV5oC,EAAI,KAAKqhB,CAAK,EACdA,EAAQ8N,EAAM,KACdxQ,EAAI,GACL,CAEA,OAAK0C,GAAS8N,IACb9N,EAAM,MAAQ8N,EAAI,KAAK,EACvB9N,EAAM,IAAMA,EAAM,MAAM,YAAY,EACpCA,EAAM,KAAOq0D,EACbr0D,EAAM,IAAMo0D,EACZz1E,EAAI,KAAKqhB,CAAK,GAGRrhB,CACR,CAvES,EAAAw1E,EAAA,YAyET,SAASG,EAAUh3D,EAAmB,CACrC,MAAM4nB,EAAO5nB,EAAI,KAChB7e,EAASymC,EAAK,OAEdtmC,EAAQ0e,EAAI,EAEbA,EAAI,IAEJ,MAAMuB,EAAQ,CAAC,GAAG,EAClB,IAAI01D,EAA2B,GAE/B,KAAQj3D,EAAI,EAAI7e,GAAUogB,EAAM,QAAS,CACxC,MAAMjgB,EAAQ0e,EAAI,EACjBze,EAAOqmC,EAAKtmC,CAAK,EAElB,GAAK21E,EAAS,CACb,GAAK11E,IAAS,KAAO,CACpBye,EAAI,IACJ,QACD,EAEMze,IAAS,KAAOA,IAAS,MAAQA,IAAS01E,IAC/C11D,EAAM,IAAI,EACV01D,EAAS,GAGX,KAAO,CASN,IARK11E,IAAS,KAAOA,IAAS,OAC7B01E,EAAS11E,EACTggB,EAAM,KAAKhgB,CAAI,IAGXA,IAAS,KAAOA,IAAS,MAC7BggB,EAAM,KAAKhgB,CAAI,EAEXA,IAAS,KACRggB,EAAM,IAAI,IAAM,IACpB,MAAM,IAAI,YAAY,cAAc,EAGtC,GAAKhgB,IAAS,KACRggB,EAAM,IAAI,IAAM,IACpB,MAAM,IAAI,YAAY,cAAc,CAEvC,CAEAvB,EAAI,GACL,CAEA,OAAO,KAAK,MAAM4nB,EAAK,MAAMtmC,EAAO0e,EAAI,CAAC,CAAC,CAC3C,CAlDS,EAAAg3D,EAAA,Y,yJC7FF,SAASE,EAAUC,EAAqB,EAAG,CACjD,MAAMh3D,EAAM,KAAK,MAAM,KAAK,IAAI,EAAI,GAAI,EACxC,OAAOA,EAAOA,EAAMg3D,CACrB,CAHgB,EAAAD,EAAA,aAKT,SAASE,EACf9kB,EACA+kB,EACAC,EACAC,EACAC,EACC,CACD,MAAMC,EAAUnlB,EAAU,GAC1B,IAAIoL,EAAU,KAAK,MAAMpL,EAAU,EAAE,EACpCmL,EAAQ,KAAK,MAAMC,EAAU,EAAE,EAC/Bga,EAAO,GAIR,GAFAha,EAAUA,EAAU,GAEf2Z,EAAgB,CACpB,MAAMM,EAAY,KAAK,MAAMla,EAAQ,EAAE,EAEvC,GADAA,EAAQA,EAAQ,GACX6Z,GAAaK,EAAY,EAC7B,MAAO,GAAGD,CAAI,QAEfA,EAAOC,EAAY,EAAI,GAAGA,CAAS,UAAY,EAChD,CAEA,MAAMC,EAAcL,IAAa,IAASG,GAAM,OAAS,GAAKja,EAAQ,EAEtE,MAAO,GAAGia,CAAI,GACbE,EAAa,GAAGF,GAAQja,EAAQ,GAAK,IAAM,EAAE,GAAGA,CAAK,IAAM,EAC5D,GAAGma,GAAcla,EAAU,GAAK,IAAM,EAAE,GAAGA,CAAO,GACjD8Z,EAAa,GAAK,IAAIC,EAAU,GAAK,IAAM,EAAE,GAAGA,CAAO,EAAE,EAC3D,CA7BgB,EAAAL,EAAA,sBAgCT,SAASS,EAAeJ,EAAiB,CAC/C,IAAI/Z,EAAU,KAAK,MAAM+Z,EAAU,EAAE,EACrC,MAAMha,EAAQ,KAAK,MAAMC,EAAU,EAAE,EAErC,OAAAA,GAAW,GACX+Z,GAAW,GAEJ,GAAGha,EAAQ,EAAI,GAAGA,CAAK,IAAIC,EAAU,GAAK,IAAM,EAAE,GAAK,EAAE,GAAGA,CAAO,IAAI+Z,EAAU,GAAK,IAAM,EAAE,GAAGA,CAAO,EAChH,CARgB,EAAAI,EAAA,kBAWT,SAASC,EAAgBxlB,EAAiB,CAChD,MAAMmlB,EAAUnlB,EAAU,GAC1B,IAAIoL,EAAU,KAAK,MAAMpL,EAAU,EAAE,EACjCmL,EAAQ,KAAK,MAAMC,EAAU,EAAE,EACnC,MAAMga,EAAO,KAAK,MAAMja,EAAQ,EAAE,EAElC,OAAAC,EAAUA,EAAU,GACpBD,EAAQA,EAAQ,GAET,GAAGia,EAAO,EAAI,GAAGA,CAAI,IAAM,EAAE,GAAGja,EAAQ,EAAI,GAAGA,CAAK,IAAM,EAAE,GAAGC,EAAU,EAAI,GAAGA,CAAO,IAAM,EAAE,GAAG+Z,EAAU,EAAI,GAAGA,CAAO,IAAM,EAAE,EAC1I,CAVgB,EAAAK,EAAA,mBAaT,SAASC,EAAezlB,EAAiB,CAC/C,MAAMmlB,EAAUnlB,EAAU,GAC1B,IAAIoL,EAAU,KAAK,MAAMpL,EAAU,EAAE,EACrC,MAAMmL,EAAQ,KAAK,MAAMC,EAAU,EAAE,EAErC,OAAAA,EAAUA,EAAU,GAEb,GAAGD,EAAQ,EAAI,GAAGA,CAAK,IAAM,EAAE,GAAGC,EAAU,EAAI,GAAGA,CAAO,IAAM,EAAE,GAAG+Z,EAAU,EAAI,GAAGA,CAAO,IAAM,EAAE,EAC7G,CARgB,EAAAM,EAAA,iB,kMClChB,IAAI/hC,EAAU,EAEP,MAAMgiC,EAAY,OAAO,WAAW,EAE9BC,EAAiB,CAC7B,KAAM,GACN,UAAW,EACX,UAAW,EAEX,KAAM,GAEN,aAAc,eACd,WAAY,sBACZ,WAAY,qBACb,EA2Fa,EAAN,MAAM,CAAQ,CAuBpB,YAAYh3E,EAAqCirC,EAA2CzrC,EAAkC,CAI7H,GAVD,iBAAuB,GACvB,gBAAsB,GAMhB,OAAOQ,GAAW,WACtBA,EAAS,SAAS,cAAcA,CAAM,GAEnC,EAAGA,aAAkB,aACxB,MAAM,IAAI,UAAU,gBAAgB,EAYrC,GAVA,KAAK,QAAU,OAAO,OAAO,CAAC,EAAGg3E,EAAgBx3E,CAAO,EACxD,KAAK,KAAO,KAAK,QAAQ,KAEzB,KAAK,OAASQ,EACd,KAAK,UAAY,KAAK,QAAQ,WAAa,KAAK,OAChD,KAAK,IAAMirC,EAEN,KAAK,QAAQ,iBACjB,KAAK,iBAAiB,EAEhB,KAAK,KAcX,KAAK,IAAMA,EACX,KAAK,SAAW,IAAI,QAfF,CAClB,IAAIgsC,EACJ,GAAK,OAAOhsC,GAAQ,SACnBgsC,EAAW,MAAM,KAAKj3E,EAAO,iBAAiBirC,CAAG,CAAC,UACzC,MAAM,QAAQA,CAAG,EAC1BgsC,EAAWhsC,UACFA,aAAe,YACxBgsC,EAAW,CAAChsC,CAAG,MAEf,OAAM,IAAI,UAAU,kBAAkB,EAEvC,KAAK,SAAW,IAAI,IAAIgsC,CAAQ,CAEjC,CAaA,GARA,KAAK,UAAY,gBAAgBliC,GAAS,GAE1C,KAAK,YAAch4B,GAAK,CACvB,MAAMrT,EAASqT,EAAE,OACjB,GAAKrT,GAAUA,EAAO,SAAS,YAAc,OAC5C,OAAO,KAAK,MAAMA,CAAM,CAC1B,EAEK,MAAK,QAAQ,OAGX,GAAK,KAAK,KAChB,KAAK,aAAeqT,GAAK,CACxB,KAAK,YAAYA,EAAE,SAAUA,EAAE,OAAO,EACtC,MAAMrT,EAASqT,EAAE,OACZrT,GAAUA,EAAO,WAAaA,EAAO,UAAU,SAAS,KAAK,GAAa,GAAKA,EAAO,SAAS,YAAc,QACjH,KAAK,OAAOA,CAAM,CAEpB,EAEA1J,EAAO,iBAAiB,YAAa,KAAK,YAAY,EACtDA,EAAO,iBAAiB,WAAY,KAAK,WAAW,UAGpD,KAAK,aAAe+c,GAAK,CACxB,KAAK,YAAYA,EAAE,SAAUA,EAAE,OAAO,EACtC,MAAMrT,EAASqT,EAAE,OACZ,KAAK,SAAS,IAAIrT,CAAM,GAAKA,EAAO,QAAQ,YAAc,QAC9D,KAAK,OAAOA,CAAM,CACpB,EAEK,KAAK,SAAS,MAAQ,EAC1B,UAAUw8B,KAAM,KAAK,SACpBA,EAAG,iBAAiB,aAAc,KAAK,YAAY,EACnDA,EAAG,iBAAiB,aAAc,KAAK,WAAW,OAInDlmC,EAAO,iBAAiB,YAAa,KAAK,YAAY,EACtDA,EAAO,iBAAiB,WAAY,KAAK,WAAW,CAIvD,CAEA,SAAU,CAGT,GAFA,KAAK,gBAAgB,EAEhB,MAAK,QAAQ,OAEX,GAAK,KAAK,MAAQ,KAAK,SAAS,KAAO,EACxC,KAAK,cACT,KAAK,OAAO,oBAAoB,YAAa,KAAK,YAAY,EAC/D,KAAK,OAAO,oBAAoB,WAAY,KAAK,WAAW,MAE5D,WAAUkmC,KAAM,KAAK,SACf,KAAK,cACTA,EAAG,oBAAoB,aAAc,KAAK,YAAY,EACvDA,EAAG,oBAAoB,aAAc,KAAK,WAAW,EAGvD,UAAUA,KAAM,KAAK,SAAU,CAC9B,MAAM5jB,EAAO4jB,EAAW,KAAK,SAAS,EACjC5jB,GAAOA,EAAI,SACf,KAAK,KAAKA,CAAG,EAEb4jB,EAAW,KAAK,SAAS,EAAI,KAC9BA,EAAG,aAAe,IACnB,CAGA,KAAK,SAAW,KAChB,KAAK,YAAc,KAAK,aAAe,KACvC,KAAK,UAAY,KACjB,KAAK,OAAS,IACf,CAGA,kBAAmB,CACb,KAAK,aAGV,KAAK,WAAanpB,GAAK,KAAK,YAAYA,EAAE,SAAUA,EAAE,OAAO,EAC7D,OAAO,iBAAiB,UAAW,KAAK,UAAU,EAClD,OAAO,iBAAiB,QAAS,KAAK,UAAU,EACjD,CAEA,iBAAkB,CACV,KAAK,aAGZ,OAAO,oBAAoB,UAAW,KAAK,UAAU,EACrD,OAAO,oBAAoB,QAAS,KAAK,UAAU,EACnD,KAAK,WAAa,KACnB,CAEA,YAAYlX,EAAgBqxE,EAAqB,CAC3CrxE,IAAU,KAAK,aAAeqxE,IAAe,KAAK,aAGvD,KAAK,YAAcrxE,EACnB,KAAK,WAAaqxE,EAEX,KAAK,YACX,KAAK,UAAY,sBAAsB,IAAM,CAE5C,GADA,KAAK,UAAY,KACZ,KAAK,SACT,UAAUhxC,KAAM,KAAK,SAAU,CAC9B,MAAM5jB,EAAO4jB,EAAW,KAAK,SAAS,EACjC5jB,GAAOA,EAAI,QACfA,EAAI,MAAM,QAAQ,MAAQ,GAAG,KAAK,WAAW,GAC7CA,EAAI,MAAM,QAAQ,KAAO,GAAG,KAAK,UAAU,GAC3CA,EAAI,OAAO,EAEb,CACF,CAAC,GACH,CAGA,SAAU,CACT,GAAK,OAAK,QAAQ,QAAU,CAAE,KAAK,UAGnC,UAAU4jB,KAAM,KAAK,SAAU,CAC9B,MAAM5jB,EAAO4jB,EAAW,KAAK,SAAS,EACjC,SAAS,KAAK,SAASA,CAAE,GAGzB5jB,GAAOA,EAAI,SACf,KAAK,KAAKA,CAAG,CACf,CACD,CAGA,OAAO5Y,EAAqB,CAC3B,IAAI4Y,EAAO5Y,EAAe,KAAK,SAAS,EAWxC,GAVO4Y,IACNA,EAAO5Y,EAAe,KAAK,SAAS,EAAI,CAAC,OAAAA,CAAM,GAEhD4Y,EAAI,MAAQ,GAEPA,EAAI,cACR,aAAaA,EAAI,WAAW,EAC5BA,EAAI,YAAc,MAGdA,EAAI,QACR,OAED,MAAMmoC,KAAQ,cAAW,KAAK,QAAQ,UAAW,KAAM/gD,EAAQ4Y,CAAG,EAE7DmoC,IAAU,EACd,KAAK,KAAKnoC,CAAG,EAGbA,EAAI,YAAc,WAAW,IAAM,CAClCA,EAAI,YAAc,KACbA,EAAI,OACR,KAAK,KAAKA,CAAG,CACf,EAAGmoC,CAAK,CACV,CAEA,MAAM/gD,EAAqB,CAC1B,MAAM4Y,EAAO5Y,EAAe,KAAK,SAAS,EAW1C,GAVK,CAAE4Y,IAGPA,EAAI,MAAQ,GAEPA,EAAI,cACR,aAAaA,EAAI,WAAW,EAC5BA,EAAI,YAAc,MAGd,CAAEA,EAAI,SACV,OAED,MAAMmoC,KAAQ,cAAW,KAAK,QAAQ,UAAW,KAAM/gD,EAAQ4Y,CAAG,EAE7DmoC,IAAU,EACd,KAAK,KAAKnoC,CAAG,EAGbA,EAAI,YAAc,WAAW,IAAM,CAClCA,EAAI,YAAc,KACXA,EAAI,OACV,KAAK,KAAKA,CAAG,CAEf,EAAGmoC,CAAK,CACV,CAGA,KAAKnoC,EAAsB,CAC1B,MAAMriB,EAAO,KAAK,QACjByJ,EAAS4Y,EAAI,OAEd,KAAK,SAAS,IAAI5Y,CAAM,EACxBA,EAAO,aAAe4Y,EAGtBA,EAAI,cAAgB,KACpBA,EAAI,WAAa,IACXA,EAAI,QACD,QAAQ,QAAQ,GACjBA,EAAI,gBACVA,EAAI,cAAgB,IAAI,QAAQ5d,GAAW4d,EAAI,QAAU5d,CAAO,GAC1D4d,EAAI,eAEZA,EAAI,OAAS,IAAMA,EAAI,QAAQ,EAC/BA,EAAI,KAAO,IAAM,CAChB,IAAIA,EAAO5Y,EAAe,KAAK,SAAS,EACjC4Y,IACNA,EAAO5Y,EAAe,KAAK,SAAS,EAAI,CAAC,OAAAA,CAAM,GAChD,KAAK,KAAK4Y,CAAG,CACd,EACAA,EAAI,KAAO,IAAM,KAAK,KAAKA,CAAG,EAC9BA,EAAI,SAAW,IAAM,CACfA,EAAI,UACRA,EAAI,KAAK,EACTA,EAAI,KAAK,EAEX,EAEA,IAAImB,KAAU,cAAWxjB,EAAK,QAAS,KAAMyJ,EAAQ4Y,CAAG,EAIxD,GAHKmB,IAAY,SAChBA,EAAUnB,EAAI,OAAO,OAEjBA,EAAI,SAAWmB,IAAYszD,GAAc,CAAEtzD,GAAW,CAAExjB,EAAK,OACjE,OAGD,MAAM4L,KAAQ,iBAAc,MAAO,CAClC,UAAW5L,EAAK,WAChB,UAAW,EACZ,CAAC,EACAk3E,EAAQ70D,EAAI,WAAU,iBAAc,MAAOriB,EAAK,UAAU,EAE1DimC,EAAK5jB,EAAI,SAAQ,iBAAc,MAAO,CACrC,UAAWriB,EAAK,aAChB,aAAc,KAAK,YACnB,YAAa,KAAK,UACnB,EAAG,CAACk3E,EAAOtrE,CAAK,CAAC,EAQlB,GANK5L,EAAK,YACT4L,EAAM,eAAY,iBAAc,MAAO5L,EAAK,UAAU,CAAC,EAEnDqiB,EAAI,OACR60D,EAAM,UAAU,IAAI,GAAGl3E,EAAK,UAAU,WAAWqiB,EAAI,KAAK,EAAE,EAExDA,EAAI,UAAY,CACpB,UAAU2oB,KAAO,MAAM,QAAQ3oB,EAAI,SAAS,EAAIA,EAAI,UAAY,CAACA,EAAI,SAAS,EAC7E60D,EAAM,UAAU,IAAIlsC,CAAG,EACxB3oB,EAAI,UAAY,MACjB,CAEA,MAAM80D,KAAc,cAAWn3E,EAAK,YAAa,KAAMyJ,EAAQ4Y,CAAG,EACjE+0D,KAAe,cAAWp3E,EAAK,aAAc,KAAMyJ,EAAQ4Y,CAAG,EAE/D4jB,EAAG,UAAU,OAAO,cAAekxC,GAAe,EAAK,GAElD,CAAEn3E,EAAK,QAAWo3E,IAAiBp3E,EAAK,SAAWA,EAAK,SAAWA,EAAK,WACvEo3E,GAAgBp3E,EAAK,QACzBimC,EAAG,iBAAiB,YAAaA,EAAG,kBAAoBrmB,GAAS,CAChE,KAAK,YAAYA,EAAM,SAAUA,EAAM,OAAO,EAC9C5f,EAAK,OAAOyJ,EAAQ4Y,EAAKzC,CAAK,CAC/B,CAAC,EAEFqmB,EAAG,iBAAiB,YAAaA,EAAG,kBAAoBrmB,GAAS,CAC3D,CAAE5f,EAAK,gBAAkB,CAAE,SAAS,SAASyJ,CAAM,GACvD,KAAK,KAAK4Y,CAAG,EAET+0D,GAAgBp3E,EAAK,SACzBA,EAAK,QAAQyJ,EAAQ4Y,EAAKzC,CAAK,EAE3B5f,EAAK,YAEE,cAAWA,EAAK,YAAa,KAAMyJ,EAAQ4Y,CAAG,EACzD,KAAK,OAAO5Y,CAAM,EACTA,EAAO,QAAQ,YAAc,QACtC,KAAK,MAAMA,CAAM,EACnB,CAAC,EAEDw8B,EAAG,iBAAiB,WAAYA,EAAG,iBAAmBrmB,GAAS,CACzDw3D,GAAgBp3E,EAAK,SACzBA,EAAK,QAAQyJ,EAAQ4Y,EAAKzC,CAAK,EAE3B,CAAE5f,EAAK,QAAUyJ,EAAO,QAAQ,YAAc,QAClD,KAAK,MAAMA,CAAM,CACnB,CAAC,GAKF,MAAM4tE,KAAW,cAAWr3E,EAAK,KAAM,KAAMyJ,EAAQ4Y,CAAG,EACvDi1D,EAASD,EAAW,YAAc,cAE7B5zE,EAAY,CACjB,KAAM,CACL,SAAU,CAAC,MAAO,SAAU,OAAQ,OAAO,CAC5C,EACA,OAAQ,CACP,OAAQ,CAAC,EAAG,EAAE,CACf,EACA,MAAO,CACN,QAASmI,CACV,CACD,EAEA,IAAI2rE,EAAW,OAAO,OAAO,CAC5B,UAAA9zE,CACD,EAAGzD,EAAK,MAAM,EAEdu3E,EAAS,UAAY,OAAO,OAAO9zE,EAAW8zE,EAAS,SAAS,EAE3Dv3E,EAAK,eACTu3E,EAAWv3E,EAAK,aAAayJ,EAAQ4Y,EAAKk1D,CAAQ,GAAKA,GAExDA,EAAS,YAAW,YAAS,IAAM,CAC7B,CAAEv3E,EAAK,gBAAkB,CAAE,SAAS,SAASqiB,EAAI,MAAM,GAC3D,KAAK,KAAKA,CAAG,CACf,EAAG,GAAG,EAEN,IAAIm1D,EAAqB/tE,EACpBzJ,EAAK,YACTw3E,EAAgBC,EAAchuE,CAAM,GAErC4Y,EAAI,QAAU,IAAM,CACdA,EAAI,QACRA,EAAI,OAAO,YAAY,CAEzB,EAEKA,EAAI,SACRA,EAAI,QAAQ,EAEbA,EAAI,QAAU,KACdA,EAAI,cAAgB,KAEfmB,aAAmB,SACvB0zD,EAAM,UAAY,4CAClB1zD,EAAQ,KAAKA,GAAW,CACvB,GAAK,CAAEA,EACN,OAAO,KAAK,KAAKnB,CAAG,EAEhBg1D,IAAa7zD,aAAmB,MAAQ,MAAM,QAAQA,CAAO,IACjE0zD,EAAM,UAAY,MAClB,eAAYA,EAAO1zD,EAASxjB,EAAK,gBAAgB,GAEjDk3E,EAAMI,CAAM,EAAI9zD,EAEjBnB,EAAI,QAAQ,CAEb,CAAC,EAAE,MAAM/B,GAAO,CACV,KAAK,QAAQ,QACjB,KAAK,QAAQ,OAAO,MAAM,mCAAoCA,CAAG,EAE7D,KAAK,QAAQ,KACjB42D,EAAM,YAAc,KAAK,QAAQ,KAAK,EAAE,uBAAwB;AAAA,OAAqD,CAAC,IAAA52D,CAAG,CAAC,EAE1H42D,EAAM,YAAc;AAAA,EAA+C52D,CAAG,GACvE+B,EAAI,QAAQ,CACb,CAAC,GAEUmB,IACN6zD,IAAa7zD,aAAmB,MAAQ,MAAM,QAAQA,CAAO,MACjE,eAAY0zD,EAAO1zD,EAASxjB,EAAK,gBAAgB,EAEjDk3E,EAAMI,CAAM,EAAI9zD,GAIlB+zD,EAAS,UAAYG,EAAmBH,EAAS,SAAS,EAG1Dl1D,EAAI,UAAS,MAAam1D,EAAevxC,EAAIsxC,CAAQ,EACrD,KAAK,UAAU,YAAYtxC,CAAE,EAC7B5jB,EAAI,QAAU,GAETriB,EAAK,QACTA,EAAK,OAAOyJ,EAAQ4Y,CAAG,CACzB,CAGA,KAAKA,EAAsB,CAC1B,MAAMriB,EAAO,KAAK,QASlB,GARKA,EAAK,QACTA,EAAK,OAAOqiB,EAAI,OAAQA,CAAG,EAEvBA,EAAI,SACRA,EAAI,OAAO,QAAQ,EACnBA,EAAI,OAAS,MAGTA,EAAI,MAAQ,CAChB,MAAM4jB,EAAK5jB,EAAI,MACV4jB,EAAG,mBACPA,EAAG,oBAAoB,YAAaA,EAAG,iBAAiB,EAEpDA,EAAG,kBACPA,EAAG,oBAAoB,WAAYA,EAAG,gBAAgB,EAElDA,EAAG,mBACPA,EAAG,oBAAoB,YAAaA,EAAG,iBAAiB,EAEzDA,EAAG,OAAO,EACV5jB,EAAI,MAAQ4jB,EAAG,iBAAmBA,EAAG,kBAAoB,IAC1D,CAEK,KAAK,MAAQ,KAAK,UACtB,KAAK,SAAS,OAAO5jB,EAAI,MAAM,EAE3BA,EAAI,OAAO,eAAiBA,IAChCA,EAAI,OAAO,aAAe,MAE1BA,EAAI,OAAe,KAAK,SAAS,EAAI,KACtCA,EAAI,QAAUA,EAAI,SAAWA,EAAI,OAASs1D,EAC1Ct1D,EAAI,QAAU,KACdA,EAAI,QAAU,EACf,CACD,EA7dqB,eAAd,IAAMu1D,EAAN,EA+dP,QAAeA,EAMR,SAASF,EAAmBpmD,EAAY,CAC9C,MAAMoE,EAAgB,CAAC,EAEvB,SAAU,CAACl2B,EAAKC,CAAG,IAAK,OAAO,QAAQ6xB,CAAK,EAAG,CAC9C,MAAM5R,EAAa,CAClB,KAAMlgB,CACP,EAEA,GAAIC,GAAO,OAAOA,GAAQ,UAAY,CAAE,MAAM,QAAQA,CAAG,EAAG,IACvD,OAAIA,EAAK,SAAS,IACrBigB,EAAM,QAAWjgB,EAAY,SAE9B,MAAMgZ,EAAO,OAAO,KAAKhZ,CAAG,GACxBgZ,EAAK,OAAS,GAAMA,EAAK,SAAW,GAAKA,EAAK,CAAC,IAAM,aACxDiH,EAAM,QAAUjgB,EAClB,CAEAi2B,EAAO,KAAKhW,CAAK,CAClB,CAEA,OAAOgW,CACR,CArBgB,EAAAgiD,EAAA,sBAwBT,SAASD,EAAchwE,EAAyBC,EAAYE,EAAiB,EAAGD,EAAgB,EAAG,CACzG,IAAIkwE,EAEJ,GAAKpwE,aAAa,YAAc,CAC/B,MAAMlF,EAAOkF,EAAE,sBAAsB,EACrCowE,EAAKt1E,EAAK,EACVmF,EAAInF,EAAK,EACTqF,EAASrF,EAAK,OACdoF,EAAQpF,EAAK,KACd,MACCs1E,EAAKpwE,EAiBN,MAfY,CACX,sBAAuB,KAAO,CAC7B,IAAKC,EACL,OAASA,EAAeE,EACxB,EAAAF,EACA,KAAMmwE,EACN,MAAOA,EAAKlwE,EACZ,EAAAF,EACA,OAAAG,EACA,MAAAD,CACD,GACA,YAAaA,EACb,aAAcC,CACf,CAGD,CA5BgB,EAAA6vE,EAAA,iBAgChB,SAASE,GAAO,CAAE,CAAT,EAAAA,EAAA,O,8PCppBT,WAAa,GAAY,EAEzB,MAAMG,EAAyB,CAC9B,UAAW,GACX,aAAc,EACf,EASaC,EAA+C,CAC3D,SAASt4E,EAAK,CACb,MAAO,GAAGA,CAAG,EACd,EAEA,OAAOA,EAAK0C,EAAMkd,EAAQlf,EAAKue,EAAKtL,EAAM,CACzC,MAAM4kE,EAAU71E,EAAK,IAAMA,EAAK,EAAE1C,CAAG,GAAK0C,EAAK,EAAE,OACjD,GAAO61E,EAGP,OAAO,KAAK,YAAYA,EAAS5kE,EAAMiM,CAAM,CAC9C,EAEA,OAAO5f,EAAK0C,EAAMkd,EAAQlf,EAAKue,EAAKtL,EAAM,CACzC,MAAM4kE,EAAU71E,EAAK,IAAMA,EAAK,EAAE,IAAI1C,CAAG,EAAE,GAAK0C,EAAK,EAAE81E,EAAgB54D,EAAQ5f,CAAG,CAAC,GAAK0C,EAAK,EAAE,OAC/F,GAAO61E,EAGP,OAAO,KAAK,YAAYA,EAAS5kE,EAAMiM,CAAM,CAC9C,EAEA,cAAc5f,EAAK0C,EAAMkd,EAAQlf,EAAKue,EAAKtL,EAAM,CAChD,MAAM4kE,EAAU71E,EAAK,IAAMA,EAAK,EAAE,IAAI1C,CAAG,EAAE,GAAK0C,EAAK,EAAE+1E,EAAe74D,EAAQ5f,CAAG,CAAC,GAAK0C,EAAK,EAAE,OAC9F,GAAO61E,EAGP,OAAO,KAAK,YAAYA,EAAS5kE,EAAMiM,CAAM,CAC9C,EAEA,OAAO5f,EAAK0C,EAAM,CACjB,GAAK,OAAO1C,GAAQ,SAAW,CAC9B,IAAI04E,EAAU,WAAW14E,CAAG,EAG5B,IAFK,MAAM04E,CAAO,GAAK,CAAE,SAASA,CAAO,KACxCA,EAAU,SAAS14E,EAAK,EAAE,GACtB,MAAM04E,CAAO,GAAK,CAAE,SAASA,CAAO,EACxC,OAAO14E,EAERA,EAAM04E,CACP,CAEA,OAAO,KAAK,aAAa14E,EAAK0C,EAAK,CAAW,CAC/C,EAEA,SAAS1C,EAAK0C,EAAM,CACnB,GAAK,OAAO1C,GAAQ,SAAW,CAC9B,IAAI04E,EAAU,WAAW14E,CAAG,EAG5B,IAFK,MAAM04E,CAAO,GAAK,CAAE,SAASA,CAAO,KACxCA,EAAU,SAAS14E,EAAK,EAAE,GACtB,MAAM04E,CAAO,GAAK,CAAE,SAASA,CAAO,EACxC,OAAO14E,EAERA,EAAM04E,CACP,CAEA,OAAO,KAAK,eAAe14E,EAAK0C,EAAK,CAAW,CACjD,EAEA,KAAK1C,EAAK0C,EAAM,CACf,OAAO,KAAK,WAAW1C,EAAK0C,EAAK,CAAW,CAC7C,EAEA,KAAK1C,EAAK0C,EAAM,CACf,OAAO,KAAK,WAAW1C,EAAK0C,EAAK,CAAW,CAC7C,EAEA,SAAS1C,EAAK0C,EAAM,CACnB,OAAO,KAAK,eAAe1C,EAAK0C,EAAK,CAAW,CACjD,EAEA,SAAS1C,EAAK,CACb,OAAO,KAAK,eAAeA,CAAG,CAC/B,EAEA,aAAaA,EAAK,CACjB,OAAO,KAAK,eAAeA,CAAG,CAC/B,EAEA,aAAaA,EAAK0C,EAAM,CACvB,OAAO,KAAK,mBAAmB1C,EAAK0C,EAAK,CAAW,CACrD,EAEA,UAAU1C,EAAK0C,EAAM,CACpB,OAAO,KAAK,mBAAmB1C,EAAK0C,EAAK,CAAW,CACrD,EAEA,UAAYwb,GAAcA,IAAM,EAAI,IAAM,EAC3C,EAKay6D,EAAkB,CAC9B,OAAQ,CACP,SAAU,CACT,MAAO,UACR,EACA,QAAS,CACR,MAAO,SACR,EACA,aAAc,CACb,MAAO,UACP,sBAAuB,CACxB,CACD,EAEA,KAAM,CACL,MAAO,CACN,MAAO,UACP,IAAK,UACL,KAAM,SACP,EAEA,QAAS,CAAC,EAEV,OAAQ,CACP,MAAO,QACP,IAAK,UACL,KAAM,SACP,EAEA,KAAM,CACL,MAAO,OACP,IAAK,UACL,KAAM,SACP,EAEA,KAAM,CACL,QAAS,OACT,MAAO,OACP,IAAK,UACL,KAAM,SACP,CACD,EAEA,KAAM,CACL,MAAO,CACN,KAAM,UACN,OAAQ,SACT,EAEA,OAAQ,CACP,KAAM,UACN,OAAQ,UACR,OAAQ,SACT,EAEA,KAAM,CACL,KAAM,UACN,OAAQ,UACR,OAAQ,UACR,aAAc,OACf,CACD,EAEA,SAAU,CACT,MAAO,CACN,MAAO,UACP,IAAK,UACL,KAAM,UACN,KAAM,UACN,OAAQ,SACT,EAEA,OAAQ,CAAC,EAET,KAAM,CACL,MAAO,OACP,IAAK,UACL,KAAM,UACN,KAAM,UACN,OAAQ,UACR,OAAQ,UACR,aAAc,OACf,EAEA,KAAM,CACL,QAAS,OACT,MAAO,OACP,IAAK,UACL,KAAM,UACN,KAAM,UACN,OAAQ,UACR,OAAQ,UACR,aAAc,OACf,CACD,CACD,EAoDa,EAAN,MAAM,CAAgB,CAwB5B,YAAY74E,EAAuC,CAoBlD,GAnBAA,EAAUA,GAAW,CAAC,EAEtB,KAAK,KAAOA,EAAQ,KACpB,KAAK,QAAUA,EAAQ,QAAU,KACjC,KAAK,cAAgBA,EAAQ,aAAe,KAC5C,KAAK,cAAgBA,EAAQ,eAAiB,KAAK,QACnD,KAAK,eAAiB,KAEtB,KAAK,kBAAoBA,EAAQ,mBAAqB,UACtD,KAAK,kBAAoBA,EAAQ,mBAAqB,QACtD,KAAK,sBAAwBA,EAAQ,uBAAyB,SAE9D,KAAK,QAAU,IAAI,IACnB,KAAK,MAAQ,IAAI,IAEjB,KAAK,cAAgB,IAAI,IACzB,KAAK,gBAAkB,IAAI,IAE3B,KAAK,QAAU,OAAO,OAAO,CAAC,EAAG64E,CAAe,EAC3C74E,EAAQ,QAAU,CAEtB,MAAMkZ,EAAO,OAAO,KAAKlZ,EAAQ,OAAO,EACxC,UAAUC,KAAOiZ,EACf,KAAK,QAAgBjZ,CAAG,EAAI,OAAO,OAAO,CAAC,EAAG,KAAK,QAAQA,CAAG,EAAGD,EAAQ,QAAQC,CAAG,CAAC,CACxF,CAEA,KAAK,MAAQ,OAAO,OAAO,CAAC,EAAGu4E,EAAex4E,EAAQ,OAAS,CAAC,CAAC,EACjE,KAAK,OAAS,IAAI,KAAO,OAAO,OAAO,CAAC,EAAGu4E,EAAwBv4E,EAAQ,aAAa,CAAC,EAEpFA,EAAQ,SACZ,KAAK,OAAOA,EAAQ,OAAO,CAC7B,CAEA,IAAI,QAAS,CACZ,OAAO,KAAK,OACb,CAEA,IAAI,OAAOE,EAAK,CACVA,IAAQ,KAAK,UACjB,KAAK,QAAUA,EACf,KAAK,cAAc,MAAM,EACzB,KAAK,gBAAgB,MAAM,EAE7B,CAEA,eAAeigB,EAAY,CAC1B,OAAKA,GAAO,eACJA,EAAM,eAAe,KAAK,OAAO,EAC/B,OAAOA,GAAU,SACnB,GAAGA,CAAK,GACTA,CACR,CAEA,mBAAmBtU,EAA+B3J,EAAiB,CAClE,MAAMob,EAAI,IAAMzR,CAAK,EACpBitE,EAAiB52E,IAAW,QAE7B,GAAI,CACH,OAAOob,EAAE,OAAO,KAAK,aAAa,EAAE,QAAQw7D,CAAc,CAC3D,MAAa,CACZ,OAAOx7D,EAAE,QAAQw7D,CAAc,CAChC,CACD,CAEA,eAAejtE,EAAwBktE,EAAkB,CACxD,IAAIp2D,EAAY,KAAK,gBAAgB,IAAIo2D,CAAQ,EACjD,OAAOp2D,IACNA,EAAY,IAAI,KAAK,aAAa,UAAU,UAAuB,CAClE,MAAO,WACP,SAAAo2D,CACD,CAAC,EAED,KAAK,gBAAgB,IAAIA,EAAUp2D,CAAS,GAGtCA,EAAU,OAAO9W,CAAK,CAC9B,CAEA,aAAaA,EAAwB3J,EAAgB,CACpD,IAAIygB,EAAY,KAAK,cAAc,IAAIzgB,CAAM,EAC7C,OAAOygB,IACD,KAAK,QAAQ,OAAOzgB,CAAM,EAC9BygB,EAAY,IAAI,KAAK,aAAa,KAAK,OAAQ,KAAK,QAAQ,OAAOzgB,CAAM,CAAC,EACjE,OAAOA,GAAW,SAC3BygB,EAAY,IAAI,KAAK,aAAa,KAAK,OAAQ,CAC9C,sBAAuBzgB,EACvB,sBAAuBA,CACxB,CAAC,EAEDygB,EAAY,IAAI,KAAK,aAAa,KAAK,MAAM,EAE9C,KAAK,cAAc,IAAIzgB,EAAQygB,CAAS,GAGlCA,EAAU,OAAO9W,CAAK,CAC9B,CAEA,eAAeA,EAAe,CAC7B,SAAO,sBAAmBA,CAAK,CAChC,CAEA,WAAWA,EAA+B3J,EAAiB,CAI1D,GAHOA,IACNA,EAAS,KAAK,mBAEVA,GAAU,CAAE,KAAK,QAAQ,KAAKA,CAAM,EAAI,CAC5C,MAAMob,EAAI,IAAMzR,CAAK,EACrB,GAAI,CACH,OAAOyR,EAAE,OAAO,KAAK,aAAa,EAAE,OAAOpb,CAAM,CAClD,MAAa,CACZ,OAAOob,EAAE,OAAOpb,CAAM,CACvB,CACD,CAEA,OAAO2J,aAAiB,OACvBA,EAAQ,IAAI,KAAKA,CAAK,GAEhBA,EAAM,mBAAmB,KAAK,QAAS,KAAK,QAAQ,KAAK3J,CAAM,GAAK,CAAC,CAAC,CAC9E,CAEA,WAAW2J,EAA+B3J,EAAiB,CAI1D,GAHOA,IACNA,EAAS,KAAK,mBAEVA,GAAU,CAAE,KAAK,QAAQ,KAAKA,CAAM,EAAI,CAC5C,MAAMob,EAAI,IAAMzR,CAAK,EACrB,GAAI,CACH,OAAOyR,EAAE,OAAO,KAAK,aAAa,EAAE,OAAOpb,CAAM,CAClD,MAAa,CACZ,OAAOob,EAAE,OAAOpb,CAAM,CACvB,CACD,CAEA,OAAO2J,aAAiB,OACvBA,EAAQ,IAAI,KAAKA,CAAK,GAEhBA,EAAM,mBAAmB,KAAK,QAAS,KAAK,QAAQ,KAAK3J,CAAM,GAAK,CAAC,CAAC,CAC9E,CAEA,eAAe2J,EAA+B3J,EAAiB,CAI9D,GAHOA,IACNA,EAAS,KAAK,uBAEVA,GAAU,CAAE,KAAK,QAAQ,SAASA,CAAM,EAAI,CAChD,MAAMob,EAAI,IAAMzR,CAAK,EACrB,GAAI,CACH,OAAOyR,EAAE,OAAO,KAAK,aAAa,EAAE,OAAOpb,CAAM,CAClD,MAAa,CACZ,OAAOob,EAAE,OAAOpb,CAAM,CACvB,CACD,CAEA,OAAO2J,aAAiB,OACvBA,EAAQ,IAAI,KAAKA,CAAK,GAEhBA,EAAM,eAAe,KAAK,QAAS,KAAK,QAAQ,SAAS3J,CAAM,GAAK,CAAC,CAAC,CAC9E,CAEA,OAAO+d,EAA6B4Y,EAAiB,CACpD,MAAM3Y,EAAkB,CAAC,EACzB,GAAK,CAAED,GAAW,OAAOA,GAAY,SACpC,OAAOC,EAER,UAAUjgB,KAAO,OAAO,KAAKggB,CAAO,EAAG,CACtC,MAAM+4D,EAAWngD,EAAS54B,IAAQ,IAAM44B,EAAS,GAAGA,CAAM,IAAI54B,CAAG,GAAKA,EACrEmgB,EAASH,EAAQhgB,CAAG,EAErB,GAAK,OAAOmgB,GAAW,SACtBF,EAAM,KAAK,GAAG,KAAK,OAAOE,EAAQ44D,CAAQ,CAAC,MACvC,CACJ,IAAI7jC,EACJ,GAAI,CACHA,EAAS,KAAK,OAAO,MAAM/0B,CAAM,CAClC,OAAQW,EAAK,CACP,KAAK,MACT,KAAK,KAAK,sCAAsCi4D,CAAQ,MAAM54D,CAAM,GAAIW,CAAG,EAE5E,QACD,CAEA,KAAK,QAAQ,IAAIi4D,EAAU54D,CAAM,EACjC,KAAK,MAAM,IAAI44D,EAAU7jC,CAAM,EAC/Bj1B,EAAM,KAAK84D,CAAQ,CACpB,CACD,CAEA,OAAO94D,CACR,CAEA,MAAMD,EAA4B4Y,EAAgB,CAC5C,OAAO5Y,GAAY,WACvBA,EAAU,CAACA,CAAO,GAEnB,MAAM/G,EAAO,MAAM,QAAQ+G,CAAO,EAAIA,EAAU,OAAO,KAAKA,CAAO,EACnE,UAAUhgB,KAAOiZ,EAAM,CACtB,MAAM8/D,EAAWngD,EAAS54B,IAAQ,IAAM44B,EAAS,GAAGA,CAAM,IAAI54B,CAAG,GAAKA,EAGjE,OAFMggB,EAAgBhgB,CAAG,GAEP,SACtB,KAAK,MAAMggB,EAAS+4D,CAAQ,GAE5B,KAAK,QAAQ,OAAOA,CAAQ,EAC5B,KAAK,MAAM,OAAOA,CAAQ,EAE5B,CACD,CAEA,IAAI/4E,EAAa,CAChB,OAAO,KAAK,QAAQ,IAAIA,CAAG,CAC5B,CAEA,IAAIA,EAAamgB,EAAgB,CAChC,MAAM+0B,EAAS,KAAK,OAAO,MAAM/0B,CAAM,EACvC,KAAK,QAAQ,IAAIngB,EAAKmgB,CAAM,EAC5B,KAAK,MAAM,IAAIngB,EAAKk1C,CAAM,CAC3B,CAEA,OAAQ,CACP,KAAK,QAAQ,MAAM,EACnB,KAAK,MAAM,MAAM,CAClB,CAEA,QAAQl1B,EAA6B,CACpC,KAAK,MAAM,EACX,KAAK,OAAOA,CAAO,CACpB,CAEA,cACChgB,EACAmgB,EACApgB,EACA+nB,EAAqC,CAAC,EACV,CAC5B,IAAI5I,EACHW,EACAjM,EAAO7T,GAAkB,CAAC,EAI3B,GAHK,OAAO6T,GAAS,WACpBA,EAAO,CAAC,MAAOA,CAAI,GAEf,CAAEkU,EAAS,SAAW,KAAK,QAAQ,IAAI9nB,CAAG,EAE9Ckf,EAAM,KAAK,MAAM,IAAIlf,CAAG,GAAK,CAAC,EAC9B6f,EAAS,KAAK,eAEH,CAAEiI,EAAS,SAAW,KAAK,MAAM,IAAI9nB,CAAG,EACnDkf,EAAM,KAAK,MAAM,IAAIlf,CAAG,GAAK,CAAC,EAC9B6f,EAAS,KAAK,kBAER,CACN,IAAIq1B,EAA4B,KAChC,GAAI,CACHA,EAAS,KAAK,OAAO,MAAM/0B,CAAM,CAClC,OAAQW,EAAK,CACZ,GAAKgH,EAAS,WACb,MAAMhH,EAEF,CAAEgH,EAAS,QAAU,KAAK,MAC9B,KAAK,KAAK,sCAAsC9nB,CAAG,MAAMmgB,CAAM,GAAIW,CAAG,EAEvE5B,EAAM,CAAC,eAAe,EACtBW,EAAS,KAAK,aACf,CAEKq1B,GACJh2B,EAAMg2B,EACNr1B,EAAS,KAAK,OAEPiI,EAAS,UACV,KAAK,SAAW,KAAK,eACzB,KAAK,QAAQ,IAAI9nB,EAAKmgB,CAAM,EAE7B,KAAK,MAAM,IAAIngB,EAAKk1C,CAAM,KAI3Bh2B,EAAM,CAAC,EACPW,EAAS,KAAK,cAEhB,CAEA,OAAK,KAAK,iBACTX,EAAM,KAAK,eAAelf,EAAKkf,CAAG,GAE5B,CAACA,EAAKtL,EAAMiM,CAAM,CAC1B,CAEA,EAAE7f,EAAamgB,EAAgBvM,EAAWkU,EAAqC,CAC9E,OAAOkxD,EAAa,KAAK,MAAMh5E,EAAKmgB,EAAQvM,EAAMkU,CAAQ,CAAC,CAC5D,CAEA,MAAM9nB,EAAamgB,EAAgBvM,EAAWkU,EAAqC,CAClF,OAAO,KAAK,YAAY,GAAG,KAAK,cAAc9nB,EAAKmgB,EAAQvM,EAAMkU,CAAQ,CAAC,CAC3E,CAEA,WACCnlB,EACAiR,EACAiM,EACAlf,EACAue,EACC,CACD,GAAK,CAAEvc,GAAQ,OAAOA,GAAS,SAC9B,OAAOA,EAEHkd,GAAU,OACdA,EAAS,KAAK,QAEf,MAAM5f,KAAM,OAAI0C,EAAK,EAAGiR,CAAI,EAC5B,GAAK3T,GAAO,KACX,OAAO,KAER,GAAK0C,EAAK,EAAI,CACb,MAAMgzC,EAAU,KAAK,MAAMhzC,EAAK,CAAC,EACjC,GAAKgzC,EACJ,OAAOA,EAAQ,KAAK,KAAM11C,EAAK0C,EAAyBkd,EAAQlf,EAAKue,EAAKtL,CAAI,EACrE,KAAK,MACd,KAAK,KAAK,6BAA8BjR,EAAyB,CAAC,yBAAyB,CAC7F,CAEA,OAAO1C,CACR,CAEA,YAAYif,EAAiBtL,EAAWiM,EAAgB,CACvD,MAAMlf,EAAM,CAAC,EAEb,UAAUgC,KAAQuc,EAAK,CACtB,MAAMjf,EAAM,KAAK,WAAW0C,EAAMiR,EAAMiM,EAAQlf,EAAKue,CAAG,EACpDjf,GAAO,MACVU,EAAI,KAAKV,CAAG,CACd,CAEA,OAAOU,CACR,CAED,EAvW6B,uBAAtB,IAAMs4E,EAAN,EAyWP,QAAeA,EAGf,SAASD,EAAa12E,EAAqB,CAC1C,OAAO,MAAM,QAAQA,CAAI,EAGlBA,EAAK,IAAI02E,CAAY,EAAE,KAAK,EAAE,EAF7B,GAAG12E,CAAI,EAGhB,CALS,EAAA02E,EAAA,gBAYT,IAAIE,EAAyC,KAC5CC,EAAiC,KAE3B,SAASV,EAAgB54D,EAAgBiS,EAAe,CAC9D,OAAK,CAAEonD,GAAiBr5D,IAAWs5D,KAClCD,EAAgB,IAAI,KAAK,YAAYr5D,EAAQ,CAC5C,KAAM,UACP,CAAC,EACDs5D,EAAkBt5D,GAGZq5D,EAAc,OAAOpnD,CAAK,CAClC,CATgB,EAAA2mD,EAAA,mBAWhB,IAAIW,EAAwC,KAC3CC,EAAgC,KAE1B,SAASX,EAAe74D,EAAgBiS,EAAe,CAC7D,OAAK,CAAEsnD,GAAgBv5D,IAAWw5D,KACjCD,EAAe,IAAI,KAAK,YAAYv5D,EAAQ,CAC3C,KAAM,SACP,CAAC,EACDw5D,EAAiBx5D,GAGXu5D,EAAa,OAAOtnD,CAAK,CACjC,CATgB,EAAA4mD,EAAA,iB,iFCrgBD,MAAM,EAAN,MAAM,UAAmB,SAAO,CAkB9C,YAAYl3E,EAAejB,EAAwB,CAClD,MAAMiB,EAAMjB,CAAM,EAjBnB,YAAiB,KACjB,UAAsB,KAkBrB,KAAK,KAAO,KAAK,OAEjB,KAAK,OAAO,aAAa,EAEzB,KAAK,kBAAoB,IAAI,IAC7B,KAAK,qBAAuB,IAAI,IAEhC,KAAK,oBAAsB,IAAI,IAC/B,KAAK,uBAAyB,IAAI,IAElC,KAAK,kBAAoB,IAAI,IAC7B,KAAK,qBAAuB,IAAI,IAIhC,KAAK,gBAAe,YAAS,KAAK,aAAc,EAAE,EAClD,KAAK,oBAAmB,YAAS,KAAK,iBAAkB,EAAE,EAC1D,KAAK,cAAa,YAAS,KAAK,WAAY,EAAE,CAC/C,CAEA,YACC01D,EACAqjB,EACAv5E,EACC,CACD,IAAImgB,EACJ,MAAK,CAAEo5D,GAAa,CAAEv5E,GAAW,UAAWk2D,GAASA,EAAM,MAC1D/1C,EAAQ+1C,GAER/1C,EAAQ,CACP,MAAA+1C,EACA,UAAAqjB,CACD,EAEKv5E,IACJmgB,EAAQ,OAAO,OAAOA,EAAOngB,CAAO,IAG/B,KAAK,OAAO,OAAO,MAAMmgB,CAAK,CACtC,CAEA,OACCq5D,EACAD,EACAv5E,EACC,CACD,IAAImgB,EACJ,MAAK,CAAEo5D,GAAa,CAAEv5E,GAAW,aAAcw5E,GAAYA,EAAS,SACnEr5D,EAAQq5D,GAERr5D,EAAQ,CACP,SAAAq5D,EACA,UAAAD,CACD,EAEKv5E,IACJmgB,EAAQ,OAAO,OAAOA,EAAOngB,CAAO,IAG/B,KAAK,OAAO,OAAO,OAAOmgB,CAAK,CACvC,CAEA,IAAI,cAAuB,CAC1B,MAAM6zB,EAAU,KAAK,KAAK,WAAW,EACrC,OAAOA,GAAWA,EAAQ,cAAgB,IAC3C,CAEA,IAAI,QAAiB,CACpB,MAAMA,EAAU,KAAK,KAAK,WAAW,EACrC,OAAOA,GAAWA,EAAQ,QAAU,OACrC,CAUA,MAAM,WAAY,CAOjB,OANa,MAAM,KAAK,YAGvB,MAAM,oCACP,IAEa,MAAM,MACpB,CAcA,MAAM,sBACLkiB,EACA5jC,EAAgB,GAChBuxB,EAAwB,KACvB,CACD,MAAMhwC,EAAO,MAAM,KAAK,YAGvB,MAAM,qCACN,CACC,MAAAqiD,EACA,MAAA5jC,EACA,OAAAuxB,CACD,CACD,EAEMhb,KAAQ,OAAI,yCAA0Ch1B,CAAI,GAAK,CAAC,EACrE4/D,EAASvd,EAAM,YAAY,EAE5B,OAAK,MAAM,QAAQrtB,CAAK,GACvBA,EAAM,KAAK,CAACh4B,EAAEC,IAAM,CACnB,MAAM2oE,EAAU5oE,IAAMA,EAAE,MAAM,cAAc,IAAM4iE,GAAU5iE,GAAG,aAAa,cAAc,IAAM4iE,GAC/FiG,EAAU7oE,IAAMC,EAAE,MAAM,cAAc,IAAM2iE,GAAU3iE,GAAG,aAAa,cAAc,IAAM2iE,GAE3F,OAAKgG,GAAW,CAAEC,EAAiB,GAC9B,CAAED,GAAWC,EAAiB,EAC5B,CACR,CAAC,EAEK,CACN,UAAQ,OAAI,2CAA4C7lE,CAAI,EAC5D,MAAAg1B,EACA,SAAU,IAAE,OAAI,6CAA8Ch1B,CAAI,EAClE,SAAO,OAAI,mCAAoCA,CAAI,GAAK,CACzD,CACD,CAQA,MAAM,YAAYhS,EAASJ,EAAsB,CAQhD,OAPa,MAAM,KAAK,YAGvB,MAAM,qCACN,CAAE,GAAAI,EAAI,KAAAJ,CAAK,CACZ,IAEa,MAAM,IACpB,CAaA,MAAM,kBACL+tC,EACAmqC,EACC,CACDnqC,EAAa,OAAOA,CAAU,EAE9B,MAAM37B,EAAO,MAAM,KAAK,OAIrB,CACF,SAAU,MAAM,oCAChB,UAAW,CACV,MAAO,CACN,UAAW27B,EACX,UAAWmqC,CACZ,CACD,CACD,CAAC,EAEKhqD,EAAO9b,GAAM,MAAM,mBAAmB,aAE5C,GAAK8b,IAAS,wBACb,MAAM,IAAI,oBACT,gDACA,mCACD,EAED,GAAKA,IAAS,sBACb,MAAM,IAAI,oBACT,2DACA,qCACA,OAAI,wCAAyC9b,CAAI,CAClD,EAED,GAAK8b,IAAS,UACb,MAAM,IAAI,oBACT,gDACA,uBACD,EAED,MAAO,EACR,CAcA,MAAM,iBAAiBumC,EAAe5jC,EAAQ,GAAIuxB,EAAwB,KAAM,CAC/E,MAAMhwC,EAAO,MAAM,KAAK,YAYvB,MAAM,oCACN,CACC,MAAAqiD,EACA,MAAA5jC,EACA,OAAAuxB,CACD,CACD,EAEMhb,KAAQ,OAAI,oCAAqCh1B,CAAI,GAAK,CAAC,EAChE4/D,EAASvd,EAAM,YAAY,EAE5B,OAAK,MAAM,QAAQrtB,CAAK,GACvBA,EAAM,KAAK,CAACh4B,EAAEC,IAAM,CACnB,MAAM2oE,EAAU5oE,IAAMA,EAAE,OAAO,cAAc,IAAM4iE,GAAU5iE,GAAG,aAAa,cAAc,IAAM4iE,GAChGiG,EAAU7oE,IAAMC,EAAE,OAAO,cAAc,IAAM2iE,GAAU3iE,GAAG,aAAa,cAAc,IAAM2iE,GAE5F,OAAKgG,GAAW,CAAEC,EAAiB,GAC9B,CAAED,GAAWC,EAAiB,EAC5B,CACR,CAAC,EAEK,CACN,UAAQ,OAAI,sCAAuC7lE,CAAI,EACvD,MAAAg1B,EACA,SAAU,IAAE,OAAI,wCAAyCh1B,CAAI,EAC7D,SAAO,OAAI,8BAA+BA,CAAI,GAAK,CACpD,CACD,CAQA,MAAM,QAAQhS,EAAS0zB,EAAe,CAQrC,OAPa,MAAM,KAAK,YAGvB,MAAM,oCACN,CAAE,GAAA1zB,EAAI,MAAA0zB,CAAM,CACb,IAEa,MAAM,IACpB,CAQA,MAAM,YAAY1zB,EAAS0zB,EAAe,CAYzC,OAXa,MAAM,KAAK,YAOvB,MAAM,qCACN,CAAE,GAAA1zB,EAAI,MAAA0zB,CAAM,CACb,IAEa,MAAM,MAAM,mBAAmB,IAC7C,CAQA,MAAM,YAAY1zB,EAAS0zB,EAAe,CAazC,OAZa,MAAM,KAAK,YAQvB,MAAM,qCACN,CAAE,GAAA1zB,EAAI,MAAA0zB,CAAM,CACb,IAEa,MAAM,MAAM,IAC1B,CAQA,MAAM,gBAAgB1zB,EAAS0zB,EAAe,CAY7C,OAXa,MAAM,KAAK,YAOvB,MAAM,qCACN,CAAE,GAAA1zB,EAAI,MAAA0zB,CAAM,CACb,IAEa,MAAM,MAAM,MAAM,QAChC,CAQA,MAAM,WAAWia,EAAgBoqC,EAAwB,GAAO,CAC/DpqC,EAAa,OAAOA,CAAU,EAC9BoqC,EAAwB,CAAC,CAAEA,EAE3B,MAAM/lE,EAAO,MAAM,KAAK,OAOrB,CACF,SAAU,MAAM,qCAChB,UAAW,CACV,MAAO,CACN,SAAU27B,EACV,qBAAsBoqC,CACvB,CACD,CACD,CAAC,EAED,QAAQ,IAAI,gBAAiB/lE,CAAI,EACjC,MAAMkN,EAAMlN,GAAM,MAAM,YAAY,MACpC,GAAKkN,GAAK,KACT,MAAM,IAAI,MAAMA,EAAI,IAAI,EAEzB,OAAOlN,GAAM,MAAM,YAAY,MAChC,CAOA,MAAM,aAAa27B,EAAgB,CAClCA,EAAa,OAAOA,CAAU,EAE9B,MAAM37B,EAAO,MAAM,KAAK,OAIrB,CACF,SAAU,MAAM,qCAChB,UAAW,CACV,MAAO,CACN,SAAU27B,CACX,CACD,CACD,CAAC,EAED,eAAQ,IAAI,kBAAmB37B,CAAI,EAC5BA,GAAM,MAAM,cAAc,MAClC,CASA,MAAM,iBAAiBhS,EAAS0zB,EAAe,CAuB9C,OAtBa,MAAM,KAAK,YAavB,MAAM,qCACN,CACC,GAAA1zB,EAAI,MAAA0zB,EACJ,KAAM,UACN,KAAM,OACN,MAAO,CACR,CACD,IAEa,MAAM,MAAM,QAAQ,QAAQ,CAAC,GAAG,IAC9C,CAUA,aAAa1zB,EAAS0zB,EAAe,CACpC,IAAI1U,EACAg5D,EACA55E,EAEJ,GAAK4B,EACJgf,EAAQ,KAAK,kBACb5gB,EAAM,OAAO4B,CAAE,UACJ0zB,EACX1U,EAAQ,KAAK,qBACb5gB,EAAMs1B,MAEN,QAAO,QAAQ,OAAO,kCAAkC,EAEzD,IAAIukD,EAASj5D,EAAM,IAAI5gB,CAAG,EAC1B,GAAI65E,EACH,OAAOA,EAAO,CAAC,EAEhB,IAAIz+C,EACH0+C,EAED,OAAAF,EAAS,IAAI,QAAgC,CAACh8D,EAAGY,IAAM,CACtD4c,EAAUxd,EACVk8D,EAAUt7D,CACX,CAAC,EAEDoC,EAAM,IAAI5gB,EAAK,CAAC45E,EAAQx+C,EAAU0+C,CAAQ,CAAC,EAEpC,KAAK,gBACX,KAAK,WAAW,EAEVF,CACR,CAEA,MAAM,YAAa,CAClB,GAAK,KAAK,eACT,OAED,KAAK,eAAiB,GAGtB,MAAMvwC,EAAM,CAAC,GAAG,KAAK,kBAAkB,KAAK,CAAC,EAAE,MAAM,EAAG,EAAE,EACzDwoB,EAAY,GAAKxoB,EAAI,OACrB0wC,EAASloB,EAAY,EAAI,CAAC,GAAG,KAAK,qBAAqB,KAAK,CAAC,EAAE,MAAM,EAAGA,CAAS,EAAI,CAAC,EAEvF,IAAIhO,EAEJ,GAAI,CAWHA,GAVa,MAAM,KAAK,YAErB,CACF,MAAO,MAAM,qCACb,UAAW,CACV,IAAKxa,EAAI,OAASA,EAAM,KACxB,OAAQ0wC,EAAO,OAASA,EAAS,IAClC,CACD,CAAC,IAEa,MAAM,OAAS,CAAC,CAE/B,OAAQj5D,EAAK,CACZ,UAAUlf,KAAMynC,EAAK,CACpB,MAAMwwC,EAAS,KAAK,kBAAkB,IAAIj4E,CAAE,EAC5C,KAAK,kBAAkB,OAAOA,CAAE,EAC5Bi4E,GACHA,EAAO,CAAC,EAAE/4D,CAAG,CACf,CAEA,UAAUwU,KAASykD,EAAQ,CAC1B,MAAMF,EAAS,KAAK,qBAAqB,IAAIvkD,CAAK,EAClD,KAAK,qBAAqB,OAAOA,CAAK,EAClCukD,GACHA,EAAO,CAAC,EAAE/4D,CAAG,CACf,CAEA,MACD,CAEA,MAAMk5D,EAAS,IAAI,IAAI3wC,CAAG,EACzB4wC,EAAY,IAAI,IAAIF,CAAM,EAE3B,GAAK,MAAM,QAAQl2B,CAAK,EACvB,UAAUlhD,KAAQkhD,EAAO,CACxB,GAAK,CAAElhD,GAAQ,CAAEA,EAAK,GACrB,SAEDq3E,EAAO,OAAOr3E,EAAK,EAAE,EACrBs3E,EAAU,OAAOt3E,EAAK,KAAK,EAE3B,IAAIk3E,EAAS,KAAK,kBAAkB,IAAIl3E,EAAK,EAAE,EAC1Ck3E,IACJ,KAAK,kBAAkB,OAAOl3E,EAAK,EAAE,EACrCk3E,EAAO,CAAC,EAAEl3E,CAAI,GAGfk3E,EAAS,KAAK,qBAAqB,IAAIl3E,EAAK,KAAK,EAC5Ck3E,IACJ,KAAK,qBAAqB,OAAOl3E,EAAK,KAAK,EAC3Ck3E,EAAO,CAAC,EAAEl3E,CAAI,EAEhB,CAED,UAAUf,KAAMo4E,EAAQ,CACvB,MAAMH,EAAS,KAAK,kBAAkB,IAAIj4E,CAAE,EACvCi4E,IACJ,KAAK,kBAAkB,OAAOj4E,CAAE,EAChCi4E,EAAO,CAAC,EAAE,IAAI,EAEhB,CAEA,UAAUvkD,KAAS2kD,EAAW,CAC7B,MAAMJ,EAAS,KAAK,qBAAqB,IAAIvkD,CAAK,EAC7CukD,IACJ,KAAK,qBAAqB,OAAOvkD,CAAK,EACtCukD,EAAO,CAAC,EAAE,IAAI,EAEhB,CAEA,KAAK,eAAiB,IAEjB,KAAK,kBAAkB,MAAQ,KAAK,qBAAqB,OAC7D,KAAK,WAAW,CAClB,CAaA,MAAM,eAAej4E,EAAS0zB,EAAe,CAE5C,OADa,MAAM,KAAK,iBAAiB1zB,EAAI0zB,CAAK,IACrC,EACd,CAGA,MAAM,gBAAgB1zB,EAAS0zB,EAAe,CAa7C,OAZa,MAAM,KAAK,YAIrB,CACF,MAAO,MAAM,qCACb,UAAW,CACV,GAAA1zB,EACA,MAAA0zB,CACD,CACD,CAAC,IAEY,MAAM,MAAM,eAC1B,CAoBA,MAAM,QAAQ4kD,EAAa,CAC1B,MAAMtmE,EAAO,MAAM,KAAK,YAAY,CACnC,MAAO,MAAM,qCACb,UAAW,CACV,GAAIsmE,CACL,CACD,CAAC,EAED,SAAO,OAAI,YAAatmE,CAAI,CAC7B,CAsBA,MAAM,WAAW27B,EAAYzvB,EAAOq6D,EAASp6E,EAAU,CAAC,EAAG,CAC1D,GAAK,OAAO+f,GAAU,SACrB,MAAM,IAAI,UAAU,sBAAsB,EAE3C,GAAK,CAAE,MAAM,QAAQq6D,CAAO,GAAKA,EAAQ,KAAKlyE,GAAK,OAAOA,GAAM,QAAQ,EACvE,MAAM,IAAI,UAAU,kCAAkC,EAEvD,IAAIqb,EAAOvjB,EAAQ,MAAQ,EAC1BovC,EAAWpvC,EAAQ,UAAY,IAC3B,OAAOujB,GAAS,UAAYA,EAAO,KACvCA,EAAO,IACH,OAAO6rB,GAAa,UAAYA,EAAW,KAC/CA,EAAW,IAEZ,MAAMv7B,EAAO,MAAM,KAAK,OAAO,CAC9B,SAAU,MAAM,qCAChB,UAAW,CACV,MAAO,CACN,SAAU0P,EACV,WAAYA,EAAO,EACnB,QAAS62D,EAAQ,IAAIlyE,IAAM,CAAC,MAAOA,CAAC,EAAE,EACtC,gBAAiBknC,EACjB,QAAS,GAAGI,CAAU,GACtB,qBAAsBxvC,EAAQ,sBAAwB,GACtD,eAAgBA,EAAQ,gBAAkB,GAC1C,MAAA+f,CACD,CACD,CACD,CAAC,EAED,SAAO,OAAI,uBAAwBlM,CAAI,CACxC,CAeA,MAAM,YAAYsmE,EAAS,CAC1B,MAAMtmE,EAAO,MAAM,KAAK,OAAO,CAC9B,SAAU,MAAM,qCAChB,UAAW,CACV,GAAIsmE,CACL,CACD,CAAC,EAED,SAAO,OAAI,wBAAyBtmE,CAAI,CACzC,CAeA,MAAM,cAAcsmE,EAAS,CAC5B,MAAMtmE,EAAO,MAAM,KAAK,OAAO,CAC9B,SAAU,MAAM,qCAChB,UAAW,CACV,GAAIsmE,CACL,CACD,CAAC,EAED,SAAO,OAAI,0BAA2BtmE,CAAI,CAC3C,CAaA,cAAchS,EAAS0zB,EAAe,CACrC,IAAI1U,EACAg5D,EACA55E,EAEJ,GAAK4B,EACJgf,EAAQ,KAAK,oBACb5gB,EAAM,OAAO4B,CAAE,UACJ0zB,EACX1U,EAAQ,KAAK,uBACb5gB,EAAMs1B,MAEN,QAAO,QAAQ,OAAO,kCAAkC,EAEzD,IAAIukD,EAASj5D,EAAM,IAAI5gB,CAAG,EAC1B,GAAI65E,EACH,OAAOA,EAAO,CAAC,EAEhB,IAAIz+C,EACH0+C,EAED,OAAAF,EAAS,IAAI,QAAsC,CAACh8D,EAAGY,IAAM,CAC5D4c,EAAUxd,EACVk8D,EAAUt7D,CACX,CAAC,EAEDoC,EAAM,IAAI5gB,EAAK,CAAC45E,EAAQx+C,EAAU0+C,CAAQ,CAAC,EAEpC,KAAK,kBACX,KAAK,aAAa,EAEZF,CACR,CAEA,MAAM,cAAe,CACpB,GAAK,KAAK,iBACT,OAED,KAAK,iBAAmB,GAGxB,MAAMvwC,EAAM,CAAC,GAAG,KAAK,oBAAoB,KAAK,CAAC,EAAE,MAAM,EAAG,EAAE,EAC3DwoB,EAAY,GAAKxoB,EAAI,OACrB0wC,EAASloB,EAAY,EAAI,CAAC,GAAG,KAAK,uBAAuB,KAAK,CAAC,EAAE,MAAM,EAAGA,CAAS,EAAI,CAAC,EAEzF,IAAIhO,EAMJ,GAAI,CAeHA,GAda,MAAM,KAAK,YAMrB,CACF,MAAO,MAAM,qCACb,UAAW,CACV,IAAKxa,EAAI,OAASA,EAAM,KACxB,OAAQ0wC,EAAO,OAASA,EAAS,IAClC,CACD,CAAC,IAEa,MAAM,KAErB,OAAQj5D,EAAK,CACZ,UAAUlf,KAAMynC,EAAK,CACpB,MAAMwwC,EAAS,KAAK,oBAAoB,IAAIj4E,CAAE,EAC9C,KAAK,oBAAoB,OAAOA,CAAE,EAC7Bi4E,GACJA,EAAO,CAAC,EAAE/4D,CAAG,CACf,CAEA,UAAUwU,KAASykD,EAAQ,CAC1B,MAAMF,EAAS,KAAK,uBAAuB,IAAIvkD,CAAK,EACpD,KAAK,uBAAuB,OAAOA,CAAK,EACnCukD,GACJA,EAAO,CAAC,EAAE/4D,CAAG,CACf,CAEA,MACD,CAEA,MAAMk5D,EAAS,IAAI,IAAI3wC,CAAG,EACzB4wC,EAAY,IAAI,IAAIF,CAAM,EAE3B,GAAK,MAAM,QAAQl2B,CAAK,EACvB,UAAUlhD,KAAQkhD,EAAO,CACxB,GAAK,CAAElhD,GAAQ,CAAEA,EAAK,GACrB,SAEDq3E,EAAO,OAAOr3E,EAAK,EAAE,EACrBs3E,EAAU,OAAOt3E,EAAK,KAAK,EAE3B,IAAIk3E,EAAS,KAAK,oBAAoB,IAAIl3E,EAAK,EAAE,EAC5Ck3E,IACJ,KAAK,oBAAoB,OAAOl3E,EAAK,EAAE,EACvCk3E,EAAO,CAAC,EAAEl3E,EAAK,MAAM,GAGtBk3E,EAAS,KAAK,uBAAuB,IAAIl3E,EAAK,KAAK,EAC9Ck3E,IACJ,KAAK,uBAAuB,OAAOl3E,EAAK,KAAK,EAC7Ck3E,EAAO,CAAC,EAAEl3E,EAAK,MAAM,EAEvB,CAED,UAAUf,KAAMo4E,EAAQ,CACvB,MAAMH,EAAS,KAAK,oBAAoB,IAAIj4E,CAAE,EACzCi4E,IACJ,KAAK,oBAAoB,OAAOj4E,CAAE,EAClCi4E,EAAO,CAAC,EAAE,IAAI,EAEhB,CAEA,UAAUvkD,KAAS2kD,EAAW,CAC7B,MAAMJ,EAAS,KAAK,uBAAuB,IAAIvkD,CAAK,EAC/CukD,IACJ,KAAK,uBAAuB,OAAOvkD,CAAK,EACxCukD,EAAO,CAAC,EAAE,IAAI,EAEhB,CAEA,KAAK,iBAAmB,IAEnB,KAAK,oBAAoB,MAAQ,KAAK,uBAAuB,OACjE,KAAK,aAAa,CACpB,CAaA,eAAej4E,EAAS0zB,EAAe,CACtC,IAAI1U,EACAg5D,EACA55E,EAEJ,GAAK4B,EACJgf,EAAQ,KAAK,kBACb5gB,EAAM,OAAO4B,CAAE,UACJ0zB,EACX1U,EAAQ,KAAK,qBACb5gB,EAAMs1B,MAEN,QAAO,QAAQ,OAAO,kCAAkC,EAEzD,IAAIukD,EAASj5D,EAAM,IAAI5gB,CAAG,EAC1B,GAAI65E,EACH,OAAOA,EAAO,CAAC,EAEhB,IAAIz+C,EACH0+C,EAED,OAAAF,EAAS,IAAI,QAAqC,CAACh8D,EAAGY,IAAM,CAC3D4c,EAAUxd,EACVk8D,EAAUt7D,CACX,CAAC,EAEDoC,EAAM,IAAI5gB,EAAK,CAAC45E,EAAQx+C,EAAU0+C,CAAQ,CAAC,EAEpC,KAAK,gBACX,KAAK,iBAAiB,EAEhBF,CACR,CAEA,MAAM,kBAAmB,CACxB,GAAK,KAAK,eACT,OAED,KAAK,eAAiB,GAGtB,MAAMvwC,EAAM,CAAC,GAAG,KAAK,kBAAkB,KAAK,CAAC,EAAE,MAAM,EAAG,EAAE,EACzDwoB,EAAY,GAAKxoB,EAAI,OACrB0wC,EAASloB,EAAY,EAAI,CAAC,GAAG,KAAK,qBAAqB,KAAK,CAAC,EAAE,MAAM,EAAGA,CAAS,EAAI,CAAC,EAEvF,IAAIhO,EAQJ,GAAI,CAWHA,GAVa,MAAM,KAAK,YAErB,CACF,MAAO,MAAM,oCACb,UAAW,CACV,IAAKxa,EAAI,OAASA,EAAM,KACxB,OAAQ0wC,EAAO,OAASA,EAAS,IAClC,CACD,CAAC,IAEa,MAAM,KAErB,OAAQj5D,EAAK,CACZ,UAAUlf,KAAMynC,EAAK,CACpB,MAAMwwC,EAAS,KAAK,kBAAkB,IAAIj4E,CAAE,EACvCi4E,IACJ,KAAK,kBAAkB,OAAOj4E,CAAE,EAChCi4E,EAAO,CAAC,EAAE/4D,CAAG,EAEf,CAEA,UAAUwU,KAASykD,EAAQ,CAC1B,MAAMF,EAAS,KAAK,qBAAqB,IAAIvkD,CAAK,EAC7CukD,IACJ,KAAK,qBAAqB,OAAOvkD,CAAK,EACtCukD,EAAO,CAAC,EAAE/4D,CAAG,EAEf,CAEA,MACD,CAEA,MAAMk5D,EAAS,IAAI,IAAI3wC,CAAG,EACzB4wC,EAAY,IAAI,IAAIF,CAAM,EAE3B,GAAK,MAAM,QAAQl2B,CAAK,EACvB,UAAUlhD,KAAQkhD,EAAO,CACxB,GAAK,CAAElhD,GAAQ,CAAEA,EAAK,GACrB,SAEDq3E,EAAO,OAAOr3E,EAAK,EAAE,EACrBs3E,EAAU,OAAOt3E,EAAK,KAAK,EAE3B,IAAIk3E,EAAS,KAAK,kBAAkB,IAAIl3E,EAAK,EAAE,EAC1Ck3E,IACJ,KAAK,kBAAkB,OAAOl3E,EAAK,EAAE,EACrCk3E,EAAO,CAAC,EAAEl3E,EAAK,QAAQ,6BAA+B,IAAI,GAG3Dk3E,EAAS,KAAK,qBAAqB,IAAIl3E,EAAK,KAAK,EAC5Ck3E,IACJ,KAAK,qBAAqB,OAAOl3E,EAAK,KAAK,EAC3Ck3E,EAAO,CAAC,EAAEl3E,EAAK,QAAQ,6BAA+B,IAAI,EAE5D,CAED,UAAUf,KAAMo4E,EAAQ,CACvB,MAAMH,EAAS,KAAK,kBAAkB,IAAIj4E,CAAE,EACvCi4E,IACJ,KAAK,kBAAkB,OAAOj4E,CAAE,EAChCi4E,EAAO,CAAC,EAAE,IAAI,EAEhB,CAEA,UAAUvkD,KAAS2kD,EAAW,CAC7B,MAAMJ,EAAS,KAAK,qBAAqB,IAAIvkD,CAAK,EAC7CukD,IACJ,KAAK,qBAAqB,OAAOvkD,CAAK,EACtCukD,EAAO,CAAC,EAAE,IAAI,EAEhB,CAEA,KAAK,eAAiB,IAEjB,KAAK,kBAAkB,MAAQ,KAAK,qBAAqB,OAC7D,KAAK,iBAAiB,CACxB,CAYA,MAAM,gBAAgB5jB,EAAe,CAiBpC,MAAMmkB,GAhBO,MAAM,KAAK,YAQrB,CACF,MAAO,MAAM,qCACb,UAAW,CACV,MAAAnkB,EACA,MAAO,GACR,CACD,CAAC,IAEmB,MAAM,oBAAoB,MAC9C,GAAK,CAAE,MAAM,QAAQmkB,CAAK,GAAK,CAAEA,EAAM,OACtC,MAAO,CAAC,EAET,MAAMz5E,EAAgB,CAAC,EACvB,UAAU05E,KAAQD,EAAO,CACxB,MAAM14E,EAAM24E,GAAM,MAAM,QACnB34E,GACJf,EAAI,KAAKe,CAAG,CACd,CAEA,OAAOf,CACR,CACD,EAzjC+C,kBAAhC,IAAM25E,EAAN,C,YC7IX,IAAInjC,EAAM,CAAC,KAAO,WAAW,YAAc,CAAC,CAAC,KAAO,sBAAsB,UAAY,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,iBAAiB,EAAE,oBAAsB,CAAC,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,CAAC,EAAE,KAAO,CAAC,KAAO,cAAc,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,SAAS,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,cAAc,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,MAAQ,CAAC,KAAO,WAAW,MAAQ,IAAI,CAAC,EAAE,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,MAAQ,CAAC,KAAO,WAAW,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,WAAW,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAM,CAAC,MAAQ,EAAE,IAAM,GAAG,CAAC,EAC73EA,EAAI,IAAI,OAAS,CAAC,KAAO,2LAA2L,KAAO,kBAAkB,eAAiB,CAAC,KAAO,EAAE,OAAS,CAAC,CAAC,EAGnR,IAAIvnB,EAAQ,CAAC,EACb,SAAS2qD,EAAOC,EAAM,CACpB,OAAOA,EAAK,OACV,SAASx3D,EAAK,CACZ,GAAIA,EAAI,OAAS,qBAAsB,MAAO,GAC9C,IAAIxhB,EAAOwhB,EAAI,KAAK,MACpB,OAAI4M,EAAMpuB,CAAI,EACL,IAEPouB,EAAMpuB,CAAI,EAAI,GACP,GAEX,CACF,CACF,CAbS,EAAA+4E,EAAA,UAiBT,SAASE,EAA0B93E,EAAM+3E,EAAM,CAC7C,GAAI/3E,EAAK,OAAS,iBAChB+3E,EAAK,IAAI/3E,EAAK,KAAK,KAAK,UACfA,EAAK,OAAS,qBAAsB,CAC7C,IAAId,EAAOc,EAAK,KACZd,EAAK,OAAS,aAChB64E,EAAK,IAAI74E,EAAK,KAAK,KAAK,CAE5B,CAEIc,EAAK,cACPA,EAAK,aAAa,WAAW,QAAQ,SAASgjD,EAAW,CACvD80B,EAA0B90B,EAAW+0B,CAAI,CAC3C,CAAC,EAGC/3E,EAAK,qBACPA,EAAK,oBAAoB,QAAQ,SAASqgB,EAAK,CAC7Cy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,EAGC/3E,EAAK,aACPA,EAAK,YAAY,QAAQ,SAASqgB,EAAK,CACrCy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,CAEL,CA3BS,EAAAD,EAAA,6BA6BT,IAAIE,EAAiB,CAAC,EACrB,YAA6B,CAC5BxjC,EAAI,YAAY,QAAQ,SAASn0B,EAAK,CACpC,GAAIA,EAAI,KAAM,CACZ,IAAI03D,EAAO,IAAI,IACfD,EAA0Bz3D,EAAK03D,CAAI,EACnCC,EAAe33D,EAAI,KAAK,KAAK,EAAI03D,CACnC,CACF,CAAC,CACH,EARC,qBAQE,EAEH,SAASE,EAAczjC,EAAK31C,EAAM,CAChC,QAASuQ,EAAI,EAAGA,EAAIolC,EAAI,YAAY,OAAQplC,IAAK,CAC/C,IAAIhR,EAAUo2C,EAAI,YAAYplC,CAAC,EAC/B,GAAIhR,EAAQ,MAAQA,EAAQ,KAAK,OAASS,EACxC,OAAOT,CAEX,CACF,CAPS,EAAA65E,EAAA,iBAST,SAASC,EAAS1jC,EAAK2jC,EAAe,CAEpC,IAAIC,EAAS,CACX,KAAM5jC,EAAI,KACV,YAAa,CAACyjC,EAAczjC,EAAK2jC,CAAa,CAAC,CACjD,EACI3jC,EAAI,eAAe,KAAK,IAC1B4jC,EAAO,IAAM5jC,EAAI,KAKnB,IAAI6jC,EAASL,EAAeG,CAAa,GAAK,IAAI,IAC9CG,EAAU,IAAI,IACdC,EAAU,IAAI,IAOlB,IAJAF,EAAO,QAAQ,SAASG,EAAS,CAC/BD,EAAQ,IAAIC,CAAO,CACrB,CAAC,EAEMD,EAAQ,KAAO,GAAG,CACvB,IAAIE,EAAWF,EACfA,EAAU,IAAI,IAEdE,EAAS,QAAQ,SAASD,EAAS,CACjC,GAAI,CAACF,EAAQ,IAAIE,CAAO,EAAG,CACzBF,EAAQ,IAAIE,CAAO,EACnB,IAAIE,EAAYV,EAAeQ,CAAO,GAAK,IAAI,IAC/CE,EAAU,QAAQ,SAASC,EAAU,CACnCJ,EAAQ,IAAII,CAAQ,CACtB,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAAL,EAAQ,QAAQ,SAASE,EAAS,CAChC,IAAII,EAAKX,EAAczjC,EAAKgkC,CAAO,EAC/BI,GACFR,EAAO,YAAY,KAAKQ,CAAE,CAE9B,CAAC,EAEMR,CACT,CA5CS,EAAAF,EAAA,YA8CT/6E,GAAO,QAAUq3C,EAEbr3C,GAAO,QAAP,gBAAoC+6E,EAAS1jC,EAAK,iBAAiB,C,aCvHvE,IAAIA,EAAM,CAAC,KAAO,WAAW,YAAc,CAAC,CAAC,KAAO,sBAAsB,UAAY,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,kBAAkB,EAAE,oBAAsB,CAAC,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,EAAE,KAAO,CAAC,KAAO,cAAc,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,qBAAqB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAM,CAAC,MAAQ,EAAE,IAAM,GAAG,CAAC,EACr+EA,EAAI,IAAI,OAAS,CAAC,KAAO,iLAAiL,KAAO,kBAAkB,eAAiB,CAAC,KAAO,EAAE,OAAS,CAAC,CAAC,EAGzQ,IAAIvnB,EAAQ,CAAC,EACb,SAAS2qD,EAAOC,EAAM,CACpB,OAAOA,EAAK,OACV,SAASx3D,EAAK,CACZ,GAAIA,EAAI,OAAS,qBAAsB,MAAO,GAC9C,IAAIxhB,EAAOwhB,EAAI,KAAK,MACpB,OAAI4M,EAAMpuB,CAAI,EACL,IAEPouB,EAAMpuB,CAAI,EAAI,GACP,GAEX,CACF,CACF,CAbS,EAAA+4E,EAAA,UAiBT,SAASE,EAA0B93E,EAAM+3E,EAAM,CAC7C,GAAI/3E,EAAK,OAAS,iBAChB+3E,EAAK,IAAI/3E,EAAK,KAAK,KAAK,UACfA,EAAK,OAAS,qBAAsB,CAC7C,IAAId,EAAOc,EAAK,KACZd,EAAK,OAAS,aAChB64E,EAAK,IAAI74E,EAAK,KAAK,KAAK,CAE5B,CAEIc,EAAK,cACPA,EAAK,aAAa,WAAW,QAAQ,SAASgjD,EAAW,CACvD80B,EAA0B90B,EAAW+0B,CAAI,CAC3C,CAAC,EAGC/3E,EAAK,qBACPA,EAAK,oBAAoB,QAAQ,SAASqgB,EAAK,CAC7Cy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,EAGC/3E,EAAK,aACPA,EAAK,YAAY,QAAQ,SAASqgB,EAAK,CACrCy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,CAEL,CA3BS,EAAAD,EAAA,6BA6BT,IAAIE,EAAiB,CAAC,EACrB,YAA6B,CAC5BxjC,EAAI,YAAY,QAAQ,SAASn0B,EAAK,CACpC,GAAIA,EAAI,KAAM,CACZ,IAAI03D,EAAO,IAAI,IACfD,EAA0Bz3D,EAAK03D,CAAI,EACnCC,EAAe33D,EAAI,KAAK,KAAK,EAAI03D,CACnC,CACF,CAAC,CACH,EARC,qBAQE,EAEH,SAASE,EAAczjC,EAAK31C,EAAM,CAChC,QAASuQ,EAAI,EAAGA,EAAIolC,EAAI,YAAY,OAAQplC,IAAK,CAC/C,IAAIhR,EAAUo2C,EAAI,YAAYplC,CAAC,EAC/B,GAAIhR,EAAQ,MAAQA,EAAQ,KAAK,OAASS,EACxC,OAAOT,CAEX,CACF,CAPS,EAAA65E,EAAA,iBAST,SAASC,EAAS1jC,EAAK2jC,EAAe,CAEpC,IAAIC,EAAS,CACX,KAAM5jC,EAAI,KACV,YAAa,CAACyjC,EAAczjC,EAAK2jC,CAAa,CAAC,CACjD,EACI3jC,EAAI,eAAe,KAAK,IAC1B4jC,EAAO,IAAM5jC,EAAI,KAKnB,IAAI6jC,EAASL,EAAeG,CAAa,GAAK,IAAI,IAC9CG,EAAU,IAAI,IACdC,EAAU,IAAI,IAOlB,IAJAF,EAAO,QAAQ,SAASG,EAAS,CAC/BD,EAAQ,IAAIC,CAAO,CACrB,CAAC,EAEMD,EAAQ,KAAO,GAAG,CACvB,IAAIE,EAAWF,EACfA,EAAU,IAAI,IAEdE,EAAS,QAAQ,SAASD,EAAS,CACjC,GAAI,CAACF,EAAQ,IAAIE,CAAO,EAAG,CACzBF,EAAQ,IAAIE,CAAO,EACnB,IAAIE,EAAYV,EAAeQ,CAAO,GAAK,IAAI,IAC/CE,EAAU,QAAQ,SAASC,EAAU,CACnCJ,EAAQ,IAAII,CAAQ,CACtB,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAAL,EAAQ,QAAQ,SAASE,EAAS,CAChC,IAAII,EAAKX,EAAczjC,EAAKgkC,CAAO,EAC/BI,GACFR,EAAO,YAAY,KAAKQ,CAAE,CAE9B,CAAC,EAEMR,CACT,CA5CS,EAAAF,EAAA,YA8CT/6E,GAAO,QAAUq3C,EAEbr3C,GAAO,QAAP,iBAAqC+6E,EAAS1jC,EAAK,kBAAkB,C,aCvHzE,IAAIA,EAAM,CAAC,KAAO,WAAW,YAAc,CAAC,CAAC,KAAO,sBAAsB,UAAY,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,qBAAqB,EAAE,oBAAsB,CAAC,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,EAAE,KAAO,CAAC,KAAO,cAAc,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,sBAAsB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,YAAY,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAM,CAAC,MAAQ,EAAE,IAAM,GAAG,CAAC,EAChnDA,EAAI,IAAI,OAAS,CAAC,KAAO,iIAAiI,KAAO,kBAAkB,eAAiB,CAAC,KAAO,EAAE,OAAS,CAAC,CAAC,EAGzN,IAAIvnB,EAAQ,CAAC,EACb,SAAS2qD,EAAOC,EAAM,CACpB,OAAOA,EAAK,OACV,SAASx3D,EAAK,CACZ,GAAIA,EAAI,OAAS,qBAAsB,MAAO,GAC9C,IAAIxhB,EAAOwhB,EAAI,KAAK,MACpB,OAAI4M,EAAMpuB,CAAI,EACL,IAEPouB,EAAMpuB,CAAI,EAAI,GACP,GAEX,CACF,CACF,CAbS,EAAA+4E,EAAA,UAiBT,SAASE,EAA0B93E,EAAM+3E,EAAM,CAC7C,GAAI/3E,EAAK,OAAS,iBAChB+3E,EAAK,IAAI/3E,EAAK,KAAK,KAAK,UACfA,EAAK,OAAS,qBAAsB,CAC7C,IAAId,EAAOc,EAAK,KACZd,EAAK,OAAS,aAChB64E,EAAK,IAAI74E,EAAK,KAAK,KAAK,CAE5B,CAEIc,EAAK,cACPA,EAAK,aAAa,WAAW,QAAQ,SAASgjD,EAAW,CACvD80B,EAA0B90B,EAAW+0B,CAAI,CAC3C,CAAC,EAGC/3E,EAAK,qBACPA,EAAK,oBAAoB,QAAQ,SAASqgB,EAAK,CAC7Cy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,EAGC/3E,EAAK,aACPA,EAAK,YAAY,QAAQ,SAASqgB,EAAK,CACrCy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,CAEL,CA3BS,EAAAD,EAAA,6BA6BT,IAAIE,EAAiB,CAAC,EACrB,YAA6B,CAC5BxjC,EAAI,YAAY,QAAQ,SAASn0B,EAAK,CACpC,GAAIA,EAAI,KAAM,CACZ,IAAI03D,EAAO,IAAI,IACfD,EAA0Bz3D,EAAK03D,CAAI,EACnCC,EAAe33D,EAAI,KAAK,KAAK,EAAI03D,CACnC,CACF,CAAC,CACH,EARC,qBAQE,EAEH,SAASE,EAAczjC,EAAK31C,EAAM,CAChC,QAASuQ,EAAI,EAAGA,EAAIolC,EAAI,YAAY,OAAQplC,IAAK,CAC/C,IAAIhR,EAAUo2C,EAAI,YAAYplC,CAAC,EAC/B,GAAIhR,EAAQ,MAAQA,EAAQ,KAAK,OAASS,EACxC,OAAOT,CAEX,CACF,CAPS,EAAA65E,EAAA,iBAST,SAASC,EAAS1jC,EAAK2jC,EAAe,CAEpC,IAAIC,EAAS,CACX,KAAM5jC,EAAI,KACV,YAAa,CAACyjC,EAAczjC,EAAK2jC,CAAa,CAAC,CACjD,EACI3jC,EAAI,eAAe,KAAK,IAC1B4jC,EAAO,IAAM5jC,EAAI,KAKnB,IAAI6jC,EAASL,EAAeG,CAAa,GAAK,IAAI,IAC9CG,EAAU,IAAI,IACdC,EAAU,IAAI,IAOlB,IAJAF,EAAO,QAAQ,SAASG,EAAS,CAC/BD,EAAQ,IAAIC,CAAO,CACrB,CAAC,EAEMD,EAAQ,KAAO,GAAG,CACvB,IAAIE,EAAWF,EACfA,EAAU,IAAI,IAEdE,EAAS,QAAQ,SAASD,EAAS,CACjC,GAAI,CAACF,EAAQ,IAAIE,CAAO,EAAG,CACzBF,EAAQ,IAAIE,CAAO,EACnB,IAAIE,EAAYV,EAAeQ,CAAO,GAAK,IAAI,IAC/CE,EAAU,QAAQ,SAASC,EAAU,CACnCJ,EAAQ,IAAII,CAAQ,CACtB,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAAL,EAAQ,QAAQ,SAASE,EAAS,CAChC,IAAII,EAAKX,EAAczjC,EAAKgkC,CAAO,EAC/BI,GACFR,EAAO,YAAY,KAAKQ,CAAE,CAE9B,CAAC,EAEMR,CACT,CA5CS,EAAAF,EAAA,YA8CT/6E,GAAO,QAAUq3C,EAEbr3C,GAAO,QAAP,oBAAwC+6E,EAAS1jC,EAAK,qBAAqB,C,aCvH/E,IAAIA,EAAM,CAAC,KAAO,WAAW,YAAc,CAAC,CAAC,KAAO,sBAAsB,UAAY,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,kBAAkB,EAAE,oBAAsB,CAAC,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,EAAE,KAAO,CAAC,KAAO,cAAc,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,qBAAqB,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,MAAQ,CAAC,KAAO,WAAW,MAAQ,KAAK,CAAC,EAAE,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,MAAQ,CAAC,KAAO,WAAW,MAAQ,KAAK,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,eAAe,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,WAAW,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,iBAAiB,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,MAAQ,CAAC,KAAO,WAAW,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAM,CAAC,MAAQ,EAAE,IAAM,GAAG,CAAC,EACr2EA,EAAI,IAAI,OAAS,CAAC,KAAO,kNAAkN,KAAO,kBAAkB,eAAiB,CAAC,KAAO,EAAE,OAAS,CAAC,CAAC,EAG1S,IAAIvnB,EAAQ,CAAC,EACb,SAAS2qD,EAAOC,EAAM,CACpB,OAAOA,EAAK,OACV,SAASx3D,EAAK,CACZ,GAAIA,EAAI,OAAS,qBAAsB,MAAO,GAC9C,IAAIxhB,EAAOwhB,EAAI,KAAK,MACpB,OAAI4M,EAAMpuB,CAAI,EACL,IAEPouB,EAAMpuB,CAAI,EAAI,GACP,GAEX,CACF,CACF,CAbS,EAAA+4E,EAAA,UAiBT,SAASE,EAA0B93E,EAAM+3E,EAAM,CAC7C,GAAI/3E,EAAK,OAAS,iBAChB+3E,EAAK,IAAI/3E,EAAK,KAAK,KAAK,UACfA,EAAK,OAAS,qBAAsB,CAC7C,IAAId,EAAOc,EAAK,KACZd,EAAK,OAAS,aAChB64E,EAAK,IAAI74E,EAAK,KAAK,KAAK,CAE5B,CAEIc,EAAK,cACPA,EAAK,aAAa,WAAW,QAAQ,SAASgjD,EAAW,CACvD80B,EAA0B90B,EAAW+0B,CAAI,CAC3C,CAAC,EAGC/3E,EAAK,qBACPA,EAAK,oBAAoB,QAAQ,SAASqgB,EAAK,CAC7Cy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,EAGC/3E,EAAK,aACPA,EAAK,YAAY,QAAQ,SAASqgB,EAAK,CACrCy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,CAEL,CA3BS,EAAAD,EAAA,6BA6BT,IAAIE,EAAiB,CAAC,EACrB,YAA6B,CAC5BxjC,EAAI,YAAY,QAAQ,SAASn0B,EAAK,CACpC,GAAIA,EAAI,KAAM,CACZ,IAAI03D,EAAO,IAAI,IACfD,EAA0Bz3D,EAAK03D,CAAI,EACnCC,EAAe33D,EAAI,KAAK,KAAK,EAAI03D,CACnC,CACF,CAAC,CACH,EARC,qBAQE,EAEH,SAASE,EAAczjC,EAAK31C,EAAM,CAChC,QAASuQ,EAAI,EAAGA,EAAIolC,EAAI,YAAY,OAAQplC,IAAK,CAC/C,IAAIhR,EAAUo2C,EAAI,YAAYplC,CAAC,EAC/B,GAAIhR,EAAQ,MAAQA,EAAQ,KAAK,OAASS,EACxC,OAAOT,CAEX,CACF,CAPS,EAAA65E,EAAA,iBAST,SAASC,EAAS1jC,EAAK2jC,EAAe,CAEpC,IAAIC,EAAS,CACX,KAAM5jC,EAAI,KACV,YAAa,CAACyjC,EAAczjC,EAAK2jC,CAAa,CAAC,CACjD,EACI3jC,EAAI,eAAe,KAAK,IAC1B4jC,EAAO,IAAM5jC,EAAI,KAKnB,IAAI6jC,EAASL,EAAeG,CAAa,GAAK,IAAI,IAC9CG,EAAU,IAAI,IACdC,EAAU,IAAI,IAOlB,IAJAF,EAAO,QAAQ,SAASG,EAAS,CAC/BD,EAAQ,IAAIC,CAAO,CACrB,CAAC,EAEMD,EAAQ,KAAO,GAAG,CACvB,IAAIE,EAAWF,EACfA,EAAU,IAAI,IAEdE,EAAS,QAAQ,SAASD,EAAS,CACjC,GAAI,CAACF,EAAQ,IAAIE,CAAO,EAAG,CACzBF,EAAQ,IAAIE,CAAO,EACnB,IAAIE,EAAYV,EAAeQ,CAAO,GAAK,IAAI,IAC/CE,EAAU,QAAQ,SAASC,EAAU,CACnCJ,EAAQ,IAAII,CAAQ,CACtB,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAAL,EAAQ,QAAQ,SAASE,EAAS,CAChC,IAAII,EAAKX,EAAczjC,EAAKgkC,CAAO,EAC/BI,GACFR,EAAO,YAAY,KAAKQ,CAAE,CAE9B,CAAC,EAEMR,CACT,CA5CS,EAAAF,EAAA,YA8CT/6E,GAAO,QAAUq3C,EAEbr3C,GAAO,QAAP,iBAAqC+6E,EAAS1jC,EAAK,kBAAkB,C,aCvHzE,IAAIA,EAAM,CAAC,KAAO,WAAW,YAAc,CAAC,CAAC,KAAO,sBAAsB,UAAY,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,eAAe,EAAE,oBAAsB,CAAC,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,SAAS,CAAC,EAAE,KAAO,CAAC,KAAO,cAAc,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,SAAS,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,SAAS,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,gBAAgB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,YAAY,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,qBAAqB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,sBAAsB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,KAAK,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,WAAW,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,sBAAsB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,WAAW,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,YAAY,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,yBAAyB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAM,CAAC,MAAQ,EAAE,IAAM,GAAG,CAAC,EAC9hLA,EAAI,IAAI,OAAS,CAAC,KAAO,qaAAqa,KAAO,kBAAkB,eAAiB,CAAC,KAAO,EAAE,OAAS,CAAC,CAAC,EAG7f,IAAIvnB,EAAQ,CAAC,EACb,SAAS2qD,EAAOC,EAAM,CACpB,OAAOA,EAAK,OACV,SAASx3D,EAAK,CACZ,GAAIA,EAAI,OAAS,qBAAsB,MAAO,GAC9C,IAAIxhB,EAAOwhB,EAAI,KAAK,MACpB,OAAI4M,EAAMpuB,CAAI,EACL,IAEPouB,EAAMpuB,CAAI,EAAI,GACP,GAEX,CACF,CACF,CAbS,EAAA+4E,EAAA,UAiBT,SAASE,EAA0B93E,EAAM+3E,EAAM,CAC7C,GAAI/3E,EAAK,OAAS,iBAChB+3E,EAAK,IAAI/3E,EAAK,KAAK,KAAK,UACfA,EAAK,OAAS,qBAAsB,CAC7C,IAAId,EAAOc,EAAK,KACZd,EAAK,OAAS,aAChB64E,EAAK,IAAI74E,EAAK,KAAK,KAAK,CAE5B,CAEIc,EAAK,cACPA,EAAK,aAAa,WAAW,QAAQ,SAASgjD,EAAW,CACvD80B,EAA0B90B,EAAW+0B,CAAI,CAC3C,CAAC,EAGC/3E,EAAK,qBACPA,EAAK,oBAAoB,QAAQ,SAASqgB,EAAK,CAC7Cy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,EAGC/3E,EAAK,aACPA,EAAK,YAAY,QAAQ,SAASqgB,EAAK,CACrCy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,CAEL,CA3BS,EAAAD,EAAA,6BA6BT,IAAIE,EAAiB,CAAC,EACrB,YAA6B,CAC5BxjC,EAAI,YAAY,QAAQ,SAASn0B,EAAK,CACpC,GAAIA,EAAI,KAAM,CACZ,IAAI03D,EAAO,IAAI,IACfD,EAA0Bz3D,EAAK03D,CAAI,EACnCC,EAAe33D,EAAI,KAAK,KAAK,EAAI03D,CACnC,CACF,CAAC,CACH,EARC,qBAQE,EAEH,SAASE,EAAczjC,EAAK31C,EAAM,CAChC,QAASuQ,EAAI,EAAGA,EAAIolC,EAAI,YAAY,OAAQplC,IAAK,CAC/C,IAAIhR,EAAUo2C,EAAI,YAAYplC,CAAC,EAC/B,GAAIhR,EAAQ,MAAQA,EAAQ,KAAK,OAASS,EACxC,OAAOT,CAEX,CACF,CAPS,EAAA65E,EAAA,iBAST,SAASC,EAAS1jC,EAAK2jC,EAAe,CAEpC,IAAIC,EAAS,CACX,KAAM5jC,EAAI,KACV,YAAa,CAACyjC,EAAczjC,EAAK2jC,CAAa,CAAC,CACjD,EACI3jC,EAAI,eAAe,KAAK,IAC1B4jC,EAAO,IAAM5jC,EAAI,KAKnB,IAAI6jC,EAASL,EAAeG,CAAa,GAAK,IAAI,IAC9CG,EAAU,IAAI,IACdC,EAAU,IAAI,IAOlB,IAJAF,EAAO,QAAQ,SAASG,EAAS,CAC/BD,EAAQ,IAAIC,CAAO,CACrB,CAAC,EAEMD,EAAQ,KAAO,GAAG,CACvB,IAAIE,EAAWF,EACfA,EAAU,IAAI,IAEdE,EAAS,QAAQ,SAASD,EAAS,CACjC,GAAI,CAACF,EAAQ,IAAIE,CAAO,EAAG,CACzBF,EAAQ,IAAIE,CAAO,EACnB,IAAIE,EAAYV,EAAeQ,CAAO,GAAK,IAAI,IAC/CE,EAAU,QAAQ,SAASC,EAAU,CACnCJ,EAAQ,IAAII,CAAQ,CACtB,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAAL,EAAQ,QAAQ,SAASE,EAAS,CAChC,IAAII,EAAKX,EAAczjC,EAAKgkC,CAAO,EAC/BI,GACFR,EAAO,YAAY,KAAKQ,CAAE,CAE9B,CAAC,EAEMR,CACT,CA5CS,EAAAF,EAAA,YA8CT/6E,GAAO,QAAUq3C,EAEbr3C,GAAO,QAAP,cAAkC+6E,EAAS1jC,EAAK,eAAe,C,aCvHnE,IAAIA,EAAM,CAAC,KAAO,WAAW,YAAc,CAAC,CAAC,KAAO,sBAAsB,UAAY,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,yBAAyB,EAAE,oBAAsB,CAAC,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,CAAC,EAAE,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,KAAK,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,CAAC,EAAE,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,qBAAqB,SAAW,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,CAAC,EAAE,KAAO,CAAC,KAAO,cAAc,KAAO,CAAC,KAAO,YAAY,KAAO,CAAC,KAAO,OAAO,MAAQ,kCAAkC,CAAC,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,sBAAsB,EAAE,UAAY,CAAC,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,CAAC,CAAC,EAAE,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,CAAC,CAAC,EAAE,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,EAAE,MAAQ,CAAC,KAAO,WAAW,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,CAAC,CAAC,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,aAAa,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,OAAO,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,MAAM,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,oBAAoB,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,QAAQ,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,UAAU,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,SAAS,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,EAAE,aAAe,CAAC,KAAO,eAAe,WAAa,CAAC,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,IAAI,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,EAAE,CAAC,KAAO,QAAQ,KAAO,CAAC,KAAO,OAAO,MAAQ,YAAY,EAAE,UAAY,CAAC,EAAE,WAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAM,CAAC,MAAQ,EAAE,IAAM,GAAG,CAAC,EAC/lGA,EAAI,IAAI,OAAS,CAAC,KAAO,2SAA2S,KAAO,kBAAkB,eAAiB,CAAC,KAAO,EAAE,OAAS,CAAC,CAAC,EAGnY,IAAIvnB,EAAQ,CAAC,EACb,SAAS2qD,EAAOC,EAAM,CACpB,OAAOA,EAAK,OACV,SAASx3D,EAAK,CACZ,GAAIA,EAAI,OAAS,qBAAsB,MAAO,GAC9C,IAAIxhB,EAAOwhB,EAAI,KAAK,MACpB,OAAI4M,EAAMpuB,CAAI,EACL,IAEPouB,EAAMpuB,CAAI,EAAI,GACP,GAEX,CACF,CACF,CAbS,EAAA+4E,EAAA,UAiBT,SAASE,EAA0B93E,EAAM+3E,EAAM,CAC7C,GAAI/3E,EAAK,OAAS,iBAChB+3E,EAAK,IAAI/3E,EAAK,KAAK,KAAK,UACfA,EAAK,OAAS,qBAAsB,CAC7C,IAAId,EAAOc,EAAK,KACZd,EAAK,OAAS,aAChB64E,EAAK,IAAI74E,EAAK,KAAK,KAAK,CAE5B,CAEIc,EAAK,cACPA,EAAK,aAAa,WAAW,QAAQ,SAASgjD,EAAW,CACvD80B,EAA0B90B,EAAW+0B,CAAI,CAC3C,CAAC,EAGC/3E,EAAK,qBACPA,EAAK,oBAAoB,QAAQ,SAASqgB,EAAK,CAC7Cy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,EAGC/3E,EAAK,aACPA,EAAK,YAAY,QAAQ,SAASqgB,EAAK,CACrCy3D,EAA0Bz3D,EAAK03D,CAAI,CACrC,CAAC,CAEL,CA3BS,EAAAD,EAAA,6BA6BT,IAAIE,EAAiB,CAAC,EACrB,YAA6B,CAC5BxjC,EAAI,YAAY,QAAQ,SAASn0B,EAAK,CACpC,GAAIA,EAAI,KAAM,CACZ,IAAI03D,EAAO,IAAI,IACfD,EAA0Bz3D,EAAK03D,CAAI,EACnCC,EAAe33D,EAAI,KAAK,KAAK,EAAI03D,CACnC,CACF,CAAC,CACH,EARC,qBAQE,EAEH,SAASE,EAAczjC,EAAK31C,EAAM,CAChC,QAASuQ,EAAI,EAAGA,EAAIolC,EAAI,YAAY,OAAQplC,IAAK,CAC/C,IAAIhR,EAAUo2C,EAAI,YAAYplC,CAAC,EAC/B,GAAIhR,EAAQ,MAAQA,EAAQ,KAAK,OAASS,EACxC,OAAOT,CAEX,CACF,CAPS,EAAA65E,EAAA,iBAST,SAASC,EAAS1jC,EAAK2jC,EAAe,CAEpC,IAAIC,EAAS,CACX,KAAM5jC,EAAI,KACV,YAAa,CAACyjC,EAAczjC,EAAK2jC,CAAa,CAAC,CACjD,EACI3jC,EAAI,eAAe,KAAK,IAC1B4jC,EAAO,IAAM5jC,EAAI,KAKnB,IAAI6jC,EAASL,EAAeG,CAAa,GAAK,IAAI,IAC9CG,EAAU,IAAI,IACdC,EAAU,IAAI,IAOlB,IAJAF,EAAO,QAAQ,SAASG,EAAS,CAC/BD,EAAQ,IAAIC,CAAO,CACrB,CAAC,EAEMD,EAAQ,KAAO,GAAG,CACvB,IAAIE,EAAWF,EACfA,EAAU,IAAI,IAEdE,EAAS,QAAQ,SAASD,EAAS,CACjC,GAAI,CAACF,EAAQ,IAAIE,CAAO,EAAG,CACzBF,EAAQ,IAAIE,CAAO,EACnB,IAAIE,EAAYV,EAAeQ,CAAO,GAAK,IAAI,IAC/CE,EAAU,QAAQ,SAASC,EAAU,CACnCJ,EAAQ,IAAII,CAAQ,CACtB,CAAC,CACH,CACF,CAAC,CACH,CAEA,OAAAL,EAAQ,QAAQ,SAASE,EAAS,CAChC,IAAII,EAAKX,EAAczjC,EAAKgkC,CAAO,EAC/BI,GACFR,EAAO,YAAY,KAAKQ,CAAE,CAE9B,CAAC,EAEMR,CACT,CA5CS,EAAAF,EAAA,YA8CT/6E,GAAO,QAAUq3C,EAEbr3C,GAAO,QAAP,wBAA4C+6E,EAAS1jC,EAAK,yBAAyB,C,kBCvG3F,IAAIqkC,EAAW,EAAQ,EAAsB,EACzCC,EAAU,EAAQ,KAAqB,EACvCC,EAAQ,EAAQ,KAAyB,EACzCC,EAAY,EAAQ,KAAsB,EAU9C,SAASljD,EAASmjD,EAAMC,EAAQC,EAAU,CASxC,GARI,UAAU,OAAS,IACrBA,EAAWF,EACXA,EAAO,KACPC,EAAS,MAGX,KAAK,SAAWC,EAEZ,OAAO,KAAK,UAAa,UAAY,KAAK,UAAY,EACxD,MAAM,IAAI,MAAM,0DAA0D,KACnE,CAAC,SAAS,KAAK,QAAQ,GAAK,KAAK,MAAM,KAAK,QAAQ,IAAM,KAAK,SACpE,MAAM,IAAI,MAAM,oEAAoE,EAExF,IAAIC,EAAeL,EAAM,gBAAgBI,CAAQ,EAEjD,KAAK,QAAU,IAAIC,EAAaD,CAAQ,EACxC,KAAK,SAAW,IAAIC,EAAaD,CAAQ,EACzC,KAAK,EAAI,OAAOF,GAAS,WAAa,IAAIA,EAAKE,CAAQ,EAAI,IAAI,MAAMA,CAAQ,EAC7E,KAAK,EAAI,OAAOD,GAAW,WAAa,IAAIA,EAAOC,CAAQ,EAAI,IAAI,MAAMA,CAAQ,EAGjF,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,MAAQ,CAAC,CAChB,CA1BS,EAAArjD,EAAA,YAiCTA,EAAS,UAAU,MAAQ,UAAW,CACpC,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,KAAO,EACZ,KAAK,MAAQ,CAAC,CAChB,EAQAA,EAAS,UAAU,WAAa,SAASujD,EAAS,CAChD,IAAIC,EAAU,KAAK,KAEnB,GAAI,KAAK,OAASD,EAChB,OAAO,KAET,IAAIE,EAAW,KAAK,SAASF,CAAO,EAChC36E,EAAO,KAAK,QAAQ26E,CAAO,EAE/B,OAAI,KAAK,OAASA,EAChB,KAAK,KAAOE,EAGZ,KAAK,SAAS76E,CAAI,EAAI66E,EAGxB,KAAK,QAAQA,CAAQ,EAAI76E,EAEzB,KAAK,SAAS46E,CAAO,EAAID,EACzB,KAAK,KAAOA,EACZ,KAAK,QAAQA,CAAO,EAAIC,EAEjB,IACT,EASAxjD,EAAS,UAAU,IAAM,SAASz4B,EAAK4L,EAAO,CAG5C,IAAIowE,EAAU,KAAK,MAAMh8E,CAAG,EAE5B,GAAI,OAAOg8E,EAAY,IAAa,CAClC,KAAK,WAAWA,CAAO,EACvB,KAAK,EAAEA,CAAO,EAAIpwE,EAElB,MACF,CAGI,KAAK,KAAO,KAAK,SACnBowE,EAAU,KAAK,QAKfA,EAAU,KAAK,KACf,KAAK,KAAO,KAAK,SAASA,CAAO,EACjC,OAAO,KAAK,MAAM,KAAK,EAAEA,CAAO,CAAC,GAInC,KAAK,MAAMh8E,CAAG,EAAIg8E,EAClB,KAAK,EAAEA,CAAO,EAAIh8E,EAClB,KAAK,EAAEg8E,CAAO,EAAIpwE,EAGlB,KAAK,QAAQowE,CAAO,EAAI,KAAK,KAC7B,KAAK,SAAS,KAAK,IAAI,EAAIA,EAC3B,KAAK,KAAOA,CACd,EAaAvjD,EAAS,UAAU,OAAS,SAASz4B,EAAK4L,EAAO,CAC/C,IAAIuwE,EAAW,KACXC,EAAS,KAETJ,EAAU,KAAK,MAAMh8E,CAAG,EAE5B,OAAI,OAAOg8E,EAAY,KACrB,KAAK,WAAWA,CAAO,EACvBG,EAAW,KAAK,EAAEH,CAAO,EACzB,KAAK,EAAEA,CAAO,EAAIpwE,EACX,CAAC,QAAS,GAAO,IAAK5L,EAAK,MAAOm8E,CAAQ,IAI/C,KAAK,KAAO,KAAK,SACnBH,EAAU,KAAK,QAKfA,EAAU,KAAK,KACf,KAAK,KAAO,KAAK,SAASA,CAAO,EACjCG,EAAW,KAAK,EAAEH,CAAO,EACzBI,EAAS,KAAK,EAAEJ,CAAO,EACvB,OAAO,KAAK,MAAM,KAAK,EAAEA,CAAO,CAAC,GAInC,KAAK,MAAMh8E,CAAG,EAAIg8E,EAClB,KAAK,EAAEA,CAAO,EAAIh8E,EAClB,KAAK,EAAEg8E,CAAO,EAAIpwE,EAGlB,KAAK,QAAQowE,CAAO,EAAI,KAAK,KAC7B,KAAK,SAAS,KAAK,IAAI,EAAIA,EAC3B,KAAK,KAAOA,EAGRI,EACK,CAAC,QAAS,GAAM,IAAKA,EAAQ,MAAOD,CAAQ,EAG5C,KAEX,EAQA1jD,EAAS,UAAU,IAAM,SAASz4B,EAAK,CACrC,OAAOA,KAAO,KAAK,KACrB,EASAy4B,EAAS,UAAU,IAAM,SAASz4B,EAAK,CACrC,IAAIg8E,EAAU,KAAK,MAAMh8E,CAAG,EAE5B,GAAI,SAAOg8E,EAAY,KAGvB,YAAK,WAAWA,CAAO,EAEhB,KAAK,EAAEA,CAAO,CACvB,EASAvjD,EAAS,UAAU,KAAO,SAASz4B,EAAK,CACpC,IAAIg8E,EAAU,KAAK,MAAMh8E,CAAG,EAE5B,GAAI,SAAOg8E,EAAY,KAGvB,OAAO,KAAK,EAAEA,CAAO,CACzB,EASAvjD,EAAS,UAAU,QAAU,SAAS/O,EAAU6kC,EAAO,CACrDA,EAAQ,UAAU,OAAS,EAAIA,EAAQ,KAUvC,QARIx8C,EAAI,EACJvP,EAAI,KAAK,KAETw5E,EAAU,KAAK,KACf/iE,EAAO,KAAK,EACZo2C,EAAS,KAAK,EACdmH,EAAU,KAAK,QAEZzkD,EAAIvP,GAETknB,EAAS,KAAK6kC,EAAOc,EAAO2sB,CAAO,EAAG/iE,EAAK+iE,CAAO,EAAG,IAAI,EACzDA,EAAUxlB,EAAQwlB,CAAO,EAEzBjqE,GAEJ,EAQA0mB,EAAS,UAAU,KAAO,UAAW,CACnC,IAAI1mB,EAAI,EACJvP,EAAI,KAAK,KAETw5E,EAAU,KAAK,KACf/iE,EAAO,KAAK,EACZu9C,EAAU,KAAK,QAEnB,OAAO,IAAIglB,EAAS,UAAW,CAC7B,GAAIzpE,GAAKvP,EACP,MAAO,CAAC,KAAM,EAAI,EAEpB,IAAIxC,EAAMiZ,EAAK+iE,CAAO,EAEtB,OAAAjqE,IAEIA,EAAIvP,IACNw5E,EAAUxlB,EAAQwlB,CAAO,GAEpB,CACL,KAAM,GACN,MAAOh8E,CACT,CACF,CAAC,CACH,EAQAy4B,EAAS,UAAU,OAAS,UAAW,CACrC,IAAI1mB,EAAI,EACJvP,EAAI,KAAK,KAETw5E,EAAU,KAAK,KACf3sB,EAAS,KAAK,EACdmH,EAAU,KAAK,QAEnB,OAAO,IAAIglB,EAAS,UAAW,CAC7B,GAAIzpE,GAAKvP,EACP,MAAO,CAAC,KAAM,EAAI,EAEpB,IAAIoJ,EAAQyjD,EAAO2sB,CAAO,EAE1B,OAAAjqE,IAEIA,EAAIvP,IACNw5E,EAAUxlB,EAAQwlB,CAAO,GAEpB,CACL,KAAM,GACN,MAAApwE,CACF,CACF,CAAC,CACH,EAQA6sB,EAAS,UAAU,QAAU,UAAW,CACtC,IAAI1mB,EAAI,EACJvP,EAAI,KAAK,KAETw5E,EAAU,KAAK,KACf/iE,EAAO,KAAK,EACZo2C,EAAS,KAAK,EACdmH,EAAU,KAAK,QAEnB,OAAO,IAAIglB,EAAS,UAAW,CAC7B,GAAIzpE,GAAKvP,EACP,MAAO,CAAC,KAAM,EAAI,EAEpB,IAAIxC,EAAMiZ,EAAK+iE,CAAO,EAClBpwE,EAAQyjD,EAAO2sB,CAAO,EAE1B,OAAAjqE,IAEIA,EAAIvP,IACNw5E,EAAUxlB,EAAQwlB,CAAO,GAEpB,CACL,KAAM,GACN,MAAO,CAACh8E,EAAK4L,CAAK,CACpB,CACF,CAAC,CACH,EAKI,OAAO,OAAW,MACpB6sB,EAAS,UAAU,OAAO,QAAQ,EAAIA,EAAS,UAAU,SAK3DA,EAAS,UAAU,QAAU,UAAW,CAMtC,QALI0lC,EAAQ,IAAI,IAEZke,EAAW,KAAK,QAAQ,EACxBrmC,EAEIA,EAAOqmC,EAAS,KAAK,EAAG,CAACrmC,EAAK,MACpCmoB,EAAM,IAAInoB,EAAK,MAAM,CAAC,EAAGA,EAAK,MAAM,CAAC,CAAC,EAGxC,cAAO,eAAemoB,EAAO,cAAe,CAC1C,MAAO1lC,EACP,WAAY,EACd,CAAC,EAEM0lC,CACT,EAEI,OAAO,OAAW,MACpB1lC,EAAS,UAAU,OAAO,IAAI,4BAA4B,CAAC,EAAIA,EAAS,UAAU,SAYpFA,EAAS,KAAO,SAAS6jD,EAAUV,EAAMC,EAAQC,EAAU,CACzD,GAAI,UAAU,OAAS,GAGrB,GAFAA,EAAWH,EAAU,YAAYW,CAAQ,EAErC,OAAOR,GAAa,SACtB,MAAM,IAAI,MAAM,8GAA8G,OAEzH,UAAU,SAAW,IAC5BA,EAAWF,EACXA,EAAO,KACPC,EAAS,MAGX,IAAIrsC,EAAQ,IAAI/W,EAASmjD,EAAMC,EAAQC,CAAQ,EAE/C,OAAAL,EAAQa,EAAU,SAAS1wE,EAAO5L,EAAK,CACrCwvC,EAAM,IAAIxvC,EAAK4L,CAAK,CACtB,CAAC,EAEM4jC,CACT,EAKA1vC,GAAO,QAAU24B,C,mBC5ajB,IAAIgjD,EAAU,EAAQ,KAAqB,EAEvCC,EAAQ,EAAQ,KAAmB,EASvC,SAASa,EAAYtyE,EAAQ,CAC3B,OAAO,MAAM,QAAQA,CAAM,GAAKyxE,EAAM,aAAazxE,CAAM,CAC3D,CAFS,EAAAsyE,EAAA,eAWT,SAASC,EAAYvyE,EAAQ,CAC3B,GAAI,OAAOA,EAAO,QAAW,SAC3B,OAAOA,EAAO,OAEhB,GAAI,OAAOA,EAAO,MAAS,SACzB,OAAOA,EAAO,IAGlB,CARS,EAAAuyE,EAAA,eAgBT,SAASC,EAAQxyE,EAAQ,CACvB,IAAIzH,EAAIg6E,EAAYvyE,CAAM,EAEtByyE,EAAQ,OAAOl6E,GAAM,SAAW,IAAI,MAAMA,CAAC,EAAI,CAAC,EAEhDuP,EAAI,EAGR,OAAA0pE,EAAQxxE,EAAQ,SAAS2B,EAAO,CAC9B8wE,EAAM3qE,GAAG,EAAInG,CACf,CAAC,EAEM8wE,CACT,CAbS,EAAAD,EAAA,WAqBT,SAASE,EAAmB1yE,EAAQ,CAClC,IAAIzH,EAAIg6E,EAAYvyE,CAAM,EAEtB2yE,EAAa,OAAOp6E,GAAM,SAC5Bk5E,EAAM,gBAAgBl5E,CAAC,EACvB,MAEEk6E,EAAQ,OAAOl6E,GAAM,SAAW,IAAI,MAAMA,CAAC,EAAI,CAAC,EAChD2tC,EAAU,OAAO3tC,GAAM,SAAW,IAAIo6E,EAAWp6E,CAAC,EAAI,CAAC,EAEvDuP,EAAI,EAGR,OAAA0pE,EAAQxxE,EAAQ,SAAS2B,EAAO,CAC9B8wE,EAAM3qE,CAAC,EAAInG,EACXukC,EAAQp+B,CAAC,EAAIA,GACf,CAAC,EAEM,CAAC2qE,EAAOvsC,CAAO,CACxB,CAnBS,EAAAwsC,EAAA,sBAwBT98E,EAAQ,YAAc08E,EACtB18E,EAAQ,YAAc28E,EACtB38E,EAAQ,QAAU48E,EAClB58E,EAAQ,mBAAqB88E,C,iBC3E7B,IAAIE,EAAmB,KAAK,IAAI,EAAG,CAAC,EAAI,EACpCC,EAAoB,KAAK,IAAI,EAAG,EAAE,EAAI,EACtCC,EAAoB,KAAK,IAAI,EAAG,EAAE,EAAI,EAEtCC,EAA0B,KAAK,IAAI,EAAG,CAAC,EAAI,EAC3CC,EAA2B,KAAK,IAAI,EAAG,EAAE,EAAI,EAC7CC,EAA2B,KAAK,IAAI,EAAG,EAAE,EAAI,EAEjDr9E,EAAQ,gBAAkB,SAASq1B,EAAM,CACvC,IAAIioD,EAAWjoD,EAAO,EAEtB,GAAIioD,GAAYN,EACd,OAAO,WAET,GAAIM,GAAYL,EACd,OAAO,YAET,GAAIK,GAAYJ,EACd,OAAO,YAET,MAAM,IAAI,MAAM,iEAAiE,CACnF,EAEAl9E,EAAQ,sBAAwB,SAASq1B,EAAM,CAC7C,IAAIioD,EAAWjoD,EAAO,EAEtB,OAAIioD,GAAYH,EACP,UAELG,GAAYF,EACP,WAELE,GAAYD,EACP,WAEF,YACT,EAQAr9E,EAAQ,cAAgB,SAAS+L,EAAO,CAGtC,OAAIA,KAAWA,EAAQ,GAGjB,KAAK,KAAKA,CAAK,IAAM,GACnBA,GAAS,KAAOA,GAAS,KACpB,UAELA,GAAS,OAASA,GAAS,OACtB,WAEF,WAIHA,GAAS,IACJ,WAELA,GAAS,MACJ,YAEF,YAMJ,YACT,EAUA,IAAIwxE,EAAgB,CAClB,WAAY,EACZ,UAAW,EACX,YAAa,EACb,WAAY,EACZ,YAAa,EACb,WAAY,EACZ,aAAc,EACd,aAAc,CAChB,EAGAv9E,EAAQ,yBAA2B,SAAS68E,EAAOW,EAAQ,CACzD,IAAIC,EAAU,KACVC,EAAc,EACdn9E,EACAod,EACAW,EACA,EACA,EAEJ,IAAK,EAAI,EAAG,EAAIu+D,EAAM,OAAQ,EAAI,EAAG,IACnCv+D,EAAIk/D,EAASA,EAAOX,EAAM,CAAC,CAAC,EAAIA,EAAM,CAAC,EACvCl/D,EAAI3d,EAAQ,cAAcse,CAAC,EAC3B/d,EAAIg9E,EAAc5/D,EAAE,IAAI,EAEpBpd,EAAIm9E,IACNA,EAAcn9E,EACdk9E,EAAU9/D,GAId,OAAO8/D,CACT,EAQAz9E,EAAQ,aAAe,SAAS+L,EAAO,CACrC,OAAO,OAAO,YAAgB,KAAe,YAAY,OAAOA,CAAK,CACvE,EAQA/L,EAAQ,OAAS,UAAW,CAC1B,IAAIY,EAAS,EACTsR,EACA+L,EACAtb,EAEJ,IAAKuP,EAAI,EAAGvP,EAAI,UAAU,OAAQuP,EAAIvP,EAAGuP,IACvCtR,GAAU,UAAUsR,CAAC,EAAE,OAEzB,IAAI2qE,EAAQ,IAAK,UAAU,CAAC,EAAE,YAAaj8E,CAAM,EAEjD,IAAKsR,EAAI,EAAG+L,EAAI,EAAG/L,EAAIvP,EAAGuP,IACxB2qE,EAAM,IAAI,UAAU3qE,CAAC,EAAG+L,CAAC,EACzBA,GAAK,UAAU/L,CAAC,EAAE,OAGpB,OAAO2qE,CACT,EAQA78E,EAAQ,QAAU,SAASY,EAAQ,CAKjC,QAJIs7E,EAAel8E,EAAQ,gBAAgBY,CAAM,EAE7Ci8E,EAAQ,IAAIX,EAAat7E,CAAM,EAE1BsR,EAAI,EAAGA,EAAItR,EAAQsR,IAC1B2qE,EAAM3qE,CAAC,EAAIA,EAEb,OAAO2qE,CACT,C,mBCpLA,IAAIc,EAAU,EAAQ,KAAc,EAEhCC,EAAuBD,EAAQ,qBAC/BE,EAAiBF,EAAQ,eAQ7B19E,GAAO,QAAU,WAAiBw8E,EAAU5yD,EAAU,CACpD,IAAI2yD,EAAU5qC,EAAG1/B,EAAGvP,EAAGob,EAEvB,GAAI,CAAC0+D,EAAU,MAAM,IAAI,MAAM,wCAAwC,EAEvE,GAAI,OAAO5yD,GAAa,WACtB,MAAM,IAAI,MAAM,4CAA4C,EAG9D,GACE,MAAM,QAAQ4yD,CAAQ,GACrBmB,GAAwB,YAAY,OAAOnB,CAAQ,GACpD,OAAOA,GAAa,UACpBA,EAAS,SAAS,IAAM,qBACxB,CACA,IAAKvqE,EAAI,EAAGvP,EAAI85E,EAAS,OAAQvqE,EAAIvP,EAAGuP,IAAK2X,EAAS4yD,EAASvqE,CAAC,EAAGA,CAAC,EACpE,MACF,CAGA,GAAI,OAAOuqE,EAAS,SAAY,WAAY,CAC1CA,EAAS,QAAQ5yD,CAAQ,EACzB,MACF,CAYA,GAREg0D,GACA,OAAO,YAAYpB,GACnB,OAAOA,EAAS,MAAS,aAEzBA,EAAWA,EAAS,OAAO,QAAQ,EAAE,GAInC,OAAOA,EAAS,MAAS,WAAY,CAIvC,IAHAD,EAAWC,EACXvqE,EAAI,EAEK6L,EAAIy+D,EAAS,KAAK,EAAIz+D,EAAE,OAAS,IACxC8L,EAAS9L,EAAE,MAAO7L,CAAC,EACnBA,IAGF,MACF,CAGA,IAAK0/B,KAAK6qC,EACJA,EAAS,eAAe7qC,CAAC,GAC3B/nB,EAAS4yD,EAAS7qC,CAAC,EAAGA,CAAC,CAK7B,EAvDiB,U,UCJjB,SAAS+pC,EAASn6E,EAAM,CACtB,GAAI,OAAOA,GAAS,WAClB,MAAM,IAAI,MAAM,6CAA6C,EAE/D,KAAK,KAAOA,CACd,CALS,EAAAm6E,EAAA,YAUL,OAAO,OAAW,MACpBA,EAAS,UAAU,OAAO,QAAQ,EAAI,UAAY,CAChD,OAAO,IACT,GAQFA,EAAS,GAAK,UAAY,CACxB,IAAI/1E,EAAO,UACTjD,EAAIiD,EAAK,OACTsM,EAAI,EAEN,OAAO,IAAIypE,EAAS,UAAY,CAC9B,OAAIzpE,GAAKvP,EAAU,CAAC,KAAM,EAAI,EAEvB,CAAC,KAAM,GAAO,MAAOiD,EAAKsM,GAAG,CAAC,CACvC,CAAC,CACH,EAOAypE,EAAS,MAAQ,UAAY,CAC3B,IAAIa,EAAW,IAAIb,EAAS,UAAY,CACtC,MAAO,CAAC,KAAM,EAAI,CACpB,CAAC,EAED,OAAOa,CACT,EAQAb,EAAS,aAAe,SAAUmC,EAAU,CAC1C,IAAI5rE,EAAI,EACNvP,EAAIm7E,EAAS,OAEf,OAAO,IAAInC,EAAS,UAAY,CAC9B,OAAIzpE,GAAKvP,EAAU,CAAC,KAAM,EAAI,EAEvB,CAAC,KAAM,GAAO,MAAOm7E,EAAS5rE,GAAG,CAAC,CAC3C,CAAC,CACH,EAQAypE,EAAS,GAAK,SAAU5vE,EAAO,CAC7B,OAAIA,aAAiB4vE,EAAiB,GAGpC,OAAO5vE,GAAU,UACjBA,IAAU,MACV,OAAOA,EAAM,MAAS,UAE1B,EAKA9L,GAAO,QAAU07E,C,iBC/FjB37E,EAAQ,qBAAuB,OAAO,YAAgB,IACtDA,EAAQ,eAAiB,OAAO,OAAW,G,aCE3CC,GAAO,QAAU89E,EACjB99E,GAAO,QAAQ,MAAQihB,EACvBjhB,GAAO,QAAQ,iBAAmB+9E,EAClC/9E,GAAO,QAAQ,MAAQo2E,EACvBp2E,GAAO,QAAQ,QAAUg+E,EACzBh+E,GAAO,QAAQ,iBAAmBi+E,EAClCj+E,GAAO,QAAQ,eAAiBk+E,EAKhC,IAAIC,EAAoB,IAOpBC,EAAc,IAAI,OAAO,CAG3B,UAMA,qFACF,EAAE,KAAK,GAAG,EAAG,GAAG,EAShB,SAAShI,EAAOv1D,EAAK5gB,EAAS,CAU5B,QATIs6B,EAAS,CAAC,EACVr6B,EAAM,EACNqC,EAAQ,EACR6kC,EAAO,GACPi3C,EAAoBp+E,GAAWA,EAAQ,WAAck+E,EACrDG,EAAar+E,GAAWA,EAAQ,WAAc,OAC9Cs+E,EAAc,GACdtjD,GAEIA,EAAMmjD,EAAY,KAAKv9D,CAAG,KAAO,MAAM,CAC7C,IAAIha,EAAIo0B,EAAI,CAAC,EACTujD,EAAUvjD,EAAI,CAAC,EACfj5B,EAASi5B,EAAI,MAKjB,GAJAmM,GAAQvmB,EAAI,MAAMte,EAAOP,CAAM,EAC/BO,EAAQP,EAAS6E,EAAE,OAGf23E,EAAS,CACXp3C,GAAQo3C,EAAQ,CAAC,EACjBD,EAAc,GACd,QACF,CAEA,IAAIloB,EAAO,GACP30D,EAAOu5B,EAAI,CAAC,EACZwjD,EAAUxjD,EAAI,CAAC,EACfmH,EAAQnH,EAAI,CAAC,EACb12B,EAAW02B,EAAI,CAAC,EAEpB,GAAI,CAACsjD,GAAen3C,EAAK,OAAQ,CAC/B,IAAIuK,EAAIvK,EAAK,OAAS,EAClB9pB,EAAI8pB,EAAKuK,CAAC,EACVmB,EAAUwrC,EAAYA,EAAU,QAAQhhE,CAAC,EAAI,GAAK,GAElDw1B,IACFujB,EAAO/4C,EACP8pB,EAAOA,EAAK,MAAM,EAAGuK,CAAC,EAE1B,CAGIvK,IACF7M,EAAO,KAAK6M,CAAI,EAChBA,EAAO,GACPm3C,EAAc,IAGhB,IAAIG,EAASn6E,IAAa,KAAOA,IAAa,IAC1Co6E,EAAWp6E,IAAa,KAAOA,IAAa,IAC5Cq6E,EAAUH,GAAWr8C,EACrBy8C,GAAYxoB,GAAQgoB,EAExB9jD,EAAO,KAAK,CACV,KAAM74B,GAAQxB,IACd,OAAQm2D,EACR,UAAAwoB,GACA,SAAAF,EACA,OAAAD,EACA,QAASE,EACLE,EAAYF,CAAO,EACnB,KAAOG,EAAaF,KAAcR,EAAmBQ,GAAaA,GAAYR,CAAiB,EAAI,KACzG,CAAC,CACH,CAGA,OAAIj3C,GAAQ7kC,EAAQse,EAAI,SACtB0Z,EAAO,KAAK6M,EAAOvmB,EAAI,OAAOte,CAAK,CAAC,EAG/Bg4B,CACT,CAvES,EAAA67C,EAAA,SAgFT,SAAS4H,EAASn9D,EAAK5gB,EAAS,CAC9B,OAAOg+E,EAAiB7H,EAAMv1D,EAAK5gB,CAAO,EAAGA,CAAO,CACtD,CAFS,EAAA+9E,EAAA,WAOT,SAAS/8D,EAAOJ,EAAK5gB,EAAS,CAC5B,IAAIkZ,EAAO,CAAC,EACR6lE,EAAKlB,EAAaj9D,EAAK1H,EAAMlZ,CAAO,EACxC,OAAO89E,EAAiBiB,EAAI7lE,CAAI,CAClC,CAJS,EAAA8H,EAAA,SAST,SAAS88D,EAAkBiB,EAAI7lE,EAAM,CACnC,OAAO,SAAU8lE,EAAUh/E,EAAS,CAClC,IAAI4G,EAAIm4E,EAAG,KAAKC,CAAQ,EACxB,GAAI,CAACp4E,EAAG,MAAO,GAOf,QALIugC,EAAOvgC,EAAE,CAAC,EACVtE,EAAQsE,EAAE,MACVghC,EAAS,CAAC,EACVq3C,EAAUj/E,GAAWA,EAAQ,QAAW,mBAEnCgS,EAAI,EAAGA,EAAIpL,EAAE,OAAQoL,IAC5B,GAAIpL,EAAEoL,CAAC,IAAM,OAEb,KAAI/R,EAAMiZ,EAAKlH,EAAI,CAAC,EAEhB/R,EAAI,OACN2nC,EAAO3nC,EAAI,IAAI,EAAI2G,EAAEoL,CAAC,EAAE,MAAM/R,EAAI,SAAS,EAAE,IAAI,SAAU4L,EAAO,CAChE,OAAOozE,EAAOpzE,EAAO5L,CAAG,CAC1B,CAAC,EAED2nC,EAAO3nC,EAAI,IAAI,EAAIg/E,EAAOr4E,EAAEoL,CAAC,EAAG/R,CAAG,EAIvC,MAAO,CAAE,KAAAknC,EAAY,MAAA7kC,EAAc,OAAAslC,CAAe,CACpD,CACF,CA1BS,EAAAk2C,EAAA,oBA+BT,SAASE,EAAkB1jD,EAAQt6B,EAAS,CAK1C,QAHI6yC,EAAU,IAAI,MAAMvY,EAAO,MAAM,EAG5BtoB,EAAI,EAAGA,EAAIsoB,EAAO,OAAQtoB,IAC7B,OAAOsoB,EAAOtoB,CAAC,GAAM,WACvB6gC,EAAQ7gC,CAAC,EAAI,IAAI,OAAO,OAASsoB,EAAOtoB,CAAC,EAAE,QAAU,KAAMyY,EAAMzqB,CAAO,CAAC,GAI7E,OAAO,SAAU6T,EAAM7T,EAAS,CAK9B,QAJImnC,EAAO,GACP+3C,EAAUl/E,GAAWA,EAAQ,QAAW,mBACxC6pC,EAAW7pC,EAAUA,EAAQ,WAAa,GAAQ,GAE7CgS,EAAI,EAAGA,EAAIsoB,EAAO,OAAQtoB,IAAK,CACtC,IAAIiQ,EAAQqY,EAAOtoB,CAAC,EAEpB,GAAI,OAAOiQ,GAAU,SAAU,CAC7BklB,GAAQllB,EACR,QACF,CAEA,IAAIpW,EAAQgI,EAAOA,EAAKoO,EAAM,IAAI,EAAI,OAClC0d,EAEJ,GAAI,MAAM,QAAQ9zB,CAAK,EAAG,CACxB,GAAI,CAACoW,EAAM,OACT,MAAM,IAAI,UAAU,aAAeA,EAAM,KAAO,gCAAgC,EAGlF,GAAIpW,EAAM,SAAW,EAAG,CACtB,GAAIoW,EAAM,SAAU,SAEpB,MAAM,IAAI,UAAU,aAAeA,EAAM,KAAO,mBAAmB,CACrE,CAEA,QAAS9hB,EAAI,EAAGA,EAAI0L,EAAM,OAAQ1L,IAAK,CAGrC,GAFAw/B,EAAUu/C,EAAOrzE,EAAM1L,CAAC,EAAG8hB,CAAK,EAE5B4nB,GAAY,CAACgJ,EAAQ7gC,CAAC,EAAE,KAAK2tB,CAAO,EACtC,MAAM,IAAI,UAAU,iBAAmB1d,EAAM,KAAO,eAAiBA,EAAM,QAAU,GAAG,EAG1FklB,IAAShnC,IAAM,EAAI8hB,EAAM,OAASA,EAAM,WAAa0d,CACvD,CAEA,QACF,CAEA,GAAI,OAAO9zB,GAAU,UAAY,OAAOA,GAAU,UAAY,OAAOA,GAAU,UAAW,CAGxF,GAFA8zB,EAAUu/C,EAAO,OAAOrzE,CAAK,EAAGoW,CAAK,EAEjC4nB,GAAY,CAACgJ,EAAQ7gC,CAAC,EAAE,KAAK2tB,CAAO,EACtC,MAAM,IAAI,UAAU,aAAe1d,EAAM,KAAO,eAAiBA,EAAM,QAAU,eAAiB0d,EAAU,GAAG,EAGjHwH,GAAQllB,EAAM,OAAS0d,EACvB,QACF,CAEA,GAAI,CAAA1d,EAAM,SAEV,MAAM,IAAI,UAAU,aAAeA,EAAM,KAAO,YAAcA,EAAM,OAAS,WAAa,WAAW,CACvG,CAEA,OAAOklB,CACT,CACF,CArES,EAAA62C,EAAA,oBA6ET,SAASc,EAAcl+D,EAAK,CAC1B,OAAOA,EAAI,QAAQ,4BAA6B,MAAM,CACxD,CAFS,EAAAk+D,EAAA,gBAUT,SAASD,EAAa18C,EAAO,CAC3B,OAAOA,EAAM,QAAQ,eAAgB,MAAM,CAC7C,CAFS,EAAA08C,EAAA,eAUT,SAASp0D,EAAOzqB,EAAS,CACvB,OAAOA,GAAWA,EAAQ,UAAY,GAAK,GAC7C,CAFS,EAAAyqB,EAAA,SAWT,SAAS00D,EAAgBh4C,EAAMjuB,EAAM,CACnC,GAAI,CAACA,EAAM,OAAOiuB,EAGlB,IAAIstC,EAASttC,EAAK,OAAO,MAAM,WAAW,EAE1C,GAAIstC,EACF,QAASziE,EAAI,EAAGA,EAAIyiE,EAAO,OAAQziE,IACjCkH,EAAK,KAAK,CACR,KAAMlH,EACN,OAAQ,KACR,UAAW,KACX,SAAU,GACV,OAAQ,GACR,QAAS,IACX,CAAC,EAIL,OAAOm1B,CACT,CApBS,EAAAg4C,EAAA,kBA8BT,SAASC,EAAej4C,EAAMjuB,EAAMlZ,EAAS,CAG3C,QAFI85B,EAAQ,CAAC,EAEJ9nB,EAAI,EAAGA,EAAIm1B,EAAK,OAAQn1B,IAC/B8nB,EAAM,KAAK+jD,EAAa12C,EAAKn1B,CAAC,EAAGkH,EAAMlZ,CAAO,EAAE,MAAM,EAGxD,OAAO,IAAI,OAAO,MAAQ85B,EAAM,KAAK,GAAG,EAAI,IAAKrP,EAAMzqB,CAAO,CAAC,CACjE,CARS,EAAAo/E,EAAA,iBAkBT,SAASC,EAAgBl4C,EAAMjuB,EAAMlZ,EAAS,CAC5C,OAAOi+E,EAAe9H,EAAMhvC,EAAMnnC,CAAO,EAAGkZ,EAAMlZ,CAAO,CAC3D,CAFS,EAAAq/E,EAAA,kBAYT,SAASpB,EAAgB3jD,EAAQphB,EAAMlZ,EAAS,CAC9CA,EAAUA,GAAW,CAAC,EAUtB,QARIs/E,EAASt/E,EAAQ,OACjBa,EAAQb,EAAQ,QAAU,GAC1B0K,EAAM1K,EAAQ,MAAQ,GACtB4+E,EAAY5+E,EAAQ,WAAak+E,EACjCqB,EAAW,CAAC,EAAE,OAAOv/E,EAAQ,UAAY,CAAC,CAAC,EAAE,IAAI8+E,CAAY,EAAE,OAAO,GAAG,EAAE,KAAK,GAAG,EACnF3sC,EAAQtxC,EAAQ,IAAM,GAGjBmR,EAAI,EAAGA,EAAIsoB,EAAO,OAAQtoB,IAAK,CACtC,IAAIiQ,EAAQqY,EAAOtoB,CAAC,EAEpB,GAAI,OAAOiQ,GAAU,SACnBkwB,GAAS2sC,EAAa78D,CAAK,MACtB,CACL,IAAIu8D,EAAUv8D,EAAM,OAChB,MAAQA,EAAM,QAAU,OAAS68D,EAAa78D,EAAM,SAAS,EAAI,MAAQA,EAAM,QAAU,MACzFA,EAAM,QAEN/I,GAAMA,EAAK,KAAK+I,CAAK,EAErBA,EAAM,SACHA,EAAM,OAGTkwB,GAAS,MAAQ2sC,EAAa78D,EAAM,MAAM,EAAI,IAAMu8D,EAAU,MAF9DrsC,GAAS,IAAMqsC,EAAU,KAK3BrsC,GAAS2sC,EAAa78D,EAAM,MAAM,EAAI,IAAMu8D,EAAU,GAE1D,CACF,CAEA,GAAI9zE,EACG40E,IAAQntC,GAAS,MAAQ2sC,EAAaF,CAAS,EAAI,MAExDzsC,GAASotC,IAAa,IAAM,IAAM,MAAQA,EAAW,QAChD,CACL,IAAIC,EAAWllD,EAAOA,EAAO,OAAS,CAAC,EACnCmlD,EAAiB,OAAOD,GAAa,SACrCA,EAASA,EAAS,OAAS,CAAC,IAAMZ,EAClCY,IAAa,OAEZF,IAAQntC,GAAS,MAAQ2sC,EAAaF,CAAS,EAAI,MAAQW,EAAW,OACtEE,IAAgBttC,GAAS,MAAQ2sC,EAAaF,CAAS,EAAI,IAAMW,EAAW,IACnF,CAEA,OAAO,IAAI,OAAOptC,EAAO1nB,EAAMzqB,CAAO,CAAC,CACzC,CAlDS,EAAAi+E,EAAA,kBAgET,SAASJ,EAAc12C,EAAMjuB,EAAMlZ,EAAS,CAC1C,OAAImnC,aAAgB,OACXg4C,EAAeh4C,EAAMjuB,CAAI,EAG9B,MAAM,QAAQiuB,CAAI,EACbi4C,EAAqCj4C,EAAOjuB,EAAMlZ,CAAO,EAG3Dq/E,EAAsCl4C,EAAOjuB,EAAMlZ,CAAO,CACnE,CAVS,EAAA69E,EAAA,e,mBC/YT,IAAI15E,EAAM,CACT,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,CACD,EACA,aAAc,CACb,KACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,aAAc,CACb,IACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,UAAW,CACV,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,gBAAiB,CAChB,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,IACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,IACA,IACD,EACA,aAAc,CACb,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,cAAe,CACd,MACA,IACD,EACA,aAAc,CACb,MACA,GACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,eAAgB,CACf,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,KACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,WAAY,CACX,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,UAAW,CACV,MACA,IACD,EACA,aAAc,CACb,MACA,IACD,EACA,WAAY,CACX,MACA,IACD,EACA,UAAW,CACV,MACA,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","sources":["webpack://frankerfacez/<define:__version_prerelease__>","webpack://frankerfacez/./node_modules/.pnpm/@ffz+icu-msgparser@2.0.0/node_modules/@ffz/icu-msgparser/lib/parser.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getHTMLElementScroll.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getNodeScroll.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getCompositeRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/orderModifiers.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/debounce.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/mergeByName.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/createPopper.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/contains.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getBoundingClientRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getComputedStyle.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getDocumentElement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getLayoutRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getNodeName.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/isTableElement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getOffsetParent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getParentNode.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getWindow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getWindowScroll.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getWindowScrollBarX.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/instanceOf.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/isLayoutViewport.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/isScrollParent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getScrollParent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/listScrollParents.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/enums.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/applyStyles.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/arrow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/computeStyles.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/eventListeners.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getOppositePlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getOppositeVariationPlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/computeAutoPlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/flip.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/hide.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/offset.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/popperOffsets.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getAltAxis.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/modifiers/preventOverflow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/popper.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/computeOffsets.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getViewportRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getDocumentRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/rectToClientRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/dom-utils/getClippingRect.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/detectOverflow.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/expandToHashMap.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getBasePlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getFreshSideObject.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getMainAxisFromPlacement.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/getVariation.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/math.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/mergePaddingObject.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/userAgent.js","webpack://frankerfacez/./node_modules/.pnpm/@popperjs+core@2.11.8/node_modules/@popperjs/core/lib/utils/within.js","webpack://frankerfacez/./node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/core.js","webpack://frankerfacez/./node_modules/.pnpm/crypto-js@4.2.0/node_modules/crypto-js/sha1.js","webpack://frankerfacez/./node_modules/.pnpm/dayjs@1.10.7/node_modules/dayjs/dayjs.min.js","webpack://frankerfacez/./node_modules/.pnpm/dayjs@1.10.7/node_modules/dayjs/plugin/relativeTime.js","webpack://frankerfacez/./node_modules/.pnpm/emoji-regex@9.2.2/node_modules/emoji-regex/es2015/index.js","webpack://frankerfacez/./src/i18n.js","webpack://frankerfacez/./src/modules/chat/actions/actions.jsx","webpack://frankerfacez/./src/modules/chat/actions/renderers.jsx","webpack://frankerfacez/./src/modules/chat/actions/types.jsx","webpack://frankerfacez/./src/modules/chat/badges.jsx","webpack://frankerfacez/./src/modules/chat/emoji.js","webpack://frankerfacez/./src/modules/chat/emotes.js","webpack://frankerfacez/./src/modules/chat/index.js","webpack://frankerfacez/./src/modules/chat/link_providers.js","webpack://frankerfacez/./src/modules/chat/rich_providers.js","webpack://frankerfacez/./src/modules/chat/room.js","webpack://frankerfacez/./src/modules/chat/tokenizers.jsx","webpack://frankerfacez/./src/modules/emote_card/index.jsx","webpack://frankerfacez/./src/modules/link_card/index.jsx","webpack://frankerfacez/./src/modules/main_menu/index.js","webpack://frankerfacez/./src/modules/main_menu/provider-mixin.js","webpack://frankerfacez/./src/modules/main_menu/setting-mixin.js","webpack://frankerfacez/./src/modules/translation_ui/index.js","webpack://frankerfacez/./src/sites/base.js","webpack://frankerfacez/./src/sites/shared/player.jsx","webpack://frankerfacez/./src/utilities/compat/webmunch.ts","webpack://frankerfacez/./src/utilities/compat/elemental.ts","webpack://frankerfacez/./src/utilities/compat/subpump.ts","webpack://frankerfacez/./src/sites/twitch-twilight/styles/main.scss","webpack://frankerfacez/./src/sites/twitch-twilight/index.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/bits_button.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/bttv_compat.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/channel.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/scroller.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/rich_content.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/line.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/settings_menu.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/emote_menu.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/input.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/viewer_card.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/index.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/points.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/compat_emote_menu.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/css_tweaks/index.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/dashboard.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/directory/game.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/directory/index.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/layout.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/menu_button.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/mod-view.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/player.jsx","webpack://frankerfacez/./src/sites/twitch-twilight/styles/color_normalizer.scss","webpack://frankerfacez/./src/sites/twitch-twilight/modules/theme/index.js","webpack://frankerfacez/./src/sites/twitch-twilight/modules/video_chat/index.jsx","webpack://frankerfacez/./src/utilities/compat/apollo.js","webpack://frankerfacez/./src/utilities/markdown.js","webpack://frankerfacez/./src/modules/chat/overrides.ts","webpack://frankerfacez/./src/modules/chat/user.ts","webpack://frankerfacez/./src/modules/metadata.tsx","webpack://frankerfacez/./src/modules/tooltips.ts","webpack://frankerfacez/./src/settings/clearables.ts","webpack://frankerfacez/./src/settings/context.ts","webpack://frankerfacez/./src/settings/filters.ts","webpack://frankerfacez/./src/settings/index.ts","webpack://frankerfacez/./src/settings/processors.ts","webpack://frankerfacez/./src/settings/profile.ts","webpack://frankerfacez/./src/settings/providers.ts","webpack://frankerfacez/./src/settings/typehandlers.ts","webpack://frankerfacez/./src/settings/validators.ts","webpack://frankerfacez/./src/sites/twitch-twilight/modules/loadable.tsx","webpack://frankerfacez/./src/sites/twitch-twilight/modules/sub_button.tsx","webpack://frankerfacez/./src/utilities/blobs.ts","webpack://frankerfacez/./src/utilities/color.ts","webpack://frankerfacez/./src/utilities/compat/fine-router.ts","webpack://frankerfacez/./src/utilities/compat/fine.ts","webpack://frankerfacez/./src/utilities/constants.ts","webpack://frankerfacez/./src/utilities/dialog.ts","webpack://frankerfacez/./src/utilities/dom.ts","webpack://frankerfacez/./src/utilities/events.ts","webpack://frankerfacez/./src/utilities/filtering.ts","webpack://frankerfacez/./styles/font-awesome.scss","webpack://frankerfacez/./src/utilities/font-awesome.ts","webpack://frankerfacez/./styles/opendyslexic.scss","webpack://frankerfacez/./src/utilities/fonts.ts","webpack://frankerfacez/./src/utilities/graphql.ts","webpack://frankerfacez/./src/utilities/module.ts","webpack://frankerfacez/./src/utilities/object.ts","webpack://frankerfacez/./src/utilities/path-parser.ts","webpack://frankerfacez/./src/utilities/time.ts","webpack://frankerfacez/./src/utilities/tooltip.ts","webpack://frankerfacez/./src/utilities/translation-core.ts","webpack://frankerfacez/./src/utilities/twitch-data.ts","webpack://frankerfacez/./src/modules/chat/clip_info.gql","webpack://frankerfacez/./src/modules/chat/emote_info.gql","webpack://frankerfacez/./src/modules/chat/emote_set_info.gql","webpack://frankerfacez/./src/modules/chat/video_info.gql","webpack://frankerfacez/./src/modules/emote_card/twitch_data.gql","webpack://frankerfacez/./src/sites/twitch-twilight/modules/chat/sub_status.gql","webpack://frankerfacez/./node_modules/.pnpm/mnemonist@0.38.5/node_modules/mnemonist/lru-cache.js","webpack://frankerfacez/./node_modules/.pnpm/mnemonist@0.38.5/node_modules/mnemonist/utils/iterables.js","webpack://frankerfacez/./node_modules/.pnpm/mnemonist@0.38.5/node_modules/mnemonist/utils/typed-arrays.js","webpack://frankerfacez/./node_modules/.pnpm/obliterator@2.0.0/node_modules/obliterator/foreach.js","webpack://frankerfacez/./node_modules/.pnpm/obliterator@2.0.0/node_modules/obliterator/iterator.js","webpack://frankerfacez/./node_modules/.pnpm/obliterator@2.0.0/node_modules/obliterator/support.js","webpack://frankerfacez/./node_modules/.pnpm/path-to-regexp@3.2.0/node_modules/path-to-regexp/index.js","webpack://frankerfacez/./node_modules/dayjs/locale/ lazy ^\\.\\/.*\\.js$ chunkName: i18n-[index] namespace object","webpack://frankerfacez/./src/modules/ sync (","webpack://frankerfacez/./src/sites/twitch-twilight/modules/ sync (","webpack://frankerfacez/external root \"ffzVue\"","webpack://frankerfacez/webpack/bootstrap","webpack://frankerfacez/webpack/runtime/compat get default export","webpack://frankerfacez/webpack/runtime/create fake namespace object","webpack://frankerfacez/webpack/runtime/define property getters","webpack://frankerfacez/webpack/runtime/ensure chunk","webpack://frankerfacez/webpack/runtime/get javascript chunk filename","webpack://frankerfacez/webpack/runtime/getFullHash","webpack://frankerfacez/webpack/runtime/global","webpack://frankerfacez/webpack/runtime/hasOwnProperty shorthand","webpack://frankerfacez/webpack/runtime/load script","webpack://frankerfacez/webpack/runtime/make namespace object","webpack://frankerfacez/webpack/runtime/runtimeId","webpack://frankerfacez/webpack/runtime/publicPath","webpack://frankerfacez/webpack/runtime/jsonp chunk loading","webpack://frankerfacez/./src/utilities/logging.ts","webpack://frankerfacez/./src/addons.ts","webpack://frankerfacez/./node_modules/.pnpm/js-cookie@3.0.5/node_modules/js-cookie/dist/js.cookie.mjs","webpack://frankerfacez/./src/experiments.ts","webpack://frankerfacez/./src/socket.js","webpack://frankerfacez/./src/pubsub/client.ts","webpack://frankerfacez/./src/pubsub/index.ts","webpack://frankerfacez/./src/utilities/vue.ts","webpack://frankerfacez/./src/staging.tsx","webpack://frankerfacez/./src/load_tracker.ts","webpack://frankerfacez/./src/utilities/addon.ts","webpack://frankerfacez/./src/main.ts"],"sourcesContent":[null,"'use strict';\n\nconst SPACE = /\\s/,\n\tSYMBOLS = {\n\t\tOPEN: '{',\n\t\tCLOSE: '}',\n\t\tTAG_OPEN: '<',\n\t\tTAG_CLOSE: '>',\n\t\tTAG_CLOSING: '/',\n\t\tSEP: ',',\n\t\tSUB_VAR: '#',\n\t\tESCAPE: \"'\"\n\t},\n\tSUBNUM = 'subnumeric_types',\n\tSUBMSG = 'submessage_types',\n\tKEYS = Object.keys(SYMBOLS),\n\tCLOSE_TAG = Symbol('C');\n\nconst Parser = exports = module.exports = function Parser(options) {\n\t\tif ( ! (this instanceof Parser) )\n\t\t\treturn new Parser(options);\n\n\t\tthis.opts = Object.assign({\n\t\t\tOFFSET: 'offset:',\n\t\t\t[SUBNUM]: ['plural', 'selectordinal'],\n\t\t\t[SUBMSG]: ['plural', 'selectordinal', 'select'],\n\t\t\tallowTags: true,\n\t\t\trequireOther: true\n\t\t}, SYMBOLS, options);\n\n\t\tfor(let i=0; i < KEYS.length; i++) {\n\t\t\tconst key = KEYS[i],\n\t\t\t\tval = this.opts[key];\n\t\t\tif ( typeof val !== 'string' || val.length !== 1 )\n\t\t\t\tthrow new Error(`Option ${key} must be a 1-length string`);\n\t\t\tfor(let j=i+1; j < KEYS.length; j++) {\n\t\t\t\tconst k2 = KEYS[j];\n\t\t\t\tif ( this.opts[k2] === val )\n\t\t\t\t\tthrow new Error(`Option ${key} and ${k2} cannot match`);\n\t\t\t}\n\t\t}\n\t},\n\tp = Parser.prototype;\n\np.parse = function(msg) {\n\treturn this.parseAST({msg: String(msg), i: 0}, null);\n}\n\np.parseAST = function(context, parent) {\n\tconst msg = context.msg,\n\t\topts = this.opts,\n\t\tlength = msg.length,\n\t\tspecial_hash = parent && opts[SUBNUM].includes(parent.t),\n\t\tout = [];\n\n\twhile ( context.i < length ) {\n\t\tconst start = context.i,\n\t\t\tchar = msg[start];\n\n\t\tif ( char === opts.CLOSE ) {\n\t\t\tif ( ! parent ) {\n\t\t\t\tmergePush(out, '}')\n\t\t\t\tcontext.i++;\n\t\t\t} else\n\t\t\t\tbreak;\n\n\t\t} else if ( char === opts.OPEN || (special_hash && char === opts.SUB_VAR) ) {\n\t\t\tmergePush(out, this.parseElement(context, parent));\n\n\t\t} else if ( opts.allowTags && char === opts.TAG_OPEN && ! SPACE.test(msg[start+1]) ) {\n\t\t\tconst element = this.parseTag(context, parent);\n\t\t\tif ( element === CLOSE_TAG ) {\n\t\t\t\tparent.closed = true;\n\t\t\t\tbreak;\n\t\t\t} else\n\t\t\t\tmergePush(out, element);\n\n\t\t} else\n\t\t\tmergePush(out, this.parseText(context, parent));\n\n\t\t// Infinite Loop Protection\n\t\t// This should never be triggered.\n\t\t/* istanbul ignore if */\n\t\tif ( context.i === start )\n\t\t\tthrow unexpected(char, context.i);\n\t}\n\n\treturn out;\n}\n\np.parseText = function(context, parent, include_separator = true, include_space = true, include_tags = false) {\n\tconst msg = context.msg,\n\t\topts = this.opts,\n\t\ttags = opts.allowTags,\n\t\tlength = msg.length,\n\t\tspecial_hash = parent && opts[SUBNUM].includes(parent.t);\n\n\tlet out = '';\n\n\twhile ( context.i < length ) {\n\t\tconst char = msg[context.i];\n\t\tif ( char === opts.OPEN ||\n\t\t\t\tchar === opts.CLOSE ||\n\t\t\t\t(tags && (char === opts.TAG_OPEN || (include_tags && (char === opts.TAG_CLOSE || char === opts.TAG_CLOSING)))) ||\n\t\t\t\t(!include_separator && char === opts.SEP) ||\n\t\t\t\t(!include_space && SPACE.test(char)) ||\n\t\t\t\t(special_hash && char === opts.SUB_VAR) )\n\t\t\tbreak;\n\n\t\tif ( char === opts.ESCAPE ) {\n\t\t\tlet next = msg[++context.i];\n\t\t\tif ( next === opts.ESCAPE ) {\n\t\t\t\t// Escaped Escape Character\n\t\t\t\tout += next;\n\t\t\t\tcontext.i++;\n\t\t\t} else if (\n\t\t\t\tnext === opts.OPEN ||\n\t\t\t\tnext === opts.CLOSE ||\n\t\t\t\t(tags && (next === opts.TAG_OPEN || (include_tags && (next === opts.TAG_CLOSE || next === opts.TAG_CLOSING)))) ||\n\t\t\t\t(special_hash && next === opts.SUB_VAR) ||\n\t\t\t\t! include_space || ! include_separator\n\t\t\t) {\n\t\t\t\t// Special Character\n\t\t\t\t// Tags are only special when they're enabled.\n\t\t\t\t// Tag endings are only special inside open tags.\n\t\t\t\t// SUB_VAR is only special inside submessages.\n\t\t\t\t// Spaces and separators are only special inside placeholders.\n\t\t\t\tout += next;\n\t\t\t\twhile( ++context.i < length ) {\n\t\t\t\t\tnext = msg[context.i];\n\t\t\t\t\tif ( next === opts.ESCAPE ) {\n\t\t\t\t\t\t// Check for an escaped escape character, and don't\n\t\t\t\t\t\t// stop if we encounter one.\n\t\t\t\t\t\tnext = msg[context.i + 1];\n\t\t\t\t\t\tif ( next === opts.ESCAPE ) {\n\t\t\t\t\t\t\tout += next;\n\t\t\t\t\t\t\tcontext.i++;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontext.i++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else\n\t\t\t\t\t\tout += next;\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tout += char;\n\n\t\t} else {\n\t\t\tcontext.i++;\n\t\t\tout += char;\n\t\t}\n\t}\n\n\treturn out;\n}\n\np.parseTag = function(context, parent) {\n\tconst msg = context.msg,\n\t\tstart = context.i,\n\t\topts = this.opts;\n\n\tcontext.i++;\n\tlet char = msg[context.i];\n\n\t// Closing Tag?\n\tlet closing = false;\n\tif ( char === opts.TAG_CLOSING ) {\n\t\tif ( ! parent || ! parent.n )\n\t\t\tthrow unexpected(char, context.i);\n\t\tclosing = true;\n\t\tcontext.i++;\n\t\tskipSpace(context);\n\t}\n\n\t// Name\n\tconst name = this.parseText(context, null, false, false, true);\n\tif ( ! name )\n\t\treturn msg.slice(start, context.i);\n\n\tskipSpace(context);\n\tchar = msg[context.i];\n\n\tif ( closing ) {\n\t\tif ( char !== opts.TAG_CLOSE )\n\t\t\tthrow expected(opts.TAG_CLOSE, char, context.i);\n\n\t\tif ( name !== parent.n )\n\t\t\tthrow unexpected('tag mismatch', start);\n\n\t\tcontext.i++;\n\t\treturn CLOSE_TAG;\n\t}\n\n\tclosing = false;\n\tif ( char === opts.TAG_CLOSING ) {\n\t\tclosing = true;\n\t\tcontext.i++;\n\t\tchar = msg[context.i];\n\t}\n\n\tif ( char !== opts.TAG_CLOSE )\n\t\t// So long and thanks for all the fish.\n\t\treturn msg.slice(start, context.i);\n\n\tcontext.i++;\n\n\tconst tag = {\n\t\tn: name\n\t};\n\n\tif ( closing )\n\t\treturn tag;\n\n\tconst contents = this.parseAST(context, tag);\n\tif ( contents && contents.length )\n\t\ttag.c = contents;\n\n\tif ( ! tag.closed && context.i >= msg.length )\n\t\tthrow expected('closing tag', context);\n\n\tdelete tag.closed;\n\treturn tag;\n}\n\np.parseElement = function(context, parent) {\n\tconst msg = context.msg,\n\t\topts = this.opts,\n\t\tspecial_hash = parent && opts[SUBNUM].includes(parent.t);\n\n\tlet char = msg[context.i];\n\n\tif ( special_hash && char === opts.SUB_VAR ) {\n\t\tcontext.i++;\n\t\treturn {v: parent.v, t: 'number'}\n\t}\n\n\tcontext.i++;\n\tskipSpace(context);\n\n\t// ID\n\tconst id = this.parseText(context, null, false, false);\n\tif ( ! id )\n\t\tthrow expected('placeholder id', char, context.i);\n\n\tconst out = {v: id};\n\n\tskipSpace(context);\n\n\tchar = msg[context.i];\n\tif ( char === opts.CLOSE ) {\n\t\tcontext.i++;\n\t\treturn out;\n\n\t} else if ( char !== opts.SEP )\n\t\tthrow expected(`${opts.SEP} or ${opts.CLOSE}`, char, context.i);\n\n\tcontext.i++;\n\tskipSpace(context);\n\n\t// Type\n\tconst type = this.parseText(context, null, false, false);\n\tif ( ! type )\n\t\tthrow expected('type', context);\n\n\tout.t = type;\n\tskipSpace(context);\n\n\tchar = msg[context.i];\n\tif ( char === opts.CLOSE ) {\n\t\tif ( opts[SUBMSG].includes(out.t) )\n\t\t\tthrow expected('sub-messages', context);\n\n\t\tcontext.i++;\n\t\treturn out;\n\n\t} else if ( char !== opts.SEP )\n\t\tthrow expected(`${opts.SEP} or ${opts.CLOSE}`, char, context.i);\n\n\tcontext.i++;\n\tskipSpace(context);\n\n\t// Formatting\n\tif ( opts[SUBNUM].includes(out.t) ) {\n\t\tconst offset = this.parseOffset(context);\n\t\tif ( offset ) {\n\t\t\tout.f = offset;\n\t\t\tskipSpace(context);\n\t\t}\n\t}\n\n\tif ( opts[SUBMSG].includes(out.t) ) {\n\t\tconst submessages = this.parseSubmessages(context, out),\n\t\t\treq = opts.requireOther;\n\t\tif ( (Array.isArray(req) ? req.includes(out.t) : req) && ! submessages.other )\n\t\t\tthrow expected('other sub-message', context);\n\n\t\tout.o = submessages;\n\n\t} else {\n\t\tconst format = this.parseText(context, null, true, true);\n\t\tif ( ! format )\n\t\t\tthrow expected('format', context);\n\n\t\t// Since we allow spaces mid-format, we should trim any\n\t\t// remaining spaces off the end.\n\t\tout.f = format.trimRight();\n\t}\n\n\tskipSpace(context);\n\tchar = msg[context.i];\n\tif ( char !== opts.CLOSE )\n\t\tthrow expected(opts.CLOSE, char, context.i);\n\n\tcontext.i++;\n\treturn out;\n}\n\n\np.parseSubmessages = function(context, parent) {\n\tconst msg = context.msg,\n\t\tlength = msg.length,\n\t\tout = {};\n\n\twhile(context.i < length ) {\n\t\tconst char = msg[context.i];\n\t\tif ( char === this.opts.CLOSE )\n\t\t\tbreak;\n\n\t\tconst selector = this.parseText(context, null, true, false);\n\t\tif ( ! selector )\n\t\t\tthrow expected('sub-message selector', context);\n\n\t\tskipSpace(context);\n\t\tout[selector] = this.parseSubmessage(context, parent);\n\t\tskipSpace(context);\n\t}\n\n\treturn out;\n}\n\n\np.parseSubmessage = function(context, parent) {\n\tconst msg = context.msg,\n\t\topts = this.opts;\n\n\tif ( msg[context.i] !== opts.OPEN )\n\t\tthrow expected(opts.OPEN, context);\n\n\tcontext.i++;\n\tconst out = this.parseAST(context, parent);\n\n\tif ( msg[context.i] !== opts.CLOSE )\n\t\tthrow expected(opts.CLOSE, context);\n\n\tcontext.i++;\n\treturn out;\n}\n\n\np.parseOffset = function(context) {\n\tconst msg = context.msg,\n\t\tOFFSET = this.opts.OFFSET,\n\t\tlength = msg.length;\n\n\tif ( msg.slice(context.i, context.i + OFFSET.length) !== OFFSET )\n\t\treturn;\n\n\tcontext.i += OFFSET.length;\n\tskipSpace(context);\n\n\tconst start = context.i;\n\twhile(context.i < length && /[-\\d]/.test(msg[context.i]))\n\t\tcontext.i++;\n\n\tif ( start === context.i )\n\t\tthrow expected('number', context);\n\n\treturn +msg.slice(start, context.i);\n}\n\n\nfunction expected(char, found, index) {\n\tif ( typeof found === 'object' ) {\n\t\tindex = found.i;\n\t\tfound = found.msg[index];\n\t}\n\n\treturn new SyntaxError(`expected ${char} at position ${index} but found ${found || 'eof'}`);\n}\n\nfunction unexpected(char, index) {\n\treturn new SyntaxError(`unexpected ${char} at position ${index}`)\n}\n\nfunction skipSpace(context) {\n\tconst msg = context.msg,\n\t\tlength = msg.length;\n\n\twhile ( context.i < length && SPACE.test(msg[context.i]) )\n\t\tcontext.i++;\n}\n\nfunction mergePush(list, item) {\n\tconst l = list.length - 1;\n\tif ( typeof item === 'string' && typeof list[l] === 'string' )\n\t\tlist[l] += item;\n\telse\n\t\tlist.push(item);\n}\n","export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}","import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport { round } from \"../utils/math.js\";\n\nfunction isElementScaled(element) {\n  var rect = element.getBoundingClientRect();\n  var scaleX = round(rect.width) / element.offsetWidth || 1;\n  var scaleY = round(rect.height) / element.offsetHeight || 1;\n  return scaleX !== 1 || scaleY !== 1;\n} // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var offsetParentIsScaled = isHTMLElement(offsetParent) && isElementScaled(offsetParent);\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement, offsetParentIsScaled, isFixed);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent, true);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}","import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}","export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}","export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}","import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(setOptionsAction) {\n        var options = typeof setOptionsAction === 'function' ? setOptionsAction(state.options) : setOptionsAction;\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        });\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update  it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update  it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref) {\n        var name = _ref.name,\n            _ref$options = _ref.options,\n            options = _ref$options === void 0 ? {} : _ref$options,\n            effect = _ref.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };","import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}","import { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport { round } from \"../utils/math.js\";\nimport getWindow from \"./getWindow.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getBoundingClientRect(element, includeScale, isFixedStrategy) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n\n  var clientRect = element.getBoundingClientRect();\n  var scaleX = 1;\n  var scaleY = 1;\n\n  if (includeScale && isHTMLElement(element)) {\n    scaleX = element.offsetWidth > 0 ? round(clientRect.width) / element.offsetWidth || 1 : 1;\n    scaleY = element.offsetHeight > 0 ? round(clientRect.height) / element.offsetHeight || 1 : 1;\n  }\n\n  var _ref = isElement(element) ? getWindow(element) : window,\n      visualViewport = _ref.visualViewport;\n\n  var addVisualOffsets = !isLayoutViewport() && isFixedStrategy;\n  var x = (clientRect.left + (addVisualOffsets && visualViewport ? visualViewport.offsetLeft : 0)) / scaleX;\n  var y = (clientRect.top + (addVisualOffsets && visualViewport ? visualViewport.offsetTop : 0)) / scaleY;\n  var width = clientRect.width / scaleX;\n  var height = clientRect.height / scaleY;\n  return {\n    width: width,\n    height: height,\n    top: y,\n    right: x + width,\n    bottom: y + height,\n    left: x,\n    x: x,\n    y: y\n  };\n}","import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}","import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}","export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}","import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}","import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement, isShadowRoot } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getUAString from \"../utils/userAgent.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = /firefox/i.test(getUAString());\n  var isIE = /Trident/i.test(getUAString());\n\n  if (isIE && isHTMLElement(element)) {\n    // In IE 9, 10 and 11 fixed elements containing block is always established by the viewport\n    var elementCss = getComputedStyle(element);\n\n    if (elementCss.position === 'fixed') {\n      return null;\n    }\n  }\n\n  var currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}","import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}","export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}","import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}","import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}","import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };","import getUAString from \"../utils/userAgent.js\";\nexport default function isLayoutViewport() {\n  return !/^((?!chrome|android).)*safari/i.test(getUAString());\n}","import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}","import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}","import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}","export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];","import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport { within } from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};","import { top, left, right, bottom, end } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref, win) {\n  var x = _ref.x,\n      y = _ref.y;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(x * dpr) / dpr || 0,\n    y: round(y * dpr) / dpr || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      variation = _ref2.variation,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets,\n      isFixed = _ref2.isFixed;\n  var _offsets$x = offsets.x,\n      x = _offsets$x === void 0 ? 0 : _offsets$x,\n      _offsets$y = offsets.y,\n      y = _offsets$y === void 0 ? 0 : _offsets$y;\n\n  var _ref3 = typeof roundOffsets === 'function' ? roundOffsets({\n    x: x,\n    y: y\n  }) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref3.x;\n  y = _ref3.y;\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static' && position === 'absolute') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top || (placement === left || placement === right) && variation === end) {\n      sideY = bottom;\n      var offsetY = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.height : // $FlowFixMe[prop-missing]\n      offsetParent[heightProp];\n      y -= offsetY - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left || (placement === top || placement === bottom) && variation === end) {\n      sideX = right;\n      var offsetX = isFixed && offsetParent === win && win.visualViewport ? win.visualViewport.width : // $FlowFixMe[prop-missing]\n      offsetParent[widthProp];\n      x -= offsetX - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  var _ref4 = roundOffsets === true ? roundOffsetsByDPR({\n    x: x,\n    y: y\n  }, getWindow(popper)) : {\n    x: x,\n    y: y\n  };\n\n  x = _ref4.x;\n  y = _ref4.y;\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) <= 1 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref5) {\n  var state = _ref5.state,\n      options = _ref5.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    variation: getVariation(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration,\n    isFixed: state.options.strategy === 'fixed'\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};","import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};","var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}","var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}","import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}","import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases  research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};","import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};","import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};","import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};","export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}","import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport { within, withinMaxClamp } from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { min as mathMin, max as mathMax } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var normalizedTetherOffsetValue = typeof tetherOffsetValue === 'number' ? {\n    mainAxis: tetherOffsetValue,\n    altAxis: tetherOffsetValue\n  } : Object.assign({\n    mainAxis: 0,\n    altAxis: 0\n  }, tetherOffsetValue);\n  var offsetModifierState = state.modifiersData.offset ? state.modifiersData.offset[state.placement] : null;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis) {\n    var _offsetModifierState$;\n\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = offset + overflow[mainSide];\n    var max = offset - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis : minLen - arrowLen - arrowPaddingMin - normalizedTetherOffsetValue.mainAxis;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis : maxLen + arrowLen + arrowPaddingMax + normalizedTetherOffsetValue.mainAxis;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = (_offsetModifierState$ = offsetModifierState == null ? void 0 : offsetModifierState[mainAxis]) != null ? _offsetModifierState$ : 0;\n    var tetherMin = offset + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = offset + maxOffset - offsetModifierValue;\n    var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n    popperOffsets[mainAxis] = preventedOffset;\n    data[mainAxis] = preventedOffset - offset;\n  }\n\n  if (checkAltAxis) {\n    var _offsetModifierState$2;\n\n    var _mainSide = mainAxis === 'x' ? top : left;\n\n    var _altSide = mainAxis === 'x' ? bottom : right;\n\n    var _offset = popperOffsets[altAxis];\n\n    var _len = altAxis === 'y' ? 'height' : 'width';\n\n    var _min = _offset + overflow[_mainSide];\n\n    var _max = _offset - overflow[_altSide];\n\n    var isOriginSide = [top, left].indexOf(basePlacement) !== -1;\n\n    var _offsetModifierValue = (_offsetModifierState$2 = offsetModifierState == null ? void 0 : offsetModifierState[altAxis]) != null ? _offsetModifierState$2 : 0;\n\n    var _tetherMin = isOriginSide ? _min : _offset - referenceRect[_len] - popperRect[_len] - _offsetModifierValue + normalizedTetherOffsetValue.altAxis;\n\n    var _tetherMax = isOriginSide ? _offset + referenceRect[_len] + popperRect[_len] - _offsetModifierValue - normalizedTetherOffsetValue.altAxis : _max;\n\n    var _preventedOffset = tether && isOriginSide ? withinMaxClamp(_tetherMin, _offset, _tetherMax) : within(tether ? _tetherMin : _min, _offset, tether ? _tetherMax : _max);\n\n    popperOffsets[altAxis] = _preventedOffset;\n    data[altAxis] = _preventedOffset - _offset;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};","import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";","import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}","import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport isLayoutViewport from \"./isLayoutViewport.js\";\nexport default function getViewportRect(element, strategy) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0;\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    var layoutViewport = isLayoutViewport();\n\n    if (layoutViewport || !layoutViewport && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}","import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}","export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}","import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element, strategy) {\n  var rect = getBoundingClientRect(element, false, strategy === 'fixed');\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent, strategy) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element, strategy)) : isElement(clippingParent) ? getInnerBoundingClientRect(clippingParent, strategy) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary, strategy) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent, strategy));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}","import getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$strategy = _options.strategy,\n      strategy = _options$strategy === void 0 ? state.strategy : _options$strategy,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary, strategy);\n  var referenceClientRect = getBoundingClientRect(state.elements.reference);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}","export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}","import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}","export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}","export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}","export default function getVariation(placement) {\n  return placement.split('-')[1];\n}","export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;","import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}","export default function getUAString() {\n  var uaData = navigator.userAgentData;\n\n  if (uaData != null && uaData.brands && Array.isArray(uaData.brands)) {\n    return uaData.brands.map(function (item) {\n      return item.brand + \"/\" + item.version;\n    }).join(' ');\n  }\n\n  return navigator.userAgent;\n}","import { max as mathMax, min as mathMin } from \"./math.js\";\nexport function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}\nexport function withinMaxClamp(min, value, max) {\n  var v = within(min, value, max);\n  return v > max ? max : v;\n}",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory();\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\troot.CryptoJS = factory();\n\t}\n}(this, function () {\n\n\t/*globals window, global, require*/\n\n\t/**\n\t * CryptoJS core components.\n\t */\n\tvar CryptoJS = CryptoJS || (function (Math, undefined) {\n\n\t    var crypto;\n\n\t    // Native crypto from window (Browser)\n\t    if (typeof window !== 'undefined' && window.crypto) {\n\t        crypto = window.crypto;\n\t    }\n\n\t    // Native crypto in web worker (Browser)\n\t    if (typeof self !== 'undefined' && self.crypto) {\n\t        crypto = self.crypto;\n\t    }\n\n\t    // Native crypto from worker\n\t    if (typeof globalThis !== 'undefined' && globalThis.crypto) {\n\t        crypto = globalThis.crypto;\n\t    }\n\n\t    // Native (experimental IE 11) crypto from window (Browser)\n\t    if (!crypto && typeof window !== 'undefined' && window.msCrypto) {\n\t        crypto = window.msCrypto;\n\t    }\n\n\t    // Native crypto from global (NodeJS)\n\t    if (!crypto && typeof global !== 'undefined' && global.crypto) {\n\t        crypto = global.crypto;\n\t    }\n\n\t    // Native crypto import via require (NodeJS)\n\t    if (!crypto && typeof require === 'function') {\n\t        try {\n\t            crypto = require('crypto');\n\t        } catch (err) {}\n\t    }\n\n\t    /*\n\t     * Cryptographically secure pseudorandom number generator\n\t     *\n\t     * As Math.random() is cryptographically not safe to use\n\t     */\n\t    var cryptoSecureRandomInt = function () {\n\t        if (crypto) {\n\t            // Use getRandomValues method (Browser)\n\t            if (typeof crypto.getRandomValues === 'function') {\n\t                try {\n\t                    return crypto.getRandomValues(new Uint32Array(1))[0];\n\t                } catch (err) {}\n\t            }\n\n\t            // Use randomBytes method (NodeJS)\n\t            if (typeof crypto.randomBytes === 'function') {\n\t                try {\n\t                    return crypto.randomBytes(4).readInt32LE();\n\t                } catch (err) {}\n\t            }\n\t        }\n\n\t        throw new Error('Native crypto module could not be used to get secure random number.');\n\t    };\n\n\t    /*\n\t     * Local polyfill of Object.create\n\n\t     */\n\t    var create = Object.create || (function () {\n\t        function F() {}\n\n\t        return function (obj) {\n\t            var subtype;\n\n\t            F.prototype = obj;\n\n\t            subtype = new F();\n\n\t            F.prototype = null;\n\n\t            return subtype;\n\t        };\n\t    }());\n\n\t    /**\n\t     * CryptoJS namespace.\n\t     */\n\t    var C = {};\n\n\t    /**\n\t     * Library namespace.\n\t     */\n\t    var C_lib = C.lib = {};\n\n\t    /**\n\t     * Base object for prototypal inheritance.\n\t     */\n\t    var Base = C_lib.Base = (function () {\n\n\n\t        return {\n\t            /**\n\t             * Creates a new object that inherits from this object.\n\t             *\n\t             * @param {Object} overrides Properties to copy into the new object.\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         field: 'value',\n\t             *\n\t             *         method: function () {\n\t             *         }\n\t             *     });\n\t             */\n\t            extend: function (overrides) {\n\t                // Spawn\n\t                var subtype = create(this);\n\n\t                // Augment\n\t                if (overrides) {\n\t                    subtype.mixIn(overrides);\n\t                }\n\n\t                // Create default initializer\n\t                if (!subtype.hasOwnProperty('init') || this.init === subtype.init) {\n\t                    subtype.init = function () {\n\t                        subtype.$super.init.apply(this, arguments);\n\t                    };\n\t                }\n\n\t                // Initializer's prototype is the subtype object\n\t                subtype.init.prototype = subtype;\n\n\t                // Reference supertype\n\t                subtype.$super = this;\n\n\t                return subtype;\n\t            },\n\n\t            /**\n\t             * Extends this object and runs the init method.\n\t             * Arguments to create() will be passed to init().\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var instance = MyType.create();\n\t             */\n\t            create: function () {\n\t                var instance = this.extend();\n\t                instance.init.apply(instance, arguments);\n\n\t                return instance;\n\t            },\n\n\t            /**\n\t             * Initializes a newly created object.\n\t             * Override this method to add some logic when your objects are created.\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         init: function () {\n\t             *             // ...\n\t             *         }\n\t             *     });\n\t             */\n\t            init: function () {\n\t            },\n\n\t            /**\n\t             * Copies properties into this object.\n\t             *\n\t             * @param {Object} properties The properties to mix in.\n\t             *\n\t             * @example\n\t             *\n\t             *     MyType.mixIn({\n\t             *         field: 'value'\n\t             *     });\n\t             */\n\t            mixIn: function (properties) {\n\t                for (var propertyName in properties) {\n\t                    if (properties.hasOwnProperty(propertyName)) {\n\t                        this[propertyName] = properties[propertyName];\n\t                    }\n\t                }\n\n\t                // IE won't copy toString using the loop above\n\t                if (properties.hasOwnProperty('toString')) {\n\t                    this.toString = properties.toString;\n\t                }\n\t            },\n\n\t            /**\n\t             * Creates a copy of this object.\n\t             *\n\t             * @return {Object} The clone.\n\t             *\n\t             * @example\n\t             *\n\t             *     var clone = instance.clone();\n\t             */\n\t            clone: function () {\n\t                return this.init.prototype.extend(this);\n\t            }\n\t        };\n\t    }());\n\n\t    /**\n\t     * An array of 32-bit words.\n\t     *\n\t     * @property {Array} words The array of 32-bit words.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var WordArray = C_lib.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of 32-bit words.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.create();\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607]);\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607], 6);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 4;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this word array to a string.\n\t         *\n\t         * @param {Encoder} encoder (Optional) The encoding strategy to use. Default: CryptoJS.enc.Hex\n\t         *\n\t         * @return {string} The stringified word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var string = wordArray + '';\n\t         *     var string = wordArray.toString();\n\t         *     var string = wordArray.toString(CryptoJS.enc.Utf8);\n\t         */\n\t        toString: function (encoder) {\n\t            return (encoder || Hex).stringify(this);\n\t        },\n\n\t        /**\n\t         * Concatenates a word array to this word array.\n\t         *\n\t         * @param {WordArray} wordArray The word array to append.\n\t         *\n\t         * @return {WordArray} This word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray1.concat(wordArray2);\n\t         */\n\t        concat: function (wordArray) {\n\t            // Shortcuts\n\t            var thisWords = this.words;\n\t            var thatWords = wordArray.words;\n\t            var thisSigBytes = this.sigBytes;\n\t            var thatSigBytes = wordArray.sigBytes;\n\n\t            // Clamp excess bits\n\t            this.clamp();\n\n\t            // Concat\n\t            if (thisSigBytes % 4) {\n\t                // Copy one byte at a time\n\t                for (var i = 0; i < thatSigBytes; i++) {\n\t                    var thatByte = (thatWords[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                    thisWords[(thisSigBytes + i) >>> 2] |= thatByte << (24 - ((thisSigBytes + i) % 4) * 8);\n\t                }\n\t            } else {\n\t                // Copy one word at a time\n\t                for (var j = 0; j < thatSigBytes; j += 4) {\n\t                    thisWords[(thisSigBytes + j) >>> 2] = thatWords[j >>> 2];\n\t                }\n\t            }\n\t            this.sigBytes += thatSigBytes;\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Removes insignificant bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray.clamp();\n\t         */\n\t        clamp: function () {\n\t            // Shortcuts\n\t            var words = this.words;\n\t            var sigBytes = this.sigBytes;\n\n\t            // Clamp\n\t            words[sigBytes >>> 2] &= 0xffffffff << (32 - (sigBytes % 4) * 8);\n\t            words.length = Math.ceil(sigBytes / 4);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = wordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone.words = this.words.slice(0);\n\n\t            return clone;\n\t        },\n\n\t        /**\n\t         * Creates a word array filled with random bytes.\n\t         *\n\t         * @param {number} nBytes The number of random bytes to generate.\n\t         *\n\t         * @return {WordArray} The random word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.random(16);\n\t         */\n\t        random: function (nBytes) {\n\t            var words = [];\n\n\t            for (var i = 0; i < nBytes; i += 4) {\n\t                words.push(cryptoSecureRandomInt());\n\t            }\n\n\t            return new WordArray.init(words, nBytes);\n\t        }\n\t    });\n\n\t    /**\n\t     * Encoder namespace.\n\t     */\n\t    var C_enc = C.enc = {};\n\n\t    /**\n\t     * Hex encoding strategy.\n\t     */\n\t    var Hex = C_enc.Hex = {\n\t        /**\n\t         * Converts a word array to a hex string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The hex string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var hexString = CryptoJS.enc.Hex.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var hexChars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                hexChars.push((bite >>> 4).toString(16));\n\t                hexChars.push((bite & 0x0f).toString(16));\n\t            }\n\n\t            return hexChars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a hex string to a word array.\n\t         *\n\t         * @param {string} hexStr The hex string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Hex.parse(hexString);\n\t         */\n\t        parse: function (hexStr) {\n\t            // Shortcut\n\t            var hexStrLength = hexStr.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < hexStrLength; i += 2) {\n\t                words[i >>> 3] |= parseInt(hexStr.substr(i, 2), 16) << (24 - (i % 8) * 4);\n\t            }\n\n\t            return new WordArray.init(words, hexStrLength / 2);\n\t        }\n\t    };\n\n\t    /**\n\t     * Latin1 encoding strategy.\n\t     */\n\t    var Latin1 = C_enc.Latin1 = {\n\t        /**\n\t         * Converts a word array to a Latin1 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Latin1 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var latin1String = CryptoJS.enc.Latin1.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var latin1Chars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                latin1Chars.push(String.fromCharCode(bite));\n\t            }\n\n\t            return latin1Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Latin1 string to a word array.\n\t         *\n\t         * @param {string} latin1Str The Latin1 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Latin1.parse(latin1String);\n\t         */\n\t        parse: function (latin1Str) {\n\t            // Shortcut\n\t            var latin1StrLength = latin1Str.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < latin1StrLength; i++) {\n\t                words[i >>> 2] |= (latin1Str.charCodeAt(i) & 0xff) << (24 - (i % 4) * 8);\n\t            }\n\n\t            return new WordArray.init(words, latin1StrLength);\n\t        }\n\t    };\n\n\t    /**\n\t     * UTF-8 encoding strategy.\n\t     */\n\t    var Utf8 = C_enc.Utf8 = {\n\t        /**\n\t         * Converts a word array to a UTF-8 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The UTF-8 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var utf8String = CryptoJS.enc.Utf8.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            try {\n\t                return decodeURIComponent(escape(Latin1.stringify(wordArray)));\n\t            } catch (e) {\n\t                throw new Error('Malformed UTF-8 data');\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts a UTF-8 string to a word array.\n\t         *\n\t         * @param {string} utf8Str The UTF-8 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Utf8.parse(utf8String);\n\t         */\n\t        parse: function (utf8Str) {\n\t            return Latin1.parse(unescape(encodeURIComponent(utf8Str)));\n\t        }\n\t    };\n\n\t    /**\n\t     * Abstract buffered block algorithm template.\n\t     *\n\t     * The property blockSize must be implemented in a concrete subtype.\n\t     *\n\t     * @property {number} _minBufferSize The number of blocks that should be kept unprocessed in the buffer. Default: 0\n\t     */\n\t    var BufferedBlockAlgorithm = C_lib.BufferedBlockAlgorithm = Base.extend({\n\t        /**\n\t         * Resets this block algorithm's data buffer to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm.reset();\n\t         */\n\t        reset: function () {\n\t            // Initial values\n\t            this._data = new WordArray.init();\n\t            this._nDataBytes = 0;\n\t        },\n\n\t        /**\n\t         * Adds new data to this block algorithm's buffer.\n\t         *\n\t         * @param {WordArray|string} data The data to append. Strings are converted to a WordArray using UTF-8.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm._append('data');\n\t         *     bufferedBlockAlgorithm._append(wordArray);\n\t         */\n\t        _append: function (data) {\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof data == 'string') {\n\t                data = Utf8.parse(data);\n\t            }\n\n\t            // Append\n\t            this._data.concat(data);\n\t            this._nDataBytes += data.sigBytes;\n\t        },\n\n\t        /**\n\t         * Processes available data blocks.\n\t         *\n\t         * This method invokes _doProcessBlock(offset), which must be implemented by a concrete subtype.\n\t         *\n\t         * @param {boolean} doFlush Whether all blocks and partial blocks should be processed.\n\t         *\n\t         * @return {WordArray} The processed data.\n\t         *\n\t         * @example\n\t         *\n\t         *     var processedData = bufferedBlockAlgorithm._process();\n\t         *     var processedData = bufferedBlockAlgorithm._process(!!'flush');\n\t         */\n\t        _process: function (doFlush) {\n\t            var processedWords;\n\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\t            var dataSigBytes = data.sigBytes;\n\t            var blockSize = this.blockSize;\n\t            var blockSizeBytes = blockSize * 4;\n\n\t            // Count blocks ready\n\t            var nBlocksReady = dataSigBytes / blockSizeBytes;\n\t            if (doFlush) {\n\t                // Round up to include partial blocks\n\t                nBlocksReady = Math.ceil(nBlocksReady);\n\t            } else {\n\t                // Round down to include only full blocks,\n\t                // less the number of blocks that must remain in the buffer\n\t                nBlocksReady = Math.max((nBlocksReady | 0) - this._minBufferSize, 0);\n\t            }\n\n\t            // Count words ready\n\t            var nWordsReady = nBlocksReady * blockSize;\n\n\t            // Count bytes ready\n\t            var nBytesReady = Math.min(nWordsReady * 4, dataSigBytes);\n\n\t            // Process blocks\n\t            if (nWordsReady) {\n\t                for (var offset = 0; offset < nWordsReady; offset += blockSize) {\n\t                    // Perform concrete-algorithm logic\n\t                    this._doProcessBlock(dataWords, offset);\n\t                }\n\n\t                // Remove processed words\n\t                processedWords = dataWords.splice(0, nWordsReady);\n\t                data.sigBytes -= nBytesReady;\n\t            }\n\n\t            // Return processed words\n\t            return new WordArray.init(processedWords, nBytesReady);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this object.\n\t         *\n\t         * @return {Object} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = bufferedBlockAlgorithm.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone._data = this._data.clone();\n\n\t            return clone;\n\t        },\n\n\t        _minBufferSize: 0\n\t    });\n\n\t    /**\n\t     * Abstract hasher template.\n\t     *\n\t     * @property {number} blockSize The number of 32-bit words this hasher operates on. Default: 16 (512 bits)\n\t     */\n\t    var Hasher = C_lib.Hasher = BufferedBlockAlgorithm.extend({\n\t        /**\n\t         * Configuration options.\n\t         */\n\t        cfg: Base.extend(),\n\n\t        /**\n\t         * Initializes a newly created hasher.\n\t         *\n\t         * @param {Object} cfg (Optional) The configuration options to use for this hash computation.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hasher = CryptoJS.algo.SHA256.create();\n\t         */\n\t        init: function (cfg) {\n\t            // Apply config defaults\n\t            this.cfg = this.cfg.extend(cfg);\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this hasher to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Reset data buffer\n\t            BufferedBlockAlgorithm.reset.call(this);\n\n\t            // Perform concrete-hasher logic\n\t            this._doReset();\n\t        },\n\n\t        /**\n\t         * Updates this hasher with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {Hasher} This hasher.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.update('message');\n\t         *     hasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            // Append\n\t            this._append(messageUpdate);\n\n\t            // Update the hash\n\t            this._process();\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the hash computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The hash.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hash = hasher.finalize();\n\t         *     var hash = hasher.finalize('message');\n\t         *     var hash = hasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Final message update\n\t            if (messageUpdate) {\n\t                this._append(messageUpdate);\n\t            }\n\n\t            // Perform concrete-hasher logic\n\t            var hash = this._doFinalize();\n\n\t            return hash;\n\t        },\n\n\t        blockSize: 512/32,\n\n\t        /**\n\t         * Creates a shortcut function to a hasher's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to create a helper for.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var SHA256 = CryptoJS.lib.Hasher._createHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHelper: function (hasher) {\n\t            return function (message, cfg) {\n\t                return new hasher.init(cfg).finalize(message);\n\t            };\n\t        },\n\n\t        /**\n\t         * Creates a shortcut function to the HMAC's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to use in this HMAC helper.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var HmacSHA256 = CryptoJS.lib.Hasher._createHmacHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHmacHelper: function (hasher) {\n\t            return function (message, key) {\n\t                return new C_algo.HMAC.init(hasher, key).finalize(message);\n\t            };\n\t        }\n\t    });\n\n\t    /**\n\t     * Algorithm namespace.\n\t     */\n\t    var C_algo = C.algo = {};\n\n\t    return C;\n\t}(Math));\n\n\n\treturn CryptoJS;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_algo = C.algo;\n\n\t    // Reusable object\n\t    var W = [];\n\n\t    /**\n\t     * SHA-1 hash algorithm.\n\t     */\n\t    var SHA1 = C_algo.SHA1 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new WordArray.init([\n\t                0x67452301, 0xefcdab89,\n\t                0x98badcfe, 0x10325476,\n\t                0xc3d2e1f0\n\t            ]);\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcut\n\t            var H = this._hash.words;\n\n\t            // Working variables\n\t            var a = H[0];\n\t            var b = H[1];\n\t            var c = H[2];\n\t            var d = H[3];\n\t            var e = H[4];\n\n\t            // Computation\n\t            for (var i = 0; i < 80; i++) {\n\t                if (i < 16) {\n\t                    W[i] = M[offset + i] | 0;\n\t                } else {\n\t                    var n = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n\t                    W[i] = (n << 1) | (n >>> 31);\n\t                }\n\n\t                var t = ((a << 5) | (a >>> 27)) + e + W[i];\n\t                if (i < 20) {\n\t                    t += ((b & c) | (~b & d)) + 0x5a827999;\n\t                } else if (i < 40) {\n\t                    t += (b ^ c ^ d) + 0x6ed9eba1;\n\t                } else if (i < 60) {\n\t                    t += ((b & c) | (b & d) | (c & d)) - 0x70e44324;\n\t                } else /* if (i < 80) */ {\n\t                    t += (b ^ c ^ d) - 0x359d3e2a;\n\t                }\n\n\t                e = d;\n\t                d = c;\n\t                c = (b << 30) | (b >>> 2);\n\t                b = a;\n\t                a = t;\n\t            }\n\n\t            // Intermediate hash value\n\t            H[0] = (H[0] + a) | 0;\n\t            H[1] = (H[1] + b) | 0;\n\t            H[2] = (H[2] + c) | 0;\n\t            H[3] = (H[3] + d) | 0;\n\t            H[4] = (H[4] + e) | 0;\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 14] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Return final computed hash\n\t            return this._hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        }\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA1('message');\n\t     *     var hash = CryptoJS.SHA1(wordArray);\n\t     */\n\t    C.SHA1 = Hasher._createHelper(SHA1);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA1(message, key);\n\t     */\n\t    C.HmacSHA1 = Hasher._createHmacHelper(SHA1);\n\t}());\n\n\n\treturn CryptoJS.SHA1;\n\n}));","!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(t=\"undefined\"!=typeof globalThis?globalThis:t||self).dayjs=e()}(this,(function(){\"use strict\";var t=1e3,e=6e4,n=36e5,r=\"millisecond\",i=\"second\",s=\"minute\",u=\"hour\",a=\"day\",o=\"week\",f=\"month\",h=\"quarter\",c=\"year\",d=\"date\",$=\"Invalid Date\",l=/^(\\d{4})[-/]?(\\d{1,2})?[-/]?(\\d{0,2})[Tt\\s]*(\\d{1,2})?:?(\\d{1,2})?:?(\\d{1,2})?[.:]?(\\d+)?$/,y=/\\[([^\\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:\"en\",weekdays:\"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday\".split(\"_\"),months:\"January_February_March_April_May_June_July_August_September_October_November_December\".split(\"_\")},m=function(t,e,n){var r=String(t);return!r||r.length>=e?t:\"\"+Array(e+1-r.length).join(n)+t},g={s:m,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?\"+\":\"-\")+m(r,2,\"0\")+\":\"+m(i,2,\"0\")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,f),s=n-i<0,u=e.clone().add(r+(s?-1:1),f);return+(-(r+(n-i)/(s?i-u:u-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:f,y:c,w:o,d:a,D:d,h:u,m:s,s:i,ms:r,Q:h}[t]||String(t||\"\").toLowerCase().replace(/s$/,\"\")},u:function(t){return void 0===t}},D=\"en\",v={};v[D]=M;var p=function(t){return t instanceof _},S=function(t,e,n){var r;if(!t)return D;if(\"string\"==typeof t)v[t]&&(r=t),e&&(v[t]=e,r=t);else{var i=t.name;v[i]=t,r=i}return!n&&r&&(D=r),r||!n&&D},w=function(t,e){if(p(t))return t.clone();var n=\"object\"==typeof e?e:{};return n.date=t,n.args=arguments,new _(n)},O=g;O.l=S,O.i=p,O.w=function(t,e){return w(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var _=function(){function M(t){this.$L=S(t.locale,null,!0),this.parse(t)}var m=M.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(O.u(e))return new Date;if(e instanceof Date)return new Date(e);if(\"string\"==typeof e&&!/Z$/i.test(e)){var r=e.match(l);if(r){var i=r[2]-1||0,s=(r[7]||\"0\").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return O},m.isValid=function(){return!(this.$d.toString()===$)},m.isSame=function(t,e){var n=w(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return w(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<w(t)},m.$g=function(t,e,n){return O.u(t)?this[e]:this.set(n,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var n=this,r=!!O.u(e)||e,h=O.p(t),$=function(t,e){var i=O.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},l=function(t,e){return O.w(n.toDate()[t].apply(n.toDate(\"s\"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},y=this.$W,M=this.$M,m=this.$D,g=\"set\"+(this.$u?\"UTC\":\"\");switch(h){case c:return r?$(1,0):$(31,11);case f:return r?$(1,M):$(0,M+1);case o:var D=this.$locale().weekStart||0,v=(y<D?y+7:y)-D;return $(r?m-v:m+(6-v),M);case a:case d:return l(g+\"Hours\",0);case u:return l(g+\"Minutes\",1);case s:return l(g+\"Seconds\",2);case i:return l(g+\"Milliseconds\",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var n,o=O.p(t),h=\"set\"+(this.$u?\"UTC\":\"\"),$=(n={},n[a]=h+\"Date\",n[d]=h+\"Date\",n[f]=h+\"Month\",n[c]=h+\"FullYear\",n[u]=h+\"Hours\",n[s]=h+\"Minutes\",n[i]=h+\"Seconds\",n[r]=h+\"Milliseconds\",n)[o],l=o===a?this.$D+(e-this.$W):e;if(o===f||o===c){var y=this.clone().set(d,1);y.$d[$](l),y.init(),this.$d=y.set(d,Math.min(this.$D,y.daysInMonth())).$d}else $&&this.$d[$](l);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[O.p(t)]()},m.add=function(r,h){var d,$=this;r=Number(r);var l=O.p(h),y=function(t){var e=w($);return O.w(e.date(e.date()+Math.round(t*r)),$)};if(l===f)return this.set(f,this.$M+r);if(l===c)return this.set(c,this.$y+r);if(l===a)return y(1);if(l===o)return y(7);var M=(d={},d[s]=e,d[u]=n,d[i]=t,d)[l]||1,m=this.$d.getTime()+r*M;return O.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||$;var r=t||\"YYYY-MM-DDTHH:mm:ssZ\",i=O.z(this),s=this.$H,u=this.$m,a=this.$M,o=n.weekdays,f=n.months,h=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].substr(0,s)},c=function(t){return O.s(s%12||12,t,\"0\")},d=n.meridiem||function(t,e,n){var r=t<12?\"AM\":\"PM\";return n?r.toLowerCase():r},l={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:O.s(a+1,2,\"0\"),MMM:h(n.monthsShort,a,f,3),MMMM:h(f,a),D:this.$D,DD:O.s(this.$D,2,\"0\"),d:String(this.$W),dd:h(n.weekdaysMin,this.$W,o,2),ddd:h(n.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(s),HH:O.s(s,2,\"0\"),h:c(1),hh:c(2),a:d(s,u,!0),A:d(s,u,!1),m:String(u),mm:O.s(u,2,\"0\"),s:String(this.$s),ss:O.s(this.$s,2,\"0\"),SSS:O.s(this.$ms,3,\"0\"),Z:i};return r.replace(y,(function(t,e){return e||l[t]||i.replace(\":\",\"\")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(r,d,$){var l,y=O.p(d),M=w(r),m=(M.utcOffset()-this.utcOffset())*e,g=this-M,D=O.m(this,M);return D=(l={},l[c]=D/12,l[f]=D,l[h]=D/3,l[o]=(g-m)/6048e5,l[a]=(g-m)/864e5,l[u]=g/n,l[s]=g/e,l[i]=g/t,l)[y]||g,$?D:O.a(D)},m.daysInMonth=function(){return this.endOf(f).$D},m.$locale=function(){return v[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=S(t,e,!0);return r&&(n.$L=r),n},m.clone=function(){return O.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},M}(),b=_.prototype;return w.prototype=b,[[\"$ms\",r],[\"$s\",i],[\"$m\",s],[\"$H\",u],[\"$W\",a],[\"$M\",f],[\"$y\",c],[\"$D\",d]].forEach((function(t){b[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),w.extend=function(t,e){return t.$i||(t(e,_,w),t.$i=!0),w},w.locale=S,w.isDayjs=p,w.unix=function(t){return w(1e3*t)},w.en=v[D],w.Ls=v,w.p={},w}));","!function(r,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(r=\"undefined\"!=typeof globalThis?globalThis:r||self).dayjs_plugin_relativeTime=e()}(this,(function(){\"use strict\";return function(r,e,t){r=r||{};var n=e.prototype,o={future:\"in %s\",past:\"%s ago\",s:\"a few seconds\",m:\"a minute\",mm:\"%d minutes\",h:\"an hour\",hh:\"%d hours\",d:\"a day\",dd:\"%d days\",M:\"a month\",MM:\"%d months\",y:\"a year\",yy:\"%d years\"};function i(r,e,t,o){return n.fromToBase(r,e,t,o)}t.en.relativeTime=o,n.fromToBase=function(e,n,i,d,u){for(var f,a,s,l=i.$locale().relativeTime||o,h=r.thresholds||[{l:\"s\",r:44,d:\"second\"},{l:\"m\",r:89},{l:\"mm\",r:44,d:\"minute\"},{l:\"h\",r:89},{l:\"hh\",r:21,d:\"hour\"},{l:\"d\",r:35},{l:\"dd\",r:25,d:\"day\"},{l:\"M\",r:45},{l:\"MM\",r:10,d:\"month\"},{l:\"y\",r:17},{l:\"yy\",d:\"year\"}],m=h.length,c=0;c<m;c+=1){var y=h[c];y.d&&(f=d?t(e).diff(i,y.d,!0):i.diff(e,y.d,!0));var p=(r.rounding||Math.round)(Math.abs(f));if(s=f>0,p<=y.r||!y.r){p<=1&&c>0&&(y=h[c-1]);var v=l[y.l];u&&(p=u(\"\"+p)),a=\"string\"==typeof v?v.replace(\"%d\",p):v(p,n,y.l,s);break}}if(n)return a;var M=s?l.future:l.past;return\"function\"==typeof M?M(a):M.replace(\"%s\",a)},n.to=function(r,e){return i(r,e,this,!0)},n.from=function(r,e){return i(r,e,this)};var d=function(r){return r.$u?t.utc():t()};n.toNow=function(r){return this.to(d(this),r)},n.fromNow=function(r){return this.from(d(this),r)}}}));","\"use strict\";\n\nmodule.exports = () => {\n  // https://mths.be/emoji\n  return /\\u{1F3F4}\\u{E0067}\\u{E0062}(?:\\u{E0077}\\u{E006C}\\u{E0073}|\\u{E0073}\\u{E0063}\\u{E0074}|\\u{E0065}\\u{E006E}\\u{E0067})\\u{E007F}|(?:\\u{1F9D1}\\u{1F3FF}\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D)?\\u{1F9D1}|\\u{1F469}\\u{1F3FF}\\u200D\\u{1F91D}\\u200D[\\u{1F468}\\u{1F469}])[\\u{1F3FB}-\\u{1F3FE}]|(?:\\u{1F9D1}\\u{1F3FE}\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D)?\\u{1F9D1}|\\u{1F469}\\u{1F3FE}\\u200D\\u{1F91D}\\u200D[\\u{1F468}\\u{1F469}])[\\u{1F3FB}-\\u{1F3FD}\\u{1F3FF}]|(?:\\u{1F9D1}\\u{1F3FD}\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D)?\\u{1F9D1}|\\u{1F469}\\u{1F3FD}\\u200D\\u{1F91D}\\u200D[\\u{1F468}\\u{1F469}])[\\u{1F3FB}\\u{1F3FC}\\u{1F3FE}\\u{1F3FF}]|(?:\\u{1F9D1}\\u{1F3FC}\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D)?\\u{1F9D1}|\\u{1F469}\\u{1F3FC}\\u200D\\u{1F91D}\\u200D[\\u{1F468}\\u{1F469}])[\\u{1F3FB}\\u{1F3FD}-\\u{1F3FF}]|(?:\\u{1F9D1}\\u{1F3FB}\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D)?\\u{1F9D1}|\\u{1F469}\\u{1F3FB}\\u200D\\u{1F91D}\\u200D[\\u{1F468}\\u{1F469}])[\\u{1F3FC}-\\u{1F3FF}]|\\u{1F468}(?:\\u{1F3FB}(?:\\u200D(?:\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D\\u{1F468}[\\u{1F3FB}-\\u{1F3FF}]|\\u{1F468}[\\u{1F3FB}-\\u{1F3FF}])|\\u{1F91D}\\u200D\\u{1F468}[\\u{1F3FC}-\\u{1F3FF}]|[\\u2695\\u2696\\u2708]\\uFE0F|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]))?|[\\u{1F3FC}-\\u{1F3FF}]\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D\\u{1F468}[\\u{1F3FB}-\\u{1F3FF}]|\\u{1F468}[\\u{1F3FB}-\\u{1F3FF}])|\\u200D(?:\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D)?\\u{1F468}|[\\u{1F468}\\u{1F469}]\\u200D(?:\\u{1F466}\\u200D\\u{1F466}|\\u{1F467}\\u200D[\\u{1F466}\\u{1F467}])|\\u{1F466}\\u200D\\u{1F466}|\\u{1F467}\\u200D[\\u{1F466}\\u{1F467}]|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F3FF}\\u200D(?:\\u{1F91D}\\u200D\\u{1F468}[\\u{1F3FB}-\\u{1F3FE}]|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F3FE}\\u200D(?:\\u{1F91D}\\u200D\\u{1F468}[\\u{1F3FB}-\\u{1F3FD}\\u{1F3FF}]|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F3FD}\\u200D(?:\\u{1F91D}\\u200D\\u{1F468}[\\u{1F3FB}\\u{1F3FC}\\u{1F3FE}\\u{1F3FF}]|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F3FC}\\u200D(?:\\u{1F91D}\\u200D\\u{1F468}[\\u{1F3FB}\\u{1F3FD}-\\u{1F3FF}]|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|(?:\\u{1F3FF}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FE}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FD}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FC}\\u200D[\\u2695\\u2696\\u2708]|\\u200D[\\u2695\\u2696\\u2708])\\uFE0F|\\u200D(?:[\\u{1F468}\\u{1F469}]\\u200D[\\u{1F466}\\u{1F467}]|[\\u{1F466}\\u{1F467}])|\\u{1F3FF}|\\u{1F3FE}|\\u{1F3FD}|\\u{1F3FC})?|(?:\\u{1F469}(?:\\u{1F3FB}\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D[\\u{1F468}\\u{1F469}]|[\\u{1F468}\\u{1F469}])|[\\u{1F3FC}-\\u{1F3FF}]\\u200D\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D[\\u{1F468}\\u{1F469}]|[\\u{1F468}\\u{1F469}]))|\\u{1F9D1}[\\u{1F3FB}-\\u{1F3FF}]\\u200D\\u{1F91D}\\u200D\\u{1F9D1})[\\u{1F3FB}-\\u{1F3FF}]|\\u{1F469}\\u200D\\u{1F469}\\u200D(?:\\u{1F466}\\u200D\\u{1F466}|\\u{1F467}\\u200D[\\u{1F466}\\u{1F467}])|\\u{1F469}(?:\\u200D(?:\\u2764\\uFE0F\\u200D(?:\\u{1F48B}\\u200D[\\u{1F468}\\u{1F469}]|[\\u{1F468}\\u{1F469}])|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F3FF}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FE}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FD}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FC}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FB}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F9D1}(?:\\u200D(?:\\u{1F91D}\\u200D\\u{1F9D1}|[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F384}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F3FF}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F384}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FE}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F384}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FD}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F384}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FC}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F384}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}]|\\u{1F3FB}\\u200D[\\u{1F33E}\\u{1F373}\\u{1F37C}\\u{1F384}\\u{1F393}\\u{1F3A4}\\u{1F3A8}\\u{1F3EB}\\u{1F3ED}\\u{1F4BB}\\u{1F4BC}\\u{1F527}\\u{1F52C}\\u{1F680}\\u{1F692}\\u{1F9AF}-\\u{1F9B3}\\u{1F9BC}\\u{1F9BD}])|\\u{1F469}\\u200D\\u{1F466}\\u200D\\u{1F466}|\\u{1F469}\\u200D\\u{1F469}\\u200D[\\u{1F466}\\u{1F467}]|\\u{1F469}\\u200D\\u{1F467}\\u200D[\\u{1F466}\\u{1F467}]|(?:\\u{1F441}\\uFE0F\\u200D\\u{1F5E8}|\\u{1F9D1}(?:\\u{1F3FF}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FE}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FD}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FC}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FB}\\u200D[\\u2695\\u2696\\u2708]|\\u200D[\\u2695\\u2696\\u2708])|\\u{1F469}(?:\\u{1F3FF}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FE}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FD}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FC}\\u200D[\\u2695\\u2696\\u2708]|\\u{1F3FB}\\u200D[\\u2695\\u2696\\u2708]|\\u200D[\\u2695\\u2696\\u2708])|\\u{1F636}\\u200D\\u{1F32B}|\\u{1F3F3}\\uFE0F\\u200D\\u26A7|\\u{1F43B}\\u200D\\u2744|(?:[\\u{1F3C3}\\u{1F3C4}\\u{1F3CA}\\u{1F46E}\\u{1F470}\\u{1F471}\\u{1F473}\\u{1F477}\\u{1F481}\\u{1F482}\\u{1F486}\\u{1F487}\\u{1F645}-\\u{1F647}\\u{1F64B}\\u{1F64D}\\u{1F64E}\\u{1F6A3}\\u{1F6B4}-\\u{1F6B6}\\u{1F926}\\u{1F935}\\u{1F937}-\\u{1F939}\\u{1F93D}\\u{1F93E}\\u{1F9B8}\\u{1F9B9}\\u{1F9CD}-\\u{1F9CF}\\u{1F9D4}\\u{1F9D6}-\\u{1F9DD}][\\u{1F3FB}-\\u{1F3FF}]|[\\u{1F46F}\\u{1F93C}\\u{1F9DE}\\u{1F9DF}])\\u200D[\\u2640\\u2642]|[\\u26F9\\u{1F3CB}\\u{1F3CC}\\u{1F575}][\\uFE0F\\u{1F3FB}-\\u{1F3FF}]\\u200D[\\u2640\\u2642]|\\u{1F3F4}\\u200D\\u2620|[\\u{1F3C3}\\u{1F3C4}\\u{1F3CA}\\u{1F46E}\\u{1F470}\\u{1F471}\\u{1F473}\\u{1F477}\\u{1F481}\\u{1F482}\\u{1F486}\\u{1F487}\\u{1F645}-\\u{1F647}\\u{1F64B}\\u{1F64D}\\u{1F64E}\\u{1F6A3}\\u{1F6B4}-\\u{1F6B6}\\u{1F926}\\u{1F935}\\u{1F937}-\\u{1F939}\\u{1F93D}\\u{1F93E}\\u{1F9B8}\\u{1F9B9}\\u{1F9CD}-\\u{1F9CF}\\u{1F9D4}\\u{1F9D6}-\\u{1F9DD}]\\u200D[\\u2640\\u2642]|[\\xA9\\xAE\\u203C\\u2049\\u2122\\u2139\\u2194-\\u2199\\u21A9\\u21AA\\u2328\\u23CF\\u23ED-\\u23EF\\u23F1\\u23F2\\u23F8-\\u23FA\\u24C2\\u25AA\\u25AB\\u25B6\\u25C0\\u25FB\\u25FC\\u2600-\\u2604\\u260E\\u2611\\u2618\\u2620\\u2622\\u2623\\u2626\\u262A\\u262E\\u262F\\u2638-\\u263A\\u2640\\u2642\\u265F\\u2660\\u2663\\u2665\\u2666\\u2668\\u267B\\u267E\\u2692\\u2694-\\u2697\\u2699\\u269B\\u269C\\u26A0\\u26A7\\u26B0\\u26B1\\u26C8\\u26CF\\u26D1\\u26D3\\u26E9\\u26F0\\u26F1\\u26F4\\u26F7\\u26F8\\u2702\\u2708\\u2709\\u270F\\u2712\\u2714\\u2716\\u271D\\u2721\\u2733\\u2734\\u2744\\u2747\\u2763\\u27A1\\u2934\\u2935\\u2B05-\\u2B07\\u3030\\u303D\\u3297\\u3299\\u{1F170}\\u{1F171}\\u{1F17E}\\u{1F17F}\\u{1F202}\\u{1F237}\\u{1F321}\\u{1F324}-\\u{1F32C}\\u{1F336}\\u{1F37D}\\u{1F396}\\u{1F397}\\u{1F399}-\\u{1F39B}\\u{1F39E}\\u{1F39F}\\u{1F3CD}\\u{1F3CE}\\u{1F3D4}-\\u{1F3DF}\\u{1F3F5}\\u{1F3F7}\\u{1F43F}\\u{1F4FD}\\u{1F549}\\u{1F54A}\\u{1F56F}\\u{1F570}\\u{1F573}\\u{1F576}-\\u{1F579}\\u{1F587}\\u{1F58A}-\\u{1F58D}\\u{1F5A5}\\u{1F5A8}\\u{1F5B1}\\u{1F5B2}\\u{1F5BC}\\u{1F5C2}-\\u{1F5C4}\\u{1F5D1}-\\u{1F5D3}\\u{1F5DC}-\\u{1F5DE}\\u{1F5E1}\\u{1F5E3}\\u{1F5E8}\\u{1F5EF}\\u{1F5F3}\\u{1F5FA}\\u{1F6CB}\\u{1F6CD}-\\u{1F6CF}\\u{1F6E0}-\\u{1F6E5}\\u{1F6E9}\\u{1F6F0}\\u{1F6F3}])\\uFE0F|\\u{1F3F3}\\uFE0F\\u200D\\u{1F308}|\\u{1F469}\\u200D\\u{1F467}|\\u{1F469}\\u200D\\u{1F466}|\\u{1F635}\\u200D\\u{1F4AB}|\\u{1F62E}\\u200D\\u{1F4A8}|\\u{1F415}\\u200D\\u{1F9BA}|\\u{1F9D1}(?:\\u{1F3FF}|\\u{1F3FE}|\\u{1F3FD}|\\u{1F3FC}|\\u{1F3FB})?|\\u{1F469}(?:\\u{1F3FF}|\\u{1F3FE}|\\u{1F3FD}|\\u{1F3FC}|\\u{1F3FB})?|\\u{1F1FD}\\u{1F1F0}|\\u{1F1F6}\\u{1F1E6}|\\u{1F1F4}\\u{1F1F2}|\\u{1F408}\\u200D\\u2B1B|\\u2764\\uFE0F\\u200D[\\u{1F525}\\u{1FA79}]|\\u{1F441}\\uFE0F|\\u{1F3F3}\\uFE0F|\\u{1F1FF}[\\u{1F1E6}\\u{1F1F2}\\u{1F1FC}]|\\u{1F1FE}[\\u{1F1EA}\\u{1F1F9}]|\\u{1F1FC}[\\u{1F1EB}\\u{1F1F8}]|\\u{1F1FB}[\\u{1F1E6}\\u{1F1E8}\\u{1F1EA}\\u{1F1EC}\\u{1F1EE}\\u{1F1F3}\\u{1F1FA}]|\\u{1F1FA}[\\u{1F1E6}\\u{1F1EC}\\u{1F1F2}\\u{1F1F3}\\u{1F1F8}\\u{1F1FE}\\u{1F1FF}]|\\u{1F1F9}[\\u{1F1E6}\\u{1F1E8}\\u{1F1E9}\\u{1F1EB}-\\u{1F1ED}\\u{1F1EF}-\\u{1F1F4}\\u{1F1F7}\\u{1F1F9}\\u{1F1FB}\\u{1F1FC}\\u{1F1FF}]|\\u{1F1F8}[\\u{1F1E6}-\\u{1F1EA}\\u{1F1EC}-\\u{1F1F4}\\u{1F1F7}-\\u{1F1F9}\\u{1F1FB}\\u{1F1FD}-\\u{1F1FF}]|\\u{1F1F7}[\\u{1F1EA}\\u{1F1F4}\\u{1F1F8}\\u{1F1FA}\\u{1F1FC}]|\\u{1F1F5}[\\u{1F1E6}\\u{1F1EA}-\\u{1F1ED}\\u{1F1F0}-\\u{1F1F3}\\u{1F1F7}-\\u{1F1F9}\\u{1F1FC}\\u{1F1FE}]|\\u{1F1F3}[\\u{1F1E6}\\u{1F1E8}\\u{1F1EA}-\\u{1F1EC}\\u{1F1EE}\\u{1F1F1}\\u{1F1F4}\\u{1F1F5}\\u{1F1F7}\\u{1F1FA}\\u{1F1FF}]|\\u{1F1F2}[\\u{1F1E6}\\u{1F1E8}-\\u{1F1ED}\\u{1F1F0}-\\u{1F1FF}]|\\u{1F1F1}[\\u{1F1E6}-\\u{1F1E8}\\u{1F1EE}\\u{1F1F0}\\u{1F1F7}-\\u{1F1FB}\\u{1F1FE}]|\\u{1F1F0}[\\u{1F1EA}\\u{1F1EC}-\\u{1F1EE}\\u{1F1F2}\\u{1F1F3}\\u{1F1F5}\\u{1F1F7}\\u{1F1FC}\\u{1F1FE}\\u{1F1FF}]|\\u{1F1EF}[\\u{1F1EA}\\u{1F1F2}\\u{1F1F4}\\u{1F1F5}]|\\u{1F1EE}[\\u{1F1E8}-\\u{1F1EA}\\u{1F1F1}-\\u{1F1F4}\\u{1F1F6}-\\u{1F1F9}]|\\u{1F1ED}[\\u{1F1F0}\\u{1F1F2}\\u{1F1F3}\\u{1F1F7}\\u{1F1F9}\\u{1F1FA}]|\\u{1F1EC}[\\u{1F1E6}\\u{1F1E7}\\u{1F1E9}-\\u{1F1EE}\\u{1F1F1}-\\u{1F1F3}\\u{1F1F5}-\\u{1F1FA}\\u{1F1FC}\\u{1F1FE}]|\\u{1F1EB}[\\u{1F1EE}-\\u{1F1F0}\\u{1F1F2}\\u{1F1F4}\\u{1F1F7}]|\\u{1F1EA}[\\u{1F1E6}\\u{1F1E8}\\u{1F1EA}\\u{1F1EC}\\u{1F1ED}\\u{1F1F7}-\\u{1F1FA}]|\\u{1F1E9}[\\u{1F1EA}\\u{1F1EC}\\u{1F1EF}\\u{1F1F0}\\u{1F1F2}\\u{1F1F4}\\u{1F1FF}]|\\u{1F1E8}[\\u{1F1E6}\\u{1F1E8}\\u{1F1E9}\\u{1F1EB}-\\u{1F1EE}\\u{1F1F0}-\\u{1F1F5}\\u{1F1F7}\\u{1F1FA}-\\u{1F1FF}]|\\u{1F1E7}[\\u{1F1E6}\\u{1F1E7}\\u{1F1E9}-\\u{1F1EF}\\u{1F1F1}-\\u{1F1F4}\\u{1F1F6}-\\u{1F1F9}\\u{1F1FB}\\u{1F1FC}\\u{1F1FE}\\u{1F1FF}]|\\u{1F1E6}[\\u{1F1E8}-\\u{1F1EC}\\u{1F1EE}\\u{1F1F1}\\u{1F1F2}\\u{1F1F4}\\u{1F1F6}-\\u{1F1FA}\\u{1F1FC}\\u{1F1FD}\\u{1F1FF}]|[#\\*0-9]\\uFE0F\\u20E3|\\u2764\\uFE0F|[\\u{1F3C3}\\u{1F3C4}\\u{1F3CA}\\u{1F46E}\\u{1F470}\\u{1F471}\\u{1F473}\\u{1F477}\\u{1F481}\\u{1F482}\\u{1F486}\\u{1F487}\\u{1F645}-\\u{1F647}\\u{1F64B}\\u{1F64D}\\u{1F64E}\\u{1F6A3}\\u{1F6B4}-\\u{1F6B6}\\u{1F926}\\u{1F935}\\u{1F937}-\\u{1F939}\\u{1F93D}\\u{1F93E}\\u{1F9B8}\\u{1F9B9}\\u{1F9CD}-\\u{1F9CF}\\u{1F9D4}\\u{1F9D6}-\\u{1F9DD}][\\u{1F3FB}-\\u{1F3FF}]|[\\u26F9\\u{1F3CB}\\u{1F3CC}\\u{1F575}][\\uFE0F\\u{1F3FB}-\\u{1F3FF}]|\\u{1F3F4}|[\\u270A\\u270B\\u{1F385}\\u{1F3C2}\\u{1F3C7}\\u{1F442}\\u{1F443}\\u{1F446}-\\u{1F450}\\u{1F466}\\u{1F467}\\u{1F46B}-\\u{1F46D}\\u{1F472}\\u{1F474}-\\u{1F476}\\u{1F478}\\u{1F47C}\\u{1F483}\\u{1F485}\\u{1F48F}\\u{1F491}\\u{1F4AA}\\u{1F57A}\\u{1F595}\\u{1F596}\\u{1F64C}\\u{1F64F}\\u{1F6C0}\\u{1F6CC}\\u{1F90C}\\u{1F90F}\\u{1F918}-\\u{1F91C}\\u{1F91E}\\u{1F91F}\\u{1F930}-\\u{1F934}\\u{1F936}\\u{1F977}\\u{1F9B5}\\u{1F9B6}\\u{1F9BB}\\u{1F9D2}\\u{1F9D3}\\u{1F9D5}][\\u{1F3FB}-\\u{1F3FF}]|[\\u261D\\u270C\\u270D\\u{1F574}\\u{1F590}][\\uFE0F\\u{1F3FB}-\\u{1F3FF}]|[\\u270A\\u270B\\u{1F385}\\u{1F3C2}\\u{1F3C7}\\u{1F408}\\u{1F415}\\u{1F43B}\\u{1F442}\\u{1F443}\\u{1F446}-\\u{1F450}\\u{1F466}\\u{1F467}\\u{1F46B}-\\u{1F46D}\\u{1F472}\\u{1F474}-\\u{1F476}\\u{1F478}\\u{1F47C}\\u{1F483}\\u{1F485}\\u{1F48F}\\u{1F491}\\u{1F4AA}\\u{1F57A}\\u{1F595}\\u{1F596}\\u{1F62E}\\u{1F635}\\u{1F636}\\u{1F64C}\\u{1F64F}\\u{1F6C0}\\u{1F6CC}\\u{1F90C}\\u{1F90F}\\u{1F918}-\\u{1F91C}\\u{1F91E}\\u{1F91F}\\u{1F930}-\\u{1F934}\\u{1F936}\\u{1F977}\\u{1F9B5}\\u{1F9B6}\\u{1F9BB}\\u{1F9D2}\\u{1F9D3}\\u{1F9D5}]|[\\u{1F3C3}\\u{1F3C4}\\u{1F3CA}\\u{1F46E}\\u{1F470}\\u{1F471}\\u{1F473}\\u{1F477}\\u{1F481}\\u{1F482}\\u{1F486}\\u{1F487}\\u{1F645}-\\u{1F647}\\u{1F64B}\\u{1F64D}\\u{1F64E}\\u{1F6A3}\\u{1F6B4}-\\u{1F6B6}\\u{1F926}\\u{1F935}\\u{1F937}-\\u{1F939}\\u{1F93D}\\u{1F93E}\\u{1F9B8}\\u{1F9B9}\\u{1F9CD}-\\u{1F9CF}\\u{1F9D4}\\u{1F9D6}-\\u{1F9DD}]|[\\u{1F46F}\\u{1F93C}\\u{1F9DE}\\u{1F9DF}]|[\\u231A\\u231B\\u23E9-\\u23EC\\u23F0\\u23F3\\u25FD\\u25FE\\u2614\\u2615\\u2648-\\u2653\\u267F\\u2693\\u26A1\\u26AA\\u26AB\\u26BD\\u26BE\\u26C4\\u26C5\\u26CE\\u26D4\\u26EA\\u26F2\\u26F3\\u26F5\\u26FA\\u26FD\\u2705\\u2728\\u274C\\u274E\\u2753-\\u2755\\u2757\\u2795-\\u2797\\u27B0\\u27BF\\u2B1B\\u2B1C\\u2B50\\u2B55\\u{1F004}\\u{1F0CF}\\u{1F18E}\\u{1F191}-\\u{1F19A}\\u{1F201}\\u{1F21A}\\u{1F22F}\\u{1F232}-\\u{1F236}\\u{1F238}-\\u{1F23A}\\u{1F250}\\u{1F251}\\u{1F300}-\\u{1F320}\\u{1F32D}-\\u{1F335}\\u{1F337}-\\u{1F37C}\\u{1F37E}-\\u{1F384}\\u{1F386}-\\u{1F393}\\u{1F3A0}-\\u{1F3C1}\\u{1F3C5}\\u{1F3C6}\\u{1F3C8}\\u{1F3C9}\\u{1F3CF}-\\u{1F3D3}\\u{1F3E0}-\\u{1F3F0}\\u{1F3F8}-\\u{1F407}\\u{1F409}-\\u{1F414}\\u{1F416}-\\u{1F43A}\\u{1F43C}-\\u{1F43E}\\u{1F440}\\u{1F444}\\u{1F445}\\u{1F451}-\\u{1F465}\\u{1F46A}\\u{1F479}-\\u{1F47B}\\u{1F47D}-\\u{1F480}\\u{1F484}\\u{1F488}-\\u{1F48E}\\u{1F490}\\u{1F492}-\\u{1F4A9}\\u{1F4AB}-\\u{1F4FC}\\u{1F4FF}-\\u{1F53D}\\u{1F54B}-\\u{1F54E}\\u{1F550}-\\u{1F567}\\u{1F5A4}\\u{1F5FB}-\\u{1F62D}\\u{1F62F}-\\u{1F634}\\u{1F637}-\\u{1F644}\\u{1F648}-\\u{1F64A}\\u{1F680}-\\u{1F6A2}\\u{1F6A4}-\\u{1F6B3}\\u{1F6B7}-\\u{1F6BF}\\u{1F6C1}-\\u{1F6C5}\\u{1F6D0}-\\u{1F6D2}\\u{1F6D5}-\\u{1F6D7}\\u{1F6EB}\\u{1F6EC}\\u{1F6F4}-\\u{1F6FC}\\u{1F7E0}-\\u{1F7EB}\\u{1F90D}\\u{1F90E}\\u{1F910}-\\u{1F917}\\u{1F91D}\\u{1F920}-\\u{1F925}\\u{1F927}-\\u{1F92F}\\u{1F93A}\\u{1F93F}-\\u{1F945}\\u{1F947}-\\u{1F976}\\u{1F978}\\u{1F97A}-\\u{1F9B4}\\u{1F9B7}\\u{1F9BA}\\u{1F9BC}-\\u{1F9CB}\\u{1F9D0}\\u{1F9E0}-\\u{1F9FF}\\u{1FA70}-\\u{1FA74}\\u{1FA78}-\\u{1FA7A}\\u{1FA80}-\\u{1FA86}\\u{1FA90}-\\u{1FAA8}\\u{1FAB0}-\\u{1FAB6}\\u{1FAC0}-\\u{1FAC2}\\u{1FAD0}-\\u{1FAD6}]|[\\u231A\\u231B\\u23E9-\\u23EC\\u23F0\\u23F3\\u25FD\\u25FE\\u2614\\u2615\\u2648-\\u2653\\u267F\\u2693\\u26A1\\u26AA\\u26AB\\u26BD\\u26BE\\u26C4\\u26C5\\u26CE\\u26D4\\u26EA\\u26F2\\u26F3\\u26F5\\u26FA\\u26FD\\u2705\\u270A\\u270B\\u2728\\u274C\\u274E\\u2753-\\u2755\\u2757\\u2795-\\u2797\\u27B0\\u27BF\\u2B1B\\u2B1C\\u2B50\\u2B55\\u{1F004}\\u{1F0CF}\\u{1F18E}\\u{1F191}-\\u{1F19A}\\u{1F1E6}-\\u{1F1FF}\\u{1F201}\\u{1F21A}\\u{1F22F}\\u{1F232}-\\u{1F236}\\u{1F238}-\\u{1F23A}\\u{1F250}\\u{1F251}\\u{1F300}-\\u{1F320}\\u{1F32D}-\\u{1F335}\\u{1F337}-\\u{1F37C}\\u{1F37E}-\\u{1F393}\\u{1F3A0}-\\u{1F3CA}\\u{1F3CF}-\\u{1F3D3}\\u{1F3E0}-\\u{1F3F0}\\u{1F3F4}\\u{1F3F8}-\\u{1F43E}\\u{1F440}\\u{1F442}-\\u{1F4FC}\\u{1F4FF}-\\u{1F53D}\\u{1F54B}-\\u{1F54E}\\u{1F550}-\\u{1F567}\\u{1F57A}\\u{1F595}\\u{1F596}\\u{1F5A4}\\u{1F5FB}-\\u{1F64F}\\u{1F680}-\\u{1F6C5}\\u{1F6CC}\\u{1F6D0}-\\u{1F6D2}\\u{1F6D5}-\\u{1F6D7}\\u{1F6EB}\\u{1F6EC}\\u{1F6F4}-\\u{1F6FC}\\u{1F7E0}-\\u{1F7EB}\\u{1F90C}-\\u{1F93A}\\u{1F93C}-\\u{1F945}\\u{1F947}-\\u{1F978}\\u{1F97A}-\\u{1F9CB}\\u{1F9CD}-\\u{1F9FF}\\u{1FA70}-\\u{1FA74}\\u{1FA78}-\\u{1FA7A}\\u{1FA80}-\\u{1FA86}\\u{1FA90}-\\u{1FAA8}\\u{1FAB0}-\\u{1FAB6}\\u{1FAC0}-\\u{1FAC2}\\u{1FAD0}-\\u{1FAD6}]|[#\\*0-9\\xA9\\xAE\\u203C\\u2049\\u2122\\u2139\\u2194-\\u2199\\u21A9\\u21AA\\u231A\\u231B\\u2328\\u23CF\\u23E9-\\u23F3\\u23F8-\\u23FA\\u24C2\\u25AA\\u25AB\\u25B6\\u25C0\\u25FB-\\u25FE\\u2600-\\u2604\\u260E\\u2611\\u2614\\u2615\\u2618\\u261D\\u2620\\u2622\\u2623\\u2626\\u262A\\u262E\\u262F\\u2638-\\u263A\\u2640\\u2642\\u2648-\\u2653\\u265F\\u2660\\u2663\\u2665\\u2666\\u2668\\u267B\\u267E\\u267F\\u2692-\\u2697\\u2699\\u269B\\u269C\\u26A0\\u26A1\\u26A7\\u26AA\\u26AB\\u26B0\\u26B1\\u26BD\\u26BE\\u26C4\\u26C5\\u26C8\\u26CE\\u26CF\\u26D1\\u26D3\\u26D4\\u26E9\\u26EA\\u26F0-\\u26F5\\u26F7-\\u26FA\\u26FD\\u2702\\u2705\\u2708-\\u270D\\u270F\\u2712\\u2714\\u2716\\u271D\\u2721\\u2728\\u2733\\u2734\\u2744\\u2747\\u274C\\u274E\\u2753-\\u2755\\u2757\\u2763\\u2764\\u2795-\\u2797\\u27A1\\u27B0\\u27BF\\u2934\\u2935\\u2B05-\\u2B07\\u2B1B\\u2B1C\\u2B50\\u2B55\\u3030\\u303D\\u3297\\u3299\\u{1F004}\\u{1F0CF}\\u{1F170}\\u{1F171}\\u{1F17E}\\u{1F17F}\\u{1F18E}\\u{1F191}-\\u{1F19A}\\u{1F1E6}-\\u{1F1FF}\\u{1F201}\\u{1F202}\\u{1F21A}\\u{1F22F}\\u{1F232}-\\u{1F23A}\\u{1F250}\\u{1F251}\\u{1F300}-\\u{1F321}\\u{1F324}-\\u{1F393}\\u{1F396}\\u{1F397}\\u{1F399}-\\u{1F39B}\\u{1F39E}-\\u{1F3F0}\\u{1F3F3}-\\u{1F3F5}\\u{1F3F7}-\\u{1F4FD}\\u{1F4FF}-\\u{1F53D}\\u{1F549}-\\u{1F54E}\\u{1F550}-\\u{1F567}\\u{1F56F}\\u{1F570}\\u{1F573}-\\u{1F57A}\\u{1F587}\\u{1F58A}-\\u{1F58D}\\u{1F590}\\u{1F595}\\u{1F596}\\u{1F5A4}\\u{1F5A5}\\u{1F5A8}\\u{1F5B1}\\u{1F5B2}\\u{1F5BC}\\u{1F5C2}-\\u{1F5C4}\\u{1F5D1}-\\u{1F5D3}\\u{1F5DC}-\\u{1F5DE}\\u{1F5E1}\\u{1F5E3}\\u{1F5E8}\\u{1F5EF}\\u{1F5F3}\\u{1F5FA}-\\u{1F64F}\\u{1F680}-\\u{1F6C5}\\u{1F6CB}-\\u{1F6D2}\\u{1F6D5}-\\u{1F6D7}\\u{1F6E0}-\\u{1F6E5}\\u{1F6E9}\\u{1F6EB}\\u{1F6EC}\\u{1F6F0}\\u{1F6F3}-\\u{1F6FC}\\u{1F7E0}-\\u{1F7EB}\\u{1F90C}-\\u{1F93A}\\u{1F93C}-\\u{1F945}\\u{1F947}-\\u{1F978}\\u{1F97A}-\\u{1F9CB}\\u{1F9CD}-\\u{1F9FF}\\u{1FA70}-\\u{1FA74}\\u{1FA78}-\\u{1FA7A}\\u{1FA80}-\\u{1FA86}\\u{1FA90}-\\u{1FAA8}\\u{1FAB0}-\\u{1FAB6}\\u{1FAC0}-\\u{1FAC2}\\u{1FAD0}-\\u{1FAD6}]\\uFE0F|[\\u261D\\u26F9\\u270A-\\u270D\\u{1F385}\\u{1F3C2}-\\u{1F3C4}\\u{1F3C7}\\u{1F3CA}-\\u{1F3CC}\\u{1F442}\\u{1F443}\\u{1F446}-\\u{1F450}\\u{1F466}-\\u{1F478}\\u{1F47C}\\u{1F481}-\\u{1F483}\\u{1F485}-\\u{1F487}\\u{1F48F}\\u{1F491}\\u{1F4AA}\\u{1F574}\\u{1F575}\\u{1F57A}\\u{1F590}\\u{1F595}\\u{1F596}\\u{1F645}-\\u{1F647}\\u{1F64B}-\\u{1F64F}\\u{1F6A3}\\u{1F6B4}-\\u{1F6B6}\\u{1F6C0}\\u{1F6CC}\\u{1F90C}\\u{1F90F}\\u{1F918}-\\u{1F91F}\\u{1F926}\\u{1F930}-\\u{1F939}\\u{1F93C}-\\u{1F93E}\\u{1F977}\\u{1F9B5}\\u{1F9B6}\\u{1F9B8}\\u{1F9B9}\\u{1F9BB}\\u{1F9CD}-\\u{1F9CF}\\u{1F9D1}-\\u{1F9DD}]/gu;\n};\n","'use strict';\n\n// ============================================================================\n// Localization\n// ============================================================================\n\nimport {DEBUG, SERVER} from 'utilities/constants';\nimport {get, pick_random, shallow_copy, deep_copy} from 'utilities/object';\nimport { getBuster } from 'utilities/time';\nimport Module from 'utilities/module';\n\nimport NewTransCore from 'utilities/translation-core';\n\nconst fetchJSON = (url, options) => fetch(url, options).then(r => r.ok ? r.json() : null).catch(() => null);\n\nconst STACK_SPLITTER = /\\s*at\\s+(.+?)\\s+\\((.+)\\)$/,\n\tSOURCE_SPLITTER = /^(.+):\\/\\/(.+?)(?:\\?[a-zA-Z0-9]+)?:(\\d+:\\d+)$/;\n\nconst MAP_OPTIONS = {\n\tfilter(line) {\n\t\treturn line.includes('.frankerfacez.com') || line.includes('localhost');\n\t},\n\tcacheGlobally: true\n};\n\nconst BAD_FRAMES = [\n\t'/src/i18n.js',\n\t'/src/utilities/vue.js'\n]\n\nconst FACES = ['(`)', ';;w;;', 'owo', 'ono', 'oAo', 'oxo', 'ovo;', 'UwU', '>w<', '^w^', '> w >', 'v.v'],\n\n\ttransformText = (ast, fn) => ast.map(node => {\n\t\tif ( typeof node === 'string' )\n\t\t\treturn fn(node);\n\n\t\telse if ( typeof node === 'object' && node.o ) {\n\t\t\tconst out = Object.assign(node, {o: {}});\n\t\t\tfor(const key of Object.keys(node.o))\n\t\t\t\tout.o[key] = transformText(node.o[key], fn)\n\t\t}\n\n\t\treturn node;\n\t}),\n\n\towo = text => text\n\t\t.replace(/(?:r|l)/g, 'w')\n\t\t.replace(/(?:R|L)/g, 'W')\n\t\t.replace(/n([aeiou])/g, 'ny$1')\n\t\t.replace(/N([aeiou])/g, 'Ny$1')\n\t\t.replace(/N([AEIOU])/g, 'NY$1')\n\t\t.replace(/ove/g, 'uv')\n\t\t.replace(/!+/g, ` ${pick_random(FACES)} `),\n\n\n\tTRANSFORMATIONS = {\n\t\tdouble: (key, ast) => [...ast, ' ', ...ast],\n\t\tupper: (key, ast) => transformText(ast, n => n.toUpperCase()),\n\t\tlower: (key, ast) => transformText(ast, n => n.toLowerCase()),\n\t\tappend_key: (key, ast) => [...ast, ` (${key})`],\n\t\tset_key: key => [key],\n\t\towo: (key, ast) => transformText(ast, owo)\n\t};\n\n\n// ============================================================================\n// TranslationManager\n// ============================================================================\n\nexport default class TranslationManager extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis.inject('settings');\n\n\t\tthis._seen = new Set;\n\n\t\tthis.availableLocales = ['en'];\n\t\tthis.chunks = ['client'];\n\n\t\tthis.localeData = {\n\t\t\ten: { name: 'English' }\n\t\t}\n\n\t\tthis.loadLocales();\n\n\t\tthis.strings_loaded = false;\n\t\tthis.new_strings = 0;\n\t\tthis.changed_strings = 0;\n\t\tthis.capturing = false;\n\t\tthis.captured = new Map;\n\n\t\tthis.settings.addUI('i18n.debug.open', {\n\t\t\tpath: 'Debugging > Localization >> Editing',\n\t\t\tcomponent: 'i18n-open',\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.add('i18n.debug.capture', {\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val === null )\n\t\t\t\t\treturn DEBUG;\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Localization >> General',\n\t\t\t\ttitle: 'Enable message capture.',\n\t\t\t\tdescription: 'Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tforce_seen: true\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.capturing = val;\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('i18n.debug.transform', {\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Localization >> General',\n\t\t\t\ttitle: 'Transformation',\n\t\t\t\tdescription: 'Transform all localized strings to test string coverage as well as length.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: null, title: 'Disabled'},\n\t\t\t\t\t{value: 'upper', title: 'Upper Case'},\n\t\t\t\t\t{value: 'lower', title: 'Lower Case'},\n\t\t\t\t\t{value: 'append_key', title: 'Append Key'},\n\t\t\t\t\t{value: 'set_key', title: 'Set to Key'},\n\t\t\t\t\t{value: 'double', title: 'Double'},\n\t\t\t\t\t{value: 'owo', title: \"owo what's this\"}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.transformation = TRANSFORMATIONS[val];\n\t\t\t\tthis.emit(':transform');\n\t\t\t\tthis.emit(':update');\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('i18n.locale', {\n\t\t\tdefault: -1,\n\t\t\tprocess: (ctx, val) => {\n\t\t\t\tif ( val === -1 || typeof val !== 'string' )\n\t\t\t\t\tval = ctx.get('context.session.languageCode') || 'en';\n\n\t\t\t\tif ( this.availableLocales.includes(val) )\n\t\t\t\t\treturn val;\n\n\t\t\t\tif ( val === 'no' && this.availableLocales.includes('nb') )\n\t\t\t\t\treturn 'nb';\n\n\t\t\t\tconst idx = val.indexOf('-');\n\t\t\t\tif ( idx === -1 )\n\t\t\t\t\treturn 'en';\n\n\t\t\t\tval = val.slice(0, idx);\n\t\t\t\treturn this.availableLocales.includes(val) ? val : 'en';\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> General @{\"sort\":-100}',\n\t\t\t\ttitle: 'Language',\n\t\t\t\tdescription: `FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.`,\n\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: (profile, val) => this.getLocaleOptions(val)\n\t\t\t},\n\n\t\t\tchanged: val => this.locale = val\n\t\t});\n\n\n\t\tthis.settings.add('i18n.format.date', {\n\t\t\tdefault: 'default',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> Formatting',\n\t\t\t\ttitle: 'Date Format',\n\t\t\t\tdescription: 'The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\textra: {\n\t\t\t\t\tbefore: true,\n\t\t\t\t\tmode: 'date',\n\t\t\t\t\tcomponent: 'format-preview'\n\t\t\t\t},\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst out = [], now = new Date;\n\t\t\t\t\tfor (const [key, fmt] of Object.entries(this._.formats.date)) {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\tvalue: key, title: `${this.formatDate(now, key)} (${key})`\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.defaultDateFormat = val;\n\t\t\t\tthis.emit(':update')\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('i18n.format.time', {\n\t\t\tdefault: 'short',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> Formatting',\n\t\t\t\ttitle: 'Time Format',\n\t\t\t\tdescription: 'The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\textra: {\n\t\t\t\t\tbefore: true,\n\t\t\t\t\tmode: 'time',\n\t\t\t\t\tcomponent: 'format-preview'\n\t\t\t\t},\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst out = [], now = new Date;\n\t\t\t\t\tfor (const [key,fmt] of Object.entries(this._.formats.time)) {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\tvalue: key, title: `${this.formatTime(now, key)} (${key})`\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.defaultTimeFormat = val;\n\t\t\t\tthis.emit(':update')\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('i18n.format.datetime', {\n\t\t\tdefault: 'medium',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Localization >> Formatting',\n\t\t\t\ttitle: 'Date-Time Format',\n\t\t\t\tdescription: 'The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\textra: {\n\t\t\t\t\tbefore: true,\n\t\t\t\t\tmode: 'datetime',\n\t\t\t\t\tcomponent: 'format-preview'\n\t\t\t\t},\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst out = [], now = new Date;\n\t\t\t\t\tfor (const [key,fmt] of Object.entries(this._.formats.datetime)) {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\tvalue: key, title: `${this.formatDateTime(now, key)} (${key})`\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis._.defaultDateTimeFormat = val;\n\t\t\t\tthis.emit(':update')\n\t\t\t}\n\t\t});\n\t}\n\n\tgetLocaleOptions(val) {\n\t\tif( val === undefined )\n\t\t\tval = this.settings.get('i18n.locale');\n\n\t\tconst normal_out = [],\n\t\t\tjoke_out = [];\n\n\t\tfor(const locale of this.availableLocales) {\n\t\t\tconst data = this.localeData[locale];\n\t\t\tlet title = data?.native_name || data?.name || locale;\n\n\t\t\tif ( data?.coverage != null && data?.coverage < 100 )\n\t\t\t\ttitle = this.t('i18n.locale-coverage', '{name} ({coverage,number,percent} Complete)', {\n\t\t\t\t\tname: title,\n\t\t\t\t\tcoverage: data.coverage / 100\n\t\t\t\t});\n\n\t\t\tconst entry = {\n\t\t\t\tselected: val === locale,\n\t\t\t\tvalue: locale,\n\t\t\t\ttitle\n\t\t\t};\n\n\t\t\tif ( data?.joke )\n\t\t\t\tjoke_out.push(entry);\n\t\t\telse\n\t\t\t\tnormal_out.push(entry);\n\t\t}\n\n\t\tnormal_out.sort((a, b) => a.title.localeCompare(b.title));\n\t\tjoke_out.sort((a, b) => a.title.localeCompare(b.title));\n\n\t\tlet out = [{\n\t\t\tselected: val === -1,\n\t\t\tvalue: -1,\n\t\t\ti18n_key: 'setting.appearance.localization.general.language.twitch',\n\t\t\ttitle: \"Use Twitch's Language\"\n\t\t}];\n\n\t\tif ( normal_out.length ) {\n\t\t\tout.push({\n\t\t\t\tseparator: true,\n\t\t\t\ti18n_key: 'setting.appearance.localization.general.language.languages',\n\t\t\t\ttitle: 'Supported Languages'\n\t\t\t});\n\n\t\t\tout = out.concat(normal_out);\n\t\t}\n\n\t\tif ( joke_out.length ) {\n\t\t\tout.push({\n\t\t\t\tseparator: true,\n\t\t\t\ti18n_key: 'setting.appearance.localization.general.language.joke',\n\t\t\t\ttitle: 'Joke Languages'\n\t\t\t});\n\n\t\t\tout = out.concat(joke_out);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tonEnable() {\n\t\tthis.capturing = this.settings.get('i18n.debug.capture');\n\t\tif ( this.capturing )\n\t\t\tthis.loadStrings();\n\n\t\tthis._ = new NewTransCore({ //TranslationCore({\n\t\t\twarn: (...args) => this.log.warn(...args),\n\t\t\tdefaultDateFormat: this.settings.get('i18n.format.date'),\n\t\t\tdefaultTimeFormat: this.settings.get('i18n.format.time'),\n\t\t\tdefaultDateTimeFormat: this.settings.get('i18n.format.datetime')\n\t\t});\n\n\t\tif ( window.BroadcastChannel ) {\n\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-i18n');\n\t\t\tbc.addEventListener('message',\n\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\t\t}\n\n\t\tthis._.transformation = TRANSFORMATIONS[this.settings.get('i18n.debug.transform')];\n\t\tthis.locale = this.settings.get('i18n.locale');\n\t}\n\n\tasync loadChunk(name) {\n\t\tif (this.chunks.includes(name))\n\t\t\treturn [];\n\n\t\tthis.chunks.push(name);\n\n\t\tconst locale = this._.locale;\n\t\tconst phrases = await this.loadLocale(locale, name);\n\n\t\tconst added = this._.extend(phrases);\n\t\tif ( added.length ) {\n\t\t\tthis.log.info(`Loaded Chunk: ${name} -- Phrases: ${added.length}`);\n\t\t\tthis.emit(':loaded', added);\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tbroadcast(msg) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\tgetKeys() {\n\t\tconst out = [];\n\t\tfor(const entry of this.captured.values()) {\n\t\t\tconst thing = deep_copy(entry);\n\t\t\tthing.translation = this._.phrases.get(thing.key) || thing.phrase;\n\t\t\tout.push(thing);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\trequestKeys() {\n\t\tthis.broadcast({type: 'request-keys'});\n\t}\n\n\tupdatePhrase(key, phrase) {\n\t\tthis.broadcast({\n\t\t\ttype: 'update-key',\n\t\t\tkey,\n\t\t\tphrase\n\t\t});\n\n\t\tthis._.extend({\n\t\t\t[key]: phrase\n\t\t});\n\n\t\tthis.emit(':loaded', [key]);\n\t\tthis.emit(':update');\n\t}\n\n\thandleMessage(event) {\n\t\tconst msg = event.data;\n\t\tif ( ! msg )\n\t\t\treturn;\n\n\t\tif ( msg.type === 'update-key' ) {\n\t\t\tthis._.extend({\n\t\t\t\t[msg.key]: msg.phrase\n\t\t\t});\n\n\t\t\tthis.emit(':loaded', [msg.key]);\n\t\t\tthis.emit(':update');\n\n\t\t} else if ( msg.type === 'request-keys' )\n\t\t\tthis.broadcast({\n\t\t\t\ttype: 'keys',\n\t\t\t\tdata: Array.from(this.captured.values())\n\t\t\t});\n\n\t\telse if ( msg.type === 'keys' && Array.isArray(msg.data) ) {\n\t\t\tfor(const entry of msg.data) {\n\t\t\t\t// TODO: Merging logic.\n\t\t\t\tthis.captured.set(entry.key, entry);\n\t\t\t}\n\n\t\t\tthis.emit(':got-keys');\n\t\t}\n\t}\n\n\n\topenUI(popout = true) {\n\t\t// Override the capturing state when we open the UI.\n\t\tif ( ! this.capturing ) {\n\t\t\tthis.capturing = true;\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\tconst mod = this.resolve('translation_ui');\n\t\tif ( popout )\n\t\t\tmod.openPopout();\n\t\telse\n\t\t\tmod.enable();\n\t}\n\n\n\tget dayjsLocale() {\n\t\treturn this._?._dayjs_locale;\n\t}\n\n\tget locale() {\n\t\treturn this._ && this._.locale;\n\t}\n\n\tset locale(new_locale) {\n\t\tthis.setLocale(new_locale);\n\t}\n\n\n\tasync loadStrings(ignore_loaded = false) {\n\t\tif ( this.strings_loaded && ! ignore_loaded )\n\t\t\treturn;\n\n\t\tif ( this.strings_loading )\n\t\t\treturn;\n\n\t\tthis.strings_loading = true;\n\n\t\tconst resp = await fetch(`${SERVER}/script/locale/strings.json?_=${getBuster(30)}`);\n\t\tlet strings;\n\t\tif (! resp.ok ) {\n\t\t\tthis.log.warn(`Error Loading Strings -- Status: ${resp.status}`);\n\t\t\tstrings = [];\n\t\t} else\n\t\t\tstrings = await resp.json();\n\n\t\tfor(const str of strings) {\n\t\t\tconst key = str.id;\n\t\t\tlet store = this.captured.get(key);\n\t\t\tif ( ! store ) {\n\t\t\t\tthis.captured.set(key, store = {key, phrase: str.default, hits: 0, calls: []});\n\t\t\t\tif ( str.source?.length )\n\t\t\t\t\tstore.calls.push(str.source);\n\t\t\t}\n\n\t\t\tif ( ! store.options && str.context?.length )\n\t\t\t\ttry {\n\t\t\t\t\tstore.options = JSON.parse(str.context);\n\t\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\tstore.known = str.default;\n\t\t\tstore.different = str.default !== store.phrase;\n\t\t}\n\n\t\tthis.new_strings = 0;\n\t\tthis.changed_strings = 0;\n\n\t\tfor(const entry of this.captured.values()) {\n\t\t\tif ( ! entry.known )\n\t\t\t\tthis.new_strings++;\n\t\t\tif ( entry.different )\n\t\t\t\tthis.changed_strings++;\n\t\t}\n\n\t\tthis.strings_loaded = true;\n\t\tthis.strings_loading = false;\n\n\t\tthis.log.info(`Loaded ${strings.length} strings from the server.`);\n\t\tthis.emit(':strings-loaded');\n\t\tthis.emit(':new-strings', this.new_strings);\n\t\tthis.emit(':changed-strings', this.changed_strings);\n\t}\n\n\n\tsee(key, phrase, options) {\n\t\tif ( ! this.capturing )\n\t\t\treturn;\n\n\t\tlet stack;\n\t\ttry {\n\t\t\tstack = new Error().stack;\n\t\t} catch(err) {\n\t\t\t/* :thinking: */\n\t\t\ttry {\n\t\t\t\tstack = err.stack;\n\t\t\t} catch(err_again) { /* aww */ }\n\t\t}\n\n\t\tlet store = this.captured.get(key);\n\t\tif ( ! store ) {\n\t\t\tthis.captured.set(key, store = {key, phrase, hits: 0, calls: []});\n\t\t\tif ( this.strings_loaded ) {\n\t\t\t\tthis.new_strings++;\n\t\t\t\tthis.emit(':new-strings', this.new_strings);\n\t\t\t}\n\t\t}\n\n\t\tif ( phrase !== store.phrase ) {\n\t\t\tstore.phrase = phrase;\n\t\t\tif ( store.known && phrase !== store.known && ! store.different ) {\n\t\t\t\tstore.different = true;\n\t\t\t\tthis.changed_strings++;\n\t\t\t\tthis.emit(':changed-strings', this.changed_strings);\n\t\t\t}\n\t\t}\n\n\t\tstore.options = this.pluckVariables(key, options);\n\t\tstore.hits++;\n\n\t\tif ( stack ) {\n\t\t\tif ( this.mapStackTrace )\n\t\t\t\tthis.mapStackTrace(stack, result => this.recordCall(store, result), MAP_OPTIONS);\n\t\t\telse\n\t\t\t\timport(/* webpackChunkName: 'translation-ui' */ 'sourcemapped-stacktrace').then(mod => {\n\t\t\t\t\tthis.mapStackTrace = mod.mapStackTrace;\n\t\t\t\t\tthis.mapStackTrace(stack, result => this.recordCall(store, result), MAP_OPTIONS);\n\t\t\t\t});\n\t\t}\n\t}\n\n\n\tpluckVariables(key, options) {\n\t\tconst ast = this._.cache.get(key);\n\t\tif ( ! ast )\n\t\t\treturn null;\n\n\t\tconst out = {};\n\t\tthis._doPluck(ast, options, out);\n\t\tif ( Object.keys(out).length )\n\t\t\treturn out;\n\n\t\treturn null;\n\t}\n\n\t_doPluck(ast, options, out) {\n\t\tif ( Array.isArray(ast) ) {\n\t\t\tfor(const val of ast)\n\t\t\t\tthis._doPluck(val, options, out);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof ast === 'object' && ast.v ) {\n\t\t\tconst val = get(ast.v, options);\n\t\t\t// Skip React objects.\n\t\t\tif ( val && val['$$typeof'] )\n\t\t\t\treturn;\n\n\t\t\tout[ast.v] = shallow_copy(val);\n\t\t}\n\t}\n\n\n\trecordCall(store, stack) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! Array.isArray(stack) )\n\t\t\treturn;\n\n\t\tfor(const line of stack) {\n\t\t\tconst match = STACK_SPLITTER.exec(line);\n\t\t\tif ( ! match )\n\t\t\t\tcontinue;\n\n\t\t\tconst location = SOURCE_SPLITTER.exec(match[2]);\n\t\t\tif ( ! location || location[1] !== 'webpack' )\n\t\t\t\tcontinue;\n\n\t\t\tconst file = location[2];\n\t\t\tif ( file.includes('/node_modules/') || BAD_FRAMES.includes(file) )\n\t\t\t\tcontinue;\n\n\t\t\tlet out;\n\t\t\tif ( match[1] === 'MainMenu.getSettingsTree' )\n\t\t\t\tout = 'FFZ Control Center';\n\t\t\telse {\n\t\t\t\tlet label = match[1];\n\t\t\t\tif ( (label === 'Proxy.render' || label.startsWith('Proxy.push')) && location[2].includes('.vue') )\n\t\t\t\t\tlabel = 'Vue Component';\n\n\t\t\t\tout = `${label} (${location[2]}:${location[3]})`;\n\t\t\t}\n\n\t\t\tif ( ! store.calls.includes(out) )\n\t\t\t\tstore.calls.push(out);\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\n\tasync loadLocales() {\n\t\tconst resp = await fetch(`${SERVER}/script/locale/locales.json?_=${getBuster(30)}`);\n\t\tlet data;\n\t\tif ( ! resp.ok ) {\n\t\t\tthis.log.warn(`Error Populating Locales -- Status: ${resp.status}`);\n\t\t} else\n\t\t\tdata = await resp.json();\n\n\t\tif ( ! Array.isArray(data) || ! data.length )\n\t\t\tdata = [{\n\t\t\t\tid: 'en',\n\t\t\t\tname: 'English',\n\t\t\t\tcoverage: 100,\n\t\t\t\trtl: false,\n\t\t\t\thashes: {}\n\t\t\t}];\n\n\t\tthis.localeData = {};\n\t\tthis.availableLocales = [];\n\n\t\tfor(const locale of data) {\n\t\t\tconst key = locale.id.toLowerCase();\n\t\t\tthis.localeData[key] = locale;\n\t\t\tthis.availableLocales.push(key);\n\t\t}\n\n\t\tthis.emit(':locales-loaded');\n\t}\n\n\n\tasync loadLocale(locale, chunk = null) {\n\t\t// Normalize the locale.\n\t\tlocale = locale.toLowerCase();\n\n\t\tif ( locale === 'en' )\n\t\t\treturn {};\n\n\t\tconst hashes = this.localeData[locale]?.hashes;\n\t\tif (! hashes) {\n\t\t\tthis.log.info(`Cannot Load Locale: ${locale}`);\n\t\t\treturn {};\n\t\t}\n\n\t\tif (! chunk)\n\t\t\tchunk = this.chunks;\n\t\telse if (! Array.isArray(chunk))\n\t\t\tchunk = [chunk];\n\n\t\tconst id = this.localeData[locale].id;\n\t\tconst promises = [];\n\n\t\tfor(const chnk of chunk) {\n\t\t\tconst hash = hashes[chnk];\n\t\t\tif (! hash)\n\t\t\t\tcontinue;\n\n\t\t\tpromises.push(fetchJSON(`https://cdn2.frankerfacez.com/static/locale/${id}/${chnk}.${hash}.json`));\n\t\t}\n\n\t\tconst chunks = await Promise.all(promises);\n\t\tconst result = {};\n\n\t\tlet ignored = 0;\n\n\t\tfor(const chunk of chunks) {\n\t\t\tif (! chunk)\n\t\t\t\tcontinue;\n\n\t\t\tfor(const [key,val] of Object.entries(chunk)) {\n\t\t\t\tif (typeof val === 'string' && val.length > 0)\n\t\t\t\t\tresult[key] = val;\n\t\t\t\telse\n\t\t\t\t\tignored++;\n\t\t\t}\n\t\t}\n\n\t\tif (ignored > 0)\n\t\t\tthis.log.debug(`Ignored ${ignored} invalid values while loading ${locale} chunks.`);\n\n\t\treturn result;\n\t}\n\n\tasync setLocale(new_locale) {\n\t\t// Normalize the locale.\n\t\tnew_locale = new_locale.toLowerCase();\n\n\t\tconst old_locale = this._.locale;\n\t\tif ( new_locale === old_locale )\n\t\t\treturn [];\n\n\t\tthis._.locale = new_locale;\n\t\tthis._.clear();\n\t\tthis.log.info(`Changed Locale: ${new_locale} -- Old: ${old_locale}`);\n\t\tthis.emit(':changed', new_locale, old_locale);\n\t\tthis.emit(':update');\n\n\t\tif ( new_locale === 'en' ) {\n\t\t\t// All the built-in messages are English. We don't need special\n\t\t\t// logic to load the translations.\n\t\t\tthis.emit(':loaded', []);\n\t\t\tthis._._dayjs_locale = 'en';\n\t\t\treturn [];\n\t\t}\n\n\t\tconst data = this.localeData[new_locale];\n\t\tconst phrases = await this.loadLocale(data?.id || new_locale);\n\n\t\tlet djs;\n\t\ttry {\n\t\t\tdjs = data?.dayjs_override || new_locale;\n\t\t\tawait this.loadDayjsLocale(djs);\n\t\t} catch (err) {\n\t\t\tthis.log.warn(`Unable to load DayJS locale for ${new_locale}`);\n\t\t\tdjs = 'en';\n\t\t}\n\n\t\tif ( this._.locale !== new_locale )\n\t\t\tthrow new Error('locale has changed since we started loading');\n\n\t\tthis._._dayjs_locale = djs;\n\n\t\tconst added = this._.extend(phrases);\n\t\tif ( added.length ) {\n\t\t\tthis.log.info(`Loaded Locale: ${new_locale} -- Phrases: ${added.length}`);\n\t\t\tthis.emit(':loaded', added);\n\t\t\tthis.emit(':update');\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tasync loadDayjsLocale(locale) {\n\t\tif ( locale === 'en' || locale === 'en-arrr' )\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tawait import(\n\t\t\t\t/* webpackMode: 'lazy' */\n\t\t\t\t/* webpackChunkName: 'i18n-[index]' */\n\t\t\t\t`dayjs/locale/${locale}.js`\n\t\t\t);\n\t\t} catch(err) {\n\t\t\tthis.log.warn(`Unable to load day.js locale data for locale \"${locale}\"`, err);\n\t\t}\n\t}\n\n\thas(key) {\n\t\treturn this._.has(key);\n\t}\n\n\tformatNode(...args) {\n\t\treturn this._.formatNode(...args);\n\t}\n\n\ttoLocaleString(...args) {\n\t\treturn this._.toLocaleString(...args);\n\t}\n\n\ttoRelativeTime(...args) {\n\t\treturn this._.formatRelativeTime(...args);\n\t}\n\n\tformatNumber(...args) {\n\t\treturn this._.formatNumber(...args);\n\t}\n\n\tformatCurrency(...args) {\n\t\treturn this._.formatCurrency(...args);\n\t}\n\n\tformatDuration(...args) {\n\t\treturn this._.formatDuration(...args);\n\t}\n\n\tformatDate(...args) {\n\t\treturn this._.formatDate(...args)\n\t}\n\n\tformatTime(...args) {\n\t\treturn this._.formatTime(...args)\n\t}\n\n\tformatDateTime(...args) {\n\t\treturn this._.formatDateTime(...args)\n\t}\n\n\tt(key, ...args) {\n\t\tthis.see(key, ...args);\n\t\treturn this._.t(key, ...args);\n\t}\n\n\ttList(key, ...args) {\n\t\tthis.see(key, ...args);\n\t\treturn this._.tList(key, ...args);\n\t}\n}\n\n\n// ============================================================================\n// Transformations\n// ============================================================================\n\nconst DOLLAR_REGEX = /\\$/g;\nconst REPLACE = String.prototype.replace;\n\nconst FORMAT_REGEX = /^\\s*([^(]+?)\\s*(?:\\(\\s*([^)]+?)\\s*\\))?\\s*$/;\n\nexport function parseFormatters(fmt) {\n\tif (!fmt || ! fmt.length)\n\t\treturn;\n\n\tconst result = [];\n\n\tfor(const token of fmt.split(/\\|/g)) {\n\t\tconst match = FORMAT_REGEX.exec(token);\n\t\tif (!match)\n\t\t\tcontinue;\n\n\t\tresult.push({\n\t\t\tfmt: match[1],\n\t\t\textra: match[2]\n\t\t});\n\t}\n\n\treturn result;\n}\n\nexport function transformPhrase(phrase, substitutions, locale, token_regex, formatters) {\n\tconst is_array = Array.isArray(phrase);\n\tif ( substitutions == null )\n\t\treturn is_array ? phrase[0] : phrase;\n\n\tlet result = phrase;\n\tconst options = typeof substitutions === 'number' ? {count: substitutions} : substitutions;\n\n\tif ( is_array )\n\t\tresult = result[0];\n\n\tif ( typeof result === 'string' )\n\t\tresult = REPLACE.call(result, token_regex, (expr, arg, fmt) => {\n\t\t\tlet val = get(arg.trim(), options);\n\t\t\tif ( val == null )\n\t\t\t\treturn '';\n\n\t\t\tconst fmts = parseFormatters(fmt);\n\t\t\tlet formatted = false;\n\t\t\tif (fmts) {\n\t\t\t\tfor(const format of fmts) {\n\t\t\t\t\tconst formatter = formatters[format.fmt];\n\t\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\t\tval = formatter(val, locale, options, format.extra);\n\t\t\t\t\t\tformatted = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (! formatted && typeof val === 'string' )\n\t\t\t\tval = REPLACE.call(val, DOLLAR_REGEX, '$$');\n\n\t\t\treturn val;\n\t\t});\n\n\treturn result;\n}\n","'use strict';\n\n// ============================================================================\n// Emoji Handling\n// ============================================================================\n\nimport { DEBUG } from 'utilities/constants';\nimport Module, { buildAddonProxy } from 'utilities/module';\nimport {has, maybe_call, deep_copy} from 'utilities/object';\nimport {createElement, ClickOutside} from 'utilities/dom';\nimport Tooltip from 'utilities/tooltip';\n\nimport * as ACTIONS from './types';\nimport * as RENDERERS from './renderers';\nimport { transformPhrase } from 'src/i18n';\n\nconst VAR_REPLACE = /\\{\\{(.*?)(?:\\|(.*?))?\\}\\}/g;\n\nexport default class Actions extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('tooltips');\n\t\tthis.inject('i18n');\n\n\t\tthis.actions = {};\n\t\tthis.renderers = {};\n\n\t\tthis.filterAction = (x) => x.appearance &&\n\t\t\tthis.renderers[x.appearance.type] &&\n\t\t\t(! this.renderers[x.appearance.type].load || this.renderers[x.appearance.type].load(x.appearance)) &&\n\t\t\t(! x.action || this.actions[x.action]);\n\n\t\tthis.settings.add('chat.actions.size', {\n\t\t\tdefault: 16,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions @{\"always_list_pages\": true} >> Appearance',\n\t\t\t\ttitle: 'Action Size',\n\t\t\t\tdescription: \"How tall actions should be, in pixels. This may be affected by your browser's zoom and font size settings.\",\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_int',\n\t\t\t\tbounds: [1]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.hover-size', {\n\t\t\tdefault: 30,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > Message Hover >> Appearance',\n\t\t\t\ttitle: 'Action Size',\n\t\t\t\tdescription: \"How tall hover actions should be, in pixels. This may be affected by your browser's zoom and font size settings.\",\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_int',\n\t\t\t\tbounds: [1]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.reasons', {\n\t\t\tdefault: [\n\t\t\t\t{v: {text: 'One-Man Spam', i18n: 'chat.reasons.spam'}},\n\t\t\t\t{v: {text: 'Posting Bad Links', i18n: 'chat.reasons.links'}},\n\t\t\t\t{v: {text: 'Ban Evasion', i18n: 'chat.reasons.evasion'}},\n\t\t\t\t{v: {text: 'Threats / Personal Info', i18n: 'chat.reasons.personal'}},\n\t\t\t\t{v: {text: 'Hate / Harassment', i18n: 'chat.reasons.hate'}},\n\t\t\t\t{v: {text: 'Ignoring Broadcaster / Moderators', i18n: 'chat.reason.ignore'}}\n\t\t\t],\n\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\n\t\t\t// Clean up after Vue being stupid.\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( Array.isArray(val) )\n\t\t\t\t\tfor(const entry of val)\n\t\t\t\t\t\tif ( entry.i18n && typeof entry.i18n !== 'string' )\n\t\t\t\t\t\t\tdelete entry.i18n;\n\n\t\t\t\treturn val;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > Reasons >> Custom Reasons',\n\t\t\t\tcomponent: 'chat-reasons',\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.hover', {\n\t\t\tprocess: (ctx, val) =>\n\t\t\t\tval.filter(this.filterAction),\n\n\t\t\tdefault: [\n\t\t\t\t{v: {action: 'pin', appearance: {type: 'icon', icon: 'ffz-i-pin'}, options: {}, display: {mod_icons: true}}},\n\t\t\t\t{v: {action: 'reply', appearance: {type: 'dynamic'}, options: {}, display: {}}}\n\t\t\t],\n\n\t\t\ttype: 'array_merge',\n\t\t\tinherit_default: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > Message Hover @{\"description\": \"Here, you can define custom actions that will appear on top of messages in chat when you hover over them. If you aren\\'t seeing an action you\\'ve defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu.\"}',\n\t\t\t\tcomponent: 'chat-actions',\n\t\t\t\tcontext: ['user', 'room', 'message'],\n\t\t\t\tinline: true,\n\t\t\t\tmodifiers: true,\n\t\t\t\thover_modifier: false,\n\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst chat = this.resolve('site.chat');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: val => chat && chat.colors ? chat.colors.process(val) : val,\n\t\t\t\t\t\tactions: deep_copy(this.actions),\n\t\t\t\t\t\trenderers: deep_copy(this.renderers)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.inline', {\n\t\t\t// Filter out actions\n\t\t\tprocess: (ctx, val) =>\n\t\t\t\tval.filter(this.filterAction),\n\n\t\t\tdefault: [\n\t\t\t\t{v: {action: 'ban', appearance: {type: 'icon', icon: 'ffz-i-block'}, options: {}, display: {mod: true, mod_icons: true, deleted: false}}},\n\t\t\t\t{v: {action: 'unban', appearance: {type: 'icon', icon: 'ffz-i-ok'}, options: {}, display: {mod: true, mod_icons: true, deleted: true}}},\n\t\t\t\t{v: {action: 'timeout', appearance: {type: 'icon', icon: 'ffz-i-clock'}, display: {mod: true, mod_icons: true}}},\n\t\t\t\t{v: {action: 'msg_delete', appearance: {type: 'icon', icon: 'ffz-i-trash'}, options: {}, display: {mod: true, mod_icons: true}}}\n\t\t\t],\n\n\t\t\ttype: 'array_merge',\n\t\t\tinherit_default: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > In-Line @{\"description\": \"Here, you can define custom actions that will appear along messages in chat. If you aren\\'t seeing an action you\\'ve defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu.\"}',\n\t\t\t\tcomponent: 'chat-actions',\n\t\t\t\tcontext: ['user', 'room', 'message'],\n\t\t\t\tinline: true,\n\t\t\t\tmodifiers: true,\n\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst chat = this.resolve('site.chat');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: val => chat && chat.colors ? chat.colors.process(val) : val,\n\t\t\t\t\t\tactions: deep_copy(this.actions),\n\t\t\t\t\t\trenderers: deep_copy(this.renderers)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.user-context', {\n\t\t\t// Filter out actions\n\t\t\tprocess: (ctx, val) =>\n\t\t\t\tval.filter(x => x.type || this.filterAction(x)),\n\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\tinherit_default: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > User Context @{\"description\": \"Here, you can define custom actions that will appear in a context menu when you right-click a username in chat.\"}',\n\t\t\t\tcomponent: 'chat-actions',\n\t\t\t\tcontext: ['user', 'room', 'message'],\n\t\t\t\tmod_icons: true,\n\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst chat = this.resolve('site.chat');\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: val => chat && chat.colors ? chat.colors.process(val) : val,\n\t\t\t\t\t\tactions: deep_copy(this.actions),\n\t\t\t\t\t\trenderers: deep_copy(this.renderers)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis.settings.add('chat.actions.room', {\n\t\t\t// Filter out actions\n\t\t\tprocess: (ctx, val) =>\n\t\t\t\tval.filter(x => x.type || this.filterAction(x)),\n\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\tinherit_default: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > Room @{\"description\": \"Here, you can define custom actions that will appear above the chat input box.\"}',\n\t\t\t\tcomponent: 'chat-actions',\n\t\t\t\tcontext: ['room', 'room-mode'],\n\t\t\t\tinline: false,\n\n\t\t\t\tdata: () => {\n\t\t\t\t\tconst chat = this.resolve('site.chat');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: val => chat && chat.colors ? chat.colors.process(val) : val,\n\t\t\t\t\t\tactions: deep_copy(this.actions),\n\t\t\t\t\t\trenderers: deep_copy(this.renderers)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.room-above', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > Room >> General',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Display Room Actions above the chat input box.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.actions.rules-as-reasons', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Actions > Reasons >> Rules',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: \"Include the current room's rules in the list of reasons.\"\n\t\t\t}\n\t\t});\n\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t\tthis.handleContext = this.handleContext.bind(this);\n\t\tthis.handleUserContext = this.handleUserContext.bind(this);\n\t}\n\n\n\tonEnable() {\n\t\tthis.tooltips.types.action = (target, tip) => {\n\t\t\tconst data = this.getData(target);\n\t\t\tif ( ! data )\n\t\t\t\treturn this.i18n.t('chat.actions.unknown', 'Unknown Action Type');\n\n\t\t\tif ( ! data.definition.tooltip )\n\t\t\t\treturn `Error: The \"${data.action}\" action provider does not have tooltip support.`;\n\n\t\t\tif ( data.tip && data.tip.length )\n\t\t\t\treturn this.replaceVariables(data.tip, data);\n\n\t\t\treturn maybe_call(data.definition.tooltip, this, data, target, tip);\n\t\t}\n\n\n\t\tfor(const key in ACTIONS)\n\t\t\tif ( has(ACTIONS, key) )\n\t\t\t\tthis.addAction(key, ACTIONS[key]);\n\n\t\tfor(const key in RENDERERS)\n\t\t\tif ( has(RENDERERS, key) )\n\t\t\t\tthis.addRenderer(key, RENDERERS[key]);\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tlet removed = 0;\n\t\t\tfor(const [key, def] of Object.entries(this.actions)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tdelete this.actions[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const [key, def] of Object.entries(this.renderers)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tdelete this.renderers[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( removed ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed} entries when unloading addon:`, addon_id);\n\t\t\t\tthis._updateContexts();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tgetAddonProxy(addon_id, addon, module) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides = {},\n\t\t\twarnings = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\n\t\toverrides.addAction = (key, data) => {\n\t\t\tif ( data )\n\t\t\t\tdata.__source = addon_id;\n\n\t\t\tif ( is_dev && ! key.includes(addon_id) )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to actions.addAction() did not include add-on ID in key:', key);\n\n\t\t\treturn this.addAction(key, data);\n\t\t}\n\n\t\toverrides.addRenderer = (key, data) => {\n\t\t\tif ( data )\n\t\t\t\tdata.__source = addon_id;\n\n\t\t\tif ( is_dev && ! key.includes(addon_id) )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to actions.addRenderer() did not include add-on ID in key:', key);\n\n\t\t\treturn this.addRenderer(key, data);\n\t\t}\n\n\t\tif ( is_dev ) {\n\t\t\toverrides.removeAction = (...key) => {\n\t\t\t\tfor(const entry of key) {\n\t\t\t\t\tconst existing = this.actions[entry];\n\t\t\t\t\tif ( existing && existing.__source !== addon_id )\n\t\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned action with actions.removeAction:', entry, ' owner:', existing.__source ?? 'ffz');\n\t\t\t\t}\n\n\t\t\t\treturn this.removeAction(...key);\n\t\t\t};\n\n\t\t\toverrides.removeRenderer = (...key) => {\n\t\t\t\tfor(const entry of key) {\n\t\t\t\t\tconst existing = this.renderers[entry];\n\t\t\t\t\tif ( existing && existing.__source !== addon_id )\n\t\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned renderer with actions.removeRenderer:', entry, ' owner:', existing.__source ?? 'ffz');\n\t\t\t\t}\n\n\t\t\t\treturn this.removeRenderer(...key);\n\t\t\t}\n\n\t\t\twarnings.actions = 'Please use addAction() or removeAction()';\n\t\t\twarnings.renderers = 'Please use addRenderer() or removeRenderer()';\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'actions', overrides, warnings);\n\t}\n\n\n\t_updateContexts() {\n\t\tfor(const ctx of this.settings.__contexts) {\n\t\t\tctx.update('chat.actions.inline');\n\t\t\tctx.update('chat.actions.hover');\n\t\t\tctx.update('chat.actions.user-context');\n\t\t\tctx.update('chat.actions.room');\n\t\t}\n\t}\n\n\n\taddAction(key, data) {\n\t\tif ( has(this.actions, key) )\n\t\t\treturn this.log.warn(`Attempted to add action \"${key}\" which is already defined.`);\n\n\t\tthis.actions[key] = data;\n\t\tthis._updateContexts();\n\t}\n\n\n\taddRenderer(key, data) {\n\t\tif ( has(this.renderers, key) )\n\t\t\treturn this.log.warn(`Attempted to add renderer \"${key}\" which is already defined.`);\n\n\t\tthis.renderers[key] = data;\n\t\tthis._updateContexts();\n\t}\n\n\tgetActions() {\n\t\treturn {...this.actions}\n\t}\n\n\tgetAction(key) {\n\t\treturn this.actions[key] ?? null;\n\t}\n\n\tgetRenderer(key) {\n\t\treturn this.renderers[key] ?? null;\n\t}\n\n\tgetRenderers() {\n\t\treturn {...this.renderers}\n\t}\n\n\tremoveAction(...keys) {\n\t\tlet changed = false;\n\t\tfor(const entry of keys) {\n\t\t\tif ( ! has(this.actions, entry) )\n\t\t\t\tcontinue;\n\n\t\t\tdelete this.actions[entry];\n\t\t\tchanged = true;\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis._updateContexts();\n\t}\n\n\n\tremoveRenderer(...keys) {\n\t\tlet changed = false;\n\t\tfor(const entry of keys) {\n\t\t\tif ( ! has(this.renderers, entry) )\n\t\t\t\treturn;\n\n\t\t\tdelete this.renderers[entry];\n\t\t\tchanged = true;\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis._updateContexts();\n\t}\n\n\n\treplaceVariables(text, data) {\n\t\treturn transformPhrase(\n\t\t\ttext,\n\t\t\tdata,\n\t\t\tthis.i18n.locale,\n\t\t\tVAR_REPLACE,\n\t\t\t{\n\t\t\t\tupper(val) {\n\t\t\t\t\treturn val.toString().toUpperCase();\n\t\t\t\t},\n\t\t\t\tuppercase(val) {\n\t\t\t\t\treturn val.toString().toUpperCase();\n\t\t\t\t},\n\t\t\t\tlower(val) {\n\t\t\t\t\treturn val.toString().toLowerCase();\n\t\t\t\t},\n\t\t\t\tlowercase(val) {\n\t\t\t\t\treturn val.toString().toLowerCase();\n\t\t\t\t},\n\t\t\t\tsnakecase(val) {\n\t\t\t\t\treturn val.toString().toSnakeCase();\n\t\t\t\t},\n\t\t\t\tslugify(val, locale, options, extra) {\n\t\t\t\t\treturn val.toString().toSlug(extra && extra.length ? extra : '-');\n\t\t\t\t},\n\t\t\t\turlencode(val) {\n\t\t\t\t\treturn encodeURIComponent(val);\n\t\t\t\t},\n\t\t\t\tword(val, locale, options, extra) {\n\t\t\t\t\tif (! extra || ! extra.length)\n\t\t\t\t\t\treturn val;\n\n\t\t\t\t\tlet start, end;\n\t\t\t\t\tconst bits = extra.split(',');\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tstart = parseInt(bits[0], 10);\n\t\t\t\t\t\tif (isNaN(start) || !isFinite(start))\n\t\t\t\t\t\t\treturn val;\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tthis.log.warn('Invalid value for word(start)', bits[0]);\n\t\t\t\t\t\treturn val;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (bits.length > 1) {\n\t\t\t\t\t\tconst bit = bits[1].trim();\n\t\t\t\t\t\tif (! bit.length )\n\t\t\t\t\t\t\tend = -1;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tend = parseInt(bits[1], 10);\n\t\t\t\t\t\t\t\tif (isNaN(end) || !isFinite(end))\n\t\t\t\t\t\t\t\t\treturn val;\n\t\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\t\tthis.log.warn('Invalid value for word(end)', bits[1]);\n\t\t\t\t\t\t\t\treturn val;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst words = val.split(/\\s+/);\n\n\t\t\t\t\tif (start < 0)\n\t\t\t\t\t\tstart = words.length + start;\n\t\t\t\t\tif (start < 0)\n\t\t\t\t\t\tstart = 0;\n\t\t\t\t\tif (start >= words.length)\n\t\t\t\t\t\tstart = words.length - 1;\n\n\t\t\t\t\tif (end != null) {\n\t\t\t\t\t\tif (end < 0)\n\t\t\t\t\t\t\tend = words.length + end;\n\t\t\t\t\t\tif (end < start)\n\t\t\t\t\t\t\tend = start;\n\t\t\t\t\t\tif (end > words.length)\n\t\t\t\t\t\t\tend = words.length;\n\n\t\t\t\t\t\treturn words.slice(start, end + 1).join(' ');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn words[start];\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\n\trenderInlineReasons(data, t, tip) {\n\t\tconst reasons = this.parent.context.get('chat.actions.reasons'),\n\t\t\treason_elements = [],\n\t\t\troom = this.parent.context.get('chat.actions.rules-as-reasons') && this.parent.getRoom(data.room.id, data.room.login, true),\n\t\t\trules = room && room.rules;\n\n\t\tif ( ! reasons && ! rules ) {\n\t\t\ttip.hide();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst click_fn = reason => e => {\n\t\t\ttip.hide();\n\t\t\tdata.definition.click.call(this, e, Object.assign({reason}, data));\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t};\n\n\t\tif ( reasons && reasons.length ) {\n\t\t\tfor(const reason of reasons) {\n\t\t\t\tconst text = this.replaceVariables((typeof reason.i18n === 'string') ? this.i18n.t(reason.i18n, reason.text) : reason.text, data);\n\n\t\t\t\treason_elements.push(<li class=\"tw-full-width tw-relative\">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\tclass=\"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05\"\n\t\t\t\t\t\tonClick={click_fn(text)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{text}\n\t\t\t\t\t</a>\n\t\t\t\t</li>)\n\t\t\t}\n\t\t}\n\n\t\tif ( rules && rules.length ) {\n\t\t\tif ( reasons && reasons.length )\n\t\t\t\treason_elements.push(<div class=\"tw-mg-y-05 tw-border-b\"></div>);\n\n\t\t\tfor(const rule of rules) {\n\t\t\t\treason_elements.push(<li class=\"tw-full-width tw-relative\">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\tclass=\"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05\"\n\t\t\t\t\t\tonClick={click_fn(rule)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{rule}\n\t\t\t\t\t</a>\n\t\t\t\t</li>);\n\t\t\t}\n\t\t}\n\n\t\tlet reason_text;\n\t\tif ( data.definition.reason_text )\n\t\t\treason_text = data.definition.reason_text.call(this, data, t, tip);\n\t\telse\n\t\t\treason_text = this.i18n.t('chat.actions.select-reason', 'Please select a reason from the list below:');\n\n\t\treturn (<div class=\"ffz--inline-reasons\">\n\t\t\t{reason_text ? <div class=\"tw-pd-05 tw-border-b\">\n\t\t\t\t{reason_text}\n\t\t\t</div> : null}\n\t\t\t<div class=\"scrollable-area\" data-simplebar>\n\t\t\t\t<div class=\"simplebar-scroll-content\">\n\t\t\t\t\t<div class=\"simplebar-content\">\n\t\t\t\t\t\t<ul>{reason_elements}</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>);\n\t}\n\n\n\trenderInlineContext(target, data) {\n\t\tconst definition = data.definition;\n\t\tlet content;\n\n\t\tif ( definition.context )\n\t\t\tcontent = (t, tip) => definition.context.call(this, data, t, tip);\n\n\t\telse if ( definition.uses_reason ) {\n\t\t\tcontent = (t, tip) => this.renderInlineReasons(data, t, tip);\n\n\t\t} else\n\t\t\treturn;\n\n\t\treturn this.renderPopup(target, content);\n\t}\n\n\n\trenderPopup(target, content) {\n\t\tif ( target._ffz_destroy )\n\t\t\treturn target._ffz_destroy();\n\n\t\tconst destroy = target._ffz_destroy = () => {\n\t\t\tif ( target._ffz_outside )\n\t\t\t\ttarget._ffz_outside.destroy();\n\n\t\t\tif ( target._ffz_popup ) {\n\t\t\t\tconst fp = target._ffz_popup;\n\t\t\t\ttarget._ffz_popup = null;\n\t\t\t\tfp.destroy();\n\t\t\t}\n\n\t\t\tif ( target._ffz_on_destroy )\n\t\t\t\ttarget._ffz_on_destroy();\n\n\t\t\ttarget._ffz_destroy = target._ffz_outside = target._ffz_on_destroy = null;\n\t\t}\n\n\t\tconst parent = document.fullscreenElement || document.body.querySelector('#root>div') || document.body,\n\t\t\ttt = target._ffz_popup = new Tooltip(parent, target, {\n\t\t\t\tlogger: this.log,\n\t\t\t\tmanual: true,\n\t\t\t\tlive: false,\n\t\t\t\thtml: true,\n\t\t\t\thover_events: true,\n\t\t\t\tno_update: true,\n\n\t\t\t\ttooltipClass: 'ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base',\n\t\t\t\tarrowClass: 'ffz-balloon__tail tw-overflow-hidden tw-absolute',\n\t\t\t\tarrowInner: 'ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute',\n\t\t\t\tinnerClass: '',\n\n\t\t\t\tpopper: {\n\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\tmodifiers: {\n\t\t\t\t\t\tpreventOverflow: {\n\t\t\t\t\t\t\tboundariesElement: parent\n\t\t\t\t\t\t},\n\t\t\t\t\t\tflip: {\n\t\t\t\t\t\t\tbehavior: ['bottom', 'top', 'left', 'right']\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tcontent,\n\t\t\t\tonShow: async (t, tip) => {\n\t\t\t\t\tawait tip.waitForDom();\n\t\t\t\t\ttarget._ffz_outside = new ClickOutside(tip.outer, destroy)\n\t\t\t\t},\n\n\t\t\t\tonMove: (target, tip, event) => {\n\t\t\t\t\tthis.emit('tooltips:hover', target, tip, event)\n\t\t\t\t},\n\n\t\t\t\tonLeave: (target, tip, event) => {\n\t\t\t\t\tthis.emit('tooltips:leave', target, tip, event);\n\t\t\t\t},\n\n\t\t\t\tonHide: destroy\n\t\t\t});\n\n\t\ttt._enter(target);\n\t}\n\n\n\tgetUserLevel(room, user) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! room || ! user  )\n\t\t\treturn 0;\n\n\t\tif ( room.id === user.id || room.login === user.login )\n\t\t\treturn 5;\n\n\t\telse if ( user.moderator || user.type === 'mod' || (user.badges && user.badges.moderator) )\n\t\t\treturn 3;\n\n\t\treturn 0;\n\t}\n\n\n\trenderRoom(mod_icons, current_user, current_room, is_above, createElement) {\n\t\tconst lines = [],\n\t\t\tchat = this.resolve('site.chat');\n\t\tlet line = null;\n\n\t\tfor(const data of this.parent.context.get('chat.actions.room')) {\n\t\t\tif ( ! data )\n\t\t\t\tcontinue;\n\n\t\t\tdata.ctx = 'room';\n\n\t\t\tconst type = data.type;\n\t\t\tif ( type ) {\n\t\t\t\tif ( type === 'new-line' ) {\n\t\t\t\t\tline = null;\n\n\t\t\t\t} else if ( type === 'space' ) {\n\t\t\t\t\tif ( ! line )\n\t\t\t\t\t\tlines.push(line = []);\n\n\t\t\t\t\tline.push(<div class=\"tw-flex-grow-1\" />);\n\n\t\t\t\t} else if ( type === 'space-small' ) {\n\t\t\t\t\tif ( ! line )\n\t\t\t\t\t\tlines.push(line = []);\n\n\t\t\t\t\tline.push(<div class=\"tw-mg-x-1\" />);\n\n\t\t\t\t} else\n\t\t\t\t\tthis.log.warn('Unknown action type', type);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( ! data.action || ! data.appearance )\n\t\t\t\tcontinue;\n\n\t\t\tlet ap = data.appearance || {};\n\t\t\tconst disp = data.display || {},\n\t\t\t\tact = this.actions[data.action];\n\n\t\t\tif ( ! act || disp.disabled ||\n\t\t\t\t(disp.mod_icons != null && disp.mod_icons !== !!mod_icons) ||\n\t\t\t\t(disp.mod != null && disp.mod !== (current_user ? !!current_user.mod : false)) ||\n\t\t\t\t(disp.staff != null && disp.staff !== (current_user ? !!current_user.staff : false)) ||\n\t\t\t\t(disp.emoteOnly != null && disp.emoteOnly !== current_room.emoteOnly) ||\n\t\t\t\t(disp.slowMode != null && disp.slowMode !== current_room.slowMode) ||\n\t\t\t\t(disp.subsMode != null && disp.subsMode !== current_room.subsMode) ||\n\t\t\t\t(disp.r9kMode != null && disp.r9kMode !== current_room.r9kMode) ||\n\t\t\t\t(disp.followersOnly != null && disp.followersOnly !== current_room.followersOnly) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( maybe_call(act.hidden, this, data, null, current_room, current_user, mod_icons) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( ap.type === 'dynamic' ) {\n\t\t\t\tconst out = act.dynamicAppearance && act.dynamicAppearance.call(this, Object.assign({}, ap), data, null, current_room, current_user, mod_icons);\n\t\t\t\tif ( out )\n\t\t\t\t\tap = out;\n\t\t\t}\n\n\t\t\tif ( act.override_appearance ) {\n\t\t\t\tconst out = act.override_appearance.call(this, Object.assign({}, ap), data, null, current_room, current_user, mod_icons);\n\t\t\t\tif ( out )\n\t\t\t\t\tap = out;\n\t\t\t}\n\n\t\t\tconst def = this.renderers[ap.type];\n\t\t\tif ( ! def )\n\t\t\t\tcontinue;\n\n\t\t\tconst has_color = def.colored && ap.color,\n\t\t\t\tdisabled = maybe_call(act.disabled, this, data, null, current_room, current_user, mod_icons) || false,\n\t\t\t\tcolor = has_color && (chat && chat.colors ? chat.colors.process(ap.color) : ap.color),\n\t\t\t\tcontents = def.render.call(this, ap, createElement, color);\n\n\t\t\tif ( ! line )\n\t\t\t\tlines.push(line = []);\n\n\t\t\tline.push(<button\n\t\t\t\tclass={`ffz-tooltip tw-pd-x-05 mod-icon ffz-mod-icon tw-c-text-alt-2${disabled ? ' disabled' : ''}${has_color ? ' colored' : ''}`}\n\t\t\t\tdata-tooltip-type=\"action\"\n\t\t\t\tdata-action={data.action}\n\t\t\t\tdata-options={data.options ? JSON.stringify(data.options) : null}\n\t\t\t\tdata-tip={ap.tooltip}\n\t\t\t\tonClick={this.handleClick}\n\t\t\t\tonContextMenu={this.handleContext}\n\t\t\t>\n\t\t\t\t{contents}\n\t\t\t</button>);\n\t\t}\n\n\t\tif ( ! lines.length )\n\t\t\treturn null;\n\n\t\tconst room = current_room && JSON.stringify(current_room),\n\t\t\tmulti_line = lines.length > 1;\n\n\t\tconst actions = multi_line ?\n\t\t\tlines.map((line, idx) => <div key={idx} class=\"tw-flex tw-full-width tw-flex-row tw-flex-wrap\">{line}</div>) :\n\t\t\tlines[0];\n\n\t\treturn (<div\n\t\t\tclass={`ffz--room-actions${multi_line ? ' tw-flex-column' : ''} ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${is_above ? 'tw-pd-y-05 tw-border-t' : 'tw-mg-x-05'}`}\n\t\t\tdata-room={room}\n\t\t>\n\t\t\t{actions}\n\t\t</div>)\n\t}\n\n\n\trenderUserContext(target, actions) {\n\t\tconst fine = this.resolve('site.fine'),\n\t\t\tsite = this.resolve('site'),\n\t\t\tchat = this.resolve('site.chat'),\n\t\t\tline = fine && fine.searchParent(target, n => n.props && n.props.message);\n\n\t\tconst msg = line?.props?.message;\n\t\tif ( ! msg || ! site || ! chat )\n\t\t\treturn;\n\n\t\tlet room = msg.roomLogin ? msg.roomLogin : msg.channel ? msg.channel.slice(1) : undefined;\n\t\tif ( ! room && line.props.channelID ) {\n\t\t\tconst r = this.parent.getRoom(line.props.channelID, null, true);\n\t\t\tif ( r && r.login )\n\t\t\t\troom = msg.roomLogin = r.login;\n\t\t}\n\n\t\tconst u = site.getUser(),\n\t\t\tr = {id: line.props.channelID, login: room};\n\n\t\tconst has_replies = !!(line.props.hasReply || line.props.reply || ! line.props.replyRestrictedReason),\n\t\t\tcan_replies = has_replies && msg.message && ! msg.deleted && ! line.props.disableReplyClick,\n\t\t\tcan_reply = can_replies && (has_replies || (u && u.login !== msg.user?.login));\n\n\t\tmsg.roomId = r.id;\n\n\t\tif ( u ) {\n\t\t\tu.moderator = line.props.isCurrentUserModerator;\n\t\t\tu.staff = line.props.isCurrentUserStaff;\n\t\t\tu.reply_mode = this.parent.context.get('chat.replies.style'),\n\t\t\tu.can_reply = can_reply;\n\t\t}\n\n\t\tconst current_level = this.getUserLevel(r, u),\n\t\t\tmsg_level = this.getUserLevel(r, msg.user);\n\n\t\tlet mod_icons = line.props.showModerationIcons;\n\t\tif ( current_level < 3 )\n\t\t\tmod_icons = false;\n\n\t\tconst chat_line = line;\n\n\t\treturn this.renderPopup(target, (t, tip) => {\n\t\t\tconst lines = [];\n\t\t\tlet line = null;\n\n\t\t\tconst handle_click = event => {\n\t\t\t\tthis.handleClick(event, line);\n\t\t\t\ttip.hide();\n\t\t\t};\n\n\t\t\tfor(const data of actions) {\n\t\t\t\tif ( ! data )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tdata.ctx = 'user_context';\n\n\t\t\t\tif ( data.type === 'new-line' ) {\n\t\t\t\t\tline = null;\n\t\t\t\t\tcontinue;\n\n\t\t\t\t} else if ( data.type === 'space-small' ) {\n\t\t\t\t\tif ( ! line )\n\t\t\t\t\t\tlines.push(line = []);\n\n\t\t\t\t\tline.push(<div class=\"tw-pd-x-1\" />);\n\t\t\t\t\tcontinue;\n\n\t\t\t\t} else if ( data.type === 'space' ) {\n\t\t\t\t\tif ( ! line )\n\t\t\t\t\t\tlines.push(line = []);\n\n\t\t\t\t\tline.push(<div class=\"tw-flex-grow-1\" />);\n\t\t\t\t\tcontinue;\n\n\t\t\t\t} else if ( ! data.action || ! data.appearance )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet ap = data.appearance || {};\n\t\t\t\tconst disp = data.display || {},\n\t\t\t\t\tact = this.actions[data.action];\n\n\t\t\t\tif ( ! act || disp.disabled ||\n\t\t\t\t\t(disp.mod_icons != null && disp.mod_icons !== !!mod_icons) ||\n\t\t\t\t\t(disp.mod != null && disp.mod !== (current_level > msg_level)) ||\n\t\t\t\t\t(disp.staff != null && disp.staff !== (u ? !!u.staff : false)) ||\n\t\t\t\t\t(disp.deleted != null && disp.deleted !== !!msg.deleted) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( maybe_call(act.hidden, this, data, msg, r, u, mod_icons, chat_line) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( ap.type === 'dynamic' ) {\n\t\t\t\t\tconst out = act.dynamicAppearance && act.dynamicAppearance.call(this, Object.assign({}, ap), data, msg, r, u, mod_icons, chat_line);\n\t\t\t\t\tif ( out )\n\t\t\t\t\t\tap = out;\n\t\t\t\t}\n\n\t\t\t\tif ( act.override_appearance ) {\n\t\t\t\t\tconst out = act.override_appearance.call(this, Object.assign({}, ap), data, msg, r, u, mod_icons, chat_line);\n\t\t\t\t\tif ( out )\n\t\t\t\t\t\tap = out;\n\t\t\t\t}\n\n\t\t\t\tconst def = this.renderers[ap.type];\n\t\t\t\tif ( ! def )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst has_color = def.colored && ap.color,\n\t\t\t\t\tdisabled = maybe_call(act.disabled, this, data, msg, r, u, mod_icons, chat_line) || false,\n\t\t\t\t\tcolor = has_color && (chat && chat.colors ? chat.colors.process(ap.color) : ap.color),\n\t\t\t\t\tcontents = def.render.call(this, ap, createElement, color);\n\n\t\t\t\tif ( ! line )\n\t\t\t\t\tlines.push(line = []);\n\n\t\t\t\tconst btn = (<button\n\t\t\t\t\tclass={`ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text${disabled ? ' tw-button--disabled disabled' : ''}`}\n\t\t\t\t\t//disabled={disabled}\n\t\t\t\t\tdata-tooltip-type=\"action\"\n\t\t\t\t\tdata-action={data.action}\n\t\t\t\t\tdata-options={data.options ? JSON.stringify(data.options) : null}\n\t\t\t\t\tonClick={handle_click} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\tonContextMenu={this.handleContext}\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tw-button__text\">\n\t\t\t\t\t\t{contents}\n\t\t\t\t\t</span>\n\t\t\t\t</button>);\n\n\t\t\t\tif ( ap.tooltip )\n\t\t\t\t\tbtn.dataset.tip = ap.tooltip;\n\n\t\t\t\tline.push(btn);\n\t\t\t}\n\n\t\t\tconst out = (<div class=\"ffz-action-data tw-pd-05\" data-source=\"msg\">\n\t\t\t\t<div class=\"tw-pd-b-05 tw-border-b\">\n\t\t\t\t\t<strong>{ msg.user.displayName || msg.user.login }</strong>...\n\t\t\t\t</div>\n\t\t\t\t{lines.map(line => {\n\t\t\t\t\tif ( ! line || ! line.length )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn (<div class=\"tw-flex tw-flex-no-wrap\">\n\t\t\t\t\t\t{line}\n\t\t\t\t\t</div>);\n\t\t\t\t})}\n\t\t\t</div>);\n\n\t\t\tout.ffz_message = msg;\n\t\t\tout.ffz_line = chat_line;\n\t\t\treturn out;\n\t\t});\n\t}\n\n\n\trenderHover(msg, mod_icons, current_user, current_room, createElement, instance = null) {\n\t\tconst actions = [];\n\n\t\tconst current_level = this.getUserLevel(current_room, current_user),\n\t\t\tmsg_level = this.getUserLevel(current_room, msg.user),\n\t\t\tis_self = msg.user && current_user && current_user.login === msg.user.login;\n\n\t\tif ( current_level < 3 )\n\t\t\tmod_icons = false;\n\n\t\tconst chat = this.resolve('site.chat');\n\n\t\tlet had_action = false;\n\n\t\tfor(const data of this.parent.context.get('chat.actions.hover')) {\n\t\t\tif ( ! data.action || ! data.appearance )\n\t\t\t\tcontinue;\n\n\t\t\tdata.ctx = 'hover';\n\n\t\t\tlet ap = data.appearance || {};\n\t\t\tconst disp = data.display || {},\n\t\t\t\tkeys = disp.keys,\n\t\t\t\tact = this.actions[data.action];\n\n\t\t\tif ( ! act || disp.disabled ||\n\t\t\t\t(disp.mod_icons != null && disp.mod_icons !== !!mod_icons) ||\n\t\t\t\t(disp.mod != null && disp.mod !== (current_level > msg_level)) ||\n\t\t\t\t(disp.staff != null && disp.staff !== (current_user ? !!current_user.staff : false)) ||\n\t\t\t\t(disp.deleted != null && disp.deleted !== !!msg.deleted) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( is_self && ! act.can_self )\n\t\t\t\tcontinue;\n\n\t\t\tif ( maybe_call(act.hidden, this, data, msg, current_room, current_user, mod_icons, instance) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( ap.type === 'dynamic' ) {\n\t\t\t\tconst out = act.dynamicAppearance && act.dynamicAppearance.call(this, Object.assign({}, ap), data, msg, current_room, current_user, mod_icons, instance);\n\t\t\t\tif ( out )\n\t\t\t\t\tap = out;\n\t\t\t}\n\n\t\t\tif ( act.override_appearance ) {\n\t\t\t\tconst out = act.override_appearance.call(this, Object.assign({}, ap), data, msg, current_room, current_user, mod_icons, instance);\n\t\t\t\tif ( out )\n\t\t\t\t\tap = out;\n\t\t\t}\n\n\t\t\tconst def = this.renderers[ap.type];\n\t\t\tif ( ! def )\n\t\t\t\tcontinue;\n\n\t\t\tconst has_color = def.colored && ap.color,\n\t\t\t\tdisabled = maybe_call(act.disabled, this, data, msg, current_room, current_user, mod_icons, instance) || false,\n\t\t\t\tcolor = has_color && (chat && chat.colors ? chat.colors.process(ap.color) : ap.color),\n\t\t\t\tcontents = def.render.call(this, ap, createElement, color);\n\n\t\t\thad_action = true;\n\t\t\tactions.push(<div class={`ffz-hover-action${keys ? ` ffz-has-modifier ffz-modifier-${keys}` : ''}`}>\n\t\t\t\t<button\n\t\t\t\t\tclass={`ffz-tooltip ffz-mod-icon tw-c-text-alt-2${disabled ? ' disabled' : ''}${has_color ? ' colored' : ''}`}\n\t\t\t\t\t//disabled={disabled}\n\t\t\t\t\tdata-tooltip-type=\"action\"\n\t\t\t\t\tdata-action={data.action}\n\t\t\t\t\tdata-options={data.options ? JSON.stringify(data.options) : null}\n\t\t\t\t\tdata-tip={ap.tooltip}\n\t\t\t\t\tonClick={this.handleClick}\n\t\t\t\t\tonContextMenu={this.handleContext}\n\t\t\t\t>\n\t\t\t\t\t{contents}\n\t\t\t\t</button>\n\t\t\t</div>);\n\t\t}\n\n\t\tif ( ! had_action )\n\t\t\treturn null;\n\n\t\treturn (<div\n\t\t\tclass={`ffz--hover-actions ffz-action-data tw-mg-r-05`}\n\t\t\tdata-source=\"line\"\n\t\t>\n\t\t\t{actions}\n\t\t</div>);\n\t}\n\n\n\trenderInline(msg, mod_icons, current_user, current_room, createElement, instance = null) {\n\t\tconst actions = [];\n\n\t\tconst current_level = this.getUserLevel(current_room, current_user),\n\t\t\tmsg_level = this.getUserLevel(current_room, msg.user),\n\t\t\tis_self = msg.user && current_user && current_user.login === msg.user.login;\n\n\t\tif ( current_level < 3 )\n\t\t\tmod_icons = false;\n\n\t\tconst chat = this.resolve('site.chat'),\n\t\t\tmodified = [];\n\n\t\tlet had_action = false;\n\n\t\tfor(const data of this.parent.context.get('chat.actions.inline')) {\n\t\t\tif ( ! data.action || ! data.appearance )\n\t\t\t\tcontinue;\n\n\t\t\tdata.ctx = 'inline';\n\n\t\t\tlet ap = data.appearance || {};\n\t\t\tconst disp = data.display || {},\n\t\t\t\tkeys = disp.keys,\n\t\t\t\thover = disp.hover,\n\t\t\t\tact = this.actions[data.action];\n\n\t\t\tif ( ! act || disp.disabled ||\n\t\t\t\t(disp.mod_icons != null && disp.mod_icons !== !!mod_icons) ||\n\t\t\t\t(disp.mod != null && disp.mod !== (current_level > msg_level)) ||\n\t\t\t\t(disp.staff != null && disp.staff !== (current_user ? !!current_user.staff : false)) ||\n\t\t\t\t(disp.deleted != null && disp.deleted !== !!msg.deleted) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( is_self && ! act.can_self )\n\t\t\t\tcontinue;\n\n\t\t\tif ( maybe_call(act.hidden, this, data, msg, current_room, current_user, mod_icons, instance) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( ap.type === 'dynamic' ) {\n\t\t\t\tconst out = act.dynamicAppearance && act.dynamicAppearance.call(this, Object.assign({}, ap), data, msg, current_room, current_user, mod_icons, instance);\n\t\t\t\tif ( out )\n\t\t\t\t\tap = out;\n\t\t\t}\n\n\t\t\tif ( act.override_appearance ) {\n\t\t\t\tconst out = act.override_appearance.call(this, Object.assign({}, ap), data, msg, current_room, current_user, mod_icons, instance);\n\t\t\t\tif ( out )\n\t\t\t\t\tap = out;\n\t\t\t}\n\n\t\t\tconst def = this.renderers[ap.type];\n\t\t\tif ( ! def )\n\t\t\t\tcontinue;\n\n\t\t\tconst has_color = def.colored && ap.color,\n\t\t\t\tdisabled = maybe_call(act.disabled, this, data, msg, current_room, current_user, mod_icons, instance) || false,\n\t\t\t\tcolor = has_color && (chat && chat.colors ? chat.colors.process(ap.color) : ap.color),\n\t\t\t\tcontents = def.render.call(this, ap, createElement, color);\n\n\t\t\tlet list = actions;\n\n\t\t\tif ( keys || hover )\n\t\t\t\tlist = modified;\n\n\t\t\thad_action = true;\n\t\t\tlist.push(<button\n\t\t\t\tclass={`ffz-tooltip mod-icon ffz-mod-icon tw-c-text-alt-2${disabled ? ' disabled' : ''}${has_color ? ' colored' : ''}${keys ? ` ffz-modifier-${keys}` : ''}${hover ? ' ffz-hover' : ''}`}\n\t\t\t\t//disabled={disabled}\n\t\t\t\tdata-tooltip-type=\"action\"\n\t\t\t\tdata-action={data.action}\n\t\t\t\tdata-options={data.options ? JSON.stringify(data.options) : null}\n\t\t\t\tdata-tip={ap.tooltip}\n\t\t\t\tonClick={this.handleClick}\n\t\t\t\tonContextMenu={this.handleContext}\n\t\t\t>\n\t\t\t\t{contents}\n\t\t\t</button>);\n\t\t}\n\n\t\tif ( ! had_action )\n\t\t\treturn null;\n\n\t\tlet out = null;\n\t\tif ( actions.length )\n\t\t\tout = (<div\n\t\t\t\tclass=\"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05\"\n\t\t\t\tdata-source=\"line\"\n\t\t\t>\n\t\t\t\t{actions}\n\t\t\t</div>);\n\n\t\tif ( modified.length ) {\n\t\t\tconst modified_out = (<div\n\t\t\t\tclass=\"ffz--inline-actions ffz--modifier-actions ffz-action-data\"\n\t\t\t\tdata-source=\"line\"\n\t\t\t>\n\t\t\t\t{modified}\n\t\t\t</div>);\n\n\t\t\tif ( out )\n\t\t\t\treturn [out, modified_out];\n\t\t\treturn modified_out;\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tgetData(element) {\n\t\tconst ds = element.dataset,\n\t\t\tparent = element.closest('.ffz-action-data'),\n\t\t\tpds = parent && parent.dataset,\n\t\t\taction = ds && ds.action,\n\t\t\tdefinition = this.actions[action];\n\n\t\tif ( ! definition )\n\t\t\treturn null;\n\n\t\tlet user, room, message, loaded = false, line;\n\n\t\tif ( pds ) {\n\t\t\tif ( pds.source === 'msg' && parent.ffz_message ) {\n\t\t\t\tconst msg = parent.ffz_message;\n\t\t\t\tline = parent.ffz_line;\n\n\t\t\t\tloaded = true;\n\t\t\t\tuser = msg.user ? {\n\t\t\t\t\tcolor: msg.user.color,\n\t\t\t\t\tid: msg.user.id,\n\t\t\t\t\tlogin: msg.user.login,\n\t\t\t\t\tdisplayName: msg.user.displayName,\n\t\t\t\t\ttype: msg.user.type\n\t\t\t\t} : null;\n\n\t\t\t\troom = {\n\t\t\t\t\tlogin: msg.roomLogin,\n\t\t\t\t\tid: msg.roomId\n\t\t\t\t};\n\n\t\t\t\tmessage = {\n\t\t\t\t\tid: msg.id,\n\t\t\t\t\ttext: msg.message\n\t\t\t\t};\n\n\t\t\t} else if ( pds.source === 'line' ) {\n\t\t\t\tconst fine = this.resolve('site.fine');\n\t\t\t\tline = fine && fine.searchParent(parent, n => n.props && n.props.message);\n\n\t\t\t\tif ( line && line.props && line.props.message ) {\n\t\t\t\t\tloaded = true;\n\n\t\t\t\t\tconst msg = line.props.message;\n\n\t\t\t\t\tuser = msg.user ? {\n\t\t\t\t\t\tcolor: msg.user.color,\n\t\t\t\t\t\tid: msg.user.id,\n\t\t\t\t\t\tlogin: msg.user.login,\n\t\t\t\t\t\tdisplayName: msg.user.displayName,\n\t\t\t\t\t\ttype: msg.user.type\n\t\t\t\t\t} : null;\n\n\t\t\t\t\troom = {\n\t\t\t\t\t\tlogin: line.props.channelLogin,\n\t\t\t\t\t\tid: line.props.channelID\n\t\t\t\t\t}\n\n\t\t\t\t\tmessage = {\n\t\t\t\t\t\tid: msg.id,\n\t\t\t\t\t\ttext: msg.message\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! loaded ) {\n\t\t\t\tuser = pds.user ? JSON.parse(pds.user) : null;\n\t\t\t\troom = pds.room ? JSON.parse(pds.room) : null;\n\t\t\t\tmessage = pds.message ? JSON.parse(pds.message) : pds.msgId ? {id: pds.msgId} : null;\n\t\t\t}\n\t\t}\n\n\t\tconst data = {\n\t\t\taction,\n\t\t\tdefinition,\n\t\t\ttip: ds.tip,\n\t\t\toptions: ds.options ? JSON.parse(ds.options) : null,\n\t\t\tuser,\n\t\t\troom,\n\t\t\tmessage,\n\t\t\tmessage_id: message ? message.id : null,\n\t\t\tline\n\t\t};\n\n\t\tif ( definition.defaults )\n\t\t\tdata.options = Object.assign({}, maybe_call(definition.defaults, this, data, element), data.options);\n\n\t\treturn data;\n\t}\n\n\n\thandleClick(event) {\n\t\tconst target = event.target,\n\t\t\tdata = this.getData(target);\n\t\tif ( ! data )\n\t\t\treturn;\n\n\t\tif ( target.classList.contains('disabled') )\n\t\t\treturn;\n\n\t\tif ( ! data.definition.click ) {\n\t\t\tif ( data.definition.context )\n\t\t\t\treturn this.handleContext(event);\n\n\t\t\treturn this.log.warn(`No click handler for action provider \"${data.action}\"`);\n\t\t}\n\n\t\tif ( target._ffz_tooltip )\n\t\t\ttarget._ffz_tooltip.hide();\n\n\t\treturn data.definition.click.call(this, event, data);\n\t}\n\n\thandleContext(event) {\n\t\tif ( event.shiftKey )\n\t\t\treturn;\n\n\t\tevent.preventDefault();\n\n\t\tconst target = event.target,\n\t\t\tdata = this.getData(event.target);\n\t\tif ( ! data )\n\t\t\treturn;\n\n\t\tif ( target.classList.contains('disabled') )\n\t\t\treturn;\n\n\t\tif ( target._ffz_tooltip )\n\t\t\ttarget._ffz_tooltip.hide();\n\n\t\tif ( ! data.definition.context && ! data.definition.uses_reason )\n\t\t\treturn;\n\n\t\tthis.renderInlineContext(target, data);\n\t}\n\n\thandleUserContext(event) {\n\t\tif ( event.shiftKey )\n\t\t\treturn;\n\n\t\tconst actions = this.parent.context.get('chat.actions.user-context');\n\t\tif ( ! Array.isArray(actions) || ! actions.length )\n\t\t\treturn;\n\n\t\tevent.preventDefault();\n\n\t\tconst target = event.target;\n\t\tif ( target._ffz_tooltip )\n\t\t\ttarget._ffz_tooltip.hide();\n\n\t\tthis.renderUserContext(target, actions);\n\t}\n\n\tpasteMessage(room, message) {\n\t\treturn this.resolve('site.chat.input').pasteMessage(room, message);\n\t}\n\n\n\taddNotice(room, message) {\n\t\treturn this.resolve('site.chat').addNotice(room, message);\n\t}\n\n\n\tsendMessage(room, message) {\n\t\treturn this.resolve('site.chat').sendMessage(room, message);\n\t}\n}\n","'use strict';\n\nimport {load as loadFontAwesome} from 'utilities/font-awesome';\n\n\n// ============================================================================\n// Dynamic\n// ============================================================================\n\nexport const dynamic = {\n\ttitle: 'Dynamic',\n\ttitle_i18n: 'setting.actions.appearance.dynamic',\n\n\tcolored: true,\n\n\trender(data, createElement, color) {\n\t\treturn <figure style={{color}} class={`${data.icon||'ffz-i-zreknarf'}`} />;\n\t}\n}\n\n\n// ============================================================================\n// Text\n// ============================================================================\n\nexport const text = {\n\ttitle: 'Text',\n\ttitle_i18n: 'setting.actions.appearance.text',\n\n\tcolored: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-text.vue'),\n\n\tcomponent: () => import(/* webpackChunkName: 'main-menu' */ './components/preview-text.vue'),\n\trender(data, createElement, color) {\n\t\treturn <span style={{color}}>{data.text}</span>;\n\t}\n}\n\n// ============================================================================\n// Emote\n// ============================================================================\n\nexport const emote = {\n\ttitle: 'Emote',\n\ttitle_i18n: 'setting.actions.appearance.emote',\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-emote.vue'),\n\n\tcomponent: () => import(/* webpackChunkName: 'main-menu' */ './components/preview-emote.vue'),\n\trender(data, createElement) {\n\t\treturn <figure class=\"mod-icon__image\"><img src={data.src} /></figure>;\n\t}\n}\n\n// ============================================================================\n// Icon\n// ============================================================================\n\nexport const icon = {\n\ttitle: 'Icon',\n\ttitle_i18n: 'setting.actions.appearance.icon',\n\n\tcolored: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-icon.vue'),\n\n\tload(data) {\n\t\tif ( data.icon && data.icon.startsWith('ffz-fa') )\n\t\t\tloadFontAwesome();\n\n\t\treturn true;\n\t},\n\n\tcomponent: () => import(/* webpackChunkName: 'main-menu' */ './components/preview-icon.vue'),\n\n\trender(data, createElement, color) {\n\t\treturn <figure style={{color}} class={`${data.icon||'ffz-i-zreknarf'}`} />;\n\t}\n}\n\n\n// ============================================================================\n// Text + Icon\n// ============================================================================\n\nexport const combo = {\n\ttitle: 'Text and Icon',\n\ttitle_i18n: 'setting.actions.appearance.combo',\n\n\tcolored: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-combo.vue'),\n\n\tload(data) {\n\t\tif ( data.icon && data.icon.startsWith('ffz-fa') )\n\t\t\tloadFontAwesome();\n\n\t\treturn true;\n\t},\n\n\tcomponent: () => import(/* webpackChunkName: 'main-menu' */ './components/preview-combo.vue'),\n\n\trender(data, createElement, color) {\n\t\treturn (<span style={{color}} class={data.icon}>\n\t\t\t{data.text}\n\t\t</span>)\n\t}\n}\n\n\n// ============================================================================\n// Image\n// ============================================================================\n\nexport const image = {\n\ttitle: 'Image',\n\ttitle_i18n: 'setting.actions.appearance.image',\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-image.vue'),\n\n\tcomponent: () => import(/* webpackChunkName: 'main-menu' */ './components/preview-image.vue'),\n\trender(data, createElement) {\n\t\treturn <figure class=\"mod-icon__image\"><img src={data.image} /></figure>;\n\t}\n}\n\n\n// ============================================================================\n// Emoji\n// ============================================================================\n\n/*export const emoji = {\n\ttitle: 'Emoji',\n\ttitle_i18n: 'setting.actions.appearance.emoji',\n\n\tcolored: false,\n\teditor: () => import(/* webpackChunkName: 'main-menu' * / './components/edit-emoji.vue'),\n\n\tload(data) {\n\t\tif ( data.icon && data.icon.startsWith('ffz-fa') )\n\t\t\tloadFontAwesome();\n\n\t\treturn true;\n\t},\n\n\tcomponent: () => import(/* webpackChunkName: 'main-menu' * / './components/preview-emoji.vue'),\n\n\trender(data, createElement) {\n\t\treturn <figure class=\"mod-icon__image\"><img src={data.image} /></figure>;\n\t}\n}*/","'use strict';\n\nimport { TranslatableError } from 'src/utilities/object';\nimport {createElement} from 'utilities/dom';\n\n\n// ============================================================================\n// Pin Message\n// ============================================================================\n\nexport const pin = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-pin'\n\t\t}\n\t}],\n\n\trequired_context: ['message'],\n\n\ttitle: 'Pin This Message',\n\tdescription: \"Allows you to pin a chat message if you're a moderator.\",\n\n\tcan_self: true,\n\n\ttooltip(data) {\n\t\tconst pinned = data.line?.props?.pinnedMessage?.message?.id === data.message_id;\n\t\tif (pinned)\n\t\t\treturn this.i18n.t('chat.actions.pin.already', 'This message is already pinned.');\n\n\t\treturn this.i18n.t('chat.actions.pin', 'Pin This Message')\n\t},\n\n\tdisabled(data, message, current_room, current_user, mod_icons, instance) {\n\t\tconst line = instance ?? data.line,\n\t\t\tprops = line?.props,\n\t\t\tpinned = props?.pinnedMessage?.message?.id === message.id && message.id != null;\n\n\t\treturn pinned;\n\t},\n\n\thidden(data, message, current_room, current_user, mod_icons, instance) {\n\t\tlet line = instance;\n\n\t\tif ( ! line )\n\t\t\treturn true;\n\n\t\tif ( ! line.props.isPinnable || ! line.onPinMessageClick )\n\t\t\treturn true;\n\n\t\t// If the message is empty or deleted, we can't pin it.\n\t\tif ( ! message.message || ! message.message.length || message.deleted )\n\t\t\treturn true;\n\t},\n\n\tclick(event, data) {\n\t\tlet line = data.line;\n\t\tif ( ! line ) {\n\t\t\tconst fine = this.resolve('site.fine');\n\t\t\tline = fine ? fine.searchParent(event.target, n => n.setMessageTray && n.props && n.props.message) : null;\n\t\t}\n\n\t\tif ( ! line || ! line.props.isPinnable || ! line.onPinMessageClick )\n\t\t\treturn;\n\n\t\tif ( line.props.pinnedMessage?.message?.id === data.message_id )\n\t\t\treturn;\n\n\t\tline.onPinMessageClick();\n\t}\n}\n\n\n// ============================================================================\n// Send Reply\n// ============================================================================\n\nexport const reply = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'dynamic'\n\t\t}\n\t}],\n\n\trequired_context: ['message'],\n\tsupports_dynamic: true,\n\n\ttitle: 'Reply to Message',\n\tdescription: \"Allows you to directly reply to another user's message.\",\n\n\tcan_self: true,\n\n\tdynamicAppearance(ap, data, message, current_room, current_user, mod_icons, instance) {\n\t\tconst line = instance ?? data.line,\n\t\t\tprops = line?.props,\n\t\t\thas_reply = props?.hasReply || props?.reply;\n\n\t\treturn {\n\t\t\ttype: 'icon',\n\t\t\ticon: has_reply ? 'ffz-i-threads' : 'ffz-i-reply',\n\t\t\tcolor: ap.color\n\t\t}\n\t},\n\n\ttooltip(data) {\n\t\tconst props = data.line?.props,\n\t\t\thas_reply = props?.hasReply || props?.reply;\n\n\t\tif (has_reply)\n\t\t\treturn this.i18n.t('chat.actions.reply.thread', 'Open Thread');\n\n\t\treturn this.i18n.t('chat.actions.reply', 'Reply to Message')\n\t},\n\n\thidden(data, message, current_room, current_user) {\n\t\tconst id = message?.id;\n\t\tif ( typeof id !== 'string' || ! /^[0-9a-f]+-[0-9a-f]+/.test(id) )\n\t\t\treturn true;\n\n\t\t// Users must be able to reply.\n\t\tif ( ! current_user?.can_reply )\n\t\t\treturn true;\n\n\t\t// If reply mode is set to 0 (Disabled), don't show the action.\n\t\tif ( current_user?.reply_mode === 0 )\n\t\t\treturn true;\n\n\t\t// If the message is empty or deleted, don't show the action.\n\t\tif ( ! message.message || message.deleted )\n\t\t\treturn true;\n\t},\n\n\tclick(event, data) {\n\t\tlet line = data.line;\n\t\tif ( ! line ) {\n\t\t\tconst fine = this.resolve('site.fine');\n\t\t\tline = fine ? fine.searchParent(event.target, n => n.setMessageTray && n.props && n.props.message) : null;\n\t\t}\n\n\t\tif ( ! line )\n\t\t\treturn;\n\n\t\tline.ffzOpenReply();\n\t}\n}\n\n\n// ============================================================================\n// Edit Overrides\n// ============================================================================\n\nexport const edit_overrides = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-pencil'\n\t\t}\n\t}],\n\n\trequired_context: ['user'],\n\n\ttitle: 'Change Name & Color',\n\tdescription: 'Allows you to set local overrides for a user\\'s name and color in chat.',\n\n\tcan_self: true,\n\n\ttooltip() {\n\t\treturn this.i18n.t('chat.actions.edit_overrides', 'Change Name & Color')\n\t},\n\n\tclick(event, data) {\n\t\t//const ref = makeReference(event.clientX, event.clientY);\n\t\tthis.resolve('chat.overrides').renderUserEditor(data.user, event.target);\n\t}\n}\n\n\n// ============================================================================\n// Copy to Clipboard\n// ============================================================================\n\nexport const copy_message = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-docs'\n\t\t}\n\t}],\n\n\tdefaults: {\n\t\tformat: '{{user.displayName}}: {{message.text}}'\n\t},\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-copy.vue'),\n\n\trequired_context: ['user', 'message'],\n\n\ttitle: 'Copy Message',\n\tdescription: 'Allows you to quickly copy a chat message to your clipboard.',\n\n\tcan_self: true,\n\n\ttooltip(data) {\n\t\tconst msg = this.replaceVariables(data.options.format, data);\n\n\t\treturn [\n\t\t\t(<div class=\"tw-border-b tw-mg-b-05\">{ // eslint-disable-line react/jsx-key\n\t\t\t\tthis.i18n.t('chat.actions.copy_message', 'Copy Message')\n\t\t\t}</div>),\n\t\t\t(<div class=\"tw-align-left\">{ // eslint-disable-line react/jsx-key\n\t\t\t\tmsg\n\t\t\t}</div>)\n\t\t];\n\t},\n\n\tclick(event, data) {\n\t\tconst msg = this.replaceVariables(data.options.format, data);\n\t\tnavigator.clipboard.writeText(msg);\n\t}\n}\n\n\n// ============================================================================\n// Open URL\n// ============================================================================\n\nexport const open_url = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-link-ext'\n\t\t}\n\t}],\n\n\tdefaults: {\n\t\turl: 'https://link.example/{{user.login}}'\n\t},\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-url.vue'),\n\n\ttitle: 'Open URL',\n\tdescription(data) {\n\t\treturn data.options.url;\n\t},\n\tdescription_i18n: null,\n\n\tcan_self: true,\n\n\ttooltip(data) {\n\t\tconst url = this.replaceVariables(data.options.url, data);\n\n\t\treturn [\n\t\t\t(<div class=\"tw-border-b tw-mg-b-05\">{ // eslint-disable-line react/jsx-key\n\t\t\t\tthis.i18n.t('chat.actions.open_url', 'Open URL')\n\t\t\t}</div>),\n\t\t\t(<div class=\"tw-align-left\">{ // eslint-disable-line react/jsx-key\n\t\t\t\turl\n\t\t\t}</div>)\n\t\t]\n\t},\n\n\tclick(event, data) {\n\t\tconst url = this.replaceVariables(data.options.url, data);\n\n\t\tconst win = window.open();\n\t\tif ( win ) {\n\t\t\twin.opener = null;\n\t\t\twin.location = url;\n\t\t}\n\t}\n};\n\n\n// ============================================================================\n// Chat\n// ============================================================================\n\nexport const chat = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'text',\n\t\t\ttext: 'C'\n\t\t}\n\t}],\n\n\trequired_context: ['room'],\n\n\tdefaults: {\n\t\tcommand: '@{{user.login}} HeyGuys',\n\t\tpaste: false\n\t},\n\n\ttitle: 'Chat Command',\n\tdescription(data) {\n\t\tif ( data.options.paste )\n\t\t\treturn this.t('chat.actions.chat.desc.paste', 'Paste into chat: {cmd}', {cmd: data.options.command})\n\n\t\tconst target = data.options.target ?? '';\n\n\t\treturn this.t('chat.actions.chat.desc.target', 'Send in {target}: {cmd}', {\n\t\t\tcmd: data.options.command,\n\t\t\ttarget: /^\\s*$/.test(target)\n\t\t\t\t? this.t('chat.actions.chat.desc.current', 'current channel')\n\t\t\t\t: target\n\t\t});\n\t},\n\tdescription_i18n: null,\n\n\tcan_self: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-chat.vue'),\n\n\ttooltip(data) {\n\t\tconst msg = this.replaceVariables(data.options.command, data);\n\t\tlet target = this.replaceVariables(data.options.target ?? '', data);\n\t\tif ( /^\\s*$/.test(target) )\n\t\t\ttarget = null;\n\n\t\treturn [\n\t\t\t(<div class=\"tw-border-b tw-mg-b-05\">{ // eslint-disable-line react/jsx-key\n\t\t\t\ttarget\n\t\t\t\t\t? this.i18n.t('chat.actions.chat.with-target', 'Chat Command in Channel: {target}', {target})\n\t\t\t\t\t: this.i18n.t('chat.actions.chat', 'Chat Command')\n\t\t\t}</div>),\n\t\t\t(<div class=\"tw-align-left\">{ // eslint-disable-line react/jsx-key\n\t\t\t\tmsg\n\t\t\t}</div>)\n\t\t]\n\t},\n\n\tclick(event, data) {\n\t\tconst msg = this.replaceVariables(data.options.command, data);\n\t\tlet target = this.replaceVariables(data.options.target ?? '', data);\n\t\tif ( data.options.paste || /^\\s*$/.test(target) )\n\t\t\ttarget = data.room.login;\n\n\t\tif ( data.options.paste )\n\t\t\tthis.pasteMessage(target, msg);\n\t\telse\n\t\t\tthis.sendMessage(target, msg);\n\t}\n}\n\n\n// ============================================================================\n// Timeout\n// ============================================================================\n\nexport const msg_delete = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-trash'\n\t\t},\n\n\t\tdisplay: {\n\t\t\tmod: true,\n\t\t\tmod_icons: true\n\t\t}\n\t}],\n\n\tdefaults: {},\n\trequired_context: ['room', 'user', 'message'],\n\n\ttitle: 'Delete Message',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.delete.tooltip', \"Delete {user.login}'s message\", {user: data.user});\n\t},\n\n\tclick(event, data) {\n\t\tconst td = this.resolve('site.twitch_data');\n\t\treturn td.deleteChatMessage(data.room.id, data.message_id).catch(err => {\n\t\t\tif ( err instanceof TranslatableError )\n\t\t\t\tthis.addNotice(data.room.login, this.i18n.t(err.i18n_key, err.message, err.data));\n\t\t});\n\t}\n}\n\n\n\nexport const ban = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-block'\n\t\t},\n\n\t\tdisplay: {\n\t\t\tmod: true,\n\t\t\tmod_icons: true\n\t\t}\n\t}],\n\n\tdefaults: {},\n\n\trequired_context: ['room', 'user'],\n\tuses_reason: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-ban.vue'),\n\n\ttitle: 'Ban User',\n\n\treason_text(data) {\n\t\treturn this.i18n.t('chat.actions.ban-reason', 'Ban {user.login} for:', {user: data.user});\n\t},\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.ban.tooltip', 'Ban {user.login}', {user: data.user});\n\t},\n\n\tclick(event, data) {\n\t\tlet reason = data.reason || data.options.reason || '';\n\t\tif ( reason.length )\n\t\t\treason = this.replaceVariables(reason, data);\n\n\t\tthis.sendMessage(data.room.login, `/ban ${data.user.login} ${reason}`);\n\t}\n}\n\n\nexport const timeout = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-clock'\n\t\t},\n\n\t\tdisplay: {\n\t\t\tmod: true,\n\t\t\tmod_icons: true\n\t\t}\n\t}],\n\n\tdefaults: {\n\t\tduration: 600\n\t},\n\n\trequired_context: ['room', 'user'],\n\tuses_reason: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-timeout.vue'),\n\n\ttitle: 'Timeout User',\n\tdescription: '{options.duration, plural, one {# second} other {# seconds}}',\n\n\treason_text(data) {\n\t\treturn this.i18n.t('chat.actions.timeout-reason',\n\t\t\t'Timeout {user.login} for {duration, plural, one {# second} other {# seconds}} for:',\n\t\t\t{\n\t\t\t\tuser: data.user,\n\t\t\t\tduration: data.options.duration\n\t\t\t}\n\t\t);\n\t},\n\n\ttooltip(data) {\n\t\treturn this.i18n.t(\n\t\t\t'chat.actions.timeout.tooltip',\n\t\t\t'Timeout {user.login} for {duration, plural, one {# second} other {# seconds}}',\n\t\t\t{\n\t\t\t\tuser: data.user,\n\t\t\t\tduration: data.options.duration\n\t\t\t}\n\t\t);\n\t},\n\n\tclick(event, data) {\n\t\tlet reason = data.reason || data.options.reason || '';\n\t\tif ( reason.length )\n\t\t\treason = this.replaceVariables(reason, data);\n\n\t\tthis.sendMessage(data.room.login, `/timeout ${data.user.login} ${data.options.duration} ${reason}`);\n\t}\n}\n\n\nexport const unban = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-ok'\n\t\t},\n\n\t\tdisplay: {\n\t\t\tmod: true,\n\t\t\tmod_icons: true\n\t\t}\n\t}],\n\n\trequired_context: ['room', 'user'],\n\n\ttitle: 'Unban User',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.unban.tooltip', 'Unban {user.login}', {user: data.user});\n\t},\n\n\tclick(event, data) {\n\t\tthis.sendMessage(data.room.login, `/unban ${data.user.login}`);\n\t}\n}\n\n\nexport const untimeout = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-ok'\n\t\t},\n\n\t\tdisplay: {\n\t\t\tmod: true,\n\t\t\tmod_icons: true\n\t\t}\n\t}],\n\n\trequired_context: ['room', 'user'],\n\n\ttitle: 'Untimeout User',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.untimeout.tooltip', 'Untimeout {user.login}', {user: data.user});\n\t},\n\n\tclick(event, data) {\n\t\tthis.sendMessage(data.room.login, `/untimeout ${data.user.login}`);\n\t}\n}\n\n\n// ============================================================================\n// Mod and Unmod User\n// ============================================================================\n\nexport const mod = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-mod'\n\t\t}\n\t}],\n\n\trequired_context: ['room', 'user'],\n\n\ttitle: 'Mod User',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.mod.tooltip', 'Mod {user.login}', {user: data.user});\n\t},\n\n\thidden(data, message, current_room, current_user, mod_icons, instance) {\n\t\t// You cannot mod mods.\n\t\tif ( message.user.type === 'mod' )\n\t\t\treturn true;\n\n\t\t// You cannot mod the broadcaster.\n\t\tif ( message.user.id === current_room.id )\n\t\t\treturn true;\n\n\t\t// Only the broadcaster can mod, otherwise.\n\t\treturn current_room.id !== current_user.id;\n\t},\n\n\tclick(event, data) {\n\t\tthis.sendMessage(data.room.login, `/mod ${data.user.login}`);\n\t}\n};\n\n\nexport const unmod = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-unmod'\n\t\t}\n\t}],\n\n\trequired_context: ['room', 'user'],\n\n\ttitle: 'Un-Mod User',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.unmod.tooltip', 'Un-Mod {user.login}', {user: data.user});\n\t},\n\n\thidden(data, message, current_room, current_user, mod_icons, instance) {\n\t\t// You can only un-mod mods.\n\t\tif ( message.user.type !== 'mod' )\n\t\t\treturn true;\n\n\t\t// You can unmod yourself.\n\t\tif ( message.user.id === current_user.id )\n\t\t\treturn false;\n\n\t\t// You cannot unmod the broadcaster.\n\t\tif ( message.user.id === current_room.id )\n\t\t\treturn false;\n\n\t\t// Only the broadcaster can unmod, otherwise.\n\t\treturn current_room.id !== current_user.id;\n\t},\n\n\tclick(event, data) {\n\t\tthis.sendMessage(data.room.login, `/unmod ${data.user.login}`);\n\t}\n};\n\n\n// ============================================================================\n// Whisper\n// ============================================================================\n\nexport const whisper = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'text',\n\t\t\ttext: 'W'\n\t\t}\n\t}],\n\n\trequired_context: ['user'],\n\n\ttitle: 'Whisper User',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.whisper.tooltip', 'Whisper {user.login}', data);\n\t},\n\n\tclick(event, data) {\n\t\tconst site = this.resolve('site'),\n\t\t\tme = site && site.getUser(),\n\t\t\tstore = site && site.store;\n\n\t\tif ( ! me || ! store || ! data.user || ! data.user.id || me.id == data.user.id )\n\t\t\treturn;\n\n\t\tconst id_1 = parseInt(me.id, 10),\n\t\t\tid_2 = parseInt(data.user.id, 10),\n\t\t\tthread = id_1 < id_2 ? `${id_1}_${id_2}` : `${id_2}_${id_1}`;\n\n\t\tstore.dispatch({\n\t\t\ttype: 'whispers.THREAD_OPENED',\n\t\t\tdata: {\n\t\t\t\tthreadID: thread,\n\t\t\t\tcollapsed: false\n\t\t\t}\n\t\t});\n\t}\n}\n\n\n// ============================================================================\n// Toggle Profile\n// ============================================================================\n\nexport const toggle_profile = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'dynamic'\n\t\t}\n\t}],\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/edit-profile.vue'),\n\n\trequired_context: [],\n\tsupports_dynamic: true,\n\tcan_self: true,\n\n\ttitle: 'Toggle Settings Profile',\n\tdescription(data) {\n\t\tconst ffz = window.FrankerFaceZ.get(),\n\t\t\tsettings = ffz?.resolve('settings'),\n\t\t\tprofile = settings?.profile(data.options?.uuid);\n\n\t\tif ( ! profile )\n\t\t\treturn null;\n\n\t\treturn profile.i18n_key ? this.t(profile.i18n_key, profile.name) : profile.name;\n\t},\n\tdescription_i18n: null,\n\n\tdynamicAppearance(ap, data) {\n\t\tconst profile = this.settings.profile(data.options?.uuid);\n\t\tif ( ! profile )\n\t\t\treturn {\n\t\t\t\ttype: 'icon',\n\t\t\t\ticon: 'ffz-i-attention',\n\t\t\t\tcolor: ap.color\n\t\t\t};\n\n\t\treturn {\n\t\t\ttype: 'icon',\n\t\t\ticon: profile.toggled ? 'ffz-i-ok' : 'ffz-i-cancel',\n\t\t\tcolor: ap.color\n\t\t}\n\t},\n\n\ttooltip(data) {\n\t\tconst profile = this.settings.profile(data.options?.uuid);\n\t\tlet name;\n\t\tif ( ! profile )\n\t\t\tname = 'invalid';\n\t\telse\n\t\t\tname = profile.i18n_key ? this.i18n.t(profile.i18n_key, profile.name) : profile.name;\n\n\t\treturn this.i18n.t('chat.actions.toggle_profile.tooltip', 'Toggle Profile: {name}', {\n\t\t\tname\n\t\t});\n\t},\n\n\tclick(event, data) {\n\t\tconst profile = this.settings.profile(data.options?.uuid);\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\t// TODO: Make dynamic appearance things update automatically so\n\t\t// we don't need this hack.\n\n\t\t// Find any setting using this.\n\t\tconst found = new Set;\n\t\tfor(const ctx of ['inline', 'hover', 'user-context', 'room']) {\n\t\t\tconst key = `chat.actions.${ctx}`,\n\t\t\t\tstuff = this.parent.context.get(key);\n\n\t\t\tif ( Array.isArray(stuff) )\n\t\t\t\tfor(const item of stuff) {\n\t\t\t\t\tif ( item.action === 'toggle_profile' ) {\n\t\t\t\t\t\tif ( item.options?.uuid === profile.uuid ) {\n\t\t\t\t\t\t\tfound.add(ctx);\n\t\t\t\t\t\t\tthis.parent.context.once(`changed:${key}`, () => found.delete(ctx));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\t// Toggle the profile.\n\t\tprofile.toggled = ! profile.toggled;\n\n\t\t// Now wait, and update any setting that didn't update.\n\t\trequestAnimationFrame(() => {\n\t\t\tfor(const ctx of found) {\n\t\t\t\tthis.parent.context.update(`chat.actions.${ctx}`);\n\t\t\t}\n\t\t});\n\t}\n}\n\n\n// ============================================================================\n// Gift Subscription\n// ============================================================================\n/*\nexport const gift_sub = {\n\tpresets: [{\n\t\tappearance: {\n\t\t\ttype: 'icon',\n\t\t\ticon: 'ffz-i-gift'\n\t\t}\n\t}],\n\n\trequired_context: ['room', 'user', 'product'],\n\n\ttitle: 'Gift Subscription',\n\n\ttooltip(data) {\n\t\treturn this.i18n.t('chat.actions.gift_sub', 'Gift a Sub to {user.login}', data);\n\t},\n\n\tcontext() {\n\t\treturn (<div class=\"tw-border\">\n\t\t\tWoop woop.\n\t\t</div>);\n\t}\n}*/\n","'use strict';\n\n// ============================================================================\n// Badge Handling\n// ============================================================================\n\nimport {NEW_API, SERVER, IS_WEBKIT, IS_FIREFOX, WEBKIT_CSS as WEBKIT, DEBUG} from 'utilities/constants';\n\nimport {createElement, ManagedStyle} from 'utilities/dom';\nimport {has, makeAddonIdChecker, maybe_call, SourcedSet} from 'utilities/object';\nimport Module, { buildAddonProxy } from 'utilities/module';\nimport { ColorAdjuster } from 'utilities/color';\nimport { NoContent } from 'utilities/tooltip';\n\nconst CSS_BADGES = {\n\t1: {\n\t\tstaff: { 1: { color: '#200f33', svg: true, trans: { color: '#6441a5' } } },\n\t\tadmin: { 1: { color: '#faaf19', svg: true  } },\n\t\tglobal_mod: { 1: { color: '#0c6f20', svg: true } },\n\t\tbroadcaster: { 1: { color: '#e71818', svg: true } },\n\t\tmoderator: { 1: { color: '#34ae0a', svg: true } },\n\t\ttwitchbot: { 1: { color: '#34ae0a' } },\n\t\tpartner: { 1: { color: 'transparent', trans: { image: true, color: '#6441a5' } } },\n\t\t'clip-champ': { 1: { color: '#6441a5'} },\n\n\t\tvip: { 1: { color: '#b33ff0', trans: { color: 'transparent', invert: false}} },\n\t\tturbo: { 1: { color: '#6441a5', svg: true } },\n\t\tpremium: { 1: { color: '#009cdc' } },\n\n\t\tsubscriber: { 0: { color: '#6441a5' }, 1: { color: '#6441a5' }},\n\t},\n\n\t2: {\n\t\tstaff: { 1: { color: '#000' } },\n\t\tadmin: { 1: { color: '#DB7600' } },\n\t\tbroadcaster: { 1: { color: '#E91916' } },\n\t\tmoderator: { 1: { color: '#00AD03' } },\n\t\tglobal_mod: { 1: { color: '#006441' } },\n\t\ttwitchbot: { 1: { color: '#00AD03' } },\n\t\tpartner: { 1: { color: '#9146FF' } },\n\n\t\tsubscriber: { 0: { color: '#8205B4'}, 1: { color: '#8205B4' } },\n\n\t\tvip: { 1: { color: '#E005B9' } },\n\t\tturbo: { 1: { color: '#59399A' } },\n\t\tpremium: { 1: { color: '#00A0D6' } },\n\t\t'anonymous-cheerer': { 1: { color: '#4B367C' } },\n\t\t'clip-champ': { 1: { color: '#9146FF' } },\n\t\t'artist-badge': { 1: { color: '#1e69ff' } },\n\t\t'no_audio': { 1: { color: '#323239' } },\n\t\t'no_video': { 1: { color: '#323239' } }\n\t}\n}\n\nexport const BADGE_POSITIONS = {\n\tstaff: -2,\n\tadmin: -1,\n\tglobal_mod: -1,\n\tbroadcaster: 0,\n\tmod: 1,\n\tmoderator: 1,\n\ttwitchbot: 1,\n\tvip: 2,\n\tsubscriber: 25\n};\n\n\nconst NO_REPEAT = 'background-repeat:no-repeat;background-position:center;',\n\tBASE_IMAGE = `${SERVER}/static/badges/twitch/`,\n\tCSS_MASK_IMAGE = IS_WEBKIT ? 'webkitMaskImage' : 'maskImage',\n\n\tCSS_TEMPLATES = {\n\t\t0: data => `${data.fore ? `color:${data.fore};` : ''}background:${data.image||''} ${data.color};background-size:${data.scale*1.8}rem;${data.svg ? '' : `background-image:${data.image_set};`}${NO_REPEAT}`,\n\t\t1: data => `${CSS_TEMPLATES[0](data)}border-radius:${data.scale*.2}rem;`,\n\t\t2: data => `${CSS_TEMPLATES[0](data)}border-radius:${data.scale*.9}rem;background-size:${data.scale*1.6}rem;`,\n\t\t3: data => `${data.fore ? `color:${data.fore};` : ''}background:${data.color};border-radius:${data.scale*.9}rem;`,\n\t\t4: data => `${CSS_TEMPLATES[3](data)}height:${data.scale}rem;min-width:${data.scale}rem;`,\n\t\t5: data => `background:${data.image};background-size:${data.scale*1.8}rem;${data.svg ? `` : `background-image:${data.image_set};`}${NO_REPEAT}`,\n\t\t6: data => `background:linear-gradient(${data.color},${data.color});${WEBKIT}mask-image:${data.image};${WEBKIT}mask-size:${data.scale*1.8}rem ${data.scale*1.8}rem;${data.svg ? `` : `${WEBKIT}mask-image:${data.image_set};`}`\n\t};\n\n\nexport function generateOverrideCSS(data, style) {\n\tconst urls = data.urls || {1: data.image},\n\t\timage = `url(\"${urls[1]}\")`,\n\t\timage_set = `${WEBKIT}image-set(${image} 1x${urls[2] ? `, url(\"${urls[2]}\") 2x` : ''}${urls[4] ? `, url(\"${urls[4]}\") 4x` : ''})`;\n\n\tif ( style === 3 || style === 4 )\n\t\treturn '';\n\n\tif ( style === 6 )\n\t\treturn `${WEBKIT}mask-image:${image} !important;${WEBKIT}mask-image:${image_set} !important;`;\n\telse\n\t\treturn `background-image:${image} !important;background-image:${image_set} !important;`;\n}\n\n\nexport function generateBadgeCSS(badge, version, data, style, is_dark, badge_version = 2, color_fixer, fg_fixer, scale = 1, clickable = false) {\n\tlet color = data.color || 'transparent',\n\t\tfore = data.fore || is_dark ? '#fff' : '#000',\n\t\tbase_image = data.image || (data.addon ? null : `${BASE_IMAGE}${badge_version}/${badge}${data.svg ? '.svg' : `/${version}/`}`),\n\t\ttrans = false,\n\t\tinvert = false,\n\t\tsvg, image, image_set;\n\n\tif ( base_image && style > 4 ) {\n\t\tconst td = data.trans || {};\n\t\tcolor = td.color || color;\n\n\t\tif ( td.image ) {\n\t\t\ttrans = true;\n\t\t\tif ( td.image !== true )\n\t\t\t\tbase_image = td.image;\n\t\t}\n\n\t\tif ( has(td, 'invert') )\n\t\t\tinvert = td.invert && ! is_dark;\n\t\telse\n\t\t\tinvert = style === 5 && ! is_dark;\n\t}\n\n\tif ( style === 3 || style === 4 ) {\n\t\tif ( color === 'transparent' && data.trans )\n\t\t\tcolor = data.trans.color || color;\n\t}\n\n\tif ( color === 'transparent' )\n\t\tstyle = 0;\n\n\tif ( base_image && style !== 3 && style !== 4 ) {\n\t\tsvg = base_image.endsWith('.svg');\n\t\tif ( data.urls )\n\t\t\timage = `url(\"${data.urls[scale]}\")`;\n\t\telse\n\t\t\timage = `url(\"${svg ? base_image : `${base_image}${scale}${trans ? '_trans' : ''}.png`}\")`;\n\n\t\tif ( data.urls && scale === 1 ) {\n\t\t\timage_set = `${WEBKIT}image-set(${image} 1x${data.urls[2] ? `, url(\"${data.urls[2]}\") 2x` : ''}${data.urls[4] ? `, url(\"${data.urls[4]}\") 4x` : ''})`\n\n\t\t} else if ( data.urls && scale === 2 ) {\n\t\t\timage_set = `${WEBKIT}image-set(${image} 1x${data.urls[4] ? `, url(\"${data.urls[4]}\") 2x` : ''})`;\n\n\t\t} else if ( ! svg && scale < 4 ) {\n\t\t\tif ( scale === 1 )\n\t\t\t\timage_set = `${WEBKIT}image-set(${image} 1x, url(\"${base_image}2${trans ? '_trans' : ''}.png\") 2x, url(\"${base_image}4${trans ? '_trans' : ''}.png\") 4x)`;\n\n\t\t\telse if ( scale === 2 )\n\t\t\t\timage_set = `${WEBKIT}image-set(${image} 1x, url(\"${base_image}4${trans ? '_trans' : ''}.png\") 2x)`;\n\n\t\t} else\n\t\t\timage_set = image;\n\t}\n\n\tif ( color_fixer && color && color !== 'transparent' )\n\t\tcolor = color_fixer.process(color) || color;\n\n\tif ( fg_fixer && fore && fore !== 'transparent' && color !== 'transparent' ) {\n\t\tfg_fixer.base = color;\n\t\tfore = fg_fixer.process(fore) || fore;\n\t}\n\n\tif ( ! base_image ) {\n\t\tif ( style > 4 )\n\t\t\tstyle = 1;\n\t\telse if ( style > 3 )\n\t\t\tstyle = 2;\n\t}\n\n\treturn `${clickable && (data.click_handler || data.click_url || data.click_action) ? 'cursor:pointer;' : ''}${invert ? 'filter:invert(100%);' : ''}${CSS_TEMPLATES[style]({\n\t\tscale: 1,\n\t\tcolor,\n\t\tfore,\n\t\timage,\n\t\timage_set,\n\t\tsvg\n\t})}${data.css || ''}`;\n}\n\n\nexport default class Badges extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('tooltips');\n\t\tthis.inject('experiments');\n\t\tthis.inject('staging');\n\t\tthis.inject('load_tracker');\n\n\t\tthis.style = new ManagedStyle('badges');\n\n\t\t// Bulk data structure for badges applied to a lot of users.\n\t\t// This lets us avoid allocating lots of individual user\n\t\t// objects when we don't need to do so.\n\t\tthis.bulk = new Map;\n\n\t\tthis._woofer_months = {};\n\n\t\tthis.badges = {};\n\t\tthis.twitch_badges = {};\n\n\t\tif ( IS_FIREFOX )\n\t\t\tthis.settings.add('chat.badges.media-queries', {\n\t\t\t\tdefault: true,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Chat > Badges >> tabs ~> Appearance',\n\t\t\t\t\ttitle: 'Use @media queries to support High-DPI Badge images in Mozilla Firefox.',\n\t\t\t\t\tdescription: 'This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.',\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.settings.add('chat.badges.version', {\n\t\t\tdefault: 2,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> tabs ~> Appearance',\n\t\t\t\ttitle: 'Version',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 1, title: '1 (Pre December 2019)'},\n\t\t\t\t\t{value: 2, title: '2 (Current)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.badges.clickable', {\n\t\t\tdefault: 2,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif (val === true)\n\t\t\t\t\treturn 2;\n\t\t\t\telse if (val === false)\n\t\t\t\t\treturn 0;\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> Behavior',\n\t\t\t\ttitle: 'Allow clicking badges.',\n\t\t\t\tdescription: 'Certain badges, such as Prime Gaming, act as links when this is enabled.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Legacy (Open URLs)'},\n\t\t\t\t\t{value: 2, title: 'Open Badge Card'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.badges.fix-colors', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> tabs ~> Appearance',\n\t\t\t\ttitle: 'Adjust badge colors for visibility.',\n\t\t\t\tdescription: 'Ensures that badges are visible against the current background.\\n\\n**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.badges.hidden', {\n\t\t\tdefault: {},\n\t\t\ttype: 'object_merge',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> tabs ~> Visibility',\n\t\t\t\ttitle: 'Visibility',\n\t\t\t\tcomponent: 'badge-visibility',\n\t\t\t\tgetBadges: cb => this.getSettingsBadges(true, cb)\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.badges.custom-mod', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> tabs ~> Appearance',\n\t\t\t\ttitle: 'Use custom moderator badges where available.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.badges.custom-vip', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> tabs ~> Appearance',\n\t\t\t\ttitle: 'Use custom VIP badges where available.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.badges.style', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Badges >> tabs ~> Appearance',\n\t\t\t\ttitle: 'Style',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Square'},\n\t\t\t\t\t{value: 1, title: 'Rounded'},\n\t\t\t\t\t{value: 2, title: 'Circular'},\n\t\t\t\t\t{value: 3, title: 'Circular (Color Only)'},\n\t\t\t\t\t{value: 4, title: 'Circular (Color Only, Small)'},\n\t\t\t\t\t{value: 5, title: 'Transparent'},\n\t\t\t\t\t{value: 6, title: 'Transparent (Colored)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t}\n\n\tgetSettingsBadges(include_addons, callback) {\n\t\tconst twitch = [],\n\t\t\tother = [],\n\t\t\towl = [],\n\t\t\ttcon = [],\n\t\t\tgame = [],\n\t\t\tffz = [],\n\t\t\tspecific_addons = {},\n\t\t\taddon = [];\n\n\t\tconst twitch_keys = Object.keys(this.twitch_badges);\n\t\tif ( ! twitch_keys.length && callback ) {\n\t\t\tconst td = this.resolve('site.twitch_data');\n\t\t\tif ( td )\n\t\t\t\ttd.getBadges().then(data => {\n\t\t\t\t\tthis.updateTwitchBadges(data);\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t}\n\n\t\tfor(const key in this.twitch_badges)\n\t\t\tif ( has(this.twitch_badges, key) ) {\n\t\t\t\tconst badge = this.twitch_badges[key],\n\t\t\t\t\tvs = [];\n\t\t\t\tlet v = badge && (badge[1] || badge[0]);\n\n\t\t\t\tfor(const key in badge)\n\t\t\t\t\tif ( key !== '__cat' && has(badge, key) ) {\n\t\t\t\t\t\tconst version = badge[key];\n\t\t\t\t\t\tif ( ! v )\n\t\t\t\t\t\t\tv = version;\n\n\t\t\t\t\t\tif ( version && version.image1x )\n\t\t\t\t\t\t\tvs.push({\n\t\t\t\t\t\t\t\tversion: key,\n\t\t\t\t\t\t\t\tname: version.title,\n\t\t\t\t\t\t\t\timage: version.image1x,\n\t\t\t\t\t\t\t\tstyleImage: `url(\"${version.image1x}\")`\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\tif ( v ) {\n\t\t\t\t\tlet cat;\n\t\t\t\t\tif ( badge.__cat === 'm-other' )\n\t\t\t\t\t\tcat = other;\n\t\t\t\t\telse if ( badge.__cat === 'm-owl' )\n\t\t\t\t\t\tcat = owl;\n\t\t\t\t\telse if ( badge.__cat === 'm-tcon' )\n\t\t\t\t\t\tcat = tcon;\n\t\t\t\t\telse if ( badge.__cat === 'm-game' )\n\t\t\t\t\t\tcat = game;\n\t\t\t\t\telse\n\t\t\t\t\t\tcat = twitch;\n\n\t\t\t\t\tcat.push({\n\t\t\t\t\t\tid: key,\n\t\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\t\tname: v.title,\n\t\t\t\t\t\tcolor: 'transparent',\n\t\t\t\t\t\timage: v.image2x,\n\t\t\t\t\t\tversions: vs,\n\t\t\t\t\t\tstyleImage: `url(\"${v.image2x}\")`\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\tif ( include_addons ) {\n\t\t\tconst addon_badges_by_id = {};\n\n\t\t\tfor(const [key, badge] of Object.entries(this.badges)) {\n\t\t\t\tif ( badge.no_visibility )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet image = badge.urls ? (badge.urls[2] || badge.urls[1]) : badge.image,\n\t\t\t\t\timage1x = badge.urls?.[1] || badge.image,\n\t\t\t\t\tcolor = badge.color || 'transparent';\n\n\t\t\t\tif ( ! badge.addon ) {\n\t\t\t\t\timage = `//cdn.frankerfacez.com/badge/${badge.id}/2/rounded`;\n\t\t\t\t\timage1x = `//cdn.frankerfacez.com/badge/${badge.id}/1/rounded`;\n\t\t\t\t\tcolor = 'transparent';\n\t\t\t\t}\n\n\t\t\t\tlet store;\n\t\t\t\tif ( typeof badge.addon === 'string' )\n\t\t\t\t\tstore = specific_addons[badge.addon] = specific_addons[badge.addon] || [];\n\t\t\t\telse\n\t\t\t\t\tstore = badge.addon ? addon : ffz;\n\n\t\t\t\tlet name = badge.title;\n\t\t\t\tlet extra;\n\t\t\t\ttry {\n\t\t\t\t\textra = maybe_call(badge.tooltipExtra, this, null, badge);\n\t\t\t\t} catch(err) { extra = null; }\n\t\t\t\tif ( extra && !(extra instanceof Promise) )\n\t\t\t\t\tname = name + extra;\n\n\t\t\t\tconst id = badge.base_id ?? key,\n\t\t\t\t\tis_this = id === key;\n\t\t\t\tlet existing = addon_badges_by_id[id];\n\n\t\t\t\tif ( existing ) {\n\t\t\t\t\tif ( ! existing.versions )\n\t\t\t\t\t\texisting.versions = [{\n\t\t\t\t\t\t\tversion: existing.key,\n\t\t\t\t\t\t\tname: existing.tipname,\n\t\t\t\t\t\t\tcolor: existing.color,\n\t\t\t\t\t\t\timage: existing.image1x,\n\t\t\t\t\t\t\tstyleImage: `url(\"${existing.image1x}\")`\n\t\t\t\t\t\t}];\n\n\t\t\t\t\texisting.versions.push({\n\t\t\t\t\t\tversion: key,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\timage: image1x,\n\t\t\t\t\t\tstyleImage: `url(\"${image1x}\")`\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( is_this ) {\n\t\t\t\t\t\texisting.name = badge.title;\n\t\t\t\t\t\texisting.tipname = name;\n\t\t\t\t\t\texisting.color = color;\n\t\t\t\t\t\texisting.image = image;\n\t\t\t\t\t\texisting.styleImage = `url(\"${image}\")`;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\texisting = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\tprovider: 'ffz',\n\t\t\t\t\t\tname: badge.title,\n\t\t\t\t\t\ttipname: name,\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\timage,\n\t\t\t\t\t\timage1x,\n\t\t\t\t\t\tstyleImage: `url(\"${image}\")`\n\t\t\t\t\t};\n\n\t\t\t\t\tif ( badge.base_id ) {\n\t\t\t\t\t\texisting.always_versions = true;\n\t\t\t\t\t\texisting.versions = [{\n\t\t\t\t\t\t\tversion: existing.key,\n\t\t\t\t\t\t\tname: existing.tipname,\n\t\t\t\t\t\t\tcolor: existing.color,\n\t\t\t\t\t\t\timage: existing.image1x,\n\t\t\t\t\t\t\tstyleImage: `url(\"${existing.image1x}\")`\n\t\t\t\t\t\t}];\n\t\t\t\t\t}\n\n\t\t\t\t\taddon_badges_by_id[id] = existing;\n\t\t\t\t\tstore.push(existing);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst out = [\n\t\t\t{title: 'Twitch', id: 'm-twitch', badges: twitch},\n\t\t\t{title: 'Twitch: TwitchCon', id: 'm-tcon', badges: tcon},\n\t\t\t{title: 'Twitch: Other', id: 'm-other', badges: other},\n\t\t\t{title: 'Twitch: Overwatch League', id: 'm-owl', badges: owl},\n\t\t\t{title: 'Twitch: Game', id: 'm-game', key: 'game', badges: game}\n\t\t];\n\n\t\tif ( ffz.length )\n\t\t\tout.push({title: 'FrankerFaceZ', id: 'm-ffz', badges: ffz});\n\n\t\tconst addons = this.resolve('addons'),\n\t\t\taddon_chunks = [];\n\n\t\tfor(const [key, val] of Object.entries(specific_addons)) {\n\t\t\tconst addon = addons?.getAddon?.(key),\n\t\t\t\ttitle = addon?.short_name ?? addon?.name ?? key;\n\n\t\t\taddon_chunks.push({title: `Add-On: ${title}`, id: `m-addon-${key}`, badges: val});\n\t\t}\n\n\t\taddon_chunks.sort((a,b) => a.title.localeCompare(b.title));\n\t\tout.push(...addon_chunks);\n\n\t\tif ( addon.length )\n\t\t\tout.push({title: 'Add-on', id: 'm-addon', badges: addon});\n\n\t\treturn out;\n\t}\n\n\n\tonEnable() {\n\t\tthis.parent.context.on('changed:chat.badges.custom-mod', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:chat.badges.custom-vip', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:chat.badges.style', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:theme.is-dark', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:theme.tooltips-dark', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:chat.badges.version', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:chat.badges.media-queries', this.rebuildAllCSS, this);\n\t\tthis.parent.context.on('changed:chat.badges.fix-colors', this.rebuildColoredBadges, this);\n\t\tthis.parent.context.on('changed:chat.badges.clickable', this.rebuildAllCSS, this);\n\n\t\tthis.rebuildAllCSS();\n\t\tthis.loadGlobalBadges();\n\n\t\tthis.on('chat:reload-data', flags => {\n\t\t\tif ( ! flags || flags.badges )\n\t\t\t\tthis.loadGlobalBadges();\n\t\t});\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tlet removed = 0;\n\t\t\tfor(const [key, val] of Object.entries(this.badges)) {\n\t\t\t\tif ( val?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.removeBadge(key, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( removed ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed} entries when unloading addon:`, addon_id);\n\t\t\t\tthis.generateBadgeCSS();\n\t\t\t\t// TODO: Debounced re-badge all chat messages.\n\t\t\t}\n\t\t});\n\n\t\tthis.tooltips.types.badge = (target, tip) => {\n\t\t\ttip.add_class = 'ffz__tooltip--badges';\n\n\t\t\tconst show_previews = this.parent.context.get('tooltip.badge-images');\n\t\t\tconst ds = this.getBadgeData(target);\n\n\t\t\tif ( ds.data == null )\n\t\t\t\treturn NoContent;\n\n\t\t\tconst out = [];\n\t\t\tlet promises = false;\n\n\t\t\tfor(const d of ds.data) {\n\t\t\t\tlet source_channel = null;\n\t\t\t\tif ( d.room ) {\n\t\t\t\t\tconst source = this.resolve('site.chat')?.shared_room_data?.get(d.room);\n\t\t\t\t\tsource_channel = source?.displayName;\n\t\t\t\t\tif (source_channel)\n\t\t\t\t\t\tsource_channel = `\\n\\n${source_channel}`;\n\t\t\t\t}\n\n\t\t\t\tconst p = d.provider;\n\t\t\t\tif ( p === 'twitch' ) {\n\t\t\t\t\tconst bd = this.getTwitchBadge(d.badge, d.version, ds.room_id, ds.room_login),\n\t\t\t\t\t\tglobal_badge = this.getTwitchBadge(d.badge, d.version, null, null, true) || {};\n\t\t\t\t\tif ( ! bd )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tlet title = bd.title || global_badge.title;\n\t\t\t\t\tconst tier = bd.tier || global_badge.tier;\n\n\t\t\t\t\tif ( d.data ) {\n\t\t\t\t\t\tif ( d.badge === 'subscriber' ) {\n\t\t\t\t\t\t\tif ( tier > 0 )\n\t\t\t\t\t\t\t\ttitle = this.i18n.t('badges.subscriber.tier-months', '{title}\\n(Tier {tier}, {months, plural, one {# Month} other {# Months}})', {\n\t\t\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\t\t\ttier,\n\t\t\t\t\t\t\t\t\tmonths: d.data\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\ttitle = this.i18n.t('badges.subscriber.months', '{title}\\n({count, plural, one {# Month} other {# Months}})', {\n\t\t\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\t\t\tcount: d.data\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if ( d.badge === 'founder' ) {\n\t\t\t\t\t\t\ttitle = this.i18n.t('badges.founder.months', '{title}\\n(Subscribed for {count, plural, one {# Month} other {# Months}})', {\n\t\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\t\tcount: d.data\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tout.push(<div class=\"ffz-badge-tip\">\n\t\t\t\t\t\t{show_previews && <img class=\"preview-image ffz-badge\" src={bd.image4x} />}\n\t\t\t\t\t\t{title}{source_channel}\n\t\t\t\t\t</div>);\n\n\t\t\t\t} else if ( p === 'ffz' ) {\n\t\t\t\t\tconst full_badge = this.badges[d.id],\n\t\t\t\t\t\tbadge = d.badge,\n\t\t\t\t\t\textra = maybe_call(badge?.tooltipExtra ?? full_badge?.tooltipExtra, this, ds, badge, target, tip);\n\n\t\t\t\t\tif ( extra instanceof Promise ) {\n\t\t\t\t\t\tpromises = true;\n\t\t\t\t\t\tout.push(extra.then(stuff => (<div class=\"ffz-badge-tip\">\n\t\t\t\t\t\t\t{show_previews && d.image && <div\n\t\t\t\t\t\t\t\tclass=\"preview-image ffz-badge\"\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tbackgroundColor: d.color,\n\t\t\t\t\t\t\t\t\tbackgroundImage: `url(\"${d.image}\")`\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>}\n\t\t\t\t\t\t\t{d.title}{stuff||''}{source_channel}\n\t\t\t\t\t\t</div>)));\n\n\t\t\t\t\t} else\n\t\t\t\t\t\tout.push(<div class=\"ffz-badge-tip\">\n\t\t\t\t\t\t\t{show_previews && d.image && <div\n\t\t\t\t\t\t\t\tclass=\"preview-image ffz-badge\"\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tbackgroundColor: d.color,\n\t\t\t\t\t\t\t\t\tbackgroundImage: `url(\"${d.image}\")`\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>}\n\t\t\t\t\t\t\t{d.title}{extra||''}{source_channel}\n\t\t\t\t\t\t</div>);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( promises )\n\t\t\t\treturn Promise.all(out);\n\t\t\treturn out;\n\t\t}\n\t}\n\n\t// ========================================================================\n\t// Add-On Proxy\n\t// ========================================================================\n\n\tgetAddonProxy(addon_id, addon, module) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst is_dev = DEBUG || (addon?.dev ?? false),\n\t\t\tid_checker = makeAddonIdChecker(addon_id);\n\n\t\tconst overrides = {},\n\t\t\twarnings = {};\n\n\t\toverrides.loadBadgeData = (badge_id, data, ...args) => {\n\t\t\tif ( data && data.addon === undefined )\n\t\t\t\tdata.addon = addon_id;\n\n\t\t\tif ( is_dev && ! id_checker.test(badge_id) )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to chat.badges.loadBadgeData() did not include addon ID in badge_id:', badge_id);\n\n\t\t\treturn this.loadBadgeData(badge_id, data, ...args);\n\t\t};\n\n\t\tif ( is_dev ) {\n\t\t\toverrides.removeBadge = (badge_id, ...args) => {\n\t\t\t\t// Note: We aren't checking that the badge_id contains the add-on\n\t\t\t\t// ID because that should be handled by loadBadgeData for badges\n\t\t\t\t// from this add-on. Checking if we're removing a badge from\n\t\t\t\t// another source covers the rest.\n\n\t\t\t\tconst existing = this.badges[badge_id];\n\t\t\t\tif ( existing && existing.addon !== addon_id )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned badge with chat.badges.removeBadge():', key, ' owner:', existing.addon ?? 'ffz');\n\n\t\t\t\treturn this.removeBadge(badge_id, ...args);\n\t\t\t};\n\n\t\t\toverrides.setBulk = (source, ...args) => {\n\t\t\t\tif ( ! id_checker.test(source) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to chat.badges.setBulk() did not include addon ID in source:', source);\n\n\t\t\t\treturn this.setBulk(source, ...args);\n\t\t\t};\n\n\t\t\toverrides.deleteBulk = (source, ...args) => {\n\t\t\t\tif ( ! id_checker.test(source) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to chat.badges.deleteBulk() did not include addon ID in source:', source);\n\n\t\t\t\treturn this.deleteBulk(source, ...args);\n\t\t\t}\n\n\t\t\toverrides.extendBulk = (source, ...args) => {\n\t\t\t\tif ( ! id_checker.test(source) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to chat.badges.extendBulk() did not include addon ID in source:', source);\n\n\t\t\t\treturn this.extendBulk(source, ...args);\n\t\t\t}\n\n\t\t\twarnings.badges = 'Please use loadBadgeData() or removeBadge()';\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'chat.badges', overrides, warnings);\n\t}\n\n\n\tgetBadgeData(target) {\n\t\tlet container = target.parentElement?.parentElement;\n\t\tif ( ! container?.dataset?.roomId )\n\t\t\tcontainer = target.closest('[data-room-id]');\n\n\t\tconst room_id = container?.dataset?.roomId,\n\t\t\troom_login = container?.dataset?.room,\n\n\t\t\tuser_id = container?.dataset?.userId,\n\t\t\tuser_login = container?.dataset?.user;\n\n\t\tlet data;\n\t\tif (target.dataset.badgeData )\n\t\t\tdata = JSON.parse(target.dataset.badgeData);\n\t\telse {\n\t\t\tconst badge_idx = target.dataset.badgeIdx;\n\t\t\tlet message;\n\n\t\t\tif ( container.message )\n\t\t\t\tmessage = container.message;\n\t\t\telse {\n\t\t\t\tconst fine = this.resolve('site.fine');\n\n\t\t\t\tif ( fine ) {\n\t\t\t\t\tmessage = container[fine.accessor]?.return?.stateNode?.props?.message;\n\t\t\t\t\tif ( ! message )\n\t\t\t\t\t\tmessage = fine.searchParent(container, n => n.props?.message)?.props?.message;\n\t\t\t\t\tif ( ! message && this.root.flavor === 'clips' ) {\n\t\t\t\t\t\tconst lines = this.resolve('site.chat.line');\n\t\t\t\t\t\tconst node = fine.searchParent(container, n => n.props?.node)?.props?.node;\n\t\t\t\t\t\tif ( lines && node )\n\t\t\t\t\t\t\tmessage = lines.messages.get(node);\n\t\t\t\t\t}\n\t\t\t\t\tif ( ! message )\n\t\t\t\t\t\tmessage = fine.searchParent(container, n => n.props?.node)?.props?.node?._ffz_message;\n\t\t\t\t\tif ( ! message )\n\t\t\t\t\t\tmessage = fine.searchParent(container, n => n.props?.messageContext)?.props?.messageContext?.comment?._ffz_message;\n\t\t\t\t\tif ( ! message )\n\t\t\t\t\t\tmessage = fine.searchParent(container, n => n._ffzIdentityMsg, 50)?._ffzIdentityMsg;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( message?._ffz_message)\n\t\t\t\tmessage = message._ffz_message;\n\t\t\tif ( message )\n\t\t\t\tdata = message.ffz_badge_cache?.[badge_idx]?.[1]?.badges;\n\t\t}\n\n\t\treturn {\n\t\t\troom_id: room_id,\n\t\t\troom_login: room_login,\n\t\t\tuser_id: user_id,\n\t\t\tuser_login: user_login,\n\t\t\tdata\n\t\t};\n\t}\n\n\n\thandleClick(event) {\n\t\tconst mode = this.parent.context.get('chat.badges.clickable');\n\t\tif ( ! mode )\n\t\t\treturn;\n\n\t\tconst target = event.target;\n\t\tconst ds = this.getBadgeData(target);\n\n\t\tif ( ds.data == null )\n\t\t\treturn;\n\n\t\tlet url = null;\n\t\tlet click_badge = null;\n\n\t\tfor(const d of ds.data) {\n\t\t\tconst p = d.provider;\n\t\t\tif ( p === 'twitch' ) {\n\t\t\t\tconst bd = this.getTwitchBadge(d.badge, d.version, ds.room_id, ds.room_login),\n\t\t\t\t\tglobal_badge = this.getTwitchBadge(d.badge, d.version, null, null, true) || {};\n\t\t\t\tif ( ! bd )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( mode == 1 && bd.click_url )\n\t\t\t\t\turl = bd.click_url;\n\t\t\t\telse if ( mode == 1 && global_badge.click_url )\n\t\t\t\t\turl = global_badge.click_url;\n\t\t\t\telse if ( mode == 1 && (bd.click_action === 'sub' || global_badge.click_action === 'sub') && ds.room_login )\n\t\t\t\t\turl = `https://www.twitch.tv/subs/${ds.room_login}`;\n\t\t\t\telse\n\t\t\t\t\tclick_badge = bd;\n\n\t\t\t\tbreak;\n\n\t\t\t} else if ( p === 'ffz' ) {\n\t\t\t\tconst badge = this.badges[target.dataset.badge];\n\t\t\t\tif ( badge?.click_handler ) {\n\t\t\t\t\turl = badge.click_handler(ds.user_id, ds.user_login, ds.room_id, ds.room_login, ds.data, event);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ( badge?.click_url ) {\n\t\t\t\t\turl = badge.click_url;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (click_badge) {\n\t\t\tconst fine = this.resolve('site.fine');\n\t\t\tif (fine) {\n\t\t\t\tconst line = fine.searchParent(target, n => n.openBadgeDetails && n.props?.message);\n\t\t\t\tif (line) {\n\t\t\t\t\tline.openBadgeDetails(click_badge, event);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( url ) {\n\t\t\tconst link = createElement('a', {\n\t\t\t\ttarget: '_blank',\n\t\t\t\trel: 'noopener noreferrer',\n\t\t\t\thref: url\n\t\t\t});\n\t\t\tlink.click();\n\t\t}\n\n\t\tevent.preventDefault();\n\t}\n\n\n\tcacheBadges(msg, skip_hide = false) {\n\t\tif ( msg.ffz_badge_cache )\n\t\t\treturn msg.ffz_badge_cache;\n\n\t\tconst hidden_badges = skip_hide ? {} : (this.parent.context.get('chat.badges.hidden') || {}),\n\t\t\tbadge_style = this.parent.context.get('chat.badges.style'),\n\t\t\tcustom_mod = this.parent.context.get('chat.badges.custom-mod'),\n\t\t\tcustom_vip = this.parent.context.get('chat.badges.custom-vip'),\n\t\t\tis_mask = badge_style > 5,\n\t\t\tis_colored = badge_style !== 5,\n\t\t\thas_image = badge_style !== 3 && badge_style !== 4,\n\n\t\t\ttb = this.twitch_badges,\n\n\t\t\tslotted = new Map,\n\t\t\ttwitch_badges = msg.badges || {},\n\t\t\tdynamic_data = msg.badgeDynamicData || {},\n\n\t\t\t//user = msg.user || {},\n\t\t\t//user_id = user.id,\n\t\t\t//user_login = user.login,\n\t\t\troom_id = msg.sourceRoomID ? msg.sourceRoomID : msg.roomID,\n\t\t\troom_login = msg.sourceRoomID ? null : msg.roomLogin,\n\n\t\t\troom = this.parent.getRoom(room_id, room_login, true),\n\t\t\tbadges = msg.ffz_badges; // this.getBadges(user_id, user_login, room_id, room_login);\n\n\t\tlet last_slot = 50, slot;\n\n\t\tfor(const badge_id in twitch_badges)\n\t\t\tif ( has(twitch_badges, badge_id) ) {\n\t\t\t\tconst version = twitch_badges[badge_id],\n\t\t\t\t\tis_hidden = hidden_badges[badge_id],\n\t\t\t\t\tbdata = tb && tb[badge_id],\n\t\t\t\t\tcat = bdata && bdata.__cat || 'm-twitch';\n\n\t\t\t\tif ( ! badge_id || is_hidden || (is_hidden == null && hidden_badges[cat]) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( has(BADGE_POSITIONS, badge_id) )\n\t\t\t\t\tslot = BADGE_POSITIONS[badge_id];\n\t\t\t\telse\n\t\t\t\t\tslot = last_slot++;\n\n\t\t\t\tconst data = dynamic_data[badge_id] || (badge_id === 'founder' && dynamic_data['subscriber']),\n\t\t\t\t\tmod_urls = badge_id === 'moderator' && custom_mod && room && room.data && room.data.mod_urls,\n\t\t\t\t\tvip_urls = badge_id === 'vip' && custom_vip && room && room.data && room.data.vip_badge,\n\t\t\t\t\tbadges = [];\n\n\t\t\t\tif ( mod_urls ) {\n\t\t\t\t\tconst bd = this.getTwitchBadge(badge_id, version, room_id, room_login);\n\t\t\t\t\tbadges.push({\n\t\t\t\t\t\tprovider: 'ffz',\n\t\t\t\t\t\timage: mod_urls[4] || mod_urls[2] || mod_urls[1],\n\t\t\t\t\t\tcolor: '#34ae0a',\n\t\t\t\t\t\ttitle: bd ? bd.title : 'Moderator',\n\t\t\t\t\t\troom: room_id,\n\t\t\t\t\t\tdata\n\t\t\t\t\t});\n\n\t\t\t\t} else if ( vip_urls ) {\n\t\t\t\t\tconst bd = this.getTwitchBadge(badge_id, version, room_id, room_login);\n\t\t\t\t\tbadges.push({\n\t\t\t\t\t\tprovider: 'ffz',\n\t\t\t\t\t\timage: vip_urls[4] || vip_urls[2] || vip_urls[1],\n\t\t\t\t\t\tcolor: 'transparent',\n\t\t\t\t\t\ttitle: bd ? bd.title : 'VIP',\n\t\t\t\t\t\troom: room_id,\n\t\t\t\t\t\tdata\n\t\t\t\t\t});\n\n\t\t\t\t} else\n\t\t\t\t\tbadges.push({\n\t\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\t\tbadge: badge_id,\n\t\t\t\t\t\tversion,\n\t\t\t\t\t\troom: room_id,\n\t\t\t\t\t\tdata\n\t\t\t\t\t});\n\n\t\t\t\tslotted.set(slot, {\n\t\t\t\t\tid: badge_id,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t'data-provider': 'twitch',\n\t\t\t\t\t\t'data-badge': badge_id,\n\t\t\t\t\t\t'data-version': version,\n\t\t\t\t\t\tstyle: {}\n\t\t\t\t\t},\n\t\t\t\t\tbadges\n\t\t\t\t});\n\t\t\t}\n\n\t\tif ( Array.isArray(badges) ) {\n\t\t\tconst handled_ids = new Set;\n\n\t\t\tfor(const badge of badges)\n\t\t\t\tif ( badge && badge.id != null ) {\n\t\t\t\t\tif ( handled_ids.has(badge.id) )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\thandled_ids.add(badge.id);\n\n\t\t\t\t\tconst full_badge = this.badges[badge.id] || {},\n\t\t\t\t\t\tcat = typeof full_badge.addon === 'string'\n\t\t\t\t\t\t\t? `m-addon-${full_badge.addon}`\n\t\t\t\t\t\t\t: full_badge.addon\n\t\t\t\t\t\t\t\t? 'm-addon'\n\t\t\t\t\t\t\t\t: 'm-ffz',\n\t\t\t\t\t\thide_key = badge.base_id ?? badge.id,\n\t\t\t\t\t\tis_hidden = hidden_badges[hide_key];\n\n\t\t\t\t\tif ( is_hidden || (is_hidden == null && hidden_badges[cat]) )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tconst slot = has(badge, 'slot') ? badge.slot : full_badge.slot,\n\t\t\t\t\t\told_badge = slotted.get(slot),\n\t\t\t\t\t\turls = badge.urls || (badge.image ? {1: badge.image} : null),\n\t\t\t\t\t\tcolor = badge.color || full_badge.color || 'transparent',\n\t\t\t\t\t\tno_invert = badge.no_invert,\n\t\t\t\t\t\tmasked = color !== 'transparent' && is_mask,\n\n\t\t\t\t\t\tbu = (urls || full_badge.urls || {1: full_badge.image}),\n\t\t\t\t\t\tbd = {\n\t\t\t\t\t\t\tprovider: 'ffz',\n\t\t\t\t\t\t\tid: badge.id,\n\t\t\t\t\t\t\tbadge,\n\t\t\t\t\t\t\troom: badge.room,\n\t\t\t\t\t\t\timage: bu[4] || bu[2] || bu[1],\n\t\t\t\t\t\t\tcolor: badge.color || full_badge.color,\n\t\t\t\t\t\t\ttitle: badge.title || full_badge.title,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t// Hacky nonsense.\n\t\t\t\t\tif ( ! full_badge.addon ) {\n\t\t\t\t\t\tbd.image = `//cdn.frankerfacez.com/badge/${badge.id}/4/rounded`;\n\t\t\t\t\t\tbd.color = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet style;\n\n\t\t\t\t\tif ( old_badge ) {\n\t\t\t\t\t\told_badge.badges.push(bd);\n\n\t\t\t\t\t\tconst replaces = has(badge, 'replaces') ? badge.replaces : full_badge.replaces,\n\t\t\t\t\t\t\treplaces_type = badge.replaces_type || full_badge.replaces_type;\n\t\t\t\t\t\tif ( replaces && (!replaces_type || replaces_type === old_badge.id) ) {\n\t\t\t\t\t\t\told_badge.replaced = badge.id;\n\t\t\t\t\t\t\told_badge.content = badge.content || full_badge.content || old_badge.content;\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tstyle = old_badge.props.style;\n\n\t\t\t\t\t} else if ( slot == null )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\telse {\n\t\t\t\t\t\tstyle = {};\n\t\t\t\t\t\tconst props = {\n\t\t\t\t\t\t\tclassName: 'ffz-tooltip ffz-badge',\n\t\t\t\t\t\t\t'data-tooltip-type': 'badge',\n\t\t\t\t\t\t\t'data-provider': 'ffz',\n\t\t\t\t\t\t\t'data-badge': badge.id,\n\t\t\t\t\t\t\tstyle\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tslotted.set(slot, {\n\t\t\t\t\t\t\tid: badge.id,\n\t\t\t\t\t\t\tprops,\n\t\t\t\t\t\t\tbadges: [bd],\n\t\t\t\t\t\t\tcontent: badge.content || full_badge.content\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (no_invert) {\n\t\t\t\t\t\tconst old = slotted.get(slot);\n\t\t\t\t\t\told.full_size = true;\n\t\t\t\t\t\told.no_invert = true;\n\n\t\t\t\t\t\tstyle.background = 'unset';\n\t\t\t\t\t\tstyle.backgroundSize = 'unset';\n\t\t\t\t\t\tstyle[CSS_MASK_IMAGE] = 'unset';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( (has_image || color === 'transparent') && urls ) {\n\t\t\t\t\t\tconst image = `url(\"${urls[1]}\")`;\n\t\t\t\t\t\tlet image_set;\n\t\t\t\t\t\tif ( urls[2] || urls[4] )\n\t\t\t\t\t\t\timage_set = `${WEBKIT}image-set(${image} 1x${urls[2] ? `, url(\"${urls[2]}\") 2x` : ''}${urls[4] ? `, url(\"${urls[4]}\") 4x` : ''})`;\n\n\t\t\t\t\t\tstyle[masked && !no_invert ? CSS_MASK_IMAGE : 'backgroundImage'] = image;\n\t\t\t\t\t\tif ( image_set )\n\t\t\t\t\t\t\tstyle[masked && !no_invert ? CSS_MASK_IMAGE : 'backgroundImage'] = image_set;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( is_colored && badge.color ) {\n\t\t\t\t\t\tif ( masked && !no_invert )\n\t\t\t\t\t\t\tstyle.backgroundImage = `linear-gradient(${badge.color},${badge.color})`;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tstyle.backgroundColor = badge.color;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\treturn msg.ffz_badge_cache = Array.from(slotted).sort((a,b) => a[0] - b[0]);\n\t}\n\n\n\trender(msg, createElement, skip_hide = false, skip_click = false) {\n\t\tif ( ! msg.badges && ! msg.ffz_badges )\n\t\t\treturn null;\n\n\t\tif ( ! msg.ffz_badge_cache )\n\t\t\tthis.cacheBadges(msg, skip_hide);\n\n\t\tif ( ! msg.ffz_badge_cache.length )\n\t\t\treturn null;\n\n\t\tconst out = [];\n\t\tfor(let i=0, l = msg.ffz_badge_cache.length; i < l; i++) {\n\t\t\tconst data = msg.ffz_badge_cache[i][1],\n\t\t\t\tprops = data.props;\n\n\t\t\tlet content = maybe_call(data.content, this, data, msg, createElement);\n\t\t\tif ( content && ! Array.isArray(content) )\n\t\t\t\tcontent = [content];\n\n\t\t\tprops.className = `ffz-tooltip ffz-badge${content ? ' tw-pd-x-05' : ''}${data.full_size ? ' ffz-full-size' : ''}${data.no_invert ? ' ffz-no-invert' : ''}`;\n\t\t\tprops.key = `${props['data-provider']}-${props['data-badge']}`;\n\t\t\tprops['data-tooltip-type'] = 'badge';\n\t\t\tprops['data-badge-idx'] = i;\n\t\t\t//props['data-badge-data'] = JSON.stringify(data.badges);\n\n\t\t\tif ( ! skip_click )\n\t\t\t\tprops.onClick = this.handleClick;\n\n\t\t\tif ( data.replaced )\n\t\t\t\tprops['data-replaced'] = data.replaced;\n\n\t\t\tout.push(createElement('span', props, content || undefined));\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\trebuildColor() {\n\t\tif ( this.parent.context.get('chat.badges.fix-colors') ) {\n\t\t\tthis.fg_fixer = new ColorAdjuster('#fff', 1, 4.5);\n\t\t\tthis.color_fixer = new ColorAdjuster(\n\t\t\t\tthis.parent.context.get('theme.is-dark') ? '#181818' : '#FFFFFF',\n\t\t\t\t1,\n\t\t\t\t2.5\n\t\t\t);\n\t\t} else {\n\t\t\tthis.fg_fixer = null;\n\t\t\tthis.color_fixer = null;\n\t\t}\n\t}\n\n\n\trebuildColoredBadges() {\n\t\tthis.rebuildColor();\n\n\t\tthis.buildBadgeCSS();\n\t\tthis.buildTwitchCSSBadgeCSS();\n\t}\n\n\n\trebuildAllCSS() {\n\t\tthis.rebuildColor();\n\n\t\tfor(const room of this.parent.iterateRooms()) {\n\t\t\troom.buildBadgeCSS();\n\t\t\troom.buildModBadgeCSS();\n\t\t}\n\n\t\tthis.buildBadgeCSS();\n\t\tthis.buildTwitchBadgeCSS();\n\t\tthis.buildTwitchCSSBadgeCSS();\n\t}\n\n\n\t// ========================================================================\n\t// Extension Badges\n\t// ========================================================================\n\n\tgetBadges(user_id, user_login, room_id, room_login) {\n\t\tconst room = this.parent.getRoom(room_id, room_login, true),\n\t\t\tglobal_user = this.parent.getUser(user_id, user_login, true);\n\n\t\tif ( global_user ) {\n\t\t\tuser_id = user_id ?? global_user.id;\n\t\t\tuser_login = user_login ?? global_user.login;\n\t\t}\n\n\t\tconst room_user = room && room.getUser(user_id, user_login, true);\n\n\t\tconst out = (global_user?.badges ? global_user.badges._cache : []).concat(\n\t\t\troom_user?.badges ? room_user.badges._cache.map(x => ({...x, room: room_id})) : []);\n\n\t\tif ( this.bulk.size ) {\n\t\t\tconst str_user = String(user_id);\n\t\t\tfor(const [badge_id, users] of this.bulk) {\n\t\t\t\tif ( users?._cache.has(str_user) )\n\t\t\t\t\tout.push({id: badge_id});\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tsetBulk(source, badge_id, entries) {\n\t\tlet set = this.bulk.get(badge_id);\n\t\tif ( ! set )\n\t\t\tthis.bulk.set(badge_id, set = new SourcedSet(true));\n\n\t\tset.set(source, entries);\n\t}\n\n\tdeleteBulk(source, badge_id) {\n\t\tconst set = this.bulk.get(badge_id);\n\t\tif ( set )\n\t\t\tset.delete(source);\n\t}\n\n\textendBulk(source, badge_id, entries) {\n\t\tlet set = this.bulk.get(badge_id);\n\t\tif ( ! set )\n\t\t\tthis.bulk.set(badge_id, set = new SourcedSet(true));\n\n\t\tif ( ! Array.isArray(entries) )\n\t\t\tentries = [entries];\n\n\t\tset.extend(source, ...entries);\n\t}\n\n\n\tasync loadGlobalBadges(tries = 0) {\n\t\tthis.load_tracker.schedule('chat-data', 'ffz-global-badges');\n\n\t\tlet response, data;\n\n\t\tif ( this.experiments.getAssignment('api_load') && tries < 1 )\n\t\t\ttry {\n\t\t\t\tfetch(`${NEW_API}/v1/badges/ids`).catch(() => {});\n\t\t\t} catch(err) { /* do nothing */ }\n\n\t\ttry {\n\t\t\tresponse = await fetch(`${this.staging.api}/v1/badges/ids`);\n\t\t} catch(err) {\n\t\t\ttries++;\n\t\t\tif ( tries < 10 )\n\t\t\t\treturn setTimeout(() => this.loadGlobalBadges(tries), 500 * tries);\n\n\t\t\tthis.log.error('Error loading global badge data.', err);\n\t\t\tthis.load_tracker.notify('chat-data', 'ffz-global-badges', false);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! response.ok ) {\n\t\t\tthis.load_tracker.notify('chat-data', 'ffz-global-badges', false);\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tdata = await response.json();\n\t\t} catch(err) {\n\t\t\tthis.log.error('Error parsing global badge data.', err);\n\t\t\tthis.load_tracker.notify('chat-data', 'ffz-global-badges', false);\n\t\t\treturn false;\n\t\t}\n\n\t\tlet badges = 0, users = 0;\n\n\t\tif ( data.badges )\n\t\t\tfor(const badge of data.badges)\n\t\t\t\tif ( badge && badge.id ) {\n\t\t\t\t\tthis.loadBadgeData(badge.id, badge, false);\n\t\t\t\t\tbadges++;\n\t\t\t\t}\n\n\t\tif ( data.users )\n\t\t\tfor(const badge_id in data.users)\n\t\t\t\tif ( has(data.users, badge_id) ) {\n\t\t\t\t\tconst badge = this.badges[badge_id],\n\t\t\t\t\t\tname = badge?.name;\n\t\t\t\t\tlet c = 0;\n\n\t\t\t\t\tif ( name === 'supporter' || name === 'subwoofer' || name === 'bot' ) {\n\t\t\t\t\t\tthis.setBulk('ffz-global', badge_id, data.users[badge_id].map(x => String(x)));\n\t\t\t\t\t\t/*this.supporter_id = badge_id;\n\t\t\t\t\t\tfor(const user_id of data.users[badge_id])\n\t\t\t\t\t\t\tthis.supporters.add(`${user_id}`);*/\n\n\t\t\t\t\t\tc = data.users[badge_id].length; // this.supporters.size;\n\t\t\t\t\t} else\n\t\t\t\t\t\tfor(const user_id of data.users[badge_id]) {\n\t\t\t\t\t\t\tconst user = this.parent.getUser(user_id, undefined);\n\t\t\t\t\t\t\tif ( user.addBadge('ffz-global', badge_id) ) {\n\t\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t\t\tusers++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\tif ( c > 0 )\n\t\t\t\t\t\tthis.log.info(`Added \"${badge ? badge.name : `#${badge_id}`}\" to ${c} users.`);\n\t\t\t\t}\n\n\t\tthis.log.info(`Loaded ${badges} badges and assigned them to ${users} users.`);\n\t\tthis.buildBadgeCSS();\n\t\tthis.load_tracker.notify('chat-data', 'ffz-global-badges');\n\t}\n\n\n\tgetBadge(badge_id) {\n\t\treturn this.badges[badge_id] ?? null;\n\t}\n\n\n\tremoveBadge(badge_id, generate_css = true) {\n\t\tif ( ! this.badges[badge_id] )\n\t\t\treturn;\n\n\t\tdelete this.badges[badge_id];\n\n\t\tif ( generate_css )\n\t\t\tthis.buildBadgeCSS();\n\t}\n\n\n\tloadBadgeData(badge_id, data, generate_css = true) {\n\t\tthis.badges[badge_id] = data;\n\n\t\tif ( data ) {\n\t\t\tif ( data.addon === undefined )\n\t\t\t\tdata.addon =/^addon/.test(badge_id);\n\n\t\t\tif ( data.replaces && ! data.replaces_type ) {\n\t\t\t\tdata.replaces_type = data.replaces;\n\t\t\t\tdata.replaces = true;\n\t\t\t}\n\n\t\t\tif ( ! data.addon && (data.name === 'developer' || data.name === 'subwoofer' || data.name === 'supporter') )\n\t\t\t\tdata.click_url = 'https://www.frankerfacez.com/subscribe';\n\n\t\t\tif ( ! data.addon && (data.name === 'subwoofer') ) {\n\t\t\t\tdata.base_id = data.id;\n\n\t\t\t\tdata.tooltipExtra = data => {\n\t\t\t\t\tif ( ! data?.user_id )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn this.getSubwooferMonths(data.user_id)\n\t\t\t\t\t\t.then(d => {\n\t\t\t\t\t\t\tif ( ! d?.months )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tif ( d.lifetime )\n\t\t\t\t\t\t\t\treturn '\\n' + this.i18n.t('badges.subwoofer.lifetime', 'Lifetime Subwoofer');\n\n\t\t\t\t\t\t\treturn '\\n' + this.i18n.t('badges.subwoofer.months', '({count, plural, one {# Month} other {# Months}})', {\n\t\t\t\t\t\t\t\tcount: d.months\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ( generate_css )\n\t\t\tthis.buildBadgeCSS();\n\t}\n\n\n\tgetSubwooferMonths(user_id) {\n\t\tlet info = this._woofer_months[user_id];\n\t\tif ( info instanceof Promise )\n\t\t\treturn info;\n\n\t\tconst expires = info?.expires;\n\t\tif ( expires && Date.now() >= expires )\n\t\t\tinfo = this._woofer_months[user_id] = null;\n\n\t\tif ( info?.value )\n\t\t\treturn Promise.resolve(info.value);\n\n\t\treturn this._woofer_months[user_id] = fetch(`https://api.frankerfacez.com/v1/_user/id/${user_id}`)\n\t\t\t.then(resp => resp.ok ? resp.json() : null)\n\t\t\t.then(data => {\n\t\t\t\tlet out = null;\n\t\t\t\tif ( data?.user?.sub_months )\n\t\t\t\t\tout = {\n\t\t\t\t\t\tmonths: data.user.sub_months,\n\t\t\t\t\t\tlifetime: data.user.sub_lifetime\n\t\t\t\t\t};\n\n\t\t\t\tthis._woofer_months[user_id] = {\n\t\t\t\t\texpires: Date.now() + (5 * 60 * 1000),\n\t\t\t\t\tvalue: out\n\t\t\t\t};\n\n\t\t\t\treturn out;\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.error('Error getting subwoofer data for user', user_id, err);\n\n\t\t\t\tthis._woofer_months[user_id] = {\n\t\t\t\t\texpires: Date.now() + (60 * 1000),\n\t\t\t\t\tvalue: null\n\t\t\t\t};\n\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\n\tbuildBadgeCSS() {\n\t\tconst style = this.parent.context.get('chat.badges.style'),\n\t\t\tis_dark = this.parent.context.get('theme.is-dark'),\n\t\t\tcan_click = this.parent.context.get('chat.badges.clickable'),\n\t\t\tuse_media = IS_FIREFOX && this.parent.context.get('chat.badges.media-queries');\n\n\t\tconst out = [];\n\t\tfor(const key in this.badges)\n\t\t\tif ( has(this.badges, key) ) {\n\t\t\t\tconst data = this.badges[key],\n\t\t\t\t\tselector = `.ffz-badge[data-badge=\"${key}\"]`;\n\n\t\t\t\tout.push(`.ffz-badge[data-replaced=\"${key}\"]{${generateOverrideCSS(data, style, is_dark)}}`);\n\n\t\t\t\tif ( use_media ) {\n\t\t\t\t\tout.push(`@media (max-resolution: 99dpi) {${selector}{${generateBadgeCSS(key, 0, data, style, is_dark, 0, this.color_fixer, this.fg_fixer, 1, can_click)}}}`);\n\t\t\t\t\tout.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${selector}{${generateBadgeCSS(key, 0, data, style, is_dark, 0, this.color_fixer, this.fg_fixer, 2, can_click)}}}`);\n\t\t\t\t\tout.push(`@media (min-resolution: 200dpi) {${selector}{${generateBadgeCSS(key, 0, data, style, is_dark, 0, this.color_fixer, this.fg_fixer, 4, can_click)}}}`);\n\t\t\t\t} else\n\t\t\t\t\tout.push(`${selector}{${generateBadgeCSS(key, 0, data, style, is_dark, 0, this.color_fixer, this.fg_fixer, undefined, can_click)}}`);\n\t\t\t}\n\n\t\tthis.style.set('ext-badges', out.join('\\n'));\n\t}\n\n\n\t// ========================================================================\n\t// Twitch Badges\n\t// ========================================================================\n\n\tgetTwitchBadge(badge, version, room_id, room_login, retried = false) {\n\t\tconst room = this.parent.getRoom(room_id, room_login, true);\n\t\tlet b;\n\n\t\tif ( room ) {\n\t\t\tconst versions = room.badges && room.badges[badge];\n\t\t\tb = versions && versions[version];\n\t\t}\n\n\t\tif ( ! b ) {\n\t\t\tconst versions = this.twitch_badges && this.twitch_badges[badge];\n\t\t\tb = versions && versions[version];\n\t\t}\n\n\t\tif ( ! b && ! retried ) {\n\t\t\tconst chat = this.resolve('site.chat');\n\t\t\tif ( chat && chat.tryUpdateBadges )\n\t\t\t\tchat.tryUpdateBadges();\n\t\t}\n\n\t\treturn b;\n\t}\n\n\tgetTwitchBadgeCount() {\n\t\treturn this.twitch_badge_count || 0;\n\t}\n\n\tupdateTwitchBadges(badges) {\n\t\tthis.twitch_badge_count = 0;\n\t\tif ( ! badges )\n\t\t\tthis.twitch_badges = {};\n\t\telse if ( ! Array.isArray(badges) )\n\t\t\tthis.twitch_badges = badges;\n\t\telse {\n\t\t\tlet b = null;\n\t\t\tif ( badges.length ) {\n\t\t\t\tb = {};\n\t\t\t\tfor(const data of badges) {\n\t\t\t\t\tconst sid = data.setID,\n\t\t\t\t\t\tbs = b[sid] = b[sid] || {\n\t\t\t\t\t\t\t__cat: getBadgeCategory(sid)\n\t\t\t\t\t\t};\n\n\t\t\t\t\tthis.twitch_badge_count++;\n\t\t\t\t\tbs[data.version] = fixBadgeData(data);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.twitch_badges = b;\n\t\t}\n\n\t\tthis.buildTwitchBadgeCSS();\n\t\tthis.buildTwitchCSSBadgeCSS();\n\t}\n\n\n\tbuildTwitchCSSBadgeCSS() {\n\t\tconst style = this.parent.context.get('chat.badges.style'),\n\t\t\tis_dark = this.parent.context.get('theme.is-dark'),\n\t\t\tcan_click = this.parent.context.get('chat.badges.clickable'),\n\t\t\tuse_media = IS_FIREFOX && this.parent.context.get('chat.badges.media-queries'),\n\n\t\t\tbadge_version = this.parent.context.get('chat.badges.version'),\n\t\t\tversioned = CSS_BADGES[badge_version] || {},\n\t\t\ttwitch_data = this.twitch_badges || {};\n\n\t\tconst out = [];\n\t\tfor(const key in versioned)\n\t\t\tif ( has(versioned, key) ) {\n\t\t\t\tconst data = versioned[key],\n\t\t\t\t\ttwitch = twitch_data[key];\n\t\t\t\tfor(const version in data)\n\t\t\t\t\tif ( has(data, version) ) {\n\t\t\t\t\t\tconst d = data[version],\n\t\t\t\t\t\t\ttd = twitch?.[version],\n\t\t\t\t\t\t\tselector = `.ffz-badge[data-badge=\"${key}\"][data-version=\"${version}\"]`;\n\n\t\t\t\t\t\tif ( td && td.click_url )\n\t\t\t\t\t\t\td.click_url = td.click_url;\n\t\t\t\t\t\tif ( td && td.click_action )\n\t\t\t\t\t\t\td.click_action = td.click_action;\n\n\t\t\t\t\t\tif ( use_media ) {\n\t\t\t\t\t\t\tout.push(`@media (max-resolution: 99dpi) {${selector}{${generateBadgeCSS(key, version, d, style, is_dark, badge_version, this.color_fixer, this.fg_fixer, 1, can_click)}}}`);\n\t\t\t\t\t\t\tout.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${selector}{${generateBadgeCSS(key, version, d, style, is_dark, badge_version, this.color_fixer, this.fg_fixer, 2, can_click)}}}`);\n\t\t\t\t\t\t\tout.push(`@media (min-resolution: 200dpi) {${selector}{${generateBadgeCSS(key, version, d, style, is_dark, badge_version, this.color_fixer, this.fg_fixer, 4, can_click)}}}`);\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tout.push(`${selector}{${generateBadgeCSS(key, version, d, style, is_dark, badge_version, this.color_fixer, this.fg_fixer, undefined, can_click)}}`);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\tthis.style.set('css-badges', out.join('\\n'));\n\t}\n\n\n\tbuildTwitchBadgeCSS() {\n\t\tif ( ! this.twitch_badges )\n\t\t\tthis.style.delete('twitch-badges');\n\n\t\tconst badge_version = this.parent.context.get('chat.badges.version'),\n\t\t\tuse_media = IS_FIREFOX && this.parent.context.get('chat.badges.media-queries'),\n\t\t\tcan_click = this.parent.context.get('chat.badges.clickable'),\n\t\t\tversioned = CSS_BADGES[badge_version] || {};\n\n\t\tconst out = [];\n\t\tfor(const key in this.twitch_badges)\n\t\t\tif ( has(this.twitch_badges, key) ) {\n\t\t\t\tif ( has(versioned, key) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst versions = this.twitch_badges[key];\n\t\t\t\tfor(const version in versions)\n\t\t\t\t\tif ( has(versions, version) ) {\n\t\t\t\t\t\tconst data = versions[version],\n\t\t\t\t\t\t\tselector = `.ffz-badge[data-badge=\"${key}\"][data-version=\"${version}\"]`;\n\n\t\t\t\t\t\tout.push(`${selector} {\n\t\t\t${can_click && (data.click_action || data.click_url) ? 'cursor:pointer;' : ''}\n\t\t\tbackground-color: transparent;\n\t\t\tfilter: none;\n\t\t\t${WEBKIT}mask-image: none;\n\t\t\tbackground-size: 1.8rem;\n\t\t\tbackground-image: url(\"${data.image1x}\");\n\t\t\tbackground-image: ${WEBKIT}image-set(\n\t\t\t\turl(\"${data.image1x}\") 1x,\n\t\t\t\turl(\"${data.image2x}\") 2x,\n\t\t\t\turl(\"${data.image4x}\") 4x\n\t\t\t);\n\t\t}`);\n\n\t\t\t\t\t\tif ( use_media ) {\n\t\t\t\t\t\t\tout.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${selector} {\n\t\t\t\t\t\t\t\tbackground-image: url(\"${data.image2x}\");\n\t\t\t\t\t\t\t}}`);\n\t\t\t\t\t\t\tout.push(`@media (min-resolution: 200dpi) { ${selector} {\n\t\t\t\t\t\t\t\tbackground-image: url(\"${data.image4x}\");\n\t\t\t\t\t\t\t}}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\n\t\tif ( out.length )\n\t\t\tthis.style.set('twitch-badges', out.join('\\n'));\n\t\telse\n\t\t\tthis.style.delete('twitch-badges');\n\t}\n}\n\n\nconst OTHER_BADGES = [\n\t'vga-champ-2017',\n\t'warcraft',\n\t'samusoffer_beta',\n\t'power-rangers',\n\t'bits-charity',\n\t'glhf-pledge'\n];\n\n\nexport function getBadgeCategory(key) {\n\tif ( OTHER_BADGES.includes(key) )\n\t\treturn 'm-other';\n\telse if ( key.startsWith('overwatch-league') )\n\t\treturn 'm-owl';\n\telse if ( key.startsWith('twitchcon') || key.startsWith('glitchcon') )\n\t\treturn 'm-tcon';\n\telse if ( /_\\d+$/.test(key) )\n\t\treturn 'm-game';\n\n\treturn 'm-twitch';\n}\n\nexport function fixBadgeData(badge) {\n\tif ( ! badge )\n\t\treturn badge;\n\n\t// Duplicate the badge object, because\n\t// Apollo results are frozen.\n\tbadge = {...badge};\n\n\t// Click Behavior\n\tif ( ! badge.clickAction && badge.onClickAction )\n\t\tbadge.clickAction = badge.onClickAction;\n\n\tif ( badge.clickAction === 'VISIT_URL' && badge.clickURL )\n\t\tbadge.click_url = badge.clickURL;\n\n\tif ( badge.clickAction === 'TURBO' )\n\t\tbadge.click_url = 'https://www.twitch.tv/products/turbo?ref=chat_badge';\n\n\tif ( badge.clickAction === 'SUBSCRIBE' && badge.channelName )\n\t\tbadge.click_url = `https://www.twitch.tv/subs/${badge.channelName}`;\n\telse if ( badge.clickAction )\n\t\tbadge.click_action = 'sub';\n\n\t// Subscriber Tier\n\tif ( badge.setID === 'subscriber' ) {\n\t\tconst id = parseInt(badge.version, 10);\n\t\tif ( ! isNaN(id) && isFinite(id) ) {\n\t\t\tbadge.tier = (id - (id % 1000)) / 1000;\n\t\t\tif ( badge.tier < 0 )\n\t\t\t\tbadge.tier = 0;\n\t\t} else\n\t\t\tbadge.tier = 0;\n\t}\n\n\treturn badge;\n}\n","'use strict';\n\n// ============================================================================\n// Emoji Handling\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {SERVER} from 'utilities/constants';\nimport {has} from 'utilities/object';\nimport { getBuster } from 'utilities/time';\n\nimport splitter from 'emoji-regex/es2015/index';\n\n\n/*export const SIZES = {\n\tapple: [64, 160],\n\temojione: [64],\n\tfacebook: [64, 96],\n\tgoogle: [64, 136],\n\tmessenger: [64, 128],\n\ttwitter: [64, 72]\n}*/\n\nexport const HIDDEN_CATEGORIES = [\n\t'component'\n];\n\nexport const CATEGORIES = {\n\t'smileys-emotion': 'Smileys & Emotions',\n\t'people-body': 'People',\n\t'component': 'Components',\n\t'animals-nature': 'Animals & Nature',\n\t'food-drink': 'Food & Drink',\n\t'travel-places': 'Travel & Places',\n\t'activities': 'Activities',\n\t'objects': 'Objects',\n\t'symbols': 'Symbols',\n\t'flags': 'Flags'\n};\n\nexport const CATEGORY_SORT = Object.keys(CATEGORIES);\n\nexport const SKIN_TONES = {\n\t1: '1f3fb',\n\t2: '1f3fc',\n\t3: '1f3fd',\n\t4: '1f3fe',\n\t5: '1f3ff'\n};\n\nlet enable_replace_joiner = true;\n\nlet joiner;\ntry {\n\tjoiner = new RegExp('(?<!\\\\u{E0002})\\\\u{E0002}', 'gu');\n} catch(err) {\n\tenable_replace_joiner = false;\n\tjoiner = null;\n}\n\nexport const JOINER_REPLACEMENT = joiner; // /(?<!\\u{E0002})\\u{E0002}/gu;\nexport const ZWD_REPLACEMENT = /\\u{200D}/gu;\nexport const EMOJI_JOINER = '\\u{E0002}';\n\nexport const IMAGE_PATHS = {\n\tgoogle: 'noto',\n\ttwitter: 'twemoji',\n\topen: 'openmoji',\n\tblob: 'blob'\n};\n\n\nexport function codepoint_to_emoji(cp) {\n\tlet code = typeof cp === 'number' ? cp : parseInt(cp, 16);\n\tif ( code < 0x10000 )\n\t\treturn String.fromCharCode(code);\n\n\tcode -= 0x10000;\n\treturn String.fromCharCode(\n\t\t0xD800 + (code >> 10),\n\t\t0xDC00 + (code & 0x3FF)\n\t);\n}\n\n\nexport default class Emoji extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('..emotes');\n\t\tthis.inject('settings');\n\n\t\tif (enable_replace_joiner)\n\t\t\tthis.settings.add('chat.emoji.replace-joiner', {\n\t\t\t\tdefault: 1,\n\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\tif ( val === 2 )\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\treturn val;\n\t\t\t\t},\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Chat > Behavior >> Emoji',\n\t\t\t\t\ttitle: 'Emoji Joiner Workaround',\n\t\t\t\t\tdescription: 'This feature is intended to allow the use of combined emoji in supported clients. This is required due to a bug in TMI that strips ZWJ characters from chat messages. [Visit the original issue](https://github.com/FrankerFaceZ/FrankerFaceZ/issues/1147) for more details.',\n\t\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\t\tdata: [\n\t\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t\t{value: 1, title: 'Display Only'},\n\t\t\t\t\t\t{value: 3, title: 'Display and Send'}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\t\telse {\n\t\t\tthis.log.warn('This browser does not support regexp lookbehind. The \"Emoji Joiner Workaround\" feature will be disabled.');\n\n\t\t\tthis.settings.add('chat.emoji.replace-joiner', {\n\t\t\t\tprocess() { return 0 }\n\t\t\t});\n\t\t}\n\n\t\tthis.settings.add('chat.emoji.style', {\n\t\t\tdefault: 'twitter',\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val != 0 && ! IMAGE_PATHS[val] )\n\t\t\t\t\treturn 'twitter';\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emoji',\n\t\t\t\ttitle: 'Emoji Style',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 'twitter', title: 'Twitter (Twemoji)'},\n\t\t\t\t\t{value: 'google', title: 'Google (Noto)'},\n\t\t\t\t\t{value: 'blob', title: 'Blob'},\n\t\t\t\t\t{value: 'open', title: 'OpenMoji'},\n\t\t\t\t\t{value: 0, title: 'Native'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\t// For some reason, splitter is a function.\n\t\tthis.splitter = splitter();\n\n\t\tthis.categories = CATEGORIES;\n\n\t\tthis.emoji = {};\n\t\tthis.names = {};\n\t\tthis.chars = new Map;\n\t}\n\n\tonEnable() {\n\t\tthis.on('chat:pre-send-message', event => {\n\t\t\tif (event.context.get('chat.emoji.replace-joiner') < 2)\n\t\t\t\treturn;\n\n\t\t\tevent.message = event.message.replace(ZWD_REPLACEMENT, EMOJI_JOINER);\n\t\t});\n\n\t\tthis.loadEmojiData();\n\t}\n\n\tasync loadEmojiData(tries = 0) {\n\t\tlet data;\n\t\ttry {\n\t\t\tdata = await fetch(`${SERVER}/script/emoji/v3.2.json?_${getBuster(60)}`).then(r =>\n\t\t\t\tr.ok ? r.json() : null\n\t\t\t);\n\n\t\t} catch(err) {\n\t\t\ttries++;\n\t\t\tif ( tries < 10 )\n\t\t\t\treturn setTimeout(() => this.loadEmojiData(tries), 500 * tries);\n\n\t\t\tthis.log.error('Error loading emoji data.', err);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! data )\n\t\t\treturn false;\n\n\t\tconst cats = data.c,\n\t\t\tout = {},\n\t\t\tnames = {},\n\t\t\tchars = new Map;\n\n\t\tfor(const raw of data.e) {\n\t\t\tconst emoji = Object.assign(hydrate_emoji(raw.slice(4)), {\n\t\t\t\tcategory: cats[raw[0]],\n\t\t\t\tsort: raw[1],\n\t\t\t\tnames: raw[2],\n\t\t\t\tname: raw[3]\n\t\t\t});\n\n\t\t\tif ( ! Array.isArray(emoji.names) )\n\t\t\t\temoji.names = [emoji.names];\n\n\t\t\tif ( ! emoji.name )\n\t\t\t\temoji.name = emoji.names[0].replace(/_/g, ' ');\n\n\t\t\tout[emoji.code] = emoji;\n\t\t\tchars.set(emoji.raw, [emoji.code, null]);\n\t\t\tfor(const name of emoji.names)\n\t\t\t\tnames[name] = emoji.code;\n\n\t\t\t// Variations\n\t\t\tif ( raw[7] ) {\n\t\t\t\tconst vars = emoji.variants = {};\n\t\t\t\tfor(const r of raw[7]) {\n\t\t\t\t\tif ( Array.isArray(r[3]) || ! r[3] ) {\n\t\t\t\t\t\t// The tone picker doesn't support multiple tones\n\t\t\t\t\t\t// for a single emoji. Just make this variation a\n\t\t\t\t\t\t// new emoji.\n\t\t\t\t\t\tconst em = Object.assign(hydrate_emoji(r), {\n\t\t\t\t\t\t\tcategory: cats[raw[0]],\n\t\t\t\t\t\t\tsort: raw[1],\n\t\t\t\t\t\t\tnames: r[5],\n\t\t\t\t\t\t\thidden: true\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif ( ! Array.isArray(em.names) )\n\t\t\t\t\t\t\tem.names = [em.names];\n\n\t\t\t\t\t\tem.name = em.names[0].replace(/_/g, ' ');\n\n\t\t\t\t\t\tout[em.code] = em;\n\t\t\t\t\t\tchars.set(em.raw, [em.code, null]);\n\t\t\t\t\t\tfor(const name of em.names)\n\t\t\t\t\t\t\tnames[name] = em.code;\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// We just have a normal tone. We need to look\n\t\t\t\t\t// up the modifier and use it.\n\t\t\t\t\tconst tone = SKIN_TONES[r[3]];\n\t\t\t\t\tif ( ! tone ) {\n\t\t\t\t\t\tconsole.warn('Unknown tone:', r[3], r, emoji);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst vari = Object.assign(hydrate_emoji(r), {\n\t\t\t\t\t\tkey: tone\n\t\t\t\t\t});\n\n\t\t\t\t\tvars[tone] = vari;\n\t\t\t\t\tchars.set(vari.raw, [emoji.code, vari.key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.emoji = out;\n\t\tthis.names = names;\n\t\tthis.chars = chars;\n\n\t\tthis.log.info(`Loaded data about ${Object.keys(out).length} emoji.`);\n\t\tthis.emit(':populated');\n\t\treturn true;\n\t}\n\n\tgetFullImage(image, style) {\n\t\tif ( ! style )\n\t\t\tstyle = this.parent.context.get('chat.emoji.style');\n\n\t\tif ( ! has(IMAGE_PATHS, style) )\n\t\t\tstyle = 'twitter';\n\n\t\treturn `${SERVER}/static/emoji/images/${IMAGE_PATHS[style]}/${image}`;\n\n\t\t/*if ( ! has(SIZES, style) )\n\t\t\tstyle = 'twitter';\n\n\t\treturn `${SERVER}/static/emoji/img-${style}-${SIZES[style][0]}/${image}`;*/\n\t}\n\n\tgetFullImageSet(image, style) {\n\t\tif ( ! style )\n\t\t\tstyle = this.parent.context.get('chat.emoji.style');\n\n\t\tif ( ! has(IMAGE_PATHS, style) )\n\t\t\tstyle = 'twitter';\n\n\t\treturn `${SERVER}/static/emoji/images/${IMAGE_PATHS[style]}/${image} 72w`;\n\n\t\t/*if ( ! has(SIZES, style) )\n\t\t\tstyle = 'twitter';\n\n\t\treturn SIZES[style].map(w =>\n\t\t\t`${SERVER}/static/emoji/img-${style}-${w}/${image} ${w}w`\n\t\t).join(', ');*/\n\t}\n}\n\n\nfunction hydrate_emoji(data) {\n\tlet code = data[0];\n\tif ( data[4] === 0 )\n\t\tcode = `${code}-fe0f`;\n\n\treturn {\n\t\tcode,\n\t\timage: `${data[0]}.png`,\n\t\traw: code.split('-').map(codepoint_to_emoji).join(''),\n\t\tsheet_x: data[1][0],\n\t\tsheet_y: data[1][1],\n\n\t\thas: {\n\t\t\tgoogle: !!(0b1000 & data[2]),\n\t\t\tblob: !!(0b0100 & data[2]) || !!(0b1000 & data[2]), // Blob falls back to Noto\n\t\t\ttwitter: !!(0b0010 & data[2]),\n\t\t\topen: !!(0b0001 & data[2])\n\t\t}\n\t};\n}","'use strict';\n\n// ============================================================================\n// Emote Handling and Default Provider\n// ============================================================================\n\nimport Module, { buildAddonProxy } from 'utilities/module';\nimport {ManagedStyle} from 'utilities/dom';\n\nimport {get, has, timeout, SourcedSet, make_enum_flags, makeAddonIdChecker, deep_copy} from 'utilities/object';\nimport {NEW_API, IS_OSX, EmoteTypes, TWITCH_GLOBAL_SETS, TWITCH_POINTS_SETS, TWITCH_PRIME_SETS, DEBUG} from 'utilities/constants';\n\nimport GET_EMOTE from './emote_info.gql';\nimport GET_EMOTE_SET from './emote_set_info.gql';\n\nconst HoverRAF = Symbol('FFZ:Hover:RAF');\nconst HoverState = Symbol('FFZ:Hover:State');\n\nconst MOD_KEY = IS_OSX ? 'metaKey' : 'ctrlKey';\n\nconst Flags = make_enum_flags(\n\t'Hidden',\n\t'FlipX',\n\t'FlipY',\n\t'GrowX',\n\t'Slide',\n\t'Appear',\n\t'Leave',\n\t'Rotate',\n\t'Rotate90',\n\t'Greyscale',\n\t'Sepia',\n\t'Rainbow',\n\t'HyperRed',\n\t'Shake',\n\t'Cursed',\n\t'Jam',\n\t'Bounce',\n\t'NoSpace'\n);\n\nexport const MODIFIER_FLAGS = Flags;\n\nexport const MODIFIER_KEYS = Object.values(MODIFIER_FLAGS).filter(x => typeof x === 'number');\n\nconst APPEAR_FRAMES = [\n\t[0, -18, 0, 0],\n\t[19.99, -18, 0, 0],\n\t[20, -18, 0.1, 0],\n\t[25, -16, 0.2, 0.6],\n\t[30, -14, 0.3, -4],\n\t[35, -12, 0.4, 0.6],\n\t[40, -10, 0.5, -4],\n\t[45, -8, 0.6, 2],\n\t[50, -6, 0.7, -3],\n\t[55, -4, 0.8, 2],\n\t[60, -2, 0.9, -3],\n\t[65, 0, 1, 0],\n\t[100, 0, 1, 0]\n];\n\nconst LEAVE_FRAMES = [\n\t[0, 0, 1, 0],\n\t[39.99, 0, 1, 0],\n\t[40, 0, -.9, .9, -3],\n\t[45, -2, -.8, .8, 2],\n\t[50, -4, -.7, .7, -3],\n\t[55, -6, -.6, .6, 2],\n\t[60, -8, -.5, .5, -4],\n\t[65, -10, -.4, .4, .6],\n\t[70, -12, -.3, .3, -4],\n\t[75, -14, -.2, .2, .6],\n\t[80, -16, -.1, .1, 0],\n\t[85, -18, -0.01, 0, 0],\n\t[100, -18, 0, 0, 0]\n];\n\n\nfunction appearLeaveToKeyframes(source, multi = 1, offset = 0, has_var = false) {\n\tconst out = [];\n\n\tfor(const line of source) {\n\t\tconst pct = (line[0] * multi) + offset;\n\n\t\tlet vr, tx, scale, ty;\n\t\tvr = has_var ? `var(--ffz-effect-transforms) ` : '';\n\t\ttx = line[1] === 0 ? '' : `translateX(${line[1]}px) `;\n\n\t\tif ( line.length === 4 ) {\n\t\t\tscale = `scale(${line[2]})`;\n\t\t\tty = line[3] === 0 ? '' : ` translateY(${line[3]}px)`;\n\n\t\t} else {\n\t\t\tconst sx = line[2],\n\t\t\t\tsy = line[3];\n\n\t\t\tscale = `scale(${sx}, ${sy})`;\n\n\t\t\tty = line[4] === 0 ? '' : ` translateY(${line[4]}px)`;\n\t\t}\n\n\t\tout.push(`\\t${pct}% { transform:${vr}${tx}${scale}${ty}; }`);\n\t}\n\n\treturn out.join('\\n');\n}\n\n\n\nconst EFFECT_STYLES = [\n\t{\n\t\tsetting: 'FlipX',\n\t\tflags: Flags.FlipX,\n\t\ttitle: 'Flip Horizontal',\n\t\ttransform: 'scaleX(-1)'\n\t},\n\t{\n\t\tsetting: 'FlipY',\n\t\tflags: Flags.FlipY,\n\t\ttitle: 'Flip Vertical',\n\t\ttransform: 'scaleY(-1)'\n\t},\n\t{\n\t\tsetting: 'ShrinkX',\n\t\tflags: Flags.ShrinkX,\n\t\ttitle: 'Squish Horizontal'\n\t},\n\t{\n\t\tsetting: 'GrowX',\n\t\tflags: Flags.GrowX,\n\t\ttitle: 'Stretch Horizontal'\n\t},\n\t{\n\t\tsetting: 'Slide',\n\t\tflags: Flags.Slide,\n\t\t//not_flags: Flags.Rotate,\n\t\ttitle: 'Slide Animation',\n\t\tas_background: true,\n\t\tanimation: 'ffz-effect-slide var(--ffz-speed-x) linear infinite',\n\t\traw: `@keyframes ffz-effect-slide {\n0% { background-position-x: 0; }\n100% { background-position-x: calc(-1 * var(--ffz-width)); }\n}`\n\t},\n\t{\n\t\tsetting: 'Appear',\n\t\tflags: Flags.Appear,\n\t\tnot_flags: Flags.Leave,\n\t\ttitle: 'Appear Animation',\n\t\tanimation: 'ffz-effect-appear 3s infinite linear',\n\t\tanimationTransform: 'ffz-effect-appear-transform 3s linear infinite',\n\t\traw: `@keyframes ffz-effect-appear {\n${appearLeaveToKeyframes(APPEAR_FRAMES)}\n}\n@keyframes ffz-effect-appear-transform {\n${appearLeaveToKeyframes(APPEAR_FRAMES, 1, 0, true)}\n}`\n\t},\n\t{\n\t\tsetting: 'Leave',\n\t\tflags: Flags.Leave,\n\t\tnot_flags: Flags.Appear,\n\t\ttitle: 'Leave Animation',\n\t\tanimation: 'ffz-effect-leave 3s infinite linear',\n\t\tanimationTransform: 'ffz-effect-leave-transform 3s infinite linear',\n\t\traw: `@keyframes ffz-effect-leave {\n${appearLeaveToKeyframes(LEAVE_FRAMES)}\n}\n@keyframes ffz-effect-leave-transform {\n${appearLeaveToKeyframes(LEAVE_FRAMES, 1, 0, true)}\n}`\n\t},\n\t{\n\t\tsetting: [\n\t\t\t'Appear',\n\t\t\t'Leave'\n\t\t],\n\t\tflags: Flags.Appear | Flags.Leave,\n\t\tanimation: 'ffz-effect-in-out 6s infinite linear',\n\t\tanimationTransform: 'ffz-effect-in-out-transform 6s linear infinite',\n\t\traw: `@keyframes ffz-effect-in-out {\n${appearLeaveToKeyframes(APPEAR_FRAMES, 0.5, 0)}\n${appearLeaveToKeyframes(LEAVE_FRAMES, 0.5, 50)}\n}\n@keyframes ffz-effect-in-out-transform {\n${appearLeaveToKeyframes(APPEAR_FRAMES, 0.5, 0, true)}\n${appearLeaveToKeyframes(LEAVE_FRAMES, 0.5, 50, true)}\n}`\n\t},\n\t{\n\t\tsetting: 'Rotate',\n\t\tflags: Flags.Rotate,\n\t\tnot_flags: Flags.Slide,\n\t\ttitle: 'Rotate Animation',\n\t\tno_wide: true,\n\t\tanimation: 'ffz-effect-rotate 1.5s infinite linear',\n\t\tanimationTransform: 'ffz-effect-rotate-transform 1.5s infinite linear',\n\t\traw: `@keyframes ffz-effect-rotate {\n0% { transform: rotate(0deg); }\n100% { transform: rotate(360deg); }\n}\n@keyframes ffz-effect-rotate-transform {\n0% { transform: var(--ffz-effect-transforms) rotate(0deg); }\n100% { transform: var(--ffz-effect-transforms) rotate(360deg); }\n}`\n\t},\n\t/*{\n\t\tsetting: [\n\t\t\t'Slide',\n\t\t\t'Rotate'\n\t\t],\n\t\tflags: Flags.Rotate | Flags.Slide,\n\t\t// Sync up the speed for slide and rotate if both are applied.\n\t\tanimation: 'ffz-effect-slide calc(1.5 * var(--ffz-speed-x)) linear infinite'\n\t},\n\t{\n\t\tsetting: 'Greyscale',\n\t\tflags: Flags.Greyscale,\n\t\tfilter: 'grayscale(1)'\n\t},\n\t{\n\t\tsetting: 'Sepia',\n\t\tflags: Flags.Sepia,\n\t\tfilter: 'sepia(1)'\n\t},*/\n\t{\n\t\tsetting: 'Rainbow',\n\t\tflags: Flags.Rainbow,\n\t\ttitle: 'Rainbow Animation',\n\t\tanimation: 'ffz-effect-rainbow 2s linear infinite',\n\t\tanimationFilter: 'ffz-effect-rainbow-filter 2s linear infinite',\n\t\traw: `@keyframes ffz-effect-rainbow {\n\t0% { filter: hue-rotate(0deg) }\n\t100% { filter: hue-rotate(360deg) }\n}\n@keyframes ffz-effect-rainbow-filter {\n\t0% { filter: var(--ffz-effect-filters) hue-rotate(0deg) }\n\t100% { filter: var(--ffz-effect-filters) hue-rotate(360deg) }\n}`\n\t},\n\t{\n\t\tsetting: 'HyperRed',\n\t\tflags: Flags.HyperRed,\n\t\ttitle: 'Hyper Red',\n\t\tfilter: 'brightness(0.2) sepia(1) brightness(2.2) contrast(3) saturate(8)'\n\t},\n\t{\n\t\tsetting: 'Shake',\n\t\tflags: Flags.Shake,\n\t\ttitle: 'Hyper Shake Animation',\n\t\tanimation: 'ffz-effect-shake 0.1s linear infinite',\n\t\tanimationTransform: 'ffz-effect-shake-transform 0.1s linear infinite',\n\t\traw: `@keyframes ffz-effect-shake-transform {\n\t0% { transform: var(--ffz-effect-transforms) translate(1px, 1px); }\n\t10% { transform: var(--ffz-effect-transforms) translate(-1px, -2px); }\n\t20% { transform: var(--ffz-effect-transforms) translate(-3px, 0px); }\n\t30% { transform: var(--ffz-effect-transforms) translate(3px, 2px); }\n\t40% { transform: var(--ffz-effect-transforms) translate(1px, -1px); }\n\t50% { transform: var(--ffz-effect-transforms) translate(-1px, 2px); }\n\t60% { transform: var(--ffz-effect-transforms) translate(-3px, 1px); }\n\t70% { transform: var(--ffz-effect-transforms) translate(3px, 1px); }\n\t80% { transform: var(--ffz-effect-transforms) translate(-1px, -1px); }\n\t90% { transform: var(--ffz-effect-transforms) translate(1px, 2px); }\n\t100% { transform: var(--ffz-effect-transforms) translate(1px, -2px); }\n}\n@keyframes ffz-effect-shake {\n\t0% { transform: translate(1px, 1px); }\n\t10% { transform: translate(-1px, -2px); }\n\t20% { transform: translate(-3px, 0px); }\n\t30% { transform: translate(3px, 2px); }\n\t40% { transform: translate(1px, -1px); }\n\t50% { transform: translate(-1px, 2px); }\n\t60% { transform: translate(-3px, 1px); }\n\t70% { transform: translate(3px, 1px); }\n\t80% { transform: translate(-1px, -1px); }\n\t90% { transform: translate(1px, 2px); }\n\t100% { transform: translate(1px, -2px); }\n}`\n\t},\n\t{\n\t\tsetting: 'Photocopy',\n\t\tflags: Flags.Cursed,\n\t\ttitle: 'Cursed',\n\t\tfilter: 'grayscale(1) brightness(0.7) contrast(2.5)'\n\t},\n\t{\n\t\tsetting: 'Jam',\n\t\tflags: Flags.Jam,\n\t\ttitle: 'Jam Animation',\n\t\tanimation: 'ffz-effect-jam 0.6s linear infinite',\n\t\tanimationTransform: 'ffz-effect-jam-transform 0.6s linear infinite',\n\t\traw: `@keyframes ffz-effect-jam {\n\t0% { transform: translate(-2px, -2px) rotate(-6deg); }\n\t10% { transform: translate(-1.5px, -2px) rotate(-8deg); }\n\t20% { transform: translate(1px, -1.5px) rotate(-8deg); }\n\t30% { transform: translate(3px, 2.5px) rotate(-6deg); }\n\t40% { transform: translate(3px, 4px) rotate(-2deg); }\n\t50% { transform: translate(2px, 4px) rotate(3deg); }\n\t60% { transform: translate(1px, 4px) rotate(3deg); }\n\t70% { transform: translate(-0.5px, 3px) rotate(2deg); }\n\t80% { transform: translate(-1.25px, 1px) rotate(0deg); }\n\t90% { transform: translate(-1.75px, -0.5px) rotate(-2deg); }\n\t100% { transform: translate(-2px, -2px) rotate(-5deg); }\n}\n@keyframes ffz-effect-jam-transform {\n\t0% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-6deg); }\n\t10% { transform: var(--ffz-effect-transforms) translate(-1.5px, -2px) rotate(-8deg); }\n\t20% { transform: var(--ffz-effect-transforms) translate(1px, -1.5px) rotate(-8deg); }\n\t30% { transform: var(--ffz-effect-transforms) translate(3px, 2.5px) rotate(-6deg); }\n\t40% { transform: var(--ffz-effect-transforms) translate(3px, 4px) rotate(-2deg); }\n\t50% { transform: var(--ffz-effect-transforms) translate(2px, 4px) rotate(3deg); }\n\t60% { transform: var(--ffz-effect-transforms) translate(1px, 4px) rotate(3deg); }\n\t70% { transform: var(--ffz-effect-transforms) translate(-0.5px, 3px) rotate(2deg); }\n\t80% { transform: var(--ffz-effect-transforms) translate(-1.25px, 1px) rotate(0deg); }\n\t90% { transform: var(--ffz-effect-transforms) translate(-1.75px, -0.5px) rotate(-2deg); }\n\t100% { transform: var(--ffz-effect-transforms) translate(-2px, -2px) rotate(-5deg); }\n}`\n\t},\n\t{\n\t\tsetting: 'Bounce',\n\t\tflags: Flags.Bounce,\n\t\tanimation: 'ffz-effect-bounce 0.5s linear infinite',\n\t\tanimationTransform: 'ffz-effect-bounce-transform 0.5s linear infinite',\n\t\ttransformOrigin: 'bottom center',\n\t\traw: `@keyframes ffz-effect-bounce {\n\t0% { transform: scale(0.8, 1); }\n\t10% { transform: scale(0.9, 0.8); }\n\t20% { transform: scale(1, 0.4); }\n\t25% { transform: scale(1.2, 0.3); }\n\t25.001% { transform: scale(-1.2, 0.3); }\n\t30% { transform: scale(-1, 0.4); }\n\t40% { transform: scale(-0.9, 0.8); }\n\t50% { transform: scale(-0.8, 1); }\n\t60% { transform: scale(-0.9, 0.8); }\n\t70% { transform: scale(-1, 0.4); }\n\t75% { transform: scale(-1.2, 0.3); }\n\t75.001% { transform: scale(1.2, 0.3); }\n\t80% { transform: scale(1, 0.4); }\n\t90% { transform: scale(0.9, 0.8); }\n\t100% { transform: scale(0.8, 1); }\n}\n@keyframes ffz-effect-bounce-transform {\n\t0% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }\n\t10% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }\n\t20% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }\n\t25% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }\n\t25.001% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }\n\t30% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }\n\t40% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }\n\t50% { transform: scale(-0.8, 1) var(--ffz-effect-transforms); }\n\t60% { transform: scale(-0.9, 0.8) var(--ffz-effect-transforms); }\n\t70% { transform: scale(-1, 0.4) var(--ffz-effect-transforms); }\n\t75% { transform: scale(-1.2, 0.3) var(--ffz-effect-transforms); }\n\t75.001% { transform: scale(1.2, 0.3) var(--ffz-effect-transforms); }\n\t80% { transform: scale(1, 0.4) var(--ffz-effect-transforms); }\n\t90% { transform: scale(0.9, 0.8) var(--ffz-effect-transforms); }\n\t100% { transform: scale(0.8, 1) var(--ffz-effect-transforms); }\n}`\n\t},\n\t{\n\t\tsetting: [\n\t\t\t'Bounce',\n\t\t\t'FlipY'\n\t\t],\n\t\tflags: Flags.Bounce | Flags.FlipY,\n\t\ttransform: 'translateY(100%)',\n\t},\n];\n\n\nfunction generateBaseFilterCss() {\n\tconst out = [\n\t\t`.modified-emote[data-effects] > .chat-line__message--emote {\n\t--ffz-effect-filters: none;\n\t--ffz-effect-transforms: initial;\n\t--ffz-effect-animations: initial;\n}`\n\t];\n\n\t//for(const [key, val] of Object.entries(MODIFIER_FLAG_CSS)) {\n\tfor(const val of EFFECT_STYLES) {\n\t\tif ( val.raw )\n\t\t\tout.push(val.raw);\n\t}\n\n\treturn out.join('\\n');\n}\n\n\nconst MODIFIERS = {\n\t59847: {\n\t\tmodifier_offset: '0 15px 15px 0',\n\t\tmodifier: true\n\t},\n\n\t70852: {\n\t\tmodifier: true,\n\t\tmodifier_offset: '0 5px 20px 0',\n\t\textra_width: 5,\n\t\tshrink_to_fit: true\n\t},\n\n\t70854: {\n\t\tmodifier: true,\n\t\tmodifier_offset: '30px 0 0'\n\t},\n\n\t147049: {\n\t\tmodifier: true,\n\t\tmodifier_offset: '4px 1px 0 3px'\n\t},\n\n\t147011: {\n\t\tmodifier: true,\n\t\tmodifier_offset: '0'\n\t},\n\n\t70864: {\n\t\tmodifier: true,\n\t\tmodifier_offset: '0'\n\t},\n\n\t147038: {\n\t\tmodifier: true,\n\t\tmodifier_offset: '0'\n\t}\n};\n\n\nexport default class Emotes extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.EmoteTypes = EmoteTypes;\n\t\tthis.ModifierFlags = MODIFIER_FLAGS;\n\n\t\tthis.filters = {};\n\t\tthis.__filters = [];\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('experiments');\n\t\tthis.inject('staging');\n\t\tthis.inject('load_tracker');\n\n\t\tthis.twitch_inventory_sets = new Set; //(EXTRA_INVENTORY);\n\t\tthis.__twitch_emote_to_set = {};\n\t\tthis.__twitch_set_to_channel = {};\n\t\tthis.__twitch_emote_to_artist = {};\n\n\t\t// Bulk data structure for collections applied to a lot of users.\n\t\t// This lets us avoid allocating lots of individual user\n\t\t// objects when we don't need to do so.\n\t\tthis.bulk = new Map;\n\n\t\tthis.effects_enabled = {};\n\t\tthis.pending_effects = new Set();\n\t\tthis.applyEffects = this.applyEffects.bind(this);\n\n\t\tthis.sub_sets = new SourcedSet;\n\t\tthis.default_sets = new SourcedSet;\n\t\tthis.global_sets = new SourcedSet;\n\n\t\tthis.providers = new Map;\n\n\t\tthis.setProvider('ffz', {\n\t\t\tname: 'FrankerFaceZ',\n\t\t\tfont_icon: 'ffz-i-zreknarf',\n\t\t\t//icon: 'https://cdn.frankerfacez.com/badge/4/4/solid'\n\t\t});\n\n\t\t/*this.providers.set('ffz-featured', {\n\t\t\tmenu_name: 'Featured',\n\t\t\tmenu_i18n_key: 'emote-menu.featured',\n\t\t\tsort_key: 75\n\t\t});*/\n\n\t\tthis.emote_sets = {};\n\t\tthis._set_refs = {};\n\t\tthis._set_timers = {};\n\n\t\tthis.settings.add('chat.emotes.source-priorities', {\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Priorities',\n\t\t\t\tcomponent: 'emote-priorities',\n\t\t\t\tdata: () => deep_copy(this.providers)\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emotes.enabled', {\n\t\t\tdefault: 2,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emotes',\n\t\t\t\ttitle: 'Display Emotes',\n\t\t\t\tsort: -100,\n\t\t\t\tforce_seen: true,\n\t\t\t\tdescription: 'If you do not wish to see emotes, you can disable them here.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Twitch Only'},\n\t\t\t\t\t{value: 2, title: 'Enabled'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emotes.2x', {\n\t\t\tdefault: 0,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val === true ) return 1;\n\t\t\t\telse if ( val === false ) return 0;\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emotes',\n\t\t\t\ttitle: 'Larger Emotes',\n\t\t\t\tdescription: 'This setting will make emotes appear twice as large in chat. It\\'s good for use with larger fonts or just if you really like emotes.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Emotes'},\n\t\t\t\t\t{value: 2, title: 'Emotes and Emoji'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emotes.limit-size', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emotes',\n\t\t\t\ttitle: 'Limit Native Emote Size',\n\t\t\t\tdescription: 'Sometimes, really obnoxiously large emotes slip through the cracks and wind up on Twitch. This limits the size of Twitch emotes to mitigate the issue.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emotes.allow-gigantify', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emotes',\n\t\t\t\ttitle: 'Allow \"Gigantify an Emote\" Power-Up',\n\t\t\t\tdescription: 'How big is too big? Giant? Disable this and the emotes will be displayed normally.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.fix-bad-emotes', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emotes',\n\t\t\t\ttitle: 'Fix Bad Twitch Global Emotes',\n\t\t\t\tdescription: 'Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.click-emotes', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Open emote information pages by Shift-Clicking them.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.sub-emotes', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Open Twitch subscription pages by Shift-Clicking emotes when relevant.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-dialogs', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Open emote information cards for Twitch emotes by clicking them.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.effects.enable', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Effects >> General',\n\t\t\t\ttitle: 'Enable the use of emote effects.',\n\t\t\t\tdescription: 'Emote Effects are special effects that can be applied to some emotes using special modifiers.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tfor(const val of EFFECT_STYLES) {\n\t\t\tif ( ! val.setting || Array.isArray(val.setting) )\n\t\t\t\tcontinue;\n\n\t\t\tconst setting = {\n\t\t\t\tdefault: val.animation\n\t\t\t\t\t? null\n\t\t\t\t\t: true,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Chat > Emote Effects >> Specific Effect @{\"description\": \"**Note:** Animated effects are, by default, only enabled when [Animated Emotes](~chat.appearance.emotes) are enabled.\"}',\n\t\t\t\t\ttitle: `Enable the effect \"${val.title ?? val.setting}\".`,\n\t\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\t\tforce_seen: true\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif ( val.animation ) {\n\t\t\t\tsetting.default = null;\n\t\t\t\tsetting.requires = ['chat.emotes.animated'];\n\t\t\t\tsetting.process = function(ctx, val) {\n\t\t\t\t\tif ( val == null )\n\t\t\t\t\t\treturn ctx.get('chat.emotes.animated') === 1;\n\t\t\t\t\treturn val;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.settings.add(`chat.effects.${val.setting}`, setting);\n\t\t}\n\n\t\t// Because this may be used elsewhere.\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t\tthis.animHover = this.animHover.bind(this);\n\t\tthis.animLeave = this.animLeave.bind(this);\n\t}\n\n\n\tgetAddonProxy(addon_id, addon, module) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst is_dev = DEBUG || addon?.dev,\n\t\t\tid_checker = makeAddonIdChecker(addon_id);\n\n\t\tconst overrides = {},\n\t\t\twarnings = {};\n\n\t\toverrides.addFilter = (filter) => {\n\t\t\tif ( filter )\n\t\t\t\tfilter.__source = addon_id;\n\n\t\t\treturn this.addFilter(filter);\n\t\t}\n\n\t\toverrides.setProvider = (provider, data) => {\n\t\t\tif ( is_dev && ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.setProvider did not include addon ID in provider:', provider);\n\n\t\t\tif ( data )\n\t\t\t\tdata.__source = addon_id;\n\n\t\t\treturn this.setProvider(provider, data);\n\t\t}\n\n\t\toverrides.addDefaultSet = (provider, set_id, data) => {\n\t\t\tif ( is_dev && ! id_checker.test(provider) )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.addDefaultSet did not include addon ID in provider:', provider);\n\n\t\t\tif ( ! this.providers.has(provider) ) {\n\t\t\t\tthis.inferProvider(provider, addon_id);\n\t\t\t\tif ( is_dev )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.addDefaultSet for provider that has not been registered with emotes.setProvider:', provider);\n\t\t\t}\n\n\t\t\tif ( data ) {\n\t\t\t\tif ( is_dev && ! id_checker.test(set_id) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.addDefaultSet loaded set data but did not include addon ID in set ID:', set_id);\n\n\t\t\t\tdata.__source = addon_id;\n\t\t\t}\n\n\t\t\treturn this.addDefaultSet(provider, set_id, data);\n\t\t}\n\n\t\toverrides.addSubSet = (provider, set_id, data) => {\n\t\t\tif ( is_dev && ! id_checker.test(provider) )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.addSubSet did not include addon ID in provider:', provider);\n\n\t\t\tif ( ! this.providers.has(provider) ) {\n\t\t\t\tthis.inferProvider(provider, addon_id);\n\t\t\t\tif ( is_dev )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.addSubSet for provider that has not been registered with emotes.setProvider:', provider);\n\t\t\t}\n\n\t\t\tif ( data ) {\n\t\t\t\tif ( is_dev && ! id_checker.test(set_id) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.addSubSet loaded set data but did not include addon ID in set ID:', set_id);\n\n\t\t\t\tdata.__source = addon_id;\n\t\t\t}\n\n\t\t\treturn this.addSubSet(provider, set_id, data);\n\t\t}\n\n\t\toverrides.loadSetData = (set_id, data, ...args) => {\n\t\t\tif ( is_dev && ! id_checker.test(set_id) )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.loadSetData did not include addon ID in set ID:', set_id);\n\n\t\t\tif ( data )\n\t\t\t\tdata.__source = addon_id;\n\n\t\t\treturn this.loadSetData(set_id, data, ...args);\n\t\t}\n\n\t\tif ( is_dev ) {\n\t\t\toverrides.removeFilter = (filter) => {\n\t\t\t\tlet type;\n\t\t\t\tif ( typeof filter === 'string' ) type = filter;\n\t\t\t\telse type = filter.type;\n\n\t\t\t\tconst existing = this.filters[type];\n\t\t\t\tif ( existing && existing.__source !== addon_id )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned emote filter with emotes.removeFilter:', type, ' owner:', existing.__source ?? 'ffz');\n\n\t\t\t\treturn this.removeFilter(filter);\n\t\t\t}\n\n\t\t\toverrides.removeDefaultSet = (provider, ...args) => {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.removeDefaultSet did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeDefaultSet(provider, ...args);\n\t\t\t}\n\n\t\t\toverrides.removeSubSet = (provider, ...args) => {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to emotes.removeSubSet did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeSubSet(provider, ...args);\n\t\t\t}\n\n\t\t\twarnings.style = true;\n\t\t\twarnings.effect_style = true;\n\t\t\twarnings.emote_sets = true;\n\t\t\twarnings.loadSetUserIds = warnings.loadSetUsers = 'This method is meant for internal use.';\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'emotes', overrides, warnings);\n\t}\n\n\n\tonEnable() {\n\t\tthis.style = new ManagedStyle('emotes');\n\t\tthis.effect_style = new ManagedStyle('effects');\n\n\t\t// Generate the base filter CSS.\n\t\tthis.base_effect_css = generateBaseFilterCss();\n\n\t\tthis.parent.context.getChanges('chat.emotes.source-priorities', this.updatePriorities, this);\n\n\t\tthis.parent.context.on('changed:chat.effects.enable', this.updateEffects, this);\n\t\tfor(const input of EFFECT_STYLES)\n\t\t\tif ( input.setting && ! Array.isArray(input.setting) )\n\t\t\t\tthis.parent.context.on(`changed:chat.effects.${input.setting}`, this.updateEffects, this);\n\n\t\tthis.updateEffects();\n\n\t\t// Fix numeric Twitch favorite IDs.\n\t\tconst favs = this.getFavorites('twitch');\n\t\tlet changed = false;\n\t\tfor(let i=0; i < favs.length; i++) {\n\t\t\tif ( typeof favs[i] === 'number' ) {\n\t\t\t\tchanged = true;\n\t\t\t\tfavs[i] = `${favs[i]}`;\n\t\t\t}\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.setFavorites('twitch', favs);\n\n\t\tif ( Object.keys(this.emote_sets).length ) {\n\t\t\tthis.log.info('Generating CSS for existing emote sets.');\n\t\t\tfor(const set_id in this.emote_sets)\n\t\t\t\tif ( has(this.emote_sets, set_id) ) {\n\t\t\t\t\tconst emote_set = this.emote_sets[set_id];\n\t\t\t\t\tif ( emote_set && (emote_set.pending_css || emote_set.css) ) {\n\t\t\t\t\t\tthis.style.set(`es--${set_id}`, (emote_set.pending_css || '') + (emote_set.css || ''));\n\t\t\t\t\t\temote_set.pending_css = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\tthis.on('pubsub:command:follow_sets', this.updateFollowSets, this);\n\n\t\tthis.on('pubsub:command:add_emote', msg => {\n\t\t\tconst set_id = msg.set_id,\n\t\t\t\temote = msg.emote,\n\n\t\t\t\temote_set = this.emote_sets[set_id];\n\n\t\t\tif ( ! emote_set )\n\t\t\t\treturn;\n\n\t\t\tconst has_old = !! emote_set.emotes?.[emote.id] || !! emote_set.disabled_emotes?.[emote.id];\n\t\t\tconst processed = this.addEmoteToSet(set_id, emote);\n\n\t\t\tthis.maybeNotifyChange(\n\t\t\t\thas_old ? 'modified' : 'added',\n\t\t\t\tset_id,\n\t\t\t\tprocessed\n\t\t\t);\n\t\t});\n\n\t\tthis.on('pubsub:command:remove_emote', msg => {\n\t\t\tconst set_id = msg.set_id,\n\t\t\t\temote_id = msg.emote_id;\n\n\t\t\tif ( ! this.emote_sets[set_id] )\n\t\t\t\treturn;\n\n\t\t\t// If removing it returns nothing, there was no\n\t\t\t// emote to remove with that ID.\n\t\t\tconst removed = this.removeEmoteFromSet(set_id, emote_id);\n\t\t\tif ( ! removed )\n\t\t\t\treturn;\n\n\t\t\tthis.maybeNotifyChange(\n\t\t\t\t'removed',\n\t\t\t\tset_id,\n\t\t\t\tremoved\n\t\t\t);\n\t\t});\n\n\t\tthis.on('chat:reload-data', flags => {\n\t\t\tif ( ! flags || flags.emotes )\n\t\t\t\tthis.loadGlobalSets();\n\t\t});\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tlet removed = 0;\n\t\t\tfor(const [key, set] of Object.entries(this.emote_sets)) {\n\t\t\t\tif ( set?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.loadSetData(key, null, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const [key, def] of Object.entries(this.filters)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.removeFilter(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const [key, data] of this.providers.entries()) {\n\t\t\t\tif ( data?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.setProvider(key, null);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( removed ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed} entries when unloading addon:`, addon_id);\n\t\t\t\t// TODO: Debounced retokenize all chat messages.\n\t\t\t}\n\t\t})\n\n\t\tthis.loadGlobalSets();\n\t}\n\n\n\t// ========================================================================\n\t// Providers\n\t// ========================================================================\n\n\tupdatePriorities(priorities) {\n\t\tconst l = priorities?.length;\n\n\t\tif (! l || l <= 0)\n\t\t\tthis.sourceSortFn = null;\n\t\telse\n\t\t\tthis.sourceSortFn = (first, second) => {\n\t\t\t\tif (first.startsWith('ffz-'))\n\t\t\t\t\tfirst = 'ffz';\n\t\t\t\tif (second.startsWith('ffz-'))\n\t\t\t\t\tsecond = 'ffz';\n\n\t\t\t\tlet first_priority = priorities.indexOf(first),\n\t\t\t\t\tsecond_priority = priorities.indexOf(second);\n\n\t\t\t\tif (first_priority === -1) first_priority = l;\n\t\t\t\tif (second_priority === -1) second_priority = l;\n\n\t\t\t\treturn first_priority - second_priority;\n\t\t\t};\n\n\t\t// Update all existing sourced sets now.\n\t\tthis.default_sets.setSortFunction(this.sourceSortFn);\n\n\t\tthis.emit(':update-priorities', this.sourceSortFn);\n\t}\n\n\tinferProvider(provider, addon_id) {\n\t\tif ( this.providers.has(provider) )\n\t\t\treturn;\n\n\t\tconst data = this.resolve('addons')?.getAddon(addon_id);\n\t\tif ( data )\n\t\t\tthis.setProvider(provider, {\n\t\t\t\tname: data.name,\n\t\t\t\ti18n_key: data.name_i18n,\n\t\t\t\ticon: data.icon,\n\t\t\t\tdescription: provider,\n\t\t\t\t__source: addon_id\n\t\t\t});\n\t}\n\n\tsetProvider(provider, data) {\n\t\tif ( ! data )\n\t\t\tthis.providers.delete(provider);\n\t\telse {\n\t\t\tdata.id = provider;\n\t\t\tthis.providers.set(provider, data);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Emote Filtering\n\t// ========================================================================\n\n\taddFilter(filter, should_update = true) {\n\t\tconst type = filter.type;\n\t\tif ( has(this.filters, type) ) {\n\t\t\tthis.log.warn(`Tried adding emote filter of type '${type}' when one was already present.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.filters[type] = filter;\n\t\tif ( filter.priority == null )\n\t\t\tfilter.priotiy = 0;\n\n\t\tthis.__filters.push(filter);\n\t\tthis.__filters.sort((a, b) => {\n\t\t\tif ( a.priority > b.priority ) return -1;\n\t\t\tif ( a.priority < b.priority ) return 1;\n\t\t\treturn a.type < b.type;\n\t\t});\n\n\t\tif ( should_update )\n\t\t\tthis.updateFiltered();\n\t}\n\n\tremoveFilter(filter, should_update = true) {\n\t\tlet type;\n\t\tif ( typeof filter === 'string' ) type = filter;\n\t\telse type = filter.type;\n\n\t\tfilter = this.filters[type];\n\t\tif ( ! filter )\n\t\t\treturn null;\n\n\t\tdelete this.filters[type];\n\n\t\tconst idx = this.__filters.indexOf(filter);\n\t\tif ( idx !== -1 ) {\n\t\t\tthis.__filters.splice(idx, 1);\n\t\t\tif ( should_update )\n\t\t\t\tthis.updateFiltered();\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tshouldFilterEmote(emote, set, set_id) {\n\t\tfor(const filter of this.__filters)\n\t\t\tif ( filter.test(emote, set, set_id) )\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\tupdateFiltered() {\n\t\t// Iterate over every emote set, updating filtered emotes.\n\t\tfor(const set of Object.values(this.emote_sets)) {\n\n\t\t\tconst emotes = {},\n\t\t\t\tfiltered = {};\n\n\t\t\tlet count = 0,\n\t\t\t\tfcount = 0,\n\t\t\t\tchanged = false;\n\n\t\t\tfor(const em of Object.values(set.emotes)) {\n\t\t\t\tif ( ! this.shouldFilterEmote(em, set, set.id) ) {\n\t\t\t\t\temotes[em.id] = em;\n\t\t\t\t\tcount++;\n\n\t\t\t\t} else {\n\t\t\t\t\tfiltered[em.id] = em;\n\t\t\t\t\tfcount++;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const em of Object.values(set.disabled_emotes)) {\n\t\t\t\tif ( this.shouldFilterEmote(em, set, set.id)) {\n\t\t\t\t\tfiltered[em.id] = em;\n\t\t\t\t\tfcount++;\n\n\t\t\t\t} else {\n\t\t\t\t\temotes[em.id] = em;\n\t\t\t\t\tcount++;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! changed )\n\t\t\t\tcontinue;\n\n\t\t\t// Save the changes.\n\t\t\tthis.log.info(`Filtered emote set #${set.id}: ${set.title} (total: ${count+fcount}, old: ${set.disabled_count}, new: ${fcount})`);\n\n\t\t\tset.emotes = emotes;\n\t\t\tset.count = count;\n\t\t\tset.disabled_emotes = filtered;\n\t\t\tset.disabled_count = fcount;\n\n\t\t\t// Update the CSS for the set.\n\t\t\tconst css = [];\n\t\t\tfor(const em of Object.values(emotes)) {\n\t\t\t\tconst emote_css = this.generateEmoteCSS(em);\n\t\t\t\tif ( emote_css?.length )\n\t\t\t\t\tcss.push(emote_css);\n\t\t\t}\n\n\t\t\tif ( this.style && (css.length || set.css) )\n\t\t\t\tthis.style.set(`es--${set.id}`, css.join('') + (set.css || ''));\n\t\t\telse if ( css.length )\n\t\t\t\tset.pending_css = css.join('');\n\n\t\t\t// And emit an event because this emote set changed.\n\t\t\tthis.emit(':loaded', set.id, set);\n\t\t}\n\n\t\t// TODO: Summary, maybe? Or update chat? Who knows?\n\t}\n\n\n\t// ========================================================================\n\t// Chat Notices\n\t// ========================================================================\n\n\tmaybeNotifyChange(action, set_id, emote) {\n\t\tif ( ! this._pending_notifications )\n\t\t\tthis._pending_notifications = [];\n\n\t\tthis._pending_notifications.push({action, set_id, emote});\n\n\t\tif ( ! this._pending_timer )\n\t\t\tthis._pending_timer = setTimeout(() => this._handleNotifyChange(), 1000);\n\t}\n\n\t_handleNotifyChange() {\n\t\tclearTimeout(this._pending_timer);\n\t\tthis._pending_timer = null;\n\n\t\tconst notices = this._pending_notifications;\n\t\tthis._pending_notifications = null;\n\n\t\t// Make sure we are equipped to send notices.\n\t\tconst chat = this.resolve('site.chat');\n\t\tif ( ! chat?.addNotice )\n\t\t\treturn;\n\n\t\t// Get the current user.\n\t\tconst me = this.resolve('site').getUser();\n\t\tif ( ! me?.id )\n\t\t\treturn;\n\n\t\t// Get the current channel.\n\t\tlet room_id = this.parent.context.get('context.channelID'),\n\t\t\troom_login = this.parent.context.get('context.channel');\n\n\t\t// And now get the current user's available emote sets.\n\t\tconst sets = this.getSetIDs(me.id, me.login, room_id, room_login);\n\t\tconst set_changes = {};\n\n\t\t// Build a data structure for reducing the needed number of notices.\n\t\tfor(const notice of notices) {\n\t\t\t// Make sure the set ID is a string.\n\t\t\tconst set_id = `${notice.set_id}`,\n\t\t\t\taction = notice.action;\n\n\t\t\tif ( sets.includes(set_id) ) {\n\t\t\t\tconst changes = set_changes[set_id] = set_changes[set_id] || {},\n\t\t\t\t\tlist = changes[action] = changes[action] || [];\n\n\t\t\t\t// Deduplicate while we're at it.\n\t\t\t\tif ( list.find(em => em.id === notice.emote.id) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlist.push(notice.emote);\n\t\t\t}\n\t\t}\n\n\t\t// Iterate over everything, sending chat notices.\n\t\tfor(const [set_id, notices] of Object.entries(set_changes)) {\n\t\t\tconst emote_set = this.emote_sets[set_id];\n\t\t\tif ( ! emote_set )\n\t\t\t\tcontinue;\n\n\t\t\tfor(const [action, emotes] of Object.entries(notices)) {\n\t\t\t\tconst emote_list = emotes\n\t\t\t\t\t.map(emote => emote.name)\n\t\t\t\t\t.join(', ');\n\n\t\t\t\tlet msg;\n\t\t\t\tif ( action === 'added' )\n\t\t\t\t\tmsg = this.i18n.t('emote-updates.added', 'The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been added to {set}.', {\n\t\t\t\t\t\tcount: emotes.length,\n\t\t\t\t\t\temotes: emote_list,\n\t\t\t\t\t\tset: emote_set.title\n\t\t\t\t\t});\n\n\t\t\t\telse if ( action === 'modified' )\n\t\t\t\t\tmsg = this.i18n.t('emote-updates.modified', 'The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been updated in {set}.', {\n\t\t\t\t\t\tcount: emotes.length,\n\t\t\t\t\t\temotes: emote_list,\n\t\t\t\t\t\tset: emote_set.title\n\t\t\t\t\t});\n\n\t\t\t\telse if ( action === 'removed' )\n\t\t\t\t\tmsg = this.i18n.t('emote-updates.removed', 'The {count, plural, one {emote {emotes} has} other {emotes {emotes} have}} been removed from {set}.', {\n\t\t\t\t\t\tcount: emotes.length,\n\t\t\t\t\t\temotes: emote_list,\n\t\t\t\t\t\tset: emote_set.title\n\t\t\t\t\t});\n\n\t\t\t\tif ( msg )\n\t\t\t\t\tchat.addNotice('*', {\n\t\t\t\t\t\ticon: 'ffz-i-zreknarf',\n\t\t\t\t\t\tmessage: msg\n\t\t\t\t\t}); // `[FFZ] ${msg}`);\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Load Modifier Effects\n\t// ========================================================================\n\n\tensureEffect(flags) {\n\t\tif ( ! this.effect_style.has(`${flags}`) ) {\n\t\t\tthis.pending_effects.add(flags);\n\t\t\tif ( ! this._effect_timer )\n\t\t\t\tthis._effect_timer = requestAnimationFrame(this.applyEffects);\n\t\t}\n\t}\n\n\tapplyEffects() {\n\t\tthis._effect_timer = null;\n\t\tconst effects = this.pending_effects;\n\t\tthis.pending_effects = new Set;\n\n\t\tfor(const flags of effects) {\n\t\t\tconst result = this.generateFilterCss(flags);\n\t\t\tthis.effect_style.set(`${flags}`, result ?? '');\n\t\t}\n\t}\n\n\tgenerateFilterCss(flags) {\n\t\tif ( ! this.parent.context.get('chat.effects.enable') )\n\t\t\treturn null;\n\n\t\tlet filter, transformOrigin, transform, animation, animations = [];\n\n\t\tfor(const input of this.activeEffectStyles) {\n\t\t\tif ( (flags & input.flags) !== input.flags )\n\t\t\t\tcontinue;\n\n\t\t\tif ( input.not_flags && (flags & input.not_flags) === input.not_flags )\n\t\t\t\tcontinue;\n\n\t\t\tif ( input.animation )\n\t\t\t\tanimations.push(input);\n\n\t\t\tif ( input.filter )\n\t\t\t\tfilter = filter\n\t\t\t\t\t? `${filter} ${input.filter}`\n\t\t\t\t\t: input.filter;\n\n\t\t\tif ( input.transformOrigin )\n\t\t\t\ttransformOrigin = input.transformOrigin;\n\n\t\t\tif ( input.transform )\n\t\t\t\ttransform = transform\n\t\t\t\t\t? `${transform} ${input.transform}`\n\t\t\t\t\t: input.transform;\n\t\t}\n\n\t\tif ( animations.length )\n\t\t\tfor(const input of animations) {\n\t\t\t\tif ( filter && input.animationFilter )\n\t\t\t\t\tanimation = animation\n\t\t\t\t\t\t? `${animation}, ${input.animationFilter}`\n\t\t\t\t\t\t: input.animationFilter;\n\t\t\t\telse if ( transform && input.animationTransform )\n\t\t\t\t\tanimation = animation\n\t\t\t\t\t\t? `${animation}, ${input.animationTransform}`\n\t\t\t\t\t\t: input.animationTransform;\n\t\t\t\telse\n\t\t\t\t\tanimation = animation\n\t\t\t\t\t\t? `${animation}, ${input.animation}`\n\t\t\t\t\t\t: input.animation;\n\t\t\t}\n\n\t\tif ( ! filter && ! transform && ! animation )\n\t\t\treturn null;\n\n\t\treturn `.modified-emote[data-effects=\"${flags}\"] > .chat-line__message--emote {${filter ? `\n\t--ffz-effect-filters: ${filter};\n\tfilter: var(--ffz-effect-filters);` : ''}${transformOrigin ? `\n\ttransform-origin: ${transformOrigin};` : ''}${transform ? `\n\t--ffz-effect-transforms: ${transform};\n\ttransform: var(--ffz-effect-transforms);` : ''}${animation ? `\n\t--ffz-effect-animations: ${animation};\n\tanimation: var(--ffz-effect-animations);` : ''}\n}`;\n\t}\n\n\tupdateEffects() {\n\t\t// TODO: Smarter logic so it does less work.\n\t\tconst enabled = this.parent.context.get('chat.effects.enable');\n\n\t\tthis.effects_enabled = {};\n\t\tthis.activeEffectStyles = [];\n\n\t\tthis.activeAsBackgroundMask = 0;\n\t\tthis.activeNoWideMask = 0;\n\n\t\tfor(const input of EFFECT_STYLES) {\n\t\t\tif ( input.setting && ! Array.isArray(input.setting) )\n\t\t\t\tthis.effects_enabled[input.setting] = this.parent.context.get(`chat.effects.${input.setting}`);\n\t\t}\n\n\t\tfor(const input of EFFECT_STYLES) {\n\t\t\tlet enabled = true;\n\t\t\tif ( Array.isArray(input.setting) ) {\n\t\t\t\tfor(const setting of input.setting)\n\t\t\t\t\tif ( ! this.effects_enabled[setting] ) {\n\t\t\t\t\t\tenabled = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t} else if ( input.setting )\n\t\t\t\tenabled = this.effects_enabled[input.setting];\n\n\t\t\tif ( enabled ) {\n\t\t\t\tthis.activeEffectStyles.push(input);\n\n\t\t\t\tif ( input.as_background )\n\t\t\t\t\tthis.activeAsBackgroundMask = this.activeAsBackgroundMask | input.flags;\n\t\t\t\tif ( input.no_wide )\n\t\t\t\t\tthis.activeNoWideMask = this.activeNoWideMask | input.flags;\n\t\t\t}\n\t\t}\n\n\t\tthis.effect_style.clear();\n\t\tif ( ! enabled || ! this.activeEffectStyles.length )\n\t\t\treturn;\n\n\t\tthis.effect_style.set('base', this.base_effect_css);\n\t\tthis.emit(':update-effects');\n\t}\n\n\n\t// ========================================================================\n\t// Featured Sets\n\t// ========================================================================\n\n\tupdateFollowSets(data) {\n\t\tfor(const room_login in data)\n\t\t\tif ( has(data, room_login) ) {\n\t\t\t\tconst room = this.parent.getRoom(null, room_login, true);\n\t\t\t\tif ( ! room || room.destroyed )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst new_sets = data[room_login] || [],\n\t\t\t\t\temote_sets = room.emote_sets,\n\t\t\t\t\tproviders = emote_sets && emote_sets._sources;\n\n\t\t\t\tif ( providers && providers.has('ffz-featured') )\n\t\t\t\t\tfor(const item of providers.get('ffz-featured')) {\n\t\t\t\t\t\tconst idx = new_sets.indexOf(item);\n\t\t\t\t\t\tif ( idx === -1 )\n\t\t\t\t\t\t\troom.removeSet('ffz-featured', item);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tnew_sets.splice(idx, 1);\n\t\t\t\t\t}\n\n\t\t\t\tfor(const set_id of new_sets) {\n\t\t\t\t\troom.addSet('ffz-featured', set_id);\n\n\t\t\t\t\tif ( ! this.emote_sets[set_id] )\n\t\t\t\t\t\tthis.loadSet(set_id);\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Hidden Checking\n\t// ========================================================================\n\n\ttoggleHidden(source, id, value = null) {\n\t\tconst key = `hidden-emotes.${source}`,\n\t\t\tp = this.settings.provider,\n\t\t\thidden = p.get(key, []),\n\n\t\t\tidx = hidden.indexOf(id);\n\n\t\tif ( value === null )\n\t\t\tvalue = idx === -1;\n\n\t\tif ( value && idx === -1 )\n\t\t\thidden.push(id);\n\t\telse if ( ! value && idx !== -1 )\n\t\t\thidden.splice(idx, 1);\n\t\telse\n\t\t\treturn;\n\n\t\tif ( hidden.length )\n\t\t\tp.set(key, hidden);\n\t\telse\n\t\t\tp.delete(key);\n\n\t\tthis.emit(':change-hidden', source, id, value);\n\t}\n\n\tisHidden(source, id) {\n\t\treturn this.getHidden(source).includes(id);\n\t}\n\n\tgetHidden(source) {\n\t\treturn this.settings.provider.get(`hidden-emotes.${source}`) || [];\n\t}\n\n\tsetHidden(source, list) {\n\t\tconst key = `hidden-emotes.${source}`;\n\t\tif ( ! Array.isArray(list) || ! list.length )\n\t\t\tthis.settings.provider.delete(key);\n\t\telse\n\t\t\tthis.settings.provider.set(key, list);\n\t}\n\n\n\t// ========================================================================\n\t// Animation Hover\n\t// ========================================================================\n\n\tanimHover(event) { // eslint-disable-line class-methods-use-this\n\t\tconst target = event.currentTarget;\n\t\tif ( target[HoverState] )\n\t\t\treturn;\n\n\t\tif ( target[HoverRAF] )\n\t\t\tcancelAnimationFrame(target[HoverRAF]);\n\n\t\ttarget[HoverRAF] = requestAnimationFrame(() => {\n\t\t\ttarget[HoverRAF] = null;\n\t\t\tif ( target[HoverState] )\n\t\t\t\treturn;\n\n\t\t\tif ( ! target.matches(':hover') )\n\t\t\t\treturn;\n\n\t\t\ttarget[HoverState] = true;\n\t\t\tconst emotes = target.querySelectorAll('.ffz-hover-emote');\n\t\t\tfor(const em of emotes) {\n\t\t\t\tconst ds = em.dataset;\n\t\t\t\tif ( ds.normalSrc && ds.hoverSrc ) {\n\t\t\t\t\tem.src = ds.hoverSrc;\n\t\t\t\t\tif (em.srcset)\n\t\t\t\t\t\tem.srcset = ds.hoverSrcSet;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\tanimLeave(event) { // eslint-disable-line class-methods-use-this\n\t\tconst target = event.currentTarget;\n\t\tif ( ! target[HoverState] )\n\t\t\treturn;\n\n\t\tif ( target[HoverRAF] )\n\t\t\tcancelAnimationFrame(target[HoverRAF]);\n\n\t\ttarget[HoverRAF] = requestAnimationFrame(() => {\n\t\t\ttarget[HoverRAF] = null;\n\t\t\tif ( ! target[HoverState] )\n\t\t\t\treturn;\n\n\t\t\tif ( target.matches(':hover') )\n\t\t\t\treturn;\n\n\t\t\ttarget[HoverState] = false;\n\t\t\tconst emotes = target.querySelectorAll('.ffz-hover-emote');\n\t\t\tfor(const em of emotes) {\n\t\t\t\tconst ds = em.dataset;\n\t\t\t\tif ( ds.normalSrc ) {\n\t\t\t\t\tem.src = ds.normalSrc;\n\t\t\t\t\tif (em.srcset)\n\t\t\t\t\t\tem.srcset = ds.normalSrcSet;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\t// ========================================================================\n\t// Favorite Checking\n\t// ========================================================================\n\n\ttoggleFavorite(source, id, value = null) {\n\t\tconst key = `favorite-emotes.${source}`,\n\t\t\tp = this.settings.provider,\n\t\t\tfavorites = p.get(key) || [],\n\n\t\t\tidx = favorites.indexOf(id);\n\n\t\tif ( value === null )\n\t\t\tvalue = idx === -1;\n\n\t\tif ( value && idx === -1 )\n\t\t\tfavorites.push(id);\n\t\telse if ( ! value && idx !== -1 )\n\t\t\tfavorites.splice(idx, 1);\n\t\telse\n\t\t\treturn value;\n\n\t\tif ( favorites.length )\n\t\t\tp.set(key, favorites);\n\t\telse\n\t\t\tp.delete(key);\n\n\t\tthis.emit(':change-favorite', source, id, value);\n\t\treturn value;\n\t}\n\n\tisFavorite(source, id) {\n\t\tconst favorites = this.settings.provider.get(`favorite-emotes.${source}`);\n\t\treturn favorites && favorites.includes(id);\n\t}\n\n\tgetFavorites(source) {\n\t\treturn this.settings.provider.get(`favorite-emotes.${source}`) || [];\n\t}\n\n\tsetFavorites(source, favs) {\n\t\tconst key = `favorite-emotes.${source}`;\n\t\tif ( ! Array.isArray(favs) || ! favs.length )\n\t\t\tthis.settings.provider.delete(key);\n\t\telse\n\t\t\tthis.settings.provider.set(key, favs);\n\t}\n\n\thandleClick(event, favorite_only = false) {\n\t\tconst target = event.target,\n\t\t\tds = target && target.dataset;\n\n\t\t/*const modified = target.closest('.modified-emote');\n\t\tif ( modified && modified !== target )\n\t\t\treturn;*/\n\n\t\tif ( ! ds )\n\t\t\treturn;\n\n\t\tconst provider = ds.provider,\n\t\t\tclick_emote = this.parent.context.get('chat.click-emotes'),\n\t\t\tclick_sub = this.parent.context.get('chat.sub-emotes');\n\n\t\tif ( event.shiftKey && (click_emote || click_sub) ) {\n\t\t\tlet url;\n\n\t\t\tif ( provider === 'twitch' ) {\n\t\t\t\turl = null; // = `https://twitchemotes.com/emotes/${ds.id}`;\n\n\t\t\t\tif ( click_sub ) {\n\t\t\t\t\tconst apollo = this.resolve('site.apollo');\n\t\t\t\t\tif ( apollo ) {\n\t\t\t\t\t\tapollo.client.query({\n\t\t\t\t\t\t\tquery: GET_EMOTE,\n\t\t\t\t\t\t\tvariables: {\n\t\t\t\t\t\t\t\tid: ds.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).then(result => {\n\t\t\t\t\t\t\tconst prod = get('data.emote.subscriptionProduct', result);\n\t\t\t\t\t\t\tif ( prod && prod.state === 'ACTIVE' && prod.owner && prod.owner.login )\n\t\t\t\t\t\t\t\turl = `https://www.twitch.tv/subs/${prod.owner.login}`;\n\t\t\t\t\t\t\telse if ( ! click_emote )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tif ( url ) {\n\t\t\t\t\t\t\t\tconst win = window.open();\n\t\t\t\t\t\t\t\tif ( win ) {\n\t\t\t\t\t\t\t\t\twin.opener = null;\n\t\t\t\t\t\t\t\t\twin.location = url;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else if ( provider === 'ffz' ) {\n\t\t\t\tconst emote_set = this.emote_sets[ds.set],\n\t\t\t\t\temote = emote_set && (emote_set.emotes[ds.id] || emote_set.disabled_emotes?.[ds.id]);\n\n\t\t\t\tif ( ! emote )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( emote.click_url )\n\t\t\t\t\turl = emote.click_url;\n\n\t\t\t\telse if ( ! emote_set.source )\n\t\t\t\t\turl = `https://www.frankerfacez.com/emoticons/${emote.id}`;\n\t\t\t}\n\n\t\t\tif ( ! click_emote )\n\t\t\t\treturn false;\n\n\t\t\tif ( url ) {\n\t\t\t\tconst win = window.open();\n\t\t\t\tif ( win ) {\n\t\t\t\t\twin.opener = null;\n\t\t\t\t\twin.location = url;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( event[MOD_KEY] ) {\n\t\t\t// Favoriting Emotes\n\t\t\tlet source, id;\n\n\t\t\tif ( provider === 'twitch' ) {\n\t\t\t\tsource = 'twitch';\n\t\t\t\tid = ds.id;\n\n\t\t\t} else if ( provider === 'ffz' ) {\n\t\t\t\tconst emote_set = this.emote_sets[ds.set],\n\t\t\t\t\temote = emote_set && (emote_set.emotes[ds.id] || emote_set.disabled_emotes?.[ds.id]);\n\n\t\t\t\tif ( ! emote )\n\t\t\t\t\treturn;\n\n\t\t\t\tsource = emote_set.source || 'ffz';\n\t\t\t\tid = emote.id;\n\n\t\t\t} else if ( provider === 'emoji' ) {\n\t\t\t\tsource = 'emoji';\n\t\t\t\tid = ds.code;\n\n\t\t\t} else\n\t\t\t\treturn;\n\n\t\t\tthis.toggleFavorite(source, id);\n\t\t\tconst tt = target._ffz_tooltip;\n\t\t\tif ( tt && tt.visible ) {\n\t\t\t\ttt.hide();\n\t\t\t\tsetTimeout(() => document.contains(target) && tt.show(), 0);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( favorite_only )\n\t\t\treturn false;\n\n\t\tlet modifiers;\n\t\ttry {\n\t\t\tmodifiers = JSON.parse(ds.modifierInfo);\n\t\t} catch(err) {\n\t\t\t/* no-op */\n\t\t}\n\n\t\tconst evt = this.makeEvent({\n\t\t\tprovider,\n\t\t\tid: ds.id,\n\t\t\tset: ds.set,\n\t\t\tcode: ds.code,\n\t\t\tvariant: ds.variant,\n\t\t\tname: ds.name || target.alt,\n\t\t\tmodifiers,\n\t\t\tsource: event\n\t\t});\n\n\t\tthis.emit('chat.emotes:click', evt);\n\t\tif ( evt.defaultPrevented )\n\t\t\treturn true;\n\n\t\tif ( provider === 'twitch' && this.parent.context.get('chat.emote-dialogs') ) {\n\t\t\tconst fine = this.resolve('site.fine');\n\t\t\tif ( ! fine )\n\t\t\t\treturn;\n\n\t\t\tconst line = fine.searchParent(target, n => n.props && n.props.message),\n\t\t\t\topener = fine.searchParent(target, n => n.onShowEmoteCard, 500);\n\n\t\t\tif ( ! line || ! opener )\n\t\t\t\treturn;\n\n\t\t\tconst rect = target.getBoundingClientRect();\n\n\t\t\topener.onShowEmoteCard({\n\t\t\t\tchannelID: line.props.channelID || '',\n\t\t\t\tchannelLogin: line.props.channelLogin || '',\n\t\t\t\temoteID: ds.id,\n\t\t\t\temoteCode: target.alt,\n\t\t\t\tsourceID: 'chat',\n\t\t\t\treferrerID: '',\n\t\t\t\tinitialTopOffset: rect.bottom,\n\t\t\t\tinitialBottomOffset: rect.top\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Access\n\t// ========================================================================\n\n\tgetTargetEmote() {\n\t\tthis.target_emote = null;\n\n\t\tconst me = this.resolve('site').getUser(),\n\t\t\tInput = me ? this.resolve('site.chat.input') : null,\n\t\t\tentered = Input ? Input.getInput() : null;\n\n\t\tconst menu = this.resolve('site.chat.emote_menu')?.MenuWrapper?.first,\n\t\t\temote_sets = menu?.getAllSets?.(),\n\t\t\temotes = emote_sets\n\t\t\t\t? emote_sets.map(x => x.emotes).flat().filter(x => ! x.effects && ! x.locked)\n\t\t\t\t: null;\n\n\t\tif ( entered && emotes ) {\n\t\t\t// Okay this is gonna be oof.\n\t\t\tconst name_map = {};\n\t\t\tfor(let i = 0; i < emotes.length; i++)\n\t\t\t\tif ( ! name_map[emotes[i].name] )\n\t\t\t\t\tname_map[emotes[i].name] = i;\n\n\t\t\tconst words = entered.split(' ');\n\t\t\tlet i = words.length;\n\t\t\twhile(i--) {\n\t\t\t\tconst word = words[i];\n\t\t\t\tif ( name_map[word] != null )\n\t\t\t\t\treturn emotes[name_map[word]];\n\t\t\t}\n\t\t}\n\n\t\t// Random emote\n\t\tif ( emotes && emotes.length ) {\n\t\t\tconst idx = Math.floor(Math.random() * emotes.length),\n\t\t\t\temote = emotes[idx];\n\n\t\t\tthis.target_emote = emote;\n\t\t\treturn emote;\n\t\t}\n\n\t\t// Return LaterSooner\n\t\treturn this.target_emote = {\n\t\t\tprovider: 'ffz',\n\t\t\tset_id: 3,\n\t\t\tid: 149346,\n\t\t\tname: 'LaterSooner',\n\t\t\tsrc: 'https://cdn.frankerfacez.com/emote/149346/1',\n\t\t\tsrcSet: 'https://cdn.frankerfacez.com/emote/149346/1 1x, https://cdn.frankerfacez.com/emote/149346/2 2x, https://cdn.frankerfacez.com/emote/149346/4 4x',\n\t\t\twidth: 25,\n\t\t\theight: 32\n\t\t}\n\t}\n\n\n\tgetSetIDs(user_id, user_login, room_id, room_login) {\n\t\tconst room = this.parent.getRoom(room_id, room_login, true),\n\t\t\troom_user = room && room.getUser(user_id, user_login, true),\n\t\t\tuser = this.parent.getUser(user_id, user_login, true);\n\n\t\tlet out = (user?.emote_sets ? user.emote_sets._cache : []).concat(\n\t\t\troom_user?.emote_sets ? room_user.emote_sets._cache : [],\n\t\t\troom?.emote_sets ? room.emote_sets._cache : [],\n\t\t\tthis.default_sets._cache\n\t\t);\n\n\t\tif ( this.bulk.size ) {\n\t\t\tconst str_user = String(user_id);\n\t\t\tfor(const [set_id, users] of this.bulk) {\n\t\t\t\tif ( users?._cache.has(str_user) )\n\t\t\t\t\tout.push(set_id);\n\t\t\t}\n\t\t}\n\n\t\t// Shared Chats\n\t\tif ( room?.shared_chats?.size > 0 )\n\t\t\tfor(const shared_id of room.shared_chats) {\n\t\t\t\tconst shared_room = this.parent.getRoom(shared_id, null, true),\n\t\t\t\t\tshared_user = shared_room && shared_room.getUser(user_id, user_login, true);\n\n\t\t\t\tif ( shared_user?.emote_sets?._cache )\n\t\t\t\t\tout = out.concat(shared_user.emote_sets._cache);\n\n\t\t\t\tif ( shared_room?.emote_sets?._cache )\n\t\t\t\t\tout = out.concat(shared_room.emote_sets._cache);\n\t\t\t}\n\n\t\treturn out;\n\t}\n\n\tgetSets(user_id, user_login, room_id, room_login) {\n\t\treturn this.getSetIDs(user_id, user_login, room_id, room_login)\n\t\t\t.map(set_id => this.emote_sets[set_id]);\n\t}\n\n\t_withSources(out, seen, emote_sets, room_id = null) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! emote_sets?._sources )\n\t\t\treturn;\n\n\t\tfor(const [provider, data] of emote_sets._sources)\n\t\t\tfor(const item of data)\n\t\t\t\tif ( ! seen.has(item) ) {\n\t\t\t\t\tout.push([item, provider, room_id]);\n\t\t\t\t\tseen.add(item);\n\t\t\t\t}\n\n\t\treturn out;\n\t}\n\n\tgetRoomSetIDsWithSources(user_id, user_login, room_id, room_login) {\n\t\tconst room = this.parent.getRoom(room_id, room_login, true),\n\t\t\troom_user = room && room.getUser(user_id, user_login, true);\n\n\t\tif ( ! room )\n\t\t\treturn [];\n\n\t\tconst out = [], seen = new Set;\n\n\t\tthis._withSources(out, seen, room.emote_sets, room.id);\n\t\tif ( room_user )\n\t\t\tthis._withSources(out, seen, room_user.emote_sets, room.id);\n\n\t\t// Shared Chats\n\t\tif ( room?.shared_chats?.size > 0 )\n\t\t\tfor(const shared_id of room.shared_chats) {\n\t\t\t\tconst shared_room = this.parent.getRoom(shared_id, null, true),\n\t\t\t\t\tshared_user = shared_room && shared_room.getUser(user_id, user_login, true);\n\n\t\t\t\tif ( shared_user )\n\t\t\t\t\tthis._withSources(out, seen, shared_user.emote_sets, shared_id);\n\n\t\t\t\tif ( shared_room )\n\t\t\t\t\tthis._withSources(out, seen, shared_room.emote_sets, shared_id);\n\t\t\t}\n\n\t\treturn out;\n\t}\n\n\tgetRoomSetsWithSources(user_id, user_login, room_id, room_login) {\n\t\treturn this.getRoomSetIDsWithSources(user_id, user_login, room_id, room_login)\n\t\t\t.map(([set_id, source, r_id]) => [this.emote_sets[set_id], source, r_id]);\n\t}\n\n\tgetRoomSetIDs(user_id, user_login, room_id, room_login) {\n\t\tconst room = this.parent.getRoom(room_id, room_login, true),\n\t\t\troom_user = room && room.getUser(user_id, user_login, true);\n\n\t\tlet out;\n\n\t\tif ( ! room )\n\t\t\tout = [];\n\n\t\telse if ( ! room_user?.emote_sets )\n\t\t\tout = room.emote_sets ? room.emote_sets._cache : [];\n\n\t\telse if ( ! room.emote_sets )\n\t\t\tout = room_user.emote_sets._cache;\n\n\t\telse\n\t\t\tout = room_user.emote_sets._cache.concat(room.emote_sets._cache);\n\n\t\t// Shared Chats\n\t\tif ( room?.shared_chats?.size > 0 )\n\t\t\tfor(const shared_id of room.shared_chats) {\n\t\t\t\tconst shared_room = this.parent.getRoom(shared_id, null, true),\n\t\t\t\t\tshared_user = shared_room && shared_room.getUser(user_id, user_login, true);\n\n\t\t\t\tif ( shared_user?.emote_sets?._cache )\n\t\t\t\t\tout = out.concat(shared_user.emote_sets._cache);\n\n\t\t\t\tif ( shared_room?.emote_sets?._cache )\n\t\t\t\t\tout = out.concat(shared_room.emote_sets._cache);\n\t\t\t}\n\n\t\treturn out;\n\t}\n\n\tgetRoomSets(user_id, user_login, room_id, room_login) {\n\t\treturn this.getRoomSetIDs(user_id, user_login, room_id, room_login)\n\t\t\t.map(set_id => this.emote_sets[set_id]);\n\t}\n\n\tgetGlobalSetIDsWithSources(user_id, user_login) {\n\t\tconst user = this.parent.getUser(user_id, user_login, true),\n\t\t\tout = [], seen = new Set;\n\n\t\tthis._withSources(out, seen, this.default_sets);\n\t\tif ( user )\n\t\t\tthis._withSources(out, seen, user.emote_sets);\n\n\t\tif ( this.bulk.size ) {\n\t\t\tconst str_user = String(user_id);\n\t\t\tfor(const [set_id, users] of this.bulk) {\n\t\t\t\tif ( ! seen.has(set_id) && users?._cache.has(str_user) ) {\n\t\t\t\t\tfor(const [provider, data] of users._sources) {\n\t\t\t\t\t\tif ( data && data.includes(str_user) ) {\n\t\t\t\t\t\t\tout.push([set_id, provider, null]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tgetGlobalSetsWithSources(user_id, user_login) {\n\t\treturn this.getGlobalSetIDsWithSources(user_id, user_login)\n\t\t\t.map(([set_id, source]) => [this.emote_sets[set_id], source, null]);\n\t}\n\n\n\tgetSubSetIDsWithSources() {\n\t\tconst out = [], seen = new Set;\n\n\t\tthis._withSources(out, seen, this.sub_sets);\n\n\t\treturn out;\n\t}\n\n\tgetSubSetsWithSources() {\n\t\treturn this.getSubSetIDsWithSources()\n\t\t\t.map(([set_id, source]) => [this.emote_sets[set_id], source, null]);\n\t}\n\n\n\tgetGlobalSetIDs(user_id, user_login) {\n\t\tconst user = this.parent.getUser(user_id, user_login, true);\n\n\t\tconst out = (user?.emote_sets ? user.emote_sets._cache : []).concat(\n\t\t\tthis.default_sets._cache\n\t\t);\n\n\t\tif ( this.bulk.size ) {\n\t\t\tconst str_user = String(user_id);\n\t\t\tfor(const [set_id, users] of this.bulk) {\n\t\t\t\tif ( users?._cache.has(str_user) )\n\t\t\t\t\tout.push(set_id);\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\n\t}\n\n\tgetGlobalSets(user_id, user_login) {\n\t\treturn this.getGlobalSetIDs(user_id, user_login)\n\t\t\t.map(set_id => this.emote_sets[set_id]);\n\t}\n\n\tgetEmotes(user_id, user_login, room_id, room_login) {\n\t\tconst emotes = {};\n\t\tfor(const emote_set of this.getSets(user_id, user_login, room_id, room_login))\n\t\t\tif ( emote_set && emote_set.emotes )\n\t\t\t\tfor(const emote of Object.values(emote_set.emotes) )\n\t\t\t\t\tif ( emote && ! has(emotes, emote.name) )\n\t\t\t\t\t\temotes[emote.name] = emote;\n\n\t\treturn emotes;\n\t}\n\n\t// ========================================================================\n\t// Bulk Management\n\t// ========================================================================\n\n\tsetBulk(source, set_id, entries) {\n\t\tlet set = this.bulk.get(set_id);\n\t\tif ( ! set )\n\t\t\tthis.bulk.set(set_id, set = new SourcedSet(true));\n\n\t\tconst size = set._cache.size;\n\t\tset.set(source, entries);\n\t\tconst new_size = set._cache.size;\n\n\t\tif ( ! size && new_size )\n\t\t\tthis.refSet(set_id);\n\t}\n\n\tdeleteBulk(source, set_id) {\n\t\tconst set = this.bulk.get(set_id);\n\t\tif ( ! set )\n\t\t\treturn;\n\n\t\tconst size = set._cache.size;\n\t\tset.delete(source);\n\t\tconst new_size = set._cache.size;\n\n\t\tif ( size && ! new_size )\n\t\t\tthis.unrefSet(set_id);\n\t}\n\n\textendBulk(source, set_id, entries) {\n\t\tlet set = this.bulk.get(set_id);\n\t\tif ( ! set )\n\t\t\tthis.bulk.set(set_id, set = new SourcedSet(true));\n\n\t\tif ( ! Array.isArray(entries) )\n\t\t\tentries = [entries];\n\n\t\tconst size = set._cache.size;\n\t\tset.extend(source, ...entries);\n\t\tconst new_size = set._cache.size;\n\n\t\tif ( ! size && new_size )\n\t\t\tthis.refSet(set_id);\n\t}\n\n\t// ========================================================================\n\t// Emote Set Ref Counting\n\t// ========================================================================\n\n\taddDefaultSet(provider, set_id, data) {\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tlet changed = false, added = false;\n\t\tif ( ! this.default_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tchanged = ! this.default_sets.includes(set_id);\n\t\t\tthis.default_sets.push(provider, set_id);\n\t\t\tadded = true;\n\t\t}\n\n\t\tif ( data )\n\t\t\tthis.loadSetData(set_id, data);\n\n\t\tif ( changed ) {\n\t\t\tthis.refSet(set_id);\n\t\t\tthis.emit(':update-default-sets', provider, set_id, true);\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tremoveDefaultSet(provider, set_id) {\n\t\tif ( ! set_id ) {\n\t\t\tconst sets = this.default_sets.get(provider);\n\t\t\tif ( sets )\n\t\t\t\tfor(const set_id of Array.from(sets))\n\t\t\t\t\tthis.removeDefaultSet(provider, set_id);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tif ( this.default_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tthis.default_sets.remove(provider, set_id);\n\t\t\tif ( ! this.default_sets.includes(set_id) ) {\n\t\t\t\tthis.unrefSet(set_id);\n\t\t\t\tthis.emit(':update-default-sets', provider, set_id, false);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\taddSubSet(provider, set_id, data) {\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tlet changed = false, added = false;\n\t\tif ( ! this.sub_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tchanged = ! this.sub_sets.includes(set_id);\n\t\t\tthis.sub_sets.push(provider, set_id);\n\t\t\tadded = true;\n\t\t}\n\n\t\tif ( data )\n\t\t\tthis.loadSetData(set_id, data);\n\n\t\tif ( changed ) {\n\t\t\tthis.refSet(set_id);\n\t\t\tthis.emit(':update-sub-sets', provider, set_id, true);\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tremoveSubSet(provider, set_id) {\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tif ( this.sub_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tthis.sub_sets.remove(provider, set_id);\n\t\t\tif ( ! this.sub_sets.includes(set_id) ) {\n\t\t\t\tthis.unrefSet(set_id);\n\t\t\t\tthis.emit(':update-sub-sets', provider, set_id, false);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\trefSet(set_id) {\n\t\tthis._set_refs[set_id] = (this._set_refs[set_id] || 0) + 1;\n\t\tif ( this._set_timers[set_id] ) {\n\t\t\tclearTimeout(this._set_timers[set_id]);\n\t\t\tthis._set_timers[set_id] = null;\n\t\t}\n\t}\n\n\tunrefSet(set_id) {\n\t\tconst c = this._set_refs[set_id] = (this._set_refs[set_id] || 1) - 1;\n\t\tif ( c <= 0 && ! this._set_timers[set_id] )\n\t\t\tthis._set_timers[set_id] = setTimeout(() => this.unloadSet(set_id), 5000);\n\t}\n\n\n\t// ========================================================================\n\t// Emote Set Loading\n\t// ========================================================================\n\n\tasync loadGlobalSets(tries = 0) {\n\t\tthis.load_tracker.schedule('chat-data', 'ffz-global');\n\n\t\tlet response, data;\n\n\t\tif ( this.experiments.getAssignment('api_load') && tries < 1 )\n\t\t\ttry {\n\t\t\t\tfetch(`${NEW_API}/v1/set/global`).catch(() => {});\n\t\t\t} catch(err) { /* do nothing */ }\n\n\t\ttry {\n\t\t\tresponse = await fetch(`${this.staging.api}/v1/set/global/ids`)\n\t\t} catch(err) {\n\t\t\ttries++;\n\t\t\tif ( tries < 10 )\n\t\t\t\treturn setTimeout(() => this.loadGlobalSets(tries), 500 * tries);\n\n\t\t\tthis.log.error('Error loading global emote sets.', err);\n\t\t\tthis.load_tracker.notify('chat-data', 'ffz-global', false);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! response.ok ) {\n\t\t\tthis.load_tracker.notify('chat-data', 'ffz-global', false);\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tdata = await response.json();\n\t\t} catch(err) {\n\t\t\tthis.log.error('Error parsing global emote data.', err);\n\t\t\tthis.load_tracker.notify('chat-data', 'ffz-global', false);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst sets = data.sets || {};\n\n\t\t// Remove existing global sets, in case we have any.\n\t\tthis.removeDefaultSet('ffz-global');\n\n\t\tfor(const set_id of data.default_sets)\n\t\t\tthis.addDefaultSet('ffz-global', set_id);\n\n\t\tfor(const set_id in sets)\n\t\t\tif ( has(sets, set_id) ) {\n\t\t\t\tconst id = sets[set_id]?.id;\n\t\t\t\tthis.loadSetData(set_id, sets[set_id]);\n\t\t\t\tif ( id && ! data.default_sets.includes(id) )\n\t\t\t\t\tthis.addSubSet('ffz-global', set_id);\n\t\t\t}\n\n\t\tif ( data.user_ids )\n\t\t\tthis.loadSetUserIds(data.user_ids);\n\t\telse if ( data.users )\n\t\t\tthis.loadSetUsers(data.users);\n\n\t\tthis.load_tracker.notify('chat-data', 'ffz-global');\n\t\treturn true;\n\t}\n\n\n\tasync loadSet(set_id, suppress_log = false, tries = 0) {\n\t\tconst load_key = `ffz-${set_id}`;\n\t\tthis.load_tracker.schedule('chat-data', load_key);\n\t\tlet response, data;\n\n\t\tif ( this.experiments.getAssignment('api_load') )\n\t\t\ttry {\n\t\t\t\tfetch(`${NEW_API}/v1/set/${set_id}`).catch(() => {});\n\t\t\t} catch(err) { /* do nothing */ }\n\n\t\ttry {\n\t\t\tresponse = await fetch(`${this.staging.api}/v1/set/${set_id}${this.staging.active ? '/ids' : ''}`)\n\t\t} catch(err) {\n\t\t\ttries++;\n\t\t\tif ( tries < 10 )\n\t\t\t\treturn setTimeout(() => this.loadGlobalSets(tries), 500 * tries);\n\n\t\t\tthis.log.error(`Error loading data for set \"${set_id}\".`, err);\n\t\t\tthis.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! response.ok ) {\n\t\t\tthis.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tdata = await response.json();\n\t\t} catch(err) {\n\t\t\tthis.log.error(`Error parsing data for set \"${set_id}\".`, err);\n\t\t\tthis.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst set = data.set;\n\t\tif ( set )\n\t\t\tthis.loadSetData(set.id, set, suppress_log);\n\n\t\tif ( data.user_ids )\n\t\t\tthis.loadSetUserIds(data.user_ids);\n\t\telse if ( data.users )\n\t\t\tthis.loadSetUsers(data.users);\n\n\t\tthis.load_tracker.notify('chat-data', load_key, true);\n\t\treturn true;\n\t}\n\n\n\tloadSetUserIds(data, suppress_log = false) {\n\t\tfor(const set_id in data)\n\t\t\tif ( has(data, set_id) ) {\n\t\t\t\tconst emote_set = this.emote_sets[set_id],\n\t\t\t\t\tusers = data[set_id];\n\n\t\t\t\tthis.setBulk('ffz-global', set_id, users.map(x => String(x)));\n\t\t\t\tif ( ! suppress_log )\n\t\t\t\t\tthis.log.info(`Added \"${emote_set ? emote_set.title : set_id}\" emote set to ${users.length} users.`);\n\t\t\t}\n\t}\n\n\n\tloadSetUsers(data, suppress_log = false) {\n\t\tfor(const set_id in data)\n\t\t\tif ( has(data, set_id) ) {\n\t\t\t\tconst emote_set = this.emote_sets[set_id],\n\t\t\t\t\tusers = data[set_id];\n\n\t\t\t\tfor(const login of users)\n\t\t\t\t\tthis.parent.getUser(undefined, login)\n\t\t\t\t\t\t.addSet('ffz-global', set_id);\n\n\t\t\t\tif ( ! suppress_log )\n\t\t\t\t\tthis.log.info(`Added \"${emote_set ? emote_set.title : set_id}\" emote set to ${users.length} users.`);\n\t\t\t}\n\t}\n\n\n\tprocessEmote(emote, set_id) {\n\t\tif ( ! emote.id || ! emote.name || ! emote.urls )\n\t\t\treturn null;\n\n\t\temote.set_id = set_id;\n\t\temote.src = emote.urls[1];\n\t\temote.srcSet = `${emote.urls[1]} 1x`;\n\t\tif ( emote.urls[2] )\n\t\t\temote.srcSet += `, ${emote.urls[2]} 2x`;\n\t\tif ( emote.urls[4] )\n\t\t\temote.srcSet += `, ${emote.urls[4]} 4x`;\n\n\t\tif ( emote.urls[2] ) {\n\t\t\temote.can_big = true;\n\t\t\temote.src2 = emote.urls[2];\n\t\t\temote.srcSet2 = `${emote.urls[2]} 1x`;\n\t\t\tif ( emote.urls[4] )\n\t\t\t\temote.srcSet2 += `, ${emote.urls[4]} 2x`;\n\t\t}\n\n\t\tif ( emote.animated?.[1] ) {\n\t\t\temote.animSrc = emote.animated[1];\n\t\t\temote.animSrcSet = `${emote.animated[1]} 1x`;\n\t\t\tif ( emote.animated[2] ) {\n\t\t\t\temote.animSrcSet += `, ${emote.animated[2]} 2x`;\n\t\t\t\temote.animSrc2 = emote.animated[2];\n\t\t\t\temote.animSrcSet2 = `${emote.animated[2]} 1x`;\n\n\t\t\t\tif ( emote.animated[4] ) {\n\t\t\t\t\temote.animSrcSet += `, ${emote.animated[4]} 4x`;\n\t\t\t\t\temote.animSrcSet2 += `, ${emote.animated[4]} 2x`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check to see if this emote applies any effects with as_background.\n\t\t/*let as_background = false;\n\t\tif ( emote.modifier_flags ) {\n\t\t\tfor(const input of EFFECT_STYLES)\n\t\t\t\tif ( (emote.modifier_flags & input.flags) === input.flags ) {\n\t\t\t\t\tif ( input.as_background ) {\n\t\t\t\t\t\tas_background = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}*/\n\n\t\temote.token = {\n\t\t\ttype: 'emote',\n\t\t\tid: emote.id,\n\t\t\tset: set_id,\n\t\t\tprovider: 'ffz',\n\t\t\tsrc: emote.src,\n\t\t\tsrcSet: emote.srcSet,\n\t\t\tcan_big: !! emote.urls[2],\n\t\t\tsrc2: emote.src2,\n\t\t\tsrcSet2: emote.srcSet2,\n\t\t\tanimSrc: emote.animSrc,\n\t\t\tanimSrcSet: emote.animSrcSet,\n\t\t\tanimSrc2: emote.animSrc2,\n\t\t\tanimSrcSet2: emote.animSrcSet2,\n\t\t\tmasked: !! emote.mask,\n\t\t\tmod: emote.modifier,\n\t\t\tmod_prefix: emote.modifier_prefix,\n\t\t\tmod_hidden: (emote.modifier_flags & 1) === 1,\n\t\t\ttext: emote.hidden ? '???' : emote.name,\n\t\t\tlength: emote.name.length,\n\t\t\theight: emote.height,\n\t\t\twidth: emote.width,\n\t\t\tsource_modifier_flags: emote.modifier_flags ?? 0,\n\t\t\t//effect_bg: as_background\n\t\t};\n\n\t\tif ( has(MODIFIERS, emote.id) )\n\t\t\tObject.assign(emote, MODIFIERS[emote.id]);\n\n\t\treturn emote;\n\t}\n\n\n\taddEmoteToSet(set_id, emote) {\n\t\tconst set = this.emote_sets[set_id];\n\t\tif ( ! set )\n\t\t\tthrow new Error(`Invalid emote set \"${set_id}\"`);\n\n\t\tlet processed = this.processEmote(emote, set_id);\n\t\tif ( ! processed )\n\t\t\tthrow new Error(\"Invalid emote data object.\");\n\n\t\tconst is_disabled = this.shouldFilterEmote(processed, set, set_id);\n\n\t\t// Possible logic paths:\n\t\t// 1. No old emote. New emote accepted.\n\t\t// 2. No old emote. New emote disabled.\n\t\t// 3. Old emote. New emote accepted.\n\t\t// 4. Old emote. New emote disabled.\n\t\t// 5. Old emote disabled. New emote accepted.\n\t\t// 6. Old emote disabled. New emote disabled.\n\n\t\t// Are we removing a disabled emote?\n\t\tlet removed = set.disabled_emotes[processed.id];\n\t\tif ( removed ) {\n\t\t\tdelete set.disabled_emotes[processed.id];\n\t\t\tset.disabled_count--;\n\t\t}\n\n\t\t// Are we removing an existing emote?\n\t\tconst old_emote = set.emotes[processed.id],\n\t\t\told_css = old_emote && this.generateEmoteCSS(old_emote);\n\n\t\t// Store the emote.\n\t\tif ( is_disabled ) {\n\t\t\tset.disabled_emotes[processed.id] = processed;\n\t\t\tset.disabled_count++;\n\n\t\t\t// If there was an old emote, we need to decrement\n\t\t\t// the use count and remove it from the emote list.\n\t\t\tif ( old_emote ) {\n\t\t\t\tconst new_emotes = {};\n\t\t\t\tlet count = 0;\n\n\t\t\t\tfor(const em of Object.values(set.emotes)) {\n\t\t\t\t\tif ( em.id == processed.id )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tnew_emotes[em.id] = em;\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\n\t\t\t\tset.emotes = new_emotes;\n\t\t\t\tset.count = count;\n\n\t\t\t} else {\n\t\t\t\t// If there was no old emote, then we can stop now.\n\t\t\t\treturn processed;\n\t\t\t}\n\n\t\t} else {\n\t\t\t// Not disabled. This is a live emote.\n\t\t\tset.emotes[processed.id] = processed;\n\n\t\t\t// If there was no old emote, update the set count.\n\t\t\tif ( ! old_emote )\n\t\t\t\tset.count++;\n\t\t}\n\n\t\t// Now we need to update the CSS. If we had old emote CSS, then we\n\t\t// will need to totally rebuild the CSS.\n\t\tconst style_key = `es--${set_id}`;\n\n\t\t// Rebuild the full CSS if we have an old emote.\n\t\tif ( old_css && old_css.length ) {\n\t\t\tconst css = [];\n\t\t\tfor(const em of Object.values(set.emotes)) {\n\t\t\t\tconst emote_css = this.generateEmoteCSS(em);\n\t\t\t\tif ( emote_css && emote_css.length )\n\t\t\t\t\tcss.push(emote_css);\n\t\t\t}\n\n\t\t\tif ( this.style && (css.length || set.css) )\n\t\t\t\tthis.style.set(style_key, css.join('') + (set.css || ''));\n\t\t\telse if ( css.length )\n\t\t\t\tset.pending_css = css.join('');\n\n\t\t} else if ( ! is_disabled ) {\n\t\t\t// If there wasn't an old emote, only add our CSS if the emote\n\t\t\t// isn't disabled.\n\t\t\tconst emote_css = this.generateEmoteCSS(processed);\n\t\t\tif ( emote_css && emote_css.length ) {\n\t\t\t\tif ( this.style )\n\t\t\t\t\tthis.style.set(style_key, (this.style.get(style_key) || '') + emote_css);\n\t\t\t\telse\n\t\t\t\t\tset.pending_css = (set.pending_css || '') + emote_css;\n\t\t\t}\n\t\t}\n\n\t\t// Send a loaded event because this emote set changed.\n\t\tthis.emit(':loaded', set_id, set);\n\n\t\t// Return the processed emote object.\n\t\treturn processed;\n\t}\n\n\n\tremoveEmoteFromSet(set_id, emote_id) {\n\t\tconst set = this.emote_sets[set_id];\n\t\tif ( ! set )\n\t\t\tthrow new Error(`Invalid emote set \"${set_id}\"`);\n\n\t\tif ( emote_id && emote_id.id )\n\t\t\temote_id = emote_id.id;\n\n\t\t// If the emote was present but disabled, just return it\n\t\t// without having to do most of our logic.\n\t\tconst removed = set.disabled_emotes?.[emote_id];\n\t\tif ( removed ) {\n\t\t\tset.disabled_count--;\n\t\t\tdelete set.disabled_emotes[emote_id];\n\t\t\treturn removed;\n\t\t}\n\n\t\tconst emote = set.emotes[emote_id];\n\t\tif ( ! emote )\n\t\t\treturn;\n\n\t\tconst emote_css = this.generateEmoteCSS(emote);\n\t\tconst css = (emote_css && emote_css.length) ? [] : null;\n\n\t\t// Rebuild the emotes object to avoid gaps.\n\t\tconst new_emotes = {};\n\t\tlet count = 0;\n\n\t\tfor(const em of Object.values(set.emotes)) {\n\t\t\tif ( em.id == emote_id )\n\t\t\t\tcontinue;\n\n\t\t\tnew_emotes[em.id] = em;\n\t\t\tcount++;\n\n\t\t\tif ( css != null) {\n\t\t\t\tconst em_css = this.generateEmoteCSS(em);\n\t\t\t\tif ( em_css && em_css.length )\n\t\t\t\t\tcss.push(em_css);\n\t\t\t}\n\t\t}\n\n\t\tset.emotes = new_emotes;\n\t\tset.count = count;\n\n\t\tif ( css != null ) {\n\t\t\tconst style_key = `es--${set_id}`;\n\t\t\tif ( this.style && (css.length || set.css) )\n\t\t\t\tthis.style.set(style_key, css.join('') + (set.css || ''));\n\t\t\telse if ( css.length )\n\t\t\t\tset.pending_css = css.join('');\n\t\t}\n\n\t\t// Send a loaded event because this emote set changed.\n\t\tthis.emit(':loaded', set_id, set);\n\n\t\t// Return the removed emote.\n\t\treturn emote;\n\t}\n\n\n\tloadSetData(set_id, data, suppress_log = false) {\n\t\tconst old_set = this.emote_sets[set_id];\n\t\tif ( ! data ) {\n\t\t\tif ( old_set ) {\n\t\t\t\tif ( this.style )\n\t\t\t\t\tthis.style.delete(`es--${set_id}`);\n\t\t\t\tthis.emote_sets[set_id] = null;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emote_sets[set_id] = data;\n\n\t\tlet count = 0,\n\t\t\tfcount = 0;\n\t\tconst ems = data.emotes || data.emoticons,\n\t\t\tnew_ems = data.emotes = {},\n\t\t\tfiltered = data.disabled_emotes = {},\n\t\t\tcss = [];\n\n\t\tdata.id = set_id;\n\t\tdata.emoticons = undefined;\n\n\t\tconst bad_emotes = [];\n\n\t\tfor(const emote of ems) {\n\t\t\tlet processed = this.processEmote(emote, set_id);\n\t\t\tif ( ! processed ) {\n\t\t\t\tbad_emotes.push(emote);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( this.shouldFilterEmote(processed, data, set_id) ) {\n\t\t\t\tfiltered[processed.id] = processed;\n\t\t\t\tfcount++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst emote_css = this.generateEmoteCSS(processed);\n\t\t\tif ( emote_css )\n\t\t\t\tcss.push(emote_css);\n\n\t\t\tcount++;\n\t\t\tnew_ems[processed.id] = processed;\n\t\t}\n\n\t\tif ( bad_emotes.length )\n\t\t\tthis.log.warn(`Bad Emote Data for Set #${set_id}`, bad_emotes);\n\n\t\tdata.count = count;\n\t\tdata.disabled_count = fcount;\n\n\t\tif ( this.style && (css.length || data.css) )\n\t\t\tthis.style.set(`es--${set_id}`, css.join('') + (data.css || ''));\n\t\telse if ( css.length )\n\t\t\tdata.pending_css = css.join('');\n\n\t\tif ( ! suppress_log )\n\t\t\tthis.log.info(`Loaded emote set #${set_id}: ${data.title} (${count} emotes, ${fcount} filtered)`);\n\n\t\tthis.emit(':loaded', set_id, data);\n\n\t\t// Don't let people endlessly load unused sets.\n\t\tconst refs = this._set_refs[set_id] || 0;\n\t\tif ( refs <= 0 && ! this._set_timers[set_id] )\n\t\t\tthis._set_timers[set_id] = setTimeout(() => this.unloadSet(set_id), 5000);\n\t}\n\n\n\tunloadSet(set_id, force = false, suppress_log = false) {\n\t\tconst old_set = this.emote_sets[set_id],\n\t\t\tcount = this._set_refs[set_id] || 0;\n\n\t\tif ( ! old_set )\n\t\t\treturn;\n\n\t\tif ( count > 0 ) {\n\t\t\tif ( ! force )\n\t\t\t\treturn this.log.warn(`Attempted to unload emote set #${set_id} with ${count} users.`);\n\t\t\tthis.log.warn(`Unloading emote set ${set_id} with ${count} users.`);\n\t\t}\n\n\t\tif ( ! suppress_log )\n\t\t\tthis.log.info(`Unloaded emote set #${set_id}: ${old_set.title}`);\n\n\t\tif ( this._set_timers[set_id] ) {\n\t\t\tclearTimeout(this._set_timers[set_id]);\n\t\t\tthis._set_timers[set_id] = null;\n\t\t}\n\n\t\tthis.emit(':unloaded', set_id, old_set);\n\t\tthis.emote_sets[set_id] = null;\n\t}\n\n\n\t// ========================================================================\n\t// Emote CSS\n\t// ========================================================================\n\n\tgenerateEmoteCSS(emote) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! emote.mask && ! emote.margins && ( ! emote.modifier || ( ! emote.modifier_offset && ! emote.extra_width && ! emote.shrink_to_fit ) ) && ! emote.css )\n\t\t\treturn '';\n\n\t\tlet output = '';\n\t\tif ( emote.modifier && (emote.modifier_offset || emote.margins || emote.extra_width || emote.shrink_to_fit) ) {\n\t\t\tlet margins = emote.modifier_offset || emote.margins || '0';\n\t\t\tmargins = margins.split(/\\s+/).map(x => parseInt(x, 10));\n\t\t\tif ( margins.length === 3 )\n\t\t\t\tmargins.push(margins[1]);\n\n\t\t\tconst l = margins.length,\n\t\t\t\tm_top = margins[0 % l],\n\t\t\t\tm_right = margins[1 % l],\n\t\t\t\tm_bottom = margins[2 % l],\n\t\t\t\tm_left = margins[3 % l];\n\n\t\t\toutput = `.modified-emote span .ffz-emote[data-id=\"${emote.id}\"] {\n\tpadding: ${m_top}px ${m_right}px ${m_bottom}px ${m_left}px;\n\t${emote.shrink_to_fit ? `max-width: calc(100% - ${40 - m_left - m_right - (emote.extra_width||0)}px);` : ''}\n\tmargin: 0 !important;\n}`;\n\t\t}\n\n\t\tif ( emote.modifier && emote.mask?.[1] ) {\n\t\t\toutput = (output || '') + `.modified-emote[data-modifiers~=\"${emote.id}\"] > .chat-line__message--emote {\n\t-webkit-mask-image: url(\"${emote.mask[1]}\");\n\t-webkit-mask-position: center center;\n}`\n\t\t}\n\n\t\treturn `${output}.ffz-emote[data-id=\"${emote.id}\"] {\n\t${(emote.margins && ! emote.modifier) ? `margin: ${emote.margins} !important;` : ''}\n\t${emote.css||''}\n}`;\n\t}\n\n\n\t// ========================================================================\n\t// Twitch Data Lookup\n\t// ========================================================================\n\n\tsetTwitchEmoteSet(emote_id, set_id) {\n\t\tif ( typeof emote_id === 'number' ) {\n\t\t\tif ( isNaN(emote_id) || ! isFinite(emote_id) )\n\t\t\t\treturn;\n\t\t\temote_id = `${emote_id}`;\n\t\t}\n\n\t\tif ( typeof set_id === 'number' ) {\n\t\t\tif ( isNaN(set_id) || ! isFinite(set_id) )\n\t\t\t\treturn;\n\t\t\tset_id = `${set_id}`;\n\t\t}\n\n\t\tthis.__twitch_emote_to_set[emote_id] = set_id;\n\t}\n\n\tsetTwitchSetChannel(set_id, channel) {\n\t\tif ( typeof set_id === 'number' ) {\n\t\t\tif ( isNaN(set_id) || ! isFinite(set_id) )\n\t\t\t\treturn;\n\n\t\t\tset_id = `${set_id}`;\n\t\t}\n\n\t\tthis.__twitch_set_to_channel[set_id] = channel;\n\t}\n\n\t_getTwitchEmoteSet(emote_id, need_artist = false) {\n\t\tconst tes = this.__twitch_emote_to_set,\n\t\t\ttsc = this.__twitch_set_to_channel,\n\t\t\ttsa = this.__twitch_emote_to_artist;\n\n\t\tif ( typeof emote_id === 'number' ) {\n\t\t\tif ( isNaN(emote_id) || ! isFinite(emote_id) )\n\t\t\t\treturn Promise.resolve(null);\n\n\t\t\temote_id = `${emote_id}`;\n\t\t}\n\n\t\tif ( has(tes, emote_id) && (! need_artist || has(tsa, emote_id)) ) {\n\t\t\tconst val = tes[emote_id];\n\t\t\tif ( Array.isArray(val) )\n\t\t\t\treturn new Promise(s => val.push(s));\n\t\t\telse\n\t\t\t\treturn Promise.resolve(val);\n\t\t}\n\n\t\tconst apollo = this.resolve('site.apollo');\n\t\tif ( ! apollo?.client )\n\t\t\treturn Promise.resolve(null);\n\n\t\treturn new Promise(s => {\n\t\t\tconst promises = [s];\n\t\t\ttes[emote_id] = promises;\n\n\t\t\ttimeout(apollo.client.query({\n\t\t\t\tquery: GET_EMOTE,\n\t\t\t\tvariables: {\n\t\t\t\t\tid: `${emote_id}`\n\t\t\t\t}\n\t\t\t}), 2000).then(data => {\n\t\t\t\tconst emote = data?.data?.emote;\n\t\t\t\tlet set_id = null;\n\n\t\t\t\tif ( emote ) {\n\t\t\t\t\tset_id = emote.setID;\n\n\t\t\t\t\tif ( emote.id && ! has(tsa, emote.id) ) {\n\t\t\t\t\t\ttsa[emote.id] = emote.artist;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( set_id && ! has(tsc, set_id) ) {\n\t\t\t\t\t\tconst type = determineEmoteType(emote);\n\n\t\t\t\t\t\ttsc[set_id] = {\n\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\towner: emote?.subscriptionProduct?.owner || emote?.owner\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttes[emote_id] = set_id;\n\t\t\t\tfor(const fn of promises)\n\t\t\t\t\tfn(set_id);\n\n\t\t\t}).catch(() => {\n\t\t\t\ttes[emote_id] = null;\n\t\t\t\tfor(const fn of promises)\n\t\t\t\t\tfn(null);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTwitchEmoteSet(emote_id, callback) {\n\t\tconst promise = this._getTwitchEmoteSet(emote_id);\n\t\tif ( callback )\n\t\t\tpromise.then(callback);\n\t\telse\n\t\t\treturn promise;\n\t}\n\n\t_getTwitchEmoteArtist(emote_id) {\n\t\tconst tsa = this.__twitch_emote_to_artist;\n\n\t\tif ( has(tsa, emote_id) )\n\t\t\treturn Promise.resolve(tsa[emote_id]);\n\n\t\treturn this._getTwitchEmoteSet(emote_id, true)\n\t\t\t.then(() => tsa[emote_id])\n\t\t\t.catch(() => {\n\t\t\t\ttsa[emote_id] = null;\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\tgetTwitchEmoteArtist(emote_id, callback) {\n\t\tconst promise = this._getTwitchEmoteArtist(emote_id);\n\t\tif ( callback )\n\t\t\tpromise.then(callback);\n\t\telse\n\t\t\treturn promise;\n\t}\n\n\n\t_getTwitchSetChannel(set_id) {\n\t\tconst tsc = this.__twitch_set_to_channel;\n\n\t\tif ( typeof set_id === 'number' ) {\n\t\t\tif ( isNaN(set_id) || ! isFinite(set_id) )\n\t\t\t\treturn Promise.resolve(null);\n\n\t\t\tset_id = `${set_id}`;\n\t\t}\n\n\t\tif ( has(tsc, set_id) ) {\n\t\t\tconst val = tsc[set_id];\n\t\t\tif ( Array.isArray(val) )\n\t\t\t\treturn new Promise(s => val.push(s));\n\t\t\telse\n\t\t\t\treturn Promise.resolve(val);\n\t\t}\n\n\t\tconst apollo = this.resolve('site.apollo');\n\t\tif ( ! apollo?.client )\n\t\t\treturn Promise.resolve(null);\n\n\t\treturn new Promise(s => {\n\t\t\tconst promises = [s];\n\t\t\ttsc[set_id] = promises;\n\n\t\t\ttimeout(apollo.client.query({\n\t\t\t\tquery: GET_EMOTE_SET,\n\t\t\t\tvariables: {\n\t\t\t\t\tid: `${set_id}`\n\t\t\t\t}\n\t\t\t}), 2000).then(data => {\n\t\t\t\tconst set = data?.data?.emoteSet;\n\t\t\t\tlet result = null;\n\n\t\t\t\tif ( set ) {\n\t\t\t\t\tresult = {\n\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\ttype: determineSetType(set),\n\t\t\t\t\t\towner: set.owner ? {\n\t\t\t\t\t\t\tid: set.owner.id,\n\t\t\t\t\t\t\tlogin: set.owner.login,\n\t\t\t\t\t\t\tdisplayName: set.owner.displayName\n\t\t\t\t\t\t} : null\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\ttsc[set_id] = result;\n\t\t\t\tfor(const fn of promises)\n\t\t\t\t\tfn(result);\n\n\t\t\t}).catch(() => {\n\t\t\t\ttsc[set_id] = null;\n\t\t\t\tfor(const fn of promises)\n\t\t\t\t\tfn(null);\n\t\t\t});\n\t\t});\n\t}\n\n\n\tgetTwitchSetChannel(set_id, callback) {\n\t\tconst promise = this._getTwitchSetChannel(set_id);\n\t\tif ( callback )\n\t\t\tpromise.then(callback);\n\t\telse\n\t\t\treturn promise;\n\t}\n}\n\n\nfunction determineEmoteType(emote) {\n\tconst product = emote.subscriptionProduct;\n\tif ( product ) {\n\t\tif ( product.id == 12658 )\n\t\t\treturn EmoteTypes.Prime;\n\t\telse if ( product.id == 324 )\n\t\t\treturn EmoteTypes.Turbo;\n\n\t\t// TODO: Care about Overwatch League\n\n\t\tconst owner = product.owner;\n\t\tif ( owner ) {\n\t\t\tif ( owner.id == 139075904 || product.state === 'INACTIVE' )\n\t\t\t\treturn EmoteTypes.LimitedTime;\n\n\t\t\treturn EmoteTypes.Subscription;\n\t\t}\n\t}\n\n\tif ( emote.setID == 300238151 )\n\t\treturn EmoteTypes.ChannelPoints;\n\n\tif ( emote.setID == 300374282 )\n\t\treturn EmoteTypes.TwoFactor;\n\n\tconst id = parseInt(emote.setID, 10);\n\tif ( ! isNaN(id) && isFinite(id) && id >= 5e8 )\n\t\treturn EmoteTypes.BitsTier;\n\n\treturn EmoteTypes.Global;\n}\n\n\nfunction determineSetType(set) {\n\tconst id = /^\\d+$/.test(set.id) ? parseInt(set.id, 10) : null;\n\n\tif ( id && TWITCH_GLOBAL_SETS.includes(id) )\n\t\treturn EmoteTypes.Global;\n\n\tif ( id && TWITCH_POINTS_SETS.includes(id) )\n\t\treturn EmoteTypes.ChannelPoints;\n\n\tif ( id && TWITCH_PRIME_SETS.includes(id) )\n\t\treturn EmoteTypes.Prime;\n\n\tif ( id == 300374282 )\n\t\treturn EmoteTypes.TwoFactor;\n\n\tconst owner = set.owner;\n\tif ( owner ) {\n\t\tif ( owner.id == 139075904 )\n\t\t\treturn EmoteTypes.LimitedTime;\n\n\t\tlet product;\n\t\tif ( Array.isArray(owner.subscriptionProducts) )\n\t\t\tfor(const prod of owner.subscriptionProducts)\n\t\t\t\tif ( set.id == prod.emoteSetID ) {\n\t\t\t\t\tproduct = prod;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\tif ( product ) {\n\t\t\tif ( product.id == 12658 )\n\t\t\t\treturn EmoteTypes.Prime;\n\t\t\telse if ( product.id == 324 )\n\t\t\t\treturn EmoteTypes.Turbo;\n\t\t\telse if ( product.state === 'INACTIVE' )\n\t\t\t\treturn EmoteTypes.LimitedTime;\n\t\t}\n\n\t\treturn EmoteTypes.Subscription;\n\t}\n\n\tif ( id >= 5e8 )\n\t\treturn EmoteTypes.BitsTier;\n\n\treturn EmoteTypes.Global;\n}\n","'use strict';\n\n// ============================================================================\n// Chat\n// ============================================================================\n\nimport dayjs from 'dayjs';\n\nimport { DEBUG, LINK_DATA_HOSTS, RESOLVERS_REQUIRE_TOS } from 'utilities/constants';\nimport Module, { buildAddonProxy } from 'utilities/module';\nimport {Color} from 'utilities/color';\nimport {createElement, ManagedStyle} from 'utilities/dom';\nimport {getFontsList} from 'utilities/fonts';\nimport {timeout, has, addWordSeparators, glob_to_regex, escape_regex, split_chars, makeAddonIdChecker, deep_copy, SourcedSet, getTwitchEmoteURL} from 'utilities/object';\n\nimport Badges from './badges';\nimport Emotes from './emotes';\nimport Emoji from './emoji';\nimport Overrides from './overrides';\n\nimport Room from './room';\nimport User from './user';\nimport * as TOKENIZERS from './tokenizers';\nimport * as RICH_PROVIDERS from './rich_providers';\nimport * as LINK_PROVIDERS from './link_providers';\n\nimport Actions from './actions/actions';\n\n\nfunction sortPriorityColorTerms(list) {\n\tlist.sort((a,b) => {\n\t\tif ( a[0] < b[0] ) return 1;\n\t\tif ( a[0] > b[0] ) return -1;\n\t\tif ( ! a[1] && b[1] ) return 1;\n\t\tif ( a[1] && ! b[1] ) return -1;\n\t\treturn 0;\n\t});\n\treturn list;\n}\n\nconst TERM_FLAGS = ['g', 'gi'];\n\nconst UNBLOCKABLE_TOKENS = [\n\t'filter_test'\n];\n\nfunction formatTerms(data) {\n\tconst out = [];\n\n\tfor(let i=0; i < data.length; i++) {\n\t\tconst list = data[i];\n\t\tif ( list[0].length )\n\t\t\tlist[1].push(addWordSeparators(list[0].join('|')));\n\n\t\tout.push(list[1].length ? new RegExp(list[1].join('|'), TERM_FLAGS[i] || 'gi') : null);\n\t}\n\n\treturn out;\n}\n\nconst ERROR_IMAGE = 'https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0';\nconst EMOTE_CHARS = /[ .,!]/;\nconst GIF_TERMS = ['gif emotes', 'gif emoticons', 'gifs'];\n\nexport default class Chat extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('tooltips');\n\t\tthis.inject('experiments');\n\t\tthis.inject('staging');\n\t\tthis.inject('load_tracker');\n\n\t\tthis.inject(Badges);\n\t\tthis.inject(Emotes);\n\t\tthis.inject(Emoji);\n\t\tthis.inject(Actions);\n\t\tthis.inject('overrides', Overrides);\n\n\t\tthis._link_info = {};\n\n\t\t// Bind for JSX stuff\n\t\tthis.clickToReveal = this.clickToReveal.bind(this);\n\t\tthis.handleLinkClick = this.handleLinkClick.bind(this);\n\t\tthis.handleMentionClick = this.handleMentionClick.bind(this);\n\t\tthis.handleReplyClick = this.handleReplyClick.bind(this);\n\n\t\tthis.style = new ManagedStyle;\n\n\t\tthis.context = this.settings.context({});\n\n\t\tthis.CommandPrefixes = new SourcedSet(true);\n\t\tthis.CommandPrefixes.set('ffz', ['/', '!']);\n\n\t\tthis.rooms = {};\n\t\tthis.users = {};\n\n\t\tthis.room_ids = {};\n\t\tthis.user_ids = {};\n\n\t\tthis.tokenizers = {};\n\t\tthis.__tokenizers = [];\n\n\t\tthis.rich_providers = {};\n\t\tthis.__rich_providers = [];\n\n\t\tthis.link_providers = {};\n\t\tthis.__link_providers = [];\n\n\t\tthis._hl_reasons = {};\n\t\tthis.addHighlightReason('mention', 'Mentioned', 'Mention');\n\t\tthis.addHighlightReason('user', 'Highlight User', 'User');\n\t\tthis.addHighlightReason('badge', 'Highlight Badge', 'Badge');\n\t\tthis.addHighlightReason('term', 'Highlight Term', 'Term');\n\n\t\t// ========================================================================\n\t\t// Settings\n\t\t// ========================================================================\n\n\t\t/*this.settings.add('debug.highlight-reason', {\n\t\t\tdefault: [],\n\t\t\ttype: 'basic_array_merge',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Debugging >> General',\n\t\t\t\ttitle: 'Test',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tmultiple: true,\n\t\t\t\tdata: () => this.getHighlightReasons()\n\t\t\t}\n\t\t});*/\n\n\t\tthis.settings.add('debug.link-resolver.source', {\n\t\t\tprocess: (ctx, val) => {\n\t\t\t\treturn LINK_DATA_HOSTS[val] ?? LINK_DATA_HOSTS.Production;\n\t\t\t},\n\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Data Sources >> Links',\n\t\t\t\ttitle: 'Link Resolver',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tforce_seen: true,\n\t\t\t\tdata: [\n\t\t\t\t\t{value: null, title: 'Automatic'},\n\t\t\t\t].concat(Object.entries(LINK_DATA_HOSTS).map(x => ({\n\t\t\t\t\tvalue: x[0],\n\t\t\t\t\ttitle: x[1].title\n\t\t\t\t})))\n\t\t\t},\n\n\t\t\tchanged: () => this.clearLinkCache()\n\t\t});\n\n\t\tthis.settings.addUI('debug.link-resolver.test', {\n\t\t\tpath: 'Debugging > Data Sources >> Links',\n\t\t\tcomponent: 'link-tester',\n\t\t\tgetChat: () => this,\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.add('chat.timestamp-size', {\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> General',\n\t\t\t\ttitle: 'Timestamp Font Size',\n\t\t\t\tdescription: 'How large should timestamps be, in pixels. Defaults to Font Size if not set.',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_int',\n\t\t\t\tbounds: [1]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.font-size', {\n\t\t\tdefault: 13,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> General',\n\t\t\t\ttitle: 'Font Size',\n\t\t\t\tdescription: \"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.\",\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_int',\n\t\t\t\tbounds: [1]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.font-family', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> General',\n\t\t\t\ttitle: 'Font Family',\n\t\t\t\tdescription: 'Set the font used for displaying chat messages.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\tdata: () => getFontsList()\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.name-format', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Usernames',\n\t\t\t\ttitle: 'Display Style',\n\t\t\t\tdescription: 'Change how usernames are displayed in chat when users have an international display name set.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'International Name (Username) <Default>'},\n\t\t\t\t\t{value: 1, title: 'International Name'},\n\t\t\t\t\t{value: 2, title: 'Username'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.lines.emote-alignment', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Emote Alignment',\n\t\t\t\tdescription: 'Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Standard'},\n\t\t\t\t\t{value: 1, title: 'Padded'},\n\t\t\t\t\t{value: 2, title: 'Baseline (BTTV-Like)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.rich.enabled', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Rich Content',\n\t\t\t\ttitle: 'Display rich content in chat.',\n\t\t\t\tdescription: 'This displays rich content blocks for things like linked clips and videos.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.rich.want-mid', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Rich Content',\n\t\t\t\ttitle: 'Display larger rich content in chat.',\n\t\t\t\tdescription: 'This enables the use of bigger rich content embeds in chat. This is **not** recommended for most users and/or chats.\\n\\n**Note:** Enabling this may cause chat to scroll at inopportune times due to content loading. Moderators should not use this feature.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.rich.hide-tokens', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Rich Content',\n\t\t\t\ttitle: 'Hide matching links for rich content.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.rich.all-links', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Rich Content',\n\t\t\t\ttitle: 'Display rich content embeds for all links.',\n\t\t\t\tdescription: '*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\textra: {\n\t\t\t\t\tcomponent: 'chat-rich-example',\n\t\t\t\t\tgetChat: () => this\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.rich.minimum-level', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Rich Content',\n\t\t\t\ttitle: 'Required User Level',\n\t\t\t\tdescription: 'Only display rich content embeds on messages posted by users with this level or higher.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 4, title: 'Broadcaster'},\n\t\t\t\t\t{value: 3, title: 'Moderator'},\n\t\t\t\t\t{value: 2, title: 'VIP'},\n\t\t\t\t\t{value: 1, title: 'Subscriber'},\n\t\t\t\t\t{value: 0, title: 'Everyone'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.scrollback-length', {\n\t\t\tdefault: 150,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Scrollback Length',\n\t\t\t\tdescription: 'Keep up to this many lines in chat. Setting this too high will create lag.',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_int',\n\t\t\t\tbounds: [1]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.debug', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Behavior',\n\t\t\t\ttitle: 'Display a list of highlight reasons on every chat message for debugging.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tforce_seen: true\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.addUI('chat.filtering.pad-bottom', {\n\t\t\tpath: 'Chat > Filtering > Highlight',\n\t\t\tsort: 1000,\n\t\t\tcomponent: 'setting-spacer',\n\t\t\ttop: '30rem',\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.click-to-reveal', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General @{\"sort\":-1} >> Behavior',\n\t\t\t\ttitle: 'Click to reveal deleted terms.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.deleted-style', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Deleted Messages',\n\t\t\t\ttitle: 'Detailed Message Style',\n\t\t\t\tdescription: 'This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Faded'},\n\t\t\t\t\t{value: 1, title: 'Faded, Line Through'},\n\t\t\t\t\t{value: 2, title: 'Line Through'},\n\t\t\t\t\t{value: 3, title: 'No Change'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.display-deleted', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Deleted Messages',\n\t\t\t\tsort: -1,\n\t\t\t\ttitle: 'Rendering Mode',\n\t\t\t\tdescription: 'This, when set, overrides the `Deleted Messages` mode selected in Twitch chat settings, which is normally only accessible for moderators. Brief hides messages entirely and shows a notice in chat that a number of messages were hidden. Detailed shows the contents of the message. Legacy shows `<message deleted>` with click to reveal.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: false, title: 'Do Not Override'},\n\t\t\t\t\t{value: 'BRIEF', title: 'Brief'},\n\t\t\t\t\t{value: 'DETAILED', title: 'Detailed'},\n\t\t\t\t\t{value: 'LEGACY', title: 'Legacy'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.display-mod-action', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Deleted Messages',\n\t\t\t\ttitle: 'Display Reason',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'In Detailed Mode'},\n\t\t\t\t\t{value: 2, title: 'Always'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.automod.delete-messages', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> AutoMod Filters @{\"description\": \"Extra configuration for Twitch\\'s native `Chat Filters`.\"}',\n\t\t\t\ttitle: 'Mark messages as deleted if they contain filtered phrases.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.automod.remove-messages', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> AutoMod Filters',\n\t\t\t\ttitle: 'Remove messages entirely if they contain filtered phrases.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.automod.run-as-mod', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> AutoMod Filters',\n\t\t\t\ttitle: 'Use Chat Filters as a moderator.',\n\t\t\t\tdescription: 'By default, Twitch\\'s Chat Filters feature does not function for moderators. This overrides that behavior.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.process-own', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Behavior',\n\t\t\t\ttitle: 'Filter your own messages.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.ignore-clear', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Deleted Messages',\n\t\t\t\ttitle: 'Do not Clear Chat when commanded to.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.remove-deleted', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Deleted Messages',\n\t\t\t\ttitle: 'Remove deleted messages from chat.',\n\t\t\t\tdescription: 'Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.',\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Do Not Remove'},\n\t\t\t\t\t{value: 1, title: 'Remove Unseen (Default)'},\n\t\t\t\t\t{value: 2, title: 'Remove Unseen as Moderator'},\n\t\t\t\t\t{value: 3, title: 'Remove All'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.delay', {\n\t\t\tdefault: -1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Artificial Chat Delay',\n\t\t\t\tdescription: 'Delay the appearance of chat messages to allow for moderation before you see them.',\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: -1, title: 'Default Delay (Room Specific; Non-Mod Only)'},\n\t\t\t\t\t{value: 0, title: 'No Delay'},\n\t\t\t\t\t{value: 300, title: 'Minor (Bot Moderation; 0.3s)'},\n\t\t\t\t\t{value: 1200, title: 'Normal (Human Moderation; 1.2s)'},\n\t\t\t\t\t{value: 5000, title: 'Large (Spoiler Removal / Slow Mods; 5s)'},\n\t\t\t\t\t{value: 10000, title: 'Extra Large (10s)'},\n\t\t\t\t\t{value: 15000, title: 'Extremely Large (15s)'},\n\t\t\t\t\t{value: 20000, title: 'Mods Asleep; Delay Chat (20s)'},\n\t\t\t\t\t{value: 30000, title: 'Half a Minute (30s)'},\n\t\t\t\t\t{value: 60000, title: 'Why??? (1m)'},\n\t\t\t\t\t{value: 788400000000, title: 'The CBenni Option (Literally 25 Years)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.hidden-tokens', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tconst out = new Set;\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tif ( v?.v || ! UNBLOCKABLE_TOKENS.includes(v.v) )\n\t\t\t\t\t\tout.add(v.v);\n\n\t\t\t\treturn out;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Hidden Token Types @{\"description\":\"This filter allows you to prevent specific content token types from appearing chat messages, such as hiding all cheers or emotes.\"}',\n\t\t\t\tcomponent: 'blocked-types',\n\t\t\t\tgetExtraTerms: () => Object\n\t\t\t\t\t.keys(this.tokenizers)\n\t\t\t\t\t.filter(key => ! UNBLOCKABLE_TOKENS.includes(key) && this.tokenizers[key]?.render),\n\t\t\t\tdata: () => Object\n\t\t\t\t\t.keys(this.tokenizers)\n\t\t\t\t\t.filter(key => ! UNBLOCKABLE_TOKENS.includes(key) && this.tokenizers[key]?.render)\n\t\t\t\t\t.sort()\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.highlight-basic-users', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Highlight @{\"description\": \"These settings allow you to highlight messages in chat based on their contents. Setting priorities on rules allows you to determine which highlight color should be applied if a message matches multiple rules. Rules with a higher priority take priority over rules with lower priorities.\\\\n\\\\nYou can also create a rule that removes highlights from messages, preventing lower priority rules from highlighting them, by setting a color with an alpha value of zero. Example: `#00000000`\"} >> Users',\n\t\t\t\tcomponent: 'basic-terms',\n\t\t\t\tcolored: true,\n\t\t\t\twords: false,\n\t\t\t\tpriority: true\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:highlight-users', {\n\t\t\trequires: ['chat.filtering.highlight-basic-users'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('chat.filtering.highlight-basic-users');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst temp = new Map;\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst p = item.p || 0,\n\t\t\t\t\t\tt = item.t;\n\n\t\t\t\t\tlet c = item.c || null;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnew RegExp(v);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet colors = temp.get(p);\n\t\t\t\t\tif ( ! colors ) {\n\t\t\t\t\t\tcolors = new Map;\n\t\t\t\t\t\ttemp.set(p, colors);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( c ) {\n\t\t\t\t\t\tconst test = Color.RGBA.fromCSS(c);\n\t\t\t\t\t\tif ( ! test || ! test.a )\n\t\t\t\t\t\t\tc = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( colors.has(c) )\n\t\t\t\t\t\tcolors.get(c).push(v);\n\t\t\t\t\telse {\n\t\t\t\t\t\tcolors.set(c, [v]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst out = [];\n\t\t\t\tfor(const [priority, list] of temp) {\n\t\t\t\t\tfor(const [color, entries] of list) {\n\t\t\t\t\t\tout.push([\n\t\t\t\t\t\t\tpriority,\n\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\tnew RegExp(`^(?:${entries.join('|')})$`, 'gi')\n\t\t\t\t\t\t]);\n\t\t\t\t\t\t//list.set(k, new RegExp(`^(?:${entries.join('|')})$`, 'gi'));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn sortPriorityColorTerms(out);\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.filtering.highlight-basic-users-blocked', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Block >> Users',\n\t\t\t\tcomponent: 'basic-terms',\n\t\t\t\tremovable: true,\n\t\t\t\twords: false\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('__filter:block-users', {\n\t\t\trequires: ['chat.filtering.highlight-basic-users-blocked'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('chat.filtering.highlight-basic-users-blocked');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = [[], []];\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst t = item.t;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tout[item.remove ? 1 : 0].push(v);\n\t\t\t\t}\n\n\t\t\t\treturn out.map(data => {\n\t\t\t\t\tif ( ! data.length )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn new RegExp(`^(?:${data.join('|')})$`, 'i');\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.filtering.highlight-basic-badges', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Highlight >> Badges',\n\t\t\t\tcomponent: 'badge-highlighting',\n\t\t\t\tcolored: true,\n\t\t\t\tpriority: true,\n\t\t\t\tdata: () => this.badges.getSettingsBadges(true)\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('__filter:highlight-badges', {\n\t\t\trequires: ['chat.filtering.highlight-basic-badges'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('chat.filtering.highlight-basic-badges');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst badges = new Map;\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tlet c = item.c || null;\n\t\t\t\t\tconst p = item.p || 0,\n\t\t\t\t\t\tv = item.v;\n\n\t\t\t\t\tif ( c ) {\n\t\t\t\t\t\tconst test = Color.RGBA.fromCSS(c);\n\t\t\t\t\t\tif ( ! test || ! test.a )\n\t\t\t\t\t\t\tc = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst existing = badges.get(v);\n\t\t\t\t\tif ( ! existing || existing[0] < p || (c && ! existing[1] && existing[0] <= p) )\n\t\t\t\t\t\tbadges.set(v, [p, c]);\n\t\t\t\t}\n\n\t\t\t\treturn badges;\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.filtering.highlight-basic-badges-blocked', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Block >> Badges @{\"description\": \"**Note:** This section is for filtering messages out of chat from users with specific badges. If you wish to hide a badge, go to [Chat > Badges >> Visibility](~chat.badges.tabs.visibility).\"}',\n\t\t\t\tcomponent: 'badge-highlighting',\n\t\t\t\tremovable: true,\n\t\t\t\tdata: () => this.badges.getSettingsBadges(true)\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:block-badges', {\n\t\t\trequires: ['chat.filtering.highlight-basic-badges-blocked'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('chat.filtering.highlight-basic-badges-blocked');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = [[], []];\n\t\t\t\tfor(const item of val)\n\t\t\t\t\tif ( item.v )\n\t\t\t\t\t\tout[item.remove ? 1 : 0].push(item.v);\n\n\t\t\t\tif ( ! out[0].length && ! out[1].length )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn out;\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.filtering.highlight-basic-terms', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Highlight >> Terms @{\"description\": \"Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms.\"}',\n\t\t\t\tcomponent: 'basic-terms',\n\t\t\t\tcolored: true,\n\t\t\t\tpriority: true,\n\t\t\t\thighlight: true\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:highlight-terms', {\n\t\t\trequires: ['chat.filtering.highlight-tokens', 'chat.filtering.highlight-basic-terms'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst can_highlight = ctx.get('chat.filtering.highlight-tokens');\n\t\t\t\tconst val = ctx.get('chat.filtering.highlight-basic-terms');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst temp = new Map;\n\t\t\t\t//const colors = new Map;\n\t\t\t\tlet has_highlight = false,\n\t\t\t\t\thas_non = false;\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst p = item.p || 0,\n\t\t\t\t\t\thighlight = can_highlight && (has(item, 'h') ? item.h : true),\n\t\t\t\t\t\tsensitive = item.s,\n\t\t\t\t\t\tt = item.t,\n\t\t\t\t\t\tword = has(item, 'w') ? item.w : t !== 'raw';\n\n\t\t\t\t\tlet c = item.c || null;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'regex' && t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnew RegExp(v);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( highlight )\n\t\t\t\t\t\thas_highlight = true;\n\t\t\t\t\telse\n\t\t\t\t\t\thas_non = true;\n\n\t\t\t\t\tlet colors = temp.get(p);\n\t\t\t\t\tif ( ! colors ) {\n\t\t\t\t\t\tcolors = new Map;\n\t\t\t\t\t\ttemp.set(p, colors);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( c ) {\n\t\t\t\t\t\tconst test = Color.RGBA.fromCSS(c);\n\t\t\t\t\t\tif ( ! test || ! test.a )\n\t\t\t\t\t\t\tc = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet data = colors.get(c);\n\t\t\t\t\tif ( ! data )\n\t\t\t\t\t\tcolors.set(c, data = [\n\t\t\t\t\t\t\t[ // highlight\n\t\t\t\t\t\t\t\t[ // sensitive\n\t\t\t\t\t\t\t\t\t[], [] // word\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t[], []\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t[], []\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t[], []\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]);\n\n\t\t\t\t\tdata[highlight ? 0 : 1][sensitive ? 0 : 1][word ? 0 : 1].push(v);\n\t\t\t\t}\n\n\t\t\t\tif ( ! has_highlight && ! has_non )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = {\n\t\t\t\t\thl: has_highlight ? [] : null,\n\t\t\t\t\tnon: has_non ? [] : null\n\t\t\t\t};\n\n\t\t\t\tfor(const [priority, colors] of temp) {\n\t\t\t\t\tfor(const [color, list] of colors) {\n\t\t\t\t\t\tconst highlights = formatTerms(list[0]),\n\t\t\t\t\t\t\tnon_highlights = formatTerms(list[1]);\n\n\t\t\t\t\t\tif ( highlights[0] || highlights[1] )\n\t\t\t\t\t\t\tout.hl.push([\n\t\t\t\t\t\t\t\tpriority,\n\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\thighlights\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\tif ( non_highlights[0] || non_highlights[1] )\n\t\t\t\t\t\t\tout.non.push([\n\t\t\t\t\t\t\t\tpriority,\n\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\tnon_highlights\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( has_highlight )\n\t\t\t\t\tsortPriorityColorTerms(out.hl);\n\n\t\t\t\tif ( has_non )\n\t\t\t\t\tsortPriorityColorTerms(out.non);\n\n\t\t\t\treturn out;\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.filtering.highlight-basic-blocked', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Block >> Terms @{\"description\": \"Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms.\"}',\n\t\t\t\tcomponent: 'basic-terms',\n\t\t\t\tremovable: true\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('__filter:block-terms', {\n\t\t\trequires: ['chat.filtering.highlight-basic-blocked'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('chat.filtering.highlight-basic-blocked');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst data = [\n\t\t\t\t\t[ // no-remove\n\t\t\t\t\t\t[ // sensitive\n\t\t\t\t\t\t\t[], [] // word\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[ // intensitive\n\t\t\t\t\t\t\t[], []\n\t\t\t\t\t\t]\n\t\t\t\t\t],\n\t\t\t\t\t[ // remove\n\t\t\t\t\t\t[ // sensitive\n\t\t\t\t\t\t\t[], [] // word\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[ // intensiitve\n\t\t\t\t\t\t\t[], []\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t];\n\n\t\t\t\tlet had_remove = false,\n\t\t\t\t\thad_non = false;\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst t = item.t,\n\t\t\t\t\t\tsensitive = item.s,\n\t\t\t\t\t\tword = has(item, 'w') ? item.w : t !== 'raw';\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'regex' && t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif ( item.remove )\n\t\t\t\t\t\thad_remove = true;\n\t\t\t\t\telse\n\t\t\t\t\t\thad_non = true;\n\n\t\t\t\t\tdata[item.remove ? 1 : 0][sensitive ? 0 : 1][word ? 0 : 1].push(v);\n\t\t\t\t}\n\n\t\t\t\tif ( ! had_remove && ! had_non )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn {\n\t\t\t\t\tremove: had_remove ? formatTerms(data[1]) : null,\n\t\t\t\t\tnon: had_non ? formatTerms(data[0]) : null\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.filtering.clickable-mentions', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tpath: 'Chat > Viewer Cards >> Behavior',\n\t\t\t\ttitle: 'Enable opening viewer cards by clicking mentions in chat.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.all-mentions', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Display mentions for all users without requiring an at sign (@).',\n\t\t\t\tdescription: '**Note**: This setting can increase memory usage and impact chat performance.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.color-mentions', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Display mentions in chat with username colors.',\n\t\t\t\tdescription: '**Note:** Not compatible with color overrides as mentions do not include user IDs.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.need-colors', {\n\t\t\trequires: ['chat.filtering.all-mentions' ,'chat.filtering.color-mentions'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ctx.get('chat.filtering.all-mentions') || ctx.get('chat.filtering.color-mentions')\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.bold-mentions', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Display mentions in chat with a bold font.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.mention-priority', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Mention Priority',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\ttype: 'number',\n\t\t\t\tprocess: 'to_int',\n\t\t\t\tdescription: 'Mentions of your name have this priority for the purpose of highlighting. See [Chat > Filtering > Highlight](~chat.filtering.highlight) for more details.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.mention-color', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Custom Highlight Color',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\tdescription: 'If this is set, highlighted messages with no default color set will use this color rather than red.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.highlight-mentions', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Highlight messages that mention you.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.highlight-tokens', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Highlight matched words in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.images', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> General @{\"sort\": -1}',\n\t\t\t\ttitle: 'Display images in tooltips.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.badge-images', {\n\t\t\tdefault: true,\n\t\t\trequires: ['tooltip.images'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn ctx.get('tooltip.images') ? val : false\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Badges',\n\t\t\t\ttitle: 'Display large images of badges.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.emote-sources', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Emotes',\n\t\t\t\ttitle: 'Display known sources.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.emote-images', {\n\t\t\tdefault: true,\n\t\t\trequires: ['tooltip.images'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn ctx.get('tooltip.images') ? val : false\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Emotes',\n\t\t\t\ttitle: 'Display large images of emotes.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.rich-links', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tsort: -1,\n\t\t\t\tpath: 'Chat > Tooltips >> Links',\n\t\t\t\ttitle: 'Display rich tooltips for links.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\textra: {\n\t\t\t\t\tcomponent: 'chat-tooltip-example'\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.link-interaction', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Links',\n\t\t\t\ttitle: 'Allow interaction with supported link tooltips.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.link-images', {\n\t\t\tdefault: true,\n\t\t\trequires: ['tooltip.images'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn ctx.get('tooltip.images') ? val : false\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Links',\n\t\t\t\ttitle: 'Display images for links.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.link-nsfw-images', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Links',\n\t\t\t\ttitle: 'Display potentially NSFW images.',\n\t\t\t\tdescription: 'When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\n\t\t// Terms of Service Stuff\n\t\tfor(const [key, info] of Object.entries(RESOLVERS_REQUIRE_TOS)) {\n\t\t\tthis.settings.addUI(`tooltip.tos.${key}`, {\n\t\t\t\tpath: 'Chat > Tooltips >> Terms of Service @{\"description\": \"The following services require you to agree to their Terms of Service before we can show you information from their platforms.\"}',\n\t\t\t\tcomponent: 'tooltip-tos',\n\t\t\t\titem: key,\n\t\t\t\toverride_setting: 'agreed-tos',\n\t\t\t\tgetChat: () => this,\n\t\t\t\tdata: deep_copy(info),\n\t\t\t\tonUIChange: () => this.emit(':update-link-resolver')\n\t\t\t});\n\t\t}\n\n\n\t\tthis.settings.add('chat.adjustment-mode', {\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val == null )\n\t\t\t\t\treturn (ctx.get('ls.useHighContrastColors') ?? true) ? 1 : 0;\n\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\trequires: ['ls.useHighContrastColors'],\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Colors',\n\t\t\t\ttitle: 'Adjustment',\n\t\t\t\tdescription: 'Alter user colors to ensure that they remain readable.',\n\n\t\t\t\tdefault(ctx) {\n\t\t\t\t\treturn (ctx.get('ls.useHighContrastColors') ?? true) ? 1 : 0;\n\t\t\t\t},\n\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: -1, title: 'No Color'},\n\t\t\t\t\t{value: 0, title: 'Unchanged'},\n\t\t\t\t\t{value: 1, title: 'HSL Luma'},\n\t\t\t\t\t{value: 2, title: 'Luv Luma'},\n\t\t\t\t\t{value: 3, title: 'HSL Loop (BTTV-Like)'},\n\t\t\t\t\t{value: 4, title: 'RGB Loop (Deprecated)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.adjustment-contrast', {\n\t\t\tdefault: 4.5,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Colors',\n\t\t\t\ttitle: 'Minimum Contrast',\n\t\t\t\tdescription: 'Set the minimum contrast ratio used by Luma adjustments when determining readability.',\n\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_float'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.me-style', {\n\t\t\tdefault: 2,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Action Style',\n\t\t\t\tdescription: 'When someone uses `/me`, the message will be rendered in this style.',\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'No Style'},\n\t\t\t\t\t{value: 1, title: 'Colorized (Old Style)'},\n\t\t\t\t\t{value: 2, title: 'Italic (New Style)'},\n\t\t\t\t\t{value: 3, title: 'Colorized Italic'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.bits.stack', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Bits and Cheering >> Appearance',\n\t\t\t\ttitle: 'Cheer Stacking',\n\t\t\t\tdescription: 'Collect all the cheers in a message into a single cheer at the start of the message.',\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Grouped by Type'},\n\t\t\t\t\t{value: 2, title: 'All in One'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emotes.animated', {\n\t\t\tdefault: null,\n\t\t\trequires: ['ls.emoteAnimationsEnabled'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val == null )\n\t\t\t\t\treturn (ctx.get('ls.emoteAnimationsEnabled') ?? true) ? 1 : 0;\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Emotes',\n\t\t\t\tsort: -50,\n\t\t\t\ttitle: 'Animated Emotes',\n\n\t\t\t\tdefault(ctx) {\n\t\t\t\t\treturn (ctx.get('ls.emoteAnimationsEnabled') ?? true) ? 1 : 0;\n\t\t\t\t},\n\n\t\t\t\tgetExtraTerms: () => GIF_TERMS,\n\n\t\t\t\tdescription: 'This controls whether or not animated emotes are allowed to play in chat. When this is `Disabled`, emotes will appear as static images. Setting this to `Enable on Hover` may cause performance issues.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Enabled'},\n\t\t\t\t\t{value: 2, title: 'Enable on Hover'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('tooltip.emote-images.animated', {\n\t\t\trequires: ['chat.emotes.animated'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val == null )\n\t\t\t\t\tval = ctx.get('chat.emotes.animated') ? true : false;\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Tooltips >> Emotes',\n\t\t\t\ttitle: 'Display animated images of emotes.',\n\t\t\t\tgetExtraTerms: () => GIF_TERMS,\n\t\t\t\tdescription: 'If this is not overridden, animated images are only shown in emote tool-tips if [Chat > Appearance >> Emotes > Animated Emotes](~chat.appearance.emotes) is not disabled.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.bits.animated', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Bits and Cheering >> Appearance',\n\t\t\t\ttitle: 'Display animated cheers.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tconst ts = new Date(0).toLocaleTimeString().toUpperCase(),\n\t\t\tdefault_24 = ts.lastIndexOf('PM') === -1 && ts.lastIndexOf('AM') === -1;\n\n\t\tthis.settings.add('chat.timestamp-format', {\n\t\t\tdefault: default_24 ? 'H:mm' : 'h:mm',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Timestamp Format',\n\t\t\t\tcomponent: 'setting-combo-box',\n\n\t\t\t\tdescription: 'Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 'h:mm', title: '12 Hour'},\n\t\t\t\t\t{value: 'h:mm:ss', title: '12 Hour with Seconds'},\n\t\t\t\t\t{value: 'H:mm', title: '24 Hour'},\n\t\t\t\t\t{value: 'H:mm:ss', title: '24 Hour with Seconds'},\n\t\t\t\t\t{value: 'hh:mm', title: 'Padded'},\n\t\t\t\t\t{value: 'hh:mm:ss', title: 'Padded with Seconds'},\n\t\t\t\t\t{value: 'HH:mm', title: 'Padded 24 Hour'},\n\t\t\t\t\t{value: 'HH:mm:ss', title: 'Padded 24 Hour with Seconds'},\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.context.on('changed:theme.is-dark', () => {\n\t\t\tfor(const room of this.iterateRooms())\n\t\t\t\troom.buildBitsCSS();\n\t\t});\n\n\t\tthis.context.on('changed:chat.bits.animated', () => {\n\t\t\tfor(const room of this.iterateRooms())\n\t\t\t\troom.buildBitsCSS();\n\t\t});\n\n\t\tthis.context.on('changed:chat.filtering.need-colors', async val => {\n\t\t\tif ( val )\n\t\t\t\tawait this.createColorCache();\n\t\t\telse\n\t\t\t\tthis.color_cache = null;\n\n\t\t\tthis.emit(':update-line-tokens');\n\t\t});\n\n\t\tthis.context.on('changed:chat.filtering.all-mentions', () => this.emit(':update-line-tokens'));\n\t\tthis.context.on('changed:chat.filtering.color-mentions', () => this.emit(':update-line-tokens'));\n\t}\n\n\n\tasync createColorCache() {\n\t\tconst LRUCache = await require(/* webpackChunkName: 'utils' */ 'mnemonist/lru-cache');\n\t\tthis.color_cache = new LRUCache(150);\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = ['chat settings', '-------------------------------------------------------------------------------'];\n\t\tfor(const [key, value] of this.context.__cache.entries())\n\t\t\tout.push(`${key}: ${JSON.stringify(value)}`);\n\n\t\treturn out.join('\\n');\n\t}\n\n\n\tgetAddonProxy(addon_id, addon, module) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst is_dev = DEBUG || addon?.dev,\n\t\t\tid_checker = makeAddonIdChecker(addon_id);\n\n\t\tconst overrides = {},\n\t\t\twarnings = {};\n\n\t\tconst user_proxy = buildAddonProxy(module, null, 'getUser()', {\n\t\t\taddBadge: is_dev ? function(provider, ...args) {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().addBadge() did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.addBadge(provider, ...args);\n\t\t\t} : undefined,\n\n\t\t\tremoveBadge: is_dev ? function(provider, ...args) {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().removeBadge() did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeBadge(provider, ...args);\n\t\t\t} : undefined,\n\n\t\t\taddSet(provider, set_id, data) {\n\t\t\t\tif ( is_dev && ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().addSet() did not include addon ID in provider:', provider);\n\n\t\t\t\tif ( ! this.manager.emotes.providers.has(provider) ) {\n\t\t\t\t\tthis.manager.emotes.inferProvider(provider, addon_id);\n\t\t\t\t\tif ( is_dev )\n\t\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().addSet() for provider that has not been registered with emotes.setProvider:', provider);\n\t\t\t\t}\n\n\t\t\t\tif ( data ) {\n\t\t\t\t\tif ( is_dev && ! id_checker.test(set_id) )\n\t\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().addSet() loaded set data but did not include addon ID in set ID:', set_id);\n\t\t\t\t\tdata.__source = addon_id;\n\t\t\t\t}\n\n\t\t\t\treturn this.addSet(provider, set_id, data);\n\t\t\t},\n\n\t\t\tremoveAllSets: is_dev ? function(provider) {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().removeAllSets() did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeAllSets(provider);\n\t\t\t} : undefined,\n\n\t\t\tremoveSet: is_dev ? function(provider, ...args) {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getUser().removeSet() did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeSet(provider, ...args);\n\t\t\t} : undefined\n\n\t\t}, is_dev ? {\n\t\t\tbadges: 'Please use addBadge(), getBadge(), or removeBadge()',\n\t\t\temote_sets: 'Please use addSet(), removeSet(), or removeAllSets()',\n\t\t\troom: true\n\t\t} : null, true);\n\n\t\tconst room_proxy = buildAddonProxy(module, null, 'getRoom()', {\n\t\t\tgetUser(...args) {\n\t\t\t\tconst result = this.getUser(...args);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn new Proxy(result, user_proxy);\n\t\t\t},\n\n\t\t\taddSet(provider, set_id, data) {\n\t\t\t\tif ( is_dev && ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getRoom().addSet() did not include addon ID in provider:', provider);\n\n\t\t\t\tif ( ! this.manager.emotes.providers.has(provider) ) {\n\t\t\t\t\tthis.manager.emotes.inferProvider(provider, addon_id);\n\t\t\t\t\tif ( is_dev )\n\t\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getRoom().addSet() for provider that has not been registered with emotes.setProvider:', provider);\n\t\t\t\t}\n\n\t\t\t\tif ( data ) {\n\t\t\t\t\tif ( is_dev && ! id_checker.test(set_id) )\n\t\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getRoom().addSet() loaded set data but did not include addon ID in set ID:', set_id);\n\t\t\t\t\tdata.__source = addon_id;\n\t\t\t\t}\n\n\t\t\t\treturn this.addSet(provider, set_id, data);\n\t\t\t},\n\n\t\t\tremoveAllSets: is_dev ? function(provider) {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getRoom().removeAllSets() did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeAllSets(provider);\n\t\t\t} : undefined,\n\n\t\t\tremoveSet: is_dev ? function(provider, ...args) {\n\t\t\t\tif ( ! id_checker.test(provider) )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Call to getRoom().removeSet() did not include addon ID in provider:', provider);\n\n\t\t\t\treturn this.removeSet(provider, ...args);\n\t\t\t} : undefined\n\n\t\t}, {\n\t\t\tbadges: true,\n\t\t\tload_data: true,\n\t\t\temote_sets: 'Please use addSet(), removeSet(), or removeAllSets()',\n\t\t\trefs: 'Please use ref() or unref()',\n\t\t\tstyle: true,\n\t\t\tusers: 'Please use getUser()',\n\t\t\tuser_ids: 'Please use getUser()'\n\t\t}, true);\n\n\t\toverrides.iterateUsers = function*() {\n\t\t\tfor(const user of this.iterateUsers())\n\t\t\t\tyield new Proxy(user, user_proxy);\n\t\t}\n\n\t\toverrides.iterateRooms = function*() {\n\t\t\tfor(const room of this.iterateRooms())\n\t\t\t\tyield new Proxy(room, room_proxy);\n\t\t}\n\n\t\toverrides.iterateAllRoomsAndUsers = function*() {\n\t\t\tfor(const thing of this.iterateAllRoomsAndUsers())\n\t\t\t\tyield new Proxy(thing, (thing instanceof Room)\n\t\t\t\t\t? room_proxy\n\t\t\t\t\t: user_proxy\n\t\t\t\t);\n\t\t}\n\n\t\toverrides.addTabCommandPrefix = (prefix, provider = null) => {\n\t\t\tif ( provider == null )\n\t\t\t\tprovider = addon_id;\n\t\t\tif ( is_dev && provider !== addon_id )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Used addTabCommandPrefix with incorrect provider.');\n\n\t\t\treturn this.addTabCommandPrefix(prefix, provider);\n\t\t}\n\n\t\toverrides.removeTabCommandPrefix = (prefix, provider = null) => {\n\t\t\tif ( provider == null )\n\t\t\t\tprovider = addon_id;\n\t\t\tif ( is_dev && provider !== addon_id )\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Used removeTabCommandPrefix with incorrect provider.');\n\n\t\t\treturn this.removeTabCommandPrefix(prefix, provider);\n\t\t}\n\n\t\toverrides.addTokenizer = tokenizer => {\n\t\t\tif ( tokenizer )\n\t\t\t\ttokenizer.__source = addon_id;\n\n\t\t\treturn this.addTokenizer(tokenizer);\n\t\t}\n\n\t\toverrides.addLinkProvider = provider => {\n\t\t\tif ( provider )\n\t\t\t\tprovider.__source = addon_id;\n\n\t\t\treturn this.addLinkProvider(provider);\n\t\t}\n\n\t\toverrides.addRichProvider = provider => {\n\t\t\tif ( provider )\n\t\t\t\tprovider.__source = addon_id;\n\n\t\t\treturn this.addRichProvider(provider);\n\t\t}\n\n\t\tif ( is_dev ) {\n\t\t\toverrides.getUser = (...args) => {\n\t\t\t\tlet result = this.getUser(...args);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn new Proxy(result, user_proxy);\n\t\t\t}\n\n\t\t\toverrides.getRoom = (...args) => {\n\t\t\t\tlet result = this.getRoom(...args);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn new Proxy(result, room_proxy);\n\t\t\t}\n\n\t\t\toverrides.removeTokenizer = tokenizer => {\n\t\t\t\tlet type;\n\t\t\t\tif ( typeof tokenizer === 'string' )\n\t\t\t\t\ttype = tokenizer;\n\t\t\t\telse\n\t\t\t\t\ttype = tokenizer.type;\n\n\t\t\t\tconst existing = this.tokenizers[type];\n\t\t\t\tif ( existing && existing.__source !== addon_id )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned tokenizer with chat.removeTokenizer:', type, ' owner:', existing.__source ?? 'ffz');\n\n\t\t\t\treturn this.removeTokenizer(tokenizer);\n\t\t\t}\n\n\t\t\toverrides.removeLinkProvider = provider => {\n\t\t\t\tlet type;\n\t\t\t\tif ( typeof provider === 'string' )\n\t\t\t\t\ttype = provider;\n\t\t\t\telse\n\t\t\t\t\ttype = provider.type;\n\n\t\t\t\tconst existing = this.link_providers[type];\n\t\t\t\tif ( existing && existing.__source !== addon_id )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned link provider with chat.removeLinkProvider:', type, ' owner:', existing.__source ?? 'ffz');\n\n\t\t\t\treturn this.removeLinkProvider(provider);\n\t\t\t}\n\n\t\t\toverrides.removeRichProvider = provider => {\n\t\t\t\tlet type;\n\t\t\t\tif ( typeof provider === 'string' )\n\t\t\t\t\ttype = provider;\n\t\t\t\telse\n\t\t\t\t\ttype = provider.type;\n\n\t\t\t\tconst existing = this.link_providers[type];\n\t\t\t\tif ( existing && existing.__source !== addon_id )\n\t\t\t\t\tmodule.log.warn('[DEV-CHECK] Removed un-owned rich provider with chat.removeRichProvider:', type, ' owner:', existing.__source ?? 'ffz');\n\n\t\t\t\treturn this.removeRichProvider(provider);\n\t\t\t}\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'chat', overrides, warnings);\n\t}\n\n\n\n\tonEnable() {\n\t\tthis.socket = this.resolve('socket');\n\t\tthis.pubsub = this.resolve('pubsub');\n\n\t\tthis.settings.provider.on('changed', this.onProviderChange, this);\n\n\t\tthis.on('site.subpump:pubsub-message', this.onPubSub, this);\n\t\tthis.on('chat.emotes:update-priorities', fn => {\n\t\t\tfor(const thing of this.iterateAllRoomsAndUsers()) {\n\t\t\t\tif (thing.emote_sets)\n\t\t\t\t\tthing.emote_sets.setSortFunction(fn);\n\t\t\t}\n\t\t});\n\n\t\tif ( this.context.get('chat.filtering.need-colors') )\n\t\t\tthis.createColorCache().then(() => this.emit(':update-line-tokens'));\n\n\t\tfor(const key in TOKENIZERS)\n\t\t\tif ( has(TOKENIZERS, key) )\n\t\t\t\tthis.addTokenizer(TOKENIZERS[key]);\n\n\t\tfor(const key in RICH_PROVIDERS)\n\t\t\tif ( has(RICH_PROVIDERS, key) )\n\t\t\t\tthis.addRichProvider(RICH_PROVIDERS[key]);\n\n\t\tfor(const key in LINK_PROVIDERS)\n\t\t\tif ( has(LINK_PROVIDERS, key) )\n\t\t\t\tthis.addLinkProvider(LINK_PROVIDERS[key]);\n\n\t\tthis.on('chat:reload-data', flags => {\n\t\t\tfor(const room of this.iterateRooms())\n\t\t\t\troom.load_data();\n\t\t});\n\n\t\tthis.on('chat:get-tab-commands', event => {\n\t\t\tevent.commands.push({\n\t\t\t\tname: 'ffz:reload',\n\t\t\t\tdescription: this.i18n.t('chat.command.reload', 'Reload FFZ and add-on chat data (emotes, badges, etc.)'),\n\t\t\t\tpermissionLevel: 0,\n\t\t\t\tffz_group: 'FrankerFaceZ'\n\t\t\t});\n\t\t});\n\n\t\tthis.triggered_reload = false;\n\n\t\tthis.on('chat:ffz-command:reload', event => {\n\t\t\tif ( this.triggered_reload )\n\t\t\t\treturn;\n\n\t\t\tconst sc = this.resolve('site.chat');\n\t\t\tif ( sc?.addNotice )\n\t\t\t\tsc.addNotice('*', this.i18n.t('chat.command.reload.starting', 'FFZ is reloading data...'));\n\n\t\t\tthis.triggered_reload = true;\n\t\t\tthis.emit('chat:reload-data');\n\t\t});\n\n\t\tthis.on('load_tracker:complete:chat-data', (list) => {\n\t\t\tif ( this.triggered_reload ) {\n\t\t\t\tconst sc = this.resolve('site.chat');\n\t\t\t\tif ( sc?.addNotice )\n\t\t\t\t\tsc.addNotice('*', this.i18n.t('chat.command.reload.done', 'FFZ has finished reloading data. (Sources: {list})', {list: list.join(', ')}));\n\t\t\t}\n\n\t\t\tthis.triggered_reload = false;\n\t\t});\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tlet removed = 0;\n\t\t\tfor(const [key, def] of Object.entries(this.link_providers)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.removeLinkProvider(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const [key, def] of Object.entries(this.rich_providers)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.removeRichProvider(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const [key, def] of Object.entries(this.tokenizers)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.removeTokenizer(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.CommandPrefixes.delete(addon_id);\n\n\t\t\tfor(const item of this.iterateAllRoomsAndUsers())\n\t\t\t\tremoved += item._unloadAddon(addon_id) ?? 0;\n\n\t\t\t// If we removed things, retokenize all chat messages.\n\t\t\t// TODO: Debounce this.\n\t\t\tif ( removed ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed} entries when unloading addon:`, addon_id);\n\t\t\t\tthis.emit(':update-line-tokens');\n\t\t\t}\n\t\t});\n\t}\n\n\n\tonPubSub(event) {\n\t\tif ( event.prefix === 'stream-chat-room-v1' && event.message.type === 'chat_rich_embed' ) {\n\t\t\tconst data = event.message.data,\n\t\t\t\turl = data.request_url,\n\n\t\t\t\tproviders = this.__link_providers;\n\n\t\t\t// Don't re-cache.\n\t\t\tif ( this._link_info[url] )\n\t\t\t\treturn;\n\n\t\t\tfor(const provider of providers) {\n\t\t\t\tconst match = provider.test.call(this, url);\n\t\t\t\tif ( match ) {\n\t\t\t\t\tconst processed = provider.receive ? provider.receive.call(this, match, data) : data;\n\t\t\t\t\tlet result = provider.process.call(this, match, processed);\n\n\t\t\t\t\tif ( !(result instanceof Promise) )\n\t\t\t\t\t\tresult = Promise.resolve(result);\n\n\t\t\t\t\tresult.then(value => {\n\t\t\t\t\t\t// If something is already running, don't override it.\n\t\t\t\t\t\tlet info = this._link_info[url];\n\t\t\t\t\t\tif ( info )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t// Save the value.\n\t\t\t\t\t\tthis._link_info[url] = [true, Date.now() + 120000, value];\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\tgetUser(id, login, no_create, no_login, error = false) {\n\t\tlet user;\n\t\tif ( id && typeof id === 'number' )\n\t\t\tid = `${id}`;\n\n\t\tif ( id && this.user_ids[id] )\n\t\t\tuser = this.user_ids[id];\n\n\t\telse if ( login && this.users[login] && ! no_login )\n\t\t\tuser = this.users[login];\n\n\t\tif ( user && user.destroyed )\n\t\t\tuser = null;\n\n\t\tif ( ! user ) {\n\t\t\tif ( no_create )\n\t\t\t\treturn null;\n\t\t\telse\n\t\t\t\tuser = new User(this, null, id, login);\n\t\t}\n\n\t\tif ( id && id !== user.id ) {\n\t\t\t// If the ID isn't what we expected, something is very wrong here.\n\t\t\t// Blame name changes.\n\t\t\tif ( user.id ) {\n\t\t\t\tthis.log.warn(`Data mismatch for user #${id} -- Stored ID: ${user.id} -- Login: ${login} -- Stored Login: ${user.login}`);\n\t\t\t\tif ( error )\n\t\t\t\t\tthrow new Error('id mismatch');\n\n\t\t\t\t// Remove the old reference if we're going with this.\n\t\t\t\tif ( this.user_ids[user.id] === user )\n\t\t\t\t\tthis.user_ids[user.id] = null;\n\t\t\t}\n\n\t\t\t// Otherwise, we're just here to set the ID.\n\t\t\tuser._id = id;\n\t\t\tthis.user_ids[id] = user;\n\t\t}\n\n\t\tif ( login ) {\n\t\t\tconst other = this.users[login];\n\t\t\tif ( other ) {\n\t\t\t\tif ( other !== user && ! no_login ) {\n\t\t\t\t\t// If the other has an ID, something weird happened. Screw it\n\t\t\t\t\t// and just take over.\n\t\t\t\t\tif ( other.id )\n\t\t\t\t\t\tthis.users[login] = user;\n\t\t\t\t\telse {\n\t\t\t\t\t\tuser.merge(other);\n\t\t\t\t\t\tother.destroy(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tthis.users[login] = user;\n\t\t}\n\n\t\treturn user;\n\t}\n\n\n\tgetRoom(id, login, no_create, no_login, error = false) {\n\t\tlet room;\n\t\tif ( id && typeof id === 'number' )\n\t\t\tid = `${id}`;\n\n\t\tif ( id && this.room_ids[id] )\n\t\t\troom = this.room_ids[id];\n\n\t\telse if ( login && this.rooms[login] && ! no_login )\n\t\t\troom = this.rooms[login];\n\n\t\tif ( room && room.destroyed )\n\t\t\troom = null;\n\n\t\tif ( ! room ) {\n\t\t\tif ( no_create )\n\t\t\t\treturn null;\n\t\t\telse\n\t\t\t\troom = new Room(this, id, login);\n\t\t}\n\n\t\tif ( id && id !== room.id ) {\n\t\t\t// If the ID isn't what we expected, something is very wrong here.\n\t\t\t// Blame name changes. Or React not being atomic.\n\t\t\tif ( room.id ) {\n\t\t\t\tthis.log.warn(`Data mismatch for room #${id} -- Stored ID: ${room.id} -- Login: ${login} -- Stored Login: ${room.login}`);\n\t\t\t\tif ( error )\n\t\t\t\t\tthrow new Error('id mismatch');\n\n\t\t\t\t// Remove the old reference if we're going with this.\n\t\t\t\tif ( this.room_ids[room.id] === room )\n\t\t\t\t\tthis.room_ids[room.id] = null;\n\t\t\t}\n\n\t\t\t// Otherwise, we're just here to set the ID.\n\t\t\troom._id = id;\n\t\t\tthis.room_ids[id] = room;\n\t\t}\n\n\t\tif ( login ) {\n\t\t\tconst other = this.rooms[login];\n\t\t\tif ( other ) {\n\t\t\t\tif ( other !== room && ! no_login ) {\n\t\t\t\t\t// If the other has an ID, something weird happened. Screw it\n\t\t\t\t\t// and just take over.\n\t\t\t\t\tif ( other.id )\n\t\t\t\t\t\tthis.rooms[login] = room;\n\t\t\t\t\telse {\n\t\t\t\t\t\troom.merge(other);\n\t\t\t\t\t\tother.destroy(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else\n\t\t\t\tthis.rooms[login] = room;\n\t\t}\n\n\t\treturn room;\n\t}\n\n\n\t*iterateAllRoomsAndUsers() {\n\t\tfor(const room of this.iterateRooms()) {\n\t\t\tyield room;\n\t\t\tfor(const user of room.iterateUsers())\n\t\t\t\tyield user;\n\t\t}\n\n\t\tfor(const user of this.iterateUsers())\n\t\t\tyield user;\n\t}\n\n\n\t*iterateUsers() {\n\t\tconst visited = new Set;\n\n\t\tfor(const user of Object.values(this.user_ids)) {\n\t\t\tif ( user && ! user.destroyed ) {\n\t\t\t\tvisited.add(user);\n\t\t\t\tyield user;\n\t\t\t}\n\t\t}\n\n\t\tfor(const user of Object.values(this.users)) {\n\t\t\tif ( user && ! user.destroyed )\n\t\t\t\tyield user;\n\t\t}\n\t}\n\n\n\t*iterateRooms() {\n\t\tconst visited = new Set;\n\n\t\tfor(const room of Object.values(this.room_ids)) {\n\t\t\tif ( room && ! room.destroyed ) {\n\t\t\t\tvisited.add(room);\n\t\t\t\tyield room;\n\t\t\t}\n\t\t}\n\n\t\tfor(const room of Object.values(this.rooms)) {\n\t\t\tif ( room && ! room.destroyed && ! visited.has(room) )\n\t\t\t\tyield room;\n\t\t}\n\t}\n\n\n\titerateMessages(include_chat = true, include_whisper = true, include_video = true) {\n\t\tconst messages = [];\n\t\tthis.emit('chat:get-messages', include_chat, include_whisper, include_video, messages);\n\t\tthis.emit('chat:get-messages-late', include_chat, include_whisper, include_video, messages);\n\t\treturn messages;\n\t}\n\n\n\thandleLinkClick(event) {\n\t\tif ( event.ctrlKey || event.shiftKey )\n\t\t\treturn;\n\n\t\tconst target = event.currentTarget,\n\t\t\tds = target?.dataset;\n\n\t\tif ( ! ds )\n\t\t\treturn;\n\n\t\tconst evt = this.makeEvent({\n\t\t\turl: ds.url ?? target.href,\n\t\t\tsource: event\n\t\t});\n\n\t\tthis.emit('chat:click-link', evt);\n\t\tif ( evt.defaultPrevented ) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\n\thandleReplyClick(event) {\n\t\tconst target = event.target,\n\t\t\tfine = this.resolve('site.fine');\n\n\t\tif ( ! target || ! fine )\n\t\t\treturn;\n\n\t\tconst chat = fine.searchParent(target, n => n.props && n.props.reply && n.setOPCardTray);\n\t\tif ( chat )\n\t\t\tchat.setOPCardTray(chat.props.reply);\n\t}\n\n\n\thandleMentionClick(event) {\n\t\tif ( ! this.context.get('chat.filtering.clickable-mentions') )\n\t\t\treturn;\n\n\t\tconst target = event.target,\n\t\t\tds = target && target.dataset;\n\n\t\tif ( ! ds || ! ds.login )\n\t\t\treturn;\n\n\t\tconst fine = this.resolve('site.fine');\n\t\tif ( ! fine )\n\t\t\treturn;\n\n\t\tconst chat = fine.searchParent(target, n => n.props && n.props.onUsernameClick);\n\t\tif ( ! chat )\n\t\t\treturn;\n\n\t\tchat.props.onUsernameClick(\n\t\t\tds.login,\n\t\t\tundefined, undefined,\n\t\t\tevent.currentTarget.getBoundingClientRect().bottom\n\t\t);\n\t}\n\n\n\tclickToReveal(event) {\n\t\tconst target = event.target;\n\t\tif ( target ) {\n\t\t\tif ( target._ffz_visible )\n\t\t\t\ttarget.textContent = '';\n\t\t\telse if ( ! this.context.get('chat.filtering.click-to-reveal') )\n\t\t\t\treturn;\n\t\t\telse if ( target.dataset )\n\t\t\t\ttarget.textContent = target.dataset.text;\n\n\t\t\ttarget._ffz_visible = ! target._ffz_visible;\n\t\t}\n\t}\n\n\n\tstandardizeWhisper(msg) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! msg )\n\t\t\treturn msg;\n\n\t\tif ( msg._ffz_message )\n\t\t\treturn msg._ffz_message;\n\n\t\tconst emotes = {},\n\t\t\tis_action = msg.content.startsWith('/me '),\n\t\t\toffset = is_action ? 4 : 0,\n\n\t\t\tout = msg._ffz_message = {\n\t\t\t\tid: msg.id,\n\t\t\t\tuser: {...msg.from}, // Apollo seals this~\n\t\t\t\tmessage: msg.content.slice(offset),\n\t\t\t\tis_action,\n\t\t\t\tffz_emotes: emotes,\n\t\t\t\ttimestamp: msg.sentAt && msg.sentAt.getTime(),\n\t\t\t\tdeleted: false\n\t\t\t};\n\n\t\tout.user.color = out.user.chatColor;\n\n\t\tif ( Array.isArray(msg.emotes) && msg.emotes.length )\n\t\t\tfor(const emote of msg.emotes) {\n\t\t\t\tconst id = emote.emoteID,\n\t\t\t\t\tem = emotes[id] = emotes[id] || [];\n\n\t\t\t\tem.push({\n\t\t\t\t\tstartIndex: emote.from - offset,\n\t\t\t\t\tendIndex: emote.to - offset\n\t\t\t\t});\n\t\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tgetUserLevel(msg) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! msg || ! msg.user )\n\t\t\treturn 0;\n\n\t\tif ( msg.user.login === msg.roomLogin || (msg.badges && msg.badges.broadcaster) )\n\t\t\treturn 4;\n\n\t\tif ( ! msg.badges )\n\t\t\treturn 0;\n\n\t\tif ( msg.badges.moderator )\n\t\t\treturn 3;\n\n\t\tif ( msg.badges.vip )\n\t\t\treturn 2;\n\n\t\tif ( msg.badges.subscriber )\n\t\t\treturn 1;\n\n\t\treturn 0;\n\t}\n\n\n\ttokenizeReply(reply) {\n\t\tif ( ! reply )\n\t\t\treturn null;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttype: 'reply',\n\t\t\t\ttext: reply.parentDisplayName,\n\t\t\t\tcolor: (this.context.get('chat.filtering.color-mentions') && this.color_cache)\n\t\t\t\t\t? this.color_cache.get(reply.parentUserLogin)\n\t\t\t\t\t: null,\n\t\t\t\trecipient: reply.parentUserLogin\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'text',\n\t\t\t\ttext: ' '\n\t\t\t}\n\t\t];\n\t}\n\n\n\tapplyHighlight(msg, priority, color, reason, use_null_color = false) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! msg )\n\t\t\treturn msg;\n\n\t\tconst is_null = msg.mention_priority == null,\n\t\t\tmatched = is_null || priority >= msg.mention_priority,\n\t\t\thigher = is_null || priority > msg.mention_priority;\n\n\t\tif ( msg.filters )\n\t\t\tmsg.filters.push(`${reason}(${priority})${matched && color === false ? ':remove' : color ? `:${color}` : ''}`);\n\n\t\tif ( matched ) {\n\t\t\tmsg.mention_priority = priority;\n\n\t\t\tif ( color === false ) {\n\t\t\t\tif ( higher ) {\n\t\t\t\t\tmsg.mentioned = false;\n\t\t\t\t\tmsg.clear_priority = priority;\n\t\t\t\t\tmsg.mention_color = msg.highlights = null;\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmsg.mentioned = true;\n\t\t\tif ( ! msg.highlights )\n\t\t\t\tmsg.highlights = new Set;\n\t\t}\n\n\t\tif ( msg.mentioned && (msg.clear_priority == null || priority >= msg.clear_priority) ) {\n\t\t\tmsg.highlights.add(reason);\n\t\t\tif ( (color || use_null_color) && (higher || ! msg.mention_color) )\n\t\t\t\tmsg.mention_color = color;\n\t\t}\n\t}\n\n\n\tstandardizeMessage(msg) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! msg )\n\t\t\treturn msg;\n\n\t\tmsg.ffz_standardized = true;\n\n\t\t// Standardize User\n\t\tif ( msg.sender && ! msg.user )\n\t\t\tmsg.user = msg.sender;\n\n\t\tif ( msg.from && ! msg.user )\n\t\t\tmsg.user = msg.from;\n\n\t\tlet user = msg.user;\n\t\tif ( ! user )\n\t\t\tuser = msg.user = {};\n\n\t\tconst ext = msg.extension || {};\n\n\t\tuser.color = user.color || user.chatColor || ext.chatColor || null;\n\t\tuser.type = user.type || user.userType || null;\n\t\tuser.id = user.id || user.userID || null;\n\t\tuser.login = user.login || user.userLogin || null;\n\t\tuser.displayName = user.displayName || user.userDisplayName || user.login || ext.displayName;\n\t\tuser.isIntl = user.login && user.displayName && user.displayName.trim().toLowerCase() !== user.login;\n\n\t\tif ( this.color_cache && user.color )\n\t\t\tthis.color_cache.set(user.login, user.color);\n\n\t\t// Standardize Message Content\n\t\tif ( ! msg.message && msg.messageParts )\n\t\t\tthis.detokenizeMessage(msg);\n\n\t\tif ( msg.content && ! msg.message ) {\n\t\t\tif ( msg.content.fragments )\n\t\t\t\tthis.detokenizeContent(msg);\n\t\t\telse\n\t\t\t\tmsg.message = msg.content.text;\n\t\t}\n\n\t\t// Standardize Emotes\n\t\tif ( ! msg.ffz_emotes )\n\t\t\tthis.standardizeEmotes(msg);\n\n\t\t// Standardize Badges\n\t\tif ( ! msg.badges && user.displayBadges ) {\n\t\t\tconst b = msg.badges = {};\n\t\t\tfor(const item of user.displayBadges)\n\t\t\t\tb[item.setID] = item.version;\n\t\t}\n\n\t\tif ( ! msg.badges && ext.displayBadges ) {\n\t\t\tconst b = msg.badges = {};\n\t\t\tfor(const item of ext.displayBadges)\n\t\t\t\tb[item.setID] = item.version;\n\t\t}\n\n\t\t// Validate User Type\n\t\tif ( user.type == null && msg.badges && msg.badges.moderator )\n\t\t\tuser.type = 'mod';\n\n\t\t// Standardize Timestamp\n\t\tif ( ! msg.timestamp && msg.sentAt )\n\t\t\tmsg.timestamp = new Date(msg.sentAt).getTime();\n\n\t\t// Standardize Deletion\n\t\tif ( msg.deletedAt !== undefined )\n\t\t\tmsg.deleted = !!msg.deletedAt;\n\n\t\t// Addon Badges\n\t\tmsg.ffz_badges = msg.sourceRoomID\n\t\t\t? this.badges.getBadges(user.id, user.login, msg.sourceRoomID, null)\n\t\t\t: this.badges.getBadges(user.id, user.login, msg.roomID, msg.roomLogin);\n\n\t\treturn msg;\n\t}\n\n\n\tstandardizeEmotes(msg) { // eslint-disable-line class-methods-use-this\n\t\tif ( msg.emotes && msg.message ) {\n\t\t\tconst emotes = {},\n\t\t\t\tchars = split_chars(msg.message);\n\n\t\t\tlet offset = 0;\n\t\t\tif ( msg.message && msg.messageBody && msg.message !== msg.messageBody )\n\t\t\t\toffset = chars.length - split_chars(msg.messageBody).length;\n\n\t\t\tfor(const key in msg.emotes)\n\t\t\t\tif ( has(msg.emotes, key) ) {\n\t\t\t\t\tconst raw_emote = msg.emotes[key];\n\t\t\t\t\tif ( Array.isArray(raw_emote) )\n\t\t\t\t\t\treturn msg.ffz_emotes = msg.emotes;\n\n\t\t\t\t\tconst em = emotes[raw_emote.id] = emotes[raw_emote.id] || [];\n\t\t\t\t\tlet idx = raw_emote.startIndex + 1 + offset;\n\t\t\t\t\twhile(idx < chars.length) {\n\t\t\t\t\t\tif ( EMOTE_CHARS.test(chars[idx]) )\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tidx++;\n\t\t\t\t\t}\n\n\t\t\t\t\tem.push({\n\t\t\t\t\t\tstartIndex: raw_emote.startIndex + offset,\n\t\t\t\t\t\tendIndex: idx - 1\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\tmsg.ffz_emotes = emotes;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( msg.messageParts )\n\t\t\tthis.detokenizeMessage(msg, true);\n\n\t\telse if ( msg.content && msg.content.fragments )\n\t\t\tthis.detokenizeContent(msg, true);\n\t}\n\n\n\tdetokenizeContent(msg, emotes_only = false) { // eslint-disable-line class-methods-use-this\n\t\tconst out = [],\n\t\t\tparts = msg.content.fragments,\n\t\t\tl = parts.length,\n\t\t\temotes = {};\n\n\t\tlet idx = 0, ret, first = true;\n\n\t\tfor(let i=0; i < l; i++) {\n\t\t\tconst part = parts[i],\n\t\t\t\tcontent = part.content,\n\t\t\t\tct = content && content.__typename;\n\n\t\t\tret = part.text;\n\n\t\t\tif ( ct === 'Emote' ) {\n\t\t\t\tconst id = content.emoteID,\n\t\t\t\t\tem = emotes[id] = emotes[id] || [];\n\n\t\t\t\tem.push({startIndex: idx, endIndex: idx + ret.length - 1});\n\t\t\t}\n\n\t\t\tif ( ret && ret.length ) {\n\t\t\t\tif ( first && ret.startsWith('/me ') ) {\n\t\t\t\t\tmsg.is_action = true;\n\t\t\t\t\tret = ret.slice(4);\n\t\t\t\t}\n\n\t\t\t\tidx += split_chars(ret).length;\n\t\t\t\tout.push(ret);\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif ( ! emotes_only )\n\t\t\tmsg.message = out.join('');\n\n\t\tmsg.ffz_emotes = emotes;\n\t\treturn msg;\n\t}\n\n\n\tdetokenizeMessage(msg, emotes_only = false) { // eslint-disable-line class-methods-use-this\n\t\tconst out = [],\n\t\t\tparts = msg.messageParts,\n\t\t\tl = parts.length,\n\t\t\temotes = {};\n\n\t\tlet idx = 0, ret, last_type = null, bits = 0;\n\n\t\tfor(let i=0; i < l; i++) {\n\t\t\tconst part = parts[i],\n\t\t\t\tcontent = part.ffz_content ?? part.content;\n\n\t\t\tif ( ! content )\n\t\t\t\tcontinue;\n\n\t\t\tif ( typeof content === 'string' )\n\t\t\t\tret = content;\n\n\t\t\telse if ( content.recipient )\n\t\t\t\tret = `@${content.recipient}`;\n\n\t\t\telse if ( content.url )\n\t\t\t\tret = content.url;\n\n\t\t\telse if ( content.cheerAmount ) {\n\t\t\t\tbits += content.cheerAmount;\n\t\t\t\tret = `${content.alt}${content.cheerAmount}`;\n\n\t\t\t} else if ( content.images ) {\n\t\t\t\tconst url = (content.images.themed ? content.images.dark : content.images.sources);\n\t\t\t\tlet id = content.emoteID;\n\t\t\t\tif ( ! id ) {\n\t\t\t\t\tconst match = url && (\n\t\t\t\t\t\t/\\/emoticons\\/v1\\/(\\d+)\\/[\\d.]+$/.exec(url['1x']) ||\n\t\t\t\t\t\t/\\/emoticons\\/v2\\/(\\d+)\\//.exec(url['1x'])\n\t\t\t\t\t);\n\t\t\t\t\tid = match && match[1];\n\t\t\t\t}\n\n\t\t\t\tret = content.alt;\n\n\t\t\t\tif ( id ) {\n\t\t\t\t\tconst em = emotes[id] = emotes[id] || [],\n\t\t\t\t\t\toffset = last_type > 0 ? 1 : 0;\n\n\t\t\t\t\tem.push({startIndex: idx + offset, endIndex: idx + ret.length - 1});\n\t\t\t\t}\n\n\t\t\t\tif ( last_type > 0 )\n\t\t\t\t\tret = ` ${ret}`;\n\n\t\t\t} else\n\t\t\t\tcontinue;\n\n\t\t\tif ( ret ) {\n\t\t\t\tidx += split_chars(ret).length;\n\t\t\t\tlast_type = part.type;\n\t\t\t\tout.push(ret)\n\t\t\t}\n\t\t}\n\n\t\tif ( ! emotes_only )\n\t\t\tmsg.message = out.join('');\n\n\t\tmsg.bits = bits;\n\t\tmsg.ffz_emotes = emotes;\n\t\treturn msg;\n\t}\n\n\n\t/**\n\t * Format a user block. This uses our use \"chat.name-format\" style.\n\t *\n\t * @param {Object} user The user object we're rendering.\n\t * @param {Function} e createElement method, either from React or utilities/dom.\n\t * @returns {Array} Array of rendered elements.\n\t */\n\tformatUser(user, e) {\n\t\tconst setting = this.context.get('chat.name-format');\n\t\tconst name = setting === 2 && user.isIntl ? user.login : (user.displayName || user.login);\n\n\t\tconst out = [e('span', {\n\t\t\tclassName: 'chat-author__display-name'\n\t\t}, name)];\n\n\t\tif ( setting === 0 && user.isIntl )\n\t\t\tout.push(e('span', {\n\t\t\t\tclassName: 'chat-author__intl-login'\n\t\t\t}, ` (${user.login})`));\n\n\t\treturn out;\n\t}\n\n\n\tformatTime(time) {\n\t\tif (!( time instanceof Date ))\n\t\t\ttime = new Date(time);\n\n\t\tconst fmt = this.context.get('chat.timestamp-format'),\n\t\t\td = dayjs(time);\n\n\t\ttry {\n\t\t\treturn d.locale(this.i18n.locale).format(fmt);\n\t\t} catch(err) {\n\t\t\t// If the locale isn't loaded, this can fail.\n\t\t\treturn d.format(fmt);\n\t\t}\n\t}\n\n\n\taddHighlightReason(key, data, label) {\n\t\tif ( typeof key === 'object' && key.key ) {\n\t\t\tdata = key;\n\t\t\tkey = data.key;\n\n\t\t} else if ( typeof data === 'string' )\n\t\t\tdata = {title: data};\n\n\t\tif ( typeof label === 'string' && label.length > 0 )\n\t\t\tdata.label = label;\n\n\t\tdata.value = data.key = key;\n\t\tif ( ! data.i18n_key )\n\t\t\tdata.i18n_key = `hl-reason.${key}`;\n\n\t\tif ( data.label && ! data.i18n_label )\n\t\t\tdata.i18n_label = `${data.i18n_key}.label`;\n\n\t\tif ( this._hl_reasons[key] )\n\t\t\tthrow new Error(`Highlight Reason already exists with key ${key}`);\n\n\t\tthis._hl_reasons[key] = data;\n\t}\n\n\tgetHighlightReason(key) {\n\t\treturn this._hl_reasons[key] ?? null;\n\t}\n\n\tgetHighlightReasons() {\n\t\treturn Object.values(this._hl_reasons);\n\t}\n\n\taddTabCommandPrefix(prefix, source = 'ffz') {\n\t\tif ( ! Array.isArray(prefix) )\n\t\t\tprefix = [prefix];\n\n\t\tfor(const item of prefix) {\n\t\t\tif ( typeof item !== 'string' || item.length !== 1 )\n\t\t\t\tthrow new Error('Invalid command prefix. Must be string of length 1.');\n\n\t\t\tthis.CommandPrefixes.push(source, item);\n\t\t}\n\t}\n\n\tremoveTabCommandPrefix(prefix, source = 'ffz') {\n\t\tif ( ! Array.isArray(prefix) )\n\t\t\tprefix = [prefix];\n\n\t\tfor(const item of prefix)\n\t\t\tthis.CommandPrefixes.remove(source, item);\n\t}\n\n\taddTokenizer(tokenizer) {\n\t\tconst type = tokenizer.type;\n\t\tif ( has(this.tokenizers, type) ) {\n\t\t\tthis.log.warn(`Tried adding tokenizer of type '${type}' when one was already present.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tokenizers[type] = tokenizer;\n\t\tif ( tokenizer.priority == null )\n\t\t\ttokenizer.priority = 0;\n\n\t\tif ( tokenizer.tooltip ) {\n\t\t\tconst tt = tokenizer.tooltip;\n\t\t\tconst tk = this.tooltips.types[type] = tt.bind(this);\n\n\t\t\tfor(const i of ['interactive', 'delayShow', 'delayHide', 'onShow', 'onHide'])\n\t\t\t\ttk[i] = typeof tt[i] === 'function' ? tt[i].bind(this) : tt[i];\n\t\t}\n\n\t\tthis.__tokenizers.push(tokenizer);\n\t\tthis.__tokenizers.sort((a, b) => {\n\t\t\tif ( a.priority > b.priority ) return -1;\n\t\t\tif ( a.priority < b.priority ) return 1;\n\t\t\treturn a.type < b.type;\n\t\t});\n\t}\n\n\tremoveTokenizer(tokenizer) {\n\t\tlet type;\n\t\tif ( typeof tokenizer === 'string' ) type = tokenizer;\n\t\telse type = tokenizer.type;\n\n\t\ttokenizer = this.tokenizers[type];\n\t\tif ( ! tokenizer )\n\t\t\treturn null;\n\n\t\tdelete this.tokenizers[type];\n\n\t\tif ( tokenizer.tooltip )\n\t\t\tdelete this.tooltips.types[type];\n\n\t\tconst idx = this.__tokenizers.indexOf(tokenizer);\n\t\tif ( idx !== -1 )\n\t\t\tthis.__tokenizers.splice(idx, 1);\n\n\t\treturn tokenizer;\n\t}\n\n\taddLinkProvider(provider) {\n\t\tconst type = provider.type;\n\t\tif ( has(this.link_providers, type) ) {\n\t\t\tthis.log.warn(`Tried adding link provider of type '${type}' when one was already present.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.link_providers[type] = provider;\n\t\tif ( provider.priority == null )\n\t\t\tprovider.priority = 0;\n\n\t\tthis.__link_providers.push(provider);\n\t\tthis.__link_providers.sort((a,b) => {\n\t\t\tif ( a.priority > b.priority ) return -1;\n\t\t\tif ( a.priority < b.priority ) return 1;\n\t\t\treturn a.type < b.type;\n\t\t});\n\t}\n\n\tremoveLinkProvider(provider) {\n\t\tlet type;\n\t\tif ( typeof provider === 'string' ) type = provider;\n\t\telse type = provider.type;\n\n\t\tprovider = this.link_providers[type];\n\t\tif ( ! provider )\n\t\t\treturn null;\n\n\t\tdelete this.link_providers[type];\n\n\t\tconst idx = this.__link_providers.indexOf(provider);\n\t\tif ( idx !== -1 )\n\t\t\tthis.__link_providers.splice(idx, 1);\n\n\t\treturn provider;\n\t}\n\n\taddRichProvider(provider) {\n\t\tconst type = provider.type;\n\t\tif ( has(this.rich_providers, type) ) {\n\t\t\tthis.log.warn(`Tried adding rich provider of type '${type}' when one was already present.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.rich_providers[type] = provider;\n\t\tif ( provider.priority == null )\n\t\t\tprovider.priority = 0;\n\n\t\tthis.__rich_providers.push(provider);\n\t\tthis.__rich_providers.sort((a,b) => {\n\t\t\tif ( a.priority > b.priority ) return -1;\n\t\t\tif ( a.priority < b.priority ) return 1;\n\t\t\treturn a.type < b.type;\n\t\t});\n\t}\n\n\tremoveRichProvider(provider) {\n\t\tlet type;\n\t\tif ( typeof provider === 'string' ) type = provider;\n\t\telse type = provider.type;\n\n\t\tprovider = this.rich_providers[type];\n\t\tif ( ! provider )\n\t\t\treturn null;\n\n\t\tdelete this.rich_providers[type];\n\n\t\tconst idx = this.__rich_providers.indexOf(provider);\n\t\tif ( idx !== -1 )\n\t\t\tthis.__rich_providers.splice(idx, 1);\n\n\t\treturn provider;\n\t}\n\n\n\ttokenizeString(message, msg, user, haltable = false) {\n\t\tlet tokens = [{type: 'text', text: message}];\n\n\t\tfor(const tokenizer of this.__tokenizers) {\n\t\t\tif ( ! tokenizer.process )\n\t\t\t\tcontinue;\n\n\t\t\tconst new_tokens = tokenizer.process.call(this, tokens, msg, user, haltable);\n\t\t\tif ( new_tokens )\n\t\t\t\ttokens = new_tokens;\n\n\t\t\tif ( haltable && msg.ffz_halt_tokens ) {\n\t\t\t\tmsg.ffz_halt_tokens = undefined;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn tokens;\n\t}\n\n\n\tpluckLastEmote(tokens) {\n\t\tif ( ! Array.isArray(tokens) )\n\t\t\treturn;\n\n\t\tlet i = tokens.length;\n\t\twhile(i--) {\n\t\t\tconst token = tokens[i];\n\t\t\tif (token.type === 'emote' && token.provider !== 'emoji') {\n\t\t\t\tif ( this.context.get('chat.emotes.allow-gigantify') ) {\n\t\t\t\t\ttoken.gigantify = true;\n\t\t\t\t\ttoken.hidden = true;\n\t\t\t\t\treturn token;\n\t\t\t\t} else {\n\t\t\t\t\tif (token.gigantify)\n\t\t\t\t\t\ttoken.hidden = false;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t} else if (token.hidden)\n\t\t\t\tcontinue;\n\t\t}\n\t}\n\n\n\tpluckRichContent(tokens, msg) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! this.context.get('chat.rich.enabled') || this.context.get('chat.rich.minimum-level') > this.getUserLevel(msg) )\n\t\t\treturn;\n\n\t\tif ( ! Array.isArray(tokens) )\n\t\t\treturn;\n\n\t\tconst providers = this.__rich_providers;\n\n\t\tconst want_mid = this.context.get('chat.rich.want-mid');\n\n\t\tfor(const token of tokens) {\n\t\t\tif ( token.allow_rich ?? true )\n\t\t\t\tfor(const provider of providers)\n\t\t\t\t\tif ( provider.test.call(this, token, msg) ) {\n\t\t\t\t\t\ttoken.hidden = provider.can_hide_token && (this.context.get('chat.rich.hide-tokens') || provider.hide_token);\n\t\t\t\t\t\treturn provider.process.call(this, token, want_mid);\n\t\t\t\t\t}\n\t\t}\n\t}\n\n\n\ttokenizeMessage(msg, user, haltable = false) {\n\t\tif ( msg.content && ! msg.message )\n\t\t\tmsg.message = msg.content.text;\n\n\t\tif ( msg.sender && ! msg.user )\n\t\t\tmsg.user = msg.sender;\n\n\t\tif ( ! msg.message )\n\t\t\treturn [];\n\n\t\tlet tokens = [{type: 'text', text: msg.message}];\n\n\t\tfor(const tokenizer of this.__tokenizers) {\n\t\t\tif ( ! tokenizer.process )\n\t\t\t\tcontinue;\n\n\t\t\tconst new_tokens = tokenizer.process.call(this, tokens, msg, user, haltable);\n\t\t\tif ( new_tokens )\n\t\t\t\ttokens = new_tokens;\n\n\t\t\tif ( haltable && msg.ffz_halt_tokens ) {\n\t\t\t\tmsg.ffz_halt_tokens = undefined;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn tokens || [];\n\t}\n\n\n\trenderGiantEmote(token, e) {\n\t\tif ( ! e )\n\t\t\te = createElement;\n\n\t\tconst animated = token.anim === 1,\n\t\t\thover_animated = token.anim === 2;\n\n\t\tlet src, hoverSrc, height;\n\t\tif (token.provider === 'twitch') {\n\t\t\tsrc = getTwitchEmoteURL(token.id, 4, animated, true);\n\t\t\tif (hover_animated)\n\t\t\t\thoverSrc = getTwitchEmoteURL(token.id, 4, true, true);\n\t\t\theight = 112;\n\n\t\t} else if (token.provider === 'ffz') {\n\t\t\tconst emote_set = this.emotes.emote_sets[token.set],\n\t\t\t\temote = emote_set?.emotes?.[token.id];\n\n\t\t\tif ( emote ) {\n\t\t\t\tlet urls = (animated ? emote.animated : null) ?? emote.urls;\n\t\t\t\tlet pair = getBiggestImage(urls);\n\t\t\t\tif (! pair )\n\t\t\t\t\treturn null;\n\n\t\t\t\tsrc = pair[0];\n\t\t\t\theight = emote.height * pair[1];\n\n\t\t\t\tif (hover_animated && emote.animated) {\n\t\t\t\t\tpair = getBiggestImage(emote.animated);\n\t\t\t\t\tif (pair)\n\t\t\t\t\t\thoverSrc = pair[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else\n\t\t\tsrc = null;\n\n\t\tif ( ! src )\n\t\t\treturn null;\n\n\t\treturn e('img', {\n\t\t\tclassName: `chat-image chat-line__message--emote ffz--pointer-events ffz-tooltip${hoverSrc ? ' ffz-hover-emote' : ''}${token.provider === 'twitch' ? ' twitch-emote' : token.provider === 'ffz' ? ' ffz-emote' : token.provider === 'emoji' ? ' ffz-emoji' : ''}`,\n\t\t\tsrc,\n\t\t\theight: `${height}px`,\n\t\t\talt: token.text,\n\t\t\t'data-normal-src': src,\n\t\t\t'data-hover-src': hoverSrc,\n\t\t\t'data-tooltip-type': 'emote',\n\t\t\t'data-provider': token.provider,\n\t\t\t'data-id': token.id,\n\t\t\t'data-set': token.set,\n\t\t\t'data-code': token.code,\n\t\t\t'data-variant': token.variant,\n\t\t\tonClick: this.emotes.handleClick\n\t\t});\n\t}\n\n\n\trenderTokens(tokens, e, reply) {\n\t\tif ( ! e )\n\t\t\te = createElement;\n\n\t\tconst out = [],\n\t\t\ttokenizers = this.tokenizers,\n\t\t\tl = tokens.length;\n\n\t\tconst hidden = this.context.get('chat.filtering.hidden-tokens');\n\n\t\tfor(let i=0; i < l; i++) {\n\t\t\tconst token = tokens[i],\n\t\t\t\ttype = token.type,\n\t\t\t\ttk = tokenizers[type];\n\n\t\t\tif ( token.hidden || hidden.has(type) )\n\t\t\t\tcontinue;\n\n\t\t\tlet res;\n\n\t\t\t// If we have a reply, skip the initial mention.\n\t\t\tif ( reply && i === 0 && type === 'mention' && token.recipient && token.recipient === reply.parentUserLogin )\n\t\t\t\tcontinue;\n\n\t\t\tif ( type === 'text' )\n\t\t\t\tres = e('span', {\n\t\t\t\t\tclassName: 'text-fragment',\n\t\t\t\t\t'data-a-target': 'chat-message-text'\n\t\t\t\t}, token.text);\n\n\t\t\telse if ( tk )\n\t\t\t\tres = tk.render.call(this, token, e, reply);\n\n\t\t\telse\n\t\t\t\tres = e('em', {\n\t\t\t\t\tclassName: 'ffz-unknown-token ffz-tooltip',\n\t\t\t\t\t'data-tooltip-type': 'json',\n\t\t\t\t\t'data-data': JSON.stringify(token, null, 2)\n\t\t\t\t}, `[unknown token: ${type}]`)\n\n\t\t\tif ( res )\n\t\t\t\tout.push(res);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\t// ====\n\t// Twitch Crap\n\t// ====\n\n\tclearLinkCache(url) {\n\t\tif ( url ) {\n\t\t\tconst info = this._link_info[url];\n\t\t\tif ( ! info[0] ) {\n\t\t\t\tfor(const pair of info[2])\n\t\t\t\t\tpair[1]();\n\t\t\t}\n\n\t\t\tthis._link_info[url] = null;\n\t\t\tthis.emit(':update-link-resolver', url);\n\t\t\treturn;\n\t\t}\n\n\t\tconst old = this._link_info;\n\t\tthis._link_info = {};\n\n\t\tfor(const info of Object.values(old)) {\n\t\t\tif ( ! info[0] ) {\n\t\t\t\tfor(const pair of info[2])\n\t\t\t\t\tpair[1]();\n\t\t\t}\n\t\t}\n\n\t\tthis.emit(':update-link-resolver');\n\t}\n\n\n\tget_link_info(url, no_promises, refresh = false) {\n\t\tlet info = this._link_info[url];\n\t\tconst expires = info && info[1];\n\n\t\tif ( (info && info[0] && refresh) || (expires && Date.now() > expires) )\n\t\t\tinfo = this._link_info[url] = null;\n\n\t\tif ( info && info[0] ) {\n\t\t\tconst out = this.handleLinkToS(info[2]);\n\t\t\treturn no_promises ? out : Promise.resolve(out);\n\t\t}\n\n\t\tif ( no_promises )\n\t\t\treturn null;\n\n\t\telse if ( info )\n\t\t\treturn new Promise((resolve, reject) => info[2].push([resolve, reject]))\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tinfo = this._link_info[url] = [false, null, [[resolve, reject]]];\n\n\t\t\tconst handle = (success, data) => {\n\t\t\t\tdata = this.fixLinkInfo(data);\n\n\t\t\t\tconst callbacks = ! info[0] && info[2];\n\t\t\t\tinfo[0] = true;\n\t\t\t\tinfo[1] = Date.now() + 120000;\n\t\t\t\tinfo[2] = success ? data : null;\n\n\t\t\t\tdata = this.handleLinkToS(data);\n\n\t\t\t\tif ( callbacks )\n\t\t\t\t\tfor(const cbs of callbacks)\n\t\t\t\t\t\tcbs[success ? 0 : 1](data);\n\t\t\t}\n\n\t\t\t// Try using a link provider.\n\t\t\tfor(const lp of this.__link_providers) {\n\t\t\t\tconst match = lp.test.call(this, url);\n\t\t\t\tif ( match ) {\n\t\t\t\t\ttimeout(lp.process.call(this, match), 15000)\n\t\t\t\t\t\t.then(data => handle(true, data))\n\t\t\t\t\t\t.catch(err => handle(false, err));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet provider = this.settings.get('debug.link-resolver.source').value;\n\t\t\tif ( provider === 'special:socket' && ! this.socket )\n\t\t\t\tprovider = LINK_DATA_HOSTS.test.value;\n\n\t\t\tif ( provider === 'special:socket' ) {\n\t\t\t\ttimeout(this.socket.call('get_link', url), 15000)\n\t\t\t\t\t.then(data => handle(true, data))\n\t\t\t\t\t.catch(err => handle(false, err));\n\t\t\t} else {\n\t\t\t\ttimeout(fetch(`${provider}?url=${encodeURIComponent(url)}`).then(r => r.json()), 15000)\n\t\t\t\t\t.then(data => handle(true, data))\n\t\t\t\t\t.catch(err => handle(false, err));\n\t\t\t}\n\t\t});\n\t}\n\n\n\thandleLinkToS(data) {\n\t\tif ( ! Array.isArray(data?.urls) )\n\t\t\treturn data;\n\n\t\t// Check for YouTube\n\t\tconst agreed = this.settings.provider.get('agreed-tos', []),\n\t\t\trejected = this.settings.provider.get('declined-tos', []);\n\n\t\tconst resolvers = new Set(data.urls.map(x => x.resolver).filter(x => x));\n\t\tfor(const [key, info] of Object.entries(RESOLVERS_REQUIRE_TOS)) {\n\t\t\tif ( resolvers.has(key) && ! agreed.includes(key) ) {\n\t\t\t\tconst declined = rejected.includes(key);\n\n\t\t\t\treturn {\n\t\t\t\t\t...data,\n\t\t\t\t\turl: null,\n\t\t\t\t\tshort: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'box',\n\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\tinfo.i18n_key\n\t\t\t\t\t\t\t\t\t? {type: 'i18n', key: info.i18n_key, phrase: info.label}\n\t\t\t\t\t\t\t\t\t: info.label,\n\t\t\t\t\t\t\t\tdeclined ? null : ' ',\n\t\t\t\t\t\t\t\tdeclined ? null : {\n\t\t\t\t\t\t\t\t\ttype: 'conditional',\n\t\t\t\t\t\t\t\t\ttooltip: false,\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\ttype: 'i18n',\n\t\t\t\t\t\t\t\t\t\tkey: 'embed.tos-open-settings',\n\t\t\t\t\t\t\t\t\t\tphrase: '{link} to open your settings.',\n\t\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'open_settings',\n\t\t\t\t\t\t\t\t\t\t\t\titem: 'chat.tooltips',\n\t\t\t\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'i18n',\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey: 'embed.tos-open-settings.click',\n\t\t\t\t\t\t\t\t\t\t\t\t\tphrase: 'Click here'\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\talternative: {\n\t\t\t\t\t\t\t\t\t\ttype: 'i18n',\n\t\t\t\t\t\t\t\t\t\tkey: 'embed.tos-settings',\n\t\t\t\t\t\t\t\t\t\tphrase: 'Open the FFZ Control Center and navigate to Chat > Tooltips to agree.'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tmid: null,\n\t\t\t\t\tfull: null\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n\n\n\tagreeToTerms(service) {\n\t\tconst agreed = this.settings.provider.get('agreed-tos', []);\n\t\tif ( agreed.includes(service) )\n\t\t\treturn;\n\n\t\tthis.settings.provider.set('agreed-tos', [...agreed, service]);\n\t\tthis.emit(':update-link-resolver');\n\t}\n\n\n\tdeclineTerms(service) {\n\t\tconst declined = this.settings.provider.get('declined-tos', []);\n\t\tif ( declined.includes(service) )\n\t\t\treturn;\n\n\t\tthis.settings.provider.set('declined-tos', [...declined, service]);\n\t\tthis.emit(':update-link-resolver');\n\t}\n\n\thasAgreedToTerms(service) {\n\t\tconst agreed = this.settings.provider.get('agreed-tos');\n\t\treturn agreed ? agreed.includes(service) : false;\n\t}\n\n\thasDeclinedTerms(service) {\n\t\tconst declined = this.settings.provider.get('declined-tos');\n\t\treturn declined ? declined.includes(service) : false;\n\t}\n\n\n\tonProviderChange(key, value) {\n\t\tif ( key !== 'agreed-tos' && key !== 'declined-tos' )\n\t\t\treturn;\n\n\t\tthis.emit(':update-link-resolver');\n\t}\n\n\n\tfixLinkInfo(data) {\n\t\tif ( ! data )\n\t\t\treturn data;\n\n\t\tif ( data.error && data.message )\n\t\t\tdata.error = data.message;\n\n\t\tif ( data.error )\n\t\t\tdata = {\n\t\t\t\tv: 5,\n\t\t\t\ttitle: this.i18n.t('card.error', 'An error occurred.'),\n\t\t\t\tdescription: data.error,\n\t\t\t\tshort: {\n\t\t\t\t\ttype: 'header',\n\t\t\t\t\timage: {type: 'image', url: ERROR_IMAGE},\n\t\t\t\t\ttitle: {type: 'i18n', key: 'card.error', phrase: 'An error occurred.'},\n\t\t\t\t\tsubtitle: data.error\n\t\t\t\t},\n\t\t\t\tunsafe: data.unsafe,\n\t\t\t\turls: data.urls\n\t\t\t}\n\n\t\tif ( data.v < 5 && ! data.short && ! data.full && (data.title || data.desc_1 || data.desc_2) ) {\n\t\t\tconst image = data.preview || data.image;\n\n\t\t\tdata = {\n\t\t\t\tv: 5,\n\t\t\t\tshort: {\n\t\t\t\t\ttype: 'header',\n\t\t\t\t\timage: image ? {\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\turl: image,\n\t\t\t\t\t\tsfw: data.image_safe ?? false,\n\t\t\t\t\t} : null,\n\t\t\t\t\ttitle: data.title,\n\t\t\t\t\tsubtitle: data.desc_1,\n\t\t\t\t\textra: data.desc_2\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n}\n\n\nfunction getBiggestImage(urls) {\n\tif (urls?.[4] )\n\t\treturn [urls[4], 4];\n\tif (urls?.[3] )\n\t\treturn [urls[3], 3];\n\tif (urls?.[2] )\n\t\treturn [urls[2], 2];\n\tif (urls?.[1] )\n\t\treturn [urls[1], 1];\n\treturn null;\n}\n","'use strict';\n\n// ============================================================================\n// Rich Content Providers\n// ============================================================================\n\nconst CLIP_URL = /^(?:https?:\\/\\/)?clips\\.twitch\\.tv\\/([a-z0-9-_=]+)(?:\\/)?(\\w+)?(?:\\/edit)?/i;\nconst NEW_CLIP_URL = /^(?:https?:\\/\\/)?(?:(?:www|m)\\.)?twitch\\.tv\\/\\w+\\/clip\\/([a-z0-9-_=]+)/i;\nconst VIDEO_URL = /^(?:https?:\\/\\/)?(?:www\\.)?twitch\\.tv\\/(?:\\w+\\/v|videos)\\/(\\w+)/;\nconst USER_URL = /^(?:https?:\\/\\/)?(?:www\\.)?twitch\\.tv\\/([^/]+)$/;\n\nconst BAD_USERS = [\n\t'directory', '_deck', 'p', 'downloads', 'jobs', 'turbo', 'settings', 'friends',\n\t'subscriptions', 'inventory', 'wallet', 'store', 'drops', 'search', 'prime'\n];\n\nimport GET_CLIP from './clip_info.gql';\nimport GET_VIDEO from './video_info.gql';\n\n\n// ============================================================================\n// Clips\n// ============================================================================\n\nexport const Clip = {\n\ttype: 'clip',\n\n\ttest(url) {\n\t\tconst match = CLIP_URL.exec(url) || NEW_CLIP_URL.exec(url);\n\t\tif ( match && match[1] && match[1] !== 'create' )\n\t\t\treturn match[1];\n\t},\n\n\treceive(match, data) {\n\t\tconst cd = data?.twitch_metadata?.clip_metadata;\n\t\tif ( ! cd )\n\t\t\treturn;\n\n\t\treturn {\n\t\t\tid: cd.id,\n\t\t\tslug: cd.slug,\n\t\t\ttitle: data.title,\n\t\t\tthumbnailURL: data.thumbnail_url,\n\t\t\tcurator: {\n\t\t\t\tid: cd.curator_id,\n\t\t\t\tdisplayName: data.author_name\n\t\t\t},\n\t\t\tbroadcaster: {\n\t\t\t\tid: cd.broadcaster_id,\n\t\t\t\tdisplayName: cd.channel_display_name\n\t\t\t},\n\t\t\tgame: {\n\t\t\t\tdisplayName: cd.game\n\t\t\t}\n\t\t}\n\t},\n\n\tasync process(match, received) {\n\t\tlet clip = received;\n\n\t\tif ( ! clip ) {\n\t\t\tconst apollo = this.resolve('site.apollo');\n\t\t\tif ( ! apollo )\n\t\t\t\treturn null;\n\n\t\t\tconst result = await apollo.client.query({\n\t\t\t\tquery: GET_CLIP,\n\t\t\t\tvariables: {\n\t\t\t\t\tslug: match\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tclip = result?.data?.clip;\n\t\t}\n\n\t\tif ( ! clip || ! clip.broadcaster )\n\t\t\treturn null;\n\n\t\t\tconst game = clip.game,\n\t\t\tgame_display = game && game.displayName;\n\n\t\tlet user = {\n\t\t\ttype: 'style', weight: 'semibold', color: 'alt-2',\n\t\t\tcontent: clip.broadcaster.displayName\n\t\t};\n\n\t\tif ( clip.broadcaster.login )\n\t\t\tuser = {\n\t\t\t\ttype: 'link', url: `https://www.twitch.tv/${clip.broadcaster.login}`,\n\t\t\t\tcontent: user\n\t\t\t};\n\n\t\tconst subtitle = game_display ? {\n\t\t\ttype: 'i18n', key: 'clip.desc.1.playing', phrase: '{user} playing {game}', content: {\n\t\t\t\tuser,\n\t\t\t\tgame: {type: 'style', weight: 'semibold', content: game_display}\n\t\t\t}\n\t\t} : {type: 'i18n', key: 'clip.desc.1', phrase: 'Clip of {user}', content: {user}};\n\n\t\tlet curator = clip.curator ? {\n\t\t\ttype: 'style', color: 'alt-2',\n\t\t\tcontent: clip.curator.displayName\n\t\t} : {type: 'i18n', key: 'clip.unknown', phrase: 'Unknown'};\n\n\t\tif ( clip.curator?.login )\n\t\t\tcurator = {\n\t\t\t\ttype: 'link', url: `https://www.twitch.tv/${clip.curator.login}`,\n\t\t\t\tcontent: curator\n\t\t\t};\n\n\t\tlet extra;\n\n\t\tif ( clip.viewCount > 0 )\n\t\t\textra = {\n\t\t\t\ttype: 'i18n', key: 'clip.desc.2',\n\t\t\t\tphrase: 'Clipped by {curator}  {views, plural, one {# View} other {# Views}}',\n\t\t\t\tcontent: {\n\t\t\t\t\tcurator,\n\t\t\t\t\tviews: clip.viewCount\n\t\t\t\t}\n\t\t\t};\n\t\telse\n\t\t\textra = {\n\t\t\t\ttype: 'i18n', key: 'clip.desc.no-views',\n\t\t\t\tphrase: 'Clipped by {curator}',\n\t\t\t\tcontent: {\n\t\t\t\t\tcurator\n\t\t\t\t}\n\t\t\t};\n\n\t\tconst header = {\n\t\t\ttype: 'header',\n\t\t\timage: {type: 'image', url: clip.thumbnailURL, sfw: true, aspect: 16/9},\n\t\t\ttitle: clip.title,\n\t\t\tsubtitle,\n\t\t\textra\n\t\t};\n\n\t\treturn {\n\t\t\taccent: '#6441a4',\n\n\t\t\tfragments: {\n\t\t\t\theader\n\t\t\t},\n\n\t\t\tshort: {type: 'ref', name: 'header'},\n\n\t\t\tfull: [\n\t\t\t\t{type: 'ref', name: 'header'},\n\t\t\t\t{\n\t\t\t\t\ttype: 'conditional',\n\t\t\t\t\tmedia: true,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: 'gallery',\n\t\t\t\t\t\titems: [{\n\t\t\t\t\t\t\ttype: 'player',\n\t\t\t\t\t\t\tiframe: `https://clips.twitch.tv/embed?parent=twitch.tv&clip=${match}`,\n\t\t\t\t\t\t\taspect: 16/9,\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\ttype: 'overlay',\n\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\turl: clip.thumbnailURL,\n\t\t\t\t\t\t\t\t\tsfw: true,\n\t\t\t\t\t\t\t\t\taspect: 16/9\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'center': {\n\t\t\t\t\t\t\t\t\ttype: 'style',\n\t\t\t\t\t\t\t\t\tsize: '2',\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\ttype: 'icon',\n\t\t\t\t\t\t\t\t\t\tname: 'play'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n}\n\n\n// ============================================================================\n// Users\n// ============================================================================\n\nexport const User = {\n\ttype: 'user',\n\n\ttest(url) {\n\t\tconst match = USER_URL.exec(url);\n\t\tif ( match && ! BAD_USERS.includes(match[1]) )\n\t\t\treturn match[1];\n\t},\n\n\tasync process(match) {\n\t\tconst twitch_data = this.resolve('site.twitch_data'),\n\t\t\tuser = twitch_data ? await twitch_data.getUser(null, match) : null;\n\n\t\tif ( ! user || ! user.id )\n\t\t\treturn null;\n\n\t\tconst game = user.broadcastSettings?.game?.displayName,\n\t\t\tstream_id = user.stream?.id;\n\n\t\tconst fragments = {\n\t\t\tavatar: {\n\t\t\t\ttype: 'image',\n\t\t\t\turl: user.profileImageURL,\n\t\t\t\trounding: -1,\n\t\t\t\taspect: 1\n\t\t\t},\n\t\t\tdesc: user.description,\n\t\t\ttitle: [user.displayName]\n\t\t};\n\n\t\tif ( stream_id && game )\n\t\t\tfragments.game = {type: 'style', weight: 'semibold', content: game};\n\n\t\tif ( user.displayName.trim().toLowerCase() !== user.login )\n\t\t\tfragments.title.push({\n\t\t\t\ttype: 'style', color: 'alt-2',\n\t\t\t\tcontent: [' (', user.login, ')']\n\t\t\t});\n\n\t\tif ( user.roles?.isPartner )\n\t\t\tfragments.title.push({\n\t\t\t\ttype: 'style', color: 'link',\n\t\t\t\tcontent: {type: 'icon', name: 'verified'}\n\t\t\t});\n\n\t\tconst full = [\n\t\t\t{\n\t\t\t\ttype: 'header',\n\t\t\t\timage: {type: 'ref', name: 'avatar'},\n\t\t\t\ttitle: {type: 'ref', name: 'title'},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'box',\n\t\t\t\t'mg-y': 'small',\n\t\t\t\twrap: 'pre-wrap',\n\t\t\t\tlines: 5,\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: 'ref',\n\t\t\t\t\tname: 'desc'\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif ( stream_id && game ) {\n\t\t\tconst thumb_url = user.stream.previewImageURL\n\t\t\t\t? user.stream.previewImageURL\n\t\t\t\t\t.replace('{width}', '320')\n\t\t\t\t\t.replace('{height}', '180')\n\t\t\t\t: null;\n\n\t\t\tfull.push({\n\t\t\t\ttype: 'link',\n\t\t\t\turl: `https://www.twitch.tv/${user.login}`,\n\t\t\t\tembed: true,\n\t\t\t\tinteractive: true,\n\t\t\t\ttooltip: false,\n\t\t\t\tcontent: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'conditional',\n\t\t\t\t\t\tmedia: true,\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\ttype: 'gallery',\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\turl: thumb_url,\n\t\t\t\t\t\t\t\t\taspect: 16/9\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'box',\n\t\t\t\t\t\t'mg-y': 'small',\n\t\t\t\t\t\tlines: 2,\n\t\t\t\t\t\tcontent: user.broadcastSettings.title\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'ref',\n\t\t\t\t\t\tname: 'game'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tfull.push({\n\t\t\ttype: 'header',\n\t\t\tcompact: true,\n\t\t\tsubtitle: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'icon',\n\t\t\t\t\tname: 'twitch'\n\t\t\t\t},\n\t\t\t\t' Twitch'\n\t\t\t]\n\t\t});\n\n\t\treturn {\n\t\t\tv: 5,\n\n\t\t\taccent: user.primaryColorHex ? `#${user.primaryColorHex}` : null,\n\t\t\tfragments,\n\n\t\t\tshort: {\n\t\t\t\ttype: 'header',\n\t\t\t\timage: {type: 'ref', name: 'avatar'},\n\t\t\t\ttitle: {type: 'ref', name: 'title'},\n\t\t\t\tsubtitle: {type: 'ref', name: 'desc'},\n\t\t\t\textra: stream_id ? {\n\t\t\t\t\ttype: 'i18n',\n\t\t\t\t\tkey: 'cards.user.streaming',\n\t\t\t\t\tphrase: 'streaming {game}',\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\tgame: {type: 'ref', name: 'game'}\n\t\t\t\t\t}\n\t\t\t\t} : null\n\t\t\t},\n\n\t\t\tfull\n\t\t}\n\t}\n\n}\n\n\n// ============================================================================\n// Videos\n// ============================================================================\n\nexport const Video = {\n\ttype: 'video',\n\n\ttest(url) {\n\t\tconst match = VIDEO_URL.exec(url);\n\t\tif ( match )\n\t\t\treturn match[1];\n\t},\n\n\tasync process(match) {\n\t\tconst apollo = this.resolve('site.apollo');\n\t\tif ( ! apollo )\n\t\t\treturn null;\n\n\t\tconst result = await apollo.client.query({\n\t\t\tquery: GET_VIDEO,\n\t\t\tvariables: {\n\t\t\t\tid: match\n\t\t\t}\n\t\t});\n\n\t\tif ( ! result || ! result.data || ! result.data.video || ! result.data.video.owner )\n\t\t\treturn null;\n\n\t\tconst video = result.data.video,\n\t\t\tgame = video.game,\n\t\t\tgame_display = game && game.displayName;\n\n\t\tconst fragments = {\n\t\t\ttitle: video.title,\n\t\t\tthumbnail: {\n\t\t\t\ttype: 'image',\n\t\t\t\turl: video.previewThumbnailURL,\n\t\t\t\taspect: 16/9\n\t\t\t}\n\t\t};\n\n\t\tconst user = {\n\t\t\ttype: 'link',\n\t\t\turl: `https://www.twitch.tv/${video.owner.login}`,\n\t\t\tcontent: {\n\t\t\t\ttype: 'style',\n\t\t\t\tweight: 'semibold',\n\t\t\t\tcolor: 'alt-2',\n\t\t\t\tcontent: video.owner.displayName\n\t\t\t}\n\t\t};\n\n\t\tfragments.subtitle = video.game?.displayName\n\t\t\t? {\n\t\t\t\ttype: 'i18n',\n\t\t\t\tkey: 'video.desc.1.playing',\n\t\t\t\tphrase: 'Video of {user} playing {game}',\n\t\t\t\tcontent: {\n\t\t\t\t\tuser,\n\t\t\t\t\tgame: {\n\t\t\t\t\t\ttype: 'style',\n\t\t\t\t\t\tweight: 'semibold',\n\t\t\t\t\t\tcontent: video.game.displayName\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t: {\n\t\t\t\ttype: 'i18n',\n\t\t\t\tkey: 'video.desc.1',\n\t\t\t\tphrase: 'Video of {user}',\n\t\t\t\tcontent: {\n\t\t\t\t\tuser\n\t\t\t\t}\n\t\t\t};\n\n\t\tlet length = video.lengthSeconds;\n\n\t\treturn {\n\t\t\tv: 5,\n\n\t\t\tfragments,\n\n\t\t\tshort: {\n\t\t\t\ttype: 'header',\n\t\t\t\timage: {type: 'ref', name: 'thumbnail'},\n\t\t\t\ttitle: {type: 'ref', name: 'title'},\n\t\t\t\tsubtitle: {type: 'ref', name: 'subtitle'},\n\t\t\t\textra: {\n\t\t\t\t\ttype: 'i18n',\n\t\t\t\t\tkey: 'video.desc.2',\n\t\t\t\t\tphrase: '{length,duration}  {views,number} Views  {date,datetime}',\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\tlength,\n\t\t\t\t\t\tviews: video.viewCount,\n\t\t\t\t\t\tdate: video.publishedAt\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tfull: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'header',\n\t\t\t\t\timage: {\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\turl: video.owner.profileImageURL,\n\t\t\t\t\t\trounding: -1,\n\t\t\t\t\t\taspect: 1\n\t\t\t\t\t},\n\t\t\t\t\ttitle: {type: 'ref', name: 'title'},\n\t\t\t\t\tsubtitle: {type: 'ref', name: 'subtitle'}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'box',\n\t\t\t\t\t'mg-y': 'small',\n\t\t\t\t\tlines: 5,\n\t\t\t\t\twrap: 'pre-wrap',\n\t\t\t\t\tcontent: video.description\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'conditional',\n\t\t\t\t\tmedia: true,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\ttype: 'gallery',\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'overlay',\n\t\t\t\t\t\t\t\tcontent: {type: 'ref', name: 'thumbnail'},\n\t\t\t\t\t\t\t\t'top-left': {\n\t\t\t\t\t\t\t\t\ttype: 'format',\n\t\t\t\t\t\t\t\t\tformat: 'duration',\n\t\t\t\t\t\t\t\t\tvalue: length\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'bottom-left': {\n\t\t\t\t\t\t\t\t\ttype: 'i18n',\n\t\t\t\t\t\t\t\t\tkey: 'video.views',\n\t\t\t\t\t\t\t\t\tphrase: '{views,number} views',\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\tviews: video.viewCount\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'header',\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tsubtitle: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'icon',\n\t\t\t\t\t\t\tname: 'twitch'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\" Twitch  \",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'format',\n\t\t\t\t\t\t\tformat: 'datetime',\n\t\t\t\t\t\t\tvalue: video.publishedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Rich Content Providers\n// ============================================================================\n\n// ============================================================================\n// General Links\n// ============================================================================\n\nexport const Links = {\n\ttype: 'link',\n\tcan_hide_token: true,\n\tpriority: -10,\n\n\ttest(token) {\n\t\tif ( token.type !== 'link' )\n\t\t\treturn false;\n\n\t\tconst url = token.url;\n\n\t\t// Link providers always result in embeds.\n\t\tfor(const provider of this.__link_providers) {\n\t\t\tif ( provider.test.call(this, url) )\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn this.context.get('chat.rich.all-links') || token.force_rich;\n\t},\n\n\tprocess(token, want_mid) {\n\t\treturn {\n\t\t\tcard_tooltip: true,\n\t\t\turl: token.url,\n\t\t\ttimeout: 0,\n\t\t\twant_mid,\n\n\t\t\tgetData: async (refresh = false) => {\n\t\t\t\tlet data;\n\t\t\t\ttry {\n\t\t\t\t\tdata = await this.get_link_info(token.url, false, refresh);\n\t\t\t\t} catch(err) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl: token.url,\n\t\t\t\t\t\terror: String(err)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( ! data )\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl: token.url\n\t\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...data,\n\t\t\t\t\tallow_media: this.context.get('tooltip.link-images'),\n\t\t\t\t\tallow_unsafe: this.context.get('tooltip.link-nsfw-images')\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Room\n// ============================================================================\n\nimport User from './user';\n\nimport {NEW_API, WEBKIT_CSS as WEBKIT, IS_FIREFOX} from 'utilities/constants';\n\nimport {ManagedStyle} from 'utilities/dom';\nimport {has, SourcedSet, set_equals} from 'utilities/object';\nimport { getBadgeCategory, fixBadgeData } from './badges';\n\n\nexport default class Room {\n\tconstructor(manager, id, login) {\n\t\tthis._destroy_timer = null;\n\n\t\tthis.refs = new Set;\n\t\tthis.style = new ManagedStyle(`room--${login}`);\n\n\t\tthis.emote_sets = null; // new SourcedSet;\n\t\tthis.badges = null;\n\t\tthis.users = {};\n\t\tthis.user_ids = {};\n\t\tthis.shared_chats = new Set;\n\n\t\tthis.manager = manager;\n\t\tthis._id = id;\n\t\tthis.login = login;\n\n\t\tif ( id )\n\t\t\tthis.manager.room_ids[id] = this;\n\n\t\tif ( id && this.manager.pubsub )\n\t\t\tthis.manager.pubsub.subscribe(this, `twitch/${id}`);\n\n\t\tthis.manager.emit(':room-add', this);\n\t\tthis.load_data();\n\t}\n\n\n\tdestroy() {\n\t\tclearTimeout(this._destroy_timer);\n\t\tthis._destroy_timer = null;\n\n\t\tthis.destroyed = true;\n\n\t\tthis.manager.emit(':room-remove', this);\n\n\t\tif ( this.users ) {\n\t\t\tfor(const user of Object.values(this.users))\n\t\t\t\tif ( user )\n\t\t\t\t\tuser.destroy();\n\t\t}\n\n\t\tif ( this.user_ids ) {\n\t\t\tfor(const user of Object.values(this.user_ids))\n\t\t\t\tif ( user )\n\t\t\t\t\tuser.destroy();\n\t\t}\n\n\t\tthis.shared_chats = null;\n\t\tthis.refs = null;\n\t\tthis.users = null;\n\t\tthis.user_ids = null;\n\n\t\tif ( this.style ) {\n\t\t\tthis.style.destroy();\n\t\t\tthis.style = null;\n\t\t}\n\n\t\tif ( this.emote_sets ) {\n\t\t\tfor(const set_id of this.emote_sets._cache)\n\t\t\t\tthis.manager.emotes.unrefSet(set_id);\n\n\t\t\tthis.emote_sets = null;\n\t\t}\n\n\t\tif ( this._login ) {\n\t\t\tif ( this.manager.rooms[this._login] === this )\n\t\t\t\tthis.manager.rooms[this._login] = null;\n\n\t\t\tif ( this.manager.socket )\n\t\t\t\tthis.manager.socket.unsubscribe(this, `room.${this.login}`);\n\t\t}\n\n\t\tif ( this._id && this.manager.pubsub )\n\t\t\tthis.manager.pubsub.unsubscribe(this, `twitch/${this._id}`);\n\n\t\tif ( this.manager.room_ids[this._id] === this )\n\t\t\tthis.manager.room_ids[this._id] = null;\n\t}\n\n0\n\tmerge(other) {\n\t\tif ( ! this.login && other.login )\n\t\t\tthis.login = other.login;\n\n\t\t// We skip a lot of data, assuming that we got valid information from FFZ's API.\n\n\t\tif ( other.refs )\n\t\t\tfor(const ref of other.refs)\n\t\t\t\tthis.ref(ref);\n\n\t\tif ( other.shared_chats )\n\t\t\tfor(const room of other.shared_chats )\n\t\t\t\tthis.shareChat(room);\n\n\t\tif ( other.emote_sets && other.emote_sets._sources ) {\n\t\t\tfor(const [provider, sets] of other.emote_sets._sources.entries()) {\n\t\t\t\tfor(const set_id of sets)\n\t\t\t\t\tthis.addSet(provider, set_id);\n\t\t\t}\n\t\t}\n\n\t\tif ( other.data && ! this.data ) {\n\t\t\tthis.data = other.data;\n\t\t\tif ( this.data.css )\n\t\t\t\tthis.style.set('css', this.data.css);\n\t\t\telse\n\t\t\t\tthis.style.delete('css');\n\n\t\t\tthis.buildModBadgeCSS();\n\t\t\tthis.buildVIPBadgeCSS();\n\t\t}\n\n\t\tif ( other.badges && ! this.badges ) {\n\t\t\tthis.badges = other.badges;\n\t\t\tthis.buildBadgeCSS();\n\t\t}\n\n\t\tif ( other.bitsConfig && ! this.bitsConfig ) {\n\t\t\tthis.bitsConfig = other.bitsConfig;\n\t\t\tthis.buildBitsCSS();\n\t\t}\n\n\t\tconst handled_users = new Set;\n\n\t\tif ( other.users )\n\t\t\tfor(const user of Object.values(other.users)) {\n\t\t\t\tif ( ! user.destroyed && ! handled_users.has(user) ) {\n\t\t\t\t\tthis.getUser(user.id, user.login).merge(user);\n\t\t\t\t\thandled_users.add(user);\n\t\t\t\t}\n\t\t\t}\n\n\t\tif ( other.user_ids )\n\t\t\tfor(const user of Object.values(other.user_ids)) {\n\t\t\t\tif ( ! user.destroyed && ! handled_users.has(user) ) {\n\t\t\t\t\tthis.getUser(user.id, user.login).merge(user);\n\t\t\t\t\thandled_users.add(user);\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\n\n\t// TODO: Logic?\n\n\tshareChat(room) {\n\t\tthis.shared_chats.add(room);\n\t}\n\n\tshareChats(rooms) {\n\t\tthis.shared_chats = new Set(rooms || []);\n\t}\n\n\tunshareChat(room) {\n\t\tif (room)\n\t\t\tthis.shared_chats.delete(room);\n\t\telse\n\t\t\tthis.shared_chats.clear();\n\t}\n\n\n\n\t_unloadAddon(addon_id) {\n\t\t// TODO: This\n\t\treturn 0;\n\t}\n\n\n\tget id() {\n\t\treturn this._id;\n\t}\n\n\tget login() {\n\t\treturn this._login;\n\t}\n\n\tset login(val) {\n\t\tif ( this._login === val )\n\t\t\treturn;\n\n\t\tif ( this._login ) {\n\t\t\tconst old_room = this.manager.rooms[this._login];\n\t\t\tif ( old_room === this ) {\n\t\t\t\tthis.manager.rooms[this._login] = null;\n\t\t\t\tif ( this.manager.socket )\n\t\t\t\t\tthis.manager.socket.unsubscribe(this, `room.${this.login}`);\n\t\t\t}\n\t\t}\n\n\t\tthis._login = val;\n\t\tif ( ! val )\n\t\t\treturn;\n\n\t\tconst old_room = this.manager.rooms[val];\n\t\tif ( old_room && old_room !== this )\n\t\t\told_room.login = null;\n\n\t\t// Make sure we didn't have a funky loop thing happen.\n\t\tthis._login = val;\n\t\tthis.manager.rooms[val] = this;\n\t\tif ( this.manager.socket )\n\t\t\tthis.manager.socket.subscribe(this, `room.${val}`);\n\t\tthis.manager.emit(':room-update-login', this, val);\n\t}\n\n\n\t*iterateUsers() {\n\t\tconst visited = new Set;\n\n\t\tfor(const user of Object.values(this.user_ids)) {\n\t\t\tif ( user && ! user.destroyed ) {\n\t\t\t\tvisited.add(user);\n\t\t\t\tyield user;\n\t\t\t}\n\t\t}\n\n\t\tfor(const user of Object.values(this.users)) {\n\t\t\tif ( user && ! user.destroyed )\n\t\t\t\tyield user;\n\t\t}\n\t}\n\n\n\tgetUser(id, login, no_create, no_login, error = false) {\n\t\tif ( this.destroyed )\n\t\t\treturn null;\n\n\t\tlet user;\n\t\tif ( id && typeof id === 'number' )\n\t\t\tid = `${id}`;\n\n\t\tif ( id && this.user_ids[id] )\n\t\t\tuser = this.user_ids[id];\n\n\t\telse if ( login && this.users[login] && ! no_login )\n\t\t\tuser = this.users[login];\n\n\t\tif ( user && user.destroyed )\n\t\t\tuser = null;\n\n\t\tif ( ! user ) {\n\t\t\tif ( no_create )\n\t\t\t\treturn null;\n\n\t\t\tuser = new User(this.manager, this, id, login);\n\t\t}\n\n\t\tif ( id && id !== user.id ) {\n\t\t\t// If the ID isn't what we expected, something is very wrong here.\n\t\t\t// Blame name changes.\n\t\t\tif ( user.id ) {\n\t\t\t\tthis.manager.log.warn(`Data mismatch for user #${id} -- Stored ID: ${user.id} -- Login: ${login} -- Stored Login: ${user.login}`);\n\t\t\t\tif ( error )\n\t\t\t\t\tthrow new Error('id mismatch');\n\n\t\t\t\t// Remove the old reference if we're going with this.\n\t\t\t\tif ( this.user_ids[user.id] === user )\n\t\t\t\t\tthis.user_ids[user.id] = null;\n\t\t\t}\n\n\t\t\t// Otherwise, we're just here to set the ID.\n\t\t\tuser._id = id;\n\t\t\tthis.user_ids[id] = user;\n\t\t}\n\n\t\tif ( login ) {\n\t\t\tconst other = this.users[login];\n\t\t\tif ( other ) {\n\t\t\t\tif ( other !== user && ! no_login ) {\n\t\t\t\t\t// If the other has an ID, something weird happened. Screw it\n\t\t\t\t\t// and just take over.\n\t\t\t\t\tif ( other.id )\n\t\t\t\t\t\tthis.users[login] = user;\n\t\t\t\t\telse {\n\t\t\t\t\t\tuser.merge(other);\n\t\t\t\t\t\tother.destroy();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tthis.users[login] = user;\n\t\t}\n\n\t\treturn user;\n\t}\n\n\n\t// ========================================================================\n\t// FFZ Data\n\t// ========================================================================\n\n\tasync load_data(tries = 0) {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tconst load_key = `ffz-room-${this.id ? `id:${this.id}` : this.login}`;\n\t\tthis.manager.load_tracker.schedule('chat-data', load_key);\n\n\t\tif ( this.manager.experiments.getAssignment('api_load') )\n\t\t\ttry {\n\t\t\t\tfetch(`${NEW_API}/v1/room/${this.id ? `id/${this.id}` : this.login}`).catch(() => {});\n\t\t\t} catch(err) { /* do nothing */ }\n\n\t\tlet response, data;\n\t\ttry {\n\t\t\tresponse = await fetch(`${this.manager.staging.api}/v1/room/${this.id ? `id/${this.id}` : this.login}`);\n\t\t} catch(err) {\n\t\t\ttries++;\n\t\t\tif ( tries < 10 )\n\t\t\t\treturn setTimeout(() => this.load_data(tries), 500 * tries);\n\n\t\t\tthis.manager.log.error(`Error loading room data for ${this.id}:${this.login}`, err);\n\t\t\tthis.manager.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! response.ok ) {\n\t\t\tthis.manager.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tdata = await response.json();\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`, err);\n\t\t\tthis.manager.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst old_badges = this.data?.user_badge_ids;\n\t\tif ( old_badges )\n\t\t\tfor(const badge_id in old_badges )\n\t\t\t\tif ( has(old_badges, badge_id) )\n\t\t\t\t\tfor(const user of old_badges[badge_id])\n\t\t\t\t\t\tthis.getUser(user, undefined).removeBadge('ffz', badge_id);\n\n\t\tconst d = data.room,\n\t\t\tid = `${d.twitch_id}`;\n\n\t\tif ( ! this._id ) {\n\t\t\tthis._id = id;\n\t\t\tthis.manager.room_ids[id] = this;\n\n\t\t} else if ( this._id !== id ) {\n\t\t\tthis.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${id}`);\n\t\t\tthis.manager.load_tracker.notify('chat-data', load_key, false);\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! this.login )\n\t\t\tthis.login = d.id;\n\t\telse if ( this.login !== d.id )\n\t\t\tthis.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got \"${d.id}\" from FFZ's API.`);\n\n\t\tthis.data = d;\n\n\t\tthis.removeAllSets('ffz-main');\n\n\t\tif ( d.set )\n\t\t\tthis.addSet('ffz-main', d.set);\n\n\t\tif ( data.sets )\n\t\t\tfor(const set_id in data.sets)\n\t\t\t\tif ( has(data.sets, set_id) )\n\t\t\t\t\tthis.manager.emotes.loadSetData(set_id, data.sets[set_id]);\n\n\t\tconst badges = d.user_badge_ids;\n\t\tif ( badges )\n\t\t\tfor(const badge_id in badges)\n\t\t\t\tif ( has(badges, badge_id) )\n\t\t\t\t\tfor(const user of badges[badge_id])\n\t\t\t\t\t\tthis.getUser(user, undefined).addBadge('ffz', badge_id);\n\n\t\tif ( d.css )\n\t\t\tthis.style.set('css', d.css);\n\t\telse\n\t\t\tthis.style.delete('css');\n\n\t\tthis.buildModBadgeCSS();\n\t\tthis.buildVIPBadgeCSS();\n\n\t\tthis.manager.load_tracker.notify('chat-data', load_key);\n\t\treturn true;\n\t}\n\n\n\t// ========================================================================\n\t// Emote Sets\n\t// ========================================================================\n\n\taddSet(provider, set_id, data) {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tif ( ! this.emote_sets )\n\t\t\tthis.emote_sets = new SourcedSet(false, this.manager.emotes.sourceSortFn);\n\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tlet changed = false, added = false;\n\t\tif ( ! this.emote_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tchanged = ! this.emote_sets.includes(set_id);\n\t\t\tthis.emote_sets.push(provider, set_id);\n\t\t\tadded = true;\n\t\t}\n\n\t\tif ( data )\n\t\t\tthis.manager.emotes.loadSetData(set_id, data);\n\n\t\tif ( changed ) {\n\t\t\tthis.manager.emotes.refSet(set_id);\n\t\t\tthis.manager.emotes.emit(':update-room-sets', this, provider, set_id, true);\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tremoveAllSets(provider) {\n\t\tif ( this.destroyed || ! this.emote_sets )\n\t\t\treturn false;\n\n\t\tconst sets = this.emote_sets.get(provider);\n\t\tif ( ! Array.isArray(sets) || ! sets.length )\n\t\t\treturn false;\n\n\t\tfor(const set_id of sets)\n\t\t\tthis.removeSet(provider, set_id);\n\n\t\treturn true;\n\t}\n\n\tremoveSet(provider, set_id) {\n\t\tif ( this.destroyed || ! this.emote_sets )\n\t\t\treturn;\n\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tif ( this.emote_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tthis.emote_sets.remove(provider, set_id);\n\t\t\tif ( ! this.emote_sets.includes(set_id) ) {\n\t\t\t\tthis.manager.emotes.unrefSet(set_id);\n\t\t\t\tthis.manager.emotes.emit(':update-room-sets', this, provider, set_id, false);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\n\t// ========================================================================\n\t// Life Cycle\n\t// ========================================================================\n\n\tref(referrer) {\n\t\tif ( ! this.refs )\n\t\t\tthrow new Error('Attempting to use destroyed Room');\n\n\t\tclearTimeout(this._destroy_timer);\n\t\tthis._destroy_timer = null;\n\t\tthis.refs.add(referrer);\n\t}\n\n\tunref(referrer) {\n\t\tif ( ! this.refs )\n\t\t\treturn;\n\n\t\tthis.refs.delete(referrer);\n\t\tif ( ! this.refs.size && ! this._destroy_timer )\n\t\t\tthis._destroy_timer = setTimeout(() => this.destroy(), 5000);\n\t}\n\n\n\t// ========================================================================\n\t// Badge Data\n\t// ========================================================================\n\n\tbadgeCount() {\n\t\treturn this.badge_count || 0;\n\t}\n\n\tupdateBadges(badges) {\n\t\tthis.badge_count = 0;\n\t\tif ( badges instanceof Map ) {\n\t\t\tconst b = {};\n\t\t\tfor(const [sid, variants] of badges.entries()) {\n\t\t\t\tconst bs = b[sid] = b[sid] || {\n\t\t\t\t\t__cat: getBadgeCategory(sid)\n\t\t\t\t};\n\n\t\t\t\tfor(const [version, data] of variants.entries()) {\n\t\t\t\t\tbs[version] = fixBadgeData(data);\n\t\t\t\t\tthis.badge_count++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.badges = b;\n\n\t\t} else if ( ! Array.isArray(badges) ) {\n\t\t\tthis.badges = badges;\n\n\t\t} else {\n\t\t\t// Rooms can have no badges, so we want to allow that.\n\t\t\tconst b = {};\n\t\t\tfor(const data of badges) {\n\t\t\t\tconst sid = data.setID,\n\t\t\t\t\tbs = b[sid] = b[sid] || {\n\t\t\t\t\t\t__cat: getBadgeCategory(sid)\n\t\t\t\t\t};\n\n\t\t\t\tbs[data.version] = fixBadgeData(data);\n\t\t\t\tthis.badge_count++;\n\t\t\t}\n\n\t\t\tthis.badges = b;\n\t\t}\n\n\t\tthis.buildBadgeCSS();\n\t}\n\n\tbuildVIPBadgeCSS() {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tif ( ! this.data || ! this.data.vip_badge || ! this.manager.context.get('chat.badges.custom-vip') )\n\t\t\treturn this.style.delete('vip-badge');\n\n\t\tconst urls = this.data.vip_badge,\n\t\t\timage = `url(\"${urls[1]}\")`;\n\n\t\tlet image_set;\n\t\tif ( urls[2] || urls[4] )\n\t\t\timage_set = `${WEBKIT}image-set(${image} 1x${urls[2] ? `, url(\"${urls[2]}\") 2x` : ''}${urls[4] ? `, url(\"${urls[4]}\") 4x` : ''})`;\n\n\t\tthis.style.set('vip-badge', `[data-room-id=\"${this.id}\"] .ffz-badge[data-badge=\"vip\"] {\n\t\t\tbackground-color: transparent;\n\t\t\tbackground-image: ${image};\n\t\t\t${image_set ? `background-image: ${image_set};` : ''}\n\t\t\t${WEBKIT}mask-image: unset;\n\t\t}`);\n\t}\n\n\tbuildModBadgeCSS() {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tif ( ! this.data || ! this.data.mod_urls || ! this.manager.context.get('chat.badges.custom-mod') )\n\t\t\treturn this.style.delete('mod-badge');\n\n\t\tconst style = this.manager.context.get('chat.badges.style'),\n\t\t\tmasked = style > 5 ? `${WEBKIT}mask` : 'background',\n\t\t\thas_image = style !== 3 && style !== 4;\n\n\t\tif ( ! has_image )\n\t\t\treturn this.style.delete('mod-badge');\n\n\t\tconst urls = this.data.mod_urls,\n\t\t\timage = `url(\"${urls[1]}\")`;\n\n\t\tlet image_set;\n\t\tif ( urls[2] || urls[4] )\n\t\t\timage_set = `${WEBKIT}image-set(${image} 1x${urls[2] ? `, url(\"${urls[2]}\") 2x` : ''}${urls[4] ? `, url(\"${urls[4]}\") 4x` : ''})`\n\n\t\tthis.style.set('mod-badge', `[data-room-id=\"${this.id}\"] .ffz-badge[data-badge=\"moderator\"] {\n\t\t\t${masked}-image: ${image};\n\t\t\t${image_set ? `${masked}-image: ${image_set};` : ''}\n\t\t}`);\n\t}\n\n\tbuildBadgeCSS() {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tif ( ! this.badges )\n\t\t\treturn this.style.delete('badges');\n\n\t\tconst use_media = IS_FIREFOX && this.manager.context.get('chat.badges.media-queries'),\n\t\t\tcan_click = this.manager.context.get('chat.badges.clickable'),\n\t\t\tout = [],\n\t\t\tid = this.id;\n\n\t\tfor(const key in this.badges)\n\t\t\tif ( has(this.badges, key) ) {\n\t\t\t\tconst versions = this.badges[key];\n\t\t\t\tfor(const version in versions)\n\t\t\t\t\tif ( has(versions, version) ) {\n\t\t\t\t\t\tconst data = versions[version],\n\t\t\t\t\t\t\tselector = `[data-room-id=\"${id}\"] .ffz-badge[data-badge=\"${key}\"][data-version=\"${version}\"]`;\n\n\t\t\t\t\t\tout.push(`${selector} {\n\t\t\t${can_click && (data.click_action || data.click_url) ? 'cursor:pointer;' : ''}\n\t\t\tbackground-color: transparent;\n\t\t\tfilter: none;\n\t\t\t${WEBKIT}mask-image: none;\n\t\t\theight: 1.8rem;\n\t\t\twidth: 1.8rem;\n\t\t\tbackground-size: 1.8rem;\n\t\t\tbackground-image: url(\"${data.image1x}\");\n\t\t\tbackground-image: ${WEBKIT}image-set(\n\t\t\t\turl(\"${data.image1x}\") 1x,\n\t\t\t\turl(\"${data.image2x}\") 2x,\n\t\t\t\turl(\"${data.image4x}\") 4x\n\t\t\t);\n\t\t}`);\n\n\t\t\t\t\t\tif ( use_media ) {\n\t\t\t\t\t\t\tout.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${selector} {\n\t\t\t\t\t\t\t\tbackground-image: url(\"${data.image2x}\");\n\t\t\t\t\t\t\t}}`);\n\t\t\t\t\t\t\tout.push(`@media (min-resolution: 200dpi) { ${selector} {\n\t\t\t\t\t\t\t\tbackground-image: url(\"${data.image4x}\");\n\t\t\t\t\t\t\t}}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\n\n\t\tthis.style.set('badges', out.join('\\n'));\n\t}\n\n\n\t// ========================================================================\n\t// Bits Data\n\t// ========================================================================\n\n\tupdateBitsConfig(config, force) {\n\t\tif ( ! force && this.bitsConfig && config ) {\n\t\t\tconst old_keys = new Set(Object.keys(this.bitsConfig)),\n\t\t\t\tnew_keys = new Set(Object.keys(config));\n\n\t\t\tif ( set_equals(old_keys, new_keys) )\n\t\t\t\treturn;\n\t\t}\n\n\t\tthis.bitsConfig = config;\n\t\tthis.buildBitsCSS();\n\t}\n\n\tbuildBitsCSS() {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tif ( ! this.bitsConfig )\n\t\t\treturn this.style.delete('bits');\n\n\t\tconst animated = this.manager.context.get('chat.bits.animated') ? 'animated' : 'static',\n\t\t\ttheme = this.manager.context.get('theme.is-dark') ? 'dark' : 'light',\n\t\t\ttt_theme = this.manager.context.get('theme.tooltips-dark') ? 'dark' : 'light',\n\t\t\tout = [];\n\n\t\tfor(const key in this.bitsConfig)\n\t\t\tif ( has(this.bitsConfig, key) ) {\n\t\t\t\tconst action = this.bitsConfig[key],\n\t\t\t\t\tprefix = action.prefix.toLowerCase(),\n\t\t\t\t\ttiers = action.tiers,\n\t\t\t\t\tl = tiers.length;\n\n\t\t\t\tfor(let i=0; i < l; i++) {\n\t\t\t\t\tconst images = tiers[i].images[theme][animated],\n\t\t\t\t\t\ttt_images = tiers[i].images[tt_theme][animated];\n\n\t\t\t\t\tout.push(`.ffz-cheer[data-prefix=\"${prefix}\"][data-tier=\"${i}\"] {\n\tcolor: ${tiers[i].color || 'inherit'};\n\tbackground-image: url(\"${images[1]}\");\n\tbackground-image: ${WEBKIT}image-set(\n\t\turl(\"${images[1]}\") 1x,\n\t\turl(\"${images[2]}\") 2x,\n\t\turl(\"${images[4]}\") 4x\n\t);\n}\n.ffz__tooltip .ffz-cheer[data-prefix=\"${prefix}\"][data-tier=\"${i}\"] {\n\tbackground-image: url(\"${tt_images[1]}\");\n\tbackground-image: ${WEBKIT}image-set(\n\t\turl(\"${tt_images[1]}\") 1x,\n\t\turl(\"${tt_images[2]}\") 2x,\n\t\turl(\"${tt_images[4]}\") 4x\n\t);\n}\n.ffz-cheer-preview[data-prefix=\"${prefix}\"][data-tier=\"${i}\"] {\n\tbackground-image: url(\"${tt_images[4]}\");\n}`)\n\t\t\t\t}\n\t\t\t}\n\n\t\tthis.style.set('bits', out.join('\\n'));\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Default Tokenizers\n// ============================================================================\n\nimport {sanitize, createElement} from 'utilities/dom';\nimport {has, getTwitchEmoteURL, split_chars, getTwitchEmoteSrcSet} from 'utilities/object';\nimport { NoContent } from 'utilities/tooltip';\n\nimport {EmoteTypes, IS_FIREFOX, REPLACEMENT_BASE, REPLACEMENTS, WEIRD_EMOTE_SIZES} from 'utilities/constants';\nimport {CATEGORIES, JOINER_REPLACEMENT} from './emoji';\n\nimport { MODIFIER_FLAGS } from './emotes';\n\nconst SHRINK_X = MODIFIER_FLAGS.ShrinkX,\n\tSLIDE_X = MODIFIER_FLAGS.Slide,\n\tSTRETCH_X = MODIFIER_FLAGS.GrowX;\n\t//SHRINK_Y = MODIFIER_FLAGS.ShrinkY,\n\t//STRETCH_Y = MODIFIER_FLAGS.GrowY,\n\n\nconst EMOTE_CLASS = 'chat-image chat-line__message--emote',\n\t//WHITESPACE = /^\\s*$/,\n\t//LINK_REGEX = /([^\\w@#%\\-+=:~])?((?:(https?:\\/\\/)?(?:[\\w@#%\\-+=:~]+\\.)+[a-z]{2,6}(?:\\/[\\w./@#%&()\\-+=:?~]*)?))([^\\w./@#%&()\\-+=:?~]|\\s|$)/g,\n\tNEW_LINK_REGEX = /(?:(https?:\\/\\/)?((?:[\\w#%\\-+=:~]+\\.)+[a-z]{2,10}(?:\\/[\\w./#%&@()\\-+=:?~]*[^\\s\\.!,?])?))/g,\n\t//OLD_NEW_LINK_REGEX = /(?:(https?:\\/\\/)?((?:[\\w#%\\-+=:~]+\\.)+[a-z]{2,10}(?:\\/[\\w./#%&@()\\-+=:?~]*)?))/g,\n\t//MENTION_REGEX = /([^\\w@#%\\-+=:~])?(@([^\\u0000-\\u007F]+|\\w+)+)([^\\w./@#%&()\\-+=:?~]|\\s|$)/g; // eslint-disable-line no-control-regex\n\tMENTION_REGEX = /^(['\"*([{<\\\\/]*)(@)((?:[^\\u0000-\\u007F]|[\\w-])+)(?:\\b|$)/; // eslint-disable-line no-control-regex\n\n\nexport const FilterTester = {\n\ttype: 'filter_test',\n\tpriority: 1000,\n\n\trender(token, createElement) {\n\t\tif ( ! token.msg.filters?.length )\n\t\t\treturn null;\n\n\t\treturn (<div class=\"ffz-pill tw-mg-l-1\">\n\t\t\t{ token.msg.filters.join(', ') }\n\t\t</div>);\n\t},\n\n\tprocess(tokens, msg) {\n\t\tif ( ! tokens || ! tokens.length || ! this.context.get('chat.filtering.debug') )\n\t\t\treturn;\n\n\t\tmsg.filters = [];\n\n\t\ttokens.push({\n\t\t\ttype: 'filter_test',\n\t\t\tmsg\n\t\t});\n\n\t\treturn tokens;\n\t}\n}\n\n\n// ============================================================================\n// Links\n// ============================================================================\n\nfunction datasetBool(value) {\n\treturn value == null ? null : value === 'true';\n}\n\nexport const Links = {\n\ttype: 'link',\n\tpriority: 50,\n\n\tcomponent: () => import(/* webpackChunkName: 'vue-chat' */ './components/chat-link.vue'),\n\n\trender(token, createElement) {\n\t\treturn (<a\n\t\t\tclass=\"ffz-tooltip link-fragment\"\n\t\t\tdata-tooltip-type=\"link\"\n\t\t\tdata-url={token.url}\n\t\t\tdata-is-mail={token.is_mail}\n\t\t\trel=\"noopener noreferrer\"\n\t\t\ttarget=\"_blank\"\n\t\t\thref={token.url}\n\t\t\tonClick={this.handleLinkClick}\n\t\t>{token.text}</a>);\n\t},\n\n\ttooltip(target, tip) {\n\t\tif ( ! this.context.get('tooltip.rich-links') && ! target.dataset.forceTooltip )\n\t\t\treturn NoContent;\n\n\t\tif ( target.dataset.isMail === 'true' )\n\t\t\treturn [this.i18n.t('tooltip.email-link', 'E-Mail {address}', {address: target.textContent})];\n\n\t\tconst url = target.dataset.url || target.href,\n\t\t\tshow_images = datasetBool(target.dataset.forceMedia) ?? this.context.get('tooltip.link-images'),\n\t\t\tshow_unsafe = datasetBool(target.dataset.forceUnsafe) ?? this.context.get('tooltip.link-nsfw-images');\n\n\t\treturn Promise.all([\n\t\t\timport(/* webpackChunkName: 'rich_tokens' */ 'utilities/rich_tokens'),\n\t\t\tthis.get_link_info(url)\n\t\t]).then(([rich_tokens, data]) => {\n\t\t\tif ( ! data || (data.v || 1) > rich_tokens.VERSION )\n\t\t\t\treturn '';\n\n\t\t\tconst ctx = {\n\t\t\t\ttList: (...args) => this.i18n.tList(...args),\n\t\t\t\ti18n: this.i18n,\n\n\t\t\t\tfragments: data.fragments,\n\t\t\t\ti18n_prefix: data.i18n_prefix,\n\n\t\t\t\ttooltip: true,\n\n\t\t\t\tallow_media: show_images,\n\t\t\t\tallow_unsafe: show_unsafe,\n\t\t\t\tonload: () => requestAnimationFrame(() => tip.update())\n\t\t\t};\n\n\t\t\tlet content;\n\t\t\tif ( tip.element ) {\n\t\t\t\ttip.element.classList.add('ffz-rich-tip');\n\t\t\t\ttip.element.classList.add('tw-align-left');\n\t\t\t}\n\n\t\t\tif ( tip.outer && data.accent ) {\n\t\t\t\ttip.outer.classList.add('ffz-accent-tip');\n\t\t\t\ttip.outer.style.setProperty('--ffz-color-accent', data.accent);\n\t\t\t}\n\n\t\t\tif ( data.full ) {\n\t\t\t\tcontent = rich_tokens.renderTokens(data.full, createElement, ctx);\n\n\t\t\t} else if ( data.mid ) {\n\t\t\t\tcontent = rich_tokens.renderTokens(data.mid, createElement, ctx);\n\n\t\t\t} else if ( data.short ) {\n\t\t\t\tcontent = rich_tokens.renderTokens(data.short, createElement, ctx);\n\n\t\t\t} else\n\t\t\t\tcontent = this.i18n.t('card.empty', 'No data was returned.');\n\n\t\t\tif ( ! data.urls )\n\t\t\t\treturn content;\n\n\t\t\tconst url_table = [];\n\t\t\tfor(let i=0; i < data.urls.length; i++) {\n\t\t\t\tconst url = data.urls[i];\n\n\t\t\t\turl_table.push(<tr>\n\t\t\t\t\t<td>{this.i18n.formatNumber(i + 1)}.</td>\n\t\t\t\t\t<td class=\"tw-c-text-alt-2 tw-pd-x-05 tw-word-break-all\">{url.url}</td>\n\t\t\t\t\t<td>{url.flags ? url.flags.map(flag => <span class=\"ffz-pill\">{flag.toLowerCase()}</span>) : null}</td>\n\t\t\t\t</tr>);\n\t\t\t}\n\n\t\t\tlet url_notice;\n\t\t\tif ( data.unsafe ) {\n\t\t\t\tconst reasons = Array.from(new Set(data.urls.map(url => url.flags).flat())).join(', ');\n\t\t\t\turl_notice = (<div class=\"ffz-i-attention\">\n\t\t\t\t\t{this.i18n.tList(\n\t\t\t\t\t\t'tooltip.link-unsafe',\n\t\t\t\t\t\t'Caution: This URL is has been flagged as potentially harmful by: {reasons}',\n\t\t\t\t\t\t{reasons: reasons.toLowerCase()}\n\t\t\t\t\t)}\n\t\t\t\t</div>);\n\t\t\t} else if ( data.urls.length > 1 )\n\t\t\t\turl_notice = this.i18n.t('tooltip.link-destination', 'Destination: {url}', {\n\t\t\t\t\turl: data.urls[data.urls.length-1].url\n\t\t\t\t});\n\n\t\t\tcontent = (<div>\n\t\t\t\t<div class=\"ffz--shift-hide\">\n\t\t\t\t\t{content}\n\t\t\t\t\t{url_notice ? <div class=\"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-align-center\">\n\t\t\t\t\t\t{url_notice}\n\t\t\t\t\t\t<div class=\" tw-font-size-8\">\n\t\t\t\t\t\t\t{this.i18n.t('tooltip.shift-detail', '(Shift for Details)')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div> : null}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ffz--shift-show tw-align-left\">\n\t\t\t\t\t<div class=\"tw-semibold tw-mg-b-05 tw-align-center\">\n\t\t\t\t\t\t{this.i18n.t('tooltip.link.urls', 'Visited URLs')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<table>{url_table}</table>\n\t\t\t\t</div>\n\t\t\t</div>);\n\n\t\t\treturn content;\n\n\t\t}).catch(error => {\n\t\t\tconsole.error(error);\n\t\t\treturn sanitize(this.i18n.t('tooltip.error', 'An error occurred. ({error})', {error}))\n\t\t});\n\t},\n\n\tprocess(tokens) {\n\t\tif ( ! tokens || ! tokens.length )\n\t\t\treturn;\n\n\t\tconst out = [];\n\t\tfor(const token of tokens) {\n\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\tout.push(token);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tNEW_LINK_REGEX.lastIndex = 0;\n\t\t\tconst text = token.text;\n\t\t\tlet idx = 0, match;\n\n\t\t\twhile((match = NEW_LINK_REGEX.exec(text))) {\n\t\t\t\tconst nix = match.index;\n\t\t\t\tif ( idx !== nix )\n\t\t\t\t\tout.push({type: 'text', text: text.slice(idx, nix)});\n\n\t\t\t\tlet url = match[0];\n\t\t\t\tif ( url.endsWith(')') ) {\n\t\t\t\t\tlet open = 1, i = url.length - 1;\n\t\t\t\t\twhile(i--) {\n\t\t\t\t\t\tconst chr = url[i];\n\t\t\t\t\t\tif ( chr === ')' )\n\t\t\t\t\t\t\topen++;\n\t\t\t\t\t\telse if ( chr === '(' )\n\t\t\t\t\t\t\topen--;\n\n\t\t\t\t\t\tif ( ! open )\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( open )\n\t\t\t\t\t\turl = url.slice(0, url.length - 1);\n\t\t\t\t}\n\n\t\t\t\tout.push({\n\t\t\t\t\ttype: 'link',\n\t\t\t\t\turl: `${match[1] ? '' : 'https://'}${url}`,\n\t\t\t\t\tis_mail: false,\n\t\t\t\t\ttext: url\n\t\t\t\t});\n\n\t\t\t\tidx = nix + url.length;\n\t\t\t}\n\n\t\t\tif ( idx < text.length )\n\t\t\t\tout.push({type: 'text', text: text.slice(idx)});\n\t\t}\n\n\t\treturn out;\n\t}\n}\n\nLinks.tooltip.interactive = function(target) {\n\tif ( ! this.context.get('tooltip.rich-links') || ! this.context.get('tooltip.link-interaction') || target.dataset.isMail === 'true' )\n\t\treturn false;\n\n\tconst info = this.get_link_info(target.dataset.url, true);\n\treturn info && info.interactive;\n};\n\nLinks.tooltip.delayHide = function(target) {\n\tif ( ! this.context.get('tooltip.rich-links') || target.dataset.isMail === 'true' )\n\t\treturn 0;\n\n\treturn 64;\n};\n\n\n// ============================================================================\n// Replies (Styled Like Mentions)\n// ============================================================================\n\nexport const Replies = {\n\ttype: 'reply',\n\tpriority: 0,\n\n\tcomponent: () => null,\n\n\trender(token, createElement) {\n\t\tlet color = token.color;\n\t\tif ( color ) {\n\t\t\tconst chat = this.resolve('site.chat');\n\t\t\tcolor = chat ? chat.colors.process(color) : color;\n\t\t}\n\n\t\treturn (<strong\n\t\t\tclass={`chat-line__message-mention ffz--pointer-events ffz-tooltip ffz--reply-mention ffz-i-threads${token.me ? ' ffz--mention-me' : ''}`}\n\t\t\tstyle={{color}}\n\t\t\tdata-tooltip-type=\"reply\"\n\t\t\tdata-login={token.recipient}\n\t\t\tonClick={this.handleReplyClick}\n\t\t>\n\t\t\t{token.text}\n\t\t</strong>)\n\t},\n\n\ttooltip(target) {\n\t\tconst fine = this.resolve('site.fine');\n\t\tif ( ! target || ! fine )\n\t\t\treturn null;\n\n\t\tconst chat = fine.searchParent(target, n => n.props && n.props.reply && n.setOPCardTray),\n\t\t\treply = chat?.props?.reply;\n\t\tif ( ! reply )\n\t\t\treturn null;\n\n\t\treturn [\n\t\t\tcreateElement('strong', {}, this.i18n.t('chat.reply-to', 'Replying To:')),\n\t\t\t'\\n\\n',\n\t\t\tcreateElement('div', {className: 'tw-align-left'}, [\n\t\t\t\tcreateElement('strong', {}, reply.parentDisplayName),\n\t\t\t\t': ',\n\t\t\t\treply.parentMessageBody\n\t\t\t])\n\t\t];\n\t}\n}\n\n\n// ============================================================================\n// Mentions\n// ============================================================================\n\nfunction mention_processAll(tokens, msg, user, color_mentions) {\n\tconst can_highlight_user = user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own'),\n\t\tpriority = this.context.get('chat.filtering.mention-priority');\n\n\tlet login, display, mentionable = false;\n\tif ( user && user.login && ! can_highlight_user ) {\n\t\tlogin = user.login.toLowerCase();\n\t\tdisplay = user.displayName && user.displayName.toLowerCase();\n\t\tif ( display === login )\n\t\t\tdisplay = null;\n\n\t\tmentionable = true;\n\t}\n\n\tconst out = [];\n\tfor(const token of tokens) {\n\t\tif ( token.type !== 'text' ) {\n\t\t\tout.push(token);\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet text = [];\n\n\t\tfor(const segment of token.text.split(/ +/)) {\n\t\t\tconst match = /^(@?)(\\S+?)(?:\\b|$)/.exec(segment);\n\t\t\tif ( match ) {\n\t\t\t\tlet recipient = match[2],\n\t\t\t\t\thas_at = match[1] === '@',\n\t\t\t\t\tmentioned = false;\n\n\t\t\t\tconst rlower = recipient ? recipient.toLowerCase() : '',\n\t\t\t\t\tcolor = this.color_cache ? this.color_cache.get(rlower) : null;\n\n\t\t\t\tif ( rlower === login || rlower === display )\n\t\t\t\t\tmentioned = true;\n\n\t\t\t\tif ( ! has_at && ! color && ! mentioned ) {\n\t\t\t\t\ttext.push(segment);\n\n\t\t\t\t} else {\n\t\t\t\t\t// If we have pending text, join it together.\n\t\t\t\t\tif ( text.length )  {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\ttext: `${text.join(' ')} `\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttext = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'mention',\n\t\t\t\t\t\ttext: match[0],\n\t\t\t\t\t\tme: mentioned,\n\t\t\t\t\t\tcolor: color_mentions ? color : null,\n\t\t\t\t\t\trecipient: rlower\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( mentioned )\n\t\t\t\t\t\tthis.applyHighlight(msg, priority, null, 'mention', true);\n\n\t\t\t\t\t// Push the remaining text from the token.\n\t\t\t\t\ttext.push(segment.substr(match[0].length));\n\t\t\t\t}\n\n\t\t\t} else\n\t\t\t\ttext.push(segment);\n\t\t}\n\n\t\tif ( text.length > 1 || (text.length === 1 && text[0] !== '') )\n\t\t\tout.push({type: 'text', text: text.join(' ')})\n\t}\n\n\treturn out;\n}\n\nexport const Mentions = {\n\ttype: 'mention',\n\tpriority: 0,\n\n\tcomponent: () => import(/* webpackChunkName: 'vue-chat' */ './components/chat-mention.vue'),\n\n\t/*oldRender(token, createElement) {\n\t\treturn (<strong class={`chat-line__message-mention${token.me ? ' ffz--mention-me' : ''}`}>\n\t\t\t{token.text}\n\t\t</strong>);\n\t},*/\n\n\trender(token, createElement) {\n\t\tlet color = token.color;\n\t\tif ( color ) {\n\t\t\tconst chat = this.resolve('site.chat');\n\t\t\tcolor = chat ? chat.colors.process(color) : color;\n\t\t}\n\n\t\treturn (<strong\n\t\t\tclass={`chat-line__message-mention${token.me ? ' ffz--mention-me' : ''} ffz--pointer-events`}\n\t\t\tstyle={{color}}\n\t\t\tdata-login={token.recipient}\n\t\t\tonClick={this.handleMentionClick}\n\t\t>\n\t\t\t{token.text}\n\t\t</strong>)\n\t},\n\n\tprocess(tokens, msg, user) {\n\t\tif ( ! tokens || ! tokens.length )\n\t\t\treturn;\n\n\t\tconst all_mentions = this.context.get('chat.filtering.all-mentions'),\n\t\t\tcolor_mentions = this.context.get('chat.filtering.color-mentions');\n\n\t\tif ( all_mentions )\n\t\t\treturn mention_processAll.call(this, tokens, msg, user, color_mentions);\n\n\t\tconst can_highlight_user = user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own'),\n\t\t\tpriority = this.context.get('chat.filtering.mention-priority');\n\n\t\tlet regex, login, display, mentionable = false;\n\t\tif ( user && user.login && ! can_highlight_user ) {\n\t\t\tlogin = user.login.toLowerCase();\n\t\t\tdisplay = user.displayName && user.displayName.toLowerCase();\n\t\t\tif ( display === login )\n\t\t\t\tdisplay = null;\n\n\t\t\tmentionable = true;\n\t\t\tregex = new RegExp(`^(['\"*([{<\\\\/]*)(?:(@?)(${user.login.toLowerCase()}${display ? `|${display}` : ''})|@((?:[^\\u0000-\\u007F]|[\\\\w-])+))(?:\\\\b|$)`, 'i');\n\t\t} else\n\t\t\tregex = MENTION_REGEX;\n\n\t\tconst out = [];\n\t\tfor(const token of tokens) {\n\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\tout.push(token);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet text = [];\n\n\t\t\tfor(const segment of token.text.split(/ +/)) {\n\t\t\t\tconst match = regex.exec(segment);\n\t\t\t\tif ( match ) {\n\t\t\t\t\t// If we have pending text, join it together.\n\t\t\t\t\tif ( text.length || match[1])  {\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\ttext: `${text.join(' ')} ${match[1] || ''}`\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttext = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tlet recipient,\n\t\t\t\t\t\tmentioned = false,\n\t\t\t\t\t\tat = match[2];\n\n\t\t\t\t\tif ( match[4] ) {\n\t\t\t\t\t\trecipient = match[4];\n\t\t\t\t\t\tat = '@';\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\trecipient = match[3];\n\t\t\t\t\t\tmentioned = mentionable;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst rlower = recipient ? recipient.toLowerCase() : '',\n\t\t\t\t\t\tcolor = (color_mentions && this.color_cache) ? this.color_cache.get(rlower) : null;\n\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'mention',\n\t\t\t\t\t\ttext: `${at}${recipient}`,\n\t\t\t\t\t\tme: mentioned,\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\trecipient: rlower\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( mentioned )\n\t\t\t\t\t\tthis.applyHighlight(msg, priority, null, 'mention', true);\n\n\t\t\t\t\t// Push the remaining text from the token.\n\t\t\t\t\ttext.push(segment.substr(match[0].length));\n\n\t\t\t\t} else\n\t\t\t\t\ttext.push(segment);\n\t\t\t}\n\n\t\t\tif ( text.length > 1 || (text.length === 1 && text[0] !== '') )\n\t\t\t\tout.push({type: 'text', text: text.join(' ')})\n\t\t}\n\n\t\treturn out;\n\t}\n}\n\n\n// ============================================================================\n// Custom Highlight Terms\n// ============================================================================\n\nexport const UserHighlights = {\n\ttype: 'user_highlight',\n\tpriority: 90,\n\n\tprocess(tokens, msg, user) {\n\t\tif ( user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own') )\n\t\t\treturn;\n\n\t\tconst list = this.context.get('__filter:highlight-users');\n\t\tif ( ! list || ! list.length )\n\t\t\treturn;\n\n\t\tconst u = msg.user;\n\t\tfor(const [priority, color, regex] of list) {\n\t\t\tif ( regex.test(u.login) || regex.test(u.displayName) )\n\t\t\t\tthis.applyHighlight(msg, priority, color, 'user');\n\t\t}\n\t}\n}\n\nexport const BlockedUsers = {\n\ttype: 'user_block',\n\tpriority: 100,\n\n\tprocess(tokens, msg, user, haltable) {\n\t\tif ( user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own') )\n\t\t\treturn;\n\n\t\tconst u = msg.user,\n\t\t\tregexes = this.context.get('__filter:block-users');\n\t\tif ( ! regexes )\n\t\t\treturn;\n\n\t\tif ( regexes[1] && (regexes[1].test(u.login) || regexes[1].test(u.displayName)) ) {\n\t\t\tmsg.deleted = true;\n\t\t\tmsg.ffz_removed = true;\n\t\t\tif ( haltable )\n\t\t\t\tmsg.ffz_halt_tokens = true;\n\n\t\t} else if ( ! msg.deleted && regexes[0] && (regexes[0].test(u.login) || regexes[0].test(u.displayName)) )\n\t\t\tmsg.deleted = true;\n\t}\n}\n\nfunction getBadgeIDs(msg) {\n\tlet keys = msg.badges ? Object.keys(msg.badges) : null;\n\tif ( ! msg.ffz_badges )\n\t\treturn keys;\n\n\tif ( ! keys )\n\t\tkeys = [];\n\n\tfor(const badge of msg.ffz_badges)\n\t\tif ( badge?.id )\n\t\t\tkeys.push(badge.id);\n\n\treturn keys;\n}\n\nexport const BadgeStuff = {\n\ttype: 'badge_stuff',\n\tpriority: 97,\n\n\tprocess(tokens, msg, user, haltable) {\n\t\tif ( user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own') )\n\t\t\treturn;\n\n\t\tconst highlights = this.context.get('__filter:highlight-badges'),\n\t\t\tlist = this.context.get('__filter:block-badges');\n\n\t\tif ( ! highlights && ! list )\n\t\t\treturn;\n\n\t\tconst keys = getBadgeIDs(msg);\n\t\tif ( ! keys || ! keys.length )\n\t\t\treturn;\n\n\t\tfor(const badge of keys) {\n\t\t\tif ( list && list[1].includes(badge) ) {\n\t\t\t\tmsg.deleted = true;\n\t\t\t\tmsg.ffz_removed = true;\n\t\t\t\tif ( haltable )\n\t\t\t\t\tmsg.ffz_halt_tokens = true;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( list && ! msg.deleted && list[0].includes(badge) )\n\t\t\t\tmsg.deleted = true;\n\n\t\t\tif ( highlights && highlights.has(badge) ) {\n\t\t\t\tconst details = highlights.get(badge);\n\t\t\t\tif ( Array.isArray(details) && details.length > 1 )\n\t\t\t\t\tthis.applyHighlight(msg, details[0], details[1], 'badge');\n\t\t\t}\n\t\t}\n\t}\n}\n\n/*export const BlockedBadges = {\n\ttype: 'badge_block',\n\tpriority: 100,\n\tprocess(tokens, msg, user, haltable) {\n\t\tif ( user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own') )\n\t\t\treturn tokens;\n\n\t\tconst list = this.context.get('__filter:block-badges');\n\t\tif ( ! list || (! list[0].length && ! list[1].length) )\n\t\t\treturn tokens;\n\n\t\tconst keys = getBadgeIDs(msg);\n\t\tif ( ! keys || ! keys.length )\n\t\t\treturn tokens;\n\n\t\tfor(const badge of keys) {\n\t\t\tif ( list[1].includes(badge) ) {\n\t\t\t\tmsg.deleted = true;\n\t\t\t\tmsg.ffz_removed = true;\n\t\t\t\tif ( haltable )\n\t\t\t\t\tmsg.ffz_halt_tokens = true;\n\t\t\t\treturn tokens;\n\t\t\t}\n\n\t\t\tif ( ! msg.deleted && list[0].includes(badge) )\n\t\t\t\tmsg.deleted = true;\n\t\t}\n\n\t\treturn tokens;\n\t}\n}*/\n\nexport const CustomHighlights = {\n\ttype: 'highlight',\n\tpriority: 35,\n\n\tcomponent: () => import(/* webpackChunkName: 'vue-chat' */ './components/chat-highlight.vue'),\n\n\trender(token, createElement) {\n\t\treturn (<strong class=\"ffz--highlight\">{token.text}</strong>);\n\t},\n\n\tprocess(tokens, msg, user) {\n\t\tif ( ! tokens || ! tokens.length )\n\t\t\treturn;\n\n\t\tif ( user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own') )\n\t\t\treturn;\n\n\t\tconst data = this.context.get('__filter:highlight-terms');\n\t\tif ( ! data )\n\t\t\treturn;\n\n\t\tlet had_match = false;\n\t\tif ( data.non ) {\n\t\t\tfor(const [priority, color, regexes] of data.non) {\n\t\t\t\tif ( had_match && msg.mention_priority != null && msg.mention_priority > priority )\n\t\t\t\t\tbreak;\n\n\t\t\t\tlet matched = false;\n\t\t\t\tif ( regexes[0] ) {\n\t\t\t\t\tregexes[0].lastIndex = 0;\n\t\t\t\t\tmatched = regexes[0].test(msg.message);\n\t\t\t\t}\n\t\t\t\tif ( ! matched && regexes[1] ) {\n\t\t\t\t\tregexes[1].lastIndex = 0;\n\t\t\t\t\tmatched = regexes[1].test(msg.message);\n\t\t\t\t}\n\n\t\t\t\tif ( matched ) {\n\t\t\t\t\thad_match = true;\n\t\t\t\t\tthis.applyHighlight(msg, priority, color, 'term');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( ! data.hl )\n\t\t\treturn tokens;\n\n\t\tfor(const [priority, color, regexes] of data.hl) {\n\t\t\tconst out = [];\n\t\t\tfor(const token of tokens) {\n\t\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\t\tout.push(token);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst text = token.text;\n\t\t\t\tlet idx = 0, match;\n\n\t\t\t\twhile(idx < text.length) {\n\t\t\t\t\tif ( regexes[0] )\n\t\t\t\t\t\tregexes[0].lastIndex = idx;\n\t\t\t\t\tif ( regexes[1] )\n\t\t\t\t\t\tregexes[1].lastIndex = idx;\n\n\t\t\t\t\tmatch = regexes[0] ? regexes[0].exec(text) : null;\n\t\t\t\t\tconst second = regexes[1] ? regexes[1].exec(text) : null;\n\t\t\t\t\tif ( second && (! match || match.index > second.index) )\n\t\t\t\t\t\tmatch = second;\n\n\t\t\t\t\tif ( ! match )\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tconst raw_nix = match.index,\n\t\t\t\t\t\toffset = match[1] ? match[1].length : 0,\n\t\t\t\t\t\tnix = raw_nix + offset;\n\n\t\t\t\t\tif ( idx !== nix )\n\t\t\t\t\t\tout.push({type: 'text', text: text.slice(idx, nix)});\n\n\t\t\t\t\tthis.applyHighlight(msg, priority, color, 'term');\n\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'highlight',\n\t\t\t\t\t\ttext: match[0].slice(offset)\n\t\t\t\t\t});\n\n\t\t\t\t\tidx = raw_nix + match[0].length;\n\t\t\t\t}\n\n\t\t\t\tif ( idx < text.length )\n\t\t\t\t\tout.push({type: 'text', text: text.slice(idx)});\n\t\t\t}\n\n\t\t\ttokens = out;\n\t\t}\n\n\t\treturn tokens;\n\t}\n}\n\n\nfunction blocked_process(tokens, msg, regexes, do_remove, haltable) {\n\tconst out = [];\n\tfor(const token of tokens) {\n\t\tif ( token.type !== 'text' ) {\n\t\t\tout.push(token);\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst text = token.text;\n\t\tlet idx = 0, match;\n\n\t\twhile(idx < text.length) {\n\t\t\tif ( regexes[0] )\n\t\t\t\tregexes[0].lastIndex = idx;\n\t\t\tif ( regexes[1] )\n\t\t\t\tregexes[1].lastIndex = idx;\n\n\t\t\tmatch = regexes[0] ? regexes[0].exec(text) : null;\n\t\t\tconst second = regexes[1] ? regexes[1].exec(text) : null;\n\t\t\tif ( second && (! match || match.index > second.index) )\n\t\t\t\tmatch = second;\n\n\t\t\tif ( ! match )\n\t\t\t\tbreak;\n\n\t\t\tconst raw_nix = match.index,\n\t\t\t\toffset = match[1] ? match[1].length : 0,\n\t\t\t\tnix = raw_nix + offset;\n\n\t\t\tif ( idx !== nix )\n\t\t\t\tout.push({type: 'text', text: text.slice(idx, nix)});\n\n\t\t\tif ( do_remove ) {\n\t\t\t\tmsg.ffz_removed = true;\n\t\t\t\tif ( haltable )\n\t\t\t\t\treturn tokens;\n\t\t\t}\n\n\t\t\tout.push({\n\t\t\t\ttype: 'blocked',\n\t\t\t\ttext: match[0].slice(offset)\n\t\t\t});\n\n\t\t\tidx = raw_nix + match[0].length\n\t\t}\n\n\t\tif ( idx < text.length )\n\t\t\tout.push({type: 'text', text: text.slice(idx)});\n\t}\n\n\treturn out;\n}\n\n\nexport const BlockedTerms = {\n\ttype: 'blocked',\n\tpriority: 99,\n\n\tcomponent: () => import(/* webpackChunkName: 'vue-chat' */ './components/chat-blocked.vue'),\n\n\trender(token, createElement) {\n\t\treturn (<strong\n\t\t\tdata-text={token.text}\n\t\t\tdata-tooltip-type=\"blocked\"\n\t\t\tclass=\"ffz-tooltip ffz--blocked ffz--pointer-events\"\n\t\t\tonClick={this.clickToReveal}\n\t\t>\n\t\t\t&times;&times;&times;\n\t\t</strong>);\n\t},\n\n\ttooltip(target) {\n\t\tconst ds = target.dataset;\n\t\treturn [\n\t\t\t(<div class=\"tw-border-b tw-mg-b-05\">{ // eslint-disable-line react/jsx-key\n\t\t\t\tthis.i18n.t('chat.filtering.blocked-term', 'Blocked Term')\n\t\t\t}</div>),\n\t\t\tds.text\n\t\t]\n\t},\n\n\tprocess(tokens, msg, user, haltable) {\n\t\tif ( ! tokens || ! tokens.length )\n\t\t\treturn;\n\n\t\tif ( user && user.login && user.login == msg.user.login && ! this.context.get('chat.filtering.process-own') )\n\t\t\treturn;\n\n\t\tconst regexes = this.context.get('__filter:block-terms');\n\t\tif ( ! regexes )\n\t\t\treturn;\n\n\t\tif ( regexes.remove ) {\n\t\t\ttokens = blocked_process(tokens, msg, regexes.remove, true, haltable);\n\t\t\tif ( haltable && msg.ffz_removed ) {\n\t\t\t\tmsg.ffz_halt_tokens = true;\n\t\t\t\treturn tokens;\n\t\t\t}\n\t\t}\n\n\t\tif ( regexes.non )\n\t\t\ttokens = blocked_process(tokens, msg, regexes.non, false, haltable);\n\n\t\treturn tokens;\n\t}\n}\n\n\n// ============================================================================\n// AutoMod Filtering\n// ============================================================================\n\nconst AM_DESCRIPTIONS = {\n\tA: 'Hostility',\n\tI: 'Discrimination',\n\tP: 'Profanity',\n\tS: 'Sexually Explicit Language'\n};\n\nexport const AutomoddedTerms = {\n\ttype: 'amterm',\n\tpriority: 95,\n\n\tcomponent: () => import(/* webpackChunkName: 'vue-chat' */ './components/chat-automod-blocked.vue'),\n\n\trender(token, createElement) {\n\t\treturn (<strong\n\t\t\tdata-text={token.text}\n\t\t\tdata-categories={JSON.stringify(token.categories)}\n\t\t\tdata-tooltip-type=\"amterm\"\n\t\t\tclass=\"ffz-tooltip ffz--blocked ffz--pointer-events\"\n\t\t\tonClick={this.clickToReveal}\n\t\t>\n\t\t\t&times;&times;&times;\n\t\t</strong>);\n\t},\n\n\ttooltip(target) {\n\t\tconst ds = target.dataset,\n\t\t\tflags = [];\n\n\t\tlet cats;\n\t\ttry {\n\t\t\tcats = JSON.parse(ds.categories);\n\t\t\tfor(const key in cats) {\n\t\t\t\tif ( cats[key] && AM_DESCRIPTIONS[key] )\n\t\t\t\t\tflags.push(this.i18n.t(`chat.filtering.automod.${key}`, AM_DESCRIPTIONS[key]))\n\t\t\t}\n\n\t\t} catch(err) {\n\t\t\tflags.push('Parse Error');\n\t\t}\n\n\n\t\treturn [\n\t\t\t(<div class=\"tw-border-b tw-mg-b-05\">{ // eslint-disable-line react/jsx-key\n\t\t\t\tthis.i18n.t('chat.filtering.automod-term', 'AutoMod Blocked Term')\n\t\t\t}</div>),\n\t\t\tthis.i18n.t('chat.filtering.automod-why', 'This was flagged as: '),\n\t\t\tflags.join(', ')\n\t\t];\n\t},\n\n\tprocess(tokens, msg, user, haltable) {\n\t\tif ( ! tokens || ! tokens.length || ! msg.flags || ! Array.isArray(msg.flags.list) )\n\t\t\treturn;\n\n\t\tconst cats = msg.flags.preferences,\n\t\t\tflagged = msg.flags.list.filter(x => {\n\t\t\t\tif ( ! x || x.startIndex == null || x.endIndex == null )\n\t\t\t\t\treturn false;\n\n\t\t\t\tconst y = x.categories;\n\t\t\t\tif ( ! y )\n\t\t\t\t\treturn false;\n\n\t\t\t\tfor(const key in y) {\n\t\t\t\t\tif ( y[key] && cats[key] )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}),\n\t\t\tf_length = flagged.length;\n\n\t\tif ( ! f_length )\n\t\t\treturn;\n\n\t\tconst out = [];\n\t\tlet idx = 0,\n\t\t\tfix = 0;\n\n\t\tconst remove = this.context.get('chat.automod.remove-messages');\n\t\tconst del = this.context.get('chat.automod.delete-messages');\n\n\t\tif ( del )\n\t\t\tmsg.deleted = true;\n\n\t\tif ( remove ) {\n\t\t\tmsg.ffz_removed = true;\n\t\t\tif ( haltable )\n\t\t\t\tmsg.ffz_halt_tokens = true;\n\t\t\treturn;\n\t\t}\n\n\t\tfor(const token of tokens) {\n\t\t\tconst length = token.length || (token.text && split_chars(token.text).length) || 0,\n\t\t\t\tt_start = idx,\n\t\t\t\tt_end = idx + length;\n\n\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\tout.push(token);\n\t\t\t\tidx = t_end;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst text = split_chars(token.text);\n\n\t\t\twhile ( fix < f_length ) {\n\t\t\t\tconst flag = flagged[fix],\n\t\t\t\t\tf_start = flag.startIndex,\n\t\t\t\t\tf_end = flag.endIndex + 1;\n\n\t\t\t\t// Did this flagged term already end? Skip it!\n\t\t\t\tif ( f_end < t_start ) {\n\t\t\t\t\tfix++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Does this flagged term start after this token?\n\t\t\t\tif ( f_start > t_end ) {\n\t\t\t\t\t// Just dump this token and move on.\n\t\t\t\t\tout.push(token);\n\t\t\t\t\tidx = t_end;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// If there's text at the beginning of the token that isn't part of\n\t\t\t\t// this flagged term, output it.\n\t\t\t\tif ( f_start > idx )\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\ttext: text.slice(idx - t_start, f_start - t_start).join('')\n\t\t\t\t\t});\n\n\t\t\t\t// Clamp the start of the filtered term to the start of this token.\n\t\t\t\tlet fs = f_start - t_start;\n\t\t\t\tif ( fs < 0 )\n\t\t\t\t\tfs = 0;\n\n\t\t\t\t// Add the token.\n\t\t\t\tout.push({\n\t\t\t\t\ttype: 'amterm',\n\t\t\t\t\tcategories: flag.categories,\n\t\t\t\t\ttext: text.slice(fs, f_end - t_start).join('')\n\t\t\t\t});\n\n\t\t\t\t// Does this flagged term extend past the end of this token?\n\t\t\t\tif ( f_end > t_end ) {\n\t\t\t\t\t// Don't go to the next term, just continue processing on the\n\t\t\t\t\t// next token.\n\t\t\t\t\tidx = t_end;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tidx = f_end;\n\t\t\t\tfix++;\n\t\t\t}\n\n\t\t\t// We've finished processing terms. If there's any remaining\n\t\t\t// text in the token, push it out.\n\t\t\tif ( idx < t_end ) {\n\t\t\t\tif ( t_start === idx )\n\t\t\t\t\tout.push(token);\n\t\t\t\telse\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\ttext: text.slice(idx - t_start).join('')\n\t\t\t\t\t});\n\n\t\t\t\tidx = t_end;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n}\n\n\n\n// ============================================================================\n// Cheers\n// ============================================================================\n\nexport const CheerEmotes = {\n\ttype: 'cheer',\n\tpriority: 40,\n\n\tcomponent: () => import(/* webpackChunkName: 'vue-chat' */ './components/chat-cheer.vue'),\n\n\trender(token, createElement) {\n\t\treturn (<span\n\t\t\tclass=\"ffz-cheer ffz-tooltip ffz--pointer-events\"\n\t\t\tdata-tooltip-type=\"cheer\"\n\t\t\tdata-prefix={token.prefix}\n\t\t\tdata-amount={this.i18n.formatNumber(token.amount)}\n\t\t\tdata-tier={token.tier}\n\t\t\tdata-individuals={JSON.stringify(token.individuals || null)}\n\t\t\talt={token.text}\n\t\t/>);\n\t},\n\n\ttooltip(target) {\n\t\tconst ds = target.dataset,\n\t\t\tamount = parseInt(ds.amount.replace(/,/g, ''), 10),\n\t\t\tprefix = ds.prefix,\n\t\t\ttier = ds.tier,\n\t\t\tindividuals = ds.individuals && JSON.parse(ds.individuals),\n\t\t\tlength = individuals && individuals.length;\n\n\t\tconst out = [\n\t\t\tthis.context.get('tooltip.emote-images') && (<div\n\t\t\t\tclass=\"preview-image ffz-cheer-preview\"\n\t\t\t\tdata-prefix={prefix}\n\t\t\t\tdata-tier={tier}\n\t\t\t/>),\n\t\t\tthis.i18n.t('tooltip.bits', '{count,number} Bits', amount),\n\t\t];\n\n\t\tif ( length > 1 ) {\n\t\t\tout.push(<br />);\n\n\t\t\tindividuals.sort(i => -i[0]);\n\n\t\t\tfor(let i=0; i < length && i < 12; i++) {\n\t\t\t\tconst [amount, tier, prefix] = individuals[i];\n\t\t\t\tout.push(this.tokenizers.cheer.render.call(this, {\n\t\t\t\t\tamount,\n\t\t\t\t\tprefix,\n\t\t\t\t\ttier\n\t\t\t\t}, createElement));\n\t\t\t}\n\n\t\t\tif ( length > 12 ) {\n\t\t\t\tout.push(<br />);\n\t\t\t\tout.push(this.i18n.t('tooltip.bits.more', '(and {count, number} more)', length-12));\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t},\n\n\tprocess(tokens, msg) {\n\t\tif ( ! tokens || ! tokens.length || ! msg.bits )\n\t\t\treturn;\n\n\t\tconst room = this.getRoom(msg.roomID, msg.roomLogin, true),\n\t\t\tactions = room && room.bitsConfig;\n\n\t\tif ( ! actions )\n\t\t\treturn;\n\n\t\tconst matcher = new RegExp(`^(${Object.keys(actions).join('|')})(\\\\d+)$`, 'i');\n\n\t\tconst out = [],\n\t\t\tcollected = {},\n\t\t\tcollect = this.context.get('chat.bits.stack');\n\n\t\tfor(const token of tokens) {\n\t\t\tif ( ! token || token.type !== 'text' ) {\n\t\t\t\tout.push(token);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet text = [];\n\t\t\tfor(const segment of token.text.split(/ +/)) {\n\t\t\t\tconst match = matcher.exec(segment);\n\t\t\t\tif ( match ) {\n\t\t\t\t\tconst prefix = match[1].toLowerCase(),\n\t\t\t\t\t\tcheer = actions[prefix];\n\n\t\t\t\t\tif ( ! cheer ) {\n\t\t\t\t\t\ttext.push(segment);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst amount = parseInt(match[2], 10),\n\t\t\t\t\t\ttiers = cheer.tiers;\n\n\t\t\t\t\tlet tier, token;\n\t\t\t\t\tfor(let i=0, l = tiers.length; i < l; i++)\n\t\t\t\t\t\tif ( amount >= tiers[i].amount ) {\n\t\t\t\t\t\t\ttier = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\tif ( text.length ) {\n\t\t\t\t\t\t// We have pending text. Join it together, with an extra space.\n\t\t\t\t\t\tout.push({type: 'text', text: `${text.join(' ')} `});\n\t\t\t\t\t\ttext = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tout.push(token = {\n\t\t\t\t\t\ttype: 'cheer',\n\t\t\t\t\t\tprefix,\n\t\t\t\t\t\ttier,\n\t\t\t\t\t\tamount,\n\t\t\t\t\t\ttext: match[0]\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( collect ) {\n\t\t\t\t\t\tlet pref = collect === 2 ? 'cheer' : prefix;\n\t\t\t\t\t\tif ( ! actions[pref] )\n\t\t\t\t\t\t\tpref = prefix;\n\n\t\t\t\t\t\tconst group = collected[pref] = collected[pref] || {total: 0, individuals: []};\n\n\t\t\t\t\t\tgroup.total += amount;\n\t\t\t\t\t\tgroup.individuals.push([amount, tier, prefix]);\n\t\t\t\t\t\ttoken.hidden = true;\n\t\t\t\t\t}\n\n\t\t\t\t\ttext.push('');\n\n\t\t\t\t} else\n\t\t\t\t\ttext.push(segment);\n\t\t\t}\n\n\t\t\tif ( text.length > 1 || (text.length === 1 && text[0] !== '') )\n\t\t\t\tout.push({type: 'text', text: text.join(' ')});\n\t\t}\n\n\t\tif ( collect ) {\n\t\t\tfor(const prefix in collected)\n\t\t\t\tif ( has(collected, prefix) ) {\n\t\t\t\t\tconst cheers = collected[prefix],\n\t\t\t\t\t\tcheer = actions[prefix],\n\t\t\t\t\t\ttiers = cheer.tiers;\n\n\t\t\t\t\tlet tier = 0;\n\t\t\t\t\tfor(let l = tiers.length; tier < l; tier++)\n\t\t\t\t\t\tif ( cheers.total >= tiers[tier].amount )\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tout.unshift({\n\t\t\t\t\t\ttype: 'cheer',\n\t\t\t\t\t\tprefix,\n\t\t\t\t\t\ttier,\n\t\t\t\t\t\tamount: cheers.total,\n\t\t\t\t\t\tindividuals: cheers.individuals,\n\t\t\t\t\t\tlength: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n}\n\n\n\n// ============================================================================\n// Addon Emotes\n// ============================================================================\n\nconst render_emote = (token, createElement, wrapped) => {\n\tconst hover = token.anim === 2,\n\t\tbig = token.big && token.can_big;\n\tlet src, srcSet, hoverSrc, hoverSrcSet, normalSrc, normalSrcSet;\n\n\tif ( token.anim === 1 && token.animSrc ) {\n\t\tsrc = big ? token.animSrc2 : token.animSrc;\n\t\tsrcSet = big ? token.animSrcSet2 : token.animSrcSet;\n\t} else {\n\t\tsrc = big ? token.src2 : token.src;\n\t\tsrcSet = big ? token.srcSet2 : token.srcSet;\n\t}\n\n\tif ( hover && token.animSrc ) {\n\t\tnormalSrc = src;\n\t\tnormalSrcSet = srcSet;\n\t\thoverSrc = big ? token.animSrc2 : token.animSrc;\n\t\thoverSrcSet = big ? token.animSrcSet2 : token.animSrcSet;\n\t}\n\n\tconst mods = token.modifiers || [], ml = mods.length,\n\t\temote = createElement('img', {\n\t\t\tclass: `${EMOTE_CLASS} ffz-tooltip${hoverSrc ? ' ffz-hover-emote' : ''}${token.provider === 'twitch' ? ' twitch-emote' : token.provider === 'ffz' ? ' ffz-emote' : token.provider === 'emoji' ? ' ffz-emoji' : ''}`,\n\t\t\tattrs: {\n\t\t\t\tsrc: (IS_FIREFOX && srcSet?.length) ? undefined : src,\n\t\t\t\tsrcSet,\n\t\t\t\talt: token.text,\n\t\t\t\theight: (token.big && ! token.can_big && token.height) ? `${token.height * 2}px` : undefined,\n\t\t\t\t'data-tooltip-type': 'emote',\n\t\t\t\t'data-provider': token.provider,\n\t\t\t\t'data-id': token.id,\n\t\t\t\t'data-set': token.set,\n\t\t\t\t'data-code': token.code,\n\t\t\t\t'data-variant': token.variant,\n\t\t\t\t'data-normal-src': normalSrc,\n\t\t\t\t'data-normal-src-set': normalSrcSet,\n\t\t\t\t'data-hover-src': hoverSrc,\n\t\t\t\t'data-hover-src-set': hoverSrcSet,\n\t\t\t\t'data-modifiers': ml ? mods.map(x => x.id).join(' ') : null,\n\t\t\t\t'data-modifier-info': ml ? JSON.stringify(mods.map(x => [x.set, x.id])) : null\n\t\t\t}\n\t\t});\n\n\tif ( ! ml ) {\n\t\tif ( wrapped )\n\t\t\treturn emote;\n\n\t\treturn createElement('div', {\n\t\t\tclassName: 'ffz--inline',\n\t\t\tattrs: {\n\t\t\t\t'data-test-selector': 'emote-button'\n\t\t\t}\n\t\t}, [emote]);\n\t}\n\n\treturn createElement('div', {\n\t\tclass: 'ffz--inline modified-emote',\n\t\tattrs: {\n\t\t\t'data-test-selector': 'emote-button',\n\t\t\t'data-provider': token.provider,\n\t\t\t'data-id': token.id,\n\t\t\t'data-set': token.set,\n\t\t\t'data-modifiers': ml ? mods.map(x => x.id).join(' ') : null\n\t\t}\n\t}, [emote, mods.map(x => createElement('span', {key: x.text}, render_emote(x, createElement, true)))])\n}\n\n\nexport const AddonEmotes = {\n\ttype: 'emote',\n\tpriority: 10,\n\n\tcomponent: {\n\t\tfunctional: true,\n\t\trender(createElement, {props}) {\n\t\t\treturn render_emote(props.token, createElement);\n\t\t}\n\t},\n\n\trender(token, createElement, wrapped) {\n\t\tconst hover = token.anim === 2,\n\t\t\tbig = token.big && token.can_big;\n\t\tlet src, srcSet, hoverSrc, hoverSrcSet, normalSrc, normalSrcSet;\n\n\t\tif ( token.anim === 1 && token.animSrc ) {\n\t\t\tsrc = big ? token.animSrc2 : token.animSrc;\n\t\t\tsrcSet = big ? token.animSrcSet2 : token.animSrcSet;\n\t\t} else {\n\t\t\tsrc = big ? token.src2 : token.src;\n\t\t\tsrcSet = big ? token.srcSet2 : token.srcSet;\n\t\t}\n\n\t\tif ( hover && token.animSrc ) {\n\t\t\tnormalSrc = src;\n\t\t\tnormalSrcSet = srcSet;\n\t\t\thoverSrc = big ? token.animSrc2 : token.animSrc;\n\t\t\thoverSrcSet = big ? token.animSrcSet2 : token.animSrcSet;\n\t\t}\n\n\t\tlet style = undefined, outerStyle = undefined;\n\t\tconst mods = token.modifiers || [], ml = mods.length,\n\t\t\teffects = token.modifier_flags,\n\t\t\tis_big = (token.big && ! token.can_big && token.height);\n\n\t\tlet as_bg = (this.emotes.activeAsBackgroundMask & effects) !== 0;\n\t\tlet no_wide = (this.emotes.activeNoWideMask & effects) !== 0;\n\n\t\tif ( no_wide || effects || ml ) {\n\t\t\t// We need to calculate the size of the emote and the biggest\n\t\t\t// modifier so that everything can be nicely centered.\n\t\t\tif ( token.provider === 'emoji' ) {\n\t\t\t\tconst factor = token.big_emoji ? 2 : 1,\n\t\t\t\t\tsize = factor * 1.5 * (this.context.get('chat.font-size') ?? 13);\n\n\t\t\t\tstyle = {\n\t\t\t\t\twidth: size,\n\t\t\t\t\theight: size,\n\t\t\t\t};\n\t\t\t\touterStyle = {\n\t\t\t\t\twidth: size,\n\t\t\t\t\theight: size\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconst factor = token.big ? 2 : 1;\n\t\t\t\tstyle = {\n\t\t\t\t\twidth: token.width * factor,\n\t\t\t\t\theight: token.height * factor\n\t\t\t\t};\n\t\t\t\touterStyle = {\n\t\t\t\t\twidth: style.width,\n\t\t\t\t\theight: style.height\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfor(const mod of mods) {\n\t\t\t\tif ( mod.effect_bg )\n\t\t\t\t\tas_bg = true;\n\n\t\t\t\tif ( ! mod.mod_hidden && mod.set !== 'info' ) {\n\t\t\t\t\tconst factor = mod.big ? 2 : 1,\n\t\t\t\t\t\twidth = mod.width * factor,\n\t\t\t\t\t\theight = mod.height * factor;\n\n\t\t\t\t\tif ( width > outerStyle.width )\n\t\t\t\t\t\touterStyle.width = width;\n\t\t\t\t\tif ( height > outerStyle.height )\n\t\t\t\t\t\touterStyle.height = height;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( effects ) {\n\t\t\t\tthis.emotes.ensureEffect(effects);\n\n\t\t\t\tif ( (effects & SHRINK_X) === SHRINK_X && this.emotes.effects_enabled?.ShrinkX )\n\t\t\t\t\tstyle.width *= 0.5;\n\t\t\t\tif ( (effects & STRETCH_X) === STRETCH_X && this.emotes.effects_enabled?.GrowX )\n\t\t\t\t\tstyle.width *= 2;\n\t\t\t\t/*if ( (effects  & SHRINK_Y) === SHRINK_Y )\n\t\t\t\t\tstyle.height *= 0.5;\n\t\t\t\tif ( (effects & STRETCH_Y) === STRETCH_Y )\n\t\t\t\t\tstyle.height *= 2;*/\n\n\t\t\t\tstyle.width = Math.min(style.width, token.big ? 256 : 128);\n\t\t\t\tstyle.height = Math.min(style.height, token.big ? 80 : 40);\n\t\t\t}\n\n\t\t\tif ( no_wide ) {\n\t\t\t\tconst limit = token.big ? 64 : 32;\n\t\t\t\tif ( style.width > limit ) {\n\t\t\t\t\tconst factor = limit / style.width;\n\t\t\t\t\tstyle.width *= factor;\n\t\t\t\t\tstyle.height *= factor;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( style.width > outerStyle.width )\n\t\t\t\touterStyle.width = style.width;\n\t\t\tif ( style.height > outerStyle.height )\n\t\t\t\touterStyle.height = style.height;\n\n\t\t\tif ( style.width !== outerStyle.width )\n\t\t\t\tstyle.marginLeft = (outerStyle.width - style.width) / 2;\n\t\t\tif ( style.height !== outerStyle.height )\n\t\t\t\tstyle.marginTop = (outerStyle.height - style.height) / 2;\n\n\t\t\tif ( effects ) {\n\t\t\t\tif ( (effects & SLIDE_X) === SLIDE_X ) {\n\t\t\t\t\tstyle['--ffz-width'] = `${style.width}px`;\n\t\t\t\t\tstyle['--ffz-speed-x'] = `${0.5 * (style.width / (token.big ? 64 : 32))}s`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet emote;\n\n\t\tif ( as_bg ) {\n\t\t\tstyle = style || {};\n\t\t\tstyle.backgroundImage = `url(\"${src}\")`;\n\t\t\tstyle.backgroundSize = '100%';\n\n\t\t\temote = (<div\n\t\t\t\tclass={`${EMOTE_CLASS} ffz--pointer-events ffz-tooltip${hoverSrc ? ' ffz-hover-emote' : ''}${token.provider === 'twitch' ? ' twitch-emote' : token.provider === 'ffz' ? ' ffz-emote' : token.provider === 'emoji' ? ' ffz-emoji' : ''}`}\n\t\t\t\tstyle={style}\n\t\t\t\tdata-name={token.text}\n\t\t\t\tdata-tooltip-type=\"emote\"\n\t\t\t\tdata-provider={token.provider}\n\t\t\t\tdata-id={token.id}\n\t\t\t\tdata-set={token.set}\n\t\t\t\tdata-code={token.code}\n\t\t\t\tdata-variant={token.variant}\n\t\t\t\tdata-normal-src={normalSrc}\n\t\t\t\tdata-normal-src-set={normalSrcSet}\n\t\t\t\tdata-hover-src={hoverSrc}\n\t\t\t\tdata-hover-src-set={hoverSrcSet}\n\t\t\t\tdata-modifiers={ml ? mods.map(x => x.id).join(' ') : null}\n\t\t\t\tdata-modifier-info={ml ? JSON.stringify(mods.map(x => [x.set, x.id])) : null}\n\t\t\t\tonClick={this.emotes.handleClick}\n\t\t\t><div class=\"ffz-alt-text\">{ token.text }</div></div>);\n\t\t}\n\n\t\telse\n\t\t\temote = (<img\n\t\t\t\tclass={`${EMOTE_CLASS} ffz--pointer-events ffz-tooltip${hoverSrc ? ' ffz-hover-emote' : ''}${token.provider === 'twitch' ? ' twitch-emote' : token.provider === 'ffz' ? ' ffz-emote' : token.provider === 'emoji' ? ' ffz-emoji' : ''}`}\n\t\t\t\tsrc={(IS_FIREFOX && srcSet?.length) ? undefined : src}\n\t\t\t\tsrcSet={srcSet}\n\t\t\t\tstyle={style}\n\t\t\t\theight={style ? undefined : is_big ? `${token.height * 2}px` : undefined}\n\t\t\t\talt={token.text}\n\t\t\t\tdata-tooltip-type=\"emote\"\n\t\t\t\tdata-provider={token.provider}\n\t\t\t\tdata-id={token.id}\n\t\t\t\tdata-set={token.set}\n\t\t\t\tdata-code={token.code}\n\t\t\t\tdata-variant={token.variant}\n\t\t\t\tdata-normal-src={normalSrc}\n\t\t\t\tdata-normal-src-set={normalSrcSet}\n\t\t\t\tdata-hover-src={hoverSrc}\n\t\t\t\tdata-hover-src-set={hoverSrcSet}\n\t\t\t\tdata-modifiers={ml ? mods.map(x => x.id).join(' ') : null}\n\t\t\t\tdata-modifier-info={ml ? JSON.stringify(mods.map(x => [x.set, x.id])) : null}\n\t\t\t\tonClick={this.emotes.handleClick}\n\t\t\t/>);\n\n\t\tif ( ! ml && ! token.modifier_flags ) {\n\t\t\tif ( wrapped )\n\t\t\t\treturn emote;\n\n\t\t\treturn (<div class=\"ffz--inline\" data-test-selector=\"emote-button\">{emote}</div>);\n\t\t}\n\n\t\treturn (<div\n\t\t\tclass={`ffz--inline ffz--pointer-events modified-emote${style ? ' scaled-modified-emote' : ''}`}\n\t\t\tdata-test-selector=\"emote-button\"\n\t\t\tdata-provider={token.provider}\n\t\t\tdata-id={token.id}\n\t\t\tdata-set={token.set}\n\t\t\tstyle={outerStyle}\n\t\t\tdata-modifiers={ml ? mods.map(x => x.id).join(' ') : null}\n\t\t\tdata-effects={effects ? effects : undefined}\n\t\t\t//onClick={this.emotes.handleClick}\n\t\t>\n\t\t\t{emote}\n\t\t\t{mods.map(t => {\n\t\t\t\tif (t.set === 'info')\n\t\t\t\t\treturn null;\n\t\t\t\tif ((t.source_modifier_flags & 1) === 1 && t.text)\n\t\t\t\t\treturn null;\n\t\t\t\t\t// This is currently weird and breaks copy/paste\n\t\t\t\t\t// so since it doesn't *fix* copy/paste just leave\n\t\t\t\t\t// it out for now.\n\t\t\t\t\t//return <div class=\"ffz-alt-text\">{` ${t.text}`}</div>;\n\t\t\t\treturn <span key={t.text}>{this.tokenizers.emote.render.call(this, t, createElement, true)}</span>\n\t\t\t})}\n\t\t</div>);\n\t},\n\n\tasync tooltip(target, tip) {\n\t\tconst ds = target.dataset,\n\t\t\tprovider = ds.provider,\n\t\t\tmodifiers = ds.modifierInfo;\n\n\t\tlet name, preview, source, artist, owner, mods, fav_source, emote_id,\n\t\t\toriginal_name,\n\t\t\tplain_name = false;\n\n\t\tconst hide_source = ds.noSource === 'true';\n\n\t\tif ( modifiers && modifiers !== 'null' ) {\n\t\t\tmods = JSON.parse(modifiers).map(([set_id, emote_id]) => {\n\t\t\t\tif ( set_id === 'info' )\n\t\t\t\t\treturn (<span class=\"tw-mg-05\">\n\t\t\t\t\t\t{emote_id?.icon ? <img class=\"ffz__tooltip__mod-icon\" src={emote_id.icon} /> : null}\n\t\t\t\t\t\t{emote_id?.icon ? ` - ${emote_id?.label}` : emote_id?.label}\n\t\t\t\t\t</span>);\n\n\t\t\t\tconst emote_set = this.emotes.emote_sets[set_id],\n\t\t\t\t\temote = emote_set && (emote_set.emotes[emote_id] || emote_set.disabled_emotes?.[emote_id]);\n\n\t\t\t\tif ( emote )\n\t\t\t\t\treturn (<span class=\"tw-mg-05\">\n\t\t\t\t\t\t{this.tokenizers.emote.render.call(this, emote.token, createElement)}\n\t\t\t\t\t\t{` - ${emote.hidden ? '???' : emote.name}`}\n\t\t\t\t\t</span>);\n\t\t\t})\n\t\t}\n\n\t\tif ( provider === 'twitch' ) {\n\t\t\temote_id = ds.id;\n\t\t\tconst set_id = hide_source ? null : await this.emotes.getTwitchEmoteSet(emote_id),\n\t\t\t\temote_set = set_id != null && await this.emotes.getTwitchSetChannel(set_id),\n\t\t\t\traw_artist = hide_source ? null : await this.emotes.getTwitchEmoteArtist(emote_id);\n\n\t\t\tpreview = `${getTwitchEmoteURL(ds.id, 4, true, true)}?_=preview`;\n\t\t\tfav_source = 'twitch';\n\n\t\t\tif ( raw_artist )\n\t\t\t\tartist = raw_artist.displayName || raw_artist.login;\n\n\t\t\tif ( emote_set ) {\n\t\t\t\tconst type = emote_set.type;\n\t\t\t\tif ( type === EmoteTypes.Global ) {\n\t\t\t\t\tif ( emote_set.owner?.login ) {\n\t\t\t\t\t\tsource = this.i18n.t('tooltip.channel', 'Channel: {source}', {\n\t\t\t\t\t\t\tsource: emote_set.owner.displayName || emote_set.owner.login\n\t\t\t\t\t\t});\n\t\t\t\t\t} else\n\t\t\t\t\t\tsource = this.i18n.t('emote.global', 'Twitch Global');\n\n\t\t\t\t} else if ( type === EmoteTypes.BitsTier ) {\n\t\t\t\t\tsource = this.i18n.t('emote.bits', 'Twitch Bits Reward');\n\t\t\t\t\tif ( emote_set.owner?.login )\n\t\t\t\t\t\tsource = this.i18n.t('emote.bits-owner', '{source}\\nChannel: {channel}', {\n\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\tchannel: emote_set.owner.displayName || emote_set.owner.login\n\t\t\t\t\t\t});\n\n\t\t\t\t} else if ( type === EmoteTypes.Prime || type === EmoteTypes.Turbo )\n\t\t\t\t\tsource = this.i18n.t('emote.prime', 'Prime Gaming');\n\n\t\t\t\telse if ( type === EmoteTypes.TwoFactor )\n\t\t\t\t\tsource = this.i18n.t('emote.2fa', 'Twitch 2FA Emote');\n\n\t\t\t\telse if ( type === EmoteTypes.LimitedTime )\n\t\t\t\t\tsource = this.i18n.t('emote.limited', 'Limited-Time Only Emote');\n\n\t\t\t\telse if ( type === EmoteTypes.ChannelPoints )\n\t\t\t\t\tsource = this.i18n.t('emote.points', 'Channel Points Emote');\n\n\t\t\t\telse if ( type === EmoteTypes.Follower && emote_set.owner?.login )\n\t\t\t\t\tsource = this.i18n.t('emote.follower', 'Follower Emote ({source})', {\n\t\t\t\t\t\tsource: emote_set.owner.displayName || emote_set.owner.login\n\t\t\t\t\t});\n\n\t\t\t\telse if ( type === EmoteTypes.Subscription && emote_set.owner?.login )\n\t\t\t\t\tsource = this.i18n.t('tooltip.channel', 'Channel: {source}', {\n\t\t\t\t\t\tsource: emote_set.owner.displayName || emote_set.owner.login\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t} else if ( provider === 'ffz' ) {\n\t\t\tconst emote_set = this.emotes.emote_sets[ds.set],\n\t\t\t\temote = emote_set && (emote_set.emotes[ds.id] || emote_set.disabled_emotes?.[ds.id]);\n\n\t\t\tif ( emote_set ) {\n\t\t\t\tsource = emote_set.source_line || (`${emote_set.source || 'FFZ'} ${emote_set.title || 'Global'}`);\n\t\t\t\tfav_source = emote_set.source || 'ffz';\n\t\t\t}\n\n\t\t\tif ( emote ) {\n\t\t\t\temote_id = emote.id;\n\n\t\t\t\tif ( emote.artist )\n\t\t\t\t\tartist = emote.artist.display_name || emote.artist.name;\n\n\t\t\t\tif ( emote.original_name && emote.original_name !== emote.name )\n\t\t\t\t\toriginal_name = this.i18n.t(\n\t\t\t\t\t\t'emote.original-name', 'Name: {name}',\n\t\t\t\t\t\t{name: emote.original_name}\n\t\t\t\t\t);\n\n\t\t\t\tif ( emote.owner )\n\t\t\t\t\towner = this.i18n.t(\n\t\t\t\t\t\t'emote.owner', 'By: {owner}',\n\t\t\t\t\t\t{owner: emote.owner.display_name});\n\n\t\t\t\tconst anim = this.context.get('tooltip.emote-images.animated');\n\t\t\t\tif ( anim && emote.animated?.[1] ) {\n\t\t\t\t\tif ( emote.animated[4] )\n\t\t\t\t\t\tpreview = emote.animated[4];\n\t\t\t\t\telse if ( emote.animated[2] )\n\t\t\t\t\t\tpreview = emote.animated[2];\n\n\t\t\t\t} else {\n\t\t\t\t\tif ( emote.urls[4] )\n\t\t\t\t\t\tpreview = emote.urls[4];\n\t\t\t\t\telse if ( emote.urls[2] )\n\t\t\t\t\t\tpreview = emote.urls[2];\n\t\t\t\t}\n\n\t\t\t\tif ( ds.effects && emote.modifier && emote.modifier_flags ) {\n\t\t\t\t\towner = null;\n\n\t\t\t\t\tconst effects = emote.modifier_flags;\n\t\t\t\t\tthis.emotes.ensureEffect(effects);\n\n\t\t\t\t\tconst target = this.emotes.getTargetEmote();\n\n\t\t\t\t\tlet style = {\n\t\t\t\t\t\twidth: (target.width ?? 28) * 2,\n\t\t\t\t\t\theight: (target.height ?? 28) * 2\n\t\t\t\t\t};\n\n\t\t\t\t\tlet outerStyle = {\n\t\t\t\t\t\twidth: style.width,\n\t\t\t\t\t\theight: style.height\n\t\t\t\t\t};\n\n\n\t\t\t\t\tlet as_bg = (this.emotes.activeAsBackgroundMask & effects) !== 0;\n\t\t\t\t\tlet no_wide = (this.emotes.activeNoWideMask & effects) !== 0;\n\n\t\t\t\t\tlet changed = false;\n\n\t\t\t\t\tif ( (effects & SHRINK_X) === SHRINK_X && this.emotes.effects_enabled?.ShrinkX ) {\n\t\t\t\t\t\tstyle.width *= 0.5;\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t\tif ( (effects & STRETCH_X) === STRETCH_X && this.emotes.effects_enabled?.GrowX ) {\n\t\t\t\t\t\tstyle.width *= 2;\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t\t/*if ( (effects  & SHRINK_Y) === SHRINK_Y ) {\n\t\t\t\t\t\tstyle.height *= 0.5;\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t\tif ( (effects & STRETCH_Y) === STRETCH_Y ) {\n\t\t\t\t\t\tstyle.height *= 2;\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}*/\n\n\t\t\t\t\tif ( changed ) {\n\t\t\t\t\t\tif ( style.width > 512 )\n\t\t\t\t\t\t\tstyle.width = 512;\n\t\t\t\t\t\tif ( style.height > 160 )\n\t\t\t\t\t\t\tstyle.height = 160;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( no_wide ) {\n\t\t\t\t\t\tconst limit = 64;\n\t\t\t\t\t\tif ( style.width > limit ) {\n\t\t\t\t\t\t\tconst factor = limit / style.width;\n\t\t\t\t\t\t\tstyle.width *= factor;\n\t\t\t\t\t\t\tstyle.height *= factor;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( style.width > outerStyle.width )\n\t\t\t\t\t\touterStyle.width = style.width;\n\t\t\t\t\tif ( style.height > outerStyle.height )\n\t\t\t\t\t\touterStyle.height = style.height;\n\n\t\t\t\t\tif ( style.width !== outerStyle.width )\n\t\t\t\t\t\tstyle.marginLeft = (outerStyle.width - style.width) / 2;\n\t\t\t\t\tif ( style.height !== outerStyle.height )\n\t\t\t\t\t\tstyle.marginTop = (outerStyle.height - style.height) / 2;\n\n\t\t\t\t\tif ( (effects & SLIDE_X) === SLIDE_X ) {\n\t\t\t\t\t\tstyle['--ffz-width'] = `${style.width}px`;\n\t\t\t\t\t\tstyle['--ffz-speed-x'] = `${0.5 * style.width / 64}s`;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyle.width = `${style.width}px`;\n\t\t\t\t\tstyle.height = `${style.height}px`;\n\n\t\t\t\t\touterStyle.width = `${outerStyle.width}px`;\n\t\t\t\t\touterStyle.height = `${outerStyle.height}px`;\n\n\t\t\t\t\tif ( as_bg ) {\n\t\t\t\t\t\tstyle.backgroundImage = `url(\"${target.src}\")`;\n\t\t\t\t\t\tstyle.backgroundSize = '100%';\n\t\t\t\t\t}\n\n\t\t\t\t\t// Whip up a special preview.\n\t\t\t\t\tpreview = (<div class=\"ffz-effect-tip\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc={target.src}\n\t\t\t\t\t\t\tsrcSet={target.srcSet}\n\t\t\t\t\t\t\twidth={(target.width ?? 28) * 2}\n\t\t\t\t\t\t\theight={(target.height ?? 28) * 2}\n\t\t\t\t\t\t\tonLoad={tip.update}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"ffz-i-right-open\"></span>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass={`ffz--inline ffz--pointer-events modified-emote${style ? ' scaled-modified-emote' : ''}`}\n\t\t\t\t\t\t\tstyle={outerStyle}\n\t\t\t\t\t\t\tdata-modifiers={emote.id}\n\t\t\t\t\t\t\tdata-effects={effects}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{as_bg\n\t\t\t\t\t\t\t\t? <div\n\t\t\t\t\t\t\t\t\tclass={`${EMOTE_CLASS} ffz--pointer-events ffz-tooltip ffz-emote`}\n\t\t\t\t\t\t\t\t\tstyle={style}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t: <img\n\t\t\t\t\t\t\t\t\tclass={`${EMOTE_CLASS} ffz--pointer-events ffz-tooltip ffz-emote`}\n\t\t\t\t\t\t\t\t\tsrc={target.src}\n\t\t\t\t\t\t\t\t\tsrcSet={target.srcSet}\n\t\t\t\t\t\t\t\t\tstyle={style}\n\t\t\t\t\t\t\t\t\theight={style ? undefined : `${target.height * 2}px`}\n\t\t\t\t\t\t\t\t\tonLoad={tip.update}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>);\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if ( provider === 'emoji' ) {\n\t\t\tconst emoji = this.emoji.emoji[ds.code],\n\t\t\t\tstyle = this.context.get('chat.emoji.style'),\n\t\t\t\tvariant = ds.variant ? emoji.variants[ds.variant] : emoji,\n\t\t\t\tvcode = ds.variant ? this.emoji.emoji[ds.variant] : null;\n\n\t\t\tfav_source = 'emoji';\n\t\t\temote_id = ds.code;\n\n\t\t\tpreview = (<img\n\t\t\t\tclass=\"preview-image ffz-emoji\"\n\t\t\t\tsrc={this.emoji.getFullImage(variant.image, style)}\n\t\t\t\tsrcSet={this.emoji.getFullImageSet(variant.image, style)}\n\t\t\t\tonLoad={tip.update}\n\t\t\t/>);\n\n\t\t\tplain_name = true;\n\t\t\tname = `:${emoji.names[0]}:${vcode ? `:${vcode.names[0]}:` : ''}`;\n\n\t\t\tconst category = emoji.category ? this.i18n.t(`emoji.category.${emoji.category.toSnakeCase()}`, CATEGORIES[emoji.category] || emoji.category) : null;\n\t\t\tsource = this.i18n.t('tooltip.emoji', 'Emoji - {category}', {category});\n\n\t\t} else\n\t\t\treturn;\n\n\t\tif ( ! name )\n\t\t\tname = ds.name || target.alt;\n\n\t\tconst favorite = fav_source && this.emotes.isFavorite(fav_source, emote_id);\n\n\t\treturn [\n\t\t\tpreview && this.context.get('tooltip.emote-images') && (typeof preview === 'string' ? (<img\n\t\t\t\tclass=\"preview-image\"\n\t\t\t\tsrc={preview}\n\t\t\t\tonLoad={tip.update}\n\t\t\t/>) : preview),\n\n\t\t\tplain_name || (hide_source && ! owner)\n\t\t\t\t? name\n\t\t\t\t: this.i18n.t('tooltip.emote', 'Emote: {name}', {name}),\n\n\t\t\t! hide_source && source && this.context.get('tooltip.emote-sources') && (<div class=\"tw-pd-t-05\">\n\t\t\t\t{source}\n\t\t\t</div>),\n\n\t\t\toriginal_name && (<div class=\"tw-pd-t-05\">\n\t\t\t\t{original_name}\n\t\t\t</div>),\n\n\t\t\towner && this.context.get('tooltip.emote-sources') && (<div class=\"tw-pd-t-05\">\n\t\t\t\t{owner}\n\t\t\t</div>),\n\n\t\t\tartist && this.context.get('tooltip.emote-sources') && (<div class=\"tw-pd-t-05\">\n\t\t\t\t{this.i18n.t(\n\t\t\t\t\t'emote.artist', 'Artist: {artist}',\n\t\t\t\t\t{artist}\n\t\t\t\t)}\n\t\t\t</div>),\n\n\t\t\tds.sellout && (<div class=\"tw-mg-t-05 tw-border-t tw-pd-t-05\">{ds.sellout}</div>),\n\n\t\t\tmods && (<div class=\"tw-pd-t-1 tw-pd-b-05\">{mods}</div>),\n\n\t\t\tfavorite && (<figure class=\"ffz--favorite ffz-i-star\" />)\n\t\t];\n\t},\n\n\tprocess(tokens, msg) {\n\t\tif ( ! tokens || ! tokens.length )\n\t\t\treturn;\n\n\t\tif ( this.context.get('chat.emotes.enabled') !== 2 )\n\t\t\treturn;\n\n\t\tconst emotes = this.emotes.getEmotes(\n\t\t\tmsg.user.id,\n\t\t\tmsg.user.login,\n\t\t\tmsg.roomID,\n\t\t\tmsg.roomLogin\n\t\t);\n\n\t\tif ( ! emotes )\n\t\t\treturn;\n\n\t\tconst big = this.context.get('chat.emotes.2x') > 0,\n\t\t\tanim = this.context.get('chat.emotes.animated'),\n\t\t\tout = [];\n\n\t\tlet had_prefix_mods = false;\n\t\tlet had_no_space = false;\n\t\tlet last_token, emote;\n\n\t\tconst NoSpace = this.emotes.ModifierFlags?.NoSpace;\n\n\t\tfor(const token of tokens) {\n\t\t\tif ( ! token )\n\t\t\t\tcontinue;\n\n\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\tif ( token.type === 'emote' ) {\n\t\t\t\t\tif ( ! token.modifiers ) {\n\t\t\t\t\t\ttoken.modifiers = [];\n\t\t\t\t\t\ttoken.modifier_flags = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tout.push(token);\n\t\t\t\tlast_token = token;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet text = [];\n\n\t\t\tfor(const segment of token.text.split(/ +/)) {\n\t\t\t\tif ( has(emotes, segment) ) {\n\t\t\t\t\temote = emotes[segment];\n\n\t\t\t\t\t// Is this emote a modifier?\n\t\t\t\t\tif ( emote.modifier && emote.modifier_prefix )\n\t\t\t\t\t\thad_prefix_mods = true;\n\t\t\t\t\telse if ( emote.modifier && last_token && last_token.modifiers && (!text.length || (text.length === 1 && text[0] === '')) ) {\n\t\t\t\t\t\tif ( last_token.modifiers.indexOf(emote.token) === -1 ) {\n\t\t\t\t\t\t\tif ( emote.modifier_flags ) {\n\t\t\t\t\t\t\t\tlast_token.modifier_flags |= emote.modifier_flags;\n\t\t\t\t\t\t\t\tif ( NoSpace && (emote.modifier_flags & NoSpace) === NoSpace )\n\t\t\t\t\t\t\t\t\thad_no_space = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlast_token.modifiers.push(\n\t\t\t\t\t\t\t\tObject.assign({\n\t\t\t\t\t\t\t\t\t\tbig,\n\t\t\t\t\t\t\t\t\t\tanim\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\temote.token\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( text.length ) {\n\t\t\t\t\t\t// We have pending text. Join it together, with an extra space.\n\t\t\t\t\t\tconst t = {type: 'text', text: `${text.join(' ')} `};\n\t\t\t\t\t\tout.push(t);\n\t\t\t\t\t\tif ( t.text.trim().length )\n\t\t\t\t\t\t\tlast_token = t;\n\n\t\t\t\t\t\ttext = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst t = Object.assign({\n\t\t\t\t\t\tmodifiers: [],\n\t\t\t\t\t\tmodifier_flags: 0,\n\t\t\t\t\t\tbig,\n\t\t\t\t\t\tanim\n\t\t\t\t\t}, emote.token);\n\t\t\t\t\tout.push(t);\n\t\t\t\t\tlast_token = t;\n\n\t\t\t\t\ttext.push('');\n\n\t\t\t\t} else\n\t\t\t\t\ttext.push(segment);\n\t\t\t}\n\n\t\t\tif ( text.length > 1 || (text.length === 1 && text[0] !== '') ) {\n\t\t\t\tconst t = {type: 'text', text: text.join(' ')};\n\t\t\t\tout.push(t);\n\t\t\t}\n\t\t}\n\n\t\tif ( had_prefix_mods ) {\n\t\t\t// We need to scan through and apply prefix modifiers as appropriate.\n\t\t\tlet last_emote,\n\t\t\t\thad_text = false;\n\n\t\t\tlet i = out.length;\n\t\t\twhile(i--) {\n\t\t\t\tconst token = out[i];\n\n\t\t\t\t// Is it a new emote?\n\t\t\t\tif ( token.type === 'emote' && ! token.mod ) {\n\t\t\t\t\tlast_emote = token;\n\t\t\t\t\thad_text = false;\n\t\t\t\t}\n\n\t\t\t\t// Is it a prefix mod with a target emote?\n\t\t\t\telse if ( last_emote && token.type === 'emote' && token.mod && token.mod_prefix ) {\n\t\t\t\t\tlast_emote.modifiers.push(token);\n\t\t\t\t\tif ( token.source_modifier_flags ) {\n\t\t\t\t\t\tlast_emote.modifier_flags |= token.source_modifier_flags;\n\t\t\t\t\t\tif ( NoSpace && (token.source_modifier_flags & NoSpace) === NoSpace )\n\t\t\t\t\t\t\thad_no_space = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove one or two tokens, depending on if we had a space.\n\t\t\t\t\t// (We should always have a space, but be flexible.)\n\t\t\t\t\tout.splice(i, had_text ? 2 : 1);\n\t\t\t\t\thad_text = false;\n\t\t\t\t}\n\n\t\t\t\t// Make a note of at most one space.\n\t\t\t\telse if ( last_emote && ! had_text && token.type === 'text' && token.text === ' ' ) {\n\t\t\t\t\thad_text = true;\n\t\t\t\t}\n\n\t\t\t\t// Absolutely anything else means it's a broken sequence.\n\t\t\t\telse {\n\t\t\t\t\tlast_emote = null;\n\t\t\t\t\thad_text = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( had_no_space ) {\n\t\t\t// We need to remove prefix spaces before emotes with the no-space effect.\n\t\t\tlet no_space = false;\n\t\t\tlet i = out.length;\n\t\t\twhile(i--) {\n\t\t\t\tconst token = out[i];\n\t\t\t\tif ( token.type === 'emote' && (token.modifier_flags & NoSpace) === NoSpace )\n\t\t\t\t\tno_space = true;\n\t\t\t\telse {\n\t\t\t\t\tif ( no_space && token.type === 'text' && token.text === ' ' )\n\t\t\t\t\t\tout.splice(i, 1);\n\n\t\t\t\t\tno_space = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n}\n\n/*AddonEmotes.tooltip.interactive = function(target) {\n\tconst mods = target.dataset.modifiers;\n\treturn mods && mods.length > 0;\n}\n\nAddonEmotes.tooltip.delayHide = function(target) {\n\tconst mods = target.dataset.modifiers;\n\treturn mods && mods.length > 0 ? 100 : 0;\n}*/\n\n\n// ============================================================================\n// Emoji\n// ============================================================================\n\nexport const Emoji = {\n\ttype: 'emoji',\n\tpriority: 15,\n\n\tprocess(tokens) {\n\t\tif ( ! tokens || ! tokens.length )\n\t\t\treturn;\n\n\t\tconst splitter = this.emoji.splitter,\n\t\t\tbig = this.context.get('chat.emotes.2x') > 1,\n\t\t\treplace = this.context.get('chat.emoji.replace-joiner') > 0,\n\t\t\tstyle = this.context.get('chat.emoji.style');\n\n\t\tif ( style === 0 )\n\t\t\treturn;\n\n\t\tconst out = [];\n\n\t\tfor(const token of tokens) {\n\t\t\tif ( ! token )\n\t\t\t\tcontinue;\n\n\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\tout.push(token);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst text = replace ?\n\t\t\t\ttoken.text.replace(JOINER_REPLACEMENT, \"\\u200d\") :\n\t\t\t\ttoken.text;\n\n\t\t\tsplitter.lastIndex = 0;\n\t\t\tlet idx = 0, match;\n\n\t\t\twhile((match = splitter.exec(text))) {\n\t\t\t\tconst start = match.index,\n\t\t\t\t\tkey = this.emoji.chars.get(match[0]);\n\n\t\t\t\tif ( ! key )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst emoji = this.emoji.emoji[key[0]],\n\t\t\t\t\tvariant = key[1] ? emoji.variants[key[1]] : emoji,\n\t\t\t\t\tlength = split_chars(match[0]).length;\n\n\t\t\t\tif ( idx !== start )\n\t\t\t\t\tout.push({type: 'text', text: text.slice(idx, start)});\n\n\t\t\t\tout.push({\n\t\t\t\t\ttype: 'emote',\n\n\t\t\t\t\tprovider: 'emoji',\n\t\t\t\t\tcode: key[0],\n\t\t\t\t\tvariant: key[1],\n\n\t\t\t\t\tbig_emoji: big,\n\n\t\t\t\t\tsrc: this.emoji.getFullImage(variant.image, style),\n\t\t\t\t\tsrcSet: this.emoji.getFullImageSet(variant.image, style),\n\n\t\t\t\t\ttext: match[0],\n\t\t\t\t\tlength,\n\t\t\t\t\tmodifiers: [],\n\t\t\t\t\tmodifier_flags: 0\n\t\t\t\t});\n\n\t\t\t\tidx = start + match[0].length;\n\t\t\t}\n\n\t\t\tif ( idx < text.length )\n\t\t\t\tout.push({type: 'text', text: text.slice(idx)});\n\t\t}\n\n\t\treturn out;\n\t}\n}\n\n\n// ============================================================================\n// Twitch Emotes\n// ============================================================================\n\nexport const TwitchEmotes = {\n\ttype: 'twitch-emote',\n\tpriority: 20,\n\n\tprocess(tokens, msg) {\n\t\tif ( ! msg.ffz_emotes )\n\t\t\treturn;\n\n\t\tif ( this.context.get('chat.emotes.enabled') < 1 )\n\t\t\treturn;\n\n\t\tconst data = msg.ffz_emotes,\n\t\t\tanim = this.context.get('chat.emotes.animated'),\n\t\t\tbig = this.context.get('chat.emotes.2x') > 0,\n\t\t\tuse_replacements = this.context.get('chat.fix-bad-emotes'),\n\t\t\temotes = [];\n\n\t\tfor(const emote_id in data)\n\t\t\t// Disable fix for now so we can see what Twitch is sending for emote data.\n\t\t\tif ( has(data, emote_id) ) { // && Array.isArray(data[emote_id]) ) {\n\t\t\t\tfor(const match of data[emote_id])\n\t\t\t\t\temotes.push([emote_id, match.startIndex, match.endIndex + 1]);\n\t\t\t}\n\n\t\tconst e_length = emotes.length;\n\n\t\tif ( ! e_length )\n\t\t\treturn;\n\n\t\tconst out = [];\n\n\t\temotes.sort((a,b) => a[1] !== b[1] ? a[1] - b[1] : b[0] - a[0]);\n\n\t\tlet idx = 0,\n\t\t\teix = 0;\n\n\t\tfor(const token of tokens) {\n\t\t\tconst length = token.length || (token.text && split_chars(token.text).length) || 0,\n\t\t\t\tt_start = idx,\n\t\t\t\tt_end = idx + length;\n\n\t\t\tif ( token.type !== 'text' ) {\n\t\t\t\tout.push(token);\n\t\t\t\tidx = t_end;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst text = split_chars(token.text);\n\n\t\t\twhile( eix < e_length ) {\n\t\t\t\tconst [e_id, e_start, e_end] = emotes[eix];\n\n\t\t\t\t// Do not honor fake emotes that were created for the sake\n\t\t\t\t// of WYSIWYG / autocompletion.\n\t\t\t\tif ( typeof e_id === 'string' ) {\n\t\t\t\t\tif ( e_id.startsWith('__FFZ__') || e_id.startsWith('__BTTV__') ) {\n\t\t\t\t\t\teix++;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Does this emote go outside the bounds of this token?\n\t\t\t\tif ( e_start > t_end || e_end > t_end ) {\n\t\t\t\t\t// Output the remainder of this token.\n\t\t\t\t\tif ( t_start === idx )\n\t\t\t\t\t\tout.push(token);\n\t\t\t\t\telse\n\t\t\t\t\t\tout.push({\n\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\ttext: text.slice(idx - t_start).join('')\n\t\t\t\t\t\t});\n\n\t\t\t\t\t// If this emote goes across token boundaries,\n\t\t\t\t\t// skip it.\n\t\t\t\t\tif ( e_start < t_end && e_end > t_end )\n\t\t\t\t\t\teix++;\n\n\t\t\t\t\tidx = t_end;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// If this emote starts before the current index, skip it.\n\t\t\t\tif ( e_start < idx ) {\n\t\t\t\t\teix++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// If there's text at the beginning of the token that\n\t\t\t\t// isn't part of this emote, output it.\n\t\t\t\tif ( e_start > idx )\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\ttext: text.slice(idx - t_start, e_start - t_start).join('')\n\t\t\t\t\t});\n\n\t\t\t\tlet src, srcSet, animSrc, animSrcSet;\n\t\t\t\tlet src2, srcSet2, animSrc2, animSrcSet2;\n\t\t\t\tlet can_big = true;\n\n\t\t\t\tconst replacement = REPLACEMENTS[e_id];\n\t\t\t\tif ( replacement && use_replacements ) {\n\t\t\t\t\tsrc = `${REPLACEMENT_BASE}${replacement}`;\n\t\t\t\t\tsrcSet = '';\n\t\t\t\t\tcan_big = false;\n\n\t\t\t\t} else {\n\t\t\t\t\tsrc = getTwitchEmoteURL(e_id, 1, false);\n\t\t\t\t\tsrcSet = getTwitchEmoteSrcSet(e_id, false);\n\n\t\t\t\t\tif ( anim > 0 ) {\n\t\t\t\t\t\tanimSrc = getTwitchEmoteURL(e_id, 1, true);\n\t\t\t\t\t\tanimSrcSet = getTwitchEmoteSrcSet(e_id, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( big ) {\n\t\t\t\t\t\tsrc2 = getTwitchEmoteURL(e_id, 2, false);\n\t\t\t\t\t\tsrcSet2 = getTwitchEmoteSrcSet(e_id, false, true, true);\n\n\t\t\t\t\t\tif ( anim > 0 ) {\n\t\t\t\t\t\t\tanimSrc2 = getTwitchEmoteURL(e_id, 2, true);\n\t\t\t\t\t\t\tanimSrcSet2 = getTwitchEmoteSrcSet(e_id, true, true, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst sizes = WEIRD_EMOTE_SIZES[e_id];\n\n\t\t\t\tconst width = sizes ? sizes[0] : 28,\n\t\t\t\t\theight = sizes ? sizes[1] : 28;\n\n\t\t\t\tout.push({\n\t\t\t\t\ttype: 'emote',\n\t\t\t\t\tid: e_id,\n\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\tsrc,\n\t\t\t\t\tsrcSet,\n\t\t\t\t\tsrc2,\n\t\t\t\t\tsrcSet2,\n\t\t\t\t\tanimSrc,\n\t\t\t\t\tanimSrc2,\n\t\t\t\t\tanimSrcSet,\n\t\t\t\t\tanimSrcSet2,\n\t\t\t\t\tanim,\n\t\t\t\t\tbig,\n\t\t\t\t\tcan_big,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\ttext: text.slice(e_start - t_start, e_end - t_start).join(''),\n\t\t\t\t\tmodifiers: [],\n\t\t\t\t\tmodifier_flags: 0\n\t\t\t\t});\n\n\t\t\t\tidx = e_end;\n\t\t\t\teix++;\n\t\t\t}\n\n\t\t\t// We've finished processing emotes. If there is any\n\t\t\t// remaining text in the token, push it out.\n\t\t\tif ( idx < t_end ) {\n\t\t\t\tif ( t_start === idx )\n\t\t\t\t\tout.push(token);\n\t\t\t\telse\n\t\t\t\t\tout.push({\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\ttext: text.slice(idx - t_start).join('')\n\t\t\t\t\t});\n\n\t\t\t\tidx = t_end;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Emote Cards\n// ============================================================================\n\nimport {createElement} from 'utilities/dom';\nimport { getDialogNextZ } from 'utilities/dialog';\nimport {deep_copy, getTwitchEmoteURL} from 'utilities/object';\nimport { EmoteTypes, TWITCH_GLOBAL_SETS, TWITCH_POINTS_SETS, TWITCH_PRIME_SETS } from 'utilities/constants';\n\nimport GET_EMOTE from './twitch_data.gql';\n\nimport Module from 'utilities/module';\n\nfunction getEmoteTypeFromTwitchType(type) {\n\tif ( type === 'SUBSCRIPTIONS' )\n\t\treturn EmoteTypes.Subscription;\n\tif ( type === 'FOLLOWER' )\n\t\treturn EmoteTypes.Follower;\n\tif ( type === 'GLOBALS' || type === 'SMILIES' )\n\t\treturn EmoteTypes.Global;\n\tif ( type === 'LIMITED_TIME' || type === 'MEGA_COMMERCE' )\n\t\treturn EmoteTypes.LimitedTime;\n\tif ( type === 'BITS_BADGE_TIERS' )\n\t\treturn EmoteTypes.BitsTier;\n\tif ( type === 'CHANNEL_POINTS' )\n\t\treturn EmoteTypes.ChannelPoints;\n\tif ( type === 'TWO_FACTOR' )\n\t\treturn EmoteTypes.TwoFactor;\n\tif ( type === 'PRIME' )\n\t\treturn EmoteTypes.Prime;\n\tif ( type === 'TURBO' )\n\t\treturn EmoteTypes.Turbo;\n\n\treturn EmoteTypes.Unknown;\n}\n\n\nfunction tierToNumber(tier) {\n\tif ( tier === '1000' || tier === 'prime' )\n\t\treturn 1;\n\tif ( tier === '2000' )\n\t\treturn 2;\n\tif ( tier === '3000' )\n\t\treturn 3;\n\treturn 1;\n}\n\n\nexport default class EmoteCard extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('chat');\n\t\tthis.inject('chat.emotes');\n\t\tthis.inject('chat.emoji');\n\t\tthis.inject('site');\n\t\tthis.inject('site.apollo');\n\t\tthis.inject('site.twitch_data');\n\n\t\tthis.vue = this.resolve('vue');\n\n\t\t//this.last_z = 9000;\n\t\tthis.open_cards = {};\n\t\tthis.last_card = null;\n\t}\n\n\tonEnable() {\n\n\t\tthis.on('chat.emotes:click', this.handleClick, this);\n\n\t}\n\n\thandleClick(evt) {\n\t\tif ( ! this.chat.context.get('chat.emote-dialogs') )\n\t\t\treturn;\n\n\t\tevt.preventDefault();\n\n\t\tthis.openCard({\n\t\t\tprovider: evt.provider,\n\t\t\tcode: evt.code,\n\t\t\tvariant: evt.variant,\n\t\t\tname: evt.name,\n\t\t\tset: evt.set,\n\t\t\tid: evt.id ?? `${evt.code}::${evt.variant}`\n\t\t}, evt.modifiers, evt.source);\n\n\t}\n\n\tasync loadVue() {\n\t\tif ( this._vue_loaded )\n\t\t\treturn;\n\n\t\tawait this.vue.enable();\n\t\tconst card_component = await import(/* webpackChunkName: 'emote-cards' */ './components/card.vue');\n\t\tthis.vue.component('emote-card', card_component.default);\n\n\t\tthis._vue_loaded = true;\n\t}\n\n\n\tcanReportTwitch() {\n\t\tconst site = this.resolve('site'),\n\t\t\t//core = site.getCore?.(),\n\t\t\tuser = site.getUser(),\n\t\t\tweb_munch = this.resolve('site.web_munch');\n\n\t\tlet report_form;\n\t\ttry {\n\t\t\treport_form = web_munch.getModule('user-report');\n\t\t} catch(err) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !! report_form && !! user?.id && site?.store?.dispatch;\n\t}\n\n\n\treportTwitchEmote(id, channel) {\n\t\tconst site = this.resolve('site'),\n\t\t\t//core = site.getCore(),\n\t\t\tuser = site.getUser(),\n\t\t\tweb_munch = this.resolve('site.web_munch');\n\n\t\tlet report_form;\n\t\ttry {\n\t\t\treport_form = web_munch.getModule('user-report');\n\t\t} catch(err) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( ! user?.id || ! site?.store?.dispatch )\n\t\t\treturn false;\n\n\t\tsite.store.dispatch({\n\t\t\ttype: 'core.modal.MODAL_SHOWN',\n\t\t\tmodalComponent: report_form,\n\t\t\tmodalProps: {\n\t\t\t\treportContext: {\n\t\t\t\t\tcontentID: String(id),\n\t\t\t\t\tcontentMetadata: {\n\t\t\t\t\t\tchannelID: String(user.id)\n\t\t\t\t\t},\n\t\t\t\t\tcontentType: 'EMOTE_REPORT',\n\t\t\t\t\ttargetUserID: String(channel),\n\t\t\t\t\ttrackingContext: 'emote_card'\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n\n\n\tasync loadData(emote) {\n\t\tif ( emote.provider === 'twitch' ) {\n\t\t\tconst apollo = this.resolve('site.apollo');\n\t\t\tif ( ! apollo )\n\t\t\t\tthrow new Error('Unable to load emote data');\n\n\t\t\tconst result = await apollo.client.query({\n\t\t\t\tquery: GET_EMOTE,\n\t\t\t\tvariables: {\n\t\t\t\t\temoteID: emote.id\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif ( ! result?.data?.emote )\n\t\t\t\tthrow new Error('Unable to load emote data');\n\n\t\t\tconst data = result.data.emote;\n\n\t\t\tconst src = getTwitchEmoteURL(data.id, 2, true, true);\n\t\t\tconst srcSet = `${src} 1x, ${getTwitchEmoteURL(data.id, 4, true, true)} 2x`;\n\n\t\t\tlet source;\n\t\t\tlet body;\n\t\t\tlet tier;\n\n\t\t\t//console.log(\"loaded data\", data);\n\n\t\t\tlet type = getEmoteTypeFromTwitchType(data.type);\n\n\t\t\tlet set;\n\t\t\ttry {\n\t\t\t\tset = parseInt(data.setID, 10);\n\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\tif ( TWITCH_GLOBAL_SETS.includes(set) )\n\t\t\t\ttype = EmoteTypes.Global;\n\t\t\telse if ( TWITCH_POINTS_SETS.includes(set) )\n\t\t\t\ttype = EmoteTypes.ChannelPoints;\n\t\t\telse if ( TWITCH_PRIME_SETS.includes(set) )\n\t\t\t\ttype = EmoteTypes.Prime;\n\n\t\t\t//console.log('loaded data', data, type);\n\n\t\t\tif ( type === EmoteTypes.Subscription ) {\n\t\t\t\tconst products = data.owner?.subscriptionProducts;\n\n\t\t\t\tif ( Array.isArray(products) ) {\n\t\t\t\t\tfor(const product of products) {\n\t\t\t\t\t\tif ( product.emotes.some(em => em.id === data.id) ) {\n\t\t\t\t\t\t\ttier = tierToNumber(product.tier);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsource = this.i18n.t('emote-card.sub', 'Tier {tier} Sub Emote ({source})', {\n\t\t\t\t\ttier: tier,\n\t\t\t\t\tsource: data.owner?.displayName || data.owner?.login\n\t\t\t\t});\n\n\t\t\t\tbody = 'twitch';\n\n\t\t\t} else if ( type === EmoteTypes.Follower ) {\n\t\t\t\tsource = this.i18n.t('emote.follower', 'Follower Emote ({source})', {\n\t\t\t\t\tsource: data.owner.displayName || data.owner.login\n\t\t\t\t});\n\t\t\t\tbody = 'twitch';\n\n\t\t\t} else if ( type === EmoteTypes.Global )\n\t\t\t\tsource = this.i18n.t('emote.global', 'Twitch Global');\n\n\t\t\telse if ( type === EmoteTypes.LimitedTime )\n\t\t\t\tsource = this.i18n.t('emote.limited', 'Limited-Time Only Emote');\n\n\t\t\telse if ( type === EmoteTypes.BitsTier ) {\n\t\t\t\tsource = this.i18n.t('emote-card.bits', '{amount,number} Bits Reward ({source})', {\n\t\t\t\t\tamount: data.bitsBadgeTierSummary?.threshold,\n\t\t\t\t\tsource: data.owner.displayName || data.owner.login\n\t\t\t\t});\n\t\t\t\tbody = 'twitch';\n\n\t\t\t} else if ( type === EmoteTypes.TwoFactor )\n\t\t\t\tsource = this.i18n.t('emote.2fa', 'Twitch 2FA Emote');\n\n\t\t\telse if ( type === EmoteTypes.ChannelPoints ) {\n\t\t\t\tsource = this.i18n.t('emote.points', 'Channel Points Emote');\n\t\t\t\tbody = 'twitch';\n\n\t\t\t} else if ( type === EmoteTypes.Prime || type === EmoteTypes.Turbo )\n\t\t\t\tsource = this.i18n.t('emote.prime', 'Prime Gaming');\n\n\t\t\telse\n\t\t\t\tsource = data.type;\n\n\t\t\t//console.log('raw data', data);\n\n\t\t\tconst out = {\n\t\t\t\t//raw: data,\n\t\t\t\tid: data.id,\n\t\t\t\tfav_source: 'twitch',\n\t\t\t\tchannel_id: data.owner?.id,\n\t\t\t\tmore: [],\n\t\t\t\tbody,\n\t\t\t\tsrc,\n\t\t\t\tsrcSet,\n\t\t\t\tname: data.token,\n\t\t\t\tsource,\n\t\t\t\tartist: data.artist\n\t\t\t\t\t? (data.artist.displayName || data.artist.login)\n\t\t\t\t\t: null,\n\t\t\t\tartistLink: data.artist\n\t\t\t\t\t? `https://www.twitch.tv/${data.artist.login}`\n\t\t\t\t\t: null\n\t\t\t};\n\n\t\t\tif ( data.owner?.id ) {\n\t\t\t\tout.channel_title = data.owner.displayName ?? data.owner.login;\n\t\t\t\tout.channel_login = data.owner.login;\n\t\t\t\tout.channel_live = !! data.owner.stream?.id;\n\t\t\t\tout.channel_followed = !! data.owner?.self?.follower?.followedAt;\n\n\t\t\t\tout.more.push({\n\t\t\t\t\ttype: 'link',\n\t\t\t\t\ticon: 'ffz-i-link-ext',\n\t\t\t\t\ttitle: 'View Channel on TwitchEmotes.com',\n\t\t\t\t\thref: `https://twitchemotes.com/channels/${data.owner.id}`\n\t\t\t\t});\n\n\t\t\t\t// Check if we can actually submit a report.\n\t\t\t\tif ( this.canReportTwitch() )\n\t\t\t\tout.more.push({\n\t\t\t\t\ttype: 'report-twitch',\n\t\t\t\t\ttitle_i18n: 'emote-card.report',\n\t\t\t\t\ttitle: 'Report Emote',\n\t\t\t\t\ticon: 'ffz-i-flag'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif ( data.bitsBadgeTierSummary?.threshold ) {\n\t\t\t\tout.unlock_mode = 'bits';\n\t\t\t\tout.unlocked = data.bitsBadgeTierSummary.self?.isUnlocked;\n\t\t\t\tout.bits_amount = data.bitsBadgeTierSummary.threshold;\n\t\t\t\tout.bits_remain = data.bitsBadgeTierSummary.self?.numberOfBitsUntilUnlock ?? out.unlock_amount;\n\n\t\t\t} else if ( type === EmoteTypes.Follower ) {\n\t\t\t\tout.unlock_mode = 'follow';\n\t\t\t\tout.unlocked = false; // out.channel_followed ?? false;\n\t\t\t\tconst extras = out.extra_emotes = [];\n\n\t\t\t\tif ( ! out.unlocked && Array.isArray(data.owner?.channel?.localEmoteSets) )\n\t\t\t\t\tfor(const set of data.owner.channel.localEmoteSets)\n\t\t\t\t\t\tif ( Array.isArray(set.emotes) )\n\t\t\t\t\t\t\tfor(const em of set.emotes) {\n\t\t\t\t\t\t\t\tconst src = getTwitchEmoteURL(em.id, 1, true, true);\n\t\t\t\t\t\t\t\tconst srcSet = `${src} 1x, ${getTwitchEmoteURL(em.id, 2, true, true)} 2x`;\n\n\t\t\t\t\t\t\t\textras.push({\n\t\t\t\t\t\t\t\t\tid: em.id,\n\t\t\t\t\t\t\t\t\tname: em.token,\n\t\t\t\t\t\t\t\t\tsrc,\n\t\t\t\t\t\t\t\t\tsrcSet\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t} else if ( type === EmoteTypes.Subscription ) {\n\t\t\t\tout.unlock_mode = 'subscribe';\n\t\t\t\tout.unlocked = false;\n\t\t\t\tout.unlock_tier = tier;\n\n\t\t\t\tout.existing_tier = 0;\n\t\t\t\tconst bene = data.owner?.self?.subscriptionBenefit;\n\t\t\t\tif ( bene?.tier )\n\t\t\t\t\tout.existing_tier = tierToNumber(bene.tier);\n\n\t\t\t\tconst extras = out.extra_emotes = [],\n\t\t\t\t\textier = out.existing_tier;\n\n\t\t\t\tif ( extier >= tier )\n\t\t\t\t\tout.unlocked = true;\n\t\t\t\telse if ( Array.isArray(data.owner?.subscriptionProducts) )\n\t\t\t\t\tfor(const product of data.owner.subscriptionProducts) {\n\t\t\t\t\t\tconst ptier = tierToNumber(product.tier);\n\t\t\t\t\t\tif ( ptier === tier ) {\n\t\t\t\t\t\t\tout.channel_product = product.name;\n\t\t\t\t\t\t\tif ( product.priceInfo?.price && product.priceInfo.currency ) {\n\t\t\t\t\t\t\t\tconst formatter = new Intl.NumberFormat(navigator.languages, {\n\t\t\t\t\t\t\t\t\tstyle: 'currency',\n\t\t\t\t\t\t\t\t\tcurrency: product.priceInfo.currency\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tout.product_price = formatter.format(product.priceInfo.price / 100);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( ptier > extier && ptier <= tier && Array.isArray(product.emotes) )\n\t\t\t\t\t\t\tfor(const em of product.emotes) {\n\t\t\t\t\t\t\t\tconst src = getTwitchEmoteURL(em.id, 1, true, true);\n\t\t\t\t\t\t\t\tconst srcSet = `${src} 1x, ${getTwitchEmoteURL(em.id, 2, true, true)} 2x`;\n\n\t\t\t\t\t\t\t\textras.push({\n\t\t\t\t\t\t\t\t\tid: em.id,\n\t\t\t\t\t\t\t\t\tname: em.token,\n\t\t\t\t\t\t\t\t\tsrc,\n\t\t\t\t\t\t\t\t\tsrcSet\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn out;\n\t\t}\n\n\t\t// Emoji\n\t\tif ( emote.provider === 'emoji' ) {\n\t\t\tconst emoji = this.emoji.emoji[emote.code],\n\t\t\t\tstyle = this.chat.context.get('chat.emoji.style'),\n\t\t\t\tvariant = emote.variant ? emoji.variants[emote.variant] : emoji,\n\t\t\t\tvcode = emote.variant ? this.emoji.emoji[emote.variant] : null;\n\n\t\t\tconst category = emoji.category ? this.i18n.t(`emoji.category.${emoji.category.toSnakeCase()}`, this.emoji.categories[emoji.category] || emoji.category) : null;\n\n\t\t\tconst out = {\n\t\t\t\tid: emote.code,\n\t\t\t\tfav_source: 'emoji',\n\t\t\t\tmore: [],\n\t\t\t\tsrc: this.emoji.getFullImage(variant.image, style),\n\t\t\t\tsrcSet: this.emoji.getFullImageSet(variant.image, style),\n\t\t\t\twidth: 18,\n\t\t\t\theight: 18,\n\t\t\t\tname: `:${emoji.names[0]}:${vcode ? `:${vcode.names[0]}:` : ''}`,\n\t\t\t\tsource: this.i18n.t('tooltip.emoji', 'Emoji - {category}', {category})\n\t\t\t};\n\n\t\t\treturn out;\n\t\t}\n\n\t\tif ( emote.provider !== 'ffz' )\n\t\t\tthrow new Error('Invalid provider');\n\n\t\t// Try to get the emote set.\n\t\tconst emote_set = this.emotes.emote_sets[emote.set],\n\t\t\tdata = emote_set ? emote_set.emotes?.[emote.id] || emote_set.disabled_emotes?.[emote.id] : null;\n\n\t\tif ( ! data )\n\t\t\tthrow new Error('Unable to load emote data');\n\n\t\tconst out = {\n\t\t\tid: data.id,\n\t\t\tfav_source: emote_set.source ?? 'ffz',\n\t\t\tmore: [],\n\t\t\tsrc: data.animSrc2 ?? data.src2,\n\t\t\tsrcSet: data.animSrcSet2 ?? data.srcSet2,\n\t\t\twidth: data.width,\n\t\t\theight: data.height,\n\t\t\tname: data.name,\n\t\t\toriginalName: data.original_name,\n\t\t\tsource: emote_set.source_line || (`${emote_set.source || 'FFZ'} ${emote_set.title || 'Global Emotes'}`),\n\t\t\towner: data.owner\n\t\t\t\t? (data.owner.display_name || data.owner.name)\n\t\t\t\t: null,\n\t\t\townerLink: data.owner && ! emote_set.source\n\t\t\t\t? `https://www.frankerfacez.com/${data.owner.name}`\n\t\t\t\t: null,\n\t\t\tartist: data.artist\n\t\t\t\t? (data.artist.display_name || data.artist.name)\n\t\t\t\t: null,\n\t\t\tartistLink: data.artist && ! emote_set.source\n\t\t\t\t? `https://www.frankerfacez.com/${data.artist.name}`\n\t\t\t\t: null,\n\t\t};\n\n\t\tif ( ! emote_set.source ) {\n\t\t\tif ( data.public )\n\t\t\t\tout.body = 'manage-ffz';\n\n\t\t\tout.more.push({\n\t\t\t\ttype: 'link',\n\t\t\t\ttitle_i18n: 'emote-card.view-on-ffz',\n\t\t\t\ttitle: 'View on FrankerFaceZ',\n\t\t\t\thref: `https://www.frankerfacez.com/emoticon/${data.id}-`\n\t\t\t});\n\n\t\t\tout.more.push({\n\t\t\t\ttype: 'report-ffz',\n\t\t\t\ttitle_i18n: 'emote-card.report',\n\t\t\t\ttitle: 'Report Emote',\n\t\t\t\ticon: 'ffz-i-flag'\n\t\t\t});\n\n\t\t} else if ( data.click_url ) {\n\t\t\tout.more.push({\n\t\t\t\ttype: 'link',\n\t\t\t\ttitle_i18n: 'emote-card.view-external',\n\t\t\t\ttitle: 'View on {source}',\n\t\t\t\tsource: emote_set.source,\n\t\t\t\thref: data.click_url\n\t\t\t});\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tasync openCard(emote, modifiers, event) {\n\n\t\tconst card_key = `${emote.provider}::${emote.id}::${modifiers ?? ''}`,\n\t\t\told_card = this.open_cards[card_key];\n\n\t\tif ( old_card ) {\n\t\t\told_card.$el.style.zIndex = getDialogNextZ();\n\t\t\told_card.focus();\n\t\t\treturn;\n\t\t}\n\n\t\tlet pos_x = event ? event.clientX : window.innerWidth / 2,\n\t\t\tpos_y = event ? event.clientY + 15 : window.innerHeight / 2;\n\n\t\tif ( this.last_card ) {\n\t\t\tconst card = this.last_card;\n\n\t\t\tif ( ! event ) {\n\t\t\t\tpos_x = card.$el.offsetLeft;\n\t\t\t\tpos_y = card.$el.offsetTop;\n\t\t\t}\n\n\t\t\tcard.close();\n\t\t}\n\n\t\t// Start loading data. Don't await it yet, so we can\n\t\t// wait for Vue at the same time.\n\t\tconst data = this.loadData(emote);\n\n\t\t// Now load vue.\n\t\tawait this.loadVue();\n\n\t\t// Display the card.\n\t\tthis.last_card = this.open_cards[card_key] = this.buildCard(\n\t\t\tpos_x,\n\t\t\tpos_y,\n\t\t\temote,\n\t\t\tmodifiers,\n\t\t\tdata\n\t\t);\n\t}\n\n\tbuildCard(pos_x, pos_y, emote, modifiers, data) {\n\t\tlet child;\n\n\t\tconst component = new this.vue.Vue({\n\t\t\tel: createElement('div'),\n\t\t\trender: h => h('emote-card', {\n\t\t\t\tprops: {\n\t\t\t\t\traw_emote: deep_copy(emote),\n\t\t\t\t\traw_modifiers: modifiers,\n\t\t\t\t\tdata: data,\n\n\t\t\t\t\tgetFFZ: () => this,\n\t\t\t\t\treportTwitchEmote: (...args) => this.reportTwitchEmote(...args),\n\t\t\t\t\tgetZ: getDialogNextZ\n\t\t\t\t},\n\n\t\t\t\ton: {\n\t\t\t\t\temit: (event, ...data) => this.emit(event, ...data),\n\n\t\t\t\t\tclose: () => {\n\t\t\t\t\t\tconst el = component.$el;\n\t\t\t\t\t\tel.remove();\n\t\t\t\t\t\tcomponent.$destroy();\n\n\t\t\t\t\t\tif ( this.last_card === child )\n\t\t\t\t\t\t\tthis.last_card = null;\n\n\t\t\t\t\t\tconst card_key = `${emote.provider}::${emote.id}::${modifiers ?? ''}`;\n\t\t\t\t\t\tif ( this.open_cards[card_key] === child )\n\t\t\t\t\t\t\tthis.open_cards[card_key] = null;\n\n\t\t\t\t\t\tthis.emit('tooltips:cleanup');\n\t\t\t\t\t},\n\n\t\t\t\t\tpin: () => {\n\t\t\t\t\t\tif ( this.last_card === child )\n\t\t\t\t\t\t\tthis.last_card = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tchild = component.$children[0];\n\n\t\tconst el = component.$el;\n\t\tel.style.left = `${pos_x}px`;\n\t\tel.style.top = `${pos_y}px`;\n\n\t\tconst container = document.querySelector(this.site.constructor.DIALOG_SELECTOR ?? '#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height');\n\t\tcontainer.appendChild(el);\n\n\t\trequestAnimationFrame(() => child.constrain());\n\n\t\treturn child;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Link Cards\n// ============================================================================\n\nimport { createElement } from 'utilities/dom';\nimport { getDialogNextZ } from 'utilities/dialog';\nimport { deep_copy } from 'utilities/object';\n\nimport Module from 'utilities/module';\n\n\nexport default class LinkCard extends Module {\n\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('chat');\n\t\tthis.inject('site');\n\t\tthis.inject('settings');\n\n\t\tthis.vue = this.resolve('vue');\n\n\t\tthis.settings.add('link-cards.enable', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Link Cards >> General',\n\t\t\t\ttitle: 'Enable Link Cards.',\n\t\t\t\tdescription: 'When this is enabled and you click a link in chat or whispers, a popup will open with information about the link. This provides the same data as rich link tooltips, but in a form that allows more interaction.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('link-cards.use-destination', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Link Cards >> General',\n\t\t\t\ttitle: 'Bypass Known Shorteners',\n\t\t\t\tdescription: 'When clicking \"Open Link\" from a Link Card with this enabled, you will bypass known shorteners and tracking services and go directly to the destination URL.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\t//this.last_z = 9000;\n\t\tthis.open_cards = {};\n\t\tthis.last_card = null;\n\t}\n\n\tonEnable() {\n\t\tthis.on('chat:click-link', this.handleClick, this);\n\t}\n\n\thandleClick(evt) {\n\t\tif ( ! this.settings.get('link-cards.enable') )\n\t\t\treturn;\n\n\t\tevt.preventDefault();\n\t\tthis.openCard(evt.url, evt.source);\n\t}\n\n\tasync loadVue() {\n\t\tif ( this._vue_loaded )\n\t\t\treturn;\n\n\t\tawait this.vue.enable();\n\t\tconst card_component = await import(/* webpackChunkName: 'emote-cards' */ './components/card.vue');\n\t\tthis.vue.component('link-card', card_component.default);\n\n\t\tthis.vue.component('lc-url', {\n\t\t\tfunctional: true,\n\t\t\tprops: ['url', 'show-protocol'],\n\t\t\trender(createElement, context) {\n\n\t\t\t\tlet url = context.props.url;\n\t\t\t\tif ( !(url instanceof URL) )\n\t\t\t\t\turl = new URL(url);\n\n\t\t\t\tconst out = [];\n\n\t\t\t\tif ( context.props.showProtocol )\n\t\t\t\t\tout.push(createElement('span', {\n\t\t\t\t\t\tclass: 'tw-c-text-alt-2'\n\t\t\t\t\t}, `${url.protocol}//`));\n\n\t\t\t\tout.push(createElement('span', url.host));\n\n\t\t\t\tlet suffix = url.toString().slice(url.origin.length);\n\n\t\t\t\tif ( suffix.length && suffix !== '/' )\n\t\t\t\t\tout.push(createElement('span', {\n\t\t\t\t\t\tclass: 'tw-c-text-alt-2'\n\t\t\t\t\t}, suffix));\n\n\t\t\t\treturn createElement('span', out);\n\t\t\t}\n\t\t});\n\n\t\tthis._vue_loaded = true;\n\t}\n\n\tasync openCard(link, event) {\n\t\tconst card_key = `${link}`,\n\t\t\told_card = this.open_cards[card_key];\n\n\t\tif ( old_card ) {\n\t\t\told_card.$el.style.zIndex = getDialogNextZ();\n\t\t\told_card.focus();\n\t\t\treturn;\n\t\t}\n\n\t\tlet pos_x = event ? event.clientX : window.innerWidth / 2,\n\t\t\tpos_y = event ? event.clientY + 15 : window.innerHeight / 2;\n\n\t\t/*if ( this.last_card ) {\n\t\t\tconst card = this.last_card;\n\n\t\t\tif ( ! event ) {\n\t\t\t\tpos_x = card.$el.offsetLeft;\n\t\t\t\tpos_y = card.$el.offsetTop;\n\t\t\t}\n\n\t\t\tcard.close();\n\t\t}*/\n\n\t\t// Start loading data. Don't await it yet, so we can\n\t\t// wait for Vue at the same time.\n\t\tconst data = this.chat.get_link_info(link);\n\n\t\t// Now load vue.\n\t\tawait this.loadVue();\n\n\t\t// Display the card.\n\t\tthis.last_card = this.open_cards[card_key] = this.buildCard(\n\t\t\tpos_x,\n\t\t\tpos_y,\n\t\t\tlink,\n\t\t\tdata\n\t\t);\n\t}\n\n\tbuildCard(pos_x, pos_y, link, data) {\n\t\tlet child;\n\n\t\tconst component = new this.vue.Vue({\n\t\t\tel: createElement('div'),\n\t\t\trender: h => h('link-card', {\n\t\t\t\tprops: {\n\t\t\t\t\turl: link,\n\t\t\t\t\tdata: data,\n\n\t\t\t\t\tuse_dest: this.settings.get('link-cards.use-destination'),\n\n\t\t\t\t\tgetFFZ: () => this,\n\t\t\t\t\tgetZ: getDialogNextZ\n\t\t\t\t},\n\n\t\t\t\ton: {\n\t\t\t\t\temit: (event, ...data) => this.emit(event, ...data),\n\n\t\t\t\t\tclose: () => {\n\t\t\t\t\t\tconst el = component.$el;\n\t\t\t\t\t\tel.remove();\n\t\t\t\t\t\tcomponent.$destroy();\n\n\t\t\t\t\t\tif ( this.last_card === child )\n\t\t\t\t\t\t\tthis.last_card = null;\n\n\t\t\t\t\t\tconst card_key = link;\n\t\t\t\t\t\tif ( this.open_cards[card_key] === child )\n\t\t\t\t\t\t\tthis.open_cards[card_key] = null;\n\n\t\t\t\t\t\tthis.emit('tooltips:cleanup');\n\t\t\t\t\t},\n\n\t\t\t\t\tpin: () => {\n\t\t\t\t\t\tif ( this.last_card === child )\n\t\t\t\t\t\t\tthis.last_card = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tchild = component.$children[0];\n\n\t\tconst el = component.$el;\n\t\tel.style.left = `${pos_x}px`;\n\t\tel.style.top = `${pos_y}px`;\n\n\t\tconst container = document.querySelector(this.site.constructor.DIALOG_SELECTOR ?? '#root>div>.tw-full-height,.twilight-minimal-root>.tw-full-height');\n\t\tcontainer.appendChild(el);\n\n\t\trequestAnimationFrame(() => child.constrain());\n\n\t\treturn child;\n\t}\n}","'use strict';\n\n// ============================================================================\n// Menu Module\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {createElement} from 'utilities/dom';\nimport {get, has, deep_copy, set_equals} from 'utilities/object';\n\nimport Dialog from 'utilities/dialog';\n\nimport SettingMixin from './setting-mixin';\nimport ProviderMixin from './provider-mixin';\n\nimport {NO_SYNC_KEYS, parse_path} from 'src/settings';\n\nfunction format_term(term) {\n\tif ( typeof term !== 'string' )\n\t\treturn term;\n\n\treturn term.replace(/<[^>]*>/g, '').toLocaleLowerCase();\n}\n\n\n// TODO: Rewrite literally everything about the menu to use a router and further\n// separate the concept of navigation from visible pages.\n\nexport default class MainMenu extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('site');\n\t\tthis.inject('vue');\n\n\t\tthis.load_requires = ['vue'];\n\n\t\tthis.Mixin = this.SettingMixin = SettingMixin;\n\t\tthis.ProviderMixin = ProviderMixin;\n\n\t\t//this.should_enable = true;\n\n\t\tthis.exclusive = false;\n\t\tthis.new_seen = false;\n\n\t\tthis._settings_tree = null;\n\t\tthis._settings_count = 0;\n\n\t\tthis.dialog = new Dialog(() => this.buildDialog());\n\t\tthis.has_update = false;\n\t\tthis.opened = false;\n\t\tthis.showing = false;\n\n\t\tthis.context = this.settings.context();\n\n\t\tthis.settings.addUI('profiles', {\n\t\t\tpath: 'Data Management @{\"sort\": 1000, \"profile_warning\": false} > Profiles @{\"profile_warning\": false}',\n\t\t\tcomponent: 'profile-manager'\n\t\t});\n\n\t\tthis.settings.addUI('backup', {\n\t\t\tpath: 'Data Management > Backup and Restore @{\"profile_warning\": false}',\n\t\t\tcomponent: 'backup-restore',\n\t\t\tgetExtraTerms: () => ['restore'],\n\t\t\tgetFFZ: () => this.resolve('core')\n\t\t});\n\n\t\tthis.settings.addUI('clear', {\n\t\t\tpath: 'Data Management > Storage @{\"profile_warning\": false} >> tabs ~> Clear',\n\t\t\tcomponent: 'clear-settings',\n\t\t\tgetExtraTerms: () => ['reset'],\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.addUI('provider', {\n\t\t\tpath: 'Data Management > Storage >> tabs ~> Provider',\n\t\t\tcomponent: 'provider',\n\t\t\tgetExtraTerms: () => ['storage', 'local', 'indexeddb', 'localstorage'],\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.addUI('home', {\n\t\t\tpath: 'Home @{\"sort\": -1000, \"profile_warning\": false}',\n\t\t\tcomponent: 'home-page',\n\t\t\trequestPage: page => this.requestPage(page),\n\t\t\tgetUnseen: () => {\n\t\t\t\tif ( ! this.unseen?.size )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst categories = {},\n\t\t\t\t\tout = [];\n\n\t\t\t\tlet i = 0;\n\n\t\t\t\tfor(const item of this.unseen) {\n\t\t\t\t\tconst def = this.settings.definitions.get(item) || this.settings.ui_structures.get(item);\n\t\t\t\t\tif ( ! def || ! def.ui || ! def.ui.path_tokens )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tconst path = def.ui.path,\n\t\t\t\t\t\ttitle = def.ui.title;\n\n\t\t\t\t\ti++;\n\t\t\t\t\tif ( i > 20 )\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tif ( ! categories[path] ) {\n\t\t\t\t\t\tconst key = def.ui.path_tokens.map(x => x.key).join('.');\n\t\t\t\t\t\tconst tokens = [];\n\n\t\t\t\t\t\tlet cat = this._settings_tree[key];\n\t\t\t\t\t\twhile ( cat ) {\n\t\t\t\t\t\t\ttokens.unshift({\n\t\t\t\t\t\t\t\ti18n: cat.i18n_key,\n\t\t\t\t\t\t\t\ttitle: cat.title\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif ( cat.parent ) {\n\t\t\t\t\t\t\t\tif ( cat.page || cat.tab )\n\t\t\t\t\t\t\t\t\ttokens.unshift({title: '>>'});\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\ttokens.unshift({title: '>'});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcat = this._settings_tree[cat.parent];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tout.push(categories[path] = {\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\ttokens,\n\t\t\t\t\t\t\tentries: []\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ! path || ! title )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcategories[path].entries.push({\n\t\t\t\t\t\tkey: item,\n\t\t\t\t\t\ti18n: def.ui.i18n_key ?? `setting.entry.${item}`,\n\t\t\t\t\t\ttitle\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif ( ! out.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn out;\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.addUI('debug.graphql-test', {\n\t\t\tpath: 'Debugging > GraphQL >> Inspector',\n\t\t\tcomponent: 'graphql-inspect',\n\t\t\tgetFFZ: () => this.resolve('core'),\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.addUI('faq', {\n\t\t\tpath: 'Home > FAQ @{\"profile_warning\": false}',\n\t\t\tcomponent: 'md-page',\n\t\t\tkey: 'faq'\n\t\t});\n\n\t\tthis.settings.addUI('chat.filtering.syntax-help', {\n\t\t\tpath: 'Chat > Filtering > Syntax Help @{\"profile_warning\": false}',\n\t\t\tcomponent: 'md-page',\n\t\t\tkey: 'term-syntax',\n\t\t\tforce_seen: true\n\t\t});\n\n\t\t/*this.settings.addUI('privacy', {\n\t\t\tpath: 'Home > Privacy @{\"profile_warning\": false}',\n\t\t\tcomponent: 'md-page',\n\t\t\tkey: 'privacy',\n\t\t\tforce_seen: true\n\t\t});*/\n\n\t\tthis.settings.addUI('feedback', {\n\t\t\tpath: 'Home > Feedback @{\"profile_warning\": false}',\n\t\t\tcomponent: 'md-page',\n\t\t\tkey: 'feedback'\n\t\t});\n\n\t\tthis.settings.addUI('feedback.log', {\n\t\t\tpath: 'Home > Feedback >> Log @{\"sort\": 1000}',\n\t\t\tcomponent: 'async-text',\n\t\t\twatch: [\n\t\t\t\t'reports.error.include-user',\n\t\t\t\t'reports.error.include-settings'\n\t\t\t],\n\t\t\tdata: () => this.resolve('core').generateLog()\n\t\t})\n\n\t\tthis.settings.addUI('changelog', {\n\t\t\tpath: 'Home > Changelog @{\"profile_warning\": false}',\n\t\t\tcomponent: 'changelog',\n\t\t\tgetFFZ: () => this\n\t\t});\n\n\t\tthis.settings.addUI('addon-changelog', {\n\t\t\tpath: 'Add-Ons > Changelog @{\"sort\": -1000, \"profile_warning\": false, \"hide_children\": true}',\n\t\t\tcomponent: 'changelog',\n\t\t\tforce_seen: true,\n\t\t\taddons: true,\n\t\t\tgetFFZ: () => this\n\t\t});\n\n\t\tthis.settings.addUI('legal', {\n\t\t\tpath: 'Home > Legal @{\"sort\": 1000}',\n\t\t\tcomponent: 'md-page',\n\t\t\tkey: 'legal',\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.add('ffz.search.matches-only', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Control Center >> Search',\n\t\t\t\ttitle: 'Hide items that do not match completely when searching.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.on('settings:added-definition', (key, definition) => {\n\t\t\tthis._addDefinitionToTree(key, definition);\n\t\t\tthis.scheduleUpdate();\n\t\t});\n\n\t\tthis.on('settings:removed-definition', key => {\n\t\t\tthis._removeDefinitionFromTree(key);\n\t\t\tthis.scheduleUpdate();\n\t\t});\n\n\t\tthis.on('pubsub:command:new_version', version => {\n\t\t\tif ( version === window.FrankerFaceZ.version_info.commit )\n\t\t\t\treturn;\n\n\t\t\tthis.log.info('New Version:', version);\n\t\t\tthis.has_update = true;\n\n\t\t\tconst mb = this.resolve('site.menu_button');\n\t\t\tif ( mb )\n\t\t\t\tmb.has_update = true;\n\n\t\t\tif ( this._vue )\n\t\t\t\tthis._vue.$children[0].context.has_update = true;\n\t\t});\n\n\t\tthis.scheduleUpdate();\n\n\t\tthis.on(':open', evt => {\n\t\t\t// If we're on a page with minimal root, we want to open settings\n\t\t\t// in a popout as we're almost certainly within Popout Chat.\n\t\t\tconst layout = this.resolve('site.layout'),\n\t\t\t\titem = evt?.item,\n\t\t\t\tevent = evt?.event;\n\n\t\t\tif ( (layout && layout.is_minimal) || (event && (event.ctrlKey || event.shiftKey)) ) {\n\t\t\t\tif ( ! this.openPopout(item) && evt )\n\t\t\t\t\tevt.errored = true;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( item )\n\t\t\t\tthis.requestPage(item);\n\t\t\tif ( this.showing )\n\t\t\t\treturn;\n\n\t\t\tthis.emit('site.menu_button:clicked');\n\t\t});\n\t}\n\n\n\topenPopout(item) {\n\t\tconst win = window.open(\n\t\t\t`https://twitch.tv/popout/frankerfacez/chat?ffz-settings${item ? `=${encodeURIComponent(item)}` : ''}`,\n\t\t\t'_blank',\n\t\t\t'resizable=yes,scrollbars=yes,width=850,height=600'\n\t\t);\n\n\t\tif ( win ) {\n\t\t\twin.focus();\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthis.log.warn('Unable to open popout settings window.');\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync onLoad() {\n\t\tthis.vue.component(\n\t\t\t(await import(/* webpackChunkName: \"main-menu\" */ './components.js')).default\n\t\t);\n\t}\n\n\n\tasync onEnable() {\n\t\tawait this.site.awaitElement(Dialog.EXCLUSIVE);\n\t\tawait this.i18n.loadChunk('settings');\n\n\t\tthis.on('addons:added', this.scheduleUpdate, this);\n\t\tthis.on('experiments:enabled', this.scheduleUpdate, this);\n\t\tthis.on('i18n:update', this.scheduleUpdate, this);\n\n\t\tthis.dialog.on('show', () => {\n\t\t\tif ( this.dialog.maximized )\n\t\t\t\tthis.runFix(1);\n\n\t\t\tthis.showing = true;\n\t\t\tthis.opened = true;\n\t\t\tthis.updateButtonUnseen();\n\t\t\tthis.emit('show')\n\t\t});\n\t\tthis.dialog.on('hide', () => {\n\t\t\tif ( this.dialog.maximized )\n\t\t\t\tthis.runFix(-1);\n\n\t\t\tthis.showing = false;\n\t\t\tthis.emit('hide');\n\t\t\tthis.destroyDialog();\n\t\t});\n\n\t\tthis.dialog.on('resize', () => {\n\t\t\tif ( this.dialog.visible )\n\t\t\t\tthis.runFix(this.dialog.maximized ? 1 : -1);\n\n\t\t\tif ( this._vue )\n\t\t\t\tthis._vue.$children[0].maximized = this.dialog.maximized\n\t\t});\n\n\t\tthis.on('site.menu_button:clicked', this.dialog.toggleVisible, this.dialog);\n\t\tthis.dialog.show();\n\t}\n\n\tonDisable() {\n\t\tthis.dialog.hide();\n\t\tthis.off('site.menu_button:clicked', this.dialog.toggleVisible, this.dialog);\n\t}\n\n\n\tmdNavigate(thing) {\n\t\tconst path = thing?.dataset?.settingsLink;\n\t\tif ( ! path )\n\t\t\treturn;\n\n\t\tthis.requestPage(path);\n\n\t\tif ( ! this.showing )\n\t\t\tthis.emit('site.menu_button:clicked');\n\t}\n\n\n\tupdateContext(context) {\n\t\tif ( ! context )\n\t\t\tcontext = this._context;\n\n\t\tthis._context = context;\n\n\t\tif ( this.use_context ) {\n\t\t\tif ( ! this.context._updateContext ) {\n\t\t\t\tthis.context._updateContext = this.context.updateContext;\n\t\t\t\tthis.context.updateContext = function(context) {\n\t\t\t\t\tconst accepted = {};\n\t\t\t\t\tfor(const key of NO_SYNC_KEYS)\n\t\t\t\t\t\tif ( has(context, key) )\n\t\t\t\t\t\t\taccepted[key] = context[key];\n\n\t\t\t\t\tthis._updateContext(accepted);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.context._context = {};\n\t\t\tthis.context._updateContext({\n\t\t\t\t...context,\n\t\t\t\tcan_proxy: context?.proxied || false\n\t\t\t});\n\n\t\t} else {\n\t\t\tif ( this.context._updateContext ) {\n\t\t\t\tthis.context.updateContext = this.context._updateContext;\n\t\t\t\tthis.context._updateContext = null;\n\t\t\t}\n\n\t\t\tthis.context.setContext({can_proxy: context?.proxied || false});\n\t\t}\n\t}\n\n\n\topenExclusive() {\n\t\twindow.addEventListener('message', event => {\n\t\t\tconst type = event.data?.ffz_type;\n\n\t\t\tif ( type === 'context-update' )\n\t\t\t\tthis.updateContext({...event.data.ctx, proxied: true});\n\n\t\t\telse if ( type === 'context-gone' ) {\n\t\t\t\tthis.log.info('Context proxy gone.');\n\t\t\t\tthis.updateContext({proxied: false});\n\t\t\t}\n\n\t\t});\n\n\t\ttry {\n\t\t\twindow.opener.postMessage({\n\t\t\t\tffz_type: 'request-context'\n\t\t\t}, '*');\n\t\t} catch(err) {\n\t\t\tthis.log.info('Unable to request settings context from opener.');\n\t\t}\n\n\t\tthis.exclusive = true;\n\t\tthis.dialog.exclusive = true;\n\t\tthis.enable().then(() => this.dialog.show());\n\t}\n\n\trunFix(amount) {\n\t\tthis.settings.updateContext({\n\t\t\tforce_chat_fix: (this.settings.get('context.force_chat_fix') || 0) + amount\n\t\t});\n\t}\n\n\n\trequestPage(page) {\n\t\tconst vue = get('_vue.$children.0', this);\n\t\tif ( vue && vue.navigate )\n\t\t\tvue.navigate(page);\n\t\telse\n\t\t\tthis._wanted_page = page;\n\t}\n\n\n\tgetUnseen() {\n\t\tconst pages = this.getSettingsTree();\n\t\tif ( ! Array.isArray(pages) )\n\t\t\treturn 0;\n\n\t\tlet i=0;\n\t\tfor(const page of pages)\n\t\t\tif ( page )\n\t\t\t\ti += (page.unseen || 0);\n\n\t\treturn i;\n\t}\n\n\n\tbuildDialog() {\n\t\tif ( this._menu )\n\t\t\treturn this._menu;\n\n\t\tthis._vue = new this.vue.Vue({\n\t\t\tel: createElement('div'),\n\t\t\trender: h => h('main-menu', this.getData())\n\t\t});\n\n\t\treturn this._menu = this._vue.$el;\n\t}\n\n\tdestroyDialog() {\n\t\tif ( this._vue )\n\t\t\tthis._vue.$destroy();\n\n\t\tthis._menu = this._vue = null;\n\t}\n\n\n\tscheduleUpdate() {\n\t\tif ( this._update_timer )\n\t\t\treturn;\n\n\t\tthis._update_timer = setTimeout(() => {\n\t\t\t// Make sure i18n is loaded before we try this.\n\t\t\tthis.i18n.enable().then(() => this.updateLiveMenu());\n\t\t}, 250);\n\t}\n\n\n\tupdateButtonUnseen() {\n\t\tconst mb = this.resolve('site.menu_button');\n\t\tif ( mb )\n\t\t\tmb.new_settings = this.opened ? 0 : this.getUnseen();\n\t}\n\n\n\tupdateLiveMenu() {\n\t\tclearTimeout(this._update_timer);\n\t\tthis._update_timer = null;\n\n\t\tthis.updateButtonUnseen();\n\n\t\tif ( ! this._vue || ! this._vue.$children || ! this._vue.$children[0] )\n\t\t\treturn;\n\n\t\tconst root = this._vue.$children[0],\n\t\t\titem = root.currentItem,\n\t\t\tkey = item && item.full_key,\n\t\t\twants_old = ! root.restoredItem,\n\t\t\tstate = window.history.state,\n\n\t\t\ttree = this.getSettingsTree();\n\n\t\troot.nav = tree;\n\t\troot.navKeys = tree.keys;\n\n\t\tlet current, restored = true;\n\n\t\tif ( this._wanted_page )\n\t\t\tcurrent = tree.keys[this._wanted_page];\n\n\t\tif ( ! current && wants_old ) {\n\t\t\tif ( state?.ffzcc )\n\t\t\t\tcurrent = tree.keys[state.ffzcc];\n\t\t\tif ( ! current ) {\n\t\t\t\tconst params = new URL(window.location).searchParams,\n\t\t\t\t\tkey = params?.get('ffz-settings');\n\t\t\t\tcurrent = key && tree.keys[key];\n\t\t\t}\n\t\t\tif ( ! current )\n\t\t\t\trestored = false;\n\t\t}\n\n\t\tif ( ! current )\n\t\t\tcurrent = tree.keys[key];\n\n\t\tif ( ! current )\n\t\t\tcurrent = this.has_update ?\n\t\t\t\ttree.keys['home.changelog'] :\n\t\t\t\ttree.keys['home'];\n\n\t\troot.currentItem = current;\n\t\troot.restoredItem = restored;\n\n\t\tthis._wanted_page = null;\n\t}\n\n\n\trebuildSettingsTree() {\n\t\tthis._settings_tree = {};\n\t\tthis._settings_count = 0;\n\n\t\tfor(const [key, def] of this.settings.definitions)\n\t\t\tthis._addDefinitionToTree(key, def);\n\n\t\tfor(const [key, def] of this.settings.ui_structures)\n\t\t\tthis._addDefinitionToTree(key, def);\n\t}\n\n\n\t_removeDefinitionFromTree(key) {\n\t\tif ( ! this._settings_tree )\n\t\t\treturn;\n\n\t\tlet page;\n\t\tfor(const val of Object.values(this._settings_tree)) {\n\t\t\tif ( ! val || ! Array.isArray(val.settings) )\n\t\t\t\tcontinue;\n\n\t\t\tfor(let i = 0; i < val.settings.length; i++) {\n\t\t\t\tconst entry = val.settings[i];\n\t\t\t\tif ( entry && entry[0] === key ) {\n\t\t\t\t\tval.settings.splice(i, 1);\n\t\t\t\t\tpage = val;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( page )\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Was it found?\n\t\tif ( ! page )\n\t\t\treturn;\n\n\t\tthis._maybeDeleteSection(page);\n\t}\n\n\t_maybeDeleteSection(page) {\n\t\t// Is the section empty?\n\t\tif ( page.settings && page.settings.length )\n\t\t\treturn;\n\n\t\tconst id = page.full_key;\n\n\t\t// Check for children.\n\t\tfor(const val of Object.values(this._settings_tree)) {\n\t\t\tif ( val.parent === id )\n\t\t\t\treturn;\n\t\t}\n\n\t\t// Nope~\n\t\tdelete this._settings_tree[id];\n\n\t\tif ( page.parent ) {\n\t\t\tconst parent = this._settings_tree[page.parent];\n\t\t\tif ( parent )\n\t\t\t\tthis._maybeDeleteSection(parent);\n\t\t}\n\t}\n\n\t_addDefinitionToTree(key, def) {\n\t\tif ( ! def.ui || ! this._settings_tree )\n\t\t\treturn;\n\n\t\tif ( ! def.ui.path_tokens ) {\n\t\t\tif ( def.ui.path )\n\t\t\t\tdef.ui.path_tokens = parse_path(def.ui.path);\n\t\t\telse\n\t\t\t\treturn;\n\t\t}\n\n\t\tif ( ! def.ui || ! def.ui.path_tokens || ! this._settings_tree )\n\t\t\treturn;\n\n\t\tconst tree = this._settings_tree,\n\t\t\ttokens = def.ui.path_tokens,\n\t\t\tlen = tokens.length;\n\n\t\tlet prefix = null,\n\t\t\ttoken;\n\n\t\t// Create and/or update all the necessary structure elements for\n\t\t// this node in the settings tree.\n\t\tfor(let i=0; i < len; i++) {\n\t\t\tconst raw_token = tokens[i],\n\t\t\t\tkey = prefix ? `${prefix}.${raw_token.key}` : raw_token.key;\n\n\t\t\ttoken = tree[key];\n\t\t\tif ( ! token )\n\t\t\t\ttoken = tree[key] = {\n\t\t\t\t\tfull_key: key,\n\t\t\t\t\tsort: 0,\n\t\t\t\t\tparent: prefix,\n\t\t\t\t\texpanded: prefix == null,\n\t\t\t\t\ti18n_key: `setting.${key}`,\n\t\t\t\t\tdesc_i18n_key: `setting.${key}.description`\n\t\t\t\t};\n\n\t\t\tObject.assign(token, raw_token);\n\n\t\t\tprefix = key;\n\t\t}\n\n\t\t// Add this setting to the tree.\n\t\ttoken.settings = token.settings || [];\n\t\ttoken.settings.push([key, def]);\n\t\tthis._settings_count++;\n\t}\n\n\n\tgetSettingsTree() {\n\t\tconst started = performance.now();\n\n\t\tif ( ! this._settings_tree )\n\t\t\tthis.rebuildSettingsTree();\n\n\t\tconst tree = this._settings_tree,\n\t\t\tsettings_seen = this.new_seen ? null : this.settings.provider.get('cfg-seen'),\n\t\t\tunseen = settings_seen ? new Set : null,\n\t\t\tnew_seen = settings_seen ? null : [],\n\n\t\t\tcollapsed = this.settings.provider.get('cfg-collapsed'),\n\n\t\t\troot = {},\n\t\t\tcopies = {},\n\n\t\t\tneeds_sort = new Set,\n\t\t\tneeds_component = new Set,\n\n\t\t\thave_locale = this.i18n.locale !== 'en';\n\n\t\tif ( new_seen )\n\t\t\tthis.new_seen = true;\n\n\t\tfor(const key in tree) {\n\t\t\tif ( ! has(tree, key) )\n\t\t\t\tcontinue;\n\n\t\t\tconst token = copies[key] = copies[key] || Object.assign({}, tree[key]),\n\t\t\t\tp_key = token.parent,\n\t\t\t\tparent = p_key ?\n\t\t\t\t\t(copies[p_key] = copies[p_key] || Object.assign({}, tree[p_key])) :\n\t\t\t\t\troot;\n\n\t\t\ttoken.parent = p_key ? parent : null;\n\t\t\ttoken.page = token.page || parent.page;\n\n\t\t\tif ( collapsed )\n\t\t\t\ttoken.expanded = ! collapsed.includes(token.full_key);\n\n\t\t\tif ( token.page && ! token.component )\n\t\t\t\tneeds_component.add(token);\n\n\t\t\tif ( token.settings ) {\n\t\t\t\tconst list = token.contents = token.contents || [];\n\n\t\t\t\tfor(const [setting_key, def] of token.settings)\n\t\t\t\t\tif ( def.ui ) { //} && def.ui.title ) {\n\t\t\t\t\t\tconst i18n_key = def.ui.i18n_key ? def.ui.i18n_key : setting_key ? `setting.entry.${setting_key}` : def.ui.key ? `${token.i18n_key}.${def.ui.key}` : token.i18n_key;\n\t\t\t\t\t\tconst tok = Object.assign({\n\t\t\t\t\t\t\ti18n_key,\n\t\t\t\t\t\t\tdesc_i18n_key: `${i18n_key}.description`,\n\t\t\t\t\t\t\tsort: 0,\n\t\t\t\t\t\t\t//title: setting_key\n\t\t\t\t\t\t}, def.ui, {\n\t\t\t\t\t\t\tfull_key: `setting:${setting_key}`,\n\t\t\t\t\t\t\tsetting: setting_key,\n\t\t\t\t\t\t\tpath_tokens: undefined,\n\t\t\t\t\t\t\tparent: token\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif ( has(def, 'default') && ! has(tok, 'default') ) {\n\t\t\t\t\t\t\tconst def_type = typeof def.default;\n\t\t\t\t\t\t\tif ( def_type === 'object' )\n\t\t\t\t\t\t\t\ttok.default = deep_copy(def.default);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\ttok.default = def.default;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet terms = [\n\t\t\t\t\t\t\tsetting_key\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tif ( tok.title ) {\n\t\t\t\t\t\t\tterms.push(tok.i18n_key ? this.i18n.t(tok.i18n_key, tok.title, null, true) : tok.title);\n\n\t\t\t\t\t\t\tif ( have_locale && tok.i18n_key && this.i18n.has(tok.i18n_key) )\n\t\t\t\t\t\t\t\tterms.push(this.i18n.t(tok.i18n_key, tok.title, null));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( tok.description ) {\n\t\t\t\t\t\t\tterms.push(tok.desc_i18n_key ? this.i18n.t(tok.desc_i18n_key, tok.description, null, true) : tok.description);\n\n\t\t\t\t\t\t\tif ( have_locale && tok.desc_i18n_key && this.i18n.has(tok.desc_i18n_key) )\n\t\t\t\t\t\t\t\tterms.push(this.i18n.t(tok.desc_i18n_key, tok.description, null));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( tok.getExtraTerms )\n\t\t\t\t\t\t\tterms = terms.concat(tok.getExtraTerms());\n\n\t\t\t\t\t\ttok.search_terms = terms.map(format_term).join('\\n');\n\n\t\t\t\t\t\tif ( settings_seen ) {\n\t\t\t\t\t\t\tif ( ! settings_seen.includes(setting_key) && ! tok.force_seen ) {\n\t\t\t\t\t\t\t\tunseen.add(setting_key);\n\t\t\t\t\t\t\t\tlet i = tok;\n\t\t\t\t\t\t\t\twhile(i) {\n\t\t\t\t\t\t\t\t\ti.unseen = (i.unseen || 0) + 1;\n\t\t\t\t\t\t\t\t\ti = i.parent;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ( new_seen )\n\t\t\t\t\t\t\tnew_seen.push(setting_key);\n\n\t\t\t\t\t\tlist.push(tok);\n\t\t\t\t\t}\n\n\t\t\t\ttoken.settings = undefined;\n\t\t\t\tif ( list.length > 1 )\n\t\t\t\t\tneeds_sort.add(list);\n\t\t\t}\n\n\t\t\tif ( ! token.search_terms ) {\n\t\t\t\tconst formatted = token.title && (token.i18n_key ? this.i18n.t(token.i18n_key, token.title, null, true) : token.title);\n\t\t\t\tlet terms = [token.key];\n\n\t\t\t\tif ( formatted && formatted.localeCompare(token.key, undefined, {sensitivity: 'base'}) )\n\t\t\t\t\tterms.push(formatted);\n\n\t\t\t\tif ( have_locale && token.i18n_key && this.i18n.has(token.i18n_key) )\n\t\t\t\t\tterms.push(this.i18n.t(token.i18n_key, token.title, null));\n\n\t\t\t\tif ( token.description ) {\n\t\t\t\t\tterms.push(token.desc_i18n_key ? this.i18n.t(token.desc_i18n_key, token.description, null, true) : token.description);\n\n\t\t\t\t\tif ( have_locale && token.desc_i18n_key && this.i18n.has(token.desc_i18n_key) )\n\t\t\t\t\t\tterms.push(this.i18n.t(token.desc_i18n_key, token.description, null));\n\t\t\t\t}\n\n\t\t\t\tterms = terms.map(format_term);\n\n\t\t\t\tfor(const lk of ['tabs', 'contents', 'items'])\n\t\t\t\t\tif ( token[lk] )\n\t\t\t\t\t\tfor(const tok of token[lk] )\n\t\t\t\t\t\t\tif ( tok.search_terms )\n\t\t\t\t\t\t\t\tterms.push(tok.search_terms);\n\n\t\t\t\tterms = token.search_terms = terms.join('\\n');\n\n\t\t\t\tlet p = parent;\n\t\t\t\twhile(p && p.search_terms) {\n\t\t\t\t\tp.search_terms += `\\n${terms}`;\n\t\t\t\t\tp = p.parent;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst lk = token.tab ? 'tabs' : token.page ? 'contents' : 'items',\n\t\t\t\tlist = parent[lk] = parent[lk] || [];\n\n\t\t\tlist.push(token);\n\t\t\tif ( list.length > 1 )\n\t\t\t\tneeds_sort.add(list);\n\t\t}\n\n\t\tfor(const token of needs_component) {\n\t\t\ttoken.component = token.tabs ? 'tab-container' :\n\t\t\t\ttoken.contents ? 'menu-container' :\n\t\t\t\t\t'setting-check-box';\n\t\t}\n\n\t\tfor(const list of needs_sort)\n\t\t\tlist.sort((a, b) => {\n\t\t\t\tif ( a.sort < b.sort ) return -1;\n\t\t\t\tif ( a.sort > b.sort ) return 1;\n\n\t\t\t\treturn a.key && a.key.localeCompare(b.key);\n\t\t\t});\n\n\t\tconst items = root.items || [];\n\t\titems.keys = copies;\n\n\t\t// Save for now, since we just want to mark everything as seen.\n\t\tif ( new_seen )\n\t\t\tthis.settings.provider.set('cfg-seen', new_seen);\n\n\t\tif ( ! collapsed ) {\n\t\t\tconst new_collapsed = [];\n\t\t\tfor(const key of Object.keys(copies)) {\n\t\t\t\tconst item = copies[key];\n\t\t\t\tif ( item && item.items && item.parent )\n\t\t\t\t\tnew_collapsed.push(key);\n\t\t\t}\n\n\t\t\tthis.settings.provider.set('cfg-collapsed', new_collapsed);\n\t\t}\n\n\t\tif ( ! set_equals(unseen, this.unseen) ) {\n\t\t\tthis.unseen = unseen;\n\t\t\tthis.emit(':update-unseen');\n\t\t}\n\n\t\tthis.log.info(`Built Tree in ${(performance.now() - started).toFixed(5)}ms with ${Object.keys(tree).length} structure nodes and ${this._settings_count} settings nodes.`);\n\t\treturn items;\n\t}\n\n\n\tgetProfiles(context) {\n\t\tconst profiles = [],\n\t\t\tkeys = {};\n\n\t\tcontext = context || this.context;\n\n\t\tfor(const profile of this.settings.__profiles)\n\t\t\tprofiles.push(keys[profile.id] = this.getProfileProxy(profile, context));\n\n\t\treturn [profiles, keys];\n\t}\n\n\n\tgetProfileProxy(profile, context) { // eslint-disable-line class-methods-use-this\n\t\treturn {\n\t\t\tid: profile.id,\n\n\t\t\torder: context.manager.__profiles.indexOf(profile),\n\t\t\tlive: context.__profiles.includes(profile),\n\n\t\t\ttoggled: profile.toggled,\n\n\t\t\ttitle: profile.name,\n\t\t\ti18n_key: profile.i18n_key,\n\n\t\t\tephemeral: profile.ephemeral,\n\n\t\t\tdescription: profile.description,\n\t\t\tdesc_i18n_key: profile.desc_i18n_key || profile.i18n_key && `${profile.i18n_key}.description`,\n\n\t\t\thotkey: profile.hotkey,\n\t\t\turl: profile.url,\n\t\t\tpause_updates: profile.pause_updates,\n\n\t\t\tmove: idx => context.manager.moveProfile(profile.id, idx),\n\t\t\tsave: () => profile.save(),\n\t\t\tupdate: data => {\n\t\t\t\tprofile.data = deep_copy(data);\n\t\t\t\tprofile.save();\n\t\t\t},\n\n\t\t\ttoggle: () => profile.toggled = ! profile.toggled,\n\t\t\tgetBackup: () => deep_copy(profile.getBackup()),\n\n\t\t\tcontext: deep_copy(profile.context),\n\n\t\t\tget: key => profile.get(key),\n\t\t\tset: (key, val) => profile.set(key, val),\n\t\t\tdelete: key => profile.delete(key),\n\t\t\thas: key => profile.has(key),\n\n\t\t\ton: (...args) => profile.on(...args),\n\t\t\toff: (...args) => profile.off(...args)\n\t\t}\n\t}\n\n\n\tgetContext() {\n\t\tconst t = this,\n\t\t\tVue = this.vue.Vue,\n\t\t\tsettings = this.settings,\n\t\t\tprovider = settings.provider,\n\t\t\tcontext = this.context,\n\t\t\t[profiles, profile_keys] = this.getProfiles(),\n\t\t\tstate = window.history.state,\n\t\t\tprofile_id = state?.ffzccp;\n\n\t\tlet currentProfile = profile_keys[0];\n\t\tif ( profile_id != null )\n\t\t\tcurrentProfile = profile_keys[profile_id];\n\n\t\tif ( ! currentProfile ) {\n\t\t\tfor(let i=profiles.length - 1; i >= 0; i--) {\n\t\t\t\tif ( profiles[i].live && ! profiles[i].ephemeral && profiles[i].title && ! /7tv/i.test(profiles[i].title) ) {\n\t\t\t\t\tcurrentProfile = profiles[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! currentProfile )\n\t\t\t\tcurrentProfile = profiles[0];\n\t\t}\n\n\t\tconst _c = {\n\t\t\tprofiles,\n\t\t\tprofile_keys,\n\t\t\tcurrentProfile,\n\n\t\t\texclusive: this.exclusive,\n\t\t\tcan_proxy: context._context.can_proxy,\n\t\t\tproxied: context._context.proxied,\n\t\t\thas_update: this.has_update,\n\t\t\tmatches_only: settings.get('ffz.search.matches-only'),\n\t\t\tmod_icons: context.get('context.chat.showModIcons'),\n\n\t\t\tsetProxied: val => {\n\t\t\t\tthis.use_context = val;\n\t\t\t\tthis.updateContext();\n\t\t\t},\n\n\t\t\tcreateProfile: data => {\n\t\t\t\tconst profile = settings.createProfile(data);\n\t\t\t\treturn t.getProfileProxy(profile, context);\n\t\t\t},\n\n\t\t\tdeleteProfile: profile => settings.deleteProfile(profile),\n\n\t\t\tgetProcessor: key => settings.getProcessor(key),\n\t\t\tgetValidator: key => settings.getValidator(key),\n\n\t\t\tgetFFZ: () => t.resolve('core'),\n\n\t\t\tprovider: {\n\t\t\t\tunwrap: () => provider,\n\t\t\t\tget: (...args) => provider.get(...args),\n\t\t\t\tset: (...args) => provider.set(...args),\n\t\t\t\tdelete: (...args) => provider.delete(...args),\n\t\t\t\thas: (...args) => provider.has(...args),\n\t\t\t\ton: (...args) => provider.on(...args),\n\t\t\t\toff: (...args) => provider.off(...args)\n\t\t\t},\n\n\t\t\tcontext: {\n\t\t\t\t_users: 0,\n\n\t\t\t\tprofiles: context.__profiles.map(profile => profile.id),\n\t\t\t\tget: key => context.get(key),\n\t\t\t\tuses: key => context.uses(key),\n\n\t\t\t\ton: (...args) => context.on(...args),\n\t\t\t\toff: (...args) => context.off(...args),\n\n\t\t\t\torder: id => context.order.indexOf(id),\n\t\t\t\tcontext: deep_copy(context._context),\n\n\t\t\t\t_update_profiles(changed) {\n\t\t\t\t\tconst new_list = [],\n\t\t\t\t\t\tprofiles = context.manager.__profiles;\n\n\t\t\t\t\tfor(let i=0; i < profiles.length; i++) {\n\t\t\t\t\t\tconst profile = profile_keys[profiles[i].id];\n\t\t\t\t\t\tif ( profile ) {\n\t\t\t\t\t\t\tprofile.order = i;\n\t\t\t\t\t\t\tnew_list.push(profile);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tVue.set(_c, 'profiles', new_list);\n\n\t\t\t\t\tif ( changed && changed.id === _c.currentProfile.id )\n\t\t\t\t\t\t_c.currentProfile = profile_keys[changed.id];\n\t\t\t\t},\n\n\t\t\t\t_profile_created(profile) {\n\t\t\t\t\tVue.set(profile_keys, profile.id, t.getProfileProxy(profile, context));\n\t\t\t\t\tthis._update_profiles()\n\t\t\t\t},\n\n\t\t\t\t_profile_changed(profile) {\n\t\t\t\t\tVue.set(profile_keys, profile.id, t.getProfileProxy(profile, context));\n\t\t\t\t\tthis._update_profiles(profile);\n\t\t\t\t},\n\n\t\t\t\t_profile_toggled(profile, val) {\n\t\t\t\t\tVue.set(profile_keys[profile.id], 'toggled', val);\n\t\t\t\t\tthis._update_profiles(profile);\n\t\t\t\t},\n\n\t\t\t\t_profile_deleted(profile) {\n\t\t\t\t\tVue.delete(profile_keys, profile.id);\n\t\t\t\t\tthis._update_profiles();\n\n\t\t\t\t\tif ( _c.currentProfile.id === profile.id ) {\n\t\t\t\t\t\t_c.currentProfile = profile_keys[0];\n\t\t\t\t\t\tif ( ! _c.currentProfile ) {\n\t\t\t\t\t\t\tfor(let i=_c.profiles.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\t\tif ( _c.profiles[i].live ) {\n\t\t\t\t\t\t\t\t\t_c.currentProfile = _c.profiles[i];\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( ! _c.currentProfile )\n\t\t\t\t\t\t\t\t_c.currentProfile = _c.profiles[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t_context_changed() {\n\t\t\t\t\tthis.context = deep_copy(context.__context);\n\t\t\t\t\tconst profiles = context.manager.__profiles,\n\t\t\t\t\t\tids = this.profiles = context.__profiles.map(profile => profile.id);\n\n\t\t\t\t\t_c.proxied = this.context.proxied;\n\t\t\t\t\t_c.can_proxy = this.context.can_proxy;\n\t\t\t\t\t_c.mod_icons = context.get('context.chat.showModIcons');\n\n\t\t\t\t\tfor(let i=0; i < profiles.length; i++) {\n\t\t\t\t\t\tconst id = profiles[i].id,\n\t\t\t\t\t\t\tprofile = profile_keys[id];\n\n\t\t\t\t\t\tprofile.live = ids.includes(id);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t_update_settings() {\n\t\t\t\t\t_c.matches_only = settings.get('ffz.search.matches-only');\n\t\t\t\t},\n\n\t\t\t\t_add_user() {\n\t\t\t\t\tthis._users++;\n\t\t\t\t\tif ( this._users === 1 ) {\n\t\t\t\t\t\tsettings.on(':changed:ffz.search.matches-only', this._update_settings, this);\n\t\t\t\t\t\tsettings.on(':profile-toggled', this._profile_toggled, this);\n\t\t\t\t\t\tsettings.on(':profile-created', this._profile_created, this);\n\t\t\t\t\t\tsettings.on(':profile-changed', this._profile_changed, this);\n\t\t\t\t\t\tsettings.on(':profile-deleted', this._profile_deleted, this);\n\t\t\t\t\t\tsettings.on(':profiles-reordered', this._update_profiles, this);\n\t\t\t\t\t\tcontext.on('context_changed', this._context_changed, this);\n\t\t\t\t\t\tcontext.on('profiles_changed', this._context_changed, this);\n\t\t\t\t\t\tthis.profiles = context.__profiles.map(profile => profile.id);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t_remove_user() {\n\t\t\t\t\tthis._users--;\n\t\t\t\t\tif ( this._users === 0 ) {\n\t\t\t\t\t\tsettings.off(':changed:ffz.search.matches-only', this._update_settings, this);\n\t\t\t\t\t\tsettings.off(':profile-toggled', this._profile_toggled, this);\n\t\t\t\t\t\tsettings.off(':profile-created', this._profile_created, this);\n\t\t\t\t\t\tsettings.off(':profile-changed', this._profile_changed, this);\n\t\t\t\t\t\tsettings.off(':profile-deleted', this._profile_deleted, this);\n\t\t\t\t\t\tsettings.off(':profiles-reordered', this._update_profiles, this);\n\t\t\t\t\t\tcontext.off('context_changed', this._context_changed, this);\n\t\t\t\t\t\tcontext.off('profiles_changed', this._context_changed, this);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn _c;\n\t}\n\n\tmarkSeen(item, seen) {\n\t\tlet had_seen = true,\n\t\t\tchanged = false;\n\n\t\tif ( ! seen ) {\n\t\t\thad_seen = false;\n\t\t\tseen = this.settings.provider.get('cfg-seen', []);\n\t\t}\n\n\t\tif ( Array.isArray(item.contents) ) {\n\t\t\tfor(const child of item.contents)\n\t\t\t\tchanged = (child && this.markSeen(child, seen)) || changed;\n\t\t}\n\n\t\tif ( item.setting ) {\n\t\t\tif ( this.unseen )\n\t\t\t\tthis.unseen.delete(item.setting);\n\n\t\t\tif ( ! seen.includes(item.setting) ) {\n\t\t\t\tchanged = true;\n\t\t\t\tseen.push(item.setting);\n\n\t\t\t\tlet i = item.parent;\n\t\t\t\twhile(i) {\n\t\t\t\t\ti.unseen = (i.unseen || 1) - 1;\n\t\t\t\t\ti = i.parent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( ! had_seen && changed ) {\n\t\t\tthis.settings.provider.set('cfg-seen', seen);\n\t\t\tthis.emit(':update-unseen');\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\tmarkAllSeen(thing, seen) {\n\t\tlet had_seen = true;\n\t\tif ( ! seen ) {\n\t\t\thad_seen = false;\n\t\t\tseen = this.settings.provider.get('cfg-seen', []);\n\t\t}\n\n\t\tif ( Array.isArray(thing) )\n\t\t\tfor(const page of thing)\n\t\t\t\tif ( page )\n\t\t\t\t\tthis.markAllSeen(page, seen);\n\n\t\tif ( Array.isArray(thing.items) )\n\t\t\tfor(const item of thing.items)\n\t\t\t\tthis.markAllSeen(item, seen);\n\n\t\tif ( Array.isArray(thing.contents) )\n\t\t\tfor(const content of thing.contents)\n\t\t\t\tthis.markAllSeen(content, seen);\n\n\t\tif ( Array.isArray(thing.tabs) )\n\t\t\tfor(const tab of thing.tabs)\n\t\t\t\tthis.markAllSeen(tab, seen);\n\n\t\tif ( Array.isArray(thing.settings) )\n\t\t\tfor(const setting of thing.settings)\n\t\t\t\tif ( setting )\n\t\t\t\t\tthis.markAllSeen(setting[1], seen);\n\n\t\tif ( thing.setting && ! seen.includes(thing.setting) )\n\t\t\tseen.push(thing.setting);\n\n\t\tif ( thing.unseen )\n\t\t\tthing.unseen = 0;\n\n\t\tif ( ! had_seen ) {\n\t\t\tthis.settings.provider.set('cfg-seen', seen);\n\t\t\tthis.unseen = null;\n\t\t\tthis.emit(':update-unseen');\n\t\t}\n\t}\n\n\tgetData() {\n\t\tconst settings = this.getSettingsTree(),\n\t\t\tcontext = this.getContext(),\n\t\t\tstate = window.history.state;\n\n\t\tlet current, restored = true;\n\t\tif ( this._wanted_page )\n\t\t\tcurrent = settings.keys[this._wanted_page];\n\t\tif ( ! current && state?.ffzcc ) {\n\t\t\tcurrent = settings.keys[state.ffzcc];\n\t\t\tif ( ! current )\n\t\t\t\trestored = false;\n\t\t} if ( ! current ) {\n\t\t\tconst params = new URL(window.location).searchParams,\n\t\t\t\tkey = params?.get('ffz-settings');\n\t\t\tcurrent = key && settings.keys[key];\n\t\t\tif ( ! current )\n\t\t\t\trestored = false;\n\t\t}\n\t\tif ( ! current )\n\t\t\tcurrent = this.has_update ?\n\t\t\t\tsettings.keys['home.changelog'] :\n\t\t\t\tsettings.keys['home'];\n\n\t\tthis._wanted_page = null;\n\t\tthis.markSeen(current);\n\n\t\tlet has_unseen = false;\n\t\tfor(const page of settings)\n\t\t\tif ( page && page.unseen ) {\n\t\t\t\thas_unseen = true;\n\t\t\t\tbreak;\n\t\t\t}\n\n\n\t\tconst out = {\n\t\t\tcontext,\n\n\t\t\tquery: '',\n\t\t\tfaded: false,\n\n\t\t\tnav: settings,\n\t\t\tcurrentItem: current,\n\t\t\trestoredItem: true, // restored, -- Look into making this smoother later.\n\t\t\tnavKeys: settings.keys,\n\n\t\t\thas_unseen,\n\n\t\t\tmaximized: this.dialog.maximized,\n\t\t\texclusive: this.dialog.exclusive,\n\n\t\t\tmarkAllSeen: thing => this.markAllSeen(thing),\n\t\t\tmarkSeen: item => this.markSeen(item),\n\n\t\t\tmarkExpanded: item => {\n\t\t\t\tconst collapsed = this.settings.provider.get('cfg-collapsed', []),\n\t\t\t\t\tincluded = collapsed.indexOf(item.full_key);\n\n\t\t\t\tif ( item.expanded && included !== -1 )\n\t\t\t\t\tcollapsed.splice(included, 1);\n\t\t\t\telse if ( ! item.expanded && included === -1 )\n\t\t\t\t\tcollapsed.push(item.full_key);\n\t\t\t\telse\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.settings.provider.set('cfg-collapsed', collapsed);\n\t\t\t},\n\n\t\t\tresize: e => {\n\t\t\t\tif ( this.dialog.exclusive || this.site?.router?.current_name === 'squad' || this.site?.router?.current_name === 'command-center' )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( this.settings.get('layout.is-theater-mode') )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.dialog.toggleSize(e);\n\t\t\t},\n\n\t\t\tclose: e => ! this.dialog.exclusive && this.dialog.toggleVisible(e),\n\n\t\t\tversion: window.FrankerFaceZ.version_info,\n\t\t};\n\n\t\tout.popout = e => {\n\t\t\tif ( this.dialog.exclusive )\n\t\t\t\treturn;\n\n\t\t\tthis.dialog.toggleVisible(e);\n\t\t\tif ( ! this.openPopout(out.currentItem?.full_key) )\n\t\t\t\talert(this.i18n.t('popup.error', 'We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.')); // eslint-disable-line no-alert\n\t\t}\n\n\t\treturn out;\n\t}\n}\n","'use strict';\n\nimport {deep_copy} from 'utilities/object';\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tvalue: undefined,\n\t\t\thas_value: false,\n\n\t\t\tprovider_key: this.item.override_setting ?? this.item.setting,\n\n\t\t\t_unseen: false\n\t\t}\n\t},\n\n\tcreated() {\n\t\tconst provider = this.context.provider,\n\t\t\tsetting = this.provider_key;\n\n\t\tprovider.on('changed', this._providerChange, this);\n\n\t\tthis.has_value = provider.has(setting);\n\t\tif ( this.has_value )\n\t\t\tthis.value = deep_copy(provider.get(setting));\n\t\telse\n\t\t\tthis.value = this.default_value;\n\n\t\tif ( this.item.unseen ) {\n\t\t\tthis._unseen = true;\n\t\t\tthis.item.unseen = 0;\n\t\t}\n\t},\n\n\tdestroyed() {\n\t\tconst provider = this.context.provider;\n\n\t\tprovider.off('changed', this._providerChange, this);\n\n\t\tthis.value = undefined;\n\t\tthis.has_value = false;\n\t},\n\n\tcomputed: {\n\t\tdata() {\n\t\t\tconst data = this.item.data;\n\t\t\tif ( typeof data === 'function' )\n\t\t\t\treturn data(this.value);\n\n\t\t\treturn data;\n\t\t},\n\n\t\tunseen() {\n\t\t\treturn this._unseen || this.item.unseen > 0;\n\t\t},\n\n\t\tdefault_value() {\n\t\t\tif ( typeof this.item.default === 'function' )\n\t\t\t\treturn this.item.default(this.context);\n\n\t\t\treturn deep_copy(this.item.default);\n\t\t},\n\n\t\tisValid() {\n\t\t\treturn this.isDefault || this.validate(this.value)\n\t\t},\n\n\t\tisDefault() {\n\t\t\treturn ! this.has_value\n\t\t}\n\t},\n\n\tmethods: {\n\t\t_providerChange(key, val, deleted) {\n\t\t\tif ( key !== this.provider_key )\n\t\t\t\treturn;\n\n\t\t\tif ( deleted ) {\n\t\t\t\tthis.has_value = false;\n\t\t\t\tthis.value = this.default_value;\n\t\t\t} else {\n\t\t\t\tthis.has_value = true;\n\t\t\t\tthis.value = deep_copy(val);\n\t\t\t}\n\t\t},\n\n\t\tvalidate(value) {\n\t\t\tlet validate = this.item.validator;\n\t\t\tif ( ! validate && typeof this.item.process === 'string' )\n\t\t\t\tvalidate = this.context.getValidator(`process_${this.item.process}`);\n\t\t\tif ( validate ) {\n\t\t\t\tif ( typeof validate !== 'function' )\n\t\t\t\t\tvalidate = this.context.getValidator(validate);\n\t\t\t\tif ( typeof validate === 'function' )\n\t\t\t\t\treturn validate(value, this.item, this);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error(`Invalid Validator for ${this.provider_key}`);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tset(value) {\n\t\t\tconst provider = this.context.provider,\n\t\t\t\tsetting = this.provider_key;\n\n\t\t\t// TODO: Run validation.\n\n\t\t\tlet process = this.item.process;\n\t\t\tif ( process ) {\n\t\t\t\tif ( typeof process !== 'function' )\n\t\t\t\t\tprocess = this.context.getProcessor(process);\n\t\t\t\tif ( typeof process === 'function' )\n\t\t\t\t\tvalue = process(value, this.default_value, this.item, this);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error(`Invalid processor for ${setting}`);\n\t\t\t}\n\n\t\t\tprovider.set(setting, value);\n\t\t\tthis.has_value = true;\n\t\t\tthis.value = deep_copy(value);\n\n\t\t\tif ( this.item.onUIChange )\n\t\t\t\tthis.item.onUIChange(this.value, this);\n\t\t},\n\n\t\tclear() {\n\t\t\tconst provider = this.context.provider,\n\t\t\t\tsetting = this.provider_key;\n\n\t\t\tprovider.delete(setting);\n\t\t\tthis.value = this.default_value;\n\t\t\tthis.has_value = false;\n\n\t\t\tif ( this.item.onUIChange )\n\t\t\t\tthis.item.onUIChange(this.value, this);\n\t\t}\n\t}\n}\n","'use strict';\n\nimport {deep_copy} from 'utilities/object';\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tvalue: undefined,\n\t\t\thas_value: false,\n\t\t\tprofile: null,\n\n\t\t\t_unseen: false,\n\t\t\tsource: null,\n\t\t\tsource_value: undefined,\n\t\t}\n\t},\n\n\tcreated() {\n\t\tconst ctx = this.context.context,\n\t\t\tsetting = this.item.setting;\n\n\t\tctx._add_user();\n\n\t\tthis._update_profile();\n\t\tthis._uses_changed(ctx.uses(setting));\n\n\t\tif ( this.item.unseen ) {\n\t\t\tthis._unseen = true;\n\t\t\tthis.item.unseen = 0;\n\t\t}\n\n\t\tctx.on(`uses_changed:${setting}`, this._uses_changed, this);\n\t},\n\n\tdestroyed() {\n\t\tconst ctx = this.context.context,\n\t\t\tsetting = this.item.setting;\n\n\t\tif ( this.profile )\n\t\t\tthis.profile.off('changed', this._setting_changed, this);\n\n\t\tif ( this.source )\n\t\t\tthis.source.off('changed', this._source_setting_changed, this);\n\n\t\tctx.off(`uses_changed:${setting}`, this._uses_changed, this);\n\n\t\tthis.value = undefined;\n\t\tthis.has_value = false;\n\t\tthis.profile = null;\n\n\t\tthis.source_value = undefined;\n\t\tthis.source = null;\n\n\t\tctx._remove_user();\n\t},\n\n\twatch: {\n\t\t'context.currentProfile'() {\n\t\t\tthis._update_profile();\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tdata() {\n\t\t\tconst data = this.item.data;\n\t\t\tif ( typeof data === 'function' )\n\t\t\t\treturn data(this.profile, this.value);\n\n\t\t\treturn data;\n\t\t},\n\n\t\tunseen() {\n\t\t\treturn this._unseen || this.item.unseen > 0\n\t\t},\n\n\t\tdefault_value() {\n\t\t\tif ( typeof this.item.default === 'function' )\n\t\t\t\treturn this.item.default(this.context.context);\n\n\t\t\treturn deep_copy(this.item.default);\n\t\t},\n\n\t\tisInherited() {\n\t\t\treturn ! this.has_value && this.source && this.sourceOrder > this.profileOrder;\n\t\t},\n\n\t\tisDefault() {\n\t\t\treturn ! this.has_value && ! this.source\n\t\t},\n\n\t\tisOverridden() {\n\t\t\treturn this.source && this.sourceOrder < this.profileOrder;\n\t\t},\n\n\t\tisValid() {\n\t\t\treturn this.isDefault || this.validate(this.value);\n\t\t},\n\n\t\tisReadOnly() {\n\t\t\treturn this.profile && this.profile.ephemeral\n\t\t},\n\n\t\tsourceOrder() {\n\t\t\treturn this.source ? this.source.order : Infinity\n\t\t},\n\n\t\tprofileOrder() {\n\t\t\treturn this.profile ? this.profile.order : Infinity\n\t\t},\n\n\t\tsourceTitle() {\n\t\t\tif ( this.source )\n\t\t\t\treturn this.source.i18n_key ?\n\t\t\t\t\tthis.t(this.source.i18n_key, this.source.title, this.source) :\n\t\t\t\t\tthis.source.title;\n\t\t},\n\n\t\tsourceDisplay() {\n\t\t\tconst opts = {\n\t\t\t\ttitle: this.sourceTitle\n\t\t\t};\n\n\t\t\tif ( this.isInherited )\n\t\t\t\treturn this.t('setting.inherited-from', 'Inherited From: {title}', opts);\n\t\t\telse if ( this.isOverridden )\n\t\t\t\treturn this.t('setting.overridden-by', 'Overridden By: {title}', opts);\n\t\t}\n\t},\n\n\tmethods: {\n\t\t_update_profile() {\n\t\t\tif ( this.profile )\n\t\t\t\tthis.profile.off('changed', this._setting_changed, this);\n\n\t\t\tconst profile = this.profile = this.context.currentProfile,\n\t\t\t\tsetting = this.item.setting;\n\n\t\t\tprofile.on('changed', this._setting_changed, this);\n\n\t\t\tthis.has_value = profile.has(setting);\n\t\t\tthis.value = this.has_value ?\n\t\t\t\tdeep_copy(profile.get(setting)) :\n\t\t\t\tthis.isInherited ?\n\t\t\t\t\tthis.source_value :\n\t\t\t\t\tthis.default_value;\n\t\t},\n\n\t\t_setting_changed(key, value, deleted) {\n\t\t\tif ( key !== this.item.setting )\n\t\t\t\treturn;\n\n\t\t\tthis.has_value = deleted !== true;\n\t\t\tthis.value = this.has_value ?\n\t\t\t\tdeep_copy(value) :\n\t\t\t\tthis.isInherited ?\n\t\t\t\t\tthis.source_value :\n\t\t\t\t\tthis.default_value;\n\t\t},\n\n\t\t_source_setting_changed(key, value, deleted) {\n\t\t\tif ( key !== this.item.setting )\n\t\t\t\treturn;\n\n\t\t\tthis.source_value = deep_copy(value);\n\t\t\tif ( this.isInherited )\n\t\t\t\tthis.value = deleted ? this.default_value : value;\n\t\t},\n\n\t\t_uses_changed(uses) {\n\t\t\tif ( this._uses_cb )\n\t\t\t\tclearTimeout(this._uses_cb);\n\n\t\t\t// We don't do this immediately because this code will be\n\t\t\t// running inside a \"changed\" event handler and unregistering\n\t\t\t// our listener will throw a concurrent modification exception.\n\t\t\tthis._uses_cb = setTimeout(() => {\n\t\t\t\tif ( this.source )\n\t\t\t\t\tthis.source.off('changed', this._source_setting_changed, this);\n\n\t\t\t\t// We primarily only care about the main source.\n\t\t\t\tuses = uses ? uses[0] : null;\n\n\t\t\t\tconst source = this.source = uses == null ? null : this.context.profile_keys[uses],\n\t\t\t\t\tsetting = this.item.setting;\n\n\t\t\t\tif ( source ) {\n\t\t\t\t\tsource.on('changed', this._source_setting_changed, this);\n\t\t\t\t\tthis.source_value = deep_copy(source.get(setting));\n\n\t\t\t\t} else\n\t\t\t\t\tthis.source_value = undefined;\n\n\t\t\t\tthis.has_value = this.profile && this.profile.has(this.item.setting);\n\t\t\t\tif ( ! this.has_value )\n\t\t\t\t\tthis.value = this.isInherited ? this.source_value : this.default_value;\n\t\t\t}, 0);\n\t\t},\n\n\t\tvalidate(value) {\n\t\t\tlet validate = this.item.validator;\n\t\t\tif ( ! validate && typeof this.item.process === 'string' )\n\t\t\t\tvalidate = this.context.getValidator(`process_${this.item.process}`);\n\t\t\tif ( validate ) {\n\t\t\t\tif ( typeof validate !== 'function' )\n\t\t\t\t\tvalidate = this.context.getValidator(validate);\n\t\t\t\tif ( typeof validate === 'function' )\n\t\t\t\t\treturn validate(value, this.item, this);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error(`Invalid Validator for ${this.item.setting}`);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tset(value) {\n\t\t\t// TODO: Run validation.\n\t\t\tif ( this.isReadOnly )\n\t\t\t\treturn;\n\n\t\t\tlet process = this.item.process;\n\t\t\tif ( process ) {\n\t\t\t\tif ( typeof process !== 'function' )\n\t\t\t\t\tprocess = this.context.getProcessor(process);\n\t\t\t\tif ( typeof process === 'function' )\n\t\t\t\t\tvalue = process(value, this.default_value, this.item, this);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error(`Invalid processor for ${this.item.setting}`);\n\t\t\t}\n\n\t\t\tthis.profile.set(this.item.setting, value);\n\n\t\t\tif ( this.item.onUIChange )\n\t\t\t\tthis.item.onUIChange(value, this);\n\t\t},\n\n\t\tclear() {\n\t\t\tif ( this.isReadOnly )\n\t\t\t\treturn;\n\n\t\t\tthis.profile.delete(this.item.setting);\n\n\t\t\tif ( this.item.onUIChange )\n\t\t\t\tthis.item.onUIChange(this.value, this);\n\t\t}\n\t}\n}","'use strict';\n\n// ============================================================================\n// Translation UI\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport Dialog from 'utilities/dialog';\n\nimport {createElement} from 'utilities/dom';\n\nexport default class TranslationUI extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('site');\n\t\tthis.inject('vue');\n\n\t\tthis.load_requires = ['vue'];\n\n\t\tthis.dialog = new Dialog(() => this.buildDialog());\n\t}\n\n\topenPopout() {\n\t\tconst win = window.open(\n\t\t\t'https://twitch.tv/popout/frankerfacez/chat?ffz-translate',\n\t\t\t'_blank',\n\t\t\t'resizable=yes,scrollbars=yes,width=850,height=600'\n\t\t);\n\n\t\tif ( win ) {\n\t\t\twin.focus();\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthis.log.warn('Unable to open popout translation window.');\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync onLoad() {\n\t\tthis.vue.component(\n\t\t\t(await import(/* webpackChunkName: \"translation-ui\" */ './components.js')).default\n\t\t);\n\t}\n\n\tasync onEnable() {\n\t\tawait this.site.awaitElement(Dialog.EXCLUSIVE);\n\n\t\tthis.on('i18n:seen', key => {\n\t\t\tif ( ! this._vue )\n\t\t\t\treturn;\n\n\t\t\tconst comp = this._vue.$children[0];\n\t\t\tcomp.phrases.push(key);\n\t\t})\n\n\t\tthis.dialog.on('hide', this.destroyDialog, this);\n\t\tthis.dialog.on('resize', () => {\n\t\t\tif ( this._vue )\n\t\t\t\tthis._vue.$children[0].maximized = this.dialog.maximized\n\t\t});\n\n\t\tthis.dialog.show();\n\t}\n\n\tonDisable() {\n\t\tthis.dialog.hide();\n\t}\n\n\n\tbuildDialog() {\n\t\tif ( this._dialog )\n\t\t\treturn this._dialog;\n\n\t\tthis._vue = new this.vue.Vue({\n\t\t\tel: createElement('div'),\n\t\t\trender: h => h('translation-ui', this.getData())\n\t\t});\n\n\t\treturn this._dialog = this._vue.$el;\n\t}\n\n\tdestroyDialog() {\n\t\tif ( this._vue )\n\t\t\tthis._vue.$destroy();\n\n\t\tthis._dialog = this._vue = null;\n\t}\n\n\n\tgetData() {\n\t\tthis.i18n.loadStrings();\n\n\t\treturn {\n\t\t\tphrases: [],\n\t\t\tquery: '',\n\n\t\t\tfaded: false,\n\t\t\tmaximized: this.dialog.maximized,\n\t\t\texclusive: this.dialog.exclusive,\n\n\t\t\tgetI18n: () => this.i18n,\n\t\t\tgetKeys: () => this.i18n.getKeys(),\n\t\t\trequestKeys: () => this.i18n.requestKeys(),\n\t\t\tupdatePhrase: (key, phrase) => this.i18n.updatePhrase(key, phrase),\n\n\t\t\tlisten: (event, fn, ctx) => this.on(event, fn, ctx),\n\t\t\tunlisten: (event, fn, ctx) => this.off(event, fn, ctx),\n\n\t\t\tresize: e => ! this.dialog.exclusive && this.dialog.toggleSize(e),\n\t\t\tclose: e => ! this.dialog.exclusive && this.dialog.toggleVisible(e),\n\n\t\t\tpopout: e => {\n\t\t\t\tif ( this.dialog.exclusive )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.dialog.toggleVisible(e);\n\t\t\t\tif ( ! this.openPopout() )\n\t\t\t\t\talert(this.i18n.t('popup.error', 'We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.')); // eslint-disable-line no-alert\n\t\t\t}\n\t\t}\n\t}\n}","'use strict';\n\nimport Module, { GenericModule } from 'utilities/module';\n\nlet last_site = 0;\nlet last_call = 0;\n\nexport default class BaseSite extends Module {\n\n\tconstructor(name, parent) {\n\t\tsuper(name, parent);\n\t\tthis._id = `_ffz$${last_site++}`;\n\n\t\t//this.inject('settings');\n\n\t\tthis.log.info(`Using: ${this.constructor.name}`);\n\t}\n\n\n\t// ========================================================================\n\t// DOM Manipulation\n\t// ========================================================================\n\n\tgetReact() {\n\t\tif ( this._react )\n\t\t\treturn this._react;\n\n\t\tlet react;\n\t\ttry {\n\t\t\treact = this.getCore?.()?.intl?.react;\n\t\t} catch(err) { /* no-op */ }\n\n\t\tif ( react?.Component && react.createElement )\n\t\t\treturn this._react = react;\n\n\t\treact = this.resolve('site.web_munch')?.getModule?.('react');\n\t\tif ( react?.Component && react.createElement )\n\t\t\treturn this._react = react;\n\t}\n\n\tgetReactDom() {\n\t\tif ( this._reactDom )\n\t\t\treturn this._reactDom;\n\n\t\tlet reactDom = this.resolve('site.web_munch')?.getModule?.('react-dom');\n\t\tif ( reactDom?.createPortal )\n\t\t\treturn this._reactDom = reactDom;\n\t}\n\n\tfindReact() {\n\t\tconst react = this.getReact();\n\t\tif ( react )\n\t\t\treturn Promise.resolve(react);\n\n\t\tconst munch = this.resolve('site.web_munch');\n\t\tif ( munch )\n\t\t\treturn munch.findModule('react');\n\n\t\treturn this.waitFor('site.web_munch:registered')\n\t\t\t.then(() => this.findReact());\n\t}\n\n\tawaitElement(selector, parent, timeout = 60000) {\n\t\tif ( ! parent )\n\t\t\tparent = document.documentElement;\n\n\t\tconst el = parent.querySelector(selector);\n\t\tif ( el )\n\t\t\treturn Promise.resolve(el);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst observer_name = `${this._id}$observer`,\n\t\t\t\tdata = parent[observer_name],\n\t\t\t\tcall_id = last_call++,\n\n\t\t\t\ttimer = timeout && setTimeout(() => {\n\t\t\t\t\tconst data = parent[observer_name];\n\t\t\t\t\tif ( ! data )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tconst [observer, selectors] = data;\n\n\t\t\t\t\tfor(let i=0; i < selectors.length; i++) {\n\t\t\t\t\t\tconst d = selectors[i];\n\t\t\t\t\t\tif ( d[0] === call_id ) {\n\t\t\t\t\t\t\tselectors.splice(i, 1);\n\t\t\t\t\t\t\td[3]('Timed out');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ! selectors.length ) {\n\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t\tparent[observer_name] = null;\n\t\t\t\t\t}\n\t\t\t\t}, timeout);\n\n\t\t\tif ( data ) {\n\t\t\t\tdata[1].push([call_id, selector, resolve, reject, timer]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst observer = new MutationObserver(() => {\n\t\t\t\tconst data = parent[observer_name];\n\t\t\t\tif ( ! data ) {\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst selectors = data[1];\n\t\t\t\tfor(let i=0; i < selectors.length; i++) {\n\t\t\t\t\tconst d = selectors[i];\n\t\t\t\t\tconst el = parent.querySelector(d[1]);\n\t\t\t\t\tif ( el ) {\n\t\t\t\t\t\tselectors.splice(i, 1);\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tif ( d[4] )\n\t\t\t\t\t\t\tclearTimeout(d[4]);\n\n\t\t\t\t\t\td[2](el);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( ! selectors.length ) {\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\tparent[observer_name] = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tparent[observer_name] = [observer, [[call_id, selector, resolve, reject, timer]]];\n\t\t\tobserver.observe(parent, {\n\t\t\t\tchildList: true,\n\t\t\t\tattributes: true,\n\t\t\t\tcharacterData: true,\n\t\t\t\tsubtree: true\n\t\t\t});\n\t\t});\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Twitch Player -- Shared Code\n// ============================================================================\n\nimport Module from 'utilities/module';\n\nimport {createElement, on, off} from 'utilities/dom';\nimport {isValidShortcut, debounce, has} from 'utilities/object';\nimport { getFontsList, useFont } from 'utilities/fonts';\n\nconst STYLE_VALIDATOR = createElement('span');\n\nconst LEFT_CONTROLS = '.video-player__default-player .player-controls__left-control-group';\nconst RIGHT_CONTROLS = '.video-player__default-player .player-controls__right-control-group';\n\nconst HAS_COMPRESSOR = window.AudioContext && window.DynamicsCompressorNode != null,\n\tHAS_GAIN = HAS_COMPRESSOR && window.GainNode != null;\n\nconst SCROLL_I18N = 'setting.entry.player.volume-scroll.values',\n\tSCROLL_OPTIONS = [\n\t\t{value: false, title: 'Disabled', i18n_key: `${SCROLL_I18N}.false`},\n\t\t{value: true, title: 'Enabled', i18n_key: `${SCROLL_I18N}.true`},\n\t\t{value: 2, title: 'Enabled with Right-Click', i18n_key: `${SCROLL_I18N}.2`},\n\t\t{value: 3, title: 'Enabled with Alt', i18n_key: `${SCROLL_I18N}.3`},\n\t\t{value: 4, title: 'Enabled with Alt + Right-Click', i18n_key: `${SCROLL_I18N}.4`},\n\t\t{value: 5, title: 'Enabled with Shift', i18n_key: `${SCROLL_I18N}.5`},\n\t\t{value: 6, title: 'Enabled with Shift + Right-Click', i18n_key: `${SCROLL_I18N}.6`},\n\t\t{value: 7, title: 'Enabled with Ctrl', i18n_key: `${SCROLL_I18N}.7`},\n\t\t{value: 8, title: 'Enabled with Ctrl + Right-Click', i18n_key: `${SCROLL_I18N}.8`}\n\t];\n\nfunction getNativeClipButton(container) {\n\treturn container.querySelector('button[aria-label*=\"alt+x\"]') ??\n\tcontainer.querySelector('button[aria-label]:has(path[d=\"M8 9H6v2h2V9zm1 0h2v2H9V9zm5 0h-2v2h2V9z\"]');\n}\n\nfunction wantsRMB(setting) {\n\treturn setting === 2 || setting === 4 || setting === 6 || setting === 8;\n}\n\nfunction matchesEvent(setting, event, has_rmb) {\n\tif ( wantsRMB(setting) && event.button !== 2 && ! has_rmb )\n\t\treturn false;\n\n\tif ( ! event.altKey && (setting === 3 || setting === 4) )\n\t\treturn false;\n\n\tif ( ! event.shiftKey && (setting === 5 || setting === 6) )\n\t\treturn false;\n\n\tif ( ! event.ctrlKey && (setting === 7 || setting === 8) )\n\t\treturn false;\n\n\treturn true;\n}\n\nfunction rotateButton(event) {\n\tconst target = event.currentTarget,\n\t\ticon = target && target.querySelector('figure');\n\tif ( ! icon || icon.classList.contains('ffz-i-t-reset-clicked') )\n\t\treturn;\n\n\ticon.classList.toggle('ffz-i-t-reset', false);\n\ticon.classList.toggle('ffz-i-t-reset-clicked', true);\n\n\tsetTimeout(() => {\n\t\ticon.classList.toggle('ffz-i-t-reset', true);\n\t\ticon.classList.toggle('ffz-i-t-reset-clicked', false);\n\t}, 500);\n}\n\nexport default class PlayerBase extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.css_tweaks');\n\n\t\tthis.onShortcut = this.onShortcut.bind(this);\n\n\t\tthis.LEFT_CONTROLS = LEFT_CONTROLS;\n\t\tthis.RIGHT_CONTROLS = RIGHT_CONTROLS;\n\n\t\tthis.registerSettings();\n\t}\n\n\tregisterSettings() {\n\t\tthis.settings.add('player.embed-metadata', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Embed and Popout',\n\t\t\t\ttitle: 'Show metadata when mousing over the player.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.cast-button.hide', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Hide the Cast button.',\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggleHide('player-cast', val)\n\t\t});\n\n\t\tthis.settings.add('player.clip-button.hide-native', {\n\t\t\tdefault: null,\n\t\t\trequires: ['player.clip-button.custom'],\n\t\t\tprocess: (ctx, val) => val ?? ctx.get('player.clip-button.custom'),\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Hide the native Clip button.',\n\t\t\t\tdescription: 'By default, this is enabled when using the setting to add a custom Clip button.'\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggle('player-hide-native-clip', val)\n\t\t});\n\n\t\tthis.settings.add('player.clip-button.custom', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Display a custom Clip button.',\n\t\t\t\tdescription: 'Add a custom Clip button to the player that better fits the style of the other buttons.'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\tthis.addClipButton(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.fade-pause-buffer', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Fade the player when paused or buffering to make the UI easier to see.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggle('player-fade-paused', val)\n\t\t});\n\n\t\tthis.settings.add('player.disable-content-warnings', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\ttitle: 'Do not display content warnings.',\n\t\t\t\tdescription: 'When this is enabled, FFZ will automatically skip content warnings. This feature is intended for use by adults only.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => {\n\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\tthis.skipContentWarnings(inst);\n\t\t\t}\n\t\t});\n\n\t\tif ( HAS_COMPRESSOR ) {\n\t\t\tthis.settings.add('player.compressor.enable', {\n\t\t\t\tdefault: true,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor @{\"description\": \"These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more.\"} >> General',\n\t\t\t\t\ttitle: 'Enable the audio compressor and add an `Audio Compressor` button to the player controls.',\n\t\t\t\t\tsort: -1000,\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t},\n\n\t\t\t\tchanged: () => {\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.addCompressorButton(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.default', {\n\t\t\t\tdefault: false,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> General',\n\t\t\t\t\ttitle: 'Enable the compressor by default.',\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t},\n\n\t\t\t\tchanged: () => {\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.compressPlayer(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.force-legacy', {\n\t\t\t\tdefault: false,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Force use of legacy browser API.',\n\t\t\t\t\tdescription: 'This setting forces FrankerFaceZ to attempt to use an older browser API to create the compressor. Please reset your player after changing this setting.',\n\t\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\t\tforce_seen: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.shortcut', {\n\t\t\t\tdefault: null,\n\t\t\t\trequires: ['player.compressor.enable'],\n\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\tif ( ! ctx.get('player.compressor.enable') )\n\t\t\t\t\t\treturn null;\n\t\t\t\t\treturn val;\n\t\t\t\t},\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> General',\n\t\t\t\t\ttitle: 'Shortcut Key',\n\t\t\t\t\tdescription: 'This key sequence can be used to toggle the compressor.',\n\t\t\t\t\tcomponent: 'setting-hotkey'\n\t\t\t\t},\n\t\t\t\tchanged: () => {\n\t\t\t\t\tthis.updateShortcut();\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.addCompressorButton(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif ( HAS_GAIN ) {\n\t\t\t\tthis.settings.add('player.gain.enable', {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tsort: -1,\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control @{\"sort\": 50, \"description\": \"Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses.\"}',\n\t\t\t\t\t\ttitle: 'Enable gain control when the audio compressor is enabled.',\n\t\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => {\n\t\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\t\tthis.compressPlayer(inst);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.no-volume', {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\trequires: ['player.gain.enable'],\n\t\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\t\tif ( ! ctx.get('player.gain.enable') )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn val;\n\t\t\t\t\t},\n\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Force built-in volume to 100% when the audio compressor is enabled.',\n\t\t\t\t\t\tdescription: 'With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.',\n\t\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: val => {\n\t\t\t\t\t\tthis.css_tweaks.toggleHide('player-gain-volume', val);\n\t\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\t\tthis.updateGainVolume(inst);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.scroll', {\n\t\t\t\t\tdefault: false,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Scroll Adjust',\n\t\t\t\t\t\tdescription: 'Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*',\n\t\t\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\t\t\tdata: SCROLL_OPTIONS\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.default', {\n\t\t\t\t\tdefault: 100,\n\t\t\t\t\trequires: ['player.gain.min', 'player.gain.max'],\n\t\t\t\t\tprocess(ctx, val) {\n\t\t\t\t\t\tconst min = ctx.get('player.gain.min'),\n\t\t\t\t\t\t\tmax = ctx.get('player.gain.max');\n\n\t\t\t\t\t\tval /= 100;\n\n\t\t\t\t\t\tif ( val < min )\n\t\t\t\t\t\t\tval = min;\n\t\t\t\t\t\tif ( val > max )\n\t\t\t\t\t\t\tval = max;\n\n\t\t\t\t\t\treturn val;\n\t\t\t\t\t},\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Default Value',\n\t\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\t\tdescription: 'The default value for gain control, when gain control is enabled. 100% means no change in volume.',\n\t\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\t\tbounds: [0, true]\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => this.updateGains()\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.min', {\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tprocess: (ctx, val) => val / 100,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Minimum',\n\t\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\t\tdescription: '**Range:** 0 ~ 100\\n\\nThe minimum allowed value for gain control. 0% is effectively muted.',\n\t\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\t\tbounds: [0, true, 100, true]\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => this.updateGains()\n\t\t\t\t});\n\n\t\t\t\tthis.settings.add('player.gain.max', {\n\t\t\t\t\tdefault: 200,\n\t\t\t\t\tprocess: (ctx, val) => val / 100,\n\t\t\t\t\tui: {\n\t\t\t\t\t\tpath: 'Player > Compressor >> Gain Control',\n\t\t\t\t\t\ttitle: 'Maximum',\n\t\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\t\tdescription: '**Range:** 100 ~ 1000\\n\\nThe maximum allowed value for gain control. 100% is no change. 200% is double the volume.',\n\t\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\t\tbounds: [100, true, 1000, true]\n\t\t\t\t\t},\n\n\t\t\t\t\tchanged: () => this.updateGains()\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.settings.add('player.compressor.threshold', {\n\t\t\t\tdefault: -50,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced @{\"sort\": 1000}',\n\t\t\t\t\ttitle: 'Threshold',\n\t\t\t\t\tsort: 0,\n\t\t\t\t\tdescription: '**Range:** -100 ~ 0\\n\\nThe decibel value above which the compression will start taking effect.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\tbounds: [-100, true, 0, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.knee', {\n\t\t\t\tdefault: 40,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Knee',\n\t\t\t\t\tsort: 5,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 40\\n\\nA decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\tbounds: [0, true, 40, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.ratio', {\n\t\t\t\tdefault: 12,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Ratio',\n\t\t\t\t\tsort: 10,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 20\\n\\nThe amount of change, in dB, needed in the input for a 1 dB change in the output.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_int',\n\t\t\t\t\tbounds: [0, true, 20, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.attack', {\n\t\t\t\tdefault: 0,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Attack',\n\t\t\t\t\tsort: 15,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 1\\n\\nThe amount of time, in seconds, required to reduce the gain by 10 dB.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_float',\n\t\t\t\t\tbounds: [0, true, 1, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\n\t\t\tthis.settings.add('player.compressor.release', {\n\t\t\t\tdefault: 0.25,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > Compressor >> Advanced',\n\t\t\t\t\ttitle: 'Release',\n\t\t\t\t\tsort: 20,\n\t\t\t\t\tdescription: '**Range:** 0 ~ 1\\nThe amount of time, in seconds, required to increase the gain by 10 dB.',\n\t\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\t\tprocess: 'to_float',\n\t\t\t\t\tbounds: [0, true, 1, true]\n\t\t\t\t},\n\n\t\t\t\tchanged: () => this.updateCompressors()\n\t\t\t});\n\t\t}\n\n\t\tthis.settings.add('player.allow-catchup', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General @{\"sort\": -1000} >> General',\n\t\t\t\ttitle: 'Allow the player to speed up to reduce delay.',\n\t\t\t\tdescription: 'Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updatePlaybackRates()\n\t\t});\n\n\t\tthis.settings.add('player.mute-click', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Mute or unmute the player by middle-clicking.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.volume-scroll', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Adjust volume by scrolling with the mouse wheel.',\n\t\t\t\tdescription: '*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: SCROLL_OPTIONS\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.button.reset', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\ttitle: 'Add a `Reset Player` button to the player controls.',\n\t\t\t\tdescription: \"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => {\n\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\tthis.addResetButton(inst);\n\t\t\t}\n\t\t});\n\n\t\tif ( document.pictureInPictureEnabled )\n\t\t\tthis.settings.add('player.button.pip', {\n\t\t\t\tdefault: true,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\t\ttitle: 'Add a `Picture-in-Picture` button to the player controls.',\n\t\t\t\t\tdescription: \"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.\",\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t},\n\t\t\t\tchanged: () => {\n\t\t\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\t\t\tthis.addPiPButton(inst);\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.settings.add('player.volume-scroll-steps', {\n\t\t\tdefault: 0.1,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Volume scroll amount',\n\t\t\t\tdescription: 'How much the volume level is changed per individual scroll input.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0.1, title: '10%'},\n\t\t\t\t\t{value: 0.05, title: '5%'},\n\t\t\t\t\t{value: 0.02, title: '2%'},\n\t\t\t\t\t{value: 0.01, title: '1%'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.captions.font-size', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Font',\n\t\t\t\ttitle: 'Font Size',\n\t\t\t\tdescription: 'How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.',\n\t\t\t\tcomponent: 'setting-text-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.font-family', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Font',\n\t\t\t\ttitle: 'Font Family',\n\t\t\t\tdescription: 'Override the font used for displaying Closed Captions.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\tdata: () => getFontsList()\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\t/*this.settings.add('player.captions.custom-position', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\tsort: -1,\n\t\t\t\ttitle: 'Enable overriding the position and alignment of closed captions.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.vertical', {\n\t\t\tdefault: '10%',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\ttitle: 'Vertical Position',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tdescription: 'Override the position for Closed Captions. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.horizontal', {\n\t\t\tdefault: '50%',\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\ttitle: 'Horizontal Position',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tdescription: 'Override the position for Closed Captions. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.'\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});\n\n\t\tthis.settings.add('player.captions.alignment', {\n\t\t\tdefault: 32,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > Closed Captioning >> Position',\n\t\t\t\ttitle: 'Alignment',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 11, title: 'Top Left'},\n\t\t\t\t\t{value: 12, title: 'Top Center'},\n\t\t\t\t\t{value: 13, title: 'Top Right'},\n\t\t\t\t\t{value: 21, title: 'Middle Left'},\n\t\t\t\t\t{value: 22, title: 'Middle Center'},\n\t\t\t\t\t{value: 23, title: 'Middle Right'},\n\t\t\t\t\t{value: 31, title: 'Bottom Left'},\n\t\t\t\t\t{value: 32, title: 'Bottom Center'},\n\t\t\t\t\t{value: 33, title: 'Bottom Right'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: () => this.updateCaptionsCSS()\n\t\t});*/\n\n\t\tthis.settings.add('player.ext-hide', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Extensions',\n\t\t\t\ttitle: 'Show Overlay Extensions',\n\t\t\t\tdescription: '**Note**: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security. To prevent extensions from loading entirely, we recommend using the [Disable Twitch Extensions browser extension](https://twitch-tools.rootonline.de/disable_twitch_extensions.php) by CommanderRoot.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 2, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'With Controls'},\n\t\t\t\t\t{value: 0, title: 'Always'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: val => this.updateHideExtensions(val)\n\t\t});\n\n\t\tthis.settings.add('player.ext-interaction', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Extensions',\n\t\t\t\ttitle: 'Allow mouse interaction with overlay extensions.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('player-ext-mouse', !val)\n\t\t})\n\n\t\tthis.settings.add('player.no-autoplay', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Do not automatically start playing videos or streams.',\n\t\t\t\tdescription: 'Note: This feature does not apply when navigating directly from channel to channel.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.vod.autoplay', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Auto-play the next recommended video after a video finishes.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.volume-always-shown', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Volume',\n\t\t\t\ttitle: 'Keep the volume slider expanded at all times.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('player-volume', val)\n\t\t});\n\n\t\tthis.settings.add('player.hide-mouse', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> General',\n\t\t\t\ttitle: \"Hide mouse when controls aren't visible.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('player-hide-mouse', val)\n\t\t});\n\n\t\tthis.settings.add('player.single-click-pause', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: \"Pause/Unpause the player by clicking.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\t}\n\n\tasync onEnable() {\n\t\tawait this.settings.awaitProvider();\n\t\tawait this.settings.provider.awaitReady();\n\n\t\tthis.css_tweaks.toggleHide('player-cast', this.settings.get('player.cast-button.hide'));\n\t\tthis.css_tweaks.toggleHide('player-gain-volume', this.settings.get('player.gain.no-volume'));\n\t\tthis.css_tweaks.toggle('player-hide-native-clip', this.settings.get('player.clip-button.hide-native'));\n\t\tthis.css_tweaks.toggle('player-volume', this.settings.get('player.volume-always-shown'));\n\t\tthis.css_tweaks.toggle('player-ext-mouse', !this.settings.get('player.ext-interaction'));\n\t\tthis.css_tweaks.toggle('player-hide-mouse', this.settings.get('player.hide-mouse'));\n\t\tthis.css_tweaks.toggle('player-fade-paused', this.settings.get('player.fade-pause-buffer'));\n\n\t\tthis.installVisibilityHook();\n\t\tthis.updateHideExtensions();\n\t\tthis.updateCaptionsCSS();\n\t\tthis.updateShortcut();\n\n\t\tthis.on(':reset', this.resetAllPlayers, this);\n\n\t\tthis.Player.ready((cls, instances) => {\n\t\t\tthis.modifyPlayerClass(cls);\n\n\t\t\tfor(const inst of instances) {\n\t\t\t\tconst events = inst.props?.playerEvents;\n\t\t\t\tif ( events ) {\n\t\t\t\t\toff(events, 'Playing', inst.setPlayerActive);\n\t\t\t\t\toff(events, 'PlayerSeekCompleted', inst.setPlayerActive);\n\t\t\t\t}\n\n\t\t\t\tinst.ffzMaybeRemoveNativeListeners();\n\t\t\t\tinst.maybeAttachDomEventListeners();\n\t\t\t\tinst.ffzScheduleState();\n\n\t\t\t\tif ( events ) {\n\t\t\t\t\ton(events, 'Playing', inst.setPlayerActive);\n\t\t\t\t\ton(events, 'PlayerSeekCompleted', inst.setPlayerActive);\n\t\t\t\t}\n\n\t\t\t\tthis.updateGUI(inst);\n\t\t\t\tthis.compressPlayer(inst);\n\t\t\t\tthis.updatePlaybackRate(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.Player.on('mount', inst => {\n\t\t\tthis.updateGUI(inst);\n\t\t\tthis.compressPlayer(inst);\n\t\t\tthis.updatePlaybackRate(inst);\n\t\t});\n\t\tthis.Player.on('update', inst => {\n\t\t\tthis.updateGUI(inst);\n\t\t\tthis.compressPlayer(inst);\n\t\t\tthis.updatePlaybackRate(inst);\n\t\t});\n\n\t\tthis.Player.on('unmount', inst => {\n\t\t\tinst.ffzUninstall();\n\t\t});\n\n\t\tthis.on('i18n:update', () => {\n\t\t\tfor(const inst of this.Player.instances) {\n\t\t\t\tthis.updateGUI(inst);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateShortcut() {\n\t\tconst Mousetrap = this.Mousetrap = this.Mousetrap || this.resolve('site.web_munch')?.getModule?.('mousetrap') || window.Mousetrap;\n\t\tif ( ! Mousetrap || ! Mousetrap.bind )\n\t\t\treturn;\n\n\t\tif ( this._shortcut_bound ) {\n\t\t\tMousetrap.unbind(this._shortcut_bound);\n\t\t\tthis._shortcut_bound = null;\n\t\t}\n\n\t\tconst key = this.settings.get('player.compressor.shortcut');\n\t\tif ( HAS_COMPRESSOR && key && isValidShortcut(key) ) {\n\t\t\tMousetrap.bind(key, this.onShortcut);\n\t\t\tthis._shortcut_bound = key;\n\t\t}\n\t}\n\n\n\tonShortcut(e) {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.compressPlayer(inst, e);\n\t}\n\n\n\tmodifyPlayerClass(cls) {\n\t\tconst t = this,\n\t\t\told_attach = cls.prototype.maybeAttachDomEventListeners;\n\n\t\tcls.prototype.ffzInstall = function() {\n\t\t\tif ( this._ffz_installed )\n\t\t\t\treturn;\n\n\t\t\tthis._ffz_installed = true;\n\n\t\t\t//if ( ! this._ffzUpdateVolume )\n\t\t\t//\tthis._ffzUpdateVolume = debounce(this.ffzUpdateVolume.bind(this));\n\n\t\t\tif ( ! this._ffzUpdateState )\n\t\t\t\tthis._ffzUpdateState = this.ffzUpdateState.bind(this);\n\n\t\t\tif ( ! this._ffzErrorReset )\n\t\t\t\tthis._ffzErrorReset = t.addErrorResetButton.bind(t, this);\n\n\t\t\tif ( ! this._ffzReady )\n\t\t\t\tthis._ffzReady = this.ffzReady.bind(this);\n\n\t\t\tconst inst = this,\n\t\t\t\told_active = this.setPlayerActive,\n\t\t\t\told_inactive = this.setPlayerInactive;\n\n\t\t\tthis.setPlayerActive = function() {\n\t\t\t\tinst.ffzScheduleState();\n\t\t\t\treturn old_active.call(inst);\n\t\t\t}\n\n\t\t\tthis.setPlayerInactive = function() {\n\t\t\t\tinst.ffzScheduleState();\n\t\t\t\treturn old_inactive.call(inst);\n\t\t\t}\n\n\t\t\tthis.ffzOnEnded = () => {\n\t\t\t\tif ( t.settings.get('player.vod.autoplay') )\n\t\t\t\t\treturn;\n\n\t\t\t\tt.parent.awaitElement(\n\t\t\t\t\t'.autoplay-vod__content-container button',\n\t\t\t\t\tthis.props.containerRef || t.fine.getChildNode(this),\n\t\t\t\t\t1000\n\t\t\t\t).then(el => el.click());\n\t\t\t}\n\n\t\t\tconst events = this.props.playerEvents;\n\t\t\tif ( events ) {\n\t\t\t\ton(events, 'Buffering', this._ffzUpdateState);\n\t\t\t\ton(events, 'Playing', this._ffzUpdateState);\n\t\t\t\ton(events, 'PlayerError', this._ffzUpdateState);\n\t\t\t\ton(events, 'PlayerError', this._ffzErrorReset);\n\t\t\t\ton(events, 'Ended', this._ffzUpdateState);\n\t\t\t\ton(events, 'Ended', this.ffzOnEnded);\n\t\t\t\ton(events, 'Ready', this._ffzReady);\n\t\t\t\ton(events, 'Idle', this._ffzUpdateState);\n\t\t\t}\n\n\t\t\tthis.ffzStopAutoplay();\n\t\t}\n\n\t\t/*cls.prototype.ffzUpdateVolume = function() {\n\t\t\tif ( document.hidden )\n\t\t\t\treturn;\n\n\t\t\tconst player = this.props.mediaPlayerInstance,\n\t\t\t\tvideo = player?.mediaSinkManager?.video || player?.core?.mediaSinkManager?.video;\n\t\t\tif ( video ) {\n\t\t\t\tconst volume = video.volume,\n\t\t\t\t\tmuted = player.isMuted();\n\t\t\t\tif ( ! video.muted && player.getVolume() !== volume ) {\n\t\t\t\t\tplayer.setVolume(volume);\n\t\t\t\t\tplayer.setMuted(muted);\n\t\t\t\t}\n\t\t\t}\n\t\t}*/\n\n\t\tcls.prototype.ffzUninstall = function() {\n\t\t\tif ( this._ffz_state_raf )\n\t\t\t\tcancelAnimationFrame(this._ffz_state_raf);\n\n\t\t\tconst events = this.props.playerEvents;\n\t\t\tif ( events && this._ffzUpdateState ) {\n\t\t\t\toff(events, 'Playing', this._ffzUpdateState);\n\t\t\t\toff(events, 'PlayerError', this._ffzUpdateState);\n\t\t\t\toff(events, 'PlayerError', this._ffzErrorReset);\n\t\t\t\toff(events, 'Ended', this._ffzUpdateState);\n\t\t\t\toff(events, 'Ended', this.ffzOnEnded);\n\t\t\t\toff(events, 'Ready', this._ffzReady);\n\t\t\t\toff(events, 'Idle', this._ffzUpdateState);\n\t\t\t}\n\n\t\t\tthis.ffzRemoveListeners();\n\n\t\t\tthis._ffz_state_raf = null;\n\t\t\tthis._ffzUpdateState = null;\n\t\t\tthis._ffzErrorReset = null;\n\t\t\tthis._ffzReady = null;\n\t\t\tthis.ffzOnEnded = null;\n\t\t}\n\n\t\tcls.prototype.ffzReady = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont )\n\t\t\t\treturn;\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst icons = cont.querySelectorAll('.ffz--player-reset figure');\n\t\t\t\tfor(const icon of icons) {\n\t\t\t\t\tif ( icon._ffz_unspin )\n\t\t\t\t\t\tclearTimeout(icon._ffz_unspin);\n\n\t\t\t\t\ticon.classList.toggle('loading', false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tcls.prototype.ffzStopAutoplay = function() {\n\t\t\tif ( t.shouldStopAutoplay(this) )\n\t\t\t\tt.stopPlayer(this.props.mediaPlayerInstance, this.props.playerEvents, this);\n\t\t}\n\n\t\tcls.prototype.ffzScheduleState = function() {\n\t\t\tif ( ! this._ffzUpdateState )\n\t\t\t\tthis._ffzUpdateState = this.ffzUpdateState.bind(this);\n\n\t\t\tif ( ! this._ffz_state_raf )\n\t\t\t\tthis._ffz_state_raf = requestAnimationFrame(this._ffzUpdateState);\n\t\t}\n\n\t\tcls.prototype.ffzUpdateState = function() {\n\t\t\tthis._ffz_state_raf = null;\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont )\n\t\t\t\treturn;\n\n\t\t\tconst ds = cont.dataset;\n\t\t\tds.controls = this.state?.active || false;\n\n\t\t\tlet player = this.props.mediaPlayerInstance;\n\t\t\tif ( ! player )\n\t\t\t\treturn;\n\n\t\t\tif ( player.core )\n\t\t\t\tplayer = player.core;\n\n\t\t\tconst state = player.state?.state,\n\t\t\t\tvideo = player.mediaSinkManager?.video;\n\n\t\t\tif ( state === 'Playing' ) {\n\t\t\t\tif ( video?._ffz_maybe_compress ) {\n\t\t\t\t\tvideo._ffz_maybe_compress = false;\n\t\t\t\t\tt.compressPlayer(this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( video && video._ffz_compressed != null )\n\t\t\t\tds.compressed = video._ffz_compressed;\n\n\t\t\tds.ended = state === 'Ended';\n\t\t\tds.paused = state === 'Idle';\n\t\t\tds.buffering = state === 'Buffering';\n\t\t}\n\n\t\tcls.prototype.ffzAttachListeners = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont || this._ffz_listeners )\n\t\t\t\treturn;\n\n\t\t\tthis._ffz_listeners = true;\n\t\t\tif ( ! this._ffz_scroll_handler )\n\t\t\t\tthis._ffz_scroll_handler = this.ffzScrollHandler.bind(this);\n\n\t\t\tif ( ! this._ffz_click_handler )\n\t\t\t\tthis._ffz_click_handler = this.ffzClickHandler.bind(this);\n\n\t\t\tif ( ! this._ffz_dblclick_handler )\n\t\t\t\tthis._ffz_dblclick_handler = this.ffzDblClickHandler.bind(this);\n\n\t\t\tif ( ! this._ffz_menu_handler )\n\t\t\t\tthis._ffz_menu_handler = this.ffzMenuHandler.bind(this);\n\n\t\t\ton(cont, 'wheel', this._ffz_scroll_handler);\n\t\t\ton(cont, 'dblclick', this._ffz_dblclick_handler);\n\t\t\ton(cont, 'mousedown', this._ffz_click_handler);\n\t\t\ton(cont, 'contextmenu', this._ffz_menu_handler);\n\t\t}\n\n\t\tcls.prototype.ffzRemoveListeners = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( ! cont || ! this._ffz_listeners )\n\t\t\t\treturn;\n\n\t\t\tif ( this._ffz_scroll_handler ) {\n\t\t\t\toff(cont, 'wheel', this._ffz_scroll_handler);\n\t\t\t\tthis._ffz_scroll_handler = null;\n\t\t\t}\n\n\t\t\tif ( this._ffz_click_handler ) {\n\t\t\t\toff(cont, 'mousedown', this._ffz_click_handler);\n\t\t\t\tthis._ffz_click_handler = null;\n\t\t\t}\n\n\t\t\tif ( this._ffz_menu_handler ) {\n\t\t\t\toff(cont, 'contextmenu', this._ffz_menu_handler);\n\t\t\t\tthis._ffz_menu_handler = null;\n\t\t\t}\n\n\t\t\tif ( this._ffz_dblclick_handler ) {\n\t\t\t\toff(cont, 'dblclick', this._ffz_dblclick_handler);\n\t\t\t\tthis._ffz_dblclick_handler = null;\n\t\t\t}\n\n\t\t\tthis._ffz_listeners = false;\n\t\t}\n\n\t\tcls.prototype.ffzDelayPause = function() {\n\t\t\tif ( this._ffz_pause_timer )\n\t\t\t\tclearTimeout(this._ffz_pause_timer);\n\n\t\t\tconst player = this.props?.mediaPlayerInstance;\n\t\t\tif (! player.isPaused())\n\t\t\t\tthis._ffz_pause_timer = setTimeout(() => {\n\t\t\t\t\tconst player = this.props?.mediaPlayerInstance;\n\t\t\t\t\tif (!player.isPaused())\n\t\t\t\t\t\tplayer.pause();\n\t\t\t\t}, 500);\n\t\t}\n\n\t\tcls.prototype.ffzDblClickHandler = function(event) {\n\t\t\tif ( ! event )\n\t\t\t\treturn;\n\n\t\t\tif ( this._ffz_pause_timer )\n\t\t\t\tclearTimeout(this._ffz_pause_timer);\n\t\t}\n\n\t\tcls.prototype.ffzClickHandler = function(event) {\n\t\t\tif ( ! event )\n\t\t\t\treturn;\n\n\t\t\tconst vol_scroll = t.settings.get('player.volume-scroll'),\n\t\t\t\tgain_scroll = t.settings.get('player.gain.scroll'),\n\t\t\t\tclick_pause = t.settings.get('player.single-click-pause'),\n\n\t\t\t\twants_rmb = wantsRMB(vol_scroll) || wantsRMB(gain_scroll);\n\n\t\t\t// Left Click\n\t\t\tif (click_pause && event.button === 0) {\n\t\t\t\tif (! event.target || ! event.target.classList.contains('click-handler'))\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.ffzDelayPause();\n\t\t\t}\n\n\t\t\t// Right Click\n\t\t\tif ( wants_rmb && event.button === 2 ) {\n\t\t\t\tthis.ffz_rmb = true;\n\t\t\t\tthis.ffz_scrolled = false;\n\t\t\t}\n\n\t\t\t// Middle Click\n\t\t\tif ( ! t.settings.get('player.mute-click') || event.button !== 1 )\n\t\t\t\treturn;\n\n\t\t\tconst player = this.props?.mediaPlayerInstance;\n\t\t\tif ( ! player?.isMuted )\n\t\t\t\treturn;\n\n\t\t\tconst muted = ! player.isMuted();\n\t\t\tplayer.setMuted(muted);\n\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: muted}));\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n\t\tcls.prototype.ffzMenuHandler = function(event) {\n\t\t\tthis.ffz_rmb = false;\n\t\t\tif ( this.ffz_scrolled ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.ffzScrollHandler = function(event) {\n\t\t\tconst vol_scroll = t.settings.get('player.volume-scroll'),\n\t\t\t\tgain_scroll = t.settings.get('player.gain.scroll'),\n\t\t\t\tno_vol = t.settings.get('player.gain.no-volume'),\n\n\t\t\t\tmatches_gain = gain_scroll && matchesEvent(gain_scroll, event, this.ffz_rmb),\n\t\t\t\tmatches_vol = vol_scroll && matchesEvent(vol_scroll, event, this.ffz_rmb);\n\n\t\t\tif ( ! matches_gain && ! matches_vol )\n\t\t\t\treturn;\n\n\t\t\tconst delta = event.wheelDelta || -(event.deltaY || event.detail || 0),\n\t\t\t\tplayer = this.props?.mediaPlayerInstance,\n\t\t\t\tvideo = player?.mediaSinkManager?.video || player?.core?.mediaSinkManager?.video,\n\t\t\t\thas_gain = video?._ffz_compressed && video?._ffz_gain != null,\n\t\t\t\tdoing_gain = has_gain && matches_gain;\n\n\t\t\tif ( ! player?.getVolume )\n\t\t\t\treturn;\n\n\t\t\tif ( doing_gain ? wantsRMB(gain_scroll) : wantsRMB(vol_scroll) )\n\t\t\t\tthis.ffz_scrolled = true;\n\n\t\t\tconst amount = t.settings.get('player.volume-scroll-steps');\n\n\t\t\tif ( doing_gain ) {\n\t\t\t\tlet value = video._ffz_gain_value;\n\t\t\t\tif ( value == null )\n\t\t\t\t\tvalue = t.settings.get('player.gain.default');\n\n\t\t\t\tconst min = t.settings.get('player.gain.min'),\n\t\t\t\t\tmax = t.settings.get('player.gain.max');\n\n\t\t\t\tif ( delta > 0 )\n\t\t\t\t\tvalue += amount;\n\t\t\t\telse\n\t\t\t\t\tvalue -= amount;\n\n\t\t\t\tif ( value < min )\n\t\t\t\t\tvalue = min;\n\t\t\t\tif ( value > max )\n\t\t\t\t\tvalue = max;\n\n\t\t\t\tvideo._ffz_gain_value = value;\n\n\t\t\t\tif ( no_vol && value !== 0 ) {\n\t\t\t\t\tplayer.setMuted(false);\n\t\t\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: false}));\n\t\t\t\t}\n\n\t\t\t\tt.updateGain(this);\n\n\t\t\t} else if ( matches_vol && ! (video._ffz_compressed && no_vol) ) {\n\t\t\t\tconst old_volume = video?.volume ?? player.getVolume(),\n\t\t\t\t\tvolume = Math.max(0, Math.min(1, old_volume + (delta > 0 ? amount : -amount)));\n\n\t\t\t\tplayer.setVolume(volume);\n\t\t\t\tlocalStorage.volume = volume;\n\n\t\t\t\tif ( volume !== 0 ) {\n\t\t\t\t\tplayer.setMuted(false);\n\t\t\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: false}));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n\t\tcls.prototype.ffzMaybeRemoveNativeListeners = function() {\n\t\t\tconst cont = this.props.containerRef;\n\t\t\tif ( cont && this.listenersAttached ) {\n\t\t\t\toff(cont, 'mouseleave', this.setPlayerInactive);\n\t\t\t\toff(cont, 'mouseenter', this.setPlayerActive);\n\t\t\t\toff(cont, 'mousemove', this.onMouseMove);\n\t\t\t\tthis.listenersAttached = false;\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.maybeAttachDomEventListeners = function() {\n\t\t\ttry {\n\t\t\t\tthis.ffzInstall();\n\t\t\t\tthis.ffzAttachListeners();\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error attaching event listener.', err);\n\t\t\t}\n\n\t\t\treturn old_attach.call(this);\n\t\t}\n\t}\n\n\tshouldStopAutoplay() { // eslint-disable-line class-methods-use-this\n\t\treturn false;\n\t}\n\n\tinstallVisibilityHook() {\n\t\tif ( ! document.pictureInPictureEnabled ) {\n\t\t\tthis.log.info('Skipping visibility hooks. Picture-in-Picture is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst t = this;\n\n\t\tdocument.addEventListener('fullscreenchange', () => {\n\t\t\tconst fs = document.fullscreenElement,\n\t\t\t\tpip = document.pictureInPictureElement;\n\n\t\t\tif ( fs && pip && (fs === pip || fs.contains(pip)) )\n\t\t\t\tdocument.exitPictureInPicture();\n\n\t\t\t// Update the UI since we can't enter PiP from Fullscreen\n\t\t\tfor(const inst of this.Player.instances)\n\t\t\t\tthis.addPiPButton(inst);\n\t\t});\n\n\t\ttry {\n\t\t\tObject.defineProperty(document, 'hidden', {\n\t\t\t\tconfigurable: true,\n\t\t\t\tget() {\n\t\t\t\t\t// If Picture in Picture is active, then we should not\n\t\t\t\t\t// drop quality. Therefore, we need to trick Twitch\n\t\t\t\t\t// into thinking the document is still active.\n\t\t\t\t\tif ( document.pictureInPictureElement != null )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tif ( t.settings.get('player.force-visible') )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\treturn document.visibilityState === 'hidden';\n\t\t\t\t}\n\t\t\t});\n\n\t\t} catch(err) {\n\t\t\tthis.log.warn('Unable to install document visibility hook.', err);\n\t\t}\n\t}\n\n\tstopPlayer(player, events, inst) {\n\t\tif ( player && player.pause && (player.getState?.() || player.core?.getState?.()) === 'Playing' )\n\t\t\tplayer.pause();\n\t\telse if ( events && ! events._ffz_stopping ) {\n\t\t\tevents._ffz_stopping = true;\n\n\t\t\tconst immediatePause = () => {\n\t\t\t\tif ( inst.props.mediaPlayerInstance?.pause ) {\n\t\t\t\t\tinst.props.mediaPlayerInstance.pause();\n\t\t\t\t\toff(events, 'Playing', immediatePause);\n\t\t\t\t\tevents._ffz_stopping = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.log.info('Unable to immediately pause. Listening for playing event.');\n\t\t\ton(events, 'Playing', immediatePause);\n\t\t}\n\t}\n\n\tupdateCaptionsCSS() {\n\t\t// Font\n\t\tconst font_out = [];\n\n\t\tconst font_size = this.settings.get('player.captions.font-size');\n\t\tlet font_family = this.settings.get('player.captions.font-family');\n\n\t\tif ( font_family && font_family.length ) {\n\t\t\tconst [processed, unloader] = useFont(font_family);\n\t\t\tfont_family = processed;\n\n\t\t\tif ( this._font_unloader )\n\t\t\t\tthis._font_unloader();\n\n\t\t\tthis._font_unloader = unloader;\n\n\t\t\tif ( font_family.indexOf(' ') !== -1 && font_family.indexOf(',') === -1 && font_family.indexOf('\"') === -1 && font_family.indexOf(\"'\") === -1 )\n\t\t\t\tfont_family = `\"${font_family}\"`;\n\n\t\t\tSTYLE_VALIDATOR.style.fontFamily = '';\n\t\t\tSTYLE_VALIDATOR.style.fontFamily = font_family;\n\n\t\t\tif ( STYLE_VALIDATOR.style.fontFamily )\n\t\t\t\tfont_out.push(`font-family: ${STYLE_VALIDATOR.style.fontFamily} !important;`);\n\t\t}\n\n\t\tSTYLE_VALIDATOR.style.fontSize = '';\n\t\tSTYLE_VALIDATOR.style.fontSize = font_size;\n\n\t\tif ( STYLE_VALIDATOR.style.fontSize )\n\t\t\tfont_out.push(`font-size: ${STYLE_VALIDATOR.style.fontSize} !important;`);\n\n\t\tif ( font_out.length )\n\t\t\tthis.css_tweaks.set('captions-font', `.player-captions-container__caption-line {\n\t${font_out.join('\\n\\t')}\n}`)\n\t\telse\n\t\t\tthis.css_tweaks.delete('captions-font');\n\n\t\t// Position\n\t\t/*const enabled = this.settings.get('player.captions.custom-position'),\n\t\t\tvertical = this.settings.get('player.captions.vertical'),\n\t\t\thorizontal = this.settings.get('player.captions.horizontal'),\n\t\t\talignment = this.settings.get('player.captions.alignment');\n\n\t\tif ( ! enabled ) {\n\t\t\tthis.css_tweaks.delete('captions-position');\n\t\t\treturn;\n\t\t}\n\n\t\tconst out = [], align_out = [],\n\t\t\talign_horizontal = alignment % 10,\n\t\t\talign_vertical = Math.floor(alignment / 10);\n\n\t\tlet custom_top = false,\n\t\t\tcustom_left = false;\n\n\t\tSTYLE_VALIDATOR.style.top = '';\n\t\tSTYLE_VALIDATOR.style.top = vertical;\n\t\tif ( STYLE_VALIDATOR.style.top ) {\n\t\t\tout.push(`${align_vertical === 3 ? 'bottom' : 'top'}: ${STYLE_VALIDATOR.style.top} !important;`)\n\t\t\tout.push(`${align_vertical === 3 ? 'top' : 'bottom'}: unset !important;`);\n\t\t\tcustom_top = true;\n\t\t}\n\n\t\tSTYLE_VALIDATOR.style.top = '';\n\t\tSTYLE_VALIDATOR.style.top = horizontal;\n\t\tif ( STYLE_VALIDATOR.style.top ) {\n\t\t\tif ( align_horizontal === 1 )\n\t\t\t\talign_out.push(`align-items: flex-start !important;`);\n\t\t\telse if ( align_horizontal === 3 )\n\t\t\t\talign_out.push(`align-items: flex-end !important;`);\n\n\t\t\tout.push(`${align_horizontal === 3 ? 'right' : 'left'}: ${STYLE_VALIDATOR.style.top} !important;`);\n\t\t\tout.push(`${align_horizontal === 3 ? 'left' : 'right'}: unset !important;`);\n\t\t\tcustom_left = true;\n\t\t}\n\n\t\tif ( align_horizontal !== 2 )\n\t\t\tout.push(`width: unset !important;`);\n\n\t\tout.push(`transform: translate(${(!custom_left || align_horizontal === 2) ? '-50%' : '0'}, ${(!custom_top || align_vertical === 2) ? '-50%' : '0'})`);\n\n\t\tthis.css_tweaks.set('captions-position', `.player-captions-container {\n\t${out.join('\\n\\t')};\n}${align_out.length ? `.player-captions-container__caption-window {\n\t${align_out.join('\\n\\t')}\n}` : ''}`);*/\n\t}\n\n\tupdateHideExtensions(val) {\n\t\tif ( val === undefined )\n\t\t\tval = this.settings.get('player.ext-hide');\n\n\t\tthis.css_tweaks.toggleHide('player-ext-hover', val === 1);\n\t\tthis.css_tweaks.toggleHide('player-ext', val === 2);\n\t}\n\n\tskipContentWarnings(inst) {\n\t\tif ( ! this.settings.get('player.disable-content-warnings') )\n\t\t\treturn;\n\n\t\tconst cont = this.fine.getHostNode(inst),\n\t\t\tbtn = cont && cont.querySelector('button[data-a-target=\"content-classification-gate-overlay-start-watching-button\"]');\n\n\t\tif ( btn )\n\t\t\tbtn.click();\n\t}\n\n\tupdateGUI(inst) {\n\t\tthis.skipContentWarnings(inst);\n\t\tthis.addPiPButton(inst);\n\t\tthis.addResetButton(inst);\n\t\tthis.addClipButton(inst);\n\t\tthis.addCompressorButton(inst, false);\n\t\tthis.addGainSlider(inst, false);\n\t\tthis.addMetadata(inst);\n\n\t\t//if ( inst._ffzUpdateVolume )\n\t\t//\tinst._ffzUpdateVolume();\n\n\t\tthis.emit(':update-gui', inst);\n\t}\n\n\tareControlsDisabled(inst) {\n\t\tif ( ! inst._ffz_control_state )\n\t\t\tthis.findControlState(inst);\n\n\t\tif ( inst._ffz_control_state )\n\t\t\treturn inst._ffz_control_state.props.disableControls;\n\n\t\treturn false;\n\t}\n\n\tfindControlState(inst) {\n\t\tif ( ! inst._ffz_control_state )\n\t\t\tinst._ffz_control_state = this.fine.searchTree(inst, n => n.props && has(n.props, 'disableControls'), 200);\n\t}\n\n\taddGainSlider(inst, visible_only, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video || inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,\n\t\t\tcontainer = outer && outer.querySelector(LEFT_CONTROLS);\n\t\tlet gain = video != null && video._ffz_compressed && video._ffz_gain;\n\n\t\tif ( this.areControlsDisabled(inst) )\n\t\t\tgain = null;\n\n\t\tif ( ! container ) {\n\t\t\tif ( video && ! gain )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addGainSlider.bind(this, inst, visible_only, (tries || 0) + 1), 250);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst min = this.settings.get('player.gain.min'),\n\t\t\tmax = this.settings.get('player.gain.max');\n\n\t\tif ( min >= max || max <= min )\n\t\t\tgain = null;\n\n\t\tlet tip, tipcont, input, extra, fill, cont = container.querySelector('.ffz--player-gain');\n\t\tif ( ! gain ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tconst on_change = () => {\n\t\t\t\tlet value = input.value / 100;\n\n\t\t\t\tconst min = this.settings.get('player.gain.min'),\n\t\t\t\t\tmax = this.settings.get('player.gain.max');\n\n\t\t\t\tif ( value < min )\n\t\t\t\t\tvalue = min;\n\t\t\t\tif ( value > max )\n\t\t\t\t\tvalue = max;\n\n\t\t\t\tif ( value == video._ffz_gain_value )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\t\t\tcore = player.core || player;\n\n\t\t\t\tif ( ! this.areControlsDisabled(inst) && value > 0 && this.settings.get('player.gain.no-volume') && core?.isMuted?.() ) {\n\t\t\t\t\tcore.setMuted(false);\n\t\t\t\t\tlocalStorage.setItem('video-muted', JSON.stringify({default: false}));\n\t\t\t\t}\n\n\t\t\t\tvideo._ffz_gain_value = value;\n\t\t\t\tgain.gain.value = value;\n\n\t\t\t\tconst range = max - min,\n\t\t\t\t\twidth = (value - min) / range;\n\n\t\t\t\tfill.style.width = `${width * 100}%`;\n\t\t\t\textra.textContent = `${Math.round(value * 100)}%`;\n\t\t\t};\n\n\t\t\tcont = (<div class=\"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container\">\n\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-full-height\">\n\t\t\t\t\t<label class=\"tw-hide-accessible\">{this.i18n.t('player.gain.label','Gain Control')}</label>\n\t\t\t\t\t<div class=\"tw-flex tw-full-width tw-relative tw-z-above\">\n\t\t\t\t\t\t{input = (<input\n\t\t\t\t\t\t\tclass=\"ffz-range ffz-range--overlay\"\n\t\t\t\t\t\t\ttype=\"range\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\t\tstep=\"1\"\n\t\t\t\t\t\t\tdata-a-target=\"player-gain-slider\"\n\t\t\t\t\t\t\tvalue=\"100\"\n\t\t\t\t\t\t/>)}\n\t\t\t\t\t\t<div class=\"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below\">\n\t\t\t\t\t\t\t<div class=\"tw-border-radius-large ffz-range__fill-container\">\n\t\t\t\t\t\t\t\t{fill = (<div\n\t\t\t\t\t\t\t\t\tclass=\"tw-border-radius-large ffz-range__fill-value ffz--gain-value\"\n\t\t\t\t\t\t\t\t\tdata-test-selector=\"ffz-range__fill-value-selector\"\n\t\t\t\t\t\t\t\t/>)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{tipcont = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up\" role=\"tooltip\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{tip = (<div class=\"ffz--p-tip\" />)}\n\t\t\t\t\t\t{extra = (<div class=\"tw-regular ffz--p-value\" />)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>)}\n\t\t\t</div>);\n\n\t\t\t/*input.addEventListener('contextmenu', e => {\n\t\t\t\tvideo._ffz_gain_value = null;\n\t\t\t\tthis.updateGain(inst);\n\t\t\t\te.preventDefault();\n\t\t\t});*/\n\t\t\tinput.addEventListener('input', on_change);\n\t\t\tcontainer.appendChild(cont);\n\n\t\t} else if ( visible_only )\n\t\t\treturn;\n\t\telse {\n\t\t\tinput = cont.querySelector('input');\n\t\t\tfill = cont.querySelector('.ffz--gain-value');\n\t\t\ttipcont = cont.querySelector('.ffz-il-tooltip');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip .ffz--p-tip');\n\t\t\textra = cont.querySelector('.ffz-il-tooltip .ffz--p-value');\n\t\t}\n\n\t\tlet value = video._ffz_gain_value;\n\t\tif ( value == null )\n\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\tinput.min = min * 100;\n\t\tinput.max = max * 100;\n\t\tinput.value = value * 100;\n\n\t\tconst range = max - min,\n\t\t\twidth = (value - min) / range;\n\n\t\tfill.style.width = `${width * 100}%`;\n\n\t\ttip.textContent = this.i18n.t('player.gain.label', 'Gain Control');\n\t\textra.textContent = `${Math.round(value * 100)}%`;\n\t}\n\n\taddCompressorButton(inst, visible_only, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video || inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,\n\t\t\tcontainer = outer && outer.querySelector(LEFT_CONTROLS),\n\t\t\thas_comp = HAS_COMPRESSOR && video != null && this.settings.get('player.compressor.enable');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_comp )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addCompressorButton.bind(this, inst, visible_only, (tries || 0) + 1), 250);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet icon, tip, extra, btn, cont = container.querySelector('.ffz--player-comp');\n\t\tif ( ! has_comp || this.areControlsDisabled(inst) ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-comp-button\"\n\t\t\t\t\tonClick={this.compressPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t{icon = (<figure class=\"ffz-player-icon\" />)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up\" role=\"tooltip\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{tip = (<div class=\"ffz--p-tip\" />)}\n\t\t\t\t\t\t{extra = (<div class=\"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain\" />)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>);\n\n\t\t\tcontainer.appendChild(cont);\n\t\t} else if ( visible_only )\n\t\t\treturn;\n\t\telse {\n\t\t\ticon = cont.querySelector('figure');\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip .ffz--p-tip');\n\t\t\textra = cont.querySelector('.ffz-il-tooltip .ffz--p-extra');\n\t\t}\n\n\t\tconst comp_active = video._ffz_compressed,\n\t\t\tcan_apply = this.canCompress(inst);\n\t\tlet label = can_apply ?\n\t\t\tcomp_active ?\n\t\t\t\tthis.i18n.t('player.comp_button.off', 'Disable Audio Compressor') :\n\t\t\t\tthis.i18n.t('player.comp_button.on', 'Audio Compressor')\n\t\t\t: this.i18n.t('player.comp_button.disabled', 'Audio Compressor cannot be enabled when viewing Clips.');\n\n\t\textra.textContent = this.i18n.t('player.comp_button.help', 'See the FFZ Control Center for details. If audio breaks, please reset the player.');\n\n\t\tif ( can_apply && this._shortcut_bound )\n\t\t\tlabel = `${label} (${this._shortcut_bound})`;\n\n\t\ticon.classList.toggle('ffz-i-comp-on', comp_active);\n\t\ticon.classList.toggle('ffz-i-comp-off', ! comp_active);\n\t\tbtn.disabled = ! can_apply;\n\n\t\tbtn.setAttribute('aria-label', label);\n\t\ttip.textContent = label;\n\t}\n\n\treplaceVideoElement(player, video) {\n\t\tconst new_vid = createElement('video'),\n\t\t\tvol = video?._ffz_pregain_volume ?? video?.volume ?? player.getVolume(),\n\t\t\tmuted = player.isMuted();\n\n\t\tnew_vid._ffz_gain_value = video._ffz_gain_value;\n\t\tnew_vid._ffz_state = video._ffz_state;\n\t\tnew_vid._ffz_toggled = video._ffz_toggled;\n\t\tnew_vid._ffz_maybe_compress = video._ffz_compressed;\n\t\tnew_vid.volume = vol;\n\t\tif ( muted )\n\t\t\tnew_vid.muted = true;\n\t\tnew_vid.playsInline = true;\n\n\t\tthis.installPlaybackRate(new_vid);\n\t\tvideo.replaceWith(new_vid);\n\t\tplayer.attachHTMLVideoElement(new_vid);\n\t\treturn new_vid;\n\t}\n\n\thookPlayerLoad(player) {\n\t\tif ( ! player || player._ffz_load )\n\t\t\treturn;\n\n\t\tplayer._ffz_load = player.load;\n\n\t\tplayer.load = (...args) => {\n\t\t\ttry {\n\t\t\t\tconst video = player.getHTMLVideoElement();\n\t\t\t\tif ( video?._ffz_compressor && player.attachHTMLVideoElement ) {\n\t\t\t\t\tthis.log.info('Recreating video element due to player load with compressor installed.');\n\t\t\t\t\tthis.replaceVideoElement(player, video);\n\t\t\t\t}\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error while handling player load.', err);\n\t\t\t}\n\n\t\t\treturn player._ffz_load(...args);\n\t\t}\n\t}\n\n\tcompressPlayer(inst, e) {\n\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\tcore = player.core || player,\n\t\t\tvideo = core?.mediaSinkManager?.video;\n\n\t\tif ( ! video || ! HAS_COMPRESSOR )\n\t\t\treturn;\n\n\t\t// Backup the player load method.\n\t\tthis.hookPlayerLoad(player);\n\n\t\t// Backup and replace the setSrc method.\n\t\tif ( ! inst._ffz_setSrc ) {\n\t\t\tinst._ffz_setSrc = inst.setSrc;\n\t\t\tinst.setSrc = async function(...args) {\n\t\t\t\tconsole.log('setSrc', args);\n\t\t\t\tconst vid = inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\t\t\t\tif ( vid && vid._ffz_compressor )\n\t\t\t\t\tawait this.resetPlayer(inst);\n\t\t\t\treturn inst._ffz_setSrc(...args);\n\t\t\t}\n\t\t}\n\n\t\t// Backup the setVolume method.\n\t\tif ( ! core._ffz_setVolume ) {\n\t\t\tcore._ffz_setVolume = core.setVolume;\n\t\t\tcore._ffz_fakeVolume = () => {};\n\t\t}\n\n\t\tvideo._ffz_maybe_compress = false;\n\t\tconst compressed = video._ffz_compressed || false;\n\t\tlet wanted = video._ffz_toggled ? video._ffz_state : this.settings.get('player.compressor.default');\n\t\tif ( e != null ) {\n\t\t\te.preventDefault();\n\t\t\tvideo._ffz_toggled = true;\n\t\t\twanted = ! video._ffz_compressed;\n\t\t\tvideo._ffz_state = wanted;\n\t\t}\n\n\t\tif ( ! video._ffz_compressor ) {\n\t\t\tif ( ! wanted )\n\t\t\t\treturn;\n\n\t\t\tthis.createCompressor(inst, video);\n\n\t\t} else if ( ! video._ffz_comp_reset && ! this.canCompress(inst) ) {\n\t\t\tvideo._ffz_comp_reset = true;\n\t\t\tthis.resetPlayer(inst);\n\t\t\treturn;\n\t\t}\n\n\t\tlet gain = video._ffz_gain;\n\t\tconst want_gain = HAS_GAIN && this.settings.get('player.gain.enable'),\n\t\t\thas_gain = gain != null;\n\n\t\tif ( ((wanted == compressed) || (e == null && video._ffz_toggled)) && has_gain == want_gain )\n\t\t\treturn;\n\n\t\tconst ctx = video._ffz_context,\n\t\t\tcomp = video._ffz_compressor,\n\t\t\tsrc = video._ffz_source;\n\n\t\tif ( ! ctx || ! comp || ! src )\n\t\t\treturn;\n\n\t\tif ( want_gain && ! gain ) {\n\t\t\tlet value = video._ffz_gain_value;\n\t\t\tif ( value == null )\n\t\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\t\ttry {\n\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\tthrow new Error();\n\n\t\t\t\tgain = video._ffz_gain = new GainNode(ctx, {\n\t\t\t\t\tgain: value\n\t\t\t\t});\n\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.info('Unable to use new GainNode. Falling back to old method.');\n\t\t\t\tgain = video._ffz_gain = ctx.createGain();\n\t\t\t\tgain.gain.value = value;\n\t\t\t}\n\n\t\t\tcomp.connect(gain);\n\n\t\t\tif ( compressed ) {\n\t\t\t\tcomp.disconnect(ctx.destination);\n\t\t\t\tgain.connect(ctx.destination);\n\t\t\t}\n\n\t\t} else if ( ! want_gain && gain ) {\n\t\t\tcomp.disconnect(gain);\n\t\t\tif ( compressed ) {\n\t\t\t\tgain.disconnect(ctx.destination);\n\t\t\t\tcomp.connect(ctx.destination);\n\t\t\t}\n\n\t\t\tgain = video._ffz_gain = null;\n\t\t}\n\n\t\tif ( wanted != compressed ) {\n\t\t\tif ( wanted ) {\n\t\t\t\tsrc.disconnect(ctx.destination);\n\t\t\t\tsrc.connect(comp);\n\t\t\t\tif ( gain ) {\n\t\t\t\t\tgain.connect(ctx.destination);\n\t\t\t\t\tif ( this.settings.get('player.gain.no-volume') ) {\n\t\t\t\t\t\tvideo._ffz_pregain_volume = core.getVolume();\n\t\t\t\t\t\tcore._ffz_setVolume(1);\n\t\t\t\t\t\tcore.setVolume = core._ffz_fakeVolume;\n\t\t\t\t\t}\n\n\t\t\t\t} else\n\t\t\t\t\tcomp.connect(ctx.destination);\n\t\t\t} else {\n\t\t\t\tsrc.disconnect(comp);\n\t\t\t\tif ( gain ) {\n\t\t\t\t\tgain.disconnect(ctx.destination);\n\t\t\t\t\tif ( video._ffz_pregain_volume != null ) {\n\t\t\t\t\t\tcore._ffz_setVolume(video._ffz_pregain_volume);\n\t\t\t\t\t\tcore.setVolume = core._ffz_setVolume;\n\t\t\t\t\t\tvideo._ffz_pregain_volume = null;\n\t\t\t\t\t}\n\n\t\t\t\t} else\n\t\t\t\t\tcomp.disconnect(ctx.destination);\n\t\t\t\tsrc.connect(ctx.destination);\n\t\t\t}\n\t\t}\n\n\t\tif ( inst.props.containerRef )\n\t\t\tinst.props.containerRef.dataset.compressed = wanted;\n\n\t\tvideo._ffz_compressed = wanted;\n\t\tthis.addCompressorButton(inst);\n\t\tthis.addGainSlider(inst);\n\t}\n\n\tupdateGainVolume(inst) {\n\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\tcore = player.core || player,\n\t\t\tvideo = core?.mediaSinkManager?.video;\n\n\t\tif ( ! video || ! video._ffz_compressed )\n\t\t\treturn;\n\n\t\tconst setting = this.settings.get('player.gain.no-volume');\n\n\t\tif ( setting && video._ffz_pregain_volume == null ) {\n\t\t\tvideo._ffz_pregain_volume = core.getVolume();\n\t\t\tcore._ffz_setVolume(1);\n\t\t\tcore.setVolume = core._ffz_fakeVolume;\n\n\t\t} else if ( ! setting && video._ffz_pregain_volume != null ) {\n\t\t\tcore._ffz_setVolume(video._ffz_pregain_volume);\n\t\t\tcore.setVolume = core._ffz_setVolume;\n\t\t\tvideo._ffz_pregain_volume = null;\n\t\t}\n\t}\n\n\tcanCompress(inst) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! HAS_COMPRESSOR )\n\t\t\treturn false;\n\n\t\tconst player = inst.props?.mediaPlayerInstance;\n\t\tif ( player == null )\n\t\t\treturn false;\n\n\t\tconst video = player.mediaSinkManager?.video || player.core?.mediaSinkManager?.video;\n\t\tif ( ! video )\n\t\t\treturn false;\n\n\t\tif ( ! video.src && ! video.srcObject )\n\t\t\treturn false;\n\n\t\tif ( video.src ) {\n\t\t\tconst url = new URL(video.src);\n\t\t\tif ( url.protocol !== 'blob:' )\n\t\t\t\treturn false;\n\t\t}\n\n\t\t// TODO: Validation for srcObject (if we need it)\n\n\t\treturn true;\n\t}\n\n\tcreateCompressor(inst, video, ctx) {\n\t\tif ( ! this.canCompress(inst) )\n\t\t\treturn;\n\n\t\tlet comp = video._ffz_compressor;\n\t\tif ( ! comp ) {\n\t\t\tctx = ctx || new AudioContext();\n\t\t\tif ( ctx.state === 'suspended' ) {\n\t\t\t\tlet timer;\n\t\t\t\tconst evt = () => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\tctx.removeEventListener('statechange', evt);\n\t\t\t\t\tif (ctx.state === 'suspended') {\n\t\t\t\t\t\tthis.log.debug('Aborting due to browser auto-play policy.');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.createCompressor(inst, video, ctx);\n\t\t\t\t}\n\n\t\t\t\tthis.log.debug('Attempting to resume suspended AudioContext.');\n\t\t\t\ttimer = setTimeout(evt, 100);\n\t\t\t\ttry {\n\t\t\t\t\tctx.addEventListener('statechange', evt);\n\t\t\t\t\tctx.resume();\n\t\t\t\t} catch(err) { }\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvideo._ffz_context = ctx;\n\t\t\tlet src;\n\t\t\ttry {\n\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\tthrow new Error();\n\n\t\t\t\tsrc = video._ffz_source = new MediaElementAudioSourceNode(ctx, {\n\t\t\t\t\tmediaElement: video\n\t\t\t\t});\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.info('Unable to use new MediaElementAudioSourceNode. Falling back to old method.');\n\t\t\t\tsrc = video._ffz_source = ctx.createMediaElementSource(video);\n\t\t\t}\n\n\t\t\tsrc.connect(ctx.destination);\n\n\t\t\ttry {\n\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\tthrow new Error();\n\n\t\t\t\tcomp = video._ffz_compressor = new DynamicsCompressorNode(ctx);\n\t\t\t} catch (err) {\n\t\t\t\tthis.log.info('Unable to use new DynamicsCompressorNode. Falling back to old method.');\n\t\t\t\tcomp = video._ffz_compressor = ctx.createDynamicsCompressor();\n\t\t\t}\n\n\t\t\tif ( this.settings.get('player.gain.enable') ) {\n\t\t\t\tlet gain;\n\t\t\t\tlet value = video._ffz_gain_value;\n\t\t\t\tif ( value == null )\n\t\t\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\t\t\ttry {\n\t\t\t\t\tif (this.settings.get('player.compressor.force-legacy'))\n\t\t\t\t\t\tthrow new Error();\n\n\t\t\t\t\tgain = video._ffz_gain = new GainNode(ctx, {\n\t\t\t\t\t\tgain: value\n\t\t\t\t\t});\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.log.info('Unable to use new GainNode. Falling back to old method.');\n\t\t\t\t\tgain = video._ffz_gain = ctx.createGain();\n\t\t\t\t\tgain.gain.value = value;\n\t\t\t\t}\n\n\t\t\t\tcomp.connect(gain);\n\t\t\t}\n\n\t\t\tvideo._ffz_compressed = false;\n\t\t}\n\n\t\tthis.updateCompressor(null, comp);\n\t}\n\n\tupdateGains() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.updateGain(inst);\n\t}\n\n\tupdateGain(inst, gain, video, update_gui = true) {\n\t\tif ( ! video )\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\n\t\tif ( gain == null )\n\t\t\tgain = video?._ffz_gain;\n\n\t\tif ( ! video || ! gain )\n\t\t\treturn;\n\n\t\tlet value = video._ffz_gain_value;\n\t\tif ( value == null )\n\t\t\tvalue = this.settings.get('player.gain.default');\n\n\t\tgain.gain.value = value;\n\t\tif ( update_gui )\n\t\t\tthis.addGainSlider(inst);\n\t}\n\n\tupdateCompressors() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.updateCompressor(inst);\n\t}\n\n\tupdateCompressor(inst, comp) {\n\t\tif ( comp == null ) {\n\t\t\tconst video = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\t\t\tcomp = video?._ffz_compressor;\n\t\t}\n\n\t\tif ( ! comp )\n\t\t\treturn;\n\n\t\tcomp.threshold.value = this.settings.get('player.compressor.threshold');\n\t\tcomp.knee.value = this.settings.get('player.compressor.knee');\n\t\tcomp.ratio.value = this.settings.get('player.compressor.ratio');\n\t\tcomp.attack.value = this.settings.get('player.compressor.attack');\n\t\tcomp.release.value = this.settings.get('player.compressor.release');\n\t}\n\n\tupdatePlaybackRates() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.updatePlaybackRate(inst);\n\t}\n\n\tupdatePlaybackRate(inst) {\n\t\tconst video = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\n\t\tif ( ! video.setFFZPlaybackRate )\n\t\t\tthis.installPlaybackRate(video);\n\n\t\tvideo.setFFZPlaybackRate(video.playbackRate);\n\t}\n\n\tinstallPlaybackRate(video) {\n\t\tif ( video.setFFZPlaybackRate )\n\t\t\treturn;\n\n\t\tlet pbrate = video.playbackRate;\n\n\t\tconst t = this,\n\t\t\tinstallProperty = () => {\n\t\t\t\tif ( t.settings.get('player.allow-catchup') )\n\t\t\t\t\treturn;\n\n\t\t\t\tObject.defineProperty(video, 'playbackRate', {\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tget() {\n\t\t\t\t\t\treturn pbrate;\n\t\t\t\t\t},\n\t\t\t\t\tset(val) {\n\t\t\t\t\t\tif ( val === 1 || val < 1 || val >= 1.1 )\n\t\t\t\t\t\t\tvideo.setFFZPlaybackRate(val);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\tvideo.setFFZPlaybackRate = rate => {\n\t\t\tdelete video.playbackRate;\n\t\t\tpbrate = rate;\n\t\t\tvideo.playbackRate = rate;\n\t\t\tinstallProperty();\n\t\t};\n\t}\n\n\n\taddPiPButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tvideo = inst.props.mediaPlayerInstance?.mediaSinkManager?.video || inst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video,\n\t\t\tis_fs = video && document.fullscreenElement && document.fullscreenElement.contains(video),\n\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS),\n\t\t\thas_pip = document.pictureInPictureEnabled && this.settings.get('player.button.pip');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_pip )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addPiPButton.bind(this, inst, (tries || 0) + 1), 250);\n\n\t\t\treturn; // this.log.warn('Unable to find container element for PiP button.');\n\t\t}\n\n\t\tlet icon, tip, btn, cont = container.querySelector('.ffz--player-pip');\n\t\tif ( ! has_pip ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-pip-button\"\n\t\t\t\t\tonClick={this.pipPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t{icon = (<figure class=\"ffz-player-icon\" />)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tconst thing = container.querySelector('button[data-a-target=\"player-theatre-mode-button\"]') ||\n\t\t\t\t//container.querySelector('div:not(:has(.tw-tooltip)) button:not([data-a-target])') ||\n\t\t\t\tcontainer.querySelector('button[aria-label*=\"Theat\"]') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-fullscreen-button\"]');\n\n\t\t\tif ( thing ) {\n\t\t\t\tcontainer.insertBefore(cont, thing.parentElement);\n\t\t\t} else\n\t\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\ticon = cont.querySelector('figure');\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tconst pip_active = !!document.pictureInPictureElement,\n\t\t\tpip_swap = false, //pip_active && document.pictureInPictureElement !== video,\n\t\t\tlabel = is_fs ?\n\t\t\t\tthis.i18n.t('player.pip_button.fs', 'Cannot use Picture-in-Picture when Fullscreen')\n\t\t\t\t: pip_swap ?\n\t\t\t\t\tthis.i18n.t('player.pip_button.swap', 'Switch Picture-in-Picture')\n\t\t\t\t\t: pip_active ?\n\t\t\t\t\t\tthis.i18n.t('player.pip_button.off', 'Exit Picture-in-Picture')\n\t\t\t\t\t\t: this.i18n.t('player.pip_button', 'Picture-in-Picture');\n\n\t\ticon.classList.toggle('ffz-i-t-pip-inactive', ! pip_active || pip_swap);\n\t\ticon.classList.toggle('ffz-i-t-pip-active', pip_active && ! pip_swap);\n\n\t\tbtn.setAttribute('aria-label', label);\n\t\ttip.textContent = label;\n\t}\n\n\n\tpipPlayer(inst, e) {\n\t\tconst video = inst.props.mediaPlayerInstance?.mediaSinkManager?.video ||\n\t\t\tinst.props.mediaPlayerInstance?.core?.mediaSinkManager?.video;\n\t\tif ( ! video || ! document.pictureInPictureEnabled )\n\t\t\treturn;\n\n\t\tif ( e )\n\t\t\te.preventDefault();\n\n\t\tif ( document.fullscreenElement && document.fullscreenElement.contains(video) )\n\t\t\treturn;\n\n\t\tif ( ! video._ffz_pip_enter ) {\n\t\t\tvideo.addEventListener('enterpictureinpicture', video._ffz_pip_enter = () => {\n\t\t\t\tthis.addPiPButton(inst);\n\t\t\t});\n\n\t\t\tvideo.addEventListener('leavepictureinpicture', video._ffz_pip_exit = () => {\n\t\t\t\tthis.addPiPButton(inst);\n\t\t\t});\n\t\t}\n\n\t\t//const is_this = document.pictureInPictureElement === video;\n\t\tif ( document.pictureInPictureElement )\n\t\t\tdocument.exitPictureInPicture();\n\t\telse\n\t\t//if ( ! is_this )\n\t\t\tvideo.requestPictureInPicture();\n\t}\n\n\taddClipButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS),\n\t\t\thas_clip_button = this.settings.get('player.clip-button.custom');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_clip_button )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addClipButton.bind(this, inst, (tries || 0) + 1), 250);\n\n\t\t\treturn; // this.log.warn('Unable to find container element for Clip button.');\n\t\t}\n\n\t\tlet tip, btn, cont = container.querySelector('.ffz--player-clip');\n\t\tif ( ! has_clip_button ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (! container.ffz_native_clip || ! container.contains(container.ffz_native_clip) )\n\t\t\tcontainer.ffz_native_clip = getNativeClipButton(container);\n\n\t\tif ( ! cont ) {\n\t\t\t// We need the native clip button, so we can dispatch a click.\n\t\t\tconst on_click = e => {\n\t\t\t\tconst native = getNativeClipButton(container);\n\t\t\t\tif (native)\n\t\t\t\t\tnative.click();\n\t\t\t}\n\n\t\t\tcont = (<div class=\"ffz--player-clip tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-clip-button\"\n\t\t\t\t\tonClick={on_click}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-player-icon ffz-i-clip\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tconst thing = container.querySelector('.ffz--player-reset button') ||\n\t\t\t\tcontainer.querySelector('.ffz--player-pip button') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-theatre-mode-button\"]') ||\n\t\t\t\t//container.querySelector('div:not(:has(.tw-tooltip)) button:not([data-a-target])') ||\n\t\t\t\tcontainer.querySelector('button[aria-label*=\"Theat\"]') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-fullscreen-button\"]');\n\n\t\t\tif ( thing ) {\n\t\t\t\tcontainer.insertBefore(cont, thing.parentElement);\n\t\t\t} else\n\t\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tconst native = container.ffz_native_clip,\n\t\t\tdisabled = native\n\t\t\t\t? (native.disabled || native.ariaDisabled === 'true')\n\t\t\t\t: false;\n\n\t\tbtn.disabled = disabled;\n\t\tbtn.setAttribute('aria-label',\n\t\t\ttip.textContent = disabled\n\t\t\t\t? (native.ariaLabel || this.i18n.t(\n\t\t\t\t\t'player.clip-button.disabled',\n\t\t\t\t\t'Clips are Disabled'\n\t\t\t\t))\n\t\t\t\t: this.i18n.t(\n\t\t\t\t\t'player.clip-button',\n\t\t\t\t\t'Clip (Alt+X)'\n\t\t\t\t));\n\t}\n\n\tclickClip(inst, e) {\n\t\tconsole.log('clicked clip', inst, e);\n\t}\n\n\n\taddResetButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS),\n\t\t\thas_reset = this.settings.get('player.button.reset');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_reset )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 5 )\n\t\t\t\treturn setTimeout(this.addResetButton.bind(this, inst, (tries || 0) + 1), 250);\n\n\t\t\treturn; // this.log.warn('Unable to find container element for Reset button.');\n\t\t}\n\n\t\tlet tip, btn, cont = container.querySelector('.ffz--player-reset');\n\t\tif ( ! has_reset ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-reset-button\"\n\t\t\t\t\tonClick={rotateButton}\n\t\t\t\t\tonDblClick={this.resetPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-player-icon ffz-i-t-reset\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tconst thing = container.querySelector('.ffz--player-pip button') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-theatre-mode-button\"]') ||\n\t\t\t\t//container.querySelector('div:not(:has(.tw-tooltip)) button:not([data-a-target])') ||\n\t\t\t\tcontainer.querySelector('button[aria-label*=\"Theat\"]') ||\n\t\t\t\tcontainer.querySelector('button[data-a-target=\"player-fullscreen-button\"]');\n\n\t\t\tif ( thing ) {\n\t\t\t\tcontainer.insertBefore(cont, thing.parentElement);\n\t\t\t} else\n\t\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tbtn.setAttribute('aria-label',\n\t\t\ttip.textContent = this.i18n.t(\n\t\t\t\t'player.reset_button',\n\t\t\t\t'Reset Player (Double-Click)'\n\t\t\t));\n\t}\n\n\n\taddErrorResetButton(inst, tries = 0) {\n\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\tcontainer = outer && outer.querySelector('.content-overlay-gate'),\n\t\t\thas_reset = this.settings.get('player.button.reset');\n\n\t\tif ( ! container ) {\n\t\t\tif ( ! has_reset )\n\t\t\t\treturn;\n\n\t\t\tif ( tries < 2 )\n\t\t\t\tthis.parent.awaitElement(\n\t\t\t\t\t'.autoplay-vod__content-container button',\n\t\t\t\t\tthis.props.containerRef || t.fine.getChildNode(this),\n\t\t\t\t\t1000\n\t\t\t\t).then(() => {\n\t\t\t\t\tthis.addErrorResetButton(inst, (tries || 0) + 1);\n\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.log.warn('Unable to find container element for Error Reset button.');\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet tip, btn, cont = container.querySelector('.ffz--player-reset');\n\t\tif ( ! has_reset ) {\n\t\t\tif ( cont )\n\t\t\t\tcont.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! cont ) {\n\t\t\tcont = (<div class=\"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tdata-a-target=\"ffz-player-reset-button\"\n\t\t\t\t\tonClick={rotateButton}\n\t\t\t\t\tonDblClick={this.resetPlayer.bind(this, inst)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<div class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-player-icon ffz-i-t-reset\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{tip = (<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\" role=\"tooltip\" />)}\n\t\t\t</div>);\n\n\t\t\tcontainer.appendChild(cont);\n\n\t\t} else {\n\t\t\tbtn = cont.querySelector('button');\n\t\t\ttip = cont.querySelector('.ffz-il-tooltip');\n\t\t}\n\n\t\tbtn.setAttribute('aria-label',\n\t\t\ttip.textContent = this.i18n.t(\n\t\t\t\t'player.reset_button',\n\t\t\t\t'Double-Click to Reset Player'\n\t\t\t));\n\t}\n\n\n\tresetAllPlayers() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tthis.resetPlayer(inst);\n\t}\n\n\n\tasync resetPlayer(inst, e) {\n\t\tconst player = inst ? ((inst.mediaSinkManager || inst.core?.mediaSinkManager) ? inst : inst?.props?.mediaPlayerInstance) : null;\n\n\t\tif ( e ) {\n\t\t\te.preventDefault();\n\t\t\tconst target = e.currentTarget,\n\t\t\t\ticon = target && target.querySelector('figure');\n\n\t\t\tif ( icon ) {\n\t\t\t\tif ( icon.classList.contains('loading') )\n\t\t\t\t\treturn;\n\n\t\t\t\ticon.classList.toggle('ffz-i-t-reset', true);\n\t\t\t\ticon.classList.toggle('ffz-i-t-reset-clicked', false);\n\n\t\t\t\ticon.classList.toggle('loading', true);\n\t\t\t\ticon._ffz_unspin = setTimeout(() => {\n\t\t\t\t\ticon._ffz_unspin = null;\n\t\t\t\t\ticon.classList.toggle('loading', false);\n\t\t\t\t}, 10000);\n\t\t\t}\n\t\t}\n\n\t\t// Are we dealing with a VOD?\n\t\tconst duration = player.getDuration?.() ?? Infinity;\n\t\tlet position = -1;\n\n\t\tconst core = player.core || player;\n\t\tif ( core._ffz_setVolume )\n\t\t\tcore.setVolume = core._ffz_setVolume;\n\n\t\tif ( isFinite(duration) && ! isNaN(duration) && duration > 0 )\n\t\t\tposition = player.getPosition();\n\n\t\tconst video = player.mediaSinkManager?.video || player.core?.mediaSinkManager?.video;\n\t\tif ( video?._ffz_compressor && player.attachHTMLVideoElement ) {\n\t\t\tconst new_vid = this.replaceVideoElement(player, video);\n\t\t\tnew_vid._ffz_maybe_compress = true;\n\t\t}\n\n\t\tthis.PlayerSource.check();\n\t\tfor(const inst of this.PlayerSource.instances) {\n\t\t\tif ( ! player || player === inst.props?.mediaPlayerInstance )\n\t\t\t\tawait inst.setSrc({isNewMediaPlayerInstance: false});\n\t\t}\n\n\t\tif ( position > 0 )\n\t\t\tsetTimeout(() => player.seekTo(position), 250);\n\t}\n\n\taddMetadata(inst) {\n\t\tif ( ! this.metadata )\n\t\t\treturn;\n\n\t\tif ( ! inst._ffz_md_update )\n\t\t\tinst._ffz_md_update = debounce(() => requestAnimationFrame(() => this._updateMetadata(inst)), 1000, 2);\n\n\t\tinst._ffz_md_update();\n\t}\n\n\twantsMetadata() { // eslint-disable-line class-methods-use-this\n\t\treturn false;\n\t}\n\n\t_updateMetadata(inst) {\n\t\tif ( inst._ffz_cont && ! document.contains(inst._ffz_cont) )\n\t\t\tinst._ffz_cont = null;\n\n\t\tconst wanted = this.wantsMetadata(inst);\n\n\t\tif ( ! inst._ffz_cont ) {\n\t\t\tif ( ! wanted )\n\t\t\t\treturn;\n\n\t\t\tconst outer = inst.props.containerRef || this.fine.getChildNode(inst),\n\t\t\t\tcontainer = outer && outer.querySelector(RIGHT_CONTROLS);\n\n\t\t\tif ( ! container )\n\t\t\t\treturn;\n\n\t\t\tinst._ffz_cont = (<div class=\"ffz--player-meta-tray\" />);\n\t\t\tcontainer.insertBefore(inst._ffz_cont, container.firstElementChild);\n\t\t}\n\n\t\tif ( ! wanted ) {\n\t\t\tinst._ffz_cont.remove();\n\t\t\tinst._ffz_cont = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateMetadata(inst);\n\t}\n\n\tupdateMetadata(inst, keys) {\n\t\tconst cont = inst._ffz_cont;\n\t\tif ( ! cont || ! document.contains(cont) )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = this.metadata.keys;\n\t\telse if ( ! Array.isArray(keys) )\n\t\t\tkeys = [keys];\n\n\t\tconst source = this.getData(),\n\t\t\tuser = source?.props?.data?.user;\n\n\t\tconst timers = inst._ffz_meta_timers = inst._ffz_meta_timers || {},\n\t\t\trefresh_fn = key => this.updateMetadata(inst, key),\n\t\t\tdata = {\n\t\t\t\tchannel: {\n\t\t\t\t\tid: user?.id,\n\t\t\t\t\tlogin: source?.props?.channelLogin,\n\t\t\t\t\tdisplay_name: user?.displayName,\n\t\t\t\t\tlive: user?.stream?.id != null,\n\t\t\t\t\tlive_since: user?.stream?.createdAt\n\t\t\t\t},\n\t\t\t\tinst,\n\t\t\t\tsource,\n\t\t\t\tgetViewerCount: () => 0,\n\t\t\t\tgetUserSelfImmediate: () => null,\n\t\t\t\tgetUserSelf: () => null,\n\t\t\t\tgetBroadcastID: () => user?.id ? this.getBroadcastID(inst, user.id) : null\n\t\t\t};\n\n\t\tfor(const key of keys)\n\t\t\tthis.metadata.renderPlayer(key, data, cont, timers, refresh_fn);\n\t}\n\n\n\tgetUptime(inst) {\n\t\t// TODO: Support multiple instances.\n\t\tconst source = this.getData(),\n\t\t\tuser = source?.props?.data?.user;\n\n\t\tlet created = user?.stream?.createdAt;\n\n\t\tif ( ! created )\n\t\t\treturn null;\n\n\t\tif ( !(created instanceof Date) )\n\t\t\tcreated = new Date(created);\n\n\t\tconst now = Date.now();\n\n\t\treturn (now - created.getTime()) / 1000;\n\t}\n\n\n\tgetBroadcastID(inst, channel_id) {\n\t\tif ( ! this.twitch_data )\n\t\t\treturn Promise.resolve(null);\n\n\t\tconst cache = inst._ffz_bcast_cache = inst._ffz_bcast_cache || {};\n\t\tif ( channel_id === cache.channel_id ) {\n\t\t\tif ( Date.now() - cache.saved < 60000 )\n\t\t\t\treturn Promise.resolve(cache.broadcast_id);\n\t\t}\n\n\t\treturn new Promise(async (s, f) => {\n\t\t\tif ( cache.updating ) {\n\t\t\t\tcache.updating.push([s, f]);\n\t\t\t\treturn ;\n\t\t\t}\n\n\t\t\tcache.channel_id = channel_id;\n\t\t\tcache.updating = [[s,f]];\n\t\t\tlet id, err;\n\n\t\t\ttry {\n\t\t\t\tid = await this.twitch_data.getBroadcastID(channel_id);\n\t\t\t} catch(error) {\n\t\t\t\tid = null;\n\t\t\t\terr = error;\n\t\t\t}\n\n\t\t\tconst waiters = cache.updating;\n\t\t\tcache.updating = null;\n\n\t\t\tif ( cache.channel_id !== channel_id ) {\n\t\t\t\terr = new Error('Outdated');\n\t\t\t\tcache.channel_id = null;\n\t\t\t\tcache.broadcast_id = null;\n\t\t\t\tcache.saved = 0;\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcache.broadcast_id = id;\n\t\t\tcache.saved = Date.now();\n\n\t\t\tfor(const pair of waiters)\n\t\t\t\terr ? pair[1](err) : pair[0](id);\n\t\t});\n\t}\n\n\n\tget playerUI() {\n\t\tconst container = this.fine.searchTree(this.Player.first, n => n.props && n.props.uiContext, 150);\n\t\treturn container?.props?.uiContext;\n\t}\n\n\tget current() {\n\t\tfor(const inst of this.Player.instances)\n\t\t\tif ( inst?.props?.mediaPlayerInstance )\n\t\t\t\treturn inst.props.mediaPlayerInstance;\n\n\t\treturn null;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// WebMunch\n// It consumes webpack.\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport {has, generateUUID, makeAddonIdChecker} from 'utilities/object';\nimport { DEBUG } from 'utilities/constants';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\t'site.web_munch': WebMunchEvents;\n\t}\n\tinterface ModuleMap {\n\t\t'site.web_munch': WebMunch;\n\t}\n}\n\n\nenum NodeState {\n\t/** Nodes in the Unloaded state have not yet been loaded by webpack. */\n\tUnloaded,\n\t/** Nodes in the Loaded state have been loaded by webpack and we've\n\t * processed them to read dependencies. */\n\tLoaded,\n\t/** Nodes in the Ready state are Loaded, and additionally all their\n\t * dependencies are Ready. The module can be used. */\n\tReady,\n\t/** Nodes in the Used state have been used. */\n\tUsed\n}\n\n\ntype GraphNode = {\n\tid: string;\n\tstate: NodeState;\n\t/** A set of nodes that this node depends on. This may be `false` if the\n\t * node's dependencies have been checked and it has none, or `null` if the\n\t * node's dependencies have not yet been checked. */\n\trequires: Set<string> | false | null;\n\t/** A set of nodes that depend on this node. This may be `null` if no\n\t * nodes have been found that depend on this node yet. */\n\tdependants: Set<string> | null;\n}\n\n\nexport type WebMunchEvents = {\n\t/** This event is fired whenever new modules were marked Ready. */\n\t':new-ready': [ids: Set<string>]\n};\n\nexport type Predicate = ((n: unknown) => boolean) & {\n\tchunks?: string | string[];\n\tuse_result?: boolean;\n};\n\nexport type DeepPredicate = (n: unknown, mod: unknown, key: string | Symbol) => boolean;\n\n\ntype WebpackStoreV4 = WebpackLoaderDataV4[] & {\n\tpush: WebpackLoaderV4;\n};\n\ntype WebpackModuleLoaderV4 = ((module: unknown, exports: unknown, __webpack_require__: WebpackRequireV4) => unknown);\ntype WebpackLoaderFuncV4 = (require: WebpackRequireV4) => void;\n\ntype WebpackLoaderDataV4 = [\n\tchunk_ids: (number | string)[],\n\tmodules: Record<string, WebpackModuleLoaderV4>,\n\tfn?: WebpackLoaderFuncV4\n];\ntype WebpackLoaderV4 = (data: WebpackLoaderDataV4, ...args: unknown[]) => unknown;\n\ntype WebpackRequireV4 = {\n\t<T = unknown>(id: string): T;\n\tm?: Record<string, WebpackModuleLoaderV4>;\n\tu?: (id: string) => string;\n};\n\n\nconst regex_cache: Record<string, RegExp> = {};\n\nfunction getRequireRegex(name: string) {\n\tif ( ! regex_cache[name] )\n\t\treturn regex_cache[name] = new RegExp(`\\\\b(?<!\\\\.)${name}\\\\(([0-9e_+]+)\\\\)`, 'g');\n\treturn regex_cache[name];\n}\n\nconst NAMES = [\n\t'webpackJsonp',\n\t'webpackChunktwitch_twilight',\n\t'webpackChunktwitch_sunlight',\n\t'webpackJsonp_N_E'\n];\n\nconst HARD_MODULES = [\n\t[0, 'vendor'],\n\t[1, 'core']\n];\n\n\n/**\n * Compute the strongly connected components (SCCs) among a set of candidate nodes\n * using Tarjan's algorithm. The graph is defined over the _graph property and an edge\n * exists from node A to node B if A.requires (a Set) contains B.\n *\n * @param node_ids Array of module IDs (candidates) to run the algorithm on.\n * @returns An array of SCCs (each SCC is an array of module IDs).\n */\nfunction computeSCC(graph: Record<string, GraphNode>, node_ids: Set<string>): string[][] {\n\tlet index = 0;\n\tconst indices: Record<string, number> = {};\n\tconst lowlinks: Record<string, number> = {};\n\tconst stack: string[] = [];\n\tconst onStack: Record<string, boolean> = {};\n\tconst result: string[][] = [];\n\n\tfunction strongconnect(v: string) {\n\t\tindices[v] = index;\n\t\tlowlinks[v] = index;\n\t\tindex++;\n\t\tstack.push(v);\n\t\tonStack[v] = true;\n\n\t\t// Consider each dependency of v.\n\t\tconst node = graph[v];\n\t\tif (node.requires) {\n\t\t\tfor (const w of node.requires) {\n\t\t\t\t// Only consider w if it is among the candidates.\n\t\t\t\tif (!node_ids.has(w)) continue;\n\t\t\t\tif (indices[w] === undefined) {\n\t\t\t\t\t// w has not been visited; do so.\n\t\t\t\t\tstrongconnect(w);\n\t\t\t\t\tlowlinks[v] = Math.min(lowlinks[v], lowlinks[w]);\n\t\t\t\t} else if (onStack[w]) {\n\t\t\t\t\tlowlinks[v] = Math.min(lowlinks[v], indices[w]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If v is a root node, pop the stack and generate an SCC.\n\t\tif (lowlinks[v] === indices[v]) {\n\t\t\tconst scc: string[] = [];\n\t\t\tlet w: string;\n\t\t\tdo {\n\t\t\t\tw = stack.pop()!;\n\t\t\t\tonStack[w] = false;\n\t\t\t\tscc.push(w);\n\t\t\t} while (w !== v);\n\t\t\tresult.push(scc);\n\t\t}\n\t}\n\n\t// Run strongconnect for every candidate node.\n\tfor (const v of node_ids) {\n\t\tif (indices[v] === undefined) {\n\t\t\tstrongconnect(v);\n\t\t}\n\t}\n\treturn result;\n}\n\n\n\nexport default class WebMunch extends Module<'site.web_munch', WebMunchEvents> {\n\n\t_original_store?: WebpackStoreV4 | null;\n\t_original_loader?: WebpackLoaderV4 | null;\n\t_require: WebpackRequireV4 | null;\n\t_chunk_names: Record<string, string>;\n\n\t_known_rules: Record<string, Predicate>;\n\t_mod_cache: Record<string, unknown>;\n\n\t_loaded_ids: Set<string>;\n\t_pending_ready_ids: Set<string>;\n\n\t_graph: Record<string, GraphNode>;\n\t_graph_update_raf?: ReturnType<typeof requestAnimationFrame> | null;\n\n\t_processed_all?: boolean;\n\n\t_require_waiter?: Promise<WebpackRequireV4> | null;\n\t_load_waiter?: Promise<WebpackLoaderV4> | null;\n\t_load_wait_fns?: null | [(value: WebpackLoaderV4) => void, (reason?: any) => void];\n\n\tstart_time: number;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis._processGraph = this._processGraph.bind(this);\n\n\t\tthis.start_time = performance.now();\n\n\t\tthis._known_rules = {};\n\t\tthis._mod_cache = {};\n\n\t\tthis._require = null;\n\t\tthis._chunk_names = {};\n\n\t\tthis._pending_ready_ids = new Set;\n\t\tthis._loaded_ids = new Set;\n\t\tthis._graph = {};\n\n\t\tthis.hookLoader();\n\t\tthis.getRequire();\n\t}\n\n\n\t// ========================================================================\n\t// Grabbing Webpack\n\t// ========================================================================\n\n\twaitForLoader() {\n\t\tif ( this._original_loader )\n\t\t\treturn Promise.resolve(this._original_loader);\n\n\t\tif ( ! this._load_waiter )\n\t\t\tthis._load_waiter = new Promise<WebpackLoaderV4>((s,f) => {\n\t\t\t\tthis._load_wait_fns = [s,f];\n\t\t\t});\n\n\t\treturn this._load_waiter;\n\t}\n\n\t_resolveLoadWait(result?: WebpackLoaderV4 | null) {\n\t\tconst fns = this._load_wait_fns;\n\n\t\tthis._load_waiter = null;\n\t\tthis._load_wait_fns = null;\n\n\t\tif (fns)\n\t\t\tresult ? fns[0](result) : fns[1]();\n\t}\n\n\thookLoader(attempts = 0) {\n\t\tif ( this._original_loader ) {\n\t\t\tthis.log.warn('Attempted to call hookLoader twice.');\n\t\t\treturn;\n\t\t}\n\n\t\tlet name: string | null = null;\n\t\tfor(const n of NAMES)\n\t\t\tif ( (window as any)[n] ) {\n\t\t\t\tname = n;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\tif ( ! name ) {\n\t\t\tif ( attempts > 240 ) {\n\t\t\t\tthis.log.error(\"Unable to find webpack's loader after one minute.\");\n\n\t\t\t\ttry {\n\t\t\t\t\tconst possibilities = [];\n\t\t\t\t\tfor(const key of Object.keys(window))\n\t\t\t\t\t\tif ( has(window, key) && typeof key === 'string' && /webpack/i.test(key) && ! /ffz/i.test(key) )\n\t\t\t\t\t\t\tpossibilities.push(key);\n\n\t\t\t\t\tif ( possibilities.length )\n\t\t\t\t\t\tthis.log.info('Possible Matches: ', possibilities.join(', '));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.log.info('No possible matches found.');\n\n\t\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\t\tthis._resolveLoadWait();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetTimeout(this.hookLoader.bind(this, attempts + 1), 250);\n\t\t\treturn;\n\t\t}\n\n\t\tconst thing = (window as any)[name] as unknown;\n\n\t\tif ( Array.isArray(thing) ) {\n\t\t\tthis._original_store = thing as WebpackStoreV4;\n\t\t\tthis._original_loader = thing.push;\n\n\t\t\tthis._processAllModules();\n\n\t\t\ttry {\n\t\t\t\t(thing as any).push = this.webpackJsonpv4.bind(this);\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn('Unable to wrap webpackJsonp due to write protection.');\n\t\t\t\tthis._resolveLoadWait();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.log.error('webpackJsonp is of an unknown value. Unable to wrap.');\n\t\t\tthis._resolveLoadWait();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._resolveLoadWait(this._original_loader);\n\n\t\tconst end = performance.now();\n\t\tthis.log.info(`Hooked webpack loader after ${Math.round(100*(end - this.start_time))/100}ms`);\n\t}\n\n\n\twebpackJsonpv4(data: WebpackLoaderDataV4, ...args: unknown[]) {\n\t\tconst chunk_ids = data[0].map(x => typeof x !== 'string' ? `${x}` : x),\n\t\t\tmodules = data[1],\n\t\t\tnames = Array.isArray(chunk_ids)\n\t\t\t\t? chunk_ids.map(x => this._chunk_names[x] ?? x)\n\t\t\t\t: null;\n\n\t\tthis.log.verbose(`Twitch Chunk Loaded: ${chunk_ids} (${names?.join(', ')})`);\n\t\tthis.log.verbose(`Modules: ${Object.keys(modules)}`);\n\n\t\tconst res = this._original_loader!.call(this._original_store, data, ...args); // eslint-disable-line prefer-rest-params\n\n\t\t//this.emit(':chunk-loaded', chunk_ids, names, modules);\n\n\t\tif ( modules )\n\t\t\tthis._processModulesV4(modules);\n\n\t\treturn res;\n\t}\n\n\n\t// ========================================================================\n\t// Grabbing Require\n\t// ========================================================================\n\n\tgetRequire(): Promise<WebpackRequireV4> {\n\t\tif ( this._require )\n\t\t\treturn Promise.resolve(this._require);\n\n\t\tif ( ! this._require_waiter )\n\t\t\tthis._require_waiter = new Promise<WebpackRequireV4>(async (resolve, reject) => {\n\t\t\t\tlet fn = await this.waitForLoader();\n\t\t\t\tfn = fn.bind(this._original_store);\n\n\t\t\t\t// Inject a fake module and use that to grab require.\n\t\t\t\tconst id = `ffz-loader$${generateUUID()}`;\n\t\t\t\tfn([\n\t\t\t\t\t[id],\n\t\t\t\t\t{\n\t\t\t\t\t\t[id]: (module, exports, __webpack_require__) => {\n\t\t\t\t\t\t\tthis._require = __webpack_require__;\n\t\t\t\t\t\t\tthis._loadChunkNames();\n\t\t\t\t\t\t\tresolve(this._require);\n\t\t\t\t\t\t\tconst end = performance.now();\n\t\t\t\t\t\t\tthis.log.info(`Hooked webpack require after ${Math.round(100*(end - this.start_time))/100}ms`);\n\t\t\t\t\t\t\tthis._processAllModules();\n\t\t\t\t\t\t\tthis._require_waiter = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t(req: WebpackRequireV4) => req(id)\n\t\t\t\t]);\n\t\t\t});\n\n\t\treturn this._require_waiter;\n\t}\n\n\tprivate _loadChunkNames() {\n\t\tlet modules: Record<string, string> | null = null;\n\t\tif ( this._require?.u ) {\n\t\t\tconst builder = this._require.u.toString(),\n\t\t\t\tmatch = /assets\\/\"\\+\\(?({\\d+:.*?})/.exec(builder),\n\t\t\t\tdata = match ? match[1].replace(/([\\de]+):/g, (_, m) => {\n\t\t\t\t\tif ( /^\\d+e\\d+$/.test(m) ) {\n\t\t\t\t\t\tconst bits = m.split('e');\n\t\t\t\t\t\tm = parseInt(bits[0], 10) * (10 ** parseInt(bits[1], 10));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn `\"${m}\":`;\n\t\t\t\t}) : null;\n\n\t\t\tif ( data )\n\t\t\t\ttry {\n\t\t\t\t\tmodules = JSON.parse(data);\n\t\t\t\t} catch(err) { console.log(data); console.log(err) /* no-op */ }\n\t\t}\n\n\t\tif ( modules ) {\n\t\t\tthis._chunk_names = modules;\n\t\t\tthis.log.debug(`Loaded names for ${Object.keys(modules).length} chunks from require().`)\n\t\t} else\n\t\t\tthis.log.warn(`Unable to find chunk names in require().`);\n\t}\n\n\n\t// ========================================================================\n\t// Node Graph Processing\n\t// ========================================================================\n\n\tprivate _getNode(id: string) {\n\t\tlet out = this._graph[id];\n\t\tif (! out )\n\t\t\tout = this._graph[id] = {\n\t\t\t\tid,\n\t\t\t\tstate: NodeState.Unloaded,\n\t\t\t\trequires: null,\n\t\t\t\tdependants: null\n\t\t\t};\n\n\t\treturn out;\n\t}\n\n\n\tprivate _processAllModules() {\n\t\tif ( ! this._require?.m || ! this._original_store || this._processed_all )\n\t\t\treturn;\n\n\t\tthis._processed_all = true;\n\n\t\tfor(const chunk of this._original_store)\n\t\t\tif ( chunk && chunk[1] )\n\t\t\t\tthis._processModulesV4(chunk[1]);\n\t}\n\n\t/**\n\t * Process newly loaded modules, updating their graph nodes\n\t * and potentially triggering graph rebuilds via _processGraph.\n\t * @param modules An object containing freshly loaded modules to process.\n\t * @param newly_ready A list of ids of newly ready modules, for adding onto.\n\t * @returns A list of ids of modules that are now ready\n\t */\n\tprivate _processModulesV4(modules: Record<string, Function>) {\n\t\tconst require = this._require;\n\t\tlet need_graph = false;\n\n\t\tfor(const mod_id of Object.keys(modules)) {\n\t\t\tconst node = this._getNode(mod_id),\n\t\t\t\tfn = require?.m?.[mod_id];\n\n\t\t\tif (node.state !== NodeState.Unloaded || ! fn)\n\t\t\t\tcontinue;\n\n\t\t\tnode.state = NodeState.Loaded;\n\t\t\tthis._loaded_ids.add(mod_id);\n\n\t\t\tif (node.requires == null)\n\t\t\t\tthis._detectRequirements(node, fn);\n\n\t\t\tif (node.requires === false) {\n\t\t\t\tnode.state = NodeState.Ready;\n\t\t\t\tthis._loaded_ids.delete(mod_id);\n\t\t\t\tthis._pending_ready_ids.add(mod_id);\n\t\t\t}\n\n\t\t\t// Mark any nodes that depend on this node as dirty\n\t\t\t// so we can reprocess that section of the graph.\n\t\t\tif (node.dependants && node.dependants.size > 0)\n\t\t\t\tneed_graph = true;\n\t\t}\n\n\t\t// Schedule a graph update, maybe.\n\t\tif (need_graph || this._pending_ready_ids.size > 0)\n\t\t\tthis.scheduleGraphUpdate();\n\t}\n\n\n\tprivate _detectRequirements(node: GraphNode, fn: WebpackModuleLoaderV4) {\n\t\tconst str = fn.toString(),\n\t\t\tname_match = /^function\\([^,)]+,[^,)]+,([^,)]+)/.exec(str);\n\n\t\tif ( name_match ) {\n\t\t\tconst regex = getRequireRegex(name_match[1]);\n\t\t\tconst reqs = new Set<string>;\n\n\t\t\tregex.lastIndex = 0;\n\t\t\tlet match;\n\n\t\t\t// Here, we check all the modules this module depends on\n\t\t\t// so that we don't require a module with missing requirements\n\t\t\t// because webpack sucks.\n\t\t\twhile((match = regex.exec(str))) {\n\t\t\t\tlet mod_id = match[1];\n\t\t\t\tif ( mod_id === 'e' )\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// Modules are all numbers, but some are written in e notation.\n\t\t\t\t// We need to correct that for string comparison.\n\t\t\t\tif ( /^\\d+e\\d+$/.test(mod_id) ) {\n\t\t\t\t\tconst bits = mod_id.split('e');\n\t\t\t\t\tmod_id = `${parseInt(bits[0], 10) * (10 ** parseInt(bits[1], 10))}`;\n\t\t\t\t}\n\n\t\t\t\treqs.add(mod_id);\n\n\t\t\t\t// Two way relationship\n\t\t\t\tconst other = this._getNode(mod_id);\n\t\t\t\tother.dependants ??= new Set;\n\t\t\t\tother.dependants.add(node.id);\n\t\t\t}\n\n\t\t\tnode.requires = reqs.size > 0 ? reqs : false;\n\n\t\t} else\n\t\t\tnode.requires = false;\n\t}\n\n\tscheduleGraphUpdate() {\n\t\tif ( ! this._graph_update_raf)\n\t\t\tthis._graph_update_raf = requestAnimationFrame(this._processGraph);\n\t}\n\n\n\t/**\n\t * Process the dependency graph for any nodes that are in the Loaded state\n\t * and may now be marked as Ready. To handle cycles, we group nodes into\n\t * strongly connected components and mark an entire SCC as Ready if every\n\t * external dependency is already Ready or Used.\n\t * @param newly_ready An array to collect module ids that are marked Ready\n\t * @returns The updated list of module ids that are now ready.\n\t */\n\tprivate _processGraph() {\n\t\tthis._graph_update_raf = null;\n\n\t\tconst start = performance.now();\n\t\tconst count = this._pending_ready_ids.size;\n\n\t\t// Iterate until no further nodes have become Ready.\n\t\tlet changed = true;\n\t\twhile(changed) {\n\t\t\tchanged = false;\n\n\t\t\t// Determine our candidates.\n\t\t\tif (this._loaded_ids.size === 0)\n\t\t\t\tbreak;\n\n\t\t\t// Compute strongly connected components among the candidates.\n\t\t\tconst sccs = computeSCC(this._graph, this._loaded_ids);\n\t\t\tfor(const scc of sccs) {\n\t\t\t\tif (scc.length === 0)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// Check if each node in the SCC has all external dependencies Ready/Used.\n\t\t\t\tlet eligible = true;\n\n\t\t\t\tfor(const mod_id of scc) {\n\t\t\t\t\tconst node = this._graph[mod_id];\n\t\t\t\t\tif (node.requires)\n\t\t\t\t\t\tfor(const req_id of node.requires) {\n\t\t\t\t\t\t\t// Ignore other modules that are part of this SCC.\n\t\t\t\t\t\t\tif (scc.includes(req_id))\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tconst req_node = this._graph[req_id];\n\t\t\t\t\t\t\tif (!req_node || (req_node.state !== NodeState.Ready && req_node.state !== NodeState.Used)) {\n\t\t\t\t\t\t\t\teligible = false;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\tif (!eligible)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// If the entire SCC is eligible, mark every node in it as Ready.\n\t\t\t\tif (eligible) {\n\t\t\t\t\tchanged = true;\n\n\t\t\t\t\tfor(const mod_id of scc) {\n\t\t\t\t\t\tconst node = this._graph[mod_id];\n\t\t\t\t\t\tif (node.state === NodeState.Loaded) {\n\t\t\t\t\t\t\tnode.state = NodeState.Ready;\n\t\t\t\t\t\t\tthis._loaded_ids.delete(mod_id);\n\t\t\t\t\t\t\tthis._pending_ready_ids.add(mod_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst end = performance.now();\n\t\tthis.log.debug(`Processed graph in ${Math.round(100*(end-start))/100}ms, found ${this._pending_ready_ids.size - count} newly ready modules. There are ${this._loaded_ids.size} remaining Loaded modules.`);\n\n\t\t// TODO: Check for modules we're waiting for but only in the newly ready modules.\n\n\t\tif ( this._pending_ready_ids.size ) {\n\t\t\tconst ready_ids = this._pending_ready_ids;\n\t\t\tthis._pending_ready_ids = new Set;\n\t\t\tthis.emit(':new-ready', ready_ids);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Finding Modules\n\t// ========================================================================\n\n\tknown(key: string, predicate: Predicate) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const k of Object.keys(key))\n\t\t\t\tthis.known(k, key[k]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._known_rules[key] = predicate;\n\t}\n\n\n\tasync findModule<T = unknown>(key: string, predicate?: Predicate) {\n\t\tif ( ! this._require )\n\t\t\tawait this.getRequire();\n\n\t\treturn this.getModule<T>(key, predicate);\n\t}\n\n\n\tfindDeep(chunks: string | string[] | null, predicate: DeepPredicate, multi = true) {\n\t\tif ( chunks && ! Array.isArray(chunks) )\n\t\t\tchunks = [chunks];\n\n\t\tif ( ! this._require || ! this._original_store )\n\t\t\tthrow new Error('We do not have webpack');\n\n\t\tconst out: unknown[] = [],\n\t\t\tnames = this._chunk_names;\n\t\tfor(const [cs, modules] of this._original_store) {\n\t\t\t/*if ( chunks ) {\n\t\t\t\tlet matched = false;\n\t\t\t\tfor(const c of cs) {\n\t\t\t\t\tif ( chunks.includes(c) || chunks.includes(`${c}`) || (names[c] && chunks.includes(names[c])) ) {\n\t\t\t\t\t\tmatched = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( ! matched )\n\t\t\t\t\tcontinue;\n\t\t\t}*/\n\n\t\t\tfor(const id of Object.keys(modules)) {\n\t\t\t\tconst node = this._getNode(id);\n\t\t\t\tif (node.state !== NodeState.Ready && node.state !== NodeState.Used)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.state = NodeState.Used;\n\t\t\t\t\tconst mod = this._require(id);\n\t\t\t\t\tif (mod)\n\t\t\t\t\t\tfor(const [key, val] of Object.entries(mod))\n\t\t\t\t\t\t\tif ( val && predicate(val, mod, key) ) {\n\t\t\t\t\t\t\t\tthis.log.info(`Found in key \"${key}\" of module \"${id}\" (${this.chunkNameForModule(id)})`);\n\t\t\t\t\t\t\t\tif ( ! multi )\n\t\t\t\t\t\t\t\t\treturn mod;\n\t\t\t\t\t\t\t\tout.push(mod);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.log.warn('Exception while deep scanning webpack.', err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( out.length )\n\t\t\treturn out;\n\n\t\tthis.log.info('Unable to find deep scan target.');\n\t\treturn null;\n\t}\n\n\n\tgetModule<T = unknown>(key: string | null, predicate?: Predicate) {\n\t\tif ( typeof key === 'function' ) {\n\t\t\tpredicate = key;\n\t\t\tkey = null;\n\t\t}\n\n\t\tif ( key && this._mod_cache[key] )\n\t\t\treturn this._mod_cache[key] as T;\n\n\t\tif ( ! predicate && key )\n\t\t\tpredicate = this._known_rules[key];\n\n\t\tif ( ! predicate )\n\t\t\tthrow new Error(`no known predicate for locating ${key}`);\n\n\t\tconst require = this._require;\n\t\tif ( require?.m )\n\t\t\treturn this._newGetModule(key, predicate, require) as T;\n\n\t\treturn null;\n\t}\n\n\t_chunksForModule(id: string) {\n\t\tif ( ! this._original_store )\n\t\t\treturn null;\n\n\t\tconst out = new Set<number | string>;\n\n\t\tfor(const [chunks, modules] of this._original_store) {\n\t\t\tif ( modules[id] ) {\n\t\t\t\tfor(const chunk of chunks)\n\t\t\t\t\tout.add(chunk);\n\t\t\t}\n\t\t}\n\n\t\treturn [...out];\n\t}\n\n\tchunkNameForModule(id: string) {\n\t\tconst chunks = this._chunksForModule(id);\n\t\tif ( ! chunks )\n\t\t\treturn null;\n\n\t\tfor(const chunk of chunks) {\n\t\t\tconst name = this._chunk_names[chunk];\n\t\t\tif ( name )\n\t\t\t\treturn name;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tchunkNamesForModule(id: string) {\n\t\tconst chunks = this._chunksForModule(id);\n\t\tif ( ! chunks )\n\t\t\treturn null;\n\n\t\treturn chunks.map(id => this._chunk_names[id] || id);\n\t}\n\n\n\t_newGetModule(key: string | null, predicate: Predicate, require: WebpackRequireV4) {\n\t\tif ( ! require )\n\t\t\treturn null;\n\n\t\tlet ids: Set<string>;\n\t\tif ( this._original_store && predicate.chunks && this._chunk_names && Object.keys(this._chunk_names).length ) {\n\t\t\tconst chunk_pred = typeof predicate.chunks === 'function';\n\t\t\tif ( ! chunk_pred && ! Array.isArray(predicate.chunks) )\n\t\t\t\tpredicate.chunks = [predicate.chunks];\n\n\t\t\tconst chunks = predicate.chunks,\n\t\t\t\tnames = this._chunk_names;\n\n\t\t\tlet id_list: string[] = [];\n\t\t\tfor(const [cs, modules] of this._original_store) {\n\t\t\t\tlet matched = false;\n\t\t\t\tfor(const c of cs) {\n\t\t\t\t\tif ( chunk_pred ? chunks(names[c], c) : (chunks.includes(c) || chunks.includes(String(c)) || (names[c] && chunks.includes(names[c]))) ) {\n\t\t\t\t\t\tmatched = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( matched )\n\t\t\t\t\tid_list = [...id_list, ...Object.keys(modules)];\n\t\t\t}\n\n\t\t\tids = new Set(id_list);\n\t\t} else\n\t\t\tids = new Set(Object.keys(this._graph));\n\n\t\tlet checked = 0;\n\t\tfor(const id of ids) {\n\t\t\t//let check;\n\t\t\ttry {\n\t\t\t\tchecked++;\n\n\t\t\t\t// Ensure the node is in a valid state for requiring it.\n\t\t\t\tconst node = this._getNode(id);\n\t\t\t\tif ( node.state !== NodeState.Ready && node.state !== NodeState.Used )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tnode.state = NodeState.Used;\n\t\t\t\tconst mod = require(id);\n\t\t\t\tif ( mod ) {\n\t\t\t\t\tconst ret = predicate(mod);\n\t\t\t\t\tif ( ret ) {\n\t\t\t\t\t\tthis.log.debug(`Located module \"${key}\" in module ${id}${DEBUG ? ` (${this.chunkNameForModule(id)})` : ''} after ${checked} tries`);\n\t\t\t\t\t\tconst out = predicate.use_result ? ret : mod;\n\t\t\t\t\t\tif ( key )\n\t\t\t\t\t\t\tthis._mod_cache[key] = out;\n\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn(`Unexpected error trying to find module '${id}':`, err);\n\t\t\t}\n\t\t}\n\n\t\tthis.log.debug(`Unable to locate module \"${key}\" despite checking ${checked} modules`);\n\t\treturn null;\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Elemental\n// It finds elements.\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport Module, { GenericModule } from 'utilities/module';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\t'site.elemental': Elemental;\n\t}\n}\n\nexport default class Elemental extends Module<'site.elemental'> {\n\n\tprivate _wrappers: Map<string, ElementalWrapper<any>>;\n\tprivate _observer: MutationObserver | null;\n\tprivate _watching: Set<ElementalWrapper<any>>;\n\tprivate _live_watching: ElementalWrapper<any>[] | null;\n\tprivate _route?: string | null;\n\tprivate _timer?: number | null;\n\n\tprivate _timeout?: ReturnType<typeof setTimeout> | null;\n\tprivate _clean_timeout?: ReturnType<typeof setTimeout> | null;\n\tprivate _clean_all?: ReturnType<typeof requestAnimationFrame> | null;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis._pruneLive = this._pruneLive.bind(this);\n\n\t\tthis._wrappers = new Map;\n\n\t\tthis._observer = null;\n\t\tthis._watching = new Set;\n\t\tthis._live_watching = null;\n\n\t\tthis.scheduleCleaning();\n\t}\n\n\t/** @internal */\n\tonDisable() {\n\t\tthis._stopWatching();\n\t}\n\n\n\tdefine<TElement extends HTMLElement = HTMLElement>(\n\t\tkey: string,\n\t\tselector: string,\n\t\troutes?: string[] | false | null,\n\t\topts: MutationObserverInit | null = null,\n\t\tlimit = 0,\n\t\ttimeout = 5000,\n\t\tremove = true\n\t) {\n\t\tif ( this._wrappers.has(key) )\n\t\t\treturn this._wrappers.get(key) as ElementalWrapper<TElement>;\n\n\t\tif ( ! selector || typeof selector !== 'string' || ! selector.length )\n\t\t\tthrow new Error('cannot find definition and no selector provided');\n\n\t\tconst wrapper = new ElementalWrapper<TElement>(key, selector, routes, opts, limit, timeout, remove, this);\n\t\tthis._wrappers.set(key, wrapper);\n\n\t\treturn wrapper;\n\t}\n\n\n\troute(route: string | null) {\n\t\tthis._route = route;\n\t\tthis._timer = Date.now();\n\t\tthis._updateLiveWatching();\n\t\tthis.checkAll();\n\t\tthis.cleanAll();\n\t}\n\n\tscheduleCleaning() {\n\t\tif ( this._clean_timeout )\n\t\t\tclearTimeout(this._clean_timeout);\n\n\t\tthis._clean_timeout = setTimeout(() => {\n\t\t\tthis._clean_timeout = null;\n\t\t\tthis.cleanAll();\n\t\t\tthis.scheduleCleaning();\n\t\t}, 1000);\n\t}\n\n\tcleanAll() {\n\t\tif ( this._clean_all )\n\t\t\tcancelAnimationFrame(this._clean_all);\n\n\t\tthis._clean_all = requestAnimationFrame(() => {\n\t\t\tthis._clean_all = null;\n\t\t\tfor(const wrapper of this._wrappers.values())\n\t\t\t\twrapper.clean();\n\t\t});\n\t}\n\n\n\tcheckAll() {\n\t\tif ( this._watching )\n\t\t\tfor(const watcher of this._watching)\n\t\t\t\twatcher.check();\n\t}\n\n\n\tupdateTimeout() {\n\t\tthis._timer = Date.now();\n\t\tthis._updateLiveWatching();\n\t\tthis.checkAll();\n\t}\n\n\n\tprivate _isActive(watcher: ElementalWrapper<any>, now: number) {\n\t\tif ( watcher.routes === false )\n\t\t\treturn false;\n\n\t\tif ( this._route && watcher.routes.length && ! watcher.routes.includes(this._route) )\n\t\t\treturn false;\n\n\t\tif ( watcher.timeout > 0 && (now - (this._timer as number)) > watcher.timeout )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate _updateLiveWatching() {\n\t\tif ( this._timeout ) {\n\t\t\tclearTimeout(this._timeout);\n\t\t\tthis._timeout = null;\n\t\t}\n\n\t\tconst lw: ElementalWrapper<any>[] = this._live_watching = [],\n\t\t\tnow = Date.now();\n\t\tlet min_timeout = Number.POSITIVE_INFINITY;\n\n\t\tif ( this._watching )\n\t\t\tfor(const watcher of this._watching)\n\t\t\t\tif ( this._isActive(watcher, now) ) {\n\t\t\t\t\tif ( watcher.timeout > 0 && watcher.timeout < min_timeout )\n\t\t\t\t\t\tmin_timeout = watcher.timeout;\n\n\t\t\t\t\tlw.push(watcher);\n\t\t\t\t}\n\n\t\tif ( isFinite(min_timeout) )\n\t\t\tthis._timeout = setTimeout(this._pruneLive, min_timeout);\n\n\t\tif ( ! lw.length )\n\t\t\tthis._stopWatching();\n\t\telse if ( ! this._observer )\n\t\t\tthis._startWatching();\n\t}\n\n\tprivate _pruneLive() {\n\t\tthis._updateLiveWatching();\n\t}\n\n\tprivate _checkWatchers(muts: Node[]) {\n\t\tif ( this._live_watching )\n\t\t\tfor(const watcher of this._live_watching)\n\t\t\t\twatcher.checkElements(muts as Element[]);\n\t}\n\n\tprivate _startWatching() {\n\t\tif ( ! this._observer && this._live_watching && this._live_watching.length ) {\n\t\t\tthis.log.info('Installing MutationObserver.');\n\n\t\t\tthis._observer = new MutationObserver(mutations => this._checkWatchers(mutations.map(x => x.target)));\n\t\t\tthis._observer.observe(document.body, {\n\t\t\t\tchildList: true,\n\t\t\t\tsubtree: true\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _stopWatching() {\n\t\tif ( this._observer ) {\n\t\t\tthis.log.info('Stopping MutationObserver.');\n\t\t\tthis._observer.disconnect();\n\t\t}\n\n\t\tif ( this._timeout ) {\n\t\t\tclearTimeout(this._timeout);\n\t\t\tthis._timeout = null;\n\t\t}\n\n\t\tthis._live_watching = null;\n\t\tthis._observer = null;\n\t}\n\n\n\tlisten(inst: ElementalWrapper<any>, ensure_live = true) {\n\t\tif ( this._watching.has(inst) || ! ensure_live )\n\t\t\treturn;\n\n\t\tif ( ensure_live )\n\t\t\tthis._timer = Date.now();\n\n\t\tthis._watching.add(inst);\n\t\tthis._updateLiveWatching();\n\t}\n\n\tunlisten(inst: ElementalWrapper<any>) {\n\t\tif ( ! this._watching.has(inst) )\n\t\t\treturn;\n\n\t\tthis._watching.delete(inst);\n\t\tthis._updateLiveWatching();\n\t}\n}\n\n\nlet elemental_id = 0;\n\ntype ElementalParam = `_ffz$elemental$${number}`;\ntype ElementalRemoveParam = `_ffz$elemental_remove$${number}`;\n\ndeclare global {\n\tinterface HTMLElement {\n\t\t[key: ElementalParam]: MutationObserver | null;\n\t\t[key: ElementalRemoveParam]: MutationObserver | null;\n\t}\n}\n\ntype ElementalWrapperEvents<TElement extends HTMLElement> = {\n\tmount: [element: TElement];\n\tunmount: [element: TElement];\n\tmutate: [element: TElement, mutations: MutationRecord[]];\n}\n\nexport class ElementalWrapper<\n\tTElement extends HTMLElement = HTMLElement\n> extends EventEmitter<ElementalWrapperEvents<TElement>> {\n\n\treadonly id: number;\n\treadonly name: string;\n\treadonly selector: string;\n\treadonly routes: string[] | false;\n\treadonly opts: MutationObserverInit | null;\n\treadonly limit: number;\n\treadonly timeout: number;\n\treadonly check_removal: boolean;\n\tcount: number;\n\treadonly instances: Set<TElement>;\n\treadonly elemental: Elemental;\n\n\treadonly param: ElementalParam;\n\treadonly remove_param: ElementalRemoveParam;\n\n\tprivate _stimer?: ReturnType<typeof setTimeout> | null;\n\n\tconstructor(\n\t\tname: string,\n\t\tselector: string,\n\t\troutes: string[] | false | undefined | null,\n\t\topts: MutationObserverInit | null,\n\t\tlimit: number,\n\t\ttimeout: number,\n\t\tremove: boolean,\n\t\telemental: Elemental\n\t) {\n\t\tsuper();\n\n\t\tthis.id = elemental_id++;\n\t\tthis.param = `_ffz$elemental$${this.id}`;\n\t\tthis.remove_param = `_ffz$elemental_remove$${this.id}`;\n\n\t\tthis._schedule = this._schedule.bind(this);\n\n\t\tthis.name = name;\n\t\tthis.selector = selector;\n\t\tthis.routes = routes ?? [];\n\t\tthis.opts = opts;\n\t\tthis.limit = limit;\n\t\tthis.timeout = timeout;\n\t\tthis.check_removal = remove;\n\n\t\tif ( this.opts && ! this.opts.childList && ! this.opts.attributes && ! this.opts.characterData )\n\t\t\tthis.opts.attributes = true;\n\n\t\tthis.count = 0;\n\t\tthis.instances = new Set;\n\t\tthis.elemental = elemental;\n\n\t\tthis.check();\n\t\tthis.schedule();\n\t}\n\n\tget atLimit() {\n\t\treturn this.limit > 0 && this.count >= this.limit;\n\t}\n\n\tclean() {\n\t\tconst instances = Array.from(this.instances);\n\t\tlet removed = false;\n\t\tfor(const el of instances) {\n\t\t\tif ( ! document.contains(el) ) {\n\t\t\t\tthis.remove(el, false);\n\t\t\t\tremoved = true;\n\t\t\t}\n\t\t}\n\n\t\tif ( removed ) {\n\t\t\tif ( this.limit === 0 || this.count < this.limit )\n\t\t\t\tthis.check();\n\t\t\tthis.schedule();\n\t\t}\n\t}\n\n\tschedule() {\n\t\tif ( ! this._stimer )\n\t\t\tthis._stimer = setTimeout(this._schedule, 0);\n\t}\n\n\t_schedule() {\n\t\tif ( this._stimer )\n\t\t\tclearTimeout(this._stimer);\n\t\tthis._stimer = null;\n\n\t\tif ( this.limit === 0 || this.count < this.limit )\n\t\t\tthis.elemental.listen(this);\n\t\telse\n\t\t\tthis.elemental.unlisten(this);\n\t}\n\n\tcheck() {\n\t\tconst matches = document.querySelectorAll<TElement>(this.selector);\n\t\t// TypeScript is stupid and thinks NodeListOf<Element> doesn't have an iterator\n\t\tfor(const el of matches as unknown as Iterable<TElement>)\n\t\t\tthis.add(el);\n\t}\n\n\tcheckElements(els: Iterable<Element>) {\n\t\tif ( this.atLimit )\n\t\t\treturn this.schedule();\n\n\t\tfor(const el of els) {\n\t\t\tconst matches = el.querySelectorAll<TElement>(this.selector);\n\t\t\tfor(const match of matches as unknown as Iterable<TElement>)\n\t\t\t\tthis.add(match);\n\n\t\t\tif ( this.atLimit )\n\t\t\t\treturn;\n\t\t}\n\t}\n\n\tget first() {\n\t\tfor(const el of this.instances)\n\t\t\treturn el;\n\n\t\treturn null;\n\t}\n\n\ttoArray() {\n\t\treturn Array.from(this.instances);\n\t}\n\n\teach(fn: (element: TElement) => void) {\n\t\tfor(const el of this.instances)\n\t\t\tfn(el);\n\t}\n\n\tadd(element: TElement) {\n\t\tif ( this.instances.has(element) )\n\t\t\treturn;\n\n\t\tthis.instances.add(element);\n\t\tthis.count++;\n\n\t\tif ( this.check_removal && element.parentNode ) {\n\t\t\tconst remove_check = new MutationObserver(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tif ( ! document.contains(element) )\n\t\t\t\t\t\tthis.remove(element);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tremove_check.observe(element.parentNode, {childList: true});\n\t\t\t(element as HTMLElement)[this.remove_param] = remove_check;\n\t\t}\n\n\t\tif ( this.opts ) {\n\t\t\tconst observer = new MutationObserver(muts => {\n\t\t\t\tif ( ! document.contains(element) ) {\n\t\t\t\t\tthis.remove(element);\n\t\t\t\t} else if ( ! this.__running.size )\n\t\t\t\t\tthis.emit('mutate', element, muts);\n\t\t\t});\n\n\t\t\tobserver.observe(element, this.opts);\n\t\t\t(element as HTMLElement)[this.param] = observer;\n\t\t}\n\n\t\tthis.schedule();\n\t\tthis.emit('mount', element);\n\t}\n\n\tremove(element: TElement, do_schedule = true) {\n\t\tconst observer = element[this.param];\n\t\tif ( observer ) {\n\t\t\tobserver.disconnect();\n\t\t\t(element as HTMLElement)[this.param] = null;\n\t\t}\n\n\t\tconst remove_check = element[this.remove_param];\n\t\tif ( remove_check ) {\n\t\t\tremove_check.disconnect();\n\t\t\t(element as HTMLElement)[this.remove_param] = null;\n\t\t}\n\n\t\tif ( ! this.instances.has(element) )\n\t\t\treturn;\n\n\t\tthis.instances.delete(element);\n\t\tthis.count--;\n\n\t\tif ( do_schedule )\n\t\t\tthis.schedule();\n\t\tthis.emit('unmount', element);\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Subpump\n// It controls Twitch PubSub.\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { FFZEvent } from 'utilities/events';\n\ndeclare global {\n\tinterface Window {\n\t\t__twitch_pubsub_client: TwitchPubSubClient | null | undefined;\n\t\t//__Twitch__pubsubInstances: any;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\t'site.subpump': SubpumpEvents;\n\t}\n\tinterface ModuleMap {\n\t\t'site.subpump': Subpump;\n\t}\n}\n\n\n\n/**\n * This is a rough map of the parts of Twitch's PubSub client that we\n * care about for our purposes.\n */\ntype TwitchPubSubClient = {\n\n\tconnection: {\n\t\tremoveAllListeners(topic: string): void;\n\t\taddListener(topic: string, listener: (event: any) => void): void;\n\t}\n\n\ttopicListeners?: {\n\t\t_events?: Record<string, any>;\n\t}\n\n\tonMessage(event: TwitchPubSubMessageEvent): any;\n\n\tlisten(opts: { topic: string }, listener: (event: any) => void, ...args: any[]): void;\n\tunlisten(topic: string, listener: (event: any) => void, ...args: any[]): void;\n\n\tffz_original_listen?: (opts: { topic: string }, listener: (event: any) => void, ...args: any[]) => void;\n\tffz_original_unlisten?: (topic: string, listener: (event: any) => void, ...args: any[]) => void;\n\n\tsimulateMessage(topic: string, message: string): void;\n\n}\n\ntype TwitchPubSubMessageEvent = {\n\ttype: string;\n\tdata?: {\n\t\ttopic: string;\n\t\tmessage: string;\n\t}\n}\n\n\n\nexport type RawPubSubEventData = {\n\tprefix: string;\n\ttrail: string;\n\tevent: {\n\t\ttopic: string;\n\t\tmessage: string;\n\t}\n}\n\n\nexport class PubSubEvent<TMessage = any> extends FFZEvent<RawPubSubEventData> {\n\n\t_obj?: TMessage;\n\t_changed: boolean;\n\n\t// This is assigned in super()\n\tprefix: string;\n\ttrail: string;\n\tevent: {\n\t\ttopic: string;\n\t\tmessage: string;\n\t};\n\n\tconstructor(data: RawPubSubEventData) {\n\t\tsuper(data);\n\n\t\tthis._obj = undefined;\n\t\tthis._changed = false;\n\t}\n\n\tmarkChanged() {\n\t\tthis._changed = true;\n\t}\n\n\tget topic() {\n\t\treturn this.event.topic;\n\t}\n\n\tget message(): TMessage {\n\t\tif ( this._obj === undefined )\n\t\t\tthis._obj = JSON.parse(this.event.message) ?? null;\n\n\t\treturn this._obj as TMessage;\n\t}\n\n\tset message(val) {\n\t\tthis._obj = val;\n\t\tthis._changed = true;\n\t}\n\n}\n\n\nexport type SubpumpEvents = {\n\t/** A message was received via Twitch's PubSub connection. */\n\t':pubsub-message': [event: PubSubEvent];\n\t/** Twitch subscribed to a new topic. */\n\t':add-topic': [topic: string];\n\t/** Twitch unsubscribed from a topic. */\n\t':remove-topic': [topic: string];\n}\n\n\nexport default class Subpump extends Module<'site.subpump', SubpumpEvents> {\n\n\tinstance?: TwitchPubSubClient | null;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\t\tthis.instance = null;\n\t}\n\n\tonEnable(tries = 0) {\n\t\tconst instance = window.__twitch_pubsub_client;\n\t\t\t//instances = window.__Twitch__pubsubInstances;\n\n\t\tif ( ! instance ) { //} && ! instances ) {\n\t\t\tif ( tries > 10 )\n\t\t\t\tthis.log.warn('Unable to find PubSub.');\n\t\t\telse\n\t\t\t\tnew Promise(r => setTimeout(r, 50)).then(() => this.onEnable(tries + 1));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( instance ) {\n\t\t\tthis.instance = instance;\n\t\t\tthis.hookClient(instance);\n\t\t}\n\n\t\t/*\n\t\telse if ( instances ) {\n\t\t\tfor(const val of Object.values(instances))\n\t\t\t\tif ( val?._client ) {\n\t\t\t\t\tif ( this.instance ) {\n\t\t\t\t\t\tthis.log.warn('Multiple PubSub instances detected. Things might act weird.');\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.instance = val;\n\t\t\t\t\tthis.hookOldClient(val._client);\n\t\t\t\t}\n\t\t}\n\t\t*/\n\n\t\tif ( ! this.instance )\n\t\t\tthis.log.warn('Unable to find a PubSub instance.');\n\t}\n\n\thandleMessage(msg: TwitchPubSubMessageEvent) {\n\t\ttry {\n\t\t\tif ( msg.type === 'MESSAGE' && msg.data?.topic ) {\n\t\t\t\tconst raw_topic = msg.data.topic,\n\t\t\t\t\tidx = raw_topic.indexOf('.'),\n\t\t\t\t\tprefix = idx === -1 ? raw_topic : raw_topic.slice(0, idx),\n\t\t\t\t\ttrail = idx === -1 ? '' : raw_topic.slice(idx + 1);\n\n\t\t\t\tconst event = new PubSubEvent({\n\t\t\t\t\tprefix,\n\t\t\t\t\ttrail,\n\t\t\t\t\tevent: msg.data\n\t\t\t\t});\n\n\t\t\t\tthis.emit(':pubsub-message', event);\n\t\t\t\tif ( event.defaultPrevented )\n\t\t\t\t\treturn true;\n\n\t\t\t\tif ( event._changed )\n\t\t\t\t\tmsg.data.message = JSON.stringify(event._obj);\n\t\t\t}\n\n\t\t} catch(err) {\n\t\t\tthis.log.error('Error processing PubSub event.', err);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thookClient(client: TwitchPubSubClient) {\n\t\tconst t = this,\n\t\t\torig_message = client.onMessage;\n\n\t\t//this.is_old = false;\n\n\t\tclient.connection.removeAllListeners('message');\n\n\t\tclient.onMessage = function(e) {\n\t\t\tif ( t.handleMessage(e) )\n\t\t\t\treturn;\n\n\t\t\treturn orig_message.call(this, e);\n\t\t}\n\n\t\tclient.connection.addListener('message', client.onMessage);\n\n\t\tconst orig_on = client.listen,\n\t\t\torig_off = client.unlisten;\n\n\t\tclient.ffz_original_listen = orig_on;\n\t\tclient.ffz_original_unlisten = orig_off;\n\n\t\tclient.listen = function(opts, fn, ...args) {\n\t\t\tconst topic = opts.topic,\n\t\t\t\thas_topic = topic && !! client.topicListeners?._events?.[topic],\n\t\t\t\tout = orig_on.call(this, opts, fn, ...args);\n\n\t\t\tif ( topic && ! has_topic )\n\t\t\t\tt.emit(':add-topic', topic);\n\n\t\t\treturn out;\n\t\t}\n\n\t\tclient.unlisten = function(topic, fn, ...args) {\n\t\t\tconst has_topic = !! client.topicListeners?._events?.[topic],\n\t\t\t\tout = orig_off.call(this, topic, fn, ...args);\n\n\t\t\tif ( has_topic && ! client.topicListeners?._events?.[topic] )\n\t\t\t\tt.emit(':remove-topic', topic);\n\n\t\t\treturn out;\n\t\t}\n\t}\n\n\tsimulateMessage(topic: string, message: any) {\n\t\tif ( ! this.instance )\n\t\t\tthrow new Error('No PubSub instance available');\n\n\t\t/*if ( this.is_old ) {\n\t\t\tconst listens = this.instance._client?._listens;\n\t\t\tlistens._trigger(topic, JSON.stringify(message));\n\t\t} else {*/\n\t\tthis.instance.simulateMessage(topic, JSON.stringify(message));\n\t\t//}\n\t}\n\n\tget topics() {\n\t\tconst events = this.instance?.topicListeners?._events;\n\t\t/*if ( this.is_old )\n\t\t\tevents = this.instance?._client?._listens._events;\n\t\telse\n\t\t\tevents = this.instance?.topicListeners?._events;*/\n\n\t\tif ( ! events )\n\t\t\treturn [];\n\n\t\treturn Object.keys(events);\n\t}\n\n}\n","export default __webpack_public_path__ + \"main.css\";","'use strict';\n\n// ============================================================================\n// Site Support: Twitch Twilight\n// ============================================================================\n\nimport BaseSite from '../base';\n\nimport WebMunch from 'utilities/compat/webmunch';\nimport Elemental from 'utilities/compat/elemental';\nimport Fine from 'utilities/compat/fine';\nimport FineRouter from 'utilities/compat/fine-router';\nimport Apollo from 'utilities/compat/apollo';\nimport TwitchData from 'utilities/twitch-data';\nimport Subpump from 'utilities/compat/subpump';\n\n//import Switchboard from './switchboard';\n\nimport {createElement} from 'utilities/dom';\nimport {has} from 'utilities/object';\n\nimport MAIN_URL from 'site/styles/main.scss';\n\n\n// ============================================================================\n// The Site\n// ============================================================================\n\nexport default class Twilight extends BaseSite {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject(WebMunch);\n\t\tthis.inject(Fine);\n\t\tthis.inject(Elemental);\n\t\tthis.inject('router', FineRouter);\n\t\tthis.inject(Apollo, false);\n\t\tthis.inject(TwitchData);\n\t\t//this.inject(Switchboard);\n\t\tthis.inject(Subpump);\n\n\t\tthis._dom_updates = [];\n\t}\n\n\tasync populateModules() {\n\t\tconst ctx = await require.context('site/modules', true, /(?:^(?:\\.\\/)?[^/]+|index)\\.[jt]sx?$/);\n\t\tconst modules = await this.loadFromContext(ctx, this.log);\n\t\tthis.log.info(`Loaded descriptions of ${Object.keys(modules).length} modules.`);\n\t}\n\n\tasync onLoad() {\n\t\tawait this.populateModules();\n\n\t\tthis.web_munch.known(Twilight.KNOWN_MODULES);\n\n\t\tthis.router.route(Twilight.ROUTES);\n\t\tthis.router.routeName(Twilight.ROUTE_NAMES);\n\n\t\tthis.router.route('user', '/:userName', null, state => state?.channelView !== 'Home');\n\t\tthis.router.route('user-home', '/:userName', null, state => state?.channelView === 'Home');\n\n\t\tthis.router.route(Twilight.DASH_ROUTES, 'dashboard.twitch.tv');\n\t\tthis.router.route(Twilight.PLAYER_ROUTES, 'player.twitch.tv');\n\t\tthis.router.route(Twilight.CLIP_ROUTES, 'clips.twitch.tv');\n\t}\n\n\tonEnable() {\n\t\tthis.settings = this.resolve('settings');\n\n\t\tthis.web_munch.findModule('simplebar').then(sb => {\n\t\t\tif (! window.ffzSimplebar && sb )\n\t\t\t\twindow.ffzSimplebar = sb;\n\t\t}).catch(() => {});\n\n\t\tconst thing = this.fine.searchNode(null, n => n?.pendingProps?.store?.getState),\n\t\t\tstore = this.store = thing?.pendingProps?.store;\n\n\t\tif ( ! store )\n\t\t\treturn new Promise(r => setTimeout(r, 50)).then(() => this.onEnable());\n\n\t\t// Event Bridge\n\t\tthis.on(':dom-update', (...args) => {\n\t\t\tthis._dom_updates.push(args);\n\t\t\tif ( ! this._dom_frame )\n\t\t\t\tthis._dom_frame = requestAnimationFrame(() => {\n\t\t\t\t\tconst updates = this._dom_updates,\n\t\t\t\t\t\tcore = this.resolve('core');\n\t\t\t\t\tthis._dom_updates = [];\n\t\t\t\t\tthis._dom_frame = null;\n\n\t\t\t\t\tfor(const [key, inst] of updates) {\n\t\t\t\t\t\tconst node = this.fine.getChildNode(inst);\n\t\t\t\t\t\tcore.emit('core:dom-update', key, node, inst);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t});\n\n\t\t// Window Size\n\t\tconst update_size = () => this.settings.updateContext({\n\t\t\tsize: {\n\t\t\t\theight: window.innerHeight,\n\t\t\t\twidth: window.innerWidth\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('resize', update_size);\n\t\tupdate_size();\n\n\t\tconst update_fullscreen = () => {\n\t\t\tthis.settings.updateContext({\n\t\t\t\tfullscreen: !! document.fullscreenElement\n\t\t\t});\n\t\t\tthis.emit(':fullscreen');\n\t\t}\n\n\t\tdocument.addEventListener('fullscreenchange', update_fullscreen);\n\t\tthis.settings.updateContext({\n\t\t\tfullscreen: !! document.fullscreenElement\n\t\t});\n\n\t\t// Share Context\n\t\tstore.subscribe(() => this.updateContext());\n\t\tthis.updateContext();\n\n\t\tthis.router.on(':route', (route, match) => {\n\t\t\tthis.log.info('Navigation', route && route.name, match && match[0]);\n\t\t\tthis.fine.route(route && route.name);\n\t\t\tthis.elemental.route(route && route.name);\n\t\t\tthis.settings.updateContext({\n\t\t\t\troute,\n\t\t\t\troute_data: match\n\t\t\t});\n\t\t});\n\n\t\tconst current = this.router.current;\n\t\tthis.fine.route(current && current.name);\n\t\tthis.elemental.route(current && current.name);\n\t\tthis.settings.updateContext({\n\t\t\troute: current,\n\t\t\troute_data: this.router.match\n\t\t});\n\n\t\tdocument.head.appendChild(createElement('link', {\n\t\t\thref: MAIN_URL,\n\t\t\trel: 'stylesheet',\n\t\t\ttype: 'text/css',\n\t\t\tcrossOrigin: 'anonymous'\n\t\t}));\n\n\t\t// Check for ?ffz-settings in page and open the\n\t\t// settings window in exclusive mode.\n\t\tconst params = new URL(window.location).searchParams;\n\t\tif ( params ) {\n\t\t\tif ( params.has('ffz-settings') )\n\t\t\t\tthis.resolve('main_menu').openExclusive();\n\n\t\t\tif ( params.has('ffz-translate') ) {\n\t\t\t\tconst translation = this.resolve('translation_ui');\n\t\t\t\ttranslation.dialog.exclusive = true;\n\t\t\t\ttranslation.enable();\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateContext() {\n\t\ttry {\n\t\t\tconst state = this.store.getState(),\n\t\t\t\tlocation = this.router?.reactLocation;\n\n\t\t\tthis.settings.updateContext({\n\t\t\t\tlocation,\n\t\t\t\tui: state && state.ui,\n\t\t\t\tsession: state && state.session,\n\t\t\t\tchat: state && state.chat\n\t\t\t});\n\n\t\t} catch(err) {\n\t\t\tthis.log.error('Error updating context.', err);\n\t\t}\n\t}\n\n\tgetSession() {\n\t\tconst state = this.store && this.store.getState();\n\t\treturn state && state.session;\n\t}\n\n\tgetUser() {\n\t\tif ( this._user )\n\t\t\treturn this._user;\n\n\t\tconst session = this.getSession();\n\t\treturn this._user = session && session.user;\n\t}\n\n\tgetCore() {\n\t\tif ( ! this._core )\n\t\t\tthis._core = this.web_munch.getModule('core');\n\n\t\treturn this._core;\n\t}\n}\n\n\nconst CALCULATE_BITS = '_calculateChangedBits';\n\nTwilight.KNOWN_MODULES = {\n\tsimplebar: n => n.globalObserver && n.initDOMLoadedElements,\n\treact: n => n.Component && n.createElement,\n\t'react-dom': n => n.createRoot && n.createPortal,\n\tcore: n => {\n\t\tif ( n.x2?.experiments && n.x2.intl )\n\t\t\treturn n.x2;\n\t\tif ( n['$6']?.experiments )\n\t\t\treturn n['$6'];\n\t\tif ( n.p?.experiments )\n\t\t\treturn n.p;\n\t\tif ( n.o?.experiments )\n\t\t\treturn n.o;\n\t\tif ( n.q?.experiments )\n\t\t\treturn n.q;\n\t},\n\tcookie: n => n && n.set && n.get && n.getJSON && n.withConverter,\n\t'extension-service': n => n.extensionService,\n\t'callout-types': n => {\n\t\tif ( n.o?.ClipLiveNudge && n.o?.Drop && n.o?.ShareResub )\n\t\t\treturn n.o;\n\t},\n\t'chat-types': n => {\n\t\tif ( has(n.ZW, 'Message') && has(n.ZW, 'RoomMods') )\n\t\t\treturn {\n\t\t\t\tautomod: n.sq,\n\t\t\t\tchat: n.ZW,\n\t\t\t\tmessage: n.IF,\n\t\t\t\tmod: n.RB\n\t\t\t};\n\n\t\tif ( has(n.b, 'Message') && has(n.b, 'RoomMods') )\n\t\t\treturn {\n\t\t\t\tautomod: n.a,\n\t\t\t\tchat: n.b,\n\t\t\t\tmessage: n.c,\n\t\t\t\tmod: n.e\n\t\t\t};\n\n\t\tif ( has(n.SJ, 'Message') && has(n.SJ, 'RoomMods') )\n\t\t\treturn {\n\t\t\t\tautomod: n.mT,\n\t\t\t\tchat: n.SJ,\n\t\t\t\tmessage: n.Ay,\n\t\t\t\tmod: n.Aw\n\t\t\t};\n\t},\n\t'gql-printer': n => {\n\t\tif ( n === window )\n\t\t\treturn;\n\n\t\tif ( n.print && n.print.toString().includes('.visit') )\n\t\t\treturn n.print;\n\n\t\tif ( n.S && n.S.toString().includes('.visit') )\n\t\t\treturn n.S;\n\t},\n\t'user-report': n => n['Z']?.displayName === 'Loadable(ReportUserModal)' && n['Z'],\n\t'sub-form': n => typeof n.T === 'function' && String(n.T).includes('CheckoutModal') && n.T,\n\tmousetrap: n => n.bindGlobal && n.unbind && n.handleKey,\n\t'algolia-search': n => {\n\t\tif ( n.a?.prototype?.queryTopResults && n.a.prototype.queryForType )\n\t\t\treturn n.a;\n\t\tif ( n.w9?.prototype?.queryTopResults && n.w9.prototype.queryForType )\n\t\t\treturn n.w9;\n\t},\n\tcalloutstack: n => {\n\t\tif ( has(n.at?._currentValue, 'callouts') && typeof n.at._currentValue.pinCallout === 'function' )\n\t\t\treturn {\n\t\t\t\tstack: n.at\n\t\t\t};\n\t},\n\thighlightstack: n => {\n\t\tif ( has(n['g$']?._currentValue, 'highlights') && typeof n.SP?._currentValue === 'function' )\n\t\t\treturn {\n\t\t\t\tstack: n['g$'],\n\t\t\t\tdispatch: n.SP\n\t\t\t};\n\n\t\tif ( has(n.b, CALCULATE_BITS) && has(n.c, CALCULATE_BITS) )\n\t\t\treturn {\n\t\t\t\tstack: n.b,\n\t\t\t\tdispatch: n.c\n\t\t\t};\n\n\t\tif ( has(n.fQ, CALCULATE_BITS) && has(n.vJ, CALCULATE_BITS) )\n\t\t\treturn {\n\t\t\t\tstack: n.fQ,\n\t\t\t\tdispatch: n.vJ\n\t\t\t};\n\n\t\tif ( has(n.fQ?._currentValue, 'highlights') && typeof n.vJ?._currentValue === 'function' )\n\t\t\treturn {\n\t\t\t\tstack: n.fQ,\n\t\t\t\tdispatch: n.vJ\n\t\t\t};\n\t}\n}\n\n//const VEND_CHUNK = n => ! n || n.includes('vendor');\nconst VEND_CORE = n => ! n || n.includes('vendor') || n.includes('core');\n\nTwilight.KNOWN_MODULES.core.use_result = true;\nTwilight.KNOWN_MODULES.core.skip_cache = true;\n//Twilight.KNOWN_MODULES.core.chunks = 'core';\n\nTwilight.KNOWN_MODULES.simplebar.chunks = VEND_CORE;\nTwilight.KNOWN_MODULES.react.chunks = VEND_CORE;\nTwilight.KNOWN_MODULES.cookie.chunks = VEND_CORE;\n\nTwilight.KNOWN_MODULES['gql-printer'].use_result = true;\nTwilight.KNOWN_MODULES['gql-printer'].chunks = VEND_CORE;\n\nTwilight.KNOWN_MODULES.mousetrap.chunks = VEND_CORE;\n\nconst CHAT_CHUNK = n => ! n || n.includes('chat');\n\nTwilight.KNOWN_MODULES['callout-types'].use_result = true;\nTwilight.KNOWN_MODULES['chat-types'].use_result = true;\nTwilight.KNOWN_MODULES['chat-types'].chunks = CHAT_CHUNK;\nTwilight.KNOWN_MODULES['calloutstack'].use_result = true;\nTwilight.KNOWN_MODULES['highlightstack'].use_result = true;\nTwilight.KNOWN_MODULES['highlightstack'].chunks = CHAT_CHUNK;\n\nTwilight.KNOWN_MODULES['algolia-search'].use_result = true;\nTwilight.KNOWN_MODULES['algolia-search'].chunks = 'core';\n\nTwilight.KNOWN_MODULES['user-report'].use_result = true;\nTwilight.KNOWN_MODULES['user-report'].chunks = n => ! n || n.includes('core') || n.includes('common');\n\nTwilight.KNOWN_MODULES['sub-form'].use_result = true;\nTwilight.KNOWN_MODULES['sub-form'].chunks = 'core';\n\n\nTwilight.POPOUT_ROUTES = [\n\t'embed-chat',\n\t'popout',\n\t'dash-popout-chat',\n\t'mod-popout-chat'\n];\n\n\nTwilight.CHAT_ROUTES = [\n\t'collection',\n\t'popout',\n\t'dash-chat',\n\t'video',\n\t'user-video',\n\t'user-home',\n\t'user-clip',\n\t'user-videos',\n\t'user-clips',\n\t'user-events',\n\t'user-followers',\n\t'user-following',\n\t'user',\n\t'dash',\n\t'embed-chat',\n\t'squad',\n\t'command-center',\n\t'dash-stream-manager',\n\t'dash-popout-chat',\n\t'mod-view',\n\t'mod-popout-chat'\n];\n\n\nTwilight.ROUTE_NAMES = {\n\t'dir': 'Browse',\n\t'dir-following': 'Following',\n\t'dir-all': 'Browse Live Channels',\n\t'dash': 'Dashboard',\n\t'popout': 'Popout Chat',\n\t'dash-popout-chat': 'Dashboard Popout Chat',\n\t'user-video': 'Channel Video',\n\t'popout-player': 'Popout/Embed Player'\n};\n\n\nTwilight.SUNLIGHT_ROUTES = [\n\t'dash-stream-manager',\n\t'dash-channel-analytics',\n\t'dash-stream-summary',\n\t'dash-achievements',\n\t'dash-roles',\n\t'dash-activity',\n\t'dash-channel-points',\n\t'dash-video-producer',\n\t'dash-edit-video',\n\t'dash-collections',\n\t'dash-edit-collection',\n\t'dash-clips',\n\t'dash-settings-moderation',\n\t'dash-settings-channel',\n\t'dash-settings-revenue',\n\t'dash-extensions',\n\t'dash-streaming-tools'\n];\n\n\nTwilight.PLAYER_ROUTES = {\n\t'popout-player': '/'\n};\n\nTwilight.CLIP_ROUTES = {\n\t'clip-page': '/:slug'\n};\n\n\nTwilight.DASH_ROUTES = {\n\t'dash-stream-manager': '/u/:userName/stream-manager',\n\t'dash-channel-analytics': '/u/:userName/channel-analytics',\n\t'dash-stream-summary': '/u/:userName/stream-summary',\n\t'dash-achievements': '/u/:userName/achievements',\n\t'dash-roles': '/u/:userName/community/roles',\n\t'dash-activity': '/u/:userName/community/activity',\n\t'dash-channel-points': '/u/:userName/community/channel-points',\n\t'dash-video-producer': '/u/:userName/content/video-producer',\n\t'dash-edit-video': '/u/:userName/content/video-producer/edit/:videoID',\n\t'dash-collections': '/u/:userName/content/collections',\n\t'dash-edit-collection': '/u/:userName/content/collections/:collectionID',\n\t'dash-clips': '/u/:userName/content/clips',\n\t'dash-settings-moderation': '/u/:userName/settings/moderation',\n\t'dash-settings-channel': '/u/:userName/settings/channel',\n\t'dash-settings-revenue': '/u/:userName/settings/revenue',\n\t'dash-extensions': '/u/:userName/extensions',\n\t'dash-streaming-tools': '/u/:userName/broadcast',\n\t'dash-popout-chat': '/popout/u/:userName/stream-manager/chat',\n};\n\nTwilight.ROUTES = {\n\t'front-page': '/',\n\t'collection': '/directory/collection/:collectionID',\n\t'dir': '/directory',\n\t'dir-gaming': '/directory/gaming',\n\t'dir-irl': '/directory/irl',\n\t'dir-music': '/directory/music',\n\t'dir-creative': '/directory/creative',\n\t'dir-esports': '/directory/esports',\n\t//'dir-community': '/communities/:communityName',\n\t//'dir-community-index': '/directory/communities',\n\t//'dir-creative': '/directory/creative',\n\t'dir-following': '/directory/following/:category?',\n\t'dir-game-index': '/directory/category/:gameName',\n\t'dir-game-clips': '/directory/category/:gameName/clips',\n\t'dir-game-videos': '/directory/category/:gameName/videos/:filter',\n\t//'dir-game-details': '/directory/game/:gameName/details',\n\t'dir-all': '/directory/all/:filter?',\n\t//'dir-category': '/directory/:category?',\n\t'dash': '/:userName/dashboard/:live?',\n\t//'dash-automod': '/:userName/dashboard/settings/automod',\n\t'event': '/event/:eventName',\n\t'popout': '/popout/:userName/chat',\n\t//'dash-chat': '/popout/:userName/dashboard/live/chat',\n\t'video': '/videos/:videoID',\n\t'user-video': '/:userName/video/:videoID',\n\t'user-videos': '/:userName/videos/:filter?',\n\t'user-clips': '/:userName/clips',\n\t'user-clip': '/:userName/clip/:clipID',\n\t'user-collections': '/:userName/collections',\n\t'user-events': '/:userName/events',\n\t'user-followers': '/:userName/followers',\n\t'user-following': '/:userName/following',\n\t'product': '/products/:productName',\n\t'prime': '/prime',\n\t'turbo': '/turbo',\n\t'search': '/search',\n\t//'user': '/:userName',\n\t'squad': '/:userName/squad',\n\t'command-center': '/:userName/commandcenter',\n\t'embed-chat': '/embed/:userName/chat',\n\t'mod-view': '/moderator/:userName',\n\t'mod-popout-chat': '/popout/moderator/:userName/chat',\n\t'drops-inventory': '/drops/inventory',\n\t'drops-campaigns': '/drops/campaigns'\n};\n\n\nTwilight.DIALOG_EXCLUSIVE = '.moderation-root,.sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root,#root';\nTwilight.DIALOG_MAXIMIZED = '.moderation-view-page > div[data-highlight-selector=\"main-grid\"],.sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area,.teams-page-body__outer-container .scrollable-area';\nTwilight.DIALOG_SELECTOR = '.moderation-root,.sunlight-root,#root,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area';\n","'use strict';\n\n// ============================================================================\n// Bits Button\n// ============================================================================\n\nimport Module from 'utilities/module';\n\n\nexport default class BitsButton extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\n\t\tthis.settings.add('layout.display-bits-button', {\n\t\t\trequires: ['chat.bits.show'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val != null )\n\t\t\t\t\treturn val;\n\n\t\t\t\treturn ctx.get('chat.bits.show')\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Show the Get Bits button.',\n\t\t\t\tdescription: 'By default, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering)',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.BitsButton.forceUpdate()\n\t\t});\n\n\t\tthis.BitsButton = this.fine.define(\n\t\t\t'bits-button',\n\t\t\tn => n.toggleBalloon && n.toggleShowTutorial\n\t\t);\n\t}\n\n\tonEnable() {\n\t\tthis.BitsButton.ready(cls => {\n\t\t\tconst t = this,\n\t\t\t\told_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tif ( ! t.settings.get('layout.display-bits-button') )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.BitsButton.forceUpdate();\n\t\t})\n\t}\n}","'use strict';\n\nimport { sleep } from 'src/utilities/object';\n// ============================================================================\n// BetterTTV Compatibility\n// ============================================================================\n\nimport Module from 'utilities/module';\n\nconst CHAT_EVENTS = [\n\t'chat-input'\n];\n\nexport default class BTTVCompat extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\n\t\tthis.should_enable = true;\n\t}\n\n\tonEnable() {\n\t\tthis.on('core:dom-update', this.handleDomUpdate, this);\n\n\t\tthis.hookSettings();\n\t}\n\n\tawaitSettings(tries = 0) {\n\t\tif ( ! window.BetterTTV?.settings ) {\n\t\t\tif ( tries > 100 )\n\t\t\t\treturn Promise.reject();\n\t\t\treturn sleep(50).then(() => this.awaitSettings(tries + 1));\n\t\t}\n\n\t\treturn window.BetterTTV.settings;\n\t}\n\n\tasync hookSettings() {\n\t\tconst settings = await this.awaitSettings(),\n\t\t\twaiter = () => this.updateContext(settings);\n\n\t\tsettings.on('changed.clickTwitchEmotes', waiter);\n\t\tsettings.on('changed.bttvGIFEmotes', waiter);\n\t\twaiter();\n\n\t\tif ( settings.get('ffzEmotes') ) {\n\t\t\tif ( this.settings.provider.get('bttv-ffz-notice') )\n\t\t\t\treturn;\n\n\t\t\tconst button = this.resolve('site.menu_button');\n\t\t\tif ( button ) {\n\t\t\t\tbutton.addToast({\n\t\t\t\t\ticon: 'ffz-i-zreknarf',\n\t\t\t\t\ttext_i18n: 'compat.bttv.emotes-on',\n\t\t\t\t\ttext: 'You have \"FrankerFaceZ Emotes\" turned on in BetterTTV\\'s settings, but you also have FrankerFaceZ installed. Please disable \"FrankerFaceZ Emotes\" in BetterTTV\\'s settings. It isn\\'t necessary.'\n\t\t\t\t});\n\t\t\t\tthis.settings.provider.set('bttv-ffz-notice', true);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateContext(settings) {\n\t\tthis.settings.updateContext({\n\t\t\tbttv: {\n\t\t\t\tloaded: true,\n\t\t\t\temote_menu: settings.get('clickTwitchEmotes'),\n\t\t\t\tgifs: settings.get('bttvGIFEmotes')\n\t\t\t}\n\t\t});\n\t}\n\n\thandleDomUpdate(key) {\n\t\tif ( ! window.BetterTTV?.watcher?.emitLoad )\n\t\t\treturn;\n\n\t\tif ( ! CHAT_EVENTS.includes(key) )\n\t\t\treturn;\n\n\t\tthis.log.info('Sending chat reload event to BetterTTV.');\n\t\ttry {\n\t\t\twindow.BetterTTV.watcher.emitLoad('chat');\n\t\t} catch(err) {\n\t\t\tthis.log.error('An error occurred with BetterTTV:', err);\n\t\t}\n\t}\n}","'use strict';\n\n// ============================================================================\n// Channel\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport { Color } from 'utilities/color';\nimport {debounce} from 'utilities/object';\nimport { createElement, setChildren } from 'utilities/dom';\n\n\nconst USER_PAGES = ['user', 'user-home', 'user-about', 'video', 'user-video', 'user-clip', 'user-videos', 'user-clips', 'user-collections', 'user-events', 'user-followers', 'user-following'];\n\nexport default class Channel extends Module {\n\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('site.apollo');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.elemental');\n\t\tthis.inject('site.subpump');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.router');\n\t\tthis.inject('site.twitch_data');\n\t\tthis.inject('metadata');\n\t\tthis.inject('socket');\n\t\tthis.inject('pubsub');\n\n\t\tthis.settings.add('channel.auto-click-off-featured', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> General',\n\t\t\t\ttitle: 'Automatically un-check \"Featured Clips Only\" when viewing a channel\\'s clips.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('channel.panel-tips', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> Panels',\n\t\t\t\ttitle: 'Display rich tool-tips for links in channel panels.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis.updatePanelTips();\n\t\t\t\tthis.css_tweaks.toggle('panel-links', val);\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('channel.auto-skip-trailer', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> General',\n\t\t\t\ttitle: 'Automatically skip channel trailers.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tif ( val )\n\t\t\t\t\tthis.ChannelTrailer.each(el => this.maybeSkipTrailer(el));\n\t\t\t}\n\t\t})\n\n\t\tthis.settings.add('channel.auto-click-chat', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> General',\n\t\t\t\ttitle: 'Automatically open chat when opening an offline channel page.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('channel.extra-links', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Add extra links to live channel pages, next to the streamer\\'s name.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateLinks()\n\t\t});\n\n\t\t/*this.settings.add('channel.hosting.enable', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> Hosting',\n\t\t\t\ttitle: 'Enable Channel Hosting',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => ! val && this.InfoBar.each(el => this.updateBar(el))\n\t\t});*/\n\n\t\tthis.ChannelPanels = this.fine.define(\n\t\t\t'channel-panels',\n\t\t\tn => n.layoutMasonry && n.updatePanelOrder && n.onExtensionPoppedOut,\n\t\t\tUSER_PAGES\n\t\t);\n\n\n\t\tthis.ChannelTrailer = this.elemental.define(\n\t\t\t'channel-trailer', '.channel-trailer-player__wrapper',\n\t\t\tUSER_PAGES,\n\t\t\t{attributes: true}, 1\n\t\t);\n\n\n\t\tthis.ChannelRoot = this.elemental.define(\n\t\t\t'channel-root', '.channel-root',\n\t\t\tUSER_PAGES,\n\t\t\t{attributes: true}, 1\n\t\t);\n\n\t\tthis.InfoBar = this.elemental.define(\n\t\t\t'channel-info-bar', '#live-channel-stream-information', //.channel-info-content',\n\t\t\tUSER_PAGES,\n\t\t\t{childNodes: true, subtree: true}, 1\n\t\t);\n\n\t\t/*const strip_host = resp => {\n\t\t\tif ( this.settings.get('channel.hosting.enable') )\n\t\t\t\treturn;\n\n\t\t\tconst user = resp?.data?.user;\n\t\t\tif ( user )\n\t\t\t\tuser.hosting = null;\n\n\t\t\tconst userOrError = resp?.data?.userOrError;\n\t\t\tif ( userOrError )\n\t\t\t\tuserOrError.hosting = null;\n\t\t};\n\n\t\tthis.apollo.registerModifier('UseHosting', strip_host, false);\n\t\tthis.apollo.registerModifier('PlayerTrackingContextQuery', strip_host, false);*/\n\t}\n\n\tonEnable() {\n\t\tthis.updateChannelColor();\n\n\t\tthis.css_tweaks.toggle('panel-links', this.settings.get('channel.panel-tips'));\n\n\t\tthis.on('i18n:update', this.updateLinks, this);\n\n\t\tthis.ChannelTrailer.on('mount', this.maybeSkipTrailer, this);\n\t\tthis.ChannelTrailer.on('update', this.maybeSkipTrailer, this);\n\t\tthis.ChannelTrailer.each(el => this.maybeSkipTrailer(el));\n\n\t\tthis.ChannelPanels.on('mount', this.updatePanelTips, this);\n\t\tthis.ChannelPanels.on('update', this.updatePanelTips, this);\n\t\tthis.ChannelPanels.on('unmount', this.removePanelTips, this);\n\t\tthis.ChannelPanels.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updatePanelTips(inst);\n\t\t});\n\n\t\tthis.ChannelRoot.on('mount', this.updateRoot, this);\n\t\tthis.ChannelRoot.on('mutate', this.updateRoot, this);\n\t\tthis.ChannelRoot.on('unmount', this.removeRoot, this);\n\t\tthis.ChannelRoot.each(el => this.updateRoot(el));\n\n\t\tthis.InfoBar.on('mount', this.updateBar, this);\n\t\tthis.InfoBar.on('mutate', this.updateBar, this);\n\t\tthis.InfoBar.on('unmount', this.removeBar, this);\n\t\tthis.InfoBar.each(el => this.updateBar(el));\n\n\t\t//this.subpump.on(':pubsub-message', this.onPubSub, this);\n\n\t\tthis.router.on(':route', this.checkNavigation, this);\n\t\tthis.checkNavigation();\n\t}\n\n\tmaybeSkipTrailer(el) {\n\t\tif ( ! this.settings.get('channel.auto-skip-trailer') )\n\t\t\treturn;\n\n\t\tconst inst = this.fine.searchParent(el, n => n.props && n.props.onDismiss);\n\t\tif ( inst ) {\n\t\t\tthis.log.info('Automatically skipping channel trailer.');\n\t\t\tinst.props.onDismiss();\n\t\t}\n\t}\n\n\tupdatePanelTips(inst) {\n\t\tif ( ! inst ) {\n\t\t\tfor(const inst of this.ChannelPanels.instances) {\n\t\t\t\tif ( inst )\n\t\t\t\t\tthis.updatePanelTips(inst);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst el = this.fine.getChildNode(inst);\n\t\tif ( ! el || ! this.settings.get('channel.panel-tips') )\n\t\t\treturn this.removePanelTips(inst);\n\n\t\tif ( inst._ffz_tips && inst._ffz_tip_el !== el )\n\t\t\tthis.removePanelTips(inst);\n\n\t\tif ( ! inst._ffz_tips ) {\n\t\t\tconst tt = this.resolve('tooltips');\n\t\t\tif ( tt ) {\n\t\t\t\tinst._ffz_tips = tt._createInstance(el, 'tw-link', 'link', tt.getRoot());\n\t\t\t\tinst._ffz_tip_el = el;\n\t\t\t}\n\t\t}\n\t}\n\n\tremovePanelTips(inst) { // eslint-disable-line class-methods-use-this\n\t\tif ( inst?._ffz_tips ) {\n\t\t\tinst._ffz_tips.destroy();\n\t\t\tinst._ffz_tips = null;\n\t\t\tinst._ffz_tip_el = null;\n\t\t}\n\t}\n\n\tcheckFeaturedClips() {\n\t\tif ( this.router.current_name !== 'user-clips' && this.router.current_name !== 'user-videos' )\n\t\t\treturn;\n\n\t\tif ( this._featured_waiting || ! this.settings.get('channel.auto-click-off-featured') )\n\t\t\treturn;\n\n\t\tthis._featured_waiting = this.parent.awaitElement('input#featured-clips-toggle').then(el => {\n\t\t\tif ( el.checked )\n\t\t\t\tel.click();\n\n\t\t\tthis._featured_waiting = false;\n\t\t}).catch(() => {\n\t\t\tthis._featured_waiting = false;\n\t\t});\n\t}\n\n\tcheckNavigation() {\n\t\tthis.checkFeaturedClips();\n\n\t\tif ( ! this.settings.get('channel.auto-click-chat') || this.router.current_name !== 'user-home' )\n\t\t\treturn;\n\n\t\tif ( this.router.old_location === this.router.location )\n\t\t\treturn;\n\n\t\tthis.router.replace(this.router.location, {channelView: 'Watch'});\n\t}\n\n\tupdateLinks() {\n\t\tfor(const el of this.InfoBar.instances) {\n\t\t\tel._ffz_link_login = null;\n\t\t\tthis.updateBar(el);\n\t\t}\n\t}\n\n\tupdateSubscription(id, login) {\n\t\tif ( this._subbed_login === login && this._subbed_id === id )\n\t\t\treturn;\n\n\t\tif ( this._subbed_id ) {\n\t\t\tthis.pubsub.unsubscribe(this, `twitch/${this._subbed_id}`);\n\t\t\tthis._subbed_id = null;\n\t\t}\n\n\t\tif ( this._subbed_login ) {\n\t\t\tthis.socket.unsubscribe(this, `channel.${this._subbed_login}`);\n\t\t\tthis._subbed_login = null;\n\t\t}\n\n\t\tif ( id ) {\n\t\t\tthis.pubsub.subscribe(this, `twitch/${id}`);\n\t\t\tthis._subbed_id = id;\n\t\t}\n\n\t\tif ( login ) {\n\t\t\tthis.socket.subscribe(this, `channel.${login}`);\n\t\t\tthis._subbed_login = login;\n\t\t}\n\t}\n\n\tupdateBar(el) {\n\t\t// TODO: Run a data check to abort early if nothing has changed before updating metadata\n\t\t// thus avoiding a potential loop from mutations.\n\t\tif ( ! el._ffz_update )\n\t\t\tel._ffz_update = debounce(() => requestAnimationFrame(() => this._updateBar(el)), 1000, 2);\n\n\t\tel._ffz_update();\n\t}\n\n\t_updateBar(el) {\n\t\tif ( el._ffz_cont && ! document.contains(el._ffz_cont) ) {\n\t\t\tel._ffz_cont.classList.remove('ffz--meta-tray');\n\t\t\tel._ffz_cont = null;\n\t\t}\n\n\t\tconst want_links = this.settings.get('channel.extra-links');\n\n\t\tif ( el._ffz_links && (! document.contains(el._ffz_links) || ! want_links)) {\n\t\t\tel._ffz_links.remove();\n\t\t\tel._ffz_links = null;\n\t\t\tel._ffz_link_login = null;\n\t\t}\n\n\t\tlet nvc = el.querySelector('.ffz--native-viewers-container');\n\t\tif ( ! nvc ) {\n\t\t\tlet i = 0,\n\t\t\t\tvel = el.querySelector('p[data-a-target=\"animated-channel-viewers-count\"]');\n\t\t\twhile(vel && vel != el && i < 5) {\n\t\t\t\tif ( vel.querySelector('svg') ) {\n\t\t\t\t\tvel.classList.add('ffz--native-viewers-container');\n\t\t\t\t\tnvc = vel;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tvel = vel.parentElement;\n\t\t\t\ti++;\n\t\t\t}\n\t\t}\n\n\t\tif ( ! el._ffz_cont ) {\n\t\t\tlet report = el.querySelector(`.report-button,button[data-test-selector=\"video-options-button\"],button[data-test-selector=\"clip-options-button\"],button[data-a-target=\"report-button-more-button\"]`);\n\t\t\tif (!report && nvc)\n\t\t\t\treport = nvc.parentElement;\n\t\t\tlet cont = report && (\n\t\t\t\treport.closest('.tw-flex-wrap.tw-justify-content-end') ||\n\t\t\t\treport.closest('.tw-justify-content-end')\n\t\t\t);\n\n\t\t\tif ( ! cont && report ) {\n\t\t\t\tcont = report.parentElement?.parentElement;\n\t\t\t\tif ( cont && cont.parentElement?.childElementCount === 2 && report.dataset.aTarget !== 'report-button-more-button' )\n\t\t\t\t\tcont = cont.parentElement.firstElementChild;\n\t\t\t}\n\n\t\t\tif ( cont && el.contains(cont) ) {\n\t\t\t\tel._ffz_cont = cont;\n\t\t\t\tcont.classList.add('ffz--meta-tray');\n\n\t\t\t} else\n\t\t\t\tel._ffz_cont = null;\n\t\t}\n\n\t\tif ( ! el._ffz_links && want_links ) {\n\t\t\tconst link = el.querySelector('a .tw-title'),\n\t\t\t\tanchor = link && link.closest('a'),\n\t\t\t\tcont = anchor && anchor.closest('div');\n\n\t\t\tif ( cont && el.contains(cont) ) {\n\t\t\t\tel._ffz_links = <div class=\"ffz--links tw-mg-l-1\"></div>;\n\t\t\t\tcont.appendChild(el._ffz_links);\n\t\t\t}\n\t\t}\n\n\t\tconst react = this.fine.getReactInstance(el);\n\t\tlet props = react?.child?.memoizedProps;\n\t\tif ( ! props?.channelLogin )\n\t\t\tprops = props?.children?.props;\n\n\t\tconst watching = props?.watchPartyProps?.isShowingWatchPartyInMain;\n\t\tthis.settings.updateContext({\n\t\t\tisWatchParty: watching\n\t\t});\n\n\t\tif ( ! el._ffz_cont || ! props?.channelID ) {\n\t\t\tthis.updateSubscription(null, null);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( el._ffz_links && props.channelLogin !== el._ffz_link_login  ) {\n\t\t\tconst login = el._ffz_link_login = props.channelLogin;\n\t\t\tif ( login ) {\n\t\t\t\tconst make_link = (link, text) => {\n\t\t\t\t\tconst a = <a href={link} class=\"tw-c-text-alt-2 tw-interactive tw-pd-x-1 tw-font-size-5\">{text}</a>;\n\t\t\t\t\ta.addEventListener('click', event => {\n\t\t\t\t\t\tif ( event.ctrlKey || event.shiftKey || event.altKey )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tthis.router.push(link);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\n\t\t\t\tif ( el._ffz_links.closest('.home-header-sticky') )\n\t\t\t\t\tel._ffz_links.innerHTML = '';\n\t\t\t\telse\n\t\t\t\t\tsetChildren(el._ffz_links, [\n\t\t\t\t\t\tmake_link(`/${login}/schedule`, this.i18n.t('channel.links.schedule', 'Schedule')),\n\t\t\t\t\t\tmake_link(`/${login}/videos`, this.i18n.t('channel.links.videos', 'Videos')),\n\t\t\t\t\t\tmake_link(`/${login}/clips`, this.i18n.t('channel.links.clips', 'Clips'))\n\t\t\t\t\t]);\n\n\t\t\t} else\n\t\t\t\tel._ffz_links.innerHTML = '';\n\t\t}\n\n\t\t// This is awful, but it works.\n\t\tlet channel = null;\n\t\tthis.fine.searchNode(react, node => {\n\t\t\tlet state = node?.memoizedState, i = 0;\n\t\t\twhile(state != null && channel == null && i < 50 ) {\n\t\t\t\tchannel = state?.memoizedState?.current?.result?.data?.user ??\n\t\t\t\t\tstate?.memoizedState?.current?.previousData?.user;\n\n\t\t\t\tif ( !channel?.lastBroadcast?.game )\n\t\t\t\t\tchannel = null;\n\n\t\t\t\tif ( ! channel )\n\t\t\t\t\tstate = state?.next;\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn channel != null;\n\t\t});\n\n\t\tconst game = channel?.lastBroadcast?.game,\n\t\t\ttitle = channel?.lastBroadcast?.title;\n\n\t\tif (game?.id !== el._ffz_game_cache || title !== el._ffz_title_cache)\n\t\t\tthis.settings.updateContext({\n\t\t\t\tcategory: game?.displayName,\n\t\t\t\tcategoryID: game?.id,\n\t\t\t\ttitle\n\t\t\t});\n\n\t\t// TODO: See if we can read this data directly from Apollo's cache.\n\t\t// Also, test how it works with videos and clips.\n\t\t/*const raw_game = el.querySelector('a[data-a-target=\"stream-game-link\"]')?.textContent;\n\t\tif ( ! el._ffz_game_cache_updating && el._ffz_game_cache !== raw_game ) {\n\t\t\tel._ffz_game_cache_updating = true;\n\t\t\tel._ffz_game_cache = raw_game;\n\n\t\t\tthis.twitch_data.getUserGame(props.channelID, props.channelLogin).then(game => {\n\t\t\t\tel._ffz_game_cache_updating = false;\n\t\t\t\tthis.settings.updateContext({\n\t\t\t\t\tcategory: game?.displayName,\n\t\t\t\t\tcategoryID: game?.id\n\t\t\t\t})\n\t\t\t}).catch(() => {\n\t\t\t\tel._ffz_game_cache_updating = false;\n\t\t\t});\n\t\t}\n\n\t\tconst other_props = react.child.child?.child?.child?.child?.child?.child?.child?.child?.child?.memoizedProps,\n\t\t\ttitle = other_props?.title;\n\n\t\tif ( title !== el._ffz_title_cache ) {\n\t\t\tel._ffz_title_cache = title;\n\t\t\tthis.settings.updateContext({\n\t\t\t\ttitle\n\t\t\t});\n\t\t}*/\n\n\t\t//if ( ! this.settings.get('channel.hosting.enable') && props.hostLogin )\n\t\t//\tthis.setHost(props.channelID, props.channelLogin, null, null);\n\n\t\tthis.updateSubscription(props.channelID, props.channelLogin);\n\t\tthis.updateMetadata(el);\n\n\t\tthis.emit(':update-bar', el, props, channel);\n\t}\n\n\tremoveBar(el) {\n\t\tthis.updateSubscription(null, null);\n\n\t\tif ( el._ffz_cont )\n\t\t\tel._ffz_cont.classList.remove('ffz--meta-tray');\n\n\t\tel._ffz_cont = null;\n\t\tif ( el._ffz_meta_timers ) {\n\t\t\tfor(const val of Object.values(el._ffz_meta_timers))\n\t\t\t\tclearTimeout(val);\n\n\t\t\tel._ffz_meta_timers = null;\n\t\t}\n\n\t\tel._ffz_update = null;\n\t}\n\n\tupdateMetadata(el, keys) {\n\t\tconst cont = el._ffz_cont,\n\t\t\treact = this.fine.getReactInstance(el);\n\t\tlet props = react?.memoizedProps?.children?.props;\n\t\tif ( props && ! props.channelID )\n\t\t\tprops = props.children?.props;\n\n\t\tif ( ! cont || ! document.contains(cont) || ! props || ! props.channelID )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = this.metadata.keys;\n\t\telse if ( ! Array.isArray(keys) )\n\t\t\tkeys = [keys];\n\n\t\tconst timers = el._ffz_meta_timers = el._ffz_meta_timers || {},\n\t\t\trefresh_fn = key => this.updateMetadata(el, key),\n\t\t\tdata = {\n\t\t\t\tchannel: {\n\t\t\t\t\tid: props.channelID,\n\t\t\t\t\tlogin: props.channelLogin,\n\t\t\t\t\tdisplay_name: props.displayName,\n\t\t\t\t\tlive: props.isLive && ! props.videoID && ! props.clipSlug,\n\t\t\t\t\tvideo: !!(props.videoID || props.clipSlug),\n\t\t\t\t\tlive_since: props.liveSince\n\t\t\t\t},\n\t\t\t\tprops,\n\t\t\t\t/*hosted: {\n\t\t\t\t\tlogin: props.hostLogin,\n\t\t\t\t\tdisplay_name: props.hostDisplayName\n\t\t\t\t},*/\n\t\t\t\tel,\n\t\t\t\tgetViewerCount: () => {\n\t\t\t\t\tconst thing = cont.querySelector('p[data-a-target=\"animated-channel-viewers-count\"]'),\n\t\t\t\t\t\tr = thing && this.fine.getReactInstance(thing),\n\t\t\t\t\t\tc = r?.memoizedProps?.children;\n\n\t\t\t\t\t// Sometimes, on early loads, the animated element\n\t\t\t\t\t// is actually a static string.\n\t\t\t\t\tif ( typeof c === 'string' && /^[0-9,.]+$/.test(c) ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst val = parseInt(c.replace(/[\\.,]+/, ''), 10);\n\t\t\t\t\t\t\tif ( ! isNaN(val) && isFinite(val) && val > 0 )\n\t\t\t\t\t\t\t\treturn val;\n\t\t\t\t\t\t} catch(err) { /* no-op */ }\n\t\t\t\t\t}\n\n\t\t\t\t\tconst p = c?.props;\n\t\t\t\t\tif ( p && p.value != null )\n\t\t\t\t\t\treturn p.value;\n\n\t\t\t\t\treturn 0;\n\t\t\t\t},\n\t\t\t\tgetUserSelfImmediate: cb => {\n\t\t\t\t\tconst ret = this.getUserSelf(el, props.channelID, true);\n\t\t\t\t\tif ( ret && ret.then ) {\n\t\t\t\t\t\tret.then(cb);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\t\t\t\t},\n\t\t\t\tgetUserSelf: () => this.getUserSelf(el, props.channelID),\n\t\t\t\tgetBroadcastID: () => this.getBroadcastID(el, props.channelID)\n\t\t\t};\n\n\t\tfor(const key of keys)\n\t\t\tthis.metadata.renderLegacy(key, data, cont, timers, refresh_fn);\n\t}\n\n\n\tupdateRoot(el) {\n\t\tconst root = this.fine.getReactInstance(el);\n\n\t\tlet channel = null, node = root, j=0, i=0;\n\t\twhile(node != null && channel == null && j < 10) {\n\t\t\tlet state = node?.memoizedState;\n\t\t\ti=0;\n\t\t\twhile(state != null && channel == null && i < 50) {\n\t\t\t\tchannel = state?.memoizedState?.current?.result?.data?.userOrError ??\n\t\t\t\t\tstate?.memoizedState?.current?.previousData?.userOrError;\n\n\t\t\t\tif ( ! channel )\n\t\t\t\t\tstate = state?.next;\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tnode = node?.return;\n\t\t\tj++;\n\t\t}\n\n\t\tif ( channel && channel.id ) {\n\t\t\tthis.updateChannelColor(channel.primaryColorHex);\n\n\t\t\tthis.settings.updateContext({\n\t\t\t\tchannel: channel.login,\n\t\t\t\tchannelID: channel.id,\n\t\t\t\tchannelColor: channel.primaryColorHex\n\t\t\t});\n\n\t\t} else\n\t\t\tthis.removeRoot();\n\t}\n\n\tremoveRoot() {\n\t\tthis.updateChannelColor();\n\t\tthis.settings.updateContext({\n\t\t\tchannel: null,\n\t\t\tchannelID: null,\n\t\t\tchannelColor: null\n\t\t});\n\t}\n\n\tupdateChannelColor(color) {\n\t\tlet parsed = color && Color.RGBA.fromHex(color);\n\t\tif ( ! parsed )\n\t\t\tparsed = Color.RGBA.fromHex('9147FF');\n\n\t\tif ( parsed ) {\n\t\t\tthis.css_tweaks.setVariable('channel-color', parsed.toCSS());\n\t\t\tthis.css_tweaks.setVariable('channel-color-20', parsed._a(0.2).toCSS());\n\t\t\tthis.css_tweaks.setVariable('channel-color-30', parsed._a(0.3).toCSS());\n\t\t} else {\n\t\t\tthis.css_tweaks.deleteVariable('channel-color');\n\t\t\tthis.css_tweaks.deleteVariable('channel-color-20');\n\t\t\tthis.css_tweaks.deleteVariable('channel-color-30');\n\t\t}\n\t}\n\n\tgetUserSelf(el, channel_id, no_promise) {\n\t\tconst cache = el._ffz_self_cache = el._ffz_self_cache || {};\n\t\tif ( channel_id === cache.channel_id ) {\n\t\t\tif ( Date.now() - cache.saved < 60000 ) {\n\t\t\t\tif ( no_promise )\n\t\t\t\t\treturn cache.data;\n\t\t\t\treturn Promise.resolve(cache.data);\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(async (s, f) => {\n\t\t\tif ( cache.updating ) {\n\t\t\t\tcache.updating.push([s, f]);\n\t\t\t\treturn ;\n\t\t\t}\n\n\t\t\tcache.channel_id = channel_id;\n\t\t\tcache.updating = [[s,f]];\n\t\t\tlet data, err;\n\n\t\t\ttry {\n\t\t\t\tdata = await this.twitch_data.getUserSelf(channel_id);\n\t\t\t} catch(error) {\n\t\t\t\tdata = null;\n\t\t\t\terr = error;\n\t\t\t}\n\n\t\t\tconst waiters = cache.updating;\n\t\t\tcache.updating = null;\n\n\t\t\tif ( cache.channel_id !== channel_id ) {\n\t\t\t\terr = new Error('Outdated');\n\t\t\t\tcache.channel_id = null;\n\t\t\t\tcache.data = null;\n\t\t\t\tcache.saved = 0;\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcache.data = data;\n\t\t\tcache.saved = Date.now();\n\n\t\t\tfor(const pair of waiters)\n\t\t\t\terr ? pair[1](err) : pair[0](data);\n\t\t});\n\t}\n\n\tgetBroadcastID(el, channel_id) {\n\t\tconst cache = el._ffz_bcast_cache = el._ffz_bcast_cache || {};\n\t\tif ( channel_id === cache.channel_id ) {\n\t\t\tif ( Date.now() - cache.saved < 60000 )\n\t\t\t\treturn Promise.resolve(cache.broadcast_id);\n\t\t}\n\n\t\treturn new Promise(async (s, f) => {\n\t\t\tif ( cache.updating ) {\n\t\t\t\tcache.updating.push([s, f]);\n\t\t\t\treturn ;\n\t\t\t}\n\n\t\t\tcache.channel_id = channel_id;\n\t\t\tcache.updating = [[s,f]];\n\t\t\tlet id, err;\n\n\t\t\ttry {\n\t\t\t\tid = await this.twitch_data.getBroadcastID(channel_id);\n\t\t\t} catch(error) {\n\t\t\t\tid = null;\n\t\t\t\terr = error;\n\t\t\t}\n\n\t\t\tconst waiters = cache.updating;\n\t\t\tcache.updating = null;\n\n\t\t\tif ( cache.channel_id !== channel_id ) {\n\t\t\t\terr = new Error('Outdated');\n\t\t\t\tcache.channel_id = null;\n\t\t\t\tcache.broadcast_id = null;\n\t\t\t\tcache.saved = 0;\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcache.broadcast_id = id;\n\t\t\tcache.saved = Date.now();\n\n\t\t\tfor(const pair of waiters)\n\t\t\t\terr ? pair[1](err) : pair[0](id);\n\t\t});\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Chat Scroller\n// ============================================================================\n\nimport Twilight from 'site';\nimport Module from 'utilities/module';\n\nconst SCROLL_EVENTS = [\n\t'touchmove',\n\t'scroll',\n\t'wheel',\n\t'mousewheel',\n\t'DOMMouseScroll'\n];\n\nlet last_id = 0;\n\nexport default class Scroller extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('chat');\n\t\tthis.inject('site');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.web_munch');\n\n\t\tthis.ChatScroller = this.fine.define(\n\t\t\t'chat-scroller',\n\t\t\tn => n.saveScrollRef && n.handleScrollEvent && ! n.renderLines && n.resume,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.settings.add('chat.scroller.freeze', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Scrolling',\n\t\t\t\ttitle: 'Pause Chat Scrolling',\n\t\t\t\tdescription: 'Automatically stop chat from scrolling when moving the mouse over it or holding a key.\\n\\n**Note:** Scrolling up in chat will always prevent automatic scrolling, regardless of this setting.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Use Twitch Setting'},\n\t\t\t\t\t{value: 1, title: 'On Hover'},\n\t\t\t\t\t{value: 2, title: 'When Ctrl is Held'},\n\t\t\t\t\t{value: 3, title: 'When Meta is Held'},\n\t\t\t\t\t{value: 4, title: 'When Alt is Held'},\n\t\t\t\t\t{value: 5, title: 'When Shift is Held'},\n\t\t\t\t\t{value: 6, title: 'Ctrl or Hover'},\n\t\t\t\t\t{value: 7, title: 'Meta or Hover'},\n\t\t\t\t\t{value: 8, title: 'Alt or Hover'},\n\t\t\t\t\t{value: 9, title: 'Shift or Hover'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.scroller.freeze-requires-hover', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Scrolling',\n\t\t\t\ttitle: 'Require the mouse to be over chat to freeze with a hotkey.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.scroller.hover-delay', {\n\t\t\tdefault: 750,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Scrolling',\n\t\t\t\ttitle: 'Hover Timeout',\n\t\t\t\tdescription: 'Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 250, title: '0.25 Seconds'},\n\t\t\t\t\t{value: 500, title: '0.50 Seconds'},\n\t\t\t\t\t{value: 750, title: '0.75 Seconds'},\n\t\t\t\t\t{value: 1000, title: '1 Second'},\n\t\t\t\t\t{value: 2500, title: '2.5 Seconds'},\n\t\t\t\t\t{value: 5000, title: '5 Seconds'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.scroller.smooth-scroll', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> Scrolling',\n\t\t\t\ttitle: 'Smooth Scrolling',\n\t\t\t\tdescription: '**Note:** This may not behave well depending on your browser. Disable this if you encounter issues.\\n\\nSmoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Slow'},\n\t\t\t\t\t{value: 2, title: 'Medium'},\n\t\t\t\t\t{value: 3, title: 'Fast'},\n\t\t\t\t\t{value: 4, title: 'Very Fast'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateUseKeys() {\n\t\tconst old_use = this.use_keys;\n\t\tthis.use_keys = false;\n\t\tfor(const act of this.chat.context.get('chat.actions.inline'))\n\t\t\tif ( act && act.display && act.display.keys ) {\n\t\t\t\tthis.use_keys = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tfor(const act of this.chat.context.get('chat.actions.hover'))\n\t\t\tif ( act && act.display && act.display.keys ) {\n\t\t\t\tthis.use_keys = true;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\tif ( this.use_keys !== old_use ) {\n\t\t\tfor(const inst of this.ChatScroller.instances)\n\t\t\t\tinst && inst.ffzUpdateKeys && inst.ffzUpdateKeys();\n\t\t}\n\t}\n\n\tasync onEnable() {\n\t\tthis.on('i18n:update', () => this.ChatScroller.forceUpdate());\n\n\t\tthis.chat.context.on('changed:chat.actions.inline', this.updateUseKeys, this);\n\t\tthis.updateUseKeys();\n\n\t\tthis.pause_hover = this.chat.context.get('chat.scroller.freeze-requires-hover');\n\t\tthis.chat.context.on('changed:chat.scroller.freeze-requires-hover', val => {\n\t\t\tthis.pause_hover = val;\n\n\t\t\tfor(const inst of this.ChatScroller.instances)\n\t\t\t\tinst.ffzMaybeUnpause();\n\t\t})\n\n\t\tthis.pause_delay = this.chat.context.get('chat.scroller.hover-delay');\n\t\tthis.chat.context.on('changed:chat.scroller.hover-delay', val => {\n\t\t\tthis.pause_delay = val;\n\n\t\t\tfor(const inst of this.ChatScroller.instances)\n\t\t\t\tinst.ffzMaybeUnpause();\n\t\t})\n\n\t\tthis.pause = this.chat.context.get('chat.scroller.freeze');\n\t\tthis.chat.context.on('changed:chat.scroller.freeze', val => {\n\t\t\tthis.pause = val;\n\n\t\t\tfor(const inst of this.ChatScroller.instances)\n\t\t\t\tinst.ffzMaybeUnpause();\n\t\t});\n\n\t\tthis.smooth_scroll = this.chat.context.get('chat.scroller.smooth-scroll');\n\t\tthis.chat.context.on('changed:chat.scroller.smooth-scroll', val => {\n\t\t\tthis.smooth_scroll = val;\n\n\t\t\tfor(const inst of this.ChatScroller.instances)\n\t\t\t\tinst.ffzSetSmoothScroll(val);\n\t\t});\n\n\t\tconst t = this,\n\t\t\tReact = await this.site.findReact(),\n\t\t\tcreateElement = React?.createElement;\n\n\t\tif ( ! createElement )\n\t\t\treturn t.log.warn(`Unable to get React.`);\n\n\t\tthis.ChatScroller.ready((cls, instances) => {\n\t\t\tconst old_catch = cls.prototype.componentDidCatch,\n\t\t\t\told_render = cls.prototype.render;\n\n\t\t\t// Try catching errors. With any luck, maybe we can\n\t\t\t// recover from the error when we re-build?\n\t\t\tcls.prototype.componentDidCatch = function(err, info) {\n\t\t\t\t// Don't log infinitely if stuff gets super screwed up.\n\t\t\t\tconst errs = this.state.ffz_errors || 0;\n\t\t\t\tif ( errs < 100 ) {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tffz_errors: errs + 1,\n\t\t\t\t\t\tffz_total_errors: (this.state.ffz_total_errors||0) + 1\n\t\t\t\t\t});\n\n\t\t\t\t\tt.log.capture(err, {extra: info});\n\t\t\t\t\tt.log.info('Error within Chat', err, info, errs);\n\t\t\t\t}\n\n\t\t\t\tif ( old_catch )\n\t\t\t\t\treturn old_catch.call(this, err, info);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzZeroErrors = function() {\n\t\t\t\tthis.setState({ffz_errors: 0});\n\t\t\t}\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tif ( this.state.ffz_errors > 0 ) {\n\t\t\t\t\tlet timer;\n\t\t\t\t\tconst auto = this.state.ffz_total_errors < 10,\n\t\t\t\t\t\thandler = () => {\n\t\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\t\tthis.ffzZeroErrors();\n\t\t\t\t\t\t}\n\n\t\t\t\t\tif ( auto )\n\t\t\t\t\t\ttimer = setTimeout(handler, 250);\n\n\t\t\t\t\tif ( ! createElement )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn createElement('div', {\n\t\t\t\t\t\tclassName: 'tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative'\n\t\t\t\t\t}, [\n\t\t\t\t\t\tcreateElement('div', {className: 'tw-mg-b-1'}, 'There was an error displaying chat.'),\n\t\t\t\t\t\t! auto && createElement('button', {\n\t\t\t\t\t\t\tclassName: 'tw-button',\n\t\t\t\t\t\t\tonClick: handler\n\t\t\t\t\t\t}, createElement('span', {className: 'tw-button__text'}, 'Try Again'))\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tconst out = old_render.call(this);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst children = out?.props?.children?.props?.children,\n\t\t\t\t\t\t\tchild = children?.[2];\n\n\t\t\t\t\t\tif ( child?.type?.displayName === 'ChatPausedFooter' )\n\t\t\t\t\t\t\tchildren[2] = this.ffzRenderFooter();\n\t\t\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcls.prototype.ffzInstallCleaner = function() {\n\t\t\t\tif ( this._ffz_cleaner )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._ffz_cleaner = this.ffzOnClean.bind(this);\n\t\t\t\tthis._ffz_clean_timer = setInterval(this._ffz_cleaner, 60_000);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzOnClean = function() {\n\t\t\t\tconst el = t.fine.getChildNode(this);\n\t\t\t\tif (!el)\n\t\t\t\t\treturn this.ffzRemoveCleaner();\n\n\t\t\t\trequestAnimationFrame(() => t.cleanMessages(el.querySelector('.chat-scrollable-area__message-container')));\n\t\t\t}\n\n\t\t\tcls.prototype.ffzRemoveCleaner = function() {\n\t\t\t\tif ( this._ffz_clean_timer )\n\t\t\t\t\tclearInterval(this._ffz_clean_timer);\n\n\t\t\t\tthis._ffz_clean_timer = this._ffz_cleaner = null;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzInstallHandler = function() {\n\t\t\t\tif ( this._ffz_installed )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._ffz_installed = true;\n\t\t\t\tconst inst = this;\n\n\t\t\t\tinst.ffz_oldScrollEvent = inst.handleScrollEvent;\n\t\t\t\tinst.ffz_oldScroll = inst.scrollToBottom;\n\n\t\t\t\tinst.ffz_acting = false;\n\t\t\t\tinst.ffz_outside = true;\n\t\t\t\tinst._ffz_accessor = `_ffz_contains_${last_id++}`;\n\n\t\t\t\tt.on('tooltips:hover', this.ffzTooltipHover, this);\n\t\t\t\tt.on('tooltips:leave', this.ffzTooltipLeave, this);\n\n\t\t\t\tinst.scrollToBottom = function() {\n\t\t\t\t\tif ( inst._ffz_scroll_request )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tinst._ffz_scroll_request = requestAnimationFrame(inst._scrollToBottom);\n\t\t\t\t}\n\n\t\t\t\tinst._scrollToBottom = function() {\n\t\t\t\t\tinst._ffz_scroll_request = null;\n\t\t\t\t\t//inst._ffz_snapshot = null;\n\t\t\t\t\tif ( ! inst.state.isPaused ) {\n\t\t\t\t\t\tif ( inst.ffz_smooth_scroll && ! inst._ffz_one_fast_scroll )\n\t\t\t\t\t\t\tinst.ffzSmoothScroll();\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tinst._ffz_one_fast_scroll = false;\n\t\t\t\t\t\t\tinst.ffz_oldScroll();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tinst.handleScrollEvent = function(event) {\n\t\t\t\t\tif ( ! inst.scrollRef?.scrollContent )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif ( !(event.which > 0 || event.type === 'mousewheel' || event.type === 'wheel' || event.type === 'touchmove') )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t// How far are we scrolled up?\n\t\t\t\t\tconst scroller = inst.scrollRef.scrollContent,\n\t\t\t\t\t\toffset = scroller.scrollHeight - scroller.scrollTop - scroller.offsetHeight,\n\t\t\t\t\t\tscrolled_up = offset > 10;\n\n\t\t\t\t\tif ( scrolled_up !== inst.state.ffz_scrolled_up )\n\t\t\t\t\t\tinst.setState({ffz_scrolled_up: scrolled_up});\n\n\t\t\t\t\tif ( inst.state.isPaused && scrolled_up )\n\t\t\t\t\t\tinst.setLoadMoreEnabled(true);\n\n\t\t\t\t\tif ( inst.state.isPaused && ! scrolled_up )\n\t\t\t\t\t\tinst.ffzMaybeUnpause();\n\t\t\t\t\telse if ( ! inst.state.isPaused && scrolled_up )\n\t\t\t\t\t\tinst.pause();\n\t\t\t\t}\n\n\t\t\t\tconst old_resume = inst.resume;\n\n\t\t\t\tinst.ffzFastResume = function() {\n\t\t\t\t\tinst._ffz_one_fast_scroll = true;\n\t\t\t\t\tinst.resume();\n\t\t\t\t}\n\n\t\t\t\tinst.resume = function() {\n\t\t\t\t\tinst.setState({ffz_scrolled_up: false});\n\t\t\t\t\told_resume.call(this);\n\t\t\t\t}\n\n\t\t\t\t// Event Registration\n\n\t\t\t\tconst Mousetrap = t.web_munch.getModule('mousetrap') || window.Mousetrap;\n\t\t\t\tif ( Mousetrap != null ) {\n\t\t\t\t\tMousetrap.unbind('alt', 'keydown');\n\t\t\t\t\tMousetrap.unbind('alt', 'keyup');\n\t\t\t\t}\n\n\t\t\t\tinst.ffzHandleKey = inst.ffzHandleKey.bind(inst);\n\t\t\t\twindow.addEventListener('keydown', inst.ffzHandleKey);\n\t\t\t\twindow.addEventListener('keyup', inst.ffzHandleKey);\n\n\t\t\t\tinst.hoverPause = inst.ffzMouseMove.bind(inst);\n\t\t\t\tinst.hoverResume = inst.ffzMouseLeave.bind(inst);\n\n\t\t\t\tconst node = t.fine.getChildNode(inst);\n\t\t\t\tif ( node )\n\t\t\t\t\tnode.addEventListener('mousemove', inst.hoverPause);\n\n\t\t\t\tconst scroller = this.scrollRef?.scrollContent;\n\t\t\t\tif ( scroller ) {\n\t\t\t\t\tfor(const event of SCROLL_EVENTS) {\n\t\t\t\t\t\tscroller.removeEventListener(event, inst.ffz_oldScrollEvent);\n\t\t\t\t\t\tscroller.addEventListener(event, inst.handleScrollEvent);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// We need to refresh the element to make sure it's using the correct\n\t\t\t\t// event handlers for mouse enter / leave.\n\t\t\t\tinst.forceUpdate();\n\t\t\t\tt.emit('site:dom-update', 'chat-scroller', inst);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzSmoothScroll = function() {\n\t\t\t\tif ( this._ffz_smooth_animation )\n\t\t\t\t\tcancelAnimationFrame(this._ffz_smooth_animation);\n\n\t\t\t\tthis.ffz_is_smooth_scrolling = true;\n\n\t\t\t\t// Step setting value is # pixels to scroll per 10ms.\n\t\t\t\t// 1 is pretty slow, 2 medium, 3 fast, 4 very fast.\n\t\t\t\tlet step = this.ffz_smooth_scroll,\n\t\t\t\t\told_time = performance.now();\n\n\t\t\t\tconst scroll_content = this.scrollRef?.scrollContent;\n\t\t\t\tif ( ! scroll_content )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst target_top = scroll_content.scrollHeight - scroll_content.clientHeight,\n\t\t\t\t\tdifference = target_top - scroll_content.scrollTop;\n\n\t\t\t\t// If we are falling behind speed us up\n\t\t\t\tif ( difference > scroll_content.clientHeight ) {\n\t\t\t\t\t// we are a full scroll away, just jump there\n\t\t\t\t\tstep = difference;\n\n\t\t\t\t} else if ( difference > 200 ) {\n\t\t\t\t\t// we are starting to fall behind, speed it up a bit\n\t\t\t\t\tstep += step * Math.floor(difference / 200);\n\t\t\t\t}\n\n\t\t\t\tconst smoothAnimation = () => {\n\t\t\t\t\tif ( this.state.isPaused )\n\t\t\t\t\t\treturn this.ffz_is_smooth_scrolling = false;\n\n\t\t\t\t\t// See how much time has passed to get a step based off the delta\n\t\t\t\t\tconst current_time = performance.now(),\n\t\t\t\t\t\tdelta = current_time - old_time,\n\t\t\t\t\t\tcurrent_step = step * (delta / 10);\n\n\t\t\t\t\t// we need to move at least one full pixel for scrollTop to do anything in this delta.\n\t\t\t\t\tif ( current_step >= 1 ) {\n\t\t\t\t\t\tconst scroll_top = scroll_content.scrollTop,\n\t\t\t\t\t\t\tnext_top = scroll_top + current_step,\n\t\t\t\t\t\t\ttarget_top = scroll_content.scrollHeight - scroll_content.clientHeight;\n\n\t\t\t\t\t\told_time = current_time;\n\t\t\t\t\t\tif ( next_top < target_top ) {\n\t\t\t\t\t\t\tscroll_content.scrollTop = scroll_top + current_step;\n\t\t\t\t\t\t\tthis._ffz_smooth_animation = requestAnimationFrame(smoothAnimation);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// We've reached the bottom.\n\t\t\t\t\t\t\tscroll_content.scrollTop = target_top;\n\t\t\t\t\t\t\tthis.ffz_is_smooth_scrolling = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// The frame happened so quick since last update that we haven't moved a full pixel.\n\t\t\t\t\t\t// Just wait.\n\t\t\t\t\t\tthis._ffz_smooth_animation = requestAnimationFrame(smoothAnimation);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsmoothAnimation();\n\t\t\t}\n\n\t\t\tcls.prototype.ffzSetSmoothScroll = function(value) {\n\t\t\t\tthis.ffz_smooth_scroll = value;\n\t\t\t\tthis.ffzMaybeUnpause();\n\t\t\t}\n\n\t\t\t// Event Handling\n\n\t\t\tcls.prototype.ffzReadKeysFromEvent = function(event) {\n\t\t\t\tif ( event.altKey === this.ffz_alt &&\n\t\t\t\t\t\tevent.shiftKey === this.ffz_shift &&\n\t\t\t\t\t\tevent.ctrlKey === this.ffz_ctrl &&\n\t\t\t\t\t\tevent.metaKey === this.ffz_meta )\n\t\t\t\t\treturn false;\n\n\t\t\t\tthis.ffz_alt = event.altKey;\n\t\t\t\tthis.ffz_shift = event.shiftKey;\n\t\t\t\tthis.ffz_ctrl = event.ctrlKey;\n\t\t\t\tthis.ffz_meta = event.metaKey;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzHandleKey = function(event) {\n\t\t\t\tif ( ! this.ffzReadKeysFromEvent(event) )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.ffzUpdateKeyTags();\n\n\t\t\t\tif ( (t.pause_hover && this.ffz_outside) || this.ffzGetMode() < 2 )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst should_pause = this.ffzShouldBePaused(),\n\t\t\t\t\tchanged = should_pause !== this.state.isPaused;\n\n\t\t\t\tif ( changed )\n\t\t\t\t\tif ( should_pause ) {\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t\tif ( ! this.state.ffz_scrolled_up )\n\t\t\t\t\t\t\tthis.setLoadMoreEnabled(false);\n\t\t\t\t\t} else\n\t\t\t\t\t\tthis.resume();\n\t\t\t}\n\n\t\t\tcls.prototype.ffzInstallHoverTimer = function() {\n\t\t\t\tif ( this._ffz_hover_timer )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._ffz_hover_timer = setInterval(() => {\n\t\t\t\t\tif ( this.state.isPaused && this.ffzShouldBePaused() )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tthis.ffzMaybeUnpause();\n\t\t\t\t}, 50);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzMouseMove = function(event) {\n\t\t\t\tthis.ffz_last_move = Date.now();\n\t\t\t\tconst was_outside = this.ffz_outside;\n\t\t\t\tthis.ffz_outside = false;\n\n\t\t\t\tif ( this._ffz_outside_timer ) {\n\t\t\t\t\tclearTimeout(this._ffz_outside_timer);\n\t\t\t\t\tthis._ffz_outside_timer = null;\n\t\t\t\t}\n\n\t\t\t\tconst keys_updated = this.ffzReadKeysFromEvent(event);\n\n\t\t\t\t// If nothing changed, stop processing.\n\t\t\t\tif ( ! keys_updated && event.screenX === this.ffz_sx && event.screenY === this.ffz_sy ) {\n\t\t\t\t\tif ( was_outside )\n\t\t\t\t\t\tthis.ffzUpdateKeyTags();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.ffz_sx = event.screenX;\n\t\t\t\tthis.ffz_sy = event.screenY;\n\n\t\t\t\tif ( keys_updated || was_outside )\n\t\t\t\t\tthis.ffzUpdateKeyTags();\n\n\t\t\t\tconst should_pause = this.ffzShouldBePaused(),\n\t\t\t\t\tchanged = should_pause !== this.state.isPaused;\n\n\t\t\t\tif ( changed )\n\t\t\t\t\tif ( should_pause ) {\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t\tthis.ffzInstallHoverTimer();\n\t\t\t\t\t\tif ( ! this.state.ffz_scrolled_up )\n\t\t\t\t\t\t\tthis.setLoadMoreEnabled(false);\n\n\t\t\t\t\t} else\n\t\t\t\t\t\tthis.resume();\n\t\t\t}\n\n\t\t\tcls.prototype.ffzMouseLeave = function() {\n\t\t\t\tthis.ffz_outside = true;\n\t\t\t\tif ( this._ffz_outside_timer )\n\t\t\t\t\tclearTimeout(this._ffz_outside_timer);\n\n\t\t\t\tthis._ffz_outside_timer = setTimeout(() => this.ffzMaybeUnpause(), 64);\n\t\t\t\tthis.ffzUpdateKeyTags();\n\t\t\t}\n\n\t\t\tcls.prototype.ffzTooltipHover = function(target, tip, event) {\n\t\t\t\tif ( target[this._ffz_accessor] == null ) {\n\t\t\t\t\tconst scroller = this.scrollRef?.scrollContent;\n\t\t\t\t\ttarget[this._ffz_accessor] = scroller ? scroller.contains(target) : false;\n\t\t\t\t}\n\n\t\t\t\tif ( target[this._ffz_accessor] )\n\t\t\t\t\tthis.ffzMouseMove(event);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzTooltipLeave = function(target) {\n\t\t\t\tif ( this.ffz_outside )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( target[this._ffz_accessor] == null ) {\n\t\t\t\t\tconst scroller = this.scrollRef?.scrollContent;\n\t\t\t\t\ttarget[this._ffz_accessor] = scroller ? scroller.contains(target) : false;\n\t\t\t\t}\n\n\t\t\t\tif ( target[this._ffz_accessor] )\n\t\t\t\t\tthis.ffzMouseLeave();\n\t\t\t}\n\n\t\t\t// Keyboard Stuff\n\n\t\t\tcls.prototype.ffzUpdateActing = function() {\n\t\t\t\tif ( ! this._ffz_key_frame_acting )\n\t\t\t\t\tthis._ffz_key_frame_acting = requestAnimationFrame(() => this.ffz_updateActing());\n\t\t\t}\n\n\t\t\tcls.prototype.ffz_updateActing = function() {\n\t\t\t\tthis._ffz_key_frame_acting = null;\n\n\t\t\t\tif ( ! this.scrollRef?.root )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.scrollRef.root.dataset.acting = this.ffz_acting;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzUpdateKeyTags = function() {\n\t\t\t\tif ( ! this._ffz_key_frame )\n\t\t\t\t\tthis._ffz_key_frame = requestAnimationFrame(() => this.ffz_updateKeyTags());\n\t\t\t}\n\n\t\t\tcls.prototype.ffz_updateKeyTags = function() {\n\t\t\t\tthis._ffz_key_frame = null;\n\n\t\t\t\tif ( ! t.use_keys && this.ffz_use_keys === t.use_keys )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( ! this.scrollRef?.root )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.ffz_use_keys = t.use_keys;\n\t\t\t\tthis.scrollRef.root.classList.toggle('ffz--keys', t.use_keys);\n\n\t\t\t\tconst ds = this.scrollRef.root.dataset;\n\n\t\t\t\tif ( ! t.use_keys ) {\n\t\t\t\t\tdelete ds.alt;\n\t\t\t\t\tdelete ds.ctrl;\n\t\t\t\t\tdelete ds.shift;\n\t\t\t\t\tdelete ds.meta;\n\n\t\t\t\t} else {\n\t\t\t\t\tds.alt = ! this.ffz_outside && this.ffz_alt;\n\t\t\t\t\tds.ctrl = ! this.ffz_outside && this.ffz_ctrl;\n\t\t\t\t\tds.shift = ! this.ffz_outside && this.ffz_shift;\n\t\t\t\t\tds.meta = ! this.ffz_outside && this.ffz_meta;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// Pause Stuff\n\n\t\t\tcls.prototype.ffzShouldBePaused = function(since) {\n\t\t\t\t// We may not have moved the mouse. If that's the case,\n\t\t\t\t// since should be zero.\n\t\t\t\tif ( since == null )\n\t\t\t\t\tsince = Date.now() - (this.ffz_last_move ?? Date.now());\n\n\t\t\t\tif ( this.state.ffz_scrolled_up )\n\t\t\t\t\treturn true;\n\n\t\t\t\tconst mode = this.ffzGetMode(),\n\t\t\t\t\trequire_hover = t.pause_hover;\n\n\t\t\t\treturn (! require_hover || ! this.ffz_outside) && (\n\t\t\t\t\t(this.ffz_acting) ||\n\t\t\t\t\t(this.ffz_ctrl  && (mode === 2 || mode === 6)) ||\n\t\t\t\t\t(this.ffz_meta  && (mode === 3 || mode === 7)) ||\n\t\t\t\t\t(this.ffz_alt   && (mode === 4 || mode === 8)) ||\n\t\t\t\t\t(this.ffz_shift && (mode === 5 || mode === 9)) ||\n\t\t\t\t\t(! this.ffz_outside && since < t.pause_delay && (mode === 1 || mode > 5))\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzGetMode = function() {\n\t\t\t\tlet mode = t.pause;\n\t\t\t\tif ( mode === 0 && ! this.props.mouseoverPausingDisabled ) {\n\t\t\t\t\tconst setting = this.props.pauseSetting;\n\t\t\t\t\tif ( setting === 'MOUSEOVER_ALTKEY' )\n\t\t\t\t\t\tmode = 8;\n\t\t\t\t\telse if ( setting === 'MOUSEOVER' )\n\t\t\t\t\t\tmode = 1;\n\t\t\t\t\telse if ( setting === 'ALTKEY' )\n\t\t\t\t\t\tmode = 4;\n\t\t\t\t}\n\n\t\t\t\treturn mode;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzMaybeUnpause = function() {\n\t\t\t\tif ( this.state.isPaused && ! this._ffz_unpause_frame )\n\t\t\t\t\tthis._ffz_unpause_frame = requestAnimationFrame(() => {\n\t\t\t\t\t\tthis._ffz_unpause_frame = null;\n\t\t\t\t\t\tif ( this.state.isPaused && ! this.ffzShouldBePaused() )\n\t\t\t\t\t\t\tthis.resume();\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tcls.prototype.ffzRenderFooter = function() {\n\t\t\t\tlet msg, cls = '';\n\t\t\t\tif ( this.state.ffz_scrolled_up )\n\t\t\t\t\tmsg = t.i18n.t('chat.messages-below', 'Chat Paused Due to Scroll');\n\t\t\t\telse if ( this.state.isPaused ) {\n\t\t\t\t\tconst f = this.ffzGetMode(),\n\t\t\t\t\t\treason = this.ffz_acting ? t.i18n.t('chat.acting', 'Taking Action') :\n\t\t\t\t\t\t\tf === 2 ? t.i18n.t('key.ctrl', 'Ctrl Key') :\n\t\t\t\t\t\t\t\tf === 3 ? t.i18n.t('key.meta', 'Meta Key') :\n\t\t\t\t\t\t\t\t\tf === 4 ? t.i18n.t('key.alt', 'Alt Key') :\n\t\t\t\t\t\t\t\t\t\tf === 5 ? t.i18n.t('key.shift', 'Shift Key') :\n\t\t\t\t\t\t\t\t\t\t\tf === 6 ? t.i18n.t('key.ctrl_mouse', 'Ctrl or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\t\tf === 7 ? t.i18n.t('key.meta_mouse', 'Meta or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\t\t\tf === 8 ? t.i18n.t('key.alt_mouse', 'Alt or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tf === 9 ? t.i18n.t('key.shift_mouse', 'Shift or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('key.mouse', 'Mouse Movement');\n\n\t\t\t\t\tmsg = t.i18n.t('chat.paused', 'Chat Paused Due to {reason}', {reason});\n\t\t\t\t\tcls = 'ffz--freeze-indicator';\n\n\t\t\t\t} else\n\t\t\t\t\treturn createElement('div', {\n\t\t\t\t\t\tclassName: `chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${cls}`\n\t\t\t\t\t}, null);\n\n\t\t\t\treturn createElement('div', {\n\t\t\t\t\tclassName: `chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${cls}`\n\t\t\t\t}, createElement('div', {\n\t\t\t\t\tclassName: 'tw-absolute tw-border-radius-medium tw-bottom-0 tw-c-background-overlay tw-c-text-overlay tw-mg-b-1'\n\t\t\t\t}, createElement('button', {\n\t\t\t\t\tclassName: 'tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--overlay ffz-core-button--text tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative',\n\t\t\t\t\t'data-a-target': 'chat-list-footer',\n\t\t\t\t\tonClick: this.ffzFastResume\n\t\t\t\t}, createElement('div', {\n\t\t\t\t\tclassName: 'tw-align-items-center ffz-core-button-label tw-flex tw-flex-grow-0'\n\t\t\t\t}, createElement('div', {\n\t\t\t\t\tclassName: 'tw-flex-grow-0'\n\t\t\t\t}, msg)))));\n\t\t\t}\n\n\t\t\t// Do the thing~\n\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.onMount(inst);\n\t\t});\n\n\t\tthis.ChatScroller.on('mount', this.onMount, this);\n\t\tthis.ChatScroller.on('unmount', this.onUnmount, this);\n\t}\n\n\n\tonMount(inst) {\n\t\tinst.ffzSetSmoothScroll(this.smooth_scroll);\n\t\tinst.ffzInstallHandler();\n\t\tinst.ffzInstallCleaner();\n\t}\n\n\tonUnmount(inst) { // eslint-disable-line class-methods-use-this\n\t\tthis.off('tooltips:hover', inst.ffzTooltipHover, inst);\n\t\tthis.off('tooltips:leave', inst.ffzTooltipLeave, inst);\n\n\t\tif ( inst._ffz_hover_timer ) {\n\t\t\tclearInterval(inst._ffz_hover_timer);\n\t\t\tinst._ffz_hover_timer = null;\n\t\t}\n\n\t\tif ( inst._ffz_outside_timer ) {\n\t\t\tclearTimeout(inst._ffz_outside_timer);\n\t\t\tinst._ffz_outside_timer = null;\n\t\t}\n\n\t\tinst.ffzRemoveCleaner();\n\n\t\twindow.removeEventListener('keydown', inst.ffzHandleKey);\n\t\twindow.removeEventListener('keyup', inst.ffzHandleKey);\n\t}\n\n\n\tcleanMessages(el) {\n\t\tconst react = ffz.site.fine.getReactInstance(el);\n\n\t\t// Make sure we have the right thing.\n\t\tif (!react || !Array.isArray(react.child?.memoizedProps))\n\t\t\treturn;\n\n\t\t// Find the first real child\n\t\tlet node = null,\n\t\t\tr = react.child,\n\t\t\ti = 0;\n\t\twhile(r && i < 10) {\n\t\t\tif (r.stateNode instanceof HTMLDivElement) {\n\t\t\t\tnode = r.stateNode;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tr = r.child;\n\t\t\ti++;\n\t\t}\n\n\t\tif (!node || node.parentElement !== el)\n\t\t\treturn;\n\n\t\tlet to_remove = node.previousElementSibling;\n\t\ti = 0;\n\n\t\twhile(to_remove) {\n\t\t\tconst removable = to_remove;\n\t\t\tto_remove = to_remove.previousElementSibling;\n\t\t\tremovable.remove();\n\t\t\ti++;\n\t\t}\n\n\t\tif (i > 0)\n\t\t\tthis.log.debug(`Removed ${i} dead chat lines from`, el);\n\t}\n\n\n}\n","'use strict';\n\n// ============================================================================\n// RichContent Component\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {timeout, has} from 'utilities/object';\n\nconst ERROR_IMAGE = 'https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0';\n\nexport default class RichContent extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('chat');\n\t\tthis.inject('i18n');\n\t\tthis.inject('site');\n\n\t\tthis.RichContent = null;\n\t\tthis.has_tokenizer = false;\n\t}\n\n\tasync loadTokenizer() {\n\t\tif ( this.has_tokenizer )\n\t\t\treturn;\n\n\t\tthis.tokenizer = await import(/* webpackChunkName: 'rich_tokens' */ 'utilities/rich_tokens');\n\t\tthis.has_tokenizer = true;\n\t\treturn this.tokenizer;\n\t}\n\n\tasync onEnable() {\n\t\tconst t = this,\n\t\t\tReact = await this.site.findReact();\n\t\tif ( ! React )\n\t\t\treturn;\n\n\t\tconst createElement = React.createElement;\n\n\t\tthis.RichContent = class RichContent extends React.Component {\n\t\t\tconstructor(props) {\n\t\t\t\tsuper(props);\n\n\t\t\t\tthis.state = {\n\t\t\t\t\tloaded: false,\n\t\t\t\t\terror: false,\n\t\t\t\t\thas_tokenizer: t.has_tokenizer\n\t\t\t\t}\n\n\t\t\t\tif ( ! t.has_tokenizer )\n\t\t\t\t\tt.loadTokenizer().then(() => this.setState({...this.state, has_tokenizer: true}));\n\t\t\t}\n\n\t\t\tasync load(refresh = false) {\n\t\t\t\tthis.clearRefresh();\n\n\t\t\t\ttry {\n\t\t\t\t\tlet data = this.props.getData(refresh);\n\t\t\t\t\tif ( data instanceof Promise ) {\n\t\t\t\t\t\tconst to_wait = has(this.props, 'timeout') ? this.props.timeout : 1000;\n\t\t\t\t\t\tif ( to_wait )\n\t\t\t\t\t\t\tdata = await timeout(data, to_wait);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = await data;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ! data )\n\t\t\t\t\t\tdata = {\n\t\t\t\t\t\t\terror: {type: 'i18n', key: 'card.empty', phrase: 'No data was returned.'}\n\t\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.error )\n\t\t\t\t\t\tdata = {\n\t\t\t\t\t\t\tshort: {\n\t\t\t\t\t\t\t\ttype: 'header',\n\t\t\t\t\t\t\t\timage: {type: 'image', url: ERROR_IMAGE},\n\t\t\t\t\t\t\t\ttitle: {type: 'i18n', key: 'card.error', phrase: 'An error occurred.'},\n\t\t\t\t\t\t\t\tsubtitle: data.error\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\tif ( data.refresh ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.clearRefresh();\n\n\t\t\t\t\t\t\tconst then = new Date(data.refresh).getTime(),\n\t\t\t\t\t\t\t\tdelta = then - Date.now();\n\n\t\t\t\t\t\t\tif ( delta > 0 )\n\t\t\t\t\t\t\t\tthis._refresh_timer = setTimeout(() => this.load(true), delta + (100 * Math.floor(Math.random() * 100)));\n\n\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\t/* no op */\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setState(Object.assign({\n\t\t\t\t\t\tloaded: true,\n\t\t\t\t\t\turl: this.props.url,\n\t\t\t\t\t}, data));\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tif ( err.message !== 'timeout' )\n\t\t\t\t\t\tt.log.capture(err);\n\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\thas_tokenizer: t.has_tokenizer,\n\t\t\t\t\t\tloaded: true,\n\t\t\t\t\t\turl: this.props.url,\n\t\t\t\t\t\tshort: {\n\t\t\t\t\t\t\ttype: 'header',\n\t\t\t\t\t\t\timage: {type: 'image', url: ERROR_IMAGE},\n\t\t\t\t\t\t\ttitle: {type: 'i18n', key: 'card.error', phrase: 'An error occurred.'},\n\t\t\t\t\t\t\tsubtitle: String(err)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclearRefresh() {\n\t\t\t\tif ( this._refresh_timer ) {\n\t\t\t\t\tclearTimeout(this._refresh_timer);\n\t\t\t\t\tthis._refresh_timer = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheckReload(url) {\n\t\t\t\tif ( ! url || (url && this.props.url === url) )\n\t\t\t\t\tthis.reload();\n\t\t\t}\n\n\t\t\treload(refresh = false) {\n\t\t\t\tthis.clearRefresh();\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tloaded: false,\n\t\t\t\t\terror: false,\n\t\t\t\t\thas_tokenizer: t.has_tokenizer\n\t\t\t\t}, () => this.load(refresh));\n\t\t\t}\n\n\t\t\tcomponentDidMount() {\n\t\t\t\tt.on('chat:update-link-resolver', this.checkReload, this);\n\n\t\t\t\tthis.load();\n\t\t\t}\n\n\t\t\tcomponentWillUnmount() {\n\t\t\t\tt.off('chat:update-link-resolver', this.checkReload, this);\n\t\t\t\tthis.clearRefresh();\n\t\t\t}\n\n\t\t\trenderCard() {\n\t\t\t\tif ( this.props.renderBody )\n\t\t\t\t\treturn this.props.renderBody(this.state, this, createElement);\n\n\t\t\t\treturn [\n\t\t\t\t\tthis.renderUnsafe(),\n\t\t\t\t\tthis.renderBody()\n\t\t\t\t];\n\t\t\t}\n\n\t\t\trenderUnsafe() {\n\t\t\t\tif ( ! this.state.unsafe )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst reasons = Array.from(new Set(this.state.urls.map(url => url.flags).flat())).join(', ').toLowerCase();\n\n\t\t\t\treturn (<div\n\t\t\t\t\tclass=\"ffz--corner-flag ffz--corner-flag__warn ffz-tooltip ffz-tooltip--no-mouse\"\n\t\t\t\t\tdata-title={t.i18n.t('tooltip.link-unsafe', 'Caution: This URL is has been flagged as potentially harmful by: {reasons}', {reasons})}\n\t\t\t\t>\n\t\t\t\t\t<figure class=\"ffz-i-attention\" />\n\t\t\t\t</div>);\n\t\t\t}\n\n\t\t\trenderBody() {\n\t\t\t\tlet doc;\n\t\t\t\tif ( this.props.force_full === true || (this.props.force_full !== false && this.props.want_full && this.state.full) )\n\t\t\t\t\tdoc = this.state.full;\n\t\t\t\tif ( this.props.force_mid === true || (this.props.force_mid !== false && this.props.want_mid && this.state.mid) )\n\t\t\t\t\tdoc = this.state.mid;\n\t\t\t\telse\n\t\t\t\t\tdoc = this.state.short;\n\n\t\t\t\tif ( t.has_tokenizer && this.state.v && this.state.v > t.tokenizer.VERSION)\n\t\t\t\t\tdoc = null;\n\n\t\t\t\t//const doc = (this.props.force_full ? this.state.full : null) ?? (this.props.force_mid ? this.state.mid : null) ?? this.state.short;\n\t\t\t\tif ( t.has_tokenizer && this.state.loaded && doc ) {\n\t\t\t\t\treturn (<div class=\"ffz-card-rich tw-full-width tw-overflow-hidden tw-flex tw-flex-column\">\n\t\t\t\t\t\t{t.tokenizer.renderTokens(doc, createElement, {\n\t\t\t\t\t\t\tvue: false,\n\t\t\t\t\t\t\ttList: (...args) => t.i18n.tList(...args),\n\t\t\t\t\t\t\ti18n: t.i18n,\n\n\t\t\t\t\t\t\tlast_player: 0,\n\t\t\t\t\t\t\tplayer_state: this.state.player_state,\n\n\t\t\t\t\t\t\ttogglePlayer: id => {\n\t\t\t\t\t\t\t\tconst player_state = this.state.player_state ?? {};\n\t\t\t\t\t\t\t\tplayer_state[id] = ! player_state[id];\n\n\t\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\t\tplayer_state\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\tlink_click_handler: t.chat.handleLinkClick,\n\n\t\t\t\t\t\t\tfragments: this.state.fragments,\n\t\t\t\t\t\t\ti18n_prefix: this.state.i18n_prefix,\n\n\t\t\t\t\t\t\tallow_media: t.chat.context.get('tooltip.link-images'),\n\t\t\t\t\t\t\tallow_unsafe: t.chat.context.get('tooltip.link-nsfw-images')\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>);\n\n\t\t\t\t} else\n\t\t\t\t\treturn this.renderBasic();\n\t\t\t}\n\n\t\t\trenderBasic() {\n\t\t\t\tlet title, description;\n\t\t\t\tif ( this.state.error ) {\n\t\t\t\t\ttitle = t.i18n.t('card.error', 'An error occurred.');\n\t\t\t\t\tdescription = this.state.error;\n\n\t\t\t\t} else if ( this.state.loaded && this.state.has_tokenizer ) {\n\t\t\t\t\ttitle = this.state.title;\n\t\t\t\t\tdescription = this.state.description;\n\t\t\t\t} else {\n\t\t\t\t\tdescription = t.i18n.t('card.loading', 'Loading...');\n\t\t\t\t}\n\n\t\t\t\tif ( ! title && ! description )\n\t\t\t\t\tdescription = t.i18n.t('card.empty', 'No data was returned.');\n\n\t\t\t\tdescription = description ? description.split(/\\n+/).slice(0,2).map(desc =>\n\t\t\t\t\t<div class=\"tw-c-text-alt-2 tw-ellipsis tw-mg-x-05\" title={desc}>{desc}</div>\n\t\t\t\t) : [];\n\n\t\t\t\treturn [\n\t\t\t\t\t<div class=\"ffz--header-image\" />,\n\t\t\t\t\t(<div class=\"ffz--card-text tw-full-width tw-overflow-hidden tw-flex tw-flex-column tw-justify-content-center\">\n\t\t\t\t\t\t{title && <div class=\"chat-card__title tw-ellipsis tw-mg-x-05\"><span class=\"tw-strong\" title={title}>{title}</span></div>}\n\t\t\t\t\t\t{description}\n\t\t\t\t\t</div>)\n\t\t\t\t];\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\tlet content = <div class=\"tw-flex tw-flex-nowrap tw-pd-05\">{this.renderCard()}</div>;\n\t\t\t\tconst tooltip = this.props.card_tooltip && this.state.full && ! this.props.force_full;\n\t\t\t\tif ( this.state.url ) {\n\t\t\t\t\tcontent = (<a\n\t\t\t\t\t\tclass={`${tooltip ? 'ffz-tooltip ' : ''}${this.state.accent ? 'ffz-accent-card ' : ''}${this.state.error ? '': 'ffz-interactable--hover-enabled '}tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--default tw-interactive`}\n\t\t\t\t\t\tdata-tooltip-type=\"link\"\n\t\t\t\t\t\tdata-url={this.state.url}\n\t\t\t\t\t\tdata-is-mail={false}\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noreferrer noopener\"\n\t\t\t\t\t\thref={this.state.url}\n\t\t\t\t\t\tonClick={t.chat.handleLinkClick}\n\t\t\t\t\t>\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</a>);\n\t\t\t\t}\n\n\t\t\t\treturn (<div\n\t\t\t\t\tclass={`tw-border-radius-medium tw-elevation-1 ffz--chat-card tw-relative${this.state.unsafe ? ' ffz--unsafe' : ''}`}\n\t\t\t\t\tstyle={{'--ffz-color-accent': this.state.accent || null}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-border-radius-medium tw-c-background-alt tw-flex tw-full-width\">\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\t\t\t}\n\t\t}\n\t}\n}","'use strict';\n\n// ============================================================================\n// Chat Line\n// ============================================================================\n\nimport Twilight from 'site';\nimport Module from 'utilities/module';\n\nimport RichContent from './rich_content';\nimport { has } from 'utilities/object';\nimport { KEYS, RERENDER_SETTINGS, UPDATE_BADGE_SETTINGS, UPDATE_TOKEN_SETTINGS } from 'utilities/constants';\nimport { print_duration } from 'utilities/time';\n\nimport { getRewardTitle, getRewardCost, isGiantEmoteReward, doesRewardCostBits, isMessageEffect } from './points';\nimport awaitMD, {getMD} from 'utilities/markdown';\n\nconst SUB_TIERS = {\n\t1000: 1,\n\t2000: 2,\n\t3000: 3\n};\n\n\nexport default class ChatLine extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('chat');\n\t\tthis.inject('site');\n\t\tthis.inject('site.fine');\n\t\tthis.inject(RichContent);\n\t\tthis.inject('experiments');\n\n\t\tthis.inject('chat.actions');\n\t\tthis.inject('chat.overrides');\n\t\tthis.inject('chat.emotes');\n\n\t\tthis.line_types = {};\n\n\t\tthis.line_types.unknown = {\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\treturn `Unknown message type: ${msg.ffz_type}`\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.notice = {\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\tconst data = msg.ffz_data;\n\t\t\t\tlet content = this.line_types.notice.renderContent(msg, current_user, room, inst, e);\n\n\t\t\t\tif ( ! data.icon )\n\t\t\t\t\treturn content;\n\n\t\t\t\tif ( typeof content === 'string' )\n\t\t\t\t\tcontent = e('span', {}, content);\n\n\t\t\t\tif ( typeof data.icon === 'function' ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcontent.ffz_icon = data.icon(data, inst, e);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.log.capture(err);\n\t\t\t\t\t\tthis.log.error('Error using custom renderer for notice:', err);\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( data.icon instanceof URL )\n\t\t\t\t\tcontent.ffz_icon = e('img', {\n\t\t\t\t\t\tclassName: 'ffz-notice-icon tw-mg-r-05',\n\t\t\t\t\t\tsrc: data.icon.toString()\n\t\t\t\t\t});\n\n\t\t\t\telse\n\t\t\t\t\tcontent.ffz_icon = e('span', {\n\t\t\t\t\t\tclassName: `${data.icon} tw-mg-r-05`\n\t\t\t\t\t});\n\n\t\t\t\treturn content;\n\t\t\t},\n\n\t\t\trenderContent: (msg, current_user, room, inst, e) => {\n\t\t\t\tconst data = msg.ffz_data;\n\t\t\t\tif ( data.renderer )\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn data.renderer(data, inst, e);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.log.capture(err);\n\t\t\t\t\t\tthis.log.error('Error using custom renderer for notice:', err);\n\t\t\t\t\t\treturn `Error rendering notice.`\n\t\t\t\t\t}\n\n\t\t\t\tconst text = data.i18n ? this.i18n.t(data.i18n, data.messgae, data) : data.message;\n\n\t\t\t\tif ( data.markdown ) {\n\t\t\t\t\tconst md = getMD();\n\t\t\t\t\tif ( ! md ) {\n\t\t\t\t\t\tawaitMD().then(() => inst.forceUpdate());\n\t\t\t\t\t\treturn 'Loading...';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn e('span', {\n\t\t\t\t\t\tdangerouslySetInnerHTML: {\n\t\t\t\t\t\t\t__html: getMD().renderInline(text)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif ( data.tokenize ) {\n\t\t\t\t\tconst tokens = data.ffz_tokens = data.ffz_tokens || this.chat.tokenizeMessage({\n\t\t\t\t\t\tbadges: {},\n\t\t\t\t\t\tmessage: text,\n\t\t\t\t\t\tid: msg.id,\n\t\t\t\t\t\tuser: msg.user,\n\t\t\t\t\t\troomLogin: msg.roomLogin,\n\t\t\t\t\t\troomID: msg.roomID\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this.chat.renderTokens(tokens, e);\n\t\t\t\t}\n\n\t\t\t\treturn text;\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.hype = {\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\tconst setting = this.chat.context.get('chat.hype.message-style');\n\t\t\t\tif ( setting === 0 )\n\t\t\t\t\treturn null;\n\n\t\t\t\t// We need to get the message's tokens to see if it has a message or not.\n\t\t\t\tconst user = msg.user,\n\t\t\t\t\ttokens = msg.ffz_tokens = msg.ffz_tokens || this.chat.tokenizeMessage(msg, current_user),\n\t\t\t\t\thas_message = tokens.length > 0;\n\n\t\t\t\tlet amount = msg.hype_amount;\n\t\t\t\tconst digits = msg.hype_exponent ?? 0;\n\t\t\t\tif ( digits > 0 )\n\t\t\t\t\tamount /= Math.pow(10, digits);\n\n\t\t\t\ttry {\n\t\t\t\t\t// TODO: Cache formatter?\n\t\t\t\t\tconst fmt = new Intl.NumberFormat(navigator.languages, {\n\t\t\t\t\t\tstyle: 'currency',\n\t\t\t\t\t\tcurrency: msg.hype_currency,\n\t\t\t\t\t\tcompactDisplay: 'short',\n\t\t\t\t\t\tminimumFractionDigits: digits,\n\t\t\t\t\t\tmaximumFractionDigits: digits\n\t\t\t\t\t});\n\n\t\t\t\t\tamount = fmt.format(amount);\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tamount = `${msg.hype_currency} ${amount}`;\n\t\t\t\t}\n\n\t\t\t\tif (! has_message)\n\t\t\t\t\treturn this.i18n.tList('chat.hype-chat.user', '{user} sent a Hype Chat for {amount}!', {\n\t\t\t\t\t\tamount,\n\t\t\t\t\t\tuser: e('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\tonContextMenu: this.actions.handleUserContext\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, user.displayName))\n\t\t\t\t\t});\n\n\t\t\t\treturn this.i18n.tList(\n\t\t\t\t\t'chat.hype-chat',\n\t\t\t\t\t'Sent a Hype Chat for {amount}!',\n\t\t\t\t\t{\n\t\t\t\t\t\tamount\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.cheer = {\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\treturn this.i18n.tList(\n\t\t\t\t\t'chat.bits-message',\n\t\t\t\t\t'Cheered {count, plural, one {# Bit} other {# Bits}}',\n\t\t\t\t\t{\n\t\t\t\t\t\tcount: msg.bits || 0\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.points = {\n\t\t\tgetClass: (msg) => {\n\t\t\t\tconst highlight = msg.ffz_reward_highlight && this.chat.context.get('chat.points.allow-highlight') === 2;\n\n\t\t\t\treturn `ffz--points-line tw-pd-l-1 tw-pd-r-2 ${highlight ? 'ffz-custom-color ffz--points-highlight' : ''}`;\n\t\t\t},\n\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\tif ( ! msg.ffz_reward )\n\t\t\t\t\treturn null;\n\n\t\t\t\t// We need to get the message's tokens to see if it has a message or not.\n\t\t\t\tconst user = msg.user,\n\t\t\t\t\tis_bits = doesRewardCostBits(msg.ffz_reward),\n\t\t\t\t\ttokens = msg.ffz_tokens = msg.ffz_tokens || this.chat.tokenizeMessage(msg, current_user),\n\t\t\t\t\thas_message = tokens.length > 0;\n\n\t\t\t\t// Elements for the reward and cost with nice formatting.\n\t\t\t\tconst reward = e('span', {className: 'ffz--points-reward'}, getRewardTitle(msg.ffz_reward, this.i18n)),\n\t\t\t\t\tcost = e('span', {className: 'ffz--points-cost'}, [\n\t\t\t\t\t\te('span', {className: is_bits ? 'ffz-i-bits' : 'ffz--points-icon'}),\n\t\t\t\t\t\tthis.i18n.formatNumber(getRewardCost(msg.ffz_reward))\n\t\t\t\t\t]);\n\n\t\t\t\tif (! has_message)\n\t\t\t\t\treturn this.i18n.tList('chat.points.user-redeemed', '{user} redeemed {reward} {cost}', {\n\t\t\t\t\t\treward, cost,\n\t\t\t\t\t\tuser: e('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\tonContextMenu: this.actions.handleUserContext\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, user.displayName))\n\t\t\t\t\t});\n\n\t\t\t\treturn this.i18n.tList('chat.points.redeemed', 'Redeemed {reward} {cost}', {reward, cost});\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.resub = {\n\t\t\tgetClass: () => `ffz--subscribe-line tw-pd-r-2`,\n\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\tconst months = msg.sub_cumulative || msg.sub_months,\n\t\t\t\t\tsetting = this.chat.context.get('chat.subs.show');\n\n\t\t\t\tlet has_message;\n\t\t\t\tif (setting === 1 && months > 1) {\n\t\t\t\t\tconst tokens = msg.ffz_tokens = msg.ffz_tokens || this.chat.tokenizeMessage(msg, current_user);\n\t\t\t\t\thas_message = tokens.length > 0;\n\t\t\t\t}\n\n\t\t\t\tif ( !(setting === 3 || (setting === 1 && has_message && months > 1) || (setting === 2 && months > 1)) )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst user = msg.user,\n\t\t\t\t\tplan = msg.sub_plan || {},\n\t\t\t\t\ttier = SUB_TIERS[plan.plan] || 1,\n\t\t\t\t\tmulti = msg.sub_multi,\n\n\t\t\t\t\thas_multi = (multi?.count ?? 0) > 1 && multi.tenure === 0;\n\n\t\t\t\tconst sub_msg = this.i18n.tList(\n\t\t\t\t\t`chat.sub.main${has_multi ? '-multi' : ''}`,\n\t\t\t\t\t`{user} subscribed {plan}${has_multi ? ' for {multi, plural, one {# month} other {# months}} in advance' : ''}. `,\n\t\t\t\t\t{\n\t\t\t\t\t\tuser: e('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\tonContextMenu: this.actions.handleUserContext\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, user.displayName)),\n\t\t\t\t\t\tplan: plan.prime ?\n\t\t\t\t\t\t\tthis.i18n.t('chat.sub.twitch-prime', 'with Prime Gaming') :\n\t\t\t\t\t\t\tthis.i18n.t('chat.sub.plan', 'at Tier {tier}', {tier}),\n\t\t\t\t\t\tmulti: has_multi\n\t\t\t\t\t\t\t? multi.count\n\t\t\t\t\t\t\t: 1\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif ( msg.sub_share_streak && msg.sub_streak > 1 ) {\n\t\t\t\t\tsub_msg.push(this.i18n.t(\n\t\t\t\t\t\t'chat.sub.cumulative-months',\n\t\t\t\t\t\t\"They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcumulative: msg.sub_cumulative,\n\t\t\t\t\t\t\tstreak: msg.sub_streak\n\t\t\t\t\t\t}\n\t\t\t\t\t));\n\n\t\t\t\t} else if ( months > 1 ) {\n\t\t\t\t\tsub_msg.push(this.i18n.t(\n\t\t\t\t\t\t'chat.sub.months',\n\t\t\t\t\t\t\"They've subscribed for {count,number} months!\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcount: months\n\t\t\t\t\t\t}\n\t\t\t\t\t));\n\t\t\t\t}\n\n\t\t\t\tif ( ! this.chat.context.get('chat.subs.compact') )\n\t\t\t\t\tsub_msg.ffz_icon = e('span', {\n\t\t\t\t\t\tclassName: `ffz-i-${plan.prime ? 'crown' : 'star'} tw-mg-r-05`\n\t\t\t\t\t});\n\n\t\t\t\treturn sub_msg;\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.ritual = {\n\t\t\tgetClass: () => `ffz--ritual-line tw-pd-r-2`,\n\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\tconst user = msg.user;\n\n\t\t\t\tif ( msg.ritual === 'new_chatter' ) {\n\t\t\t\t\treturn this.i18n.tList('chat.ritual', '{user} is new here. Say hello!', {\n\t\t\t\t\t\tuser: e('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\tonContextMenu: this.actions.handleUserContext\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, user.displayName))\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.line_types.sub_gift = {\n\t\t\tgetClass: () => 'ffz--subscribe-line',\n\n\t\t\trenderNotice: (msg, current_user, room, inst, e) => {\n\t\t\t\tconst user = msg.user,\n\n\t\t\t\t\tplan = msg.sub_plan || {},\n\t\t\t\t\tmonths = msg.sub_months || 1,\n\t\t\t\t\ttier = SUB_TIERS[plan.plan] || 1;\n\n\t\t\t\tlet sub_msg;\n\n\t\t\t\tconst bits = {\n\t\t\t\t\tmonths,\n\t\t\t\t\tuser: (msg.sub_anon || user.username === 'ananonymousgifter') ?\n\t\t\t\t\t\tthis.i18n.t('chat.sub.anonymous-gifter', 'An anonymous gifter') :\n\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\tonContextMenu: this.actions.handleUserContext\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, user.displayName)),\n\t\t\t\t\tplan: plan.plan === 'custom' ? '' :\n\t\t\t\t\t\tthis.i18n.t('chat.sub.gift-plan', 'Tier {tier}', {tier}),\n\t\t\t\t\trecipient: e('span', {\n\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t'data-user': JSON.stringify(msg.sub_recipient)\n\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t}, msg.sub_recipient.displayName))\n\t\t\t\t};\n\n\t\t\t\tif ( months <= 1 )\n\t\t\t\t\tsub_msg = this.i18n.tList('chat.sub.mystery', '{user} gifted a {plan} Sub to {recipient}! ', bits);\n\t\t\t\telse\n\t\t\t\t\tsub_msg = this.i18n.tList('chat.sub.gift-months', '{user} gifted {months, plural, one {# month} other {# months}} of {plan} Sub to {recipient}!', bits);\n\n\t\t\t\tif ( msg.sub_total === 1 )\n\t\t\t\t\tsub_msg.push(this.i18n.t('chat.sub.gift-first', \"It's their first time gifting a Sub in the channel!\"));\n\t\t\t\telse if ( msg.sub_total > 1 )\n\t\t\t\t\tsub_msg.push(this.i18n.t('chat.sub.gift-total', \"They've gifted {count,number} Subs in the channel!\", {\n\t\t\t\t\t\tcount: msg.sub_total\n\t\t\t\t\t}));\n\n\t\t\t\tif ( ! this.chat.context.get('chat.subs.compact') )\n\t\t\t\t\tsub_msg.ffz_icon = e('span', {\n\t\t\t\t\t\tclassName: `ffz-i-${plan.prime ? 'crown' : 'star'} tw-mg-r-05`\n\t\t\t\t\t});\n\n\t\t\t\treturn sub_msg;\n\t\t\t}\n\t\t}\n\n\t\tthis.line_types.sub_mystery = {\n\n\t\t\tgetClass: () => 'ffz--subscribe-line',\n\n\t\t\trenderNotice: (msg, user, room, inst, e) => {\n\t\t\t\tconst mystery = msg.mystery;\n\t\t\t\tif ( mystery )\n\t\t\t\t\tmystery.line = inst;\n\n\t\t\t\tconst sub_msg = this.i18n.tList('chat.sub.gift', \"{user} is gifting {count, plural, one {# Tier {tier} Sub} other {# Tier {tier} Subs}} to {channel}'s community! \", {\n\t\t\t\t\tuser: (msg.sub_anon || msg.user.username === 'ananonymousgifter') ?\n\t\t\t\t\t\tthis.i18n.t('chat.sub.anonymous-gifter', 'An anonymous gifter') :\n\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'chatter-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\tonContextMenu: this.actions.handleUserContext\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, msg.user.displayName)),\n\t\t\t\t\tcount: msg.sub_count,\n\t\t\t\t\ttier: SUB_TIERS[msg.sub_plan] || 1,\n\t\t\t\t\tchannel: msg.roomLogin\n\t\t\t\t});\n\n\t\t\t\tif ( msg.sub_total === 1 )\n\t\t\t\t\tsub_msg.push(this.i18n.t('chat.sub.gift-first', \"It's their first time gifting a Sub in the channel!\"));\n\t\t\t\telse if ( msg.sub_total > 1 )\n\t\t\t\t\tsub_msg.push(this.i18n.t('chat.sub.gift-total', \"They've gifted {count} Subs in the channel!\", {\n\t\t\t\t\t\tcount: msg.sub_total\n\t\t\t\t\t}));\n\n\t\t\t\tif ( ! inst.ffz_click_expand )\n\t\t\t\t\tinst.ffz_click_expand = () => {\n\t\t\t\t\t\tinst.setState({\n\t\t\t\t\t\t\tffz_expanded: ! inst.state.ffz_expanded\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\tconst expanded = this.chat.context.get('chat.subs.merge-gifts-visibility') ?\n\t\t\t\t\t! inst.state.ffz_expanded : inst.state.ffz_expanded;\n\n\t\t\t\tlet sub_list = null;\n\t\t\t\tif( expanded && mystery && mystery.recipients && mystery.recipients.length > 0 ) {\n\t\t\t\t\tconst the_list = [];\n\t\t\t\t\tfor(const x of mystery.recipients) {\n\t\t\t\t\t\tif ( the_list.length )\n\t\t\t\t\t\t\tthe_list.push(', ');\n\n\t\t\t\t\t\tthe_list.push(e('span', {\n\t\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\t\tclassName: 'ffz--giftee-name',\n\t\t\t\t\t\t\tonClick: inst.ffz_user_click_handler,\n\t\t\t\t\t\t\t'data-user': JSON.stringify(x)\n\t\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-base tw-strong'\n\t\t\t\t\t\t}, x.displayName)));\n\t\t\t\t\t}\n\n\t\t\t\t\tsub_list = e('div', {\n\t\t\t\t\t\tclassName: 'tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2'\n\t\t\t\t\t}, the_list);\n\t\t\t\t}\n\n\t\t\t\tconst target = [\n\t\t\t\t\tsub_msg\n\t\t\t\t];\n\n\t\t\t\tif ( mystery )\n\t\t\t\t\ttarget.push(e('span', {\n\t\t\t\t\t\tclassName: `tw-pd-l-05 tw-font-size-4 ffz-i-${expanded ? 'down' : 'right'}-dir`\n\t\t\t\t\t}));\n\n\t\t\t\tconst out = [\n\t\t\t\t\te('div', {\n\t\t\t\t\t\tclassName: 'tw-full-width tw-c-text-alt-2',\n\t\t\t\t\t\tonClick: inst.ffz_click_expand\n\t\t\t\t\t}, target),\n\t\t\t\t\tsub_list\n\t\t\t\t];\n\n\t\t\t\tif ( ! this.chat.context.get('chat.subs.compact') )\n\t\t\t\t\tout.ffz_icon = e('span', {\n\t\t\t\t\t\tclassName: `ffz-i-star${msg.sub_anon ? '-empty' : ''} tw-mg-r-05`\n\t\t\t\t\t});\n\n\t\t\t\tout.ffz_target = target;\n\t\t\t\treturn out;\n\t\t\t}\n\t\t};\n\n\t\tthis.ChatLine = this.fine.define(\n\t\t\t'chat-line',\n\t\t\tn => n.renderMessageBody && n.props && ! n.onExtensionNameClick && !has(n.props, 'hasModPermissions'),\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ExtensionLine = this.fine.define(\n\t\t\t'extension-line',\n\t\t\tn => n.renderMessageBody && n.onExtensionNameClick,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.WhisperLine = this.fine.define(\n\t\t\t'whisper-line',\n\t\t\tn => n.props && n.props.message && has(n.props, 'reportOutgoingWhisperRendered')\n\t\t)\n\t}\n\n\tasync onEnable() {\n\t\tthis.on('chat.overrides:changed', id => this.updateLinesByUser(id, null, false, false), this);\n\t\tthis.on('chat:update-lines-by-user', this.updateLinesByUser, this);\n\t\tthis.on('chat:update-line', this.updateLineById, this);\n\t\tthis.on('chat:update-lines', this.updateLines, this);\n\t\tthis.on('chat:rerender-lines', this.rerenderLines, this);\n\t\tthis.on('chat:update-line-tokens', this.updateLineTokens, this);\n\t\tthis.on('chat:update-line-badges', this.updateLineBadges, this);\n\t\tthis.on('i18n:update', this.rerenderLines, this);\n\t\tthis.on('chat.emotes:update-effects', this.checkEffects, this);\n\n\t\tthis.can_reprocess = true;\n\n\t\tthis.on('chat:reload-data', () => this.can_reprocess = true);\n\t\tthis.on('chat:room-add', () => this.can_reprocess = true);\n\n\t\tthis.on('load_tracker:complete:chat-data', () => {\n\t\t\tconst val = this.chat.context.get('chat.update-when-loaded');\n\t\t\tif ( ! val || ! this.can_reprocess )\n\t\t\t\treturn;\n\n\t\t\tthis.can_reprocess = false;\n\t\t\tthis.log.info('Reprocessing chat lines due to data loads.');\n\t\t\tthis.updateLines();\n\t\t});\n\n\t\tfor(const setting of RERENDER_SETTINGS)\n\t\t\tthis.chat.context.on(`changed:${setting}`, this.rerenderLines, this);\n\n\t\tfor(const setting of UPDATE_TOKEN_SETTINGS)\n\t\t\tthis.chat.context.on(`changed:${setting}`, this.updateLineTokens, this);\n\n\t\tfor(const setting of UPDATE_BADGE_SETTINGS)\n\t\t\tthis.chat.context.on(`changed:${setting}`, this.updateLineBadges, this);\n\n\t\tthis.chat.context.on('changed:tooltip.link-images', this.maybeUpdateLines, this);\n\t\tthis.chat.context.on('changed:tooltip.link-nsfw-images', this.maybeUpdateLines, this);\n\n\t\tthis.on('chat:get-messages', (include_chat, include_whisper, include_video, messages) => {\n\t\t\tif ( include_chat ) {\n\t\t\t\tfor(const inst of this.ChatLine.instances) {\n\t\t\t\t\tconst msg = inst.props.message;\n\t\t\t\t\tif ( msg )\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\t\t_instance: inst,\n\t\t\t\t\t\t\tupdate: () => inst.forceUpdate()\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfor(const inst of this.ExtensionLine.instances) {\n\t\t\t\t\tconst msg = inst.props.message;\n\t\t\t\t\tif ( msg )\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\t\t_instance: inst,\n\t\t\t\t\t\t\tupdate: () => inst.forceUpdate()\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( include_whisper )\n\t\t\t\tfor(const inst of this.WhisperLine.instances) {\n\t\t\t\t\tconst msg = inst.props.message;\n\t\t\t\t\tif ( msg && msg._ffz_message )\n\t\t\t\t\t\tmessages.push({\n\t\t\t\t\t\t\tmessage: msg._ffz_message,\n\t\t\t\t\t\t\t_instance: inst,\n\t\t\t\t\t\t\tupdate: () => inst.forceUpdate()\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t});\n\n\t\tthis.on('chat:get-tab-commands', e => {\n\t\t\tif ( this.experiments.getTwitchAssignmentByName('chat_replies') === 'control' )\n\t\t\t\treturn;\n\n\t\t\te.commands.push({\n\t\t\t\tname: 'reply',\n\t\t\t\tdescription: 'Reply to a user\\'s last message.',\n\t\t\t\tpermissionLevel: 0,\n\t\t\t\tffz_group: 'FrankerFaceZ',\n\t\t\t\tcommandArgs: [\n\t\t\t\t\t{name: 'username', isRequired: true},\n\t\t\t\t\t{name: 'message', isRequired: false}\n\t\t\t\t]\n\t\t\t})\n\t\t});\n\n\t\tthis.on('chat:pre-send-message', e => {\n\t\t\tif ( this.experiments.getTwitchAssignmentByName('chat_replies') === 'control' )\n\t\t\t\treturn;\n\n\t\t\tconst msg = e.message,\n\t\t\t\ttypes = this.parent.chat_types || {};\n\n\t\t\tlet user, message;\n\t\t\tif ( /^\\/reply ?/i.test(msg) )\n\t\t\t\tuser = msg.slice(7).trim();\n\t\t\telse\n\t\t\t\treturn;\n\n\t\t\te.preventDefault();\n\n\t\t\tconst idx = user.indexOf(' ');\n\t\t\tif ( idx !== -1 ) {\n\t\t\t\tmessage = user.slice(idx + 1);\n\t\t\t\tuser = user.slice(0, idx);\n\t\t\t}\n\n\t\t\tif ( user.startsWith('@') )\n\t\t\t\tuser = user.slice(1);\n\n\t\t\tif ( user && user.length ) {\n\t\t\t\tuser = user.toLowerCase();\n\n\t\t\t\tconst lines = Array.from(this.ChatLine.instances);\n\t\t\t\tlet i = lines.length;\n\t\t\t\twhile(i--) {\n\t\t\t\t\tconst line = lines[i],\n\t\t\t\t\t\tmsg = line?.props?.message,\n\t\t\t\t\t\tu = msg?.user;\n\n\t\t\t\t\tif ( ! u )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif ( u.login === user || u.displayName?.toLowerCase?.() === user ) {\n\t\t\t\t\t\tif ( message ) {\n\t\t\t\t\t\t\te.sendMessage(message, {\n\t\t\t\t\t\t\t\treply: {\n\t\t\t\t\t\t\t\t\tparentDeleted: msg.deleted || false,\n\t\t\t\t\t\t\t\t\tparentDisplayName: u.displayName,\n\t\t\t\t\t\t\t\t\tparentMessageBody: msg.message,\n\t\t\t\t\t\t\t\t\tparentMsgId: msg.id,\n\t\t\t\t\t\t\t\t\tparentUid: u.id,\n\t\t\t\t\t\t\t\t\tparentUserLogin: u.login\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\trequestAnimationFrame(() => line.ffzOpenReply());\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.addMessage({\n\t\t\t\ttype: types.Notice,\n\t\t\t\tmessage: this.i18n.t('chat.reply.bad-user', 'Invalid user or no known message to reply to.')\n\t\t\t});\n\t\t});\n\n\t\tconst t = this,\n\t\t\tReact = await this.site.findReact();\n\t\tif ( ! React )\n\t\t\treturn;\n\n\t\tconst e = React.createElement,\n\t\t\tFFZRichContent = this.rich_content && this.rich_content.RichContent;\n\n\n\t\tthis.WhisperLine.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tthis._ffz_no_scan = true;\n\n\t\t\t\tif ( ! this.props.message || ! this.props.message.content || ! this.props.message.from )\n\t\t\t\t\treturn old_render.call(this);\n\n\t\t\t\ttry {\n\t\t\t\t\tconst msg = t.chat.standardizeWhisper(this.props.message),\n\n\t\t\t\t\t\tis_action = msg.is_action,\n\t\t\t\t\t\taction_style = is_action ? t.chat.context.get('chat.me-style') : 0,\n\t\t\t\t\t\taction_italic = action_style >= 2,\n\t\t\t\t\t\taction_color = action_style === 1 || action_style === 3,\n\t\t\t\t\t\tuser = msg.user,\n\t\t\t\t\t\traw_color = t.overrides.getColor(user.id) || user.color,\n\t\t\t\t\t\tcolor = t.parent.colors.process(raw_color),\n\n\t\t\t\t\t\ttokens = msg.ffz_tokens = msg.ffz_tokens || t.chat.tokenizeMessage(msg, null),\n\t\t\t\t\t\tcontents = t.chat.renderTokens(tokens, e),\n\n\t\t\t\t\t\toverride_name = t.overrides.getName(user.id);\n\n\t\t\t\t\treturn e('div', {className: 'thread-message__message'},\n\t\t\t\t\t\te('div', {className: 'tw-pd-x-1 tw-pd-y-05'}, [\n\t\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\t\tclassName: `thread-message__message--user-name notranslate${override_name ? ' ffz--name-override' : ''}`,\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tcolor\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, override_name || user.displayName),\n\t\t\t\t\t\t\te('span', null, is_action ? ' ' : ': '),\n\t\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\t\tclassName: `message${action_italic ? ' chat-line__message-body--italicized' : ''}`,\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tcolor: action_color && color\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, contents)\n\t\t\t\t\t\t])\n\t\t\t\t\t);\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.error(err);\n\t\t\t\t\tt.log.capture(err, {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tprops: this.props\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn old_render.call(this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do this after a short delay to hopefully reduce the chance of React\n\t\t\t// freaking out on us.\n\t\t\tsetTimeout(() => this.WhisperLine.forceUpdate());\n\t\t});\n\n\t\tthis.ChatLine.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.shouldComponentUpdate = function(props, state) {\n\t\t\t\tconst show = state && state.alwaysShowMessage || ! props.message.deleted,\n\t\t\t\t\told_show = this._ffz_show;\n\n\t\t\t\t// We can't just compare props.message.deleted to this.props.message.deleted\n\t\t\t\t// because the message object is the same object. So, store the old show\n\t\t\t\t// state for later reference.\n\t\t\t\tthis._ffz_show = show;\n\n\t\t\t\treturn show !== old_show ||\n\t\t\t\t\t(state && this.state && (state.ffz_expanded !== this.state.ffz_expanded)) ||\n\t\t\t\t\t//state.renderDebug !== this.state.renderDebug ||\n\t\t\t\t\tprops.deletedMessageDisplay !== this.props.deletedMessageDisplay ||\n\t\t\t\t\tprops.deletedCount !== this.props.deletedCount ||\n\t\t\t\t\tprops.message !== this.props.message ||\n\t\t\t\t\tprops.isCurrentUserModerator !== this.props.isCurrentUserModerator ||\n\t\t\t\t\tprops.showModerationIcons !== this.props.showModerationIcons ||\n\t\t\t\t\tprops.showTimestamps !== this.props.showTimestamps ||\n\t\t\t\t\t(props.pinnedMessage?.message?.id === props.message?.id) !== (this.props.pinnedMessage?.message?.id === this.props.message?.id);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzOpenReply = function() {\n\t\t\t\tif ( this.onMessageClick ) {\n\t\t\t\t\treturn this.onMessageClick();\n\t\t\t\t}\n\n\t\t\t\tif ( this.props.reply ) {\n\t\t\t\t\tthis.setOPCardTray(this.props.reply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( this.props.hasReply ) {\n\t\t\t\t\tconst msg = this.props.message;\n\t\t\t\t\tif (msg?.user) {\n\t\t\t\t\t\tthis.setOPCardTray({\n\t\t\t\t\t\t\tparentMsgId: msg.id,\n\t\t\t\t\t\t\tparentUid: msg.user.userID,\n\t\t\t\t\t\t\tparentUserLogin: msg.user.userLogin,\n\t\t\t\t\t\t\tparentDeleted: msg.deleted,\n\t\t\t\t\t\t\tparentDisplayName: msg.user.userDisplayName,\n\t\t\t\t\t\t\tparentMessageBody: msg.messageBody\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t\t\t\tconst old_render_author = this.renderMessageAuthor;\n\t\t\t\tthis.renderMessageAuthor = () => this.ffzReplyAuthor();\n\n\t\t\t\tconst tokens = this.props.message?.ffz_tokens;\n\t\t\t\tif ( ! tokens )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.setMessageTray(this.props.message, t.chat.renderTokens(tokens, e));\n\n\t\t\t\tthis.renderMessageAuthor = old_render_author;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzReplyAuthor = function() {\n\t\t\t\tconst msg = t.chat.standardizeMessage(this.props.message),\n\t\t\t\t\tuser = msg.user,\n\t\t\t\t\traw_color = t.overrides.getColor(user.id) || user.color,\n\t\t\t\t\tcolor = t.parent.colors.process(raw_color);\n\n\t\t\t\tlet room = msg.roomLogin ? msg.roomLogin : msg.channel ? msg.channel.slice(1) : undefined,\n\t\t\t\t\troom_id = msg.roomId ? msg.roomId : this.props.channelID;\n\n\t\t\t\tif ( ! room && room_id ) {\n\t\t\t\t\tconst r = t.chat.getRoom(room_id, null, true);\n\t\t\t\t\tif ( r && r.login )\n\t\t\t\t\t\troom = msg.roomLogin = r.login;\n\t\t\t\t}\n\n\t\t\t\tif ( ! room_id && room ) {\n\t\t\t\t\tconst r = t.chat.getRoom(null, room_id, true);\n\t\t\t\t\tif ( r && r.id )\n\t\t\t\t\t\troom_id = msg.roomId = r.id;\n\t\t\t\t}\n\n\t\t\t\tconst user_block = t.chat.formatUser(user, e);\n\t\t\t\tconst override_name = t.overrides.getName(user.id);\n\n\t\t\t\treturn e('span', {\n\t\t\t\t\t'data-room-id': room_id,\n\t\t\t\t\t'data-room': room,\n\t\t\t\t\t'data-user-id': user.userID,\n\t\t\t\t\t'data-user': user.userLogin && user.userLogin.toLowerCase()\n\t\t\t\t}, [\n\t\t\t\t\t//t.actions.renderInline(msg, this.props.showModerationIcons, u, r, e),\n\t\t\t\t\te('span', {\n\t\t\t\t\t\tclassName: 'chat-line__message--badges'\n\t\t\t\t\t}, t.chat.badges.render(msg, e)),\n\t\t\t\t\te('span', {\n\t\t\t\t\t\tclassName: `chat-line__username notranslate${override_name ? ' ffz--name-override tw-relative ffz-il-tooltip__container' : ''}`,\n\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\tstyle: { color },\n\t\t\t\t\t\tonClick: this.ffz_user_click_handler,\n\t\t\t\t\t\tonContextMenu: t.actions.handleUserContext\n\t\t\t\t\t}, override_name ? [\n\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\tclassName: 'chat-author__display-name'\n\t\t\t\t\t\t}, override_name),\n\t\t\t\t\t\te('div', {\n\t\t\t\t\t\t\tclassName: 'ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center'\n\t\t\t\t\t\t}, user_block)\n\t\t\t\t\t] : user_block)\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzRenderSharedChatPill = function() {\n\t\t\t\tlet style = t.chat.context.get('chat.shared-chat.style');\n\t\t\t\tif ( style == null )\n\t\t\t\t\tstyle = this.props.isCurrentUserModerator ? 2 : 0;\n\t\t\t\tif ( style === 0 )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst msg = this.props.message,\n\t\t\t\t\tsource_id = msg.sourceRoomID,\n\t\t\t\t\tsource = source_id && this.props.sharedChatDataByChannelID?.get(source_id),\n\t\t\t\t\tin_source = ! source || source_id === (msg.roomId ?? this.props.channelID);\n\n\t\t\t\tif ( ! source )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst title = t.i18n.t('chat.sent-from-source', 'Sent from {source}', {source: source.displayName ?? source.login});\n\n\t\t\t\tif ( style === 1 )\n\t\t\t\t\treturn e('span', {\n\t\t\t\t\t\tclassName: `ffz-pill ffz-tooltip tw-mg-r-05 ${in_source ? 'ffz-pill--brand' : ''}`,\n\t\t\t\t\t\t'data-title': title\n\t\t\t\t\t}, `${source.displayName ?? source.login}`);\n\n\t\t\t\tif ( style === 2 )\n\t\t\t\t\treturn e('figure', {\n\t\t\t\t\t\tclassName: `ffz-tooltip ffz-tooltip--no-mouse ffz-shared-chat-badge ffz-avatar tw-border-radius-rounded ${in_source ? 'ffz-shared-chat-badge--active' : ''} tw-mg-r-05`,\n\t\t\t\t\t\t'data-title': t.i18n.t('chat.sent-from-source', 'Sent from {source}', {source: source.displayName}),\n\t\t\t\t\t}, e('img', {\n\t\t\t\t\t\tclassName: 'tw-block tw-border-radius-rounded tw-image',\n\t\t\t\t\t\tsrc: source.profileImageURL,\n\t\t\t\t\t\talt: source.displayName\n\t\t\t\t\t}));\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzNewRender = function() { try {\n\t\t\t\tthis._ffz_no_scan = true;\n\n\t\t\t\tconst msg = t.chat.standardizeMessage(this.props.message),\n\t\t\t\t\toverride_mode = t.chat.context.get('chat.filtering.display-deleted');\n\n\t\t\t\t// Before anything else, check to see if the deleted message view is set\n\t\t\t\t// to BRIEF and the message is deleted. In that case we can exit very\n\t\t\t\t// early.\n\t\t\t\tlet mod_mode = this.props.deletedMessageDisplay;\n\t\t\t\tif ( override_mode )\n\t\t\t\t\tmod_mode = override_mode;\n\t\t\t\telse if ( ! this.props.isCurrentUserModerator && mod_mode === 'DETAILED' )\n\t\t\t\t\tmod_mode = 'LEGACY';\n\n\t\t\t\tif ( mod_mode === 'BRIEF' && msg.deleted ) {\n\t\t\t\t\tconst deleted_count = this.props.deletedCount;\n\t\t\t\t\tif ( deleted_count == null )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn e(\n\t\t\t\t\t\t'div', {\n\t\t\t\t\t\t\tclassName: 'chat-line__status'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tt.i18n.t('chat.deleted-messages', `{count,plural,\none {One message was deleted by a moderator.}\nother {# messages were deleted by a moderator.}\n}`, {\n\t\t\t\t\t\t\tcount: deleted_count\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// First, we need to handle Shared Chat.\n\t\t\t\tconst source_id = msg.sourceRoomID,\n\t\t\t\t\tsource = source_id && this.props.sharedChatDataByChannelID?.get(source_id);\n\n\t\t\t\t// Get the current room id and login. We might need to look these up.\n\t\t\t\tlet room = msg.roomLogin ? msg.roomLogin : msg.channel ? msg.channel.slice(1) : undefined,\n\t\t\t\t\troom_id = msg.roomId ? msg.roomId : this.props.channelID;\n\n\t\t\t\tif ( ! room && room_id ) {\n\t\t\t\t\tconst r = t.chat.getRoom(room_id, null, true);\n\t\t\t\t\tif ( r && r.login )\n\t\t\t\t\t\troom = msg.roomLogin = r.login;\n\t\t\t\t}\n\n\t\t\t\tif ( ! room_id && room ) {\n\t\t\t\t\tconst r = t.chat.getRoom(null, room, true);\n\t\t\t\t\tif ( r && r.id )\n\t\t\t\t\t\troom_id = msg.roomId = r.id;\n\t\t\t\t}\n\n\t\t\t\t// Construct the current room and current user objects.\n\t\t\t\tconst current_user = t.site.getUser(),\n\t\t\t\t\tcurrent_room = {id: room_id, login: room};\n\n\t\t\t\tconst is_in_source = ! source || source_id === room_id,\n\t\t\t\t\tsource_room = is_in_source\n\t\t\t\t\t\t? current_room\n\t\t\t\t\t\t: {id: source_id, login: source.login};\n\n\t\t\t\tconst reply_mode = t.chat.context.get('chat.replies.style'),\n\t\t\t\t\thas_replies = this.props && !!(this.props.hasReply || this.props.reply || ! this.props.replyRestrictedReason),\n\t\t\t\t\tcan_replies = has_replies && msg.message && ! msg.deleted && ! this.props.disableReplyClick,\n\t\t\t\t\tcan_reply = can_replies && (has_replies || (current_user && current_user.login !== msg.user?.login));\n\n\t\t\t\tif ( current_user ) {\n\t\t\t\t\tcurrent_user.moderator = this.props.isCurrentUserModerator;\n\t\t\t\t\tcurrent_user.staff = this.props.isCurrentUserStaff;\n\t\t\t\t\tcurrent_user.reply_mode = reply_mode;\n\t\t\t\t\tcurrent_user.can_reply = can_reply;\n\t\t\t\t}\n\n\t\t\t\t// Set up our click handlers as necessary.\n\t\t\t\tif ( ! this.ffz_open_reply )\n\t\t\t\t\tthis.ffz_open_reply = this.ffzOpenReply.bind(this);\n\n\t\t\t\tif ( ! this.ffz_user_click_handler ) {\n\t\t\t\t\tif ( this.props.onUsernameClick )\n\t\t\t\t\t\tthis.ffz_user_click_handler = event => {\n\t\t\t\t\t\t\tif ( this.isKeyboardEvent(event) && event.keyCode !== KEYS.Space && event.keyCode !== KEYS.Enter )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tconst target = event.currentTarget,\n\t\t\t\t\t\t\t\tds = target && target.dataset;\n\t\t\t\t\t\t\tlet target_user = msg.user;\n\n\t\t\t\t\t\t\tif ( ds && ds.user ) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\ttarget_user = JSON.parse(ds.user);\n\t\t\t\t\t\t\t\t} catch(err) { /* nothing~! */ }\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst fe = t.makeEvent({\n\t\t\t\t\t\t\t\tinst: this,\n\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\t\t\tuser: target_user,\n\t\t\t\t\t\t\t\troom: current_room,\n\t\t\t\t\t\t\t\tsource: source_room\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tt.emit('chat:user-click', fe);\n\n\t\t\t\t\t\t\tif ( fe.defaultPrevented )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tthis.props.onUsernameClick(target_user.login, 'chat_message', msg.id, target.getBoundingClientRect().bottom);\n\t\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.ffz_user_click_handler = this.openViewerCard || this.usernameClickHandler; //event => event.ctrlKey ? this.usernameClickHandler(event) : t.viewer_cards.openCard(r, user, event);\n\t\t\t\t}\n\n\t\t\t\tlet notice;\n\t\t\t\tlet klass;\n\t\t\t\tlet bg_css = null;\n\n\t\t\t\t// Do we have a special renderer?\n\t\t\t\tlet type = msg.ffz_type && t.line_types[msg.ffz_type];\n\t\t\t\tif ( ! type && msg.bits > 0 && t.chat.context.get('chat.bits.cheer-notice') )\n\t\t\t\t\ttype = t.line_types.cheer;\n\n\t\t\t\tif ( ! type && msg.ffz_type )\n\t\t\t\t\ttype = t.line_types.unknown;\n\n\t\t\t\tif ( type ) {\n\t\t\t\t\tif ( type.render )\n\t\t\t\t\t\treturn type.render(msg, current_user, current_room, this, e);\n\n\t\t\t\t\tif ( type.renderNotice )\n\t\t\t\t\t\tnotice = type.renderNotice(msg, current_user, current_room, this, e);\n\n\t\t\t\t\tif ( type.getClass )\n\t\t\t\t\t\tklass = type.getClass(msg, current_user, current_room, this, e);\n\t\t\t\t}\n\n\t\t\t\t// Render the line.\n\t\t\t\tconst user = msg.user,\n\t\t\t\t\tanim_hover = t.chat.context.get('chat.emotes.animated') === 2;\n\n\t\t\t\t// Cache the lower login\n\t\t\t\tif ( user && ! user.lowerLogin && user.userLogin )\n\t\t\t\t\tuser.lowerLogin = user.userLogin.toLowerCase();\n\n\t\t\t\t// Ensure we have a string for klass.\n\t\t\t\tklass = klass || '';\n\n\t\t\t\t// RENDERING: Start~\n\n\t\t\t\t// First, check how we should handle a deleted message.\n\t\t\t\tlet show;\n\t\t\t\tlet deleted;\n\t\t\t\tlet mod_action = null;\n\n\t\t\t\tif ( mod_mode === 'BRIEF' ) {\n\t\t\t\t\t// We already handle msg.deleted for BRIEF earlier than this.\n\t\t\t\t\tshow = true;\n\t\t\t\t\tdeleted = false;\n\n\t\t\t\t} else if ( mod_mode === 'DETAILED' ) {\n\t\t\t\t\tshow = true;\n\t\t\t\t\tdeleted = msg.deleted;\n\n\t\t\t\t} else {\n\t\t\t\t\tshow = this.state?.alwaysShowMessage || ! msg.deleted;\n\t\t\t\t\tdeleted = false;\n\t\t\t\t}\n\n\t\t\t\tif ( msg.deleted ) {\n\t\t\t\t\tconst show_mode = t.chat.context.get('chat.filtering.display-mod-action');\n\t\t\t\t\tif ( show_mode === 2 || (show_mode === 1 && mod_mode === 'DETAILED') ) {\n\t\t\t\t\t\tconst action = msg.modActionType;\n\t\t\t\t\t\tif ( action === 'timeout' )\n\t\t\t\t\t\t\tmod_action = t.i18n.t('chat.mod-action.timeout',\n\t\t\t\t\t\t\t\t'{duration} Timeout'\n\t\t\t\t\t\t\t\t, {\n\t\t\t\t\t\t\t\t\tduration: print_duration(msg.duration || 1)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\telse if ( action === 'ban' )\n\t\t\t\t\t\t\tmod_action = t.i18n.t('chat.mod-action.ban', 'Banned');\n\t\t\t\t\t\telse if ( action === 'delete' || ! action )\n\t\t\t\t\t\t\tmod_action = t.i18n.t('chat.mod-action.delete', 'Deleted');\n\n\t\t\t\t\t\tif ( mod_action && msg.modLogin )\n\t\t\t\t\t\t\tmod_action = t.i18n.t('chat.mod-action.by', '{action} by {login}', {\n\t\t\t\t\t\t\t\tlogin: msg.modLogin,\n\t\t\t\t\t\t\t\taction: mod_action\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif ( mod_action )\n\t\t\t\t\t\t\tmod_action = e('span', {\n\t\t\t\t\t\t\t\tclassName: 'tw-pd-l-05',\n\t\t\t\t\t\t\t\t'data-test-selector': 'chat-deleted-message-attribution'\n\t\t\t\t\t\t\t}, `(${mod_action})`);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Are we listing highlight reasons?\n\t\t\t\tlet highlight_tags = null;\n\t\t\t\tconst hl_position = t.chat.context.get('chat.filtering.show-reasons');\n\n\t\t\t\tif ( msg.highlights?.size && hl_position ) {\n\t\t\t\t\thighlight_tags = [];\n\n\t\t\t\t\tfor(const tag of msg.highlights) {\n\t\t\t\t\t\tconst reason = t.chat._hl_reasons[tag];\n\t\t\t\t\t\tlet label,\n\t\t\t\t\t\t\ttooltip;\n\n\t\t\t\t\t\tif ( reason ) {\n\t\t\t\t\t\t\ttooltip = reason.i18n_key\n\t\t\t\t\t\t\t\t? t.i18n.t(reason.i18n_key, reason.title)\n\t\t\t\t\t\t\t\t: reason.title;\n\n\t\t\t\t\t\t\tlabel = reason.i18n_label\n\t\t\t\t\t\t\t\t? t.i18n.t(reason.i18n_label, reason.label)\n\t\t\t\t\t\t\t\t: reason.label;\n\n\t\t\t\t\t\t\tif ( label === tooltip )\n\t\t\t\t\t\t\t\ttooltip = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( ! label )\n\t\t\t\t\t\t\tlabel = tag;\n\n\t\t\t\t\t\thighlight_tags.push(e('span', {\n\t\t\t\t\t\t\tclassName: `ffz-pill ffz-highlight-tag${reason ? ' ffz-tooltip' : ''}`,\n\t\t\t\t\t\t\t'data-title': tooltip\n\t\t\t\t\t\t}, label));\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( highlight_tags.length > 0 )\n\t\t\t\t\t\thighlight_tags = e('span', {\n\t\t\t\t\t\t\tclassName: `ffz-highlight-tags ${\n\t\t\t\t\t\t\t\thl_position === 1\n\t\t\t\t\t\t\t\t\t? 'ffz-highlight-tags__above'\n\t\t\t\t\t\t\t\t\t: 'tw-mg-r-05'\n\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t}, highlight_tags);\n\t\t\t\t\telse\n\t\t\t\t\t\thighlight_tags = null;\n\t\t\t\t}\n\n\t\t\t\t// Check to see if we have message content to render.\n\t\t\t\tconst tokens = msg.ffz_tokens = msg.ffz_tokens || t.chat.tokenizeMessage(msg, current_user),\n\t\t\t\t\thas_message = tokens.length > 0 || ! notice;\n\n\t\t\t\tlet message;\n\n\t\t\t\tif ( has_message ) {\n\t\t\t\t\t// Let's calculate some remaining values that we need.\n\t\t\t\t\tconst reply_tokens = (reply_mode === 2 || (reply_mode === 1 && this.props.repliesAppearancePreference && this.props.repliesAppearancePreference !== 'expanded'))\n\t\t\t\t\t\t? (msg.ffz_reply = msg.ffz_reply || t.chat.tokenizeReply(this.props.reply))\n\t\t\t\t\t\t: null;\n\n\t\t\t\t\tconst is_action = t.parent.message_types && t.parent.message_types.Action === msg.messageType,\n\t\t\t\t\t\tis_giant_emote = this.props.isLastEmoteGigantified || isGiantEmoteReward(msg.ffz_reward),\n\n\t\t\t\t\t\taction_style = is_action ? t.chat.context.get('chat.me-style') : 0,\n\t\t\t\t\t\taction_italic = action_style >= 2,\n\t\t\t\t\t\taction_color = action_style === 1 || action_style === 3;\n\n\t\t\t\t\tconst raw_color = t.overrides.getColor(user.id) || user.color,\n\t\t\t\t\t\tcolor = t.parent.colors.process(raw_color);\n\n\t\t\t\t\tconst rich_content = show && FFZRichContent && t.chat.pluckRichContent(tokens, msg),\n\t\t\t\t\t\tgiant_emote = is_giant_emote && t.chat.pluckLastEmote(tokens, msg);\n\n\t\t\t\t\t// First, render the user block.\n\t\t\t\t\tconst username = t.chat.formatUser(user, e),\n\t\t\t\t\t\toverride_name = t.overrides.getName(user.id);\n\n\t\t\t\t\tlet user_class = msg.ffz_user_class;\n\t\t\t\t\tif ( user_class instanceof Set )\n\t\t\t\t\t\tuser_class = [...user_class].join(' ');\n\t\t\t\t\telse if ( Array.isArray(user_class) )\n\t\t\t\t\t\tuser_class = user_class.join(' ');\n\n\t\t\t\t\tconst want_source_tip = source && t.chat.context.get('chat.shared-chat.username-tooltip');\n\n\t\t\t\t\tconst user_props = {\n\t\t\t\t\t\tclassName: `chat-line__username notranslate${override_name ? ' ffz--name-override' : ''}${(override_name || want_source_tip) ? ' tw-relative ffz-il-tooltip__container' : ''} ${user_class ?? ''}`,\n\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\tstyle: { color },\n\t\t\t\t\t\tonClick: this.ffz_user_click_handler,\n\t\t\t\t\t\tonContextMenu: t.actions.handleUserContext\n\t\t\t\t\t};\n\n\t\t\t\t\tif ( msg.ffz_user_props )\n\t\t\t\t\t\tObject.assign(user_props, msg.ffz_user_props);\n\n\t\t\t\t\tif ( msg.ffz_user_style )\n\t\t\t\t\t\tObject.assign(user_props.style, msg.ffz_user_style);\n\n\t\t\t\t\tconst user_block = e(\n\t\t\t\t\t\t'span',\n\t\t\t\t\t\tuser_props,\n\t\t\t\t\t\toverride_name\n\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\t\t\tclassName: 'chat-author__display-name'\n\t\t\t\t\t\t\t\t}, override_name),\n\t\t\t\t\t\t\t\te('div', {\n\t\t\t\t\t\t\t\t\tclassName: 'ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center'\n\t\t\t\t\t\t\t\t}, [\n\t\t\t\t\t\t\t\t\tusername,\n\t\t\t\t\t\t\t\t\twant_source_tip\n\t\t\t\t\t\t\t\t\t\t? e('div', {\n\t\t\t\t\t\t\t\t\t\t\tclassName: 'tw-font-size-8 tw-mg-t-05'\n\t\t\t\t\t\t\t\t\t\t}, t.i18n.t('chat.sent-from-source', 'Sent from {source}', {source: source.displayName ?? source.login}))\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t: want_source_tip\n\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\tusername,\n\t\t\t\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\t\t\t\tclassName: 'ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center'\n\t\t\t\t\t\t\t\t\t}, t.i18n.t('chat.sent-from-source', 'Sent from {source}', {source: source.displayName ?? source.login}))\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t: username\n\t\t\t\t\t);\n\n\t\t\t\t\t// The timestamp.\n\t\t\t\t\tconst timestamp = (this.props.showTimestamps || this.props.isHistorical)\n\t\t\t\t\t\t? e('span', { className: 'chat-line__timestamp' }, t.chat.formatTime(msg.timestamp))\n\t\t\t\t\t\t: null;\n\n\t\t\t\t\t// The reply token for FFZ style.\n\t\t\t\t\tconst reply_token = show && has_replies && reply_tokens\n\t\t\t\t\t\t? t.chat.renderTokens(reply_tokens, e)\n\t\t\t\t\t\t: null;\n\n\t\t\t\t\t// Check for a Twitch-style points highlight.\n\t\t\t\t\tconst twitch_highlight = msg.ffz_reward_highlight && t.chat.context.get('chat.points.allow-highlight') === 1;\n\n\t\t\t\t\t// The reply element for Twitch style.\n\t\t\t\t\tconst twitch_reply = reply_mode === 1 && this.props.reply && this.props.repliesAppearancePreference && this.props.repliesAppearancePreference === 'expanded'\n\t\t\t\t\t\t? this.renderReplyLine()\n\t\t\t\t\t\t: null;\n\n\t\t\t\t\t// Now assemble the pieces.\n\t\t\t\t\tmessage = [\n\t\t\t\t\t\ttwitch_reply,\n\n\t\t\t\t\t\tsource ? this.ffzRenderSharedChatPill() : null,\n\n\t\t\t\t\t\t// The preamble\n\t\t\t\t\t\ttimestamp,\n\t\t\t\t\t\tmsg.ffz_no_actions ? null : t.actions.renderInline(msg, this.props.showModerationIcons, current_user, current_room, e, this),\n\t\t\t\t\t\tthis.renderInlineHighlight ? this.renderInlineHighlight() : null,\n\t\t\t\t\t\thl_position === 2 ? highlight_tags : null,\n\n\t\t\t\t\t\t// Badges\n\t\t\t\t\t\te('span', {\n\t\t\t\t\t\t\tclassName: 'chat-line__message--badges'\n\t\t\t\t\t\t}, t.chat.badges.render(msg, e)),\n\n\t\t\t\t\t\t// User\n\t\t\t\t\t\tuser_block,\n\n\t\t\t\t\t\t// The separator\n\t\t\t\t\t\te('span', {'aria-hidden': true}, is_action ? ' ' : ': '),\n\n\t\t\t\t\t\t// Reply Token\n\t\t\t\t\t\treply_token,\n\n\t\t\t\t\t\t// Message\n\t\t\t\t\t\tshow\n\t\t\t\t\t\t\t? e(\n\t\t\t\t\t\t\t\t'span',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tclassName: `message ${action_italic ? 'chat-line__message-body--italicized' : ''} ${twitch_highlight ? 'chat-line__message-body--highlighted' : ''}`,\n\t\t\t\t\t\t\t\t\tstyle: action_color ? { color} : null\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tt.chat.renderTokens(\n\t\t\t\t\t\t\t\t\ttokens, e, (reply_mode !== 0 && has_replies) ? this.props.reply : null\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: e(\n\t\t\t\t\t\t\t\t'span',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tclassName: 'chat-line__message--deleted'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\te('a', {\n\t\t\t\t\t\t\t\t\thref: '',\n\t\t\t\t\t\t\t\t\tonClick: this.alwaysShowMessage\n\t\t\t\t\t\t\t\t}, t.i18n.t('chat.message-deleted', '<message deleted>'))\n\t\t\t\t\t\t\t),\n\n\t\t\t\t\t\t// Moderation Action\n\t\t\t\t\t\tmod_action,\n\n\t\t\t\t\t\t// Rich Content\n\t\t\t\t\t\trich_content\n\t\t\t\t\t\t\t? e(FFZRichContent, rich_content)\n\t\t\t\t\t\t\t: null,\n\n\t\t\t\t\t\t// Giant Emote\n\t\t\t\t\t\tgiant_emote\n\t\t\t\t\t\t\t? e('div', {className: 'chat-line__message--ffz-giant-emote'}, t.chat.renderGiantEmote(giant_emote, e))\n\t\t\t\t\t\t\t: null\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\t// Is there a notice?\n\t\t\t\tlet out;\n\n\t\t\t\tif ( notice ) {\n\t\t\t\t\tconst is_raw = Array.isArray(notice.ffz_target);\n\n\t\t\t\t\tif ( ! message ) {\n\t\t\t\t\t\tconst want_ts = t.chat.context.get('chat.extra-timestamps'),\n\t\t\t\t\t\t\ttimestamp = want_ts && (this.props.showTimestamps || this.props.isHistorical)\n\t\t\t\t\t\t\t\t? e('span', { className: 'chat-line__timestamp' }, t.chat.formatTime(msg.timestamp))\n\t\t\t\t\t\t\t\t: null;\n\n\t\t\t\t\t\tconst actions = msg.ffz_no_actions ? null : t.actions.renderInline(msg, this.props.showModerationIcons, current_user, current_room, e, this);\n\n\t\t\t\t\t\tif ( is_raw ) {\n\t\t\t\t\t\t\tnotice.ffz_target.unshift(\n\t\t\t\t\t\t\t\tsource ? this.ffzRenderSharedChatPill() : null,\n\t\t\t\t\t\t\t\tnotice.ffz_icon ?? null,\n\t\t\t\t\t\t\t\ttimestamp,\n\t\t\t\t\t\t\t\tactions,\n\t\t\t\t\t\t\t\thl_position === 2 ? highlight_tags : null\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tnotice = [\n\t\t\t\t\t\t\t\tsource ? this.ffzRenderSharedChatPill() : null,\n\t\t\t\t\t\t\t\tnotice.ffz_icon ?? null,\n\t\t\t\t\t\t\t\ttimestamp,\n\t\t\t\t\t\t\t\tactions,\n\t\t\t\t\t\t\t\thl_position === 2 ? highlight_tags : null,\n\t\t\t\t\t\t\t\tnotice\n\t\t\t\t\t\t\t];\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ( is_raw ) {\n\t\t\t\t\t\t\tif ( notice.ffz_icon )\n\t\t\t\t\t\t\t\tnotice.ffz_target.unshift(notice.ffz_icon);\n\n\t\t\t\t\t\t} else if ( notice.ffz_icon )\n\t\t\t\t\t\t\tnotice = [\n\t\t\t\t\t\t\t\tnotice.ffz_icon,\n\t\t\t\t\t\t\t\tnotice,\n\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\tmessage = e(\n\t\t\t\t\t\t\t'div',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclassName: 'chat-line--inline chat-line__message',\n\t\t\t\t\t\t\t\t'data-room-id': source_room?.id ?? msg.roomId ?? current_room.id,\n\t\t\t\t\t\t\t\t'data-room': source_room?.login ?? msg.roomLogin,\n\t\t\t\t\t\t\t\t'data-user-id': user?.userID,\n\t\t\t\t\t\t\t\t'data-user': user?.lowerLogin,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmessage\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tklass = `${klass} ffz-notice-line user-notice-line tw-pd-y-05`;\n\n\t\t\t\t\tif ( ! is_raw )\n\t\t\t\t\t\tnotice = e('div', {\n\t\t\t\t\t\t\tclassName: 'tw-c-text-alt-2'\n\t\t\t\t\t\t}, notice);\n\n\t\t\t\t\tif ( highlight_tags && hl_position === 1 ) {\n\t\t\t\t\t\tout = [highlight_tags, notice, message ?? null];\n\t\t\t\t\t} else if ( message )\n\t\t\t\t\t\tout = [notice, message];\n\t\t\t\t\telse\n\t\t\t\t\t\tout = notice;\n\n\t\t\t\t} else {\n\t\t\t\t\tklass = `${klass} chat-line__message`;\n\t\t\t\t\tif ( highlight_tags && hl_position === 1 )\n\t\t\t\t\t\tout = [highlight_tags, message];\n\t\t\t\t\telse\n\t\t\t\t\t\tout = message;\n\t\t\t\t}\n\n\t\t\t\t// Check for hover actions, as those require we wrap the output in a few extra elements.\n\t\t\t\tconst hover_actions = (user && msg.id && ! msg.ffz_no_actions)\n\t\t\t\t\t? t.actions.renderHover(msg, this.props.showModerationIcons, current_user, current_room, e, this)\n\t\t\t\t\t: null;\n\n\t\t\t\tif ( hover_actions ) {\n\t\t\t\t\tklass = `${klass} tw-relative`;\n\n\t\t\t\t\tout = [\n\t\t\t\t\t\te('div', {\n\t\t\t\t\t\t\tclassName: 'chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0',\n\t\t\t\t\t\t\t'data-test-selector': 'chat-message-highlight'\n\t\t\t\t\t\t}),\n\t\t\t\t\t\te('div', {\n\t\t\t\t\t\t\tclassName: 'chat-line__message-container tw-relative'\n\t\t\t\t\t\t}, out),\n\t\t\t\t\t\thover_actions\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\t// If we don't have an override background color, try to assign\n\t\t\t\t// a value based on the mention.\n\t\t\t\tif (bg_css == null)\n\t\t\t\t\tbg_css = msg.mentioned && msg.mention_color\n\t\t\t\t\t\t? t.parent.inverse_colors.process(msg.mention_color)\n\t\t\t\t\t\t: null;\n\n\t\t\t\t// Now, return the final chat line color.\n\t\t\t\treturn e('div', {\n\t\t\t\t\tclassName: `${klass}${deleted ? ' ffz--deleted-message' : ''}${msg.mentioned ? ' ffz-mentioned' : ''}${bg_css ? ' ffz-custom-color' : ''}`,\n\t\t\t\t\tstyle: {backgroundColor: bg_css},\n\t\t\t\t\t'data-room-id': source_room?.id ?? msg.roomId ?? current_room.id,\n\t\t\t\t\t'data-room': source_room?.login ?? msg.roomLogin,\n\t\t\t\t\t'data-user-id': user?.userID,\n\t\t\t\t\t'data-user': user?.lowerLogin,\n\t\t\t\t\tonMouseOver: anim_hover ? t.chat.emotes.animHover : null,\n\t\t\t\t\tonMouseOut: anim_hover ? t.chat.emotes.animLeave : null\n\t\t\t\t}, out);\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error(err);\n\t\t\t\tt.log.capture(err, {\n\t\t\t\t\textra: {\n\t\t\t\t\t\tprops: this.props\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tconsole.log('trying old 1');\n\t\t\t\t\treturn old_render.call(this);\n\t\t\t\t} catch(e2) {\n\t\t\t\t\tt.log.error('An error in Twitch shit.', e2);\n\t\t\t\t\tt.log.capture(e2, {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tprops: this.props\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn 'An error occurred rendering this chat line.';\n\t\t\t\t}\n\t\t\t} };\n\n\t\t\tcls.prototype.render = cls.prototype.ffzNewRender;\n\n\t\t\t// Do this after a short delay to hopefully reduce the chance of React\n\t\t\t// freaking out on us.\n\t\t\tsetTimeout(() => this.ChatLine.forceUpdate());\n\t\t});\n\n\t\tthis.ExtensionLine.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() { try {\n\t\t\t\tthis._ffz_no_scan = true;\n\n\t\t\t\tif ( ! this.props.installedExtensions )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst msg = t.chat.standardizeMessage(this.props.message),\n\t\t\t\t\text = msg && msg.extension;\n\t\t\t\tif( ! ext )\n\t\t\t\t\treturn null;\n\n\t\t\t\tif ( ! this.props.installedExtensions.some(val => {\n\t\t\t\t\tconst e = val.extension;\n\t\t\t\t\treturn e && (e.clientId || e.clientID) === (ext.clientId || ext.clientID) && e.version === ext.version;\n\t\t\t\t}) )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst color = t.parent.colors.process(ext.chatColor);\n\t\t\t\tlet room = msg.roomLogin ? msg.roomLogin : msg.channel ? msg.channel.slice(1) : undefined;\n\t\t\t\tif ( ! room && this.props.channelID ) {\n\t\t\t\t\tconst r = t.chat.getRoom(this.props.channelID, null, true);\n\t\t\t\t\tif ( r && r.login )\n\t\t\t\t\t\troom = msg.roomLogin = r.login;\n\t\t\t\t}\n\n\t\t\t\tconst u = t.site.getUser(),\n\t\t\t\t\tr = {id: this.props.channelID, login: room},\n\n\t\t\t\t\ttokens = msg.ffz_tokens = msg.ffz_tokens || t.chat.tokenizeMessage(msg, u),\n\t\t\t\t\trich_content = FFZRichContent && t.chat.pluckRichContent(tokens, msg),\n\t\t\t\t\tbg_css = msg.mentioned && msg.mention_color ? t.parent.inverse_colors.process(msg.mention_color) : null;\n\n\t\t\t\tif ( ! tokens.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn e('div', {\n\t\t\t\t\tclassName: `chat-line__message${msg.mentioned ? ' ffz-mentioned' : ''}${bg_css ? ' ffz-custom-color' : ''}`,\n\t\t\t\t\tstyle: {backgroundColor: bg_css},\n\t\t\t\t\t'data-room-id': r.id,\n\t\t\t\t\t'data-room': r.login,\n\t\t\t\t\t'data-extension': ext.clientID\n\t\t\t\t}, [\n\t\t\t\t\tthis.props.showTimestamps && e('span', {\n\t\t\t\t\t\tclassName: 'chat-line__timestamp'\n\t\t\t\t\t}, t.chat.formatTime(msg.timestamp)),\n\t\t\t\t\te('span', {\n\t\t\t\t\t\tclassName: 'chat-line__message--badges'\n\t\t\t\t\t}, t.chat.badges.render(msg, e)),\n\t\t\t\t\te('span', {\n\t\t\t\t\t\tclassName: 'chat-line__username notranslate',\n\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t\tstyle: { color },\n\t\t\t\t\t\tonClick: this.onExtensionNameClick\n\t\t\t\t\t}, e('span', {\n\t\t\t\t\t\tclassName: 'chat-author__display-name'\n\t\t\t\t\t}, ext.displayName)),\n\t\t\t\t\te('span', null, ': '),\n\t\t\t\t\te('span', {\n\t\t\t\t\t\tclassName: 'message'\n\t\t\t\t\t}, t.chat.renderTokens(tokens, e)),\n\t\t\t\t\trich_content && e(FFZRichContent, rich_content)\n\t\t\t\t]);\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.info(err);\n\t\t\t\tt.log.capture(err, {\n\t\t\t\t\textra: {\n\t\t\t\t\t\tprops: this.props\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t} }\n\n\t\t\t// Do this after a short delay to hopefully reduce the chance of React\n\t\t\t// freaking out on us.\n\t\t\tsetTimeout(() => this.ExtensionLine.forceUpdate());\n\t\t})\n\t}\n\n\n\tcheckEffects() {\n\t\tfor(const inst of this.ChatLine.instances) {\n\t\t\tconst msg = inst.props.message,\n\t\t\t\ttokens = msg?.ffz_tokens;\n\n\t\t\tif ( tokens )\n\t\t\t\tfor(const token of tokens) {\n\t\t\t\t\tif ( token.type === 'emote' && token.modifier_flags )\n\t\t\t\t\t\tthis.emotes.ensureEffect(token.modifier_flags);\n\t\t\t\t}\n\t\t}\n\n\t\tfor(const inst of this.WhisperLine.instances) {\n\t\t\tconst msg = inst.props.message?._ffz_message,\n\t\t\t\ttokens = msg?.ffz_tokens;\n\n\t\t\tif ( tokens )\n\t\t\t\tfor(const token of tokens) {\n\t\t\t\t\tif ( token.type === 'emote' && token.modifier_flags )\n\t\t\t\t\t\tthis.emotes.ensureEffect(token.modifier_flags);\n\t\t\t\t}\n\t\t}\n\t}\n\n\tupdateLineById(id, clear_tokens = true, clear_badges = null) {\n\t\tif ( clear_badges == null )\n\t\t\tclear_badges = clear_tokens;\n\n\t\tfor(const inst of this.ChatLine.instances) {\n\t\t\tconst msg = inst.props.message;\n\t\t\tif ( msg?.id === id ) {\n\t\t\t\tif ( clear_badges )\n\t\t\t\t\tmsg.ffz_badges = msg.ffz_badge_cache = null;\n\n\t\t\t\tif ( clear_tokens ) {\n\t\t\t\t\tmsg.ffz_tokens = null;\n\t\t\t\t\tmsg.ffz_reply = null;\n\t\t\t\t\tmsg.highlights = msg.mentioned = msg.mention_color = msg.color_priority = null;\n\t\t\t\t}\n\n\t\t\t\tinst.forceUpdate();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfor(const inst of this.WhisperLine.instances) {\n\t\t\tconst msg = inst.props.message?._ffz_message;\n\t\t\tif ( msg?.id === id ) {\n\t\t\t\t// TODO: Better support for clear_tokens and clear_badges\n\t\t\t\tif ( clear_badges || clear_tokens )\n\t\t\t\t\tmsg._ffz_message = null;\n\n\t\t\t\tinst.forceUpdate();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateLinesByUser(id, login, clear_tokens = true, clear_badges = true) {\n\t\tfor(const inst of this.ChatLine.instances) {\n\t\t\tconst msg = inst.props.message,\n\t\t\t\tuser = msg?.user;\n\t\t\tif ( user && ((id && id == user.id) || (login && login == user.login)) ) {\n\t\t\t\tif ( clear_badges )\n\t\t\t\t\tmsg.ffz_badges = msg.ffz_badge_cache = null;\n\n\t\t\t\tif ( clear_tokens ) {\n\t\t\t\t\tmsg.ffz_tokens = null;\n\t\t\t\t\tmsg.ffz_reply = null;\n\t\t\t\t\tmsg.highlights = msg.mentioned = msg.mention_color = msg.color_priority = null;\n\t\t\t\t}\n\n\t\t\t\tinst.forceUpdate();\n\t\t\t}\n\t\t}\n\n\t\tfor(const inst of this.WhisperLine.instances) {\n\t\t\tconst msg = inst.props.message?._ffz_message,\n\t\t\t\tuser = msg?.user;\n\t\t\tif ( user && ((id && id == user.id) || (login && login == user.login)) ) {\n\t\t\t\tmsg._ffz_message = null;\n\t\t\t\tinst.forceUpdate();\n\t\t\t}\n\t\t}\n\t}\n\n\n\tmaybeUpdateLines() {\n\t\tif ( this.chat.context.get('chat.rich.all-links') )\n\t\t\tthis.updateLines();\n\t}\n\n\tupdateLines() {\n\t\treturn this._updateLines();\n\t}\n\n\trerenderLines() {\n\t\treturn this._updateLines(false, false);\n\t}\n\n\tupdateLineTokens() {\n\t\treturn this._updateLines(true, false);\n\t}\n\n\tupdateLineBadges() {\n\t\treturn this._updateLines(false, true);\n\t}\n\n\t_updateLines(clear_tokens = true, clear_badges = true) {\n\t\tfor(const inst of this.ChatLine.instances) {\n\t\t\tconst msg = inst.props.message;\n\t\t\tif ( msg ) {\n\t\t\t\tif ( clear_badges )\n\t\t\t\t\tmsg.ffz_badge_cache = msg.ffz_badges = null;\n\n\t\t\t\tif ( clear_tokens ) {\n\t\t\t\t\tmsg.ffz_tokens = null;\n\t\t\t\t\tmsg.ffz_reply = null;\n\t\t\t\t\tmsg.highlights = msg.mentioned = msg.mention_color = msg.mention_priority = msg.clear_priority = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor(const inst of this.ExtensionLine.instances) {\n\t\t\tconst msg = inst.props.message;\n\t\t\tif ( msg ) {\n\t\t\t\tif ( clear_badges )\n\t\t\t\t\tmsg.ffz_badge_cache = msg.ffz_badges = null;\n\n\t\t\t\tif ( clear_tokens ) {\n\t\t\t\t\tmsg.ffz_tokens = null;\n\t\t\t\t\tmsg.ffz_reply = null;\n\t\t\t\t\tmsg.highlights = msg.mentioned = msg.mention_color = msg.mention_priority = msg.clear_priority = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor(const inst of this.WhisperLine.instances) {\n\t\t\tconst msg = inst.props.message;\n\t\t\tif ( msg && msg._ffz_message )\n\t\t\t\tmsg._ffz_message = null;\n\t\t}\n\n\t\tthis.ChatLine.forceUpdate();\n\t\tthis.ExtensionLine.forceUpdate();\n\t\tthis.WhisperLine.forceUpdate();\n\n\t\tthis.emit('chat:updated-lines');\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Chat Settings Menu\n// ============================================================================\n\nimport Twilight from 'site';\nimport Module from 'utilities/module';\nimport {createElement} from 'utilities/dom';\nimport { FFZEvent } from 'src/utilities/events';\n\nexport default class SettingsMenu extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('chat');\n\t\tthis.inject('chat.badges');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site');\n\t\tthis.inject('site.css_tweaks');\n\n\t\tthis.settings.add('chat.input.hide-identity', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Appearance',\n\t\t\t\ttitle: 'Display \"Chat Identity\" in the chat settings menu rather than the input box.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.SettingsMenu = this.fine.define(\n\t\t\t'chat-settings',\n\t\t\tn => n.renderUniversalOptions && n.onBadgesChanged,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\t/*this.ChatIdentityContainer = this.fine.define(\n\t\t\t'chat-identity-container',\n\t\t\tn => n.hideChatIdentityMenu && n.toggleBalloonRef,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);*/\n\t}\n\n\tasync onEnable() {\n\t\tthis.on('i18n:update', () => this.SettingsMenu.forceUpdate());\n\t\tthis.chat.context.on('changed:chat.scroller.freeze', () => this.SettingsMenu.forceUpdate());\n\t\tthis.chat.context.on('changed:chat.input.hide-identity', val => {\n\t\t\tthis.css_tweaks.toggle('hide-chat-identity', val);\n\t\t\tthis.SettingsMenu.forceUpdate();\n\t\t});\n\n\t\tthis.css_tweaks.toggle('hide-chat-identity', this.chat.context.get('chat.input.hide-identity'));\n\n\t\tconst t = this,\n\t\t\tReact = await this.site.findReact();\n\t\tif ( ! React )\n\t\t\treturn;\n\n\t\tconst createElement = React.createElement;\n\n\t\tthis.SettingsMenu.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render,\n\t\t\t\told_universal = cls.prototype.renderUniversalOptions;\n\n\t\t\tcls.prototype.renderUniversalOptions = function() {\n\t\t\t\tconst val = old_universal.call(this);\n\n\t\t\t\tif ( ! this.ffzSettingsClick )\n\t\t\t\t\tthis.ffzSettingsClick = e => t.click(this, e);\n\n\t\t\t\tif ( ! this.ffzPauseClick )\n\t\t\t\t\tthis.ffzPauseClick = () => this.setState({ffzPauseMenu: ! this.state.ffzPauseMenu});\n\n\t\t\t\tval.props.children.push(<div class=\"tw-full-width tw-relative\">\n\t\t\t\t\t<button class=\"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive\" onClick={this.ffzSettingsClick}>\n\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-pd-05 tw-relative\">\n\t\t\t\t\t\t\t<div class=\"tw-flex-grow-1\">\n\t\t\t\t\t\t\t\t{t.i18n.t('site.menu_button', 'FrankerFaceZ Control Center')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t\t{t.cant_window && <div class=\"tw-mg-t-05 tw-c-text-alt-2\">\n\t\t\t\t\t\t<span class=\"ffz-i-attention\">\n\t\t\t\t\t\t\t{t.i18n.t('popup.error', 'We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>}\n\t\t\t\t</div>);\n\n\t\t\t\t/*const f = t.chat.context.get('chat.scroller.freeze'),\n\t\t\t\t\treason = f === 2 ? t.i18n.t('key.ctrl', 'Ctrl Key') :\n\t\t\t\t\t\tf === 3 ? t.i18n.t('key.meta', 'Meta Key') :\n\t\t\t\t\t\t\tf === 4 ? t.i18n.t('key.alt', 'Alt Key') :\n\t\t\t\t\t\t\t\tf === 5 ? t.i18n.t('key.shift', 'Shift Key') :\n\t\t\t\t\t\t\t\t\tf === 6 ? t.i18n.t('key.ctrl_mouse', 'Ctrl or Mouse') :\n\t\t\t\t\t\t\t\t\t\tf === 7 ? t.i18n.t('key.meta_mouse', 'Meta or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\tf === 8 ? t.i18n.t('key.alt_mouse', 'Alt or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\t\tf === 9 ? t.i18n.t('key.shift_mouse', 'Shift or Mouse') :\n\t\t\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('key.hover', 'Hover');\n\n\n\t\t\t\tval.props.children.push(<div class=\"tw-full-width tw-relative\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive\"\n\t\t\t\t\t\tonClick={this.ffzPauseClick}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-pd-05 tw-relative\">\n\t\t\t\t\t\t\t<div class=\"tw-flex-grow-1\">\n\t\t\t\t\t\t\t\t{t.i18n.t('chat.settings.pause', 'Pause Chat')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"tw-mg-l-1 tw-pd-x-05\">{reason}</div>\n\t\t\t\t\t\t\t<figure class=\"tw-svg ffz-i-right-dir\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</div>);*/\n\n\t\t\t\treturn val;\n\t\t\t}\n\n\t\t\tcls.prototype.ffzRenderIdentity = function() {\n\t\t\t\tif ( ! this.state || ! this.props || this.state.moderatorMode || this.state.chatAppearance || this.state.chatPause || this.state.followerMode || this.state.recentRaids || this.state.repliesAppearance || this.state.slowMode || this.props.isShowingChatFilterSettings || this.props.isShowingDeletedMessageDisplaySettings || ! this.props.isLoggedIn )\n\t\t\t\t\treturn null;\n\n\t\t\t\tif ( ! t.chat.context.get('chat.input.hide-identity') )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst user = this.props.data?.currentUser,\n\t\t\t\t\traw_badges = this.props.data?.user?.self?.displayBadges;\n\n\t\t\t\tif ( ! user || ! user.login || ! Array.isArray(raw_badges) )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst is_intl = user.login && user.displayName && user.displayName.trim().toLowerCase() !== user.login,\n\t\t\t\t\tcolor = t.parent.colors.process(user.chatColor),\n\t\t\t\t\tbadges = {};\n\n\t\t\t\tfor(const badge of raw_badges) {\n\t\t\t\t\tif ( badge?.setID && badge.version )\n\t\t\t\t\t\tbadges[badge.setID] = badge.version;\n\t\t\t\t}\n\n\t\t\t\tif ( ! this._ffzIdentityClick )\n\t\t\t\t\tthis._ffzIdentityClick = () => {\n\t\t\t\t\t\tdocument.querySelector('button[data-a-target=\"chat-badge-carousel-badge-icon\"]').click();\n\t\t\t\t\t\tthis.props.onCloseSettings();\n\t\t\t\t\t}\n\n\t\t\t\tconst msg = {\n\t\t\t\t\tuser,\n\t\t\t\t\tbadges,\n\t\t\t\t\tffz_badges: t.badges.getBadges(user.id, user.login, this.props.channelID, this.props.channelLogin),\n\t\t\t\t\troomID: this.props.channelID,\n\t\t\t\t\troomLogin: this.props.channelLogin\n\t\t\t\t};\n\n\t\t\t\tthis._ffzIdentityMsg = msg;\n\n\t\t\t\treturn (<div class=\"ffz-identity\">\n\t\t\t\t\t<div class=\"tw-mg-y-05 tw-pd-x-05\">\n\t\t\t\t\t\t<p class=\"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase\">\n\t\t\t\t\t\t\t{ t.i18n.t('chat.identity-menu', 'Chat Identity') }\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tw-full-width tw-relative\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive\"\n\t\t\t\t\t\t\tonClick={this._ffzIdentityClick}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-pd-05 tw-relative\">\n\t\t\t\t\t\t\t\t<div class=\"tw-flex-grow-1\">\n\t\t\t\t\t\t\t\t\t<span class=\"ffz--editor-name\">\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tclass=\"ffz--editor-badges\"\n\t\t\t\t\t\t\t\t\t\t\tdata-room-id={this.props.channelID}\n\t\t\t\t\t\t\t\t\t\t\tdata-room={this.props.channelLogin}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{t.badges.render(msg, createElement, true, true)}\n\t\t\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t\t\t<span class=\"tw-strong notranslate\" style={{color}}>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"name-display__name\">{ user.displayName || user.login}</span>\n\t\t\t\t\t\t\t\t\t\t\t{is_intl && <span class=\"intl-name\"> ({user.login}) </span>}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-shrink-0 tw-mg-l-05\">\n\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-right-open\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\t\t\t}\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tconst out = old_render.call(this);\n\n\t\t\t\ttry {\n\t\t\t\t\tconst children = out?.props?.children?.props?.children?.props?.children?.[1]?.props?.children?.props?.children;\n\t\t\t\t\t//const children = out?.props?.children?.props?.children?.[1]?.props?.children?.props?.children;\n\t\t\t\t\tif ( Array.isArray(children) ) {\n\t\t\t\t\t\tconst extra = this.ffzRenderIdentity();\n\t\t\t\t\t\tif ( extra )\n\t\t\t\t\t\t\tchildren.unshift(extra);\n\t\t\t\t\t}\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.error('Error rendering chat settings menu.', err);\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tthis.SettingsMenu.forceUpdate();\n\t\t});\n\n\t\tthis.SettingsMenu.on('update', this.updateSettingsMenu, this);\n\n\t\tthis.SettingsMenu.on('unmount', inst => {\n\t\t\tinst.ffzSettingsClick = null;\n\t\t});\n\t}\n\n\tupdateSettingsMenu(inst) {\n\t\tconst el = this.fine.getChildNode(inst);\n\t\tif ( ! el || ! document.contains(el) )\n\t\t\treturn;\n\n\t\tlet cont;\n\n\t\tif ( inst.props?.editAppearance ) {\n\t\t\tthis.registerBadgePicker();\n\t\t\tconst name = el.querySelector('span[data-a-target=\"edit-display-name\"]');\n\t\t\tcont = name && name.closest('.tw-mg-t-1');\n\n\t\t} else\n\t\t\tcont = el.querySelector('.name-display > div:not([data-test-selector=\"edit-appearance-button\"])');\n\n\t\tif ( ! cont || ! el.contains(cont) )\n\t\t\treturn;\n\n\t\tconst user = inst.props?.data?.currentUser,\n\t\t\traw_badges = inst.props?.data?.user?.self?.displayBadges;\n\n\t\tif ( ! user || ! user.login || ! Array.isArray(raw_badges) )\n\t\t\treturn;\n\n\t\tconst is_intl = user.login && user.displayName && user.displayName.trim().toLowerCase() !== user.login,\n\t\t\tcolor = this.parent.colors.process(user.chatColor),\n\t\t\tbadges = {};\n\n\t\tfor(const child of cont.children) {\n\t\t\tif ( ! child?.classList )\n\t\t\t\tcontinue;\n\t\t\tif ( child.classList.contains('ffz--editor-name') )\n\t\t\t\tchild.remove();\n\t\t\telse\n\t\t\t\tchild.classList.add('tw-hide');\n\t\t}\n\n\t\tfor(const badge of raw_badges) {\n\t\t\tif ( badge?.setID && badge.version )\n\t\t\t\tbadges[badge.setID] = badge.version;\n\t\t}\n\n\t\tcont.appendChild(createElement('span', {className: 'ffz--editor-name'}, [\n\t\t\tcreateElement('span', {\n\t\t\t\tclassName: 'ffz--editor-badges',\n\t\t\t\t'data-room-id': inst.props.channelID,\n\t\t\t\t'data-room-login': inst.props.channelLogin\n\t\t\t}, this.badges.render({\n\t\t\t\tuser,\n\t\t\t\tbadges,\n\t\t\t\tffz_badges: this.badges.getBadges(user.id, user.login, inst.props.channelID, inst.props.channelLogin),\n\t\t\t\troomID: inst.props.channelID,\n\t\t\t\troomLogin: inst.props.channelLogin\n\t\t\t}, createElement, true, true)),\n\n\t\t\t<span class=\"tw-strong notranslate\" style={{color}}>\n\t\t\t\t<span class=\"name-display__name\">{user.displayName || user.login}</span>\n\t\t\t\t{is_intl && <span class=\"intl-name\"> ({user.login})</span>}\n\t\t\t</span>\n\t\t]));\n\t}\n\n\n\tregisterBadgePicker() {\n\t\tif ( this.BadgePicker )\n\t\t\treturn;\n\n\t\tthis.BadgePicker = this.fine.define(\n\t\t\t'badge-picker',\n\t\t\tn => n.onGlobalBadgeClicked && n.onGlobalBadgeKeyPress,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.BadgePicker.on('mount', this.updateBadgePicker, this);\n\t\tthis.BadgePicker.on('update', this.updateBadgePicker, this);\n\n\t\tthis.BadgePicker.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateBadgePicker(inst);\n\t\t});\n\t}\n\n\tupdateBadgePicker(inst) {\n\t\tconst el = this.fine.getChildNode(inst);\n\t\tif ( ! el ) {\n\t\t\t// This element doesn't populate right away. React is weird.\n\t\t\tif ( inst.props?.data?.loading === false && ! inst._ffz_try_again )\n\t\t\t\tinst._ffz_try_again = requestAnimationFrame(() =>\n\t\t\t\t\tthis.updateBadgePicker(inst));\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst cont = el.querySelector('.tw-flex-column');\n\t\tif ( ! cont )\n\t\t\treturn;\n\n\t\tconst badges = this.badges.getBadges(inst.props.userID, inst.props.userLogin);\n\t\tlet badge;\n\n\t\tfor(const b of badges) {\n\t\t\tconst bd = this.badges.badges[b?.id];\n\t\t\tif ( bd && ! bd.addon )\n\t\t\t\tbadge = bd;\n\t\t}\n\n\t\tconst ffz = cont.querySelector('.ffz--badge-selector');\n\t\tif ( ffz ) {\n\t\t\tif ( ! badge )\n\t\t\t\tffz.remove();\n\t\t\treturn;\n\n\t\t} else if ( ! badge )\n\t\t\treturn;\n\n\t\tconst out = (<div class=\"ffz--badge-selector tw-border-b tw-mg-b-1\">\n\t\t\t<div class=\"tw-mg-y-05 tw-pd-x-05\">\n\t\t\t\t<p class=\"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase\">\n\t\t\t\t\t{ this.i18n.t('chat.ffz-badge.title', 'FrankerFaceZ Badge') }\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<p class=\"tw-mg-b-05 tw-pd-x-05\">\n\t\t\t\t\t{ this.i18n.tList(\n\t\t\t\t\t\t'chat.ffz-badge.about',\n\t\t\t\t\t\t'This badge appears globally for users with FrankerFaceZ. Please visit the {website} to change this badge.',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twebsite: (<a href=\"https://www.frankerfacez.com/subscribe\" class=\"ffz-link\" rel=\"noopener noreferrer\" target=\"_blank\">\n\t\t\t\t\t\t\t\t{this.i18n.t('chat.ffz-badge.site-link', 'FrankerFaceZ website')}\n\t\t\t\t\t\t\t</a>)\n\t\t\t\t\t\t}\n\t\t\t\t\t) }\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div role=\"radiogroup\" class=\"tw-align-items-center tw-flex tw-flex-wrap tw-mg-b-05 tw-mg-t-05 tw-pd-x-05\">\n\t\t\t\t<div class=\"tw-mg-r-1 tw-mg-y-05\">\n\t\t\t\t\t<div class=\"tw-inline-flex\">\n\t\t\t\t\t\t<div class=\"edit-appearance__badge-chooser edit-appearance__badge-chooser--selected tw-border-radius-small\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\talt={badge.title}\n\t\t\t\t\t\t\t\tsrc={badge.urls[2]}\n\t\t\t\t\t\t\t\tsrcset={`${badge.urls[2]} 1x, ${badge.urls[4]} 2x`}\n\t\t\t\t\t\t\t\tstyle={{backgroundColor: badge.color || 'transparent'}}\n\t\t\t\t\t\t\t\trole=\"radio\"\n\t\t\t\t\t\t\t\taria-checked=\"true\"\n\t\t\t\t\t\t\t\tclass=\"tw-full-height tw-full-width\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>);\n\n\t\tconst after = cont.querySelector('[data-test-selector=\"global-badges-test-selector\"]')?.nextElementSibling;\n\t\tif ( after )\n\t\t\tcont.insertBefore(out, after);\n\t\telse\n\t\t\tcont.appendChild(out);\n\t}\n\n\n\tcloseMenu(inst) {\n\t\tconst super_parent = this.fine.searchParent(inst, n => n.setChatInputRef && n.setAutocompleteInputRef, 100),\n\t\t\tparent = super_parent && this.fine.searchTree(super_parent, n => n.props && n.props.isSettingsOpen && n.onClickSettings);\n\n\t\tif ( parent )\n\t\t\tparent.onClickSettings();\n\t}\n\n\tclick(inst, event) {\n\t\tconst target = event.currentTarget,\n\t\t\tpage = target && target.dataset && target.dataset.page;\n\n\t\tconst evt = new FFZEvent({\n\t\t\titem: page,\n\t\t\tevent,\n\t\t\terrored: false\n\t\t});\n\n\t\tthis.emit('main_menu:open', evt);\n\t\tif ( evt.errored ) {\n\t\t\tthis.cant_window = true;\n\t\t\tthis.SettingsMenu.forceUpdate();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.closeMenu(inst);\n\t}\n\n\t/*old_click(inst, event) {\n\t\t// If we're on a page with minimal root, we want to open settings\n\t\t// in a popout as we're almost certainly within Popout Chat.\n\t\tconst layout = this.resolve('site.layout');\n\t\tif ( (layout && layout.is_minimal) || (event && (event.ctrlKey || event.shiftKey)) ) {\n\t\t\tconst win = window.open(\n\t\t\t\t'https://twitch.tv/popout/frankerfacez/chat?ffz-settings',\n\t\t\t\t'_blank',\n\t\t\t\t'resizable=yes,scrollbars=yes,width=850,height=600'\n\t\t\t);\n\n\t\t\tif ( win )\n\t\t\t\twin.focus();\n\t\t\telse {\n\t\t\t\tthis.cant_window = true;\n\t\t\t\tthis.SettingsMenu.forceUpdate();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t} else {\n\t\t\tconst target = event.currentTarget,\n\t\t\t\tpage = target && target.dataset && target.dataset.page,\n\t\t\t\tmenu = this.resolve('main_menu');\n\n\t\t\tif ( menu ) {\n\t\t\t\tif ( page )\n\t\t\t\t\tmenu.requestPage(page);\n\t\t\t\tif ( menu.showing )\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit('site.menu_button:clicked');\n\t\t}\n\n\t\tthis.closeMenu(inst);\n\t}*/\n}\n","'use strict';\n\n// ============================================================================\n// Chat Emote Menu\n// ============================================================================\n\nimport {has, get, once, maybe_call, set_equals, getTwitchEmoteURL, getTwitchEmoteSrcSet, deep_equals} from 'utilities/object';\nimport {TWITCH_GLOBAL_SETS, EmoteTypes, TWITCH_POINTS_SETS, TWITCH_PRIME_SETS, WEBKIT_CSS as WEBKIT, IS_OSX, KNOWN_CODES, REPLACEMENT_BASE, REPLACEMENTS, KEYS} from 'utilities/constants';\nimport {HIDDEN_CATEGORIES, CATEGORIES, CATEGORY_SORT, IMAGE_PATHS} from 'src/modules/chat/emoji';\nimport {ClickOutside} from 'utilities/dom';\n\nimport Twilight from 'site';\nimport Module from 'utilities/module';\n\nimport SUB_STATUS from './sub_status.gql';\nimport { FFZEvent } from 'src/utilities/events';\n//import Tooltip from 'src/utilities/tooltip';\n\nconst TIERS = {\n\t1000: 'Tier 1',\n\t2000: 'Tier 2',\n\t3000: 'Tier 3'\n};\n\nconst TONE_EMOJI = [\n\t'the_horns',\n\t'raised_back_of_hand',\n\t'ok_hand',\n\t'+1',\n\t'clap',\n\t'fist',\n\t'pinched_fingers',\n\t'wave',\n\t'pinch',\n\t'victory',\n\t'love_you_gesture'\n];\n\n\nfunction scrollIntoView(el, container) {\n\tif ( ! container )\n\t\tcontainer = el.closest('.simplebar-scroll-content') ?? el.parentElement;\n\n\tconst height = container.offsetHeight,\n\t\tel_height = el.offsetHeight,\n\t\tel_top = el.offsetTop;\n\n\tif ( el_height >= height ) {\n\t\tcontainer.scrollTop = el_top;\n\t\treturn;\n\t}\n\n\tconst pos = el_top + (el_height / 2) - (height / 2);\n\tcontainer.scrollTop = pos;\n}\n\n\nfunction maybe_date(val) {\n\tif ( ! val )\n\t\treturn val;\n\n\ttry {\n\t\treturn new Date(val);\n\t} catch(err) {\n\t\treturn null;\n\t}\n}\n\n\nconst COLLATOR = window?.Intl?.Collator && new Intl.Collator(undefined, {numeric: true});\n\n\nconst EMOTE_SORTERS = [\n\tfunction id_asc(a, b) {\n\t\tif ( COLLATOR )\n\t\t\treturn COLLATOR.compare(a.id, b.id);\n\n\t\tif ( a.id < b.id ) return -1;\n\t\tif ( a.id > b.id ) return 1;\n\t\treturn 0;\n\t},\n\tfunction id_desc(a, b) {\n\t\tif ( COLLATOR )\n\t\t\treturn COLLATOR.compare(b.id, a.id);\n\n\t\tif ( a.id > b.id ) return -1;\n\t\tif ( a.id < b.id ) return 1;\n\t\treturn 0;\n\t},\n\tfunction name_asc(a, b) {\n\t\tconst a_n = a.name.toLowerCase(),\n\t\t\tb_n = b.name.toLowerCase();\n\n\t\tif ( a_n < b_n ) return -1;\n\t\tif ( a_n > b_n ) return 1;\n\n\t\tif ( COLLATOR )\n\t\t\treturn COLLATOR.compare(a.id, b.id);\n\n\t\tif ( a.id < b.id ) return -1;\n\t\tif ( a.id > b.id ) return 1;\n\t\treturn 0;\n\t},\n\tfunction name_desc(a, b) {\n\t\tconst a_n = a.name.toLowerCase(),\n\t\t\tb_n = b.name.toLowerCase();\n\n\t\tif ( a_n > b_n ) return -1;\n\t\tif ( a_n < b_n ) return 1;\n\n\t\tif ( COLLATOR )\n\t\t\treturn COLLATOR.compare(b.id, a.id);\n\n\t\tif ( a.id > b.id ) return -1;\n\t\tif ( a.id < b.id ) return 1;\n\t\treturn 0;\n\t},\n\tfunction native_asc(a, b) {\n\t\tif ( a.order != null || b.order != null ) {\n\t\t\tif ( a.order && b.order == null ) return -1;\n\t\t\tif ( b.order && a.order == null ) return 1;\n\n\t\t\tif ( a.order < b.order ) return -1;\n\t\t\tif ( a.order > b.order ) return 1;\n\t\t}\n\n\t\tif ( COLLATOR )\n\t\t\treturn COLLATOR.compare(a.id, b.id);\n\n\t\tif ( a.id < b.id ) return -1;\n\t\tif ( a.id > b.id ) return 1;\n\t\treturn 0;\n\t},\n\tfunction native_desc(a, b) {\n\t\tif ( a.order != null || b.order != null ) {\n\t\t\tif ( a.order && b.order == null ) return 1;\n\t\t\tif ( b.order && a.order == null ) return -1;\n\n\t\t\tif ( a.order < b.order ) return 1;\n\t\t\tif ( a.order > b.order ) return -1;\n\t\t}\n\n\t\tif ( COLLATOR )\n\t\t\treturn COLLATOR.compare(a.id, b.id);\n\n\t\tif ( a.id < b.id ) return 1;\n\t\tif ( a.id > b.id ) return -1;\n\t\treturn 0;\n\t}\n];\n\n\nfunction sort_sets(a, b) {\n\tconst a_sk = a.sort_key,\n\t\tb_sk = b.sort_key;\n\n\tif ( a_sk < b_sk ) return -1;\n\tif ( b_sk < a_sk ) return 1;\n\n\tconst a_n = a.title.toLowerCase(),\n\t\tb_n = b.title.toLowerCase();\n\n\tif ( a_n < b_n ) return -1;\n\tif ( b_n < a_n ) return 1;\n\treturn 0;\n}\n\n\nexport default class EmoteMenu extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('staging');\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('chat');\n\t\tthis.inject('chat.badges');\n\t\tthis.inject('chat.emotes');\n\t\tthis.inject('chat.emoji');\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.apollo');\n\t\tthis.inject('site.css_tweaks');\n\n\t\tthis.SUB_STATUS = SUB_STATUS;\n\n\t\tthis.settings.add('chat.emote-menu.shortcut', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Use Ctrl+E to open the Emote Menu.',\n\t\t\t\tdescription: 'When enabled and you press Ctrl+E with the chat input focused, the emote menu will open.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.modifiers', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Emote Modifiers',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'In-Line'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.clear-search', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Reset search when closing the Emote Menu.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.enabled', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Use the FrankerFaceZ Emote Menu.',\n\t\t\t\tdescription: 'The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.EmoteMenu.forceUpdate()\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.icon', {\n\t\t\trequires: ['chat.emote-menu.enabled', 'context.bttv.emote_menu'],\n\t\t\tdefault: false,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( ! ctx.get('chat.emote-menu.enabled') )\n\t\t\t\t\treturn false;\n\n\t\t\t\treturn ctx.get('context.bttv.emote_menu') || val;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Replace the emote menu icon with the FFZ icon for that classic feel.',\n\t\t\t\tdescription: '**Note:** This setting may be forcibly enabled if other emote menus are detected, to ensure you can visually identify the FFZ Emote Menu.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.show-quick-nav', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Show a quick navigation bar along the side of the menu.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.tall', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Use extra height for the emote menu.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.show-heading', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Show Headers',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'Always'},\n\t\t\t\t\t{value: 2, title: 'When Not Searching'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.show-search', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Show the search box.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.reduced-padding', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Use reduced padding.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.emote-menu.default-tab', {\n\t\t\tdefault: 'channel',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Default Tab',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 'fav', title: 'Favorites'},\n\t\t\t\t\t{value: 'channel', title: 'Channel'},\n\t\t\t\t\t{value: 'effect', title: 'Emote Effects'},\n\t\t\t\t\t{value: 'all', title: 'My Emotes'},\n\t\t\t\t\t{value: 'emoji', title: 'Emoji'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.effect-tab', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Display Emote Effects in their own tab.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.tooltips', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Appearance',\n\t\t\t\ttitle: 'Display emote preview tool-tips in the FFZ Emote Menu.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: 'You may wish to disable this for performance reasons.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.show-emoji', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Display emoji in the emote menu.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\n\t\tthis.settings.add('chat.emote-menu.combine-tabs', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Display all emotes on one tab.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.stay-loaded', {\n\t\t\trequires: ['chat.emote-menu.combine-tabs'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val == null )\n\t\t\t\t\tval = ctx.get('chat.emote-menu.combine-tabs');\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> General',\n\t\t\t\ttitle: 'Stay loaded after opening.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: `This causes the emote menu to stay in the DOM even when it's not visible. Enabling this may help the site perform better when opening the menu if it's slow. By default, this setting is enabled when using \\`Display all emotes on one tab.\\``\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.sort-emotes', {\n\t\t\tdefault: 4,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Sorting',\n\t\t\t\ttitle: 'Sort Emotes By',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 4, title: 'Native Order, Ascending'},\n\t\t\t\t\t{value: 5, title: 'Native Order, Descending'},\n\t\t\t\t\t{value: 0, title: 'Order Added (ID), Ascending'},\n\t\t\t\t\t{value: 1, title: 'Order Added (ID), Descending'},\n\t\t\t\t\t{value: 2, title: 'Name, Ascending'},\n\t\t\t\t\t{value: 3, title: 'Name, Descending'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.emote-menu.sort-tiers-last', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Emote Menu >> Sorting',\n\t\t\t\ttitle: 'List emotes from higher sub tiers last.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\n\t\tthis.EmoteMenu = this.fine.define(\n\t\t\t'chat-emote-menu',\n\t\t\tn => n.getAllEmoteSets && n.getSortedChannelEmotes && n.props?.emotePickerSource,\n\t\t\t//n => n.subscriptionProductHasEmotes,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t)\n\n\n\t\tthis.MenuWrapper = this.fine.wrap('ffz-emote-menu');\n\t\t//this.MenuSection = this.fine.wrap('ffz-menu-section');\n\t\t//this.MenuEmote = this.fine.wrap('ffz-menu-emote');\n\t}\n\n\tasync onEnable() {\n\t\tthis.on('i18n:update', () => this.EmoteMenu.forceUpdate());\n\t\tthis.on('chat.emotes:update-default-sets', this.maybeUpdate, this);\n\t\tthis.on('chat.emotes:update-user-sets', this.maybeUpdate, this);\n\t\tthis.on('chat.emotes:update-room-sets', this.maybeUpdate, this);\n\t\tthis.on('chat.emotes:loaded', this.maybeUpdate, this);\n\t\tthis.on('chat.emotes:change-favorite', this.maybeUpdate, this);\n\t\tthis.on('chat.emotes:change-hidden', this.maybeUpdate, this);\n\t\tthis.on('chat.emoji:populated', this.maybeUpdate, this);\n\n\t\tthis.chat.context.on('changed:chat.emote-menu.enabled', () =>\n\t\t\tthis.EmoteMenu.forceUpdate());\n\n\t\tconst rebuild = () => {\n\t\t\tfor(const inst of this.MenuWrapper.instances)\n\t\t\t\tinst.rebuildData();\n\t\t}\n\n\t\tthis.chat.context.on('changed:chat.emotes.enabled', rebuild);\n\t\tthis.chat.context.on('changed:chat.emote-menu.modifiers', rebuild);\n\t\tthis.chat.context.on('changed:chat.emote-menu.show-emoji', rebuild);\n\t\tthis.chat.context.on('changed:chat.emote-menu.tooltips', rebuild);\n\t\tthis.chat.context.on('changed:chat.fix-bad-emotes', rebuild);\n\t\tthis.chat.context.on('changed:chat.emote-menu.effect-tab', rebuild);\n\t\tthis.chat.context.on('changed:chat.emote-menu.sort-emotes', rebuild);\n\t\tthis.chat.context.on('changed:chat.emote-menu.sort-tiers-last', rebuild);\n\n\t\tthis.chat.context.on('changed:chat.emoji.style', this.updateEmojiVariables, this);\n\n\t\tthis.chat.context.getChanges('chat.emote-menu.icon', val =>\n\t\t\tthis.css_tweaks.toggle('emote-menu', val));\n\n\t\tthis.updateEmojiVariables();\n\n\t\tthis.css_tweaks.setVariable('emoji-menu--sheet', `//cdn.frankerfacez.com/static/emoji/images/sheet-twemoji-36.png`);\n\t\tthis.css_tweaks.setVariable('emoji-menu--count', 58);\n\t\tthis.css_tweaks.setVariable('emoji-menu--size', 36);\n\n\t\tconst t = this,\n\t\t\tReact = await this.site.findReact(),\n\t\t\tcreateElement = React && React.createElement;\n\n\t\tif ( ! createElement )\n\t\t\treturn t.log.warn('Unable to get React.');\n\n\t\tthis.defineClasses();\n\n\n\t\tthis.EmoteMenu.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tthis._ffz_no_scan = false;\n\n\t\t\t\tif ( ! this.props ||\n\t\t\t\t\t this.props.emotePickerSource === 'bits-rewards' ||\n\t\t\t\t\t ! has(this.props, 'channelID') ||\n\t\t\t\t\t ! t.chat.context.get('chat.emote-menu.enabled')\n\t\t\t\t) {\n\t\t\t\t\treturn old_render.call(this);\n\t\t\t\t}\n\n\t\t\t\treturn (<t.MenuErrorWrapper visible={this.props.visible}>\n\t\t\t\t\t<t.MenuComponent\n\t\t\t\t\t\tsource={this.props.emotePickerSource}\n\t\t\t\t\t\tvisible={this.props.visible}\n\t\t\t\t\t\ttoggleVisibility={this.props.toggleVisibility}\n\t\t\t\t\t\tchannel_data={this.props.channelData}\n\t\t\t\t\t\temote_data={this.props.emoteSetsData}\n\t\t\t\t\t\tuser_id={this.props.currentUserID}\n\t\t\t\t\t\tchannel_id={this.props.channelID}\n\t\t\t\t\t\tloading={this.props.channelData?.loading || this.props.emoteSetsData?.loading}\n\t\t\t\t\t\terror={this.props.channelData?.error || this.props.emoteSetsData?.error}\n\t\t\t\t\t\tonClickToken={this.props.onClickToken}\n\t\t\t\t\t/>\n\t\t\t\t</t.MenuErrorWrapper>)\n\t\t\t}\n\n\t\t\tthis.EmoteMenu.forceUpdate();\n\t\t})\n\t}\n\n\tupdateEmojiVariables() {\n\n\t\tconst style = this.chat.context.get('chat.emoji.style') || 'twitter',\n\t\t\tbase = `//cdn.frankerfacez.com/static/emoji/images/sheet-${IMAGE_PATHS[style] || 'twemoji'}-`;\n\n\t\tconst emoji_size = this.emoji_size = 36,\n\t\t\tsheet_count = this.emoji_sheet_count = 58,\n\t\t\tsheet_size = this.emoji_sheet_size = sheet_count * (emoji_size + 2),\n\t\t\tsheet_pct = this.emoji_sheet_pct = 100 * sheet_size / emoji_size;\n\n\t\tthis.emoji_sheet_remain = sheet_size - emoji_size;\n\n\t\tthis.css_tweaks.set('emoji-menu', `.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {\n\tbackground-size: ${sheet_pct}% ${sheet_pct}%;\n\tbackground-image: url(\"${base}36.png\");\n\tbackground-image: ${WEBKIT}image-set(\n\t\turl(\"${base}18.png\") 0.5x,\n\t\turl(\"${base}36.png\") 1x,\n\t\turl(\"${base}72.png\") 2x\n\t);\n}`);\n\t}\n\n\tmaybeUpdate() {\n\t\tif ( ! this.chat.context.get('chat.emote-menu.enabled') )\n\t\t\treturn;\n\n\t\tfor(const inst of this.MenuWrapper.instances)\n\t\t\tinst.rebuildData();\n\t}\n\n\n\tdefineClasses() {\n\t\tconst t = this,\n\t\t\tstorage = this.settings.provider,\n\t\t\tReact = this.site.getReact(),\n\t\t\tcreateElement = React && React.createElement;\n\n\t\tthis.EmojiTonePicker = class FFZEmojiTonePicker extends React.Component {\n\t\t\tconstructor(props) {\n\t\t\t\tsuper(props);\n\n\t\t\t\tthis.onClick = () => this.setState({open: ! this.state.open});\n\t\t\t\tthis.onMouseEnter = () => this.state.open || this.setState({emoji: this.pickRandomEmoji()});\n\t\t\t\tthis.onClickOutside = () => this.state.open && this.setState({open: false});\n\n\t\t\t\tthis.clickTone = event => {\n\t\t\t\t\tthis.props.pickTone(event.currentTarget.dataset.tone);\n\t\t\t\t\tthis.setState({open: false});\n\t\t\t\t}\n\n\t\t\t\tthis.element = null;\n\t\t\t\tthis.saveRef = element => this.element = element;\n\n\t\t\t\tthis.state = {\n\t\t\t\t\topen: false,\n\t\t\t\t\temoji: this.pickRandomEmoji(),\n\t\t\t\t\ttone: null\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcomponentDidMount() {\n\t\t\t\tif ( this.element )\n\t\t\t\t\tthis._clicker = new ClickOutside(this.element, this.onClickOutside);\n\t\t\t}\n\n\t\t\tcomponentWillUnmount() {\n\t\t\t\tif ( this._clicker ) {\n\t\t\t\t\tthis._clicker.destroy();\n\t\t\t\t\tthis._clicker = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpickRandomEmoji() { // eslint-disable-line class-methods-use-this\n\t\t\t\tconst possibilities = this.props.choices,\n\t\t\t\t\tpick = Math.floor(Math.random() * possibilities.length);\n\n\t\t\t\treturn possibilities[pick];\n\t\t\t}\n\n\t\t\trenderTone(data, tone) {\n\t\t\t\tif ( ! data )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn (<button\n\t\t\t\t\tkey={data.code}\n\t\t\t\t\tdata-tone={tone}\n\t\t\t\t\tclass=\"tw-interactive tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-y-05 tw-pd-x-2\"\n\t\t\t\t\tonClick={this.clickTone}\n\t\t\t\t>\n\t\t\t\t\t{this.renderEmoji(data)}\n\t\t\t\t</button>)\n\t\t\t}\n\n\t\t\trenderToneMenu() {\n\t\t\t\tif ( ! this.state.open )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst emoji = this.state.emoji;\n\t\t\t\tif ( ! emoji || ! emoji.variants )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst tones = Object.entries(emoji.variants).map(([tone, emoji]) => this.renderTone(emoji, tone));\n\n\t\t\t\treturn (<div class=\"tw-absolute ffz-balloon ffz-il-tooltip--up ffz-il-tooltip--align-right ffz-balloon tw-block\">\n\t\t\t\t\t<div class=\"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1\">\n\t\t\t\t\t\t{this.renderTone(emoji, null)}\n\t\t\t\t\t\t{tones}\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\t\t\t}\n\n\t\t\trenderEmoji(data) { // eslint-disable-line class-methods-use-this\n\t\t\t\tif ( ! data )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst emoji_x = (data.sheet_x * (t.emoji_size + 2)) + 1,\n\t\t\t\t\temoji_y = (data.sheet_y * (t.emoji_size + 2)) + 1,\n\n\t\t\t\t\tx_pct = 100 * emoji_x / t.emoji_sheet_remain,\n\t\t\t\t\ty_pct = 100 * emoji_y / t.emoji_sheet_remain;\n\n\t\t\t\treturn (<figure\n\t\t\t\t\tclass=\"ffz--emoji-tone-picker__emoji\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tbackgroundPosition: `${x_pct}% ${y_pct}%`\n\t\t\t\t\t}}\n\t\t\t\t/>)\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\tconst emoji = this.state.emoji,\n\t\t\t\t\ttone = this.props.tone,\n\t\t\t\t\ttoned = tone && emoji.variants[tone];\n\n\t\t\t\treturn (<div ref={this.saveRef} class=\"ffz--emoji-tone-picker tw-relative tw-mg-l-1\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow\"\n\t\t\t\t\t\tonClick={this.onClick}\n\t\t\t\t\t\tonMouseEnter={this.onMouseEnter}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"tw-button__text\">\n\t\t\t\t\t\t\t{this.renderEmoji(toned || emoji)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"tw-button__icon tw-button__icon--right\">\n\t\t\t\t\t\t\t<figure class=\"ffz-i-down-dir\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t{this.renderToneMenu()}\n\t\t\t\t</div>)\n\t\t\t}\n\t\t}\n\n\t\tthis.MenuSection = class FFZMenuSection extends React.Component {\n\t\t\tconstructor(props) {\n\t\t\t\tsuper(props);\n\n\t\t\t\tthis.ref = null;\n\t\t\t\tthis.saveRef = ref => {\n\t\t\t\t\tif ( this.ref )\n\t\t\t\t\t\tthis.props.stopObserving(this.ref);\n\n\t\t\t\t\tthis.ref = ref;\n\t\t\t\t\tif ( ref )\n\t\t\t\t\t\tthis.props.startObserving(this.ref, this);\n\t\t\t\t}\n\n\t\t\t\tconst collapsed = storage.get('emote-menu.collapsed'),\n\t\t\t\t\thidden = storage.get('emote-menu.hidden-sets');\n\n\t\t\t\tthis.state = {\n\t\t\t\t\tactive: false,\n\t\t\t\t\tactiveEmote: -1,\n\t\t\t\t\thidden: hidden && props.data && hidden.includes(props.data.hide_key || props.data.key),\n\t\t\t\t\tcollapsed: collapsed && props.data && collapsed.includes(props.data.key),\n\t\t\t\t\tintersecting: window.IntersectionObserver ? false : true\n\t\t\t\t}\n\n\t\t\t\tthis.keyHeading = this.keyHeading.bind(this);\n\t\t\t\tthis.clickHeading = this.clickHeading.bind(this);\n\t\t\t\tthis.clickEmote = this.clickEmote.bind(this);\n\n\t\t\t\tthis.mouseEnter = () => this.state.intersecting || this.setState({intersecting: true});\n\n\t\t\t\tthis.onMouseEnter = this.onMouseEnter.bind(this);\n\t\t\t\tthis.onMouseLeave = this.onMouseLeave.bind(this);\n\t\t\t}\n\n\t\t\tcomponentDidMount() {\n\t\t\t\tthis.props.addSection(this);\n\n\t\t\t\tif ( this.ref )\n\t\t\t\t\tthis.props.startObserving(this.ref, this);\n\t\t\t}\n\n\t\t\tcomponentWillUnmount() {\n\t\t\t\tthis.props.removeSection(this);\n\n\t\t\t\tif ( this.ref )\n\t\t\t\t\tthis.props.stopObserving(this.ref);\n\t\t\t}\n\n\t\t\tkeyInteract(code) { // eslint-disable-line\n\t\t\t\t/* no-op */\n\t\t\t}\n\n\t\t\tclickEmote(event) {\n\t\t\t\tif ( this.props.visibility_control ) {\n\t\t\t\t\tconst ds = event.currentTarget.dataset;\n\t\t\t\t\tlet source, id = ds.id;\n\n\t\t\t\t\tif ( ds.provider === 'twitch' )\n\t\t\t\t\t\tsource = 'twitch';\n\t\t\t\t\telse if ( ds.provider === 'ffz' ) {\n\t\t\t\t\t\tconst emote_set = t.emotes.emote_sets[ds.set],\n\t\t\t\t\t\t\temote = emote_set && emote_set.emotes[id];\n\n\t\t\t\t\t\tif ( ! emote )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tsource = emote_set.source || 'ffz';\n\t\t\t\t\t\tid = emote.id;\n\n\t\t\t\t\t} else\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tt.emotes.toggleHidden(source, id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( t.emotes.handleClick(event, true) )\n\t\t\t\t\treturn;\n\n\t\t\t\t// Check for magic.\n\t\t\t\tlet prefix = '', postfix = '';\n\t\t\t\tconst effects = event.currentTarget.dataset.effects,\n\t\t\t\t\tis_prefix = event.currentTarget.dataset.effectPrefix === 'true';\n\t\t\t\tif ( effects?.length > 0 && effects != '0' && t.emotes.target_emote ) {\n\t\t\t\t\tif ( is_prefix )\n\t\t\t\t\t\tpostfix = ` ${t.emotes.target_emote.name}`;\n\t\t\t\t\telse\n\t\t\t\t\t\tprefix = `${t.emotes.target_emote.name} `;\n\t\t\t\t}\n\n\t\t\t\tthis.props.onClickToken(`${prefix}${event.currentTarget.dataset.name}${postfix}`);\n\t\t\t}\n\n\t\t\tkeyHeading(event) {\n\t\t\t\tif ( event.keyCode === KEYS.Enter || event.keyCode === KEYS.Space )\n\t\t\t\t\tthis.clickHeading();\n\t\t\t}\n\n\t\t\tclickHeading() {\n\t\t\t\tif ( this.props.visibility_control ) {\n\t\t\t\t\tconst hidden = storage.get('emote-menu.hidden-sets') || [],\n\t\t\t\t\t\tkey = this.props.data.hide_key || this.props.data.key,\n\t\t\t\t\t\tidx = hidden.indexOf(key);\n\n\t\t\t\t\tif ( key === 'twitch-current-channel' )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif ( idx === -1 ) {\n\t\t\t\t\t\thidden.push(key);\n\t\t\t\t\t\tthis.setState({hidden: true});\n\t\t\t\t\t} else {\n\t\t\t\t\t\thidden.splice(idx, 1);\n\t\t\t\t\t\tthis.setState({hidden: false});\n\t\t\t\t\t}\n\n\t\t\t\t\tstorage.set('emote-menu.hidden-sets', hidden);\n\t\t\t\t\tt.emit('chat.emotes:change-set-hidden', key);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( this.props.filtered )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst collapsed = storage.get('emote-menu.collapsed') || [],\n\t\t\t\t\tval = ! this.state.collapsed,\n\t\t\t\t\tkey = this.props.data.key,\n\t\t\t\t\tidx = collapsed.indexOf(key);\n\n\t\t\t\tthis.setState({collapsed: val});\n\n\t\t\t\tif ( val && idx === -1 )\n\t\t\t\t\tcollapsed.push(key);\n\t\t\t\telse if ( ! val && idx !== -1 )\n\t\t\t\t\tcollapsed.splice(idx, 1);\n\t\t\t\telse\n\t\t\t\t\treturn;\n\n\t\t\t\tstorage.set('emote-menu.collapsed', collapsed);\n\t\t\t}\n\n\t\t\tonMouseEnter(event) {\n\t\t\t\tconst set_id = event.currentTarget.dataset.setId;\n\t\t\t\tthis.setState({unlocked: set_id});\n\t\t\t}\n\n\t\t\tonMouseLeave() {\n\t\t\t\tthis.setState({unlocked: null});\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\tconst data = this.props.data,\n\t\t\t\t\tfiltered = this.props.filtered,\n\t\t\t\t\tvisibility = this.props.visibility_control;\n\n\t\t\t\tlet show_heading = ! (data.is_favorites && ! this.props.combineTabs) && this.props.showHeading;\n\t\t\t\tif ( show_heading === 2 )\n\t\t\t\t\tshow_heading = ! filtered;\n\t\t\t\telse\n\t\t\t\t\tshow_heading = !! show_heading;\n\n\t\t\t\tif ( visibility )\n\t\t\t\t\tshow_heading = true;\n\n\t\t\t\tconst hidden = visibility ? this.state.hidden : false,\n\t\t\t\t\tcollapsed = visibility ? hidden : (show_heading && ! filtered && this.state.collapsed);\n\n\t\t\t\tif ( ! data )\n\t\t\t\t\treturn null;\n\n\t\t\t\tlet image;\n\t\t\t\tif ( data.image )\n\t\t\t\t\timage = (<img class={`ffz--menu-badge${data.image_large ? ' ffz--menu-badge__large' : ''}`} src={data.image} srcSet={data.image_set} />);\n\t\t\t\telse\n\t\t\t\t\timage = (<figure class={`ffz--menu-badge ffz-i-${data.icon || 'zreknarf'}`} />);\n\n\t\t\t\tlet calendar;\n\n\t\t\t\tconst renews = data.renews && data.renews.getTime(),\n\t\t\t\t\tends = data.ends && data.ends.getTime();\n\n\t\t\t\tif ( renews > 0 ) {\n\t\t\t\t\tcalendar = {\n\t\t\t\t\t\ticon: 'calendar',\n\t\t\t\t\t\tmessage: t.i18n.t('emote-menu.sub-renews', 'This sub renews {seconds,humantime}.', {seconds: renews})\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( ends ) {\n\t\t\t\t\tif ( data.prime )\n\t\t\t\t\t\tcalendar = {\n\t\t\t\t\t\t\ticon: 'crown',\n\t\t\t\t\t\t\tmessage: t.i18n.t('emote-menu.sub-prime', 'This is your free sub with Prime Gaming.\\nIt ends {seconds,humantime}.', {seconds: ends})\n\t\t\t\t\t\t}\n\t\t\t\t\telse if ( data.gift )\n\t\t\t\t\t\tcalendar = {\n\t\t\t\t\t\t\ticon: 'gift',\n\t\t\t\t\t\t\tmessage: t.i18n.t('emote-menu.sub-gift-ends', 'This gifted sub ends {seconds,humantime}.', {seconds: ends})\n\t\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tcalendar = {\n\t\t\t\t\t\t\ticon: 'calendar-empty',\n\t\t\t\t\t\t\tmessage: t.i18n.t('emote-menu.sub-ends', 'This sub ends {seconds,humantime}.', {seconds: ends})\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet source = data.source_i18n ? t.i18n.t(data.source_i18n, data.source) : data.source;\n\t\t\t\tif ( source == null )\n\t\t\t\t\tsource = 'FFZ';\n\n\t\t\t\treturn (<section ref={this.saveRef} data-key={data.key} class={filtered ? 'filtered' : ''} onMouseEnter={this.mouseEnter}>\n\t\t\t\t\t{show_heading ? (<heading tabindex=\"0\" class=\"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap\" onKeyDown={this.keyHeading} onClick={this.clickHeading}>\n\t\t\t\t\t\t{image}\n\t\t\t\t\t\t<div class=\"tw-pd-l-05\">\n\t\t\t\t\t\t\t{(data.i18n ? t.i18n.t(data.i18n, data.title) : data.title) || t.i18n.t('emote-menu.unknown', 'Unknown Source')}\n\t\t\t\t\t\t\t{! visibility && calendar && (<span\n\t\t\t\t\t\t\t\tclass={`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${calendar.icon}`}\n\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\tdata-title={calendar.message}\n\t\t\t\t\t\t\t/>)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"tw-flex-grow-1\" />\n\t\t\t\t\t\t<span class={!visibility && data.channel_source ? 'ffz-tooltip' : ''} data-title={data.channel_source}>{\n\t\t\t\t\t\t\tvisibility ?\n\t\t\t\t\t\t\t\t(hidden ?\n\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.visibility.hidden', 'Hidden') :\n\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.visibility.visible', 'Visible') )\n\t\t\t\t\t\t\t\t: source\n\t\t\t\t\t\t}</span>\n\t\t\t\t\t\t{(visibility ? false : filtered) ? '' : <figure class={`tw-pd-l-05 ffz-i-${collapsed ? 'left' : 'down'}-dir`} />}\n\t\t\t\t\t</heading>) : null}\n\t\t\t\t\t{collapsed || this.renderBody(show_heading)}\n\t\t\t\t</section>)\n\t\t\t}\n\n\t\t\trenderBody(show_sources) {\n\t\t\t\tconst data = this.props.data,\n\t\t\t\t\tfiltered = this.props.filtered,\n\t\t\t\t\tlock = data.locks && data.locks[this.state.unlocked],\n\n\t\t\t\t\temotes = data.filtered_emotes && data.filtered_emotes.map(emote => {\n\t\t\t\t\t\tif ( filtered && emote.locked )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tconst locked = emote.locked && (! lock || ! lock.emotes.has(emote.id)),\n\t\t\t\t\t\t\temote_lock = locked && data.locks && data.locks[emote.set_id];\n\t\t\t\t\t\tlet sellout = '';\n\n\t\t\t\t\t\tif ( emote_lock ) {\n\t\t\t\t\t\t\tif ( emote_lock.id === 'subwoofer' ) {\n\t\t\t\t\t\t\t\tsellout = t.i18n.t('emote-menu.emote-subwoofer', 'Become an FFZ Subwoofer to unlock this emote.');\n\t\t\t\t\t\t\t} else if ( emote_lock.id === 'cheer' ) {\n\t\t\t\t\t\t\t\tsellout = t.i18n.t('emote-menu.emote-cheer', 'Cheer an additional {bits_remaining, plural, one {# bit} other {# bits}} to unlock this emote.', emote_lock);\n\t\t\t\t\t\t\t} else if ( emote_lock.id === 'follower' ) {\n\t\t\t\t\t\t\t\tsellout = t.i18n.t('emote-menu.emote-follower', 'Follow {user} to unlock this emote in their channel.', emote_lock);\n\t\t\t\t\t\t\t} else if ( data.all_locked )\n\t\t\t\t\t\t\t\tsellout = t.i18n.t('emote-menu.emote-sub', 'Subscribe for {price} to unlock this emote.', emote_lock);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tsellout = t.i18n.t('emote-menu.emote-up', 'Upgrade your sub to {price} to unlock this emote.', emote_lock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this.renderEmote(\n\t\t\t\t\t\t\temote,\n\t\t\t\t\t\t\tlocked,\n\t\t\t\t\t\t\tshow_sources,\n\t\t\t\t\t\t\tsellout\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\treturn (<div class=\"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center\">\n\t\t\t\t\t{emotes}\n\t\t\t\t\t{! this.props.visibility_control && !filtered && this.renderSellout()}\n\t\t\t\t</div>)\n\t\t\t}\n\n\t\t\trenderEmote(emote, locked, source, sellout) {\n\t\t\t\tif ( ! this.state.intersecting )\n\t\t\t\t\treturn <span key={emote.id} class=\"emote-picker__placeholder\" style={{width: `${emote.width||28}px`, height: `${emote.height||28}px`}} />;\n\n\t\t\t\tconst visibility = this.props.visibility_control,\n\t\t\t\t\tmodifiers = this.props.emote_modifiers[emote.id],\n\t\t\t\t\thas_modifiers = Array.isArray(modifiers) && modifiers.length > 0,\n\t\t\t\t\t//has_menu = has_modifiers && this.state.open_menu == emote.id,\n\t\t\t\t\tanimated = this.props.animated,\n\t\t\t\t\thidden = visibility && emote.hidden,\n\n\t\t\t\t\ttt = t.chat.context.get('chat.emote-menu.tooltips');\n\n\t\t\t\tlet src, srcSet;\n\t\t\t\tif ( animated && emote.animSrc ) {\n\t\t\t\t\tsrc = emote.animSrc;\n\t\t\t\t\tsrcSet = emote.animSrcSet;\n\t\t\t\t} else {\n\t\t\t\t\tsrc = emote.src;\n\t\t\t\t\tsrcSet = emote.srcSet;\n\t\t\t\t}\n\n\t\t\t\treturn (<button\n\t\t\t\t\tkey={emote.id}\n\t\t\t\t\tclass={`${tt ? 'ffz-tooltip ' : ''}emote-picker__emote-link${!visibility && locked ? ' locked' : ''}${hidden ? ' emote-hidden' : ''}`}\n\t\t\t\t\tdata-tooltip-type=\"emote\"\n\t\t\t\t\tdata-provider={emote.provider}\n\t\t\t\t\tdata-id={emote.id}\n\t\t\t\t\tdata-set={emote.set_id}\n\t\t\t\t\tdata-code={emote.code}\n\t\t\t\t\tdata-modifiers={modifiers}\n\t\t\t\t\tdata-effects={emote.effects}\n\t\t\t\t\tdata-effect-prefix={emote.effect_prefix}\n\t\t\t\t\tdata-variant={emote.variant}\n\t\t\t\t\tdata-no-source={source}\n\t\t\t\t\tdata-name={emote.name}\n\t\t\t\t\taria-label={emote.name}\n\t\t\t\t\tdata-locked={emote.locked}\n\t\t\t\t\tdata-sellout={sellout}\n\t\t\t\t\tonClick={(this.props.visibility_control || !emote.locked) && this.clickEmote}\n\t\t\t\t>\n\t\t\t\t\t<figure class=\"emote-picker__emote-figure\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclass={`emote-picker__emote-image${emote.emoji ? ' ffz-emoji' : ''}`}\n\t\t\t\t\t\t\tsrc={src}\n\t\t\t\t\t\t\tsrcSet={srcSet}\n\t\t\t\t\t\t\talt={emote.name}\n\t\t\t\t\t\t\theight={emote.height ? `${emote.height}px` : null}\n\t\t\t\t\t\t\twidth={emote.width ? `${emote.width}px` : null}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</figure>\n\t\t\t\t\t{! visibility && has_modifiers && <div class=\"emote-button__options\" />}\n\t\t\t\t\t{! visibility && emote.favorite && <figure class=\"ffz--favorite ffz-i-star\" />}\n\t\t\t\t\t{! visibility && locked && <figure class={`ffz-i-${emote.lock_icon || 'lock'}`} />}\n\t\t\t\t\t{hidden && <figure class=\"ffz-i-eye-off\" />}\n\t\t\t\t</button>)\n\t\t\t}\n\n\t\t\trenderSellout() {\n\t\t\t\tconst data = this.props.data;\n\n\t\t\t\tif ( ! data.all_locked || ! data.locks )\n\t\t\t\t\treturn null;\n\n\t\t\t\tlet lock = data.locks[this.state.unlocked],\n\t\t\t\t\tlocks = Object.values(data.locks).filter(x => x.id !== 'cheer'),\n\t\t\t\t\thas_ffz = locks.filter(x => x.is_ffz).length > 0;\n\n\t\t\t\tif ( ! lock && data.locks.length === 1 )\n\t\t\t\t\tlock = data.locks[0];\n\n\t\t\t\tif ( ! locks.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn (<div class=\"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0\">\n\t\t\t\t\t{has_ffz\n\t\t\t\t\t\t? t.i18n.t('emote-menu.ffz-unlock', 'This feature is available to FFZ Subwoofers.')\n\t\t\t\t\t\t: (lock\n\t\t\t\t\t\t\t? t.i18n.t('emote-menu.sub-unlock', 'Subscribe for {price} to unlock {count, plural, one {# emote} other {# emotes}}', {price: lock.price, count: lock.emotes.size})\n\t\t\t\t\t\t\t: t.i18n.t('emote-menu.sub-basic', 'Subscribe to unlock some emotes')\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\t{has_ffz && this.props.ffz_sub_data?.has_free_sub\n\t\t\t\t\t\t? <div class=\"tw-pd-y-1\">{t.i18n.t('emote-menu.free-sub.about', 'As thanks for supporting us in the past, you can get one month of FFZ Subwoofer for free.')}</div>\n\t\t\t\t\t\t: null}\n\t\t\t\t\t<div class=\"ffz--sub-buttons tw-mg-t-05\">\n\t\t\t\t\t\t{locks.map(lock => lock.hide_button ? null : (<a\n\t\t\t\t\t\t\tkey={lock.price}\n\t\t\t\t\t\t\tclass=\"tw-button tw-border-radius-none\"\n\t\t\t\t\t\t\thref={lock.url}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\tdata-set-id={lock.set_id}\n\t\t\t\t\t\t\tonMouseEnter={this.onMouseEnter}\n\t\t\t\t\t\t\tonMouseLeave={this.onMouseLeave}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class=\"tw-button__text\">\n\t\t\t\t\t\t\t\t{has_ffz && this.props.ffz_sub_data?.has_free_sub\n\t\t\t\t\t\t\t\t\t? t.i18n.t('emote-menu.free-sub', 'Use My Free Month')\n\t\t\t\t\t\t\t\t\t: lock.price\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</a>))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>)\n\t\t\t}\n\t\t}\n\n\t\tthis.fine.wrap('ffz-menu-section', this.MenuSection);\n\n\t\tthis.EmojiSection = class FFZMenuEmojiSection extends this.MenuSection {\n\t\t\trenderEmote(emote, locked, source, sellout) {\n\t\t\t\tconst emoji_x = (emote.x * (t.emoji_size + 2)) + 1,\n\t\t\t\t\temoji_y = (emote.y * (t.emoji_size + 2)) + 1,\n\n\t\t\t\t\tx_pct = 100 * emoji_x / t.emoji_sheet_remain,\n\t\t\t\t\ty_pct = 100 * emoji_y / t.emoji_sheet_remain,\n\n\t\t\t\t\ttt = t.chat.context.get('chat.emote-menu.tooltips');\n\n\t\t\t\treturn (<button\n\t\t\t\t\tkey={emote.id}\n\t\t\t\t\tclass={`${tt ? 'ffz-tooltip ' : ''}emote-picker__emote-link${locked ? ' locked' : ''}${emote.emoji ? ' emote-picker__emoji' : ''}`}\n\t\t\t\t\tdata-tooltip-type=\"emote\"\n\t\t\t\t\tdata-provider={emote.provider}\n\t\t\t\t\tdata-id={emote.id}\n\t\t\t\t\tdata-set={emote.set_id}\n\t\t\t\t\tdata-code={emote.code}\n\t\t\t\t\tdata-variant={emote.variant}\n\t\t\t\t\tdata-no-source={source}\n\t\t\t\t\tdata-name={emote.name}\n\t\t\t\t\taria-label={emote.name}\n\t\t\t\t\tdata-locked={emote.locked}\n\t\t\t\t\tdata-sellout={sellout}\n\t\t\t\t\tonClick={!emote.locked && this.clickEmote}\n\t\t\t\t>\n\t\t\t\t\t<figure\n\t\t\t\t\t\tclass=\"emote-picker__emote-figure\"\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tbackgroundPosition: `${x_pct}% ${y_pct}%`,\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t\t{emote.favorite && <figure class=\"ffz--favorite ffz-i-star\" />}\n\t\t\t\t\t{locked && <figure class={`ffz-i-${emote.lock_icon || 'lock'}`} />}\n\t\t\t\t</button>)\n\t\t\t}\n\t\t}\n\n\t\tlet timer;\n\t\tconst doClear = () => requestAnimationFrame(() => this.emit('tooltips:cleanup')),\n\t\t\tclearTooltips = () => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tsetTimeout(doClear, 100);\n\t\t\t};\n\n\t\tthis.MenuErrorWrapper = class FFZEmoteMenuErrorWrapper extends React.Component {\n\t\t\tconstructor(props) {\n\t\t\t\tsuper(props);\n\t\t\t\tthis.state = {errored: false, error: null};\n\t\t\t}\n\n\t\t\tstatic getDerivedStateFromError(error) {\n\t\t\t\treturn {\n\t\t\t\t\terrored: true,\n\t\t\t\t\terror\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcomponentDidCatch(error) { // eslint-disable-line class-methods-use-this\n\t\t\t\tt.log.capture(error);\n\t\t\t\tt.log.error('Error rendering the FFZ Emote Menu.');\n\t\t\t\tthis.setState({\n\t\t\t\t\terrored: true,\n\t\t\t\t\terror\n\t\t\t\t});\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\tif ( this.state.errored ) {\n\t\t\t\t\tif ( ! this.props.visible )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\tconst padding = t.chat.context.get('chat.emote-menu.reduced-padding');\n\n\t\t\t\t\treturn (<div\n\t\t\t\t\t\tclass={`ffz-balloon ffz-balloon--md ffz-il-tooltip--up ffz-il-tooltip--align-right tw-block tw-absolute ffz--emote-picker${padding ? ' reduced-padding' : ''}`}\n\t\t\t\t\t\tdata-a-target=\"emote-picker\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"emote-picker__tab-content scrollable-area\"\n\t\t\t\t\t\t\t\tdata-test-selector=\"scrollable-area-wrapper\"\n\t\t\t\t\t\t\t\tdata-simplebar\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-center tw-pd-1\">\n\t\t\t\t\t\t\t\t\t<div class=\"tw-mg-b-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"tw-mg-2\">\n\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\tsrc=\"//cdn.frankerfacez.com/emoticon/26608/2\"\n\t\t\t\t\t\t\t\t\t\t\t\tsrcSet=\"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{t.i18n.t('emote-menu.error', 'There was an error rendering this menu.')}\n\t\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t\t{t.settings.get('reports.error.enable') ?\n\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.error-report', 'An error report has been automatically submitted.')\n\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t<div class=\"tw-mg-t-05 tw-border-t-1 tw-pd-t-05\">\n\t\t\t\t\t\t\t\t\t\t\t{t.i18n.t('emote-menu.disable', 'As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.') }\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>);\n\t\t\t\t}\n\n\t\t\t\treturn this.props.children;\n\t\t\t}\n\t\t}\n\n\t\tthis.MenuComponent = class FFZEmoteMenuComponent extends React.Component {\n\t\t\tconstructor(props) {\n\t\t\t\tsuper(props);\n\n\t\t\t\tthis.nav_ref = null;\n\t\t\t\tthis.saveNavRef = ref => {\n\t\t\t\t\tthis.nav_ref = ref;\n\t\t\t\t}\n\n\t\t\t\tthis.ref = null;\n\t\t\t\tthis.saveScrollRef = ref => {\n\t\t\t\t\tthis.ref = ref;\n\t\t\t\t\tthis.createObserver();\n\t\t\t\t}\n\n\t\t\t\tthis.sections = [];\n\t\t\t\tthis.activeSection = -1;\n\n\t\t\t\tthis.state = {\n\t\t\t\t\ttab: null,\n\t\t\t\t\tactive_nav: null,\n\t\t\t\t\tstayLoaded: t.chat.context.get('chat.emote-menu.stay-loaded'),\n\t\t\t\t\tquickNav: t.chat.context.get('chat.emote-menu.show-quick-nav'),\n\t\t\t\t\tanimated: t.chat.context.get('chat.emotes.animated'),\n\t\t\t\t\tshowHeading: t.chat.context.get('chat.emote-menu.show-heading'),\n\t\t\t\t\ttall: t.chat.context.get('chat.emote-menu.tall'),\n\t\t\t\t\treducedPadding: t.chat.context.get('chat.emote-menu.reduced-padding'),\n\t\t\t\t\tcombineTabs: t.chat.context.get('chat.emote-menu.combine-tabs'),\n\t\t\t\t\tshowSearch: t.chat.context.get('chat.emote-menu.show-search'),\n\t\t\t\t\tclearSearch: t.chat.context.get('chat.emote-menu.clear-search'),\n\t\t\t\t\thasNewEffects: false,\n\t\t\t\t\tunlockedEffects: t.settings.provider.get('unlocked-effects', []),\n\t\t\t\t\ttone: t.settings.provider.get('emoji-tone', null)\n\t\t\t\t}\n\n\t\t\t\tif ( props.visible ) {\n\t\t\t\t\tthis.loadData();\n\t\t\t\t\tif ( this.state.wants_plan_info )\n\t\t\t\t\t\tthis.loadFFZPlanData();\n\t\t\t\t\tif ( this.state.wants_resub_info )\n\t\t\t\t\t\tthis.loadFFZSubData();\n\t\t\t\t}\n\n\t\t\t\tthis.rebuildData();\n\n\t\t\t\tthis.observing = new Map;\n\n\t\t\t\tthis.addSection = inst => {\n\t\t\t\t\tif ( ! this.sections.includes(inst) )\n\t\t\t\t\t\tthis.sections.push(inst);\n\t\t\t\t}\n\n\t\t\t\tthis.removeSection = inst => {\n\t\t\t\t\tconst idx = this.sections.indexOf(inst);\n\t\t\t\t\tif ( idx !== -1 ) {\n\t\t\t\t\t\tthis.sections.splice(idx);\n\t\t\t\t\t\tif ( idx === this.activeSection )\n\t\t\t\t\t\t\tthis.activeSection = -1;\n\t\t\t\t\t\telse if ( idx < this.activeSection )\n\t\t\t\t\t\t\tthis.activeSection--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.startObserving = this.startObserving.bind(this);\n\t\t\t\tthis.stopObserving = this.stopObserving.bind(this);\n\t\t\t\tthis.handleObserve = this.handleObserve.bind(this);\n\t\t\t\tthis.pickTone = this.pickTone.bind(this);\n\t\t\t\tthis.clickTab = this.clickTab.bind(this);\n\t\t\t\tthis.clickSideNav = this.clickSideNav.bind(this);\n\t\t\t\t//this.clickRefresh = this.clickRefresh.bind(this);\n\t\t\t\tthis.handleFilterChange = this.handleFilterChange.bind(this);\n\t\t\t\tthis.handleKeyDown = this.handleKeyDown.bind(this);\n\t\t\t\tthis.toggleVisibilityControl = this.toggleVisibilityControl.bind(this);\n\t\t\t}\n\n\t\t\tcreateObserver() {\n\t\t\t\tif ( this.observer ) {\n\t\t\t\t\tif ( this._observed === this.ref )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tthis.observer.disconnect();\n\t\t\t\t\tthis.observer = this._observed = null;\n\t\t\t\t}\n\n\t\t\t\tif ( ! this.ref || ! window.IntersectionObserver )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._observed = this.ref;\n\t\t\t\tthis.observer = new IntersectionObserver(this.handleObserve, {\n\t\t\t\t\troot: this.ref,\n\t\t\t\t\trootMargin: '50px 0px',\n\t\t\t\t\tthreshold: 0.01\n\t\t\t\t});\n\n\t\t\t\tfor(const element of this.observing.keys())\n\t\t\t\t\tthis.observer.observe(element);\n\n\t\t\t\tthis.observeSoon();\n\t\t\t}\n\n\t\t\tobserveSoon() {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tif ( this.observer )\n\t\t\t\t\t\tthis.handleObserve(this.observer.takeRecords());\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdestroyObserver() {\n\t\t\t\tif ( ! this.observer )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.observer.disconnect();\n\t\t\t\tthis.observer = this._observed = null;\n\t\t\t}\n\n\t\t\tscrollNavIntoView() {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tconst el = this.nav_ref?.querySelector?.(`button[data-key=\"${this.state.active_nav}\"]`);\n\t\t\t\t\tif ( el )\n\t\t\t\t\t\tscrollIntoView(el);\n\t\t\t\t\t\t//el.scrollIntoView({block: 'nearest', inline: 'start'});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\thandleObserve(event) {\n\t\t\t\tlet changed = false,\n\t\t\t\t\tactive = this.state.active_nav;\n\n\t\t\t\tfor(const entry of event) {\n\t\t\t\t\tconst inst = this.observing.get(entry.target),\n\t\t\t\t\t\tintersecting = entry.isIntersecting;\n\t\t\t\t\tif ( ! inst || inst.state.intersecting === intersecting )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tinst.setState({intersecting});\n\n\t\t\t\t\tif ( intersecting )\n\t\t\t\t\t\tactive = inst.props?.data?.key;\n\t\t\t\t}\n\n\t\t\t\tif ( changed ) {\n\t\t\t\t\trequestAnimationFrame(clearTooltips);\n\n\t\t\t\t\tif ( ! this.lock_active && active !== this.state.active_nav )\n\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\tactive_nav: active\n\t\t\t\t\t\t}, () => this.scrollNavIntoView());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstartObserving(element, inst) {\n\t\t\t\tconst old_inst = this.observing.get(element);\n\t\t\t\tif ( inst === old_inst )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( old_inst )\n\t\t\t\t\tthis.stopObserving(element);\n\n\t\t\t\tthis.observing.set(element, inst);\n\t\t\t\tif ( this.observer )\n\t\t\t\t\tthis.observer.observe(element);\n\n\t\t\t\tthis.observeSoon();\n\t\t\t}\n\n\t\t\tstopObserving(element) {\n\t\t\t\tif ( ! this.observing.has(element) )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.observing.delete(element);\n\t\t\t\tif ( this.observer )\n\t\t\t\t\tthis.observer.unobserve(element);\n\t\t\t}\n\n\t\t\tcomponentDidMount() {\n\t\t\t\tif ( this.ref )\n\t\t\t\t\tthis.createObserver();\n\n\t\t\t\tt.chat.context.on('changed:chat.emotes.animated', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.stay-loaded', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.show-quick-nav', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.reduced-padding', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.show-heading', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.combine-tabs', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.show-search', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.clear-search', this.updateSettingState, this);\n\t\t\t\tt.chat.context.on('changed:chat.emote-menu.tall', this.updateSettingState, this);\n\n\t\t\t\twindow.ffz_menu = this;\n\t\t\t}\n\n\t\t\tcomponentWillUnmount() {\n\t\t\t\tthis.destroyObserver();\n\n\t\t\t\tt.chat.context.off('changed:chat.emotes.animated', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.stay-loaded', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.show-quick-nav', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.show-heading', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.reduced-padding', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.combine-tabs', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.show-search', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.clear-search', this.updateSettingState, this);\n\t\t\t\tt.chat.context.off('changed:chat.emote-menu.tall', this.updateSettingState, this);\n\n\t\t\t\tif ( window.ffz_menu === this )\n\t\t\t\t\twindow.ffz_menu = null;\n\t\t\t}\n\n\t\t\tupdateSettingState() {\n\t\t\t\tthis.setState({\n\t\t\t\t\tstayLoaded: t.chat.context.get('chat.emote-menu.stay-loaded'),\n\t\t\t\t\tquickNav: t.chat.context.get('chat.emote-menu.show-quick-nav'),\n\t\t\t\t\tanimated: t.chat.context.get('chat.emotes.animated'),\n\t\t\t\t\tshowHeading: t.chat.context.get('chat.emote-menu.show-heading'),\n\t\t\t\t\treducedPadding: t.chat.context.get('chat.emote-menu.reduced-padding'),\n\t\t\t\t\tcombineTabs: t.chat.context.get('chat.emote-menu.combine-tabs'),\n\t\t\t\t\tshowSearch: t.chat.context.get('chat.emote-menu.show-search'),\n\t\t\t\t\tclearSearch: t.chat.context.get('chat.emote-menu.clear-search'),\n\t\t\t\t\ttall: t.chat.context.get('chat.emote-menu.tall')\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tseeEffects() {\n\t\t\t\tif ( this.state.hasNewEffects ) {\n\t\t\t\t\tt.settings.provider.set('unlocked-effects', this.state.unlockedEffects);\n\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\thasNewEffects: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpickTone(tone) {\n\t\t\t\ttone = tone || null;\n\t\t\t\tt.settings.provider.set('emoji-tone', tone);\n\n\t\t\t\tthis.setState(this.filterState(\n\t\t\t\t\tthis.state.filter,\n\t\t\t\t\tthis.buildEmoji(\n\t\t\t\t\t\tObject.assign({}, this.state, {tone})\n\t\t\t\t\t)\n\t\t\t\t));\n\t\t\t}\n\n\t\t\tclickSideNav(event) {\n\t\t\t\tconst key = event.currentTarget.dataset.key;\n\t\t\t\tconst el = this.ref?.querySelector?.(`section[data-key=\"${key}\"]`);\n\t\t\t\tif ( el ) {\n\t\t\t\t\tthis.lock_active = true;\n\t\t\t\t\tscrollIntoView(el);\n\t\t\t\t\t//el.scrollIntoView({block: 'nearest', inline: 'start'});\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tactive_nav: key\n\t\t\t\t\t});\n\t\t\t\t\tsetTimeout(() => this.lock_active = false, 250);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclickTab(event) {\n\t\t\t\tconst tab = event.currentTarget.dataset.tab;\n\n\t\t\t\tif ( tab === 'effect' )\n\t\t\t\t\tthis.seeEffects();\n\n\t\t\t\tif ( this.state.combineTabs ) {\n\t\t\t\t\tlet sets;\n\t\t\t\t\tswitch(tab) {\n\t\t\t\t\t\tcase 'fav':\n\t\t\t\t\t\t\tsets = this.state.filtered_fav_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'channel':\n\t\t\t\t\t\t\tsets = this.state.filtered_channel_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'effect':\n\t\t\t\t\t\t\tsets = this.state.filtered_effect_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'emoji':\n\t\t\t\t\t\t\tsets = this.state.filtered_emoji_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'all':\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tsets = this.state.filtered_all_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst set = sets && sets[0],\n\t\t\t\t\t\tel = set && this.ref?.querySelector?.(`section[data-key=\"${set.key}\"]`);\n\n\t\t\t\t\tif ( el )\n\t\t\t\t\t\tscrollIntoView(el);\n\t\t\t\t\t\t//el.scrollIntoView({block: 'nearest', inline: 'start'});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setState({\n\t\t\t\t\ttab\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tclickSettings(event) { // eslint-disable-line class-methods-use-this\n\t\t\t\tconst evt = new FFZEvent({\n\t\t\t\t\titem: 'chat.emote_menu',\n\t\t\t\t\tevent,\n\t\t\t\t\terrored: false\n\t\t\t\t});\n\n\t\t\t\tt.emit('main_menu:open', evt);\n\n\t\t\t\t/*const layout = t.resolve('site.layout');\n\t\t\t\tif ( (layout && layout.is_minimal) || (event && (event.ctrlKey || event.shiftKey)) ) {\n\t\t\t\t\tconst win = window.open(\n\t\t\t\t\t\t'https://twitch.tv/popout/frankerfacez/chat?ffz-settings',\n\t\t\t\t\t\t'_blank',\n\t\t\t\t\t\t'resizable=yes,scrollbars=yes,width=850,height=600'\n\t\t\t\t\t);\n\n\t\t\t\t\tif ( win )\n\t\t\t\t\t\twin.focus();\n\n\t\t\t\t} else {\n\t\t\t\t\tconst menu = t.resolve('main_menu');\n\n\t\t\t\t\tif ( menu ) {\n\t\t\t\t\t\tmenu.requestPage('chat.emote_menu');\n\t\t\t\t\t\tif ( menu.showing )\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tt.emit('site.menu_button:clicked');\n\t\t\t\t}*/\n\t\t\t}\n\n\t\t\t/*clickRefresh(event) {\n\t\t\t\tconst target = event.currentTarget,\n\t\t\t\t\ttt = target && target._ffz_tooltip;\n\n\t\t\t\tif ( tt && tt.hide )\n\t\t\t\t\ttt.hide();\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tloading: true\n\t\t\t\t}, async () => {\n\t\t\t\t\tconst props = this.props,\n\t\t\t\t\t\tpromises = [],\n\t\t\t\t\t\temote_data = props.emote_data,\n\t\t\t\t\t\tchannel_data = props.channel_data;\n\n\t\t\t\t\tif ( emote_data )\n\t\t\t\t\t\tpromises.push(emote_data.refetch())\n\n\t\t\t\t\tif ( channel_data )\n\t\t\t\t\t\tpromises.push(channel_data.refetch());\n\n\t\t\t\t\tawait Promise.all(promises);\n\n\t\t\t\t\tconst es = props.emote_data && props.emote_data.emoteSets,\n\t\t\t\t\t\tsets = es && es.length ? new Set(es.map(x => parseInt(x.id, 10))) : new Set;\n\n\t\t\t\t\tconst data = await t.getData(sets, true);\n\t\t\t\t\tthis.setState(this.filterState(this.state.filter, this.buildState(\n\t\t\t\t\t\tthis.props,\n\t\t\t\t\t\tObject.assign({}, this.state, {set_sets: sets, set_data: data, loading: false})\n\t\t\t\t\t)));\n\t\t\t\t});\n\t\t\t}*/\n\n\t\t\ttoggleVisibilityControl() {\n\t\t\t\tthis.setState(this.filterState(this.state.filter, this.state, ! this.state.visibility_control));\n\t\t\t}\n\n\t\t\thandleFilterChange(event) {\n\t\t\t\tthis.setState(this.filterState(event.target.value, this.state));\n\t\t\t}\n\n\t\t\thandleKeyDown(event) {\n\t\t\t\tconst code = event.keyCode;\n\t\t\t\tif ( code === KEYS.Escape )\n\t\t\t\t\tthis.props.toggleVisibility();\n\t\t\t\telse\n\t\t\t\t\treturn;\n\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\n\t\t\tloadData(force = false, props, state) {\n\t\t\t\tstate = state || this.state;\n\t\t\t\tif ( ! state )\n\t\t\t\t\treturn false;\n\n\t\t\t\tprops = props || this.props;\n\n\t\t\t\tconst emote_sets = props.emote_data && props.emote_data.emoteSets,\n\t\t\t\t\tsets = Array.isArray(emote_sets) ? new Set(emote_sets.map(x => x.id)) : new Set;\n\n\t\t\t\tforce = force || (state.set_data && ! set_equals(state.set_sets, sets));\n\n\t\t\t\tif ( state.set_data && ! force )\n\t\t\t\t\treturn false;\n\n\t\t\t\tthis.setState({loading: true}, () => {\n\t\t\t\t\tt.getData(sets, force).then(d => {\n\t\t\t\t\t\tthis.setState(this.filterState(this.state.filter, this.buildState(\n\t\t\t\t\t\t\tthis.props,\n\t\t\t\t\t\t\tObject.assign({}, this.state, {set_sets: sets, set_data: d, loading: false})\n\t\t\t\t\t\t)));\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tloadFFZPlanData(force = false, props, state) {\n\t\t\t\tstate = state || this.state;\n\t\t\t\tif ( ! state || state.ffz_plan_loading )\n\t\t\t\t\treturn false;\n\n\t\t\t\tif ( state.ffz_sub_data && ! force )\n\t\t\t\t\treturn false;\n\n\t\t\t\tthis.setState({ffz_plan_loading: true}, () => {\n\t\t\t\t\tt.getFFZSubPrices().then(d => {\n\t\t\t\t\t\tthis.setState(this.filterState(this.state.filter, this.buildState(\n\t\t\t\t\t\t\tthis.props,\n\t\t\t\t\t\t\tObject.assign({}, this.state, {ffz_plan_data: d, ffz_plan_loading: false})\n\t\t\t\t\t\t)));\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tloadFFZSubData(force = false, props, state) {\n\t\t\t\tstate = state || this.state;\n\t\t\t\tif ( ! state || state.ffz_loading )\n\t\t\t\t\treturn false;\n\n\t\t\t\tif ( state.ffz_sub_data && ! force )\n\t\t\t\t\treturn false;\n\n\t\t\t\tthis.setState({ffz_loading: true}, () => {\n\t\t\t\t\tt.getFFZSubData().then(d => {\n\t\t\t\t\t\tthis.setState(this.filterState(this.state.filter, this.buildState(\n\t\t\t\t\t\t\tthis.props,\n\t\t\t\t\t\t\tObject.assign({}, this.state, {ffz_sub_data: d, ffz_loading: false})\n\t\t\t\t\t\t)));\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfilterState(input, old_state, visibility_control) {\n\t\t\t\tconst state = Object.assign({}, old_state);\n\n\t\t\t\tif ( visibility_control != null )\n\t\t\t\t\tstate.visibility_control = visibility_control;\n\t\t\t\telse\n\t\t\t\t\tvisibility_control = state.visibility_control;\n\n\t\t\t\tstate.filter = input;\n\t\t\t\tstate.filtered = input && input.length > 0 && input !== ':' || false;\n\n\t\t\t\tstate.filtered_channel_sets = this.filterSets(input, state.channel_sets, visibility_control);\n\t\t\t\tstate.filtered_effect_sets = this.filterSets(input, state.effect_sets, visibility_control);\n\t\t\t\tstate.filtered_all_sets = this.filterSets(input, state.all_sets, visibility_control);\n\t\t\t\tstate.filtered_fav_sets = this.filterSets(input, state.fav_sets, visibility_control);\n\t\t\t\tstate.filtered_emoji_sets = this.filterSets(input, state.emoji_sets, visibility_control);\n\n\t\t\t\tstate.has_effect_tab = state.filtered_effect_sets.length > 0;\n\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\tfilterSets(input, sets, visibility_control) {\n\t\t\t\tconst out = [];\n\t\t\t\tif ( ! sets || ! sets.length )\n\t\t\t\t\treturn out;\n\n\t\t\t\tconst filtering = input && input.length > 0 && input !== ':',\n\t\t\t\t\thidden_sets = storage.get('emote-menu.hidden-sets') || [];\n\n\t\t\t\tfor(const emote_set of sets) {\n\t\t\t\t\tif ( ! visibility_control && hidden_sets.includes(emote_set.key) )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tconst filtered = emote_set.filtered_emotes = emote_set.emotes.filter(emote => {\n\t\t\t\t\t\tif ( ! visibility_control && emote.hidden )\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\treturn ! filtering || (! emote.locked && this.doesEmoteMatch(input, emote))\n\t\t\t\t\t});\n\n\t\t\t\t\tif ( filtered.length )\n\t\t\t\t\t\tout.push(emote_set);\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tdoesEmoteMatch(filter, emote) { //eslint-disable-line class-methods-use-this\n\t\t\t\tif ( ! filter || ! filter.length )\n\t\t\t\t\treturn true;\n\n\t\t\t\tconst emote_name = emote.search || emote.name,\n\t\t\t\t\temote_lower = emote_name.toLowerCase(),\n\t\t\t\t\tterm_lower = filter.toLowerCase(),\n\t\t\t\t\thas_colon = filter.startsWith(':'),\n\t\t\t\t\tterm_trail = term_lower.slice(1);\n\n\t\t\t\tif ( Array.isArray(emote.extra) ) {\n\t\t\t\t\tlet i = emote.extra.length;\n\t\t\t\t\twhile(i--) {\n\t\t\t\t\t\tif ( ! has_colon && emote.extra[i].includes(term_lower) )\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\telse if ( has_colon && emote.extra[i].startsWith(term_trail) )\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( ! has_colon )\n\t\t\t\t\treturn emote_lower.includes(term_lower);\n\n\t\t\t\tif ( emote_lower.startsWith(term_trail) )\n\t\t\t\t\treturn true;\n\n\t\t\t\tconst idx = emote_name.indexOf(filter.charAt(1).toUpperCase());\n\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\treturn emote_lower.slice(idx+1).startsWith(term_lower.slice(2));\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\tbuildEmoji(old_state) { // eslint-disable-line class-methods-use-this\n\t\t\t\tconst state = Object.assign({}, old_state),\n\n\t\t\t\t\tsets = state.emoji_sets = [],\n\t\t\t\t\temoji_favorites = t.emotes.getFavorites('emoji'),\n\t\t\t\t\tfavorites = state.favorites = (state.favorites || []).filter(x => ! x.emoji),\n\n\t\t\t\t\ttone = state.tone = state.tone || null,\n\t\t\t\t\ttone_choices = state.tone_emoji = [],\n\t\t\t\t\tcategories = {};\n\n\t\t\t\tif ( t.chat.context.get('chat.emote-menu.show-emoji') ) {\n\t\t\t\t\tlet style = t.chat.context.get('chat.emoji.style') || 'twitter';\n\t\t\t\t\tif ( ! IMAGE_PATHS[style] )\n\t\t\t\t\t\tstyle = 'twitter';\n\n\t\t\t\t\tfor(const emoji of Object.values(t.emoji.emoji)) {\n\t\t\t\t\t\tif ( ! emoji || ! emoji.has[style] || HIDDEN_CATEGORIES.includes(emoji.category) )\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tif ( emoji.variants ) {\n\t\t\t\t\t\t\tfor(const name of emoji.names)\n\t\t\t\t\t\t\t\tif ( TONE_EMOJI.includes(name) ) {\n\t\t\t\t\t\t\t\t\ttone_choices.push(emoji);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst is_fav = emoji_favorites.includes(emoji.code),\n\t\t\t\t\t\t\ttoned = emoji.variants && emoji.variants[tone],\n\t\t\t\t\t\t\thas_tone = toned && toned.has[style],\n\t\t\t\t\t\t\tsource = has_tone ? toned : emoji;\n\n\t\t\t\t\t\tlet cat = categories[emoji.category];\n\t\t\t\t\t\tif ( ! cat ) {\n\t\t\t\t\t\t\tcat = categories[emoji.category] = [];\n\n\t\t\t\t\t\t\tsets.push({\n\t\t\t\t\t\t\t\tkey: `emoji-${emoji.category}`,\n\t\t\t\t\t\t\t\tsort_key: CATEGORY_SORT.indexOf(emoji.category),\n\t\t\t\t\t\t\t\temoji: true,\n\t\t\t\t\t\t\t\timage: t.emoji.getFullImage(source.image),\n\t\t\t\t\t\t\t\ti18n: `emoji.category.${emoji.category.toSnakeCase()}`,\n\t\t\t\t\t\t\t\ttitle: CATEGORIES[emoji.category] || emoji.category,\n\t\t\t\t\t\t\t\tsrc: 'emoji',\n\t\t\t\t\t\t\t\tsource: 'Emoji',\n\t\t\t\t\t\t\t\tsource_i18n: 'emote-menu.emoji',\n\t\t\t\t\t\t\t\temotes: cat\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst em = {\n\t\t\t\t\t\t\tprovider: 'emoji',\n\t\t\t\t\t\t\tid: emoji.sort,\n\t\t\t\t\t\t\temoji: true,\n\t\t\t\t\t\t\tcode: emoji.code,\n\t\t\t\t\t\t\tname: source.raw,\n\t\t\t\t\t\t\tvariant: has_tone && tone,\n\t\t\t\t\t\t\thidden: emoji.hidden,\n\n\t\t\t\t\t\t\tsearch: emoji.names[0],\n\t\t\t\t\t\t\textra: emoji.names.length > 1 ? emoji.names.map(x => x.toLowerCase()) : null,\n\n\t\t\t\t\t\t\theight: 18,\n\t\t\t\t\t\t\twidth: 18,\n\n\t\t\t\t\t\t\tx: source.sheet_x,\n\t\t\t\t\t\t\ty: source.sheet_y,\n\n\t\t\t\t\t\t\tfavorite: is_fav,\n\n\t\t\t\t\t\t\tsrc: t.emoji.getFullImage(source.image),\n\t\t\t\t\t\t\tsrcSet: t.emoji.getFullImageSet(source.image)\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tcat.push(em);\n\n\t\t\t\t\t\tif ( is_fav )\n\t\t\t\t\t\t\tfavorites.push(em);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstate.has_emoji_tab = sets.length > 0;\n\n\t\t\t\tstate.fav_sets = [{\n\t\t\t\t\tkey: 'favorites',\n\n\t\t\t\t\ttitle: 'Favorites',\n\t\t\t\t\ti18n: 'emote-menu.favorites',\n\t\t\t\t\ticon: 'star',\n\t\t\t\t\tsource: '',\n\n\t\t\t\t\tis_favorites: true,\n\t\t\t\t\temotes: favorites\n\t\t\t\t}];\n\n\t\t\t\t// We use this sorter because we don't want things grouped by sets.\n\t\t\t\tfavorites.sort(this.getSorter());\n\t\t\t\tsets.sort(sort_sets);\n\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\tgetAllSets() {\n\t\t\t\treturn [\n\t\t\t\t\t...(this.state.channel_sets || []),\n\t\t\t\t\t...(this.state.effect_sets || []),\n\t\t\t\t\t...(this.state.all_sets || [])\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tgetSorter() { // eslint-disable-line class-methods-use-this\n\t\t\t\treturn EMOTE_SORTERS[t.chat.context.get('chat.emote-menu.sort-emotes')] || EMOTE_SORTERS[0] || (() => 0);\n\t\t\t}\n\n\t\t\tbuildState(props, old_state) {\n\t\t\t\tconst state = Object.assign({}, old_state),\n\n\t\t\t\t\tdata = state.set_data || {},\n\t\t\t\t\tmodifiers = state.emote_modifiers = {},\n\t\t\t\t\tchannel = state.channel_sets = [],\n\t\t\t\t\tall = state.all_sets = [],\n\t\t\t\t\teffects = state.effect_sets = [],\n\t\t\t\t\tfavorites = state.favorites = [];\n\n\t\t\t\t// If we're still loading, don't set any data.\n\t\t\t\tif ( props.loading || props.error || state.loading )\n\t\t\t\t\treturn state;\n\n\t\t\t\t// If we start loading because the sets we have\n\t\t\t\t// don't match, don't set any data either.\n\t\t\t\tif ( state.set_data && this.loadData(false, props, state) )\n\t\t\t\t\treturn state;\n\n\t\t\t\t// Sorters\n\t\t\t\tconst sorter = this.getSorter(),\n\t\t\t\t\tsort_tiers = t.chat.context.get('chat.emote-menu.sort-tiers-last'),\n\t\t\t\t\tsort_emotes = (a,b) => {\n\t\t\t\t\t\tif ( a.misc || b.misc )\n\t\t\t\t\t\t\treturn sorter(a,b);\n\n\t\t\t\t\t\tif ( ! a.locked && b.locked ) return -1;\n\t\t\t\t\t\tif ( a.locked && ! b.locked ) return 1;\n\n\t\t\t\t\t\tif ( sort_tiers || a.locked || b.locked ) {\n\t\t\t\t\t\t\tif ( a.bits || b.bits ) {\n\t\t\t\t\t\t\t\tif ( ! b.bits )\n\t\t\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t\t\telse if ( ! a.bits )\n\t\t\t\t\t\t\t\t\treturn -1;\n\n\t\t\t\t\t\t\t\tconst a_val = a.bit_value || 0,\n\t\t\t\t\t\t\t\t\tb_val = b.bit_value || 0;\n\n\t\t\t\t\t\t\t\tif ( COLLATOR ) {\n\t\t\t\t\t\t\t\t\tconst result = COLLATOR.compare(a_val, b_val);\n\t\t\t\t\t\t\t\t\tif ( result != 0 )\n\t\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ( a_val < b_val ) return -1;\n\t\t\t\t\t\t\t\t\tif ( a_val > b_val ) return 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ( COLLATOR ) {\n\t\t\t\t\t\t\t\t\tconst result = COLLATOR.compare(a.set_id, b.set_id);\n\t\t\t\t\t\t\t\t\tif ( result != 0 )\n\t\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ( a.set_id < b.set_id ) return -1;\n\t\t\t\t\t\t\t\t\tif ( a.set_id > b.set_id ) return 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn sorter(a,b);\n\t\t\t\t\t}\n\n\n\t\t\t\t// Before anything, identify the follower sets.\n\t\t\t\tconst user = props.channel_data && props.channel_data.user,\n\t\t\t\t\tproducts = user && user.subscriptionProducts,\n\t\t\t\t\tlocal_sets = user && props.channel_data?.channel?.localEmoteSets,\n\t\t\t\t\tis_following = user && user.self?.follower != null,\n\t\t\t\t\tfollower_locked = ! is_following && (props.user_id && user?.id != props.user_id),\n\t\t\t\t\tbits = user?.cheer?.badgeTierEmotes;\n\n\t\t\t\tconst follower_sets = new Set();\n\t\t\t\tif ( Array.isArray(local_sets) )\n\t\t\t\t\tfor(const local of local_sets)\n\t\t\t\t\t\tif ( local?.id )\n\t\t\t\t\t\t\tfollower_sets.add(local.id);\n\n\t\t\t\t// Start with the All tab. Some data calculated for\n\t\t\t\t// all is re-used for the Channel tab.\n\n\t\t\t\tconst emote_sets = props.emote_data && props.emote_data.emoteSets,\n\t\t\t\t\temote_map = props.emote_data && props.emote_data.emoteMap,\n\t\t\t\t\ttwitch_favorites = t.emotes.getFavorites('twitch'),\n\t\t\t\t\ttwitch_hidden = t.emotes.getHidden('twitch'),\n\t\t\t\t\ttwitch_seen = new Set,\n\n\t\t\t\t\tbits_unlocked = [],\n\n\t\t\t\t\t//twitch_seen_favorites = new Set,\n\n\t\t\t\t\tgrouped_sets = {},\n\t\t\t\t\tset_ids = new Set;\n\n\t\t\t\tif ( Array.isArray(emote_sets) )\n\t\t\t\t\tfor(const emote_set of emote_sets) {\n\t\t\t\t\t\tif ( ! emote_set || ! Array.isArray(emote_set.emotes) )\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tconst set_id = emote_set.id,\n\t\t\t\t\t\t\tint_id = parseInt(set_id, 10),\n\t\t\t\t\t\t\towner = emote_set.owner,\n\t\t\t\t\t\t\tis_follower = follower_sets.has(set_id),\n\t\t\t\t\t\t\tis_bits = ! is_follower && int_id > 5e8,\n\t\t\t\t\t\t\tis_points = TWITCH_POINTS_SETS.includes(int_id) || owner?.login === 'channel_points',\n\t\t\t\t\t\t\tchan = is_follower ? user : is_points ? null : owner,\n\t\t\t\t\t\t\tset_data = data[set_id],\n\t\t\t\t\t\t\tis_current_bits = is_bits && owner && owner.id == user?.id;\n\n\t\t\t\t\t\t/*if ( chan )\n\t\t\t\t\t\t\tt.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\ts_id: set_id,\n\t\t\t\t\t\t\t\tc_id: chan.id,\n\t\t\t\t\t\t\t\tc_name: chan.login,\n\t\t\t\t\t\t\t\tc_title: chan.displayName\n\t\t\t\t\t\t\t});*/\n\n\t\t\t\t\t\tset_ids.add(set_id);\n\n\t\t\t\t\t\tlet key = `twitch-set-${set_id}`,\n\t\t\t\t\t\t\tsort_key = 0,\n\t\t\t\t\t\t\ticon = 'twitch',\n\t\t\t\t\t\t\ttitle = chan && (chan.displayName || chan.login);\n\n\t\t\t\t\t\tif ( title ) {\n\t\t\t\t\t\t\tkey = `twitch-${chan?.id}`;\n\n\t\t\t\t\t\t\tif ( is_follower )\n\t\t\t\t\t\t\t\tt.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\t\t\ttype: EmoteTypes.Follower,\n\t\t\t\t\t\t\t\t\towner: {\n\t\t\t\t\t\t\t\t\t\tid: chan.id,\n\t\t\t\t\t\t\t\t\t\tlogin: chan.login,\n\t\t\t\t\t\t\t\t\t\tdisplayName: chan.displayName\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\telse if ( is_bits )\n\t\t\t\t\t\t\t\tt.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\t\t\ttype: EmoteTypes.BitsTier,\n\t\t\t\t\t\t\t\t\towner: {\n\t\t\t\t\t\t\t\t\t\tid: chan.id,\n\t\t\t\t\t\t\t\t\t\tlogin: chan.login,\n\t\t\t\t\t\t\t\t\t\tdisplayName: chan.displayName\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tt.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\t\t\ttype: EmoteTypes.Subscription,\n\t\t\t\t\t\t\t\t\towner: {\n\t\t\t\t\t\t\t\t\t\tid: chan.id,\n\t\t\t\t\t\t\t\t\t\tlogin: chan.login,\n\t\t\t\t\t\t\t\t\t\tdisplayName: chan.displayName\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else if ( ! chan ) {\n\t\t\t\t\t\t\tif ( is_points ) {\n\t\t\t\t\t\t\t\ttitle = t.i18n.t('emote-menu.points', 'Unlocked with Points');\n\t\t\t\t\t\t\t\tkey = 'twitch-points';\n\t\t\t\t\t\t\t\ticon = 'channel-points';\n\t\t\t\t\t\t\t\tsort_key = 45;\n\n\t\t\t\t\t\t\t\t/*t.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\t\t\ttype: EmoteTypes.ChannelPoints,\n\t\t\t\t\t\t\t\t\towner: null\n\t\t\t\t\t\t\t\t});*/\n\n\t\t\t\t\t\t\t} else if ( TWITCH_GLOBAL_SETS.includes(int_id) ) {\n\t\t\t\t\t\t\t\ttitle = t.i18n.t('emote-menu.global', 'Global Emotes');\n\t\t\t\t\t\t\t\tkey = 'twitch-global';\n\t\t\t\t\t\t\t\tsort_key = 100;\n\n\t\t\t\t\t\t\t\tt.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\t\t\ttype: EmoteTypes.Global,\n\t\t\t\t\t\t\t\t\towner: null\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t} else if ( TWITCH_PRIME_SETS.includes(int_id) ) {\n\t\t\t\t\t\t\t\ttitle = t.i18n.t('emote_menu.prime', 'Prime');\n\t\t\t\t\t\t\t\tkey = 'twitch-prime';\n\t\t\t\t\t\t\t\ticon = 'crown';\n\t\t\t\t\t\t\t\tsort_key = 75;\n\n\t\t\t\t\t\t\t\tt.emotes.setTwitchSetChannel(set_id, {\n\t\t\t\t\t\t\t\t\tid: set_id,\n\t\t\t\t\t\t\t\t\ttype: EmoteTypes.Prime,\n\t\t\t\t\t\t\t\t\towner: null\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttitle = t.i18n.t('emote-menu.misc', 'Miscellaneous');\n\t\t\t\t\t\t\t\tkey = 'twitch-misc';\n\t\t\t\t\t\t\t\ticon = 'inventory';\n\t\t\t\t\t\t\t\tsort_key = 50;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\ttitle = t.i18n.t('emote-menu.unknown-set', 'Set #{set_id}', {set_id})\n\n\t\t\t\t\t\t// Do not display follower emotes the user does not have.\n\t\t\t\t\t\tif ( is_follower )\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tlet section, emotes;\n\n\t\t\t\t\t\tif ( grouped_sets[key] ) {\n\t\t\t\t\t\t\tsection = grouped_sets[key];\n\t\t\t\t\t\t\temotes = section.emotes;\n\n\t\t\t\t\t\t\tif ( set_data && section.bad ) {\n\t\t\t\t\t\t\t\tsection.bad = false;\n\t\t\t\t\t\t\t\tsection.renews = set_data.renews;\n\t\t\t\t\t\t\t\tsection.ends = set_data.ends;\n\t\t\t\t\t\t\t\tsection.prime = set_data.prime;\n\t\t\t\t\t\t\t\tsection.gift = set_data.gift;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\temotes = [];\n\t\t\t\t\t\t\tsection = grouped_sets[key] = {\n\t\t\t\t\t\t\t\tsort_key,\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\timage: chan?.profileImageURL,\n\t\t\t\t\t\t\t\timage_large: true,\n\t\t\t\t\t\t\t\ticon,\n\t\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\t\tsource: t.i18n.t('emote-menu.twitch', 'Twitch'),\n\t\t\t\t\t\t\t\temotes,\n\t\t\t\t\t\t\t\trenews: set_data?.renews,\n\t\t\t\t\t\t\t\tends: set_data?.ends,\n\t\t\t\t\t\t\t\tprime: set_data?.prime,\n\t\t\t\t\t\t\t\tgift: set_data?.gift\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( ! set_data )\n\t\t\t\t\t\t\t\tsection.bad = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet order = 0;\n\n\t\t\t\t\t\tfor(const emote of emote_set.emotes) {\n\t\t\t\t\t\t\t// Validate emotes, because apparently Twitch is handing\n\t\t\t\t\t\t\t// out bad emote data.\n\t\t\t\t\t\t\tif ( ! emote || ! emote.id || ! emote.token )\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tconst id = emote.id,\n\t\t\t\t\t\t\t\tname = KNOWN_CODES[emote.token] || emote.token,\n\t\t\t\t\t\t\t\tmapped = emote_map && emote_map[name];\n\n\t\t\t\t\t\t\tif ( ! is_points )\n\t\t\t\t\t\t\t\tt.emotes.setTwitchEmoteSet(id, set_id);\n\n\t\t\t\t\t\t\t//if ( Array.isArray(emote.modifiers) && emote.modifiers.length )\n\t\t\t\t\t\t\t//\tmodifiers[id] = emote.modifiers.map(x => x.code);\n\n\t\t\t\t\t\t\tconst modes = [''];\n\t\t\t\t\t\t\tif ( Array.isArray(emote.modifiers) && emote.modifiers.length ) {\n\t\t\t\t\t\t\t\tif ( t.chat.context.get('chat.emote-menu.modifiers') === 1 )\n\t\t\t\t\t\t\t\t\tfor(const mod of emote.modifiers)\n\t\t\t\t\t\t\t\t\t\tmodes.push(`_${mod.code}`);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor(const mode of modes) {\n\t\t\t\t\t\t\t\tconst new_id = `${id}${mode}`,\n\t\t\t\t\t\t\t\t\tnew_name = `${name}${mode}`,\n\t\t\t\t\t\t\t\t\tis_fav = twitch_favorites.includes(new_id),\n\t\t\t\t\t\t\t\t\toverridden = mapped && mapped.id != new_id,\n\t\t\t\t\t\t\t\t\treplacement = REPLACEMENTS[new_id];\n\n\t\t\t\t\t\t\t\tlet src, srcSet, animSrc, animSrcSet;\n\n\t\t\t\t\t\t\t\tif ( replacement && t.chat.context.get('chat.fix-bad-emotes') )\n\t\t\t\t\t\t\t\t\tsrc = `${REPLACEMENT_BASE}${replacement}`;\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tsrc = getTwitchEmoteURL(new_id, 1, false);\n\t\t\t\t\t\t\t\t\tsrcSet = getTwitchEmoteSrcSet(new_id, false);\n\n\t\t\t\t\t\t\t\t\tanimSrc = getTwitchEmoteURL(new_id, 1, true);\n\t\t\t\t\t\t\t\t\tanimSrcSet = getTwitchEmoteSrcSet(new_id, true);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst em = {\n\t\t\t\t\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\t\t\t\t\tid: new_id,\n\t\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\t\tname: new_name,\n\t\t\t\t\t\t\t\t\tsrc,\n\t\t\t\t\t\t\t\t\tsrcSet,\n\t\t\t\t\t\t\t\t\tanimSrc,\n\t\t\t\t\t\t\t\t\tanimSrcSet,\n\t\t\t\t\t\t\t\t\torder: order++,\n\t\t\t\t\t\t\t\t\toverridden: overridden ? mapped.id : null,\n\t\t\t\t\t\t\t\t\tmisc: ! chan,\n\t\t\t\t\t\t\t\t\tbits: is_bits,\n\t\t\t\t\t\t\t\t\thidden: twitch_hidden.includes(new_id),\n\t\t\t\t\t\t\t\t\tfavorite: is_fav\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\temotes.push(em);\n\n\t\t\t\t\t\t\t\tif ( is_current_bits )\n\t\t\t\t\t\t\t\t\tbits_unlocked.push(em);\n\n\t\t\t\t\t\t\t\tif ( is_fav && ! twitch_seen.has(new_id) )\n\t\t\t\t\t\t\t\t\tfavorites.push(em);\n\n\t\t\t\t\t\t\t\ttwitch_seen.add(new_id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( emotes.length ) {\n\t\t\t\t\t\t\temotes.sort(sort_emotes);\n\n\t\t\t\t\t\t\tif ( ! all.includes(section) )\n\t\t\t\t\t\t\t\tall.push(section);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\n\t\t\t\t// Now we handle the current Channel's emotes.\n\n\t\t\t\tif ( Array.isArray(local_sets) || Array.isArray(products) || Array.isArray(bits) ) {\n\t\t\t\t\tconst badge = t.badges.getTwitchBadge('subscriber', '0', user.id, user.login),\n\t\t\t\t\t\temotes = [],\n\t\t\t\t\t\tunlockable_emotes = new Set,\n\t\t\t\t\t\tlocks = {},\n\t\t\t\t\t\tsection = {\n\t\t\t\t\t\t\tsort_key: -10,\n\t\t\t\t\t\t\tkey: `twitch-current-channel`,\n\t\t\t\t\t\t\thide_key: `twitch-${user.id}`,\n\t\t\t\t\t\t\timage: badge && badge.image1x,\n\t\t\t\t\t\t\timage_set: badge && `${badge.image1x} 1x, ${badge.image2x} 2x, ${badge.image4x} 4x`,\n\t\t\t\t\t\t\ticon: 'twitch',\n\t\t\t\t\t\t\ttitle: t.i18n.t('emote-menu.main-set', 'Channel Emotes'),\n\t\t\t\t\t\t\tsource: t.i18n.t('emote-menu.twitch', 'Twitch'),\n\t\t\t\t\t\t\temotes,\n\t\t\t\t\t\t\tlocks,\n\t\t\t\t\t\t\tall_locked: true\n\t\t\t\t\t\t};\n\n\t\t\t\t\tif ( Array.isArray(local_sets) ) {\n\t\t\t\t\t\tfor(const local of local_sets) {\n\t\t\t\t\t\t\tif ( ! local || ! Array.isArray(local.emotes) )\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tconst set_id = local.id;\n\n\t\t\t\t\t\t\tlet lock_set;\n\n\t\t\t\t\t\t\t// If we're not following, we can't use the emote\n\t\t\t\t\t\t\t// so lock it.\n\t\t\t\t\t\t\tif ( follower_locked )\n\t\t\t\t\t\t\t\tlocks[set_id] = {\n\t\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\t\tid: 'follower',\n\t\t\t\t\t\t\t\t\tuser: user?.displayName || user?.login,\n\t\t\t\t\t\t\t\t\thide_button: true,\n\t\t\t\t\t\t\t\t\temotes: lock_set = new Set()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/*else\n\t\t\t\t\t\t\t\tsection.all_locked = false;*/\n\n\t\t\t\t\t\t\tlet order = 0;\n\t\t\t\t\t\t\tfor(const emote of local.emotes) {\n\t\t\t\t\t\t\t\tif ( ! emote || ! emote.id || ! emote.token )\n\t\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\t\tconst id = emote.id,\n\t\t\t\t\t\t\t\t\tname = KNOWN_CODES[emote.token] || emote.token,\n\t\t\t\t\t\t\t\t\tseen = twitch_seen.has(id),\n\t\t\t\t\t\t\t\t\tis_fav = twitch_favorites.includes(id);\n\n\t\t\t\t\t\t\t\tconst em = {\n\t\t\t\t\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\t\torder: order++,\n\t\t\t\t\t\t\t\t\tsrc: getTwitchEmoteURL(id, 1, false),\n\t\t\t\t\t\t\t\t\tsrcSet: getTwitchEmoteSrcSet(id, false),\n\t\t\t\t\t\t\t\t\tanimSrc: getTwitchEmoteURL(id, 1, true),\n\t\t\t\t\t\t\t\t\tanimSrcSet: getTwitchEmoteSrcSet(id, true),\n\t\t\t\t\t\t\t\t\tfavorite: is_fav,\n\t\t\t\t\t\t\t\t\thidden: twitch_hidden.includes(id),\n\t\t\t\t\t\t\t\t\tlocked: follower_locked,\n\t\t\t\t\t\t\t\t\tlock_icon: 'heart'\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\temotes.push(em);\n\n\t\t\t\t\t\t\t\tif ( is_fav && ! seen )\n\t\t\t\t\t\t\t\t\tfavorites.push(em);\n\n\t\t\t\t\t\t\t\ttwitch_seen.add(id);\n\n\t\t\t\t\t\t\t\tif ( lock_set )\n\t\t\t\t\t\t\t\t\tlock_set.add(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( Array.isArray(products) ) {\n\t\t\t\t\t\tfor(const product of products) {\n\t\t\t\t\t\t\tif ( ! product || ! Array.isArray(product.emotes) )\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tconst set_id = product.emoteSetID,\n\t\t\t\t\t\t\t\tset_data = data[set_id],\n\t\t\t\t\t\t\t\tlocked = ! set_ids.has(set_id);\n\n\t\t\t\t\t\t\tlet lock_set;\n\n\t\t\t\t\t\t\tif ( set_data ) {\n\t\t\t\t\t\t\t\tsection.renews = set_data.renews;\n\t\t\t\t\t\t\t\tsection.ends = set_data.ends;\n\t\t\t\t\t\t\t\tsection.prime = set_data.prime;\n\t\t\t\t\t\t\t\tsection.gift = set_data.gift && set_data.gift.isGift;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// If the channel is locked, store data about that in the\n\t\t\t\t\t\t\t// section so we can show appropriate UI to let people\n\t\t\t\t\t\t\t// subscribe. Also include all the already known emotes\n\t\t\t\t\t\t\t// in the list of emotes this product unlocks.\n\t\t\t\t\t\t\tif ( locked )\n\t\t\t\t\t\t\t\tlocks[set_id] = {\n\t\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\t\tid: product.id,\n\t\t\t\t\t\t\t\t\tprice: product.price || TIERS[product.tier],\n\t\t\t\t\t\t\t\t\turl: product.url,\n\t\t\t\t\t\t\t\t\temotes: lock_set = new Set(unlockable_emotes)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tsection.all_locked = false;\n\n\t\t\t\t\t\t\tlet order = 0;\n\n\t\t\t\t\t\t\tfor(const emote of product.emotes) {\n\t\t\t\t\t\t\t\t// Validate emotes, because apparently Twitch is handing\n\t\t\t\t\t\t\t\t// out bad emote data.\n\t\t\t\t\t\t\t\tif ( ! emote || ! emote.id || ! emote.token )\n\t\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\t\tconst id = emote.id,\n\t\t\t\t\t\t\t\t\tname = KNOWN_CODES[emote.token] || emote.token,\n\t\t\t\t\t\t\t\t\tseen = twitch_seen.has(id),\n\t\t\t\t\t\t\t\t\tis_fav = twitch_favorites.includes(id);\n\n\t\t\t\t\t\t\t\tconst em = {\n\t\t\t\t\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\t\torder: order++,\n\t\t\t\t\t\t\t\t\tlocked: locked && ! seen,\n\t\t\t\t\t\t\t\t\tsrc: getTwitchEmoteURL(id, 1, false),\n\t\t\t\t\t\t\t\t\tsrcSet: getTwitchEmoteSrcSet(id, false),\n\t\t\t\t\t\t\t\t\tanimSrc: getTwitchEmoteURL(id, 1, true),\n\t\t\t\t\t\t\t\t\tanimSrcSet: getTwitchEmoteSrcSet(id, true),\n\t\t\t\t\t\t\t\t\tfavorite: is_fav,\n\t\t\t\t\t\t\t\t\thidden: twitch_hidden.includes(id)\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\temotes.push(em);\n\n\t\t\t\t\t\t\t\tif ( ! locked && is_fav && ! seen )\n\t\t\t\t\t\t\t\t\tfavorites.push(em);\n\n\t\t\t\t\t\t\t\ttwitch_seen.add(id);\n\n\t\t\t\t\t\t\t\tif ( lock_set ) {\n\t\t\t\t\t\t\t\t\tunlockable_emotes.add(id);\n\t\t\t\t\t\t\t\t\tlock_set.add(id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst seen_bits = new Set;\n\n\t\t\t\t\tif ( Array.isArray(bits) ) {\n\t\t\t\t\t\tlet order;\n\t\t\t\t\t\tfor(const emote of bits) {\n\t\t\t\t\t\t\tif ( ! emote || ! emote.id || ! emote.bitsBadgeTierSummary )\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tconst id = emote.id,\n\t\t\t\t\t\t\t\tset_id = emote.setID,\n\t\t\t\t\t\t\t\tsummary = emote.bitsBadgeTierSummary,\n\t\t\t\t\t\t\t\tlocked = ! twitch_seen.has(id) && ! summary.self?.isUnlocked;\n\n\t\t\t\t\t\t\t// If the emote isn't unlocked, store data about that in the\n\t\t\t\t\t\t\t// section so we can show appropriate UI to let people know\n\t\t\t\t\t\t\t// that the emote isn't unlocked.\n\t\t\t\t\t\t\tif ( locked )\n\t\t\t\t\t\t\t\tlocks[set_id] = {\n\t\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\t\tid: 'cheer',\n\t\t\t\t\t\t\t\t\tprice: null,\n\t\t\t\t\t\t\t\t\tbits: summary.threshold,\n\t\t\t\t\t\t\t\t\tbits_remaining: summary.self?.numberOfBitsUntilUnlock ?? summary.threshold,\n\t\t\t\t\t\t\t\t\temotes: new Set([emote.id])\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst is_fav = twitch_favorites.includes(id);\n\n\t\t\t\t\t\t\t/*if ( Array.isArray(emote.modifiers) && emote.modifiers.length )\n\t\t\t\t\t\t\t\tmodifiers[id] = emote.modifiers;*/\n\n\t\t\t\t\t\t\tconst em = {\n\t\t\t\t\t\t\t\tprovider: 'twitch',\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\tset_id,\n\t\t\t\t\t\t\t\tname: emote.token,\n\t\t\t\t\t\t\t\tlocked,\n\t\t\t\t\t\t\t\torder: order++,\n\t\t\t\t\t\t\t\tsrc: getTwitchEmoteURL(id, 1, false),\n\t\t\t\t\t\t\t\tsrcSet: getTwitchEmoteSrcSet(id, false),\n\t\t\t\t\t\t\t\tanimSrc: getTwitchEmoteURL(id, 1, true),\n\t\t\t\t\t\t\t\tanimSrcSet: getTwitchEmoteSrcSet(id, true),\n\t\t\t\t\t\t\t\tbits: true,\n\t\t\t\t\t\t\t\tbit_value: summary.threshold,\n\t\t\t\t\t\t\t\tfavorite: is_fav,\n\t\t\t\t\t\t\t\thidden: twitch_hidden.includes(id)\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\temotes.push(em);\n\n\t\t\t\t\t\t\tif ( ! locked && is_fav && ! twitch_seen.has(id) )\n\t\t\t\t\t\t\t\tfavorites.push(em);\n\n\t\t\t\t\t\t\tseen_bits.add(id);\n\t\t\t\t\t\t\ttwitch_seen.add(id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( bits_unlocked.length ) {\n\t\t\t\t\t\tfor(const emote of bits_unlocked) {\n\t\t\t\t\t\t\tif ( seen_bits.has(emote.id) )\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\temotes.push(emote);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( emotes.length ) {\n\t\t\t\t\t\temotes.sort(sort_emotes);\n\t\t\t\t\t\tchannel.push(section);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet wants_resub_info = false,\n\t\t\t\t\twants_plan_info = false,\n\t\t\t\t\thas_new_effects = false;\n\n\t\t\t\tconst unlocked_effects = [...t.settings.provider.get('unlocked-effects', [])];\n\n\t\t\t\t// Finally, emotes added by FrankerFaceZ.\n\t\t\t\tif ( t.chat.context.get('chat.emotes.enabled') > 1 ) {\n\t\t\t\t\tconst me = t.site.getUser();\n\n\t\t\t\t\tconst use_effect_tab = t.chat.context.get('chat.emote-menu.effect-tab');\n\n\t\t\t\t\tconst ffz_room = t.emotes.getRoomSetsWithSources(me?.id, me?.login, props.channel_id, null),\n\t\t\t\t\t\tffz_subs = t.emotes.getSubSetsWithSources(),\n\t\t\t\t\t\tffz_global = t.emotes.getGlobalSetsWithSources(me?.id, me?.login),\n\t\t\t\t\t\tseen_sets = new Set(),\n\t\t\t\t\t\tseen_favorites = {};\n\n\t\t\t\t\tlet grouped_sets = {};\n\n\t\t\t\t\tfor(const [emote_set, provider, source_id] of ffz_room) {\n\t\t\t\t\t\tif ( seen_sets.has(emote_set) )\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tseen_sets.add(emote_set);\n\n\t\t\t\t\t\tconst section = this.processFFZSet(emote_set, provider, favorites, seen_favorites, grouped_sets, false, undefined, source_id, props.channel_id);\n\t\t\t\t\t\tif ( section ) {\n\t\t\t\t\t\t\tsection.emotes.sort(sort_emotes);\n\n\t\t\t\t\t\t\tif ( ! channel.includes(section) )\n\t\t\t\t\t\t\t\tchannel.push(section);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tgrouped_sets = {};\n\n\t\t\t\t\tconst global_set_ids = ffz_global.map(x => x?.[0]?.id);\n\n\t\t\t\t\tfor(const [emote_set, provider] of ffz_subs) {\n\t\t\t\t\t\tif ( seen_sets.has(emote_set) )\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tseen_sets.add(emote_set);\n\n\t\t\t\t\t\tconst locked = ! global_set_ids.includes(emote_set.id);\n\n\t\t\t\t\t\twants_resub_info = true;\n\n\t\t\t\t\t\tconst section = this.processFFZSet(emote_set, provider, favorites, seen_favorites, grouped_sets, locked, state);\n\t\t\t\t\t\tif ( section ) {\n\t\t\t\t\t\t\tsection.emotes.sort(sort_emotes);\n\n\t\t\t\t\t\t\tif ( use_effect_tab && ! effects.includes(section) && section.has_effects ) {\n\t\t\t\t\t\t\t\thas_new_effects = this.checkNewEffects(section.emotes, unlocked_effects) || has_new_effects;\n\t\t\t\t\t\t\t\teffects.push(section);\n\t\t\t\t\t\t\t} else if ( ! all.includes(section) )\n\t\t\t\t\t\t\t\tall.push(section);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tgrouped_sets = {};\n\n\t\t\t\t\tfor(const [emote_set, provider] of ffz_global) {\n\t\t\t\t\t\tif ( seen_sets.has(emote_set) )\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tseen_sets.add(emote_set);\n\n\t\t\t\t\t\tconst section = this.processFFZSet(emote_set, provider, favorites, seen_favorites, grouped_sets);\n\t\t\t\t\t\tif ( section ) {\n\t\t\t\t\t\t\tsection.emotes.sort(sort_emotes);\n\n\t\t\t\t\t\t\tif ( use_effect_tab && ! effects.includes(section) && section.has_effects ) {\n\t\t\t\t\t\t\t\thas_new_effects = this.checkNewEffects(section.emotes, unlocked_effects) || has_new_effects;\n\t\t\t\t\t\t\t\teffects.push(section);\n\n\t\t\t\t\t\t\t} else if ( ! all.includes(section) )\n\t\t\t\t\t\t\t\tall.push(section);\n\n\t\t\t\t\t\t\tif ( ! channel.includes(section) && maybe_call(section.force_global, this, emote_set, props.channel_data && props.channel_data.user, me) )\n\t\t\t\t\t\t\t\tchannel.push(section);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Load FFZ sub data.\n\t\t\t\tstate.wants_resub_info = wants_resub_info;\n\t\t\t\tstate.wants_plan_info = wants_plan_info;\n\n\t\t\t\tif ( this.props.visible ) {\n\t\t\t\t\tif ( state.tab === 'effects' )\n\t\t\t\t\t\thas_new_effects = false;\n\n\t\t\t\t\tif ( wants_plan_info )\n\t\t\t\t\t\tthis.loadFFZPlanData();\n\t\t\t\t\tif ( wants_resub_info )\n\t\t\t\t\t\tthis.loadFFZSubData();\n\t\t\t\t}\n\n\t\t\t\t// Sort Sets\n\t\t\t\tchannel.sort(sort_sets);\n\t\t\t\teffects.sort(sort_sets);\n\t\t\t\tall.sort(sort_sets);\n\n\t\t\t\tstate.has_channel_tab = channel.length > 0;\n\t\t\t\tstate.has_effect_tab = effects.length > 0;\n\t\t\t\tstate.hasNewEffects = effects.length > 0 && has_new_effects;\n\t\t\t\tstate.unlockedEffects = unlocked_effects;\n\n\t\t\t\treturn this.buildEmoji(state);\n\t\t\t}\n\n\n\t\t\tcheckNewEffects(emotes, unlocked) {\n\t\t\t\tlet added = false;\n\t\t\t\tfor(const emote of emotes) {\n\t\t\t\t\tif ( emote && ! emote.locked && emote.id && emote.provider === 'ffz' && ! unlocked.includes(emote.id) ) {\n\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\tunlocked.push(emote.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn added;\n\t\t\t}\n\n\n\t\t\tprocessFFZSet(emote_set, provider, favorites, seen_favorites, grouped_sets, locked = false, state, source_id, host_id = null) { // eslint-disable-line class-methods-use-this\n\t\t\t\tif ( ! emote_set || ! emote_set.emotes )\n\t\t\t\t\treturn null;\n\n\t\t\t\tlet source_name;\n\t\t\t\tif ( source_id ) {\n\t\t\t\t\tconst room = t.parent.shared_room_data?.get(source_id);\n\t\t\t\t\tsource_name = room?.displayName ?? room?.login;\n\t\t\t\t}\n\n\t\t\t\tconst fav_key = emote_set.source || 'ffz',\n\t\t\t\t\tknown_favs = t.emotes.getFavorites(fav_key),\n\t\t\t\t\tknown_hidden = t.emotes.getHidden(fav_key),\n\t\t\t\t\tseen_favs = seen_favorites[fav_key] = seen_favorites[fav_key] || new Set;\n\n\t\t\t\tconst key = `${emote_set.merge_source || fav_key}-${emote_set.merge_id || emote_set.id}`,\n\t\t\t\t\tpdata = t.emotes.providers.get(provider),\n\t\t\t\t\tsource = pdata && pdata.menu_name ?\n\t\t\t\t\t\t(pdata.menu_i18n_key ?\n\t\t\t\t\t\t\tt.i18n.t(pdata.menu_i18n_key, pdata.menu_name, pdata) :\n\t\t\t\t\t\t\tpdata.menu_name) :\n\t\t\t\t\t\temote_set.source || 'FFZ',\n\n\t\t\t\t\ttitle = (provider === 'ffz-main' || emote_set.title_is_channel)\n\t\t\t\t\t\t? source_name\n\t\t\t\t\t\t\t\t? t.i18n.t('emote-menu.source-set', '{channel}\\'s Emotes', {channel: source_name})\n\t\t\t\t\t\t\t\t: t.i18n.t('emote-menu.main-set', 'Channel Emotes')\n\t\t\t\t\t\t: (emote_set.title || t.i18n.t('emote-menu.unknown-set', `Set #{set_id}`, {set_id: emote_set.id}));\n\n\t\t\t\tlet sort_key = pdata && pdata.sort_key || emote_set.sort;\n\t\t\t\tif ( sort_key == null )\n\t\t\t\t\tsort_key = emote_set.title.toLowerCase().includes('global')\n\t\t\t\t\t\t? 100\n\t\t\t\t\t\t: 0;\n\n\t\t\t\t// Shared Chat emote sets always come after.\n\t\t\t\tif (source_id && source_id !== host_id)\n\t\t\t\t\tsort_key += 50;\n\n\t\t\t\tlet section, emotes, locks;\n\n\t\t\t\tif ( grouped_sets[key] ) {\n\t\t\t\t\tsection = grouped_sets[key];\n\t\t\t\t\temotes = section.emotes;\n\n\t\t\t\t\tif ( key === `${fav_key}-${emote_set.id}` )\n\t\t\t\t\t\tObject.assign(section, {\n\t\t\t\t\t\t\tsort_key,\n\t\t\t\t\t\t\timage: emote_set.icon,\n\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\tchannel_source: source_name,\n\t\t\t\t\t\t\tforce_global: emote_set.force_global\n\t\t\t\t\t\t});\n\n\t\t\t\t} else {\n\t\t\t\t\temotes = [];\n\t\t\t\t\tsection = grouped_sets[key] = {\n\t\t\t\t\t\tsort_key,\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\timage: emote_set.icon,\n\t\t\t\t\t\ticon: 'zreknarf',\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tchannel_source: source_name,\n\t\t\t\t\t\temotes,\n\t\t\t\t\t\tforce_global: emote_set.force_global,\n\t\t\t\t\t\tall_locked: true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Try to get resub info.\n\t\t\t\tconst resub = (state || this.state)?.ffz_sub_data?.sets?.[emote_set.id];\n\t\t\t\tif ( resub ) {\n\t\t\t\t\tsection.renews = resub.next_bill_date;\n\t\t\t\t\tsection.ends = resub.expires_at;\n\t\t\t\t}\n\n\t\t\t\tif ( locked ) {\n\t\t\t\t\tsection.locks = section.locks || {};\n\t\t\t\t\tsection.locks[emote_set.id] = {\n\t\t\t\t\t\tset_id: emote_set.id,\n\t\t\t\t\t\tid: 'subwoofer',\n\t\t\t\t\t\tis_ffz: true,\n\t\t\t\t\t\tprice: 'More Info',\n\t\t\t\t\t\turl: 'https://www.frankerfacez.com/subscribe',\n\t\t\t\t\t\temotes: locks = new Set()\n\t\t\t\t\t}\n\t\t\t\t} else\n\t\t\t\t\tsection.all_locked = false;\n\n\t\t\t\tfor(const emote of Object.values(emote_set.emotes))\n\t\t\t\t\tif ( ! emote.hidden ) {\n\t\t\t\t\t\tconst is_fav = known_favs.includes(emote.id),\n\t\t\t\t\t\t\tem = {\n\t\t\t\t\t\t\t\tprovider: 'ffz',\n\t\t\t\t\t\t\t\tid: emote.id,\n\t\t\t\t\t\t\t\tset_id: emote_set.id,\n\t\t\t\t\t\t\t\tsrc: emote.src,\n\t\t\t\t\t\t\t\tsrcSet: emote.srcSet,\n\t\t\t\t\t\t\t\tanimSrc: emote.animSrc,\n\t\t\t\t\t\t\t\tanimSrcSet: emote.animSrcSet,\n\t\t\t\t\t\t\t\teffects: emote.modifier ? emote.modifier_flags : 0,\n\t\t\t\t\t\t\t\teffect_prefix: emote.modifier ? emote.modifier_prefix : false,\n\t\t\t\t\t\t\t\tname: emote.name,\n\t\t\t\t\t\t\t\tfavorite: is_fav,\n\t\t\t\t\t\t\t\tlocked: locked,\n\t\t\t\t\t\t\t\thidden: known_hidden.includes(emote.id),\n\t\t\t\t\t\t\t\theight: emote.height,\n\t\t\t\t\t\t\t\twidth: emote.width\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\temotes.push(em);\n\n\t\t\t\t\t\tif ( ! locked && is_fav && ! seen_favs.has(emote.id) ) {\n\t\t\t\t\t\t\tfavorites.push(em);\n\t\t\t\t\t\t\tseen_favs.add(emote.id);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( locked )\n\t\t\t\t\t\t\tlocks.add(emote.id);\n\n\t\t\t\t\t\tif ( emote.modifier && emote.modifier_flags )\n\t\t\t\t\t\t\tsection.has_effects = true;\n\t\t\t\t\t}\n\n\t\t\t\tif ( emotes.length )\n\t\t\t\t\treturn section;\n\t\t\t}\n\n\n\t\t\trebuildData() {\n\t\t\t\tconst state = this.buildState(this.props, this.state);\n\t\t\t\tthis.setState(this.filterState(state.filter, state));\n\t\t\t}\n\n\n\t\t\tcomponentDidUpdate(old_props) {\n\t\t\t\tif ( this.props.visible && ! old_props.visible ) {\n\t\t\t\t\tthis.loadData();\n\n\t\t\t\t\tif ( this.state.wants_plan_info )\n\t\t\t\t\t\tthis.loadFFZPlanData();\n\t\t\t\t\tif ( this.state.wants_resub_info )\n\t\t\t\t\t\tthis.loadFFZSubData();\n\t\t\t\t}\n\n\t\t\t\tif ( ! this.props.visible && old_props.visible ) {\n\t\t\t\t\tif ( this.state.clearSearch ) {\n\t\t\t\t\t\tthis.setState(this.filterState('', this.state));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst cd = this.props.channel_data,\n\t\t\t\t\told_cd = old_props.channel_data,\n\t\t\t\t\tcd_diff = cd?.user !== old_cd?.user || cd?.channel !== old_cd?.channel,\n\n\t\t\t\t\t// emote_data is rebuilt by Twitch a lot so we can't\n\t\t\t\t\t// rely on object equality. Use a deep equality check. It's\n\t\t\t\t\t// going to be slower, but it's still faster than rebuilding\n\t\t\t\t\t// our entire data structure when nothing actually changed.\n\t\t\t\t\ted = this.props.emote_data,\n\t\t\t\t\told_ed = old_props.emote_data,\n\t\t\t\t\ted_diff = ! deep_equals(ed?.emoteSets, old_ed?.emoteSets) ||\n\t\t\t\t\t\t! deep_equals(ed?.emoteMap, old_ed?.emoteMap);\n\n\t\t\t\tif ( cd_diff || ed_diff ||\n\t\t\t\t\t\tthis.props.user_id !== old_props.user_id ||\n\t\t\t\t\t\tthis.props.channel_id !== old_props.channel_id ||\n\t\t\t\t\t\tthis.props.loading !== old_props.loading ||\n\t\t\t\t\t\tthis.props.error !== old_props.error ) {\n\t\t\t\t\tt.log.debug('Updating emote menu data. cd', cd_diff, ', ed', ed_diff);\n\t\t\t\t\tthis.rebuildData();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trenderError() {\n\t\t\t\treturn (<div class=\"tw-align-center tw-pd-1\">\n\t\t\t\t\t<div class=\"tw-mg-b-1\">\n\t\t\t\t\t\t<div class=\"tw-mg-2\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc=\"//cdn.frankerfacez.com/emoticon/26608/2\"\n\t\t\t\t\t\t\t\tsrcSet=\"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{t.i18n.t('emote-menu.error', 'There was an error rendering this menu.')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"tw-button\" onClick={this.forceUpdate}>\n\t\t\t\t\t\t<span class=\"tw-button__text\">\n\t\t\t\t\t\t\t{t.i18n.t('error.try-again', 'Try Again')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>)\n\t\t\t}\n\n\t\t\trenderEmpty() { // eslint-disable-line class-methods-use-this\n\t\t\t\treturn (<div class=\"tw-align-center tw-pd-1\">\n\t\t\t\t\t<div class=\"tw-mg-2\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc=\"//cdn.frankerfacez.com/emoticon/26608/2\"\n\t\t\t\t\t\t\tsrcSet=\"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t{this.state.filtered ?\n\t\t\t\t\t\tt.i18n.t('emote-menu.empty-search', 'There are no matching emotes.') :\n\t\t\t\t\t\tthis.state.tab === 'fav' ?\n\t\t\t\t\t\t\tt.i18n.t('emote-menu.empty-favs', \"You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.\", {hotkey: IS_OSX ? '' : 'Ctrl'}) :\n\t\t\t\t\t\t\tt.i18n.t('emote-menu.empty', \"There's nothing here.\")}\n\t\t\t\t</div>)\n\t\t\t}\n\n\t\t\trenderLoading() { // eslint-disable-line class-methods-use-this\n\t\t\t\treturn (<div class=\"tw-align-center tw-pd-1\">\n\t\t\t\t\t<h1 class=\"tw-mg-5 ffz-i-zreknarf loading\" />\n\t\t\t\t\t{t.i18n.t('emote-menu.loading', 'Loading...')}\n\t\t\t\t</div>)\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\tif ( ! this.props.visible && (! this.state.stayLoaded || ! this.loadedOnce) )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst loading = this.state.loading || this.props.loading,\n\t\t\t\t\tpadding = this.state.reducedPadding, //t.chat.context.get('chat.emote-menu.reduced-padding'),\n\t\t\t\t\tno_tabs = this.state.combineTabs; //t.chat.context.get('chat.emote-menu.combine-tabs');\n\n\t\t\t\tif ( ! loading )\n\t\t\t\t\tthis.loadedOnce = true;\n\n\t\t\t\tlet tab, sets, is_emoji, is_favs, is_effect;\n\n\t\t\t\tif ( no_tabs ) {\n\t\t\t\t\tsets = [\n\t\t\t\t\t\tthis.state.filtered_fav_sets,\n\t\t\t\t\t\tthis.state.filtered_channel_sets,\n\t\t\t\t\t\tthis.state.filtered_effect_sets,\n\t\t\t\t\t\tthis.state.filtered_all_sets,\n\t\t\t\t\t\tthis.state.filtered_emoji_sets\n\t\t\t\t\t].flat();\n\n\t\t\t\t} else {\n\t\t\t\t\ttab = this.state.tab || t.chat.context.get('chat.emote-menu.default-tab');\n\t\t\t\t\tif ( (tab === 'effect' && ! this.state.has_effect_tab) || (tab === 'channel' && ! this.state.has_channel_tab) || (tab === 'emoji' && ! this.state.has_emoji_tab) )\n\t\t\t\t\t\ttab = 'all';\n\n\t\t\t\t\tis_emoji = tab === 'emoji';\n\t\t\t\t\tis_favs = tab === 'fav';\n\t\t\t\t\tis_effect = tab === 'effect';\n\n\t\t\t\t\tswitch(tab) {\n\t\t\t\t\t\tcase 'fav':\n\t\t\t\t\t\t\tsets = this.state.filtered_fav_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'channel':\n\t\t\t\t\t\t\tsets = this.state.filtered_channel_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'effect':\n\t\t\t\t\t\t\tsets = this.state.filtered_effect_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'emoji':\n\t\t\t\t\t\t\tsets = this.state.filtered_emoji_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'all':\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tsets = this.state.filtered_all_sets;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst visibility = this.state.visibility_control,\n\t\t\t\t\twhisper = this.props.source === 'whisper';\n\n\t\t\t\treturn (<div class={`tw-block${this.props.visible ? '' : ' tw-hide'}`} style={{display: this.props.visible ? null : 'none !important'}}>\n\t\t\t\t\t<div class=\"tw-absolute ffz-attached ffz-attached--right ffz-attached--up\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass={`ffz-balloon ffz-balloon--auto tw-inline-block tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2 ffz--emote-picker${this.state.tall ? ' ffz--emote-picker__tall' : ''}${padding ? ' reduced-padding' : ''}`}\n\t\t\t\t\t\t\tdata-a-target=\"emote-picker\"\n\t\t\t\t\t\t\trole=\"dialog\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class={`emote-picker${whisper ? '__whisper' : ''}`}>\n\t\t\t\t\t\t\t\t<div class=\"tw-flex\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass={`emote-picker__tab-content${whisper ? '-whisper' : ''} tw-full-width scrollable-area scrollable-area--suppress-scroll-x`}\n\t\t\t\t\t\t\t\t\t\tdata-test-selector=\"scrollable-area-wrapper\"\n\t\t\t\t\t\t\t\t\t\tdata-simplebar\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div ref={this.saveScrollRef} class=\"simplebar-scroll-content\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"simplebar-content\">\n\t\t\t\t\t\t\t\t\t\t\t\t{loading && this.renderLoading()}\n\t\t\t\t\t\t\t\t\t\t\t\t{!loading && sets && sets.map((data,idx) => data && (! visibility || (! data.emoji && ! data.is_favorites)) && createElement(\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata.emoji ? t.EmojiSection : t.MenuSection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey: data.key,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tidx,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tffz_sub_data: this.state.ffz_sub_data,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\temote_modifiers: this.state.emote_modifiers,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimated: this.state.animated,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcombineTabs: this.state.combineTabs,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowHeading: this.state.showHeading,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiltered: this.state.filtered,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvisibility_control: visibility,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClickToken: this.props.onClickToken,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taddSection: this.addSection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tremoveSection: this.removeSection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstartObserving: this.startObserving,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopObserving: this.stopObserving\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t{! loading && (! sets || ! sets.length) && this.renderEmpty()}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{(! loading && this.state.quickNav && ! is_favs) && (<div class={`emote-picker__nav_content${whisper ? '-whisper' : ''} tw-block tw-border-radius-none tw-c-background-alt-2`}>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass={`emote-picker__nav-content-overflow${whisper ? '-whisper' : ''} scrollable-area scrollable-area--suppress-scroll-x`}\n\t\t\t\t\t\t\t\t\t\t\tdata-test-selector=\"scrollable-area-wrapper\"\n\t\t\t\t\t\t\t\t\t\t\tdata-simplebar\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div ref={this.saveNavRef} class=\"simplebar-scroll-content\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"simplebar-content\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{!loading && sets && sets.map(data => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ( ! data || (visibility && (data.is_favorites || data.emoji)) )\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst active = this.state.active_nav === data.key;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={data.key}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass={`${active ? 'emote-picker-tab-item-wrapper__active ' : ''}${padding ? 'tw-mg-y-05' : 'tw-mg-y-1'} tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-key={data.key}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-title={`${data.i18n ? t.i18n.t(data.i18n, data.title) : data.title}\\n${data.source_i18n ? t.i18n.t(data.source_i18n, data.source) : data.source}${data.channel_source ? ` (${data.channel_source})` : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-side=\"left\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickSideNav}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class={`tw-align-items-center tw-flex tw-justify-content-center ${padding ? '' : 'tw-pd-x-05 '}tw-pd-y-05${active ? ' emote-picker-tab-item-avatar__active tw-c-text-link' : ''}`}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{data.image ? <figure class=\"ffz-avatar ffz-avatar--size-20\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"tw-block tw-border-radius-rounded tw-img tw-image-avatar\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={data.image}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrcSet={data.image_set}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</figure> : <figure class={`ffz-emote-picker--nav-icon ffz-i-${data.icon || 'zreknarf'}`} />}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>);\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{no_tabs && <div class=\"tw-mg-y-1 tw-mg-x-05 tw-border-t\" />}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{no_tabs && (<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"tw-mg-y-1 tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.settings', 'Open Settings')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-side=\"left\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickSettings}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class={`tw-align-items-center tw-flex tw-justify-content-center ${padding ? '' : 'tw-pd-x-05 '}tw-pd-y-05`}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-emote-picker--nav-icon ffz-i-cog\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"emote-picker__controls-container tw-relative\">\n\t\t\t\t\t\t\t\t\t{(is_emoji || this.state.showSearch) && (<div class=\"tw-border-t tw-pd-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"tw-flex\">\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width ffz-input tw-pd-x-1 tw-pd-y-05\"\n\t\t\t\t\t\t\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t\t\t\t\t\t\tis_emoji ?\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.search-emoji', 'Search for Emoji') :\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.search', 'Search for Emotes')\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.filter}\n\t\t\t\t\t\t\t\t\t\t\t\tautoFocus\n\t\t\t\t\t\t\t\t\t\t\t\tautoCapitalize=\"off\"\n\t\t\t\t\t\t\t\t\t\t\t\tautoCorrect=\"off\"\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.handleFilterChange}\n\t\t\t\t\t\t\t\t\t\t\t\tonKeyDown={this.handleKeyDown}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{(no_tabs || is_emoji) && ! visibility && this.state.has_emoji_tab && <t.EmojiTonePicker\n\t\t\t\t\t\t\t\t\t\t\t\ttone={this.state.tone}\n\t\t\t\t\t\t\t\t\t\t\t\tchoices={this.state.tone_emoji}\n\t\t\t\t\t\t\t\t\t\t\t\tpickTone={this.pickTone}\n\t\t\t\t\t\t\t\t\t\t\t/>}\n\t\t\t\t\t\t\t\t\t\t\t{(no_tabs || ! is_emoji) && <div class=\"tw-relative ffz-il-tooltip__container tw-mg-l-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass={`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon--primary ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.state.visibility_control ? ' ffz-core-button--primary' : ' tw-button-icon'}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.toggleVisibilityControl}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon tw-mg-x-05\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class={this.state.visibility_control ? 'ffz-i-eye-off' : 'ffz-i-eye'} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--up ffz-il-tooltip--align-right\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{this.state.visibility_control ?\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.toggle-hide.on', 'Exit Emote Visibility Control') :\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('emote-menu.toggle-hide.off', 'Emote Visibility Control')\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-mg-t-1 ffz--tooltip-explain\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.i18n.t('emote-menu.toggle-hide.info', 'Emote Visibility Control allows you to hide emotes from your emote menu, either individually or by set. With Emote Visibility Control enabled, just click an emote to hide or unhide it. Please note that you will still see the emotes in chat if someone uses them, but they won\\'t appear in your emote menu.')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>)}\n\t\t\t\t\t\t\t\t\t{(no_tabs && this.state.quickNav) ? null : (<div class=\"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt\">\n\t\t\t\t\t\t\t\t\t\t{! visibility && <div class={`emote-picker-tab-item${tab === 'fav' ? ' emote-picker-tab-item--active' : ''} tw-relative`}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass={`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${tab === 'fav' ? ' ffz-interactable--selected' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"emote-picker__fav\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tab=\"fav\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.favorites', 'Favorites')}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickTab}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-star\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>}\n\t\t\t\t\t\t\t\t\t\t{this.state.has_channel_tab && <div class={`emote-picker-tab-item${tab === 'channel' ? ' emote-picker-tab-item--active' : ''} tw-relative`}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass={`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${tab === 'channel' ? ' ffz-interactable--selected' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"emote-picker__channel\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tab=\"channel\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.channel', 'Channel')}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickTab}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-camera\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>}\n\t\t\t\t\t\t\t\t\t\t{this.state.has_effect_tab && <div class={`emote-picker-tab-item${tab === 'effect' ? ' emote-picker-tab-item--active' : ''} tw-relative`}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass={`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${tab === 'effect' ? ' ffz-interactable--selected' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"emote-picker__effect\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tab=\"effect\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.effects', 'Emote Effects')}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickTab}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{this.state.hasNewEffects && (<div class=\"ffz-new-indicator\" />)}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-fx\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>}\n\t\t\t\t\t\t\t\t\t\t<div class={`emote-picker-tab-item${tab === 'all' ? ' emote-picker-tab-item--active' : ''} tw-relative`}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass={`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${tab === 'all' ? ' ffz-interactable--selected' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"emote-picker__all\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tab=\"all\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.my-emotes', 'My Emotes')}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickTab}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-channels\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{! visibility && this.state.has_emoji_tab && <div class={`emote-picker-tab-item${tab === 'emoji' ? ' emote-picker-tab-item--active' : ''} tw-relative`}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass={`ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive${tab === 'emoji' ? ' ffz-interactable--selected' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"emote-picker__emoji\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tab=\"emoji\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.emoji', 'Emoji')}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickTab}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-smile\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>}\n\t\t\t\t\t\t\t\t\t\t<div class=\"tw-flex-grow-1\" />\n\t\t\t\t\t\t\t\t\t\t<div class=\"emote-picker-tab-item tw-relative\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-tooltip-type=\"html\"\n\t\t\t\t\t\t\t\t\t\t\t\tdata-title={t.i18n.t('emote-menu.settings', 'Open Settings')}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.clickSettings}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-cog\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\t\t\t}\n\t\t}\n\n\t\tthis.fine.wrap('ffz-emote-menu', this.MenuComponent);\n\t}\n\n\n\tasync getFFZSubPrices() {\n\t\tlet result;\n\t\ttry {\n\t\t\tresult = await fetch(`${this.staging.api}/payment/plans`)\n\t\t\t\t.then(r => r.ok ? r.json() : null);\n\t\t} catch(err) {\n\t\t\tthis.log.error('Unable to load subscription prices from server.', err);\n\t\t\tresult = null;\n\t\t}\n\n\t\t// We only care about:\n\t\t// 1. What collections are granted by the available plan.\n\t\t// 2. How much they cost.\n\n\t\tconst out = {\n\t\t\tsets: {}\n\t\t};\n\n\t\tfor(const plan of Object.values(result.plans)) {\n\t\t\tif ( ! Array.isArray(plan.temporary_collections) )\n\t\t\t\tcontinue;\n\n\t\t\tlet prices;\n\t\t\tfor(const gw_plan of Object.values(result.gateway_plans)) {\n\t\t\t\tif ( gw_plan.plan_id === plan.id && gw_plan.months === 1 ) {\n\t\t\t\t\tprices = gw_plan.prices;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( prices )\n\t\t\t\tfor(const set_id of plan.temporary_collections) {\n\t\t\t\t\tout.sets[set_id] = {\n\t\t\t\t\t\tplan_id: plan.id,\n\t\t\t\t\t\tprices\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tasync getFFZSubData() {\n\t\tconst me = this.resolve('site').getUser();\n\t\tif ( ! me )\n\t\t\treturn null;\n\n\t\tconst token = await this.resolve('socket').getBareAPIToken();\n\t\tif ( ! token )\n\t\t\treturn null;\n\n\t\tlet result;\n\t\ttry {\n\t\t\tresult = await fetch(`${this.staging.api}/v2/subscription/status?include=plan`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${token}`\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.then(r => r.ok ? r.json() : null);\n\t\t} catch(err) {\n\t\t\tthis.log.error('Unable to load subscription status from server.', err);\n\t\t\tresult = null;\n\t\t}\n\n\t\t// We only care about:\n\t\t// 1. If the user has a free sub available\n\t\t// 2. What collections can expire/renew\n\t\t// 3. When they expire/renew\n\n\t\tif ( ! result )\n\t\t\treturn {error: true};\n\n\t\tconst out = {\n\t\t\thas_free_sub: result.user?.bonus_month_eligible ?? false,\n\t\t\tsets: {}\n\t\t};\n\n\t\tif ( result.user?.active_subs )\n\t\t\tfor(const entry of Object.values(result.user.active_subs)) {\n\t\t\t\tconst plan = result.plans?.[entry.id];\n\t\t\t\tif ( Array.isArray(plan?.temporary_collections) ) {\n\t\t\t\t\tfor(const set_id of plan.temporary_collections)\n\t\t\t\t\t\tout.sets[set_id] = {\n\t\t\t\t\t\t\tplan_id: entry.id,\n\t\t\t\t\t\t\texpires_at: entry.expires_at\n\t\t\t\t\t\t\t\t? new Date(entry.expires_at)\n\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\tnext_bill_date: entry.next_bill_date\n\t\t\t\t\t\t\t\t? new Date(entry.next_bill_date)\n\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tasync getData(sets, force, cursor = null, nodes = []) {\n\t\tif ( this._data ) {\n\t\t\tif ( ! force && set_equals(sets, this._data_sets) )\n\t\t\t\treturn this._data;\n\t\t\telse {\n\t\t\t\tthis._data = null;\n\t\t\t\tthis._data_sets = null;\n\t\t\t}\n\t\t}\n\n\t\tlet data;\n\t\ttry {\n\t\t\tdata = await this.apollo.client.query({\n\t\t\t\tquery: SUB_STATUS,\n\t\t\t\tvariables: {\n\t\t\t\t\tfirst: 75,\n\t\t\t\t\tafter: cursor,\n\t\t\t\t\tcriteria: {\n\t\t\t\t\t\tfilter: 'ALL'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfetchPolicy: force ? 'network-only' : 'cache-first'\n\t\t\t});\n\n\t\t} catch(err) {\n\t\t\tthis.log.warn('Error fetching additional emote menu data.', err);\n\t\t\treturn this._data = null;\n\t\t}\n\n\t\tconst out = {},\n\t\t\tcurr_nodes = get('data.currentUser.subscriptionBenefits.edges.@each.node', data),\n\t\t\thas_next_page = get('data.currentUser.subscriptionBenefits.pageInfo.hasNextPage', data),\n\t\t\tcurr_cursor = get('data.currentUser.subscriptionBenefits.edges.@last.cursor', data);\n\n\t\tnodes = nodes.concat(curr_nodes);\n\n\t\tif (has_next_page) {\n\t\t\treturn this.getData(sets, force, curr_cursor, nodes);\n\t\t}\n\n\t\tif ( nodes && nodes.length )\n\t\t\tfor(const node of nodes) {\n\t\t\t\tconst product = node && node.product,\n\t\t\t\t\tset_id = product && product.emoteSetID;\n\n\t\t\t\tif ( ! set_id )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tout[set_id] = {\n\t\t\t\t\tends: maybe_date(node.endsAt),\n\t\t\t\t\trenews: maybe_date(node.renewsAt),\n\t\t\t\t\tprime: node.purchasedWithPrime,\n\t\t\t\t\tset_id,\n\t\t\t\t\ttype: product.type,\n\t\t\t\t\tgift: node.gift?.isGift\n\t\t\t\t};\n\t\t\t}\n\n\t\tthis._data_sets = sets;\n\t\treturn this._data = out;\n\t}\n}\n\n\nEmoteMenu.getData = once(EmoteMenu.getData);\nEmoteMenu.getFFZSubData = once(EmoteMenu.getFFZSubData);\nEmoteMenu.getFFZSubPrices = once(EmoteMenu.getFFZSubPrices);\n","'use strict';\n\n// ============================================================================\n// RichContent Component\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport { findReactFragment } from 'utilities/dom';\n\nimport { SourcedSet, getTwitchEmoteSrcSet } from 'utilities/object';\nimport { TWITCH_POINTS_SETS, TWITCH_GLOBAL_SETS, TWITCH_PRIME_SETS, KNOWN_CODES, REPLACEMENTS, REPLACEMENT_BASE, KEYS } from 'utilities/constants';\n\nimport Twilight from 'site';\n\n\n// Prefer using these statically-allocated collators to String.localeCompare\nconst locale = Intl.Collator();\nconst localeCaseInsensitive = Intl.Collator(undefined, {sensitivity: 'accent'});\n\n// Describes how an emote matches against a given input\n// Higher values represent a more exact match\nconst NO_MATCH = 0;\nconst MATCH_ANY = 1;\nconst NON_PREFIX_MATCH = 2;\nconst CASE_INSENSITIVE_PREFIX_MATCH = 3;\nconst EXACT_PREFIX_MATCH = 4;\n\nfunction getNodeText(node) {\n\tif ( ! node )\n\t\treturn '';\n\n\tif ( node.type === 'emote' )\n\t\treturn node.emoteName;\n\n\tif ( node.type === 'text' )\n\t\treturn node.text;\n\n\tif ( Array.isArray(node.children) )\n\t\treturn node.children.map(getNodeText).join('');\n\n\treturn '';\n}\n\nfunction getNodeOffset(nodes, path) {\n\tlet offset = 0, pidx = 0, n = nodes;\n\n\twhile(pidx < path.length) {\n\t\tconst p = path[pidx];\n\n\t\tfor(let i = 0; i < p; i++)\n\t\t\toffset += getNodeText(n[i]).length;\n\n\t\tn = Array.isArray(n[p]) ? n[p] : n[p]?.children;\n\t\tpidx++;\n\t}\n\n\treturn offset;\n}\n\nexport default class Input extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('chat');\n\t\tthis.inject('chat.actions');\n\t\tthis.inject('chat.emotes');\n\t\tthis.inject('chat.emoji');\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site');\n\n\t\t// Settings\n\n\t\tthis.settings.add('chat.hype.display-input', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Hype Chat >> Input',\n\t\t\t\ttitle: 'Allow the Hype Chat button to appear in the chat input element.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.inline-preview.enabled', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Appearance',\n\t\t\t\ttitle: 'Display in-line previews of FrankerFaceZ emotes when entering a chat message.',\n\t\t\t\tdescription: '**Note:** This feature is temperamental. It may not display all emotes, and emote effects and overlay emotes are not displayed correctly. Once this setting has been enabled, it cannot be reasonably disabled and will remain active until you refresh the page.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.mru.enabled', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Recent Messages',\n\t\t\t\ttitle: 'Allow pressing up and down to recall previously sent chat messages.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.ffz-emotes', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Allow tab-completion of FrankerFaceZ emotes.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.emoji', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Allow tab-completion of emoji.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.emotes-without-colon', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Allow tab-completion of emotes without typing a colon. (:)',\n\t\t\t\tdescription: 'This will prevent the tab-completion of usernames without the @ prefix.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.limit-results', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Limit tab-completion results to 25.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.prioritize-favorites', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Prioritize favorite emotes at the top.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.prioritize-prefix-matches', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Prioritize emotes that start with user input.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.tab-complete.matching', {\n\t\t\tdefault: 1,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Tab Completion',\n\t\t\t\ttitle: 'Emote Matching Type',\n\t\t\t\tdescription: '1: `ppa` would match `Kappa`\\n\\n' +\n\t\t\t\t\t'2: `sip` would match `cohhSip` but not `Gossip`\\n\\n' +\n\t\t\t\t\t'3: `pasta` would match `pastaThat` but not `HoldThat`',\n\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 1, title: '1: Anything (Twitch style)'},\n\t\t\t\t\t{value: 2, title: '2: Non-Prefix (Old FFZ style)'},\n\t\t\t\t\t{value: 3, title: '3: Exact (Case-Insensitive)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\n\t\t// Components\n\n\t\tthis.ChatInput = this.fine.define(\n\t\t\t'chat-input',\n\t\t\tn => n && n.setLocalChatInputRef && n.setLocalAutocompleteInputRef,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.EmoteSuggestions = this.fine.define(\n\t\t\t'tab-emote-suggestions',\n\t\t\tn => n && n.getMatches && n.autocompleteType === 'emote',\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\n\t\tthis.MentionSuggestions = this.fine.define(\n\t\t\t'tab-mention-suggestions',\n\t\t\tn => n && n.getMentions && n.renderMention,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.CommandSuggestions = this.fine.define(\n\t\t\t'tab-cmd-suggestions',\n\t\t\tn => n && n.getMatches && n.doesCommandMatchTerm,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\t// Implement Twitch's unfinished emote usage object for prioritizing sorting\n\t\tthis.EmoteUsageCount = {\n\t\t\tTriHard: 196568036,\n\t\t\tKappa: 192158118,\n\t\t\t'4Head': 155758710,\n\t\t\tPogChamp: 151485090,\n\t\t\tcmonBruh: 146352878,\n\t\t\tBibleThump: 56472964,\n\t\t\tWutFace: 45069031,\n\t\t\tKreygasm: 41387580,\n\t\t\tDansGame: 38097659,\n\t\t\tSMOrc: 34734484,\n\t\t\tKappaPride: 34262839,\n\t\t\tVoHiYo: 27886434,\n\t\t\tSwiftRage: 24561900,\n\t\t\tResidentSleeper: 24438298,\n\t\t\tEleGiggle: 19891526,\n\t\t\tFailFish: 19118343,\n\t\t\tNotLikeThis: 18802905,\n\t\t\tKeepo: 18351415,\n\t\t\tBabyRage: 18220906,\n\t\t\tMingLee: 18026207,\n\t\t\tHeyGuys: 14851569,\n\t\t\tANELE: 14648986,\n\t\t\tPJSalt: 14438861\n\t\t};\n\t}\n\n\tasync onEnable() {\n\t\tthis.chat.context.on('changed:chat.hype.display-input', () => this.ChatInput.forceUpdate());\n\t\tthis.chat.context.on('changed:chat.actions.room', () => this.ChatInput.forceUpdate());\n\t\tthis.chat.context.on('changed:chat.actions.room-above', () => this.ChatInput.forceUpdate());\n\t\tthis.chat.context.on('changed:chat.tab-complete.emotes-without-colon', enabled => {\n\t\t\tfor (const inst of this.EmoteSuggestions.instances)\n\t\t\t\tinst.canBeTriggeredByTab = enabled;\n\n\t\t\tfor (const inst of this.MentionSuggestions.instances)\n\t\t\t\tinst.canBeTriggeredByTab = !enabled;\n\t\t});\n\n\t\tthis.use_previews = this.chat.context.get('chat.inline-preview.enabled');\n\n\t\tthis.chat.context.on('changed:chat.inline-preview.enabled', val => {\n\t\t\tif ( this.use_previews )\n\t\t\t\treturn;\n\n\t\t\tthis.use_previews = val;\n\t\t\tif ( val )\n\t\t\t\tfor(const inst of this.ChatInput.instances) {\n\t\t\t\t\tthis.installPreviewObserver(inst);\n\t\t\t\t\tinst.ffzInjectEmotes();\n\t\t\t\t\tinst.forceUpdate();\n\t\t\t\t\tthis.emit('site:dom-update', 'chat-input', inst);\n\t\t\t\t}\n\t\t});\n\n\t\tconst React = await this.site.findReact(),\n\t\t\tcreateElement = React && React.createElement;\n\n\t\tif ( ! createElement )\n\t\t\treturn this.log.warn('Unable to get React.');\n\n\t\tconst t = this;\n\n\t\tthis.ChatInput.ready((cls, instances) => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tconst out = old_render.call(this);\n\n\t\t\t\ttry {\n\t\t\t\t\tconst hide_hype = ! t.chat.context.get('chat.hype.display-input');\n\t\t\t\t\tif ( hide_hype ) {\n\t\t\t\t\t\tconst frag = findReactFragment(out, n => n.key === 'paidPinnedMessage');\n\t\t\t\t\t\tif ( frag )\n\t\t\t\t\t\t\tfrag.type = () => null;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst above = t.chat.context.get('chat.actions.room-above'),\n\t\t\t\t\t\tstate = t.chat.context.get('context.chat_state') || {},\n\t\t\t\t\t\tcontainer = above ? findReactFragment(out, n => n.props && Array.isArray(n.props.children))  : findReactFragment(out, n => n.props && n.props.className === 'chat-input__buttons-container');\n\t\t\t\t\tif ( ! container || ! container.props || ! container.props.children )\n\t\t\t\t\t\treturn out;\n\n\t\t\t\t\tconst props = this.props;\n\t\t\t\t\tif ( ! props || ! props.channelID )\n\t\t\t\t\t\treturn out;\n\n\t\t\t\t\tconst u = props.sessionUser ? {\n\t\t\t\t\t\t\tid: props.sessionUser.id,\n\t\t\t\t\t\t\tlogin: props.sessionUser.login,\n\t\t\t\t\t\t\tdisplayName: props.sessionUser.displayName,\n\t\t\t\t\t\t\tmod: props.isCurrentUserModerator,\n\t\t\t\t\t\t\tstaff: props.isStaff\n\t\t\t\t\t\t} : null,\n\t\t\t\t\t\tr = {\n\t\t\t\t\t\t\tid: props.channelID,\n\t\t\t\t\t\t\tlogin: props.channelLogin,\n\t\t\t\t\t\t\tdisplayName: props.channelDisplayName,\n\t\t\t\t\t\t\temoteOnly: props.emoteOnlyMode,\n\t\t\t\t\t\t\tslowMode: props.slowMode,\n\t\t\t\t\t\t\tslowDuration: props.slowModeDuration,\n\t\t\t\t\t\t\tsubsMode: props.subsOnlyMode,\n\t\t\t\t\t\t\tr9kMode: state.r9k,\n\t\t\t\t\t\t\tfollowersOnly: state.followersOnly,\n\t\t\t\t\t\t\tfollowersDuration: state.followersOnlyRequirement\n\t\t\t\t\t\t}\n\n\t\t\t\t\tconst actions = t.actions.renderRoom(t.chat.context.get('context.chat.showModIcons'), u, r, above, createElement);\n\t\t\t\t\tif ( above )\n\t\t\t\t\t\tcontainer.props.children.unshift(actions || null);\n\t\t\t\t\telse\n\t\t\t\t\t\tcontainer.props.children.splice(1, 0, actions || null);\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.error(err);\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfor(const inst of instances) {\n\t\t\t\tinst.forceUpdate();\n\t\t\t\tthis.emit('site:dom-update', 'chat-input', inst);\n\t\t\t\tthis.updateEmoteCompletion(inst);\n\t\t\t\tthis.overrideChatInput(inst);\n\t\t\t\tinst.ffzInjectEmotes();\n\t\t\t\tthis.installPreviewObserver(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.EmoteSuggestions.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.overrideEmoteMatcher(inst);\n\t\t});\n\n\t\tthis.MentionSuggestions.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.overrideMentionMatcher(inst);\n\t\t});\n\n\t\tthis.CommandSuggestions.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.overrideCommandMatcher(inst);\n\t\t});\n\n\t\tthis.ChatInput.on('update', this.updateEmoteCompletion, this);\n\t\tthis.ChatInput.on('mount', this.overrideChatInput, this);\n\n\t\tthis.ChatInput.on('mount', this.installPreviewObserver, this);\n\t\tthis.ChatInput.on('unmount', this.removePreviewObserver, this);\n\n\t\tthis.EmoteSuggestions.on('mount', this.overrideEmoteMatcher, this);\n\t\tthis.MentionSuggestions.on('mount', this.overrideMentionMatcher, this);\n\t\tthis.CommandSuggestions.on('mount', this.overrideCommandMatcher, this);\n\n\t\tthis.chat.context.on('changed:chat.emotes.animated', this.uncacheTabCompletion, this);\n\t\tthis.chat.context.on('changed:chat.emotes.enabled', this.uncacheTabCompletion, this);\n\t\tthis.chat.context.on('changed:chat.tab-complete.matching', this.uncacheTabCompletion, this);\n\t\tthis.on('chat.emotes:change-hidden', this.uncacheTabCompletion, this);\n\t\tthis.on('chat.emotes:change-set-hidden', this.uncacheTabCompletion, this);\n\t\tthis.on('chat.emotes:change-favorite', this.uncacheTabCompletion, this);\n\t\tthis.on('chat.emotes:update-default-sets', this.uncacheTabCompletion, this);\n\t\tthis.on('chat.emotes:update-user-sets', this.uncacheTabCompletion, this);\n\t\tthis.on('chat.emotes:update-room-sets', this.uncacheTabCompletion, this);\n\t\tthis.on('site.css_tweaks:update-chat-css', this.resizeInput, this);\n\t}\n\n\tuncacheTabCompletion() {\n\t\tfor(const inst of this.EmoteSuggestions.instances) {\n\t\t\tinst.ffz_ffz_cache = null;\n\t\t\tinst.ffz_twitch_cache = null;\n\t\t}\n\n\t\tif ( this.use_previews )\n\t\t\tfor(const inst of this.ChatInput.instances) {\n\t\t\t\tinst.ffzInjectEmotes();\n\t\t\t\tinst.forceUpdate();\n\t\t\t\tthis.emit('site:dom-update', 'chat-input', inst);\n\t\t\t}\n\t}\n\n\tupdateInput() {\n\t\tfor(const inst of this.ChatInput.instances) {\n\t\t\tif ( inst ) {\n\t\t\t\tinst.forceUpdate();\n\t\t\t\tthis.emit('site:dom-update', 'chat-input', inst);\n\t\t\t}\n\t\t}\n\t}\n\n\tresizeInput() {\n\t\tif ( this._resize_waiter )\n\t\t\tcancelAnimationFrame(this._resize_waiter);\n\n\t\tthis._resize_waiter = requestAnimationFrame(() => this._resizeInput())\n\t}\n\n\t_resizeInput() {\n\t\tthis._resize_waiter = null;\n\t\tfor (const chat_input of this.ChatInput.instances)\n\t\t\tchat_input.resizeInput();\n\t}\n\n\n\tinstallPreviewObserver(inst) {\n\t\tif ( inst._ffz_preview_observer || ! window.MutationObserver )\n\t\t\treturn;\n\n\t\tif ( ! this.use_previews )\n\t\t\treturn;\n\n\t\tconst el = this.fine.getHostNode(inst),\n\t\t\ttarget = el && el.querySelector('.chat-input__textarea');\n\t\tif ( ! target )\n\t\t\treturn;\n\n\t\tinst._ffz_preview_observer = new MutationObserver(mutations => {\n\t\t\tfor(const mut of mutations) {\n\t\t\t\t//if ( mut.target instanceof Element )\n\t\t\t\t//\tthis.checkForPreviews(inst, mut.target);\n\n\t\t\t\tfor(const node of mut.addedNodes) {\n\t\t\t\t\tif ( node instanceof Element )\n\t\t\t\t\t\tthis.checkForPreviews(inst, node);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tinst._ffz_preview_observer.observe(target, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true,\n\t\t\t//attributeFilter: ['src']\n\t\t});\n\t}\n\n\tcheckForPreviews(inst, node) {\n\t\t// We can't find the tooltip element directly (without digging into React tree at least)\n\t\t// So instead just find the relevant images in the document. This shouldn't happen TOO\n\t\t// frequently, with any luck, so the performance impact should be small.\n\t\tif ( node.querySelector?.('span[data-a-target=\"chat-input-emote-preview\"]') ) {\n\t\t\tfor(const target of document.querySelectorAll('.tw-tooltip-layer img.chat-line__message--emote')) {\n\t\t\t\tif ( target && target.src.startsWith('https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__') )\n\t\t\t\t\tthis.updatePreview(inst, target);\n\t\t\t}\n\t\t}\n\n\t\t// This no longer works because they removed aria-describedby\n\t\t/*for(const el of node.querySelectorAll?.('span[data-a-target=\"chat-input-emote-preview\"][aria-describedby]') ?? []) {\n\t\t\tconst cont = document.getElementById(el.getAttribute('aria-describedby')),\n\t\t\t\ttarget = cont && cont.querySelector('img.chat-line__message--emote');\n\n\t\t\tif ( target && target.src.startsWith('https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__') )\n\t\t\t\tthis.updatePreview(inst, target);\n\t\t}*/\n\n\t\tfor(const target of node.querySelectorAll?.('img.chat-line__message--emote')) {\n\t\t\tif ( target && (target.dataset.ffzId || target.src.startsWith('https://static-cdn.jtvnw.net/emoticons/v2/__FFZ__')) )\n\t\t\t\tthis.updatePreview(inst, target);\n\t\t}\n\t}\n\n\tupdatePreview(inst, target) {\n\t\tlet set_id = target.dataset.ffzSet,\n\t\t\temote_id = target.dataset.ffzId;\n\n\t\tif ( ! emote_id ) {\n\t\t\tconst idx = target.src.indexOf('__FFZ__', 49),\n\t\t\t\traw_id = target.src.slice(49, idx);\n\n\t\t\tconst raw_idx = raw_id.indexOf('::');\n\t\t\tif ( raw_idx === -1 )\n\t\t\t\treturn;\n\n\t\t\tset_id = raw_id.slice(0, raw_idx);\n\t\t\temote_id = raw_id.slice(raw_idx + 2);\n\n\t\t\ttarget.dataset.ffzSet = set_id;\n\t\t\ttarget.dataset.ffzId = emote_id;\n\t\t}\n\n\t\tconst emote_set = this.emotes.emote_sets[set_id],\n\t\t\temote = emote_set?.emotes?.[emote_id];\n\n\t\tif ( ! emote )\n\t\t\treturn;\n\n\t\tconst anim = this.chat.context.get('chat.emotes.animated') > 0;\n\n\t\ttarget.src = (anim ? emote.animSrc : null) ?? emote.src;\n\t\ttarget.srcset = (anim ? emote.animSrcSet : null) ?? emote.srcSet;\n\n\t\tconst w = `${emote.width}px`;\n\t\tconst h = `${emote.height}px`;\n\n\t\ttarget.style.width = w;\n\t\ttarget.style.height = h;\n\n\t\t// Find the parent.\n\t\tconst cont = target.closest('.chat-image__container');\n\t\tif ( cont ) {\n\t\t\tcont.style.width = w;\n\t\t\tcont.style.height = h;\n\n\t\t\tconst outer = cont.closest('.chat-line__message--emote-button');\n\t\t\tif ( outer ) {\n\t\t\t\touter.style.width = w;\n\t\t\t\touter.style.height = h;\n\n\t\t\t\tif ( ! outer._ffz_click_handler ) {\n\t\t\t\t\touter._ffz_click_handler = this.previewClick.bind(this, emote.id, emote_set.id, emote.name);\n\t\t\t\t\touter.addEventListener('click', outer._ffz_click_handler);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpreviewClick(id, set, name, evt) {\n\t\tconst fe = this.makeEvent({\n\t\t\tprovider: 'ffz',\n\t\t\tid,\n\t\t\tset,\n\t\t\tname,\n\t\t\tsource: evt\n\t\t});\n\n\t\tthis.emit('chat.emotes:click', fe);\n\t\tif ( ! fe.defaultPrevented )\n\t\t\treturn;\n\n\t\tevt.preventDefault();\n\t\tevt.stopImmediatePropagation();\n\t}\n\n\tremovePreviewObserver(inst) {\n\t\tif ( inst._ffz_preview_observer ) {\n\t\t\tinst._ffz_preview_observer.disconnect();\n\t\t\tinst._ffz_preview_observer = null;\n\t\t}\n\t}\n\n\n\tupdateEmoteCompletion(inst, child) {\n\t\tif ( ! child )\n\t\t\tchild = this.fine.searchTree(inst, 'tab-emote-suggestions', 50);\n\t\tif ( ! child )\n\t\t\treturn;\n\n\t\tchild._ffz_user = inst.props.sessionUser;\n\t\tchild._ffz_channel_id = inst.props.channelID;\n\t\tchild._ffz_channel_login = inst.props.channelLogin;\n\t}\n\n\toverrideChatInput(inst) {\n\t\tif ( inst._ffz_override )\n\t\t\treturn;\n\n\t\tconst t = this;\n\n\t\tconst originalOnKeyDown = inst.onKeyDown,\n\t\t\toriginalOnMessageSend = inst.onMessageSend,\n\t\t\told_resize = inst.resizeInput;\n\n\t\tconst old_componentDidUpdate = inst.componentDidUpdate;\n\n\t\tinst.ffzInjectEmotes = function() {\n\t\t\tconst idx = this.props.emotes.findIndex(item => item?.id === 'FrankerFaceZWasHere'),\n\t\t\t\tdata = t.createFakeEmoteSet(inst);\n\n\t\t\tif ( idx === -1 && data )\n\t\t\t\tthis.props.emotes.push(data);\n\t\t\telse if ( idx !== -1 && data )\n\t\t\t\tthis.props.emotes.splice(idx, 1, data);\n\t\t\telse if ( idx !== -1 && ! data )\n\t\t\t\tthis.props.emotes.splice(idx, 1);\n\t\t\telse\n\t\t\t\treturn;\n\n\t\t\t// TODO: Somehow update other React state to deal with our\n\t\t\t// injected changes. Making a shallow copy of the array\n\t\t\t// runs too frequently.\n\t\t}\n\n\t\tinst.componentDidUpdate = function(props, ...args) {\n\t\t\ttry {\n\t\t\t\tif ( props.emotes !== this.props.emotes && Array.isArray(this.props.emotes) )\n\t\t\t\t\tinst.ffzInjectEmotes();\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error updating emote autocompletion data.', err);\n\t\t\t}\n\n\t\t\tif ( old_componentDidUpdate )\n\t\t\t\told_componentDidUpdate.call(this, props, ...args);\n\t\t}\n\n\t\tinst.resizeInput = function(msg, ...args) {\n\t\t\ttry {\n\t\t\t\tif ( msg ) {\n\t\t\t\t\tif ( inst.chatInputRef instanceof Element ) {\n\t\t\t\t\t\tconst style = getComputedStyle(inst.chatInputRef),\n\t\t\t\t\t\t\theight = style && parseFloat(style.lineHeight || 18) || 18,\n\t\t\t\t\t\t\tt = height * 1 + 20.5,\n\t\t\t\t\t\t\ti = Math.ceil((inst.chatInputRef.scrollHeight - t) / height),\n\t\t\t\t\t\t\ta = Math.min(1 + i, 4);\n\n\t\t\t\t\t\tinst.setState({\n\t\t\t\t\t\t\tnumInputRows: a\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else\n\t\t\t\t\tinst.setState({\n\t\t\t\t\t\tnumInputRows: 1\n\t\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tt.log.error('Error in resizeInput', err);\n\t\t\t\treturn old_resize.call(this, msg, ...args);\n\t\t\t}\n\t\t}\n\n\t\tinst.messageHistory = [];\n\t\tinst.tempInput = '';\n\t\tinst.messageHistoryPos = -1;\n\n\t\tinst.ffzGetValue = function() {\n\t\t\tif ( inst.chatInputRef && typeof inst.chatInputRef.value === 'string' )\n\t\t\t\treturn inst.chatInputRef.value;\n\n\t\t\tif ( inst.state.value && typeof inst.state.value === 'string' )\n\t\t\t\treturn inst.state.value;\n\n\t\t\treturn '';\n\t\t}\n\n\t\tinst.ffzGetSelection = function() {\n\t\t\tif ( typeof inst.chatInputRef?.selectionEnd === 'number' ) {\n\t\t\t\treturn [inst.chatInputRef.selectionStart, inst.chatInputRef.selectionEnd]\n\t\t\t}\n\n\t\t\tif ( inst.chatInputRef?.state?.slateEditor ) {\n\t\t\t\tconst editor = inst.chatInputRef.state.slateEditor,\n\t\t\t\t\tsel = editor.selection,\n\t\t\t\t\tnodes = editor.children;\n\n\t\t\t\tif ( ! sel?.anchor?.path || ! sel?.focus?.path )\n\t\t\t\t\treturn [0,0];\n\n\t\t\t\tconst first = getNodeOffset(nodes, sel.anchor.path) + sel.anchor.offset,\n\t\t\t\t\tsecond = getNodeOffset(nodes, sel.focus.path) + sel.focus.offset;\n\n\t\t\t\tif ( first < second )\n\t\t\t\t\treturn [first, second];\n\t\t\t\telse\n\t\t\t\t\treturn [second, first];\n\t\t\t}\n\n\t\t\treturn [0,0];\n\t\t}\n\n\t\tinst.ffzSetSelection = function(start, end) {\n\t\t\tif ( inst.chatInputRef?.setSelectionRange )\n\t\t\t\tinst.chatInputRef.setSelectionRange(start, end);\n\t\t}\n\n\t\tinst.onKeyDown = function(event) {\n\t\t\ttry {\n\t\t\t\tconst code = event.charCode || event.keyCode;\n\n\t\t\t\tif ( inst.onEmotePickerToggle && t.chat.context.get('chat.emote-menu.shortcut') && event.key === 'e' && event.ctrlKey && ! event.altKey && ! event.shiftKey ) {\n\t\t\t\t\tinst.onEmotePickerToggle();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst val = inst.ffzGetValue();\n\n\t\t\t\tif ( inst.autocompleteInputRef && inst.chatInputRef && t.chat.context.get('chat.mru.enabled') && ! event.shiftKey && ! event.ctrlKey && ! event.altKey ) {\n\t\t\t\t\tconst sel = inst.ffzGetSelection();\n\n\t\t\t\t\t// Arrow Up\n\t\t\t\t\tif ( code === 38 && sel[0] === 0 && sel[1] === 0 ) {\n\t\t\t\t\t\tif ( ! inst.messageHistory.length )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( val && inst.messageHistoryPos === -1 )\n\t\t\t\t\t\t\tinst.tempInput = val;\n\n\t\t\t\t\t\tif ( inst.messageHistoryPos < inst.messageHistory.length - 1 ) {\n\t\t\t\t\t\t\tinst.messageHistoryPos++;\n\t\t\t\t\t\t\tinst.autocompleteInputRef.setValue(inst.messageHistory[inst.messageHistoryPos]);\n\t\t\t\t\t\t\tinst.ffzSetSelection(0);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t// Arrow Down\n\t\t\t\t\t} else if ( code === 40 && sel[0] >= val.length && sel[1] === sel[0] ) {\n\t\t\t\t\t\tif ( ! inst.messageHistory.length )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( inst.messageHistoryPos > 0 ) {\n\t\t\t\t\t\t\tinst.messageHistoryPos--;\n\t\t\t\t\t\t\tinst.autocompleteInputRef.setValue(inst.messageHistory[inst.messageHistoryPos]);\n\t\t\t\t\t\t\tinst.ffzSetSelection(inst.messageHistory[inst.messageHistoryPos].length);\n\n\t\t\t\t\t\t} else if ( inst.messageHistoryPos === 0 ) {\n\t\t\t\t\t\t\tinst.autocompleteInputRef.setValue(inst.tempInput);\n\t\t\t\t\t\t\tinst.ffzSetSelection(inst.tempInput.length);\n\t\t\t\t\t\t\tinst.messageHistoryPos = -1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Let users close stuff with Escape.\n\t\t\t\tif ( code === KEYS.Escape && ! event.shiftKey && ! event.ctrlKey && ! event.altKey ) {\n\t\t\t\t\tif ( inst.props.isShowingEmotePicker )\n\t\t\t\t\t\tinst.props.closeEmotePicker();\n\t\t\t\t\telse if ( inst.props.tray && (! inst.state.value || ! inst.state.value.length) )\n\t\t\t\t\t\tinst.props.clearTray();\n\t\t\t\t}\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.capture(err);\n\t\t\t\tt.log.error(err);\n\t\t\t}\n\n\t\t\toriginalOnKeyDown.call(this, event);\n\t\t}\n\n\t\tinst.onMessageSend = function(event) {\n\t\t\ttry {\n\t\t\t\tif ( t.chat.context.get('chat.mru.enabled') ) {\n\t\t\t\t\tconst val = inst.ffzGetValue();\n\t\t\t\t\tif (val && val.length) {\n\t\t\t\t\t\tif (! inst.messageHistory.length || inst.messageHistory[0] !== val) {\n\t\t\t\t\t\t\tinst.messageHistory.unshift(val);\n\t\t\t\t\t\t\tinst.messageHistory = inst.messageHistory.slice(0, 20);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tinst.messageHistoryPos = -1;\n\t\t\t\t\tinst.tempInput = '';\n\t\t\t\t}\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.capture(err);\n\t\t\t\tt.log.error(err);\n\t\t\t}\n\n\t\t\toriginalOnMessageSend.call(this, event);\n\t\t}\n\t}\n\n\n\toverrideMentionMatcher(inst) {\n\t\tinst.canBeTriggeredByTab = !this.chat.context.get('chat.tab-complete.emotes-without-colon');\n\t}\n\n\n\toverrideCommandMatcher(inst) {\n\t\tif ( inst._ffz_override )\n\t\t\treturn;\n\n\t\tinst._ffz_override = true;\n\t\tinst.oldCommands = inst.getCommands;\n\t\tinst.oldMatches = inst.getMatches;\n\t\tinst.oldReplacement = inst.determineReplacement;\n\n\t\tconst t = this;\n\n\t\tinst.getMatches = function(input, unknown, index) {\n\t\t\ttry {\n\t\t\t\treturn index === 0 && t.chat.CommandPrefixes.includes(input[0])\n\t\t\t\t\t? inst.getCommands(input) : null;\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error getting matches from command handler.', err);\n\t\t\t\treturn inst.oldCommands(input, unknown, index);\n\t\t\t}\n\t\t}\n\n\t\tinst.getCommands = function(input) { try {\n\t\t\tconst commands = inst.props.getCommands(inst.props.permissionLevel, {\n\t\t\t\tisEditor: inst.props.isCurrentUserEditor\n\t\t\t});\n\n\t\t\t// Get the parent-input so we can do stuff.\n\t\t\tconst parent = t.fine.searchParent(inst,\n\t\t\t\tn => n?.props?.channelID && n?.props?.setTray, 50);\n\n\t\t\tconst event = t.makeEvent({\n\t\t\t\tinput,\n\t\t\t\tpermissionLevel: inst.props.permissionLevel,\n\t\t\t\tisEditor: inst.props.isCurrentUserEditor,\n\t\t\t\tcommands,\n\n\t\t\t\t// Extra details, if we managed to find our parent.\n\t\t\t\t__input: parent,\n\t\t\t\tchannel: parent ? {\n\t\t\t\t\tid: parent.props.channelID,\n\t\t\t\t\tlogin: parent.props.channelLogin\n\t\t\t\t} : null\n\t\t\t});\n\n\t\t\tt.emit('chat:get-tab-commands', event);\n\n\t\t\tif ( ! commands || ! commands.length )\n\t\t\t\treturn null;\n\n\t\t\t// Trim off the starting /\n\t\t\tconst prefix = input[0],\n\t\t\t\ti = input.slice(1);\n\n\t\t\tconst sorted = commands\n\t\t\t\t.filter(cmd => prefix === (cmd.prefix ?? '/') && inst.doesCommandMatchTerm(cmd, i))\n\t\t\t\t.sort(inst.sortCommands);\n\n\t\t\tconst out = [];\n\t\t\tfor(const cmd of sorted) {\n\t\t\t\tconst arg = cmd.commandArgs?.[0];\n\t\t\t\tlet selection;\n\t\t\t\tif ( arg?.isRequired )\n\t\t\t\t\tselection = `[${arg.name}]`;\n\n\t\t\t\tout.push({\n\t\t\t\t\tcurrent: input,\n\t\t\t\t\treplacement: inst.determineReplacement(cmd),\n\t\t\t\t\tdescription: cmd.description,\n\t\t\t\t\telement: inst.renderCommandSuggestion(cmd, i),\n\t\t\t\t\tgroup: cmd.ffz_group ?\n\t\t\t\t\t\t(Array.isArray(cmd.ffz_group) ? t.i18n.t(...cmd.ffz_group) : cmd.ffz_group)\n\t\t\t\t\t\t: inst.determineGroup(cmd),\n\t\t\t\t\tselection\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// If we're working with a non-/ prefix, and have no items,\n\t\t\t// return null so we don't display ANY UI.\n\t\t\tif ( prefix !== '/' && ! out.length )\n\t\t\t\treturn null;\n\t\t\treturn out;\n\n\t\t} catch(err) {\n\t\t\tconsole.error(err);\n\t\t\treturn inst.oldCommands(input);\n\t\t} }\n\n\t\tinst.determineReplacement = function(cmd) {\n\t\t\tconst out = inst.oldReplacement(cmd);\n\t\t\tif ( (cmd.prefix ?? '/') !== '/' && out.startsWith('/') )\n\t\t\t\treturn cmd.prefix + out.slice(1);\n\t\t\treturn out;\n\t\t}\n\n\t\tconst React = this.site.getReact(),\n\t\t\tcreateElement = React?.createElement;\n\n\t\tif ( createElement )\n\t\t\tinst.renderCommandSuggestion = function(cmd, input) {\n\t\t\t\tconst args = Array.isArray(cmd?.commandArgs)\n\t\t\t\t\t? cmd.commandArgs.map(arg => (<div class={`tw-mg-r-05${arg.isRequired ? '' : ' tw-c-text-alt'}`}>[{arg.name}]</div>))\n\t\t\t\t\t: null;\n\n\t\t\t\treturn (<div class=\"tw-pd-05\">\n\t\t\t\t\t<div class=\"tw-flex\">\n\t\t\t\t\t\t<div class=\"tw-mg-r-05\">\n\t\t\t\t\t\t\t<span>{ cmd.prefix ?? '/' }</span>\n\t\t\t\t\t\t\t<span class=\"tw-semibold\">{ cmd.name }</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{args}\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class=\"tw-c-text-alt-2 tw-font-size-7\">{ cmd.description }</p>\n\t\t\t\t</div>);\n\t\t\t}\n\t}\n\n\n\tcreateFakeEmoteSet(inst) {\n\t\tif ( ! this.use_previews )\n\t\t\treturn null;\n\n\t\tif ( ! inst._ffz_channel_login ) {\n\t\t\tconst parent = this.fine.searchParent(inst, 'chat-input', 50);\n\t\t\tif ( parent )\n\t\t\t\tthis.updateEmoteCompletion(parent, inst);\n\t\t}\n\n\t\tconst user = inst._ffz_user,\n\t\t\tchannel_id = inst._ffz_channel_id,\n\t\t\tchannel_login = inst._ffz_channel_login;\n\n\t\tif ( ! channel_login )\n\t\t\treturn null;\n\n\t\tconst sets = this.emotes.getSets(user?.id, user?.login, channel_id, channel_login);\n\t\tif ( ! sets || ! sets.length )\n\t\t\treturn null;\n\n\t\tconst out = [],\n\t\t\tadded_emotes = new Set;\n\n\t\tfor(const set of sets) {\n\t\t\tif ( ! set || ! set.emotes )\n\t\t\t\tcontinue;\n\n\t\t\tconst source = set.source || 'ffz';\n\n\t\t\tfor(const emote of Object.values(set.emotes)) {\n\t\t\t\tif ( ! emote || ! emote.id || ! emote.name || added_emotes.has(emote.name) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tadded_emotes.add(emote.name);\n\n\t\t\t\tout.push({\n\t\t\t\t\tid: `__FFZ__${set.id}::${emote.id}__FFZ__`,\n\t\t\t\t\tmodifiers: null,\n\t\t\t\t\tsetID: 'FrankerFaceZWasHere',\n\t\t\t\t\ttoken: emote.name\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\t__typename: 'EmoteSet',\n\t\t\temotes: out,\n\t\t\tid: 'FrankerFaceZWasHere',\n\t\t\towner: null\n\t\t}\n\t}\n\n\n\toverrideEmoteMatcher(inst) {\n\t\tif ( inst._ffz_override )\n\t\t\treturn;\n\n\t\tconst t = this;\n\n\t\tinst.canBeTriggeredByTab = this.chat.context.get('chat.tab-complete.emotes-without-colon');\n\n\t\tinst.getMatches = function(input, pressedTab) {\n\t\t\treturn pressedTab\n\t\t\t\t? input.length < 2 ? null : inst.getMatchedEmotes(input)\n\t\t\t\t: input.startsWith(':') ? input.length < 3 ? null : inst.getMatchedEmotes(input) : null;\n\t\t}\n\n\t\tinst.doesEmoteMatchTerm = function(emote, term) {\n\t\t\tconst emote_name = emote.name || emote.token;\n\t\t\tif ( ! emote_name )\n\t\t\t\treturn NO_MATCH;\n\n\t\t\tif (emote_name.startsWith(term))\n\t\t\t\treturn EXACT_PREFIX_MATCH;\n\n\t\t\tlet emote_lower = emote.tokenLower;\n\t\t\tif ( ! emote_lower )\n\t\t\t\temote_lower = emote_name.toLowerCase();\n\n\t\t\tconst term_lower = term.toLowerCase();\n\t\t\tif (emote_lower.startsWith(term_lower))\n\t\t\t\treturn CASE_INSENSITIVE_PREFIX_MATCH;\n\n\t\t\tconst idx = emote_name.indexOf(term.charAt(0).toUpperCase());\n\t\t\tif (idx !== -1 && emote_lower.slice(idx + 1).startsWith(term_lower.slice(1)))\n\t\t\t\treturn NON_PREFIX_MATCH;\n\n\t\t\tif (emote_lower.includes(term_lower))\n\t\t\t\treturn MATCH_ANY;\n\n\t\t\treturn NO_MATCH;\n\t\t}\n\n\t\tinst.getMatchedEmotes = function(input) {\n\t\t\tconst setting = t.chat.context.get('chat.emotes.enabled');\n\t\t\tconst limitResults = t.chat.context.get('chat.tab-complete.limit-results');\n\t\t\tlet results = setting ? t.getTwitchEmoteSuggestions(input, this) : [];\n\n\t\t\tif ( setting > 1 && t.chat.context.get('chat.tab-complete.ffz-emotes') ) {\n\t\t\t\tconst ffz_emotes = t.getEmoteSuggestions(input, this);\n\t\t\t\tif ( Array.isArray(ffz_emotes) && ffz_emotes.length )\n\t\t\t\t\tresults = results.concat(ffz_emotes);\n\t\t\t}\n\n\t\t\tif ( t.chat.context.get('chat.tab-complete.emoji') ) {\n\t\t\t\tconst emoji = t.getEmojiSuggestions(input, this);\n\t\t\t\tif ( Array.isArray(emoji) && emoji.length )\n\t\t\t\t\tresults = Array.isArray(results) ? results.concat(emoji) : emoji;\n\t\t\t}\n\n\t\t\tresults = t.sortEmotes(results);\n\t\t\treturn limitResults && results.length > 25 ? results.slice(0, 25) : results;\n\t\t}\n\n\t\tconst React = this.site.getReact(),\n\t\t\tcreateElement = React?.createElement;\n\n\t\tinst.renderFFZEmojiSuggestion = function(data) {\n\t\t\treturn (<React.Fragment>\n\t\t\t\t<div class=\"tw-relative tw-flex-shrink-0 tw-pd-05\" title={data.token} favorite={data.favorite}>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"emote-autocomplete-provider__image ffz-emoji\"\n\t\t\t\t\t\tsrc={data.src}\n\t\t\t\t\t\tsrcSet={data.srcset}\n\t\t\t\t\t/>\n\t\t\t\t\t{data.favorite && <figure class=\"ffz--favorite ffz-i-star\" />}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tw-ellipsis\" title={data.token}>\n\t\t\t\t\t{data.token}\n\t\t\t\t</div>\n\t\t\t</React.Fragment>);\n\t\t}\n\n\t\tinst.renderEmoteSuggestion = function(emote) {\n\t\t\treturn (<React.Fragment>\n\t\t\t\t<div class=\"tw-relative tw-flex-shrink-0 tw-pd-05\" title={emote.token} favorite={emote.favorite}>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"emote-autocomplete-provider__image\"\n\t\t\t\t\t\tsrcSet={emote.srcSet}\n\t\t\t\t\t/>\n\t\t\t\t\t{emote.favorite && <figure class=\"ffz--favorite ffz-i-star\" />}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tw-ellipsis\" title={emote.token}>\n\t\t\t\t\t{emote.token}\n\t\t\t\t</div>\n\t\t\t</React.Fragment>);\n\t\t}\n\t}\n\n\n\t// eslint-disable-next-line class-methods-use-this\n\tsortEmotes(emotes) {\n\t\tconst preferFavorites = this.chat.context.get('chat.tab-complete.prioritize-favorites');\n\t\tconst canBeTriggeredByTab = this.chat.context.get('chat.tab-complete.emotes-without-colon');\n\t\tconst prioritizePrefixMatches = this.chat.context.get('chat.tab-complete.prioritize-prefix-matches');\n\n\t\treturn emotes.sort((a, b) => {\n\t\t\tconst aStr = a.matched || a.replacement;\n\t\t\tconst bStr = b.matched || b.replacement;\n\n\t\t\t// Prefer favorites over non-favorites, if enabled\n\t\t\tif (preferFavorites && (a.favorite ^ b.favorite))\n\t\t\t\treturn 0 - a.favorite + b.favorite;\n\n\t\t\tif (prioritizePrefixMatches) {\n\t\t\t\t// Prefer emoji over emotes if tab-complete is enabled, disprefer them otherwise\n\t\t\t\tconst aIsEmoji = !!a.matched;\n\t\t\t\tconst bIsEmoji = !!b.matched;\n\t\t\t\tif (aIsEmoji ^ bIsEmoji) {\n\t\t\t\t\tif (canBeTriggeredByTab) return 0 - aIsEmoji + bIsEmoji;\n\t\t\t\t\telse return 0 - bIsEmoji + aIsEmoji;\n\t\t\t\t}\n\n\t\t\t\t// Prefer case-sensitive prefix matches\n\t\t\t\tconst aStartsWithInput = (a.match_type === EXACT_PREFIX_MATCH);\n\t\t\t\tconst bStartsWithInput = (b.match_type === EXACT_PREFIX_MATCH);\n\t\t\t\tif (aStartsWithInput && bStartsWithInput)\n\t\t\t\t\treturn locale.compare(aStr, bStr);\n\t\t\t\telse if (aStartsWithInput) return -1;\n\t\t\t\telse if (bStartsWithInput) return 1;\n\n\t\t\t\t// Else prefer case-insensitive prefix matches\n\t\t\t\tconst aStartsWithInputCI = (a.match_type === CASE_INSENSITIVE_PREFIX_MATCH);\n\t\t\t\tconst bStartsWithInputCI = (b.match_type === CASE_INSENSITIVE_PREFIX_MATCH);\n\t\t\t\tif (aStartsWithInputCI && bStartsWithInputCI)\n\t\t\t\t\treturn localeCaseInsensitive.compare(aStr, bStr);\n\t\t\t\telse if (aStartsWithInputCI) return -1;\n\t\t\t\telse if (bStartsWithInputCI) return 1;\n\n\t\t\t\t// Else alphabetize\n\t\t\t\treturn locale.compare(aStr, bStr);\n\t\t\t}\n\n\t\t\t// Keep unsorted order for non-favorite items if prefix matching is not enabled.\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\n\tbuildTwitchCache(emotes) {\n\t\tif ( ! Array.isArray(emotes) )\n\t\t\treturn {emotes: [], length: 0};\n\n\t\tconst out = [],\n\t\t\tseen = new Set,\n\t\t\tanim = this.chat.context.get('chat.emotes.animated') > 0,\n\t\t\thidden_sets = this.settings.provider.get('emote-menu.hidden-sets'),\n\t\t\thas_hidden = Array.isArray(hidden_sets) && hidden_sets.length > 0,\n\t\t\thidden_emotes = this.emotes.getHidden('twitch'),\n\t\t\tfavorites = this.emotes.getFavorites('twitch');\n\n\t\tfor(const set of emotes) {\n\t\t\tconst int_id = parseInt(set.id, 10),\n\t\t\t\towner = set.owner,\n\t\t\t\tis_points = TWITCH_POINTS_SETS.includes(int_id) || owner?.login === 'channel_points',\n\t\t\t\tchannel = is_points ? null : owner;\n\n\t\t\t// Skip this set.\n\t\t\tif ( set.id === 'FrankerFaceZWasHere' )\n\t\t\t\tcontinue;\n\n\t\t\tlet key = `twitch-set-${set.id}`;\n\t\t\tlet extra = null;\n\n\t\t\tif ( channel?.login ) {\n\t\t\t\tkey = `twitch-${channel.id}`;\n\t\t\t\textra = channel.displayName || channel.login;\n\n\t\t\t} else if ( is_points )\n\t\t\t\tkey = 'twitch-points';\n\t\t\telse if ( TWITCH_GLOBAL_SETS.includes(int_id) )\n\t\t\t\tkey = 'twitch-global';\n\t\t\telse if ( TWITCH_PRIME_SETS.includes(int_id) )\n\t\t\t\tkey = 'twitch-prime';\n\t\t\telse\n\t\t\t\tkey = 'twitch-misc';\n\n\t\t\tif ( has_hidden && hidden_sets.includes(key) )\n\t\t\t\tcontinue;\n\n\t\t\tfor(const emote of set.emotes) {\n\t\t\t\tif ( ! emote || ! emote.id || hidden_emotes.includes(emote.id) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst id = emote.id,\n\t\t\t\t\ttoken = KNOWN_CODES[emote.token] || emote.token;\n\n\t\t\t\tif ( ! token || seen.has(token) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tseen.add(token);\n\n\t\t\t\tconst replacement = REPLACEMENTS[id];\n\t\t\t\tlet srcSet;\n\n\t\t\t\tif ( replacement && this.chat.context.get('chat.fix-bad-emotes') ) {\n\t\t\t\t\tsrcSet = `${REPLACEMENT_BASE}${replacement} 1x`;\n\t\t\t\t} else\n\t\t\t\t\tsrcSet = getTwitchEmoteSrcSet(id, anim);\n\n\t\t\t\tout.push({\n\t\t\t\t\tid,\n\t\t\t\t\tsource: key,\n\t\t\t\t\textra,\n\t\t\t\t\tsetID: set.id,\n\t\t\t\t\ttoken,\n\t\t\t\t\ttokenLower: token.toLowerCase(),\n\t\t\t\t\tsrcSet,\n\t\t\t\t\tfavorite: favorites.includes(id)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\temotes: out,\n\t\t\tlength: emotes.length\n\t\t}\n\t}\n\n\n\tgetTwitchEmoteSuggestions(input, inst) {\n\t\tif ( inst.ffz_twitch_cache?.length !== inst.props.emotes?.length )\n\t\t\tinst.ffz_twitch_cache = this.buildTwitchCache(inst.props.emotes);\n\n\t\tconst emoteMatchingType = this.chat.context.get('chat.tab-complete.matching');\n\n\t\tconst emotes = inst.ffz_twitch_cache.emotes;\n\n\t\tif ( ! emotes.length )\n\t\t\treturn [];\n\n\t\tconst results_usage = [],\n\t\t\tresults_starting = [],\n\t\t\tresults_other = [],\n\n\t\t\tsearch = input.startsWith(':') ? input.slice(1) : input;\n\n\t\tfor(const emote of emotes) {\n\t\t\tconst match_type = inst.doesEmoteMatchTerm(emote, search);\n\t\t\tif (match_type < emoteMatchingType)\n\t\t\t\t\tcontinue;\n\n\t\t\tconst element = {\n\t\t\t\tcurrent: input,\n\t\t\t\temote,\n\t\t\t\treplacement: emote.token,\n\t\t\t\telement: inst.renderEmoteSuggestion(emote),\n\t\t\t\tfavorite: emote.favorite,\n\t\t\t\tcount: this.EmoteUsageCount[emote.token] || 0,\n\t\t\t\tmatch_type\n\t\t\t};\n\n\t\t\tif (match_type < emoteMatchingType)\n\t\t\t\tcontinue;\n\n\t\t\tif ( element.count > 0 )\n\t\t\t\tresults_usage.push(element);\n\t\t\telse if ( match_type > NON_PREFIX_MATCH )\n\t\t\t\tresults_starting.push(element);\n\t\t\telse\n\t\t\t\tresults_other.push(element);\n\t\t}\n\n\t\tresults_usage.sort((a,b) => b.count - a.count);\n\t\tresults_starting.sort((a,b) => locale.compare(a.replacement, b.replacement));\n\t\tresults_other.sort((a,b) => locale.compare(a.replacement, b.replacement));\n\n\t\treturn results_usage.concat(results_starting).concat(results_other);\n\t}\n\n\n\tgetEmojiSuggestions(input, inst) {\n\t\tif (!input.startsWith(':')) {\n\t\t\treturn [];\n\t\t}\n\n\t\tlet search = input.slice(1).toLowerCase();\n\t\tconst style = this.chat.context.get('chat.emoji.style'),\n\t\t\ttone = this.settings.provider.get('emoji-tone', null),\n\t\t\tfavorites = this.emotes.getFavorites('emoji'),\n\t\t\tresults = [],\n\t\t\thas_colon = search.endsWith(':');\n\n\t\tif ( has_colon )\n\t\t\tsearch = search.slice(0,-1);\n\n\t\tconst included = new Set;\n\n\t\tfor(const name in this.emoji.names)\n\t\t\tif ( has_colon ? name === search : name.startsWith(search) ) {\n\t\t\t\tconst emoji = this.emoji.emoji[this.emoji.names[name]],\n\t\t\t\t\ttoned = emoji.variants && emoji.variants[tone],\n\t\t\t\t\tsource = toned || emoji;\n\n\t\t\t\tif ( emoji && (style === 0 || source.has[style]) && ! included.has(source.raw) ) {\n\t\t\t\t\tincluded.add(source.raw);\n\n\t\t\t\t\tconst srcSet = this.emoji.getFullImageSet(source.image, style);\n\t\t\t\t\tconst matched = `:${name}:`;\n\n\t\t\t\t\tconst favorite = favorites.includes(emoji.code);\n\t\t\t\t\tresults.push({\n\t\t\t\t\t\tcurrent: input,\n\t\t\t\t\t\temoji: source,\n\t\t\t\t\t\tmatched,\n\t\t\t\t\t\tsrcSet,\n\t\t\t\t\t\treplacement: source.raw,\n\t\t\t\t\t\telement: inst.renderFFZEmojiSuggestion({\n\t\t\t\t\t\t\ttoken: matched,\n\t\t\t\t\t\t\tid: `emoji-${emoji.code}`,\n\t\t\t\t\t\t\tsrc: this.emoji.getFullImage(source.image, style),\n\t\t\t\t\t\t\tsrcSet,\n\t\t\t\t\t\t\tfavorite\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tfavorite\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\treturn results;\n\t}\n\n\n\tbuildFFZCache(user_id, user_login, channel_id, channel_login) {\n\t\tconst sets = this.emotes.getSets(user_id, user_login, channel_id, channel_login);\n\t\tif ( ! sets || ! sets.length )\n\t\t\treturn {emotes: [], length: 0, user_id, user_login, channel_id, channel_login};\n\n\t\tconst out = [],\n\t\t\tanim = this.chat.context.get('chat.emotes.animated') > 0,\n\t\t\thidden_sets = this.settings.provider.get('emote-menu.hidden-sets'),\n\t\t\thas_hidden = Array.isArray(hidden_sets) && hidden_sets.length > 0,\n\t\t\tadded_emotes = new Set;\n\n\t\tfor(const set of sets) {\n\t\t\tif ( ! set || ! set.emotes )\n\t\t\t\tcontinue;\n\n\t\t\tconst source = set.source || 'ffz',\n\t\t\t\tsource_line = set.source_line || (`${set.source || 'FFZ'} ${set.title || 'Global'}`),\n\t\t\t\tkey = `${set.merge_source || source}-${set.merge_id || set.id}`;\n\n\t\t\tif ( has_hidden && hidden_sets.includes(key) )\n\t\t\t\tcontinue;\n\n\t\t\tconst hidden_emotes = this.emotes.getHidden(source),\n\t\t\t\tfavorites = this.emotes.getFavorites(source);\n\n\t\t\tfor(const emote of Object.values(set.emotes)) {\n\t\t\t\tif ( ! emote || ! emote.id || emote.hidden || hidden_emotes.includes(emote.id) || added_emotes.has(emote.name) )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( ! emote.name )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tadded_emotes.add(emote.name);\n\n\t\t\t\tout.push({\n\t\t\t\t\tid: `${source}-${emote.id}`,\n\t\t\t\t\tsource,\n\t\t\t\t\textra: source_line,\n\t\t\t\t\ttoken: emote.name,\n\t\t\t\t\ttokenLower: emote.name.toLowerCase(),\n\t\t\t\t\tsrcSet: anim && emote.animSrcSet || emote.srcSet,\n\t\t\t\t\tfavorite: favorites.includes(emote.id)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\temotes: out,\n\t\t\tlength: sets.length\n\t\t}\n\t}\n\n\n\tgetEmoteSuggestions(input, inst) {\n\t\tif ( ! inst._ffz_channel_login ) {\n\t\t\tconst parent = this.fine.searchParent(inst, 'chat-input', 50);\n\t\t\tif ( parent )\n\t\t\t\tthis.updateEmoteCompletion(parent, inst);\n\t\t}\n\n\t\tconst emoteMatchingType = this.chat.context.get('chat.tab-complete.matching');\n\n\t\tconst user = inst._ffz_user,\n\t\t\tchannel_id = inst._ffz_channel_id,\n\t\t\tchannel_login = inst._ffz_channel_login;\n\n\t\tif ( ! channel_login )\n\t\t\treturn [];\n\n\t\tlet cache = inst.ffz_ffz_cache;\n\t\tif ( ! cache || cache.user_id !== user?.id || cache.user_login !== user?.login || cache.channel_id !== channel_id || cache.channel_login !== channel_login )\n\t\t\tcache = inst.ffz_ffz_cache = this.buildFFZCache(user?.id, user?.login, channel_id, channel_login);\n\n\t\tconst emotes = cache.emotes;\n\t\tif ( ! emotes.length )\n\t\t\treturn [];\n\n\t\tconst search = input.startsWith(':') ? input.slice(1) : input,\n\t\t\tresults = [];\n\n\t\tfor(const emote of emotes) {\n\t\t\tconst match_type = inst.doesEmoteMatchTerm(emote, search)\n\t\t\tif (match_type < emoteMatchingType)\n\t\t\t\tcontinue;\n\n\t\t\tresults.push({\n\t\t\t\tcurrent: input,\n\t\t\t\temote,\n\t\t\t\treplacement: emote.token,\n\t\t\t\telement: inst.renderEmoteSuggestion(emote),\n\t\t\t\tfavorite: emote.favorite,\n\t\t\t\tcount: 0, // TODO: Count stuff?\n\t\t\t\tmatch_type\n\t\t\t});\n\t\t}\n\n\t\treturn results;\n\n\t\t/*for(const set of sets) {\n\t\t\tif ( ! set || ! set.emotes )\n\t\t\t\tcontinue;\n\n\t\t\tconst\n\n\t\t\tif ( set && set.emotes )\n\t\t\t\tfor(const emote of Object.values(set.emotes))\n\t\t\t\t\tif ( inst.doesEmoteMatchTerm(emote, search) && !added_emotes.has(emote.name) && ! this.emotes.isHidden(set.source || 'ffz', emote.id) ) {\n\t\t\t\t\t\tconst favorite = this.emotes.isFavorite(set.source || 'ffz', emote.id);\n\t\t\t\t\t\tresults.push({\n\t\t\t\t\t\t\tcurrent: input,\n\t\t\t\t\t\t\treplacement: emote.name,\n\t\t\t\t\t\t\telement: inst.renderEmoteSuggestion({\n\t\t\t\t\t\t\t\ttoken: emote.name,\n\t\t\t\t\t\t\t\tid: `${set.source}-${emote.id}`,\n\t\t\t\t\t\t\t\tsrcSet: emote.srcSet,\n\t\t\t\t\t\t\t\tfavorite\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tfavorite\n\t\t\t\t\t\t});\n\t\t\t\t\t\tadded_emotes.add(emote.name);\n\t\t\t\t\t}\n\t\t}\n\n\t\treturn results;*/\n\t}\n\n\tgetInput() {\n\t\tfor(const inst of this.ChatInput.instances) {\n\t\t\tif ( ! inst.autocompleteInputRef || ! inst.state )\n\t\t\t\tcontinue;\n\n\t\t\tif ( inst.state.value )\n\t\t\t\treturn inst.state.value;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpasteMessage(room, message) {\n\t\tfor(const inst of this.ChatInput.instances) {\n\t\t\tif ( inst?.props?.channelLogin !== room )\n\t\t\t\tcontinue;\n\n\t\t\tif ( ! inst.autocompleteInputRef || ! inst.state )\n\t\t\t\treturn;\n\n\t\t\tif ( inst.state.value )\n\t\t\t\tmessage = `${inst.state.value} ${message}`;\n\n\t\t\tinst.autocompleteInputRef.setValue(message);\n\t\t\tinst.autocompleteInputRef.componentRef?.focus?.();\n\t\t}\n\t}\n}\n","'use strict';\n\nimport Module from 'utilities/module';\n\n// ============================================================================\n// Vanilla Viewer Cards\n// ============================================================================\n\nexport default class ViewerCards extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('chat');\n\t\tthis.inject('settings');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.fine');\n\n\t\tthis.last_login = null;\n\n\t\tthis.settings.add('chat.viewer-cards.highlight-chat', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Viewer Cards >> Appearance',\n\t\t\t\ttitle: 'Highlight messages from users with open viewer cards.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.viewer-cards.color', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Viewer Cards >> Appearance',\n\t\t\t\ttitle: 'Highlight Color',\n\t\t\t\tcomponent: 'setting-color-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.viewer-cards.use-color', {\n\t\t\trequires: ['chat.viewer-cards.highlight-chat', 'chat.viewer-cards.color'],\n\t\t\tprocess(ctx) {\n\t\t\t\tif ( ctx.get('chat.viewer-cards.highlight-chat') )\n\t\t\t\t\treturn ctx.get('chat.viewer-cards.color');\n\t\t\t}\n\t\t})\n\n\t\tthis.ViewerCard = this.fine.define(\n\t\t\t'chat-viewer-card',\n\t\t\tn => n.props?.targetLogin && n.props?.hideViewerCard\n\t\t);\n\t}\n\n\tonEnable() {\n\t\tthis.chat.context.on('changed:chat.viewer-cards.highlight-chat', this.refreshStyle, this);\n\t\tthis.chat.context.on('changed:chat.viewer-cards.color', this.refreshStyle, this);\n\t\tthis.on('..:update-colors', this.refreshStyle, this);\n\n\t\tthis.ViewerCard.on('mount', this.updateCard, this);\n\t\tthis.ViewerCard.on('update', this.updateCard, this);\n\t\tthis.ViewerCard.on('unmount', this.unmountCard, this);\n\t}\n\n\trefreshStyle() {\n\t\tthis.updateStyle(this.last_login);\n\t}\n\n\tupdateStyle(login) {\n\t\t// Make sure we're dealing with lower-case logins.\n\t\tif ( typeof login === 'string' )\n\t\t\tlogin = login.toLowerCase();\n\n\t\tthis.last_login = login;\n\t\tif ( login && this.chat.context.get('chat.viewer-cards.highlight-chat') ) {\n\t\t\tlet color = this.chat.context.get('chat.viewer-cards.color');\n\t\t\tif ( color && color.length )\n\t\t\t\tcolor = this.parent.inverse_colors.process(color);\n\t\t\telse if ( this.chat.context.get('theme.is-dark') )\n\t\t\t\tcolor = 'rgba(0,80,255,0.2)';\n\t\t\telse\n\t\t\t\tcolor = 'rgba(128,170,255,0.2)';\n\n\t\t\tthis.css_tweaks.set('viewer-card-highlight', `\nbody .chat-room .chat-scrollable-area__message-container > div:nth-child(1n+0) > .chat-line__message:not(.chat-line--inline):not(.something-nonexistent)[data-user=\"${login}\"],\nbody .chat-room .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user=\"${login}\"] {\n\tbackground-color: ${color} !important;\n}`);\n\t\t} else\n\t\t\tthis.css_tweaks.delete('viewer-card-highlight');\n\t}\n\n\tupdateCard(inst) {\n\t\tthis.updateStyle(inst.props && inst.props.targetLogin);\n\t}\n\n\tunmountCard() {\n\t\tthis.updateStyle();\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Chat Hooks\n// ============================================================================\n\nimport {Color, ColorAdjuster} from 'utilities/color';\nimport {get, has, make_enum, shallow_object_equals, set_equals, deep_equals, glob_to_regex, escape_regex, generateUUID} from 'utilities/object';\nimport {WEBKIT_CSS as WEBKIT} from 'utilities/constants';\n\nimport {useFont} from 'utilities/fonts';\nimport awaitMD, { getMD } from 'utilities/markdown';\nimport Module from 'utilities/module';\n\nimport Twilight from 'site';\n\nimport Scroller from './scroller';\nimport ChatLine from './line';\nimport SettingsMenu from './settings_menu';\nimport EmoteMenu from './emote_menu';\nimport Input from './input';\nimport ViewerCards from './viewer_card';\nimport { isHighlightedReward, isMessageEffect } from './points';\n\n\n/*const REGEX_EMOTES = {\n\t'B-?\\\\)': ['B)', 'B-)'],\n\t'R-?\\\\)': ['R)', 'R-)'],\n\t'[oO](_|\\\\.)[oO]': ['o_o', 'O_o', 'o_O', 'O_O', 'o.o', 'O.o', 'o.O', 'O.O'],\n\t'\\\\&gt\\\\;\\\\(': ['>('],\n\t'\\\\&lt\\\\;3': ['<3'],\n\t'\\\\:-?(o|O)': [':o', ':O', ':-o', ':-O'],\n\t'\\\\:-?(p|P)': [':p', ':P', ':-p', ':-P'],\n\t'\\\\:-?D': [':D', ':-D'],\n\t'\\\\:-?[\\\\\\\\/]': [':/', ':-/', ':\\\\', ':-\\\\'],\n\t'\\\\:-?[z|Z|\\\\|]': [':z', ':Z', ':|', ':-z', ':-Z', ':-|'],\n\t'\\\\:-?\\\\(': [':(', ':-('],\n\t'\\\\:-?\\\\)': [':)', ':-)'],\n\t'\\\\;-?(p|P)': [';p', ';P', ';-p', ';-P'],\n\t'\\\\;-?\\\\)': [';)', ';-)'],\n\t'#-?[\\\\\\\\/]': ['#/', '#-/', '#//', '#-//'],\n\t':-?(?:7|L)': [':7', ':L', ':-7', ':-L'],\n\t'\\\\&lt\\\\;\\\\]': ['<]'],\n\t'\\\\:-?(S|s)': [':s', ':S', ':-s', ':-S'],\n\t'\\\\:\\\\&gt\\\\;': [':>']\n};*/\n\n\nconst MESSAGE_TYPES = make_enum(\n\t'Post',\n\t'Action'\n);\n\nconst MOD_TYPES = make_enum(\n\t'Ban',\n\t'Timeout',\n\t'Delete'\n);\n\nconst AUTOMOD_TYPES = make_enum(\n\t'MessageRejectedPrompt',\n\t'CheerMessageRejectedPrompt',\n\t'MessageRejected',\n\t'MessageAllowed',\n\t'MessageDenied',\n\t'CheerMessageDenied',\n\t'CheerMessageTimeout',\n\t'MessageModApproved',\n\t'MessageModDenied'\n);\n\nconst UNBLOCKABLE_TYPES = [\n\t'Message',\n\t'Notice',\n\t'Moderation',\n\t'ModerationAction',\n\t'TargetedModerationAction',\n\t'AutoMod',\n\t'SubscriberOnlyMode',\n\t'FollowerOnlyMode',\n\t'SlowMode',\n\t'EmoteOnlyMode',\n\t'R9KMode',\n\t'Connected',\n\t'Disconnected',\n\t'Reconnect',\n\t'RoomMods',\n\t'RoomState',\n\t'BadgesUpdated'\n]\n\nconst CHAT_TYPES = make_enum(\n\t'Message',\n\t'ExtensionMessage',\n\t'Moderation',\n\t'ModerationAction',\n\t'TargetedModerationAction',\n\t'AutoMod',\n\t'SubscriberOnlyMode',\n\t'FollowerOnlyMode',\n\t'SlowMode',\n\t'EmoteOnlyMode',\n\t'R9KMode',\n\t'Connected',\n\t'Disconnected',\n\t'Reconnect',\n\t'Subscription',\n\t'Resubscription',\n\t'GiftPaidUpgrade',\n\t'AnonGiftPaidUpgrade',\n\t'PrimePaidUpgrade',\n\t'PrimeCommunityGiftReceivedEvent',\n\t'ExtendSubscription',\n\t'SubGift',\n\t'AnonSubGift',\n\t'Clear',\n\t'RoomMods',\n\t'RoomState',\n\t'Raid',\n\t'Unraid',\n\t'Notice',\n\t'Info',\n\t'BadgesUpdated',\n\t'Purchase',\n\t'BitsCharity',\n\t'CrateGift',\n\t'RewardGift',\n\t'SubMysteryGift',\n\t'AnonSubMysteryGift',\n\t'StandardPayForward',\n\t'CommunityPayForward',\n\t'FirstCheerMessage',\n\t'FirstMessageHighlight',\n\t'BitsBadgeTierMessage',\n\t'InlinePrivateCallout',\n\t'ChannelPointsReward',\n\t'CommunityChallengeContribution',\n\t'LiveMessageSeparator',\n\t'RestrictedLowTrustUserMessage',\n\t'CommunityIntroduction',\n\t'Shoutout',\n\t'AnnouncementMessage',\n\t'CharityDonation',\n\t'MessageIdUpdate',\n\t'ViewerMilestone',\n\t'GigantifiedEmote'\n);\n\n\nconst NULL_TYPES = [\n\t'Reconnect',\n\t'RoomState',\n\t'BadgesUpdated',\n\t'Clear'\n];\n\n\nconst INLINE_CALLOUT_TYPES = {\n\t'pinned_re_sub': 'share-resub',\n\t'community_points_reward': 'community-points-rewards',\n\t'clip_live_nudge_chat_trigger': 'clip-live-nudge',\n\t'cheer_badge_grant': 'bits-badge-tier'\n};\n\nconst CALLOUT_TYPES = {\n\t\"AppointedModerator\": \"appointed-moderator\",\n\t\"BitsBadgeTier\": \"bits-badge-tier\",\n\t\"BitsPowerUps\": \"bits-power-ups\",\n\t\"ClipLiveNudge\": \"clip-live-nudge\",\n\t\"CommunityMoment\": \"community-moment\",\n\t\"CommunityPointsRewards\": \"community-points-rewards\",\n\t\"CosmicAbyss\": \"cosmic-abyss\",\n\t\"CreatorAnniversaries\": \"creator-anniversaries\",\n\t\"Drop\": \"drop\",\n\t\"EarnedSubBadge\": \"earned-sub-badge\",\n\t\"FavoritedGuestCollab\": \"favorited-guest-collab\",\n\t\"GiftBadgeExpiration\": \"gift-badge-expiration\",\n\t\"GiftBadgeRestored\": \"gift-badge-restored\",\n\t\"GiftBundleUpSell\": \"gift-bundle-up-sell\",\n\t\"HypeTrainRewards\": \"hype-train-rewards\",\n\t\"LapsedBitsUser\": \"lapsed-bits-user\",\n\t\"PartnerPlusUpSellNudge\": \"partner-plus-up-sell-nudge\",\n\t\"ReplyByKeyboard\": \"reply-by-keyboard\",\n\t\"RequestToJoinAccepted\": \"request-to-join-accepted\",\n\t\"STPromo\": \"st-promo\",\n\t\"ShareResub\": \"share-resub\",\n\t\"SubtemberPromoBits\": \"subtember-promo-bits\",\n\t\"ThankSubGifter\": \"thank-sub-gifter\",\n\t\"TurnOffAnimatedEmotes\": \"turn-off-animated-emotes\",\n\t\"WalletDrop\": \"wallet-drop\"\n};\n\nconst UNBLOCKABLE_CALLOUTS = [];\n\n\nconst MISBEHAVING_EVENTS = [\n\t'onBadgesUpdatedEvent',\n];\n\n\nexport default class ChatHook extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.shared_room_data = new Map;\n\t\tthis.shared_rooms = {};\n\n\t\tthis.colors = new ColorAdjuster;\n\t\tthis.inverse_colors = new ColorAdjuster;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('experiments');\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.router');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.web_munch');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.subpump');\n\t\t//this.inject('site.loadable');\n\n\t\tthis.inject('chat');\n\n\t\tthis.inject(Scroller);\n\t\tthis.inject(ChatLine);\n\t\tthis.inject(SettingsMenu);\n\t\tthis.inject(EmoteMenu);\n\t\tthis.inject(Input);\n\t\tthis.inject(ViewerCards);\n\n\t\tthis.ChatLeaderboard = this.fine.define(\n\t\t\t'chat-leaderboard',\n\t\t\tn => n.props?.topItems && has(n.props, 'forceMiniView') && has(n.props, 'leaderboardType'),\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatService = this.fine.define(\n\t\t\t'chat-service',\n\t\t\tn => n.join && n.client && n.props.setChatConnectionAPI,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatBuffer = this.fine.define(\n\t\t\t'chat-buffer',\n\t\t\tn => n.updateHandlers && n.delayedMessageBuffer && n.handleMessage,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatController = this.fine.define(\n\t\t\t'chat-controller',\n\t\t\tn => n.parseOutgoingMessage && n.onRoomStateUpdated && n.renderNotifications,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatRenderer = this.fine.define(\n\t\t\t'chat-renderer',\n\t\t\tn => n.mapMessagesToChatLines && n.reportChatRenderSent,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatContainer = this.fine.define(\n\t\t\t'chat-container',\n\t\t\tn => n.closeViewersList && n.onChatInputFocus,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatBufferConnector = this.fine.define(\n\t\t\t'chat-buffer-connector',\n\t\t\tn => n.clearBufferHandle && n.syncBufferedMessages,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.ChatRewardEventHandler = this.fine.define(\n\t\t\t'chat-reward-event-handler',\n\t\t\tn => n.unsubscribe && n.handleMessage && n.props?.messageHandlerAPI && n.props?.rewardMap,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.joined_raids = new Set;\n\n\t\tthis.RaidController = this.fine.define(\n\t\t\t'raid-controller',\n\t\t\tn => n.handleLeaveRaid && n.handleJoinRaid,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.InlineCallout = this.fine.define(\n\t\t\t'inline-callout',\n\t\t\tn => n.showCTA && n.toggleContextMenu && n.actionClick,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.PinnedCallout = this.fine.define(\n\t\t\t'pinned-callout',\n\t\t\tn => n.getCalloutTitle && n.buildCalloutProps && n.pin,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.CalloutSelector = this.fine.define(\n\t\t\t'callout-selector',\n\t\t\tn => n.selectCalloutComponent && n.props && has(n.props, 'callouts'),\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.PointsButton = this.fine.define(\n\t\t\t'points-button',\n\t\t\tn => n.renderIcon && n.renderFlame && n.handleIconAnimationComplete,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.PointsClaimButton = this.fine.define(\n\t\t\t'points-claim-button',\n\t\t\tn => n.getClaim && n.onClick && n.props && n.props.claimCommunityPoints,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.CommunityChestBanner = this.fine.define(\n\t\t\t'community-chest-banner',\n\t\t\tn => n.getLastGifterText && n.getBannerText && has(n, 'finalCount'),\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.PointsInfo = this.fine.define(\n\t\t\t'points-info',\n\t\t\tn => n.pointIcon !== undefined && n.pointName !== undefined,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\tthis.GiftBanner = this.fine.define(\n\t\t\t'gift-banner',\n\t\t\tn => n.getBannerText && n.onGiftMoreClick,\n\t\t\tTwilight.CHAT_ROUTES\n\t\t);\n\n\t\t// Settings\n\n\t\tthis.settings.add('chat.subs.native', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Subscriptions',\n\t\t\t\ttitle: 'Display subscription notices using Twitch\\'s native UI.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.show-reasons', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Appearance',\n\t\t\t\ttitle: 'Display Reasons',\n\t\t\t\tdescription: 'If this is enabled, the reasons a given message was highlighted will be displayed alongside the message. This is a simple display. Enable the debugging option below in Behavior for more details, but be aware that the debugging option has a slight performance impact compared to this.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: false, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Above Message'},\n\t\t\t\t\t{value: 2, title: 'Inline'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.disable-handling', {\n\t\t\tdefault: null,\n\t\t\trequires: ['context.disable-chat-processing'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val != null )\n\t\t\t\t\treturn ! val;\n\t\t\t\tif ( ctx.get('context.disable-chat-processing') )\n\t\t\t\t\treturn true;\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Chat >> Processing',\n\t\t\t\ttitle: 'Enable processing of chat messages.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tforce_seen: true\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.addUI('debug.chat-test', {\n\t\t\tpath: 'Debugging > Chat >> Chat',\n\t\t\tcomponent: 'chat-tester',\n\t\t\tgetChat: () => this,\n\t\t\tforce_seen: true\n\t\t});\n\n\t\tthis.settings.add('chat.filtering.blocked-callouts', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tprocess: (ctx, val) => {\n\t\t\t\tconst out = new Set,\n\t\t\t\t\ttype_map = this.callout_types ?? CALLOUT_TYPES;\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tif ( v?.v && type_map[v.v] && ! UNBLOCKABLE_CALLOUTS.includes(v.v) )\n\t\t\t\t\t\tout.add(type_map[v.v]);\n\n\t\t\t\treturn out;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Block >> Callout Types @{\"description\":\"This filter allows you to remove callouts of specific types from Twitch chat. Callouts are special messages that can be pinned to the bottom of chat and often have associated actions, like claiming a drop or sharing your resubscription.\"}',\n\t\t\t\tcomponent: 'blocked-types',\n\t\t\t\tgetExtraTerms: () => Object.keys(this.callout_types).filter(key => ! UNBLOCKABLE_CALLOUTS.includes(key)),\n\t\t\t\tdata: () => Object\n\t\t\t\t\t.keys(this.callout_types)\n\t\t\t\t\t.filter(key => ! UNBLOCKABLE_CALLOUTS.includes(key))\n\t\t\t\t\t.sort()\n\t\t\t}\n\t\t})\n\n\t\tthis.settings.add('chat.filtering.blocked-types', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tconst out = new Set;\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tif ( v?.v && ! UNBLOCKABLE_TYPES.includes(v.v) )\n\t\t\t\t\t\tout.add(v.v);\n\n\t\t\t\treturn out;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > Block >> Message Types @{\"description\":\"This filter allows you to remove all messages of a certain type from Twitch chat. It can be used to filter system messages, such as Hosts or Raids. Some types, such as moderation actions, cannot be blocked to prevent chat functionality from breaking.\"}',\n\t\t\t\tcomponent: 'blocked-types',\n\t\t\t\tgetExtraTerms: () => Object.keys(this.chat_types).filter(key => ! UNBLOCKABLE_TYPES.includes(key) && ! /^\\d+$/.test(key)),\n\t\t\t\tdata: () => Object\n\t\t\t\t\t.keys(this.chat_types)\n\t\t\t\t\t.filter(key => ! UNBLOCKABLE_TYPES.includes(key) && ! /^\\d+$/.test(key))\n\t\t\t\t\t.sort()\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.replies.style', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Replies',\n\t\t\t\ttitle: 'Style',\n\t\t\t\tdescription: `Twitch's default style adds a floating button to the right and displays a notice above messages that are replies. FrankerFaceZ uses an In-Line Chat Action (that can be removed in [Chat > Actions > In-Line](~chat.actions.in_line)) and uses an in-line mention to denote replies.`,\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Twitch (Default)'},\n\t\t\t\t\t{value: 2, title: 'FrankerFaceZ'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('channel.raids.no-autojoin', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> Raids',\n\t\t\t\ttitle: 'Do not automatically join raids.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.powerup.effects', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow \"Message Effects\" messages to appear in chat.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: '*Note*: Only affects messages sent after you change this setting. You can use your own chat for testing.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('channel.raids.blocked-channels', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Behavior >> Raids: Blocked Channels @{\"description\": \"You will not automatically join raids to channels listed here.\"}',\n\t\t\t\tcomponent: 'basic-terms',\n\t\t\t\twords: false\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:channel.raids.blocked-channels', {\n\t\t\trequires: ['channel.raids.blocked-channels'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('channel.raids.blocked-channels');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = [];\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst t = item.t;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tout.push(v);\n\t\t\t\t}\n\n\t\t\t\tif ( out.length )\n\t\t\t\t\treturn new RegExp(`^(?:${out.join('|')})$`, 'gi');\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t})\n\n\t\tthis.settings.add('chat.hide-community-highlights', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Hide all Community Highlights from the top of chat.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: 'Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.subs.gift-banner', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Display a banner at the top of chat when a mass gift sub happens.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.last-events', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow the Support Activity Feed to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.charity', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow the charity fundraiser progress to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.hide-appleplus', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Hide the drop notification for getting AppleTV+ when you buy a subscription.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: '**Note:** Normally, I wouldn\\'t add something that directly affects an advertisement like this, but Twitch broke the \"Don\\'t show again\" checkbox, so it\\'s up to us to fix it.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.hype-train', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow the Hype Train to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t}\n\t\t});\n\n\t\t/*this.settings.add('chat.banners.kappa-train', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Attempt to always display the Golden Kappa Train, even if other Hype Trains are hidden.',\n\t\t\t\tdescription: '**Note**: This setting is currently theoretical and may not work, or may cause non-Kappa hype trains to appear. Due to the infrequent nature of hype trains, and especially the golden kappa hype train, it is very hard to test.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});*/\n\n\t\tthis.settings.add('chat.banners.shared-chat', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Shared Chat >> Behavior',\n\t\t\t\ttitle: 'Allow the Shared Chat notice to be displayed in chat when a Shared Chat is enabled.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.pinned-message', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow Pinned Messages to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.drops', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Drops >> Appearance',\n\t\t\t\ttitle: 'Allow messages about Drops to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.polls', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow Polls to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.banners.prediction', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow Predictions to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.callouts.clip', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Allow the \\\"Chat seems active.\\\" clip suggestion to be displayed in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.community-chest.show', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Display the Community Gift Chest banner.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.points.allow-highlight', {\n\t\t\tdefault: 2,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Channel Points >> Appearance',\n\t\t\t\ttitle: 'Highlight the message in chat when someone redeems Highlight My Message.',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Twitch Style'},\n\t\t\t\t\t{value: 2, title: 'FFZ Style'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.points.show-callouts', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Channel Points >> General',\n\t\t\t\ttitle: 'Display messages in chat about Channel Points rewards.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.points.show-button', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Channel Points >> General',\n\t\t\t\ttitle: 'Display Channel Points button beneath chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.points.show-rewards', {\n\t\t\tdefault: true,\n\t\t\trequires: ['layout.portrait-min-chat'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( ctx.get('layout.portrait-min-chat') )\n\t\t\t\t\treturn false;\n\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Channel Points >> Behavior',\n\t\t\t\ttitle: 'Allow available rewards to appear next to the Channel Points button.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.points.auto-rewards', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Channel Points >> Behavior',\n\t\t\t\ttitle: 'Automatically claim bonus rewards.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tforce_seen: true\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.drops.auto-rewards', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Drops >> Behavior',\n\t\t\t\ttitle: 'Automatically claim drops.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.pin-resubs', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Automatically pin re-subscription messages in chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.shared-chat.style', {\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Shared Chat >> Appearance',\n\t\t\t\ttitle: 'Pill Style',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdescription: 'This controls the appearance of the pill at the left-side of chat messages when a message is part of a Shared Chat. By default, this is Avatar for moderators and broadcasters and Hidden for everyone else.',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: null, title: 'Automatic'},\n\t\t\t\t\t{value: 0, title: 'Hidden'},\n\t\t\t\t\t{value: 1, title: 'Channel Name'},\n\t\t\t\t\t{value: 2, title: 'Avatar'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.shared-chat.username-tooltip', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Shared Chat >> Appearance',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\ttitle: 'Display the source channel of a chat message when hovering over the poster\\'s username.',\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.width', {\n\t\t\tdefault: null,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> General @{\"sort\": -1}',\n\t\t\t\ttitle: 'Width',\n\t\t\t\tdescription: \"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.\",\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess(val) {\n\t\t\t\t\tval = parseInt(val, 10);\n\t\t\t\t\tif ( isNaN(val) || ! isFinite(val) || val <= 0 )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn val;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.effective-width', {\n\t\t\trequires: ['chat.width', 'context.ui.rightColumnWidth'],\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('chat.width');\n\t\t\t\treturn val == null ? (ctx.get('context.ui.rightColumnWidth') || 340) : val;\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.use-width', {\n\t\t\trequires: ['chat.width', 'context.ui.rightColumnExpanded', 'context.isWatchParty'],\n\t\t\tprocess(ctx) {\n\t\t\t\tif ( ! ctx.get('context.ui.rightColumnExpanded') || ctx.get('context.isWatchParty') )\n\t\t\t\t\treturn false;\n\n\t\t\t\treturn ctx.get('chat.width') != null;\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.bits.show-pinned', {\n\t\t\trequires: ['chat.bits.show'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val != null )\n\t\t\t\t\treturn val;\n\n\t\t\t\treturn ctx.get('chat.bits.show')\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Community',\n\t\t\t\ttitle: 'Display Leaderboard',\n\t\t\t\tdescription: 'The leaderboard shows the top cheerers and sub gifters in a channel.\\n\\nBy default due to a previous implementation, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering).',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.bits.show-rewards', {\n\t\t\trequires: ['chat.bits.show'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val != null )\n\t\t\t\t\treturn val;\n\n\t\t\t\treturn ctx.get('chat.bits.show')\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Bits and Cheering >> Behavior',\n\t\t\t\ttitle: 'Display messages when a cheer shares rewards to people in chat.',\n\t\t\t\tdescription: 'By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.bits.cheer-notice', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Bits and Cheering >> Appearance',\n\t\t\t\ttitle: 'Display a notice on chat messages that include cheers.',\n\t\t\t\tdescription: 'This feature is intended to prevent possible confusion from chatters using emotes to fake cheers in messages. When enabled, messages that contain real cheers will display a message above them, similar to how resubscription messages or point redemptions with messages function.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.rituals.show', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Filtering > General >> Rituals',\n\t\t\t\ttitle: 'Display ritual messages such as \"User is new here! Say Hello!\".',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.extra-timestamps', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Display timestamps on notices.',\n\t\t\t\tdescription: 'When enabled, timestamps will be displayed on point redemptions, subscriptions, etc.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.hype.message-style', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Hype Chat >> Appearance',\n\t\t\t\ttitle: 'Hype Chat Style',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdescription: '**Note**: Hype Chats that include messages will always have their messages displayed, regardless of setting. Changes made to this setting may not affect existing chat messages.',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Do Not Display'},\n\t\t\t\t\t{value: 1, title: 'Standard Twitch (Large, Colored, Limited FFZ Support)'},\n\t\t\t\t\t{value: 2, title: 'Minimal (Marked with System Message, No Colors)' }\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.subs.show', {\n\t\t\tdefault: 3,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Subscriptions',\n\t\t\t\ttitle: 'Display Subs in Chat',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdescription: '**Note**: Messages sent with re-subs will always be displayed. This only controls the special \"X subscribed!\" message.',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Do Not Display'},\n\t\t\t\t\t{value: 1, title: 'Re-Subs with Messages Only'},\n\t\t\t\t\t{value: 2, title: 'Re-Subs Only'},\n\t\t\t\t\t{value: 3, title: 'Display All'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.subs.compact', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Subscriptions',\n\t\t\t\ttitle: 'Display subscription notices in a more compact (classic style) form.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.subs.merge-gifts', {\n\t\t\tdefault: 1000,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Subscriptions',\n\t\t\t\ttitle: 'Merge Mass Sub Gifts',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 1000, title: 'Disabled'},\n\t\t\t\t\t{value: 50, title: 'More than 50'},\n\t\t\t\t\t{value: 20, title: 'More than 20'},\n\t\t\t\t\t{value: 10, title: 'More than 10'},\n\t\t\t\t\t{value: 5, title: 'More than 5'},\n\t\t\t\t\t{value: 0, title: 'Always'}\n\t\t\t\t],\n\t\t\t\tdescription: 'Merge mass gift subscriptions into a single message, depending on the quantity.\\n**Note:** Only affects newly gifted subs.'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.subs.merge-gifts-visibility', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Subscriptions',\n\t\t\t\ttitle: 'Expand merged mass sub gift messages by default.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.lines.alternate', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Display lines with alternating background colors.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.lines.padding', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Reduce padding around lines.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.lines.borders', {\n\t\t\tdefault: 0,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Appearance >> Chat Lines',\n\t\t\t\ttitle: 'Separators',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Basic Line (1px Solid)'},\n\t\t\t\t\t{value: 2, title: '3D Line (2px Groove)'},\n\t\t\t\t\t{value: 3, title: '3D Line (2px Groove Inset)'},\n\t\t\t\t\t{value: 4, title: 'Wide Line (2px Solid)'}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.input.show-mod-view', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Appearance',\n\t\t\t\ttitle: 'Allow the \"Mod View\" button to appear in relevant channels.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.input.show-highlight', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Appearance',\n\t\t\t\ttitle: 'Allow the \"Chat Highlight Settings\" button to appear in relevant channels.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.input.show-shield', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Appearance',\n\t\t\t\ttitle: 'Allow the \"Shield Mode\" button to appear in relevant channels.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.input.show-elevate-your-message', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Input >> Appearance',\n\t\t\t\ttitle: 'Allow the \"Elevate Your Message\" button to be displayed.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\t}\n\n\tget currentChat() {\n\t\tfor(const inst of this.ChatController.instances)\n\t\t\tif ( inst && inst.chatService )\n\t\t\t\treturn inst;\n\n\t\treturn null;\n\t}\n\n\n\tupdateColors() {\n\t\tconst is_dark = this.chat.context.get('theme.is-dark'),\n\t\t\tmode = this.chat.context.get('chat.adjustment-mode'),\n\t\t\tcontrast = this.chat.context.get('chat.adjustment-contrast'),\n\t\t\tc = this.colors,\n\t\t\tic = this.inverse_colors;\n\n\t\tlet chat_dark = is_dark,\n\t\t\tchat_color = Color.RGBA.fromCSS(\n\t\t\t\tthis.chat.context.get('theme.color.chat-background') ||\n\t\t\t\tthis.chat.context.get('theme.color.background')\n\t\t\t);\n\n\t\tif ( chat_color )\n\t\t\tchat_dark = chat_color.toHSLA().l < 0.5;\n\n\t\tchat_color = chat_dark ? '#191919' : '#E0E0E0';\n\n\t\tlet text_dark = ! chat_dark,\n\t\t\tchat_text = Color.RGBA.fromCSS(\n\t\t\t\tthis.chat.context.get('theme.color.chat-text') ||\n\t\t\t\tthis.chat.context.get('theme.color.text')\n\t\t\t);\n\n\t\tif ( chat_text )\n\t\t\ttext_dark = chat_text.toHSLA().l < 0.5;\n\n\t\tchat_text = text_dark ? '#19171c' : '#dad8de';\n\n\t\t// TODO: Get the background color from the theme system.\n\t\t// Updated: Use the lightest/darkest colors from alternating rows for better readibility.\n\t\tc._base = chat_color; // is_dark ? '#191919' : '#e0e0e0'; //#0e0c13' : '#faf9fa';\n\t\tc.mode = mode;\n\t\tc.contrast = contrast;\n\n\t\tic._base = chat_text; // is_dark ? '#dad8de' : '#19171c';\n\t\tic.mode = mode;\n\t\tic.contrast = contrast;\n\n\t\tthis.chat_line.rerenderLines();\n\t\t//this.updateChatLines();\n\t\tthis.updateMentionCSS();\n\t\tthis.emit(':update-colors');\n\t}\n\n\n\tupdateChatCSS() {\n\t\tif ( ! this._update_css_waiter )\n\t\t\tthis._update_css_waiter = requestAnimationFrame(() => this._updateChatCSS());\n\t}\n\n\t_updateChatCSS() {\n\t\tcancelAnimationFrame(this._update_css_waiter);\n\t\tthis._update_css_waiter = null;\n\n\t\tconst width = this.chat.context.get('chat.effective-width'),\n\t\t\taction_size = this.chat.context.get('chat.actions.size'),\n\t\t\thover_action_size = this.chat.context.get('chat.actions.hover-size'),\n\t\t\tts_size = this.chat.context.get('chat.timestamp-size'),\n\t\t\tsize = this.chat.context.get('chat.font-size'),\n\t\t\temote_alignment = this.chat.context.get('chat.lines.emote-alignment'),\n\t\t\tlh = Math.round((20/12) * size);\n\n\t\tconst hover_action_icon = Math.round(hover_action_size * (2/3)),\n\t\t\thover_action_padding = hover_action_size - hover_action_icon;\n\n\t\tlet font = this.chat.context.get('chat.font-family') || 'inherit';\n\t\tconst [processed, unloader] = useFont(font);\n\t\tfont = processed;\n\n\t\tif ( this._font_unloader )\n\t\t\tthis._font_unloader();\n\n\t\tthis._font_unloader = unloader;\n\n\t\tif ( font.indexOf(' ') !== -1 && font.indexOf(',') === -1 && font.indexOf('\"') === -1 && font.indexOf(\"'\") === -1 )\n\t\t\tfont = `\"${font}\"`;\n\n\t\tif ( ts_size )\n\t\t\tthis.css_tweaks.set('ts-size', `.chat-line__timestamp{font-size:${ts_size/10}rem}`);\n\t\telse\n\t\t\tthis.css_tweaks.delete('ts-size');\n\n\t\tthis.css_tweaks.setVariable('chat-actions-size', `${action_size/10}rem`);\n\t\tthis.css_tweaks.setVariable('chat-actions-hover-size', `${hover_action_icon/10}rem`);\n\t\tthis.css_tweaks.setVariable('chat-actions-hover-padding', `${hover_action_padding/20}rem`);\n\t\tthis.css_tweaks.setVariable('chat-font-size', `${size/10}rem`);\n\t\tthis.css_tweaks.setVariable('chat-line-height', `${lh/10}rem`);\n\t\tthis.css_tweaks.setVariable('chat-font-family', font);\n\t\tthis.css_tweaks.setVariable('chat-width', `${width/10}rem`);\n\t\tthis.css_tweaks.setVariable('negative-chat-width', `${-width/10}rem`);\n\n\t\tthis.css_tweaks.toggle('chat-font', size !== 13 || font !== 'inherit');\n\t\tthis.css_tweaks.toggle('chat-width', this.settings.get('chat.use-width'));\n\t\tthis.css_tweaks.toggle('chat-fix--watch-party', this.settings.get('context.isWatchParty'));\n\n\t\tthis.css_tweaks.toggle('emote-alignment-padded', emote_alignment === 1);\n\t\tthis.css_tweaks.toggle('emote-alignment-baseline', emote_alignment === 2);\n\n\t\tthis.emit(':update-chat-css');\n\t\tthis.emit('site.player:fix-player');\n\t\tthis.emit('site.layout:resize');\n\t}\n\n\tupdateLineBorders() {\n\t\tconst mode = this.chat.context.get('chat.lines.borders');\n\n\t\tthis.css_tweaks.toggle('chat-borders', mode > 0);\n\t\tthis.css_tweaks.toggle('chat-borders-3d', mode === 2);\n\t\tthis.css_tweaks.toggle('chat-borders-3d-inset', mode === 3);\n\t\tthis.css_tweaks.toggle('chat-borders-wide', mode === 4);\n\t}\n\n\tupdateMentionCSS() {\n\t\tconst enabled = this.chat.context.get('chat.filtering.highlight-mentions');\n\t\tthis.css_tweaks.toggle('chat-mention-token', this.chat.context.get('chat.filtering.highlight-tokens'));\n\n\t\tconst raw_color = this.chat.context.get('chat.filtering.mention-color');\n\t\tif ( raw_color ) {\n\t\t\tthis.css_tweaks.toggle('chat-mention-bg', false);\n\t\t\tthis.css_tweaks.toggle('chat-mention-bg-alt', false);\n\n\t\t\tthis.css_tweaks.toggle('chat-mention-bg-custom', true);\n\t\t\tthis.css_tweaks.setVariable('chat-mention-color', this.inverse_colors.process(raw_color));\n\n\t\t} else {\n\t\t\tthis.css_tweaks.toggle('chat-mention-bg-custom', false);\n\t\t\tthis.css_tweaks.toggle('chat-mention-bg', enabled);\n\t\t\tthis.css_tweaks.toggle('chat-mention-bg-alt', enabled && this.chat.context.get('chat.lines.alternate'));\n\t\t}\n\t}\n\n\n\tupdatePointsInfo(inst) {\n\t\tconst icon = inst?.pointIcon,\n\t\t\tname = inst?.pointName;\n\n\t\tif ( icon ) {\n\t\t\tthis.css_tweaks.set('points-icon', `.ffz--points-icon:before { display: none }\n.ffz--points-icon:after {\n\tdisplay: inline-block;\n\tmargin: 0 0.5rem -0.6rem;\n\tbackground-image: url(\"${icon.url}\");\n\tbackground-image: ${WEBKIT}image-set(url(\"${icon.url}\") 1x, url(\"${icon.url2x}\") 2x, url(\"${icon.url4x}\") 4x);\n}`);\n\t\t} else\n\t\t\tthis.css_tweaks.delete('points-icon');\n\n\t\tthis.point_name = name || null;\n\t}\n\n\n\tgrabTypes() {\n\t\tif ( this.types_loaded )\n\t\t\treturn;\n\n\t\tconst ct = this.web_munch.getModule('chat-types'),\n\t\t\tcallouts = this.web_munch.getModule('callout-types');\n\n\t\tthis.callout_types = callouts || CALLOUT_TYPES;\n\t\tthis.automod_types = ct?.automod || AUTOMOD_TYPES;\n\t\tthis.chat_types = ct?.chat || CHAT_TYPES;\n\t\tthis.message_types = ct?.message || MESSAGE_TYPES;\n\t\tthis.mod_types = ct?.mod || MOD_TYPES;\n\n\t\tif ( ! ct )\n\t\t\treturn;\n\n\t\tif ( callouts )\n\t\t\tthis.chat.context.update('chat.filtering.blocked-callouts');\n\n\t\tthis.types_loaded = true;\n\t\tconst changes = [];\n\n\t\tif ( ! shallow_object_equals(this.callout_types, CALLOUT_TYPES) )\n\t\t\tchanges.push('CALLOUT_TYPES');\n\n\t\tif ( ! shallow_object_equals(this.automod_types, AUTOMOD_TYPES) )\n\t\t\tchanges.push('AUTOMOD_TYPES');\n\n\t\tif ( ! shallow_object_equals(this.chat_types, CHAT_TYPES) )\n\t\t\tchanges.push('CHAT_TYPES');\n\n\t\tif ( ! shallow_object_equals(this.message_types, MESSAGE_TYPES) )\n\t\t\tchanges.push('MESSAGE_TYPES');\n\n\t\tif ( ! shallow_object_equals(this.mod_types, MOD_TYPES) )\n\t\t\tchanges.push('MOD_TYPES');\n\n\t\tif ( changes.length )\n\t\t\tthis.log.info('Chat Types have changed from static mappings for categories:', changes.join(' '));\n\t}\n\n\n\tupdateDisableHandling() {\n\t\tthis.disable_handling = this.chat.context.get('chat.disable-handling');\n\t}\n\n\n\t/*setChatPortal(node) {\n\t\tif ( ! node )\n\t\t\tnode = null;\n\n\t\tif ( node === this.chat_portal )\n\t\t\treturn;\n\n\t\tif ( node && !(node instanceof HTMLElement) )\n\t\t\tthrow new Error('Tried to set invalid chat portal, must be null or HTMLElement');\n\n\t\tthis.chat_portal = node;\n\t\tthis.loadable.ErrorBoundaryComponent.forceUpdate();\n\t}*/\n\n\n\tonEnable() {\n\t\tthis.on('site.web_munch:new-ready', this.grabTypes);\n\t\tthis.on('site.web_munch:new-ready', this.defineClasses);\n\t\tthis.grabTypes();\n\t\tthis.defineClasses();\n\n\t\tthis.chat.context.on('changed:chat.callouts.clip', this.updateCallouts, this);\n\t\tthis.chat.context.on('changed:chat.filtering.blocked-callouts', this.updateCallouts, this);\n\t\tthis.chat.context.on('changed:chat.points.show-callouts', this.updateCallouts, this);\n\t\tthis.chat.context.on('changed:chat.points.show-button', () => this.PointsButton.forceUpdate());\n\t\tthis.chat.context.on('changed:chat.points.show-rewards', () => {\n\t\t\tthis.PointsButton.forceUpdate();\n\t\t\tthis.PointsClaimButton.forceUpdate();\n\t\t});\n\t\tthis.chat.context.on('changed:chat.bits.show', () => {\n\t\t\tthis.PointsButton.forceUpdate();\n\t\t});\n\n\t\tthis.chat.context.on('changed:chat.banners.hype-train', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.subs.gift-banner', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.banners.polls', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.banners.prediction', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.banners.drops', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.banners.pinned-message', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.banners.hide-appleplus', this.cleanHighlights, this);\n\t\tthis.chat.context.on('changed:chat.banners.shared-chat', this.cleanHighlights, this);\n\n\t\tthis.chat.context.on('changed:chat.disable-handling', this.updateDisableHandling, this);\n\n\t\tthis.chat.context.on('changed:chat.banners.charity', () => {\n\t\t\tthis.ChatContainer.forceUpdate();\n\t\t});\n\n\t\tthis.chat.context.on('changed:chat.subs.gift-banner', () => this.GiftBanner.forceUpdate(), this);\n\t\tthis.chat.context.on('changed:chat.effective-width', this.updateChatCSS, this);\n\t\tthis.settings.main_context.on('changed:chat.use-width', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.actions.size', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.actions.hover-size', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.font-size', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.timestamp-size', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.font-family', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.lines.emote-alignment', this.updateChatCSS, this);\n\t\tthis.chat.context.on('changed:chat.adjustment-mode', this.updateColors, this);\n\t\tthis.chat.context.on('changed:chat.adjustment-contrast', this.updateColors, this);\n\t\tthis.chat.context.on('changed:theme.is-dark', this.updateColors, this);\n\t\tthis.chat.context.on('changed:theme.color.background', this.updateColors, this);\n\t\tthis.chat.context.on('changed:theme.color.chat-background', this.updateColors, this);\n\t\tthis.chat.context.on('changed:theme.color.text', this.updateColors, this);\n\t\tthis.chat.context.on('changed:theme.color.chat-text', this.updateColors, this);\n\t\tthis.chat.context.on('changed:chat.lines.borders', this.updateLineBorders, this);\n\t\tthis.chat.context.on('changed:chat.filtering.highlight-mentions', this.updateMentionCSS, this);\n\t\tthis.chat.context.on('changed:chat.filtering.highlight-tokens', this.updateMentionCSS, this);\n\t\tthis.chat.context.on('changed:chat.filtering.mention-color', this.updateMentionCSS, this);\n\t\tthis.chat.context.on('changed:chat.pin-resubs', val => {\n\t\t\tif ( val ) {\n\t\t\t\tthis.updateInlineCallouts();\n\t\t\t\tthis.updatePinnedCallouts();\n\t\t\t}\n\t\t}, this);\n\n\t\tthis.chat.context.on('changed:chat.community-chest.show', () => {\n\t\t\tthis.CommunityChestBanner.forceUpdate();\n\t\t\tthis.updateCallouts();\n\t\t}, this);\n\n\t\tthis.chat.context.getChanges('chat.emotes.2x', val => {\n\t\t\tthis.css_tweaks.toggle('big-emoji', val > 1);\n\t\t\tthis.toggleEmoteJail();\n\t\t});\n\n\t\tthis.chat.context.getChanges('chat.emotes.limit-size', () =>\n\t\t\tthis.toggleEmoteJail());\n\n\t\tthis.chat.context.getChanges('chat.banners.last-events', val =>\n\t\t\tthis.css_tweaks.toggleHide('last-x-events', ! val));\n\n\t\tthis.chat.context.getChanges('chat.input.show-mod-view', val =>\n\t\t\tthis.css_tweaks.toggleHide('ci-mod-view', ! val));\n\n\t\tthis.chat.context.getChanges('chat.input.show-highlight', val =>\n\t\t\tthis.css_tweaks.toggleHide('ci-highlight-settings', !val));\n\n\t\tthis.chat.context.getChanges('chat.input.show-shield', val =>\n\t\t\tthis.css_tweaks.toggleHide('ci-shield-mode', ! val));\n\n\t\tthis.chat.context.getChanges('chat.lines.padding', val =>\n\t\t\tthis.css_tweaks.toggle('chat-padding', val));\n\n\t\tthis.chat.context.getChanges('chat.bits.show', val =>\n\t\t\tthis.css_tweaks.toggle('hide-bits', !val));\n\n\t\tthis.chat.context.on('changed:chat.bits.show-pinned', () =>\n\t\t\tthis.ChatLeaderboard.forceUpdate());\n\n\t\tthis.chat.context.getChanges('chat.filtering.deleted-style', val => {\n\t\t\tthis.css_tweaks.toggle('chat-deleted-strike', val === 1 || val === 2);\n\t\t\tthis.css_tweaks.toggle('chat-deleted-fade', val < 2);\n\t\t});\n\n\t\tthis.chat.context.getChanges('chat.filtering.clickable-mentions', val =>\n\t\t\tthis.css_tweaks.toggle('clickable-mentions', val));\n\n\t\tthis.chat.context.getChanges('chat.filtering.bold-mentions', val =>\n\t\t\tthis.css_tweaks.toggle('chat-mention-no-bold', ! val));\n\n\t\tthis.chat.context.getChanges('chat.hide-community-highlights', val =>\n\t\t\tthis.css_tweaks.toggleHide('community-highlights', val));\n\n\t\tthis.chat.context.getChanges('chat.lines.alternate', val => {\n\t\t\tthis.css_tweaks.toggle('chat-rows', val);\n\t\t\tthis.updateMentionCSS();\n\t\t});\n\n\t\tthis.chat.context.getChanges('chat.input.show-elevate-your-message', val =>\n\t\t\tthis.css_tweaks.toggleHide('elevate-your-message', ! val));\n\n\t\tthis.updateDisableHandling();\n\t\tthis.updateChatCSS();\n\t\tthis.updateColors();\n\t\tthis.updateLineBorders();\n\t\t//this.updateMentionCSS();\n\n\t\tthis.on('chat:get-messages-late', (include_chat, include_whisper, include_video, messages) => {\n\t\t\tif ( ! include_chat )\n\t\t\t\treturn;\n\n\t\t\tconst msg_ids = new Set(messages.map(x => x.message?.id));\n\n\t\t\tfor(const inst of this.ChatBuffer.instances) {\n\t\t\t\tfor(const msg of inst.buffer) {\n\t\t\t\t\tconst msg_id = msg?.id;\n\t\t\t\t\tif ( ! msg_id || msg_ids.has(msg_id) || ! msg.ffz_standardized )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tmsg_ids.add(msg_id);\n\t\t\t\t\tmessages.push({\n\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\t_instance: null,\n\t\t\t\t\t\tupdate: () => null\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfor(const raw of inst.delayedMessageBuffer) {\n\t\t\t\t\tconst msg = raw?.event,\n\t\t\t\t\t\tmsg_id = msg?.id;\n\t\t\t\t\tif ( ! msg_id || msg_ids.has(msg_id) || ! msg.ffz_standardized )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tmsg_ids.add(msg_id);\n\t\t\t\t\tmessages.push({\n\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\t_instance: null,\n\t\t\t\t\t\tupdate: () => null\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.on('chat:get-tab-commands', e => {\n\t\t\te.commands.push({\n\t\t\t\tname: 'reconnect',\n\t\t\t\tdescription: 'Force chat to reconnect.',\n\t\t\t\tpermissionLevel: 0,\n\t\t\t\tffz_group: 'FrankerFaceZ'\n\t\t\t})\n\t\t});\n\n\t\tthis.on('chat:pre-send-message', e => {\n\t\t\tconst msg = e.message,\n\t\t\t\tinst = e._inst;\n\n\t\t\tif ( ! /^\\/reconnect ?/i.test(msg) )\n\t\t\t\treturn;\n\n\t\t\te.preventDefault();\n\n\t\t\tif ( ! inst.client?.reconnect )\n\t\t\t\tinst.addMessage({\n\t\t\t\t\ttype: t.chat_types.Notice,\n\t\t\t\t\tmessage: t.i18n.t('chat.reconnect.unable', 'FFZ is unable to force chat to reconnect.')\n\t\t\t\t});\n\t\t\telse {\n\t\t\t\tinst.addMessage({\n\t\t\t\t\ttype: t.chat_types.Notice,\n\t\t\t\t\tmessage: t.i18n.t('chat.reconnect', 'FFZ is forcing chat to reconnect...')\n\t\t\t\t});\n\n\t\t\t\tinst.client.reconnect();\n\t\t\t}\n\t\t});\n\n\t\t/*this.loadable.ErrorBoundaryComponent.ready(cls => {\n\t\t\tconst t = this,\n\t\t\t\tproto = cls.prototype,\n\t\t\t\told_render = proto.render;\n\n\t\t\tproto.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tconst type = this.props.name;\n\t\t\t\t\tif ( type === 'ChatLive' && t.chat_portal ) {\n\t\t\t\t\t\tconst ReactDOM = t.site.getReactDom(),\n\t\t\t\t\t\t\tcreatePortal = ReactDOM?.createPortal;\n\n\t\t\t\t\t\tif ( createPortal ) {\n\t\t\t\t\t\t\tconst out = old_render.call(this);\n\t\t\t\t\t\t\tconsole.log('creating portal', out);\n\t\t\t\t\t\t\treturn createPortal(out, t.chat_portal, 'ffz-chat-portal');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op * /\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\t\t});*/\n\n\t\tthis.RaidController.on('mount', this.wrapRaidController, this);\n\t\tthis.RaidController.on('update', this.noAutoRaids, this);\n\t\tthis.RaidController.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.wrapRaidController(inst);\n\t\t});\n\n\t\tthis.InlineCallout.on('mount', this.onInlineCallout, this);\n\t\tthis.InlineCallout.on('update', this.onInlineCallout, this);\n\t\tthis.InlineCallout.ready(() => this.updateInlineCallouts());\n\n\t\tthis.PinnedCallout.on('mount', this.onPinnedCallout, this);\n\t\tthis.PinnedCallout.on('update', this.onPinnedCallout, this);\n\t\tthis.PinnedCallout.ready(() => this.updatePinnedCallouts());\n\n\t\tconst t = this;\n\n\t\tthis.PointsInfo.on('mount', this.updatePointsInfo, this);\n\t\tthis.PointsInfo.on('update', this.updatePointsInfo, this);\n\t\tthis.PointsInfo.on('unmount', () => this.updatePointsInfo(null));\n\t\tthis.PointsInfo.ready(() => this.updatePointsInfo(this.PointsInfo.first));\n\n\t\tthis.ChatLeaderboard.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tif ( ! t.chat.context.get('chat.bits.show-pinned') )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.ChatLeaderboard.forceUpdate();\n\t\t});\n\n\t\tthis.GiftBanner.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tif ( ! t.chat.context.get('chat.subs.gift-banner') )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.GiftBanner.forceUpdate();\n\t\t});\n\n\t\tthis.CommunityChestBanner.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( ! t.chat.context.get('chat.community-chest.show') )\n\t\t\t\t\t\treturn null;\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t\tt.log.error(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t};\n\n\t\t\tthis.CommunityChestBanner.forceUpdate();\n\t\t});\n\n\t\tthis.PointsButton.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( ! t.chat.context.get('chat.points.show-button') )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\tconst old_aq = this.state.animationQueue,\n\t\t\t\t\t\told_bits = this.props.bitsEnabled;\n\n\t\t\t\t\tif ( ! t.chat.context.get('chat.points.show-rewards') )\n\t\t\t\t\t\tthis.state.animationQueue = [];\n\n\t\t\t\t\tif ( ! t.chat.context.get('chat.bits.show') )\n\t\t\t\t\t\tthis.props.bitsEnabled = false;\n\n\t\t\t\t\tconst out = old_render.call(this);\n\n\t\t\t\t\tthis.state.animationQueue = old_aq;\n\t\t\t\t\tthis.props.bitsEnabled = old_bits;\n\t\t\t\t\treturn out;\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t\tt.log.error(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.PointsButton.forceUpdate();\n\t\t});\n\n\t\tthis.PointsClaimButton.ready(cls => {\n\t\t\tcls.prototype.ffzHasOffer = function() {\n\t\t\t\treturn ! this.props.hidden && ! this.state?.error && this.getClaim() != null;\n\t\t\t};\n\n\t\t\tconst old_render = cls.prototype.render;\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( this.ffzHasOffer() && ! this._ffz_timer && t.chat.context.get('chat.points.auto-rewards') )\n\t\t\t\t\t\tthis._ffz_timer = setTimeout(() => {\n\t\t\t\t\t\t\tthis._ffz_timer = null;\n\t\t\t\t\t\t\tif ( this.onClick && this.ffzHasOffer() )\n\t\t\t\t\t\t\t\tthis.onClick();\n\t\t\t\t\t\t}, 1000 + Math.floor(Math.random() * 5000));\n\n\t\t\t\t\tif ( ! t.chat.context.get('chat.points.show-rewards') )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t\tt.log.error(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.PointsClaimButton.forceUpdate();\n\t\t});\n\n\t\tthis.ChatController.on('mount', this.chatMounted, this);\n\t\tthis.ChatController.on('unmount', this.chatUnmounted, this);\n\t\t//this.ChatController.on('receive-props', this.chatUpdated, this);\n\t\tthis.ChatController.on('update', this.chatUpdated, this);\n\n\t\tthis.ChatService.ready((cls, instances) => {\n\t\t\tthis.wrapChatService(cls);\n\n\t\t\tfor(const inst of instances) {\n\t\t\t\tinst.client.events.removeAll();\n\n\t\t\t\tinst._ffzInstall();\n\n\t\t\t\tconst channel = inst.joinedChannel,\n\t\t\t\t\tstate = inst.client?.session?.channelstate?.[`#${channel}`]?.roomState;\n\n\t\t\t\tif ( state )\n\t\t\t\t\tthis.updateChatState(state);\n\n\t\t\t\tinst.addEventListeners();\n\n\t\t\t\tinst.props.setChatConnectionAPI({\n\t\t\t\t\tsendMessage: inst.sendMessage,\n\t\t\t\t\t_ffz_inst: inst\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.ChatBuffer.ready((cls, instances) => {\n\t\t\tthis.wrapChatBuffer(cls);\n\n\t\t\tfor(const inst of instances) {\n\t\t\t\tconst handler = inst.props.messageHandlerAPI;\n\t\t\t\tif ( handler )\n\t\t\t\t\thandler.removeMessageHandler(inst.handleMessage);\n\n\t\t\t\tinst._ffzInstall();\n\n\t\t\t\tif ( handler )\n\t\t\t\t\thandler.addMessageHandler(inst.handleMessage);\n\n\t\t\t\t// We grab this from the chat client now.\n\t\t\t\t/*if ( Array.isArray(inst.buffer) ) {\n\t\t\t\t\tlet i = inst.buffer.length;\n\t\t\t\t\tconst ct = this.chat_types || CHAT_TYPES;\n\n\t\t\t\t\twhile(i--) {\n\t\t\t\t\t\tconst msg = inst.buffer[i];\n\t\t\t\t\t\tif ( msg && msg.type === ct.RoomState && msg.state ) {\n\t\t\t\t\t\t\tthis.updateChatState(msg.state);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}*/\n\n\t\t\t\tinst.props.setMessageBufferAPI({\n\t\t\t\t\taddUpdateHandler: inst.addUpdateHandler,\n\t\t\t\t\tremoveUpdateHandler: inst.removeUpdateHandler,\n\t\t\t\t\tgetUnreadCount: inst.getUnreadCount,\n\t\t\t\t\tgetMessages: inst.getMessages,\n\t\t\t\t\tgetMessagesForHighlight: inst.getMessagesForHighlight,\n\t\t\t\t\tgetMessagesForAllHighlights: inst.getMessagesForAllHighlights,\n\t\t\t\t\tisPaused: inst.isPaused,\n\t\t\t\t\tsetPaused: inst.setPaused,\n\t\t\t\t\thasNewerLeft: inst.hasNewerLeft,\n\t\t\t\t\tloadNewer: inst.loadNewer,\n\t\t\t\t\tloadNewest: inst.loadNewest,\n\t\t\t\t\t_ffz_inst: inst\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.ChatRewardEventHandler.ready((cls, instances) => {\n\t\t\tconst t = this,\n\t\t\t\told_subscribe = cls.prototype.subscribe;\n\n\t\t\tcls.prototype.ffzInstall = function() {\n\t\t\t\tif (this._ffz_installed)\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._ffz_installed = true;\n\t\t\t\tconst inst = this;\n\t\t\t\tconst old_handle = this.handleMessage;\n\t\t\t\tthis.handleMessage = function(msg) {\n\t\t\t\t\t//t.log.info('reward-message', msg, inst);\n\t\t\t\t\tif ( t.disable_handling )\n\t\t\t\t\t\treturn old_handle.call(this, msg);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( ! inst.props?.channelID || ! msg )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tt.insertChannelPointMessage(msg);\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.error('Error handling reward event:', err);\n\t\t\t\t\t\treturn old_handle.call(this, msg);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tcls.prototype.subscribe = function(...args) {\n\t\t\t\ttry {\n\t\t\t\t\tthis.ffzInstall();\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.error('Error in subscribe for RewardEventHandler:', err);\n\t\t\t\t}\n\t\t\t\treturn old_subscribe.call(this, ...args);\n\t\t\t}\n\n\t\t\tfor(const inst of instances)\n\t\t\t\tinst.subscribe();\n\t\t});\n\n\t\tthis.ChatBufferConnector.on('mount', this.connectorMounted, this);\n\t\tthis.ChatBufferConnector.on('update', this.connectorUpdated, this);\n\t\tthis.ChatBufferConnector.on('unmount', this.connectorUnmounted, this);\n\n\t\tthis.ChatBufferConnector.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.connectorMounted(inst);\n\t\t});\n\n\t\tthis.ChatController.ready((cls, instances) => {\n\t\t\tconst t = this,\n\t\t\t\told_catch = cls.prototype.componentDidCatch,\n\t\t\t\told_render = cls.prototype.render;\n\n\t\t\t// Try catching errors. With any luck, maybe we can\n\t\t\t// recover from the error when we re-build?\n\t\t\tcls.prototype.componentDidCatch = function(err, info) {\n\t\t\t\t// Don't log infinitely if stuff gets super screwed up.\n\t\t\t\tconst errs = this.state.ffz_errors || 0;\n\t\t\t\tif ( errs < 100 ) {\n\t\t\t\t\tthis.setState({ffz_errors: errs + 1});\n\t\t\t\t\tt.log.info('Error within Chat', err, info, errs);\n\t\t\t\t}\n\n\t\t\t\tif ( old_catch )\n\t\t\t\t\treturn old_catch.call(this, err, info);\n\t\t\t}\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\tif ( this.state.ffz_errors > 0 ) {\n\t\t\t\t\tconst React = t.site.getReact(),\n\t\t\t\t\t\tcreateElement = React && React.createElement;\n\n\t\t\t\t\tif ( ! createElement )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\treturn createElement('div', {\n\t\t\t\t\t\tclassName: 'tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative'\n\t\t\t\t\t}, 'There was an error displaying chat.');\n\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.chatMounted(inst);\n\t\t});\n\n\t\tthis.ChatRenderer.on('mount', this.rendererMounted, this);\n\t\tthis.ChatRenderer.on('unmount', this.rendererUnmounted, this);\n\t\tthis.ChatRenderer.on('update', this.rendererUpdated, this);\n\n\t\tthis.ChatRenderer.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.rendererMounted(inst);\n\t\t})\n\n\t\tthis.ChatContainer.on('mount', this.containerMounted, this);\n\t\tthis.ChatContainer.on('unmount', this.containerUnmounted, this); //removeRoom, this);\n\t\tthis.ChatContainer.on('update', this.containerUpdated, this);\n\n\t\tthis.CalloutSelector.ready((cls, instances) => {\n\t\t\tconst t = this,\n\t\t\t\told_render = cls.prototype.render;\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( t.CalloutStackHandler ) {\n\t\t\t\t\t\tconst React = t.site.getReact(),\n\t\t\t\t\t\t\tout = old_render.call(this),\n\t\t\t\t\t\t\tthing = out?.props?.children;\n\n\t\t\t\t\t\tif ( Array.isArray(thing) )\n\t\t\t\t\t\t\tthing.push(React.createElement(t.CalloutStackHandler));\n\n\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tfor(const inst of instances)\n\t\t\t\tinst.forceUpdate();\n\t\t});\n\n\t\tthis.ChatContainer.ready((cls, instances) => {\n\t\t\tconst t = this,\n\t\t\t\told_render = cls.prototype.render,\n\t\t\t\told_catch = cls.prototype.componentDidCatch;\n\n\t\t\tcls.prototype.ffzRender = function() {\n\t\t\t\tif ( t.chat.context.get('chat.banners.charity') )\n\t\t\t\t\treturn old_render.call(this);\n\n\t\t\t\tconst cd = this.props.campaignData;\n\t\t\t\tthis.props.campaignData = null;\n\t\t\t\tlet result;\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = old_render.call(this);\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.props.campaignData = cd;\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\n\t\t\t\tthis.props.campaignData = cd;\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( t.CommunityStackHandler ) {\n\t\t\t\t\t\tconst React = t.site.getReact(),\n\t\t\t\t\t\t\tout = this.ffzRender(),\n\t\t\t\t\t\t\tthing = out?.props?.children?.props?.children;\n\n\t\t\t\t\t\tif ( React && Array.isArray(thing) )\n\t\t\t\t\t\t\tthing.push(React.createElement(t.CommunityStackHandler));\n\n\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// No op\n\t\t\t\t}\n\n\t\t\t\treturn this.ffzRender();\n\t\t\t}\n\n\t\t\t// Try catching errors. With any luck, maybe we can\n\t\t\t// recover from the error when we re-build?\n\t\t\tcls.prototype.componentDidCatch = function(err, info) {\n\t\t\t\t// Don't log infinitely if stuff gets super screwed up.\n\t\t\t\tconst errs = this.state.ffz_errors || 0;\n\t\t\t\tif ( errs < 100 ) {\n\t\t\t\t\tthis.setState({ffz_errors: errs + 1});\n\t\t\t\t\tt.log.info('Error within Chat Container', err, info, errs);\n\t\t\t\t}\n\n\t\t\t\tif ( old_catch )\n\t\t\t\t\treturn old_catch.call(this, err, info);\n\t\t\t}\n\n\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.containerMounted(inst);\n\t\t});\n\n\t\tthis.subpump.on(':pubsub-message', event => {\n\t\t\tif ( event.prefix !== 'community-points-channel-v1' || this.disable_handling )\n\t\t\t\treturn;\n\n\t\t\tif ( event.prefix === 'pinned-chat-updates-v1' ) {\n\t\t\t\tthis.log.debug('Pinned Chat', event);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = this.ChatService.first,\n\t\t\t\tmessage = event.message,\n\t\t\t\tdata = message?.data?.redemption;\n\t\t\tif ( ! message || ! service || message.type !== 'reward-redeemed' || service.props.channelID != data?.channel_id )\n\t\t\t\treturn;\n\n\t\t\tthis.insertChannelPointMessage(message);\n\t\t});\n\t}\n\n\tinsertChannelPointMessage(msg) {\n\t\tconst service = this.ChatService.first,\n\t\t\tdata = msg?.data?.redemption,\n\t\t\ttype = msg?.type,\n\t\t\tisRedeemed = type === 'reward-redeemed',\n\t\t\tisAutomaticReward = type === 'automatic-reward-redeemed';\n\n\t\tif ( ! data?.reward || ! service || (!isAutomaticReward && !isRedeemed) || service.props.channelID != data?.channel_id )\n\t\t\treturn;\n\n\t\tif ((isRedeemed && data.user_input) || (isAutomaticReward && data.reward.reward_type !== 'celebration'))\n\t\t\treturn;\n\n\t\tlet rewardID;\n\t\tif (isAutomaticReward)\n\t\t\trewardID = `${inst.props.channelID}:${data.reward.reward_type}`;\n\t\telse\n\t\t\trewardID = data.reward.id;\n\n\t\tconst reward = service.props.rewardMap[rewardID];\n\t\tif ( ! reward )\n\t\t\treturn;\n\n\t\tif ( this.chat.context.get('chat.filtering.blocked-types').has('ChannelPointsReward') )\n\t\t\treturn;\n\n\t\tif ( this.last_points_redeem === data.id )\n\t\t\treturn;\n\n\t\tthis.last_points_redeem = data.id;\n\n\t\tservice.postMessageToCurrentChannel({}, {\n\t\t\tid: data.id,\n\t\t\ttype: this.chat_types.Message,\n\t\t\tffz_type: 'points',\n\t\t\tffz_reward: reward,\n\t\t\tffz_reward_highlight: isHighlightedReward(reward),\n\t\t\tmessageParts: [],\n\t\t\tuser: {\n\t\t\t\tid: data.user.id,\n\t\t\t\tlogin: data.user.login,\n\t\t\t\tdisplayName: data.user.display_name\n\t\t\t},\n\t\t\ttimestamp: new Date(msg.data.timestamp || data.redeemed_at).getTime()\n\t\t});\n\t}\n\n\n\tshouldHideCallout(type) {\n\t\tif ( ! type )\n\t\t\treturn;\n\n\t\ttype = INLINE_CALLOUT_TYPES[type] ?? type.replace(/_/g, '-');\n\n\t\tconst ctm = this.callout_types ?? CALLOUT_TYPES,\n\t\t\tblocked = this.chat.context.get('chat.filtering.blocked-callouts');\n\n\t\tif ( blocked && blocked.has(type) )\n\t\t\treturn true;\n\n\t\tif ( type === ctm.CommunityPointsRewards &&\n\t\t\t! this.chat.context.get('chat.points.show-callouts')\n\t\t)\n\t\t\treturn true;\n\n\t\tif ( type === ctm.ClipLiveNudge &&\n\t\t\t! this.chat.context.get('chat.callouts.clip')\n\t\t)\n\t\t\treturn true;\n\n\t\tif ( type === 'prime_gift_bomb' &&\n\t\t\t! this.chat.context.get('chat.community-chest.show')\n\t\t)\n\t\t\treturn true;\n\n\t\tif ( type === 'megacheer_emote_recipient' &&\n\t\t\t! t.chat.context.get('chat.bits.show-rewards')\n\t\t)\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\n\tupdateCallouts() {\n\t\tthis.updatePinnedCallouts();\n\t\tthis.updateInlineCallouts();\n\t}\n\n\n\tupdatePinnedCallouts() {\n\t\tfor(const inst of this.PinnedCallout.instances)\n\t\t\tthis.onPinnedCallout(inst);\n\t}\n\n\tonPinnedCallout(inst) {\n\t\tconst props = inst.props,\n\t\t\tevent = props?.event,\n\t\t\ttype = event?.type;\n\n\t\t//console.warn('pinned-callout', type, event, inst);\n\n\t\t// Hidden callouts\n\t\tif ( this.shouldHideCallout(type) ) {\n\t\t\tif ( inst.props.pinned )\n\t\t\t\tinst.unpin();\n\t\t\telse\n\t\t\t\tinst.hide();\n\t\t}\n\n\t\t// Auto-pin resubs\n\t\tif ( type === 'share-resub' && ! props.pinned && this.chat.context.get('chat.pin-resubs') && ! inst._ffz_pinned ) {\n\t\t\tthis.log.info('Automatically pinning re-sub notice.');\n\t\t\tinst._ffz_pinned = true;\n\t\t\tinst.pin();\n\t\t}\n\n\t\t// Auto-claim drops\n\t\tif ( type === 'drop' )\n\t\t\tthis.autoClickDrop(inst);\n\t}\n\n\tupdateInlineCallouts() {\n\t\tfor(const inst of this.InlineCallout.instances)\n\t\t\tthis.onInlineCallout(inst);\n\t}\n\n\tonInlineCallout(inst) {\n\t\t// Skip hidden inline callouts.\n\t\tif ( inst.state.isHidden )\n\t\t\treturn;\n\n\t\tconst contextMenuProps = inst.props?.event?.callout?.contextMenuProps,\n\t\t\tevent = contextMenuProps?.event ?? inst.props?.event,\n\t\t\ttype = event?.type;\n\n\t\t//console.warn('inline-callout', type, event, inst);\n\n\t\t// Hidden callouts\n\t\tif ( this.shouldHideCallout(type) || this.shouldHideCallout(inst.props?.event?.trackingType) ) {\n\t\t\tinst.setState({isHidden: true});\n\t\t\treturn;\n\t\t}\n\n\t\t// Auto-pin resubs\n\t\tif ( type === 'share-resub' && this.chat.context.get('chat.pin-resubs') && ! inst._ffz_pinned ) {\n\t\t\tconst onPin = contextMenuProps?.onPin;\n\t\t\tif ( onPin ) {\n\t\t\t\tthis.log.info('Automatically pinning re-sub notice.');\n\t\t\t\tinst._ffz_pinned = true;\n\t\t\t\tif ( inst.hideOnContextMenuAction )\n\t\t\t\t\tinst.hideOnContextMenuAction(onPin)();\n\t\t\t\telse\n\t\t\t\t\tonPin();\n\t\t\t}\n\t\t}\n\n\t\t// Auto-claim drops\n\t\tif ( type === 'drop' )\n\t\t\tthis.autoClickDrop(inst);\n\t}\n\n\n\tautoClickDrop(inst) {\n\t\tconst event = inst.props?.event?.callout?.contextMenuProps?.event ?? inst.props?.event,\n\t\t\ttype = event?.type;\n\n\t\tif ( type !== 'drop' || inst._ffz_clicking || ! this.chat.context.get(\"chat.drops.auto-rewards\") )\n\t\t\treturn;\n\n\t\t//console.warn('autoClickDrop', event, inst);\n\t\tinst._ffz_clicking = true;\n\n\t\t// Wait for the button to be added to the DOM.\n\t\tconst waiter = this.resolve('site').awaitElement(\n\t\t\t'button[data-a-target=\"chat-private-callout__primary-button\"]',\n\t\t\tthis.fine.getHostNode(inst),\n\t\t\t10000\n\t\t);\n\n\t\twaiter.then(btn => {\n\t\t\tinst._ffz_clicking = false;\n\n\t\t\t// Check AGAIN because time has passed.\n\t\t\tconst event = inst.props?.event?.callout?.contextMenuProps?.event ?? inst.props?.event,\n\t\t\t\ttype = event?.type;\n\n\t\t\tif ( type !== 'drop' || ! this.chat.context.get(\"chat.drops.auto-rewards\") )\n\t\t\t\treturn;\n\n\t\t\tbtn.click();\n\n\t\t}).catch(() => {\n\t\t\tinst._ffz_clicking = false;\n\t\t});\n\t}\n\n\n\twrapRaidController(inst) {\n\t\tif ( inst._ffz_wrapped )\n\t\t\treturn this.noAutoRaids(inst);\n\n\t\tinst._ffz_wrapped = true;\n\n\t\tconst t = this,\n\t\t\told_handle_join = inst.handleJoinRaid;\n\n\t\tinst.handleJoinRaid = function(event, ...args) {\n\t\t\tconst raid_id = inst.props && inst.props.raid && inst.props.raid.id;\n\t\t\tif ( event && event.type && raid_id )\n\t\t\t\tt.joined_raids.add(raid_id);\n\n\t\t\treturn old_handle_join.call(this, event, ...args);\n\t\t}\n\n\t\tthis.noAutoRaids(inst);\n\t}\n\n\tnoAutoRaids(inst) {\n\t\tif ( inst._ffz_no_raid )\n\t\t\treturn;\n\n\t\tinst._ffz_no_raid = setTimeout(() => {\n\t\t\tinst._ffz_no_raid = null;\n\n\t\t\tif ( inst.props && inst.props.raid && ! inst.isRaidCreator && inst.hasJoinedCurrentRaid ) {\n\t\t\t\tconst id = inst.props.raid.id;\n\t\t\t\tif ( this.joined_raids.has(id) )\n\t\t\t\t\treturn;\n\n\t\t\t\tlet leave = this.settings.get('channel.raids.no-autojoin');\n\n\t\t\t\tif ( ! leave ) {\n\t\t\t\t\tconst blocked = this.settings.get('__filter:channel.raids.blocked-channels');\n\t\t\t\t\tif ( blocked && ((inst.props.raid.targetLogin && blocked.test(inst.props.raid.targetLogin)) || (inst.props.raid.targetDisplayName && blocked.test(inst.props.raid.targetDisplayName))) )\n\t\t\t\t\t\tleave = true;\n\n\t\t\t\t\tif ( ! leave )\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.log.info('Automatically leaving raid:', id);\n\t\t\t\tinst.handleLeaveRaid();\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggleEmoteJail() {\n\t\tconst bigger = this.chat.context.get('chat.emotes.2x'),\n\t\t\tenabled = this.chat.context.get('chat.emotes.limit-size');\n\n\t\tthis.css_tweaks.toggle('big-emote-jail', enabled && ! bigger);\n\t\tthis.css_tweaks.toggle('bigger-emote-jail', enabled && bigger);\n\t}\n\n\tcleanHighlights() {\n\t\tconst types = {\n\t\t\t'community_sub_gift': this.chat.context.get('chat.subs.gift-banner'),\n\t\t\t'megacheer': this.chat.context.get('chat.bits.show'),\n\t\t\t'hype_train': this.chat.context.get('chat.banners.hype-train'),\n\t\t\t'prediction': this.chat.context.get('chat.banners.prediction'),\n\t\t\t'poll': this.chat.context.get('chat.banners.polls'),\n\t\t\t'pinned_chat': this.chat.context.get('chat.banners.pinned-message'),\n\t\t\t'mw-drop-available': this.chat.context.get('chat.banners.drops'),\n\t\t\t'shared_chat': this.chat.context.get('chat.banners.shared-chat')\n\t\t};\n\n\t\tconst highlights = this.community_stack?.highlights;\n\t\tif ( ! Array.isArray(highlights) )\n\t\t\treturn;\n\n\t\tfor(const entry of highlights) {\n\t\t\tif ( ! entry || ! entry.event || ! entry.id )\n\t\t\t\tcontinue;\n\n\t\t\tconst type = entry.event.type;\n\t\t\tif ( type && has(types, type) && ! types[type] ) {\n\t\t\t\t// Attempt to allow Golden Kappa hype trains?\n\t\t\t\t//if ( type === 'hype_train' && entry.event.typeDetails === '0' && this.chat.context.get('chat.banners.kappa-train') )\n\t\t\t\t//\tcontinue;\n\n\t\t\t\tthis.log.info('Removing community highlight: ', type, '#', entry.id);\n\t\t\t\tthis.community_dispatch({\n\t\t\t\t\ttype: 'remove-highlight',\n\t\t\t\t\tid: entry.id\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (type === 'mw-drop-available' &&\n\t\t\t\tentry.event.detailsURL === 'https://blog.twitch.tv/2024/07/26/sub-and-get-apple-tv/' &&\n\t\t\t\tthis.chat.context.get('chat.banners.hide-appleplus')\n\t\t\t) {\n\t\t\t\tthis.log.info('Removing community highlight: ', type, '#', entry.id);\n\t\t\t\tthis.community_dispatch({\n\t\t\t\t\ttype: 'remove-highlight',\n\t\t\t\t\tid: entry.id\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n\n\tcleanCallouts() {\n\t\tconst stack = this.callout_stack;\n\t\tif (stack?.pinnedCallout?.event?.type && this.shouldHideCallout(stack.pinnedCallout.event.type))\n\t\t\tstack.unpinCallout();\n\n\t\tif (stack?.callouts?.[0]?.event?.type && this.shouldHideCallout(stack.callouts[0].event.type))\n\t\t\tstack.clearCalloutType(stack.callouts[0].event.type);\n\t}\n\n\tdefineClasses() {\n\t\tif ( this.CommunityStackHandler && this.CalloutStackHandler )\n\t\t\treturn true;\n\n\t\tconst t = this,\n\t\t\tReact = this.site.getReact(),\n\t\t\tcreateElement = React?.createElement,\n\t\t\tStackMod = this.web_munch.getModule('highlightstack'),\n\t\t\tCalloutMod = this.web_munch.getModule('calloutstack');\n\n\t\tif ( ! createElement )\n\t\t\treturn false;\n\n\t\tif ( ! this.CalloutStackHandler && CalloutMod ) {\n\t\t\tthis.CalloutStackHandler = function() {\n\t\t\t\tconst stack = React.useContext(CalloutMod.stack);\n\n\t\t\t\tt.callout_stack = stack;\n\t\t\t\tt.cleanCallouts();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthis.CalloutSelector.forceUpdate();\n\t\t}\n\n\t\tif ( ! this.CommunityStackHandler && StackMod ) {\n\t\t\tthis.CommunityStackHandler = function() {\n\t\t\t\tconst stack = React.useContext(StackMod.stack),\n\t\t\t\t\tdispatch = React.useContext(StackMod.dispatch);\n\n\t\t\t\tt.community_stack = stack;\n\t\t\t\tt.community_dispatch = dispatch;\n\n\t\t\t\tt.cleanHighlights();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthis.ChatContainer.forceUpdate();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\n\tupdateChatState(state) {\n\t\tconst old_state = this.chat.context.get('context.chat_state') || {};\n\t\tif ( deep_equals(state, old_state) )\n\t\t\treturn;\n\n\t\tthis.chat.context.updateContext({\n\t\t\tchat_state: state\n\t\t});\n\n\t\tthis.input.updateInput();\n\t}\n\n\n\ttryUpdateBadges() {\n\t\tif ( !this._badge_timer )\n\t\t\tthis._badge_timer = setTimeout(() => this._tryUpdateBadges(), 0);\n\t}\n\n\t_tryUpdateBadges() {\n\t\tif ( this._badge_timer )\n\t\t\tclearTimeout(this._badge_timer);\n\t\tthis._badge_timer = null;\n\n\t\tthis.log.info('Trying to update badge data from the chat container.');\n\t\tconst inst = this.ChatContainer.first;\n\t\tif ( inst )\n\t\t\tthis.containerUpdated(inst, inst.props);\n\t}\n\n\n\twrapChatBuffer(cls) {\n\t\tif ( cls.prototype._ffz_was_here )\n\t\t\treturn;\n\n\t\tconst t = this,\n\t\t\told_clear = cls.prototype.clear,\n\t\t\told_flush = cls.prototype.flushRawMessages,\n\t\t\told_mount = cls.prototype.componentDidMount;\n\n\t\tcls.prototype._ffzInstall = function() {\n\t\t\tif ( this._ffz_installed )\n\t\t\t\treturn;\n\n\t\t\tthis._ffz_installed = true;\n\n\t\t\tconst inst = this,\n\t\t\t\told_handle = inst.handleMessage,\n\t\t\t\told_set = inst.props.setMessageBufferAPI;\n\n\t\t\tinst.props.setMessageBufferAPI = function(api) {\n\t\t\t\tif ( api )\n\t\t\t\t\tapi._ffz_inst = inst;\n\n\t\t\t\treturn old_set(api);\n\t\t\t}\n\n\t\t\tinst.handleMessage = function(msg) {\n\t\t\t\tif ( msg ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst types = t.chat_types || {},\n\t\t\t\t\t\t\tmod_types = t.mod_types || {},\n\t\t\t\t\t\t\tblocked_types = t.chat.context.get('chat.filtering.blocked-types');\n\n\t\t\t\t\t\tif ( blocked_types.has(types[msg.type]) )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( msg.type === types.ChannelPointsReward && ! isMessageEffect(msg.reward) )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( msg.type === types.RewardGift && ! t.chat.context.get('chat.bits.show-rewards') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( msg.type === types.Message ) {\n\t\t\t\t\t\t\tconst m = t.chat.standardizeMessage(msg),\n\t\t\t\t\t\t\t\tcont = inst._ffz_connector ?? inst.ffzGetConnector();\n\n\t\t\t\t\t\t\tlet room_id = m.roomID = m.roomID ? m.roomID : cont?.props?.channelID;\n\t\t\t\t\t\t\tlet room = m.roomLogin = m.roomLogin ? m.roomLogin : m.channel ? m.channel.slice(1) : cont?.props?.channelLogin;\n\n\t\t\t\t\t\t\tif ( ! room && room_id ) {\n\t\t\t\t\t\t\t\tconst r = t.chat.getRoom(room_id, null, true);\n\t\t\t\t\t\t\t\tif ( r && r.login )\n\t\t\t\t\t\t\t\t\troom = m.roomLogin = r.login;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( ! room_id && room ) {\n\t\t\t\t\t\t\t\tconst r = t.chat.getRoom(null, room, true);\n\t\t\t\t\t\t\t\tif ( r && r.id )\n\t\t\t\t\t\t\t\t\troom_id = m.roomID = r.id;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst u = t.site.getUser();\n\t\t\t\t\t\t\tif ( u && cont ) {\n\t\t\t\t\t\t\t\tu.moderator = cont.props.isCurrentUserModerator;\n\t\t\t\t\t\t\t\tu.staff = cont.props.isStaff;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tm.ffz_tokens = m.ffz_tokens || t.chat.tokenizeMessage(m, u, true);\n\t\t\t\t\t\t\tif ( m.ffz_removed )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tif ( t.hasListeners('chat:receive-message') ) {\n\t\t\t\t\t\t\t\tconst event = t.makeEvent({\n\t\t\t\t\t\t\t\t\tmessage: m,\n\t\t\t\t\t\t\t\t\tinst,\n\t\t\t\t\t\t\t\t\tchannel: room,\n\t\t\t\t\t\t\t\t\tchannelID: room_id\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tt.emit('chat:receive-message', event);\n\t\t\t\t\t\t\t\tif ( event.defaultPrevented || m.ffz_removed )\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} /*else if ( msg.type === types.ModerationAction ) {\n\t\t\t\t\t\t\tt.emit('chat:mod-user', msg.moderationActionType, )\n\n\t\t\t\t\t\t} */ else if ( msg.type === types.Moderation ) {\n\t\t\t\t\t\t\tt.emit('chat:mod-user', msg.moderationType, msg.userLogin, msg.targetMessageID, msg);\n\n\t\t\t\t\t\t\t// Special handling\n\t\t\t\t\t\t\tif ( ! inst.props.isCurrentUserModerator ) {\n\t\t\t\t\t\t\t\tconst type = msg.moderationType,\n\t\t\t\t\t\t\t\t\ttarget = msg.userLogin;\n\n\t\t\t\t\t\t\t\t// Whee~\n\t\t\t\t\t\t\t\tlet mat;\n\t\t\t\t\t\t\t\tif ( type === mod_types.Ban )\n\t\t\t\t\t\t\t\t\tmat = 'ban';\n\t\t\t\t\t\t\t\telse if ( type === mod_types.Timeout )\n\t\t\t\t\t\t\t\t\tmat = 'timeout';\n\t\t\t\t\t\t\t\telse if ( type === mod_types.Delete )\n\t\t\t\t\t\t\t\t\tmat = 'delete';\n\n\t\t\t\t\t\t\t\tif ( mat )\n\t\t\t\t\t\t\t\t\tmsg.moderationActionType = mat;\n\n\t\t\t\t\t\t\t\t// Handle moderation events ourself if it's not\n\t\t\t\t\t\t\t\t// a delete, so that we can pass the action info.\n\t\t\t\t\t\t\t\tif ( ! inst.moderatedUsers.has(target) && type !== mod_types.Delete ) {\n\t\t\t\t\t\t\t\t\tinst.moderateBuffers(\n\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\tinst.buffer,\n\t\t\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.map(e => e.event)\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\ttarget,\n\t\t\t\t\t\t\t\t\t\tmsg\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.push({\n\t\t\t\t\t\t\t\t\t\tevent: msg,\n\t\t\t\t\t\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\t\t\t\t\t\tshouldDelay: false\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} /*else if ( msg.type === types.ModerationAction && false && inst.markUserEventDeleted && inst.unsetModeratedUser ) {\n\t\t\t\t\t\t\tif ( !((! msg.level || ! msg.level.length) && msg.targetUserLogin && msg.targetUserLogin === inst.props.currentUserLogin) ) {\n\t\t\t\t\t\t\t\t//t.log.info('Moderation Action', msg);\n\t\t\t\t\t\t\t\tif ( ! inst.props.isCurrentUserModerator )\n\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\tconst mod_action = msg.moderationActionType;\n\t\t\t\t\t\t\t\tif ( mod_action === 'ban' || mod_action === 'timeout' || mod_action === 'delete' ) {\n\t\t\t\t\t\t\t\t\tconst user = msg.targetUserLogin;\n\t\t\t\t\t\t\t\t\tif ( inst.moderatedUsers.has(user) )\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\tconst do_remove = t.chat.context.get('chat.filtering.remove-deleted') === 3;\n\t\t\t\t\t\t\t\t\tif ( do_remove ) {\n\t\t\t\t\t\t\t\t\t\tconst len = inst.buffer.length,\n\t\t\t\t\t\t\t\t\t\t\ttarget_id = msg.messageID;\n\t\t\t\t\t\t\t\t\t\tinst.buffer = inst.buffer.filter(m =>\n\t\t\t\t\t\t\t\t\t\t\tm.type !== types.Message || ! m.user || m.user.userLogin !== user ||\n\t\t\t\t\t\t\t\t\t\t\t(target_id && m.id !== target_id)\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tif ( len !== inst.buffer.length && ! inst.props.isBackground )\n\t\t\t\t\t\t\t\t\t\t\tinst.notifySubscribers();\n\n\t\t\t\t\t\t\t\t\t\tinst.moderateBuffers([\n\t\t\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.map(e => e.event)\n\t\t\t\t\t\t\t\t\t\t], user, msg);\n\n\t\t\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t\t\t\tinst.moderateBuffers([\n\t\t\t\t\t\t\t\t\t\t\tinst.buffer,\n\t\t\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.map(e => e.event)\n\t\t\t\t\t\t\t\t\t\t], user, msg);\n\n\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.push({\n\t\t\t\t\t\t\t\t\t\tevent: msg,\n\t\t\t\t\t\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\t\t\t\t\t\tshouldDelay: false\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else if ( msg.type === types.Moderation && false && inst.unsetModeratedUser ) {\n\t\t\t\t\t\t\t//t.log.info('Moderation', msg);\n\t\t\t\t\t\t\tif ( inst.props.isCurrentUserModerator )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tconst user = msg.userLogin;\n\t\t\t\t\t\t\tif ( inst.moderatedUsers.has(user) )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tconst mod_action = msg.moderationType;\n\t\t\t\t\t\t\tlet new_action;\n\t\t\t\t\t\t\tif ( mod_action === mod_types.Ban )\n\t\t\t\t\t\t\t\tnew_action = 'ban';\n\t\t\t\t\t\t\telse if ( mod_action === mod_types.Delete )\n\t\t\t\t\t\t\t\tnew_action = 'delete';\n\t\t\t\t\t\t\telse if ( mod_action === mod_types.Unban )\n\t\t\t\t\t\t\t\tnew_action = 'unban';\n\t\t\t\t\t\t\telse if ( mod_action === mod_types.Timeout )\n\t\t\t\t\t\t\t\tnew_action = 'timeout';\n\n\t\t\t\t\t\t\tif ( new_action )\n\t\t\t\t\t\t\t\tmsg.moderationActionType = new_action;\n\n\t\t\t\t\t\t\tconst do_remove = t.chat.context.get('chat.filtering.remove-deleted') === 3;\n\t\t\t\t\t\t\tif ( do_remove ) {\n\t\t\t\t\t\t\t\tconst len = inst.buffer.length,\n\t\t\t\t\t\t\t\t\ttarget_id = msg.targetMessageID;\n\t\t\t\t\t\t\t\tinst.buffer = inst.buffer.filter(m =>\n\t\t\t\t\t\t\t\t\tm.type !== types.Message || ! m.user || m.user.userLogin !== user ||\n\t\t\t\t\t\t\t\t\t(target_id && m.id !== target_id)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif ( len !== inst.buffer.length && ! inst.props.isBackground )\n\t\t\t\t\t\t\t\t\tinst.notifySubscribers();\n\n\t\t\t\t\t\t\t\tinst.moderateBuffers([\n\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.map(e => e.event)\n\t\t\t\t\t\t\t\t], user, msg);\n\n\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t\tinst.moderateBuffers([\n\t\t\t\t\t\t\t\t\tinst.buffer,\n\t\t\t\t\t\t\t\t\tinst.delayedMessageBuffer.map(e => e.event)\n\t\t\t\t\t\t\t\t], user, msg);\n\n\t\t\t\t\t\t\tinst.delayedMessageBuffer.push({\n\t\t\t\t\t\t\t\tevent: msg,\n\t\t\t\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\t\t\t\tshouldDelay: false\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t} */ else if ( msg.type === types.Clear ) {\n\t\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.ignore-clear') )\n\t\t\t\t\t\t\t\tmsg = {\n\t\t\t\t\t\t\t\t\ttype: types.Info,\n\t\t\t\t\t\t\t\t\tmessage: t.i18n.t('chat.ignore-clear', 'An attempt by a moderator to clear chat was ignored.')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tt.emit('chat:clear-chat', msg);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.error('Error processing chat event.', err);\n\t\t\t\t\t\tt.log.capture(err, {extra: {msg}});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn old_handle.call(inst, msg);\n\t\t\t}\n\n\t\t\t/*inst.ffzModerateBuffer = function(buffers, event) {\n\t\t\t\tconst mod_types = t.mod_types || {},\n\t\t\t\t\tctypes = t.chat_types || {},\n\t\t\t\t\tmod_type = event.moderationActionType,\n\t\t\t\t\tuser_login = event.targetUserLogin || event.userLogin,\n\t\t\t\t\tmod_login = event.createdByLogin,\n\t\t\t\t\ttarget_id = event.targetMessageID || event.messageID;\n\n\t\t\t\tlet deleted_count = 0, last_msg;\n\n\t\t\t\tconst is_delete = mod_type === mod_types.Delete,\n\t\t\t\t\tupdater = m => {\n\t\t\t\t\t\tif ( m.event )\n\t\t\t\t\t\t\tm = m.event;\n\n\t\t\t\t\t\t/*if ( m.message && m.type in [ctypes.ChannelPointsReward, ctypes.Resubscription, ctypes.Ritual] )\n\t\t\t\t\t\t\tm = m.message;/\n\n\t\t\t\t\t\tif ( m.reply ) {\n\t\t\t\t\t\t\tif ( target_id ? target_id === m.reply.parentMsgId : (user_login && user_login === m.reply.parentUserLogin) )\n\t\t\t\t\t\t\t\tm.reply = {\n\t\t\t\t\t\t\t\t\t...m.reply,\n\t\t\t\t\t\t\t\t\tparentDeleted: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( ! user_login || ! m.user || user_login !== m.user.userLogin || ! m.messageParts )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( ! m || m.deleted )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( target_id && m.id !== target_id )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tm.deleted = true;\n\t\t\t\t\t\tm.banned = mod_type === mod_types.Ban;\n\n\t\t\t\t\t\tlast_msg = m;\n\t\t\t\t\t\tdeleted_count++;\n\n\t\t\t\t\t\tm.modLogin = mod_login;\n\t\t\t\t\t\tm.modActionType = mod_type;\n\t\t\t\t\t\tm.duration = event.duration;\n\t\t\t\t\t};\n\n\t\t\t\tfor(const buffer of buffers)\n\t\t\t\t\tif ( buffer.some(updater) )\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t//t.log.info('Moderate Buffer', mod_type, user_login, mod_login, target_id, deleted_count, last_msg);\n\n\t\t\t\tif ( last_msg )\n\t\t\t\t\tlast_msg.deletedCount = deleted_count;\n\t\t\t}*/\n\n\t\t\tinst.setPaused = function(paused) {\n\t\t\t\tif ( inst.paused === paused )\n\t\t\t\t\treturn;\n\n\t\t\t\tinst.paused = paused;\n\t\t\t\tif ( ! paused ) {\n\t\t\t\t\tinst.slidingWindowEnd = Math.min(inst.buffer.length, t.chat.context.get('chat.scrollback-length'));\n\t\t\t\t\tif ( ! inst.props.isBackground )\n\t\t\t\t\t\tinst.notifySubscribers();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tinst.loadNewer = function() {\n\t\t\t\tif ( ! inst.hasNewerLeft() )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst end = Math.min(inst.buffer.length, inst.slidingWindowEnd + 40),\n\t\t\t\t\tstart = Math.max(0, end - t.chat.context.get('chat.scrollback-length'));\n\n\t\t\t\tinst.clear(inst.buffer.length - start);\n\t\t\t\tinst.slidingWindowEnd = end - start;\n\t\t\t\tif ( ! inst.props.isBackground )\n\t\t\t\t\tinst.notifySubscribers();\n\t\t\t}\n\n\t\t\tinst.loadNewest = function() {\n\t\t\t\tif ( ! inst.hasNewerLeft() )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst max_size = t.chat.context.get('chat.scrollback-length');\n\n\t\t\t\tinst.clear(max_size);\n\t\t\t\tinst.slidingWindowEnd = Math.min(max_size, inst.buffer.length);\n\t\t\t\tif ( ! inst.props.isBackground )\n\t\t\t\t\tinst.notifySubscribers();\n\t\t\t}\n\n\t\t\tinst.getMessages = function() {\n\t\t\t\treturn inst.buffer.slice(0, inst.slidingWindowEnd + (inst.ffz_extra || 0));\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.componentDidMount = function() {\n\t\t\ttry {\n\t\t\t\tthis._ffzInstall();\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error installing FFZ features onto chat buffer.', err);\n\t\t\t}\n\n\t\t\treturn old_mount.call(this);\n\t\t}\n\n\t\tcls.prototype.clear = function(count) {\n\t\t\ttry {\n\t\t\t\tif ( count == null )\n\t\t\t\t\tcount = 0;\n\n\t\t\t\tconst max_size = t.chat.context.get('chat.scrollback-length');\n\t\t\t\tif ( ! this.isPaused() && count > max_size )\n\t\t\t\t\tcount = max_size;\n\n\t\t\t\tif ( count <= 0 ) {\n\t\t\t\t\tthis.ffz_extra = 0;\n\t\t\t\t\tthis.buffer = [];\n\t\t\t\t\tthis.delayedMessageBuffer = [];\n\t\t\t\t\tthis.paused = false;\n\n\t\t\t\t} else {\n\t\t\t\t\tconst buffer = this.buffer,\n\t\t\t\t\t\tct = t.chat_types || CHAT_TYPES,\n\t\t\t\t\t\ttarget = buffer.length - count;\n\n\t\t\t\t\tif ( target > 0 ) {\n\t\t\t\t\t\tlet removed = 0, last;\n\t\t\t\t\t\tfor(let i=0; i < target; i++)\n\t\t\t\t\t\t\tif ( buffer[i] && ! NULL_TYPES.includes(ct[buffer[i].type]) ) {\n\t\t\t\t\t\t\t\tremoved++;\n\t\t\t\t\t\t\t\tlast = i;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// When we remove less then expected, we want to keep track\n\t\t\t\t\t\t// of that so we can return the extra messages from getMessages.\n\t\t\t\t\t\tthis.buffer = buffer.slice(removed % 2 !== 0 ? Math.max(target - 4, last) : target);\n\t\t\t\t\t\tthis.ffz_extra = buffer.length - count;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.ffz_extra = 0;\n\t\t\t\t\t\tthis.buffer = this.buffer.slice(0);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.paused && this.buffer.length >= 900 )\n\t\t\t\t\t\tthis.setPaused(false);\n\t\t\t\t}\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error running clear', err);\n\t\t\t\treturn old_clear.call(this, count);\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.ffzGetConnector = function() {\n\t\t\tif ( this._ffz_connector )\n\t\t\t\treturn this._ffz_connector;\n\n\t\t\tconst now = Date.now();\n\t\t\tif ( now - (this._ffz_connect_tried || 0) > 5000 ) {\n\t\t\t\tthis._ffz_connect_tried = now;\n\t\t\t\tconst thing = t.ChatBufferConnector.first;\n\t\t\t\tif ( thing?.props?.messageBufferAPI?._ffz_inst === this )\n\t\t\t\t\treturn this._ffz_connector = thing;\n\t\t\t}\n\t\t}\n\n\t\tcls.prototype.flushRawMessages = function() {\n\t\t\ttry {\n\t\t\t\tconst out = [],\n\t\t\t\t\tct = t.chat_types || CHAT_TYPES,\n\t\t\t\t\tnow = Date.now(),\n\t\t\t\t\traw_delay = t.chat.context.get('chat.delay'),\n\t\t\t\t\tdelay = raw_delay === -1 ? this.delayDuration : raw_delay,\n\t\t\t\t\tfirst = now - delay,\n\t\t\t\t\tsee_deleted = this.shouldSeeBlockedAndDeletedMessages || this.props && this.props.shouldSeeBlockedAndDeletedMessages,\n\t\t\t\t\thas_newer = this.hasNewerLeft(),\n\t\t\t\t\tpaused = this.isPaused(),\n\t\t\t\t\tmax_size = t.chat.context.get('chat.scrollback-length'),\n\t\t\t\t\tdo_remove = t.chat.context.get('chat.filtering.remove-deleted'),\n\n\t\t\t\t\twant_event = t.hasListeners('chat:buffer-message');\n\n\t\t\t\tlet added = 0,\n\t\t\t\t\tbuffered = this.slidingWindowEnd,\n\t\t\t\t\tchanged = false,\n\t\t\t\t\tevent;\n\n\t\t\t\tfor(const msg of this.delayedMessageBuffer) {\n\t\t\t\t\tif ( msg.time <= first || ! msg.shouldDelay ) {\n\t\t\t\t\t\tif ( do_remove !== 0 && (do_remove > 1 || ! see_deleted) && this.isDeletable(msg.event) && msg.event.deleted )\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\tif ( want_event ) {\n\t\t\t\t\t\t\tif ( ! event ) {\n\t\t\t\t\t\t\t\tevent = t.makeEvent({\n\t\t\t\t\t\t\t\t\tinst: this,\n\t\t\t\t\t\t\t\t\tchannel: undefined,\n\t\t\t\t\t\t\t\t\tchannelID: undefined,\n\t\t\t\t\t\t\t\t\tmessage: undefined\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconst cont = this._ffz_connector ?? this.ffzGetConnector(),\n\t\t\t\t\t\t\t\t\troom_id = cont && cont.props.channelID;\n\n\t\t\t\t\t\t\t\tevent.channelID = room_id;\n\n\t\t\t\t\t\t\t\tif ( room_id ) {\n\t\t\t\t\t\t\t\t\tconst r = t.chat.getRoom(room_id, null, true);\n\t\t\t\t\t\t\t\t\tif ( r && r.login )\n\t\t\t\t\t\t\t\t\t\tevent.channel = r.login;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t\tevent._reset();\n\n\t\t\t\t\t\t\tevent.message = msg.event;\n\t\t\t\t\t\t\tt.emit('chat:buffer-message', event);\n\t\t\t\t\t\t\tif ( event.defaultPrevented || msg.event.ffz_removed )\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst last = this.buffer[this.buffer.length - 1],\n\t\t\t\t\t\t\ttype = last?.type;\n\n\t\t\t\t\t\tif ( !(\n\t\t\t\t\t\t\t! this.props.isLoadingHistoricalMessages &&\n\t\t\t\t\t\t\t\t! this.props.historicalMessages ||\n\t\t\t\t\t\t\t\ttype !== ct.Connected ||\n\t\t\t\t\t\t\t\tmsg.event.type === ct.Connected ||\n\t\t\t\t\t\t\t\tthis.buffer.find(e => e.type === ct.LiveMessageSeparator)\n\t\t\t\t\t\t) )\n\t\t\t\t\t\t\tthis.buffer.push({\n\t\t\t\t\t\t\t\ttype: ct.LiveMessageSeparator,\n\t\t\t\t\t\t\t\tid: 'live-message-separator'\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t/*if ( type === ct.Connected ) {\n\t\t\t\t\t\t\tconst non_null = this.buffer.filter(x => x && ct[x.type] && ! NULL_TYPES.includes(ct[x.type]));\n\t\t\t\t\t\t\tif ( non_null.length > 1 )\n\t\t\t\t\t\t\t\tthis.buffer.push({\n\t\t\t\t\t\t\t\t\ttype: ct.LiveMessageSeparator,\n\t\t\t\t\t\t\t\t\tid: 'live-message-separator'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}*/\n\n\t\t\t\t\t\tthis.buffer.push(msg.event);\n\t\t\t\t\t\tchanged = true;\n\n\t\t\t\t\t\tif ( ! this.paused ) {\n\t\t\t\t\t\t\tif ( this.buffer.length > max_size )\n\t\t\t\t\t\t\t\tadded++;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tbuffered++;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else\n\t\t\t\t\t\tout.push(msg);\n\t\t\t\t}\n\n\t\t\t\tthis.delayedMessageBuffer = out;\n\t\t\t\tif ( changed ) {\n\t\t\t\t\tthis.clear(Math.min(900, this.buffer.length - added));\n\t\t\t\t\tif ( !(added === 0 && buffered === this.slidingWindowEnd && has_newer === this.hasNewerLeft() && paused === this.isPaused()) ) {\n\t\t\t\t\t\tthis.slidingWindowEnd = buffered;\n\t\t\t\t\t\tif ( ! this.props.isBackground )\n\t\t\t\t\t\t\tthis.notifySubscribers();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( this.flushHighlightsBuffer )\n\t\t\t\t\tthis.flushHighlightsBuffer();\n\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error running flush.', err);\n\t\t\t\treturn old_flush.call(this);\n\t\t\t}\n\t\t}\n\t}\n\n\n\taddNotice(room, message) {\n\t\tif ( ! room )\n\t\t\treturn false;\n\n\t\tif ( room.startsWith('#') )\n\t\t\troom = room.slice(1);\n\n\t\troom = room.toLowerCase();\n\n\t\tfor(const inst of this.ChatService.instances) {\n\t\t\tif ( room === '*' || inst.props.channelLogin.toLowerCase() === room ) {\n\t\t\t\tif ( typeof message === 'string' )\n\t\t\t\t\tinst.addMessage({\n\t\t\t\t\t\ttype: (this.chat_types ?? CHAT_TYPES).Notice,\n\t\t\t\t\t\tmessage\n\t\t\t\t\t});\n\t\t\t\telse {\n\t\t\t\t\tconst props = inst.props,\n\t\t\t\t\t\tlogin = props.channelLogin,\n\t\t\t\t\t\tid = props.channelID;\n\n\t\t\t\t\tif ( message.markdown ) {\n\t\t\t\t\t\tconst md = getMD();\n\t\t\t\t\t\tif ( ! md )\n\t\t\t\t\t\t\tawaitMD();\n\t\t\t\t\t}\n\n\t\t\t\t\tinst.addMessage({\n\t\t\t\t\t\ttype: (this.chat_types ?? CHAT_TYPES).Message,\n\t\t\t\t\t\tchannel: `#${login}`,\n\t\t\t\t\t\troomID: id,\n\t\t\t\t\t\troomLogin: login,\n\t\t\t\t\t\tid: `ffz_notice_${generateUUID()}`,\n\t\t\t\t\t\tffz_type: 'notice',\n\t\t\t\t\t\tffz_no_actions: true,\n\t\t\t\t\t\tffz_data: message,\n\t\t\t\t\t\tmessage: null,\n\t\t\t\t\t\tmessageParts: [],\n\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tuserID: id,\n\t\t\t\t\t\t\tuserLogin: login\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\n\tsendMessage(room, message) {\n\t\tconst service = this.ChatService.first;\n\n\t\tif ( ! service || ! room )\n\t\t\treturn null;\n\n\t\tif ( room.startsWith('#') )\n\t\t\troom = room.slice(1);\n\n\t\tif ( room.toLowerCase() !== service.props.channelLogin.toLowerCase() )\n\t\t\treturn service.client.sendCommand(room, message);\n\n\t\tservice.sendMessage(message);\n\t}\n\n\n\tscheduleMystery(mystery) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! mystery.line )\n\t\t\treturn;\n\n\t\tif ( mystery._timer )\n\t\t\treturn;\n\n\t\tmystery._timer = setTimeout(() => requestAnimationFrame(() => {\n\t\t\tmystery._timer = null;\n\t\t\tif ( mystery.line )\n\t\t\t\tmystery.line.forceUpdate();\n\t\t}), 250);\n\t}\n\n\n\twrapChatService(cls) {\n\t\tconst t = this,\n\t\t\told_mount = cls.prototype.componentDidMount,\n\t\t\told_handler = cls.prototype.addEventListeners;\n\n\t\tcls.prototype._ffz_was_here = true;\n\n\t\tcls.prototype._ffzInstall = function() {\n\t\t\tif ( this._ffz_installed )\n\t\t\t\treturn;\n\n\t\t\tthis._ffz_installed = true;\n\n\t\t\tconst inst = this,\n\t\t\t\told_send = this.sendMessage,\n\t\t\t\taddMessage = (...args) => inst.addMessage(...args),\n\t\t\t\tsendMessage = (msg, extra) => inst.sendMessage(msg, extra);\n\n\t\t\tinst.sendMessage = function(msg, extra) {\n\t\t\t\tmsg = msg.replace(/\\s+/g, ' ');\n\n\t\t\t\tif ( msg.startsWith('/ffz:') ) {\n\t\t\t\t\tmsg = msg.slice(5).trim();\n\t\t\t\t\tconst idx = msg.indexOf(' ');\n\t\t\t\t\tlet subcmd;\n\t\t\t\t\tif ( idx === -1 ) {\n\t\t\t\t\t\tsubcmd = msg;\n\t\t\t\t\t\tmsg = '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsubcmd = msg.slice(0, idx);\n\t\t\t\t\t\tmsg = msg.slice(idx + 1).trimStart();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst event = t.makeEvent({\n\t\t\t\t\t\tcommand: subcmd,\n\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\textra,\n\t\t\t\t\t\tcontext: t.chat.context,\n\t\t\t\t\t\tchannel: inst.props.channelLogin,\n\t\t\t\t\t\t_inst: inst,\n\t\t\t\t\t\taddMessage,\n\t\t\t\t\t\tsendMessage\n\t\t\t\t\t});\n\n\t\t\t\t\tconst topic = `chat:ffz-command:${subcmd}`,\n\t\t\t\t\t\tlisteners = t.listeners(topic);\n\n\t\t\t\t\tif ( listeners?.length > 0 )\n\t\t\t\t\t\tt.emit(topic, event);\n\t\t\t\t\telse\n\t\t\t\t\t\tinst.addMessage({\n\t\t\t\t\t\t\ttype: t.chat_types.Notice,\n\t\t\t\t\t\t\tmessage: t.i18n.t('chat.ffz-command.invalid', 'No such command: /ffz:{subcmd}', {subcmd})\n\t\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst event = t.makeEvent({\n\t\t\t\t\tmessage: msg,\n\t\t\t\t\textra,\n\t\t\t\t\tcontext: t.chat.context,\n\t\t\t\t\tchannel: inst.props.channelLogin,\n\t\t\t\t\t_inst: inst,\n\t\t\t\t\taddMessage,\n\t\t\t\t\tsendMessage\n\t\t\t\t});\n\n\t\t\t\tt.emit('chat:pre-send-message', event);\n\n\t\t\t\tif ( event.defaultPrevented )\n\t\t\t\t\treturn;\n\n\t\t\t\treturn old_send.call(this, event.message, event.extra);\n\t\t\t}\n\t\t}\n\n\n\t\tcls.prototype.componentDidMount = function() {\n\t\t\ttry {\n\t\t\t\tthis._ffzInstall();\n\t\t\t} catch(err) {\n\t\t\t\tt.log.error('Error installing FFZ features onto chat service.', err);\n\t\t\t}\n\n\t\t\treturn old_mount.call(this);\n\t\t}\n\n\n\t\tcls.prototype.addEventListeners = function(...args) {\n\t\t\tif ( ! this._ffz_init ) {\n\t\t\t\tconst i = this;\n\n\t\t\t\tfor(const key of MISBEHAVING_EVENTS) {\n\t\t\t\t\tconst original = this[key];\n\t\t\t\t\tif ( original )\n\t\t\t\t\t\tthis[key] = function(e, t) {\n\t\t\t\t\t\t\ti._wrapped = e;\n\t\t\t\t\t\t\tconst ret = original.call(i, e, t);\n\t\t\t\t\t\t\ti._wrapped = null;\n\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_announce = this.onAnnouncementEvent;\n\t\t\t\tthis.onAnnouncementEvent = function(e) {\n\t\t\t\t\t//console.log('announcement', e);\n\t\t\t\t\treturn old_announce.call(this, e);\n\t\t\t\t}\n\n\n\t\t\t\tconst old_sub = this.onSubscriptionEvent;\n\t\t\t\tthis.onSubscriptionEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('Subscription') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling || t.chat.context.get('chat.subs.native') )\n\t\t\t\t\t\t\treturn old_sub.call(i, e);\n\n\t\t\t\t\t\tif ( t.chat.context.get('chat.subs.show') < 3 )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\te.body = '';\n\t\t\t\t\t\tconst out = i.convertMessage({message: e});\n\t\t\t\t\t\tout.ffz_type = 'resub';\n\t\t\t\t\t\tout.gift_theme = e.giftTheme;\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.sub_goal = i.getGoalData ? i.getGoalData(e.goalData) : null;\n\t\t\t\t\t\tout.sub_plan = e.methods;\n\t\t\t\t\t\tout.sub_multi = e.multiMonthData?.multiMonthDuration ? {\n\t\t\t\t\t\t\tcount: e.multiMonthData.multiMonthDuration,\n\t\t\t\t\t\t\ttenure: e.multiMonthData.multiMonthTenure\n\t\t\t\t\t\t} : null;\n\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_sub.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_state = this.onRoomStateEvent;\n\t\t\t\tthis.onRoomStateEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst channel = e.channel,\n\t\t\t\t\t\t\tcurrent = t.chat.context.get('context.channel');\n\n\t\t\t\t\t\tif ( channel && (channel === current || channel === `#${current}`) )\n\t\t\t\t\t\t\tt.updateChatState(e.state);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn old_state.call(i, e);\n\t\t\t\t}\n\n\t\t\t\tconst old_pinned = this.onPinnedChatEvent;\n\t\t\t\tthis.onPinnedChatEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst setting = t.chat.context.get('chat.hype.message-style');\n\t\t\t\t\t\tif ( setting !== 1 ) {\n\t\t\t\t\t\t\t// Drop messages with no message if we're not displaying them.\n\t\t\t\t\t\t\tif ( e.isSystemMessage && setting === 0 )\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\tconst out = i.convertMessage(e);\n\t\t\t\t\t\t\tout.ffz_type = 'hype';\n\t\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\t\tout.hype_amount = e.amount;\n\t\t\t\t\t\t\tout.hype_canonical_amount = e.canonical_amount;\n\t\t\t\t\t\t\tout.hype_currency = e.currency;\n\t\t\t\t\t\t\tout.hype_exponent = e.exponent;\n\t\t\t\t\t\t\tout.hype_level = e.level;\n\n\t\t\t\t\t\t\tif ( e.isSystemMessage ) {\n\t\t\t\t\t\t\t\t// Delete the message it comes with.\n\t\t\t\t\t\t\t\tout.message = '';\n\t\t\t\t\t\t\t\tout.messageBody = '';\n\t\t\t\t\t\t\t\tout.messageParts = [];\n\t\t\t\t\t\t\t\te.message.body = '';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t//t.log.info('Pinned Event', e, out);\n\n\t\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn old_pinned.call(i, e);\n\t\t\t\t}\n\n\t\t\t\tconst old_resub = this.onResubscriptionEvent;\n\t\t\t\tthis.onResubscriptionEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('Resubscription') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling || t.chat.context.get('chat.subs.native')  )\n\t\t\t\t\t\t\treturn old_resub.call(i, e);\n\n\t\t\t\t\t\tif ( t.chat.context.get('chat.subs.show') < 2 && ! e.body )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tconst out = i.convertMessage({message: e});\n\t\t\t\t\t\tout.ffz_type = 'resub';\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.gift_theme = e.giftTheme;\n\t\t\t\t\t\tout.sub_goal = i.getGoalData ? i.getGoalData(e.goalData) : null;\n\t\t\t\t\t\tout.sub_cumulative = e.cumulativeMonths || 0;\n\t\t\t\t\t\tout.sub_streak = e.streakMonths || 0;\n\t\t\t\t\t\tout.sub_share_streak = e.shouldShareStreakTenure;\n\t\t\t\t\t\tout.sub_months = e.months;\n\t\t\t\t\t\tout.sub_plan = e.methods;\n\t\t\t\t\t\tout.sub_multi = e.multiMonthData?.multiMonthDuration ? {\n\t\t\t\t\t\t\tcount: e.multiMonthData.multiMonthDuration,\n\t\t\t\t\t\t\ttenure: e.multiMonthData.multiMonthTenure\n\t\t\t\t\t\t} : null;\n\n\t\t\t\t\t\t//t.log.info('Resub Event', e, out);\n\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_resub.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst mysteries = this.ffz_mysteries = {};\n\n\t\t\t\tconst old_subgift = this.onSubscriptionGiftEvent;\n\t\t\t\tthis.onSubscriptionGiftEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('SubGift') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling || t.chat.context.get('chat.subs.native')  )\n\t\t\t\t\t\t\treturn old_subgift.call(i, e);\n\n\t\t\t\t\t\tconst key = `${e.channel}:${e.user.userID}`,\n\t\t\t\t\t\t\tmystery = mysteries[key];\n\n\t\t\t\t\t\tif ( mystery ) {\n\t\t\t\t\t\t\tif ( mystery.expires < Date.now() ) {\n\t\t\t\t\t\t\t\tmysteries[key] = null;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmystery.recipients.push({\n\t\t\t\t\t\t\t\t\tid: e.recipientID,\n\t\t\t\t\t\t\t\t\tlogin: e.recipientLogin,\n\t\t\t\t\t\t\t\t\tdisplayName: e.recipientName\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif( mystery.recipients.length >= mystery.size )\n\t\t\t\t\t\t\t\t\tmysteries[key] = null;\n\n\t\t\t\t\t\t\t\tif ( mystery.line )\n\t\t\t\t\t\t\t\t\tt.scheduleMystery(mystery);\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.body = '';\n\t\t\t\t\t\tconst out = i.convertMessage({message: e});\n\t\t\t\t\t\tout.ffz_type = 'sub_gift';\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.sub_recipient = {\n\t\t\t\t\t\t\tid: e.recipientID,\n\t\t\t\t\t\t\tlogin: e.recipientLogin,\n\t\t\t\t\t\t\tdisplayName: e.recipientName\n\t\t\t\t\t\t};\n\t\t\t\t\t\tout.gift_theme = e.giftTheme;\n\t\t\t\t\t\tout.sub_goal = i.getGoalData ? i.getGoalData(e.goalData) : null;\n\t\t\t\t\t\tout.sub_months = e.giftMonths;\n\t\t\t\t\t\tout.sub_plan = e.methods;\n\t\t\t\t\t\tout.sub_total = e.senderCount;\n\n\t\t\t\t\t\t//t.log.info('Sub Gift', e, out);\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_subgift.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_communityintro = this.onCommunityIntroductionEvent;\n\t\t\t\tthis.onCommunityIntroductionEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.disable_handling )\n\t\t\t\t\t\t\treturn old_communityintro.call(this, e);\n\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('CommunityIntroduction') ) {\n\t\t\t\t\t\t\tconst out = i.convertMessage(e);\n\t\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\tt.log.error(err);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn old_communityintro.call(this, e);\n\t\t\t\t}\n\n\t\t\t\tconst old_anonsubgift = this.onAnonSubscriptionGiftEvent;\n\t\t\t\tthis.onAnonSubscriptionGiftEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('AnonSubGift') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling || t.chat.context.get('chat.subs.native')  )\n\t\t\t\t\t\t\treturn old_anonsubgift.call(i, e);\n\n\t\t\t\t\t\tconst key = `${e.channel}:ANON`,\n\t\t\t\t\t\t\tmystery = mysteries[key];\n\n\t\t\t\t\t\tif ( mystery ) {\n\t\t\t\t\t\t\tif ( mystery.expires < Date.now() )\n\t\t\t\t\t\t\t\tmysteries[key] = null;\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tmystery.recipients.push({\n\t\t\t\t\t\t\t\t\tid: e.recipientID,\n\t\t\t\t\t\t\t\t\tlogin: e.recipientLogin,\n\t\t\t\t\t\t\t\t\tdisplayName: e.recipientName\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif( mystery.recipients.length >= mystery.size )\n\t\t\t\t\t\t\t\t\tmysteries[key] = null;\n\n\t\t\t\t\t\t\t\tif ( mystery.line )\n\t\t\t\t\t\t\t\t\tt.scheduleMystery(mystery);\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.body = '';\n\t\t\t\t\t\tconst out = i.convertMessage({message: e});\n\t\t\t\t\t\tout.ffz_type = 'sub_gift';\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.gift_theme = e.giftTheme;\n\t\t\t\t\t\tout.sub_goal = i.getGoalData ? i.getGoalData(e.goalData) : null;\n\t\t\t\t\t\tout.sub_anon = true;\n\t\t\t\t\t\tout.sub_recipient = {\n\t\t\t\t\t\t\tid: e.recipientID,\n\t\t\t\t\t\t\tlogin: e.recipientLogin,\n\t\t\t\t\t\t\tdisplayName: e.recipientName\n\t\t\t\t\t\t};\n\t\t\t\t\t\tout.sub_months = e.giftMonths;\n\t\t\t\t\t\tout.sub_plan = e.methods;\n\t\t\t\t\t\tout.sub_total = e.senderCount;\n\n\t\t\t\t\t\t//t.log.info('Anon Sub Gift', e, out);\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_anonsubgift.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_submystery = this.onSubscriptionMysteryGiftEvent;\n\t\t\t\tthis.onSubscriptionMysteryGiftEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('SubMysteryGift') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling || t.chat.context.get('chat.subs.native')  )\n\t\t\t\t\t\t\treturn old_submystery.call(i, e);\n\n\t\t\t\t\t\tlet mystery = null;\n\t\t\t\t\t\tif ( e.massGiftCount > t.chat.context.get('chat.subs.merge-gifts') ) {\n\t\t\t\t\t\t\tconst key = `${e.channel}:${e.user.userID}`;\n\t\t\t\t\t\t\tmystery = mysteries[key] = {\n\t\t\t\t\t\t\t\trecipients: [],\n\t\t\t\t\t\t\t\tsize: e.massGiftCount,\n\t\t\t\t\t\t\t\texpires: Date.now() + 30000\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.body = '';\n\t\t\t\t\t\tconst out = i.convertMessage({message: e});\n\t\t\t\t\t\tout.ffz_type = 'sub_mystery';\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.gift_theme = e.giftTheme;\n\t\t\t\t\t\tout.sub_goal = i.getGoalData ? i.getGoalData(e.goalData) : null;\n\t\t\t\t\t\tout.mystery = mystery;\n\t\t\t\t\t\tout.sub_plan = e.plan;\n\t\t\t\t\t\tout.sub_count = e.massGiftCount;\n\t\t\t\t\t\tout.sub_total = e.senderCount;\n\n\t\t\t\t\t\t//t.log.info('Sub Mystery', e, out);\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_submystery.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_anonsubmystery = this.onAnonSubscriptionMysteryGiftEvent;\n\t\t\t\tthis.onAnonSubscriptionMysteryGiftEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('AnonSubMysteryGift') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling || t.chat.context.get('chat.subs.native')  )\n\t\t\t\t\t\t\treturn old_anonsubmystery.call(i, e);\n\n\t\t\t\t\t\tlet mystery = null;\n\t\t\t\t\t\tif ( e.massGiftCount > t.chat.context.get('chat.subs.merge-gifts') ) {\n\t\t\t\t\t\t\tconst key = `${e.channel}:ANON`;\n\t\t\t\t\t\t\tmystery = mysteries[key] = {\n\t\t\t\t\t\t\t\trecipients: [],\n\t\t\t\t\t\t\t\tsize: e.massGiftCount,\n\t\t\t\t\t\t\t\texpires: Date.now() + 30000\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.body = '';\n\t\t\t\t\t\tconst out = i.convertMessage({message: e});\n\t\t\t\t\t\tout.ffz_type = 'sub_mystery';\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.sub_anon = true;\n\t\t\t\t\t\tout.mystery = mystery;\n\t\t\t\t\t\tout.sub_plan = e.plan;\n\t\t\t\t\t\tout.sub_count = e.massGiftCount;\n\t\t\t\t\t\tout.sub_total = e.senderCount;\n\n\t\t\t\t\t\t//t.log.info('Anon Sub Mystery', e, out);\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_anonsubmystery.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_ritual = this.onRitualEvent;\n\t\t\t\tthis.onRitualEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('Ritual') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling )\n\t\t\t\t\t\t\treturn old_ritual.call(i, e);\n\n\t\t\t\t\t\tconst out = i.convertMessage(e);\n\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\tout.ffz_type = 'ritual';\n\t\t\t\t\t\tout.ritual = e.type;\n\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t\treturn old_ritual.call(i, e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst old_points = this.onChannelPointsRewardEvent;\n\t\t\t\tthis.onChannelPointsRewardEvent = function(e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( t.chat.context.get('chat.filtering.blocked-types').has('ChannelPointsReward') )\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif ( t.disable_handling )\n\t\t\t\t\t\t\treturn old_points.call(i, e);\n\n\t\t\t\t\t\tconst reward = e.rewardID && get(e.rewardID, i.props.rewardMap);\n\t\t\t\t\t\tif ( reward ) {\n\t\t\t\t\t\t\tconst out = i.convertMessage(e);\n\n\t\t\t\t\t\t\tif ( t.chat.context.get('chat.powerup.effects') && isMessageEffect(reward) && e.animationID ) {\n\t\t\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, {\n\t\t\t\t\t\t\t\t\ttype: t.chat_types.ChannelPointsReward,\n\t\t\t\t\t\t\t\t\tid: out.id,\n\t\t\t\t\t\t\t\t\tdisplayName: out.user.userDisplayName,\n\t\t\t\t\t\t\t\t\tlogin: out.user.userLogin,\n\t\t\t\t\t\t\t\t\treward: reward,\n\t\t\t\t\t\t\t\t\tmessage: out,\n\t\t\t\t\t\t\t\t\tuserID: out.user.userID,\n\t\t\t\t\t\t\t\t\tanimationID: e.animationID,\n\t\t\t\t\t\t\t\t\tsharedChat: e.sharedChat\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tout.ffz_animation_id = e.animationID;\n\t\t\t\t\t\t\t\tout.sharedChat = e.sharedChat;\n\t\t\t\t\t\t\t\tout.ffz_type = 'points';\n\t\t\t\t\t\t\t\tout.ffz_reward = reward;\n\t\t\t\t\t\t\t\tout.ffz_reward_highlight = isHighlightedReward(reward);\n\n\t\t\t\t\t\t\t\treturn i.postMessageToCurrentChannel(e, out);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tt.log.error(err);\n\t\t\t\t\t\tt.log.capture(err, {extra: e});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn old_points.call(i, e);\n\t\t\t\t}\n\n\t\t\t\t/*const old_host = this.onHostingEvent;\n\t\t\t\tthis.onHostingEvent = function (e, _t) {\n\t\t\t\t\tt.emit('tmi:host', e, _t);\n\t\t\t\t\treturn old_host.call(i, e, _t);\n\t\t\t\t}\n\n\t\t\t\tconst old_unhost = this.onUnhostEvent;\n\t\t\t\tthis.onUnhostEvent = function (e, _t) {\n\t\t\t\t\tt.emit('tmi:unhost', e, _t);\n\t\t\t\t\treturn old_unhost.call(i, e, _t);\n\t\t\t\t}*/\n\n\t\t\t\tconst old_add = this.addMessage;\n\t\t\t\tthis.addMessage = function(e) {\n\t\t\t\t\tconst original = i._wrapped;\n\t\t\t\t\tif ( original && ! e._ffz_checked )\n\t\t\t\t\t\treturn i.postMessageToCurrentChannel(original, e);\n\n\t\t\t\t\treturn old_add.call(i, e);\n\t\t\t\t}\n\n\t\t\t\tthis._ffz_init = true;\n\t\t\t}\n\n\t\t\treturn old_handler.apply(this, ...args);\n\t\t}\n\n\t\tcls.prototype.postMessageToCurrentChannel = function(original, message) {\n\t\t\tconst original_msg = message;\n\t\t\tmessage._ffz_checked = true;\n\n\t\t\t// For certain message types, the message is contained within\n\t\t\t// a message sub-object.\n\t\t\tif ( message.type === t.chat_types.ChannelPointsReward || message.type === t.chat_types.CommunityIntroduction || (message.message?.user & message.message?.badgeDynamicData) ) {\n\t\t\t\tmessage = message.message;\n\t\t\t}\n\n\t\t\tif ( original.channel ) {\n\t\t\t\tlet chan = message.channel = original.channel.toLowerCase();\n\t\t\t\tif ( chan.startsWith('#') )\n\t\t\t\t\tchan = chan.slice(1);\n\n\t\t\t\tif ( chan !== this.props.channelLogin.toLowerCase() )\n\t\t\t\t\treturn;\n\n\t\t\t\tmessage.roomLogin = chan;\n\t\t\t}\n\n\t\t\tmessage.ffz_first_msg = message.isFirstMsg || original.message?.isFirstMsg || false;\n\t\t\tmessage.ffz_returning = original.message?.isReturningChatter || false;\n\n\t\t\tif ( original.message ) {\n\t\t\t\tconst user = original.message.user,\n\t\t\t\t\tflags = original.message.flags;\n\t\t\t\tif ( user )\n\t\t\t\t\tmessage.emotes = user.emotes;\n\n\t\t\t\tif ( flags && this.getFilterFlagOptions ) {\n\t\t\t\t\tconst clear_mod = this.props.isCurrentUserModerator && t.chat.context.get('chat.automod.run-as-mod');\n\t\t\t\t\tif ( clear_mod )\n\t\t\t\t\t\tthis.props.isCurrentUserModerator = false;\n\t\t\t\t\tmessage.flags = this.getFilterFlagOptions(flags);\n\t\t\t\t\tif ( clear_mod )\n\t\t\t\t\t\tthis.props.isCurrentUserModerator = true;\n\t\t\t\t}\n\n\t\t\t\tif (! message.message || typeof message.message === 'string') {\n\t\t\t\t\tif ( typeof original.action === 'string' )\n\t\t\t\t\t\tmessage.message = original.action;\n\t\t\t\t\telse\n\t\t\t\t\t\tmessage.message = original.message.body;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.addMessage(original_msg);\n\t\t}\n\t}\n\n\n\t/*updateChatLines() {\n\t\tthis.chat_line.updateLines();\n\t}*/\n\n\n\t// ========================================================================\n\t// Room Handling\n\t// ========================================================================\n\n\taddRoom(thing, props) {\n\t\tif ( ! props )\n\t\t\tprops = thing.props;\n\n\t\tif ( ! props.channelID )\n\t\t\treturn null;\n\n\t\tconst room = thing._ffz_room = this.chat.getRoom(props.channelID, props.channelLogin && props.channelLogin.toLowerCase(), false, true);\n\t\troom.ref(thing);\n\t\treturn room;\n\t}\n\n\n\tremoveRoom(thing) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! thing._ffz_room )\n\t\t\treturn;\n\n\t\tthing._ffz_room.unref(thing);\n\t\tthing._ffz_room = null;\n\t}\n\n\n\t// ========================================================================\n\t// Chat Controller\n\t// ========================================================================\n\n\tchatMounted(chat, props) {\n\t\tif ( chat.chatBuffer )\n\t\t\tchat.chatBuffer.ffzController = chat;\n\n\t\tif ( ! props )\n\t\t\tprops = chat.props;\n\n\t\tif ( ! this.addRoom(chat, props) )\n\t\t\treturn;\n\n\t\tthis.updateRoomBitsConfig(chat, props.bitsConfig);\n\n\t\t// TODO: Check if this is the room for the current channel.\n\n\t\tthis.settings.updateContext({\n\t\t\tmoderator: props.isCurrentUserModerator,\n\t\t\tchatHidden: props.isHidden\n\t\t});\n\n\t\tif ( props.isEmbedded || props.isPopout )\n\t\t\tthis.settings.updateContext({\n\t\t\t\tchannel: props.channelLogin && props.channelLogin.toLowerCase(),\n\t\t\t\tchannelID: props.channelID\n\t\t\t});\n\n\t\tthis.chat.context.updateContext({\n\t\t\tmoderator: props.isCurrentUserModerator,\n\t\t\tchannel: props.channelLogin && props.channelLogin.toLowerCase(),\n\t\t\tchannelID: props.channelID,\n\t\t\t/*ui: {\n\t\t\t\ttheme: props.theme\n\t\t\t}*/\n\t\t});\n\t}\n\n\n\tchatUnmounted(chat) {\n\t\tif ( chat.chatBuffer && chat.chatBuffer.ffzController === this )\n\t\t\tchat.chatBuffer.ffzController = null;\n\n\t\tif ( chat.props.isEmbedded || chat.props.isPopout )\n\t\t\tthis.settings.updateContext({\n\t\t\t\tchannel: null,\n\t\t\t\tchannelID: null\n\t\t\t});\n\n\t\tthis.settings.updateContext({\n\t\t\tmoderator: false,\n\t\t\tchatHidden: false\n\t\t});\n\n\t\tthis.chat.context.updateContext({\n\t\t\tmoderator: false,\n\t\t\tchannel: null,\n\t\t\tchannelID: null\n\t\t});\n\n\t\tthis.removeRoom(chat);\n\t}\n\n\n\tchatUpdated(chat, props) {\n\t\tif ( chat.chatBuffer )\n\t\t\tchat.chatBuffer.ffzController = chat;\n\n\t\tif ( ! chat._ffz_room || props.channelID != chat._ffz_room.id ) {\n\t\t\tthis.removeRoom(chat);\n\t\t\tif ( chat._ffz_mounted )\n\t\t\t\tthis.chatMounted(chat);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( props.bitsConfig !== chat.props.bitsConfig )\n\t\t\tthis.updateRoomBitsConfig(chat, chat.props.bitsConfig);\n\n\t\t// TODO: Check if this is the room for the current channel.\n\n\t\tlet login = chat.props.channelLogin;\n\t\tif ( login )\n\t\t\tlogin = login.toLowerCase();\n\n\t\tif ( chat.props.isEmbedded || chat.props.isPopout )\n\t\t\tthis.settings.updateContext({\n\t\t\t\tchannel: login,\n\t\t\t\tchannelID: chat.props.channelID\n\t\t\t});\n\n\t\tthis.settings.updateContext({\n\t\t\tmoderator: chat.props.isCurrentUserModerator,\n\t\t\tchatHidden: chat.props.isHidden\n\t\t});\n\n\t\tthis.chat.context.updateContext({\n\t\t\tmoderator: chat.props.isCurrentUserModerator,\n\t\t\tchannel: login,\n\t\t\tchannelID: chat.props.channelID,\n\t\t\t/*ui: {\n\t\t\t\ttheme: props.theme\n\t\t\t}*/\n\t\t});\n\t}\n\n\n\tupdateRoomBitsConfig(chat, config) { // eslint-disable-line class-methods-use-this\n\t\tconst room = chat._ffz_room;\n\t\tif ( ! room )\n\t\t\treturn;\n\n\t\t// We have to check that the available cheers haven't changed\n\t\t// to avoid doing too many recalculations.\n\t\tlet new_bits = null;\n\t\tif ( config && Array.isArray(config.orderedActions) ) {\n\t\t\tnew_bits = new Set;\n\t\t\tfor(const action of config.orderedActions)\n\t\t\t\tif ( action && action.prefix )\n\t\t\t\t\tnew_bits.add(action.prefix);\n\t\t}\n\n\t\tif ( (! this._ffz_old_bits && ! new_bits) || set_equals(this._ffz_old_bits, new_bits) )\n\t\t\treturn;\n\n\t\tthis._ffz_old_bits = new_bits;\n\n\t\troom.updateBitsConfig(formatBitsConfig(config));\n\t\tthis.chat_line.updateLineTokens();\n\t\t//this.updateChatLines();\n\t}\n\n\n\t// ========================================================================\n\t// Chat Buffer Connector\n\t// ========================================================================\n\n\tconnectorMounted(inst) { // eslint-disable-line class-methods-use-this\n\t\tconst buffer = inst.props.messageBufferAPI;\n\t\tif ( buffer && buffer._ffz_inst && buffer._ffz_inst._ffz_connector !== inst )\n\t\t\tbuffer._ffz_inst._ffz_connector = inst;\n\t}\n\n\tconnectorUpdated(inst, props) { // eslint-disable-line class-methods-use-this\n\t\tconst buffer = props.messageBufferAPI,\n\t\t\tnew_buffer = inst.props.messageBufferAPI;\n\n\t\tif ( buffer === new_buffer )\n\t\t\treturn;\n\n\t\tif ( buffer && buffer._ffz_inst && buffer._ffz_inst._ffz_connector === inst )\n\t\t\tbuffer._ffz_inst._ffz_connector = null;\n\n\t\tif ( new_buffer && new_buffer._ffz_inst && new_buffer._ffz_inst._ffz_connector !== inst )\n\t\t\tbuffer._ffz_inst._ffz_connector = inst;\n\t}\n\n\tconnectorUnmounted(inst) { // eslint-disable-line class-methods-use-this\n\t\tconst buffer = inst.props.messageBufferAPI;\n\t\tif ( buffer && buffer._ffz_inst && buffer._ffz_inst._ffz_connector === inst )\n\t\t\tbuffer._ffz_inst._ffz_connector = null;\n\t}\n\n\n\t// ========================================================================\n\t// Chat Renderers\n\t// ========================================================================\n\n\trendererMounted(cont, props) {\n\t\tif ( ! props )\n\t\t\tprops = cont.props;\n\n\t\t// We keep our own track of shared rooms, so that we can load/unload\n\t\t// the associated data as relevant.\n\t\tthis.updateRendererSharedChats(cont, props?.sharedChatDataByChannelID);\n\t}\n\n\n\tupdateRendererSharedChats(cont, data) {\n\t\tdata ??= cont.props.sharedChatDataByChannelID;\n\n\t\tif ( cont._ffz_cached_shared === data )\n\t\t\treturn;\n\n\t\tthis.shared_room_data = cont._ffz_cached_shared = data;\n\t\tthis.shared_rooms = cont._ffz_shared_rooms = cont._ffz_shared_rooms || {};\n\n\t\tconst unexpected = new Set(Object.keys(cont._ffz_shared_rooms));\n\t\tlet badges_updated = false;\n\n\t\tif (data != null)\n\t\t\tfor(const [room_id, d2] of data.entries()) {\n\t\t\t\tunexpected.delete(room_id);\n\n\t\t\t\tlet room = cont._ffz_shared_rooms[room_id];\n\t\t\t\tif ( ! room ) {\n\t\t\t\t\t// We need to add the room.\n\t\t\t\t\troom = this.chat.getRoom(room_id, d2.login);\n\t\t\t\t\troom.ref(cont);\n\t\t\t\t\tcont._ffz_shared_rooms[room_id] = room;\n\t\t\t\t}\n\n\t\t\t\t// Check badges.\n\t\t\t\tconst bd = d2.badges?.channelsBySet;\n\n\t\t\t\t// Since we don't have a flat structure, we have to recurse\n\t\t\t\t// a little to get the count.\n\t\t\t\tlet count = 0;\n\t\t\t\tif (bd) {\n\t\t\t\t\tfor(const entry of bd.values()) {\n\t\t\t\t\t\tfor(const _ of entry.values()) {\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( room.badgeCount() !== count ) {\n\t\t\t\t\tbadges_updated = true;\n\t\t\t\t\troom.updateBadges(bd);\n\t\t\t\t}\n\t\t\t}\n\n\t\t// Unref rooms that are no longer shared.\n\t\tfor(const room_id of unexpected) {\n\t\t\tconst room = cont._ffz_shared_rooms[room_id];\n\t\t\tif ( room )\n\t\t\t\troom.unref(cont);\n\n\t\t\troom.unshareChat();\n\t\t\tdelete cont._ffz_shared_rooms[room_id];\n\t\t}\n\n\t\tconst shared = Object.keys(cont._ffz_shared_rooms);\n\n\t\tfor(const room of Object.values(cont._ffz_shared_rooms))\n\t\t\troom.shareChats(shared);\n\n\t\t//this.log.info('!!!!! updated shared chats', cont._ffz_shared_rooms);\n\n\t\tif ( shared.length > 0 && this.settings.provider.get('shared-chat-notice') !== 1 ) {\n\t\t\tthis.settings.provider.set('shared-chat-notice', 1);\n\t\t\tthis.addNotice('*', {\n\t\t\t\ticon: 'ffz-i-zreknarf',\n\t\t\t\tmessage: this.i18n.t('chat.shared-chat.welcome', 'FrankerFaceZ: This is a Shared Chat, a new feature from Twitch to combine multiple stream chats into one. FrankerFaceZ support is early, so some messages might not look correct. Sorry for any trouble!')\n\t\t\t});\n\t\t}\n\n\t\tif ( badges_updated )\n\t\t\tthis.chat_line.updateLineBadges();\n\t}\n\n\trendererUnmounted(cont) {\n\t\t// Unref all shared rooms.\n\t\tif (cont._ffz_shared_rooms)\n\t\t\tfor(const room of Object.values(cont._ffz_shared_rooms))\n\t\t\t\troom.unref(cont);\n\n\t\tcont._ffz_shared_rooms = null;\n\t\tcont._ffz_cached_shared = null;\n\t\tthis.shared_room_data = new Map;\n\t\tthis.shared_rooms = {};\n\t}\n\n\trendererUpdated(cont, props) {\n\t\tthis.updateRendererSharedChats(cont, props?.sharedChatDataByChannelID);\n\t}\n\n\n\t// ========================================================================\n\t// Chat Containers\n\t// ========================================================================\n\n\tget shouldUpdateChannel() {\n\t\tconst route = this.router.current_name;\n\t\treturn Twilight.POPOUT_ROUTES.includes(route) || Twilight.SUNLIGHT_ROUTES.includes(route);\n\t}\n\n\tcontainerMounted(cont, props) {\n\t\tif ( ! props )\n\t\t\tprops = cont.props;\n\n\t\tif ( ! this.addRoom(cont, props) )\n\t\t\treturn;\n\n\t\tthis.updateRoomBitsConfig(cont, props.bitsConfig);\n\n\t\tif ( props.globalBadgeData?.badges )\n\t\t\tthis.chat.badges.updateTwitchBadges(props.globalBadgeData.badges);\n\t\telse if (props.data?.badges )\n\t\t\tthis.chat.badges.updateTwitchBadges(props.data.badges);\n\n\t\tif ( props.data ) {\n\t\t\tif ( this.shouldUpdateChannel ){\n\t\t\t\tconst color = props.data.user?.primaryColorHex;\n\t\t\t\tthis.resolve('site.channel').updateChannelColor(color);\n\n\t\t\t\tthis.settings.updateContext({\n\t\t\t\t\tchannel: props.channelLogin,\n\t\t\t\t\tchannelID: props.channelID,\n\t\t\t\t\tchannelColor: color\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.updateRoomBadges(cont, props.data.user && props.data.user.broadcastBadges);\n\t\t\tthis.updateRoomRules(cont, props.chatRules);\n\t\t}\n\t}\n\n\n\tcontainerUnmounted(cont) {\n\t\tif ( this.shouldUpdateChannel ) {\n\t\t\tthis.resolve('site.channel').updateChannelColor();\n\n\t\t\tthis.settings.updateContext({\n\t\t\t\tchannel: null,\n\t\t\t\tchannelID: null,\n\t\t\t\tchannelColor: null\n\t\t\t});\n\t\t}\n\n\t\tthis.removeRoom(cont);\n\t}\n\n\n\tcontainerUpdated(cont, props) {\n\t\t// If we don't have a room, or if the room ID doesn't match our ID\n\t\t// then we need to just create a new Room because the chat room changed.\n\t\tif ( ! cont._ffz_room || props.channelID != cont._ffz_room.id ) {\n\t\t\tthis.removeRoom(cont);\n\t\t\tif ( cont._ffz_mounted )\n\t\t\t\tthis.containerMounted(cont, props);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( props.bitsConfig !== cont.props.bitsConfig )\n\t\t\tthis.updateRoomBitsConfig(cont, props.bitsConfig);\n\n\t\tif ( props.data && Twilight.POPOUT_ROUTES.includes(this.router.current_name) ) {\n\t\t\tconst color = props.data.user?.primaryColorHex;\n\t\t\tthis.resolve('site.channel').updateChannelColor(color);\n\n\t\t\tthis.settings.updateContext({\n\t\t\t\tchannel: props.channelLogin,\n\t\t\t\tchannelID: props.channelID,\n\t\t\t\tchannelColor: color\n\t\t\t});\n\t\t}\n\n\t\t// Twitch, React, and Apollo are the trifecta of terror so we\n\t\t// can't compare the badgeSets property in any reasonable way.\n\t\t// Instead, just check the lengths to see if they've changed\n\t\t// and hope that badge versions will never change separately.\n\t\tconst cs = props.data?.user?.broadcastBadges ?? [],\n\t\t\tocs = cont.props.data?.user?.broadcastBadges ?? [];\n\n\t\tconst bs = props.globalBadgeData?.badges ?? [],\n\t\t\tobs = cont.props.globalBadgeData?.badges ?? [];\n\n\t\t/*const data = props.data || {},\n\t\t\todata = cont.props.data || {},\n\n\t\t\tbs = data.badges || [],\n\t\t\tobs = odata.badges || [],\n\n\t\t\tcs = data.user && data.user.broadcastBadges || [],\n\t\t\tocs = odata.user && odata.user.broadcastBadges || [];*/\n\n\t\tif ( this.chat.badges.getTwitchBadgeCount() !== bs.length || bs.length !== obs.length )\n\t\t\tthis.chat.badges.updateTwitchBadges(bs);\n\n\t\tif ( cont._ffz_room.badgeCount() !== cs.length || cs.length !== ocs.length )\n\t\t\tthis.updateRoomBadges(cont, cs);\n\n\t\tthis.updateRoomRules(cont, props.chatRules);\n\t}\n\n\thasRoomBadges(cont) { // eslint-disable-line class-methods-use-this\n\t\tconst room = cont._ffz_room;\n\t\tif ( ! room )\n\t\t\treturn false;\n\n\t\treturn room.hasBadges();\n\t}\n\n\tupdateRoomBadges(cont, badges) { // eslint-disable-line class-methods-use-this\n\t\tconst room = cont._ffz_room;\n\t\tif ( ! room )\n\t\t\treturn;\n\n\t\troom.updateBadges(badges);\n\t\tthis.chat_line.updateLineBadges();\n\t\t//this.updateChatLines();\n\t}\n\n\tupdateRoomRules(cont, rules) { // eslint-disable-line class-methods-use-this\n\t\tconst room = cont._ffz_room;\n\t\tif ( ! room )\n\t\t\treturn;\n\n\t\troom.rules = rules;\n\t}\n}\n\n\n// ============================================================================\n// Processing Functions\n// ============================================================================\n\nexport function formatBitsConfig(config) {\n\tif ( ! config )\n\t\treturn;\n\n\tconst out = {},\n\t\tactions = config.indexedActions,\n\t\ttier_colors = {};\n\n\tif ( Array.isArray(config.tiers) )\n\t\tfor(const tier of config.tiers)\n\t\t\ttier_colors[tier.bits] = tier.color;\n\n\tfor(const key in actions)\n\t\tif ( has(actions, key) ) {\n\t\t\tconst action = actions[key],\n\t\t\t\tnew_act = out[key] = {\n\t\t\t\t\tid: action.id,\n\t\t\t\t\tprefix: action.prefix,\n\t\t\t\t\ttiers: []\n\t\t\t\t};\n\n\t\t\tif ( config?.getImage ) {\n\t\t\t\tfor(const tier of action.orderedTiers) {\n\t\t\t\t\tconst images = {};\n\n\t\t\t\t\tfor(const theme of ['light', 'dark']) {\n\t\t\t\t\t\tconst themed = images[theme] = images[theme] || {},\n\t\t\t\t\t\t\tstat = themed.static = themed.static || {},\n\t\t\t\t\t\t\tanimated = themed.animated = themed.animated || {};\n\n\t\t\t\t\t\tfor(const scale of [1, 2, 4]) {\n\t\t\t\t\t\t\t// Static Images\n\t\t\t\t\t\t\tstat[scale] = config.getImage(action.prefix, theme, 'static', tier.bits, scale, 'png');\n\n\t\t\t\t\t\t\t// Animated Images\n\t\t\t\t\t\t\tanimated[scale] = config.getImage(action.prefix, theme, 'animated', tier.bits, scale, 'gif');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tnew_act.tiers.push({\n\t\t\t\t\t\tamount: tier.bits,\n\t\t\t\t\t\tcolor: tier.color || tier_colors[tier.bits] || 'inherit',\n\t\t\t\t\t\tid: tier.id,\n\t\t\t\t\t\timages\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t} else if ( action.orderedTiers[0]?.images ) {\n\t\t\t\tfor(const tier of action.orderedTiers) {\n\t\t\t\t\tconst images = {};\n\n\t\t\t\t\tfor(const im of tier.images) {\n\t\t\t\t\t\tconst themed = images[im.theme] = images[im.theme] || [],\n\t\t\t\t\t\t\tak = im.isAnimated ? 'animated' : 'static',\n\t\t\t\t\t\t\tanim = themed[ak] = themed[ak] || {};\n\n\t\t\t\t\t\tanim[im.dpiScale] = im.url;\n\t\t\t\t\t}\n\n\t\t\t\t\tnew_act.tiers.push({\n\t\t\t\t\t\tamount: tier.bits,\n\t\t\t\t\t\tcolor: tier.color || tier_colors[tier.bits] || 'inherit',\n\t\t\t\t\t\tid: tier.id,\n\t\t\t\t\t\timages\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\treturn out;\n}\n","export function doesRewardCostBits(reward) {\n\treturn reward.pricingType === 'BITS';\n}\n\nexport function isAutomaticReward(reward) {\n\treturn reward?.__typename === 'CommunityPointsAutomaticReward';\n}\n\nexport function isCustomReward(reward) {\n\treturn reward?.__typename === 'CommunityPointsCustomReward';\n}\n\nexport function isHighlightedReward(reward) {\n\treturn isAutomaticReward(reward) && reward.type === 'SEND_HIGHLIGHTED_MESSAGE';\n}\n\nexport function isGiantEmoteReward(reward) {\n\treturn reward && (reward.title?.includes?.('FFZ:GE') ||\n\t\treward.prompt?.includes?.('FFZ:GE'));\n}\n\nexport function isMessageEffect(reward) {\n\treturn reward?.type === 'SEND_ANIMATED_MESSAGE';\n}\n\nexport function getRewardCost(reward) {\n\tconst is_bits = doesRewardCostBits(reward);\n\tif ( isAutomaticReward(reward) )\n\t\treturn is_bits\n\t\t\t? (reward.bitsCost || reward.defaultBitsCost)\n\t\t\t: (reward.cost || reward.defaultCost);\n\n\treturn is_bits\n\t\t? reward.bitsCost\n\t\t: reward.cost;\n}\n\nexport function getRewardColor(reward) {\n\tif ( isAutomaticReward(reward) )\n\t\treturn reward.backgroundColor || reward.defaultBackgroundColor;\n\n\treturn reward.backgroundColor;\n}\n\nexport function getRewardTitle(reward, i18n) {\n\tif ( isCustomReward(reward) )\n\t\treturn reward.title;\n\n\tswitch(reward.type) {\n\t\tcase 'SEND_ANIMATED_MESSAGE':\n\t\t\treturn i18n.t('chat.points.animated', 'Message Effects');\n\t\tcase 'SEND_HIGHLIGHTED_MESSAGE':\n\t\t\treturn i18n.t('chat.points.highlighted', 'Highlight My Message');\n\t\tcase 'SINGLE_MESSAGE_BYPASS_SUB_MODE':\n\t\t\treturn i18n.t('chat.points.bypass-sub', 'Send a Message in Sub-Only Mode');\n\t\tcase 'CHOSEN_SUB_EMOTE_UNLOCK':\n\t\t\treturn i18n.t('chat.points.choose-emote', 'Choose an Emote to Unlock');\n\t\tcase 'RANDOM_SUB_EMOTE_UNLOCK':\n\t\t\treturn i18n.t('chat.points.random-emote', 'Unlock a Random Sub Emote');\n\t\tcase 'CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK':\n\t\t\treturn i18n.t('chat.points.modify-emote', 'Modify a Single Emote');\n\t\tdefault:\n\t\t\treturn i18n.t('chat.points.reward', 'Reward');\n\t}\n}\n","'use strict';\n\n/* global emoteMenu: false */\n\n// ============================================================================\n// Compatibility Layer\n// Emote Menu for Twitch (BTTV Emote Menu)\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {has, sleep} from 'utilities/object';\n\nexport default class CompatEmoteMenu extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('site.chat');\n\t\tthis.inject('chat.emotes');\n\t}\n\n\tonEnable() {\n\t\tthis.hookEmoteMenu();\n\t}\n\n\tasync hookEmoteMenu() {\n\t\tconst em = await this.findEmoteMenu();\n\t\tif ( ! em )\n\t\t\treturn this.log.info('Emote Menu for Twitch was not found after 60 seconds.');\n\n\t\tem.registerEmoteGetter('FrankerFaceZ', () => {\n\t\t\t// We get literally no information about the current context,\n\t\t\t// so we need to look up everything.\n\t\t\tconst cont = this.chat.ChatContainer.first,\n\t\t\t\tprops = cont && cont.props;\n\n\t\t\tif ( ! props )\n\t\t\t\treturn;\n\n\t\t\tconst sets = this.emotes.getSets(props.userID, props.currentUserLogin, props.channelID, props.channelLogin),\n\t\t\t\tchat = this.resolve('chat'),\n\t\t\t\tanim = (chat?.context || this.settings)?.get?.('chat.emotes.animated') > 0,\n\t\t\t\temotes = [];\n\n\t\t\tfor(const set of sets) {\n\t\t\t\tif ( ! set || ! set.emotes )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tfor(const emote_id in set.emotes)\n\t\t\t\t\tif ( has(set.emotes, emote_id) ) {\n\t\t\t\t\t\tconst emote = set.emotes[emote_id];\n\t\t\t\t\t\tif ( emote.hidden )\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\temotes.push({\n\t\t\t\t\t\t\ttext: emote.name,\n\t\t\t\t\t\t\turl: anim && emote.animated?.[1] || emote.urls[1],\n\t\t\t\t\t\t\tchannel: `${set.source || 'FrankerFaceZ'} ${set.title}`,\n\t\t\t\t\t\t\tbadge: set.icon || '//cdn.frankerfacez.com/script/devicon.png'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn emotes;\n\t\t});\n\t}\n\n\tasync findEmoteMenu(delay = 0) {\n\t\tif ( window.emoteMenu && emoteMenu.registerEmoteGetter )\n\t\t\treturn emoteMenu;\n\n\t\tif ( delay >= 60000 )\n\t\t\treturn null;\n\n\t\tawait sleep(100);\n\t\treturn this.findEmoteMenu(delay + 100);\n\t}\n}","'use strict';\n\n// ============================================================================\n// CSS Tweaks for Twitch Twilight\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {ManagedStyle} from 'utilities/dom';\nimport {has} from 'utilities/object';\nimport { getFontsList, useFont } from 'utilities/fonts';\n\nconst STYLE_VALIDATOR = document.createElement('span');\n\nconst CLASSES = {\n\t//'unfollow': '.follow-btn__follow-btn--following,.follow-btn--following',\n\t//'top-discover': '.navigation-link[data-a-target=\"discover-link\"]',\n\t'side-nav': '.side-nav,#sideNav',\n\t'side-nav-viewers': '.side-nav-card__live-status',\n\t'side-rec-channels': '.side-nav .recommended-channels,.side-nav .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)',\n\t//'side-rec-friends': '.side-nav .recommended-friends',\n\t'side-friends': '.side-nav .online-friends',\n\t'side-closed-friends': '.side-nav--collapsed .online-friends',\n\t'side-closed-rec-channels': '.side-nav--collapsed .recommended-channels,.side-nav--collapsed .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)',\n\t'side-offline-channels': '.ffz--side-nav-card-offline',\n\t'side-rerun-channels': '.side-nav .ffz--side-nav-card-rerun',\n\t'modview-hide-info': '.modview-player-widget__hide-stream-info',\n\n\t'community-highlights': '.community-highlight-stack__card',\n\t'elevate-your-message': '.chat-input__input-icons button[aria-label=\"ElevatedMessage\"]',\n\n\t'prime-offers': '.top-nav__prime',\n\t'discover-luna': '.top-nav__external-link[data-a-target=\"try-presto-link\"]',\n\n\t'subtember': '.subtember-gradient',\n\n\t'player-gain-volume': '.video-player__container[data-compressed=\"true\"] .volume-slider__slider-container:not(.ffz--player-gain)',\n\n\t'player-ext': '.video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout',\n\t'player-ext-hover': '.video-player__container[data-controls=\"false\"] .extension-taskbar,.video-player__container[data-controls=\"false\"] .extension-container,.video-player__container[data-controls=\"false\"] .extensions-dock__layout,.video-player__container[data-controls=\"false\"] .extensions-notifications,.video-player__container[data-controls=\"false\"] .extensions-video-overlay-size-container',\n\t'player-cast': '.video-player button:has(.tw-chromecast-button__icon)',\n\n\t'player-event-bar': '.channel-root .live-event-banner-ui__header',\n\t'player-rerun-bar': '.channel-root__player-container div.tw-c-text-overlay:not([data-a-target=\"hosting-ui-header\"])',\n\n\t'pinned-cheer': '.pinned-cheer,.pinned-cheer-v2,.channel-leaderboard,.channel-leaderboard-marquee,div[data-test-selector=\"channel-leaderboard-container\"]',\n\t'whispers': 'body .whispers-open-threads,.tw-core-button[data-a-target=\"whisper-box-button\"],.whispers__pill',\n\n\t'dir-live-ind': `.live-channel-card[data-ffz-type=\"live\"] .tw-channel-status-text-indicator,article[data-ffz-type=\"live\"] .tw-channel-status-text-indicator,.switcher-hopper__scroll-container .tw-tower a[data-ffz-type=\"live\"] .tw-channel-status-text-indicator`,\n\t'profile-hover': '.preview-card .tw-relative:hover .ffz-channel-avatar',\n\t'not-live-bar': 'div[data-test-selector=\"non-live-video-banner-layout\"]',\n\t'channel-live-ind': '.channel-header__user .tw-channel-status-text-indicator,.channel-info-content .tw-halo__indicator',\n\t'celebration': 'body .celebration__overlay',\n\n\t'last-x-events': '.last-x-events_container',\n\n\t'pinned-hype-chat': '.paid-pinned-chat-message-list',\n\n\t'side-stories': '.side-nav__title + div[class*=storiesLeftNavSection]',\n\n\t'ci-mod-view': '.chat-input__buttons-container a[href*=\"/moderator\"]',\n\t'ci-highlight-settings': '.chat-input__buttons-container button[data-highlight-selector=\"chat-highlights-shortcut\"]',\n\t'ci-shield-mode': '.chat-input__buttons-container > div:last-child button[class|=\"ScCoreButton\"]:not([data-highlight-selector]):not([data-a-target])'\n};\n\n\nexport default class CSSTweaks extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\n\t\tthis.style = new ManagedStyle;\n\t\tthis.chunks = {};\n\t\tthis.chunks_loaded = false;\n\n\t\tthis._state = {};\n\n\t\t// Layout\n\n\t\tthis.settings.add('metadata.modview.hide-info', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Mod View',\n\t\t\t\ttitle: 'Hide \"Hide Stream Info Stripe\" button.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('modview-hide-info', val)\n\t\t});\n\n\t\tthis.settings.add('metadata.viewers.no-native', {\n\t\t\trequires: ['metadata.viewers'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn val == null ? ctx.get('metadata.viewers') : val\n\t\t\t},\n\t\t\tchanged: val => this.toggle('hide-native-viewers', val),\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Player',\n\t\t\t\ttitle: \"Hide Twitch's native Viewer Count.\",\n\t\t\t\tdescription: \"By default, this is enabled whenever FFZ's own Viewer Count display is enabled to avoid redundant information.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('metadata.uptime.no-native', {\n\t\t\trequires: ['metadata.uptime'],\n\t\t\tdefault: null,\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn val == null ? ctx.get('metadata.uptime') !== 0 : val\n\t\t\t},\n\t\t\tchanged: val => this.toggle('hide-native-uptime', val),\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Player',\n\t\t\t\ttitle: \"Hide Twitch's native Stream Uptime.\",\n\t\t\t\tdescription: \"By default, this is enabled whenever FFZ's own Stream Uptime display is enabled to avoid redundant information.\",\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.use-chat-fix', {\n\t\t\trequires: ['context.force_chat_fix', 'layout.swap-sidebars', 'layout.use-portrait', 'chat.use-width', 'context.isWatchParty'],\n\t\t\tprocess(ctx) {\n\t\t\t\tif ( ctx.get('context.isWatchParty') )\n\t\t\t\t\treturn false;\n\n\t\t\t\treturn ctx.get('context.force_chat_fix') || ctx.get('layout.swap-sidebars') || ctx.get('layout.use-portrait') || ctx.get('chat.use-width')\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tif ( val )\n\t\t\t\t\tthis.toggle('chat-no-animate', true);\n\t\t\t\telse if ( ! val && ! this._no_anim_timer )\n\t\t\t\t\tthis._no_anim_timer = requestAnimationFrame(() => {\n\t\t\t\t\t\tthis._no_anim_timer = null;\n\t\t\t\t\t\tif ( ! this.settings.get('layout.use-chat-fix') )\n\t\t\t\t\t\t\tthis.toggle('chat-no-animate', false);\n\t\t\t\t\t});\n\n\t\t\t\tthis.toggle('chat-fix', val);\n\t\t\t\tthis.emit('site.player:fix-player');\n\t\t\t\tthis.emit('site.layout:resize');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.hide-stories', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Hide Stories',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.show', {\n\t\t\tdefault: 1,\n\t\t\trequires: ['layout.use-portrait'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val === 2 )\n\t\t\t\t\treturn ! ctx.get('layout.use-portrait');\n\n\t\t\t\treturn val;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tsort: -1,\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Display Side Navigation',\n\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'Always'},\n\t\t\t\t\t{value: 2, title: 'Hide in Portrait'}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggle('hide-side-nav', !val);\n\t\t\t\tthis.emit('site.layout:resize');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.hide-viewers', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Hide Channel View Counts',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('side-nav-viewers', val)\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.show-avatars', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Display Channel Avatars',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggle('hide-side-nav-avatars', !val)\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.show-rec-channels', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Display Recommended / Popular Channels',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'Always'},\n\t\t\t\t\t{value: 2, title: 'When Side Navigation is Open'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggleHide('side-rec-channels', val === 0);\n\t\t\t\tthis.toggleHide('side-closed-rec-channels', val === 2);\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.show-friends', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Display Online Friends',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Never'},\n\t\t\t\t\t{value: 1, title: 'Always'},\n\t\t\t\t\t{value: 2, title: 'When Side Navigation is Open'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggleHide('side-friends', val === 0);\n\t\t\t\tthis.toggleHide('side-closed-friends', val === 2);\n\t\t\t}\n\t\t});\n\n\t\t/*this.settings.add('layout.side-nav.show-rec-friends', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Display Recommended Friends',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('side-rec-friends', !val)\n\t\t});*/\n\n\t\tthis.settings.add('layout.side-nav.hide-offline', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Hide Offline Channels',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('side-offline-channels', val)\n\t\t});\n\n\t\tthis.settings.add('layout.side-nav.rerun-style', {\n\t\t\tdefault: 1,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Display Reruns',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Do Not Display'},\n\t\t\t\t\t{value: 1, title: 'Normally'},\n\t\t\t\t\t{value: 2, title: 'Faded (33% Opacity)'}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggleHide('side-rerun-channels', val === 0);\n\t\t\t\tthis.toggle('side-rerun-opacity', val === 2);\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.swap-sidebars', {\n\t\t\tdefault: false,\n\t\t\trequires: ['context.isWatchParty'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn ctx.get('context.isWatchParty') ? false : val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Side Navigation',\n\t\t\t\ttitle: 'Swap Sidebars',\n\t\t\t\tdescription: 'Swap navigation and chat to the opposite sides of the window.',\n\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggle('swap-sidebars', val);\n\t\t\t\tthis.emit('site.layout:resize');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.minimal-navigation', {\n\t\t\trequires: ['layout.theatre-navigation', 'context.isWatchParty'],\n\t\t\tdefault: false,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( ctx.get('context.isWatchParty') )\n\t\t\t\t\treturn false;\n\n\t\t\t\treturn ctx.get('layout.theatre-navigation') ?\n\t\t\t\t\ttrue : val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Minimize Navigation',\n\t\t\t\tdescription: \"Slide the site navigation bar up out of view when it isn't in use.\",\n\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggle('minimal-navigation', val);\n\t\t\t\tthis.emit('site.layout:resize');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.theatre-navigation', {\n\t\t\trequires: ['layout.is-theater-mode'],\n\t\t\tdefault: false,\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn ctx.get('layout.is-theater-mode') ? val : false\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Show the minimized navigation bar when in theatre mode.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggle('theatre-nav', val);\n\t\t\t\tthis.emit('site.layout:resize');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.subtember', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Channel',\n\t\t\t\ttitle: 'Allow the Subtember upsell banner to appear.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\t/*this.settings.add('layout.discover', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Show Discover link.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggleHide('top-discover', !val);\n\t\t\t\tthis.updateTopNav();\n\t\t\t}\n\t\t});*/\n\n\t\tthis.settings.add('layout.turbo-cta', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Allow the Twitch Turbo button to appear.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.prime-offers', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Show Prime Gaming Loot.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('prime-offers', !val)\n\t\t});\n\n\t\tthis.settings.add('layout.hide-discover-luna', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Hide the \"Discover Luna\" link.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('discover-luna', val)\n\t\t});\n\n\t\t// Chat\n\n\t\tthis.settings.add('whispers.show', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Whispers >> General',\n\t\t\t\ttitle: 'Display Whispers',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.toggleHide('whispers', !val);\n\t\t\t\tthis.emit('site.layout:resize');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.hype.show-pinned', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Hype Chat >> Appearance',\n\t\t\t\ttitle: 'Allow Hype Chat messages to appear pinned at the top of chat.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('pinned-hype-chat', ! val)\n\t\t});\n\n\t\tthis.settings.add('chat.bits.show', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\torder: -1,\n\t\t\t\tpath: 'Chat > Bits and Cheering >> Appearance',\n\t\t\t\ttitle: 'Display Bits',\n\t\t\t\tdescription: 'Display UI associated with bits. Note: This will not hide cheering in chat messages.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggle('hide-bits', !val)\n\t\t});\n\n\t\t// Other?\n\n\t\tthis.settings.add('channel.show-celebrations', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Allow Celebrations to appear.',\n\t\t\t\tdescription: 'Celebrations are animations that cover the entire Twitch page.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('celebration', ! val)\n\t\t});\n\n\t\tthis.settings.add('layout.theme.global-font', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Fonts',\n\t\t\t\ttitle: 'Font Family',\n\t\t\t\tdescription: 'Override the font used for the entire Twitch website. The old default font was: `\"Helvetica Neue\",Helvetica,Arial,sans-serif`\\n\\nAny font available via [Google Fonts](https://fonts.google.com/) can be loaded by prefixing the font name with `google:`.',\n\t\t\t\tcomponent: 'setting-combo-box',\n\t\t\t\tdata: () => getFontsList()\n\t\t\t},\n\t\t\tchanged: () => this.updateFont()\n\t\t});\n\n\t\tthis.settings.add('channel.hide-unfollow', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Hide the Unfollow button.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggle('hide-unfollow-button', val)\n\t\t});\n\n\t\tthis.settings.add('channel.hide-live-indicator', {\n\t\t\trequires: ['context.route.name'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\treturn (ctx.get('context.route.name') === 'user' || ctx.get('context.route.name') === 'user-home') ? val : false\n\t\t\t},\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Hide the \"LIVE\" indicator on live channel pages.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('channel-live-ind', val)\n\t\t});\n\n\t\tthis.settings.add('channel.round-avatars', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Allow avatar images to be rounded.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggle('square-avatars', !val)\n\t\t});\n\n\t\t/*this.settings.add('channel.hide-not-live-bar', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Hide the \"Now Live\" bar.',\n\t\t\t\tdescription: 'Hide the bar which appears beneath clips and videos when the streamer is live, telling you they are live.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.toggleHide('not-live-bar', val)\n\t\t});*/\n\t}\n\n\tonEnable() {\n\t\tthis.toggleHide('modview-hide-info', this.settings.get('metadata.modview.hide-info'));\n\t\tthis.toggleHide('side-nav-viewers', this.settings.get('layout.side-nav.hide-viewers'));\n\t\tthis.toggle('hide-native-uptime', this.settings.get('metadata.uptime.no-native'));\n\t\tthis.toggle('hide-native-viewers', this.settings.get('metadata.viewers.no-native'));\n\t\tthis.toggle('chat-fix', this.settings.get('layout.use-chat-fix'));\n\t\tthis.toggle('swap-sidebars', this.settings.get('layout.swap-sidebars'));\n\t\tthis.toggle('minimal-navigation', this.settings.get('layout.minimal-navigation'));\n\t\tthis.toggle('theatre-nav', this.settings.get('layout.theatre-navigation'));\n\n\t\tthis.toggle('hide-side-nav-avatars', ! this.settings.get('layout.side-nav.show-avatars'));\n\t\tthis.toggle('hide-side-nav', !this.settings.get('layout.side-nav.show'));\n\t\t//this.toggleHide('side-rec-friends', !this.settings.get('layout.side-nav.show-rec-friends'));\n\t\tthis.toggleHide('side-offline-channels', this.settings.get('layout.side-nav.hide-offline'));\n\t\tthis.toggleHide('discover-luna', this.settings.get('layout.hide-discover-luna'));\n\t\tthis.toggleHide('prime-offers', !this.settings.get('layout.prime-offers'));\n\t\t//this.toggleHide('top-discover', !this.settings.get('layout.discover'));\n\t\tthis.toggle('hide-unfollow-button', this.settings.get('channel.hide-unfollow'));\n\n\t\tthis.toggleHide('pinned-hype-chat', ! this.settings.get('chat.hype.show-pinned'));\n\n\t\tthis.toggle('square-avatars', ! this.settings.get('channel.round-avatars'));\n\t\t//this.toggleHide('not-live-bar', this.settings.get('channel.hide-not-live-bar'));\n\t\tthis.toggleHide('channel-live-ind', this.settings.get('channel.hide-live-indicator'));\n\n\t\tconst reruns = this.settings.get('layout.side-nav.rerun-style');\n\t\tthis.toggleHide('side-rerun-channels', reruns === 0);\n\t\tthis.toggle('side-rerun-opacity', reruns === 2);\n\n\t\tconst recs = this.settings.get('layout.side-nav.show-rec-channels');\n\t\tthis.toggleHide('side-rec-channels', recs === 0);\n\t\tthis.toggleHide('side-closed-rec-channels', recs === 2);\n\n\t\tconst friends = this.settings.get('layout.side-nav.show-friends');\n\t\tthis.toggleHide('side-friends', friends === 0);\n\t\tthis.toggleHide('side-closed-friends', friends === 2);\n\n\t\tthis.toggleHide('whispers', !this.settings.get('whispers.show'));\n\t\tthis.toggleHide('celebration', ! this.settings.get('channel.show-celebrations'));\n\n\t\tthis.settings.getChanges('layout.subtember', val => this.toggleHide('subtember', !val));\n\t\tthis.settings.getChanges('layout.side-nav.hide-stories', val => this.toggleHide('side-stories', val));\n\n\t\tthis.updateFont();\n\t\tthis.updateTopNav();\n\n\t\tthis.emit('site.player:fix-player');\n\t\tthis.emit('site.layout:resize');\n\t}\n\n\tupdateTopNav() {\n\t\trequestAnimationFrame(() => this.emit('site.layout:update-nav'));\n\t}\n\n\tupdateFont() {\n\t\tlet font = this.settings.get('layout.theme.global-font');\n\t\tif ( font && font.length ) {\n\t\t\tconst [processed, unloader] = useFont(font);\n\t\t\tfont = processed;\n\n\t\t\tif ( this._font_unloader )\n\t\t\t\tthis._font_unloader();\n\n\t\t\tthis._font_unloader = unloader;\n\n\t\t\tif ( font.indexOf(' ') !== -1 && font.indexOf(',') === -1 && font.indexOf('\"') === -1 && font.indexOf(\"'\") === -1 )\n\t\t\t\tfont = `\"${font}\"`;\n\n\t\t\tSTYLE_VALIDATOR.style.fontFamily = '';\n\t\t\tSTYLE_VALIDATOR.style.fontFamily = font;\n\n\t\t\tif ( STYLE_VALIDATOR.style.fontFamily ) {\n\t\t\t\tthis.setVariable('global-font', font);\n\t\t\t\tthis.toggle('global-font', true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.toggle('global-font', false);\n\t\tthis.deleteVariable('global-font');\n\t}\n\n\ttoggleHide(key, val) {\n\t\tconst k = `hide--${key}`;\n\t\tif ( ! val ) {\n\t\t\tthis.style.delete(k);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! has(CLASSES, key) )\n\t\t\tthrow new Error(`cannot find class for \"${key}\"`);\n\n\t\tthis.style.set(k, `${CLASSES[key]} { display: none !important }`);\n\t}\n\n\n\ttoggle(key, val) {\n\t\tval = !! val;\n\t\tif ( (this._state[key] ?? false) === val )\n\t\t\treturn;\n\n\t\tthis._state[key] = val;\n\t\tthis._apply(key);\n\t}\n\n\t_apply(key) {\n\t\tconst val = this._state[key];\n\t\tif ( ! val ) {\n\t\t\tif ( this.style )\n\t\t\t\tthis.style.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.style.has(key) )\n\t\t\treturn;\n\n\t\tif ( ! this.chunks_loaded )\n\t\t\treturn this.loadFromContext().then(() => this._apply(key));\n\n\t\tif ( ! has(this.chunks, key) ) {\n\t\t\tthis.log.warn(`Unknown chunk name \"${key}\" for toggle()`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.style.set(key, this.chunks[key]);\n\t}\n\n\n\tset(key, val) { return this.style.set(key, val) }\n\tdelete(key) { return this.style.delete(key) }\n\n\tsetVariable(key, val, scope = 'body') {\n\t\tthis.style.set(`var--${key}`, `${scope} { --ffz-${key}: ${val}; }`);\n\t}\n\n\tdeleteVariable(key) { this.style.delete(`var--${key}`) }\n\n\n\tloadFromContext() {\n\t\tif ( this.chunks_loaded )\n\t\t\treturn;\n\n\t\treturn new Promise(async r => {\n\t\t\tconst raw = (await import(/* webpackChunkName: \"site-css-tweaks\" */ './styles.js')).default;\n\t\t\tfor(const key of raw.keys()) {\n\t\t\t\tconst k = key.slice(2, key.length - (key.endsWith('.scss') ? 5 : 4));\n\t\t\t\tthis.chunks[k] = raw(key).default;\n\t\t\t}\n\n\t\t\tthis.emit('site.layout:resize');\n\n\t\t\tthis.chunks_loaded = true;\n\t\t\tr();\n\t\t})\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Dashboard\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport { get, has } from 'utilities/object';\n\nimport Twilight from 'site';\n\nexport default class Dashboard extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.channel');\n\n\t\tthis.SunlightBroadcast = this.fine.define(\n\t\t\t'sunlight-bcast',\n\t\t\tn => n.getGame && n.getTitle && n.props?.data,\n\t\t\tTwilight.SUNLIGHT_ROUTES\n\t\t);\n\n\t\tthis.SunlightManager = this.fine.define(\n\t\t\t'sunlight-manager',\n\t\t\tn => n.props?.channelID && n.props.channelLogin && has(n.props, 'hostedChannel'),\n\t\t\tTwilight.SUNLIGHT_ROUTES\n\t\t);\n\t}\n\n\tonEnable() {\n\t\tthis.SunlightManager.on('mount', this.updateSunlight, this);\n\t\tthis.SunlightManager.on('update', this.updateSunlight, this);\n\t\tthis.SunlightManager.on('unmount', this.removeSunlight, this);\n\t\tthis.SunlightManager.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateSunlight(inst);\n\t\t});\n\n\t\tthis.SunlightBroadcast.on('mount', this.updateBroadcast, this);\n\t\tthis.SunlightBroadcast.on('update', this.updateBroadcast, this);\n\t\tthis.SunlightBroadcast.on('unmount', this.removeBroadcast, this);\n\t\tthis.SunlightBroadcast.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateBroadcast(inst);\n\t\t});\n\t}\n\n\tupdateSunlight(inst) {\n\t\tthis.settings.updateContext({\n\t\t\tchannel: get('props.channelLogin', inst),\n\t\t\tchannelID: get('props.channelID', inst),\n\t\t\t//hosting: !! inst.props?.hostedChannel?.id\n\t\t});\n\t}\n\n\tremoveSunlight() {\n\t\tthis.settings.updateContext({\n\t\t\tchannel: null,\n\t\t\tchannelID: null,\n\t\t\t//hosting: false\n\t\t});\n\t}\n\n\tupdateBroadcast(inst) {\n\t\tconst data = inst.props?.data?.user?.broadcastSettings,\n\t\t\tgame = data?.game;\n\n\t\tthis.settings.updateContext({\n\t\t\tcategory: game?.name,\n\t\t\tcategoryID: game?.id,\n\t\t\ttitle: data?.title\n\t\t});\n\t}\n\n\tremoveBroadcast() {\n\t\tthis.settings.updateContext({\n\t\t\tcategory: null,\n\t\t\tcategoryID: null,\n\t\t\ttitle: null\n\t\t});\n\t}\n}","'use strict';\n\n// ============================================================================\n// Directory (Following, for now)\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {createElement} from 'utilities/dom';\nimport { get } from 'utilities/object';\n\n\nexport default class Game extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.apollo');\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\n\t\tthis.GameHeader = this.fine.define(\n\t\t\t'game-header',\n\t\t\tn => n.props && n.props.data && n.getBannerImage && n.getDirectoryCountAndTags,\n\t\t\t['dir-game-index', 'dir-community', 'dir-game-videos', 'dir-game-clips', 'dir-game-details']\n\t\t);\n\n\t\tthis.settings.addUI('directory.game.blocked-games', {\n\t\t\tpath: 'Directory > Categories @{\"description\": \"Please note that due to limitations in Twitch\\'s website, names here must be formatted exactly as displayed in your client. For best results, you can block or unblock categories directly from directory pages.\"} >> Blocked',\n\t\t\tcomponent: 'game-list-editor',\n\t\t\tdefault: [],\n\t\t\tonUIChange: () => this.parent.updateCards()\n\t\t});\n\n\t\tthis.settings.addUI('directory.game.hidden-thumbnails', {\n\t\t\tpath: 'Directory > Categories >> Hidden Thumbnails',\n\t\t\tcomponent: 'game-list-editor',\n\t\t\tdefault: [],\n\t\t\tonUIChange: () => this.parent.updateCards()\n\t\t});\n\t}\n\n\tonEnable() {\n\t\tthis.GameHeader.on('mount', this.updateGameHeader, this);\n\t\tthis.GameHeader.on('update', this.updateGameHeader, this);\n\t\tthis.GameHeader.on('unmount', () => {\n\t\t\tthis.settings.updateContext({\n\t\t\t\tcategory: null,\n\t\t\t\tcategoryID: null\n\t\t\t})\n\t\t});\n\n\t\tthis.settings.provider.on('changed', key => {\n\t\t\tif ( key === 'directory.game.blocked-games' || key === 'directory.game.hidden-thumbnails' ) {\n\t\t\t\tthis.parent.updateCards();\n\n\t\t\t\tfor(const inst of this.GameHeader.instances)\n\t\t\t\t\tthis.updateGameHeader(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.GameHeader.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateGameHeader(inst);\n\t\t});\n\n\t\tthis.on('site.router:route', route => {\n\t\t\tif ( route && route.name === 'dir-game-index' )\n\t\t\t\tthis.updateGameHeader();\n\t\t})\n\t}\n\n\n\tupdateGameHeader(inst) {\n\t\tif ( inst === undefined ) {\n\t\t\tfor(const inst of this.GameHeader.instances)\n\t\t\t\tthis.updateGameHeader(inst);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateButtons(inst);\n\n\t\tconst category = inst?.props?.data?.game;\n\n\t\tthis.settings.updateContext({\n\t\t\tcategory: category?.name,\n\t\t\tcategoryID: category?.id\n\t\t});\n\t}\n\n\n\tupdateButtons(inst) {\n\t\tconst container = this.fine.getChildNode(inst);\n\t\tif ( get('data.game', inst.props) == null || ! container || ! container.querySelector )\n\t\t\treturn;\n\n\t\tconst ffz_buttons = container.querySelector('.ffz-directory-buttons');\n\t\tif ( ffz_buttons )\n\t\t\tffz_buttons.remove();\n\n\t\tconst buttons = container.querySelector('.directory-header-new__info > div > div + div');\n\t\tif ( ! buttons )\n\t\t\treturn;\n\n\t\tlet block_btn, block_label,\n\t\t\thidden_btn, hidden_label;\n\n\t\tconst game = get('data.game.name', inst.props) || inst.props.directoryName,\n\t\t\tupdate_block = () => {\n\t\t\t\tconst blocked_games = this.settings.provider.get('directory.game.blocked-games', []),\n\t\t\t\t\tblocked = blocked_games.includes(game);\n\n\t\t\t\tblock_btn.classList.toggle('active', blocked);\n\t\t\t\tblock_label.textContent = blocked ?\n\t\t\t\t\tthis.i18n.t('directory.unblock', 'Unblock') :\n\t\t\t\t\tthis.i18n.t('directory.block', 'Block');\n\t\t\t},\n\t\t\tupdate_hidden = () => {\n\t\t\t\tconst hidden_games = this.settings.provider.get('directory.game.hidden-thumbnails', []),\n\t\t\t\t\thidden = hidden_games.includes(game);\n\n\t\t\t\thidden_btn.classList.toggle('active', hidden);\n\t\t\t\thidden_label.textContent = hidden ?\n\t\t\t\t\tthis.i18n.t('directory.show-thumbnails', 'Show Thumbnails') :\n\t\t\t\t\tthis.i18n.t('directory.hide-thumbnails', 'Hide Thumbnails');\n\t\t\t};\n\n\t\tblock_btn = (<button\n\t\t\tclass=\"tw-mg-r-1 tw-button ffz-directory-toggle-block\"\n\t\t\tonClick={this.generateClickHandler('directory.game.blocked-games', game, update_block)}\n\t\t>\n\t\t\t{block_label = <span class=\"tw-button__text\" />}\n\t\t</button>);\n\n\t\tupdate_block();\n\n\t\thidden_btn = (<button\n\t\t\tclass=\"tw-button ffz-directory-toggle-thumbnail\"\n\t\t\tonClick={this.generateClickHandler('directory.game.hidden-thumbnails', game, update_hidden)}\n\t\t>\n\t\t\t{hidden_label = <span class=\"tw-button__text\" />}\n\t\t</button>);\n\n\t\tupdate_hidden();\n\n\t\tbuttons.appendChild(<div class=\"tw-mg-t-1 ffz-directory-buttons\">\n\t\t\t{block_btn}\n\t\t\t{hidden_btn}\n\t\t</div>);\n\t}\n\n\tgenerateClickHandler(setting, game, update_func) {\n\t\treturn e => {\n\t\t\te.preventDefault();\n\t\t\tconst values = this.settings.provider.get(setting) || [],\n\t\t\t\tidx = values.indexOf(game);\n\n\t\t\tif ( idx === -1 )\n\t\t\t\tvalues.push(game);\n\t\t\telse\n\t\t\t\tvalues.splice(idx, 1);\n\n\t\t\tthis.settings.provider.set(setting, values);\n\t\t\tthis.parent.updateCards();\n\t\t\tupdate_func();\n\t\t}\n\t}\n}","'use strict';\n\n// ============================================================================\n// Directory\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {duration_to_string} from 'utilities/time';\nimport {createElement} from 'utilities/dom';\nimport {get, glob_to_regex, escape_regex, addWordSeparators} from 'utilities/object';\n\nimport Game from './game';\n\nexport const CARD_CONTEXTS = ((e ={}) => {\n\te[e.SingleGameList = 1] = 'SingleGameList';\n\te[e.SingleChannelList = 2] = 'SingleChannelList';\n\te[e.MixedGameAndChannelList = 3] = 'MixedGameAndChannelList';\n\treturn e;\n})();\n\nexport const CONTENT_FLAGS = [\n\t'DrugsIntoxication',\n\t'Gambling',\n\t'MatureGame',\n\t'ProfanityVulgarity',\n\t'SexualThemes',\n\t'ViolentGraphic'\n];\n\nfunction formatTerms(data, flags) {\n\tif ( data[0].length )\n\t\tdata[1].push(addWordSeparators(data[0].join('|')));\n\n\tif ( ! data[1].length )\n\t\treturn null;\n\n\treturn new RegExp(data[1].join('|'), flags);\n}\n\n//const CREATIVE_ID = 488191;\n\nconst DIR_ROUTES = ['front-page', 'dir', 'dir-community', 'dir-community-index', 'dir-creative', 'dir-following', 'dir-game-index', 'dir-game-clips', 'dir-game-videos', 'dir-all', 'dir-category', 'user-videos', 'user-clips'];\n\n\nexport default class Directory extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.elemental');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.router');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.twitch_data');\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\n\t\tthis.inject(Game);\n\n\t\tthis.DirectoryCard = this.elemental.define(\n\t\t\t'directory-card',\n\t\t\t`article[data-a-target^=\"video-carousel-card-\"],article[data-a-target^=\"followed-vod-\"],article[data-a-target^=\"card-\"],div[data-a-target^=\"video-tower-card-\"] article,div[data-a-target^=\"clips-card-\"] article,.shelf-card__impression-wrapper article,.tw-tower div article`,\n\t\t\tDIR_ROUTES, null, 0, 0\n\t\t);\n\n\t\tthis.DirectoryExperimentCard = this.elemental.define(\n\t\t\t'directory-experiment-card',\n\t\t\t'.switcher-hopper__scroll-container .tw-tower > div > a',\n\t\t\tDIR_ROUTES, null, 0, 0\n\t\t);\n\n\t\tthis.DirectoryGameCard = this.elemental.define(\n\t\t\t'directory-game-card', '.game-card[data-a-id]',\n\t\t\tDIR_ROUTES, null, 0, 0\n\t\t);\n\n\t\tthis.DirectoryShelf = this.fine.define(\n\t\t\t'directory-shelf',\n\t\t\tn => n.shouldRenderNode && n.props && n.props.shelf,\n\t\t\tDIR_ROUTES\n\t\t);\n\n\t\tthis.DirectorySorter = this.fine.define(\n\t\t\t'directory-sorter',\n\t\t\tn => n.getSortOptionLink && n.getSortOptionText && n.getSortOptionOnClick && n.getFilterIDs,\n\t\t\tDIR_ROUTES\n\t\t);\n\n\t\tthis.settings.add('directory.hidden.style', {\n\t\t\tdefault: 2,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Categories >> Hidden Thumbnail Style @{\"sort\": 100}',\n\t\t\t\ttitle: 'Hidden Style',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tsort: 100,\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Replace Image'},\n\t\t\t\t\t{value: 1, title: 'Replace Image and Blur Title'},\n\t\t\t\t\t{value: 2, title: 'Blur Image'},\n\t\t\t\t\t{value: 3, title: 'Blur Image and Title'}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: val => {\n\t\t\t\tthis.css_tweaks.toggle('dir-no-blur', val < 2);\n\t\t\t\tthis.css_tweaks.toggle('dir-blur-title', val === 1 || val === 3);\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('directory.hide-costream-border', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Hide border on streams with guest stars.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tgetExtraTerms: () => ['costream', 'co-stream']\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('directory.hidden.reveal', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Categories >> Hidden Thumbnail Style',\n\t\t\t\ttitle: 'Reveal hidden entries on mouse hover.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tsort: 101\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggle('dir-reveal', val)\n\t\t});\n\n\n\t\tthis.settings.add('directory.uptime', {\n\t\t\tdefault: 1,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Stream Uptime',\n\t\t\t\tdescription: 'Display the stream uptime on the channel cards.',\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Enabled'},\n\t\t\t\t\t{value: 2, title: 'Enabled (with Seconds)'}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.show-flags', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Display Content Flags on channel cards.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\t/*this.settings.add('directory.show-channel-avatars', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Display channel avatars.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});*/\n\n\n\t\tthis.settings.add('directory.hide-live', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Do not show the Live indicator on channels that are live.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: value => this.css_tweaks.toggleHide('dir-live-ind', value)\n\t\t});\n\n\t\tthis.settings.add('directory.hide-promoted', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Do not show Promoted streams in the directory.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\n\t\tthis.settings.add('directory.hide-vodcasts', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Do not show reruns in the directory.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.hide-recommended', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Following >> Categories',\n\t\t\t\ttitle: 'Do not show `Recommended Live Channels` in the Following Directory.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.DirectoryShelf.forceUpdate()\n\t\t});\n\n\n\t\tthis.settings.add('directory.block-users', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Block by Username',\n\t\t\t\tcomponent: 'basic-terms',\n\t\t\t\twords: false\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:directory.block-users', {\n\t\t\trequires: ['directory.block-users'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('directory.block-users');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = [[], []];\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst t = item.t;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tout[item.s ? 0 : 1].push(v);\n\t\t\t\t}\n\n\t\t\t\treturn [\n\t\t\t\t\tout[0].length\n\t\t\t\t\t\t? new RegExp(`^(?:${out[0].join('|')})$`)\n\t\t\t\t\t\t: null,\n\t\t\t\t\tout[1].length\n\t\t\t\t\t\t? new RegExp(`^(?:${out[1].join('|')})$`, 'i')\n\t\t\t\t\t\t: null\n\t\t\t\t];\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.block-titles', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Block by Title',\n\t\t\t\tcomponent: 'basic-terms'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:directory.block-titles', {\n\t\t\trequires: ['directory.block-titles'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('directory.block-titles');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = [\n\t\t\t\t\t[ // sensitive\n\t\t\t\t\t\t[], [] // word\n\t\t\t\t\t],\n\t\t\t\t\t[\n\t\t\t\t\t\t[], []\n\t\t\t\t\t]\n\t\t\t\t];\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst t = item.t;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tout[item.s ? 0 : 1][item.w ? 0 : 1].push(v);\n\t\t\t\t}\n\n\t\t\t\treturn [\n\t\t\t\t\tformatTerms(out[0], 'g'),\n\t\t\t\t\tformatTerms(out[1], 'gi')\n\t\t\t\t];\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.blocked-tags', {\n\t\t\tdefault: [],\n\t\t\ttype: 'basic_array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Block by Tag',\n\t\t\t\tcomponent: 'tag-list-editor'\n\t\t\t},\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\n\t\tthis.settings.add('directory.blur-titles', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Hide Thumbnails by Title',\n\t\t\t\tcomponent: 'basic-terms'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('__filter:directory.blur-titles', {\n\t\t\trequires: ['directory.blur-titles'],\n\t\t\tequals: 'requirements',\n\t\t\tprocess(ctx) {\n\t\t\t\tconst val = ctx.get('directory.blur-titles');\n\t\t\t\tif ( ! val || ! val.length )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst out = [\n\t\t\t\t\t[ // sensitive\n\t\t\t\t\t\t[], [] // word\n\t\t\t\t\t],\n\t\t\t\t\t[\n\t\t\t\t\t\t[], []\n\t\t\t\t\t]\n\t\t\t\t];\n\n\t\t\t\tfor(const item of val) {\n\t\t\t\t\tconst t = item.t;\n\t\t\t\t\tlet v = item.v;\n\n\t\t\t\t\tif ( t === 'glob' )\n\t\t\t\t\t\tv = glob_to_regex(v);\n\n\t\t\t\t\telse if ( t !== 'raw' )\n\t\t\t\t\t\tv = escape_regex(v);\n\n\t\t\t\t\tif ( ! v || ! v.length )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tout[item.s ? 0 : 1][item.w ? 0 : 1].push(v);\n\t\t\t\t}\n\n\t\t\t\treturn [\n\t\t\t\t\tformatTerms(out[0], 'g'),\n\t\t\t\t\tformatTerms(out[1], 'gi')\n\t\t\t\t];\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.blur-tags', {\n\t\t\tdefault: [],\n\t\t\ttype: 'basic_array_merge',\n\t\t\talways_inherit: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Hide Thumbnails by Tag',\n\t\t\t\tcomponent: 'tag-list-editor'\n\t\t\t},\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.wait-flags', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Appearance',\n\t\t\t\ttitle: 'Hide Thumbnails for all channels until Content Flags have been loaded.',\n\t\t\t\tdescription: 'We need to load content flags with a separate query, so they aren\\'t immediately available to determine if a given stream should be hidden, or have its thumbnail blurred. This setting will blur ALL thumbnails until after we\\'ve finished loading the necessary content flag information, ensuring you don\\'t see a flash of anything you would rather not.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.block-flags', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tconst out = new Set;\n\t\t\t\tfor(const v of val) {\n\t\t\t\t\tlet item = v?.v;\n\t\t\t\t\tif ( item === 'ViolentGrpahic')\n\t\t\t\t\t\titem = 'ViolentGraphic';\n\t\t\t\t\tif ( item )\n\t\t\t\t\t\tout.add(item);\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Block by Flag',\n\t\t\t\tcomponent: 'blocked-types',\n\t\t\t\tgetExtraTerms: () => [...CONTENT_FLAGS],\n\t\t\t\tdata: () => [...CONTENT_FLAGS]\n\t\t\t\t\t.sort()\n\t\t\t},\n\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\tthis.settings.add('directory.blur-flags', {\n\t\t\tdefault: [],\n\t\t\ttype: 'array_merge',\n\t\t\talways_inherit: true,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tconst out = new Set;\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tif ( v?.v )\n\t\t\t\t\t\tout.add(v.v);\n\n\t\t\t\treturn out;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Channels >> Hide Thumbnails by Flag',\n\t\t\t\tcomponent: 'blocked-types',\n\t\t\t\tgetExtraTerms: () => [...CONTENT_FLAGS],\n\t\t\t\tdata: () => [...CONTENT_FLAGS]\n\t\t\t\t\t.sort()\n\t\t\t},\n\t\t\tchanged: () => this.updateCards()\n\t\t});\n\n\t\t/*this.settings.add('directory.hide-viewing-history', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Following >> Categories',\n\t\t\t\ttitle: 'Do not show `Based on your viewing history` in the Following Directory.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.DirectorySuggestedVideos.forceUpdate()\n\t\t});\n\n\t\tthis.settings.add('directory.hide-latest-videos', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > Following >> Categories',\n\t\t\t\ttitle: 'Do not show `Latest Videos` in the Following Directory.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.DirectoryLatestVideos.forceUpdate()\n\t\t});*/\n\n\t\tthis.settings.add('directory.default-sort', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Directory > General >> General',\n\t\t\t\ttitle: 'Force Default Sorting',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tdata: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: false,\n\t\t\t\t\t\ttitle: 'Disabled'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'RELEVANCE',\n\t\t\t\t\t\ttitle: 'Recommended For You'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'VIEWER_COUNT',\n\t\t\t\t\t\ttitle: 'Viewers (High to Low)'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'VIEWER_COUNT_ASC',\n\t\t\t\t\t\ttitle: 'Viewers (Low to High)'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'RECENT',\n\t\t\t\t\t\ttitle: 'Recently Started'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\tchanged: () => this.updateSorting()\n\t\t});\n\n\t\tthis.routeClick = this.routeClick.bind(this);\n\t}\n\n\n\tonEnable() {\n\t\tthis.css_tweaks.toggleHide('profile-hover', this.settings.get('directory.show-channel-avatars') === 2);\n\t\tthis.css_tweaks.toggleHide('dir-live-ind', this.settings.get('directory.hide-live'));\n\t\tthis.css_tweaks.toggle('dir-reveal', this.settings.get('directory.hidden.reveal'));\n\t\tthis.settings.getChanges('directory.hide-costream-border', val => this.css_tweaks.toggle('hide-costream-border', val));\n\n\t\tconst blur = this.settings.get('directory.hidden.style');\n\n\t\tthis.css_tweaks.toggle('dir-no-blur', blur < 2);\n\t\tthis.css_tweaks.toggle('dir-blur-title', blur === 1 || blur === 3);\n\n\t\tthis.on('i18n:update', () => this.updateCards());\n\n\t\tthis.DirectoryExperimentCard.on('mount', this.updateExpCard, this);\n\t\tthis.DirectoryExperimentCard.on('mutate', this.updateExpCard, this);\n\t\tthis.DirectoryExperimentCard.on('unmount', this.clearExpCard, this);\n\t\tthis.DirectoryExperimentCard.each(el => this.updateExpCard(el));\n\n\t\tthis.DirectoryCard.on('mount', this.updateCard, this);\n\t\tthis.DirectoryCard.on('mutate', this.updateCard, this);\n\t\tthis.DirectoryCard.on('unmount', this.clearCard, this);\n\t\tthis.DirectoryCard.each(el => this.updateCard(el));\n\n\t\tthis.DirectoryGameCard.on('mount', this.updateGameCard, this);\n\t\tthis.DirectoryGameCard.on('mutate', this.updateGameCard, this);\n\t\t//this.DirectoryGameCard.on('unmount', this.clearGameCard, this);\n\t\tthis.DirectoryGameCard.each(el => this.updateGameCard(el));\n\n\t\tthis.DirectorySorter.on('mount', this.updateSorting, this);\n\t\tthis.DirectorySorter.ready(() => this.updateSorting());\n\n\t\tconst t = this;\n\n\t\tthis.DirectoryShelf.ready(cls => {\n\t\t\tconst old_should_render = cls.prototype.shouldRenderNode;\n\t\t\tcls.prototype.shouldRenderNode = function(node, ...args) {\n\t\t\t\ttry {\n\t\t\t\t\tlet game;\n\t\t\t\t\tif ( node.__typename === 'Game' )\n\t\t\t\t\t\tgame = node.name;\n\t\t\t\t\telse if ( node.game )\n\t\t\t\t\t\tgame = node.game.name;\n\n\t\t\t\t\tif ( game && t.settings.provider.get('directory.game.blocked-games', []).includes(game) )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t\tt.log.error(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_should_render.call(this, node, ...args);\n\t\t\t}\n\n\t\t\tconst old_render = cls.prototype.render;\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( t.settings.get('directory.hide-recommended') ) {\n\t\t\t\t\t\tconst key = get('props.shelf.title.key', this);\n\t\t\t\t\t\tif ( key === 'live_recs_following' )\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.DirectoryShelf.forceUpdate();\n\t\t});\n\t}\n\n\tupdateSorting(inst) {\n\t\tif ( ! inst ) {\n\t\t\tfor(const inst of this.DirectorySorter.instances)\n\t\t\t\tthis.updateSorting(inst);\n\t\t\treturn;\n\t\t}\n\n\t\tconst mode = this.settings.get('directory.default-sort');\n\t\tif ( ! mode || mode === inst.state?.activeOption )\n\t\t\treturn;\n\n\t\tconst link = inst.getSortOptionLink(mode, false, inst.props);\n\t\tif ( ! link?.props?.linkTo )\n\t\t\treturn;\n\n\t\t// Handle the onClick logic. This sets localStorage values\n\t\t// to restore this sort in the future.\n\t\tif ( link.props.onClick )\n\t\t\tlink.props.onClick();\n\n\t\t// And follow the generated link.\n\t\tthis.router.push(link.props.linkTo);\n\t}\n\n\tupdateGameCard(el) {\n\t\tconst react = this.fine.getReactInstance(el);\n\t\tif ( ! react )\n\t\t\treturn;\n\n\t\tconst props = react.return?.memoizedProps;\n\t\tif ( ! props?.trackingProps?.category )\n\t\t\treturn;\n\n\t\tconst game = props.trackingProps.category,\n\t\t\ttags = props.tagListProps?.tags;\n\n\t\tlet bad_tag = false;\n\n\t\tif ( Array.isArray(tags) ) {\n\t\t\tconst bad_tags = this.settings.get('directory.blocked-tags', []);\n\t\t\tif ( bad_tags.length ) {\n\t\t\t\tfor(const tag of tags) {\n\t\t\t\t\tif ( tag?.id && bad_tags.includes(tag.id) ) {\n\t\t\t\t\t\tbad_tag = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst should_hide = bad_tag || this.settings.provider.get('directory.game.blocked-games', []).includes(game);\n\n\t\tlet hide_container = el.closest('.tw-tower > div');\n\t\tif ( ! hide_container )\n\t\t\thide_container = el;\n\n\t\tif ( hide_container.querySelectorAll('a[data-a-target=\"tw-box-art-card-link\"]').length < 2 )\n\t\t\thide_container.classList.toggle('tw-hide', should_hide);\n\t}\n\n\tupdateCards() {\n\t\tthis.DirectoryCard.each(el => this.updateCard(el));\n\t\tthis.DirectoryExperimentCard.each(el => this.updateExpCard(el));\n\t\tthis.DirectoryGameCard.each(el => this.updateGameCard(el));\n\t\tthis.DirectoryShelf.forceUpdate();\n\n\t\tthis.emit(':update-cards');\n\t}\n\n\tclearCard(el, for_exp = false) {\n\t\tthis.clearUptime(el);\n\t\tthis.clearFlags(el);\n\n\t\tconst cont = this._getTopRightContainer(el, for_exp);\n\t\tif ( cont )\n\t\t\tcont.remove();\n\n\t\tel._ffz_top_right = null;\n\t}\n\n\tclearExpCard(el) {\n\t\treturn this.clearCard(el, true);\n\t}\n\n\tupdateCard(el) {\n\t\tconst parent = this.fine.searchParentNode(el, n => n.memoizedProps?.channelLogin);\n\t\tif ( ! parent )\n\t\t\treturn;\n\n\t\tconst props = parent.memoizedProps;\n\t\treturn this._updateCard(el, false, props, props.trackingProps);\n\t}\n\n\tupdateExpCard(el) {\n\t\tconst parent = this.fine.searchParentNode(el, n => n.memoizedProps?.item?.channelID);\n\t\tif ( ! parent )\n\t\t\treturn;\n\n\t\tconst props = parent.memoizedProps,\n\t\t\titem = props.item;\n\n\t\treturn this._updateCard(el, true, item, props.tracking);\n\t}\n\n\t_updateCard(el, for_exp, item, tracking) {\n\t\tconst game = item.categoryName || item.gameTitle || tracking?.game || tracking?.categoryName || tracking?.category,\n\t\t\ttags = item.tags ?? item.tagListProps?.freeformTags;\n\n\t\tconst need_flags = this.settings.get('directory.wait-flags'),\n\t\t\tshow_flags = this.settings.get('directory.show-flags'),\n\t\t\tblur_flags = this.settings.get('directory.blur-flags', []),\n\t\t\tblock_flags = this.settings.get('directory.block-flags', []),\n\t\t\tfilter_flags = blur_flags.size > 0 || block_flags.size > 0,\n\t\t\thas_flags = show_flags || filter_flags;\n\n\t\tif ( el._ffz_flags === undefined && has_flags ) {\n\t\t\tel._ffz_flags = null;\n\n\t\t\t// Are we getting a clip, a video, or a stream?\n\t\t\tif ( item.slug || item.type === 'clips' ) {\n\t\t\t\t// Clip\n\t\t\t\t//console.log('need flags for clip', props.slug);\n\t\t\t\tel._ffz_flags = [];\n\n\t\t\t} else if ( item.vodID || item.type === 'videos' ) {\n\t\t\t\t// Video\n\t\t\t\t//console.log('need flags for vod', props.vodID);\n\t\t\t\tel._ffz_flags = [];\n\n\t\t\t} else {\n\t\t\t\t// Stream?\n\t\t\t\t//console.log('need flags for stream', props.channelLogin);\n\t\t\t\tthis.twitch_data.getStreamFlags(item.channelID, item.channelID ? null : item.channelLogin).then(data => {\n\t\t\t\t\tel._ffz_flags = data ?? [];\n\t\t\t\t\tfor_exp\n\t\t\t\t\t\t? this.updateExpCard(el)\n\t\t\t\t\t\t: this.updateCard(el);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tlet bad_tag = false,\n\t\t\tblur_tag = false;\n\n\t\tif ( Array.isArray(tags) ) {\n\t\t\tconst bad_tags = this.settings.get('directory.blocked-tags', []),\n\t\t\t\tblur_tags = this.settings.get('directory.blur-tags', []);\n\n\t\t\tif ( bad_tags.length || blur_tags.length ) {\n\t\t\t\tfor(const tag of tags) {\n\t\t\t\t\tif ( tag?.name ) {\n\t\t\t\t\t\tconst lname = tag.name.toLowerCase();\n\t\t\t\t\t\tif ( bad_tags.includes(lname) )\n\t\t\t\t\t\t\tbad_tag = true;\n\t\t\t\t\t\tif ( blur_tags.includes(lname) )\n\t\t\t\t\t\t\tblur_tag = true;\n\t\t\t\t\t}\n\t\t\t\t\tif ( (bad_tag || ! bad_tags.length) && (blur_tag || ! blur_tags.length) )\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet should_blur = blur_tag;\n\t\tif ( need_flags && filter_flags && el._ffz_flags == null )\n\t\t\tshould_blur = true;\n\t\tif ( ! should_blur )\n\t\t\tshould_blur = this.settings.provider.get('directory.game.hidden-thumbnails', []).includes(game);\n\t\tif ( ! should_blur && blur_flags.size && el._ffz_flags ) {\n\t\t\tfor(const flag of el._ffz_flags)\n\t\t\t\tif ( flag?.id && blur_flags.has(flag.id) ) {\n\t\t\t\t\tshould_blur = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t}\n\t\tif ( ! should_blur ) {\n\t\t\tconst regexes = this.settings.get('__filter:directory.blur-titles');\n\t\t\tif ( regexes ) {\n\t\t\t\tif ( regexes[0] )\n\t\t\t\t\tregexes[0].lastIndex = -1;\n\t\t\t\tif ( regexes[1] )\n\t\t\t\t\tregexes[1].lastIndex = -1;\n\n\t\t\t\tif (( regexes[0] && regexes[0].test(item.title) ) || ( regexes[1] && regexes[1].test(item.title) ))\n\t\t\t\t\tshould_blur = true;\n\t\t\t}\n\t\t}\n\n\t\tconst type = item.type ?? item.streamType;\n\n\t\tel.classList.toggle('ffz-hide-thumbnail', should_blur);\n\t\tel.dataset.ffzType = type;\n\n\t\tlet should_hide = false;\n\t\tif ( bad_tag )\n\t\t\tshould_hide = true;\n\t\telse if ( type === 'rerun' && this.settings.get('directory.hide-vodcasts') )\n\t\t\tshould_hide = true;\n\t\telse if ( item.context != null && item.context !== CARD_CONTEXTS.SingleGameList && this.settings.provider.get('directory.game.blocked-games', []).includes(game) )\n\t\t\tshould_hide = true;\n\t\telse if ( (item.isPromotion || item.sourceType === 'COMMUNITY_BOOST' || item.sourceType === 'PROMOTION' || item.sourceType === 'SPONSORED') && this.settings.get('directory.hide-promoted') )\n\t\t\tshould_hide = true;\n\t\telse {\n\t\t\tif ( block_flags.size && el._ffz_flags ) {\n\t\t\t\tfor(const flag of el._ffz_flags)\n\t\t\t\t\tif ( flag?.id && block_flags.has(flag.id) ) {\n\t\t\t\t\t\tshould_hide = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! should_hide ) {\n\t\t\t\tconst regexes = this.settings.get('__filter:directory.block-users');\n\t\t\t\tif ( regexes ) {\n\t\t\t\t\tif ( regexes[0] )\n\t\t\t\t\t\tregexes[0].lastIndex = -1;\n\t\t\t\t\tif ( regexes[1] )\n\t\t\t\t\t\tregexes[1].lastIndex = -1;\n\n\t\t\t\t\tif (( regexes[0] && regexes[0].test(item.channelLogin) ) || ( regexes[1] && regexes[1].test(item.channelLogin) ))\n\t\t\t\t\t\tshould_hide = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! should_hide ) {\n\t\t\t\tconst regexes = this.settings.get('__filter:directory.block-titles');\n\t\t\t\tif ( regexes ) {\n\t\t\t\t\tif ( regexes[0] )\n\t\t\t\t\t\tregexes[0].lastIndex = -1;\n\t\t\t\t\tif ( regexes[1] )\n\t\t\t\t\t\tregexes[1].lastIndex = -1;\n\n\t\t\t\t\tif (( regexes[0] && regexes[0].test(item.title) ) || ( regexes[1] && regexes[1].test(item.title) ))\n\t\t\t\t\t\tshould_hide = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet hide_container = el.closest('.tw-tower > div');\n\t\tif ( ! hide_container )\n\t\t\thide_container = el;\n\n\t\tif ( hide_container.querySelectorAll('.tw-aspect .tw-image:not(.tw-image-avatar)').length < 2 )\n\t\t\thide_container.classList.toggle('tw-hide', should_hide);\n\n\t\tthis.updateUptime(el, item, for_exp);\n\t\tthis.updateFlags(el, for_exp);\n\t}\n\n\tupdateFlags(el, for_exp = false) {\n\t\tif ( ! document.contains(el) )\n\t\t\treturn this.clearFlags(el);\n\n\t\tconst setting = this.settings.get('directory.show-flags');\n\n\t\tif ( ! setting || ! el._ffz_flags?.length )\n\t\t\treturn this.clearFlags(el);\n\n\t\tconst container = this._getTopRightContainer(el, true, for_exp);\n\t\tif ( ! container )\n\t\t\treturn this.clearFlags(el);\n\n\t\tif ( ! el.ffz_flags_el )\n\t\t\tcontainer.appendChild(el.ffz_flags_el = (<div class=\"tw-mg-y-05 ffz-flags-element tw-relative ffz-il-tooltip__container\">\n\t\t\t\t<div class=\"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05\">\n\t\t\t\t\t<figure class=\"ffz-i-flag\" />\n\t\t\t\t</div>\n\t\t\t\t{el.ffz_flags_tt = <div class=\"ffz-il-tooltip ffz-il-tooltip--pre ffz-il-tooltip--down ffz-il-tooltip--align-right\" />}\n\t\t\t</div>));\n\n\t\telse if ( ! el.contains(el.ffz_flags_el) )\n\t\t\tcontainer.appendChild(el.ffz_flags_el);\n\n\t\tel.ffz_flags_tt.textContent = this.i18n.t('metadata.flags.tooltip', 'Intended for certain audiences. May contain:')\n\t\t\t+ '\\n\\n'\n\t\t\t+ el._ffz_flags.map(x => x.localizedName).join('\\n');\n\t}\n\n\tclearFlags(el) {\n\t\tif ( el.ffz_flags_el ) {\n\t\t\tel.ffz_flags_el.remove();\n\t\t\tel.ffz_flags_tt = null;\n\t\t\tel.ffz_flags_el = null;\n\t\t}\n\t}\n\n\n\t_getTopRightContainer(el, should_create = true, for_exp = false) {\n\t\tlet cont = el._ffz_top_right ?? el.querySelector('.ffz-top-right');\n\t\tif ( cont || ! should_create )\n\t\t\treturn cont;\n\n\t\tlet container = for_exp\n\t\t\t? el.querySelector('.tw-aspect .tw-image')\n\t\t\t: el.querySelector('a[data-a-target=\"preview-card-image-link\"] > div');\n\t\tif ( container && for_exp )\n\t\t\tcontainer = container.parentElement?.parentElement;\n\t\tif ( ! container )\n\t\t\treturn null;\n\n\t\tcont = (<div\n\t\t\tdata-test-selector=\"top-right-selector\"\n\t\t\tclass=\"tw-absolute tw-mg-1 tw-right-0 tw-top-0 ffz-top-right tw-flex tw-flex-column tw-align-items-end\"\n\t\t/>);\n\t\tel._ffz_top_right = cont;\n\n\t\tcontainer.appendChild(cont);\n\t\treturn cont;\n\t}\n\n\n\tupdateUptime(el, props, for_exp = false) {\n\t\tif ( ! document.contains(el) )\n\t\t\treturn this.clearUptime(el);\n\n\t\tconst setting = this.settings.get('directory.uptime'),\n\t\t\tcontainer = this._getTopRightContainer(el, setting > 0, for_exp);\n\n\t\t//const container = el.querySelector('a[data-a-target=\"preview-card-image-link\"] > div'),\n\t\t//\tsetting = this.settings.get('directory.uptime');\n\n\t\tif ( ! container || setting === 0 || props.viewCount || props.animatedImageProps || props.type === 'videos' || props.type === 'clips' )\n\t\t\treturn this.clearUptime(el);\n\n\t\tlet created_at = props.createdAt;\n\n\t\tif ( ! created_at ) {\n\t\t\tif ( el.ffz_stream_meta === undefined ) {\n\t\t\t\tel.ffz_stream_meta = null;\n\t\t\t\tthis.twitch_data.getStreamMeta(null, props.channelLogin).then(data => {\n\t\t\t\t\tel.ffz_stream_meta = data;\n\t\t\t\t\tthis.updateUptime(el, props, for_exp);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcreated_at = el.ffz_stream_meta?.createdAt;\n\t\t}\n\n\t\tconst up_since = created_at && new Date(created_at),\n\t\t\tuptime = up_since && Math.floor((Date.now() - up_since) / 1000) || 0;\n\n\t\tif ( uptime < 1 )\n\t\t\treturn this.clearUptime(el);\n\n\t\tconst up_text = duration_to_string(uptime, false, false, false, setting === 1);\n\n\t\tif ( ! el.ffz_uptime_el )\n\t\t\tel.ffz_uptime_el = container.querySelector('.ffz-uptime-element');\n\n\t\tif ( ! el.ffz_uptime_el )\n\t\t\tcontainer.appendChild(el.ffz_uptime_el = (\n\t\t\t\t<div class=\"ffz-uptime-element tw-relative ffz-il-tooltip__container\">\n\t\t\t\t\t<div class=\"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05\">\n\t\t\t\t\t\t<div class=\"tw-flex tw-c-text-live\">\n\t\t\t\t\t\t\t<figure class=\"ffz-i-clock\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{el.ffz_uptime_span = <p />}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-right\">\n\t\t\t\t\t\t{this.i18n.t('metadata.uptime.tooltip', 'Stream Uptime')}\n\t\t\t\t\t\t{el.ffz_uptime_tt = <div class=\"tw-pd-t-05\" />}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t));\n\n\t\telse if ( ! el.contains(el.ffz_uptime_el) )\n\t\t\tcontainer.appendChild(el.ffz_uptime_el);\n\n\t\tif ( ! el.ffz_uptime_span )\n\t\t\tel.ffz_uptime_span = el.ffz_uptime_el.querySelector('p');\n\t\tif ( ! el.ffz_uptime_span )\n\t\t\treturn this.clearUptime(el);\n\n\t\tif ( ! el.ffz_uptime_tt )\n\t\t\tel.ffz_uptime_tt = el.ffz_uptime_el.querySelector('.ffz-il-tooltip > div');\n\t\tif ( ! el.ffz_uptime_tt )\n\t\t\treturn this.clearUptime(el);\n\n\t\tif ( ! el.ffz_update_timer )\n\t\t\tel.ffz_update_timer = setInterval(this.updateUptime.bind(this, el, props, for_exp), 1000);\n\n\t\tel.ffz_uptime_span.textContent = up_text;\n\n\t\tif ( el.ffz_last_created_at !== created_at ) {\n\t\t\tel.ffz_uptime_tt.textContent = this.i18n.t(\n\t\t\t\t'metadata.uptime.since',\n\t\t\t\t'(since {since,datetime})',\n\t\t\t\t{since: up_since}\n\t\t\t);\n\n\t\t\tel.ffz_last_created_at = created_at;\n\t\t}\n\t}\n\n\n\tclearUptime(inst) { // eslint-disable-line class-methods-use-this\n\t\tif ( inst.ffz_update_timer ) {\n\t\t\tclearInterval(inst.ffz_update_timer);\n\t\t\tinst.ffz_update_timer = null;\n\t\t}\n\n\t\tif ( inst.ffz_uptime_el ) {\n\t\t\tinst.ffz_uptime_el.remove();\n\t\t\tinst.ffz_uptime_el = null;\n\t\t\tinst.ffz_uptime_span = null;\n\t\t\tinst.ffz_uptime_tt = null;\n\t\t\tinst.ffz_last_created_at = null;\n\t\t}\n\t}\n\n\n\trouteClick(event, url) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( ! url ) {\n\t\t\tconst target = event.currentTarget;\n\n\t\t\tif ( target ) {\n\t\t\t\tconst ds = target.dataset;\n\t\t\t\tif ( ds && ds.href )\n\t\t\t\t\turl = ds.href;\n\n\t\t\t\telse if ( target.href )\n\t\t\t\t\turl = target.href;\n\t\t\t}\n\t\t}\n\n\t\tif ( url )\n\t\t\tthis.router.push(url);\n\t}\n\n\n\thijackUserClick(event, user, optionalFn = null) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif ( optionalFn )\n\t\t\toptionalFn(event, user);\n\n\t\tthis.router.navigate('user', { userName: user });\n\t}\n}\n","'use strict';\n\nimport { IS_FIREFOX } from 'src/utilities/constants';\n// ============================================================================\n// Layout Overrides for Twitch Twilight\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {debounce, has} from 'utilities/object';\n\nconst PORTRAIT_ROUTES = ['user', 'video', 'user-video', 'user-clip', 'user-videos', 'user-clips', 'user-collections', 'user-events', 'user-followers', 'user-following'];\nconst MINIMAL_ROUTES = ['popout', 'embed-chat', 'dash-chat'];\n\nexport default class Layout extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.elemental');\n\n\t\t/*this.TopNav = this.fine.define(\n\t\t\t'top-nav',\n\t\t\tn => n.computeStyles && n.navigationLinkSize\n\t\t);*/\n\n\t\t/*this.RightColumn = this.fine.define(\n\t\t\t'tw-rightcolumn',\n\t\t\tn => n.hideOnBreakpoint && n.handleToggleVisibility\n\t\t);*/\n\n\t\tthis.ResizeDetector = this.fine.define(\n\t\t\t'resize-detector',\n\t\t\tn => n.maybeDebounceOnScroll && n.setGrowDivRef && n.props.onResize\n\t\t);\n\n\t\tthis.SideBar = this.elemental.define(\n\t\t\t'sidebar',\n\t\t\t'.side-bar-contents',\n\t\t\tnull,\n\t\t\t{childNodes: true, subtree: true}, 1\n\t\t);\n\n\t\t/*this.SideBarChannels = this.fine.define(\n\t\t\t'nav-cards',\n\t\t\tt => t.getCardSlideInContent && t.props && has(t.props, 'tooltipContent')\n\t\t);*/\n\n\t\tthis.settings.add('clips.layout.big', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Clips',\n\t\t\t\ttitle: 'Allow the player to get larger on `clips.twitch.tv` pages.',\n\t\t\t\tdescription: 'This only affects windows at least 1,200 pixels wide and attempts to make the player and chat replay as large as possible.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.portrait', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Channel',\n\t\t\t\ttitle: 'Enable Portrait Mode',\n\t\t\t\tdescription: 'In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.portrait-invert', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Channel',\n\t\t\t\ttitle: 'When in portrait mode, place chat at the top.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => document.body.classList.toggle('ffz--portrait-invert', val)\n\t\t});\n\n\t\tthis.settings.add('layout.portrait-threshold', {\n\t\t\tdefault: 1.25,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Channel',\n\t\t\t\ttitle: 'Portrait Mode Threshold',\n\t\t\t\tdescription: 'This is the Width to Height ratio at which point Portrait Mode will begin to activate.',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess(val) {\n\t\t\t\t\tval = parseFloat(val, 10)\n\t\t\t\t\tif ( isNaN(val) || ! isFinite(val) || val <= 0 )\n\t\t\t\t\t\treturn 1.25;\n\n\t\t\t\t\treturn val;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.portrait-min-chat', {\n\t\t\tdefault: false,\n\t\t\trequires: ['layout.use-portrait'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( ! ctx.get('layout.use-portrait') )\n\t\t\t\t\treturn false;\n\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Channel',\n\t\t\t\ttitle: 'Use compact chat in Portrait Mode.',\n\t\t\t\tdescription: 'When enabled, this minimizes the chat header and places the chat input box in line with the chat buttons in order to present a more compact chat able to display more lines with limited vertical space.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\t//changed: val => this.css_tweaks.toggle('portrait-chat', val)\n\t\t})\n\n\t\tthis.settings.add('layout.use-portrait', {\n\t\t\trequires: ['layout.portrait', 'layout.portrait-threshold', 'context.route.name', 'context.size', 'context.isWatchParty'],\n\t\t\tprocess(ctx) {\n\t\t\t\tif ( ctx.get('context.isWatchParty') )\n\t\t\t\t\treturn false;\n\n\t\t\t\tconst size = ctx.get('context.size');\n\t\t\t\tif ( ! size || ! ctx.get('layout.portrait') || ! PORTRAIT_ROUTES.includes(ctx.get('context.route.name')) )\n\t\t\t\t\treturn false;\n\n\t\t\t\tconst ratio = size.width / size.height;\n\t\t\t\treturn ratio <= ctx.get('layout.portrait-threshold');\n\t\t\t},\n\t\t\tchanged: () => this.updatePortraitMode()\n\t\t});\n\n\t\tthis.settings.add('layout.inject-portrait', {\n\t\t\trequires: ['layout.use-portrait', 'context.ui.rightColumnExpanded'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ctx.get('layout.use-portrait') && ctx.get('context.ui.rightColumnExpanded');\n\t\t\t},\n\t\t\t//changed: val => this.css_tweaks.toggle('portrait', val)\n\t\t});\n\n\t\tthis.settings.add('layout.fix-player-size', {\n\t\t\trequires: ['layout.inject-portrait', 'chat.use-width', 'layout.swap-sidebars'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ctx.get('layout.inject-portrait') || ctx.get('chat.use-width') || ctx.get('layout.swap-sidebars');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.use-portrait-swapped', {\n\t\t\trequires: ['layout.inject-portrait', 'layout.swap-sidebars'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ctx.get('layout.inject-portrait') && ctx.get('layout.swap-sidebars')\n\t\t\t},\n\t\t\t//changed: val => this.css_tweaks.toggle('portrait-swapped', val)\n\t\t});\n\n\t\tthis.settings.add('layout.use-portrait-meta', {\n\t\t\trequires: ['layout.inject-portrait', 'player.theatre.metadata'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ctx.get('layout.inject-portrait') && ctx.get('player.theatre.metadata')\n\t\t\t},\n\t\t\t//changed: val => this.css_tweaks.toggle('portrait-metadata', val)\n\t\t});\n\n\t\tthis.settings.add('layout.use-portrait-meta-top', {\n\t\t\trequires: ['layout.use-portrait-meta', 'layout.portrait-invert'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ctx.get('layout.use-portrait-meta') && ! ctx.get('layout.portrait-invert')\n\t\t\t},\n\t\t\t//changed: val => this.css_tweaks.toggle('portrait-metadata-top', val)\n\t\t});\n\n\t\tthis.settings.add('layout.is-theater-mode', {\n\t\t\trequires: ['context.ui.theatreModeEnabled', 'context.fullscreen'],\n\t\t\tprocess(ctx) {\n\t\t\t\tif ( ctx.get('context.fullscreen') )\n\t\t\t\t\treturn false;\n\t\t\t\treturn ctx.get('context.ui.theatreModeEnabled');\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('layout.show-portrait-chat', {\n\t\t\trequires: ['layout.use-portrait', 'layout.portrait-extra-height', 'layout.portrait-extra-width'],\n\t\t\tprocess() {\n\t\t\t\t// TODO: Calculate this based on the expected player height.\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tchanged: () => this.updatePortraitMode()\n\t\t});\n\n\t\tthis.settings.add('layout.portrait-extra-height', {\n\t\t\trequires: ['context.new_channel', 'context.squad_bar', /*'context.hosting',*/ 'layout.is-theater-mode', 'player.theatre.no-whispers', 'whispers.show', 'layout.minimal-navigation'],\n\t\t\tprocess(ctx) {\n\t\t\t\tlet height = 0;\n\t\t\t\tif ( ctx.get('layout.is-theater-mode') ) {\n\t\t\t\t\tif ( ctx.get('layout.minimal-navigation') )\n\t\t\t\t\t\theight += 1;\n\n\t\t\t\t\tif ( ctx.get('whispers.show') && ! ctx.get('player.theatre.no-whispers') )\n\t\t\t\t\t\theight += 4;\n\n\t\t\t\t} else {\n\t\t\t\t\theight = ctx.get('layout.minimal-navigation') ? 1 : 5;\n\t\t\t\t\tif ( ctx.get('whispers.show') )\n\t\t\t\t\t\theight += 4;\n\n\t\t\t\t\tif ( ctx.get('context.squad_bar') )\n\t\t\t\t\t\theight += 6;\n\n\t\t\t\t\theight += ctx.get('context.new_channel') ? 1 : 5;\n\n\t\t\t\t\t/*if ( ctx.get('context.hosting') )\n\t\t\t\t\t\theight += 4;*/\n\t\t\t\t}\n\n\t\t\t\treturn height;\n\t\t\t},\n\n\t\t\t//changed: val => this.css_tweaks.setVariable('portrait-extra-height', `${val}rem`)\n\t\t})\n\n\t\tthis.settings.add('layout.portrait-extra-width', {\n\t\t\trequire: ['layout.side-nav.show', 'layout.is-theater-mode', 'context.ui.sideNavExpanded'],\n\t\t\tprocess(ctx) {\n\t\t\t\tif ( ! ctx.get('layout.side-nav.show') || ctx.get('layout.is-theater-mode') )\n\t\t\t\t\treturn 0;\n\n\t\t\t\treturn ctx.get('context.ui.sideNavExpanded') ? 24 : 5\n\t\t\t},\n\n\t\t\t//changed: val => this.css_tweaks.setVariable('portrait-extra-width', `${val}rem`)\n\t\t});\n\n\t\tthis.settings.add('layout.is-minimal', {\n\t\t\trequire: ['context.route.name'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn MINIMAL_ROUTES.includes(ctx.get('context.route.name'));\n\t\t\t}\n\t\t});\n\t}\n\n\tonEnable() {\n\t\tdocument.body.classList.toggle('ffz--portrait-invert', this.settings.get('layout.portrait-invert'));\n\n\t\tthis.on(':update-nav', this.updateNavLinks, this);\n\t\tthis.on(':resize', this.handleResize, this);\n\n\t\tthis.settings.getChanges('layout.portrait-min-chat', val => this.css_tweaks.toggle('portrait-chat', val));\n\t\tthis.settings.getChanges('layout.inject-portrait', val => this.css_tweaks.toggle('portrait', val));\n\t\tthis.settings.getChanges('layout.use-portrait-swapped', val => this.css_tweaks.toggle('portrait-swapped', val));\n\t\tthis.settings.getChanges('layout.use-portrait-meta', val => this.css_tweaks.toggle('portrait-metadata', val));\n\t\tthis.settings.getChanges('layout.use-portrait-meta-top', val => this.css_tweaks.toggle('portrait-metadata-top', val));\n\n\t\tthis.settings.getChanges('layout.portrait-extra-width', val => this.css_tweaks.setVariable('portrait-extra-width', `${val}rem`));\n\t\tthis.settings.getChanges('layout.portrait-extra-height', val => this.css_tweaks.setVariable('portrait-extra-height', `${val}rem`));\n\t\tthis.settings.getChanges('layout.fix-player-size', val => this.css_tweaks.toggle('player-size', val));\n\n\t\t/*this.css_tweaks.toggle('portrait-chat', this.settings.get('layout.portrait-min-chat'));\n\t\tthis.css_tweaks.toggle('portrait', this.settings.get('layout.inject-portrait'));\n\t\tthis.css_tweaks.toggle('portrait-swapped', this.settings.get('layout.use-portrait-swapped'));\n\t\tthis.css_tweaks.toggle('portrait-metadata', this.settings.get('layout.use-portrait-meta'));\n\t\tthis.css_tweaks.toggle('portrait-metadata-top', this.settings.get('layout.use-portrait-meta-top'));\n\t\tthis.css_tweaks.setVariable('portrait-extra-width', `${this.settings.get('layout.portrait-extra-width')}rem`);\n\t\tthis.css_tweaks.setVariable('portrait-extra-height', `${this.settings.get('layout.portrait-extra-height')}rem`);*/\n\n\t\tthis.on('site.directory:update-cards', () => {\n\t\t\tthis.SideBar.each(el => this._updateSidebar(el));\n\t\t\t//for(const inst of this.SideBarChannels.instances)\n\t\t\t//\tthis.updateCardClass(inst);\n\t\t});\n\n\t\tthis.ResizeDetector.ready(() => {\n\t\t\tif ( this._needs_resize ) {\n\t\t\t\tthis._needs_resize = false;\n\t\t\t\tthis.handleResize();\n\t\t\t}\n\t\t});\n\n\t\tthis.SideBar.on('mount', this.updateSidebar, this);\n\t\tthis.SideBar.on('mutate', this.updateSidebar, this);\n\t\tthis.SideBar.each(el => this.updateSidebar(el));\n\n\t\t/*this.SideBarChannels.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateCardClass(inst);\n\t\t});\n\n\t\tthis.SideBarChannels.on('mount', this.updateCardClass, this);\n\t\tthis.SideBarChannels.on('update', this.updateCardClass, this);*/\n\n\t\t/*const t = this;\n\t\tthis.RightColumn.ready((cls, instances) => {\n\t\t\tcls.prototype.ffzHideOnBreakpoint = function() {\n\t\t\t\ttry {\n\t\t\t\t\tif ( ! this.containerRef )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif ( ! t.settings.get('layout.use-portrait') )\n\t\t\t\t\t\treturn this.oldHideOnBreakpoint ? this.oldHideOnBreakpoint() : null;\n\n\t\t\t\t\tconst should_show = t.settings.get('layout.show-portrait-chat'),\n\t\t\t\t\t\tis_showing = this.props.rightColumnExpandedByBreakpoint;\n\n\t\t\t\t\tif ( should_show && ! is_showing ) {\n\t\t\t\t\t\tthis.containerRef.style.display = '';\n\t\t\t\t\t\tthis.props.expandRightColumnFromBreakpoint();\n\n\t\t\t\t\t} else if ( ! should_show && is_showing ) {\n\t\t\t\t\t\tthis.containerRef.style.display = 'none';\n\t\t\t\t\t\tthis.props.collapseRightColumnFromBreakpoint();\n\t\t\t\t\t}\n\t\t\t\t} catch(err) {\n\t\t\t\t\tif ( this.oldHideOnBreakpoint )\n\t\t\t\t\t\tthis.oldHideOnBreakpoint();\n\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcls.prototype.ffzInstall = function() {\n\t\t\t\tif ( this.oldHideOnBreakpoint )\n\t\t\t\t\treturn;\n\n\t\t\t\tthis.oldHideOnBreakpoint = this.hideOnBreakpoint;\n\t\t\t\tthis.hideOnBreakpoint = () => this.ffzHideOnBreakpoint();\n\t\t\t}\n\n\t\t\tfor(const inst of instances) {\n\t\t\t\twindow.removeEventListener('resize', inst.hideOnBreakpoint);\n\t\t\t\tinst.ffzInstall();\n\t\t\t\twindow.addEventListener('resize', inst.hideOnBreakpoint);\n\t\t\t\tinst.hideOnBreakpoint();\n\t\t\t}\n\t\t});*/\n\t}\n\n\thandleResize() {\n\t\tif ( this._resize_timer )\n\t\t\treturn;\n\n\t\tthis._resize_timer = setTimeout(() => this._handleResize(), IS_FIREFOX ? 500 : 100);\n\t}\n\n\t_handleResize() {\n\t\tclearTimeout(this._resize_timer);\n\t\tthis._resize_timer = null;\n\n\t\tif ( ! this.ResizeDetector.instances.size )\n\t\t\tthis._needs_resize = true;\n\t\telse {\n\t\t\tfor(const inst of this.ResizeDetector.instances) {\n\t\t\t\tinst?.onScroll?.();\n\t\t\t\t//inst?.props?.onResize?.();\n\t\t\t}\n\n\t\t\tthis.emit('site.player:fix-player');\n\t\t}\n\t}\n\n\tget is_minimal() {\n\t\treturn this.settings.get('layout.is-minimal')\n\t}\n\n\tupdateSidebar(el) {\n\t\tif ( ! el )\n\t\t\treturn;\n\n\t\tif ( ! el._ffz_update )\n\t\t\tel._ffz_update = debounce(() => requestAnimationFrame(() => this._updateSidebar(el)), 1000, 2);\n\n\t\tel._ffz_update();\n\t}\n\n\t_updateSidebar(el) {\n\t\tif ( ! el )\n\t\t\treturn;\n\n\t\tconst cards = el.querySelectorAll('.side-nav-card'),\n\t\t\tblocked_games = this.settings.provider.get('directory.game.blocked-games', []);\n\n\t\tfor(const card of cards) {\n\t\t\tconst react = this.fine.getReactInstance(card),\n\t\t\t\tprops = react?.return?.return?.memoizedProps,\n\t\t\t\tstream = props?.metadataRight?.props?.stream,\n\t\t\t\trerun = stream?.type === 'rerun' ?? false,\n\t\t\t\tgame = stream?.game?.displayName,\n\t\t\t\toffline = props?.offline ?? false;\n\n\t\t\tlet should_hide = false;\n\t\t\tif ( game && blocked_games.includes(game) )\n\t\t\t\tshould_hide = true;\n\t\t\tif ( props?.isPromoted && this.settings.get('directory.hide-promoted') )\n\t\t\t\tshould_hide = true;\n\t\t\telse {\n\t\t\t\tif ( ! should_hide ) {\n\t\t\t\t\tconst regexes = this.settings.get('__filter:directory.block-users');\n\t\t\t\t\tconst login = props?.userLogin;\n\t\t\t\t\tif ( regexes && login ) {\n\t\t\t\t\t\tif ( regexes[0] )\n\t\t\t\t\t\t\tregexes[0].lastIndex = -1;\n\t\t\t\t\t\tif ( regexes[1] )\n\t\t\t\t\t\t\tregexes[1].lastIndex = -1;\n\t\t\t\t\t\tif ( (regexes[0] && regexes[0].test(login)) || (regexes[1] && regexes[1].test(login)) )\n\t\t\t\t\t\t\tshould_hide = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( ! should_hide) {\n\t\t\t\t\tconst regexes = this.settings.get('__filter:directory.block-titles');\n\t\t\t\t\tconst title = stream?.broadcaster?.broadcastSettings?.title;\n\t\t\t\t\tif ( regexes && title ) {\n\t\t\t\t\t\tif ( regexes[0] )\n\t\t\t\t\t\t\tregexes[0].lastIndex = -1;\n\t\t\t\t\t\tif ( regexes[1] )\n\t\t\t\t\t\t\tregexes[1].lastIndex = -1;\n\t\t\t\t\t\tif ( (regexes[0] && regexes[0].test(title)) || (regexes[1] && regexes[1].test(title)) )\n\t\t\t\t\t\t\tshould_hide = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcard.classList.toggle('ffz--side-nav-card-rerun', rerun);\n\t\t\tcard.classList.toggle('ffz--side-nav-card-offline', offline);\n\t\t\tcard.classList.toggle('tw-hide', should_hide);\n\t\t}\n\t}\n\n\t/*updateCardClass(inst) {\n\t\tconst node = this.fine.getChildNode(inst);\n\n\t\tif ( node ) {\n\t\t\tnode.classList.toggle('ffz--side-nav-card-rerun',\n\t\t\t\tinst.props?.tooltipContent?.props?.streamType === 'rerun'\n\t\t\t);\n\t\t\tnode.classList.toggle('ffz--side-nav-card-offline',\n\t\t\t\tinst.props?.offline === true\n\t\t\t);\n\n\t\t\tconst game = inst.props?.tooltipContent?.props?.gameName || inst.props?.metadataLeft?.props?.activity?.stream?.game?.name || inst.props?.metadataLeft;\n\t\t\tnode.classList.toggle('tw-hide', this.settings.provider.get('directory.game.blocked-games', []).includes(game));\n\t\t}\n\t}*/\n\n\tupdateNavLinks() {\n\n\t}\n\n\tupdatePortraitMode() {\n\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Menu Button Module\n// ============================================================================\n\nimport {DEBUG} from 'utilities/constants';\nimport Module from 'utilities/module';\nimport {createElement, ClickOutside, setChildren} from 'utilities/dom';\n\nimport Twilight from 'site';\nimport awaitMD, {getMD} from 'utilities/markdown';\n\n\nexport default class MenuButton extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('site');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.elemental');\n\t\t//this.inject('addons');\n\n\t\tthis.pauseToasts = this.pauseToasts.bind(this);\n\t\tthis.unpauseToasts = this.unpauseToasts.bind(this);\n\n\t\tthis.should_enable = true;\n\t\tthis._pill_content = null;\n\t\tthis._has_update = false;\n\t\tthis._important_update = false;\n\t\tthis._new_settings = 0;\n\t\tthis._loading = false;\n\t\tthis.toasts = [];\n\n\t\tthis.settings.add('ffz.show-new-settings', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Layout >> Top Navigation',\n\t\t\t\ttitle: 'Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.update()\n\t\t});\n\n\t\tthis.ModBar = this.fine.define(\n\t\t\t'mod-view-bar',\n\t\t\tn => n.actions && n.updateRoot && n.childContext,\n\t\t\t['mod-view']\n\t\t);\n\n\t\t/*this.SunlightDash = this.fine.define(\n\t\t\t'sunlight-dash',\n\t\t\tn => n.getIsChannelEditor && n.getIsChannelModerator && n.getIsAdsEnabled && n.getIsSquadStreamsEnabled,\n\t\t\tTwilight.SUNLIGHT_ROUTES\n\t\t);*/\n\n\t\tthis.SunlightNav = this.elemental.define(\n\t\t\t'sunlight-nav', '.sunlight-top-nav > div > div > div > div:last-child > div',\n\t\t\tTwilight.SUNLIGHT_ROUTES,\n\t\t\t{attributes: true}, 1\n\t\t);\n\n\t\tthis.NavBar = this.fine.define(\n\t\t\t'nav-bar',\n\t\t\tn => n.renderOnsiteNotifications && n.renderTwitchPrimeCrown\n\t\t);\n\n\t\tthis.SquadBar = this.fine.define(\n\t\t\t'squad-nav-bar',\n\t\t\tn => n.exitSquadMode && n.props && n.props.squadID,\n\t\t\t['squad']\n\t\t);\n\n\t\tthis.MultiController = this.fine.define(\n\t\t\t'multi-controller',\n\t\t\tn => n.handleAddStream && n.handleRemoveStream && n.getInitialStreamLayout,\n\t\t\t['command-center']\n\t\t);\n\t}\n\n\tget loading() {\n\t\treturn this._loading;\n\t}\n\n\tset loading(val) {\n\t\tif ( val === this._loading )\n\t\t\treturn;\n\n\t\tthis._loading = val;\n\t\tthis.update();\n\t}\n\n\tget new_settings() {\n\t\treturn this._new_settings;\n\t}\n\n\tset new_settings(val) {\n\t\tif ( val === this._new_settings )\n\t\t\treturn;\n\n\t\tthis._new_settings = val;\n\t\tthis.update();\n\t}\n\n\tget has_new() {\n\t\treturn this.settings.get('ffz.show-new-settings') && this._new_settings > 0;\n\t}\n\n\tget important_update() {\n\t\treturn this._important_update;\n\t}\n\n\tset important_update(val) {\n\t\tthis._important_update = false;\n\t\tthis.update();\n\t}\n\n\tget has_update() {\n\t\treturn this._has_update;\n\t}\n\n\tget has_strings() {\n\t\treturn this.i18n.new_strings > 0 || this.i18n.changed_strings > 0;\n\t}\n\n\tset has_update(val) {\n\t\tif ( val && ! this._has_update )\n\t\t\tthis._important_update = true;\n\n\t\tthis._has_update = val;\n\t\tthis.update();\n\t}\n\n\tget pill() {\n\t\treturn this._pill_content;\n\t}\n\n\tset pill(val) {\n\t\tthis._pill_content = val;\n\t\tthis.update();\n\t}\n\n\tformatPill() {\n\t\tconst val = this._pill_content;\n\t\tif ( typeof val === 'number' )\n\t\t\treturn this.i18n.formatNumber(val);\n\n\t\tif ( val == null && this.has_new )\n\t\t\treturn this.i18n.formatNumber(this._new_settings);\n\n\t\treturn val;\n\t}\n\n\tformatExtraPill() {\n\t\tif ( this.has_update )\n\t\t\treturn null;\n\n\t\tif ( this.settings.disable_profiles )\n\t\t\treturn <figure class=\"ffz-i-cog\" />;\n\n\t\tif ( this.has_strings )\n\t\t\treturn this.i18n.formatNumber(this.i18n.new_strings + this.i18n.changed_strings);\n\n\t\tconst addons = this.resolve('addons');\n\n\t\tif ( DEBUG && addons.has_dev )\n\t\t\treturn this.i18n.t('site.menu_button.dev', 'dev');\n\n\t\tif ( DEBUG && ! addons.has_dev )\n\t\t\treturn this.i18n.t('site.menu_button.main-dev', 'm-dev');\n\n\t\tif ( ! DEBUG && addons.has_dev )\n\t\t\treturn this.i18n.t('site.menu_button.addon-dev', 'a-dev');\n\n\t\treturn null;\n\t}\n\n\tupdateToasts() {\n\t\trequestAnimationFrame(() => this._updateToasts());\n\t}\n\n\t_updateToasts() {\n\t\tfor(const inst of this.NavBar.instances)\n\t\t\tthis.updateButtonToast(inst);\n\n\t\tfor(const inst of this.SquadBar.instances)\n\t\t\tthis.updateButtonToast(inst);\n\n\t\tfor(const inst of this.MultiController.instances)\n\t\t\tthis.updateButtonToast(inst);\n\n\t\t//for(const inst of this.SunlightDash.instances)\n\t\t//\tthis.updateButtonToast(inst);\n\n\t\tfor(const el of this.SunlightNav.instances)\n\t\t\tthis.updateButtonToast(null, el, true);\n\n\t\tfor(const inst of this.ModBar.instances)\n\t\t\tthis.updateButtonToast(inst);\n\t}\n\n\tupdate() {\n\t\trequestAnimationFrame(() => this._update());\n\t}\n\n\t_update() {\n\t\tfor(const inst of this.NavBar.instances)\n\t\t\tthis.updateButton(inst);\n\n\t\tfor(const inst of this.SquadBar.instances)\n\t\t\tthis.updateButton(inst);\n\n\t\tfor(const inst of this.MultiController.instances)\n\t\t\tthis.updateButton(inst);\n\n\t\t//for(const inst of this.SunlightDash.instances)\n\t\t//\tthis.updateButton(inst);\n\n\t\tfor(const el of this.SunlightNav.instances)\n\t\t\tthis.updateButton(null, el, true);\n\n\t\tfor(const inst of this.ModBar.instances)\n\t\t\tthis.updateButton(inst);\n\t}\n\n\n\tonEnable() {\n\t\tthis.NavBar.ready(() => this.update());\n\t\tthis.NavBar.on('mount', this.updateButton, this);\n\t\tthis.NavBar.on('update', this.updateButton, this);\n\n\t\tthis.SquadBar.ready(() => this.update());\n\t\tthis.SquadBar.on('mount', this.updateButton, this);\n\t\tthis.SquadBar.on('update', this.updateButton, this);\n\n\t\tthis.MultiController.ready(() => this.update());\n\t\tthis.MultiController.on('mount', this.updateButton, this);\n\t\tthis.MultiController.on('update', this.updateButton, this);\n\n\t\t/*this.SunlightDash.ready(() => this.update());\n\t\tthis.SunlightDash.on('mount', this.updateButton, this);\n\t\tthis.SunlightDash.on('update', this.updateButton, this);*/\n\n\t\tthis.SunlightNav.on('mount', el => this.updateButton(null, el, true));\n\t\tthis.SunlightNav.on('mutate', el => this.updateButton(null, el, true));\n\t\tthis.SunlightNav.each(el => this.updateButton(null, el, true));\n\n\t\tthis.ModBar.ready(() => this.update());\n\t\tthis.ModBar.on('mount', this.updateButton, this);\n\t\tthis.ModBar.on('update', this.updateButton, this);\n\n\t\tthis.on(':clicked', () => this.important_update = false);\n\n\t\tthis.once(':clicked', this.loadMenu);\n\n\t\tthis.on('i18n:new-strings', this.update);\n\t\tthis.on('i18n:changed-strings', this.update);\n\t\tthis.on('i18n:update', this.update);\n\t\tthis.on('addons:data-loaded', this.update);\n\n\t\tthis.once('settings:quota-exceeded', () => {\n\t\t\tthis.addError(\n\t\t\t\t'site.menu_button.quota-exceeded',\n\t\t\t\t'Your local storage space for this website is full, and settings cannot be saved. Please backup your settings and switch to a higher capacity provider in [Data Management > Storage >> Provider](~data_management.storage.tabs.provider).',\n\t\t\t\t'ffz-i-attention',\n\t\t\t\ttrue\n\t\t\t);\n\t\t\tthis.update();\n\t\t});\n\n\t\tthis.on('settings:change-provider', () => {\n\t\t\tthis.addError('site.menu_button.changed',\n\t\t\t\t'The FrankerFaceZ settings provider has changed. Please refresh this tab to avoid strange behavior.'\n\t\t\t);\n\t\t\tthis.update()\n\t\t});\n\t}\n\n\n\taddError(i18n, text, icon = 'ffz-i-attention', use_markdown = false) {\n\t\tthis.addToast({\n\t\t\ticon,\n\t\t\ttext_i18n: i18n,\n\t\t\ttext,\n\t\t\tmarkdown: use_markdown\n\t\t});\n\t}\n\n\n\taddToast(data) {\n\t\t/*if ( ! data.id )\n\t\t\tdata.id = generateUUID();*/\n\n\t\tif ( data.markdown ) {\n\t\t\tconst md = getMD();\n\t\t\tif ( ! md )\n\t\t\t\treturn awaitMD().then(() => this.addToast(data));\n\t\t}\n\n\t\tthis.toasts.push(data);\n\t\t// TODO: Sort by ending time?\n\t\tif ( this.toasts.length > 5 )\n\t\t\treturn;\n\n\t\tthis.updateToasts();\n\t}\n\n\n\tpauseToasts() {\n\t\tconst length = Math.min(5, this.toasts.length),\n\t\t\tnow = performance.now();\n\n\t\tthis._toasts_paused = true;\n\n\t\tfor(let i=0; i < length; i++) {\n\t\t\tconst toast = this.toasts[i];\n\t\t\tif ( ! toast || ! toast.started )\n\t\t\t\tcontinue;\n\n\t\t\tif ( toast._timer ) {\n\t\t\t\tclearTimeout(toast._timer);\n\t\t\t\ttoast._timer = null;\n\t\t\t}\n\n\t\t\tconst elapsed = now - toast.started,\n\t\t\t\tremaining = toast.timeout - elapsed;\n\n\t\t\ttoast.remaining = remaining;\n\t\t\ttoast.percentage = 100 * remaining / toast.timeout;\n\n\t\t\tif ( toast.el )\n\t\t\t\ttoast.el.replaceWith(this.renderToast(toast));\n\t\t}\n\t}\n\n\n\tunpauseToasts() {\n\t\tconst length = Math.min(5, this.toasts.length),\n\t\t\tnow = performance.now();\n\t\tthis._toasts_paused = false;\n\n\t\tfor(let i=0; i < length; i++) {\n\t\t\tconst toast = this.toasts[i];\n\t\t\tif ( ! toast || ! toast.started )\n\t\t\t\tcontinue;\n\n\t\t\tif ( toast.remaining ) {\n\t\t\t\tconst elapsed = toast.timeout - toast.remaining;\n\t\t\t\ttoast.started = now - elapsed;\n\t\t\t}\n\n\t\t\tif ( toast.el )\n\t\t\t\ttoast.el.replaceWith(this.renderToast(toast));\n\t\t}\n\t}\n\n\n\trenderToasts() {\n\t\tconst length = Math.min(5, this.toasts.length);\n\t\tif ( ! length )\n\t\t\treturn null;\n\n\t\tconst out = [];\n\t\tfor(let i=0; i < length; i++) {\n\t\t\tout.push(this.renderToast(this.toasts[i]));\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\trenderToast(data) {\n\t\tif ( ! data._remove )\n\t\t\tdata._remove = () => {\n\t\t\t\tif ( data._timer ) {\n\t\t\t\t\tclearTimeout(data._timer);\n\t\t\t\t\tdata._timer = null;\n\t\t\t\t}\n\n\t\t\t\tdata.el = null;\n\n\t\t\t\tconst idx = this.toasts.indexOf(data);\n\t\t\t\tif ( idx !== -1 ) {\n\t\t\t\t\tthis.toasts.splice(idx, 1);\n\t\t\t\t\tif ( ! this.toasts.length )\n\t\t\t\t\t\tthis._toasts_paused = false;\n\n\t\t\t\t\tthis.updateToasts();\n\t\t\t\t}\n\t\t\t}\n\n\t\tlet progress_bar = null;\n\t\tconst md = data.markdown ? getMD() : null;\n\t\tif ( data.markdown && ! md )\n\t\t\treturn null;\n\n\t\tif ( data.timeout ) {\n\t\t\tconst now = performance.now();\n\t\t\tif ( ! data.started )\n\t\t\t\tdata.started = now;\n\n\t\t\tconst elapsed = now - data.started,\n\t\t\t\tremaining = data.timeout - elapsed;\n\t\t\tlet percentage;\n\n\t\t\tif ( this._toasts_paused )\n\t\t\t\tpercentage = data.percentage;\n\n\t\t\telse if ( ! data._timer )\n\t\t\t\tdata._timer = setTimeout(data._remove, remaining);\n\n\t\t\tif ( percentage == null )\n\t\t\t\tpercentage = data.percentage = 100 * remaining / data.timeout;\n\n\t\t\tprogress_bar = (<div class=\"ffz-toast--progress tw-absolute tw-overflow-hidden tw-z-below\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tw-border-radius-rounded ffz-progress-bar ffz-progress-bar--countdown ffz-progress-bar--default ffz-progress-bar--mask\"\n\t\t\t\t\trole=\"progressbar\"\n\t\t\t\t\taria-valuenow={percentage}\n\t\t\t\t\taria-valuemin=\"0\"\n\t\t\t\t\taria-valuemax=\"100\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass={`tw-block tw-border-bottom-left-radius-rounded tw-border-top-left-radius-rounded ffz-progress-bar__fill`}\n\t\t\t\t\t\tdata-a-target=\"tw-progress-bar-animation\"\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\twidth: `${percentage}%`,\n\t\t\t\t\t\t\t'animation-duration': `${remaining / 1000}s`\n\t\t\t\t\t\t}}\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>);\n\t\t}\n\n\t\tdata.el = (<div class={`ffz-toast ffz-balloon ffz-balloon--lg tw-mg-y-1${this._toasts_paused ? ' ffz-toast--paused' : ''}`}>\n\t\t\t<div class=\"tw-pd-1 tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-relative\">\n\t\t\t\t<div class=\"tw-flex tw-align-items-start\">\n\t\t\t\t\t{data.icon && (\n\t\t\t\t\t\ttypeof data.icon === 'string' ?\n\t\t\t\t\t\t\t<figure class={`tw-font-size-3 tw-pd-r-1 ${data.icon}`} /> :\n\t\t\t\t\t\t\tdata.icon\n\t\t\t\t\t)}\n\t\t\t\t\t{ data.render ? data.render.call(this, data) : null }\n\t\t\t\t\t{ (data.title || data.text) ? (<div class=\"tw-flex-grow-1\">\n\t\t\t\t\t\t{ data.title ? (<header class=\"tw-semibold tw-font-size-3 tw-pd-b-05\">\n\t\t\t\t\t\t\t{ data.title_i18n ? this.i18n.tList(data.title_i18n, data.title, data) : data.title}\n\t\t\t\t\t\t</header>) : null }\n\t\t\t\t\t\t{ data.text ? (<span class={`${data.lines ? 'ffz--line-clamp' : ''}`} style={{'--ffz-lines': data.lines}}>\n\t\t\t\t\t\t\t{ data.markdown ? <span dangerouslySetInnerHTML={{__html: getMD().render(data.text_i18n ? this.i18n.t(data.text_i18n, data.text, data) : data.text) }} /> : null}\n\t\t\t\t\t\t\t{ data.markdown ? null : (data.text_i18n ? this.i18n.tList(data.text_i18n, data.text, data) : data.text)}\n\t\t\t\t\t\t</span>) : null }\n\t\t\t\t\t</div>) : null}\n\t\t\t\t\t{ ! data.unclosable && (<button\n\t\t\t\t\t\tclass=\"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container\"\n\t\t\t\t\t\tonClick={data._remove}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-i-cancel\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>)}\n\t\t\t\t</div>\n\t\t\t\t{progress_bar}\n\t\t\t</div>\n\t\t</div>);\n\n\t\treturn data.el;\n\t}\n\n\n\tupdateButtonToast(inst, container, is_sunlight) {\n\t\tconst toast_el = (inst || container)._ffz_toast_el;\n\t\tif ( toast_el ) {\n\t\t\ttoast_el.innerHTML = '';\n\t\t\tsetChildren(toast_el, this.renderToasts(), false, true);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateButton(inst, container, is_sunlight);\n\t}\n\n\n\tupdateButton(inst, container, is_sunlight) {\n\t\tconst root = this.fine.getChildNode(inst);\n\t\tlet is_squad = false,\n\t\t\t//is_sunlight = false,\n\t\t\tis_mod = false;\n\n\t\tif ( ! container )\n\t\t\tcontainer = root && root.querySelector('.top-nav__menu');\n\n\t\tif ( ! container ) {\n\t\t\tif ( root && root.classList.contains('squad-stream-top-bar__container') )\n\t\t\t\tcontainer = root;\n\t\t\telse\n\t\t\t\tcontainer = root && root.querySelector('.squad-stream-top-bar__container');\n\n\t\t\tif ( container )\n\t\t\t\tis_squad = true;\n\t\t}\n\n\t\tif ( ! container && inst.handleAddStream ) {\n\t\t\tcontainer = this.fine.searchTree(inst, n => n.classList && n.classList.contains('multiview-stream-page__header'));\n\t\t\tif ( container )\n\t\t\t\tis_squad = true;\n\t\t}\n\n\t\tif ( ! container && inst.getIsAdsEnabled ) {\n\t\t\tcontainer = root && root.querySelector('.sunlight-top-nav > .tw-flex > .tw-flex > .tw-justify-content-end > .tw-flex');\n\t\t\tif ( container )\n\t\t\t\tis_sunlight = true;\n\t\t}\n\n\t\tif ( ! container && inst.childContext ) {\n\t\t\tcontainer = root && root.querySelector('.modview-dock > div:last-child');\n\t\t\tif ( container )\n\t\t\t\tis_mod = true;\n\t\t}\n\n\t\tif ( ! container )\n\t\t\treturn;\n\n\t\tif ( ! is_squad && ! is_mod && ! is_sunlight ) {\n\t\t\tlet user_stuff = null;\n\t\t\ttry {\n\t\t\t\tuser_stuff = container.querySelector(':scope > .tw-justify-content-end:last-child');\n\t\t\t} catch(err) { /* dumb browsers with no :scope are dumb */ }\n\n\t\t\tif ( user_stuff )\n\t\t\t\tcontainer = user_stuff;\n\t\t\telse\n\t\t\t\tcontainer = container.lastElementChild;\n\t\t}\n\n\t\tlet btn, el = container.querySelector('.ffz-top-nav');\n\t\tif ( el )\n\t\t\tel.remove();\n\n\t\tconst addons = this.resolve('addons'),\n\t\t\ttoasts = this.renderToasts(),\n\t\t\tpill = this.formatPill(),\n\t\t\textra_pill = this.formatExtraPill();\n\n\t\tel = (<div\n\t\t\tclass={`ffz-top-nav ${is_mod ? 'ffz-mod-view-button tw-relative tw-mg-b-1' : `tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative ${is_sunlight ? 'tw-mg-l-05 tw-mg-r-2' : 'tw-mg-x-05'}`}`}\n\t\t>\n\t\t\t<div class=\"tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t{btn = (<button\n\t\t\t\t\tclass={`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative${this.loading ? ' loading' : ''}`}\n\t\t\t\t\tonClick={e => this.handleClick(e, btn)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\tonContextMenu={e => this.renderContext(e, btn)} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t<figure class=\"ffz-i-zreknarf\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</button>)}\n\t\t\t\t{this.has_error && (<div class={`tw-absolute ffz-balloon ffz-balloon--lg tw-block ${is_mod ? 'ffz-il-tooltip--up ffz-il-tooltip--align-left' : 'ffz-il-tooltip--down ffz-il-tooltip--align-right'}`}>\n\t\t\t\t\t<div class=\"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1\">\n\t\t\t\t\t\t<div class=\"tw-flex tw-align-items-center\">\n\t\t\t\t\t\t\t<div class=\"tw-flex-grow-1\">\n\t\t\t\t\t\t\t\t{ this.error.i18n ? this.i18n.t(this.error.i18n, this.error.text) : this.error.text }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{this.error.permanent ? null : (<button\n\t\t\t\t\t\t\t\tclass=\"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container\"\n\t\t\t\t\t\t\t\tonClick={() => this.error = null} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-cancel\" />\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>)}\n\t\t\t\t<div class={`ffz-il-tooltip ${is_mod ? 'ffz-il-tooltip--up ffz-il-tooltip--align-left' : 'ffz-il-tooltip--down ffz-il-tooltip--align-right'}`}>\n\t\t\t\t\t{this.i18n.t('site.menu_button', 'FrankerFaceZ Control Center')}\n\t\t\t\t\t{this.has_update && (<div class=\"tw-mg-t-1\">\n\t\t\t\t\t\t{this.i18n.t('site.menu_button.update-desc', 'There is an update available. Please refresh your page.')}\n\t\t\t\t\t</div>)}\n\t\t\t\t\t{this.settings.disable_profiles && (<div class=\"tw-mg-t-1\">\n\t\t\t\t\t\t{this.i18n.tList('site.menu_button.no-settings', 'Settings are disabled in this tab due to the inclusion of \"{param}\" in the URL.', {\n\t\t\t\t\t\t\tparam: <code class=\"ffz-monospace\">?ffz-no-settings</code>\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>)}\n\t\t\t\t\t{this._new_settings > 0 && (<div class=\"tw-mg-t-1\">\n\t\t\t\t\t\t{this.i18n.t('site.menu_button.new-desc', 'There {count,plural,one {is one new setting} other {are # new settings}}.', {count: this._new_settings})}\n\t\t\t\t\t</div>)}\n\t\t\t\t\t{this.has_strings && (<div class=\"tw-mg-t-1\">\n\t\t\t\t\t\t{this.i18n.t('site.menu_button.strings', 'There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.', {\n\t\t\t\t\t\t\tadded: this.i18n.new_strings,\n\t\t\t\t\t\t\tchanged: this.i18n.changed_strings\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>)}\n\t\t\t\t\t{DEBUG && (<div class=\"tw-mg-t-1\">\n\t\t\t\t\t\t{this.i18n.t('site.menu_button.main-dev-desc', 'You are running a developer build of FrankerFaceZ.')}\n\t\t\t\t\t</div>)}\n\t\t\t\t\t{addons.has_dev && (<div class=\"tw-mg-t-1\">\n\t\t\t\t\t\t{this.i18n.t('site.menu_button.addon-dev-desc', 'You have loaded add-on data from a local development server.')}\n\t\t\t\t\t</div>)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{(inst || container)._ffz_toast_el = (<div\n\t\t\t\tclass={`ffz-toast--container tw-absolute tw-block ${is_mod ? 'ffz-il-tooltip--up ffz-il-tooltip--align-left' : 'ffz-il-tooltip--down ffz-il-tooltip--align-right'}`}\n\t\t\t\tonmouseenter={this.pauseToasts}\n\t\t\t\tonmouseleave={this.unpauseToasts}\n\t\t\t>\n\t\t\t\t{toasts}\n\t\t\t</div>)}\n\t\t\t{this.has_update && (<div class=\"ffz-menu__extra-pill tw-absolute\">\n\t\t\t\t<div class={`tw-pill ${this.important_update ? 'tw-pill--notification' : ''}`}>\n\t\t\t\t\t<figure class=\"ffz-i-arrows-cw\" />\n\t\t\t\t</div>\n\t\t\t</div>)}\n\t\t\t{extra_pill && (<div class=\"ffz-menu__extra-pill tw-absolute\">\n\t\t\t\t<div class=\"tw-pill\">\n\t\t\t\t\t{extra_pill}\n\t\t\t\t</div>\n\t\t\t</div>)}\n\t\t\t{pill && (<div class=\"ffz-menu__pill tw-absolute\">\n\t\t\t\t<div class=\"tw-pill\">\n\t\t\t\t\t{pill}\n\t\t\t\t</div>\n\t\t\t</div>)}\n\t\t</div>);\n\n\t\tif ( is_mod )\n\t\t\tcontainer.insertBefore(el, container.firstElementChild);\n\t\telse {\n\t\t\tlet before = container.lastElementChild;\n\t\t\tif ( before && before.classList.contains('resize-detector') )\n\t\t\t\tbefore = before.previousElementSibling;\n\n\t\t\tif ( before )\n\t\t\t\tcontainer.insertBefore(el, before);\n\t\t\telse\n\t\t\t\tcontainer.appendChild(el);\n\t\t}\n\n\t\tif ( this._ctx_open )\n\t\t\tthis.renderContext(null, btn);\n\t}\n\n\thandleClick(event, btn) {\n\t\tif ( event.shiftKey ) {\n\t\t\tif ( DEBUG && event.ctrlKey )\n\t\t\t\treturn requestAnimationFrame(() => this.i18n.openUI());\n\n\t\t\treturn this.resolve('main_menu').openPopout();\n\t\t}\n\n\t\tthis.emit(':clicked', event, btn);\n\t}\n\n\trenderButtonIcon(profile) {\n\t\tconst live = this.settings.main_context.hasProfile(profile);\n\t\treturn (<figure class={`ffz--profile__icon ${live ? 'ffz-i-ok' : profile.toggled ? 'ffz-i-minus' : 'ffz-i-cancel'}`} />);\n\t}\n\n\trenderButtonTip(profile) {\n\t\tif ( ! profile.toggled )\n\t\t\treturn this.i18n.t('setting.profiles.disabled', 'This profile is disabled.');\n\n\t\tif ( this.settings.main_context.hasProfile(profile) )\n\t\t\treturn this.i18n.t('setting.profiles.active', 'This profile is enabled and active.');\n\n\t\treturn this.i18n.t('setting.profiles.disabled.rules', 'This profile is enabled, but inactive due to its rules.');\n\t}\n\n\trenderContext(event, btn) {\n\t\tif ( event ) {\n\t\t\tif ( event.shiftKey || event.ctrlKey )\n\t\t\t\treturn;\n\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tconst container = btn.parentElement.parentElement,\n\t\t\tis_mod = container.classList.contains('ffz-mod-view-button');\n\t\tlet ctx = container.querySelector('.ffz--menu-context');\n\t\tif ( ctx ) {\n\t\t\tif ( ctx._ffz_destroy )\n\t\t\t\tctx._ffz_destroy();\n\t\t\telse\n\t\t\t\treturn;\n\t\t}\n\n\t\tconst destroy = () => {\n\t\t\tthis._ctx_open = false;\n\n\t\t\tif ( ctx._ffz_outside )\n\t\t\t\tctx._ffz_outside.destroy();\n\n\t\t\tctx.remove();\n\t\t}\n\n\t\tconst profiles = [];\n\n\t\tfor(const profile of this.settings.__profiles) {\n\t\t\tconst toggle = (<button\n\t\t\t\tclass=\"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse\"\n\t\t\t\tdata-title={this.renderButtonTip(profile)}\n\t\t\t\tonClick={e => {  // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\tprofile.toggled = ! profile.toggled;\n\n\t\t\t\t\tsetChildren(toggle, this.renderButtonIcon(profile));\n\t\t\t\t\ttoggle.dataset.title = this.renderButtonTip(profile);\n\n\t\t\t\t\tif ( toggle['_ffz_tooltip']?.rerender )\n\t\t\t\t\t\ttoggle['_ffz_tooltip'].rerender();\n\n\t\t\t\t\tthis.emit('tooltips:cleanup');\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{ this.renderButtonIcon(profile) }\n\t\t\t</button>)\n\n\t\t\tconst desc_key = profile.desc_i18n_key || profile.i18n_key && `${profile.i18n_key}.description`;\n\n\t\t\tprofiles.push(<div class=\"tw-relative tw-border-b tw-pd-y-05 tw-pd-x-1 tw-flex\">\n\t\t\t\t{toggle}\n\t\t\t\t<div>\n\t\t\t\t\t<h4>{ profile.i18n_key ? this.i18n.t(profile.i18n_key, profile.name, profile) : profile.name }{profile.ephemeral && (<div\n\t\t\t\t\t\tclass=\"tw-inline tw-mg-l-05 ffz-il-tooltip__container ffz--profile-row__icon ffz-i-user-secret tw-relative\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center\">\n\t\t\t\t\t\t\t{ this.i18n.t('setting.profiles.ephemeral', 'This profile is ephemeral.') }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>)}</h4>\n\t\t\t\t\t{profile.description && (<div class=\"description\">\n\t\t\t\t\t\t{ desc_key ? this.i18n.t(desc_key, profile.description, profile) : profile.description }\n\t\t\t\t\t</div>)}\n\t\t\t\t</div>\n\t\t\t</div>);\n\t\t}\n\n\n\t\tctx = (<div class={`tw-absolute ffz-attached ${is_mod ? 'ffz-attached--up ffz-attached--left' : 'ffz-attached--down ffz-attached--right'}`}>\n\t\t\t<div class={`ffz-balloon ffz-balloon--lg tw-block ffz--menu-context`}>\n\t\t\t\t<div class=\"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4\">\n\t\t\t\t\t<div class=\"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header\">\n\t\t\t\t\t\t<div class=\"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left\">\n\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden\"\n\t\t\t\t\t\t\t\t\tonDblClick={() => {this.emit('site.player:reset'); destroy()}} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-t-reset\" />\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-left\">\n\t\t\t\t\t\t\t\t\t{ this.i18n.t('player.reset_button.all', 'Reset All Players (Double-Click)') }\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center\">\n\t\t\t\t\t\t\t<h5 class=\"tw-align-center tw-c-text-alt tw-semibold\">\n\t\t\t\t\t\t\t\t{ this.i18n.t('site.menu_button.profiles', 'Profiles') }\n\t\t\t\t\t\t\t</h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right\">\n\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden\"\n\t\t\t\t\t\t\t\t\tonClick={e => {this.openSettings(e, btn); destroy()}} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-cog\" />\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center\">\n\t\t\t\t\t\t\t\t\t{ this.i18n.t('setting.profiles.configure', 'Configure') }\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\t\t\t\tonClick={destroy} // eslint-disable-line react/jsx-no-bind\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-cancel\" />\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x\" data-simplebar>\n\t\t\t\t\t\t{profiles}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>);\n\n\t\tctx._ffz_destroy = destroy;\n\t\tctx._ffz_outside = new ClickOutside(ctx, destroy);\n\t\tcontainer.appendChild(ctx);\n\n\t\tthis._ctx_open = true;\n\t}\n\n\n\topenSettings(event, btn) {\n\t\tconst menu = this.resolve('main_menu');\n\t\tif ( ! menu )\n\t\t\treturn;\n\n\t\tmenu.requestPage('data_management.profiles');\n\t\tif ( menu.showing )\n\t\t\treturn;\n\n\t\tthis.emit(':clicked', event, btn);\n\t}\n\n\n\tloadMenu(event, btn, page) {\n\t\tconst menu = this.resolve('main_menu');\n\t\tif ( ! menu )\n\t\t\treturn;\n\n\t\tif ( page )\n\t\t\tmenu.requestPage(page);\n\t\tif ( menu.showing )\n\t\t\treturn;\n\n\t\tthis.loading = true;\n\n\t\tmenu.enable(event).then(() => {\n\t\t\tthis.loading = false;\n\n\t\t}).catch(err => {\n\t\t\tthis.log.capture(err);\n\t\t\tthis.log.error('Error enabling main menu.', err);\n\n\t\t\tthis.addError(\n\t\t\t\t'site.menu_button.error',\n\t\t\t\t'There was an error loading the FFZ Control Center. Please refresh and try again.'\n\t\t\t);\n\n\t\t\tthis.loading = false;\n\t\t\tthis.once(':clicked', this.loadMenu);\n\t\t});\n\t}\n\n\tonDisable() {\n\t\tthis.off('i18n:update', this.update);\n\t\tthis.off(':clicked', this.loadMenu);\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Mod View Module\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {debounce} from 'utilities/object';\n\n\nexport default class ModView extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('site.channel');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.elemental');\n\t\tthis.inject('site.router');\n\t\tthis.inject('site.twitch_data');\n\t\tthis.inject('metadata');\n\t\tthis.inject('socket');\n\t\tthis.inject('pubsub');\n\n\t\tthis.should_enable = true;\n\n\t\tthis._cached_color = null;\n\t\tthis._cached_channel = null;\n\t\tthis._cached_id = null;\n\n\t\tthis.Root = this.elemental.define(\n\t\t\t'mod-view-root', '.moderation-view-page',\n\t\t\t['mod-view'],\n\t\t\t{attributes: true}, 1\n\t\t);\n\n\t\tthis.ModInfoBar = this.elemental.define(\n\t\t\t'mod-info-bar', '.modview-player-widget__stream-info .simplebar-content',\n\t\t\t['mod-view'],\n\t\t\t{childNodes: true, subtree: true}, 1, 30000, false\n\t\t);\n\n\t\tthis.checkRoot = debounce(this.checkRoot, 250);\n\t\tthis.checkBar = debounce(this.checkBar, 250);\n\t}\n\n\tonEnable() {\n\t\tthis.Root.on('mount', this.updateRoot, this);\n\t\tthis.Root.on('mutate', this.updateRoot, this);\n\t\tthis.Root.on('unmount', this.removeRoot, this);\n\t\tthis.Root.each(el => this.updateRoot(el));\n\n\t\tthis.ModInfoBar.on('mount', this.updateBar, this);\n\t\tthis.ModInfoBar.on('mutate', this.updateBar, this);\n\t\tthis.ModInfoBar.on('unmount', this.removeBar, this);\n\t\tthis.ModInfoBar.each(el => this.updateBar(el));\n\n\t\tthis.router.on(':route', this.checkNavigation, this);\n\t\tthis.checkNavigation();\n\t}\n\n\tupdateSubscription(id, login) {\n\t\tif ( this._subbed_login === login && this._subbed_id === id )\n\t\t\treturn;\n\n\t\tif ( this._subbed_id ) {\n\t\t\tthis.pubsub.unsubscribe(this, `twitch/${this._subbed_id}`);\n\t\t\tthis._subbed_id = null;\n\t\t}\n\n\t\tif ( this._subbed_login ) {\n\t\t\tthis.socket.unsubscribe(this, `channel.${this._subbed_login}`);\n\t\t\tthis._subbed_login = null;\n\t\t}\n\n\t\tif ( id ) {\n\t\t\tthis.pubsub.subscribe(this, `twitch/${id}`);\n\t\t\tthis._subbed_id = id;\n\t\t}\n\n\t\tif ( login ) {\n\t\t\tthis.socket.subscribe(this, `channel.${login}`);\n\t\t\tthis._subbed_login = login;\n\t\t}\n\t}\n\n\tcheckNavigation() {\n\t\tif ( this.router.current_name === 'mod-view' ) {\n\t\t\tthis.channel.updateChannelColor(this._cached_color);\n\t\t\tthis.checkRoot();\n\t\t}\n\t}\n\n\tcheckBar() {\n\t\tthis.ModInfoBar.clean();\n\t}\n\n\tcheckRoot() {\n\t\tthis.Root.each(el => this.updateRoot(el));\n\t}\n\n\tupdateRoot(el) {\n\t\tconst root = this.fine.getReactInstance(el);\n\n\t\tlet channel = null;\n\t\tlet node = this.fine.searchNode(root, n => {\n\t\t\tlet i = 0;\n\t\t\tlet state = n.memoizedState;\n\t\t\twhile(state != null && channel == null && i < 50) {\n\t\t\t\tchannel = state?.memoizedState?.current?.result?.data?.user ??\n\t\t\t\t\tstate?.memoizedState?.current?.previousData?.user;\n\n\t\t\t\tif (!channel?.id || !channel?.login)\n\t\t\t\t\tchannel = null;\n\n\t\t\t\tstate = state?.next;\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tif (channel)\n\t\t\t\treturn true;\n\t\t});\n\n\t\tif ( channel?.id ) {\n\t\t\tif ( this._cached_id != channel.id ) {\n\t\t\t\tthis._cached_id = channel.id;\n\t\t\t\tthis._cached_channel = channel;\n\t\t\t\tthis._cached_color = null;\n\t\t\t\tthis.updateSubscription(channel.id, channel.login);\n\n\t\t\t\tthis.getChannelColor(el, channel.id).then(color => {\n\t\t\t\t\tif ( this._cached_id != channel.id )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tthis._cached_color = color;\n\t\t\t\t\tthis.channel.updateChannelColor(color);\n\t\t\t\t\tthis.settings.updateContext({\n\t\t\t\t\t\tchannelColor: color\n\t\t\t\t\t});\n\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tif ( this._cached_id != channel.id )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tthis._cached_color = null;\n\t\t\t\t\tthis.channel.updateChannelColor();\n\t\t\t\t\tthis.settings.updateContext({\n\t\t\t\t\t\tchannelColor: null\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.settings.updateContext({\n\t\t\t\t\tchannel: channel.login,\n\t\t\t\t\tchannelID: channel.id\n\t\t\t\t});\n\t\t\t}\n\t\t} else\n\t\t\tthis.removeRoot();\n\n\t}\n\n\tgetChannelColor(el, channel_id, no_promise) {\n\t\tconst cache = el._ffz_color_cache = el._ffz_color_cache || {};\n\t\tif ( channel_id === cache.channel_id ) {\n\t\t\tif ( Date.now() - cache.saved < 60000 ) {\n\t\t\t\tif ( no_promise )\n\t\t\t\t\treturn cache.data;\n\t\t\t\treturn Promise.resolve(cache.data);\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(async (s, f) => {\n\t\t\tif ( cache.updating ) {\n\t\t\t\tcache.updating.push([s, f]);\n\t\t\t\treturn ;\n\t\t\t}\n\n\t\t\tcache.channel_id = channel_id;\n\t\t\tcache.updating = [[s,f]];\n\t\t\tlet data, err;\n\n\t\t\ttry {\n\t\t\t\tdata = await this.twitch_data.getChannelColor(channel_id);\n\t\t\t} catch(error) {\n\t\t\t\tdata = null;\n\t\t\t\terr = error;\n\t\t\t}\n\n\t\t\tconst waiters = cache.updating;\n\t\t\tcache.updating = null;\n\n\t\t\tif ( cache.channel_id !== channel_id ) {\n\t\t\t\terr = new Error('Outdated');\n\t\t\t\tcache.channel_id = null;\n\t\t\t\tcache.data = null;\n\t\t\t\tcache.saved = 0;\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcache.data = data;\n\t\t\tcache.saved = Date.now();\n\n\t\t\tfor(const pair of waiters)\n\t\t\t\terr ? pair[1](err) : pair[0](data);\n\t\t});\n\t}\n\n\tremoveRoot() {\n\t\tthis._cached_id = null;\n\t\tthis._cached_channel = null;\n\t\tthis._cached_color = null;\n\t\tthis.updateSubscription();\n\t\tthis.channel.updateChannelColor();\n\t\tthis.settings.updateContext({\n\t\t\tchannel: null,\n\t\t\tchannelID: null,\n\t\t\tchannelColor: null\n\t\t});\n\t}\n\n\tupdateBar(el) {\n\t\tconst container = el.closest('.modview-player-widget__stream-info'),\n\t\t\troot = container && this.fine.getReactInstance(container);\n\n\t\tlet channel = null, state = root?.return?.memoizedState, i = 0;\n\t\twhile(state != null && channel == null && i < 50 ) {\n\t\t\tchannel = state?.memoizedState?.current?.result?.data?.channel ??\n\t\t\t\tstate?.memoizedState?.current?.previousData?.channel;\n\t\t\tstate = state?.next;\n\t\t\ti++;\n\t\t}\n\n\t\tconst bcast = channel?.lastBroadcast,\n\t\t\ttitle = bcast?.title,\n\t\t\tgame = bcast?.game;\n\n\t\t// This doesn't work because hosting in mod view.\n\t\t//if ( channel?.id && channel.id != this._cached_id )\n\t\t//\tthis.checkRoot();\n\n\t\tif ( this._cached_bar_id != channel?.id ) {\n\t\t\tthis._cached_bar_id = channel?.id;\n\t\t\tthis._cached_bar_channel = channel;\n\t\t}\n\n\t\tif ( title != el._cached_title || game?.id != el._cached_game ) {\n\t\t\tel._cached_title = title;\n\t\t\tel._cached_game = game?.id;\n\n\t\t\tthis.settings.updateContext({\n\t\t\t\tcategory: game?.name,\n\t\t\t\tcategoryID: game?.id,\n\t\t\t\ttitle\n\t\t\t});\n\t\t}\n\n\t\tif ( container ) {\n\t\t\tif ( ! container._ffz_cont ) {\n\t\t\t\tconst e = container._ffz_cont = container.querySelector('.modview-player-widget__viewcount');\n\t\t\t\tif ( e )\n\t\t\t\t\te.classList.add('ffz--mod-tray');\n\t\t\t}\n\n\t\t\tthis.updateMetadata(container);\n\t\t}\n\t}\n\n\tremoveBar(el) {\n\t\tthis.settings.updateContext({\n\t\t\tcategory: null,\n\t\t\tcategoryID: null,\n\t\t\ttitle: null\n\t\t});\n\n\t\tconst container = el.closest('.modview-player-widget__stream-info');\n\t\tif ( ! container )\n\t\t\treturn;\n\n\t\tif ( container._ffz_cont )\n\t\t\tcontainer._ffz_cont.classList.remove('ffz--mod-tray');\n\n\t\tcontainer._ffz_cont = null;\n\t\tif ( container._ffz_meta_timers ) {\n\t\t\tfor(const val of Object.values(container._ffz_meta_timers))\n\t\t\t\tclearTimeout(val);\n\n\t\t\tcontainer._ffz_meta_timers = null;\n\t\t}\n\n\t\tcontainer._ffz_update = null;\n\t}\n\n\tupdateMetadata(el, keys) {\n\t\tconst cont = el._ffz_cont,\n\t\t\tchannel = this._cached_bar_channel;\n\t\t\t//root = this.fine.getReactInstance(el);\n\n\t\t/*let channel = null, state = root?.return?.memoizedState, i = 0;\n\t\twhile(state != null && channel == null && i < 50 ) {\n\t\t\tstate = state?.next;\n\t\t\tchannel = state?.memoizedState?.current?.previousData?.result?.data?.channel;\n\t\t\ti++;\n\t\t}*/\n\n\t\tif ( ! cont || ! document.contains(cont) ) {\n\t\t\tthis.checkBar();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! channel?.id )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = this.metadata.keys;\n\t\telse if ( ! Array.isArray(keys) )\n\t\t\tkeys = [keys];\n\n\t\tconst timers = el._ffz_meta_timers = el._ffz_meta_timers || {},\n\t\t\trefresh_fn = key => this.updateMetadata(el, key),\n\t\t\tdata = {\n\t\t\t\tchannel: {\n\t\t\t\t\tid: channel.id,\n\t\t\t\t\tlogin: channel.login,\n\t\t\t\t\tdisplay_name: channel.displayName\n\t\t\t\t},\n\t\t\t\tel,\n\t\t\t\tgetViewerCount: () => 0,\n\t\t\t\tgetUserSelfImmediate: () => null,\n\t\t\t\tgetUserSelf: () => null,\n\t\t\t\tgetBroadcastID: () => null\n\t\t\t};\n\n\t\tfor(const key of keys)\n\t\t\tif ( this.metadata.definitions[key].modview )\n\t\t\t\tthis.metadata.renderLegacy(key, data, cont, timers, refresh_fn);\n\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Twitch Player\n// ============================================================================\n\nimport PlayerBase from 'src/sites/shared/player';\n\nexport const PLAYER_ROUTES = [\n\t'front-page', 'user', 'video', 'user-video', 'user-clip', 'user-videos',\n\t'user-clips', 'user-collections', 'user-events', 'user-followers',\n\t'user-following', 'dash', 'squad', 'command-center', 'dash-stream-manager',\n\t'mod-view', 'user-home'\n];\n\n/*const HAS_PITCH = (() => {\n\tconst el = createElement('video');\n\treturn el.preservesPitch != null || el.mozPreservesPitch != null\n})();*/\n\nexport default class Player extends PlayerBase {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\t// Dependency Injection\n\t\tthis.inject('site.router');\n\t\tthis.inject('metadata');\n\n\t\t// React Components\n\n\t\t/*this.SquadStreamBar = this.fine.define(\n\t\t\t'squad-stream-bar',\n\t\t\tn => n.shouldRenderSquadBanner && n.props && n.props.triggerPlayerReposition,\n\t\t\tPLAYER_ROUTES\n\t\t);*/\n\n\t\t/*this.PersistentPlayer = this.fine.define(\n\t\t\t'persistent-player',\n\t\t\tn => n.state && n.state.playerStyles\n\t\t);*/\n\n\t\tthis.DataSource = this.fine.define(\n\t\t\t'data-source',\n\t\t\tn => n.consentMetadata && n.onPlaying && n.props && n.props.data,\n\t\t\tPLAYER_ROUTES\n\t\t);\n\n\t\tthis.Player = this.fine.define(\n\t\t\t'highwind-player',\n\t\t\tn => n.setPlayerActive && n.props?.playerEvents && n.props?.mediaPlayerInstance,\n\t\t\tPLAYER_ROUTES\n\t\t);\n\n\t\tthis.TheatreHost = this.fine.define(\n\t\t\t'theatre-host',\n\t\t\tn => n.toggleTheatreMode && n.props && n.props.onTheatreModeEnabled,\n\t\t\t['user', 'user-home', 'video', 'user-video', 'user-clip']\n\t\t);\n\n\t\tthis.PlayerSource = this.fine.define(\n\t\t\t'player-source',\n\t\t\tn => n.setSrc && n.setInitialPlaybackSettings,\n\t\t\tPLAYER_ROUTES\n\t\t);\n\t}\n\n\n\trepositionPlayer() {\n\t\tif ( ! this._mover ) {\n\t\t\tconst el = document.querySelector('.channel-root__player');\n\t\t\tthis._mover = this.fine.searchNode(\n\t\t\t\tel,\n\t\t\t\tn => n.memoizedProps?.triggerPlayerReposition,\n\t\t\t\t50\n\t\t\t);\n\t\t}\n\n\t\tif ( this._mover )\n\t\t\tthis._mover.memoizedProps.triggerPlayerReposition();\n\t}\n\n\n\tregisterSettings() {\n\t\tsuper.registerSettings();\n\n\t\tthis.settings.add('player.home.autoplay', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Playback',\n\t\t\t\ttitle: 'Auto-play featured broadcasters on the front page.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('player.theatre.no-whispers', {\n\t\t\tdefault: false,\n\t\t\trequires: ['whispers.show'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( ! ctx.get('whispers.show') )\n\t\t\t\t\treturn true;\n\n\t\t\t\treturn val;\n\t\t\t},\n\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Theatre Mode',\n\t\t\t\ttitle: 'Hide whispers when Theatre Mode is enabled.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => this.css_tweaks.toggle('theatre-no-whispers', val)\n\t\t});\n\n\t\tthis.settings.add('player.theatre.metadata', {\n\t\t\tdefault: false,\n\t\t\trequires: ['context.route.name', 'layout.is-theater-mode'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( ! ctx.get('layout.is-theater-mode') || ctx.get('context.route.name') === 'video' )\n\t\t\t\t\treturn false;\n\t\t\t\treturn val\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Theatre Mode',\n\t\t\t\ttitle: 'Show metadata when mousing over the player.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: val => this.css_tweaks.toggle('theatre-metadata', val)\n\t\t});\n\n\t\tthis.settings.add('player.theatre.auto-enter', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Theatre Mode',\n\t\t\t\ttitle: 'Automatically open Theatre Mode when visiting a channel.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.fullscreen.auto-chat', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Player > General >> Fullscreen',\n\t\t\t\ttitle: 'Automatically expand chat when entering fullscreen mode.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('player.hide-event-bar', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Hide the Event Bar',\n\t\t\t\tdescription: 'Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.css_tweaks.toggleHide('player-event-bar', val);\n\t\t\t\tthis.repositionPlayer();\n\t\t\t}\n\t\t});\n\n\t\t/*this.settings.add('player.hide-rerun-bar', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Appearance >> General',\n\t\t\t\ttitle: 'Hide the Rerun Bar',\n\t\t\t\tdescription: 'Hide the Rerun Bar which appears above the player when the current channel is playing a video rather than live content.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: val => {\n\t\t\t\tthis.css_tweaks.toggleHide('player-rerun-bar', val);\n\t\t\t\tthis.repositionPlayer();\n\t\t\t}\n\t\t});*/\n\t}\n\n\n\tasync onEnable() {\n\t\tawait super.onEnable();\n\n\t\tthis.css_tweaks.toggle('theatre-no-whispers', this.settings.get('player.theatre.no-whispers'));\n\t\tthis.css_tweaks.toggle('theatre-metadata', this.settings.get('player.theatre.metadata'));\n\t\tthis.css_tweaks.toggleHide('player-event-bar', this.settings.get('player.hide-event-bar'));\n\t\t//this.css_tweaks.toggleHide('player-rerun-bar', this.settings.get('player.hide-rerun-bar'));\n\n\t\tthis.on(':fix-player', this.repositionPlayer, this);\n\n\t\tthis.on('site:fullscreen', this.maybeOpenChat, this);\n\n\t\tthis.TheatreHost.on('mount', inst => {\n\t\t\tinst._ffz_theater_start = Date.now();\n\t\t\tthis.tryTheatreMode(inst);\n\t\t});\n\t\tthis.TheatreHost.on('update', this.tryTheatreMode, this);\n\t\tthis.TheatreHost.ready((cls, instances) => {\n\t\t\tconst now = Date.now();\n\t\t\tfor(const inst of instances) {\n\t\t\t\tinst._ffz_theater_start = now;\n\t\t\t\tthis.tryTheatreMode(inst);\n\t\t\t}\n\t\t});\n\n\t\tthis.PlayerSource.on('mount', this.checkCarousel, this);\n\t\tthis.PlayerSource.on('update', this.checkCarousel, this);\n\t}\n\n\tmaybeOpenChat() {\n\t\tif ( ! this.settings.get('player.fullscreen.auto-chat') )\n\t\t\treturn;\n\n\t\tthis.parent.awaitElement('.right-column--collapsed .right-column__toggle-visibility button', document.fullscreenElement, 1000)\n\t\t\t.then(el => el.click());\n\t}\n\n\tshouldStopAutoplay() {\n\t\treturn this.settings.get('player.no-autoplay') ||\n\t\t\t(! this.settings.get('player.home.autoplay') && this.router.current?.name === 'front-page');\n\t}\n\n\n\tcheckCarousel(inst) {\n\t\t/*if ( this.settings.get('channel.hosting.enable') )\n\t\t\treturn;\n\n\t\tif ( inst.props?.playerType === 'channel_home_carousel' ) {\n\t\t\tif ( inst.props.content?.hostChannel === inst._ffz_cached_login )\n\t\t\t\treturn;\n\n\t\t\tinst._ffz_cached_login = inst.props.content?.hostChannel;\n\t\t\tif ( ! inst._ffz_cached_login )\n\t\t\t\treturn;\n\n\t\t\tconst player = inst.props.mediaPlayerInstance,\n\t\t\t\tevents = inst.props.playerEvents;\n\n\t\t\tthis.stopPlayer(player, events, inst);\n\t\t}*/\n\t}\n\n\n\tgetData() {\n\t\treturn this.DataSource.first;\n\t}\n\n\n\ttryTheatreMode(inst) {\n\t\tif ( ! inst._ffz_theater_timer )\n\t\t\tinst._ffz_theater_timer = setTimeout(() => {\n\t\t\t\tinst._ffz_theater_timer = null;\n\n\t\t\t\tif ( ! this.settings.get('player.theatre.auto-enter') || ! inst._ffz_mounted )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( this.router.current_name !== 'user' )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( inst.props.channelHomeLive || inst.props.channelHomeCarousel || inst.props.theatreModeEnabled )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( Date.now() - (inst._ffz_theater_start ||0) > 2000 )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( inst.props.onTheatreModeEnabled )\n\t\t\t\t\tinst.props.onTheatreModeEnabled();\n\t\t\t}, 250);\n\t}\n\n\n\t/**\n\t * Tries to reposition the player, using a method exposed on the\n\t * Squad Streaming bar.\n\t *\n\t * @memberof Player\n\t * @returns {void}\n\t */\n\trepositionPlayer() {\n\t\t// TODO: New implementation that works.\n\t}\n\n\tupdateSquadContext() {\n\t\tthis.settings.updateContext({\n\t\t\tsquad_bar: this.hasSquadBar\n\t\t});\n\t}\n\n\tget hasSquadBar() {\n\t\t// TODO: New implementation that works.\n\t\treturn false;\n\t}\n}\n","export default __webpack_public_path__ + \"color_normalizer.css\";","'use strict';\n\n// ============================================================================\n// Menu Module\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {createElement} from 'utilities/dom';\nimport {Color} from 'utilities/color';\n\n//import THEME_CSS from 'site/styles/theme.scss';\nimport NORMALIZER_CSS_URL from 'site/styles/color_normalizer.scss';\n\nconst BAD_ROUTES = ['product', 'prime', 'turbo'];\n\nconst COLORS = [\n\t-0.62, -0.578, -0.539, -0.469, -0.4, -0.32, -0.21, -0.098, // 1-8\n\t0, // 9\n\t0.08, 0.151, 0.212, 0.271, 0.31, 0.351 // 10-15\n];\n\nconst NO_AUTO_DARK = `:root{color-scheme: only light}`,\n\tNO_FORCED_COLOR = `:root{forced-color-adjust: none}`;\n\n\nconst ACCENT_COLORS = {\n\t//dark: {'c':{'accent': 9,'background-accent':8,'background-accent-alt':7,'background-accent-alt-2':6,'background-button':7,'background-button-active':7,'background-button-focus':8,'background-button-hover':8,'background-button-primary-active':7,'background-button-primary-default':9,'background-button-primary-hover':8,'background-graph':2,'background-graph-fill':8,'background-input-checkbox-checked':9,'background-input-checked':8,'background-interactable-active':9,'background-interactable-selected':9,'background-interactable-hover':8,'background-progress-countdown-status':9,'background-progress-status':9,'background-range-fill':9,'background-subscriber-stream-tag-active':4,'background-subscriber-stream-tag-default':4,'background-subscriber-stream-tag-hover':3,'background-toggle-checked':9,/*'background-tooltip':1,*/'background-top-nav':6,'border-brand':9,'border-button':7,'border-button-active':8,'border-button-focus':9,'border-button-hover':8,'border-input-checkbox-checked':9,'border-input-checkbox-focus':9,'border-input-focus':9,'border-interactable-selected':10,'border-subscriber-stream-tag':5,'border-tab-active':11,'border-tab-focus':11,'border-tab-hover':11,'border-toggle-focus':7,'border-toggle-hover':7,'border-whisper-incoming':10,'fill-brand':9,'text-button-text':10,'text-button-text-focus':'o1','text-button-text-hover':'o1','text-link':10,'text-link-active':10,'text-link-focus':10,'text-link-hover':10,'text-link-visited':10,'text-overlay-link-active':13,'text-overlay-link-focus':13,'text-overlay-link-hover':13,'text-tab-active':11,'background-chat':1,'background-chat-alt':3,'background-chat-header':2,'background-modal':3,'text-button-text-active':'o2'/*,'text-tooltip':1*/},'s':{'button-active':[8,'0 0 6px 0',''],'button-focus':[8,'0 0 6px 0',''],'input-focus':[8,'0 0 10px -2px',''],'interactable-focus':[8,'0 0 6px 0',''],'tab-focus':[11,'0 4px 6px -4px',''],'input':[5,'inset 0 0 0 1px','']}},\n\t//light: {'c':{'accent': 9,'background-accent':8,'background-accent-alt':7,'background-accent-alt-2':6,'background-button':7,'background-button-active':7,'background-button-focus':8,'background-button-hover':8,'background-button-primary-active':7,'background-button-primary-default':9,'background-button-primary-hover':8,'background-graph':15,'background-graph-fill':9,'background-input-checkbox-checked':9,'background-input-checked':8,'background-interactable-active':9,'background-interactable-selected':9,'background-interactable-hover':8,'background-progress-countdown-status':8,'background-progress-status':8,'background-range-fill':9,'background-subscriber-stream-tag-active':13,'background-subscriber-stream-tag-default':13,'background-subscriber-stream-tag-hover':14,'background-toggle-checked':9,/*'background-tooltip':1,*/'background-top-nav':7,'border-brand':9,'border-button':7,'border-button-active':8,'border-button-focus':9,'border-button-hover':8,'border-input-checkbox-checked':9,'border-input-checkbox-focus':9,'border-input-focus':9,'border-interactable-selected':9,'border-subscriber-stream-tag':10,'border-tab-active':8,'border-tab-focus':8,'border-tab-hover':8,'border-toggle-focus':8,'border-toggle-hover':8,'border-whisper-incoming':10,'fill-brand':9,'text-button-text':8,'text-button-text-focus':'o1','text-button-text-hover':'o1','text-link':8,'text-link-active':9,'text-link-focus':9,'text-link-hover':9,'text-link-visited':9,'text-overlay-link-active':13,'text-overlay-link-focus':13,'text-overlay-link-hover':13,'text-tab-active':8},'s':{'button-active':[8,'0 0 6px 0',''],'button-focus':[8,'0 0 6px 0',''],'input-focus':[10,'0 0 10px -2px',''],'interactable-focus':[8,'0 0 6px 1px',''],'tab-focus':[8,'0 4px 6px -4px','']}},\n\t//dark: {'c':{'background-accent':8,'background-accent-alt':7,'background-accent-alt-2':6,'background-button':7,'background-button-active':7,'background-button-focus':8,'background-button-hover':8,'background-button-primary-active':7,'background-button-primary-default':9,'background-button-primary-hover':8,'background-graph':2,'background-graph-fill':8,'background-input-checkbox-checked':9,'background-input-checked':8,'background-interactable-selected':9,'background-progress-countdown-status':9,'background-progress-status':9,'background-range-fill':9,'background-subscriber-stream-tag-active':4,'background-subscriber-stream-tag-default':4,'background-subscriber-stream-tag-hover':3,'background-toggle-checked':9,'background-top-nav':6,'border-brand':9,'border-button':7,'border-button-active':8,'border-button-focus':9,'border-button-hover':8,'border-input-checkbox-checked':9,'border-input-checkbox-focus':9,'border-input-focus':9,'border-interactable-selected':10,'border-subscriber-stream-tag':5,'border-tab-active':11,'border-tab-focus':11,'border-tab-hover':11,'border-toggle-focus':7,'border-toggle-hover':7,'border-whisper-incoming':10,'fill-brand':9,'text-button-text':10,'text-button-text-focus':'o1','text-button-text-hover':'o1','text-link':10,'text-link-active':10,'text-link-focus':10,'text-link-hover':10,'text-link-visited':10,'text-overlay-link-active':13,'text-overlay-link-focus':13,'text-overlay-link-hover':13,'text-tab-active':11,'background-chat':1,'background-chat-alt':3,'background-chat-header':2,'background-modal':3,'text-button-text-active':'o2'},'s':{'button-active':[8,'0 0 6px 0',''],'button-focus':[8,'0 0 6px 0',''],'input-focus':[8,'0 0 10px -2px',''],'interactable-focus':[8,'0 0 6px 0',''],'tab-focus':[11,'0 4px 6px -4px',''],'input':[5,'inset 0 0 0 1px','']}},\n\t//light: {'c':{'background-accent':8,'background-accent-alt':7,'background-accent-alt-2':6,'background-button':7,'background-button-active':7,'background-button-focus':8,'background-button-hover':8,'background-button-primary-active':7,'background-button-primary-default':9,'background-button-primary-hover':8,'background-graph':15,'background-graph-fill':9,'background-input-checkbox-checked':9,'background-input-checked':8,'background-interactable-selected':9,'background-progress-countdown-status':8,'background-progress-status':8,'background-range-fill':9,'background-subscriber-stream-tag-active':13,'background-subscriber-stream-tag-default':13,'background-subscriber-stream-tag-hover':14,'background-toggle-checked':9,'background-top-nav':7,'border-brand':9,'border-button':7,'border-button-active':8,'border-button-focus':9,'border-button-hover':8,'border-input-checkbox-checked':9,'border-input-checkbox-focus':9,'border-input-focus':9,'border-interactable-selected':9,'border-subscriber-stream-tag':10,'border-tab-active':8,'border-tab-focus':8,'border-tab-hover':8,'border-toggle-focus':8,'border-toggle-hover':8,'border-whisper-incoming':10,'fill-brand':9,'text-button-text':8,'text-button-text-focus':'o1','text-button-text-hover':'o1','text-link':8,'text-link-active':9,'text-link-focus':9,'text-link-hover':9,'text-link-visited':9,'text-overlay-link-active':13,'text-overlay-link-focus':13,'text-overlay-link-hover':13,'text-tab-active':8},'s':{'button-active':[8,'0 0 6px 0',''],'button-focus':[8,'0 0 6px 0',''],'input-focus':[10,'0 0 10px -2px',''],'interactable-focus':[8,'0 0 6px 1px',''],'tab-focus':[8,'0 4px 6px -4px','']}},\n\tdark: {'c':{'background-brand':11,'background-accent':8,'background-accent-alt':7,'background-accent-alt-2':6,'background-button':7,'background-button-active':7,'background-button-focus':8,'background-button-hover':8,'background-button-primary-active':7,'background-button-primary-default':9,'background-button-primary-hover':8,'background-chat':1,'background-chat-alt':3,'background-chat-header':2,'background-graph':2,'background-graph-fill':8,'background-input-checkbox-checked':10,'background-input-checked':8,'background-interactable-selected':9,'background-modal':3,'background-progress-countdown-status':9,'background-progress-status':9,'background-range-fill':10,'background-subscriber-stream-tag-active':4,'background-subscriber-stream-tag-default':4,'background-subscriber-stream-tag-hover':3,'background-toggle-checked':2,'background-toggle-handle-checked':10,'background-top-nav':6,'border-brand':9,'border-button':7,'border-button-active':8,'border-button-focus':9,'border-button-hover':8,'border-input-checkbox-checked':10,'border-input-checkbox-focus':10,'border-input-focus':10,'border-interactable-selected':10,'border-range-handle':10,'border-subscriber-stream-tag':5,'border-tab-active':11,'border-tab-focus':11,'border-tab-hover':11,'border-toggle-checked':10,'border-toggle-focus':10,'border-whisper-incoming':10,'fill-brand':9,'text-button-text-active':'o2','text-link':10,'text-link-active':10,'text-link-focus':10,'text-link-hover':10,'text-link-visited':10,'text-overlay-link-active':13,'text-overlay-link-focus':13,'text-overlay-link-hover':13,'text-tab-active':11,'text-toggle-checked-icon':10,'text-tooltip':1,'text-button-text':10},'s':{'button-active':[8,' 0 0 6px 0',''],'button-focus':[8,' 0 0 6px 0',''],'input':[5,' inset 0 0 0 1px',''],'input-focus':[8,' 0 0 10px -2px',''],'interactable-focus':[8,' 0 0 6px 0',''],'tab-focus':[11,' 0 4px 6px -4px','']}},\n\tlight: {'c':{'background-accent':8,'background-accent-alt':7,'background-accent-alt-2':6,'background-button':7,'background-button-active':7,'background-button-focus':8,'background-button-hover':8,'background-button-primary-active':7,'background-button-primary-default':9,'background-button-primary-hover':8,'background-chat':1,'background-chat-alt':3,'background-chat-header':2,'background-graph':15,'background-graph-fill':9,'background-input-checkbox-checked':9,'background-input-checked':8,'background-interactable-selected':9,'background-modal':3,'background-progress-countdown-status':8,'background-progress-status':8,'background-range-fill':9,'background-subscriber-stream-tag-active':13,'background-subscriber-stream-tag-default':13,'background-subscriber-stream-tag-hover':14,'background-toggle-checked':15,'background-top-nav':7,'background-toggle-handle-checked':10,'border-brand':9,'border-button':7,'border-button-active':8,'border-button-focus':9,'border-button-hover':8,'border-input-checkbox-checked':9,'border-input-checkbox-focus':9,'border-input-focus':9,'border-interactable-selected':9,'border-range-handle':9,'border-subscriber-stream-tag':10,'border-tab-active':8,'border-tab-focus':8,'border-tab-hover':8,'border-toggle-checked':9,'border-toggle-focus':9,'border-whisper-incoming':10,'fill-brand':9,'text-button-text-active':'o2','text-link':8,'text-link-active':9,'text-link-focus':9,'text-link-hover':9,'text-link-visited':9,'text-overlay-link-active':13,'text-overlay-link-focus':13,'text-overlay-link-hover':13,'text-tab-active':8,'text-toggle-checked-icon':9,'text-tooltip':1,'text-button-text':8,'background-tooltip':1,'text-button-text-focus':'o1','text-button-text-hover':'o1'},'s':{'button-active':[8,' 0 0 6px 0',''],'button-focus':[8,' 0 0 6px 0',''],'input':[5,' inset 0 0 0 1px',''],'input-focus':[10,' 0 0 10px -2px',''],'interactable-focus':[8,' 0 0 6px 1px',''],'tab-focus':[8,' 0 4px 6px -4px','']}},\n\taccent_dark: {'c':{'accent-hover':10,'accent':9,'accent-primary-1':1,'accent-primary-2':5,'accent-primary-3':6,'accent-primary-4':7,'accent-primary-5':8},'s':{}},\n\taccent_light: {'c':{'accent-hover':10,'accent':9,'accent-primary-1':1,'accent-primary-2':5,'accent-primary-3':6,'accent-primary-4':7,'accent-primary-5':8},'s':{}}\n};\n\n\nexport default class ThemeEngine extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis.inject('settings');\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site.css_tweaks');\n\t\tthis.inject('site.router');\n\n\t\tthis.should_enable = true;\n\n\n\t\t// Tweaks\n\n\t\tthis.settings.add('theme.high-contrast-tweaks', {\n\t\t\tdefault: null,\n\t\t\trequires: ['context.is-forced-colors', 'theme.disable-high-contrast'],\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( val === null ) {\n\t\t\t\t\tif ( ctx.get('theme.disable-high-contrast') )\n\t\t\t\t\t\treturn false;\n\t\t\t\t\treturn ctx.get('context.is-forced-colors') ?? false;\n\t\t\t\t}\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Tweaks',\n\t\t\t\ttitle: 'Enable the use of High Contrast tweaks.',\n\t\t\t\tdescription: 'This loads an additional set of styles when Forced Color / OS High Contrast mode is enabled to ensure page elements are displayed more appropriately.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t});\n\n\t\tthis.settings.add('theme.disable-high-contrast', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Tweaks',\n\t\t\t\ttitle: 'Disable Forced Color / OS High Contrast',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: 'Enabling this will instruct your browser to not respect your operating system\\'s High Contrast settings when displaying Twitch. You may need to refresh for this to take full effect.'\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.disable-auto-dark', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Tweaks @{\"sort\": 10}',\n\t\t\t\ttitle: 'Disable Auto Dark Theme',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: 'Enabling this will attempt to disable a browser\\'s built-in automatic dark theme conversion for websites, which is unnecessary on Twitch and can cause display issues. This may not apply depending on your web browser and settings.'\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.legacy-dark-input', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Tweaks',\n\t\t\t\ttitle: 'Use old input element colors with dark theme.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\t// Font\n\n\t\tthis.settings.add('theme.font.size', {\n\t\t\tdefault: 13,\n\t\t\tprocess(ctx, val) {\n\t\t\t\tif ( typeof val !== 'number' )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = parseFloat(val);\n\t\t\t\t\t} catch(err) { val = null; }\n\n\t\t\t\tif ( ! val || val < 1 || isNaN(val) || ! isFinite(val) || val > 25 )\n\t\t\t\t\tval = 13;\n\n\t\t\t\treturn val;\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Fonts @{\"sort\": 2}',\n\t\t\t\ttitle: 'Font Size',\n\t\t\t\tdescription: '**Minimum:** `1`, **Maximum:** `25`, *Old Default:* `12`\\n\\nHow large should normal text be, in pixels. This may be affected by your browser\\'s zoom and font settings.',\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\ttype: 'number'\n\t\t\t},\n\t\t\tchanged: () => this.updateFont()\n\t\t});\n\n\n\t\t// Colors\n\n\t\tthis.settings.add('theme.color.background', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Colors @{\"sort\": 0, \"description\": \"This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection.\"}',\n\t\t\t\ttitle: 'Background',\n\t\t\t\tdescription: 'Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\tsort: 0,\n\t\t\t\talpha: false\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.color.text', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Colors',\n\t\t\t\ttitle: 'Text',\n\t\t\t\tdescription: 'If not set, this will automatically be set to white or black based on the brightness of the background.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\tsort: 1\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.color.accent', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Colors',\n\t\t\t\ttitle: 'Accent',\n\t\t\t\tdescription: 'The accent color is used for buttons, links, etc.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\talpha: false,\n\t\t\t\tsort: 2\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.color.tooltip.background', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Colors',\n\t\t\t\ttitle: 'Tooltip Background',\n\t\t\t\tdescription: 'If not set, the tooltip settings will be automatically adjusted based on the brightness of the background.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\talpha: true,\n\t\t\t\tsort: 10\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.color.tooltip.text', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Colors',\n\t\t\t\ttitle: 'Tooltip Text',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\tsort: 11\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\n\t\tthis.settings.add('theme.color.chat-background', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Chat Colors @{\"sort\":1}',\n\t\t\t\ttitle: 'Background',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\tsort: 0,\n\t\t\t\talpha: false\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.color.chat-text', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Chat Colors',\n\t\t\t\ttitle: 'Text',\n\t\t\t\tdescription: 'If not set, this will automatically be set to white or black based on the brightness of the background.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\tsort: 1\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.color.chat-accent', {\n\t\t\tdefault: '',\n\t\t\tui: {\n\t\t\t\tpath: 'Appearance > Theme >> Chat Colors',\n\t\t\t\ttitle: 'Accent',\n\t\t\t\tdescription: 'The accent color is used for buttons, links, etc.',\n\t\t\t\tcomponent: 'setting-color-box',\n\t\t\t\talpha: false,\n\t\t\t\tsort: 2\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.can-dark', {\n\t\t\trequires: ['context.route.name'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ! BAD_ROUTES.includes(ctx.get('context.route.name'))\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('theme.is-dark', {\n\t\t\trequires: ['context.force-dark', 'theme.can-dark', 'context.ui.theme', 'context.ui.theatreModeEnabled', 'context.route.name', 'context.location.search'],\n\t\t\tprocess(ctx) {\n\t\t\t\tconst force = ctx.get('context.force-theme');\n\t\t\t\tif ( force != null )\n\t\t\t\t\treturn force;\n\n\t\t\t\tif ( ctx.get('context.route.name') === 'embed-chat' )\n\t\t\t\t\treturn (ctx.get('context.location.search')||'').includes('dark');\n\n\t\t\t\treturn ctx.get('context.ui.theatreModeEnabled') || (ctx.get('theme.can-dark') && ctx.get('context.ui.theme') === 1);\n\t\t\t},\n\t\t\tchanged: () => this.updateCSS()\n\t\t});\n\n\t\tthis.settings.add('theme.tooltips-dark', {\n\t\t\trequires: ['theme.is-dark'],\n\t\t\tprocess(ctx) {\n\t\t\t\treturn ! ctx.get('theme.is-dark')\n\t\t\t}\n\t\t});\n\n\t\tthis._style = null;\n\t\tthis._normalizer = null;\n\t}\n\n\n\tupdateFont() {\n\t\tlet size = this.settings.get('theme.font.size');\n\t\tif ( typeof size === 'string' && /^[0-9.]+$/.test(size) )\n\t\t\tsize = parseFloat(size);\n\t\telse if ( typeof size !== 'number' )\n\t\t\tsize = null;\n\n\t\tif ( ! size || isNaN(size) || ! isFinite(size) || size < 1 || size === 13 ) {\n\t\t\tthis.css_tweaks.delete('font-size');\n\t\t\treturn;\n\t\t}\n\n\t\tsize = size / 10;\n\n\t\tthis.css_tweaks.set('font-size', `html body {\n\t--font-size-1: ${(54/13) * size}rem;\n\t--font-size-2: ${(36/13) * size}rem;\n\t--font-size-3: ${(24/13) * size}rem;\n\t--font-size-4: ${(18/13) * size}rem;\n\t--font-size-5: ${(14/13) * size}rem;\n\t--font-size-6: ${size}rem;\n\t--font-size-7: ${(12/13) * size}rem;\n\t--font-size-8: ${(12/13) * size}rem;\n\t--font-size-base: ${size}rem;\n}\n`);\n\t}\n\n\n\tgenerateBackgroundTextBlob(color) {\n\t\tconst hsla = color.toHSLA(),\n\t\t\tluma = hsla.l,\n\t\t\tdark = luma < 0.5;\n\n\t\treturn this.generateBackgroundBlob(color) + this.generateTextBlob(Color.RGBA.fromCSS(dark ? '#FFF' : '#000'));\n\t}\n\n\n\tgenerateBackgroundBlob(color) { // eslint-disable-line class-methods-use-this\n\t\tconst hsla = color.toHSLA(),\n\t\t\tluma = hsla.l,\n\t\t\tdark = luma < 0.5;\n\n\t\treturn [\n\t\t\t`--color-background-body:${color.toCSS()};`,\n\t\t\t`--color-background-input-focus:${color.toCSS()};`,\n\t\t\t`--color-background-base:${hsla._l(luma + (dark ? 0.05 : -0.05)).toCSS()};`,\n\t\t\t`--color-background-alt:${hsla._l(luma + (dark ? 0.1 : -0.1)).toCSS()};`,\n\t\t\t`--color-background-float:var(--color-background-alt);`,\n\t\t\t`--color-background-alt-2:${hsla._l(luma + (dark ? 0.15 : -0.15)).toCSS()};`\n\t\t].join('');\n\t}\n\n\n\tgenerateTextBlob(color) { // eslint-disable-line class-methods-use-this\n\t\tif ( color.a < 0.4 )\n\t\t\tcolor = color._a(0.4);\n\n\t\tconst alpha = color.a;\n\n\t\treturn [\n\t\t\t`--color-text-base:${color.toCSS()};`,\n\t\t\t`--color-text-input:${color.toCSS()};`,\n\t\t\t`--color-text-label:${color.toCSS()};`,\n\t\t\t`--color-text-label-optional:${color._a(alpha - 0.4).toCSS()};`,\n\t\t\t`--color-text-alt:${color._a(alpha - 0.2).toCSS()};`,\n\t\t\t`--color-text-alt-2:${color._a(alpha - 0.4).toCSS()};`\n\t\t].join('')\n\t}\n\n\n\tgenerateAccentBlob(color, dark) { // eslint-disable-line class-methods-use-this\n\t\tif ( color.a < 1 )\n\t\t\tcolor = color._a(1);\n\n\t\tconst hsla = color.toHSLA(),\n\t\t\tluma = hsla.l;\n\n\t\tconst colors = COLORS.map(x => {\n\t\t\tif ( x === 0 )\n\t\t\t\treturn color.toCSS();\n\n\t\t\treturn hsla._l(luma + x).toCSS();\n\t\t});\n\n\t\tconst out = [],\n\t\t\taccent_out = [];\n\n\t\tfor(let i=0; i < colors.length; i++)\n\t\t\tout.push(`--ffz-color-accent-${i+1}:${colors[i]};`);\n\n\t\tlet source = dark ? ACCENT_COLORS.dark : ACCENT_COLORS.light;\n\n\t\tfor(const [key,val] of Object.entries(source.c)) {\n\t\t\tif ( typeof val !== 'number' )\n\t\t\t\tcontinue;\n\n\t\t\tout.push(`--color-${key}:${colors[val-1]};`);\n\t\t}\n\n\t\tsource = dark ? ACCENT_COLORS.accent_dark : ACCENT_COLORS.accent_light;\n\n\t\tfor(const [key,val] of Object.entries(source.c)) {\n\t\t\tif ( typeof val !== 'number' )\n\t\t\t\tcontinue;\n\n\t\t\taccent_out.push(`--color-${key}:${colors[val-1]} !important;`);\n\t\t}\n\n\t\treturn [out.join(''), accent_out.join('')];\n\t}\n\n\n\tupdateCSS() {\n\t\t//this.updateOldCSS();\n\n\t\tif ( this.settings.get('theme.disable-high-contrast'))\n\t\t\tthis.css_tweaks.set('nofc', NO_FORCED_COLOR);\n\t\telse\n\t\t\tthis.css_tweaks.delete('nofc');\n\n\t\tif ( this.settings.get('theme.disable-auto-dark') )\n\t\t\tthis.css_tweaks.set('nodark', NO_AUTO_DARK);\n\t\telse\n\t\t\tthis.css_tweaks.delete('nodark');\n\n\t\tthis.css_tweaks.setVariable('border-color', 'var(--color-border-base)');\n\n\t\tif ( ! this.settings.get('theme.can-dark') ) {\n\t\t\tthis.toggleNormalizer(false);\n\t\t\tthis.toggleAccentNormal(true);\n\t\t\tthis.css_tweaks.delete('colors');\n\t\t\treturn;\n\t\t}\n\n\t\tlet dark = this.settings.get('theme.is-dark');\n\t\tconst bits = [], accent_bits = [];\n\n\t\tconst background = Color.RGBA.fromCSS(this.settings.get('theme.color.background'));\n\t\tif ( background ) {\n\t\t\tbackground.a = 1;\n\t\t\t//bits.push(`--color-background-body: ${background.toCSS()};`);\n\n\t\t\tconst hsla = background.toHSLA(),\n\t\t\t\tluma = hsla.l;\n\t\t\tdark = luma < 0.5;\n\n\t\t\t// Make sure the Twitch theme is set correctly.\n\t\t\ttry {\n\t\t\t\tconst store = this.resolve('site').store,\n\t\t\t\t\ttheme = store.getState().ui.theme,\n\t\t\t\t\twanted_theme = dark ? 1 : 0;\n\n\t\t\t\tif( theme !== wanted_theme )\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: 'core.ui.THEME_CHANGED',\n\t\t\t\t\t\ttheme: wanted_theme\n\t\t\t\t\t});\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warning('Unable to automatically set the Twitch Dark Theme state.', err);\n\t\t\t}\n\n\t\t\tbits.push(this.generateBackgroundBlob(hsla));\n\n\t\t\t// TODO: Actually calculate these\n\t\t\tif ( dark ) {\n\t\t\t\tbits.push(`--color-border-base: var(--color-opac-gl-2);`);\n\t\t\t\tbits.push(`--color-background-interactable-hover: var(--color-opac-gl-1);`);\n\t\t\t\tbits.push(`--color-background-interactable-active: var(--color-opac-gl-2);`);\n\t\t\t\tbits.push(`--color-background-button-text-hover: var(--color-opac-gl-1);`);\n\t\t\t\tbits.push(`--color-background-button-text-active: var(--color-opac-gl-2);`);\n\t\t\t}\n\t\t}\n\n\t\tlet text = Color.RGBA.fromCSS(this.settings.get('theme.color.text'));\n\t\tif ( ! text && background )\n\t\t\ttext = Color.RGBA.fromCSS(dark ? '#FFF' : '#000');\n\t\tif ( text )\n\t\t\tbits.push(this.generateTextBlob(text));\n\n\t\t// Input elements\n\t\tif ( dark && this.settings.get('theme.legacy-dark-input') ) {\n\t\t\tbits.push(`--color-background-input: var(--color-opac-w-4);\n--color-background-input-overlay: var(--color-opac-b-4);\n--color-background-input-overlay-focus: var(--color-black);\n--color-background-selectable: var(--color-opac-w-3);\n--color-background-selectable-hover: var(--color-opac-w-4);\n--color-border-input: var(--color-opac-w-4);\n--color-border-input-hover: var(--color-opac-w-6);\n--color-border-input-overlay: var(--color-opac-w-6);\n--color-border-input-overlay-hover: var(--color-opac-w-8);\n--color-border-input-checkbox: var(--color-opac-w-10);\n--color-border-selectable: var(--color-opac-w-2);\n--color-border-selectable-hover: var(--color-opac-w-3);`);\n\t\t}\n\n\t\t// Accent\n\t\tconst accent = Color.RGBA.fromCSS(this.settings.get('theme.color.accent'));\n\t\tthis.toggleAccentNormal(! accent);\n\t\tif ( accent ) {\n\t\t\tconst data = this.generateAccentBlob(accent, dark);\n\t\t\tbits.push(data[0]);\n\t\t\taccent_bits.push(data[1]);\n\t\t}\n\n\t\t// Tooltips\n\t\tlet tooltip_bg = Color.RGBA.fromCSS(this.settings.get('theme.color.tooltip.background')),\n\t\t\ttooltip_dark;\n\t\tif ( ! tooltip_bg && background )\n\t\t\ttooltip_bg = Color.RGBA.fromCSS(dark ? '#FFF' : '#000');\n\n\t\tif ( tooltip_bg ) {\n\t\t\tbits.push(`--color-background-tooltip: ${tooltip_bg.toCSS()};`);\n\n\t\t\tconst hsla = tooltip_bg.toHSLA(),\n\t\t\t\tluma = hsla.l;\n\n\t\t\ttooltip_dark = luma < 0.5;\n\t\t} else\n\t\t\ttooltip_dark = ! dark;\n\n\t\tlet tooltip_text = Color.RGBA.fromCSS(this.settings.get('theme.color.tooltip.text'));\n\t\tconst has_tt_text = tooltip_text || tooltip_bg;\n\t\tif ( ! tooltip_text )\n\t\t\ttooltip_text = Color.RGBA.fromCSS(tooltip_dark ? '#FFF' : '#000');\n\n\t\tif ( tooltip_text ) {\n\t\t\tif ( has_tt_text )\n\t\t\t\tbits.push(`--color-text-tooltip: ${tooltip_text.toCSS()};`);\n\n\t\t\tconst hsla = tooltip_text.toHSLA(),\n\t\t\t\talpha = hsla.a;\n\n\t\t\tbits.push(`--color-text-tooltip-alt: ${hsla._a(alpha - 0.2).toCSS()};`);\n\t\t\tbits.push(`--color-text-tooltip-alt-2: ${hsla._a(alpha - 0.4).toCSS()};`);\n\t\t}\n\n\n\t\t// Chat\n\t\tconst chat_bits = [],\n\t\t\tchat_background = Color.RGBA.fromCSS(this.settings.get('theme.color.chat-background'));\n\t\tlet chat_dark = dark;\n\t\tif ( chat_background ) {\n\t\t\tchat_background.a = 1;\n\t\t\tconst hsla = chat_background.toHSLA(),\n\t\t\t\tluma = hsla.l;\n\t\t\tchat_dark = luma < 0.5;\n\n\t\t\tchat_bits.push(this.generateBackgroundBlob(hsla));\n\t\t}\n\n\t\tlet chat_text = Color.RGBA.fromCSS(this.settings.get('theme.color.chat-text'));\n\t\tif ( ! chat_text && chat_background )\n\t\t\tchat_text = Color.RGBA.fromCSS(chat_dark ? '#FFF' : '#000');\n\t\tif ( chat_text )\n\t\t\tchat_bits.push(this.generateTextBlob(chat_text));\n\n\n\t\t// Accent\n\t\tconst chat_accent = Color.RGBA.fromCSS(this.settings.get('theme.color.chat-accent')),\n\t\t\tchat_accent_bits = [];\n\t\t//this.toggleAccentNormal(! accent);\n\t\tif ( chat_accent ) {\n\t\t\tconst data = this.generateAccentBlob(chat_accent, chat_dark);\n\t\t\tchat_bits.push(data[0]);\n\t\t\tchat_accent_bits.push(data[1]);\n\t\t}\n\n\t\tif ( chat_bits.length )\n\t\t\tthis.css_tweaks.set('chat-colors', `.moderation-view-page-widget .stream-chat,.chat-shell {${chat_bits.join('\\n')}}.moderation-view-page-widget .stream-chat .tw-accent-region,.chat-shell .tw-accent-region{${chat_accent_bits.join('\\n')}}`);\n\t\telse\n\t\t\tthis.css_tweaks.delete('chat-colors');\n\n\t\tthis.toggleNormalizer(chat_bits.length || bits.length);\n\n\t\tconst selector = dark ? '' : `:not(.settings-menu-button-component--forced-dark-theme)`;\n\n\t\tif ( bits.length )\n\t\t\tthis.css_tweaks.set('colors', `body,body .tw-root--theme-light,body .tw-root--theme-dark${selector} {${bits.join('\\n')}}.channel-info-content .tw-accent-region,.channel-info-content div[class^=\"ScAccentRegion\"]{${accent_bits.join('\\n')}}`);\n\t\telse\n\t\t\tthis.css_tweaks.delete('colors');\n\t}\n\n\ttoggleAccentNormal(enable) {\n\t\tif ( enable ) {\n\t\t\tconst bits = [];\n\t\t\tfor(let i=0; i < 15; i++)\n\t\t\t\tbits.push(`--ffz-color-accent-${i+1}:var(--color-twitch-purple-${i+1});`);\n\n\t\t\tthis.css_tweaks.set('accent-normal', `body {${bits.join('\\n')}}`);\n\t\t} else\n\t\t\tthis.css_tweaks.delete('accent-normal');\n\t}\n\n\ttoggleNormalizer(enable) {\n\t\tif ( ! this._normalizer ) {\n\t\t\tif ( ! enable )\n\t\t\t\treturn;\n\n\t\t\tthis._normalizer = createElement('link', {\n\t\t\t\trel: 'stylesheet',\n\t\t\t\ttype: 'text/css',\n\t\t\t\thref: NORMALIZER_CSS_URL\n\t\t\t});\n\t\t} else if ( ! enable ) {\n\t\t\tthis._normalizer.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! document.head.contains(this._normalizer) )\n\t\t\tdocument.head.appendChild(this._normalizer)\n\t}\n\n\tonEnable() {\n\t\t// TODO: Detect if this changes?\n\t\tlet has_forced;\n\t\ttry {\n\t\t\thas_forced = window.matchMedia('(forced-colors: active)')?.matches;\n\t\t} catch(err) { /* no-op */ }\n\n\t\tthis.settings.updateContext({\n\t\t\t'is-forced-colors': has_forced ?? false\n\t\t});\n\n\t\tthis.settings.getChanges('theme.high-contrast-tweaks', val => {\n\t\t\tthis.css_tweaks.toggle('hc-tweaks', val);\n\t\t});\n\n\t\tthis.updateCSS();\n\t\tthis.updateFont();\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Video Chat Hooks\n// ============================================================================\n\nimport {get, has} from 'utilities/object';\nimport {print_duration} from 'utilities/time';\n//import {ClickOutside} from 'utilities/dom';\nimport {formatBitsConfig} from '../chat';\n\nimport Module from 'utilities/module';\nimport { RERENDER_SETTINGS, UPDATE_BADGE_SETTINGS, UPDATE_TOKEN_SETTINGS } from 'src/utilities/constants';\n\nconst SUB_REGEX = /^([^\\s]+) subscribed ([^.]+)\\. They've subscribed for (\\d+) months(?:[^!]+streak)?!/;\nconst SUB_TIERS = {\n\t1000: 1,\n\t2000: 2,\n\t3000: 3\n};\n\nfunction parseParamInt(param) {\n\ttry {\n\t\tif ( /^[\\d-]+$/.test(param) )\n\t\t\tparam = parseInt(param, 10);\n\t} catch(err) { /* no-op */ }\n\n\tif ( typeof param !== 'number' || isNaN(param) || ! isFinite(param) )\n\t\tparam = 0;\n\n\treturn param;\n}\n\n\nexport default class VideoChatHook extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\n\t\tthis.inject('site');\n\t\tthis.inject('site.router');\n\t\tthis.inject('site.fine');\n\n\t\tthis.inject('chat');\n\t\tthis.inject('chat.emotes');\n\t\tthis.inject('chat.overrides');\n\t\tthis.injectAs('site_chat', 'site.chat');\n\t\tthis.inject('site.chat.chat_line.rich_content');\n\n\t\tthis.VideoChatController = this.fine.define(\n\t\t\t'video-chat-controller',\n\t\t\tn => n.onError && n.videoData && n.props?.comments,\n\t\t\t['user-video', 'user-clip', 'video']\n\t\t);\n\n\t\t/*this.VideoChatMenu = this.fine.define(\n\t\t\t'video-chat-menu',\n\t\t\tn => n.onToggleMenu && n.getContent && n.props && has(n.props, 'isExpandedLayout'),\n\t\t\t['user-video', 'user-clip', 'video']\n\t\t);*/\n\n\t\tthis.VideoChatLine = this.fine.define(\n\t\t\t'video-chat-line',\n\t\t\tn => n.onTimestampClickHandler && n.props?.messageContext,\n\t\t\t['user-video', 'user-clip', 'video']\n\t\t);\n\n\t\t// Settings\n\n\t\tthis.settings.add('chat.video-chat.timestamps', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Chat on Videos >> Appearance',\n\t\t\t\ttitle: 'Display timestamps alongside chat messages.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('chat.video-chat.enabled', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Chat on Videos @{\"description\": \"This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos.\"} >> General',\n\t\t\t\ttitle: 'Enable FrankerFaceZ features for Chat on Videos.',\n\t\t\t\tdescription: 'Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.active_room = null;\n\t}\n\n\n\tasync onEnable() {\n\t\tthis.chat.context.on('changed:chat.video-chat.enabled', this.rerenderLines, this);\n\t\tthis.chat.context.on('changed:chat.video-chat.timestamps', this.rerenderLines, this);\n\t\tthis.on('chat.overrides:changed', id => this.updateLinesByUser(id, null, false, false), this);\n\t\tthis.on('chat:update-lines-by-user', this.updateLinesByUser, this);\n\t\tthis.on('chat:update-line', this.updateLineById, this);\n\t\tthis.on('chat:update-lines', this.updateLines, this);\n\t\tthis.on('chat:rerender-lines', this.rerenderLines, this);\n\t\tthis.on('chat:update-line-tokens', this.updateLineTokens, this);\n\t\tthis.on('chat:update-line-badges', this.updateLineBadges, this);\n\t\tthis.on('i18n:update', this.rerenderLines, this);\n\t\tthis.on('chat.emotes:update-effects', this.checkEffects, this);\n\n\t\tfor(const setting of RERENDER_SETTINGS)\n\t\t\tthis.chat.context.on(`changed:${setting}`, this.rerenderLines, this);\n\n\t\tfor(const setting of UPDATE_TOKEN_SETTINGS)\n\t\t\tthis.chat.context.on(`changed:${setting}`, this.updateLineTokens, this);\n\n\t\tfor(const setting of UPDATE_BADGE_SETTINGS)\n\t\t\tthis.chat.context.on(`changed:${setting}`, this.updateLineBadges, this);\n\n\t\tthis.on('chat:get-messages', (include_chat, include_whisper, include_video, messages) => {\n\t\t\tif ( include_video )\n\t\t\t\tfor(const inst of this.VideoChatLine.instances) {\n\t\t\t\t\tconst context = inst.props.messageContext;\n\t\t\t\t\tif ( ! context.comment?._ffz_message )\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tmessages.push({\n\t\t\t\t\t\tmessage: context.comment._ffz_message,\n\t\t\t\t\t\t_instance: inst,\n\t\t\t\t\t\tupdate: () => inst.forceUpdate()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t});\n\n\t\tthis.VideoChatController.on('mount', this.chatMounted, this);\n\t\tthis.VideoChatController.on('unmount', this.chatUnmounted, this);\n\t\tthis.VideoChatController.on('receive-props', this.chatUpdated, this);\n\n\t\tthis.VideoChatController.ready((cls, instances) => {\n\t\t\tfor(const inst of instances) {\n\t\t\t\tthis.chatMounted(inst);\n\t\t\t}\n\t\t});\n\n\t\tconst t = this,\n\t\t\tReact = await this.site.findReact();\n\t\tif ( ! React )\n\t\t\treturn;\n\n\t\tconst createElement = React.createElement,\n\t\t\tFFZRichContent = this.rich_content && this.rich_content.RichContent;\n\n\t\tthis.MenuContainer = class FFZMenuContainer extends React.Component {\n\t\t\tconstructor(props) {\n\t\t\t\tsuper(props);\n\n\t\t\t\tthis.onBanUser = () => {\n\t\t\t\t\tthis.props.onBanUserClick({\n\t\t\t\t\t\tbannedUser: this.props.context.comment.commenter,\n\t\t\t\t\t\ttargetChannel: this.props.context.comment.channelId,\n\t\t\t\t\t\tcomment: this.props.context.comment\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.onDeleteComment = () => {\n\t\t\t\t\tthis.props.onDeleteCommentClick(this.props.context.comment);\n\t\t\t\t}\n\n\t\t\t\tthis.onOpen = () => {\n\t\t\t\t\tthis.props.onDisableSync();\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tforce: true\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.onClose = () => {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tforce: false\n\t\t\t\t\t})\n\t\t\t\t};\n\n\t\t\t\tthis.state = {\n\t\t\t\t\tforce: false\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\t//if ( ! t.VideoChatMenu._class )\n\t\t\t\t\treturn null;\n\n\t\t\t\t/*return (<div class={`tw-flex-shrink-0 video-chat__message-menu${this.state.force ? ' video-chat__message-menu--force-visible' : ''}`}>\n\t\t\t\t\t<t.VideoChatMenu._class\n\t\t\t\t\t\tcontext={this.props.context}\n\t\t\t\t\t\tisCurrentUserModerator={this.props.isCurrentUserModerator}\n\t\t\t\t\t\tisExpandedLayout={this.props.isExpandedLayout}\n\t\t\t\t\t\tonBanUserClick={this.onBanUser}\n\t\t\t\t\t\tonClose={this.onClose}\n\t\t\t\t\t\tonDeleteCommentClick={this.onDeleteComment}\n\t\t\t\t\t\tonOpen={this.onOpen}\n\t\t\t\t\t\tonReplyClick={this.props.onReplyClick}\n\t\t\t\t\t/>\n\t\t\t\t</div>);*/\n\t\t\t}\n\t\t}\n\n\t\tthis.VideoChatLine.ready(cls => {\n\t\t\tconst old_render = cls.prototype.render;\n\n\t\t\tcls.prototype.ffzRenderMessage = function(msg, reply) {\n\t\t\t\tconst is_action = msg.is_action,\n\t\t\t\t\taction_style = is_action ? t.chat.context.get('chat.me-style') : 0,\n\t\t\t\t\taction_italic = action_style >= 2,\n\t\t\t\t\taction_color = action_style === 1 || action_style === 3,\n\t\t\t\t\tuser = msg.user,\n\t\t\t\t\traw_color = t.overrides.getColor(user.id) || user.color,\n\t\t\t\t\tcolor = t.site_chat.colors.process(raw_color),\n\n\t\t\t\t\tu = t.site.getUser();\n\n\t\t\t\tif ( u ) {\n\t\t\t\t\tu.moderator = this.props.isCurrentUserModerator;\n\t\t\t\t\tu.staff = u.roles && u.roles.isStaff;\n\t\t\t\t}\n\n\t\t\t\tlet system_msg;\n\n\t\t\t\tif ( msg.system_msg === true ) {\n\t\t\t\t\tconst params = msg.params || {},\n\t\t\t\t\t\tmsg_id = params['msg-id'];\n\t\t\t\t\tif ( msg_id === 'resub' ) {\n\t\t\t\t\t\tconst setting = t.chat.context.get('chat.subs.show'),\n\n\t\t\t\t\t\t\traw_months = parseParamInt(params['msg-param-months']),\n\t\t\t\t\t\t\tcumulative_months = parseParamInt(params['msg-param-cumulative-months']),\n\t\t\t\t\t\t\tmonths = cumulative_months || raw_months;\n\n\t\t\t\t\t\tt.log.info('resub-notice setting:', setting, 'months:', months, 'cumulative:', cumulative_months, 'raw:', raw_months);\n\t\t\t\t\t\tt.log.info('-> params:', params);\n\n\t\t\t\t\t\tif ( setting === 3 || (months > 1 && setting > 0) ) {\n\t\t\t\t\t\t\tconst share = parseParamInt(params['msg-param-should-share-streak']) === 1,\n\t\t\t\t\t\t\t\tplan = params['msg-param-sub-plan'],\n\t\t\t\t\t\t\t\tprime = plan === 'Prime',\n\t\t\t\t\t\t\t\ttier = SUB_TIERS[plan] || 1;\n\n\t\t\t\t\t\t\tt.log.info('-> share:', share, 'plan:', plan, 'tier:', tier);\n\n\t\t\t\t\t\t\tsystem_msg = t.i18n.tList('chat.sub.main', '{user} subscribed {plan}. ', {\n\t\t\t\t\t\t\t\tuser: <span class=\"tw-c-text-base tw-strong\">{user.displayName}</span>,\n\t\t\t\t\t\t\t\tplan: prime ?\n\t\t\t\t\t\t\t\t\tt.i18n.t('chat.sub.twitch-prime', 'with Prime Gaming') :\n\t\t\t\t\t\t\t\t\tt.i18n.t('chat.sub.plan', 'at Tier {tier}', {tier})\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif ( share && raw_months > 1 )\n\t\t\t\t\t\t\t\tsystem_msg.push(t.i18n.t(\n\t\t\t\t\t\t\t\t\t'chat.sub.cumulative-months',\n\t\t\t\t\t\t\t\t\t\"They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tcumulative: cumulative_months,\n\t\t\t\t\t\t\t\t\t\tstreak: raw_months\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\telse if ( months > 1 )\n\t\t\t\t\t\t\t\tsystem_msg.push(t.i18n.t(\n\t\t\t\t\t\t\t\t\t'chat.sub.months',\n\t\t\t\t\t\t\t\t\t\"They've subscribed for {count,number} months!\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tcount: months\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( msg.system_msg )\n\t\t\t\t\tsystem_msg = msg.system_msg;\n\n\t\t\t\tconst tokens = msg.ffz_tokens = msg.ffz_tokens || t.chat.tokenizeMessage(msg, u),\n\t\t\t\t\trich_content = FFZRichContent && t.chat.pluckRichContent(tokens, msg);\n\n\t\t\t\tconst user_block = t.chat.formatUser(user, createElement);\n\t\t\t\tconst override_name = t.overrides.getName(user.id);\n\n\t\t\t\tlet user_class = msg.ffz_user_class;\n\t\t\t\tif ( user_class instanceof Set )\n\t\t\t\t\tuser_class = [...user_class].join(' ');\n\t\t\t\telse if ( Array.isArray(user_class) )\n\t\t\t\t\tuser_class = user_class.join(' ');\n\n\t\t\t\tconst user_props = {\n\t\t\t\t\tclassName: `video-chat__message-author notranslate${override_name ? ' ffz--name-override tw-relative ffz-il-tooltip__container' : ''} ${user_class ?? ''}`,\n\t\t\t\t\t'data-test-selector': 'comment-author-selector',\n\t\t\t\t\thref: `/${user.login}`,\n\t\t\t\t\trel: 'noopener noreferrer',\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t\tstyle: { color }\n\t\t\t\t};\n\n\t\t\t\tif ( msg.ffz_user_props )\n\t\t\t\t\tObject.assign(user_props, msg.ffz_user_props);\n\n\t\t\t\tif ( msg.ffz_user_style )\n\t\t\t\t\tObject.assign(user_props.style, msg.ffz_user_style);\n\n\t\t\t\tconst user_bits = createElement('a', user_props, override_name ? [\n\t\t\t\t\tcreateElement('span', {\n\t\t\t\t\t\tclassName: 'chat-author__display-name'\n\t\t\t\t\t}, override_name),\n\t\t\t\t\tcreateElement('div', {\n\t\t\t\t\t\tclassName: 'ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center'\n\t\t\t\t\t}, user_block)\n\t\t\t\t] : user_block);\n\n\t\t\t\tlet out = (<div class=\"tw-flex-grow-1\" data-room-id={msg.roomID} data-room={msg.roomLogin} data-user-id={user.id} data-user={user.login}>\n\t\t\t\t\t<span class=\"chat-line__message--badges\">{\n\t\t\t\t\t\tt.chat.badges.render(msg, createElement)\n\t\t\t\t\t}</span>\n\t\t\t\t\t{user_bits}\n\t\t\t\t\t<div data-test-selector=\"comment-message-selector\" class=\"tw-inline video-chat__message\">\n\t\t\t\t\t\t<span>{is_action ? ' ' : ': '}</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass={`message ${action_italic ? 'chat-line__message-body--italicized' : ''}`}\n\t\t\t\t\t\t\tstyle={{color: action_color ? color : null}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ t.chat.renderTokens(tokens, createElement) }\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{rich_content && createElement(FFZRichContent, rich_content)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\n\t\t\t\tif ( system_msg )\n\t\t\t\t\tout = (<div class=\"tw-flex-grow-1\">\n\t\t\t\t\t\t<div class=\"tw-flex tw-c-text-alt-2\">\n\t\t\t\t\t\t\t<div>{system_msg}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{out}\n\t\t\t\t\t</div>);\n\n\t\t\t\treturn (<div class=\"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base\">\n\t\t\t\t\t{ out }\n\t\t\t\t\t{ reply ? (<t.MenuContainer\n\t\t\t\t\t\tcontext={reply}\n\t\t\t\t\t\tisCurrentUserModerator={this.props.isCurrentUserModerator}\n\t\t\t\t\t\tisExpandedLayout={this.props.isExpandedLayout}\n\t\t\t\t\t\tonBanUserClick={this.props.onBanUserClick}\n\t\t\t\t\t\tonDeleteCommentClick={this.props.onDeleteCommentClick}\n\t\t\t\t\t\tonDisableSync={this.props.onDisableSync}\n\t\t\t\t\t\tonReplyClick={this.onReplyClickHandler}\n\t\t\t\t\t/>) : null}\n\t\t\t\t</div>);\n\t\t\t}\n\n\t\t\tcls.prototype.ffzRenderExpanded = function(msg) {\n\t\t\t\tif ( ! msg._reply_handler )\n\t\t\t\t\tmsg._reply_handler = () => this.onReplyClickHandler(msg.user.login);\n\n\t\t\t\treturn (<div class=\"tw-align-items-center tw-flex tw-pd-t-05\">\n\t\t\t\t\t<button class=\"tw-button tw-button--text\" data-test-selector=\"parent-reply-button\" onClick={msg._reply_handler}>\n\t\t\t\t\t\t<span class=\"tw-button__text tw-pd-0\">{ t.i18n.t('video-chat.reply', 'Reply') }</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<span class=\"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative ffz-il-tooltip__container\">\n\t\t\t\t\t\t { t.i18n.t('video-chat.time', '{time,humantime} ago', {\n\t\t\t\t\t\t\ttime: msg.timestamp\n\t\t\t\t\t\t}) }\n\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up\" role=\"tooltip\">\n\t\t\t\t\t\t\t{ t.i18n.formatDateTime(msg.timestamp, 'full') }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t</div>)\n\t\t\t}\n\n\t\t\tcls.prototype.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tthis._ffz_no_scan = true;\n\n\t\t\t\t\tif ( this.state?.showReplyForm || ! t.chat.context.get('chat.video-chat.enabled') )\n\t\t\t\t\t\treturn old_render.call(this);\n\n\t\t\t\t\tconst context = this.props.messageContext,\n\t\t\t\t\t\tmsg = t.standardizeMessage(context.comment, context.author),\n\t\t\t\t\t\tmain_message = this.ffzRenderMessage(msg, context),\n\t\t\t\t\t\thide_timestamps = this.props.hideTimestamp || ! t.chat.context.get('chat.video-chat.timestamps'),\n\n\t\t\t\t\t\tbg_css = msg.mentioned && msg.mention_color ? t.site_chat.inverse_colors.process(msg.mention_color) : null;\n\n\t\t\t\t\tif ( msg.ffz_removed )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\tconst highlight = ! bg_css && msg.highlight && t.chat.context.get('chat.points.allow-highlight');\n\n\t\t\t\t\treturn (<div\n\t\t\t\t\t\tdata-test-selector=\"message-layout\"\n\t\t\t\t\t\tclass={`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${msg.is_sub ? ' ffz-notice-line ffz--subscribe-line' : ''}${msg.highlight ? ' ffz-notice-line ffz--points-line' : ''}${highlight ? ' ffz--points-highlight ffz-custom-color' : ''}${msg.mentioned ? ' ffz-mentioned' : ''}${bg_css ? ' ffz-custom-color' : ''}`}\n\t\t\t\t\t\tstyle={{backgroundColor: bg_css}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{hide_timestamps || (<div data-test-selector=\"message-timestamp\" class=\"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header\">\n\t\t\t\t\t\t\t<div class=\"tw-mg-r-05\">\n\t\t\t\t\t\t\t\t<div class=\"tw-inline-flex tw-relative ffz-il-tooltip__container\">\n\t\t\t\t\t\t\t\t\t<button class=\"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive\" onClick={this.onTimestampClickHandler}>\n\t\t\t\t\t\t\t\t\t\t<div class=\"tw-pd-x-05\">\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"tw-font-size-7\">{print_duration(context.comment.contentOffset)}</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up\" role=\"tooltip\">\n\t\t\t\t\t\t\t\t\t\t{t.i18n.t('video-chat.jump', 'Jump to Video')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>)}\n\t\t\t\t\t\t<div class=\"tw-full-width\">\n\t\t\t\t\t\t\t{ main_message }\n\t\t\t\t\t\t\t{ this.props.isExpandedLayout && this.ffzRenderExpanded(msg) }\n\t\t\t\t\t\t\t{ context.replies && context.replies.length > 0 && (<div class=\"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply\">\n\t\t\t\t\t\t\t\t{ context.comment.moreReplies && (<div class=\"tw-inline-block vod-message__show-more-replies\">\n\t\t\t\t\t\t\t\t\t<button class=\"tw-interactive tw-button tw-button--text\" onClick={this.onLoadMoreRepliesClickHandler}>\n\t\t\t\t\t\t\t\t\t\t<span class=\"tw-button__text\" data-a-target=\"tw-button-text\">{\n\t\t\t\t\t\t\t\t\t\t\tt.i18n.t('video-chat.show-more', 'Show more replies...')\n\t\t\t\t\t\t\t\t\t\t}</span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>)}\n\t\t\t\t\t\t\t\t<ul>{\n\t\t\t\t\t\t\t\t\tcontext.replies.map(reply => (<li key={reply.comment && reply.comment.id} class=\"tw-mg-l-05\">\n\t\t\t\t\t\t\t\t\t\t{ this.ffzRenderMessage(t.standardizeMessage(reply.comment, reply.author), reply) }\n\t\t\t\t\t\t\t\t\t\t{ this.props.isExpandedLayout && this.ffzRenderExpanded(msg) }\n\t\t\t\t\t\t\t\t\t</li>))\n\t\t\t\t\t\t\t\t}</ul>\n\t\t\t\t\t\t\t</div>)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>)\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.error('Problem rendering Chat', err);\n\t\t\t\t\treturn old_render.call(this);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do this after a short delay to hopefully reduce the chance of React\n\t\t\t// freaking out on us.\n\t\t\tsetTimeout(() => this.VideoChatLine.forceUpdate());\n\t\t})\n\t}\n\n\n\tupdateLines() {\n\t\treturn this._updateLines();\n\t}\n\n\trerenderLines() {\n\t\tthis.VideoChatLine.forceUpdate();\n\t}\n\n\tupdateLineTokens() {\n\t\treturn this._updateLines(true, false);\n\t}\n\n\tupdateLineBadges() {\n\t\treturn this._updateLines(false, true);\n\t}\n\n\t_updateLines(clear_tokens = true, clear_badges = true) { // eslint-disable-line no-unused-vars\n\t\tfor(const inst of this.VideoChatLine.instances) {\n\t\t\tconst context = inst.props.messageContext;\n\t\t\tif ( ! context.comment )\n\t\t\t\tcontinue;\n\n\t\t\tcontext.comment._ffz_message = null;\n\n\t\t\tif ( Array.isArray(context.replies) )\n\t\t\t\tfor(const reply of context.replies)\n\t\t\t\t\tif ( reply.comment )\n\t\t\t\t\t\treply.comment._ffz_message = null;\n\t\t}\n\n\t\tthis.VideoChatLine.forceUpdate();\n\t}\n\n\n\tupdateLinesByUser(id, login) {\n\t\tfor(const inst of this.VideoChatLine.instances) {\n\t\t\tconst context = inst.props.messageContext;\n\t\t\tif ( ! context.comment )\n\t\t\t\tcontinue;\n\n\t\t\tconst author = context.author;\n\t\t\tif ( author && ((id && id == author.id) || (login && login == author.name))) {\n\t\t\t\tcontext.comment._ffz_message = null;\n\t\t\t\tinst.forceUpdate();\n\t\t\t}\n\t\t}\n\t}\n\n\n\tupdateLineById(id, clear_tokens = true, clear_badges = null) {\n\t\tif ( clear_badges == null )\n\t\t\tclear_badges = clear_tokens;\n\n\t\tfor(const inst of this.VideoChatLine.instances) {\n\t\t\tconst context = inst.props.messageContext;\n\t\t\tif ( ! context.comment )\n\t\t\t\tcontinue;\n\n\t\t\tif ( context.comment?.id === id ) {\n\t\t\t\t// TODO: Better support for clear_tokens and clear_badges\n\t\t\t\tif ( clear_tokens || clear_badges )\n\t\t\t\t\tcontext.comment._ffz_message = null;\n\n\t\t\t\tinst.forceUpdate();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\n\tcheckEffects() {\n\t\tfor(const inst of this.VideoChatLine.instances) {\n\t\t\tconst context = inst.props.messageContext,\n\t\t\t\tmsg = context?.comment?._ffz_message,\n\t\t\t\ttokens = msg?.ffz_tokens;\n\n\t\t\tif ( tokens )\n\t\t\t\tfor(const token of tokens) {\n\t\t\t\t\tif ( token.type === 'emote' && token.modifier_flags )\n\t\t\t\t\t\tthis.emotes.ensureEffect(token.modifier_flags);\n\t\t\t\t}\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Message Standardization\n\t// ========================================================================\n\n\tstandardizeMessage(comment, author) { // eslint-disable-line class-methods-use-this\n\t\tif ( comment._ffz_message )\n\t\t\treturn comment._ffz_message;\n\n\t\tconst room = this.active_room || this.chat.getRoom(comment.channelId, null, true, true),\n\t\t\tparams = comment.message.userNoticeParams,\n\t\t\tmsg_id = params && params['msg-id'];\n\n\t\tconst out = comment._ffz_message = {\n\t\t\tid: comment.id,\n\t\t\tuser: {\n\t\t\t\tcolor: comment.message.userColor,\n\t\t\t\tid: author.id,\n\t\t\t\tlogin: author.name,\n\t\t\t\tdisplayName: author.displayName,\n\t\t\t\tisIntl: author.name && author.displayName && author.displayName.trim().toLowerCase() !== author.name,\n\t\t\t\ttype: author.type\n\t\t\t},\n\t\t\troomLogin: room && room.login,\n\t\t\troomID: room && room.id || comment.channelId,\n\t\t\tffz_badges: this.chat.badges.getBadges(author.id, author.login, room?.id, room?.login),\n\t\t\tbadges: comment.userBadges,\n\t\t\tmessageParts: comment.message.tokens,\n\t\t\tis_action: comment.message.isAction,\n\t\t\tmore_replies: comment.moreReplies,\n\t\t\ttimestamp: comment.createdAt,\n\t\t\tffz_context: 'video',\n\t\t\tis_sub: msg_id === 'sub' || msg_id === 'resub',\n\t\t\thighlight: msg_id === 'highlighted-message',\n\t\t\tparams\n\t\t};\n\n\t\t// We need to strip the sub message from chat messages\n\t\t// because Twitch is dumb. This might need updating to\n\t\t// handle system messages with different syntax.\n\t\tif ( Array.isArray(out.messageParts) && out.messageParts.length && msg_id === 'resub' ) {\n\t\t\tlet content = out.messageParts[0].content;\n\t\t\tif ( typeof content === 'string' ) {\n\t\t\t\tconst match = SUB_REGEX.exec(content);\n\t\t\t\tif ( match ) {\n\t\t\t\t\tcontent = content.slice(match[0].length).trimLeft();\n\t\t\t\t\tif ( content.length ) {\n\t\t\t\t\t\tout.messageParts[0].ffz_content = content;\n\t\t\t\t\t\tout.system_msg = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tthis.chat.detokenizeMessage(out);\n\n\t\treturn out;\n\t}\n\n\n\t// ========================================================================\n\t// Room Handling\n\t// ========================================================================\n\n\taddRoom(thing, props) {\n\t\tif ( ! props )\n\t\t\tprops = thing.props;\n\n\t\tconst channel = get('data.video.owner', props);\n\t\tif ( ! channel || ! channel.id )\n\t\t\treturn null;\n\n\t\tconst room = thing._ffz_room = this.chat.getRoom(channel.id, channel.login && channel.login.toLowerCase(), false, true);\n\t\troom.ref(thing);\n\t\treturn room;\n\t}\n\n\n\tremoveRoom(thing) { // eslint-disable-line class-methods-use-this\n\t\tif ( ! thing._ffz_room )\n\t\t\treturn;\n\n\t\tthing._ffz_room.unref(thing);\n\t\tthing._ffz_room = null;\n\t}\n\n\n\t// ========================================================================\n\t// Video Chat Controller\n\t// ========================================================================\n\n\tchatMounted(chat, props) {\n\t\tif ( ! props )\n\t\t\tprops = chat.props;\n\n\t\tif ( ! this.addRoom(chat, props) )\n\t\t\treturn;\n\n\t\tthis.active_room = chat._ffz_room;\n\t\tthis.chat.badges.updateTwitchBadges(get('data.badges', props));\n\n\t\tthis.updateRoomBadges(chat, get('data.video.owner.broadcastBadges', props));\n\t\tthis.updateRoomBitsConfig(chat, props.bitsConfig);\n\t}\n\n\n\tchatUpdated(chat, props) {\n\t\tif ( get('data.video.owner.id', props) !== get('data.video.owner.id', chat.props) ) {\n\t\t\tthis.removeRoom(chat);\n\t\t\tthis.chatMounted(chat, props);\n\t\t\treturn;\n\t\t}\n\n\t\tconst new_badges = get('data.badges', props),\n\t\t\told_badges = get('data.badges', chat.props),\n\n\t\t\tnew_room_badges = get('data.video.owner.broadcastBadges', props),\n\t\t\told_room_badges = get('data.video.owner.broadcastBadges', chat.props);\n\n\t\tif ( new_badges !== old_badges )\n\t\t\tthis.chat.badges.updateTwitchBadges(new_badges);\n\n\t\tif ( new_room_badges !== old_room_badges )\n\t\t\tthis.updateRoomBadges(chat, new_room_badges);\n\n\t\tif ( props.bitsConfig !== chat.props.bitsConfig )\n\t\t\tthis.updateRoomBitsConfig(chat, props.bitsConfig);\n\n\t\tconst channel = get('data.video.owner', props);\n\n\t\tthis.settings.updateContext({\n\t\t\tmoderator: props.isCurrentUserModerator\n\t\t});\n\n\t\tthis.chat.context.updateContext({\n\t\t\tmoderator: props.isCurrentUserModerator,\n\t\t\tchannel: channel ? channel.login : null,\n\t\t\tchannelID: channel ? channel.id : null\n\t\t});\n\t}\n\n\n\tchatUnmounted(chat) {\n\t\tif (this.active_room === chat._ffz_room)\n\t\t\tthis.active_room = null;\n\n\t\tthis.removeRoom(chat);\n\t}\n\n\n\tupdateRoomBadges(chat, badges) { // eslint-disable-line class-methods-use-this\n\t\tconst room = chat._ffz_room;\n\t\tif ( ! room )\n\t\t\treturn;\n\n\t\troom.updateBadges(badges);\n\t}\n\n\n\tupdateRoomBitsConfig(chat, config) { // eslint-disable-line class-methods-use-this\n\t\tconst room = chat._ffz_room;\n\t\tif ( ! room )\n\t\t\treturn;\n\n\t\troom.updateBitsConfig(formatBitsConfig(config));\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Apollo\n// Legendary Data Access Layer\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {get} from 'utilities/object';\nimport merge from 'utilities/graphql';\nimport { FFZEvent } from 'utilities/events';\n\n\n/*const BAD_ERRORS = [\n\t'timeout',\n\t'unable to load',\n\t'error internal',\n\t'context deadline exceeded',\n\t'unexpected service response',\n\t'service unavailable',\n\t'404',\n\t'500',\n\t'501',\n\t'502',\n\t'503',\n\t'504',\n\t'Internal Server Error',\n\t'http://',\n\t'https://'\n];\n\nfunction skip_error(err) {\n\tfor(const m of BAD_ERRORS)\n\t\tif ( err.message.includes(m) )\n\t\t\treturn true;\n}*/\n\n\nexport class ApolloEvent extends FFZEvent {\n\tconstructor(data) {\n\t\tsuper(data);\n\n\t\tthis._changed = false;\n\t}\n\n\tmarkChanged() {\n\t\tthis._changed = true;\n\t\treturn this;\n\t}\n}\n\n\nexport class GQLError extends Error {\n\tconstructor(err) {\n\t\tsuper(`${err.message}; Location: ${err.locations}`);\n\t}\n}\n\n\nexport default class Apollo extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.modifiers = {};\n\t\tthis.post_modifiers = {};\n\n\t\tthis.inject('..fine');\n\t}\n\n\tget gqlPrint() {\n\t\tif ( this._gql_print )\n\t\t\treturn this._gql_print;\n\n\t\tconst web_munch = this.resolve('site.web_munch'),\n\t\t\tprinter = this._gql_print = web_munch?.getModule?.('gql-printer');\n\n\t\treturn printer;\n\t}\n\n\tonEnable() {\n\t\t// TODO: Come up with a better way to await something existing.\n\t\tlet client = this.client;\n\n\t\tif ( ! client ) {\n\t\t\tconst root = this.fine.react,\n\t\t\t\tinst = root && root.stateNode;\n\n\t\t\tclient = inst?.props?.client;\n\t\t\tif ( root && ! client ) {\n\t\t\t\tlet i=0, node = root;\n\t\t\t\twhile( ! client?.queryManager && node && i++ < 20 ) {\n\t\t\t\t\tclient = node?.memoizedProps?.client;\n\t\t\t\t\tnode = node?.child;\n\t\t\t\t}\n\n\t\t\t\tif ( ! client ) {\n\t\t\t\t\tconst host = this.fine.searchTree(null, n => n.props?.client?.queryManager, 500);\n\t\t\t\t\tif ( host )\n\t\t\t\t\t\tclient = host.props.client;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.client = client;\n\t\t}\n\n\t\tif ( ! client )\n\t\t\treturn new Promise(() => this.onEnable(), 50);\n\n\t\t// Register middleware so that we can intercept requests.\n\t\tif ( ! this.client.link || ! this.client.queryManager || ! this.client.queryManager.link ) {\n\t\t\tthis.log.error('Apollo does not have a Link. We are unable to manipulate queries.');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hooked_query_init = false;\n\n\t\tconst t = this,\n\t\t\tproto = this.client.queryManager.constructor.prototype,\n\t\t\told_qm_get = proto.getCurrentQueryResult;\n\n\t\tproto.getCurrentQueryResult = function(query, optimistic = true) {\n\t\t\tconst out = old_qm_get.call(this, query, optimistic);\n\t\t\tif ( out && out.partial )\n\t\t\t\ttry {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst prev = query.getLastResult(),\n\t\t\t\t\t\t\topts = query.options;\n\t\t\t\t\t\tthis.dataStore.getCache().read({\n\t\t\t\t\t\t\tquery: opts.query,\n\t\t\t\t\t\t\tvariables: opts.variables,\n\t\t\t\t\t\t\tpreviousResult: prev ? prev.data : undefined,\n\t\t\t\t\t\t\toptimistic\n\t\t\t\t\t\t});\n\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t// If there's a missing field, and we have a lastResult, and lastResult is not loading, and lastResult is not error...\n\t\t\t\t\t\tif ( err.toString().includes(\"Can't find field\") && query.lastResult && ! query.lastResult.loading && ! query.lastError ) {\n\t\t\t\t\t\t\tif ( Date.now() - (query._ffz_last_retry || 0) >= 120000 ) {\n\t\t\t\t\t\t\t\tconst raw_name = get('options.query.definitions.0.name', query),\n\t\t\t\t\t\t\t\t\tname = raw_name && raw_name.kind === 'Name' ? raw_name.value : `#${query.queryId}`;\n\n\t\t\t\t\t\t\t\tt.log.info('Forcing query to refetch due to missing field:', name);\n\t\t\t\t\t\t\t\tquery._ffz_last_retry = Date.now();\n\t\t\t\t\t\t\t\tquery.refetch();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} catch(err) {\n\t\t\t\t\tt.log.capture(err);\n\t\t\t\t}\n\n\t\t\treturn out;\n\t\t}\n\n\t\tif ( this.client.queryManager.queryStore ) {\n\t\t\tconst old_qm_init = this.client.queryManager.queryStore.initQuery;\n\t\t\tthis.hooked_query_init = true;\n\t\t\tthis.client.queryManager.queryStore.initQuery = function(e) {\n\t\t\t\tconst t = this.store[e.queryId];\n\t\t\t\tif ( t && t.queryString !== e.queryString )\n\t\t\t\t\tt.queryString = e.queryString;\n\n\t\t\t\treturn old_qm_init.call(this, e);\n\t\t\t}\n\t\t}\n\n\t\tconst ApolloLink = this.ApolloLink = this.client.link.constructor;\n\n\t\tthis.link = new ApolloLink((operation, forward) => {\n\t\t\tif ( ! this.enabled )\n\t\t\t\treturn forward(operation);\n\n\t\t\tlet vars = operation.variables;\n\t\t\tif ( ! Object.keys(vars).length )\n\t\t\t\tvars = undefined;\n\n\t\t\ttry {\n\t\t\t\t// ONLY do this if we've hooked query init, thus letting us ignore certain issues\n\t\t\t\t// that would cause Twitch to show lovely \"Error loading data\" messages everywhere.\n\t\t\t\tif ( this.hooked_query_init )\n\t\t\t\t\tthis.apolloPreFlight(operation);\n\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.capture(err, {\n\t\t\t\t\ttags: {\n\t\t\t\t\t\toperation: operation.operationName\n\t\t\t\t\t},\n\t\t\t\t\textra: {\n\t\t\t\t\t\tvariables: vars\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.log.error('Error running Pre-Flight', err, operation);\n\t\t\t\treturn forward(operation);\n\t\t\t}\n\n\t\t\treturn forward(operation).map(result => {\n\t\t\t\tif ( result.extensions && result.extensions.operationName === operation.operationName )\n\t\t\t\t\tthis.log.crumb({\n\t\t\t\t\t\tlevel: 'info',\n\t\t\t\t\t\tcategory: 'gql',\n\t\t\t\t\t\tmessage: `${operation.operationName} [${result.extensions && result.extensions.durationMilliseconds || '??'}ms]`,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tvariables: vars,\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tthis.apolloPostFlight(result);\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.log.capture(err, {\n\t\t\t\t\t\ttags: {\n\t\t\t\t\t\t\toperation: operation.operationName\n\t\t\t\t\t\t},\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tvariables: vars\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.log.error('Error running Post-Flight', err, result);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t});\n\t\t})\n\n\t\tthis.old_link = this.client.link;\n\t\tthis.old_qm_link = this.client.queryManager.link;\n\t\t//this.old_qm_dedup = this.client.queryManager.deduplicator;\n\n\t\tthis.client.link = ApolloLink.from([\n\t\t\tthis.link,\n\t\t\tthis.old_link\n\t\t]);\n\n\t\tthis.client.queryManager.link = ApolloLink.from([\n\t\t\tthis.link,\n\t\t\tthis.old_qm_link\n\t\t]);\n\n\t\t/*this.client.queryManager.deduplicator = ApolloLink.from([\n\t\t\tthis.link,\n\t\t\tthis.old_qm_dedup\n\t\t]);*/\n\n\t\t/*this.client.link = this.link.concat(this.old_link);\n\t\tthis.client.queryManager.link = this.link.concat(this.old_qm_link);\n\t\tthis.client.queryManager.deduplicator = this.link.concat(this.old_qm_dedup);*/\n\t}\n\n\n\tonDisable() {\n\t\t// Remove our references to things.\n\t\tthis.client = this.printer = this._gql_print = this.old_link = this.old_qm_dedup = this.old_qm_link = null;\n\t}\n\n\n\tapolloPreFlight(request) {\n\t\tconst operation = request.operationName,\n\t\t\tmodifiers = this.modifiers[operation],\n\t\t\tevent = `:request.${operation}`,\n\t\t\thas_listeners = this.hasListeners(event);\n\n\t\tif ( ! modifiers && ! has_listeners )\n\t\t\treturn;\n\n\t\tconst qm = this.client.queryManager,\n\t\t\tid_map = qm && qm.queryIdsByName,\n\t\t\tquery_map = qm && qm.queries,\n\t\t\traw_id = id_map && id_map[operation],\n\t\t\tid = Array.isArray(raw_id) ? raw_id[0] : raw_id,\n\t\t\tquery = query_map && query_map.get(id);\n\n\t\tif ( modifiers ) {\n\t\t\tfor(const mod of modifiers) {\n\t\t\t\tif ( typeof mod === 'function' )\n\t\t\t\t\tmod(request);\n\t\t\t\telse if ( mod[1] )\n\t\t\t\t\tthis.applyModifier(request, mod[1]);\n\t\t\t}\n\t\t}\n\n\t\tlet modified = !! modifiers;\n\n\t\tif ( has_listeners ) {\n\t\t\tconst e = new ApolloEvent({\n\t\t\t\toperation,\n\t\t\t\trequest\n\t\t\t});\n\n\t\t\tthis.emit(event, e);\n\t\t\tif ( e._changed )\n\t\t\t\tmodified = true;\n\t\t}\n\n\t\tif ( modified ) {\n\t\t\t// Wipe the old query data. This is obviously not optimal, but Apollo will\n\t\t\t// raise an exception otherwise because the query string doesn't match.\n\n\t\t\tconst q = this.client.queryManager.queryStore.store[id],\n\t\t\t\tqs = this.gqlPrint && this.gqlPrint(request.query);\n\n\t\t\tif ( q )\n\t\t\t\tif ( qs ) {\n\t\t\t\t\tq.queryString = qs;\n\t\t\t\t\trequest.query.loc.source.body = qs;\n\t\t\t\t\trequest.query.loc.end = qs.length;\n\n\t\t\t\t\tif ( query ) {\n\t\t\t\t\t\tquery.document = request.query;\n\t\t\t\t\t\tif ( query.observableQuery && query.observableQuery.options )\n\t\t\t\t\t\t\tquery.observableQuery.options.query = request.query;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.log.info('Unable to find GQL Print. Clearing store for query:', operation);\n\t\t\t\t\tthis.client.queryManager.queryStore.store[id] = null;\n\t\t\t\t}\n\t\t}\n\t}\n\n\tapolloPostFlight(response) {\n\t\tif ( ! response.extensions )\n\t\t\treturn;\n\n\t\tconst operation = response.extensions.operationName,\n\t\t\tmodifiers = this.post_modifiers[operation];\n\n\t\tif ( modifiers )\n\t\t\tfor(const mod of modifiers)\n\t\t\t\tmod(response);\n\n\t\tthis.emit(`:response.${operation}`, response.data);\n\t}\n\n\n\tapplyModifier(request, modifier) { // eslint-disable-line class-methods-use-this\n\t\trequest.query = merge(request.query, modifier);\n\t}\n\n\n\tregisterModifier(operation, modifier, pre=true) {\n\t\tif ( typeof modifier !== 'function' ) {\n\t\t\tif ( ! pre )\n\t\t\t\tthrow new Error('post modifiers must be functions');\n\n\t\t\t/*let parsed;\n\t\t\ttry {\n\t\t\t\tparsed = this.graphql ? this.graphql.parse(modifier, {noLocation: true}) : null;\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.error(`Error parsing GraphQL statement for \"${operation}\" modifier.`, err);\n\t\t\t\tparsed = false;\n\t\t\t}*/\n\n\t\t\tmodifier = [modifier, modifier]; // parsed];\n\t\t}\n\n\t\tconst mods = pre\n\t\t\t? (this.modifiers[operation] = this.modifiers[operation] || [])\n\t\t\t: (this.post_modifiers[operation] = this.post_modifiers[operation] || []);\n\n\t\tmods.push(modifier);\n\t}\n\n\tunregisterModifier(operation, modifier, pre=true) {\n\t\tconst mods = pre ? this.modifiers[operation] : this.post_modifiers[operation];\n\t\tif ( ! mods )\n\t\t\treturn;\n\n\t\tif ( typeof modifier !== 'function' )\n\t\t\tthrow new Error('graphql modifiers cannot be removed');\n\n\t\tfor(let i=0; i < mods.length; i++) {\n\t\t\tconst mod = mods[i];\n\t\t\tif ( typeof mod === 'function' ? mod === modifier : mod[0] === modifier ) {\n\t\t\t\tmods.splice(i, 1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Querying\n\t// ========================================================================\n\n\tgetQuery(operation) {\n\t\tconst query_map = this.client.queryManager?.queries;\n\n\t\tif ( ! query_map )\n\t\t\treturn;\n\n\t\tfor(const val of query_map.values()) {\n\t\t\tconst obs = val?.observableQuery;\n\t\t\tif ( obs?.queryName === operation )\n\t\t\t\treturn obs;\n\t\t}\n\t}\n\n\n\tmaybeRefetch(operation) {\n\t\tconst query = this.getQuery(operation);\n\t\tif ( ! query || ! query.lastResult || query.lastResult.stale )\n\t\t\treturn;\n\n\t\tquery.refetch();\n\t}\n\n\n\tensureQuery(operation, predicate, delay = 500, retry_wait = 120000) {\n\t\tconst query = this.getQuery(operation);\n\n\t\tif ( query ) {\n\t\t\tconst result = query.lastResult;\n\t\t\tlet passed;\n\t\t\tif ( ! result )\n\t\t\t\tpassed = false;\n\t\t\telse if ( result.loading )\n\t\t\t\tpassed = true;\n\t\t\telse if ( typeof predicate === 'function' )\n\t\t\t\tpassed = predicate(result);\n\t\t\telse\n\t\t\t\tpassed = get(predicate, result) !== undefined;\n\n\t\t\tif ( ! passed && Date.now() - (query._ffz_last_retry || 0) >= retry_wait ) {\n\t\t\t\tquery._ffz_last_retry = Date.now();\n\n\t\t\t\t// Make a shallow clone of the query document to avoid hitting the\n\t\t\t\t// cache in transformDocument.\n\t\t\t\tquery.options.query = Object.assign({}, query.options.query);\n\n\t\t\t\tif ( delay === 0 )\n\t\t\t\t\tquery.refetch();\n\t\t\t\telse if ( delay > 0 )\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t//debugger;\n\t\t\t\t\t\tquery.refetch()\n\t\t\t\t\t}, delay);\n\t\t\t}\n\t\t}\n\n\t\treturn query;\n\t}\n\n\n\tgetFromQuery(operation, predicate, delay = 500, retry_wait = 120000) {\n\t\tconst query = this.getQuery(operation),\n\t\t\tresult = query && query.lastResult;\n\n\t\tif ( ! query )\n\t\t\treturn undefined;\n\n\t\tlet out;\n\n\t\tif ( result ) {\n\t\t\tif ( typeof predicate === 'function' )\n\t\t\t\tout = predicate(result);\n\t\t\telse\n\t\t\t\tout = get(predicate, result)\n\n\t\t\tif ( result.loading )\n\t\t\t\treturn undefined;\n\t\t}\n\n\t\tif ( out === undefined && Date.now() - (query._ffz_last_retry || 0) >= retry_wait ) {\n\t\t\tquery._ffz_last_retry = Date.now();\n\n\t\t\t// Make a shallow clone of the query document to avoid hitting the\n\t\t\t// cache in transformDocument.\n\t\t\tquery.options.query = Object.assign({}, query.options.query);\n\n\t\t\tif ( delay === 0 )\n\t\t\t\tquery.refetch();\n\t\t\telse if ( delay > 0 )\n\t\t\t\tsetTimeout(() => query.refetch(), delay);\n\t\t}\n\n\t\treturn out;\n\t}\n\n}\n","'use strict';\n\nimport {parse as parse_path} from 'utilities/path-parser';\n\nlet MD, MILA, waiters;\nlet _md;\n\nfunction loadMD() {\n\tif ( MD )\n\t\treturn Promise.resolve(MD);\n\n\treturn new Promise((s,f) => {\n\t\tif ( waiters )\n\t\t\treturn waiters.push([s,f]);\n\n\t\twaiters = [[s,f]];\n\n\t\tPromise.all([\n\t\t\timport(/* webpackChunkName: 'markdown' */ 'markdown-it'),\n\t\t\timport(/* webpackChunkName: 'markdown' */ 'markdown-it-link-attributes')\n\t\t]).then(modules => {\n\t\t\tMD = modules[0]?.default;\n\t\t\tMILA = modules[1]?.default;\n\n\t\t\tconst waited = waiters;\n\t\t\twaiters = null;\n\n\t\t\tfor(const pair of waited)\n\t\t\t\tpair[0](MD);\n\n\t\t}).catch(err => {\n\t\t\tconst waited = waiters;\n\t\t\twaiters = null;\n\n\t\t\tfor(const pair of waited)\n\t\t\t\tpair[1](err);\n\t\t});\n\t});\n}\n\n\nfunction SettingsLinks(md) {\n\tconst default_render = md.renderer.rules.link_open || this.defaultRender;\n\n\tmd.renderer.rules.link_open = function(tokens, idx, options, env, self) {\n\t\tconst token = tokens[idx];\n\t\tif ( token && token.type === 'link_open' && Array.isArray(token.attrs) ) {\n\t\t\tlet href;\n\t\t\tfor(const attr of token.attrs) {\n\t\t\t\tif ( attr[0] === 'href' ) {\n\t\t\t\t\thref = attr[1];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( href.startsWith('~') ) {\n\t\t\t\tlet path;\n\n\t\t\t\tif ( href === '~' ) {\n\t\t\t\t\t// We don't have a path, make one from the bits.\n\t\t\t\t\tlet i = idx + 1;\n\t\t\t\t\tlet bits = [];\n\n\t\t\t\t\twhile(i < tokens.length) {\n\t\t\t\t\t\tconst tok = tokens[i],\n\t\t\t\t\t\t\ttype = tok?.type;\n\t\t\t\t\t\tif ( type === 'text' )\n\t\t\t\t\t\t\tbits.push(tok);\n\t\t\t\t\t\telse if ( type === 'link_close' )\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\n\t\t\t\t\tbits = bits.map(x => x.content).join('');\n\t\t\t\t\tconst toks = parse_path(bits);\n\t\t\t\t\tpath = toks.map(x => x.key).join('.');\n\t\t\t\t} else\n\t\t\t\t\tpath = href.slice(1);\n\n\t\t\t\tif ( path && path.length ) {\n\t\t\t\t\tfor(const attr of token.attrs) {\n\t\t\t\t\t\tif ( attr[0] === 'class' ) {\n\t\t\t\t\t\t\tattr[1] = attr[1].replace(/ffz-tooltip/g, '');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttoken.attrs.push([\n\t\t\t\t\t\t'data-settings-link',\n\t\t\t\t\t\tpath\n\t\t\t\t\t]);\n\t\t\t\t\ttoken.attrs.push([\n\t\t\t\t\t\t'onclick',\n\t\t\t\t\t\t'FrankerFaceZ.get().resolve(\"main_menu\").mdNavigate(this);return false'\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn default_render(tokens, idx, options, env, self);\n\t}\n}\n\nSettingsLinks.defaultRender = function(tokens, idx, options, env, self) {\n\treturn self.renderToken(tokens, idx, options);\n}\n\nexport default async function awaitMD() {\n\tif ( ! _md ) {\n\t\tconst MD = await loadMD();\n\t\tif ( ! MD )\n\t\t\treturn null;\n\n\t\tconst md = _md = new MD({\n\t\t\thtml: false,\n\t\t\tlinkify: true\n\t\t});\n\n\t\tmd.use(SettingsLinks);\n\t\tmd.use(MILA, {\n\t\t\tattrs: {\n\t\t\t\tclass: 'ffz-tooltip',\n\t\t\t\ttarget: '_blank',\n\t\t\t\trel: 'noopener',\n\t\t\t\t'data-tooltip-type': 'link'\n\t\t\t}\n\t\t});\n\t}\n\n\treturn _md;\n}\n\nexport function getMD(callback) {\n\tif ( _md )\n\t\treturn _md;\n\n\tif ( callback )\n\t\tawaitMD().then(md => callback(md));\n}","'use strict';\n\n// ============================================================================\n// Name and Color Overrides\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { createElement, ClickOutside } from 'utilities/dom';\nimport Tooltip from 'utilities/tooltip';\nimport type SettingsManager from 'root/src/settings';\n\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\t'chat.overrides': Overrides;\n\t}\n\tinterface ModuleEventMap {\n\t\t'chat.overrides': OverrideEvents;\n\t}\n\tinterface ProviderTypeMap {\n\t\t'overrides.colors': Record<string, string | undefined>;\n\t\t'overrides.names': Record<string, string | undefined>;\n\t}\n}\n\n\nexport type OverrideEvents = {\n\t':changed': [id: string, type: 'name' | 'color', value: string | undefined];\n}\n\n\nexport default class Overrides extends Module<'chat.overrides'> {\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\n\t// State and Caching\n\tcolor_cache: Record<string, string | undefined> | null;\n\tname_cache: Record<string, string | undefined> | null;\n\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.inject('settings');\n\n\t\tthis.color_cache = null;\n\t\tthis.name_cache = null;\n\n\t\t/*this.settings.addUI('chat.overrides', {\n\t\t\tpath: 'Chat > Overrides @{\"profile_warning\": false}',\n\t\t\tcomponent: 'chat-overrides',\n\n\t\t\ton: (...args) => this.on(...args),\n\t\t\toff: (...args) => this.off(...args),\n\n\t\t\tsetColor: (...args) => this.setColor(...args),\n\t\t\tsetName: (...args) => this.setName(...args),\n\t\t\tdeleteColor: id => this.deleteColor(id),\n\t\t\tdeleteName: id => this.deleteName(id),\n\n\t\t\tgetColors: () => this.colors,\n\t\t\tgetNames: () => this.names\n\t\t});*/\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.settings.provider.on('changed', this.onProviderChange, this);\n\t}\n\n\trenderUserEditor(user: any, target: HTMLElement) {\n\t\tlet outside: ClickOutside | null,\n\t\t\tpopup: Tooltip | null,\n\t\t\tve: any;\n\n\t\tconst destroy = () => {\n\t\t\tconst o = outside, p = popup, v = ve;\n\t\t\toutside = popup = ve = null;\n\n\t\t\tif ( o )\n\t\t\t\to.destroy();\n\n\t\t\tif ( p )\n\t\t\t\tp.destroy();\n\n\t\t\tif ( v )\n\t\t\t\tv.$destroy();\n\t\t}\n\n\t\tconst parent =\n\t\t\tdocument.fullscreenElement as HTMLElement\n\t\t\t?? document.body.querySelector<HTMLElement>('#root>div')\n\t\t\t?? document.body;\n\n\t\tpopup = new Tooltip(parent, [], {\n\t\t\tlogger: this.log,\n\t\t\tmanual: true,\n\t\t\tlive: false,\n\t\t\thtml: true,\n\t\t\thover_events: true,\n\t\t\tno_update: true,\n\t\t\tno_auto_remove: true,\n\n\t\t\ttooltipClass: 'ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base',\n\t\t\tarrowClass: '', //ffz-balloon__tail tw-overflow-hidden tw-absolute',\n\t\t\tarrowInner: '', //ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute',\n\t\t\tinnerClass: '',\n\n\t\t\tpopper: {\n\t\t\t\tplacement: 'bottom',\n\t\t\t\tmodifiers: {\n\t\t\t\t\tpreventOverflow: {\n\t\t\t\t\t\tboundariesElement: parent\n\t\t\t\t\t},\n\t\t\t\t\tflip: {\n\t\t\t\t\t\tbehavior: ['bottom', 'top', 'left', 'right']\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcontent: async (t, tip) => {\n\t\t\t\tconst vue = this.resolve('vue'),\n\t\t\t\t\t_editor = import(/* webpackChunkName: \"overrides\" */ './override-editor.vue');\n\n\t\t\t\tif ( ! vue )\n\t\t\t\t\tthrow new Error('unable to load vue');\n\n\t\t\t\tconst [, editor] = await Promise.all([vue.enable(), _editor]);\n\t\t\t\tvue.component('override-editor', editor.default);\n\n\t\t\t\tve = new vue.Vue({\n\t\t\t\t\tel: createElement('div'),\n\t\t\t\t\trender: h => h('override-editor', {\n\t\t\t\t\t\tuser,\n\n\t\t\t\t\t\tname: this.getName(user.id),\n\t\t\t\t\t\tcolor: this.getColor(user.id),\n\n\t\t\t\t\t\toriginalName: user.displayName ?? user.login,\n\t\t\t\t\t\toriginalColor: user.color,\n\n\t\t\t\t\t\tupdateTip: () => tip.update(),\n\t\t\t\t\t\tsetColor: val => this.setColor(user.id, val),\n\t\t\t\t\t\tdeleteColor: () => this.deleteColor(user.id),\n\t\t\t\t\t\tsetName: val => this.setName(user.id, val),\n\t\t\t\t\t\tdeleteName: () => this.deleteName(user.id),\n\n\t\t\t\t\t\tclose: () => tip.hide()\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t\treturn ve.$el;\n\t\t\t},\n\n\t\t\tonShow: async (t, tip) => {\n\t\t\t\tawait tip.waitForDom();\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tif ( tip.outer )\n\t\t\t\t\t\toutside = new ClickOutside(tip.outer, destroy)\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tonMove: (target, tip, event) => {\n\t\t\t\tthis.emit('tooltips:hover', target, tip, event)\n\t\t\t},\n\n\t\t\tonLeave: (target, tip, event) => {\n\t\t\t\tthis.emit('tooltips:leave', target, tip, event);\n\t\t\t},\n\n\t\t\tonHide: destroy\n\t\t});\n\n\t\tpopup._enter(target);\n\t}\n\n\n\tonProviderChange(key: string) {\n\t\tif ( key === 'overrides.colors' && this.color_cache )\n\t\t\tthis.loadColors();\n\t\telse if ( key === 'overrides.names' && this.name_cache )\n\t\t\tthis.loadNames();\n\t}\n\n\tget colors() {\n\t\treturn this.color_cache ?? this.loadColors();\n\t}\n\n\tget names() {\n\t\treturn this.name_cache ?? this.loadNames();\n\t}\n\n\tloadColors() {\n\t\tlet old_keys: Set<string>,\n\t\t\tloaded = true;\n\n\t\tif ( ! this.color_cache ) {\n\t\t\tloaded = false;\n\t\t\tthis.color_cache = {};\n\t\t\told_keys = new Set;\n\t\t} else\n\t\t\told_keys = new Set(Object.keys(this.color_cache));\n\n\t\tconst entries = this.settings.provider.get('overrides.colors');\n\t\tif ( entries )\n\t\t\tfor(const [key, val] of Object.entries(entries)) {\n\t\t\t\told_keys.delete(key);\n\t\t\t\tif ( this.color_cache[key] !== val ) {\n\t\t\t\t\tthis.color_cache[key] = val;\n\t\t\t\t\tif ( loaded )\n\t\t\t\t\t\tthis.emit(':changed', key, 'color', val);\n\t\t\t\t}\n\t\t\t}\n\n\t\tfor(const key of old_keys) {\n\t\t\tthis.color_cache[key] = undefined;\n\t\t\tif ( loaded )\n\t\t\t\tthis.emit(':changed', key, 'color', undefined);\n\t\t}\n\n\t\treturn this.color_cache;\n\t}\n\n\tloadNames() {\n\t\tlet old_keys: Set<string>,\n\t\t\tloaded = true;\n\t\tif ( ! this.name_cache ) {\n\t\t\tloaded = false;\n\t\t\tthis.name_cache = {};\n\t\t\told_keys = new Set;\n\t\t} else\n\t\t\told_keys = new Set(Object.keys(this.name_cache));\n\n\t\tconst entries = this.settings.provider.get('overrides.names');\n\t\tif ( entries )\n\t\t\tfor(const [key, val] of Object.entries(entries)) {\n\t\t\t\told_keys.delete(key);\n\t\t\t\tif ( this.name_cache[key] !== val ) {\n\t\t\t\t\tthis.name_cache[key] = val;\n\t\t\t\t\tif ( loaded )\n\t\t\t\t\t\tthis.emit(':changed', key, 'name', val);\n\t\t\t\t}\n\t\t\t}\n\n\t\tfor(const key of old_keys) {\n\t\t\tthis.name_cache[key] = undefined;\n\t\t\tif ( loaded )\n\t\t\t\tthis.emit(':changed', key, 'name', undefined);\n\t\t}\n\n\t\treturn this.name_cache;\n\t}\n\n\tgetColor(id: string): string | null {\n\t\treturn this.colors[id] ?? null;\n\t}\n\n\tgetName(id: string) {\n\t\treturn this.names[id] ?? null;\n\t}\n\n\tsetColor(id: string, color?: string) {\n\t\tif ( this.colors[id] !== color ) {\n\t\t\tthis.colors[id] = color;\n\t\t\tthis.settings.provider.set('overrides.colors', this.colors);\n\t\t\tthis.emit(':changed', id, 'color', color);\n\t\t}\n\t}\n\n\tsetName(id: string, name?: string) {\n\t\tif ( this.names[id] !== name ) {\n\t\t\tthis.names[id] = name;\n\t\t\tthis.settings.provider.set('overrides.names', this.names);\n\t\t\tthis.emit(':changed', id, 'name', name);\n\t\t}\n\t}\n\n\tdeleteColor(id: string) {\n\t\tthis.setColor(id, undefined);\n\t}\n\n\tdeleteName(id: string) {\n\t\tthis.setName(id, undefined);\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// User\n// ============================================================================\n\nimport {SourcedSet} from 'utilities/object';\nimport type Chat from '.';\nimport type Room from './room';\nimport type { BadgeAssignment } from './types';\n\nexport default class User {\n\n\t// Parent\n\tmanager: Chat;\n\troom: Room | null;\n\n\t// State\n\tdestroyed: boolean = false;\n\n\t_id: string | null;\n\t_login: string | null = null;\n\n\t// Storage\n\temote_sets: SourcedSet<string> | null;\n\tbadges: SourcedSet<BadgeAssignment> | null;\n\n\n\tconstructor(manager: Chat, room: Room | null, id: string | null, login: string | null) {\n\t\tthis.manager = manager;\n\t\tthis.room = room;\n\n\t\tthis.emote_sets = null;\n\t\tthis.badges = null;\n\n\t\tthis._id = id;\n\t\tthis.login = login;\n\n\t\tif ( id )\n\t\t\t(room ?? manager).user_ids[id] = this;\n\t}\n\n\tdestroy() {\n\t\tthis.destroyed = true;\n\n\t\tif ( this.emote_sets ) {\n\t\t\tfor(const set_id of this.emote_sets._cache)\n\t\t\t\tthis.manager.emotes.unrefSet(set_id);\n\n\t\t\tthis.emote_sets = null;\n\t\t}\n\n\t\t// Badges are not referenced, so we can just dump them all.\n\t\tif ( this.badges )\n\t\t\tthis.badges = null;\n\n\t\tconst parent = this.room || this.manager;\n\n\t\tif ( parent ) {\n\t\t\tif ( this._login && parent.users && parent.users[this._login] === this )\n\t\t\t\tparent.users[this._login] = null;\n\n\t\t\tif ( parent.user_ids && parent.user_ids[this._id] === this )\n\t\t\t\tparent.user_ids[this._id] = null;\n\t\t}\n\t}\n\n\tmerge(other: User) {\n\t\tif ( ! this.login && other.login )\n\t\t\tthis.login = other.login;\n\n\t\tif ( other.emote_sets )\n\t\t\tfor(const [provider, sets] of other.emote_sets.iterateSources()) {\n\t\t\t\tfor(const set_id of sets)\n\t\t\t\t\tthis.addSet(provider, set_id);\n\t\t\t}\n\n\t\tif ( other.badges )\n\t\t\tfor(const [provider, badges] of other.badges.iterateSources()) {\n\t\t\t\tfor(const badge of badges)\n\t\t\t\t\tthis.addBadge(provider, badge.id, badge);\n\t\t\t}\n\t}\n\n\t_unloadAddon(addon_id: string) {\n\t\t// TODO: This\n\t\treturn 0;\n\t}\n\n\tget id() {\n\t\treturn this._id;\n\t}\n\n\tget login() {\n\t\treturn this._login;\n\t}\n\n\tset login(val) {\n\t\tif ( this._login === val )\n\t\t\treturn;\n\n\t\tconst obj = this.room || this.manager;\n\n\t\tif ( this._login ) {\n\t\t\tconst old_user = obj.users[this._login];\n\t\t\tif ( old_user === this )\n\t\t\t\tobj.users[this._login] = null;\n\t\t}\n\n\t\tthis._login = val;\n\t\tif ( ! val )\n\t\t\treturn;\n\n\t\tconst old_user = obj.users[val];\n\t\tif ( old_user && old_user !== this )\n\t\t\told_user.login = null;\n\n\t\t// Make sure we didn't have a funky loop thing happen.\n\t\tthis._login = val;\n\t\tobj.users[val] = this;\n\t}\n\n\n\t// ========================================================================\n\t// Add Badges\n\t// ========================================================================\n\n\taddBadge(provider: string, badge_id: string, data?: BadgeAssignment) {\n\t\tif ( this.destroyed )\n\t\t\treturn false;\n\n\t\tif ( typeof badge_id === 'number' )\n\t\t\tbadge_id = `${badge_id}`;\n\n\t\tif ( data )\n\t\t\tdata.id = badge_id;\n\t\telse\n\t\t\tdata = {id: badge_id};\n\n\t\tif ( ! this.badges )\n\t\t\tthis.badges = new SourcedSet(false, this.manager.emotes.sourceSortFn);\n\n\t\tconst existing = this.badges.get(provider);\n\t\tif ( existing )\n\t\t\tfor(const old_b of existing)\n\t\t\t\tif ( old_b.id == badge_id ) {\n\t\t\t\t\tObject.assign(old_b, data);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\tthis.badges.push(provider, data);\n\t\t//this.manager.badges.refBadge(badge_id);\n\t\treturn true;\n\t}\n\n\n\tgetBadges() {\n\t\tif ( this.badges )\n\t\t\treturn [...this.badges._cache];\n\t\treturn [];\n\t}\n\n\n\tgetBadge(badge_id: string) {\n\t\tif ( this.badges )\n\t\t\tfor(const badge of this.badges._cache)\n\t\t\t\tif ( badge.id == badge_id )\n\t\t\t\t\treturn badge;\n\n\t\treturn null;\n\t}\n\n\n\tremoveBadge(provider: string, badge_id: string) {\n\t\tif ( ! this.badges )\n\t\t\treturn false;\n\n\t\tconst existing = this.badges.get(provider);\n\t\tif ( existing )\n\t\t\tfor(const old_b of existing)\n\t\t\t\tif ( old_b.id == badge_id ) {\n\t\t\t\t\tthis.badges.remove(provider, old_b);\n\t\t\t\t\t//this.manager.badges.unrefBadge(badge_id);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\treturn false;\n\t}\n\n\n\tremoveAllBadges(provider: string) {\n\t\tif ( ! this.badges )\n\t\t\treturn false;\n\n\t\tif ( ! this.badges.has(provider) )\n\t\t\treturn false;\n\n\t\t// Just yeet them all since we don't ref badges.\n\t\tthis.badges.delete(provider);\n\t\treturn true;\n\t}\n\n\n\t// ========================================================================\n\t// Emote Sets\n\t// ========================================================================\n\n\taddSet(provider: string, set_id: string, data?: unknown) {\n\t\tif ( this.destroyed )\n\t\t\treturn;\n\n\t\tif ( ! this.emote_sets )\n\t\t\tthis.emote_sets = new SourcedSet;\n\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tlet changed = false, added = false;\n\t\tif ( ! this.emote_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tchanged = ! this.emote_sets.includes(set_id);\n\t\t\tthis.emote_sets.push(provider, set_id);\n\t\t\tadded = true;\n\t\t}\n\n\t\tif ( data )\n\t\t\tthis.manager.emotes.loadSetData(set_id, data);\n\n\t\tif ( changed ) {\n\t\t\tthis.manager.emotes.refSet(set_id);\n\t\t\tthis.manager.emotes.emit(':update-user-sets', this, provider, set_id, true);\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tremoveAllSets(provider: string) {\n\t\tif ( ! this.emote_sets )\n\t\t\treturn false;\n\n\t\tconst sets = this.emote_sets.get(provider);\n\t\tif ( ! Array.isArray(sets) || ! sets.length )\n\t\t\treturn false;\n\n\t\tfor(const set_id of sets)\n\t\t\tthis.removeSet(provider, set_id);\n\n\t\treturn true;\n\t}\n\n\tremoveSet(provider: string, set_id: string) {\n\t\tif ( ! this.emote_sets )\n\t\t\treturn;\n\n\t\tif ( typeof set_id === 'number' )\n\t\t\tset_id = `${set_id}`;\n\n\t\tif ( this.emote_sets.sourceIncludes(provider, set_id) ) {\n\t\t\tthis.emote_sets.remove(provider, set_id);\n\t\t\tif ( ! this.emote_sets.includes(set_id) ) {\n\t\t\t\tthis.manager.emotes.unrefSet(set_id);\n\t\t\t\tthis.manager.emotes.emit(':update-user-sets', this, provider, set_id, false);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","\n// ============================================================================\n// Channel Metadata\n// ============================================================================\n\nimport { DEBUG } from 'utilities/constants';\n\nimport {createElement, ClickOutside, setChildren} from 'utilities/dom';\nimport {maybe_call} from 'utilities/object';\n\nimport Module, { buildAddonProxy, GenericModule } from 'utilities/module';\nimport {duration_to_string, durationForURL} from 'utilities/time';\nimport Tooltip, { TooltipInstance } from 'utilities/tooltip';\nimport type { AddonInfo, DomFragment, OptionallyThisCallable, OptionalPromise } from 'utilities/types';\n\nimport type SettingsManager from '../settings';\nimport type TranslationManager from '../i18n';\nimport type TooltipProvider from './tooltips';\nimport type SocketClient from '../socket';\n\nconst CLIP_URL = /^https:\\/\\/[^/]+\\.(?:twitch\\.tv|twitchcdn\\.net)\\/.+?\\.mp4(?:\\?.*)?$/;\n\ndeclare global {\n\tinterface Element {\n\t\t_ffz_stat?: HTMLElement | null;\n\t\t_ffz_data?: any;\n\t\t_ffz_order?: number | null;\n\n\t\t_ffz_destroy?: (() => void) | null;\n\t\t_ffz_outside?: ClickOutside<any> | null;\n\t\t_ffz_popup?: Tooltip | null;\n\t\ttip?: TooltipInstance | null;\n\t\ttip_content?: any;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\tmetadata: Metadata\n\t}\n\tinterface SettingsTypeMap {\n\t\t'metadata.clip-download': boolean;\n\t\t'metadata.clip-download.force': boolean;\n\t\t'metadata.player-stats': boolean;\n\t\t'metadata.uptime': number;\n\t\t'metadata.stream-delay-warning': number;\n\t\t'metadata.viewers': boolean;\n\t}\n}\n\n\nexport type MetadataState = {\n\t/** Whether or not the metadata is being rendered onto the player directly. */\n\tis_player: boolean;\n\n\t/** The current channel. */\n\tchannel: {\n\t\t/** The channel's user ID. */\n\t\tid: string;\n\t\t/** The channel's login name. */\n\t\tlogin: string;\n\t\t/** The channel's display name. */\n\t\tdisplay_name: string;\n\t\t/** Whether or not the channel is currently displaying a video. */\n\t\tvideo: boolean;\n\t\t/** Whether or not the channel is currently live. */\n\t\tlive: boolean;\n\t\t/** When the channel went live, if it is currently live. */\n\t\tlive_since: string | Date;\n\t};\n\n\t/** Get the current number of viewers watching the current channel. */\n\tgetViewerCount: () => number;\n\n\t/** Get the broadcast ID of the current live broadcast, assuming the current channel is live. */\n\tgetBroadcastID: () => Promise<string | null> | null;\n\n\t/** Get the currently logged in user's relationship with the current channel. */\n\t// TODO: Types\n\tgetUserSelf: () => Promise<any>;\n\n\t/**\n\t * Get the currently logged in user's relationship with the current\n\t * channel, immediately. When data loads, if it is not already available\n\t * at the time of the call, and a callback method is provided, the\n\t * callback method will be called with the data.\n\t */\n\t// TODO: Types\n\tgetUserSelfImmediate: (callback?: (data: any) => void) => any | null;\n\n\t/** A method that, when called, will trigger the metadata element to be refreshed. */\n\trefresh: () => void;\n\n}\n\n\ntype OptionallyCallable<TData, TReturn> = OptionallyThisCallable<Metadata, [data: TData], TReturn>;\n\n\n/**\n * A metadata definition contains all the information that FrankerFaceZ\n * needs in order to render a player metadata element. This includes special\n * data processing, how often to refresh, behavior when interacted with,\n * and various appearance options.\n */\nexport type MetadataDefinition<TData = MetadataState> = {\n\n\t// Targets\n\tmodview?: boolean;\n\tplayer?: boolean;\n\n\t// Behavior\n\n\t/**\n\t * Optional. If present, this setup method will be called whenever\n\t * processing this metadata element in order to transform its data\n\t * into a prefered format.\n\t */\n\tsetup?: (this: Metadata, data: MetadataState) => OptionalPromise<TData>;\n\n\t/**\n\t * Optional. Whether or not this metadata element should refresh itself\n\t * periodically. This can be a specific amount of time, in milliseconds,\n\t * after which the element should be refreshed or `true` to refresh\n\t * after 1 second.\n\t *\n\t * Note: Your metadata might not refresh after the exact length, as\n\t * the metadata manager will attempt to optimize rendering performance\n\t * by using animation frames and batching.\n\t */\n\trefresh?: OptionallyCallable<TData, boolean | number>;\n\n\t/**\n\t * Optional. A click handler for the metadata element.\n\t * @param data Your state, as returned from {@link setup}\n\t * @param event The {@link MouseEvent} being handled.\n\t * @param refresh A method that, when called, manually refreshes\n\t * your metadata.\n\t */\n\tclick?: (this: Metadata, data: TData, event: MouseEvent, refresh: () => void) => void;\n\n\t/**\n\t * Optional. If this returns true, interactions with your metadata\n\t * element will be disabled and the element may appear with a visual\n\t * disabled state.\n\t */\n\tdisabled?: OptionallyCallable<TData, boolean>;\n\n\t// Appearance\n\n\t/**\n\t * The label for this metadata element. If no label is returned, the\n\t * metadata element will not be displayed. This should be a\n\t * human-readable string.\n\t */\n\tlabel: OptionallyCallable<TData, DomFragment>;\n\n\ttooltip?: OptionallyCallable<TData, DomFragment>;\n\n\t/**\n\t * Optional. What order this metadata element should be displayed in.\n\t * This uses CSS's flexbox's order property to adjust the visible\n\t * position of each metadata element.\n\t */\n\torder?: OptionallyCallable<TData, number>;\n\n\t/**\n\t * Optional. The color that the metadata element's label should be. If\n\t * this is not set, the default text color will be used.\n\t */\n\tcolor?: OptionallyCallable<TData, string | null | undefined>;\n\n\t/**\n\t * Optional. An icon to be displayed\n\t */\n\ticon?: OptionallyCallable<TData, DomFragment>;\n\n\t// Button Appearance\n\n\t/**\n\t * Optional. Whether or not this metadata element should be displayed\n\t * with a button style. By default, elements are displayed with a button\n\t * style if they have a {@link popup} or {@link click} behavior defined.\n\t *\n\t * You can override the appearance using this value.\n\t */\n\tbutton?: boolean;\n\n\tborder?: OptionallyCallable<TData, boolean>;\n\n\tinherit?: OptionallyCallable<TData, boolean>;\n\n\t// Popup Appearance and Behavior\n\n\t/**\n\t * Optional. When this is true, an arrow element will not be created\n\t * when building a popup for this metadata element.\n\t */\n\tno_arrow?: boolean;\n\n\tpopup?: (this: Metadata, data: TData, tip: TooltipInstance, refresh: () => void, addCloseListener: (callback: () => void) => void) => void;\n\n\n\t/**\n\t * The source that added this metadata definition. This will be unset\n\t * if the metadata was added by FrankerFaceZ, or contain the add-on ID\n\t * of an add-on.\n\t */\n\t__source?: string;\n\n}\n\n/**\n * @noInheritDoc\n */\nexport default class Metadata extends Module {\n\n\tdefinitions: Record<string, MetadataDefinition<any> | null | undefined>;\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\ti18n: TranslationManager = null as any;\n\ttooltips: TooltipProvider = null as any;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('tooltips');\n\n\t\tthis.should_enable = true;\n\t\tthis.definitions = {};\n\n\t\tthis.settings.add('metadata.clip-download', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Clips',\n\t\t\t\ttitle: 'Add a Download button for editors to clip pages.',\n\t\t\t\tdescription: 'This adds a download button beneath the player on clip pages (the main site, not on `clips.twitch.tv`) for broadcasters and their editors.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updateMetadata('clip-download')\n\t\t});\n\n\t\tthis.settings.add('metadata.player-stats', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Player',\n\t\t\t\ttitle: 'Playback Statistics',\n\t\t\t\tdescription: 'Show the current stream delay, with playback rate and dropped frames in the tooltip.',\n\t\t\t\tcomponent: 'setting-check-box',\n\n\t\t\t\tgetExtraTerms: () => ([\n\t\t\t\t\t'latency',\n\t\t\t\t\t'bitrate'\n\t\t\t\t])\n\t\t\t},\n\n\t\t\tchanged: () => this.updateMetadata('player-stats')\n\t\t});\n\n\t\tthis.settings.add('metadata.stream-delay-warning', {\n\t\t\tdefault: 0,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Player',\n\t\t\t\ttitle: 'Stream Delay Warning',\n\t\t\t\tdescription: 'When the current stream delay exceeds this number of seconds, display the stream delay in a warning color to draw attention to the large delay. Set to zero to disable.',\n\n\t\t\t\tcomponent: 'setting-text-box',\n\t\t\t\tprocess: 'to_float',\n\t\t\t\tbounds: [0, true]\n\t\t\t}\n\t\t});\n\n\t\tthis.settings.add('metadata.uptime', {\n\t\t\tdefault: 2,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Player',\n\t\t\t\ttitle: 'Stream Uptime',\n\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [\n\t\t\t\t\t{value: 0, title: 'Disabled'},\n\t\t\t\t\t{value: 1, title: 'Enabled'},\n\t\t\t\t\t{value: 2, title: 'Enabled (with Seconds)'}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: () => this.updateMetadata('uptime')\n\t\t});\n\n\t\tthis.settings.add('metadata.viewers', {\n\t\t\tdefault: false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Player',\n\t\t\t\ttitle: 'Alternative Viewer Count',\n\t\t\t\tdescription: \"This displays the current channel's viewer count without an animation when it changes.\",\n\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.updateMetadata('viewers')\n\t\t});\n\n\n\t\tthis.define('viewers', {\n\n\t\t\trefresh() { return this.settings.get('metadata.viewers') },\n\n\t\t\tsetup(data) {\n\t\t\t\treturn {\n\t\t\t\t\tlive: data.channel?.live && data.channel?.live_since != null,\n\t\t\t\t\tcount: data.getViewerCount()\n\t\t\t\t}\n\t\t\t},\n\n\t\t\torder: 1,\n\t\t\ticon: 'ffz-i-viewers',\n\n\t\t\tlabel(data) {\n\t\t\t\tif ( ! this.settings.get('metadata.viewers') || ! data.live )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn this.i18n.formatNumber(data.count)\n\t\t\t},\n\n\t\t\ttooltip() {\n\t\t\t\treturn this.i18n.t('metadata.viewers', 'Viewer Count');\n\t\t\t},\n\n\t\t\tcolor: 'var(--color-text-live)'\n\n\t\t});\n\n\n\t\tthis.define('uptime', {\n\t\t\tinherit: true,\n\t\t\tno_arrow: true,\n\t\t\tplayer: true,\n\n\t\t\trefresh() { return this.settings.get('metadata.uptime') > 0 },\n\n\t\t\tsetup(data) {\n\t\t\t\tlet created = data?.channel?.live_since;\n\t\t\t\tif ( ! created )\n\t\t\t\t\t\treturn null;\n\n\t\t\t\tif ( !(created instanceof Date) )\n\t\t\t\t\tcreated = new Date(created);\n\n\t\t\t\tconst socket = this.resolve('socket');\n\t\t\t\tconst now = Date.now() - (socket?._time_drift ?? 0);\n\n\t\t\t\treturn {\n\t\t\t\t\tcreated,\n\t\t\t\t\tuptime: created ? Math.floor((now - created.getTime()) / 1000) : -1,\n\t\t\t\t\tgetBroadcastID: data.getBroadcastID\n\t\t\t\t}\n\t\t\t},\n\n\t\t\torder: 2,\n\t\t\ticon: 'ffz-i-clock',\n\n\t\t\tlabel(data) {\n\t\t\t\tconst setting = this.settings.get('metadata.uptime');\n\t\t\t\tif ( ! setting || ! data?.created )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn duration_to_string(data.uptime, false, false, false, setting !== 2);\n\t\t\t},\n\n\t\t\ttooltip(data) {\n\t\t\t\tif ( ! data?.created )\n\t\t\t\t\treturn null;\n\n\t\t\t\treturn [\n\t\t\t\t\tthis.i18n.t(\n\t\t\t\t\t\t'metadata.uptime.tooltip',\n\t\t\t\t\t\t'Stream Uptime'\n\t\t\t\t\t),\n\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t\t'metadata.uptime.since',\n\t\t\t\t\t\t\t'(since {since,datetime})',\n\t\t\t\t\t\t\t{since: data.created}\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t];\n\t\t\t},\n\n\t\t\tasync popup(data, tip) {\n\t\t\t\tif ( ! data )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst [permission, broadcast_id] = await Promise.all([\n\t\t\t\t\t// We need the as any here because TypeScript's devs don't\n\t\t\t\t\t// live with the rest of us in the real world.\n\t\t\t\t\tnavigator?.permissions?.query?.({name: 'clipboard-write' as PermissionName}).then(perm => perm?.state).catch(() => null),\n\t\t\t\t\tdata.getBroadcastID()?.catch(err => null)\n\t\t\t\t]);\n\t\t\t\tif ( ! broadcast_id )\n\t\t\t\t\treturn (<div>\n\t\t\t\t\t\t{ this.i18n.t('metadata.uptime-no-id', 'Sorry, we couldn\\'t find an archived video for the current broadcast.') }\n\t\t\t\t\t</div>);\n\n\t\t\t\tconst url = `https://www.twitch.tv/videos/${broadcast_id}${data.uptime > 0 ? `?t=${durationForURL(data.uptime)}` : ''}`,\n\t\t\t\t\tcan_copy = permission === 'granted' || permission === 'prompt';\n\n\t\t\t\tconst copy = can_copy ? (event: MouseEvent) => {\n\t\t\t\t\tnavigator.clipboard.writeText(url);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t} : null;\n\n\t\t\t\ttip.element?.classList.add('ffz-balloon--lg');\n\n\t\t\t\treturn (<div>\n\t\t\t\t\t<div class=\"tw-pd-b-1 tw-mg-b-1 tw-border-b tw-semibold\">\n\t\t\t\t\t\t{ this.i18n.t('metadata.uptime.link-to', 'Link to {time}', {\n\t\t\t\t\t\t\ttime: duration_to_string(data.uptime, false, false, false, false)\n\t\t\t\t\t\t}) }\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tw-flex tw-align-items-center\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass=\"tw-border-radius-medium tw-font-size-6 tw-pd-x-1 tw-pd-y-05 ffz-input tw-full-width\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tvalue={url}\n\t\t\t\t\t\t\tonFocus={(e: FocusEvent) => (e.target as HTMLInputElement)?.select()}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{can_copy && <div class=\"tw-relative ffz-il-tooltip__container tw-mg-l-1\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative\"\n\t\t\t\t\t\t\t\taria-label={ this.i18n.t('metadata.uptime.copy', 'Copy to Clipboard') }\n\t\t\t\t\t\t\t\tonClick={copy}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0\">\n\t\t\t\t\t\t\t\t\t<span class=\"tw-button-icon__icon\">\n\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-docs\" />\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div class=\"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up\">\n\t\t\t\t\t\t\t\t{ this.i18n.t('metadata.uptime.copy', 'Copy to Clipboard') }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>}\n\t\t\t\t\t</div>\n\t\t\t\t</div>);\n\t\t\t}\n\t\t});\n\n\t\tthis.define('clip-download', {\n\t\t\tbutton: true,\n\t\t\tinherit: true,\n\n\t\t\tsetup(data) {\n\t\t\t\tif ( ! this.settings.get('metadata.clip-download') )\n\t\t\t\t\treturn;\n\n\t\t\t\t// TODO: Types\n\t\t\t\tconst Player = this.resolve('site.player') as any,\n\t\t\t\t\tplayer = Player.current;\n\t\t\t\tif ( ! player )\n\t\t\t\t\treturn;\n\n\t\t\t\tconst sink = player.mediaSinkManager || player.core?.mediaSinkManager,\n\t\t\t\t\tsrc = sink?.video?.src;\n\n\t\t\t\tif ( ! src || ! CLIP_URL.test(src) )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( this.settings.get('metadata.clip-download.force') )\n\t\t\t\t\treturn src as string;\n\n\t\t\t\t// TODO: Types\n\t\t\t\tconst user = (this.resolve('site') as any).getUser?.(),\n\t\t\t\t\tis_self = user?.id == data.channel.id;\n\n\t\t\t\tif ( is_self || data.getUserSelfImmediate(data.refresh)?.isEditor )\n\t\t\t\t\treturn src as string;\n\t\t\t},\n\n\t\t\tlabel(src) {\n\t\t\t\tif ( src )\n\t\t\t\t\treturn this.i18n.t('metadata.clip-download', 'Download');\n\t\t\t},\n\n\t\t\ticon: 'ffz-i-download',\n\n\t\t\tclick(src) {\n\t\t\t\tconst title = this.settings.get('context.title') || 'Untitled';\n\t\t\t\tconst name = title.replace(/[\\\\/:\"*?<>|]+/, '_') + '.mp4';\n\n\t\t\t\tconst link = createElement('a', {\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t\tdownload: name,\n\t\t\t\t\thref: src,\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tdisplay: 'none'\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdocument.body.appendChild(link);\n\t\t\t\tlink.click();\n\t\t\t\tlink.remove();\n\t\t\t}\n\t\t});\n\n\t\tthis.define('player-stats', {\n\t\t\tbutton: true,\n\t\t\tinherit: true,\n\t\t\tmodview: true,\n\t\t\tplayer: true,\n\n\t\t\trefresh() {\n\t\t\t\treturn this.settings.get('metadata.player-stats')\n\t\t\t},\n\n\t\t\tsetup(data) {\n\t\t\t\tconst Player = this.resolve('site.player') as any,\n\t\t\t\t\tsocket = this.resolve('socket') as SocketClient,\n\t\t\t\t\tplayer = Player.current;\n\n\t\t\t\tlet stats;\n\n\t\t\t\tif ( ! player )\n\t\t\t\t\tstats = null;\n\n\t\t\t\telse if ( typeof player.getPlaybackStats === 'function' ) {\n\t\t\t\t\tstats = player.getPlaybackStats();\n\n\t\t\t\t} else if ( typeof player.getVideoInfo === 'function' ) {\n\t\t\t\t\tconst temp = player.getVideoInfo();\n\t\t\t\t\tstats = {\n\t\t\t\t\t\tbackendVersion: maybe_call(player.getVersion, player),\n\t\t\t\t\t\tbufferSize: temp.video_buffer_size,\n\t\t\t\t\t\tdisplayResolution: `${temp.vid_display_width}x${temp.vid_display_height}`,\n\t\t\t\t\t\tfps: temp.current_fps,\n\t\t\t\t\t\thlsLatencyBroadcaster: temp.hls_latency_broadcaster / 1000,\n\t\t\t\t\t\thlsLatencyEncoder: temp.hls_latency_encoder / 1000,\n\t\t\t\t\t\tmemoryUsage: `${temp.totalMemoryNumber} MB`,\n\t\t\t\t\t\trate: maybe_call(player.getPlaybackRate, player) || 1,\n\t\t\t\t\t\tplaybackRate: temp.current_bitrate,\n\t\t\t\t\t\tskippedFrames: temp.dropped_frames,\n\t\t\t\t\t\tvideoResolution: `${temp.vid_width}x${temp.vid_height}`\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst videoHeight = maybe_call(player.getVideoHeight, player) || 0,\n\t\t\t\t\t\tvideoWidth = maybe_call(player.getVideoWidth, player) || 0,\n\t\t\t\t\t\tdisplayHeight = maybe_call(player.getDisplayHeight, player) || 0,\n\t\t\t\t\t\tdisplayWidth = maybe_call(player.getDisplayWidth, player) || 0;\n\n\t\t\t\t\tstats = {\n\t\t\t\t\t\tbackendVersion: maybe_call(player.getVersion, player),\n\t\t\t\t\t\tbufferSize: maybe_call(player.getBufferDuration, player),\n\t\t\t\t\t\tdisplayResolution: `${displayWidth}x${displayHeight}`,\n\t\t\t\t\t\tvideoResolution: `${videoWidth}x${videoHeight}`,\n\t\t\t\t\t\tvideoHeight,\n\t\t\t\t\t\tvideoWidth,\n\t\t\t\t\t\tdisplayHeight,\n\t\t\t\t\t\tdisplayWidth,\n\t\t\t\t\t\trate: maybe_call(player.getPlaybackRate, player),\n\t\t\t\t\t\tfps: Math.floor(maybe_call(player.getVideoFrameRate, player) || 0),\n\t\t\t\t\t\thlsLatencyBroadcaster: maybe_call(player.getLiveLatency, player) || 0,\n\t\t\t\t\t\t//hlsLatencyBroadcaster: player.stats?.broadcasterLatency || player.core?.stats?.broadcasterLatency,\n\t\t\t\t\t\t//hlsLatencyEncoder: player.stats?.transcoderLatency || player.core?.stats?.transcoderLatency,\n\t\t\t\t\t\tplaybackRate: Math.floor((maybe_call(player.getVideoBitRate, player) || 0) / 1000),\n\t\t\t\t\t\tskippedFrames: maybe_call(player.getDroppedFrames, player),\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get the video element.\n\t\t\t\tif ( stats ) {\n\t\t\t\t\tconst video = player && maybe_call(player.getHTMLVideoElement, player);\n\t\t\t\t\tstats.avOffset = 0;\n\t\t\t\t\tif ( video?._ffz_context )\n\t\t\t\t\t\tstats.avOffset = (video._ffz_context_offset ?? 0) + video._ffz_context.currentTime - video.currentTime;\n\t\t\t\t}\n\n\t\t\t\tlet tampered = false;\n\t\t\t\ttry {\n\t\t\t\t\tconst url = player.core.state.path;\n\t\t\t\t\tif ( url.includes('/api/channel/hls/') ) {\n\t\t\t\t\t\tconst data = JSON.parse(new URL(url).searchParams.get('token') as string);\n\t\t\t\t\t\ttampered = data && data.player_type && data.player_type !== 'site' ? data.player_type : false;\n\t\t\t\t\t}\n\t\t\t\t} catch(err) { /* no op */ }\n\n\t\t\t\tif ( ! stats || stats.hlsLatencyBroadcaster < -100 )\n\t\t\t\t\treturn null;\n\n\t\t\t\tlet drift = 0;\n\n\t\t\t\tif ( socket && socket.connected )\n\t\t\t\t\tdrift = socket._time_drift;\n\n\t\t\t\treturn {\n\t\t\t\t\tis_player: data.is_player,\n\t\t\t\t\tstats,\n\t\t\t\t\tdrift,\n\t\t\t\t\trate: stats.rate == null ? 1 : stats.rate,\n\t\t\t\t\tdelay: stats.hlsLatencyBroadcaster,\n\t\t\t\t\told: stats.hlsLatencyBroadcaster > 180,\n\t\t\t\t\ttampered\n\t\t\t\t}\n\t\t\t},\n\n\t\t\torder: 3,\n\n\t\t\ticon(data) {\n\t\t\t\tif ( data?.rate > 1 )\n\t\t\t\t\treturn 'ffz-i-fast-fw';\n\n\t\t\t\treturn 'ffz-i-gauge'\n\t\t\t},\n\n\t\t\tlabel(data) {\n\t\t\t\tif ( ! this.settings.get('metadata.player-stats') || ! data?.delay )\n\t\t\t\t\treturn null;\n\n\t\t\t\tif ( data.old )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst delayed = data.drift > 5000 ? '(!) ' : '';\n\n\t\t\t\tif ( data.old )\n\t\t\t\t\treturn `${delayed}${data.delay.toFixed(2)}s old`;\n\t\t\t\telse\n\t\t\t\t\treturn `${delayed}${data.delay.toFixed(2)}s`;\n\t\t\t},\n\n\t\t\tclick() {\n\t\t\t\tconst Player = this.resolve('site.player') as any,\n\t\t\t\t\tfine = this.resolve('site.fine') as any,\n\t\t\t\t\tplayer = Player.Player?.first,\n\t\t\t\t\tinst = fine && player && fine.searchTree(player, (n: any) => n.props?.setStatsOverlay, 200),\n\t\t\t\t\tcont = inst && fine.getChildNode(player),\n\t\t\t\t\tel = cont && cont.querySelector('[data-a-target=\"player-overlay-video-stats\"]');\n\n\t\t\t\tif ( ! inst )\n\t\t\t\t\treturn;\n\n\t\t\t\tinst.props.setStatsOverlay(el ? 0 : 1);\n\t\t\t},\n\n\t\t\t/*click() {\n\t\t\t\tconst Player = this.resolve('site.player'),\n\t\t\t\t\tui = Player.playerUI;\n\n\t\t\t\tif ( ! ui )\n\t\t\t\t\treturn;\n\n\t\t\t\tui.setStatsOverlay(ui.statsOverlay === 1 ? 0 : 1);\n\t\t\t},*/\n\n\t\t\tcolor(data) {\n\t\t\t\tconst setting = this.settings.get('metadata.stream-delay-warning');\n\t\t\t\tif ( setting === 0 || ! data?.delay || data.old )\n\t\t\t\t\treturn;\n\n\t\t\t\tif ( data.delay > (setting * 2) )\n\t\t\t\t\treturn data.is_player ? '#f9b6b6' : '#ec1313';\n\n\t\t\t\telse if ( data.delay > setting )\n\t\t\t\t\treturn data.is_player ? '#fcb896' : '#fc7835';\n\t\t\t},\n\n\t\t\ttooltip(data) {\n\t\t\t\tif ( ! data )\n\t\t\t\t\treturn null;\n\n\t\t\t\tconst tampered = data.tampered ? (<div class=\"tw-border-t tw-mg-t-05 tw-pd-t-05\">\n\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.tampered',\n\t\t\t\t\t\t'Your player has an unexpected player type ({type}), which may affect your viewing experience.',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: data.tampered\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\n\t\t\t\t</div>) : null;\n\n\t\t\t\tconst delayed = data.drift > 5000 ? (<div class=\"tw-border-b tw-mg-b-05 tw-pd-b-05\">\n\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.delay-warning',\n\t\t\t\t\t\t'Your local clock seems to be off by roughly {count,number} seconds, which could make this inaccurate.',\n\t\t\t\t\t\tMath.round(data.drift / 10) / 100\n\t\t\t\t\t)}\n\t\t\t\t</div>) : null;\n\n\t\t\t\tconst ff = data.rate > 1 ? (<div class=\"tw-border-b tw-mg-b-05 tw-pd-b-05\">\n\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.rate-warning',\n\t\t\t\t\t\t'Playing at {rate,number}x speed to reduce delay.',\n\t\t\t\t\t\t{rate: data.rate.toFixed(2)}\n\t\t\t\t\t)}\n\t\t\t\t</div>) : null;\n\n\t\t\t\tif ( ! data.stats || ! data.delay )\n\t\t\t\t\treturn [\n\t\t\t\t\t\tdelayed,\n\t\t\t\t\t\tff,\n\t\t\t\t\t\tthis.i18n.t('metadata.player-stats.latency-tip', 'Stream Latency'),\n\t\t\t\t\t\ttampered\n\t\t\t\t\t];\n\n\t\t\t\tconst stats = data.stats,\n\t\t\t\t\tvideo_info = this.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.video-info',\n\t\t\t\t\t\t'Video: {videoResolution}p{fps}\\nPlayback Rate: {playbackRate, number} Kbps\\nDropped Frames: {skippedFrames, number}',\n\t\t\t\t\t\tstats\n\t\t\t\t\t);\n\n\t\t\t\tconst desync = /*data.avOffset !== 0\n\t\t\t\t\t\t? (<div>{this.i18n.t(\n\t\t\t\t\t\t\t'metadata.player-stats.av-offset',\n\t\t\t\t\t\t\t'A/V Offset: {avOffset, number} seconds',\n\t\t\t\t\t\t\tstats\n\t\t\t\t\t\t)}</div>)\n\t\t\t\t\t\t:*/ null;\n\n\t\t\t\tconst buffer = stats.bufferSize > 0\n\t\t\t\t\t\t? (<div>{this.i18n.t(\n\t\t\t\t\t\t\t'metadata.player-stats.buffered',\n\t\t\t\t\t\t\t'Buffered: {buffered} seconds',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbuffered: stats.bufferSize.toFixed(2)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)}</div>)\n\t\t\t\t\t\t: null;\n\n\t\t\t\tif ( data.old )\n\t\t\t\t\treturn [\n\t\t\t\t\t\tdelayed,\n\t\t\t\t\t\tthis.i18n.t(\n\t\t\t\t\t\t\t'metadata.player-stats.video-tip',\n\t\t\t\t\t\t\t'Video Information'\n\t\t\t\t\t\t),\n\t\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t\t{this.i18n.t(\n\t\t\t\t\t\t\t\t'metadata.player-stats.broadcast-ago',\n\t\t\t\t\t\t\t\t'Broadcast {count,number}s Ago',\n\t\t\t\t\t\t\t\tdata.delay\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>,\n\t\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t\t{video_info}\n\t\t\t\t\t\t</div>,\n\t\t\t\t\t\tdesync,\n\t\t\t\t\t\tbuffer,\n\t\t\t\t\t\ttampered\n\t\t\t\t\t];\n\n\t\t\t\treturn [\n\t\t\t\t\tdelayed, ff,\n\t\t\t\t\tthis.i18n.t(\n\t\t\t\t\t\t'metadata.player-stats.latency-tip',\n\t\t\t\t\t\t'Stream Latency'\n\t\t\t\t\t),\n\t\t\t\t\t<div class=\"tw-pd-t-05\">\n\t\t\t\t\t\t{video_info}\n\t\t\t\t\t</div>,\n\t\t\t\t\tdesync,\n\t\t\t\t\tbuffer,\n\t\t\t\t\ttampered\n\t\t\t\t];\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @internal */\n\tgetAddonProxy(addon_id: string, addon: AddonInfo, module: GenericModule) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides: Record<string, any> = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\n\t\toverrides.define = <TData,>(key: string, definition: MetadataDefinition<TData>) => {\n\t\t\tif ( definition )\n\t\t\t\tdefinition.__source = addon_id;\n\n\t\t\treturn this.define(key, definition);\n\t\t};\n\n\t\treturn buildAddonProxy(module, this, 'metadata', overrides);\n\t}\n\n\n\t/** @internal */\n\tonEnable() {\n\t\tconst md: any = (this.tooltips.types as any).metadata = (target: HTMLElement) => {\n\t\t\tlet el: HTMLElement | null = target;\n\t\t\tif ( el._ffz_stat )\n\t\t\t\tel = el._ffz_stat;\n\t\t\telse if ( ! el.classList.contains('ffz-stat') ) {\n\t\t\t\tel = target.closest('.ffz-stat');\n\t\t\t\ttarget._ffz_stat = el;\n\t\t\t}\n\n\t\t\tif ( ! el )\n\t\t\t\treturn;\n\n\t\t\tconst key = el.dataset.key,\n\t\t\t\tdef = key?.length ? this.definitions[key] : null;\n\n\t\t\treturn maybe_call(def?.tooltip, this, el._ffz_data)\n\t\t};\n\n\t\tmd.onShow = (target: HTMLElement, tip: TooltipInstance) => {\n\t\t\tconst el = target._ffz_stat || target;\n\t\t\tel.tip = tip;\n\t\t};\n\n\t\tmd.onHide = (target: HTMLElement) => {\n\t\t\tconst el = target._ffz_stat || target;\n\t\t\tel.tip = null;\n\t\t\tel.tip_content = null;\n\t\t}\n\n\t\tmd.popperConfig = (target: HTMLElement, tip: TooltipInstance, opts: any) => {\n\t\t\topts.placement = 'bottom';\n\t\t\topts.modifiers.flip = {behavior: ['bottom','top']};\n\t\t\treturn opts;\n\t\t}\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tconst removed = new Set<string>;\n\t\t\tfor(const [key, def] of Object.entries(this.definitions)) {\n\t\t\t\tif ( def?.__source === addon_id ) {\n\t\t\t\t\tremoved.add(key);\n\t\t\t\t\tthis.definitions[key] = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( removed.size ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed.size} entries when unloading addon:`, addon_id);\n\t\t\t\tthis.updateMetadata([...removed]);\n\t\t\t}\n\t\t});\n\t}\n\n\n\t/**\n\t * Return an array of all metadata definition keys.\n\t */\n\tget keys() {\n\t\treturn Object.keys(this.definitions);\n\t}\n\n\t/**\n\t * Add or update a metadata definition. This method updates the entry\n\t * in {@link definitions}, and then it updates every live metadata\n\t * display to reflect the updated definition.\n\t *\n\t * @example Adding a simple metadata definition that displays when the channel went live.\n\t * ```typescript\n\t * metadata.define('when-live', {\n\t *     setup(data) {\n\t *         return data.channel?.live && data.channel.live_since;\n\t *     },\n\t *\n\t *     label(live_since) {\n\t *         return live_since;\n\t *     }\n\t * });\n\t * ```\n\t *\n\t * @param key A unique key for the metadata.\n\t * @param definition Your metadata's definition, or `null` to remove it.\n\t */\n\tdefine<TData>(key: string, definition?: MetadataDefinition<TData> | null) {\n\t\tthis.definitions[key] = definition;\n\t\tthis.updateMetadata(key);\n\t}\n\n\t/**\n\t * Update the rendered metadata elements for a key or keys. If keys\n\t * is not provided, this will update every metadata element.\n\t *\n\t * @param keys Optional. The key or keys that should be updated.\n\t */\n\tupdateMetadata(keys?: string | string[]) {\n\t\t// TODO: Types\n\n\t\tconst channel = this.resolve('site.channel') as any;\n\t\tif ( channel )\n\t\t\tfor(const el of channel.InfoBar.instances)\n\t\t\t\tchannel.updateMetadata(el, keys);\n\n\t\tconst player = this.resolve('site.player') as any;\n\t\tif ( player )\n\t\t\tfor(const inst of player.Player.instances)\n\t\t\t\tplayer.updateMetadata(inst, keys);\n\t}\n\n\t/**\n\t * Render a metadata definition into a container. This is used\n\t * internally to render metadata.\n\t *\n\t * @param key The metadata's unique key.\n\t * @param data The initial state\n\t * @param container The container to render into\n\t * @param timers An object to store timers for re-rendering\n\t * @param refresh_fn A method to call when the metadata should be re-rendered.\n\t */\n\tasync renderLegacy(\n\t\tkey: string,\n\t\tdata: MetadataState,\n\t\tcontainer: HTMLElement,\n\t\ttimers: Record<string, ReturnType<typeof setTimeout>>,\n\t\trefresh_fn: (key: string) => void\n\t) {\n\t\tif ( timers[key] )\n\t\t\tclearTimeout(timers[key]);\n\n\t\tlet el = container.querySelector<HTMLElement>(`.ffz-stat[data-key=\"${key}\"]`);\n\n\t\tconst def = this.definitions[key],\n\t\t\tdestroy = () => {\n\t\t\t\tif ( el ) {\n\t\t\t\t\t/*if ( el.tooltip )\n\t\t\t\t\t\tel.tooltip.destroy();\n\n\t\t\t\t\tif ( el.popper )\n\t\t\t\t\t\tel.popper.destroy();*/\n\n\t\t\t\t\tif ( el._ffz_destroy )\n\t\t\t\t\t\tel._ffz_destroy();\n\n\t\t\t\t\tel._ffz_destroy = /*el.tooltip = el.popper =*/ null;\n\t\t\t\t\tel.remove();\n\t\t\t\t}\n\t\t\t};\n\n\t\tif ( ! def /* || (data._mt || 'channel') !== (def.type || 'channel') */ )\n\t\t\treturn destroy();\n\n\t\ttry {\n\t\t\tconst ref_fn = () => refresh_fn(key);\n\t\t\tdata = {\n\t\t\t\t...data,\n\t\t\t\tis_player: false,\n\t\t\t\trefresh: ref_fn\n\t\t\t};\n\n\t\t\t// Process the data if a setup method is defined.\n\t\t\tif ( def.setup )\n\t\t\t\tdata = await def.setup.call(this, data);\n\n\t\t\t// Let's get refresh logic out of the way now.\n\t\t\tconst refresh = maybe_call(def.refresh, this, data);\n\t\t\tif ( refresh )\n\t\t\t\ttimers[key] = setTimeout(\n\t\t\t\t\tref_fn,\n\t\t\t\t\ttypeof refresh === 'number' ? refresh : 1000\n\t\t\t\t);\n\n\n\t\t\t// Grab the element again in case it changed, somehow.\n\t\t\tel = container.querySelector<HTMLElement>(`.ffz-stat[data-key=\"${key}\"]`);\n\n\t\t\tlet stat: HTMLElement | null,\n\t\t\t\told_color, old_icon;\n\n\t\t\tconst label = maybe_call(def.label, this, data);\n\n\t\t\tif ( ! label )\n\t\t\t\treturn destroy();\n\n\t\t\tconst order = maybe_call(def.order, this, data),\n\t\t\t\tcolor = maybe_call(def.color, this, data) || '';\n\n\t\t\tif ( ! el ) {\n\t\t\t\tlet icon = old_icon = maybe_call(def.icon, this, data);\n\t\t\t\tlet button = false;\n\n\t\t\t\tif ( def.button !== false && (def.popup || def.click) ) {\n\t\t\t\t\tbutton = true;\n\n\t\t\t\t\tlet btn: HTMLButtonElement | undefined,\n\t\t\t\t\t\tpopup: HTMLButtonElement | undefined;\n\n\t\t\t\t\tconst border = maybe_call(def.border, this, data),\n\t\t\t\t\t\tinherit = maybe_call(def.inherit, this, data);\n\n\t\t\t\t\tif ( typeof icon === 'string' )\n\t\t\t\t\t\ticon = (<span class=\"tw-mg-r-05\">\n\t\t\t\t\t\t\t<figure class={icon} />\n\t\t\t\t\t\t</span>);\n\n\t\t\t\t\tif ( def.popup && def.click ) {\n\t\t\t\t\t\tel = (<div\n\t\t\t\t\t\t\tclass={`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat ffz-stat--fix-padding ${border ? 'tw-mg-r-1' : 'tw-mg-r-05 ffz-mg-l--05'}`}\n\t\t\t\t\t\t\tdata-key={key}\n\t\t\t\t\t\t\t// createElement will properly assign this to the\n\t\t\t\t\t\t\t// created element. Shut up TypeScript.\n\t\t\t\t\t\t\ttip_content={null}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{btn = (<button\n\t\t\t\t\t\t\t\tclass={`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium ffz-core-button ffz-core-button--padded ffz-core-button--text ${inherit ? 'ffz-c-text-inherit' : 'tw-c-text-base'} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${border ? 'tw-border-l tw-border-t tw-border-b' : 'tw-font-size-5 tw-regular'}${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center tw-pd-x-1\">\n\t\t\t\t\t\t\t\t\t{icon as any}\n\t\t\t\t\t\t\t\t\t{stat = (<span class=\"ffz-stat-text\" />)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>) as HTMLButtonElement}\n\t\t\t\t\t\t\t{popup = (<button\n\t\t\t\t\t\t\t\tclass={`tw-align-items-center tw-align-middle tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${inherit ? 'ffz-c-text-inherit' : 'tw-c-text-base'} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${border ? 'tw-border' : 'tw-font-size-5 tw-regular'}${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center\">\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-down-dir\" />\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>) as HTMLButtonElement}\n\t\t\t\t\t\t</div>);\n\n\t\t\t\t\t} else\n\t\t\t\t\t\tbtn = popup = el = (<button\n\t\t\t\t\t\t\tclass={`ffz-stat tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${inherit ? 'ffz-c-text-inherit' : 'tw-c-text-base'} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative tw-pd-x-05 ffz-stat--fix-padding ${border ? 'tw-border tw-mg-r-1' : 'tw-font-size-5 tw-regular tw-mg-r-05 ffz-mg-l--05'}${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\t\tdata-key={key}\n\t\t\t\t\t\t\t// createElement will properly assign this to the\n\t\t\t\t\t\t\t// created element. Shut up TypeScript.\n\t\t\t\t\t\t\ttip_content={null}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center\">\n\t\t\t\t\t\t\t\t{icon as any}\n\t\t\t\t\t\t\t\t{stat = (<span class=\"ffz-stat-text\" />)}\n\t\t\t\t\t\t\t\t{def.popup && ! def.no_arrow && <span class=\"tw-mg-l-05\">\n\t\t\t\t\t\t\t\t\t<figure class=\"ffz-i-down-dir\" />\n\t\t\t\t\t\t\t\t</span>}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>) as any as HTMLButtonElement;\n\n\t\t\t\t\tif ( def.click )\n\t\t\t\t\t\tbtn.addEventListener('click', (event: MouseEvent) => {\n\t\t\t\t\t\t\tif ( ! el || ! btn || btn.disabled || btn.classList.contains('disabled') || (el as any).disabled || el.classList.contains('disabled') )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\treturn def.click?.call?.(this, el._ffz_data, event, () => { refresh_fn(key); });\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif ( def.popup )\n\t\t\t\t\t\tpopup.addEventListener('click', () => {\n\t\t\t\t\t\t\tif ( ! el || ! popup || popup.disabled || popup.classList.contains('disabled') || (el as any).disabled || el.classList.contains('disabled') )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tif ( el._ffz_popup && el._ffz_destroy )\n\t\t\t\t\t\t\t\treturn el._ffz_destroy();\n\n\t\t\t\t\t\t\tconst listeners: (() => void)[] = [],\n\t\t\t\t\t\t\t\tadd_close_listener = (cb: () => void) => {\n\t\t\t\t\t\t\t\t\tlisteners.push(cb);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tconst destroy = el._ffz_destroy = () => {\n\t\t\t\t\t\t\t\tfor(const cb of listeners) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\t\t\t\tif ( err instanceof Error )\n\t\t\t\t\t\t\t\t\t\t\tthis.log.capture(err, {\n\t\t\t\t\t\t\t\t\t\t\t\ttags: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmetadata: key\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tthis.log.error('Error when running a callback for pop-up destruction for metadata:', key, err);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// el is not going to be null\n\t\t\t\t\t\t\t\t// TypeScript is on drugs\n\t\t\t\t\t\t\t\t// whatever though\n\t\t\t\t\t\t\t\tif ( el ) {\n\t\t\t\t\t\t\t\t\tif ( el._ffz_outside )\n\t\t\t\t\t\t\t\t\t\tel._ffz_outside.destroy();\n\n\t\t\t\t\t\t\t\t\tif ( el._ffz_popup ) {\n\t\t\t\t\t\t\t\t\t\tconst fp = el._ffz_popup;\n\t\t\t\t\t\t\t\t\t\tel._ffz_popup = null;\n\t\t\t\t\t\t\t\t\t\tfp.destroy();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tel._ffz_destroy = el._ffz_outside = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tconst parent = document.fullscreenElement || document.body.querySelector<HTMLElement>('#root>div') || document.body,\n\t\t\t\t\t\t\t\ttt = el._ffz_popup = new Tooltip(parent as HTMLElement, el, {\n\t\t\t\t\t\t\t\t\tlogger: this.log,\n\t\t\t\t\t\t\t\t\ti18n: this.i18n,\n\t\t\t\t\t\t\t\t\tmanual: true,\n\t\t\t\t\t\t\t\t\tlive: false,\n\t\t\t\t\t\t\t\t\thtml: true,\n\n\t\t\t\t\t\t\t\t\ttooltipClass: 'ffz-metadata-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base',\n\t\t\t\t\t\t\t\t\t// Hide the arrow for now, until we re-do our CSS to make it render correctly.\n\t\t\t\t\t\t\t\t\tarrowClass: 'ffz-balloon__tail tw-overflow-hidden tw-absolute',\n\t\t\t\t\t\t\t\t\tarrowInner: 'ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute',\n\t\t\t\t\t\t\t\t\tinnerClass: 'tw-pd-1',\n\n\t\t\t\t\t\t\t\t\tpopper: {\n\t\t\t\t\t\t\t\t\t\tplacement: 'top-end',\n\t\t\t\t\t\t\t\t\t\tmodifiers: {\n\t\t\t\t\t\t\t\t\t\t\tpreventOverflow: {\n\t\t\t\t\t\t\t\t\t\t\t\tboundariesElement: parent\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tflip: {\n\t\t\t\t\t\t\t\t\t\t\t\tbehavior: ['top', 'bottom', 'left', 'right']\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcontent: (t, tip) => def.popup?.call(this, el?._ffz_data, tip, () => refresh_fn(key), add_close_listener),\n\t\t\t\t\t\t\t\t\tonShow: (t, tip) =>\n\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\tif ( el && tip.outer )\n\t\t\t\t\t\t\t\t\t\t\t\tel._ffz_outside = new ClickOutside(tip.outer, destroy);\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tonHide: destroy\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\ttt._enter(el);\n\t\t\t\t\t\t});\n\n\t\t\t\t} else {\n\t\t\t\t\tif ( typeof icon === 'string' )\n\t\t\t\t\t\ticon = (<span class=\"tw-stat__icon\"><figure class={icon} /></span>);\n\n\t\t\t\t\tel = (<div\n\t\t\t\t\t\tclass={`tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat tw-mg-r-1${def.tooltip ? ' ffz-tooltip ffz-tooltip--no-mouse' : ''}`}\n\t\t\t\t\t\tdata-tooltip-type=\"metadata\"\n\t\t\t\t\t\tdata-key={key}\n\t\t\t\t\t\ttip_content={null}\n\t\t\t\t\t>\n\t\t\t\t\t\t{icon as any}\n\t\t\t\t\t\t{stat = <span class={`${icon ? 'tw-mg-l-05 ' : ''}ffz-stat-text tw-stat__value`} />}\n\t\t\t\t\t</div>);\n\n\t\t\t\t\tif ( def.click )\n\t\t\t\t\t\tel.addEventListener('click', (event: MouseEvent) => {\n\t\t\t\t\t\t\tif ( ! el || (el as any).disabled || el.classList.contains('disabled') )\n\t\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t\t\tdef.click?.call?.(this, el._ffz_data, event, () => refresh_fn(key));\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tel._ffz_order = order;\n\n\t\t\t\tif ( order != null )\n\t\t\t\t\tel.style.order = `${order}`;\n\n\t\t\t\tcontainer.appendChild(el);\n\n\t\t\t} else {\n\t\t\t\tstat = el.querySelector('.ffz-stat-text');\n\t\t\t\tif ( ! stat )\n\t\t\t\t\treturn destroy();\n\n\t\t\t\told_icon = el.dataset.icon || '';\n\t\t\t\told_color = el.dataset.color || '';\n\n\t\t\t\tif ( el._ffz_order !== order )\n\t\t\t\t\tel.style.order = `${el._ffz_order = order}`;\n\n\t\t\t\tif ( el.tip ) {\n\t\t\t\t\tconst tooltip = maybe_call(def.tooltip, this, data);\n\t\t\t\t\tif ( el.tip_content !== tooltip ) {\n\t\t\t\t\t\tel.tip_content = tooltip;\n\t\t\t\t\t\tif ( el.tip?.element ) {\n\t\t\t\t\t\t\tel.tip.element.innerHTML = '';\n\t\t\t\t\t\t\tsetChildren(el.tip.element, tooltip);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( typeof def.icon === 'function' ) {\n\t\t\t\tconst icon = maybe_call(def.icon, this, data);\n\t\t\t\tif ( typeof icon === 'string' && icon !== old_icon ) {\n\t\t\t\t\tel.dataset.icon = icon;\n\t\t\t\t\tconst figure = el.querySelector('figure');\n\t\t\t\t\tif ( figure )\n\t\t\t\t\t\tfigure.className = icon;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( old_color !== color ) {\n\t\t\t\tel.dataset.color = color;\n\t\t\t\tel.style.setProperty('color', color, 'important');\n\t\t\t}\n\n\t\t\tel._ffz_data = data;\n\t\t\tstat.innerHTML = '';\n\t\t\tsetChildren(stat, label);\n\n\t\t\tif ( def.disabled !== undefined )\n\t\t\t\t(el as any).disabled = maybe_call(def.disabled, this, data);\n\n\t\t} catch(err) {\n\t\t\tif ( err instanceof Error )\n\t\t\t\tthis.log.capture(err, {\n\t\t\t\t\ttags: {\n\t\t\t\t\t\tmetadata: key\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\tthis.log.error(`Error rendering metadata for ${key}`, err);\n\t\t\treturn destroy();\n\t\t}\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Tooltip Handling\n// ============================================================================\n\nimport {createElement, sanitize} from 'utilities/dom';\nimport {has, maybe_call} from 'utilities/object';\n\nimport Tooltip, { TooltipInstance } from 'utilities/tooltip';\nimport Module, { GenericModule, buildAddonProxy } from 'utilities/module';\nimport awaitMD, {getMD} from 'utilities/markdown';\nimport { DEBUG } from 'src/utilities/constants';\nimport type { AddonInfo, DomFragment, OptionallyCallable } from '../utilities/types';\nimport type TranslationManager from '../i18n';\n\ndeclare global {\n\tinterface HTMLElement {\n\t\t_ffz_child: Element | null;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\ttooltips: TooltipEvents;\n\t}\n\tinterface ModuleMap {\n\t\ttooltips: TooltipProvider;\n\t}\n}\n\n\nexport type TooltipEvents = {\n\t/**\n\t * When this event is emitted, the tooltip provider will attempt to remove\n\t * old, invalid tool-tips.\n\t */\n\t':cleanup': [],\n\n\t':hover': [target: HTMLElement, tip: TooltipInstance, event: MouseEvent];\n\t':leave': [target: HTMLElement, tip: TooltipInstance, event: MouseEvent];\n};\n\ntype TooltipOptional<TReturn> = OptionallyCallable<[target: HTMLElement, tip: TooltipInstance], TReturn>;\n\ntype TooltipExtra = {\n\t__source?: string;\n\n\tpopperConfig(target: HTMLElement, tip: TooltipInstance, options: any): any;\n\n\tdelayShow: TooltipOptional<number>;\n\tdelayHide: TooltipOptional<number>;\n\n\tinteractive: TooltipOptional<boolean>;\n\thover_events: TooltipOptional<boolean>;\n\n\tonShow(target: HTMLElement, tip: TooltipInstance): void;\n\tonHide(target: HTMLElement, tip: TooltipInstance): void;\n\n};\n\nexport type TooltipDefinition = Partial<TooltipExtra> &\n\t((target: HTMLElement, tip: TooltipInstance) => DomFragment);\n\n\nexport default class TooltipProvider extends Module<'tooltips', TooltipEvents> {\n\n\t// Storage\n\ttypes: Record<string, TooltipDefinition | undefined>;\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\n\t// State\n\tcontainer?: HTMLElement | null;\n\ttip_element?: HTMLElement | null;\n\ttips?: Tooltip | null;\n\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.types = {};\n\n\t\tthis.inject('i18n');\n\n\t\tthis.should_enable = true;\n\n\t\tthis.types.json = target => {\n\t\t\tconst title = target.dataset.title;\n\t\t\treturn [\n\t\t\t\ttitle && createElement('strong', null, title),\n\t\t\t\tcreateElement('code', {\n\t\t\t\t\tclassName: `block${title ? ' pd-t-05 border-t mg-t-05' : ''}`,\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontFamily: 'monospace',\n\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t}\n\t\t\t\t}, target.dataset.data)\n\t\t\t]\n\t\t};\n\n\t\tthis.types.child = target => {\n\t\t\tconst child = target.querySelector(':scope > .ffz-tooltip-child');\n\t\t\tif ( ! child )\n\t\t\t\treturn null;\n\n\t\t\ttarget._ffz_child = child;\n\t\t\tchild.remove();\n\t\t\tchild.classList.remove('ffz-tooltip-child');\n\t\t\treturn child;\n\t\t};\n\n\t\tthis.types.child.onHide = target => {\n\t\t\tconst child = target._ffz_child;\n\t\t\tif ( child ) {\n\t\t\t\ttarget._ffz_child = null;\n\t\t\t\tchild.remove();\n\n\t\t\t\tif ( ! target.querySelector(':scope > .ffz-tooltip-child') ) {\n\t\t\t\t\tchild.classList.add('ffz-tooltip-child');\n\t\t\t\t\ttarget.appendChild(child);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.types.markdown = (target, tip) => {\n\t\t\ttip.add_class = 'ffz-tooltip--markdown';\n\n\t\t\tconst md = getMD();\n\t\t\tif ( ! md )\n\t\t\t\treturn awaitMD().then(md => md.render(target.dataset.title));\n\n\t\t\treturn md.render(target.dataset.title);\n\t\t};\n\n\t\tthis.types.text = target => sanitize(target.dataset.title ?? '');\n\t\tthis.types.html = target => target.dataset.title;\n\n\t\tthis.onFSChange = this.onFSChange.bind(this);\n\t}\n\n\n\tgetAddonProxy(addon_id: string, addon: AddonInfo, module: GenericModule) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides: Record<string, any> = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\t\tlet warnings: Record<string, boolean | string> | undefined;\n\n\t\toverrides.define = (key: string, handler: TooltipDefinition) => {\n\t\t\tif ( handler )\n\t\t\t\thandler.__source = addon_id;\n\n\t\t\treturn this.define(key, handler);\n\t\t};\n\n\t\tif ( is_dev ) {\n\t\t\toverrides.cleanup = () => {\n\t\t\t\tmodule.log.warn('[DEV-CHECK] Instead of calling tooltips.cleanup(), you can emit the event \"tooltips:cleanup\"');\n\t\t\t\treturn this.cleanup();\n\t\t\t};\n\n\t\t\twarnings = {\n\t\t\t\ttypes: 'Please use tooltips.define()'\n\t\t\t};\n\t\t}\n\n\t\treturn buildAddonProxy(\n\t\t\tmodule,\n\t\t\tthis,\n\t\t\t'tooltips',\n\t\t\toverrides,\n\t\t\twarnings\n\t\t);\n\t}\n\n\n\tonEnable() {\n\t\tconst container = this.getRoot();\n\n\t\twindow.addEventListener('fullscreenchange', this.onFSChange);\n\n\t\t//\tis_minimal = false; //container && container.classList.contains('twilight-minimal-root');\n\n\t\tthis.container = container;\n\t\tthis.tip_element = container;\n\t\tthis.tips = this._createInstance(container);\n\n\t\tthis.on(':cleanup', this.cleanup);\n\n\t\tthis.on('addon:fully-unload', addon_id => {\n\t\t\tlet removed = 0;\n\t\t\tfor(const [key, handler] of Object.entries(this.types)) {\n\t\t\t\tif ( handler?.__source === addon_id ) {\n\t\t\t\t\tremoved++;\n\t\t\t\t\tthis.types[key] = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( removed ) {\n\t\t\t\tthis.log.debug(`Cleaned up ${removed} entries when unloading addon:`, addon_id);\n\t\t\t\tthis.cleanup();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tdefine(key: string, handler: TooltipDefinition) {\n\t\t// TODO: Determine if any tooltips are already open.\n\t\t// If so, we need to close them / maybe re-open them?\n\t\tthis.types[key] = handler;\n\t}\n\n\n\tgetRoot() { // eslint-disable-line class-methods-use-this\n\t\treturn document.querySelector<HTMLElement>('.sunlight-root') ||\n\t\t\t//document.querySelector('#root>div') ||\n\t\t\tdocument.querySelector('#root') ||\n\t\t\tdocument.querySelector('.clips-root') ||\n\t\t\tdocument.body;\n\t}\n\n\t_createInstance(container: HTMLElement, klass = 'ffz-tooltip', default_type = 'text', tip_container?: HTMLElement) {\n\t\treturn new Tooltip(container, klass, {\n\t\t\thtml: true,\n\t\t\ti18n: this.i18n,\n\t\t\tlive: true,\n\t\t\tcheck_modifiers: true,\n\t\t\tcontainer: tip_container || container,\n\n\t\t\tdelayHide: this.checkDelayHide.bind(this, default_type),\n\t\t\tdelayShow: this.checkDelayShow.bind(this, default_type),\n\t\t\tcontent: this.process.bind(this, default_type),\n\t\t\tinteractive: this.checkInteractive.bind(this, default_type),\n\t\t\thover_events: this.checkHoverEvents.bind(this, default_type),\n\n\t\t\tonShow: this.delegateOnShow.bind(this, default_type),\n\t\t\tonHide: this.delegateOnHide.bind(this, default_type),\n\n\t\t\tpopperConfig: this.delegatePopperConfig.bind(this, default_type),\n\t\t\tpopper: {\n\t\t\t\tplacement: 'top',\n\t\t\t\tmodifiers: {\n\t\t\t\t\tflip: {}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonHover: (target, tip, event) => {\n\t\t\t\tthis.emit(':hover', target, tip, event)\n\t\t\t},\n\n\t\t\tonLeave: (target, tip, event) => {\n\t\t\t\tthis.emit(':leave', target, tip, event);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tonFSChange() {\n\t\tif ( ! this.container )\n\t\t\tthis.container = this.getRoot();\n\n\t\tlet tip_element = this.container;\n\t\tif ( document.fullscreenElement instanceof HTMLElement )\n\t\t\ttip_element = document.fullscreenElement;\n\n\t\tif ( tip_element !== this.tip_element ) {\n\t\t\tthis.tip_element = tip_element;\n\t\t\tif ( this.tips ) {\n\t\t\t\tthis.tips.destroy();\n\t\t\t\tthis.tips = this._createInstance(tip_element);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tcleanup() {\n\t\tif ( this.tips )\n\t\t\tthis.tips.cleanup();\n\t}\n\n\n\tdelegatePopperConfig(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance,\n\t\toptions: any\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( target.dataset.tooltipSide )\n\t\t\toptions.placement = target.dataset.tooltipSide;\n\n\t\tif ( handler && handler.popperConfig )\n\t\t\treturn handler.popperConfig(target, tip, options);\n\n\t\treturn options;\n\t}\n\n\tdelegateOnShow(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler && handler.onShow )\n\t\t\thandler.onShow(target, tip);\n\t}\n\n\tdelegateOnHide(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler && handler.onHide )\n\t\t\thandler.onHide(target, tip);\n\t}\n\n\tcheckDelayShow(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.delayShow != null )\n\t\t\treturn maybe_call(handler.delayShow, null, target, tip);\n\n\t\treturn 0;\n\t}\n\n\tcheckDelayHide(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.delayHide != null )\n\t\t\treturn maybe_call(handler.delayHide, null, target, tip);\n\n\t\treturn 0;\n\t}\n\n\tcheckInteractive(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.interactive != null )\n\t\t\treturn maybe_call(handler.interactive, null, target, tip);\n\n\t\treturn false;\n\t}\n\n\tcheckHoverEvents(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type,\n\t\t\thandler = this.types[type];\n\n\t\tif ( handler?.hover_events != null )\n\t\t\treturn maybe_call(handler.hover_events, null, target, tip);\n\n\t\treturn false;\n\t}\n\n\tprocess(\n\t\tdefault_type: string,\n\t\ttarget: HTMLElement,\n\t\ttip: TooltipInstance\n\t) {\n\t\tconst type = target.dataset.tooltipType || default_type || 'text',\n\t\t\talign = target.dataset.tooltipAlign,\n\t\t\thandler = this.types[type];\n\n\t\tif ( align )\n\t\t\ttip.align = align;\n\n\t\tif ( ! handler )\n\t\t\treturn [\n\t\t\t\tcreateElement('strong', null, 'Unhandled Tooltip Type'),\n\t\t\t\tcreateElement('code', {\n\t\t\t\t\tclassName: 'tw-block pd-t-05 border-t mg-t-05',\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontFamily: 'monospace',\n\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t}\n\t\t\t\t}, JSON.stringify(target.dataset, null, 4))\n\t\t\t];\n\n\t\treturn handler(target, tip);\n\t}\n}\n","'use strict';\n\nimport { AdvancedSettingsProvider } from \"./providers\";\nimport type { SettingsClearable } from \"./types\";\n\n// ============================================================================\n// Clearable Settings\n// ============================================================================\n\nexport const Experiments: SettingsClearable = {\n\tlabel: 'Experiment Overrides',\n\tkeys: [\n\t\t'exp-lock',\n\t\t'experiment-overrides'\n\t]\n};\n\nexport const HiddenEmotes: SettingsClearable = {\n\tlabel: 'Hidden Emotes',\n\tkeys(provider) {\n\t\tconst keys = ['emote-menu.hidden-sets'];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( key.startsWith('hidden-emotes.') )\n\t\t\t\tkeys.push(key);\n\n\t\treturn keys;\n\t}\n};\n\nexport const FavoriteEmotes: SettingsClearable = {\n\tlabel: 'Favorited Emotes',\n\tkeys(provider) {\n\t\tconst keys = [];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( key.startsWith('favorite-emotes.') )\n\t\t\t\tkeys.push(key);\n\n\t\treturn keys;\n\t}\n};\n\nexport const Overrides: SettingsClearable = {\n\tlabel: 'Name and Color Overrides',\n\tkeys: [\n\t\t'overrides.colors',\n\t\t'overrides.names'\n\t]\n};\n\nexport const Profiles: SettingsClearable = {\n\tlabel: 'Profiles',\n\tclear(provider, settings) {\n\t\tconst keys = ['profiles'];\n\t\tfor(const key of provider.keys())\n\t\t\tif ( /^p:\\d+:/.test(key) )\n\t\t\t\tkeys.push(key);\n\n\t\tfor(const key of keys)\n\t\t\tprovider.delete(key);\n\n\t\tsettings.loadProfiles();\n\t}\n};\n\nexport const Everything: SettingsClearable = {\n\tlabel: 'Absolutely Everything',\n\tasync clear(provider, settings) {\n\t\tprovider.clear();\n\t\tif ( provider.supportsBlobs && provider instanceof AdvancedSettingsProvider )\n\t\t\tawait provider.clearBlobs();\n\n\t\tsettings.loadProfiles();\n\t}\n};\n","'use strict';\n\n// ============================================================================\n// Settings Contexts\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {has, get as getter, array_equals, set_equals, map_equals, deep_equals} from 'utilities/object';\n\nimport DEFINITIONS from './typehandlers';\nimport type { AllSettingsKeys, ContextData, SettingMetadata, SettingType, SettingDefinition, SettingsKeys } from './types';\nimport type SettingsManager from '.';\nimport type SettingsProfile from './profile';\nimport type { SettingsTypeMap } from 'utilities/types';\n\n/**\n * Perform a basic check of a setting's requirements to see if they changed.\n * @param {Object} definition\n * @param {Map} cache\n * @param {Map} old_cache\n * @returns Whether or not they changed.\n */\nfunction compare_requirements(\n\tdefinition: SettingDefinition<any>,\n\tcache: Map<string, unknown>,\n\told_cache: Map<string, unknown>\n) {\n\tif ( ! definition || ! Array.isArray(definition.requires) )\n\t\treturn false;\n\n\tfor(const req of definition.requires) {\n\t\tconst old_value = old_cache.get(req),\n\t\t\tnew_value = cache.get(req);\n\n\t\tif ( typeof old_value !== typeof new_value )\n\t\t\treturn true;\n\n\t\tif ( Array.isArray(old_value) && Array.isArray(new_value) ) {\n\t\t\tif ( ! array_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if ( new_value instanceof Set && old_value instanceof Set ) {\n\t\t\tif ( ! set_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if( new_value instanceof Map && old_value instanceof Map ) {\n\t\t\tif ( ! map_equals(new_value, old_value) )\n\t\t\t\treturn true;\n\n\t\t} else if ( new_value !== old_value )\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n\nexport type SettingsContextEvents = {\n\t[K in keyof SettingsTypeMap as `changed:${K}`]: [value: SettingsTypeMap[K], old_value: SettingsTypeMap[K]];\n} & {\n\t[K in keyof SettingsTypeMap as `uses_changed:${K}`]: [uses: number[] | null, old_uses: number[] | null];\n} & {\n\tchanged: [key: SettingsKeys, value: any, old_value: any];\n\tuses_changed: [key: SettingsKeys, uses: number[] | null, old_uses: number[] | null];\n\n\tcontext_changed: [];\n\tprofiles_changed: [];\n}\n\n\n/**\n * The SettingsContext class provides a context through which to read\n * settings values in addition to emitting events when settings values\n * are changed.\n */\nexport default class SettingsContext extends EventEmitter<SettingsContextEvents> {\n\n\tparent: SettingsContext | null;\n\tmanager: SettingsManager;\n\n\torder: number[];\n\n\t/** @internal */\n\t_context: ContextData;\n\tprivate __context: ContextData = null as any;\n\n\tprivate __profiles: SettingsProfile[];\n\n\tprivate __cache: Map<SettingsKeys, unknown>;\n\tprivate __meta: Map<SettingsKeys, SettingMetadata>;\n\n\tprivate __ls_listening: boolean;\n\tprivate __ls_wanted: Map<string, Set<string>>;\n\n\tconstructor(manager: SettingsContext | SettingsManager, context?: ContextData) {\n\t\tsuper();\n\n\t\tif ( manager instanceof SettingsContext ) {\n\t\t\tthis.parent = manager;\n\t\t\tthis.manager = manager.manager;\n\n\t\t\tthis.parent.on('context_changed', this._rebuildContext, this);\n\n\t\t} else {\n\t\t\tthis.parent = null;\n\t\t\tthis.manager = manager;\n\t\t}\n\n\t\t(this.manager as any).__contexts.push(this);\n\t\tthis._context = context || {};\n\n\t\t/*this._context_objects = new Set;\n\t\tif ( context )\n\t\t\tthis._updateContext(context, undefined, undefined, new Set);*/\n\n\t\tthis.__ls_listening = false;\n\t\tthis.__ls_wanted = new Map;\n\n\t\tthis.__cache = new Map;\n\t\tthis.__meta = new Map;\n\t\tthis.__profiles = [];\n\t\tthis.order = [];\n\n\t\tthis._rebuildContext();\n\t}\n\n\tdestroy() {\n\t\tif ( this.parent )\n\t\t\tthis.parent.off('context_changed', this._rebuildContext, this);\n\n\t\tfor(const profile of this.__profiles)\n\t\t\tprofile.off('changed', this._onChanged, this);\n\n\t\tconst contexts = (this.manager as any).__contexts,\n\t\t\tidx = contexts.indexOf(this);\n\n\t\tif ( idx !== -1 )\n\t\t\tcontexts.splice(idx, 1);\n\t}\n\n\n\t// ========================================================================\n\t// Local Storage Handling\n\t// ========================================================================\n\n\t_watchLS() {\n\t\tif ( this.__ls_listening )\n\t\t\treturn;\n\n\t\tthis.__ls_listening = true;\n\t\tthis.manager.on(':ls-update', this._onLSUpdate, this);\n\t}\n\n\t_unwatchLS() {\n\t\tif ( ! this.__ls_listening )\n\t\t\treturn;\n\n\t\tthis.__ls_listening = false;\n\t\tthis.manager.off(':ls-update', this._onLSUpdate, this);\n\t}\n\n\t_onLSUpdate(key: string) {\n\t\tconst keys = this.__ls_wanted.get(`ls.${key}`);\n\t\tif ( keys )\n\t\t\tfor(const key of keys)\n\t\t\t\tthis._update(key as SettingsKeys, key as SettingsKeys, []);\n\t}\n\n\n\t// ========================================================================\n\t// State Construction\n\t// ========================================================================\n\n\t_rebuildContext() {\n\t\tthis.__context = this.parent ?\n\t\t\tObject.assign({}, this.parent.__context || this.parent._context, this._context) :\n\t\t\tthis._context;\n\n\t\t// Make sure we re-build the cache. Dependency hell.\n\t\tif ( ! this.selectProfiles() )\n\t\t\tthis.rebuildCache();\n\n\t\tthis.emit('context_changed');\n\t}\n\n\n\tselectProfiles() {\n\t\tconst new_profiles: SettingsProfile[] = [],\n\t\t\torder: number[] = this.order = [];\n\n\t\tif ( ! this.manager.disable_profiles ) {\n\t\t\tfor(const profile of this.manager.__profiles)\n\t\t\t\tif ( profile.toggled && profile.matches(this.__context) ) {\n\t\t\t\t\tnew_profiles.push(profile);\n\t\t\t\t\torder.push(profile.id);\n\t\t\t\t}\n\t\t}\n\n\t\tif ( array_equals(this.__profiles, new_profiles) )\n\t\t\treturn false;\n\n\t\tconst changed_ids = new Set;\n\n\t\tfor(const profile of this.__profiles)\n\t\t\tif ( ! new_profiles.includes(profile) ) {\n\t\t\t\tprofile.off('changed', this._onChanged, this);\n\t\t\t\tchanged_ids.add(profile.id);\n\t\t\t}\n\n\t\tfor(const profile of new_profiles)\n\t\t\tif ( ! this.__profiles.includes(profile) ) {\n\t\t\t\tprofile.on('changed', this._onChanged as any, this);\n\t\t\t\tchanged_ids.add(profile.id);\n\t\t\t}\n\n\t\tthis.__profiles = new_profiles;\n\t\tthis.emit('profiles_changed');\n\t\tthis.rebuildCache(/*changed_ids*/);\n\t\treturn true;\n\t}\n\n\n\trebuildCache() {\n\t\tconst old_cache = this.__cache,\n\t\t\told_meta = this.__meta,\n\t\t\tmeta = this.__meta = new Map;\n\n\t\tthis.__cache = new Map;\n\n\t\t// TODO: Limit the values we recalculate to ones affected by the change\n\t\t// that happened to the profiles. This is harder because of setting\n\t\t// dependencies.\n\n\t\tfor(const [key, old_value] of old_cache) {\n\t\t\tconst new_value = this.get(key),\n\t\t\t\tnew_m = meta.get(key),\n\t\t\t\told_m = old_meta.get(key),\n\t\t\t\tnew_uses = new_m ? new_m.uses : null,\n\t\t\t\told_uses = old_m ? old_m.uses : null;\n\n\t\t\tconst definition = this.manager.definitions.get(key);\n\t\t\tlet changed = false;\n\n\t\t\tif ( ! Array.isArray(definition) && definition?.equals ) {\n\t\t\t\tif ( definition.equals === 'requirements' )\n\t\t\t\t\tchanged = compare_requirements(definition, this.__cache, old_cache);\n\t\t\t\telse if ( typeof definition.equals === 'function' )\n\t\t\t\t\tchanged = ! definition.equals(new_value, old_value, this.__cache, old_cache);\n\t\t\t}\n\n\t\t\telse if ( Array.isArray(new_value) && Array.isArray(old_value) )\n\t\t\t\tchanged = ! array_equals(new_value, old_value);\n\n\t\t\telse if ( new_value instanceof Set && old_value instanceof Set )\n\t\t\t\tchanged = ! set_equals(new_value, old_value);\n\n\t\t\telse if ( new_value instanceof Map && old_value instanceof Map )\n\t\t\t\tchanged = ! map_equals(new_value, old_value);\n\n\t\t\telse if ( new_value !== old_value )\n\t\t\t\tchanged = true;\n\n\t\t\tif ( changed ) {\n\t\t\t\tthis.emit('changed', key, new_value, old_value);\n\t\t\t\tthis.emit(`changed:${key}`, new_value, old_value as any);\n\t\t\t}\n\n\t\t\tif ( ! array_equals(new_uses, old_uses) ) {\n\t\t\t\tthis.emit('uses_changed', key, new_uses, old_uses);\n\t\t\t\tthis.emit(`uses_changed:${key}`, new_uses, old_uses);\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Context Control\n\t// ========================================================================\n\n\tcontext(context: ContextData) {\n\t\treturn new SettingsContext(this, context);\n\t}\n\n\n\tupdateContext(context: ContextData) {\n\t\tlet changed = false;\n\n\t\tfor(const key in context)\n\t\t\tif ( has(context, key) ) {\n\t\t\t\tconst val = context[key];\n\t\t\t\ttry {\n\t\t\t\t\tif ( deep_equals(val, this._context[key]) )\n\t\t\t\t\t\tcontinue;\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t\t// This can catch a recursive structure error.\n\t\t\t\t}\n\n\t\t\t\tthis._context[key] = val as any;\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\tif ( changed )\n\t\t\tthis._rebuildContext();\n\t}\n\n\n\t/*_updateContext(context, prefix, keys, changed) {\n\t\tif ( ! context || typeof context !== 'object' )\n\t\t\treturn;\n\n\t\tif ( ! keys )\n\t\t\tkeys = Object.keys(context);\n\n\t\tif ( prefix && this._context_objects.has(prefix) ) {\n\t\t\tfor(const key of Object.keys(this._context) )\n\t\t\t\tif ( key.startsWith(prefix) ) {\n\t\t\t\t\tconst partial_key = key.substr(prefix.length);\n\t\t\t\t\tif ( ! keys.includes(partial_key) )\n\t\t\t\t\t\tkeys.push(partial_key);\n\t\t\t\t}\n\t\t}\n\n\t\tif ( prefix )\n\t\t\tthis._context_objects.add(prefix);\n\n\t\tfor(const key of keys) {\n\t\t\tconst full_key = prefix ? `${prefix}${key}` : key,\n\t\t\t\tpref = `${full_key}.`,\n\t\t\t\told_value = this._context[full_key],\n\t\t\t\tval = context[key];\n\n\t\t\tconst keys = val && (typeof val === 'object') && Object.keys(val);\n\t\t\tif ( keys && keys.length ) {\n\t\t\t\tthis._updateContext(val, pref, keys, changed);\n\n\t\t\t} else if ( this._context_objects.has(pref) ) {\n\t\t\t\tthis._updateContext({}, pref, [], changed);\n\t\t\t\tthis._context_objects.delete(pref);\n\n\t\t\t\tif ( (val || old_value) && val !== old_value ) {\n\t\t\t\t\tthis._context[full_key] = val;\n\t\t\t\t\tchanged.add(full_key);\n\t\t\t\t}\n\n\t\t\t} else if ( val !== old_value ) {\n\t\t\t\tthis._context[full_key] = val;\n\t\t\t\tchanged.add(full_key);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tupdateContext(context) {\n\t\tif ( ! context || typeof context !== 'object' )\n\t\t\treturn;\n\n\t\tconst changed = new Set;\n\t\tthis._updateContext(context, undefined, undefined, changed);\n\n\t\tif ( changed.size )\n\t\t\tthis._rebuildContext();\n\t}*/\n\n\n\tsetContext(context: ContextData) {\n\t\t//this._context_objects = new Set;\n\t\tthis._context = {};\n\t\tthis.updateContext(context);\n\t}\n\n\n\t// ========================================================================\n\t// Data Access\n\t// ========================================================================\n\n\t_onChanged(key: SettingsKeys) {\n\t\tthis._update(key, key, []);\n\t}\n\n\t_update<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, initial: SettingsKeys, visited: SettingsKeys[]) {\n\t\tif ( ! this.__cache.has(key) )\n\t\t\treturn;\n\n\t\telse if ( visited.includes(key) )\n\t\t\tthrow new Error(`cyclic dependent chain when updating setting \"${initial}\"`);\n\n\t\tvisited.push(key);\n\n\t\tconst old_value = this.__cache.get(key) as TValue | undefined,\n\t\t\told_meta = this.__meta.get(key),\n\t\t\tnew_value = this._get(key, key, []),\n\t\t\tnew_meta = this.__meta.get(key),\n\n\t\t\told_uses = old_meta ? old_meta.uses : null,\n\t\t\tnew_uses = new_meta ? new_meta.uses : null;\n\n\t\tif ( ! array_equals(new_uses, old_uses) ) {\n\t\t\tthis.emit('uses_changed', key, new_uses, old_uses);\n\t\t\tthis.emit(`uses_changed:${key}` as any, new_uses, old_uses);\n\t\t}\n\n\t\tif ( old_value === new_value )\n\t\t\treturn;\n\n\t\tthis.emit('changed', key, new_value, old_value);\n\t\tthis.emit(`changed:${key}` as any, new_value, old_value);\n\n\t\tconst definition = this.manager.definitions.get(key);\n\t\tif ( ! Array.isArray(definition) && definition?.required_by )\n\t\t\tfor(const req_key of definition.required_by)\n\t\t\t\tif ( ! req_key.startsWith('context.') && ! req_key.startsWith('ls.') )\n\t\t\t\t\tthis._update(req_key as SettingsKeys, initial, Array.from(visited));\n\t}\n\n\n\t_get<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, initial: SettingsKeys, visited: SettingsKeys[]): TValue {\n\t\tif ( visited.includes(key) )\n\t\t\tthrow new Error(`cyclic dependency when resolving setting \"${initial}\"`);\n\n\t\tvisited.push(key);\n\n\t\tconst definition = this.manager.definitions.get(key);\n\t\tconst raw_type = ! Array.isArray(definition) && definition?.type,\n\t\t\ttype = raw_type ? DEFINITIONS[raw_type] : DEFINITIONS.basic;\n\n\t\tif ( ! type )\n\t\t\tthrow new Error(`non-existent setting type \"${raw_type}\"`);\n\n\t\tconst raw_value = this._getRaw(key, type),\n\t\t\tmeta: SettingMetadata = {\n\t\t\t\tuses: raw_value ? raw_value[1] : null\n\t\t\t};\n\n\t\tlet value = raw_value ? raw_value[0] : undefined;\n\n\t\tif ( definition ) {\n\t\t\tif ( Array.isArray(definition) )\n\t\t\t\tthrow new Error(`non-existent setting \"${key}\" required when resolving setting \"${initial}\"`);\n\n\t\t\tif ( meta.uses === null ) {\n\t\t\t\tconst def_default = definition.default;\n\t\t\t\tif ( typeof def_default === 'function' )\n\t\t\t\t\tvalue = def_default(this);\n\t\t\t\telse\n\t\t\t\t\tvalue = def_default;\n\n\t\t\t\tif ( type.default )\n\t\t\t\t\tvalue = type.default(value, definition, this.manager.log);\n\t\t\t}\n\n\t\t\tif ( definition.requires )\n\t\t\t\tfor(const req_key of definition.requires)\n\t\t\t\t\tif ( req_key.startsWith('ls.') ) {\n\t\t\t\t\t\tthis._watchLS();\n\t\t\t\t\t\tlet keys = this.__ls_wanted.get(req_key);\n\t\t\t\t\t\tif ( ! keys )\n\t\t\t\t\t\t\tthis.__ls_wanted.set(req_key, keys = new Set);\n\n\t\t\t\t\t\tkeys.add(key);\n\n\t\t\t\t\t} else if ( ! req_key.startsWith('context.') && ! this.__cache.has(req_key as SettingsKeys) )\n\t\t\t\t\t\tthis._get(req_key as SettingsKeys, initial, Array.from(visited));\n\n\t\t\tif ( definition.process )\n\t\t\t\tvalue = definition.process(this, value, meta);\n\t\t}\n\n\t\tthis.__cache.set(key, value);\n\t\tthis.__meta.set(key, meta);\n\t\treturn value;\n\t}\n\n\n\t*profiles() {\n\t\tfor(const profile of this.__profiles)\n\t\t\tyield profile;\n\t}\n\n\n\thasProfile(profile: number | SettingsProfile) {\n\t\tif ( typeof profile === 'number' ) {\n\t\t\tfor(const prof of this.__profiles)\n\t\t\t\tif ( prof.id === profile )\n\t\t\t\t\treturn true;\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.__profiles.includes(profile);\n\t}\n\n\n\t_getRaw(key: SettingsKeys, type) {\n\t\tif ( ! type )\n\t\t\tthrow new Error(`non-existent type for ${key}`)\n\n\t\treturn type.get(\n\t\t\tkey,\n\t\t\tthis.profiles(),\n\t\t\tthis.manager.definitions.get(key),\n\t\t\tthis.manager.log,\n\t\t\tthis\n\t\t);\n\t}\n\n\n\t// ========================================================================\n\t// Data Access\n\t// ========================================================================\n\n\tupdate(key: SettingsKeys) {\n\t\tthis._update(key, key, []);\n\t}\n\n\tget<\n\t\tK extends AllSettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K): TValue {\n\t\tif ( key.startsWith('ls.') )\n\t\t\treturn this.manager.getLS(key.slice(3)) as TValue;\n\n\t\tif ( key.startsWith('context.') )\n\t\t\t//return this.__context[key.slice(8)];\n\t\t\treturn getter(key.slice(8), this.__context);\n\n\t\tif ( this.__cache.has(key as SettingsKeys) )\n\t\t\treturn this.__cache.get(key as SettingsKeys) as TValue;\n\n\t\treturn this._get(key as SettingsKeys, key as SettingsKeys, []);\n\t}\n\n\tgetChanges<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingsTypeMap[K]\n\t>(key: K, fn: (value: TValue, old_value: TValue | undefined) => void, ctx?: any) {\n\t\tthis.onChange(key, fn, ctx);\n\t\tfn.call(ctx, this.get(key), undefined as TValue);\n\t}\n\n\tonChange<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingsTypeMap[K]\n\t>(key: K, fn: (value: TValue, old_value: TValue) => void, ctx?: any) {\n\t\tthis.on(`changed:${key}`, fn as any, ctx);\n\t}\n\n\n\tuses(key: AllSettingsKeys) {\n\t\tif ( key.startsWith('ls.') )\n\t\t\treturn null;\n\n\t\tif ( key.startsWith('context.') )\n\t\t\treturn null;\n\n\t\tif ( ! this.__meta.has(key as SettingsKeys) )\n\t\t\tthis._get(key as SettingsKeys, key as SettingsKeys, []);\n\n\t\treturn this.__meta.get(key as SettingsKeys)?.uses ?? null;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Profile Filters for Settings\n// ============================================================================\n\nimport {glob_to_regex, escape_regex, matchScreen, ScreenOptions} from 'utilities/object';\nimport {FilterData, FilterType, createTester} from 'utilities/filtering';\nimport { DEBUG } from 'utilities/constants';\nimport type { ContextData } from './types';\nimport type { ScreenDetails } from 'root/types/getScreenDetails';\nimport SettingsManager from '.';\n\nlet safety: ((input: string | RegExp) => boolean) | null = null;\n\nfunction loadSafety(callback?: () => void) {\n\timport(/* webpackChunkName: 'regex' */ 'safe-regex').then(thing => {\n\t\tsafety = thing.default;\n\t\tif ( callback )\n\t\t\tcallback();\n\t})\n}\n\nconst NeverMatch = () => false;\n\n\n// Logical Components\n\nexport const Invert: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, true, false, rebuild)\n\t},\n\n\tmaxRules: 1,\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'Invert',\n\ti18n: 'settings.filter.invert',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\nexport const And: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, false, false, rebuild);\n\t},\n\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'And',\n\ti18n: 'settings.filter.and',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\nexport const Or: FilterType<FilterData[], ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\treturn createTester(config, rule_types, false, true, rebuild);\n\t},\n\n\tchildRules: true,\n\n\ttall: true,\n\ttitle: 'Or',\n\ti18n: 'settings.filter.or',\n\n\tdefault: () => [],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/nested.vue')\n};\n\ntype IfData = [\n\tcondition: FilterData[],\n\tif_true: FilterData[],\n\tif_else: FilterData[]\n];\n\nexport const If: FilterType<IfData, ContextData> = {\n\tcreateTest(config, rule_types, rebuild) {\n\t\tconst cond = createTester(config[0], rule_types as any, false, false, rebuild),\n\t\t\tif_true = createTester(config[1], rule_types as any, false, false, rebuild),\n\t\t\tif_false = createTester(config[2], rule_types as any, false, false, rebuild);\n\n\t\treturn ctx => cond(ctx) ? if_true(ctx) : if_false(ctx)\n\t},\n\n\tchildRules: true,\n\ttall: true,\n\ttitle: 'If',\n\ti18n: 'settings.filter.if',\n\n\tdefault: () => [[], [], []],\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/if.vue')\n};\n\nexport const Constant: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\tif ( config )\n\t\t\treturn () => true;\n\t\treturn NeverMatch;\n\t},\n\n\ttitle: 'True or False',\n\ti18n: 'settings.filter.true_false',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\n\n// Context Stuff\n\nfunction parseTime(time: string) {\n\tif ( typeof time !== 'string' || ! time.length )\n\t\treturn null;\n\n\tconst idx = time.indexOf(':');\n\tif ( idx === -1 )\n\t\treturn null;\n\n\tlet hours, minutes;\n\ttry {\n\t\thours = parseInt(time.slice(0, idx), 10);\n\t\tminutes = parseInt(time.slice(idx + 1), 10);\n\n\t} catch(err) {\n\t\treturn null;\n\t}\n\n\treturn hours * 60 + minutes;\n}\n\ntype TimeFilter = FilterType<[start: string, end: string], ContextData> & {\n\t_captured: Set<number>;\n\tcaptured: () => number[];\n};\n\nexport const Time: TimeFilter = {\n\t_captured: new Set,\n\n\tcreateTest(config) {\n\t\tconst start = parseTime(config[0]),\n\t\t\tend = parseTime(config[1]);\n\n\t\tif ( start == null || end == null )\n\t\t\treturn NeverMatch;\n\n\t\tif ( start <= end )\n\t\t\treturn () => {\n\t\t\t\tTime._captured.add(start);\n\t\t\t\tTime._captured.add(end + 1);\n\n\t\t\t\tconst d = new Date,\n\t\t\t\t\tv = d.getHours() * 60 + d.getMinutes();\n\n\t\t\t\treturn v >= start && v <= end;\n\t\t\t}\n\n\t\treturn () => {\n\t\t\tTime._captured.add(start + 1);\n\t\t\tTime._captured.add(end);\n\n\t\t\tconst d = new Date,\n\t\t\t\tv = d.getHours() * 60 + d.getMinutes();\n\n\t\t\treturn v >= start || v <= end;\n\t\t}\n\t},\n\n\tcaptured: () => {\n\t\tconst out = Array.from(Time._captured);\n\t\tTime._captured = new Set;\n\t\tout.sort((a, b) => a - b);\n\t\treturn out;\n\t},\n\n\ttitle: 'Time of Day',\n\ti18n: 'settings.filter.time',\n\n\tdefault: () => ['08:00', '18:00'],\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/time.vue')\n}\n\nexport const TheaterMode: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => {\n\t\t\tif ( ctx.fullscreen )\n\t\t\t\treturn config === false;\n\t\t\treturn ctx.ui?.theatreModeEnabled === config;\n\t\t}\n\t},\n\n\ttitle: 'Theater Mode',\n\ti18n: 'settings.filter.theater',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Fullscreen: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.fullscreen === config;\n\t},\n\n\ttitle: 'Fullscreen',\n\ti18n: 'settings.filter.fullscreen',\n\n\tdefault: true,\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Moderator: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.moderator === config;\n\t},\n\n\ttitle: 'Is Moderator',\n\ti18n: 'settings.filter.moderator',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const Debug: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn () => DEBUG === config;\n\t},\n\n\ttitle: 'Is Developer Mode',\n\ti18n: 'settings.filter.dev',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const AddonDebug: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.addonDev == config\n\t},\n\n\ttitle: 'Is Addon Developer Mode',\n\ti18n: 'settings.filter.addon-dev',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n}\n\nexport const SquadMode: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\treturn ctx => ctx.ui?.squadModeEnabled === config;\n\t},\n\n\ttitle: 'Squad Mode',\n\ti18n: 'settings.filter.squad',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\nexport const NativeDarkTheme: FilterType<boolean, ContextData> = {\n\tcreateTest(config) {\n\t\tconst val = config ? 1 : 0;\n\t\treturn ctx => ctx.ui?.theme === val;\n\t},\n\n\ttitle: 'Dark Theme',\n\ti18n: 'settings.filter.native-dark',\n\n\tdefault: true,\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n};\n\n// TODO: Add typing.\ntype PageData = {\n\troute: string;\n\tvalues: Record<string, string>;\n};\n\nexport const Page: FilterType<PageData, ContextData> = {\n\tcreateTest(config) {\n\t\tif ( ! config )\n\t\t\treturn NeverMatch;\n\n\t\tconst name = config.route,\n\t\t\tparts: [index: number, value: string][] = [];\n\n\t\tif ( Object.keys(config.values).length ) {\n\t\t\tconst ffz = window.FrankerFaceZ?.get(),\n\t\t\t\trouter = ffz && ffz.resolve('site.router') as any;\n\n\t\t\tif ( ! router )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tconst route = router.getRoute(name);\n\t\t\tif ( ! route || ! route.parts )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tlet i = 1;\n\t\t\tfor(const part of route.parts) {\n\t\t\t\tif ( typeof part === 'object' ) {\n\t\t\t\t\tconst val = config.values[part.name];\n\t\t\t\t\tif ( val && val.length )\n\t\t\t\t\t\tparts.push([i, val.toLowerCase()]);\n\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ctx => {\n\t\t\tif ( ! ctx.route || ! ctx.route_data || ctx.route.name !== name )\n\t\t\t\treturn false;\n\n\t\t\tfor(const [index, value] of parts) {\n\t\t\t\tlet thing = ctx.route_data[index];\n\t\t\t\tif ( typeof thing === 'string' )\n\t\t\t\t\tthing = thing.toLowerCase();\n\n\t\t\t\tif ( thing !== value )\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t},\n\n\ttall: true,\n\ttitle: 'Current Page',\n\ti18n: 'settings.filter.page',\n\n\tdefault: () => ({\n\t\troute: 'front-page',\n\t\tvalues: {}\n\t}),\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/page.vue')\n};\n\ntype ChannelData = {\n\tlogin: string | null;\n\tid: string | null;\n};\n\nexport const Channel: FilterType<ChannelData, ContextData> = {\n\tcreateTest(config) {\n\t\tconst login =  config?.login,\n\t\t\tid = config?.id;\n\n\t\tif ( ! id && ! login )\n\t\t\treturn NeverMatch;\n\n\t\telse if ( ! id )\n\t\t\treturn ctx => ctx.channel === login;\n\n\t\telse if ( ! login )\n\t\t\treturn ctx => ctx.channelID === id;\n\n\t\treturn ctx =>\n\t\t\tctx.channelID === id ||\n\t\t\t(ctx.channelID == null && ctx.channel === login);\n\t},\n\n\ttitle: 'Current Channel',\n\ti18n: 'settings.filter.channel',\n\n\tdefault: () => ({\n\t\tlogin: null,\n\t\tid: null\n\t}),\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/channel.vue')\n};\n\ntype CategoryData = {\n\tname: string | null;\n\tid: string | null;\n}\n\nexport const Category: FilterType<CategoryData, ContextData> = {\n\tcreateTest(config) {\n\t\tconst name = config?.name,\n\t\t\tid = config?.id;\n\n\t\tif ( ! id && ! name )\n\t\t\treturn NeverMatch;\n\n\t\telse if ( ! id )\n\t\t\treturn ctx => ctx.category === name;\n\n\t\telse if ( ! name )\n\t\t\treturn ctx => ctx.categoryID === id;\n\n\t\treturn ctx =>\n\t\t\tctx.categoryID === id ||\n\t\t\t(ctx.categoryID == null && ctx.category === name);\n\t},\n\n\ttitle: 'Current Category',\n\ti18n: 'settings.filter.category',\n\n\tdefault: () => ({\n\t\tname: null,\n\t\tid: null\n\t}),\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/category.vue')\n}\n\ntype TitleData = {\n\ttitle: string;\n\tmode: 'text' | 'glob' | 'raw' | 'regex';\n\tsensitive: boolean;\n};\n\nexport const Title: FilterType<TitleData, ContextData> = {\n\tcreateTest(config, _, reload) {\n\t\tconst mode = config?.mode;\n\t\tlet title = config?.title,\n\t\t\tneed_safety = true;\n\n\t\tif ( ! title || ! mode )\n\t\t\treturn NeverMatch;\n\n\t\tif ( mode === 'text' ) {\n\t\t\ttitle = escape_regex(title);\n\t\t\tneed_safety = false;\n\t\t} else if ( mode === 'glob' )\n\t\t\ttitle = glob_to_regex(title);\n\t\telse if ( mode !== 'raw' )\n\t\t\treturn NeverMatch;\n\n\t\tif ( need_safety ) {\n\t\t\tif ( ! safety )\n\t\t\t\tloadSafety(reload);\n\n\t\t\tif ( ! safety || ! safety(title) )\n\t\t\t\treturn NeverMatch;\n\t\t}\n\n\t\tlet regex: RegExp;\n\t\ttry {\n\t\t\tregex = new RegExp(title, `g${config.sensitive ? '' : 'i'}`);\n\t\t} catch(err) {\n\t\t\treturn NeverMatch;\n\t\t}\n\n\t\treturn ctx => {\n\t\t\tregex.lastIndex = 0;\n\t\t\treturn ctx.title ? regex.test(ctx.title): false;\n\t\t}\n\t},\n\n\ttitle: 'Current Title',\n\ti18n: 'settings.filter.title',\n\n\tdefault: () => ({\n\t\ttitle: '',\n\t\tmode: 'text',\n\t\tsensitive: false\n\t}),\n\n\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/title.vue')\n};\n\n// Monitor Stuff\n\ntype MonitorType = FilterType<ScreenOptions, ContextData> & {\n\t_used: boolean;\n\tdetails?: ScreenDetails | null | false;\n\n\tused: () => boolean;\n\n};\n\nexport let Monitor: MonitorType = null as any;\n\nif ( window.getScreenDetails ) {\n\n\tMonitor = {\n\t\t_used: false,\n\t\tdetails: undefined,\n\n\t\tused: () => {\n\t\t\tconst out = Monitor._used;\n\t\t\tMonitor._used = false;\n\t\t\treturn out;\n\t\t},\n\n\t\tcreateTest(config, _, reload) {\n\t\t\tif ( ! config?.label )\n\t\t\t\treturn NeverMatch;\n\n\t\t\tMonitor._used = true;\n\t\t\tif ( reload && Monitor.details === undefined ) {\n\t\t\t\tconst FFZ = window.FrankerFaceZ ?? ((window as any).FFZBridge as any),\n\t\t\t\t\tffz = FFZ?.get(),\n\t\t\t\t\tsettings = ffz?.resolve('settings');\n\t\t\t\tif ( settings )\n\t\t\t\t\tsettings.createMonitorUpdate().then(() => {\n\t\t\t\t\t\treload();\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn () => {\n\t\t\t\tMonitor._used = true;\n\t\t\t\tconst details = Monitor.details;\n\t\t\t\tif ( ! details )\n\t\t\t\t\treturn false;\n\n\t\t\t\tconst sorted = details.screens,\n\t\t\t\t\tmatched = matchScreen(sorted, config);\n\n\t\t\t\treturn matched === details.currentScreen;\n\t\t\t};\n\t\t},\n\n\t\tdefault: () => ({\n\t\t\tlabel: null\n\t\t}),\n\n\t\ttitle: 'Current Monitor',\n\t\ti18n: 'settings.filter.monitor',\n\n\t\teditor: () => import(/* webpackChunkName: 'main-menu' */ './components/monitor.vue')\n\t};\n\n}\n","'use strict';\n\n// ============================================================================\n// Settings System\n// ============================================================================\n\nimport { DEBUG } from 'utilities/constants';\nimport Module, { GenericModule, buildAddonProxy } from 'utilities/module';\nimport {deep_equals, has, debounce, deep_copy, generateUUID} from 'utilities/object';\nimport {PathNode, parse as parse_path} from 'utilities/path-parser';\n\nimport SettingsProfile from './profile';\nimport SettingsContext from './context';\n\nimport * as PROCESSORS from './processors';\nimport * as VALIDATORS from './validators';\nimport * as FILTERS from './filters';\nimport * as CLEARABLES from './clearables';\n\nimport type { SettingsProfileMetadata, ContextData, ExportedFullDump, SettingsClearable, SettingDefinition, SettingProcessor, SettingUiDefinition, SettingValidator, SettingType, ExportedBlobMetadata, SettingsKeys, AllSettingsKeys, ConcreteLocalStorageData } from './types';\nimport type { FilterType } from 'utilities/filtering';\nimport { AdvancedSettingsProvider, IndexedDBProvider, LocalStorageProvider, Providers, type SettingsProvider } from './providers';\nimport type { AddonInfo, SettingsTypeMap } from 'utilities/types';\n\nexport {parse as parse_path} from 'utilities/path-parser';\n\n\n// TODO: Special types for msg.\nfunction postMessage(target: MessageEventSource, msg: any) {\n\ttry {\n\t\t(target as Window).postMessage(msg, '*');\n\t\treturn true;\n\t} catch(err) {\n\t\treturn false;\n\t}\n}\n\nexport const NO_SYNC_KEYS = ['session'];\n\n\n// ============================================================================\n// Registration\n// ============================================================================\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\tsettings: SettingsEvents;\n\t}\n\tinterface ModuleMap {\n\t\tsettings: SettingsManager;\n\t}\n}\n\n\n// ============================================================================\n// Events\n// ============================================================================\n\n// TODO: Check settings keys for better typing on events.\n\nexport type SettingsEvents = {\n\t[K in keyof SettingsTypeMap as `:changed:${K}`]: [value: SettingsTypeMap[K], old_value: SettingsTypeMap[K]];\n} & {\n\t[key: `:uses_changed:${string}`]: [uses: number[] | null, old_uses: number[] | null];\n\n\t':added-definition': [key: SettingsKeys, definition: SettingDefinition<any>];\n\t':removed-definition': [key: SettingsKeys, definition: SettingDefinition<any>];\n\n\t':quota-exceeded': [];\n\t':change-provider': [];\n\n\t':ls-update': [key: string, value: any];\n\n\t':profile-created': [profile: SettingsProfile];\n\t':profile-changed': [profile: SettingsProfile];\n\t':profile-deleted': [profile: SettingsProfile];\n\t':profile-toggled': [profile: SettingsProfile, enabled: boolean];\n\t':profiles-reordered': [];\n};\n\n\n// ============================================================================\n// SettingsManager\n// ============================================================================\n\n/**\n * The SettingsManager module creates all the necessary class instances\n * required for the settings system to operate, facilitates communication\n * and discovery, and emits events for other modules to react to.\n */\nexport default class SettingsManager extends Module<'settings', SettingsEvents> {\n\n\t_start_time: number;\n\n\t// localStorage Hooks\n\tprivate __ls_hooked: boolean;\n\tprivate __ls_scheduled: Set<string>;\n\tprivate __ls_cache: Map<string, unknown>;\n\tprivate __ls_timer?: ReturnType<typeof setTimeout> | null;\n\n\n\t// Storage of Things\n\tclearables: Record<string, SettingsClearable>;\n\tfilters: Record<string, FilterType<any, ContextData>>;\n\tprocessors: Record<string, SettingProcessor<any>>;\n\tproviders: Record<string, typeof SettingsProvider>;\n\tvalidators: Record<string, SettingValidator<any>>;\n\n\t// Storage of Settings\n\tui_structures: Map<string, SettingDefinition<any>>;\n\tdefinitions: Map<string, SettingDefinition<any> | string[]>;\n\n\t// Storage of State\n\t// The provider *can* technically be null but it won't ever be in practice.\n\t// So we don't set the type to null to avoid making annoying checks everywhere.\n\tprovider: SettingsProvider = null as any;\n\tmain_context: SettingsContext;\n\n\tprivate _context_proxies: Set<MessageEventSource>;\n\n\tprivate _update_timer?: ReturnType<typeof setTimeout> | null;\n\tprivate _time_timer?: ReturnType<typeof setTimeout> | null;\n\tprivate _time_next?: number | null;\n\n\tprivate _active_provider: string = 'local';\n\n\tprivate _provider_waiter?: Promise<SettingsProvider> | null;\n\tprivate _provider_resolve?: ((input: SettingsProvider) => void) | null;\n\n\t/** @internal */\n\t__contexts: SettingsContext[];\n\t/** @internal */\n\t__profiles: SettingsProfile[];\n\tprivate __profile_ids: Record<number, SettingsProfile | null>;\n\tprivate __profile_uuids: Record<string, SettingsProfile | null>;\n\n\t/**\n\t * Whether or not profiles have been disabled for this session\n\t */\n\tdisable_profiles: boolean = false;\n\n\tupdateSoon: () => void;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.providers = {};\n\t\tfor(const [key, provider] of Object.entries(Providers)) {\n\t\t\tif ( provider.supported() )\n\t\t\t\tthis.providers[key] = provider;\n\t\t}\n\n\t\t// This cannot be modified at a future time, as providers NEED\n\t\t// to be ready very early in FFZ intitialization. Seal it.\n\t\tObject.seal(this.providers);\n\n\t\tthis.updateSoon = debounce(() => this.updateRoutes(), 50, false);\n\n\t\t// Do we want to not enable any profiles?\n\t\ttry {\n\t\t\tconst params = new URL(window.location as any).searchParams;\n\t\t\tif ( params ) {\n\t\t\t\tif ( params.has('ffz-no-settings') )\n\t\t\t\t\tthis.disable_profiles = true;\n\t\t\t}\n\t\t} catch(err) { /* no-op */ }\n\n\t\t// Local Storage\n\t\tthis.__ls_scheduled = new Set;\n\t\tthis.__ls_cache = new Map;\n\t\tthis.__ls_hooked = false;\n\t\tthis._updateLS = this._updateLS.bind(this);\n\n\t\t// State\n\t\tthis.__contexts = [];\n\t\tthis.__profiles = [];\n\t\tthis.__profile_ids = {};\n\t\tthis.__profile_uuids = {};\n\n\t\tthis.ui_structures = new Map;\n\t\tthis.definitions = new Map;\n\n\t\t// Validators\n\t\tthis.validators = {};\n\n\t\tfor(const key in VALIDATORS)\n\t\t\tif ( has(VALIDATORS, key) )\n\t\t\t\tthis.validators[key] = VALIDATORS[key];\n\n\t\t// Processors\n\t\tthis.processors = {};\n\n\t\tfor(const key in PROCESSORS)\n\t\t\tif ( has(PROCESSORS, key) )\n\t\t\t\tthis.processors[key] = PROCESSORS[key];\n\n\t\t// Clearable Data Rules\n\t\tthis.clearables = {};\n\n\t\tfor(const key in CLEARABLES)\n\t\t\tif ( has(CLEARABLES, key) )\n\t\t\t\tthis.clearables[key] = CLEARABLES[key];\n\n\t\t// Filters\n\t\tthis.filters = {};\n\n\t\tfor(const key in FILTERS)\n\t\t\tif ( has(FILTERS, key) && FILTERS[key] )\n\t\t\t\tthis.filters[key] = FILTERS[key];\n\n\n\t\t// Create our provider as early as possible.\n\t\tthis._createProvider().then(provider => {\n\t\t\tthis.provider = provider;\n\t\t\tthis.log.info(`Using Provider: ${provider.constructor.name}`);\n\t\t\tprovider.on('changed', this._onProviderChange, this);\n\t\t\tprovider.on('quota-exceeded', (err) => {\n\t\t\t\tthis.emit(':quota-exceeded');\n\t\t\t});\n\t\t\tprovider.on('change-provider', () => {\n\t\t\t\tthis.emit(':change-provider');\n\t\t\t});\n\n\t\t\tif ( this._provider_resolve )\n\t\t\t\tthis._provider_resolve(provider);\n\t\t});\n\n\t\t//this.migrations = new MigrationManager(this);\n\n\t\t// Also create the main context as early as possible.\n\t\tthis.main_context = new SettingsContext(this);\n\n\t\tthis.main_context.on('changed', (key: keyof SettingsTypeMap, new_value, old_value) => {\n\t\t\tthis.emit(`:changed:${key}`, new_value, old_value);\n\t\t});\n\n\t\tthis.main_context.on('uses_changed', (key: keyof SettingsTypeMap, new_uses, old_uses) => {\n\t\t\tthis.emit(`:uses_changed:${key}`, new_uses, old_uses);\n\t\t});\n\n\t\tthis.main_context.on('context_changed', () => this._updateContextProxies());\n\t\tthis._context_proxies = new Set;\n\n\t\twindow.addEventListener('message', event => {\n\t\t\tconst type = event.data?.ffz_type;\n\n\t\t\tif ( type === 'open-settings' )\n\t\t\t\tthis.emit('main_menu:open');\n\n\t\t\telse if ( type === 'request-context' && event.source ) {\n\t\t\t\tthis._context_proxies.add(event.source);\n\t\t\t\tthis._updateContextProxies(event.source);\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('beforeunload', () => {\n\t\t\tfor(const proxy of this._context_proxies)\n\t\t\t\tpostMessage(proxy, {ffz_type: 'context-gone'});\n\t\t});\n\n\t\t// Don't wait around to be required.\n\t\tthis._start_time = performance.now();\n\t\tthis.enable();\n\t}\n\n\t_updateContextProxies(proxy?: MessageEventSource) {\n\t\tif ( ! proxy && ! this._context_proxies.size )\n\t\t\treturn;\n\n\t\tconst ctx = JSON.parse(JSON.stringify(this.main_context._context));\n\t\tfor(const key of NO_SYNC_KEYS)\n\t\t\tif ( has(ctx, key) )\n\t\t\t\tdelete ctx[key];\n\n\t\tif ( proxy )\n\t\t\tpostMessage(proxy, {ffz_type: 'context-update', ctx});\n\t\telse\n\t\t\tfor(const proxy of this._context_proxies)\n\t\t\t\tpostMessage(proxy, {ffz_type: 'context-update', ctx});\n\t}\n\n\n\taddFilter<T>(key: string, data: FilterType<T, ContextData>) {\n\t\tif ( this.filters[key] )\n\t\t\treturn this.log.warn('Tried to add already existing filter', key);\n\n\t\tthis.filters[key] = data;\n\t\tthis.updateRoutes();\n\t}\n\n\tgetFilterBasicEditor() { // eslint-disable-line class-methods-use-this\n\t\treturn () => import(/* webpackChunkName: 'main-menu' */ './components/basic-toggle.vue')\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = [];\n\t\tfor(const [key, value] of (this.main_context as any).__cache.entries())\n\t\t\tout.push(`${key}: ${JSON.stringify(value)}`);\n\n\t\treturn out.join('\\n');\n\t}\n\n\tawaitProvider() {\n\t\tif ( this.provider )\n\t\t\treturn Promise.resolve(this.provider);\n\n\t\tif ( this._provider_waiter )\n\t\t\treturn this._provider_waiter;\n\n\t\treturn this._provider_waiter = new Promise<SettingsProvider>((resolve, reject) => {\n\t\t\tthis._provider_resolve = resolve;\n\t\t}).finally(() => {\n\t\t\tthis._provider_waiter = null;\n\t\t\tthis._provider_resolve = null;\n\t\t});\n\t}\n\n\n\t/**\n\t * Called when the SettingsManager instance should be enabled.\n\t */\n\tasync onEnable() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\tthrow new Error('did not get provider');\n\n\t\tawait this.provider.awaitReady();\n\n\t\t// When the router updates we additional routes, make sure to\n\t\t// trigger a rebuild of profile context and re-select profiles.\n\t\tthis.on('site.router:updated-routes', this.updateRoutes, this);\n\n\t\t// Load profiles, but don't run any events because we haven't done\n\t\t// migrations yet.\n\t\tthis.loadProfiles(true);\n\n\t\t// Handle migrations.\n\t\t//await this.migrations.process('core');\n\n\t\t// Now we can tell our context(s) about the profiles we have.\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tconst duration = performance.now() - this._start_time;\n\t\tthis.log.info(`Initialization complete after ${duration.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`)\n\n\t\tthis.scheduleUpdates();\n\t\tthis.updateClock();\n\t}\n\n\n\tasync createMonitorUpdate() {\n\t\tconst Monitor = FILTERS?.Monitor;\n\t\tif ( ! Monitor || Monitor.details !== undefined )\n\t\t\treturn;\n\n\t\tMonitor.details = null;\n\t\ttry {\n\t\t\tif ( window.getScreenDetails ) {\n\t\t\t\tMonitor.details = await window.getScreenDetails();\n\t\t\t\tMonitor.details.addEventListener('currentscreenchange', () => {\n\t\t\t\t\tfor(const context of this.__contexts)\n\t\t\t\t\t\tcontext.selectProfiles();\n\t\t\t\t});\n\t\t\t} else\n\t\t\t\tMonitor.details = false;\n\n\t\t} catch(err) {\n\t\t\tthis.log.error('Unable to get monitor details', err);\n\t\t\tMonitor.details = false;\n\t\t}\n\t}\n\n\n\tupdateClock() {\n\t\tconst captured = FILTERS?.Time?.captured?.();\n\t\tif ( ! captured?.length )\n\t\t\treturn;\n\n\t\tif ( this._time_timer )\n\t\t\tclearTimeout(this._time_timer);\n\n\t\tconst d = new Date,\n\t\t\tnow = d.getHours() * 60 + d.getMinutes();\n\n\t\tlet next = this._time_next != null ? this._time_next : null;\n\t\tfor(const value of captured) {\n\t\t\tif ( value <= now )\n\t\t\t\tcontinue;\n\n\t\t\tif ( next == null || value < next )\n\t\t\t\tnext = value;\n\t\t}\n\n\t\t// There's no time waiting for today. Skip to the next day.\n\t\tif ( next == null )\n\t\t\tnext = captured[0] + 1440;\n\n\t\t// Determine how long it'll take to reach the next time period.\n\t\tconst delta = (next - now) * 60 * 1000 - 59750 + (60000 - Date.now() % 60000);\n\t\tthis._time_timer = setTimeout(() => {\n\t\t\tfor(const context of this.__contexts)\n\t\t\t\tcontext.selectProfiles();\n\n\t\t\tthis.updateClock();\n\t\t}, delta);\n\t}\n\n\n\t// ========================================================================\n\t// LocalStorage Management\n\t// ========================================================================\n\n\tprivate _updateLSKey(key: string) {\n\t\tif ( this.__ls_cache.has(key) || this.__ls_cache.has(`raw.${key}`) ) {\n\t\t\tthis.__ls_scheduled.add(key);\n\t\t\tif ( ! this.__ls_timer )\n\t\t\t\tthis.__ls_timer = setTimeout(this._updateLS, 0);\n\t\t}\n\n\n\n\t}\n\n\tprivate _hookLS() {\n\t\tif ( this.__ls_hooked )\n\t\t\treturn;\n\n\t\tthis.__ls_hooked = true;\n\t\tconst original = localStorage.setItem,\n\t\t\tt = this;\n\n\t\tlocalStorage.setItem = function(key, ...args) {\n\t\t\t// Guard this because we never want to break\n\t\t\t// localStorage, even if something really\n\t\t\t// weird happens.\n\t\t\ttry {\n\t\t\t\tt._updateLSKey(key);\n\t\t\t} catch(err) { /* no-op */ }\n\n\t\t\treturn original.call(this, key, ...args);\n\t\t}\n\n\t\tthis._handleLSEvent = this._handleLSEvent.bind(this);\n\t\twindow.addEventListener('storage', this._handleLSEvent);\n\t}\n\n\tprivate _handleLSEvent(event: StorageEvent) {\n\t\tif ( event.key && event.storageArea === localStorage )\n\t\t\tthis._updateLSKey(event.key);\n\t}\n\n\tprivate _updateLS() {\n\t\tclearTimeout(this.__ls_timer as ReturnType<typeof setTimeout>);\n\t\tthis.__ls_timer = null;\n\t\tconst keys = this.__ls_scheduled;\n\t\tthis.__ls_scheduled = new Set;\n\n\t\tfor(const key of keys) {\n\t\t\tconst has_value = this.__ls_cache.has(key),\n\t\t\t\traw_key = `raw.${key}`,\n\t\t\t\thas_raw = this.__ls_cache.has(raw_key);\n\n\t\t\tif ( ! has_raw && ! has_value )\n\t\t\t\tcontinue;\n\n\t\t\tconst raw = localStorage.getItem(key);\n\n\t\t\tif ( has_raw ) {\n\t\t\t\tthis.__ls_cache.set(raw_key, raw);\n\t\t\t\tthis.emit(':ls-update', raw_key, raw);\n\t\t\t}\n\n\t\t\tif ( has_value ) {\n\t\t\t\tlet value;\n\t\t\t\tif ( raw )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = JSON.parse(raw);\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.log.warn(`Unable to parse localStorage value as JSON for \"${key}\"`, err);\n\t\t\t\t\t}\n\n\t\t\t\tthis.__ls_cache.set(key, value);\n\t\t\t\tthis.emit(':ls-update', key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetLS<T>(key: string): T | null {\n\t\tif ( this.__ls_cache.has(key) )\n\t\t\treturn this.__ls_cache.get(key) as T;\n\n\t\tif ( ! this.__ls_hooked )\n\t\t\tthis._hookLS();\n\n\t\tconst is_raw = key.startsWith('raw.'),\n\t\t\traw = localStorage.getItem(is_raw ? key.slice(4) : key);\n\n\t\tlet value;\n\t\tif ( is_raw )\n\t\t\tvalue = raw;\n\t\telse\n\t\t\ttry {\n\t\t\t\tvalue = raw ? JSON.parse(raw) : null;\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn(`Unable to parse localStorage value as JSON for \"${key}\"`, err);\n\t\t\t}\n\n\t\tthis.__ls_cache.set(key, value);\n\t\treturn value;\n\t}\n\n\n\t// ========================================================================\n\t// Backup and Restore\n\t// ========================================================================\n\n\tasync generateBackupFile() {\n\t\tconst now = new Date(),\n\t\t\ttimestamp = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;\n\n\t\tif ( await this._needsZipBackup() ) {\n\t\t\tconst blob = await this._getZipBackup();\n\t\t\treturn new File([blob], `ffz-settings (${timestamp}).zip`, {type: 'application/zip'});\n\t\t}\n\n\t\tconst settings = await this.getSettingsDump();\n\t\treturn new File([JSON.stringify(settings)], `ffz-settings (${timestamp}).json`, {type: 'application/json;charset=utf-8'});\n\t}\n\n\n\tprivate async _needsZipBackup() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\treturn false;\n\n\t\tawait this.provider.awaitReady();\n\n\t\tif ( !(this.provider instanceof AdvancedSettingsProvider) || ! this.provider.supportsBlobs )\n\t\t\treturn false;\n\n\t\tconst keys = await this.provider.blobKeys();\n\t\treturn Array.isArray(keys) ? keys.length > 0 : false;\n\t}\n\n\n\tprivate async _getZipBackup() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\tthrow new Error('provider not available');\n\n\t\tawait this.provider.awaitReady();\n\n\t\t// Create our ZIP file.\n\t\tconst JSZip = (await import(/* webpackChunkName: \"zip\" */ 'jszip')).default,\n\t\t\tout = new JSZip();\n\n\t\t// Normal Settings\n\t\tconst settings = await this.getSettingsDump();\n\t\tout.file('settings.json', JSON.stringify(settings));\n\n\t\t// Blob Settings\n\t\tconst metadata: Record<string, ExportedBlobMetadata> = {};\n\n\t\tif ( this.provider instanceof AdvancedSettingsProvider && this.provider.supportsBlobs ) {\n\t\t\tconst keys = await this.provider.blobKeys();\n\t\t\tfor(const key of keys) {\n\t\t\t\tconst safe_key = encodeURIComponent(key),\n\t\t\t\t\tblob = await this.provider.getBlob(key); // eslint-disable-line no-await-in-loop\n\t\t\t\tif ( ! blob )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst md: ExportedBlobMetadata = {\n\t\t\t\t\tkey\n\t\t\t\t};\n\n\t\t\t\tif ( blob instanceof File ) {\n\t\t\t\t\tmd.type = 'file';\n\t\t\t\t\tmd.name = blob.name;\n\t\t\t\t\tmd.modified = blob.lastModified;\n\t\t\t\t\tmd.mime = blob.type;\n\n\t\t\t\t} else if ( blob instanceof Blob ) {\n\t\t\t\t\tmd.type = 'blob';\n\n\t\t\t\t} else if ( blob instanceof ArrayBuffer ) {\n\t\t\t\t\tmd.type = 'ab';\n\t\t\t\t} else if ( blob instanceof Uint8Array ) {\n\t\t\t\t\tmd.type = 'ui8';\n\t\t\t\t} else\n\t\t\t\t\tcontinue;\n\n\t\t\t\tmetadata[safe_key] = md;\n\t\t\t\tout.file(`blobs/${safe_key}`, blob);\n\t\t\t}\n\t\t}\n\n\t\tout.file('blobs.json', JSON.stringify(metadata));\n\n\t\treturn out.generateAsync({type: 'blob'});\n\t}\n\n\n\tasync getSettingsDump() {\n\t\t// Before we do anything else, make sure the provider is ready.\n\t\tawait this.awaitProvider();\n\t\tif ( ! this.provider )\n\t\t\treturn null;\n\n\t\tawait this.provider.awaitReady();\n\n\t\tconst out: ExportedFullDump = {\n\t\t\tversion: 2,\n\t\t\ttype: 'full',\n\t\t\tvalues: {}\n\t\t};\n\n\t\tfor(const [key, value] of this.provider.entries())\n\t\t\tout.values[key] = value;\n\n\t\treturn out;\n\t}\n\n\n\tscheduleUpdates() {\n\t\tif ( this._update_timer )\n\t\t\tclearTimeout(this._update_timer);\n\n\t\tthis._update_timer = setTimeout(() => this.checkUpdates(), 5000);\n\t}\n\n\n\tasync checkUpdates() {\n\t\tawait this.awaitProvider();\n\t\tawait this.provider?.awaitReady();\n\n\t\tif ( ! this.provider?.shouldUpdate )\n\t\t\treturn;\n\n\t\tconst promises = [];\n\t\tfor(const profile of this.__profiles) {\n\t\t\tif ( ! profile || ! profile.url || profile.pause_updates )\n\t\t\t\tcontinue;\n\n\t\t\tconst out = profile.checkUpdate();\n\t\t\tpromises.push(out instanceof Promise ? out : Promise.resolve(out));\n\t\t}\n\n\t\tconst data = await Promise.all(promises);\n\n\t\tlet success = 0;\n\t\tfor(const thing of data)\n\t\t\tif ( thing )\n\t\t\t\tsuccess++;\n\n\t\tthis.log.info(`Successfully refreshed ${success} of ${data.length} profiles from remote URLs.`);\n\t}\n\n\n\t// ========================================================================\n\t// Provider Interaction\n\t// ========================================================================\n\n\t/**\n\t * Return an object with all the known, supported providers.\n\t * @returns {Object} The object.\n\t */\n\tgetProviders() {\n\t\treturn this.providers;\n\t}\n\n\t/**\n\t * Return the key of the active provider.\n\t * @returns {String} The key for the active provider\n\t */\n\tgetActiveProvider() {\n\t\treturn this._active_provider;\n\t}\n\n\t/**\n\t * Evaluate the environment that FFZ is running in and then decide which\n\t * provider should be used to retrieve and store settings.\n\t *\n\t * @returns {SettingsProvider} The provider to store everything.\n\t */\n\tasync _createProvider() {\n\t\t// If we should be using Cross-Origin Storage Bridge, do so.\n\t\t//if ( this.providers.cosb && this.providers.cosb.supported() )\n\t\t//\treturn new this.providers.cosb(this);\n\n\t\tlet wanted = localStorage.ffzProviderv2;\n\t\tif ( wanted == null )\n\t\t\twanted = localStorage.ffzProviderv2 = await this.sniffProvider();\n\n\t\tif ( this.providers[wanted] ) {\n\t\t\tconst provider = new (this.providers[wanted] as any)(this) as SettingsProvider;\n\t\t\tthis._active_provider = wanted;\n\t\t\treturn provider;\n\t\t}\n\n\t\t// Fallback to localStorage if nothing else was wanted and available.\n\t\tthis._active_provider = 'local';\n\t\treturn new LocalStorageProvider(this);\n\t}\n\n\n\t/**\n\t * Evaluate the environment and attempt to guess which provider we should\n\t * use for storing settings. This is necessary in case localStorage is\n\t * cleared while we have settings stored in IndexedDB.\n\t *\n\t * In the future, this may default to IndexedDB for new users.\n\t *\n\t * @returns {String} The key for which provider we should use.\n\t */\n\tasync sniffProvider() {\n\t\tconst providers = Array.from(Object.entries(this.providers));\n\t\tproviders.sort((a, b) =>\n\t\t\t((b[1] as any).priority ?? 0) -\n\t\t\t((a[1] as any).priority ?? 0)\n\t\t);\n\n\t\tfor(const [key, provider] of providers) {\n\t\t\tif ( provider.supported() && await provider.hasContent() ) // eslint-disable-line no-await-in-loop\n\t\t\t\treturn key;\n\t\t}\n\n\t\t// Fallback to local if no provider indicated present settings.\n\t\treturn 'local';\n\t}\n\n\t/**\n\t * Change to a new settings provider. This immediately prevents changes\n\t * to the old provider, and will reload the page when settings have\n\t * been transfered over.\n\t *\n\t * @param {String} key The key of the new provider to swap to.\n\t * @param {Boolean} transfer Whether or not settings should be transferred\n\t * from the current provider.\n\t */\n\tasync changeProvider(key: string, transfer: boolean) {\n\t\tif ( ! this.providers[key] || ! this.providers[key].supported() )\n\t\t\tthrow new Error(`Invalid provider: ${key}`);\n\n\t\t// If we're changing to the current provider... well, that doesn't make\n\t\t// a lot of sense, does it? Abort!\n\t\tif ( key === this._active_provider || ! this.provider )\n\t\t\treturn;\n\n\t\tconst old_provider = this.provider;\n\t\tthis.provider = null as any;\n\n\t\t// Let all other tabs know what's up.\n\t\told_provider.broadcastTransfer();\n\n\t\t// Are we transfering settings?\n\t\tif ( transfer ) {\n\t\t\tconst new_provider = new (this.providers[key] as any)(this) as SettingsProvider;\n\t\t\tawait new_provider.awaitReady();\n\n\t\t\tif ( new_provider.allowTransfer && old_provider.allowTransfer ) {\n\t\t\t\told_provider.disableEvents();\n\n\t\t\t\t// When transfering, we clear all existing settings.\n\t\t\t\tnew_provider.clear();\n\t\t\t\tif ( new_provider instanceof AdvancedSettingsProvider && new_provider.supportsBlobs )\n\t\t\t\t\tawait new_provider.clearBlobs();\n\n\t\t\t\t// Wait for it to do that.\n\t\t\t\tawait new_provider.flush();\n\n\t\t\t\tfor(const [key,val] of old_provider.entries())\n\t\t\t\t\tnew_provider.set(key, val);\n\n\t\t\t\tif ( old_provider instanceof AdvancedSettingsProvider && old_provider.supportsBlobs && new_provider instanceof AdvancedSettingsProvider && new_provider.supportsBlobs ) {\n\t\t\t\t\tfor(const key of await old_provider.blobKeys() ) {\n\t\t\t\t\t\tconst blob = await old_provider.getBlob(key); // eslint-disable-line no-await-in-loop\n\t\t\t\t\t\tif ( blob )\n\t\t\t\t\t\t\tawait new_provider.setBlob(key, blob); // eslint-disable-line no-await-in-loop\n\t\t\t\t\t}\n\n\t\t\t\t\tawait old_provider.clearBlobs();\n\t\t\t\t}\n\n\t\t\t\told_provider.clear();\n\n\t\t\t\tawait old_provider.flush();\n\t\t\t\tawait new_provider.flush();\n\t\t\t}\n\t\t}\n\n\t\t// Change over.\n\t\tlocalStorage.ffzProviderv2 = key;\n\t\tlocation.reload();\n\t}\n\n\n\t/**\n\t * React to a setting that has changed elsewhere. Generally, this is\n\t * the result of a setting being changed in another tab or, when cloud\n\t * settings are enabled, on another computer.\n\t */\n\t_onProviderChange(key: string, new_value: any, deleted: boolean) {\n\t\t// If profiles have changed, reload our profiles.\n\t\tif ( key === 'profiles' )\n\t\t\treturn this.loadProfiles();\n\n\t\tif ( ! key.startsWith('p:') )\n\t\t\treturn;\n\n\t\t// If we're still here, it means an individual setting was changed.\n\t\t// Look up the profile it belongs to and emit a changed event from\n\t\t// that profile, thus notifying any contexts or UI instances.\n\t\tkey = key.slice(2);\n\n\t\t// Is it a value?\n\t\tconst idx = key.indexOf(':');\n\t\tif ( idx === -1 )\n\t\t\treturn;\n\n\t\tconst profile = this.__profile_ids[key.slice(0, idx) as any],\n\t\t\ts_key = key.slice(idx + 1);\n\n\t\tif ( profile && ! profile.ephemeral ) {\n\t\t\tif ( s_key === ':enabled' )\n\t\t\t\tprofile.emit('toggled', profile, deleted ? true : new_value);\n\t\t\telse\n\t\t\t\tprofile.emit('changed', s_key, new_value, deleted);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Profile Management\n\t// ========================================================================\n\n\tupdateRoutes() {\n\t\t// Clear the existing matchers.\n\t\tfor(const profile of this.__profiles)\n\t\t\tprofile.clearMatcher();\n\n\t\t// And then re-select the active profiles.\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t}\n\n\n\t_onProfileToggled(profile: SettingsProfile, enabled: boolean) {\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t\tthis.emit(':profile-toggled', profile, enabled);\n\t}\n\n\n\t/**\n\t * Get an existing {@link SettingsProfile} instance.\n\t * @param id  - The id or uuid of the profile.\n\t */\n\tprofile(id: number | string): SettingsProfile | null {\n\t\treturn this.__profile_uuids[id] ?? this.__profile_ids[id as number] ?? null;\n\t}\n\n\n\t/**\n\t * Build {@link SettingsProfile} instances for all of the profiles\n\t * defined in storage, re-using existing instances when possible.\n\t */\n\tloadProfiles(suppress_events: boolean = false) {\n\t\tconst old_profile_ids = this.__profile_ids,\n\t\t\told_profile_uuids = this.__profile_uuids,\n\t\t\told_profiles = this.__profiles,\n\n\t\t\tprofile_ids: Record<number, SettingsProfile> = this.__profile_ids = {},\n\t\t\tprofiles: SettingsProfile[] = this.__profiles = [],\n\t\t\tprofile_uuids: Record<string, SettingsProfile> = this.__profile_uuids = {},\n\n\t\t\t// Create a set of actual IDs with a map from the profiles\n\t\t\t// list rather than just getting the keys from the ID map\n\t\t\t// because the ID map is an object and coerces its strings\n\t\t\t// to keys.\n\t\t\told_ids = new Set(old_profiles.map(x => x.id)),\n\n\t\t\tnew_ids = new Set<number>,\n\t\t\tchanged_ids = new Set<number>;\n\n\t\tlet raw_profiles = this.provider?.get<SettingsProfileMetadata[]>('profiles') ?? [\n\t\t\tSettingsProfile.Moderation,\n\t\t\tSettingsProfile.Default\n\t\t];\n\n\t\t// Sanity check. If we have no profiles, delete the old data.\n\t\tif ( ! raw_profiles?.length ) {\n\t\t\tthis.provider?.delete('profiles');\n\t\t\traw_profiles = [\n\t\t\t\tSettingsProfile.Moderation,\n\t\t\t\tSettingsProfile.Default\n\t\t\t];\n\t\t}\n\n\t\t// Update: Add UUIDs to all profiles.\n\t\tlet need_save = false;\n\n\t\tfor(const profile of raw_profiles) {\n\t\t\tif ( ! profile.uuid ) {\n\t\t\t\tneed_save = true;\n\n\t\t\t\tif ( profile.i18n_key === SettingsProfile.Default.i18n_key )\n\t\t\t\t\tprofile.uuid = SettingsProfile.Default.uuid as string;\n\t\t\t\telse if ( profile.i18n_key === SettingsProfile.Moderation.i18n_key )\n\t\t\t\t\tprofile.uuid = SettingsProfile.Moderation.uuid as string;\n\t\t\t\telse\n\t\t\t\t\tprofile.uuid = generateUUID();\n\t\t\t}\n\t\t}\n\n\t\tif ( need_save )\n\t\t\tthis.provider?.set('profiles', raw_profiles);\n\n\t\tlet reordered = false,\n\t\t\tchanged = false;\n\n\t\tfor(const profile of old_profiles) {\n\t\t\tprofile.off('toggled', this._onProfileToggled, this);\n\t\t\tprofile.hotkey_enabled = false;\n\t\t}\n\n\t\tfor(const profile_data of raw_profiles) {\n\t\t\tconst id = profile_data.id as number,\n\t\t\t\tslot_id = profiles.length,\n\t\t\t\told_profile = old_profile_ids[id],\n\t\t\t\told_slot_id = old_profile ? old_profiles.indexOf(old_profile) : -1;\n\n\t\t\told_ids.delete(id);\n\n\t\t\tif ( old_slot_id !== slot_id )\n\t\t\t\treordered = true;\n\n\t\t\tif ( old_profile && deep_equals(old_profile.data, profile_data, true) ) {\n\t\t\t\t// Did the order change?\n\t\t\t\tif ( old_slot_id !== slot_id )\n\t\t\t\t\tchanged = true;\n\n\t\t\t\tprofiles.push(profile_ids[id] = old_profile);\n\t\t\t\tprofile_uuids[old_profile.uuid] = old_profile;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst new_profile = profile_ids[id] = new SettingsProfile(this, profile_data);\n\t\t\tif ( old_profile ) {\n\t\t\t\told_profile.transferListeners(new_profile);\n\t\t\t\tchanged_ids.add(id);\n\n\t\t\t} else\n\t\t\t\tnew_ids.add(id);\n\n\t\t\tprofiles.push(new_profile);\n\t\t\tprofile_uuids[new_profile.uuid] = new_profile;\n\t\t\tchanged = true;\n\t\t}\n\n\t\tfor(const profile of profiles) {\n\t\t\tprofile.on('toggled', this._onProfileToggled, this);\n\t\t\tprofile.hotkey_enabled = true;\n\t\t}\n\n\t\tif ( ! changed && ! old_ids.size || suppress_events )\n\t\t\treturn;\n\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\n\t\tfor(const id of new_ids)\n\t\t\tthis.emit(':profile-created', profile_ids[id]);\n\n\t\tfor(const id of changed_ids)\n\t\t\tthis.emit(':profile-changed', profile_ids[id]);\n\n\t\tif ( reordered )\n\t\t\tthis.emit(':profiles-reordered');\n\t}\n\n\n\t/**\n\t * Create a new profile and return the {@link SettingsProfile} instance\n\t * representing it.\n\t */\n\tcreateProfile(options: Partial<SettingsProfileMetadata> = {}) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to create profile before settings have initialized. Please await enable()');\n\n\t\tif ( options.id !== undefined )\n\t\t\tthrow new Error('You cannot specify an ID when creating a profile.');\n\n\t\tlet id = 0;\n\n\t\t// Find the next available profile ID.\n\t\twhile ( this.__profile_ids[id] ) {\n\t\t\t// Ephemeral profiles have negative IDs.\n\t\t\toptions.ephemeral ? id-- : id++;\n\t\t}\n\n\t\toptions.id = id;\n\t\toptions.uuid = generateUUID();\n\n\t\tif ( ! options.name )\n\t\t\toptions.name = `Unnamed Profile ${this.__profiles.length + 1}`;\n\n\t\tconst profile = this.__profile_ids[id] = new SettingsProfile(this, options);\n\t\tthis.__profile_uuids[options.uuid] = profile;\n\t\tthis.__profiles.unshift(profile);\n\n\t\tprofile.on('toggled', this._onProfileToggled, this);\n\t\tprofile.hotkey_enabled = true;\n\n\t\t// Don't bother saving if it's ephemeral.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-created', profile);\n\t\treturn profile;\n\t}\n\n\n\t/**\n\t * Delete a profile.\n\t *\n\t * @param id - The ID of the profile to delete, or just the profile itself.\n\t */\n\tdeleteProfile(id: number | SettingsProfile) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to delete profile before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\tif ( this.__profiles.length === 1 )\n\t\t\tthrow new Error('cannot delete only profile');\n\n\t\t/*if ( profile.id === 0 )\n\t\t\tthrow new Error('cannot delete default profile');*/\n\n\t\tprofile.off('toggled', this._onProfileToggled, this);\n\t\tprofile.clear();\n\t\tthis.__profile_ids[id] = null;\n\t\tthis.__profile_uuids[profile.uuid] = null;\n\n\t\tconst idx = this.__profiles.indexOf(profile);\n\t\tif ( idx !== -1 )\n\t\t\tthis.__profiles.splice(idx, 1);\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-deleted', profile);\n\t}\n\n\n\tmoveProfile(id: number | SettingsProfile, index: number) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to move profiles before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\tconst profiles = this.__profiles,\n\t\t\tidx = profiles.indexOf(profile);\n\t\tif ( idx === index )\n\t\t\treturn;\n\n\t\tprofiles.splice(index, 0, ...profiles.splice(idx, 1));\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profiles-reordered');\n\t}\n\n\n\tsaveProfile(id: number | SettingsProfile) {\n\t\tif ( ! this.enabled )\n\t\t\tthrow new Error('Unable to save profile before settings have initialized. Please await enable()');\n\n\t\tif ( typeof id === 'object' && typeof id.id === 'number' )\n\t\t\tid = id.id;\n\t\telse if ( typeof id !== 'number' )\n\t\t\tthrow new Error('Invalid profile');\n\n\t\tconst profile = this.__profile_ids[id];\n\t\tif ( ! profile )\n\t\t\treturn;\n\n\t\t// If it wasn't an ephemeral profile, go ahead and update.\n\t\tif ( ! profile.ephemeral )\n\t\t\tthis._saveProfiles();\n\n\t\tthis.emit(':profile-changed', profile);\n\t}\n\n\n\t_saveProfiles() {\n\t\tconst out = this.__profiles\n\t\t\t.filter(prof => ! prof.ephemeral)\n\t\t\t.map(prof => prof.data);\n\n\t\t// Ensure that we always have a non-ephemeral profile.\n\t\tif ( ! out ) {\n\t\t\tthis.createProfile({\n\t\t\t\tname: 'Default Profile',\n\t\t\t\ti18n_key: 'setting.profiles.default',\n\t\t\t\tdescription: 'Settings that apply everywhere on Twitch.'\n\t\t\t});\n\n\t\t\t// Just return. Creating the profile will call this method again.\n\t\t\treturn;\n\t\t}\n\n\t\tthis.provider?.set('profiles', out);\n\t\tfor(const context of this.__contexts)\n\t\t\tcontext.selectProfiles();\n\n\t\tthis.updateClock();\n\t}\n\n\n\t// ========================================================================\n\t// Context Helpers\n\t// ========================================================================\n\n\tcontext(env: ContextData) {\n\t\treturn this.main_context.context(env);\n\t}\n\n\tget<\n\t\tK extends AllSettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K): TValue {\n\t\treturn this.main_context.get(key);\n\t}\n\n\tgetChanges<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(\n\t\tkey: K,\n\t\tfn: (val: TValue) => void,\n\t\tctx?: any\n\t) { return this.main_context.getChanges(key, fn, ctx); }\n\n\tonChange<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(\n\t\tkey: K,\n\t\tfn: (val: TValue) => void,\n\t\tctx?: any\n\t) { return this.main_context.onChange(key, fn, ctx); }\n\n\tuses<K extends AllSettingsKeys>(key: K) { return this.main_context.uses(key) }\n\tupdate<K extends SettingsKeys>(key: K) { return this.main_context.update(key) }\n\n\tupdateContext(context: ContextData) { return this.main_context.updateContext(context) }\n\tsetContext(context: ContextData) { return this.main_context.setContext(context) }\n\n\n\t// ========================================================================\n\t// Add-On Proxy\n\t// ========================================================================\n\n\tgetAddonProxy(addon_id: string, addon: AddonInfo, module: GenericModule) {\n\t\tif ( ! addon_id )\n\t\t\treturn this;\n\n\t\tconst overrides: Record<string, any> = {},\n\t\t\tis_dev = DEBUG || addon?.dev;\n\n\t\toverrides.add = <\n\t\t\tK extends SettingsKeys,\n\t\t\tTValue = SettingType<K>,\n\t\t>(key: K, definition: SettingDefinition<TValue>) => {\n\t\t\treturn this.add(key, definition, addon_id);\n\t\t};\n\n\t\t// TODO: Update addUI here too\n\t\toverrides.addUI = <\n\t\t\tK extends string,\n\t\t\tTValue = K extends SettingsKeys ? SettingType<K> : unknown,\n\t\t>(key: K, definition: SettingUiDefinition<TValue>) => {\n\t\t\treturn this.addUI(key, definition, addon_id);\n\t\t};\n\n\t\toverrides.addClearable = (key: string, definition: SettingsClearable) => {\n\t\t\treturn this.addClearable(key, definition, addon_id);\n\t\t}\n\n\t\treturn buildAddonProxy(module, this, 'settings', overrides);\n\t}\n\n\t// ========================================================================\n\t// Definitions\n\t// ========================================================================\n\n\tadd<\n\t\tK extends SettingsKeys,\n\t\tTValue = SettingType<K>\n\t>(key: K, definition: SettingDefinition<TValue>, source?: string) {\n\n\t\tconst old_definition = this.definitions.get(key),\n\t\t\trequired_by = (Array.isArray(old_definition)\n\t\t\t\t? old_definition\n\t\t\t\t: old_definition?.required_by) ?? [];\n\n\t\tdefinition.required_by = required_by;\n\t\tdefinition.requires = definition.requires ?? [];\n\n\t\tdefinition.__source = source;\n\n\t\tfor(const req_key of definition.requires) {\n\t\t\tconst req = this.definitions.get(req_key);\n\t\t\tif ( Array.isArray(req) )\n\t\t\t\treq.push(key);\n\t\t\telse if ( req )\n\t\t\t\treq.required_by?.push(key);\n\t\t\telse\n\t\t\t\tthis.definitions.set(req_key, [key]);\n\t\t}\n\n\n\t\tif ( definition.ui ) {\n\t\t\tconst ui = definition.ui;\n\t\t\tui.path_tokens = ui.path_tokens ?\n\t\t\t\tformat_path_tokens(ui.path_tokens) :\n\t\t\t\tui.path ?\n\t\t\t\t\tparse_path(ui.path) :\n\t\t\t\t\tundefined;\n\n\t\t\tif ( source && ui.path_tokens && ui.path_tokens.length >= 2 && ui.path_tokens[0].key === 'add_ons' ) {\n\t\t\t\tconst addons = this.resolve('addons'),\n\t\t\t\t\taddon = addons?.getAddon(source);\n\n\t\t\t\tif ( addon ) {\n\t\t\t\t\tconst test = ui.path_tokens[1] as any,\n\t\t\t\t\t\tlinks: string[] = [];\n\n\t\t\t\t\tlinks.push(`add_ons.changelog.${source}`);\n\t\t\t\t\tif ( addon.short_name )\n\t\t\t\t\t\tlinks.push(`add_ons.changelog.${addon.short_name.toSnakeCase()}`);\n\t\t\t\t\tif ( addon.name )\n\t\t\t\t\t\tlinks.push(`add_ons.changelog.${addon.name.toSnakeCase()}`);\n\n\t\t\t\t\ttest.header_links = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnavigate: links,\n\t\t\t\t\t\t\ti18n_key: 'home.changelog',\n\t\t\t\t\t\t\ttitle: 'Changelog'\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! ui.key && key )\n\t\t\t\tui.key = key;\n\n\t\t\tif ( ! ui.key && ui.title )\n\t\t\t\tui.key = ui.title.toSnakeCase();\n\n\t\t\tif ( (ui.component === 'setting-select-box' ||\n\t\t\t\t  ui.component === 'setting-combo-box') &&\n\t\t\t\tArray.isArray(ui.data) && ! ui.no_i18n\n\t\t\t) {\n\t\t\t\tconst i18n_base = `${ui.i18n_key || `setting.entry.${key}`}.values`;\n\t\t\t\tfor(const value of ui.data) {\n\t\t\t\t\tif ( value.i18n_key === undefined && value.value !== undefined )\n\t\t\t\t\t\tvalue.i18n_key = `${i18n_base}.${value.value}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( definition.changed )\n\t\t\tthis.on(`:changed:${key}` as any, definition.changed);\n\n\t\tthis.definitions.set(key, definition);\n\n\t\t// Do not re-emit `added-definition` when re-adding an existing\n\t\t// setting. Prevents the settings UI from goofing up.\n\t\tif ( ! old_definition || Array.isArray(old_definition) )\n\t\t\tthis.emit(':added-definition', key, definition);\n\t}\n\n\n\tremove(key: string) {\n\t\tconst definition = this.definitions.get(key);\n\t\tif ( ! definition )\n\t\t\treturn;\n\n\t\t// If the definition is an array, we're already not defined.\n\t\tif ( Array.isArray(definition) )\n\t\t\treturn;\n\n\t\t// Remove this definition from the definitions list.\n\t\tif ( Array.isArray(definition.required_by) && definition.required_by.length > 0 )\n\t\t\tthis.definitions.set(key, definition.required_by);\n\t\telse\n\t\t\tthis.definitions.delete(key);\n\n\t\t// Remove it from all the things it required.\n\t\tif ( Array.isArray(definition.requires) )\n\t\t\tfor(const req_key of definition.requires) {\n\t\t\t\tlet req = this.definitions.get(req_key);\n\t\t\t\tif ( Array.isArray(req) ) {\n\t\t\t\t\tconst idx = req.indexOf(key);\n\t\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\t\treq.splice(idx, 1);\n\n\t\t\t\t} else if ( req?.required_by )\n\t\t\t\t\treq = req.required_by;\n\t\t\t}\n\n\t\tif ( definition.changed )\n\t\t\tthis.off(`:changed:${key}` as any, definition.changed);\n\n\t\tthis.emit(':removed-definition', key as any, definition);\n\t}\n\n\n\t// TODO: Update this because addUI doesn't use keys or types\n\taddUI<\n\t\tK extends string,\n\t\tTValue = K extends SettingsKeys ? SettingType<K> : unknown\n\t>(key: K, definition: Partial<SettingUiDefinition<TValue>>, source?: string) {\n\n\t\tlet def: SettingDefinition<TValue>;\n\t\tif ( (definition as any).ui )\n\t\t\tdef = (definition as any);\n\t\telse\n\t\t\tdef = {\n\t\t\t\tui: definition as SettingUiDefinition<TValue>\n\t\t\t} as SettingDefinition<TValue>;\n\n\t\tdef.__source = source;\n\n\t\tconst ui = def.ui as SettingUiDefinition<TValue>;\n\t\tui.path_tokens = ui.path_tokens ?\n\t\t\tformat_path_tokens(ui.path_tokens) :\n\t\t\tui.path ?\n\t\t\t\tparse_path(ui.path) :\n\t\t\t\tundefined;\n\n\t\tif ( ! ui.key && ui.title )\n\t\t\tui.key = ui.title.toSnakeCase();\n\n\t\tconst old_definition = this.ui_structures.get(key);\n\t\tthis.ui_structures.set(key, def);\n\n\t\t// Do not re-emit `added-definition` when re-adding an existing\n\t\t// setting. Prevents the settings UI from goofing up.\n\t\tif ( ! old_definition )\n\t\t\tthis.emit(':added-definition', key as any, def);\n\t}\n\n\n\taddClearable(key: string | Record<string, SettingsClearable>, definition?: SettingsClearable, source?: string) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addClearable(k, value, source);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( definition ) {\n\t\t\tdefinition.__source = source;\n\t\t\tthis.clearables[key] = definition;\n\t\t}\n\t}\n\n\tgetClearables() {\n\t\treturn deep_copy(this.clearables);\n\t}\n\n\n\taddProcessor(key: string | Record<string, SettingProcessor<any>>, processor?: SettingProcessor<any>) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addProcessor(k, value);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( processor )\n\t\t\tthis.processors[key] = processor;\n\t}\n\n\tgetProcessor<T>(key: string): SettingProcessor<T> | null {\n\t\treturn this.processors[key] ?? null;\n\t}\n\n\tgetProcessors() {\n\t\treturn deep_copy(this.processors);\n\t}\n\n\taddValidator(key: string | Record<string, SettingValidator<any>>, validator?: SettingValidator<any>) {\n\t\tif ( typeof key === 'object' ) {\n\t\t\tfor(const [k, value] of Object.entries(key))\n\t\t\t\tthis.addValidator(k, value);\n\t\t\treturn;\n\t\t} else if ( typeof key !== 'string' )\n\t\t\tthrow new Error('invalid key');\n\n\t\tif ( validator )\n\t\t\tthis.validators[key] = validator;\n\t}\n\n\tgetValidator<T>(key: string): SettingValidator<T> | null {\n\t\treturn this.validators[key] ?? null;\n\t}\n\n\tgetValidators() {\n\t\treturn deep_copy(this.validators);\n\t}\n}\n\n\nexport function format_path_tokens(tokens: (string | PathNode)[]) {\n\tfor(let i=0, l = tokens.length; i < l; i++) {\n\t\tconst token = tokens[i];\n\t\tif ( typeof token === 'string' ) {\n\t\t\ttokens[i] = {\n\t\t\t\tkey: token.toSnakeCase(),\n\t\t\t\ttitle: token\n\t\t\t};\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif ( ! token.key )\n\t\t\ttoken.key = token.title.toSnakeCase();\n\t}\n\n\treturn tokens as PathNode[];\n}\n","'use strict';\n\nimport type { SettingDefinition, SettingProcessor, SettingUiDefinition } from \"./types\";\n\nconst BAD = Symbol('BAD');\ntype BadType = typeof BAD;\n\nfunction do_number(\n\tinput: number | BadType,\n\tdefault_value: number,\n\tdefinition: SettingUiDefinition<number>\n)  {\n\tif ( typeof input !== 'number' || isNaN(input) || ! isFinite(input) )\n\t\tinput = BAD;\n\n\tif ( input !== BAD ) {\n\t\tconst bounds = definition.bounds;\n\t\tif ( Array.isArray(bounds) ) {\n\t\t\tif ( bounds.length >= 3 ) {\n\t\t\t\t// [low, inclusive, high, inclusive]\n\t\t\t\tif ( (bounds[1] ? (input < bounds[0]) : (input <= bounds[0])) ||\n\t\t\t\t\t\t// TODO: Figure out why it doesn't like bounds[2] but bounds[3] is okay\n\t\t\t\t\t\t(bounds[3] ? (input > (bounds as any)[2]) : (input >= (bounds as any)[2])) )\n\t\t\t\t\tinput = BAD;\n\n\t\t\t} else if ( bounds.length === 2 ) {\n\t\t\t\t// [low, inclusive] or [low, high] ?\n\t\t\t\tif ( typeof bounds[1] === 'boolean' ) {\n\t\t\t\t\tif ( bounds[1] ? input < bounds[0] : input <= bounds[0] )\n\t\t\t\t\t\tinput = BAD;\n\t\t\t\t} else if ( input < bounds[0] || input > bounds[1] )\n\t\t\t\t\tinput = BAD;\n\t\t\t} else if ( bounds.length === 1 && input < bounds[0] )\n\t\t\t\tinput = BAD;\n\t\t}\n\t}\n\n\treturn input === BAD ? default_value : input;\n}\n\nexport const to_int: SettingProcessor<number> = (\n\tvalue,\n\tdefault_value,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?\\d+$/.test(value) )\n\t\tvalue = parseInt(value, 10);\n\telse if ( typeof value !== 'number' )\n\t\tvalue = BAD;\n\n\treturn do_number(value as number, default_value, definition);\n}\n\nexport const to_float: SettingProcessor<number> = (\n\tvalue: unknown,\n\tdefault_value,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?[\\d.]+$/.test(value) )\n\t\tvalue = parseFloat(value);\n\telse if ( typeof value !== 'number' )\n\t\tvalue = BAD;\n\n\treturn do_number(value as number, default_value, definition);\n}\n\n","'use strict';\n\n// ============================================================================\n// Settings Profiles\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {isValidShortcut, fetchJSON} from 'utilities/object';\nimport {FilterData, createTester} from 'utilities/filtering';\nimport type SettingsManager from '.';\nimport type { SettingsProvider } from './providers';\nimport type { ContextData, ExportedSettingsProfile, SettingsProfileMetadata } from './types';\nimport type { Mousetrap } from '../utilities/types';\n\ndeclare global {\n\tinterface Window {\n\t\tMousetrap?: Mousetrap;\n\t}\n}\n\n\nexport type ProfileEvents = {\n\t'toggled': [profile: SettingsProfile, enabled: boolean];\n\t'changed': [key: string, value: unknown, deleted: boolean];\n}\n\n\n/**\n * Instances of SettingsProfile are used for getting and setting raw settings\n * values, enumeration, and emit events when the raw settings are changed.\n * @extends EventEmitter\n */\nexport default class SettingsProfile extends EventEmitter<ProfileEvents> {\n\n\tstatic Default: Partial<SettingsProfileMetadata> = {\n\t\tid: 0,\n\t\tuuid: 'ffz_profile_default',\n\t\tname: 'Default Profile',\n\t\ti18n_key: 'setting.profiles.default',\n\n\t\tdescription: 'Settings that apply everywhere on Twitch.'\n\t};\n\n\n\tstatic Moderation: Partial<SettingsProfileMetadata> = {\n\t\tid: 1,\n\t\tuuid: 'ffz_profile_moderation',\n\t\tname: 'Moderation',\n\t\ti18n_key: 'setting.profiles.moderation',\n\n\t\tdescription: 'Settings that apply when you are a moderator of the current channel.',\n\n\t\tcontext: [\n\t\t\t{\n\t\t\t\ttype: 'Moderator',\n\t\t\t\tdata: true\n\t\t\t}\n\t\t]\n\t};\n\n\n\tprivate manager: SettingsManager;\n\tprivate provider: SettingsProvider;\n\n\tprivate prefix: string;\n\tprivate enabled_key: string;\n\n\tprivate _enabled: boolean = false;\n\tprivate _storage?: Map<string, unknown>;\n\n\t/**\n\t * If this is true, the profile will not be persisted and the user will\n\t * not be able to edit it.\n\t */\n\tephemeral: boolean = false;\n\n\t/**\n\t * The ID number for this profile. ID numbers may be recycled as profiles\n\t * are deleted and created.\n\t */\n\tid: number = -1;\n\n\t/**\n\t * The unique ID for this profile. UUIDs should always be unique.\n\t */\n\tuuid: string = null as any;\n\n\t// Metadata\n\n\t/**\n\t * The name of this profile. A human-readable string that may be edited\n\t * by the user.\n\t */\n\tname: string = null as any;\n\n\t/**\n\t * The localization key for the name of this profile. If this is set,\n\t * the name will be localized. If this is not set, the name will be\n\t * displayed as-is. This value is cleared if the user edits the name.\n\t */\n\ti18n_key?: string | null;\n\n\t/**\n\t * The description of this profile. A human-readable string that may\n\t * be edited by the user.\n\t */\n\tdescription?: string | null;\n\n\t/**\n\t * The localization key for the description of this profile. If this\n\t * is set, the description will be localized. If this is not set, the\n\t * description will be displayed as-is. This value is cleared if\n\t * the user edits the description.\n\t */\n\tdesc_i18n_key?: string | null;\n\n\t/**\n\t * A URL for this profile. If this is set, the profile will potentially\n\t * be automatically updated from the URL.\n\t */\n\turl?: string | null;\n\n\t/**\n\t * Whether or not automatic updates should be processed. If this is\n\t * set to true, the profile will not be automatically updated.\n\t */\n\tpause_updates: boolean = false;\n\n\t// TODO: Document, check default value\n\tshow_toggle: boolean = false;\n\n\n\t// Profile Rules\n\n\tcontext?: FilterData[];\n\n\n\t// Hotkey Stuff\n\n\t/**\n\t * A user-set hotkey for toggling this profile on or off.\n\t * @see {@link hotkey}\n\t */\n\tprivate _hotkey?: string | null;\n\n\t/**\n\t * Whether or not the hotkey is currently enabled.\n\t * @see {@link hotkey_enabled}\n\t */\n\tprivate _hotkey_enabled?: boolean = false;\n\n\tprivate _bound_key?: string | null;\n\tprivate Mousetrap?: Mousetrap;\n\n\n\tprivate matcher?: ((ctx: ContextData) => boolean) | null;\n\n\n\tconstructor(manager: SettingsManager, data: Partial<SettingsProfileMetadata>) {\n\t\tsuper();\n\n\t\tthis.onShortcut = this.onShortcut.bind(this);\n\t\tthis._hotkey_enabled = false;\n\n\t\tthis.manager = manager;\n\t\tthis.provider = manager.provider;\n\n\t\tthis.data = data;\n\t\tthis.prefix = `p:${this.id}:`;\n\t\tthis.enabled_key = `${this.prefix}:enabled`;\n\n\t\tif ( this.ephemeral ) {\n\t\t\tthis._enabled = true;\n\t\t\tthis._storage = new Map;\n\t\t}\n\t}\n\n\tget data(): Partial<SettingsProfileMetadata> {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\t//parent: this.parent,\n\t\t\tuuid: this.uuid,\n\n\t\t\tname: this.name,\n\t\t\ti18n_key: this.i18n_key,\n\t\t\thotkey: this.hotkey,\n\t\t\tpause_updates: this.pause_updates,\n\n\t\t\tephemeral: this.ephemeral,\n\n\t\t\tdescription: this.description,\n\t\t\tdesc_i18n_key: this.desc_i18n_key,\n\n\t\t\turl: this.url,\n\t\t\tshow_toggle: this.show_toggle,\n\n\t\t\tcontext: this.context\n\t\t}\n\t}\n\n\tset data(val) {\n\t\tif ( typeof val !== 'object' )\n\t\t\tthrow new TypeError('data must be an object');\n\n\t\tthis.clearMatcher();\n\n\t\t// Make sure ephemeral is set first.\n\t\tif ( val.ephemeral )\n\t\t\tthis.ephemeral = true;\n\n\t\t// Copy the values to this profile.\n\t\tfor(const [key, value] of Object.entries(val))\n\t\t\t(this as any)[key] = value;\n\t}\n\n\n\tclearMatcher() {\n\t\tthis.matcher = null;\n\t}\n\n\n\tmatches(context: ContextData) {\n\t\tif ( ! this.matcher )\n\t\t\tthis.matcher = createTester(\n\t\t\t\tthis.context,\n\t\t\t\tthis.manager.filters,\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t\t() => this.manager.updateSoon()\n\t\t\t);\n\n\t\treturn this.matcher(context);\n\t}\n\n\n\tsave() {\n\t\tif ( ! this.ephemeral )\n\t\t\tthis.manager.saveProfile(this.id);\n\t}\n\n\n\tgetBackup(): ExportedSettingsProfile {\n\t\tconst out: ExportedSettingsProfile = {\n\t\t\tversion: 2,\n\t\t\ttype: 'profile',\n\t\t\tprofile: this.data,\n\t\t\ttoggled: this.toggled,\n\t\t\tvalues: {}\n\t\t};\n\n\t\tdelete out.profile.ephemeral;\n\n\t\tfor(const [key, value] of this.entries())\n\t\t\tout.values[key] = value;\n\n\t\treturn out;\n\t}\n\n\n\tasync checkUpdate() {\n\t\tif ( ! this.url || this.pause_updates )\n\t\t\treturn false;\n\n\t\tconst data = await fetchJSON<ExportedSettingsProfile>(this.url);\n\t\tif ( ! data || data.type !== 'profile' || ! data.profile || ! data.values )\n\t\t\treturn false;\n\n\t\t// We don't want to override general settings.\n\t\tdelete data.profile.ephemeral;\n\t\tdelete data.profile.id;\n\t\tdelete data.profile.uuid;\n\t\tdelete data.profile.name;\n\t\tdelete data.profile.i18n_key;\n\t\tdelete data.profile.hotkey;\n\t\tdelete data.profile.description;\n\t\tdelete data.profile.desc_i18n_key;\n\t\tdelete data.profile.url;\n\t\tdelete data.profile.pause_updates;\n\n\t\tthis.data = data.profile;\n\n\t\tconst old_keys = new Set(this.keys());\n\n\t\tfor(const [key, value] of Object.entries(data.values)) {\n\t\t\told_keys.delete(key);\n\t\t\tthis.set(key, value);\n\t\t}\n\n\t\tfor(const key of old_keys)\n\t\t\tthis.delete(key);\n\n\t\treturn true;\n\t}\n\n\n\t// ========================================================================\n\t// Hotkey\n\t// ========================================================================\n\n\tget hotkey() {\n\t\treturn this._hotkey;\n\t}\n\n\tset hotkey(key) {\n\t\tif ( key === this._hotkey )\n\t\t\treturn;\n\n\t\tthis._hotkey = key;\n\t\tif ( this._hotkey_enabled )\n\t\t\tthis._updateHotkey();\n\t}\n\n\tget hotkey_enabled() {\n\t\treturn this._hotkey_enabled;\n\t}\n\n\tset hotkey_enabled(val) {\n\t\tthis._hotkey_enabled = !! val;\n\t\tthis._updateHotkey();\n\t}\n\n\t_updateHotkey() {\n\t\tconst Mousetrap = this.Mousetrap = this.Mousetrap || window.Mousetrap;\n\t\tif ( ! Mousetrap )\n\t\t\treturn;\n\n\t\tconst key = this._hotkey;\n\n\t\tif ( this._bound_key && (this._bound_key !== key || ! this._hotkey_enabled) ) {\n\t\t\tMousetrap.unbind(this._bound_key);\n\t\t\tthis._bound_key = null;\n\t\t}\n\n\t\tif ( ! this._hotkey_enabled )\n\t\t\treturn;\n\n\t\tif ( key && isValidShortcut(key) ) {\n\t\t\tMousetrap.bind(key, this.onShortcut);\n\t\t\tthis._bound_key = key;\n\t\t}\n\t}\n\n\tonShortcut(event: KeyboardEvent) {\n\t\tthis.toggled = ! this.toggled;\n\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// Toggled\n\t// ========================================================================\n\n\tget toggled() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._enabled;\n\t\treturn this.provider.get(this.enabled_key, true);\n\t}\n\n\tset toggled(val) {\n\t\tif ( val === this.toggled )\n\t\t\treturn;\n\n\t\tif ( this.ephemeral )\n\t\t\tthis._enabled = val;\n\t\telse\n\t\t\tthis.provider.set(this.enabled_key, val);\n\n\t\tthis.emit('toggled', this, val);\n\t}\n\n\n\t// ========================================================================\n\t// Context\n\t// ========================================================================\n\n\t// wtf is this method context is an array yo\n\t/*\n\tupdateContext(context) {\n\t\tif ( this.id === 0 )\n\t\t\tthrow new Error('cannot set context of default profile');\n\n\t\tthis.context = Object.assign(this.context || {}, context);\n\t\tthis.matcher = null;\n\t\tthis.save();\n\t}*/\n\n\tsetContext(context?: FilterData[]) {\n\t\tif ( this.id === 0 )\n\t\t\tthrow new Error('cannot set context of default profile');\n\n\t\tthis.context = context;\n\t\tthis.clearMatcher();\n\t\tthis.save();\n\t}\n\n\n\t// ========================================================================\n\t// Setting Access\n\t// ========================================================================\n\n\tget<T>(key: string, default_value: T): T;\n\tget<T>(key: string): T | null;\n\n\tget<T>(key: string, default_value?: T): T | null {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage && this._storage.has(key) )\n\t\t\t\treturn this._storage.get(key) as T;\n\n\t\t\treturn default_value ?? null;\n\t\t}\n\n\t\treturn this.provider.get<T>(this.prefix + key, default_value as T);\n\t}\n\n\tset(key: string, value: unknown) {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage )\n\t\t\t\tthis._storage.set(key, value);\n\t\t} else\n\t\t\tthis.provider.set(this.prefix + key, value);\n\n\t\tthis.emit('changed', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage )\n\t\t\t\tthis._storage.delete(key);\n\t\t} else\n\t\t\tthis.provider.delete(this.prefix + key);\n\t\tthis.emit('changed', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? this._storage.has(key): false;\n\t\treturn this.provider.has(this.prefix + key);\n\t}\n\n\tkeys() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? Array.from(this._storage.keys()) : [];\n\n\t\tconst out = [],\n\t\t\tp = this.prefix,\n\t\t\tlen = p.length;\n\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key )\n\t\t\t\tout.push(key.slice(len));\n\n\t\treturn out;\n\t}\n\n\tclear() {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage ) {\n\t\t\t\tconst keys = this.keys();\n\t\t\t\tthis._storage.clear();\n\t\t\t\tfor(const key of keys) {\n\t\t\t\t\tthis.emit('changed', key, undefined, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst p = this.prefix,\n\t\t\tlen = p.length;\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key ) {\n\t\t\t\tthis.provider.delete(key);\n\t\t\t\tthis.emit('changed', key.slice(len), undefined, true);\n\t\t\t}\n\t}\n\n\t*entries() {\n\t\tif ( this.ephemeral ) {\n\t\t\tif ( this._storage ) {\n\t\t\t\tfor(const entry of this._storage.entries())\n\t\t\t\t\tyield entry;\n\t\t\t}\n\n\t\t} else {\n\t\t\tconst p = this.prefix,\n\t\t\t\tlen = p.length;\n\n\t\t\tfor(const key of this.provider.keys())\n\t\t\t\tif ( key.startsWith(p) && key !== this.enabled_key ) {\n\t\t\t\t\tconst out: [string, unknown] = [key.slice(len), this.provider.get(key)];\n\t\t\t\t\tyield out;\n\t\t\t\t}\n\t\t}\n\t}\n\n\tget size() {\n\t\tif ( this.ephemeral )\n\t\t\treturn this._storage ? this._storage.size : 0;\n\n\t\tconst p = this.prefix;\n\t\tlet count = 0;\n\n\t\tfor(const key of this.provider.keys())\n\t\t\tif ( key.startsWith(p) && key !== this.enabled_key )\n\t\t\t\tcount++;\n\n\t\treturn count;\n\t}\n}\n","'use strict';\n\nimport { isValidBlob, deserializeBlob, serializeBlob, BlobLike, SerializedBlobLike } from 'utilities/blobs';\n\n\n// ============================================================================\n// Settings Providers\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\nimport {TicketLock, has, once} from 'utilities/object';\nimport type SettingsManager from '.';\nimport type { OptionalArray, OptionalPromise, ProviderTypeMap } from '../utilities/types';\nimport { EXTENSION } from '../utilities/constants';\n\nconst DB_VERSION = 1,\n\tNOT_WWW_TWITCH = window.location.host !== 'www.twitch.tv',\n\tNOT_WWW_YT = window.location.host !== 'www.youtube.com';\n\n\n// ============================================================================\n// Types\n// ============================================================================\n\ntype ProviderEvents = {\n\t'change-provider': [];\n\t'set': [key: string, value: any, deleted: boolean];\n\t'changed': [key: string, value: any, deleted: boolean];\n\t'quota-exceeded': [error: any];\n\n\t'set-blob': [key: string, value: BlobLike | undefined, deleted: boolean];\n\t'changed-blob': [key: string, deleted: boolean];\n\t'clear-blobs': [];\n}\n\n\n// ============================================================================\n// SettingsProvider\n// ============================================================================\n\n/**\n * Base class for providers for the settings system. A provider is in charge\n * of reading and writing values from storage as well as sending events to\n * the {@link SettingsManager} when a value is changed remotely.\n */\nexport abstract class SettingsProvider extends EventEmitter<ProviderEvents> {\n\n\t// Static Stuff\n\n\tstatic priority: number = 0;\n\tstatic title: string;\n\tstatic description: string;\n\n\tstatic hasContent: () => OptionalPromise<boolean>;\n\n\n\tmanager: SettingsManager;\n\tdisabled: boolean;\n\n\tprotected ready: boolean = false;\n\n\t/**\n\t * Create a new SettingsProvider\n\t * @param {SettingsManager} manager - The manager that owns this provider.\n\t */\n\tconstructor(manager: SettingsManager) {\n\t\tsuper();\n\n\t\tthis.manager = manager;\n\t\tthis.disabled = false;\n\t}\n\n\tstatic supported() {\n\t\treturn false;\n\t}\n\n\tstatic allowTransfer = true;\n\tstatic shouldUpdate = true;\n\n\tawaitReady() {\n\t\tif ( this.ready )\n\t\t\treturn Promise.resolve();\n\n\t\treturn Promise.reject(new Error('Not Implemented'));\n\t}\n\n\tget allowTransfer() {\n\t\treturn (this.constructor as typeof SettingsProvider).allowTransfer;\n\t}\n\n\tget shouldUpdate() {\n\t\treturn (this.constructor as typeof SettingsProvider).shouldUpdate;\n\t}\n\n\tabstract broadcastTransfer(): void;\n\tabstract disableEvents(): void;\n\n\tabstract flush(): OptionalPromise<void>;\n\n\tabstract get<K extends keyof ProviderTypeMap>(\n\t\tkey: K,\n\t\tdefault_value: ProviderTypeMap[K]\n\t): ProviderTypeMap[K];\n\tabstract get<K extends keyof ProviderTypeMap>(\n\t\tkey: K\n\t): ProviderTypeMap[K] | null;\n\tabstract get<T>(\n\t\tkey: Exclude<string, keyof ProviderTypeMap>,\n\t\tdefault_value: T\n\t): T;\n\tabstract get<T>(\n\t\tkey: Exclude<string, keyof ProviderTypeMap>\n\t): T | null;\n\n\tabstract set<K extends keyof ProviderTypeMap>(key: K, value: ProviderTypeMap[K]): void;\n\tabstract set<K extends string>(key: Exclude<K, keyof ProviderTypeMap>, value: unknown): void;\n\tabstract delete(key: string): void;\n\tabstract clear(): void;\n\n\tabstract has(key: string): boolean;\n\n\tabstract keys(): Iterable<string>;\n\tabstract entries(): Iterable<[string, any]>;\n\n\tabstract get size(): number;\n\n}\n\n\nexport abstract class AdvancedSettingsProvider extends SettingsProvider {\n\n\tget supportsBlobs() { return true; }\n\n\tisValidBlob(blob: any): blob is BlobLike {\n\t\treturn this.supportsBlobs && isValidBlob(blob);\n\t}\n\n\tabstract getBlob(key: string): Promise<BlobLike | null>;\n\tabstract setBlob(key: string, value: BlobLike): Promise<void>;\n\tabstract deleteBlob(key: string): Promise<void>;\n\tabstract hasBlob(key: string): Promise<boolean>;\n\tabstract clearBlobs(): Promise<void>;\n\tabstract blobKeys(): Promise<Iterable<string>>;\n\n}\n\n\nexport abstract class RemoteSettingsProvider extends AdvancedSettingsProvider {\n\n\t// State and Storage\n\tprivate _start_time: number;\n\tprivate _cached: Map<string, any>;\n\n\tprivate _blobs: boolean | null;\n\tprivate _rpc: Map<number, [(input: any) => void, () => void]>;\n\tprivate _last_id: number;\n\n\tprivate resolved_ready: boolean;\n\tprivate _ready_wait_resolve?: (() => void) | null;\n\tprivate _ready_wait_fail?: ((err: any) => void) | null;\n\tprivate _ready_wait?: Promise<void> | null;\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tthis._start_time = performance.now();\n\n\t\tthis._rpc = new Map;\n\n\t\tthis._cached = new Map;\n\t\tthis.resolved_ready = false;\n\t\tthis.ready = false;\n\t\tthis._ready_wait = null;\n\n\t\tthis._blobs = null;\n\t\tthis._last_id = 0;\n\t}\n\n\tget supportsBlobs() {\n\t\treturn this._blobs ?? false;\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\tdisableEvents() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\n\t// Initialization\n\n\tprotected resolveReady(success: boolean, data?: any) {\n\t\tif ( this.manager )\n\t\t\tthis.manager.log.info(`${this.constructor.name} ready in ${(performance.now() - this._start_time).toFixed(5)}ms`);\n\n\t\tthis.resolved_ready = true;\n\t\tthis.ready = success;\n\n\t\tif ( success && this._ready_wait_resolve )\n\t\t\tthis._ready_wait_resolve();\n\t\telse if ( ! success && this._ready_wait_fail )\n\t\t\tthis._ready_wait_fail(data);\n\t}\n\n\tawaitReady() {\n\t\tif ( this.resolved_ready ) {\n\t\t\tif ( this.ready )\n\t\t\t\treturn Promise.resolve();\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tif ( this._ready_wait )\n\t\t\treturn this._ready_wait;\n\n\t\treturn this._ready_wait = new Promise<void>((resolve, fail) => {\n\t\t\tthis._ready_wait_resolve = resolve;\n\t\t\tthis._ready_wait_fail = fail;\n\n\t\t}).finally(() => {\n\t\t\tthis._ready_wait = null;\n\t\t\tthis._ready_wait_resolve = null;\n\t\t\tthis._ready_wait_fail = null;\n\t\t});\n\t}\n\n\n\t// Provider Methods\n\n\tget<T>(key: string, default_value?: T): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\tthis.rpc({ffz_type: 'set', key, value})\n\t\t\t.catch(err => this.manager.log.error('Error setting value', err));\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tthis._cached.delete(key);\n\t\tthis.rpc({ffz_type: 'delete', key})\n\t\t\t.catch(err => this.manager.log.error('Error deleting value', err));\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\tclear() {\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\t\tfor(const key of old_cache.keys())\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\tthis.rpc('clear')\n\t\t\t.catch(err => this.manager.log.error('Error clearing storage', err));\n\t}\n\n\thas(key: string) { return this._cached.has(key); }\n\tkeys() { return this._cached.keys(); }\n\tentries() { return this._cached.entries(); }\n\tget size() { return this._cached.size; }\n\n\tasync flush() {\n\t\tawait this.rpc('flush');\n\t}\n\n\n\t// Provider Methods: Blobs\n\n\tasync getBlob(key: string) {\n\t\tconst msg = await this.rpc({ffz_type: 'get-blob', key});\n\t\treturn msg ? deserializeBlob(msg) : null;\n\t}\n\n\tasync setBlob(key: string, value: BlobLike) {\n\t\tawait this.rpc({\n\t\t\tffz_type: 'set-blob',\n\t\t\tkey,\n\t\t\tvalue: await serializeBlob(value)\n\t\t});\n\t}\n\n\tasync deleteBlob(key: string) {\n\t\tawait this.rpc({\n\t\t\tffz_type: 'delete-blob',\n\t\t\tkey\n\t\t});\n\t}\n\n\tasync hasBlob(key: string) {\n\t\treturn this.rpc({ffz_type: 'has-blob', key});\n\t}\n\n\tasync clearBlobs() {\n\t\tawait this.rpc('clear-blobs');\n\t}\n\n\tasync blobKeys() {\n\t\treturn this.rpc('blob-keys');\n\t}\n\n\n\t// Communication\n\n\tabstract send(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>): void;\n\n\trpc<K extends keyof CorsRpcTypes>(\n\t\tmsg: K | RPCInputMessage<K>,\n\t\ttransfer?: OptionalArray<Transferable>\n\t) {\n\t\tconst id = ++this._last_id;\n\n\t\treturn new Promise<CorsOutput<K>>((resolve,fail) => {\n\t\t\tthis._rpc.set(id, [resolve, fail]);\n\t\t\tlet out: CorsMessage;\n\t\t\tif ( typeof msg === 'string' )\n\t\t\t\tout = {ffz_type: msg} as CorsMessage;\n\t\t\telse\n\t\t\t\tout = msg as unknown as CorsMessage;\n\n\t\t\tout.id = id;\n\t\t\tthis.send(out, transfer);\n\t\t});\n\t}\n\n\thandleMessage(msg: CorsMessage) {\n\t\tif ( msg.ffz_type === 'ready' )\n\t\t\tthis.rpc('init-load').then(msg => {\n\t\t\t\tthis._blobs = msg.blobs;\n\t\t\t\tfor(const [key, value] of Object.entries(msg.values))\n\t\t\t\t\tthis._cached.set(key, value);\n\n\t\t\t\tthis.resolveReady(true);\n\n\t\t\t}).catch(err => {\n\t\t\t\tthis.resolveReady(false, err);\n\t\t\t});\n\n\t\telse if ( msg.ffz_type === 'change' )\n\t\t\tthis.onChange(msg);\n\n\t\telse if ( msg.ffz_type === 'change-blob' )\n\t\t\tthis.emit('changed-blob', msg.key, msg.deleted);\n\n\t\telse if ( msg.ffz_type === 'clear-blobs' )\n\t\t\tthis.emit('clear-blobs');\n\n\t\telse if ( msg.ffz_type === 'reply' || msg.ffz_type === 'reply-error' )\n\t\t\tthis.onReply(msg);\n\n\t\telse\n\t\t\tthis.manager.log.warn('Unknown Message', msg.ffz_type, msg);\n\t}\n\n\tonChange(msg: RPCInputMessage<'change'>) {\n\t\tconst key = msg.key,\n\t\t\tvalue = msg.value,\n\t\t\tdeleted = msg.deleted;\n\n\t\tif ( deleted ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\t\t} else {\n\t\t\tthis._cached.set(key, value);\n\t\t\tthis.emit('changed', key, value, false);\n\t\t}\n\t}\n\n\tonReply(msg: CorsReplyMessage | CorsReplyErrorMessage) {\n\t\tconst id = msg.id,\n\t\t\tsuccess = msg.ffz_type === 'reply',\n\t\t\tcbs = this._rpc.get(id);\n\t\tif ( ! cbs )\n\t\t\treturn this.manager.log.warn('Received reply for unknown ID', id);\n\n\t\tthis._rpc.delete(id);\n\t\tif ( success )\n\t\t\tcbs[0](msg.reply);\n\t\telse\n\t\t\tcbs[1]();\n\t}\n}\n\n\n\n\n\n// ============================================================================\n// LocalStorage\n// ============================================================================\n\nexport class LocalStorageProvider extends SettingsProvider {\n\n\t// Static Stuff\n\tstatic priority = -1000;\n\tstatic title = 'Local Storage';\n\tstatic description = '[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.';\n\n\t// All environments that support FFZ support LocalStorage.\n\tstatic supported() {\n\t\treturn true;\n\t}\n\n\tstatic hasContent(prefix?: string) {\n\t\tif ( ! prefix )\n\t\t\tprefix = 'FFZ:setting:';\n\n\t\tfor(const key in localStorage)\n\t\t\tif ( key.startsWith(prefix) && has(localStorage, key) )\n\t\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\t// Config and Storage\n\treadonly prefix: string;\n\tprivate _cached: Map<string, any>;\n\n\t// Event Handling\n\tprivate _broadcaster?: BroadcastChannel | null;\n\tprivate _boundHandleMessage?: ((event: MessageEvent) => void) | null;\n\tprivate _boundHandleStorage?: ((event: StorageEvent) => void) | null;\n\n\tconstructor(manager: SettingsManager, prefix?: string) {\n\t\tsuper(manager);\n\t\tthis.prefix = prefix = prefix == null ? 'FFZ:setting:' : prefix;\n\n\t\tconst cache = this._cached = new Map,\n\t\t\tlen = prefix.length;\n\n\t\tfor(const key in localStorage)\n\t\t\tif ( has(localStorage, key) && key.startsWith(prefix) ) {\n\t\t\t\tconst val = localStorage.getItem(key);\n\t\t\t\tif ( val )\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcache.set(key.slice(len), JSON.parse(val));\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\tthis.manager.log.warn(`unable to parse value for ${key}`, val);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\tthis.ready = true;\n\n\t\tif ( window.BroadcastChannel ) {\n\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-settings');\n\t\t\tbc.addEventListener('message',\n\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\n\t\t} else {\n\t\t\twindow.addEventListener('storage',\n\t\t\t\tthis._boundHandleStorage = this.handleStorage.bind(this));\n\t\t}\n\t}\n\n\tbroadcastTransfer() {\n\t\tthis.broadcast({type: 'change-provider'});\n\t}\n\n\tprivate removeListeners() {\n\t\tif ( this._broadcaster ) {\n\t\t\tif ( this._boundHandleMessage )\n\t\t\t\tthis._broadcaster.removeEventListener('message', this._boundHandleMessage);\n\t\t\tthis._broadcaster.close();\n\t\t\tthis._boundHandleMessage = this._broadcaster = null;\n\t\t}\n\n\t\tif ( this._boundHandleStorage ) {\n\t\t\twindow.removeEventListener('storage', this._boundHandleStorage);\n\t\t\tthis._boundHandleStorage = null;\n\t\t}\n\t}\n\n\tdisableEvents() {\n\t\tthis.removeListeners();\n\n\t\tthis.broadcast = () => {};\n\t\tthis.emit = () => {};\n\t}\n\n\tdestroy() {\n\t\tthis.disable();\n\t\tthis._cached.clear();\n\t}\n\n\tdisable() {\n\t\tthis.removeListeners();\n\t\tthis.disabled = true;\n\t}\n\n\n\tflush() { /* no-op */ } // eslint-disable-line class-methods-use-this\n\n\n\tbroadcast(msg: any) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\n\thandleMessage(event: MessageEvent) {\n\t\tif ( this.disabled || ! event.isTrusted || ! event.data )\n\t\t\treturn;\n\n\t\tthis.manager.log.debug('storage broadcast event', event.data);\n\t\tconst {type, key} = event.data;\n\n\t\tif ( type === 'change-provider') {\n\t\t\tthis.manager.log.info('Received notice of changed settings provider.');\n\t\t\tthis.emit('change-provider');\n\t\t\tthis.disable();\n\t\t\tthis.disableEvents();\n\n\t\t} else if ( type === 'set' ) {\n\t\t\tconst val = JSON.parse(localStorage.getItem(this.prefix + key) ?? 'null');\n\t\t\tthis._cached.set(key, val);\n\t\t\tthis.emit('changed', key, val, false);\n\n\t\t} else if ( type === 'delete' ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'clear' ) {\n\t\t\tconst old_keys = Array.from(this._cached.keys());\n\t\t\tthis._cached.clear();\n\t\t\tfor(const key of old_keys)\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\t\t}\n\t}\n\n\n\thandleStorage(event: StorageEvent) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis.manager.log.debug('storage event', event);\n\t\tif ( event.storageArea !== localStorage )\n\t\t\treturn;\n\n\t\tif ( event.key && event.key.startsWith(this.prefix) ) {\n\t\t\t// If value is null, the key was deleted.\n\t\t\tconst key = event.key.slice(this.prefix.length);\n\t\t\tlet val = event.newValue;\n\n\t\t\tif ( val === null ) {\n\t\t\t\tthis._cached.delete(key);\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t\t} else {\n\t\t\t\tval = JSON.parse(val);\n\t\t\t\tthis._cached.set(key, val);\n\t\t\t\tthis.emit('changed', key, val, false);\n\t\t\t}\n\t\t}\n\t}\n\n\tget<T>(\n\t\tkey: string,\n\t\tdefault_value?: T\n\t): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\ttry {\n\t\t\tlocalStorage.setItem(this.prefix + key, JSON.stringify(value));\n\t\t} catch(err) {\n\t\t\tif ( this.manager )\n\t\t\t\tthis.manager.log.error(`An error occurred while trying to save a value to localStorage for key \"${this.prefix + key}\"`);\n\n\t\t\tif ( err && /quota/i.test(err.toString()) )\n\t\t\t\tthis.emit('quota-exceeded', err);\n\n\t\t\tthrow err;\n\t\t}\n\n\t\tthis.broadcast({type: 'set', key});\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis._cached.delete(key);\n\t\tlocalStorage.removeItem(this.prefix + key);\n\t\tthis.broadcast({type: 'delete', key});\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\treturn this._cached.has(key);\n\t}\n\n\tkeys() {\n\t\treturn this._cached.keys();\n\t}\n\n\tclear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\n\t\tfor(const key of old_cache.keys()) {\n\t\t\tlocalStorage.removeItem(this.prefix + key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\t\t}\n\n\t\tthis.broadcast({type: 'clear'});\n\t}\n\n\tentries() {\n\t\treturn this._cached.entries();\n\t}\n\n\tget size() {\n\t\treturn this._cached.size;\n\t}\n}\n\n\nexport class IndexedDBProvider extends AdvancedSettingsProvider {\n\n\t// Static Stuff\n\tstatic priority = 10;\n\tstatic title = 'IndexedDB';\n\tstatic description = '[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.';\n\n\tstatic supported() {\n\t\treturn window.indexedDB != null;\n\t}\n\n\tstatic hasContent() {\n\t\treturn new Promise<boolean>((resolve) => {\n\t\t\tconst request = window.indexedDB.open('FFZ', DB_VERSION);\n\t\t\trequest.onerror = () => resolve(false);\n\n\t\t\trequest.onupgradeneeded = e => {\n\t\t\t\t// TODO: Logic to detect that the version updated.\n\t\t\t\t// Can wait to implement till we actually increment version.\n\t\t\t\tif ( e.target instanceof IDBRequest )\n\t\t\t\t\te.target.transaction?.abort();\n\n\t\t\t\tresolve(false);\n\t\t\t}\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tconst db = request.result;\n\n\t\t\t\t// We have a database, but does it contain anything?\n\t\t\t\tlet store;\n\t\t\t\ttry {\n\t\t\t\t\tconst trx = db.transaction(['settings'], 'readonly');\n\t\t\t\t\tstore = trx.objectStore('settings');\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// This indicates a bad database.\n\t\t\t\t\treturn resolve(false);\n\t\t\t\t}\n\n\t\t\t\tconst r2 = store.getAllKeys();\n\n\t\t\t\tr2.onerror = () => {\n\t\t\t\t\tdb.close();\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\n\t\t\t\tr2.onsuccess = () => {\n\t\t\t\t\tconst success = Array.isArray(r2.result) && r2.result.length > 0;\n\t\t\t\t\tdb.close();\n\t\t\t\t\treturn resolve(success);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\t// State and Storage\n\tprivate _start_time: number;\n\tprivate _cached: Map<string, any>;\n\tprivate _pending: Set<unknown> | null;\n\tprivate _flush_wait?: Promise<void> | null;\n\tprivate _flush_wait_resolve?: (() => void) | null;\n\tprivate _ready_wait?: Promise<void> | null;\n\n\tprivate _db_wait?: Promise<IDBDatabase> | null;\n\n\tprivate db?: IDBDatabase | null;\n\n\tprivate _last_tx: number = 0;\n\tprivate _lock: TicketLock;\n\n\t// Event Handling\n\tprivate _broadcaster?: BroadcastChannel | null;\n\tprivate _boundHandleMessage?: ((event: MessageEvent) => void) | null;\n\n\tconstructor(manager: SettingsManager, start: boolean = true) {\n\t\tsuper(manager);\n\n\t\tthis.getDB = once(this.getDB);\n\n\t\tthis._start_time = performance.now();\n\n\t\tthis._pending = new Set<unknown>;\n\t\tthis._flush_wait = null;\n\n\t\tthis._lock = new TicketLock();\n\n\t\tthis._cached = new Map;\n\t\tthis.ready = false;\n\t\tthis._ready_wait = null;\n\n\t\tif ( start ) {\n\t\t\tif ( window.BroadcastChannel ) {\n\t\t\t\tconst bc = this._broadcaster = new BroadcastChannel('ffz-settings');\n\t\t\t\tbc.addEventListener('message',\n\t\t\t\t\tthis._boundHandleMessage = this.handleMessage.bind(this));\n\n\t\t\t}\n\n\t\t\tthis._ready_wait = this.loadSettings()\n\t\t\t\t.then(() => {\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.info(`IDB ready in ${(performance.now() - this._start_time).toFixed(5)}ms`);\n\t\t\t\t\tthis.ready = true;\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.error(`IDB failed after ${(performance.now() - this._start_time).toFixed(5)}ms:`, err);\n\t\t\t\t\tthis.ready = false;\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._ready_wait = null;\n\t\t\t\t});\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis.disable();\n\t\tthis._cached.clear();\n\t}\n\n\tdisable() {\n\t\tthis.disabled = true;\n\t\tthis.removeListeners();\n\n\t\tif ( this.db ) {\n\t\t\tthis.db.close();\n\t\t\tthis.db = null;\n\t\t}\n\t}\n\n\tprivate removeListeners() {\n\t\tif ( this._broadcaster ) {\n\t\t\tif ( this._boundHandleMessage )\n\t\t\t\tthis._broadcaster.removeEventListener('message', this._boundHandleMessage);\n\t\t\tthis._broadcaster.close();\n\t\t\tthis._boundHandleMessage = this._broadcaster = null;\n\t\t}\n\t}\n\n\tbroadcastTransfer() {\n\t\tthis.broadcast({type: 'change-provider'});\n\t}\n\n\tdisableEvents() {\n\t\tthis.removeListeners();\n\t\tthis.broadcast = () => {};\n\t\tthis.emit = () => {};\n\t}\n\n\n\t_onStart(obj: unknown) {\n\t\tif ( ! this._pending )\n\t\t\tthis._pending = new Set<any>;\n\n\t\tthis._pending.add(obj);\n\t}\n\n\t_onFinish(obj: unknown) {\n\t\tif ( this._pending ) {\n\t\t\tthis._pending.delete(obj);\n\n\t\t\tif ( this._pending.size )\n\t\t\t\treturn;\n\t\t}\n\n\t\tif ( this._flush_wait_resolve )\n\t\t\tthis._flush_wait_resolve();\n\t}\n\n\tflush() {\n\t\tif ( this._flush_wait )\n\t\t\treturn this._flush_wait;\n\n\t\tif ( ! this._pending || ! this._pending.size )\n\t\t\treturn Promise.resolve();\n\n\t\treturn this._flush_wait = new Promise<void>(resolve => {\n\t\t\tthis._flush_wait_resolve = resolve\n\t\t}).finally(() => {\n\t\t\tthis._flush_wait_resolve = null;\n\t\t\tthis._flush_wait = null;\n\t\t});\n\t}\n\n\n\tbroadcast(msg: any) {\n\t\tif ( this._broadcaster )\n\t\t\tthis._broadcaster.postMessage(msg);\n\t}\n\n\n\thandleMessage(event: MessageEvent) {\n\t\tif ( this.disabled || ! event.isTrusted || ! event.data )\n\t\t\treturn;\n\n\t\tif ( this.manager )\n\t\t\tthis.manager.log.debug('storage broadcast event', event.data);\n\t\tconst {type, key} = event.data;\n\n\t\tif ( type === 'change-provider') {\n\t\t\tthis.manager.log.info('Received notice of changed settings provider.');\n\t\t\tthis.emit('change-provider');\n\t\t\tthis.disable();\n\t\t\tthis.disableEvents();\n\n\t\t} else if ( type === 'set' ) {\n\t\t\tthis._get(key).then(val => {\n\t\t\t\tthis._cached.set(key, val);\n\t\t\t\tthis.emit('changed', key, val, false);\n\t\t\t}).catch(err => this.manager && this.manager.log.error(`Error getting setting \"${key}\" from database`, err));\n\n\t\t} else if ( type === 'delete' ) {\n\t\t\tthis._cached.delete(key);\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'clear' ) {\n\t\t\tconst old_keys = Array.from(this._cached.keys());\n\t\t\tthis._cached.clear();\n\t\t\tfor(const key of old_keys)\n\t\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\t} else if ( type === 'set-blob' ) {\n\t\t\tthis.emit('changed-blob', key, false);\n\t\t} else if ( type === 'delete-blob' ) {\n\t\t\tthis.emit('changed-blob', key, true);\n\t\t} else if ( type === 'clear-blobs' ) {\n\t\t\tthis.emit('clear-blobs');\n\t\t}\n\t}\n\n\n\tawaitReady() {\n\t\tif ( this._ready_wait )\n\t\t\treturn this._ready_wait;\n\n\t\tif ( this.ready )\n\t\t\treturn Promise.resolve();\n\n\t\treturn Promise.reject();\n\t}\n\n\n\t// Synchronous Methods\n\n\tget<T>(key: string, default_value?: T): T {\n\t\treturn this._cached.has(key)\n\t\t\t? this._cached.get(key)\n\t\t\t: default_value;\n\t}\n\n\tset(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( this.has(key) )\n\t\t\t\tthis.delete(key);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cached.set(key, value);\n\t\tthis._set(key, value)\n\t\t\t.then(() => this.broadcast({type: 'set', key}))\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error saving setting \"${key}\" to database`, err));\n\n\t\tthis.emit('set', key, value, false);\n\t}\n\n\tdelete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tthis._cached.delete(key);\n\t\tthis._delete(key)\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error deleting setting \"${key}\" from database`, err))\n\t\t\t.then(() => this.broadcast({type: 'delete', key}));\n\n\t\tthis.emit('set', key, undefined, true);\n\t}\n\n\thas(key: string) {\n\t\treturn this._cached.has(key);\n\t}\n\n\tkeys() {\n\t\treturn this._cached.keys();\n\t}\n\n\tclear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst old_cache = this._cached;\n\t\tthis._cached = new Map;\n\n\t\tfor(const key of old_cache.keys())\n\t\t\tthis.emit('changed', key, undefined, true);\n\n\t\tthis._clear()\n\t\t\t.catch(err => this.manager && this.manager.log.error(`Error clearing database`, err))\n\t\t\t.then(() => this.broadcast({type: 'clear'}));\n\t}\n\n\tentries() {\n\t\treturn this._cached.entries();\n\t}\n\n\tget size() {\n\t\treturn this._cached.size;\n\t}\n\n\n\t// IDB Interaction\n\n\tgetDB(second = false) {\n\t\tif ( this.db )\n\t\t\treturn Promise.resolve(this.db);\n\n\t\tif ( this._db_wait )\n\t\t\treturn this._db_wait;\n\n\t\tlet this_wait: Promise<IDBDatabase>;\n\t\treturn this._db_wait = this_wait = new Promise<IDBDatabase>((resolve, reject) => {\n\n\t\t\tconst request = window.indexedDB.open('FFZ', DB_VERSION);\n\t\t\tthis._onStart(request);\n\n\t\t\trequest.onerror = event => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error opening database.', event);\n\n\t\t\t\treject(event);\n\t\t\t\tthis._onFinish(request);\n\t\t\t}\n\n\t\t\trequest.onupgradeneeded = event => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.info(`Upgrading database from version ${event.oldVersion} to ${DB_VERSION}`);\n\n\t\t\t\tconst db = request.result;\n\n\t\t\t\tdb.createObjectStore('settings', {keyPath: 'k'});\n\t\t\t\tdb.createObjectStore('blobs');\n\t\t\t}\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.info(`Database opened. (After: ${(performance.now() - this._start_time).toFixed(5)}ms)`);\n\n\t\t\t\tthis.db = request.result;\n\n\t\t\t\ttry {\n\t\t\t\t\tconst trx = this.db.transaction(['settings', 'blobs'], 'readonly');\n\t\t\t\t\ttrx.objectStore('settings');\n\t\t\t\t\ttrx.objectStore('blobs');\n\t\t\t\t} catch(err) {\n\t\t\t\t\t// If this is an error, the database is in an invalid state.\n\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\tthis.manager.log.error(`Database in invalid state.`, err);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.db.close();\n\t\t\t\t\t} catch(e) { /* no-op */ }\n\n\t\t\t\t\tthis._onFinish(request);\n\t\t\t\t\tthis.db = null;\n\n\t\t\t\t\tif ( second )\n\t\t\t\t\t\treject(err);\n\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Try deleting the database and making a new one.\n\t\t\t\t\t\tconst delreq = window.indexedDB.deleteDatabase('FFZ');\n\t\t\t\t\t\tthis._onStart(delreq);\n\n\t\t\t\t\t\tdelreq.onerror = event => {\n\t\t\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\t\t\tthis.manager.log.error('Error deleting invalid database.', event);\n\t\t\t\t\t\t\treject(event);\n\t\t\t\t\t\t\tthis._onFinish(delreq);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelreq.onsuccess = () => {\n\t\t\t\t\t\t\tif ( this.manager )\n\t\t\t\t\t\t\t\tthis.manager.log.info('Deleted invalid database.');\n\n\t\t\t\t\t\t\tthis._onFinish(delreq);\n\t\t\t\t\t\t\tthis._db_wait = null;\n\t\t\t\t\t\t\tthis.getDB(true)\n\t\t\t\t\t\t\t\t.then(resolve)\n\t\t\t\t\t\t\t\t.catch(reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tresolve(this.db);\n\t\t\t\tthis._onFinish(request);\n\t\t\t}\n\t\t}).finally(() => {\n\t\t\tif ( this_wait === this._db_wait )\n\t\t\t\tthis._db_wait = null;\n\t\t});\n\t}\n\n\n\tasync loadSettings() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading settings from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst request = store.getAll();\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tfor(const entry of request.result)\n\t\t\t\t\tthis._cached.set(entry.k, entry.v);\n\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\trequest.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading settings from database.', err);\n\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _getKeys() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<IDBValidKey[]>((resolve,fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading keys from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst request = store.getAllKeys();\n\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve(request.result);\n\t\t\t};\n\n\t\t\trequest.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading keys from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\t\t});\n\t}\n\n\n\tasync _get(key: string) {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readonly'),\n\t\t\tstore = trx.objectStore('settings'),\n\t\t\tid = this._last_tx++;\n\n\t\tthis._onStart(id);\n\n\t\treturn new Promise<any>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted reading value from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.get(key);\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error reading value from database.', err);\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve(req.result.v);\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _set(key: string, value: any) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted setting value to database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.put({k: key, v: value});\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error setting value to database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t}\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\n\tasync _delete(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted deleting value from database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.delete(key);\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error deleting value from database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t}\n\n\n\tasync _clear() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\t// Limit concurrent access to this table.\n\t\tconst id = this._last_tx++;\n\t\tthis._onStart(id);\n\t\tconst release = await this._lock.wait();\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['settings'], 'readwrite'),\n\t\t\tstore = trx.objectStore('settings');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\n\t\t\ttrx.onabort = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Transaction aborted clearing database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\tconst req = store.clear();\n\n\t\t\treq.onerror = err => {\n\t\t\t\tif ( this.manager )\n\t\t\t\t\tthis.manager.log.error('Error clearing database.', err);\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tfail();\n\t\t\t};\n\n\t\t\treq.onsuccess = () => {\n\t\t\t\trelease();\n\t\t\t\tthis._onFinish(id);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t}\n\n\t/* Blobs */\n\n\tasync getBlob(key: string) {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readonly'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<BlobLike>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.get(key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = e => {\n\t\t\t\tif ( isValidBlob(req.result) )\n\t\t\t\t\tresolve(req.result);\n\t\t\t\telse\n\t\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync setBlob(key: string, value: BlobLike) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tif ( ! this.isValidBlob(value) )\n\t\t\tthrow new Error('Invalid blob type');\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.put(value, key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'set-blob', key});\n\t\t\t\tthis.emit('set-blob', key, value, false);\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync deleteBlob(key: string) {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = f;\n\t\t\tconst req = store.delete(key);\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'delete-blob', key});\n\t\t\t\tthis.emit('set-blob', key, undefined, true);\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync hasBlob(key: string) {\n\t\tconst keys = await this.blobKeys();\n\t\treturn keys.includes(key);\n\t}\n\n\tasync clearBlobs() {\n\t\tif ( this.disabled )\n\t\t\treturn;\n\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readwrite'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<void>((resolve, fail) => {\n\t\t\t//store.onerror = fail;\n\t\t\tconst req = store.clear();\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tresolve();\n\n\t\t\t\tthis.broadcast({type: 'clear-blobs'});\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync blobKeys() {\n\t\tconst db = await this.getDB(),\n\t\t\ttrx = db.transaction(['blobs'], 'readonly'),\n\t\t\tstore = trx.objectStore('blobs');\n\n\t\treturn new Promise<string[]>((resolve, fail) => {\n\t\t\tconst req = store.getAllKeys();\n\t\t\tthis._onStart(req);\n\n\t\t\treq.onerror = () => {\n\t\t\t\tfail();\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t\treq.onsuccess = () => {\n\t\t\t\tif ( Array.isArray(req.result) )\n\t\t\t\t\tresolve(req.result as string[]);\n\t\t\t\telse\n\t\t\t\t\tfail();\n\n\t\t\t\tthis._onFinish(req);\n\t\t\t}\n\t\t});\n\t}\n\n}\n\n\n// ============================================================================\n// CrossOriginStorageBridge\n// ============================================================================\n\nexport class CrossOriginStorageBridge extends RemoteSettingsProvider {\n\n\t// Static Stuff\n\n\tstatic supported() { return NOT_WWW_TWITCH && NOT_WWW_YT; }\n\tstatic hasContent() {\n\t\treturn CrossOriginStorageBridge.supported();\n\t}\n\n\tstatic priority = 100;\n\tstatic title = 'Cross-Origin Storage Bridge';\n\tstatic description = 'This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don\\'t want your settings to automatically synchronize for some reason.';\n\n\tstatic allowTransfer = false;\n\tstatic shouldUpdate = false;\n\n\t// State and Storage\n\tprivate frame: HTMLIFrameElement | null;\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tconst frame = this.frame = document.createElement('iframe');\n\t\tframe.src = (this.manager.root as any).host === 'youtube' ?\n\t\t\t'//www.youtube.com/__ffz_bridge/' :\n\t\t\t'//www.twitch.tv/p/ffz_bridge/';\n\t\tframe.id = 'ffz-settings-bridge';\n\t\tframe.style.width = '0';\n\t\tframe.style.height = '0';\n\n\t\tthis.onMessage = this.onMessage.bind(this);\n\n\t\twindow.addEventListener('message', this.onMessage);\n\t\tdocument.body.appendChild(frame);\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\tdisableEvents() {\n\t\t// TODO: Figure out what this would mean for CORS.\n\t}\n\n\n\t// CORS Communication\n\n\tonMessage(event: MessageEvent) {\n\t\tconst msg = event.data;\n\t\tif ( ! msg || ! msg.ffz_type )\n\t\t\treturn;\n\n\t\tthis.handleMessage(msg);\n\t}\n\n\tsend(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>) {\n\t\tif ( typeof msg === 'string' )\n\t\t\tmsg = {ffz_type: msg} as any;\n\n\t\ttry {\n\t\t\t// as any, because we have an error catcher for a reason\n\t\t\t((this.frame as any).contentWindow as unknown as Window).postMessage(\n\t\t\t\tmsg,\n\t\t\t\t'*',\n\t\t\t\ttransfer ? (Array.isArray(transfer) ? transfer : [transfer]) : undefined\n\t\t\t);\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error('Error sending message to bridge.', err, msg, transfer);\n\t\t}\n\t}\n\n}\n\n\n// ============================================================================\n// ExtensionProvider\n// ============================================================================\n\nexport class ExtensionProvider extends RemoteSettingsProvider {\n\n\t// Static Stuff\n\n\tstatic supported() { return EXTENSION }\n\n\tstatic hasContent() {\n\t\tif ( ! ExtensionProvider.supported() )\n\t\t\treturn false;\n\n\t\t// We need a promise since we need to message the extension and\n\t\t// request to know if it has keys or not.\n\t\treturn new Promise<boolean>((resolve) => {\n\t\t\tlet responded = false,\n\t\t\t\ttimeout: ReturnType<typeof setTimeout> | null = null ;\n\n\t\t\tconst listener = (evt: MessageEvent<any>) => {\n\t\t\t\tif (evt.source !== window)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (evt.data && evt.data.type === 'ffz_from_ext') {\n\t\t\t\t\tconst msg = evt.data.data,\n\t\t\t\t\t\ttype = msg?.ffz_type;\n\n\t\t\t\t\tif (type === 'has-keys') {\n\t\t\t\t\t\tresponded = true;\n\t\t\t\t\t\tresolve(msg.value);\n\t\t\t\t\t\tcleanup();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst cleanup = () => {\n\t\t\t\tif (!responded) {\n\t\t\t\t\tresponded = true;\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\n\t\t\t\twindow.removeEventListener('message', listener);\n\t\t\t}\n\n\t\t\twindow.addEventListener('message', listener);\n\n\t\t\twindow.postMessage({\n\t\t\t\ttype: 'ffz_to_ext',\n\t\t\t\tdata: {\n\t\t\t\t\tffz_type: 'check-has-keys'\n\t\t\t\t}\n\t\t\t}, '*');\n\n\t\t\ttimeout = setTimeout(cleanup, 1000);\n\t\t});\n\t}\n\n\tstatic priority = 101;\n\tstatic title = 'Browser Extension Storage';\n\tstatic description = 'This provider uses a browser extension service worker to store settings in a location that should not suffer from issues due to storage partitioning or cache clearing.';\n\n\tstatic allowTransfer = true;\n\tstatic shouldUpdate = true;\n\n\t// State and Storage\n\n\tconstructor(manager: SettingsManager) {\n\t\tsuper(manager);\n\n\t\tthis.onExtMessage = this.onExtMessage.bind(this);\n\t\twindow.addEventListener('message', this.onExtMessage);\n\t}\n\n\t// Stuff\n\n\tbroadcastTransfer() {\n\n\t}\n\n\tdisableEvents() {\n\n\t}\n\n\t// Communication\n\n\tonExtMessage(evt: MessageEvent<any>) {\n\t\tif (evt.source !== window)\n\t\t\treturn;\n\n\t\tif (evt.data?.type === 'ffz_from_ext' && evt.data.data?.ffz_type)\n\t\t\tthis.handleMessage(evt.data.data);\n\t}\n\n\tsend(msg: string | CorsMessage, transfer?: OptionalArray<Transferable>) {\n\t\tif ( typeof msg === 'string' )\n\t\t\tmsg = {ffz_type: msg} as any;\n\n\t\ttry {\n\t\t\twindow.postMessage(\n\t\t\t\t{\n\t\t\t\t\ttype: 'ffz_to_ext',\n\t\t\t\t\tdata: msg\n\t\t\t\t},\n\t\t\t\t'*',\n\t\t\t\ttransfer ? (Array.isArray(transfer) ? transfer : [transfer]) : undefined\n\t\t\t);\n\n\t\t} catch(err) {\n\t\t\tthis.manager.log.error('Error sending message to extension.', err, msg, transfer);\n\t\t}\n\t}\n\n}\n\n\n\ntype CorsRpcTypes = {\n\n\t'ready': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'load': {\n\t\tinput: void;\n\t\toutput: Record<string, any>;\n\t};\n\n\t'change': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: any;\n\t\t\tdeleted: boolean;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'init-load': {\n\t\tinput: void;\n\t\toutput: {\n\t\t\tblobs: boolean;\n\t\t\tvalues: Record<string, any>;\n\t\t}\n\t};\n\n\t'set': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: any;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'delete': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'clear': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'get-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: SerializedBlobLike | null;\n\t};\n\n\t'set-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tvalue: SerializedBlobLike | null;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'change-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t\tdeleted: boolean;\n\t\t};\n\t\toutput: void;\n\t}\n\n\t'delete-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: void;\n\t};\n\n\t'has-blob': {\n\t\tinput: {\n\t\t\tkey: string;\n\t\t};\n\t\toutput: boolean;\n\t};\n\n\t'clear-blobs': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n\t'blob-keys': {\n\t\tinput: void;\n\t\toutput: string[];\n\t};\n\n\t'flush': {\n\t\tinput: void;\n\t\toutput: void;\n\t};\n\n};\n\ntype CorsInput<K extends keyof CorsRpcTypes> = CorsRpcTypes[K] extends { input: infer U } ? U : void;\ntype CorsOutput<K extends keyof CorsRpcTypes> = CorsRpcTypes[K] extends { output: infer U } ? U : void;\n\ntype RPCInputMessage<K extends keyof CorsRpcTypes> = {\n\tffz_type: K;\n\tid?: number;\n} & CorsInput<K>;\n\ntype CorsReplyMessage = {\n\tffz_type: 'reply';\n\tid: number;\n\treply: any;\n};\n\ntype CorsReplyErrorMessage = {\n\tffz_type: 'reply-error';\n\tid: number;\n};\n\ntype CorsMessage = CorsReplyMessage | CorsReplyErrorMessage | {\n\t[K in keyof CorsRpcTypes]: RPCInputMessage<K>\n}[keyof CorsRpcTypes];\n\n\n\n// ============================================================================\n// Available Providers Map\n// ============================================================================\n\nexport const Providers: Record<string, typeof SettingsProvider> = {\n\n\tlocal: LocalStorageProvider,\n\tidb: IndexedDBProvider,\n\tcosb: CrossOriginStorageBridge,\n\t//ext: ExtensionProvider\n\n};\n","'use strict';\n\nimport type Logger from \"utilities/logging\";\nimport type SettingsProfile from \"./profile\";\nimport type { SettingDefinition, SettingsTypeHandler } from \"./types\";\nimport type SettingsContext from \"./context\";\n\n// ============================================================================\n// Settings Types\n// ============================================================================\n\nconst DEFAULT = Symbol('default');\n\n\nexport const basic: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[]) {\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) )\n\t\t\t\treturn [\n\t\t\t\t\tprofile.get(key) as T,\n\t\t\t\t\t[profile.id]\n\t\t\t\t]\n\t}\n}\n\n\nexport const object_merge: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[], definition: SettingDefinition<any>, log: Logger) {\n\t\tconst values: T[] = [],\n\t\t\tsources: number[] = [];\n\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) ) {\n\t\t\t\tconst val = profile.get<T>(key);\n\t\t\t\tif ( ! val || typeof val !== 'object' ) {\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\" of type ${typeof val}. Skipping.`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tsources.push(profile.id);\n\t\t\t\tvalues.unshift(val);\n\t\t\t}\n\n\t\tif ( sources.length )\n\t\t\treturn [\n\t\t\t\tObject.assign({}, ...values),\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\ntype UnwrapArray<T> = T extends Array<infer U> ? U : T;\n\nexport const basic_array_merge: SettingsTypeHandler = {\n\tget<T>(key: string, profiles: SettingsProfile[], definition: SettingDefinition<any>, log: Logger) {\n\t\tconst values: UnwrapArray<T>[] = [],\n\t\t\tsources: number[] = [];\n\n\t\tfor(const profile of profiles)\n\t\t\tif ( profile.has(key) ) {\n\t\t\t\tconst val = profile.get<UnwrapArray<T>>(key);\n\t\t\t\tif ( ! Array.isArray(val) ) {\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\"`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tsources.push(profile.id);\n\t\t\t\tfor(const v of val)\n\t\t\t\t\tvalues.push(v);\n\t\t\t}\n\n\t\tif ( sources.length )\n\t\t\treturn [\n\t\t\t\tvalues,\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\nexport const array_merge: SettingsTypeHandler = {\n\tdefault(val) {\n\t\tconst values = [];\n\t\tfor(const v of val)\n\t\t\tif ( v.t !== 'inherit' && v.t !== 'skip' && v.v )\n\t\t\t\tvalues.push(v.v);\n\n\t\treturn values;\n\t},\n\n\tget<T>(\n\t\tkey: string,\n\t\tprofiles: SettingsProfile[],\n\t\tdefinition: SettingDefinition<any>,\n\t\tlog: Logger,\n\t\tctx: SettingsContext\n\t) {\n\n\t\tconst values: UnwrapArray<T>[] = [],\n\t\t\tsources: number[] = [];\n\t\tlet trailing: UnwrapArray<T>[] = [];\n\t\tlet had_value = false;\n\n\t\tlet profs: (SettingsProfile | typeof DEFAULT)[] = profiles;\n\t\tif ( definition.inherit_default )\n\t\t\tprofs = [...profiles, DEFAULT];\n\n\t\tfor(const profile of profs) {\n\t\t\tlet value;\n\t\t\tif ( profile === DEFAULT ) {\n\t\t\t\tvalue = definition.default;\n\t\t\t\tif ( typeof value === 'function' )\n\t\t\t\t\tvalue = value(ctx);\n\n\t\t\t} else if ( profile.has(key) )\n\t\t\t\tvalue = profile.get(key);\n\t\t\telse\n\t\t\t\tcontinue;\n\n\t\t\tif ( ! Array.isArray(value) ) {\n\t\t\t\tif ( profile !== DEFAULT )\n\t\t\t\t\tlog.warn(`Profile #${profile.id} has an invalid value for \"${key}\" of type ${typeof value}. Skipping.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst trail: UnwrapArray<T>[] = [];\n\n\t\t\tif ( profile !== DEFAULT )\n\t\t\t\tsources.push(profile.id);\n\n\t\t\tlet is_trailing = false;\n\t\t\tfor(const val of value) {\n\t\t\t\thad_value = true;\n\t\t\t\tif ( val.t === 'inherit' )\n\t\t\t\t\tis_trailing = true;\n\t\t\t\telse if ( val.t === 'skip' )\n\t\t\t\t\tcontinue;\n\t\t\t\telse if ( is_trailing )\n\t\t\t\t\ttrail.push(val.v);\n\t\t\t\telse\n\t\t\t\t\tvalues.push(val.v);\n\t\t\t}\n\n\t\t\ttrailing = trail.concat(trailing);\n\n\t\t\t// If we didn't run into an inherit, don't inherit.\n\t\t\tif ( ! is_trailing && ! definition.always_inherit )\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( had_value )\n\t\t\treturn [\n\t\t\t\tvalues.concat(trailing),\n\t\t\t\tsources\n\t\t\t]\n\t}\n}\n\n\n\nexport default {\n\tbasic,\n\tobject_merge,\n\tbasic_array_merge,\n\tarray_merge\n} as Record<string, SettingsTypeHandler>;\n","'use strict';\n\nimport type { SettingUiDefinition, SettingValidator } from \"./types\";\n\n\nfunction do_number(value: any, definition: SettingUiDefinition<number>) {\n\tif ( typeof value !== 'number' || isNaN(value) || ! isFinite(value) )\n\t\treturn false;\n\n\tconst bounds = definition.bounds;\n\tif ( Array.isArray(bounds) ) {\n\t\tif ( bounds.length >= 3 ) {\n\t\t\t// [low, inclusive, high, inclusive]\n\t\t\tif ( (bounds[1] ? (value < bounds[0]) : (value <= bounds[0])) ||\n\t\t\t\t\t(bounds[3] ? (value > (bounds as any)[2]) : (value >= (bounds as any)[2])) )\n\t\t\t\treturn false;\n\n\t\t} else if ( bounds.length === 2 ) {\n\t\t\t// [low, inclusive] or [low, high] ?\n\t\t\tif ( typeof bounds[1] === 'boolean' ) {\n\t\t\t\tif ( bounds[1] ? value < bounds[0] : value <= bounds[0] )\n\t\t\t\t\treturn false;\n\t\t\t} else if ( value < bounds[0] || value > bounds[1] )\n\t\t\t\treturn false;\n\t\t} else if ( bounds.length === 1 && value < bounds[0] )\n\t\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport const process_to_int: SettingValidator<number> = (\n\tvalue,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?\\d+$/.test(value) )\n\t\tvalue = parseInt(value, 10);\n\telse if ( typeof value !== 'number' )\n\t\treturn false;\n\n\treturn do_number(value, definition);\n}\n\nexport const process_to_float: SettingValidator<number> = (\n\tvalue,\n\tdefinition\n) => {\n\tif ( typeof value === 'string' && /^-?[\\d.]+$/.test(value) )\n\t\tvalue = parseFloat(value);\n\telse if ( typeof value !== 'number' )\n\t\treturn false;\n\n\treturn do_number(value, definition);\n}\n","'use strict';\n\nimport type SettingsManager from 'root/src/settings';\nimport type { FineWrapper } from 'root/src/utilities/compat/fine';\nimport type Fine from 'root/src/utilities/compat/fine';\nimport type { ReactStateNode } from 'root/src/utilities/compat/react-types';\n\n// ============================================================================\n// Loadable Stuff\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport type { AnyFunction } from 'utilities/types';\nimport type Twilight from '..';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\n\t}\n\tinterface ModuleMap {\n\t\t'site.loadable': Loadable\n\t}\n\tinterface SettingsTypeMap {\n\t\t'chat.hype.show-pinned': boolean;\n\t\t'layout.turbo-cta': boolean;\n\t}\n}\n\n\ntype LoadableNode = ReactStateNode<{\n\tcomponent: string;\n\tloader: any;\n}, {\n\tComponent?: AnyFunction;\n}>;\n\ntype ErrorBoundaryNode = ReactStateNode<{\n\tname: string;\n\tonError: any;\n\tchildren: any;\n}> & {\n\tonErrorBoundaryTestEmit: any\n}\n\n\nexport default class Loadable extends Module {\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\tsite: Twilight = null as any;\n\tfine: Fine = null as any;\n\n\t// State\n\toverrides: Map<string, boolean>;\n\n\t// Fine\n\tErrorBoundaryComponent: FineWrapper<ErrorBoundaryNode>;\n\tLoadableComponent: FineWrapper<LoadableNode>;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\t\tthis.inject('site');\n\n\t\tthis.LoadableComponent = this.fine.define(\n\t\t\t'loadable-component',\n\t\t\tn =>\n\t\t\t\t(n as LoadableNode).props?.component &&\n\t\t\t\t(n as LoadableNode).props.loader\n\t\t);\n\n\t\tthis.ErrorBoundaryComponent = this.fine.define(\n\t\t\t'error-boundary-component',\n\t\t\tn =>\n\t\t\t\t(n as ErrorBoundaryNode).props?.name &&\n\t\t\t\t(n as ErrorBoundaryNode).props?.onError &&\n\t\t\t\t(n as ErrorBoundaryNode).props?.children &&\n\t\t\t\t(n as ErrorBoundaryNode).onErrorBoundaryTestEmit\n\t\t);\n\n\t\tthis.overrides = new Map();\n\n\t}\n\n\tonEnable() {\n\t\tthis.settings.getChanges('chat.hype.show-pinned', val => {\n\t\t\tthis.toggle('PaidPinnedChatMessageList', val);\n\t\t});\n\n\t\tthis.settings.getChanges('layout.turbo-cta', val => {\n\t\t\tthis.toggle('TopNav__TurboButton_Available', val);\n\t\t});\n\n\t\tthis.ErrorBoundaryComponent.ready((cls, instances) => {\n\t\t\tthis.log.debug('Found Error Boundary component wrapper.');\n\n\t\t\tconst t = this,\n\t\t\t\tproto = cls.prototype as ErrorBoundaryNode,\n\t\t\t\told_render = proto.render;\n\n\t\t\t(proto as any)._ffz_wrapped_render = old_render;\n\t\t\tproto.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tconst type = this.props.name;\n\t\t\t\t\tif ( t.overrides.has(type) && ! t.shouldRender(type) )\n\t\t\t\t\t\treturn null;\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.ErrorBoundaryComponent.updateInstances();\n\t\t});\n\n\t\tthis.LoadableComponent.ready((cls, instances) => {\n\t\t\tthis.log.debug('Found Loadable component wrapper.');\n\n\t\t\tconst t = this,\n\t\t\t\tproto = cls.prototype,\n\t\t\t\told_render = proto.render;\n\n\t\t\tproto.render = function() {\n\t\t\t\ttry {\n\t\t\t\t\tconst type = this.props.component;\n\t\t\t\t\tif ( t.overrides.has(type) && this.state ) {\n\t\t\t\t\t\tlet cmp = this.state.Component;\n\t\t\t\t\t\tif ( typeof cmp === 'function' && ! (cmp as any).ffzWrapped ) {\n\t\t\t\t\t\t\tconst React = t.site.getReact(),\n\t\t\t\t\t\t\t\tcreateElement = React && React.createElement;\n\n\t\t\t\t\t\t\tif ( createElement ) {\n\t\t\t\t\t\t\t\tif ( ! (cmp as any).ffzWrapper ) {\n\t\t\t\t\t\t\t\t\tconst th = this;\n\t\t\t\t\t\t\t\t\tfunction FFZWrapper(props: any) {\n\t\t\t\t\t\t\t\t\t\tif ( t.shouldRender(th.props.component) )\n\t\t\t\t\t\t\t\t\t\t\treturn createElement(cmp, props);\n\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tFFZWrapper.ffzWrapped = true;\n\t\t\t\t\t\t\t\t\tFFZWrapper.displayName = `FFZWrapper(${this.props.component})`;\n\t\t\t\t\t\t\t\t\t(cmp as any).ffzWrapper = FFZWrapper;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.state.Component = (cmp as any).ffzWrapper;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch(err) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t}\n\n\t\t\t\treturn old_render.call(this);\n\t\t\t}\n\n\t\t\tthis.LoadableComponent.updateInstances();\n\t\t});\n\t}\n\n\ttoggle(cmp: string, state: boolean | null = null) {\n\t\tconst existing = this.overrides.get(cmp) ?? true;\n\n\t\tif ( state == null )\n\t\t\tstate = ! existing;\n\t\telse\n\t\t\tstate = !! state;\n\n\t\tif ( state !== existing ) {\n\t\t\tthis.overrides.set(cmp, state);\n\t\t\tthis.update(cmp);\n\t\t}\n\t}\n\n\tupdate(cmp: string) {\n\t\tfor(const inst of this.LoadableComponent.instances) {\n\t\t\tconst type = inst.props?.component;\n\t\t\tif ( type && type === cmp ) {\n\t\t\t\tinst.forceUpdate();\n\t\t\t}\n\t\t}\n\n\t\tfor(const inst of this.ErrorBoundaryComponent.instances) {\n\t\t\tconst name = inst.props?.name;\n\t\t\tif ( name && name === cmp ) {\n\t\t\t\tinst.forceUpdate();\n\t\t\t}\n\t\t}\n\t}\n\n\tshouldRender(cmp: string) {\n\t\treturn this.overrides.get(cmp) ?? true;\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Sub Button\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport {createElement} from 'utilities/dom';\nimport type SettingsManager from 'src/settings';\nimport type TranslationManager from 'src/i18n';\nimport type Fine from 'utilities/compat/fine';\nimport type { FineWrapper } from 'utilities/compat/fine';\nimport type { ReactStateNode } from 'root/src/utilities/compat/react-types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\t'site.sub_button': SubButton;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'layout.swap-sidebars': unknown;\n\t\t'sub-button.prime-notice': boolean;\n\t}\n}\n\ntype SubButtonNode = ReactStateNode<{\n\tdata?: {\n\t\tuser?: {\n\t\t\tself?: {\n\t\t\t\tcanPrimeSubscribe: boolean;\n\t\t\t\tsubscriptionBenefit: unknown;\n\t\t\t}\n\t\t}\n\t}\n}> & {\n\thandleSubMenuAction: any;\n\topenSubModal: any;\n};\n\nexport default class SubButton extends Module {\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\tfine: Fine = null as any;\n\tsettings: SettingsManager = null as any;\n\n\t// Stuff\n\tSubButton: FineWrapper<SubButtonNode>;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t\tthis.inject('site.fine');\n\n\t\tthis.settings.add('sub-button.prime-notice', {\n\t\t\tdefault: true,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Channel > Metadata >> Subscription',\n\t\t\t\ttitle: 'Show Prime Reminder',\n\t\t\t\tdescription: 'Display a crown on subscription buttons when your free channel sub with Prime is available.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t},\n\n\t\t\tchanged: () => this.SubButton.forceUpdate()\n\t\t});\n\n\t\tthis.SubButton = this.fine.define(\n\t\t\t'sub-button',\n\t\t\tn =>\n\t\t\t\t(n as SubButtonNode).handleSubMenuAction &&\n\t\t\t\t(n as SubButtonNode).openSubModal,\n\t\t\t['user', 'user-home', 'user-video', 'user-clip', 'video', 'user-videos', 'user-clips', 'user-collections', 'user-events', 'user-followers', 'user-following']\n\t\t);\n\t}\n\n\tonEnable() {\n\t\tthis.settings.on(':changed:layout.swap-sidebars', () =>\n\t\t\tthis.SubButton.forceUpdate());\n\n\t\tthis.SubButton.ready((cls, instances) => {\n\t\t\tfor(const inst of instances)\n\t\t\t\tthis.updateSubButton(inst);\n\t\t});\n\n\t\tthis.SubButton.on('mount', this.updateSubButton, this);\n\t\tthis.SubButton.on('update', this.updateSubButton, this);\n\t}\n\n\n\tupdateSubButton(inst: SubButtonNode) {\n\t\tconst container = this.fine.getChildNode<HTMLElement>(inst),\n\t\t\tbtn = container?.querySelector('button[data-a-target=\"subscribe-button\"]');\n\t\tif ( ! btn )\n\t\t\treturn;\n\n\t\tconst props = inst.props,\n\t\t\tdata = props.data && props.data.user,\n\t\t\tself = data && data.self,\n\t\t\tshould_show = this.settings.get('sub-button.prime-notice') && self && self.canPrimeSubscribe && ! self.subscriptionBenefit,\n\n\t\t\ticon = btn.querySelector('.ffz--can-prime');\n\n\t\tif ( should_show && ! icon ) {\n\t\t\tbtn.insertBefore(<span class=\"tw-button__icon tw-button__icon--left ffz--can-prime\">\n\t\t\t\t<figure\n\t\t\t\t\tclass=\"ffz-i-crown ffz-tooltip\"\n\t\t\t\t\tdata-title={this.i18n.t('sub-button.prime', 'Your free channel sub with Prime is available.')}\n\t\t\t\t/>\n\t\t\t</span>, btn.firstElementChild);\n\n\t\t\tbtn.appendChild(<span class=\"ffz--post-prime\" />);\n\n\t\t} else if ( ! should_show && icon ) {\n\t\t\ticon.remove();\n\t\t\tconst post = btn.querySelector('.ffz--post-prime');\n\t\t\tif ( post )\n\t\t\t\tpost.remove();\n\t\t}\n\t}\n}\n","\n/** A union of the various Blob types that are supported. */\nexport type BlobLike = Blob | File | ArrayBuffer | Uint8Array;\n\n/** A union of the various serialized blob types. */\nexport type SerializedBlobLike = SerializedBlob | SerializedFile | SerializedArrayBuffer | SerializedUint8Array;\n\n/** A serialized {@link Blob} representation. */\nexport type SerializedBlob = {\n\ttype: 'blob';\n\tmime: string;\n\tbuffer: ArrayBuffer\n};\n\n/** A serialized {@link File} representation. */\nexport type SerializedFile = {\n\ttype: 'file';\n\tmime: string;\n\tname: string;\n\tmodified: number;\n\tbuffer: ArrayBuffer\n};\n\n/** A serialized {@link ArrayBuffer} representation. */\nexport type SerializedArrayBuffer = {\n\ttype: 'ab';\n\tbuffer: ArrayBuffer;\n};\n\n/** A serialized {@link Uint8Array} representation. */\nexport type SerializedUint8Array = {\n\ttype: 'u8',\n\tbuffer: ArrayBuffer\n};\n\n/**\n * Determine if the provided object is a valid Blob that can be serialized\n * for transmission via a messaging API.\n */\nexport function isValidBlob(blob: any): blob is BlobLike {\n\treturn blob instanceof Blob || blob instanceof File || blob instanceof ArrayBuffer || blob instanceof Uint8Array;\n}\n\n/**\n * Serialize the provided {@link BlobLike} object into a format that can be\n * transmitted via a messaging API.\n */\nexport async function serializeBlob(blob?: BlobLike): Promise<SerializedBlobLike | null> {\n\tif ( ! blob )\n\t\treturn null;\n\n\tif ( blob instanceof Blob )\n\t\treturn {\n\t\t\ttype: 'blob',\n\t\t\tmime: blob.type,\n\t\t\tbuffer: await blob.arrayBuffer(),\n\t\t}\n\n\tif ( blob instanceof File )\n\t\treturn {\n\t\t\ttype: 'file',\n\t\t\tmime: blob.type,\n\t\t\tname: blob.name,\n\t\t\tmodified: blob.lastModified,\n\t\t\tbuffer: await blob.arrayBuffer()\n\t\t}\n\n\tif ( blob instanceof ArrayBuffer )\n\t\treturn {\n\t\t\ttype: 'ab',\n\t\t\tbuffer: blob\n\t\t}\n\n\tif ( blob instanceof Uint8Array )\n\t\treturn {\n\t\t\ttype: 'u8',\n\t\t\tbuffer: blob.buffer\n\t\t}\n\n\tthrow new TypeError('Invalid type');\n}\n\n/**\n * Deserialize the provided {@link SerializedBlobLike} object into a copy of\n * the original {@link BlobLike}.\n */\nexport function deserializeBlob(data: SerializedBlobLike): BlobLike | null {\n\tif ( ! data || ! data.type )\n\t\treturn null;\n\n\tif ( data.type === 'blob' )\n\t\treturn new Blob([data.buffer], {type: data.mime});\n\n\tif ( data.type === 'file' )\n\t\treturn new File([data.buffer], data.name, {type: data.mime, lastModified: data.modified});\n\n\tif ( data.type === 'ab' )\n\t\treturn data.buffer;\n\n\tif ( data.type === 'u8' )\n\t\treturn new Uint8Array(data.buffer);\n\n\tthrow new TypeError('Invalid type');\n}\n","'use strict';\n\nexport type CVDMatrix = [number, number, number, number, number, number, number, number, number];\n\nexport function hue2rgb(p: number, q: number, t: number) {\n\tif ( t < 0 ) t += 1;\n\tif ( t > 1 ) t -= 1;\n\tif ( t < 1/6 )\n\t\treturn p + (q-p) * 6 * t;\n\tif ( t < 1/2 )\n\t\treturn q;\n\tif ( t < 2/3 )\n\t\treturn p + (q-p) * (2/3 - t) * 6;\n\treturn p;\n}\n\nexport function bit2linear(channel: number) {\n\t// http://www.brucelindbloom.com/Eqn_RGB_to_XYZ.html\n\t// This converts rgb 8bit to rgb linear, lazy because the other algorithm is really really dumb\n\t//return Math.pow(channel, 2.2);\n\n\t// CSS Colors Level 4 says 0.03928, Bruce Lindbloom who cared to write all algos says 0.04045, used bruce because whynawt\n\treturn (channel <= 0.04045) ? channel / 12.92 : Math.pow((channel + 0.055) / 1.055, 2.4);\n}\n\nexport function linear2bit(channel: number) {\n\t// Using lazy conversion in the other direction as well\n\t//return Math.pow(channel, 1/2.2);\n\n\t// I'm honestly not sure about 0.0031308, I've only seen it referenced on Bruce Lindbloom's site\n\treturn (channel <= 0.0031308) ? channel * 12.92 : Math.pow(1.055 * channel, 1/2.4) - 0.055;\n}\n\n\nexport interface BaseColor {\n\teq(other: BaseColor | null | undefined, ignoreAlpha: boolean): boolean;\n\n\ttoCSS(): string;\n\ttoHex(): string;\n\n\ttoRGBA(): RGBAColor;\n\ttoHSVA(): HSVAColor;\n\ttoHSLA(): HSLAColor;\n\ttoXYZA(): XYZAColor;\n\ttoLUVA(): LUVAColor;\n}\n\n\nclass RGBAColor implements BaseColor {\n\n\treadonly r: number;\n\treadonly g: number;\n\treadonly b: number;\n\treadonly a: number;\n\n\tconstructor(r: number, g: number, b: number, a?: number) {\n\t\tthis.r = r || 0;\n\t\tthis.g = g || 0;\n\t\tthis.b = b || 0;\n\t\tthis.a = a || 0;\n\t}\n\n\teq(other?: BaseColor | null, ignoreAlpha = false): boolean {\n\t\tif ( other instanceof RGBAColor )\n\t\t\treturn this.r === other.r && this.g === other.g && this.b === other.b && (ignoreAlpha || this.a === other.a);\n\t\treturn other ? this.eq(other.toRGBA(), ignoreAlpha) : false;\n\t}\n\n\t// ========================================================================\n\t// Updates\n\t// ========================================================================\n\n\t_r(r: number) { return new RGBAColor(r, this.g, this.b, this.a); }\n\t_g(g: number) { return new RGBAColor(this.r, g, this.b, this.a); }\n\t_b(b: number) { return new RGBAColor(this.r, this.g, b, this.a); }\n\t_a(a: number) { return new RGBAColor(this.r, this.g, this.b, a); }\n\n\t// ========================================================================\n\t// Conversion: to RGBA\n\t// ========================================================================\n\n\tstatic fromName(name: string) {\n\t\tconst ctx = Color.getContext();\n\t\tctx.clearRect(0, 0, 1, 1);\n\t\tctx.fillStyle = name;\n\t\tctx.fillRect(0, 0, 1, 1);\n\t\tconst data = ctx.getImageData(0, 0, 1, 1);\n\t\tif ( data?.data?.length !== 4 )\n\t\t\treturn null;\n\n\t\treturn new RGBAColor(data.data[0], data.data[1], data.data[2], data.data[3] / 255);\n\t}\n\n\tstatic fromCSS(input: string) {\n\t\tinput = input && input.trim();\n\t\tif ( ! input?.length )\n\t\t\treturn null;\n\n\t\tif ( input.charAt(0) === '#' )\n\t\t\treturn RGBAColor.fromHex(input);\n\n\t\t// fillStyle can handle rgba() inputs\n\t\t/*const match = /rgba?\\( *(\\d+%?) *, *(\\d+%?) *, *(\\d+%?) *(?:, *([\\d.]+))?\\)/i.exec(input);\n\t\tif ( match ) {\n\t\t\tlet r: number, g: number, b: number, a: number;\n\t\t\tlet rS = match[1],\n\t\t\t\tgS = match[2],\n\t\t\t\tbS = match[3],\n\t\t\t\taS = match[4];\n\n\t\t\tif ( rS.charAt(rS.length-1) === '%' )\n\t\t\t\tr = 255 * (parseInt(rS,10) / 100);\n\t\t\telse\n\t\t\t\tr = parseInt(rS,10);\n\n\t\t\tif ( gS.charAt(gS.length-1) === '%' )\n\t\t\t\tg = 255 * (parseInt(gS,10) / 100);\n\t\t\telse\n\t\t\t\tg = parseInt(gS,10);\n\n\t\t\tif ( bS.charAt(bS.length-1) === '%' )\n\t\t\t\tb = 255 * (parseInt(bS,10) / 100);\n\t\t\telse\n\t\t\t\tb = parseInt(bS,10);\n\n\t\t\tif ( aS )\n\t\t\t\tif ( aS.charAt(aS.length-1) === '%' )\n\t\t\t\t\ta = parseInt(aS,10) / 100;\n\t\t\t\telse\n\t\t\t\t\ta = parseFloat(aS);\n\t\t\telse\n\t\t\t\ta = 1;\n\n\t\t\treturn new RGBAColorA(\n\t\t\t\tMath.min(Math.max(0, r), 255),\n\t\t\t\tMath.min(Math.max(0, g), 255),\n\t\t\t\tMath.min(Math.max(0, b), 255),\n\t\t\t\tMath.min(Math.max(0, a), 1)\n\t\t\t);\n\t\t}*/\n\n\t\treturn RGBAColor.fromName(input);\n\t}\n\n\tstatic fromHex(input: string) {\n\t\tif ( input.charAt(0) === '#' )\n\t\t\tinput = input.slice(1);\n\n\t\tlet raw: number;\n\t\tlet alpha: number = 255;\n\n\t\tif ( input.length === 4 ) {\n\t\t\talpha = parseInt(input[3], 16) * 17;\n\t\t\tinput = input.slice(0, 3);\n\t\t} else if ( input.length === 8 ) {\n\t\t\talpha = parseInt(input.slice(6), 16);\n\t\t\tinput = input.slice(0, 6);\n\t\t}\n\n\t\tif ( input.length === 3 )\n\t\t\traw =\n\t\t\t\t((parseInt(input[0], 16) * 17) << 16) +\n\t\t\t\t((parseInt(input[1], 16) * 17) << 8) +\n\t\t\t\tparseInt(input[2], 16) * 17;\n\n\t\telse\n\t\t\traw = parseInt(input, 16);\n\n\t\treturn new RGBAColor(\n\t\t\t(raw >> 16), // Red\n\t\t\t(raw >> 8 & 0x00FF), // Green\n\t\t\t(raw & 0xFF), // Blue\n\t\t\talpha / 255 // Alpha (scaled from 0 to 1)\n\t\t);\n\t}\n\n\tstatic fromHSVA(h: number, s: number, v: number, a?: number) {\n\t\tlet r: number, g: number, b: number;\n\n\t\tconst i = Math.floor(h * 6),\n\t\t\tf = h * 6 - i,\n\t\t\tp = v * (1 - s),\n\t\t\tq = v * (1 - f * s),\n\t\t\tt = v * (1 - (1 - f) * s);\n\n\t\tswitch(i % 6) {\n\t\t\tcase 0: r = v; g = t; b = p; break;\n\t\t\tcase 1: r = q; g = v; b = p; break;\n\t\t\tcase 2: r = p; g = v; b = t; break;\n\t\t\tcase 3: r = p; g = q; b = v; break;\n\t\t\tcase 4: r = t; g = p; b = v; break;\n\t\t\tdefault: // case 5:\n\t\t\t\tr = v; g = p; b = q;\n\t\t}\n\n\t\treturn new RGBAColor(\n\t\t\tMath.round(Math.min(Math.max(0, r*255), 255)),\n\t\t\tMath.round(Math.min(Math.max(0, g*255), 255)),\n\t\t\tMath.round(Math.min(Math.max(0, b*255), 255)),\n\t\t\ta === undefined ? 1 : a\n\t\t);\n\t}\n\n\tstatic fromHSLA(h: number, s: number, l: number, a?: number) {\n\t\tif ( s === 0 ) {\n\t\t\tconst v = Math.round(Math.min(Math.max(0, 255*l), 255));\n\t\t\treturn new RGBAColor(v, v, v, a === undefined ? 1 : a);\n\t\t}\n\n\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s,\n\t\t\tp = 2 * l - q;\n\n\t\treturn new RGBAColor(\n\t\t\tMath.round(Math.min(Math.max(0, 255 * hue2rgb(p, q, h + 1/3)), 255)),\n\t\t\tMath.round(Math.min(Math.max(0, 255 * hue2rgb(p, q, h)), 255)),\n\t\t\tMath.round(Math.min(Math.max(0, 255 * hue2rgb(p, q, h - 1/3)), 255)),\n\t\t\ta === undefined ? 1 : a\n\t\t);\n\t}\n\n\tstatic fromXYZA(x: number, y: number, z: number, a?: number) {\n\t\tconst R =  3.240479 * x - 1.537150 * y - 0.498535 * z,\n\t\t\tG = -0.969256 * x + 1.875992 * y + 0.041556 * z,\n\t\t\tB =  0.055648 * x - 0.204043 * y + 1.057311 * z;\n\n\t\t// Make sure we end up in a real color space\n\t\treturn new RGBAColor(\n\t\t\tMath.max(0, Math.min(255, 255 * linear2bit(R))),\n\t\t\tMath.max(0, Math.min(255, 255 * linear2bit(G))),\n\t\t\tMath.max(0, Math.min(255, 255 * linear2bit(B))),\n\t\t\ta === undefined ? 1 : a\n\t\t);\n\t}\n\n\t// ========================================================================\n\t// Conversion: from RGBA\n\t// ========================================================================\n\n\t// CSS\n\ttoCSS() {\n\t\tif ( this.a !== 1 )\n\t\t\treturn `rgba(${this.r},${this.g},${this.b},${this.a})`;\n\t\treturn this.toHex();\n\t}\n\n\ttoHex() {\n\t\tconst value = (Math.round(this.r) << 16) + (Math.round(this.g) << 8) + Math.round(this.b);\n\t\treturn `#${value.toString(16).padStart(6, '0')}`;\n\t}\n\n\t// Color Spaces\n\ttoRGBA() { return this; }\n\ttoHSVA() { return HSVAColor.fromRGBA(this.r, this.g, this.b, this.a); }\n\ttoHSLA() { return HSLAColor.fromRGBA(this.r, this.g, this.b, this.a); }\n\ttoXYZA() { return XYZAColor.fromRGBA(this.r, this.g, this.b, this.a); }\n\ttoLUVA() { return this.toXYZA().toLUVA(); }\n\n\t// ========================================================================\n\t// Processing\n\t// ========================================================================\n\n\tget_Y() {\n\t\treturn ((0.299 * this.r) + ( 0.587 * this.g) + ( 0.114 * this.b)) / 255;\n\t}\n\n\tluminance() {\n\t\tconst r = bit2linear(this.r / 255),\n\t\t\tg = bit2linear(this.g / 255),\n\t\t\tb = bit2linear(this.b / 255);\n\n\t\treturn (0.2126 * r) + (0.7152 * g) + (0.0722 * b);\n\t}\n\n\t/** @deprecated This is a horrible function. */\n\tbrighten(amount?: number) {\n\t\tamount = typeof amount === `number` ? amount : 1;\n\t\tamount = Math.round(255 * (amount / 100));\n\n\t\treturn new RGBAColor(\n\t\t\tMath.max(0, Math.min(255, this.r + amount)),\n\t\t\tMath.max(0, Math.min(255, this.g + amount)),\n\t\t\tMath.max(0, Math.min(255, this.b + amount)),\n\t\t\tthis.a\n\t\t);\n\t}\n\n\tdaltonize(type: string | CVDMatrix) {\n\t\tlet cvd: CVDMatrix;\n\t\tif ( typeof type === 'string' ) {\n\t\t\tif ( Color.CVDMatrix.hasOwnProperty(type) )\n\t\t\t\tcvd = Color.CVDMatrix[type];\n\t\t\telse\n\t\t\t\tthrow new Error('Invalid CVD matrix');\n\t\t} else\n\t\t\tcvd = type;\n\n\t\tconst cvd_a = cvd[0], cvd_b = cvd[1], cvd_c = cvd[2],\n\t\t\tcvd_d = cvd[3], cvd_e = cvd[4], cvd_f = cvd[5],\n\t\t\tcvd_g = cvd[6], cvd_h = cvd[7], cvd_i = cvd[8];\n\n\t\t//let L, M, S, l, m, s, R, G, B, RR, GG, BB;\n\n\t\t// RGB to LMS matrix conversion\n\t\tconst L = (17.8824 * this.r) + (43.5161 * this.g) + (4.11935 * this.b),\n\t\t\tM = (3.45565 * this.r) + (27.1554 * this.g) + (3.86714 * this.b),\n\t\t\tS = (0.0299566 * this.r) + (0.184309 * this.g) + (1.46709 * this.b);\n\n\t\t// Simulate color blindness\n\t\tconst l = (cvd_a * L) + (cvd_b * M) + (cvd_c * S),\n\t\t\tm = (cvd_d * L) + (cvd_e * M) + (cvd_f * S),\n\t\t\ts = (cvd_g * L) + (cvd_h * M) + (cvd_i * S);\n\n\t\t// LMS to RGB matrix conversion\n\t\tlet R = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s),\n\t\t\tG = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s),\n\t\t\tB = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\n\n\t\t// Isolate invisible colors to color vision deficiency (calculate error matrix)\n\t\tR = this.r - R;\n\t\tG = this.g - G;\n\t\tB = this.b - B;\n\n\t\t// Shift colors towards visible spectrum (apply error modifications)\n\t\tconst RR = (0.0 * R) + (0.0 * G) + (0.0 * B),\n\t\t\tGG = (0.7 * R) + (1.0 * G) + (0.0 * B),\n\t\t\tBB = (0.7 * R) + (0.0 * G) + (1.0 * B);\n\n\t\t// Add compensation to original values\n\t\tR = Math.min(Math.max(0, RR + this.r), 255);\n\t\tG = Math.min(Math.max(0, GG + this.g), 255);\n\t\tB = Math.min(Math.max(0, BB + this.b), 255);\n\n\t\treturn new RGBAColor(R, G, B, this.a);\n\t}\n\n}\n\n\nclass HSVAColor implements BaseColor {\n\n\treadonly h: number;\n\treadonly s: number;\n\treadonly v: number;\n\treadonly a: number;\n\n\tconstructor(h: number, s: number, v: number, a?: number) {\n\t\tthis.h = h || 0;\n\t\tthis.s = s || 0;\n\t\tthis.v = v || 0;\n\t\tthis.a = a || 0;\n\t}\n\n\teq(other?: BaseColor | null, ignoreAlpha = false): boolean {\n\t\tif ( other instanceof HSVAColor )\n\t\t\treturn this.h === other.h && this.s === other.s && this.v === other.v && (ignoreAlpha || this.a === other.a);\n\t\treturn other ? this.eq(other.toHSVA(), ignoreAlpha) : false;\n\t}\n\n\t// ========================================================================\n\t// Updates\n\t// ========================================================================\n\n\t_h(h: number) { return new HSVAColor(h, this.s, this.v, this.a); }\n\t_s(s: number) { return new HSVAColor(this.h, s, this.v, this.a); }\n\t_v(v: number) { return new HSVAColor(this.h, this.s, v, this.a); }\n\t_a(a: number) { return new HSVAColor(this.h, this.s, this.v, a); }\n\n\t// ========================================================================\n\t// Conversion: to HSVA\n\t// ========================================================================\n\n\tstatic fromRGBA(r: number, g: number, b: number, a?: number) {\n\t\tr /= 255; g /= 255; b /= 255;\n\n\t\tconst max = Math.max(r, g, b),\n\t\t\tmin = Math.min(r, g, b),\n\t\t\td = Math.min(Math.max(0, max - min), 1),\n\n\t\t\ts = max === 0 ? 0 : d / max,\n\t\t\tv = max;\n\n\t\tlet h;\n\n\t\tif ( d === 0 )\n\t\t\th = 0;\n\t\telse {\n\t\t\tswitch(max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: // case b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\t\t\th /= 6;\n\t\t}\n\n\t\treturn new HSVAColor(\n\t\t\th,\n\t\t\ts,\n\t\t\tv,\n\t\t\ta === undefined ? 1 : a\n\t\t);\n\t}\n\n\t// ========================================================================\n\t// Conversion: from HSVA\n\t// ========================================================================\n\n\ttoCSS() { return this.toRGBA().toCSS(); }\n\ttoHex() { return this.toRGBA().toHex(); }\n\n\ttoRGBA() { return RGBAColor.fromHSVA(this.h, this.s, this.v, this.a); }\n\ttoHSVA() { return this; }\n\ttoHSLA() { return this.toRGBA().toHSLA(); }\n\ttoXYZA() { return this.toRGBA().toXYZA(); }\n\ttoLUVA() { return this.toRGBA().toLUVA(); }\n\n}\n\n\nclass HSLAColor implements BaseColor {\n\n\treadonly h: number;\n\treadonly s: number;\n\treadonly l: number;\n\treadonly a: number;\n\n\tconstructor(h: number, s: number, l: number, a?: number) {\n\t\tthis.h = h || 0;\n\t\tthis.s = s || 0;\n\t\tthis.l = l || 0;\n\t\tthis.a = a || 0;\n\t}\n\n\teq(other?: BaseColor | null, ignoreAlpha = false): boolean {\n\t\tif ( other instanceof HSLAColor )\n\t\t\treturn this.h === other.h && this.s === other.s && this.l === other.l && (ignoreAlpha || this.a === other.a);\n\t\treturn other ? this.eq(other.toHSLA(), ignoreAlpha) : false;\n\t}\n\n\t// ========================================================================\n\t// Updates\n\t// ========================================================================\n\n\t_h(h: number) { return new HSLAColor(h, this.s, this.l, this.a); }\n\t_s(s: number) { return new HSLAColor(this.h, s, this.l, this.a); }\n\t_l(l: number) { return new HSLAColor(this.h, this.s, l, this.a); }\n\t_a(a: number) { return new HSLAColor(this.h, this.s, this.l, a); }\n\n\t// ========================================================================\n\t// Conversion: to HSLA\n\t// ========================================================================\n\n\tstatic fromRGBA(r: number, g: number, b: number, a?: number) {\n\t\tr /= 255; g /= 255; b /= 255;\n\n\t\tconst max = Math.max(r,g,b),\n\t\t\tmin = Math.min(r,g,b),\n\n\t\t\tl = Math.min(Math.max(0, (max+min) / 2), 1),\n\t\t\td = Math.min(Math.max(0, max - min), 1);\n\n\t\tlet h, s;\n\n\t\tif ( d === 0 )\n\t\t\th = s = 0;\n\t\telse {\n\t\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\t\tswitch(max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: //case b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t}\n\t\t\th /= 6;\n\t\t}\n\n\t\treturn new HSLAColor(h, s, l, a === undefined ? 1 : a);\n\t}\n\n\n\t// ========================================================================\n\t// Conversion: from HSLA\n\t// ========================================================================\n\n\ttoCSS() {\n\t\tconst a = this.a;\n\t\treturn `hsl${a !== 1 ? 'a' : ''}(${Math.round(this.h*360)},${Math.round(this.s*100)}%,${Math.round(this.l*100)}%${a !== 1 ? `,${this.a}` : ''})`;\n\t}\n\n\ttoHex() { return this.toRGBA().toHex(); }\n\n\ttoRGBA() { return RGBAColor.fromHSLA(this.h, this.s, this.l, this.a); }\n\ttoHSLA() { return this; }\n\ttoHSVA() { return this.toRGBA().toHSVA(); }\n\ttoXYZA() { return this.toRGBA().toXYZA(); }\n\ttoLUVA() { return this.toRGBA().toLUVA(); }\n\n\t// ========================================================================\n\t// Processing\n\t// ========================================================================\n\n\ttargetLuminance(target: number) {\n\t\tlet s = this.s,\n\t\t\tmin = 0,\n\t\t\tmax = 1;\n\n\t\ts *= Math.pow(this.l > 0.5 ? -this.l : this.l - 1, 7) + 1;\n\n\t\tlet d = (max - min) / 2,\n\t\t\tmid = min + d;\n\n\t\tfor (; d > 1/65536; d /= 2, mid = min + d) {\n\t\t\tconst luminance = RGBAColor.fromHSLA(this.h, s, mid, 1).luminance();\n\t\t\tif (luminance > target) {\n\t\t\t\tmax = mid;\n\t\t\t} else {\n\t\t\t\tmin = mid;\n\t\t\t}\n\t\t}\n\n\t\treturn new HSLAColor(this.h, s, mid, this.a);\n\t}\n\n\n}\n\n\nclass XYZAColor implements BaseColor {\n\n\treadonly x: number;\n\treadonly y: number;\n\treadonly z: number;\n\treadonly a: number;\n\n\tconstructor(x: number, y: number, z: number, a?: number) {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t\tthis.z = z || 0;\n\t\tthis.a = a || 0;\n\t}\n\n\teq(other?: BaseColor, ignoreAlpha = false): boolean {\n\t\tif ( other instanceof XYZAColor )\n\t\t\treturn this.x === other.x && this.y === other.y && this.z === other.z && (ignoreAlpha || this.a === other.a);\n\t\treturn other ? this.eq(other.toXYZA(), ignoreAlpha) : false;\n\t}\n\n\t// ========================================================================\n\t// Updates\n\t// ========================================================================\n\n\t_x(x: number) { return new XYZAColor(x, this.y, this.z, this.a); }\n\t_y(y: number) { return new XYZAColor(this.x, y, this.z, this.a); }\n\t_z(z: number) { return new XYZAColor(this.x, this.y, z, this.a); }\n\t_a(a: number) { return new XYZAColor(this.x, this.y, this.z, a); }\n\n\t// ========================================================================\n\t// Conversion: to XYZA\n\t// ========================================================================\n\n\tstatic EPSILON = Math.pow(6 / 29, 3);\n\tstatic KAPPA = Math.pow(29 / 3, 3);\n\tstatic WHITE = null as any; // Gotta do this late to avoid an error.\n\n\tstatic fromRGBA(r: number, g: number, b: number, a?: number) {\n\t\tconst R = bit2linear(r / 255),\n\t\t\tG = bit2linear(g / 255),\n\t\t\tB = bit2linear(b / 255);\n\n\t\treturn new XYZAColor(\n\t\t\t0.412453 * R + 0.357580 * G + 0.180423 * B,\n\t\t\t0.212671 * R + 0.715160 * G + 0.072169 * B,\n\t\t\t0.019334 * R + 0.119193 * G + 0.950227 * B,\n\t\t\ta === undefined ? 1 : a\n\t\t);\n\t}\n\n\tstatic fromLUVA(l: number, u: number, v: number, alpha?: number) {\n\t\tconst deltaGammaFactor = 1 / (XYZAColor.WHITE.x + 15 * XYZAColor.WHITE.y + 3 * XYZAColor.WHITE.z),\n\t\t\tuDeltaGamma = 4 * XYZAColor.WHITE.x * deltaGammaFactor,\n\t\t\tvDeltagamma = 9 * XYZAColor.WHITE.y * deltaGammaFactor;\n\n\t\t// XYZAColor.EPSILON * XYZAColor.KAPPA = 8\n\t\tconst Y = (l > 8) ? Math.pow((l + 16) / 116, 3) : l / XYZAColor.KAPPA,\n\t\t\ta = 1/3 * (((52 * l) / (u + 13 * l * uDeltaGamma)) - 1),\n\t\t\tb = -5 * Y,\n\t\t\tc = -1/3,\n\t\t\td = Y * (((39 * l) / (v + 13 * l * vDeltagamma)) - 5),\n\n\t\t\tX = (d - b) / (a - c),\n\t\t\tZ = X * a + b;\n\n\t\treturn new XYZAColor(X, Y, Z, alpha === undefined ? 1 : alpha);\n\t}\n\n\t// ========================================================================\n\t// Conversion: from XYZA\n\t// ========================================================================\n\n\ttoCSS() { return this.toRGBA().toCSS(); }\n\ttoHex() { return this.toRGBA().toHex(); }\n\n\ttoRGBA() { return RGBAColor.fromXYZA(this.x, this.y, this.z, this.a); }\n\ttoHSLA() { return this.toRGBA().toHSLA(); }\n\ttoHSVA() { return this.toRGBA().toHSVA(); }\n\ttoXYZA() { return this; }\n\ttoLUVA() { return LUVAColor.fromXYZA(this.x, this.y, this.z, this.a); }\n}\n\n// Assign this now that XYZAColor exists.\nXYZAColor.WHITE = new RGBAColor(255,255,255,1).toXYZA();\n\n\nclass LUVAColor implements BaseColor {\n\n\treadonly l: number;\n\treadonly u: number;\n\treadonly v: number;\n\treadonly a: number;\n\n\tconstructor(l: number, u: number, v: number, a?: number) {\n\t\tthis.l = l || 0;\n\t\tthis.u = u || 0;\n\t\tthis.v = v || 0;\n\t\tthis.a = a || 0;\n\t}\n\n\teq(other?: BaseColor | null, ignoreAlpha = false): boolean {\n\t\tif ( other instanceof LUVAColor )\n\t\t\treturn this.l === other.l && this.u === other.u && this.v === other.v && (ignoreAlpha || this.a === other.a);\n\t\treturn other ? this.eq(other.toLUVA(), ignoreAlpha) : false;\n\t}\n\n\t// ========================================================================\n\t// Updates\n\t// ========================================================================\n\n\t_l(l: number) { return new LUVAColor(l, this.u, this.v, this.a); }\n\t_u(u: number) { return new LUVAColor(this.l, u, this.v, this.a); }\n\t_v(v: number) { return new LUVAColor(this.l, this.u, v, this.a); }\n\t_a(a: number) { return new LUVAColor(this.l, this.u, this.v, a); }\n\n\t// ========================================================================\n\t// Conversion: to LUVA\n\t// ========================================================================\n\n\tstatic fromXYZA(X: number, Y: number, Z: number, a?: number) {\n\t\tconst deltaGammaFactor = 1 / (XYZAColor.WHITE.x + 15 * XYZAColor.WHITE.y + 3 * XYZAColor.WHITE.z),\n\t\t\tuDeltaGamma = 4 * XYZAColor.WHITE.x * deltaGammaFactor,\n\t\t\tvDeltagamma = 9 * XYZAColor.WHITE.y * deltaGammaFactor,\n\n\t\t\tyGamma = Y / XYZAColor.WHITE.y;\n\n\t\tlet deltaDivider = (X + 15 * Y + 3 * Z);\n\t\tif (deltaDivider === 0) {\n\t\t\tdeltaDivider = 1;\n\t\t}\n\n\t\tconst deltaFactor = 1 / deltaDivider,\n\n\t\t\tuDelta = 4 * X * deltaFactor,\n\t\t\tvDelta = 9 * Y * deltaFactor,\n\n\t\t\tL = (yGamma > XYZAColor.EPSILON) ? 116 * Math.pow(yGamma, 1/3) - 16 : XYZAColor.KAPPA * yGamma,\n\t\t\tu = 13 * L * (uDelta - uDeltaGamma),\n\t\t\tv = 13 * L * (vDelta - vDeltagamma);\n\n\t\treturn new LUVAColor(L, u, v, a === undefined ? 1 : a);\n\t}\n\n\t// ========================================================================\n\t// Conversion: from LUVA\n\t// ========================================================================\n\n\ttoCSS() { return this.toRGBA().toCSS(); }\n\ttoHex() { return this.toRGBA().toHex(); }\n\n\ttoRGBA() { return this.toXYZA().toRGBA(); }\n\ttoHSLA() { return this.toRGBA().toHSLA(); }\n\ttoHSVA() { return this.toRGBA().toHSVA(); }\n\ttoXYZA() { return XYZAColor.fromLUVA(this.l, this.u, this.v, this.a); }\n\ttoLUVA() { return this;}\n\n}\n\n\n\n\ntype ColorType = {\n\t_canvas?: HTMLCanvasElement;\n\t_context?: CanvasRenderingContext2D;\n\n\tgetCanvas(): HTMLCanvasElement;\n\tgetContext(): CanvasRenderingContext2D\n\n\tCVDMatrix: Record<string, CVDMatrix>;\n\n\tRGBA: typeof RGBAColor;\n\tHSVA: typeof HSVAColor;\n\tHSLA: typeof HSLAColor;\n\tXYZA: typeof XYZAColor;\n\tLUVA: typeof LUVAColor;\n\n\tfromCSS(input: string): RGBAColor | null;\n}\n\n\nexport const Color: ColorType = {\n\tCVDMatrix: {\n\t\tprotanope: [ // reds are greatly reduced (1% men)\n\t\t\t0.0, 2.02344, -2.52581,\n\t\t\t0.0, 1.0,      0.0,\n\t\t\t0.0, 0.0,      1.0\n\t\t],\n\t\tdeuteranope: [ // greens are greatly reduced (1% men)\n\t\t\t1.0,      0.0, 0.0,\n\t\t\t0.494207, 0.0, 1.24827,\n\t\t\t0.0,      0.0, 1.0\n\t\t],\n\t\ttritanope: [ // blues are greatly reduced (0.003% population)\n\t\t\t1.0,       0.0,      0.0,\n\t\t\t0.0,       1.0,      0.0,\n\t\t\t-0.395913, 0.801109, 0.0\n\t\t]\n\t},\n\n\tgetCanvas() {\n\t\tif ( ! Color._canvas )\n\t\t\tColor._canvas = document.createElement('canvas');\n\t\treturn Color._canvas;\n\t},\n\tgetContext: () => {\n\t\tif ( ! Color._context )\n\t\t\tColor._context = Color.getCanvas().getContext('2d') as CanvasRenderingContext2D;\n\t\treturn Color._context;\n\t},\n\n\tRGBA: RGBAColor,\n\tHSVA: HSVAColor,\n\tHSLA: HSLAColor,\n\tXYZA: XYZAColor,\n\tLUVA: LUVAColor,\n\n\tfromCSS(input: string) {\n\t\treturn RGBAColor.fromCSS(input);\n\t},\n};\n\n\nexport class ColorAdjuster {\n\n\tprivate _base: string;\n\tprivate _contrast: number;\n\tprivate _mode: number;\n\n\tprivate _dark: boolean = false;\n\tprivate _cache: Map<string, string> = new Map;\n\n\tprivate _luv: number = 0;\n\tprivate _luma: number = 0;\n\n\tconstructor(base = '#232323', mode = 0, contrast = 4.5) {\n\t\tthis._contrast = contrast;\n\t\tthis._base = base;\n\t\tthis._mode = mode;\n\n\t\tthis.rebuildContrast();\n\t}\n\n\tget contrast() { return this._contrast }\n\tset contrast(val) { this._contrast = val; this.rebuildContrast() }\n\n\tget base() { return this._base }\n\tset base(val) { this._base = val; this.rebuildContrast() }\n\n\tget dark() { return this._dark }\n\n\tget mode() { return this._mode }\n\tset mode(val) { this._mode = val; this.rebuildContrast() }\n\n\n\trebuildContrast() {\n\t\tthis._cache = new Map;\n\n\t\tconst base = RGBAColor.fromCSS(this._base);\n\t\tif ( ! base )\n\t\t\tthrow new Error('Invalid base color');\n\n\t\tconst lum = base.luminance(),\n\t\t\tdark = this._dark = lum < 0.5;\n\n\t\tif ( dark ) {\n\t\t\tthis._luv = new XYZAColor(\n\t\t\t\t0,\n\t\t\t\t(this._contrast * (base.toXYZA().y + 0.05) - 0.05),\n\t\t\t\t0,\n\t\t\t\t1\n\t\t\t).toLUVA().l;\n\n\t\t\tthis._luma = this._contrast * (base.luminance() + 0.05) - 0.05;\n\n\t\t} else {\n\t\t\tthis._luv = new XYZAColor(\n\t\t\t\t0,\n\t\t\t\t(base.toXYZA().y + 0.05) / this._contrast - 0.05,\n\t\t\t\t0,\n\t\t\t\t1\n\t\t\t).toLUVA().l;\n\n\t\t\tthis._luma = (base.luminance() + 0.05) / this._contrast - 0.05;\n\t\t}\n\t}\n\n\tprocess(color: BaseColor | string, throw_errors = false) {\n\t\tif ( ! color )\n\t\t\treturn null;\n\n\t\tif ( this._mode === -1 )\n\t\t\treturn '';\n\n\t\tif ( typeof color !== 'string' )\n\t\t\tcolor = color.toCSS();\n\n\t\tif ( this._mode === 0 )\n\t\t\treturn color;\n\n\t\tif ( this._cache.has(color) )\n\t\t\treturn this._cache.get(color);\n\n\t\tlet rgb: RGBAColor;\n\n\t\ttry {\n\t\t\trgb = RGBAColor.fromCSS(color);\n\t\t} catch(err) {\n\t\t\tif ( throw_errors )\n\t\t\t\tthrow err;\n\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( ! rgb )\n\t\t\treturn null;\n\n\t\tif ( this._mode === 1 ) {\n\t\t\t// HSL Luma\n\t\t\tconst luma = rgb.luminance();\n\n\t\t\tif ( this._dark ? luma < this._luma : luma > this._luma )\n\t\t\t\trgb = rgb.toHSLA().targetLuminance(this._luma).toRGBA();\n\n\t\t} else if ( this._mode === 2 ) {\n\t\t\t// LUV\n\t\t\tconst luv = rgb.toLUVA();\n\t\t\tif ( this._dark ? luv.l < this._luv : luv.l > this._luv )\n\t\t\t\trgb = luv._l(this._luv).toRGBA();\n\n\t\t} else if ( this._mode === 3 ) {\n\t\t\t// HSL Loop (aka BTTV Style)\n\t\t\tif ( this._dark )\n\t\t\t\twhile ( rgb.get_Y() < 0.5 ) {\n\t\t\t\t\tconst hsl = rgb.toHSLA();\n\t\t\t\t\trgb = hsl._l(Math.min(Math.max(0, 0.1 + 0.9 * hsl.l), 1)).toRGBA();\n\t\t\t\t}\n\n\t\t\telse\n\t\t\t\twhile ( rgb.get_Y() >= 0.5 ) {\n\t\t\t\t\tconst hsl = rgb.toHSLA();\n\t\t\t\t\trgb = hsl._l(Math.min(Math.max(0, 0.9 * hsl.l), 1)).toRGBA();\n\t\t\t\t}\n\n\t\t} else if ( this._mode === 4 ) {\n\t\t\t// RGB Loop\n\t\t\tlet i = 0;\n\t\t\tif ( this._dark )\n\t\t\t\twhile ( rgb.luminance() < 0.15 && i++ < 127 )\n\t\t\t\t\trgb = rgb.brighten();\n\n\t\t\telse\n\t\t\t\twhile ( rgb.luminance() > 0.3 && i++ < 127 )\n\t\t\t\t\trgb = rgb.brighten(-1);\n\t\t}\n\n\t\tconst out = rgb.toCSS();\n\t\tthis._cache.set(color, out);\n\t\treturn out;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Fine Router\n// ============================================================================\n\nimport {parse, tokensToRegExp, tokensToFunction} from 'path-to-regexp';\nimport Module, { GenericModule } from 'utilities/module';\nimport {has, deep_equals, sleep} from 'utilities/object';\nimport type Fine from './fine';\nimport type { OptionalPromise } from 'utilities/types';\nimport { ReactNode, ReactStateNode } from './react-types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\t'site.router': FineRouterEvents;\n\t}\n\tinterface ModuleMap {\n\t\t'site.router': FineRouter;\n\t}\n}\n\n\ntype FineRouterEvents = {\n\t':updated-route-names': [];\n\t':updated-routes': [];\n\n\t':route': [route: RouteInfo | null, match: unknown];\n};\n\nexport type RouteInfo = {\n\tname: string;\n\tdomain: string | null;\n\n};\n\n\ntype ReactLocation = Location & {\n\tstate: unknown;\n}\n\n\ntype HistoryObject = {\n\tlisten(fn: (location: ReactLocation) => void): void;\n\tpush(url: string, state: unknown): void;\n\treplace(url: string, state: unknown): void;\n\tlocation: ReactLocation;\n};\n\ntype RouterState = {\n\thistoryAction: string;\n\tlocation: ReactLocation;\n};\n\ntype RouterObject = {\n\tsubscribe(fn: (state: RouterState) => void): void;\n\trouter: {\n\t\tstate: RouterState\n\t}\n};\n\ntype NavigationObject = {\n\tpush(url: string, state: unknown): void;\n\treplace(url: string, state: unknown): void;\n}\n\n\nexport default class FineRouter extends Module<'site.router', FineRouterEvents> {\n\n\t// Dependencies\n\tfine: Fine = null as any;\n\n\t// Storage\n\troutes: Record<string, RouteInfo>;\n\troute_names: Record<string, string>;\n\tprivate __routes: RouteInfo[];\n\n\t// State\n\tcurrent: RouteInfo | null;\n\tcurrent_name: string | null;\n\tcurrent_state: unknown | null;\n\tmatch: unknown | null;\n\tlocation: unknown | null;\n\n\t// Things\n\thistory?: HistoryObject | null;\n\trouter?: RouterObject | null;\n\tnavigator?: NavigationObject | null;\n\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\t\tthis.inject('..fine');\n\n\t\tthis.__routes = [];\n\n\t\tthis.routes = {};\n\t\tthis.route_names = {};\n\t\tthis.current = null;\n\t\tthis.current_name = null;\n\t\tthis.current_state = null;\n\t\tthis.match = null;\n\t\tthis.location = null;\n\t}\n\n\t/** @internal */\n\tonEnable(tries = 0): OptionalPromise<void> {\n\t\tconst thing = this.fine.searchTree<ReactStateNode<{history: HistoryObject}>>(null, n => n?.props?.history);\n\t\tthis.history = thing?.props?.history;\n\n\t\tif ( this.history ) {\n\t\t\tthis.history.listen(location => {\n\t\t\t\tif ( this.enabled )\n\t\t\t\t\tthis._navigateTo(location);\n\t\t\t});\n\n\t\t\tthis._navigateTo(this.history.location);\n\t\t\treturn;\n\t\t}\n\n\n\t\tconst other = this.fine.searchNode(null, n => n?.pendingProps?.router?.subscribe);\n\t\tthis.router = other?.pendingProps?.router;\n\n\t\tconst nav = this.fine.searchNode(null, n => n?.pendingProps?.navigator?.push);\n\t\tthis.navigator = nav?.pendingProps?.navigator;\n\n\t\tif ( ! this.router || ! this.navigator ) {\n\t\t\tif (tries > 100) {\n\t\t\t\tthis.log.warn('Finding React\\'s router is taking a long time.');\n\t\t\t\ttries = -500;\n\t\t\t}\n\n\t\t\treturn sleep(50).then(() => this.onEnable(tries + 1));\n\t\t}\n\n\t\tthis.router.subscribe(evt => {\n\t\t\tif ( this.enabled && evt?.location )\n\t\t\t\tthis._navigateTo(evt.location);\n\t\t});\n\n\t\tthis._navigateTo(this.router.router.state.location);\n\t}\n\n\tnavigate(route, data, opts, state) {\n\t\tconst url = this.getURL(route, data, opts);\n\t\tthis.push(url, state);\n\t}\n\n\tget reactLocation() {\n\t\tif (this.history)\n\t\t\treturn this.history.location;\n\t\telse if (this.router)\n\t\t\treturn this.router.router.state.location;\n\t}\n\n\tpush(url: string, state: unknown) {\n\t\tif (this.history)\n\t\t\tthis.history.push(url, state);\n\t\telse if (this.navigator)\n\t\t\tthis.navigator.push(url, state);\n\t\telse\n\t\t\tthrow new Error('unable to push new route');\n\t}\n\n\treplace(url: string, state: unknown) {\n\t\tif (this.history)\n\t\t\tthis.history.replace(url, state);\n\t\telse if (this.navigator)\n\t\t\tthis.navigator.replace(url, state);\n\t\telse\n\t\t\tthrow new Error('unable to replace route');\n\t}\n\n\tprivate _navigateTo(location: ReactLocation) {\n\t\tthis.log.debug('New Location', location);\n\t\tconst host = window.location.host,\n\t\t\tpath = location.pathname,\n\t\t\tsearch = location.search,\n\t\t\tstate = location.state;\n\n\t\tif ( path === this.location && host === this.domain && search === this.search && deep_equals(state, this.current_state) )\n\t\t\treturn;\n\n\t\tthis.old_location = this.location;\n\t\tthis.old_search = this.search;\n\t\tthis.old_domain = this.domain;\n\t\tthis.old_state = this.current_state;\n\n\t\tthis.location = path;\n\t\tthis.search = search;\n\t\tthis.domain = host;\n\t\tthis.current_state = state;\n\n\t\tthis._pickRoute();\n\t}\n\n\tprivate _pickRoute() {\n\t\tconst path = this.location,\n\t\t\thost = this.domain;\n\n\t\tthis.old_route = this.current;\n\t\tthis.old_name = this.current_name;\n\t\tthis.old_match = this.match;\n\n\t\tfor(const route of this.__routes) {\n\t\t\tif ( route.domain && route.domain !== host )\n\t\t\t\tcontinue;\n\n\t\t\tconst match = route.regex.exec(path);\n\t\t\tif ( match && (! route.state_fn || route.state_fn(this.current_state)) ) {\n\t\t\t\tthis.log.debug('Matching Route', route, match);\n\t\t\t\tthis.current = route;\n\t\t\t\tthis.current_name = route.name;\n\t\t\t\tthis.match = match;\n\t\t\t\tthis.emit(':route', route, match);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.current = this.current_name = this.match = null;\n\t\tthis.emit(':route', null, null);\n\t}\n\n\tgetURL(route, data, opts, ...args) {\n\t\tconst r = this.routes[route];\n\t\tif ( ! r )\n\t\t\tthrow new Error(`unable to find route \"${route}\"`);\n\n\t\tif ( typeof data !== 'object' ) {\n\t\t\tconst parts = [data, opts, ...args];\n\t\t\tdata = {};\n\n\t\t\tlet i = 0;\n\t\t\tfor(const part of r.parts) {\n\t\t\t\tif ( part && part.name ) {\n\t\t\t\t\tdata[part.name] = parts[i];\n\t\t\t\t\ti++;\n\t\t\t\t\tif ( i >= parts.length )\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn r.url(data, opts);\n\t}\n\n\tgetRoute(name: string) {\n\t\treturn this.routes[name];\n\t}\n\n\tgetRoutes() {\n\t\treturn this.routes;\n\t}\n\n\tgetRouteNames() {\n\t\tfor(const route of Object.keys(this.getRoutes()))\n\t\t\tthis.getRouteName(route);\n\n\t\treturn this.route_names;\n\t}\n\n\tgetRouteName(route: string) {\n\t\tif ( ! this.route_names[route] )\n\t\t\tthis.route_names[route] = route\n\t\t\t\t.replace(/^dash-([a-z])/, (_, letter) =>\n\t\t\t\t\t`Dashboard: ${letter.toLocaleUpperCase()}`)\n\t\t\t\t.replace(/(^|-)([a-z])/g, (_, spacer, letter) =>\n\t\t\t\t\t`${spacer ? ' ' : ''}${letter.toLocaleUpperCase()}`);\n\n\t\treturn this.route_names[route];\n\t}\n\n\trouteName(route: string | Record<string, string>, name?: string, process: boolean = true) {\n\t\tif ( typeof route === 'object' ) {\n\t\t\tfor(const key in route)\n\t\t\t\tif ( has(route, key) )\n\t\t\t\t\tthis.routeName(key, route[key], false);\n\n\t\t\tif ( process )\n\t\t\t\tthis.emit(':updated-route-names');\n\t\t\treturn;\n\t\t}\n\n\t\tif ( name ) {\n\t\t\tthis.route_names[route] = name;\n\n\t\t\tif ( process )\n\t\t\t\tthis.emit(':updated-route-names');\n\t\t}\n\t}\n\n\troute(name, path, domain = null, state_fn = null, process = true) {\n\t\tif ( typeof name === 'object' ) {\n\t\t\tdomain = path;\n\t\t\tfor(const key in name)\n\t\t\t\tif ( has(name, key) )\n\t\t\t\t\tthis.route(key, name[key], domain, state_fn, false);\n\n\t\t\tif ( process ) {\n\t\t\t\tthis.__routes.sort((a,b) => b.score - a.score);\n\t\t\t\tif ( this.location )\n\t\t\t\t\tthis._pickRoute();\n\t\t\t\tthis.emit(':updated-routes');\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst parts = parse(path),\n\t\t\tscore = parts.reduce((total, val) => total + (\n\t\t\t\ttypeof val === 'string' ?\n\t\t\t\t\tval.split('/').length - 1 :\n\t\t\t\t\t0\n\t\t\t), 0),\n\t\t\troute = this.routes[name] = {\n\t\t\t\tname,\n\t\t\t\tparts,\n\t\t\t\tscore,\n\t\t\t\tdomain,\n\t\t\t\tstate_fn,\n\t\t\t\tregex: tokensToRegExp(parts),\n\t\t\t\turl: tokensToFunction(parts)\n\t\t\t}\n\n\t\tthis.__routes.push(route);\n\t\tif ( process ) {\n\t\t\tthis.__routes.sort((a,b) => b.score - a.score);\n\t\t\tif ( this.location )\n\t\t\t\tthis._pickRoute();\n\t\t\tthis.emit(':updated-routes');\n\t\t}\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Fine Lib\n// It controls React.\n// ============================================================================\n\nimport {EventEmitter, EventListener, NamespacedEventArgs, NamespacedEventKey} from 'utilities/events';\nimport Module, { GenericModule } from 'utilities/module';\nimport type { ReactAccessor, ReactNode, ReactRoot, ReactStateNode } from './react-types';\nimport type { ClassType, ExtractFunctions, MaybeParameters, OptionalArray, RecursivePartial } from 'utilities/types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\t'site.fine': FineEvents;\n\t}\n\tinterface ModuleMap {\n\t\t'site.fine': Fine;\n\t}\n}\n\nexport type FineEvents = {\n\t'site:dom-update': [name: string, instance: ReactStateNode];\n};\n\nexport type NodeCriteria = (node: ReactNode) => boolean;\nexport type FineCriteria<TNode extends ReactStateNode = ReactStateNode> =\n\t(stateNode: RecursivePartial<TNode> | Node, node: ReactNode) => boolean;\n\ntype InputNode = Node | ReactNode | ReactStateNode | null;\n\nexport default class Fine extends Module<'site.fine', FineEvents> {\n\n\tselector?: string;\n\troot_element?: HTMLElement | null;\n\n\taccessor?: ReactAccessor | null;\n\treact_root?: ReactRoot | null;\n\treact?: ReactNode | null;\n\n\tprivate _route: string | null = null;\n\tprivate _wrappers: Map<string, FineWrapper<any>>;\n\tprivate _known_classes: Map<unknown, FineWrapper<any>>;\n\tprivate _observer: MutationObserver | null;\n\tprivate _waiting: FineWrapper<any>[];\n\n\tprivate _live_waiting: FineWrapper<any>[] | null;\n\tprivate _waiting_crit?: FineCriteria<any>[] | null;\n\tprivate _waiting_timer?: ReturnType<typeof setInterval> | null;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis._wrappers = new Map;\n\t\tthis._known_classes = new Map;\n\t\tthis._observer = null;\n\t\tthis._waiting = [];\n\t\tthis._live_waiting = null;\n\t}\n\n\t/** @internal */\n\tasync onEnable(tries=0): Promise<void> {\n\t\t// TODO: Move awaitElement to utilities/dom\n\t\tif ( ! this.root_element )\n\t\t\tthis.root_element = await (this.parent as any).awaitElement(this.selector || 'body #root');\n\n\t\tlet root = this.root_element?._reactRootContainer;\n\t\tif ( root?._internalRoot?.current )\n\t\t\troot = root?._internalRoot;\n\n\t\tif ( root?.current ) {\n\t\t\tthis.react_root = root;\n\t\t\tthis.react = root?.current?.child;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.root_element && ! root ) {\n\t\t\tlet key = Fine.findAccessor(this.root_element, '__reactContainer');\n\t\t\tif ( key ) {\n\t\t\t\tthis.react_root = null;\n\t\t\t\tthis.react = this.root_element[key];\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t//if ( ! this.root_element || ! this.root_element._reactRootContainer ) {\n\t\t\tif ( tries > 500 )\n\t\t\t\tthrow new Error('Unable to find React after 25 seconds');\n\n\t\t\tthis.root_element = null;\n\t\t\treturn new Promise<void>(r =>\n\t\t\t\tsetTimeout(r, 50)).then(() => this.onEnable(tries+1));\n\t\t//}\n\n\t\t/*this.react_root = this.root_element._reactRootContainer;\n\t\tif ( this.react_root._internalRoot && this.react_root._internalRoot.current )\n\t\t\tthis.react_root = this.react_root._internalRoot;\n\n\t\tthis.react = this.react_root.current?.child;*/\n\t}\n\n\t/** @internal */\n\tonDisable() {\n\t\tthis.react_root = this.root_element = this.react = this.accessor = null;\n\t}\n\n\n\tstatic findAccessor(node: Node, prefix?: string): ReactAccessor | null {\n\t\tfor(const key in node)\n\t\t\tif ( prefix ? key.startsWith(`${prefix}$`) : (key.startsWith('__reactInternalInstance$') || key.startsWith('__reactFiber$')) )\n\t\t\t\treturn key as ReactAccessor;\n\t\treturn null;\n\t}\n\n\n\t// ========================================================================\n\t// Low Level Accessors\n\t// ========================================================================\n\n\tresolveNode(input: InputNode) {\n\t\tif ( ! input && this.react )\n\t\t\treturn this.react;\n\t\telse if ( input instanceof Node )\n\t\t\treturn this.getReactInstance(input);\n\t\telse if ( (input as ReactStateNode)?._reactInternals )\n\t\t\treturn (input as ReactStateNode)._reactInternals;\n\t\telse if ( (input as ReactStateNode)?._reactInternalFiber )\n\t\t\treturn (input as ReactStateNode)._reactInternalFiber;\n\t\telse if ( input )\n\t\t\treturn input as ReactNode;\n\t\treturn null;\n\t}\n\n\tgetReactInstance(node: Node) {\n\t\tif ( ! this.accessor )\n\t\t\tthis.accessor = Fine.findAccessor(node);\n\t\tif ( ! this.accessor )\n\t\t\treturn null;\n\n\t\treturn node[this.accessor] ??\n\t\t\tnode._reactRootContainer?._internalRoot?.current ??\n\t\t\tnode._reactRootContainer?.current ?? null;\n\t}\n\n\tgetOwner(input: InputNode) {\n\t\tinput = this.resolveNode(input);\n\t\treturn input?.return ?? null;\n\t}\n\n\tgetParentNode<TNode extends Node = Node>(\n\t\tinput: InputNode,\n\t\tmax_depth = 100,\n\t\ttraverse_roots = false\n\t) {\n\t\treturn this.searchParent<TNode>(\n\t\t\tinput,\n\t\t\tn => n instanceof Node,\n\t\t\tmax_depth,\n\t\t\t0,\n\t\t\ttraverse_roots\n\t\t);\n\t}\n\n\tgetChildNode<TNode extends Node = Node>(\n\t\tinput: InputNode,\n\t\tmax_depth = 100,\n\t\ttraverse_roots = false\n\t) {\n\t\treturn this.searchTree<TNode>(\n\t\t\tinput,\n\t\t\tn => n instanceof Node,\n\t\t\tmax_depth,\n\t\t\t0,\n\t\t\ttraverse_roots\n\t\t);\n\t}\n\n\tgetHostNode<TNode extends Node = Node>(\n\t\tinput: InputNode,\n\t\tmax_depth = 100\n\t) {\n\t\treturn this.getChildNode<TNode>(input, max_depth);\n\t}\n\n\t// TODO: Why does this exist??\n\t/** @deprecated why does this exist? */\n\tgetParent(input: InputNode) {\n\t\treturn this.getOwner(input);\n\t}\n\n\tgetFirstChild(input: InputNode) {\n\t\tconst node = this.resolveNode(input);\n\t\treturn node?.child ?? null;\n\t}\n\n\tgetChildren(input: InputNode) {\n\t\tconst node = this.resolveNode(input);\n\t\tif ( ! node )\n\t\t\treturn [];\n\n\t\tconst children = [];\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tchildren.push(child);\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tsearchParent<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: string | FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\ttraverse_roots = true\n\t): TNode | null {\n\t\tif ( depth > max_depth )\n\t\t\treturn null;\n\n\t\tconst node = this.resolveNode(input);\n\n\t\t// If we don't have a node, then stop.\n\t\tif ( ! node )\n\t\t\treturn null;\n\n\t\tif ( typeof criteria === 'string' ) {\n\t\t\tconst wrapper = this._wrappers.get(criteria);\n\t\t\tif ( ! wrapper )\n\t\t\t\tthrow new Error('invalid critera');\n\n\t\t\tif ( ! wrapper.class )\n\t\t\t\treturn null;\n\n\t\t\tcriteria = n => n && n.constructor === wrapper.class;\n\t\t}\n\n\t\tconst inst = node.stateNode;\n\t\tif ( inst && criteria(inst as any, node) )\n\t\t\treturn inst as TNode;\n\n\t\t/*// If the node has opted out of scanning, then don't\n\t\t// Various conditions that could cause a stop.\n\t\tif ( ! node ||\n\t\t\t// Theoretically possible I guess?\n\t\t\t(node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn null;*/\n\n\t\tif ( node.return ) {\n\t\t\tconst result = this.searchParent<TNode>(node.return, criteria, max_depth, depth+1, traverse_roots);\n\t\t\tif ( result )\n\t\t\t\treturn result as TNode;\n\t\t}\n\n\t\t// Stupid code for traversing up into another React root.\n\t\tif ( traverse_roots && (inst as any)?.containerInfo ) {\n\t\t\tconst parent = (inst as any).containerInfo?.parentElement as Node | undefined,\n\t\t\t\tparent_node = parent && this.getReactInstance(parent);\n\n\t\t\tif ( parent_node ) {\n\t\t\t\tconst result = this.searchParent<TNode>(parent_node, criteria, max_depth, depth+1, traverse_roots);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn result as TNode;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tsearchParentNode<TNode extends ReactNode = ReactNode>(\n\t\tinput: InputNode,\n\t\tcriteria: NodeCriteria,\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\ttraverse_roots = true\n\t): TNode | null {\n\t\tif ( depth > max_depth )\n\t\t\treturn null;\n\n\t\tconst node = this.resolveNode(input);\n\n\t\t// If we don't have a node, then stop.\n\t\tif ( ! node )\n\t\t\treturn null;\n\n\t\tif ( criteria(node) )\n\t\t\treturn node as TNode;\n\n\t\tif ( node.return ) {\n\t\t\tconst result = this.searchParentNode<TNode>(node.return, criteria, max_depth, depth+1, traverse_roots);\n\t\t\tif ( result )\n\t\t\t\treturn result as TNode;\n\t\t}\n\n\t\t// Stupid code for traversing up into another React root.\n\t\tconst inst = node.stateNode;\n\t\tif ( traverse_roots && (inst as any)?.containerInfo ) {\n\t\t\tconst parent = (inst as any).containerInfo?.parentElement as Node | undefined,\n\t\t\t\tparent_node = parent && this.getReactInstance(parent);\n\n\t\t\tif ( parent_node ) {\n\t\t\t\tconst result = this.searchParentNode<TNode>(parent_node, criteria, max_depth, depth+1, traverse_roots);\n\t\t\t\tif ( result )\n\t\t\t\t\treturn result as TNode;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tsearchNode<TNode extends ReactNode = ReactNode>(\n\t\tinput: InputNode,\n\t\tcriteria: NodeCriteria,\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\ttraverse_roots = true\n\t): TNode | null {\n\t\tif ( depth > max_depth )\n\t\t\treturn null;\n\n\t\tconst node = this.resolveNode(input);\n\n\t\t// No node? No result.\n\t\tif ( ! node )\n\t\t\treturn null;\n\n\t\tif ( criteria(node) )\n\t\t\treturn node as TNode;\n\n\t\t// If the node has disabled scanning, don't scan into its children.\n\t\tif ((node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn null;\n\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tconst result = this.searchNode<TNode>(child, criteria, max_depth, depth+1, traverse_roots);\n\t\t\tif ( result )\n\t\t\t\treturn result as TNode;\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\tconst inst = node.stateNode;\n\t\tif ( traverse_roots && (inst as any)?.props?.root ) {\n\t\t\tconst root = (inst as any).props.root._reactRootContainer as ReactRoot;\n\t\t\tif ( root ) {\n\t\t\t\tlet child = root._internalRoot?.current || root.current;\n\t\t\t\twhile(child) {\n\t\t\t\t\tconst result = this.searchNode<TNode>(child, criteria, max_depth, depth+1, traverse_roots);\n\t\t\t\t\tif ( result )\n\t\t\t\t\t\treturn result as TNode;\n\n\t\t\t\t\tchild = child.sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// TypeScript is great. You can't have optional parameters in overloads.\n\t// So here's some overloads.\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t\ttraverse_roots: boolean,\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t\ttraverse_roots: boolean,\n\t\tmulti?: false\n\t): TNode | null;\n\tsearchTree<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number,\n\t\tdepth: number,\n\t\ttraverse_roots: boolean,\n\t\tmulti: Set<TNode> | true\n\t): Set<TNode>;\n\tsearchTree<\n\t\tTNode\n\t>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth: number = 15,\n\t\tdepth: number = 0,\n\t\ttraverse_roots: boolean = true,\n\t\tmulti?: Set<TNode> | boolean\n\t): TNode | Set<TNode> | null {\n\t\tconst node = this.resolveNode(input);\n\t\tif ( multi && ! (multi instanceof Set) )\n\t\t\tmulti = new Set;\n\n\t\t// No node? Scanned too deep? Stop.\n\t\tif ( ! node || depth > max_depth )\n\t\t\treturn multi ? multi : null;\n\n\t\tif ( typeof criteria === 'string' ) {\n\t\t\tconst wrapper = this._wrappers.get(criteria);\n\t\t\tif ( ! wrapper )\n\t\t\t\tthrow new Error('invalid critera');\n\n\t\t\tif ( ! wrapper.class )\n\t\t\t\treturn multi ? multi : null;\n\n\t\t\tcriteria = n => n && n.constructor === wrapper.class;\n\t\t}\n\n\t\tconst inst = node.stateNode;\n\t\tif ( inst && criteria(inst as any, node) ) {\n\t\t\tif ( multi )\n\t\t\t\tmulti.add(inst as TNode);\n\t\t\telse\n\t\t\t\treturn inst as TNode;\n\t\t}\n\n\t\t// If the node has disabled scanning, don't scan into its children.\n\t\tif ((node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn multi ? multi : null;\n\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tconst result = this.searchTree<TNode>(child, criteria, max_depth, depth+1, traverse_roots, multi as any);\n\t\t\tif ( result && ! multi )\n\t\t\t\treturn result as TNode;\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\tif ( traverse_roots && (inst as any)?.props?.root ) {\n\t\t\tconst root = (inst as any).props.root._reactRootContainer as ReactRoot;\n\t\t\tif ( root ) {\n\t\t\t\tlet child = root._internalRoot?.current || root.current;\n\t\t\t\twhile(child) {\n\t\t\t\t\tconst result = this.searchTree<TNode>(child, criteria, max_depth, depth+1, traverse_roots, multi as any);\n\t\t\t\t\tif ( result && ! multi )\n\t\t\t\t\t\treturn result as TNode;\n\n\t\t\t\t\tchild = child.sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn multi ? multi : null;\n\t}\n\n\n\tfindAllMatching<TNode>(\n\t\tinput: InputNode,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\tmax_depth = 15,\n\t\tsingle_class = true,\n\t\tparents=false,\n\t\tdepth=0,\n\t\ttraverse_roots=true\n\t) {\n\t\tconst matches = new Set<TNode>;\n\t\tlet crit: FineCriteria = (inst, node) => ! matches.has(inst as TNode) && criteria(inst as any, node);\n\n\t\twhile(true) {\n\t\t\tconst match = parents ?\n\t\t\t\tthis.searchParent(input, crit, max_depth, depth, traverse_roots) :\n\t\t\t\tthis.searchTree(input, crit, max_depth, depth, traverse_roots);\n\n\t\t\tif ( ! match )\n\t\t\t\tbreak;\n\n\t\t\tif ( single_class && ! matches.size ) {\n\t\t\t\tconst klass = match.constructor;\n\t\t\t\tcrit = (inst, node) => ! matches.has(inst as TNode) && (inst instanceof klass) && criteria(inst as any, node);\n\t\t\t}\n\n\t\t\tmatches.add(match as TNode);\n\t\t}\n\n\t\treturn matches;\n\t}\n\n\n\tsearchAll(\n\t\tinput: InputNode,\n\t\tcriterias: FineCriteria[],\n\t\tmax_depth = 15,\n\t\tdepth = 0,\n\t\tdata: {\n\t\t\tseen: Set<any>;\n\t\t\tclasses: any[];\n\t\t\tmax_depth: number;\n\t\t\tout: {\n\t\t\t\tcls: any;\n\t\t\t\tinstances: Set<ReactStateNode | Node>;\n\t\t\t\tdepth: number | null;\n\t\t\t}[];\n\t\t} | null = null,\n\t\ttraverse_roots = true\n\t) {\n\t\tconst node = this.resolveNode(input);\n\n\t\tif ( ! data )\n\t\t\tdata = {\n\t\t\t\tseen: new Set,\n\t\t\t\tclasses: criterias.map(() => null),\n\t\t\t\tout: criterias.map(() => ({\n\t\t\t\t\tcls: null, instances: new Set, depth: null\n\t\t\t\t})),\n\t\t\t\tmax_depth: depth\n\t\t\t};\n\n\t\t// No node? Max depth? Bye.\n\t\tif ( ! node || depth > max_depth )\n\t\t\treturn data.out;\n\n\t\tif ( depth > data.max_depth )\n\t\t\tdata.max_depth = depth;\n\n\t\tconst inst = node.stateNode;\n\t\tif ( inst ) {\n\t\t\tconst cls = inst.constructor,\n\t\t\t\tidx = data.classes.indexOf(cls);\n\n\t\t\tif ( idx !== -1 )\n\t\t\t\tdata.out[idx].instances.add(inst);\n\n\t\t\telse if ( ! data.seen.has(cls) ) {\n\t\t\t\tlet i = criterias.length;\n\t\t\t\twhile(i-- > 0)\n\t\t\t\t\tif ( criterias[i](inst, node) ) {\n\t\t\t\t\t\tdata.classes[i] = data.out[i].cls = cls;\n\t\t\t\t\t\tdata.out[i].instances.add(inst);\n\t\t\t\t\t\tdata.out[i].depth = depth;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\tdata.seen.add(cls);\n\t\t\t}\n\t\t}\n\n\t\t// If the node has disabled scanning, don't scan into its children.\n\t\tif ((node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\tnode.stateNode?._ffz_no_scan\n\t\t)\n\t\t\treturn data.out;\n\n\t\tlet child = node.child;\n\t\twhile(child) {\n\t\t\tthis.searchAll(child, criterias, max_depth, depth+1, data, traverse_roots);\n\t\t\tchild = child.sibling;\n\t\t}\n\n\t\tif ( traverse_roots && (inst as any)?.props?.root ) {\n\t\t\tconst root = (inst as any).props.root._reactRootContainer as ReactRoot | null;\n\t\t\tif ( root ) {\n\t\t\t\tlet child = root._internalRoot && root._internalRoot.current || root.current;\n\t\t\t\twhile(child) {\n\t\t\t\t\tthis.searchAll(child, criterias, max_depth, depth+1, data, traverse_roots);\n\t\t\t\t\tchild = child.sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn data.out;\n\t}\n\n\n\t// ========================================================================\n\t// Class Wrapping\n\t// ========================================================================\n\n\troute(route: string) {\n\t\tthis._route = route;\n\t\tthis._updateLiveWaiting();\n\t}\n\n\n\t_updateLiveWaiting() {\n\t\tconst lw: FineWrapper[] = this._live_waiting = [],\n\t\t\tcrt: FineCriteria[] = this._waiting_crit = [],\n\t\t\troute = this._route;\n\n\t\tif ( this._waiting )\n\t\t\tfor(const waiter of this._waiting) {\n\t\t\t\t// false means never wait.\n\t\t\t\tif ( waiter.routes === false || ! waiter.criteria )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( ! route || ! waiter.routes?.length || waiter.routes.includes(route) ) {\n\t\t\t\t\tlw.push(waiter);\n\t\t\t\t\tcrt.push(waiter.criteria);\n\t\t\t\t}\n\t\t\t}\n\n\t\tif ( ! this._live_waiting.length )\n\t\t\tthis._stopWaiting();\n\t\telse if ( ! this._waiting_timer )\n\t\t\tthis._startWaiting();\n\t}\n\n\n\tdefine<TNode extends ReactStateNode = ReactStateNode>(\n\t\tkey: string,\n\t\tcriteria: FineCriteria<TNode extends ReactStateNode ? TNode : ReactStateNode>,\n\t\troutes: string[] | false | null = null\n\t) {\n\t\tif ( this._wrappers.has(key) )\n\t\t\treturn this._wrappers.get(key) as FineWrapper<TNode>;\n\n\t\tif ( ! criteria )\n\t\t\tthrow new Error('cannot find definition and no criteria provided');\n\n\t\tconst wrapper = new FineWrapper<TNode>(key, criteria as any, routes, this);\n\t\tthis._wrappers.set(key, wrapper);\n\n\t\tconst data = this.react\n\t\t\t? this.searchAll(this.react, [criteria as any], 1000)[0]\n\t\t\t: null;\n\n\t\tif ( data?.cls ) {\n\t\t\twrapper._set(data.cls, data.instances as Set<TNode>);\n\t\t\tthis._known_classes.set(data.cls, wrapper);\n\n\t\t} else if ( routes !== false ) {\n\t\t\tthis._waiting.push(wrapper);\n\t\t\tthis._updateLiveWaiting();\n\t\t}\n\n\t\treturn wrapper;\n\t}\n\n\n\twrap<TNode extends ReactStateNode = ReactStateNode>(\n\t\tkey: string,\n\t\tcls?: ClassType<TNode>\n\t) {\n\t\tlet wrapper: FineWrapper<TNode>;\n\t\tif ( this._wrappers.has(key) )\n\t\t\twrapper = this._wrappers.get(key) as FineWrapper<TNode>;\n\t\telse {\n\t\t\twrapper = new FineWrapper(key, null, null, this);\n\t\t\tthis._wrappers.set(key, wrapper);\n\t\t}\n\n\t\tif ( cls ) {\n\t\t\tif ( wrapper.class || wrapper.criteria )\n\t\t\t\tthrow new Error('tried setting a class on an already initialized FineWrapper');\n\n\t\t\twrapper._set(cls, new Set);\n\t\t\tthis._known_classes.set(cls, wrapper);\n\t\t}\n\n\t\treturn wrapper;\n\t}\n\n\n\t_checkWaiters(nodes: OptionalArray<Node | ReactNode | ReactStateNode | null> = null) {\n\t\tif ( ! this._live_waiting )\n\t\t\treturn;\n\n\t\tif ( ! Array.isArray(nodes) )\n\t\t\tnodes = [nodes];\n\n\t\tfor(let input of nodes) {\n\t\t\tif ( ! this._live_waiting.length || ! this._waiting_crit )\n\t\t\t\tbreak;\n\n\t\t\tlet node: ReactNode | null = null;\n\t\t\tif ( ! input && this.react )\n\t\t\t\tnode = this.react;\n\t\t\telse if ( input instanceof Node )\n\t\t\t\tnode = this.getReactInstance(input);\n\t\t\telse if ( (input as ReactStateNode)?._reactInternals )\n\t\t\t\tnode = (input as ReactStateNode)._reactInternals;\n\t\t\telse if ( (input as ReactStateNode)?._reactInternalFiber )\n\t\t\t\tnode = (input as ReactStateNode)._reactInternalFiber;\n\n\t\t\t// Sanity check the node.\n\t\t\tif (! node ||\n\t\t\t\t(node as unknown as ReactStateNode)._ffz_no_scan ||\n\t\t\t\tnode.stateNode?._ffz_no_scan\n\t\t\t)\n\t\t\t\tcontinue;\n\n\t\t\tconst data = this.searchAll(\n\t\t\t\tnode, this._waiting_crit, 1000\n\t\t\t);\n\n\t\t\tlet i = data.length;\n\t\t\twhile(i-- > 0) {\n\t\t\t\tif ( data[i].cls ) {\n\t\t\t\t\tconst d = data[i],\n\t\t\t\t\t\tw = this._live_waiting.splice(i, 1)[0];\n\n\t\t\t\t\tthis._waiting_crit.splice(i, 1);\n\n\t\t\t\t\tconst idx = this._waiting.indexOf(w);\n\t\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\t\tthis._waiting.splice(idx, 1);\n\n\t\t\t\t\tthis.log.debug(`Found class for \"${w.name}\" at depth ${d.depth}`);\n\t\t\t\t\tw._set(d.cls, d.instances as Set<ReactStateNode>);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( ! this._live_waiting.length )\n\t\t\tthis._stopWaiting();\n\t}\n\n\n\t_startWaiting() {\n\t\tthis.log.info('Installing MutationObserver.');\n\t\tthis._waiting_timer = setInterval(() => this._checkWaiters(), 500);\n\n\t\tif ( ! this._observer )\n\t\t\tthis._observer = new MutationObserver(mutations =>\n\t\t\t\tthis._checkWaiters(mutations.map(x => x.target))\n\t\t\t);\n\n\t\tthis._observer.observe(document.body, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true\n\t\t});\n\t}\n\n\n\t_stopWaiting() {\n\t\tthis.log.info('Stopping MutationObserver.');\n\n\t\tif ( this._observer )\n\t\t\tthis._observer.disconnect();\n\n\t\tif ( this._waiting_timer )\n\t\t\tclearInterval(this._waiting_timer);\n\n\t\tthis._live_waiting = null;\n\t\tthis._waiting_crit = null;\n\t\tthis._waiting_timer = null;\n\t}\n}\n\n\n// TODO: Extract props and stuff\nexport type ComponentMethods<TNode extends ReactStateNode = ReactStateNode> =\n\tExtractFunctions<TNode, true>;\n\nexport type ComponentMethodArgs<TNode extends ReactStateNode, K extends string> =\n\tK extends keyof ComponentMethods<TNode>\n\t\t? MaybeParameters<ComponentMethods<TNode>[K]>\n\t\t: never[];\n\n\nconst EVENTS: Record<string, keyof ComponentMethods> = {\n\t'will-mount': 'UNSAFE_componentWillMount',\n\tmount: 'componentDidMount',\n\trender: 'render',\n\t'receive-props': 'UNSAFE_componentWillReceiveProps',\n\t'should-update': 'shouldComponentUpdate',\n\t'will-update': 'UNSAFE_componentWillUpdate',\n\tupdate: 'componentDidUpdate',\n\tunmount: 'componentWillUnmount'\n}\n\n\nexport type WrapperEvents<TNode extends ReactStateNode> = {\n\tset: [klass: ClassType<TNode>, instances: Set<TNode>];\n\n\t'will-mount': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>];\n\tmount: [instance: TNode, ...args: ComponentMethodArgs<TNode, 'componentDidMount'>];\n\t'late-mount': [instance: TNode];\n\n\t'receive-props': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillReceiveProps'>];\n\t'will-update': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillUpdate'>];\n\t'should-update': [instance: TNode, ...args: ComponentMethodArgs<TNode, 'shouldComponentUpdate'>];\n\tupdate: [instance: TNode, ...args: ComponentMethodArgs<TNode, 'componentDidUpdate'>];\n\n\trender: [instance: TNode];\n\n\tunmount: [instance: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>];\n};\n\n\nexport class FineWrapper<TNode extends ReactStateNode = ReactStateNode> extends EventEmitter<WrapperEvents<TNode>> {\n\n\treadonly name: string;\n\treadonly criteria: FineCriteria<TNode> | null;\n\treadonly fine: Fine;\n\treadonly instances: Set<TNode>;\n\treadonly routes: string[] | false;\n\n\tprivate readonly _wrapped: Map<keyof TNode, [any, any]>;\n\tprivate _class: ClassType<TNode> | null;\n\n\tconstructor(name: string, criteria: FineCriteria<TNode> | null, routes: string[] | false | null, fine: Fine) {\n\t\tsuper();\n\n\t\tthis.name = name;\n\t\tthis.criteria = criteria;\n\t\tthis.fine = fine;\n\n\t\tthis.instances = new Set;\n\t\tthis.routes = routes ?? [];\n\n\t\tthis._wrapped = new Map;\n\t\tthis._class = null;\n\n\t}\n\n\tget class() { return this._class; }\n\n\tget first() {\n\t\treturn this.toArray()[0];\n\t}\n\n\tprotected __cleanListeners(): string[] {\n\t\tconst out = super.__cleanListeners();\n\n\t\tfor(const event of out) {\n\t\t\tconst key = EVENTS[event];\n\t\t\tif ( key )\n\t\t\t\ttry {\n\t\t\t\t\tthis._unwrap(key as keyof ComponentMethods<TNode>);\n\t\t\t\t} catch(err) { /* do nothing */ }\n\t\t}\n\n\t\treturn out;\n\t}\n\n\ttoArray() {\n\t\treturn Array.from(this.instances);\n\t}\n\n\tcheck(\n\t\tnode: ReactNode | ReactStateNode | Node | null = null,\n\t\tmax_depth = 1000\n\t) {\n\t\tif ( this._class || ! this.criteria )\n\t\t\treturn;\n\n\t\tconst instances = this.fine.findAllMatching<TNode>(node, this.criteria as any, max_depth);\n\t\tif ( instances.size ) {\n\t\t\tconst insts = Array.from(instances);\n\t\t\tthis._set(insts[0].constructor as any, insts);\n\t\t}\n\t}\n\n\tready(fn: (klass: ClassType<TNode>, instances: Set<TNode>) => void) {\n\t\tif ( this._class )\n\t\t\tfn(this._class, this.instances);\n\t\telse\n\t\t\tthis.once('set', fn);\n\t}\n\n\teach(fn: (inst: TNode) => void) {\n\t\tfor(const inst of this.instances)\n\t\t\tfn(inst);\n\t}\n\n\tupdateInstances(\n\t\tnode: ReactNode | ReactStateNode | Node | null = null,\n\t\tmax_depth = 1000\n\t) {\n\t\tif ( ! this._class )\n\t\t\treturn;\n\n\t\tconst instances = this.fine.findAllMatching<TNode>(\n\t\t\tnode,\n\t\t\tn => n.constructor === this._class,\n\t\t\tmax_depth\n\t\t);\n\n\t\tfor(const inst of instances) {\n\t\t\tinst._ffz_mounted = true;\n\t\t\tthis.instances.add(inst);\n\t\t}\n\t}\n\n\t_set(cls: ClassType<TNode>, instances: Iterable<TNode>) {\n\t\tif ( this._class )\n\t\t\tthrow new Error('already have a class');\n\n\t\tthis._class = cls;\n\t\t(cls as any)._ffz_wrapper = this;\n\n\t\tconst t = this,\n\t\t\t_instances = this.instances,\n\t\t\tproto = cls.prototype,\n\t\t\to_mount = proto.UNSAFE_componentWillMount as (this: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>) => any,\n\t\t\to_unmount = proto.componentWillUnmount as (this: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>) => any,\n\n\t\t\tmount = proto.UNSAFE_componentWillMount = o_mount ?\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>) {\n\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t_instances.add(this);\n\t\t\t\t\tt.emit('will-mount', this, ...args);\n\t\t\t\t\treturn o_mount.apply(this, args);\n\t\t\t\t} :\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'UNSAFE_componentWillMount'>) {\n\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t_instances.add(this);\n\t\t\t\t\tt.emit('will-mount', this, ...args);\n\t\t\t\t},\n\n\t\t\tunmount = proto.componentWillUnmount = o_unmount ?\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>) {\n\t\t\t\t\tt.emit('unmount', this, ...args);\n\t\t\t\t\t_instances.delete(this);\n\t\t\t\t\tthis._ffz_mounted = false;\n\t\t\t\t\treturn o_unmount.apply(this, args);\n\t\t\t\t} :\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, 'componentWillUnmount'>) {\n\t\t\t\t\tt.emit('unmount', this, ...args);\n\t\t\t\t\t_instances.delete(this);\n\t\t\t\t\tthis._ffz_mounted = false;\n\t\t\t\t};\n\n\t\tthis._wrapped.set('UNSAFE_componentWillMount', [mount, o_mount]);\n\t\tthis._wrapped.set('componentWillUnmount', [unmount, o_unmount]);\n\n\t\tfor(const event of this.events())\n\t\t\tthis._maybeWrap(event);\n\n\t\tif ( instances )\n\t\t\tfor(const inst of instances) {\n\t\t\t\t// How do we check mounted state for fibers?\n\t\t\t\t// Just assume they're mounted for now I guess.\n\t\t\t\tinst._ffz_mounted = true;\n\t\t\t\t_instances.add(inst);\n\t\t\t}\n\n\t\tthis.emit('set', cls, _instances);\n\t}\n\n\tprivate _add(instances: Iterable<TNode>) {\n\t\tfor(const inst of instances)\n\t\t\tthis.instances.add(inst);\n\t}\n\n\n\tprivate _maybeWrap(event: string) {\n\t\tconst key = EVENTS[event as keyof typeof EVENTS];\n\t\tif ( ! this._class || ! key || this._wrapped.has(key) )\n\t\t\treturn;\n\n\t\tthis._wrap(event, key as keyof ComponentMethods<TNode>);\n\t}\n\n\tprivate _wrap<K extends string>(event: K, key: keyof ComponentMethods<TNode>) {\n\t\tif ( this._wrapped.has(key) || ! this._class )\n\t\t\treturn;\n\n\t\tconst t = this,\n\t\t\tproto = this._class.prototype,\n\t\t\toriginal = proto[key] as (this: TNode, ...args: ComponentMethodArgs<TNode, K>) => any,\n\n\t\t\tfn = (proto as any)[key] = original ?\n\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, K>) {\n\t\t\t\t\tif ( ! this._ffz_mounted ) {\n\t\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t\tt.instances.add(this);\n\t\t\t\t\t\tt.emit('late-mount', this);\n\t\t\t\t\t}\n\n\t\t\t\t\tt.emit(event as any, this, ...args);\n\t\t\t\t\treturn original.apply(this, args);\n\t\t\t\t} :\n\n\t\t\t\tkey === 'shouldComponentUpdate' ?\n\t\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, K>) {\n\t\t\t\t\t\tif ( ! this._ffz_mounted ) {\n\t\t\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t\t\tt.instances.add(this);\n\t\t\t\t\t\t\tt.emit('late-mount', this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tt.emit(event as any, this, ...args);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\t:\n\t\t\t\t\tfunction(this: TNode, ...args: ComponentMethodArgs<TNode, K>) {\n\t\t\t\t\t\tif ( ! this._ffz_mounted ) {\n\t\t\t\t\t\t\tthis._ffz_mounted = true;\n\t\t\t\t\t\t\tt.instances.add(this);\n\t\t\t\t\t\t\tt.emit('late-mount', this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tt.emit(event as any, this, ...args);\n\t\t\t\t\t};\n\n\t\tthis._wrapped.set(key, [fn, original]);\n\t}\n\n\tprivate _unwrap(key: keyof ComponentMethods<TNode>) {\n\t\tconst pair = this._wrapped.get(key);\n\t\tif ( ! pair || ! this._class )\n\t\t\treturn;\n\n\t\tconst proto = this._class.prototype,\n\t\t\t[fn, original] = pair;\n\n\t\tif ( proto[key] !== fn )\n\t\t\tthrow new Error('unable to unwrap -- prototype modified');\n\n\t\tproto[key] = original;\n\t\tthis._wrapped.delete(key);\n\t}\n\n\n\tforceUpdate() {\n\t\tfor(const inst of this.instances)\n\t\t\ttry {\n\t\t\t\tinst.forceUpdate();\n\t\t\t\tthis.fine.emit('site:dom-update', this.name, inst);\n\n\t\t\t} catch(err) {\n\t\t\t\tif ( err instanceof Error )\n\t\t\t\t\tthis.fine.log.capture(err, {\n\t\t\t\t\t\ttags: {\n\t\t\t\t\t\t\tfine_wrapper: this.name\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\tthis.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`, err);\n\t\t\t}\n\t}\n\n\n\ton<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, '', WrapperEvents<TNode>>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.on(event, fn, ctx, priority, prepend);\n\t}\n\n\n\tonce<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, '', WrapperEvents<TNode>>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.once(event, fn, ctx, priority, prepend);\n\t}\n\n\tmany<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, '', WrapperEvents<TNode>>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.many(event, ttl, fn, ctx, priority, prepend);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<'', WrapperEvents<TNode>>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tthis._maybeWrap(event);\n\t\treturn super.waitFor(event, ctx, priority, prepend);\n\t}\n}\n","declare global {\n\tlet __extension__: string | undefined;\n}\n\n/** Whether or not FrankerFaceZ was loaded from a development server. */\nexport const DEBUG = localStorage.ffzDebugMode === 'true' && document.body.classList.contains('ffz-dev');\n\n/** Whether or not FrankerFaceZ was loaded as a packed web extension. */\nexport const EXTENSION = !!__extension__;\n\n/** The base URL of the FrankerFaceZ CDN. */\nexport const SERVER = DEBUG ? 'https://localhost:8000' : 'https://cdn2.frankerfacez.com';\n\nlet path = `${SERVER}/script`;\n\nif ( EXTENSION ) {\n\tpath = __webpack_public_path__;\n\tif ( path.endsWith('/') )\n\t\tpath = path.slice(0, path.length - 1);\n}\n\n/** Either the base URL of the FrankerFaceZ CDN or, if FFZ was loaded as a packed web extension, the base URL of the web extension's web accessible files. */\nexport const SERVER_OR_EXT = path;\n\n/** The base URL of the FrankerFaceZ API. */\nexport const API_SERVER = 'https://api.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ staging API. */\nexport const STAGING_API = 'https://api-staging.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ staging CDN. */\nexport const STAGING_CDN = 'https://cdn-staging.frankerfacez.com';\n\n/** The base URL of the FrankerFaceZ testing API used for load testing. */\nexport const NEW_API = 'https://api2.frankerfacez.com';\n\n/** The base URL provided to Sentry integrations for automatic error reporting. */\nexport const SENTRY_ID = 'https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2';\n\nexport const WORD_SEPARATORS = '[\\\\s`~<>!-#%-\\\\x2A,-/:;\\\\x3F@\\\\x5B-\\\\x5D_\\\\x7B}\\\\u00A1\\\\u00A7\\\\u00AB\\\\u00B6\\\\u00B7\\\\u00BB\\\\u00BF\\\\u037E\\\\u0387\\\\u055A-\\\\u055F\\\\u0589\\\\u058A\\\\u05BE\\\\u05C0\\\\u05C3\\\\u05C6\\\\u05F3\\\\u05F4\\\\u0609\\\\u060A\\\\u060C\\\\u060D\\\\u061B\\\\u061E\\\\u061F\\\\u066A-\\\\u066D\\\\u06D4\\\\u0700-\\\\u070D\\\\u07F7-\\\\u07F9\\\\u0830-\\\\u083E\\\\u085E\\\\u0964\\\\u0965\\\\u0970\\\\u0AF0\\\\u0DF4\\\\u0E4F\\\\u0E5A\\\\u0E5B\\\\u0F04-\\\\u0F12\\\\u0F14\\\\u0F3A-\\\\u0F3D\\\\u0F85\\\\u0FD0-\\\\u0FD4\\\\u0FD9\\\\u0FDA\\\\u104A-\\\\u104F\\\\u10FB\\\\u1360-\\\\u1368\\\\u1400\\\\u166D\\\\u166E\\\\u169B\\\\u169C\\\\u16EB-\\\\u16ED\\\\u1735\\\\u1736\\\\u17D4-\\\\u17D6\\\\u17D8-\\\\u17DA\\\\u1800-\\\\u180A\\\\u1944\\\\u1945\\\\u1A1E\\\\u1A1F\\\\u1AA0-\\\\u1AA6\\\\u1AA8-\\\\u1AAD\\\\u1B5A-\\\\u1B60\\\\u1BFC-\\\\u1BFF\\\\u1C3B-\\\\u1C3F\\\\u1C7E\\\\u1C7F\\\\u1CC0-\\\\u1CC7\\\\u1CD3\\\\u2010-\\\\u2027\\\\u2030-\\\\u2043\\\\u2045-\\\\u2051\\\\u2053-\\\\u205E\\\\u207D\\\\u207E\\\\u208D\\\\u208E\\\\u2329\\\\u232A\\\\u2768-\\\\u2775\\\\u27C5\\\\u27C6\\\\u27E6-\\\\u27EF\\\\u2983-\\\\u2998\\\\u29D8-\\\\u29DB\\\\u29FC\\\\u29FD\\\\u2CF9-\\\\u2CFC\\\\u2CFE\\\\u2CFF\\\\u2D70\\\\u2E00-\\\\u2E2E\\\\u2E30-\\\\u2E3B\\\\u3001-\\\\u3003\\\\u3008-\\\\u3011\\\\u3014-\\\\u301F\\\\u3030\\\\u303D\\\\u30A0\\\\u30FB\\\\uA4FE\\\\uA4FF\\\\uA60D-\\\\uA60F\\\\uA673\\\\uA67E\\\\uA6F2-\\\\uA6F7\\\\uA874-\\\\uA877\\\\uA8CE\\\\uA8CF\\\\uA8F8-\\\\uA8FA\\\\uA92E\\\\uA92F\\\\uA95F\\\\uA9C1-\\\\uA9CD\\\\uA9DE\\\\uA9DF\\\\uAA5C-\\\\uAA5F\\\\uAADE\\\\uAADF\\\\uAAF0\\\\uAAF1\\\\uABEB\\\\uFD3E\\\\uFD3F\\\\uFE10-\\\\uFE19\\\\uFE30-\\\\uFE52\\\\uFE54-\\\\uFE61\\\\uFE63\\\\uFE68\\\\uFE6A\\\\uFE6B\\\\uFF01-\\\\uFF03\\\\uFF05-\\\\uFF0A\\\\uFF0C-\\\\uFF0F\\\\uFF1A\\\\uFF1B\\\\uFF1F\\\\uFF20\\\\uFF3B-\\\\uFF3D\\\\uFF3F\\\\uFF5B\\\\uFF5D\\\\uFF5F-\\\\uFF65]';\n\n/**\n * A map of default Twitch emotes with non-standard sizes, so they can be displayed\n * more accurately in certain situations.\n */\nexport const WEIRD_EMOTE_SIZES: Record<string, [width: number, height: number]> = {\n\t15: [21,27],\n\t16: [22,27],\n\t17: [20,27],\n\t18: [20,27],\n\t22: [19,27],\n\t25: [25,28],\n\t26: [20,27],\n\t28: [39,27],\n\t30: [29,27],\n\t32: [21,27],\n\t33: [25,32],\n\t34: [21,28],\n\t36: [36,30],\n\t40: [21,27],\n\t41: [19,27],\n\t46: [24,24],\n\t47: [24,24],\n\t50: [18,27],\n\t52: [32,32],\n\t65: [40,30],\n\t66: [20,27],\n\t69: [41,28],\n\t73: [21,30],\n\t74: [24,30],\n\t86: [36,30],\n\t87: [24,30],\n\t92: [23,30],\n\t244: [24,30],\n\t354: [20,30],\n\t357: [28,30],\n\t360: [22,30],\n\t483: [20,18],\n\t484: [20,22],\n\t485: [27,18],\n\t486: [21,32],\n\t487: [15,32],\n\t488: [29,24],\n\t489: [20,18],\n\t490: [20,18],\n\t491: [20,18],\n\t492: [20,18],\n\t493: [20,18],\n\t494: [20,18],\n\t495: [20,18],\n\t496: [20,18],\n\t497: [20,18],\n\t498: [20,18],\n\t499: [20,18],\n\t500: [20,18],\n\t501: [20,18],\n\t1896: [20,30],\n\t1898: [26,28],\n\t1899: [22,30],\n\t1900: [33,30],\n\t1901: [24,28],\n\t1902: [27,29],\n\t1904: [24,30],\n\t1906: [24,30]\n};\n\n/** A list of hotkey combinations that are not valid for one reason or another. */\nexport const BAD_HOTKEYS = [\n\t'f',\n\t'space',\n\t'k',\n\t'shift+up',\n\t'shift+down',\n\t'esc',\n\t'm',\n\t'?',\n\t'alt+t',\n\t'alt+x'\n];\n\n/** A list of setting keys that, when changed, cause chat messages to re-render. */\nexport const RERENDER_SETTINGS = [\n\t'chat.name-format',\n\t'chat.me-style',\n\t'chat.rituals.show',\n\t'chat.subs.show',\n\t'chat.subs.compact',\n\t'chat.actions.inline',\n\t'chat.actions.hover',\n\t'chat.timestamp-format',\n\t'chat.points.allow-highlight',\n\t'chat.filtering.display-deleted',\n\t'chat.filtering.display-mod-action',\n\t'chat.replies.style',\n\t'chat.bits.cheer-notice',\n\t'chat.filtering.hidden-tokens',\n\t'chat.hype.message-style',\n\t'chat.filtering.show-reasons',\n\t'chat.emotes.allow-gigantify',\n\t'chat.shared-chat.username-tooltip',\n\t'chat.shared-chat.style'\n] as const;\n\n/**\n * A list of setting keys that, when changed, cause chat messages to first clear\n * their badge caches and then re-render.\n */\nexport const UPDATE_BADGE_SETTINGS = [\n\t'chat.badges.style',\n\t'chat.badges.hidden',\n\t'chat.badges.custom-mod',\n\t'chat.badges.custom-vip',\n] as const;\n\n/**\n * A list of setting keys that, when changed, cause chat messages to first clear\n * their cached token lists and then re-render.\n */\nexport const UPDATE_TOKEN_SETTINGS = [\n\t'chat.emotes.enabled',\n\t'chat.emotes.2x',\n\t'chat.emotes.animated',\n\t'chat.emoji.style',\n\t'chat.emoji.replace-joiner',\n\t'chat.bits.stack',\n\t'chat.rich.enabled',\n\t'chat.rich.want-mid',\n\t'chat.rich.hide-tokens',\n\t'chat.rich.all-links',\n\t'chat.rich.minimum-level',\n\t'chat.filtering.process-own',\n\t'chat.filtering.mention-priority',\n\t'chat.filtering.debug',\n\t'chat.fix-bad-emotes',\n\t'__filter:highlight-terms',\n\t'__filter:highlight-users',\n\t'__filter:highlight-badges',\n\t'__filter:block-terms',\n\t'__filter:block-users',\n\t'__filter:block-badges'\n] as const;\n\n/**\n * A list of keycodes for specific keys, for use with\n * {@link KeyboardEvent} events.\n */\nexport const KEYS = {\n\tTab: 9,\n\tEnter: 13,\n\tShift: 16,\n\tControl: 17,\n\tAlt: 18,\n\tEscape: 27,\n\tSpace: 32,\n\tPageUp: 33,\n\tPageDown: 34,\n\tEnd: 35,\n\tHome: 36,\n\tArrowLeft: 37,\n\tArrowUp: 38,\n\tArrowRight: 39,\n\tArrowDown: 40,\n\tMeta: 91,\n\tContext: 93\n} as const;\n\n/** The base URL for Twitch emote images. */\nexport const TWITCH_EMOTE_V2 = '//static-cdn.jtvnw.net/emoticons/v2';\n\n/**\n * A map of regex-style Twitch emote codes into normal,\n * human-readable strings for display in UI.\n */\nexport const KNOWN_CODES: Record<string, string> = {\n\t'#-?[\\\\\\\\/]': '#-/',\n\t':-?(?:7|L)': ':-7',\n\t'\\\\&lt\\\\;\\\\]': '<]',\n\t'\\\\:-?(S|s)': ':-S',\n\t'\\\\:-?\\\\\\\\': ':-\\\\',\n\t'\\\\:\\\\&gt\\\\;': ':>',\n\t'B-?\\\\)': 'B-)',\n\t'\\\\:-?[z|Z|\\\\|]': ':-Z',\n\t'\\\\:-?\\\\)': ':-)',\n\t'\\\\:-?\\\\(': ':-(',\n\t'\\\\:-?(p|P)': ':-P',\n\t'\\\\;-?(p|P)': ';-P',\n\t'\\\\&lt\\\\;3': '<3',\n\t'\\\\:-?[\\\\\\\\/]': ':-/',\n\t'\\\\;-?\\\\)': ';-)',\n\t'R-?\\\\)': 'R-)',\n\t'[oO](_|\\\\.)[oO]': 'O.o',\n\t'[o|O](_|\\\\.)[o|O]': 'O.o',\n\t'\\\\:-?D': ':-D',\n\t'\\\\:-?(o|O)': ':-O',\n\t'\\\\&gt\\\\;\\\\(': '>(',\n\t'Gr(a|e)yFace': 'GrayFace'\n};\n\n/** The base URL for replacement images used for specific Twitch emotes. */\nexport const REPLACEMENT_BASE = `${SERVER}/static/replacements/`;\n\n/** A map of specific Twitch emotes that should use replacement images. */\nexport const REPLACEMENTS: Record<string, string> = {\n\t15: '15-JKanStyle.png',\n\t16: '16-OptimizePrime.png',\n\t17: '17-StoneLightning.png',\n\t18: '18-TheRinger.png',\n\t//19: '19-PazPazowitz.png',\n\t//20: '20-EagleEye.png',\n\t//21: '21-CougarHunt.png',\n\t22: '22-RedCoat.png',\n\t26: '26-JonCarnage.png',\n\t//27: '27-PicoMause.png',\n\t30: '30-BCWarrior.png',\n\t33: '33-DansGame.png',\n\t36: '36-PJSalt.png'\n};\n\n/**\n * A map of WebSocket servers for the original FrankerFaceZ socket\n * system. @deprecated\n */\nexport const WS_CLUSTERS = {\n\tProduction: [\n\t\t['wss://catbag.frankerfacez.com/', 0.25],\n\t\t['wss://andknuckles.frankerfacez.com/', 0.8],\n\t\t['wss://tuturu.frankerfacez.com/', 0.7],\n\t\t['wss://lilz.frankerfacez.com/', 1],\n\t\t['wss://yoohoo.frankerfacez.com/', 1],\n\t\t['wss://pog.frankerfacez.com/', 1],\n\t\t['wss://ayaya.frankerfacez.com/', 1],\n\t\t['wss://champ.frankerfacez.com/', 1]\n\t],\n\n\tDevelopment: [\n\t\t['ws://127.0.0.1:7999/', 1]\n\t]\n}\n\n\nexport const LINK_DATA_HOSTS = {\n\t/*socket: {\n\t\ttitle: 'Socket Cluster (Deprecated)',\n\t\tvalue: 'special:socket'\n\t},*/\n\tlocalhost: {\n\t\ttitle: 'Local Dev Server (Port 8002)',\n\t\tvalue: 'https://localhost:8002',\n\t\thas_sse: true\n\t},\n\t'localhost-cf': {\n\t\ttitle: 'Local Dev Worker (Wrangler, Port 8787)',\n\t\tvalue: 'https://localhost:8787'\n\t},\n\t/*test: {\n\t\ttitle: 'API Test Server',\n\t\tvalue: 'https://api-test.frankerfacez.com/v2/link'\n\t},\n\t'test-cf': {\n\t\ttitle: 'Cloudflare Test Worker',\n\t\tvalue: 'https://link-service.workers.frankerfacez.com'\n\t},*/\n\tProduction: {\n\t\ttitle: 'Production',\n\t\tvalue: 'https://link-service.workers.frankerfacez.com'\n\t}\n};\n\n\nexport const PUBSUB_CLUSTERS = {\n\tProduction: `https://pubsub.frankerfacez.com`,\n\tStaging: `https://pubsub-staging-alt.frankerfacez.com`,\n\tEMQXTest: 'emqx-test',\n\tDevelopment: `https://stendec.dev/ps/`\n}\n\nexport const EMQX_SERVERS = [\n\t//'catbag.frankerfacez.com',\n\t//'pubsub-staging.frankerfacez.com',\n\t'biblethump.frankerfacez.com',\n\t/*'ayaya.frankerfacez.com',\n\t'champ.frankerfacez.com',\n\t'lilz.frankerfacez.com',\n\t'pog.frankerfacez.com',\n\t'yoohoo.frankerfacez.com',\n\t'andknuckles.frankerfacez.com'*/\n];\n\n\n/** Whether or not we're running on macOS */\nexport const IS_OSX = navigator.platform ? navigator.platform.indexOf('Mac') !== -1 : /OS X/.test(navigator.userAgent);\n\n/** Whether or not we're running on Windows */\nexport const IS_WIN = navigator.platform ? navigator.platform.indexOf('Win') !== -1 : /Windows/.test(navigator.userAgent);\n\n/** Whether or not we're running on a Webkit-based browser. */\nexport const IS_WEBKIT = navigator.userAgent.indexOf('AppleWebKit/') !== -1 && navigator.userAgent.indexOf('Edge/') === -1;\n\n/** Whether or not we're running on a Firefox-based browser. */\nexport const IS_FIREFOX = (navigator.userAgent.indexOf('Firefox/') !== -1);\n\n/**\n * A -webkit- CSS prefix, if we're running on a Webkit-based browser.\n * Hopefully we don't need this anymore.\n * @deprecated\n */\nexport const WEBKIT_CSS = IS_WEBKIT ? '-webkit-' : '';\n\n/** A list of Twitch emote sets that are globally available. */\nexport const TWITCH_GLOBAL_SETS = [0, 33, 42] as const;\n\n/** A list of Twitch emote sets that are for emotes unlocked with channel points. */\nexport const TWITCH_POINTS_SETS = [300238151] as const;\n\n/** A list of Twitch emote sets that are for Twitch Prime subscribers. */\nexport const TWITCH_PRIME_SETS = [457, 793, 19151, 19194] as const;\n\n/** An enum of all possible Twitch emote types. */\nexport enum EmoteTypes {\n\t/** What kind of weird emote are you dragging in here */\n\tUnknown,\n\t/** Emotes unlocked via Twitch Prime */\n\tPrime,\n\t/** Emotes unlocked via Twitch Turbo */\n\tTurbo,\n\t/** Emotes unlocked via arbitrary condition, permanently available. */\n\tLimitedTime,\n\t/** Emotes unlocked via channel points. */\n\tChannelPoints,\n\t/** Emote no longer available. */\n\tUnavailable,\n\t/** Emote unlocked via subscription to channel. */\n\tSubscription,\n\t/** Emote permanently unlocked via cheering in channel. */\n\tBitsTier,\n\t/** Globally available emote. */\n\tGlobal,\n\t/** Emote unlocked via enabling two-factor authentication. */\n\tTwoFactor,\n\t/** Emote unlocked via following a channel. */\n\tFollower\n};\n\n\nexport const RESOLVERS_REQUIRE_TOS = {\n\t'YouTube': {\n\t\tlabel: 'You must agree to the YouTube Terms of Service to view this embed.',\n\t\ti18n_key: 'embed.warn.youtube',\n\n\t\ti18n_links: 'embed.warn.youtube.links',\n\t\tlinks: `To view YouTube embeds, you must agree to YouTube's Terms of Service:\n* [Terms of Service](https://www.youtube.com/t/terms)\n* [Privacy Policy](https://policies.google.com/privacy)`,\n\n\t\ti18n_accept: 'embed.warn.youtube.agree',\n\t\taccept: 'Yes, I accept the YouTube Terms of Service.'\n\t},\n\n} as Record<string, any>;\n","'use strict';\n\n// ============================================================================\n// Dialog for Vue\n// ============================================================================\n\nimport {EventEmitter} from 'utilities/events';\n\nimport Site from 'site';\n\n\nlet last_z = 9000;\n\nexport function getDialogNextZ() {\n\treturn last_z++;\n}\n\n\nexport type DialogSelectors = {\n\texclusive: string;\n\tmaximized: string;\n\tnormal: string;\n}\n\n\nexport type DialogOptions = {\n\tselectors: DialogSelectors;\n\tmaximized?: boolean;\n\texclusive?: boolean;\n\tprepend?: boolean;\n}\n\n\nexport type DialogEvents = {\n\thide: [],\n\tshow: [],\n\terror: [error: any],\n\tresize: []\n};\n\n\nexport class Dialog extends EventEmitter<DialogEvents> {\n\n\tstatic EXCLUSIVE = Site.DIALOG_EXCLUSIVE;\n\tstatic MAXIMIZED = Site.DIALOG_MAXIMIZED;\n\tstatic SELECTOR = Site.DIALOG_SELECTOR;\n\n\tselectors: DialogSelectors;\n\n\tfactory?: () => Element;\n\t_element?: Element | null;\n\n\t_visible: boolean;\n\t_maximized: boolean;\n\t_exclusive: boolean;\n\tprepend: boolean;\n\n\n\tconstructor(element: Element | (() => Element), options: Partial<DialogOptions> = {}) {\n\t\tsuper();\n\n\t\tthis.selectors = {\n\t\t\texclusive: Dialog.EXCLUSIVE,\n\t\t\tmaximized: Dialog.MAXIMIZED,\n\t\t\tnormal: Dialog.SELECTOR\n\t\t};\n\n\t\tif ( options.selectors )\n\t\t\tthis.selectors = Object.assign(this.selectors, options.selectors);\n\n\t\tthis._maximized = options.maximized || false;\n\t\tthis._exclusive = options.exclusive || false;\n\n\t\tthis.prepend = options.prepend || false;\n\n\t\tthis._element = null;\n\t\tthis._visible = false;\n\n\t\tif ( typeof element === 'function' )\n\t\t\tthis.factory = element;\n\t\telse\n\t\t\tthis.element = element;\n\t}\n\n\t// ========================================================================\n\t// Properties and Utility Methods\n\t// ========================================================================\n\n\tget maximized() {\n\t\treturn this._exclusive || this._maximized;\n\t}\n\n\tset maximized(val) {\n\t\tval = Boolean(val);\n\t\tif ( val === this._maximized )\n\t\t\treturn;\n\n\t\tif ( this._visible )\n\t\t\tthis.toggleSize();\n\t\telse\n\t\t\tthis._maximized = val;\n\t}\n\n\tget visible() {\n\t\treturn this._visible;\n\t}\n\n\tset visible(val) {\n\t\tval = Boolean(val);\n\t\tif ( val === this._visible )\n\t\t\treturn;\n\n\t\tthis.toggleVisible();\n\t}\n\n\tget exclusive() {\n\t\treturn this._exclusive;\n\t}\n\n\tset exclusive(val) {\n\t\tif ( this._visible )\n\t\t\tthrow new Error('cannot set exclusive flag when dialog already visible');\n\n\t\tthis._exclusive = val;\n\t}\n\n\tget element() {\n\t\treturn this._element;\n\t}\n\n\tset element(val) {\n\t\tif ( this._visible )\n\t\t\tthrow new Error('cannot change element when dialog already visible');\n\n\t\tif ( !(val instanceof Node) )\n\t\t\tthrow new Error('element must be an instance of Node');\n\n\t\tthis._element = val;\n\t}\n\n\tshow() {\n\t\tthis.visible = true;\n\t}\n\n\thide() {\n\t\tthis.visible = false;\n\t}\n\n\tmaximize() {\n\t\tthis.maximized = true;\n\t}\n\n\trestore() {\n\t\tthis.maximized = false;\n\t}\n\n\n\t// ========================================================================\n\t// Element Logic\n\t// ========================================================================\n\n\tgetContainer() {\n\t\treturn document.querySelector(\n\t\t\tthis._exclusive ? this.selectors.exclusive :\n\t\t\t\tthis._maximized ? this.selectors.maximized :\n\t\t\t\t\tthis.selectors.normal\n\t\t);\n\t}\n\n\ttoggleVisible(event?: MouseEvent) {\n\t\tif ( event && event.button !== 0 )\n\t\t\treturn;\n\n\t\tconst maximized = this.maximized,\n\t\t\tvisible = this._visible = ! this._visible,\n\t\t\tcontainer = this.getContainer();\n\n\t\tif ( maximized && container )\n\t\t\tcontainer.classList.toggle('ffz-has-dialog', visible);\n\n\t\tif ( ! visible ) {\n\t\t\tif ( this._element )\n\t\t\t\tthis._element.remove();\n\n\t\t\tthis.emit('hide');\n\n\t\t\tif ( this.factory )\n\t\t\t\tthis._element = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! container )\n\t\t\treturn;\n\n\t\tif ( this.factory ) {\n\t\t\tconst el = this.factory();\n\t\t\tif ( el instanceof Promise ) {\n\t\t\t\tel.then(e => {\n\t\t\t\t\tthis._element = e;\n\t\t\t\t\tif ( this.prepend )\n\t\t\t\t\t\tcontainer.insertBefore(e, container.firstChild);\n\t\t\t\t\telse\n\t\t\t\t\t\tcontainer.appendChild(e);\n\t\t\t\t\tthis.emit('show');\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tthis.emit('error', err);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\n\t\t\t} else\n\t\t\t\tthis._element = el;\n\t\t}\n\n\t\tif ( ! this._element )\n\t\t\treturn;\n\n\t\tif ( this.prepend )\n\t\t\tcontainer.insertBefore(this._element, container.firstChild);\n\t\telse\n\t\t\tcontainer.appendChild(this._element);\n\n\t\tthis.emit('show');\n\t}\n\n\ttoggleSize(event?: MouseEvent) {\n\t\tif ( ! this._visible || event && event.button !== 0 || ! this._element )\n\t\t\treturn;\n\n\t\tthis._maximized = !this._maximized;\n\n\t\tconst maximized = this.maximized,\n\t\t\tcontainer = this.getContainer(),\n\t\t\told_container = this._element.parentElement;\n\n\t\tif ( container === old_container )\n\t\t\treturn;\n\n\t\tif ( maximized ) {\n\t\t\tif ( container )\n\t\t\t\tcontainer.classList.add('ffz-has-dialog');\n\t\t} else if ( old_container )\n\t\t\told_container.classList.remove('ffz-has-dialog');\n\n\t\tthis._element.remove();\n\t\tif ( container ) {\n\t\t\tif ( this.prepend )\n\t\t\t\tcontainer.insertBefore(this._element, container.firstChild);\n\t\t\telse\n\t\t\t\tcontainer.appendChild(this._element);\n\t\t}\n\n\t\tthis.emit('resize');\n\t}\n}\n\n// This is necessary for add-ons for now.\nexport default Dialog;\n","\nimport {has} from 'utilities/object';\nimport type { DomFragment } from './types';\nimport { DEBUG } from './constants';\n\nconst ATTRS = [\n\t'accept', 'accept-charset', 'accesskey', 'action', 'align', 'alt', 'async',\n\t'autocomplete', 'autofocus', 'autoplay', 'bgcolor', 'border', 'buffered',\n\t'challenge', 'charset', 'checked', 'cite', 'class', 'code', 'codebase',\n\t'color', 'cols', 'colspan', 'content', 'contenteditable', 'contextmenu',\n\t'controls', 'coords', 'crossorigin', 'data', 'data-*', 'datetime',\n\t'default', 'defer', 'dir', 'dirname', 'download', 'draggable',\n\t'dropzone', 'enctype', 'for', 'form', 'formaction', 'headers', 'height',\n\t'hidden', 'high', 'href', 'hreflang', 'http-equiv', 'icon', 'id',\n\t'integrity', 'ismap', 'itemprop', 'keytype', 'kind', 'label', 'lang',\n\t'language', 'list', 'loop', 'low', 'manifest', 'max', 'maxlength',\n\t'minlength', 'media', 'method', 'min', 'multiple', 'name',\n\t'novalidate', 'open', 'optimum', 'pattern', 'ping', 'placeholder', 'poster',\n\t'preload', 'radiogroup', 'readonly', 'rel', 'required', 'reversed', 'rows',\n\t'rowspan', 'sandbox', 'scope', 'scoped', 'seamless', 'selected', 'shape',\n\t'size', 'sizes', 'slot', 'span', 'spellcheck', 'src', 'srcdoc', 'srclang',\n\t'srcset', 'start', 'step', 'style', 'summary', 'tabindex', 'target',\n\t'title', 'type', 'usemap', 'value', 'width', 'wrap'\n];\n\nconst SVG_TAGS = [\n\t'svg', 'animate', 'animateMotion', 'animateTransform', 'circle', 'clipPath',\n\t'cursor', 'defs', 'desc', 'ellipse', 'feBlend', 'feColorMatrix', 'feComponentTransfer',\n\t'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight',\n\t'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur',\n\t'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight',\n\t'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence', 'filter', 'font-face-format',\n\t'font-face-name', 'font-face-src', 'font-face-uri', 'font-face', 'font', 'foreignObject',\n\t'g', 'glyph', 'glyphRef', 'hkern', 'image', 'line', 'linearGradient', 'marker', 'mask',\n\t'metadata', 'missing-glyph', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialGradient',\n\t'rect', 'set', 'stop', 'switch', 'symbol', 'text', 'textPath', 'tref',\n\t'tspan', 'use', 'view', 'vkern'\n];\n\n/*const SVG_ATTRS = [\n\t'accent-height', 'accumulate', 'additive', 'alignment-baseline', 'alphabetic',\n\t'amplitude', 'arabic-form', 'ascent', 'attributeName', 'attributeType', 'azimuth',\n\t'baseFrequency', 'baseline-shift', 'baseProfile', 'bbox', 'begin', 'bias', 'by',\n\t'calcMode', 'cap-height', 'class', 'clip', 'clipPathUnits', 'clip-path', 'clip-rule',\n\t'color', 'color-interpolation', 'color-interpolation-filters', 'crossorigin',\n\t'cursor', 'cx', 'cy', 'd', 'decoding', 'descent', 'diffuseConstant', 'direction', 'display',\n\t'divisor', 'dominant-baseline', 'dur', 'dx', 'dy', 'edgeMode', 'elevation', 'end', 'exponent',\n\t'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterUnits', 'flood-color', 'flood-opacity',\n\t'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant',\n\t'font-weight', 'fr', 'from', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyph-orientation-horizontal',\n\t'glyph-orientation-vertical', 'gradientTransform', 'gradientUnits', 'hanging',\n\t'horiz-adv-x', 'horiz-origin-x', 'ideographic', 'image-rendering', 'in', 'in2', 'intercept',\n\t'k', 'k1', 'k2', 'k3', 'k4', 'kernelMatrix', 'kernelUnitLength', 'keyPoints', 'keySplines',\n\t'keyTimes', 'lang', 'lengthAdjust', 'letter-spacing', 'lighting-color', 'limitingConeAngle',\n\t'local', 'marker-end', 'marker-mid', 'marker-start', 'markerHeight', 'markerUnits', 'markerWidth',\n\t'mask', 'maskContentUnits', 'maskUnits', 'mathematical', 'max', 'media', 'method', 'min', 'mode',\n\t'name', 'numOctaves', 'offset', 'opacity', 'operator', 'order', 'orient', 'orientation', 'origin',\n\t'overflow', 'overline-position', 'overline-thickness', 'paint-order', 'panose-1', 'path',\n\t'pathLength', 'patternContentUnits', 'patternTransform', 'patternUnits', 'ping', 'pointer-events',\n\t'points', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'preserveAlpha', 'preserveAspectRatio',\n\t'primitiveUnits', 'r', 'radius', 'refX', 'refY', 'result', 'rotate', 'rx', 'ry', 'scale', 'seed',\n\t'side', 'spacing', 'stop-color', 'stop-opacity', 'st'\n];*/\n\nconst BOOLEAN_ATTRS = [\n\t'controls', 'autoplay', 'loop'\n];\n\n\nconst range = document.createRange();\n\nfunction camelCase(name: string) {\n\treturn name.replace(/[-_]\\w/g, m => m[1].toUpperCase());\n}\n\n/**\n * A simple helper method for calling {@link EventTarget.addEventListener}\n * @internal\n */\nexport function on(obj: EventTarget, type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | AddEventListenerOptions) {\n\treturn obj.addEventListener(type, listener, options);\n}\n\n/**\n * A simple helper method for calling {@link EventTarget.removeEventListener}\n * @internal\n */\nexport function off(obj: EventTarget, type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | EventListenerOptions) {\n\treturn obj.removeEventListener(type, listener, options);\n}\n\n\n// TODO: Better fake React types.\n\ntype SimpleNodeLike = {\n\tprops?: {\n\t\tchildren?: SimpleNodeLike | SimpleNodeLike[]\n\t}\n}\n\n/**\n * Scan a React render tree, attempting to find a matching fragment.\n *\n * @param frag The initial point to start scanning the tree.\n * @param criteria A function that returns true if a fragment matches what\n * we want.\n * @param depth The maximum scanning depth, defaults to 25.\n * @param current For Internal Use. The current scanning depth.\n * @param visited For Internal Use. A Set of all visited fragments, to prevent\n * redundant checks.\n * @returns The matching fragment, or null if one was not found.\n */\nexport function findReactFragment<TNode extends SimpleNodeLike>(\n\tfrag: TNode,\n\tcriteria: (node: TNode) => boolean,\n\tdepth: number = 25,\n\tcurrent: number = 0,\n\tvisited?: Set<any>\n): TNode | null {\n\tif ( ! visited )\n\t\tvisited = new Set;\n\telse if ( visited.has(frag) )\n\t\treturn null;\n\n\tif ( criteria(frag) )\n\t\treturn frag;\n\n\tif ( current >= depth )\n\t\treturn null;\n\n\tvisited.add(frag);\n\n\tif ( frag?.props?.children ) {\n\t\tif ( Array.isArray(frag.props.children) ) {\n\t\t\tfor(const child of frag.props.children) {\n\t\t\t\tif ( ! child )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif ( Array.isArray(child) ) {\n\t\t\t\t\tfor(const f of child) {\n\t\t\t\t\t\tconst out = findReactFragment(f, criteria, depth, current + 1, visited);\n\t\t\t\t\t\tif ( out )\n\t\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst out = findReactFragment(child as TNode, criteria, depth, current + 1, visited);\n\t\t\t\t\tif ( out )\n\t\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst out = findReactFragment(frag.props.children as TNode, criteria, depth, current + 1, visited);\n\t\t\tif ( out )\n\t\t\t\treturn out;\n\t\t}\n\t}\n\n\treturn null;\n}\n\n\n// TODO: Stronger types.\n\n/**\n * This method allows you to create native DOM fragments using the same calling\n * syntax as React's `React.createElement` method. Because of this, we can use\n * JSX for creating native DOM fragments, as well as rendering functions that are\n * interchangable inside of and outside of a React context.\n *\n * @example Create a span containing a figure to render an icon.\n * ```typescript\n * return createElement('span', {\n *     className: 'ffz--icon-holder tw-mg-r-05'\n * }, createElement('figure', {\n *     className: 'ffz-i-zreknarf'\n * }));\n * ```\n *\n * @example Doing the same, but with JSX\n * ```typescript\n * // When using JSX, we still need to make sure createElement is available in\n * // the current context. It can be provided as an argument to a function, or\n * // imported at the top level of the module.\n *\n * import { createElement } from 'utilities/dom';\n * // or... if you're working with add-ons...\n * const { createElement } = FrankerFaceZ.utilities.dom;\n *\n * return (<span class=\"ffz--icon-holder tw-mg-r-05\">\n *     <figure class=\"ffz-i-zreknarf\" />\n * </span>);\n * ```\n *\n * @param tag The name of the tag to be created. Functions are not supported.\n * @param props The properties object.\n * @param children A child or list of children. These should be strings, `null`s,\n * or {@link Node}s that can be assigned as children of a {@link HTMLElement}.\n */\nexport function createElement<K extends keyof HTMLElementTagNameMap>(tag: K, props?: any, ...children: DomFragment[]): HTMLElementTagNameMap[K];\nexport function createElement<K extends keyof HTMLElementDeprecatedTagNameMap>(tag: K, props?: any, ...children: DomFragment[]): HTMLElementDeprecatedTagNameMap[K];\nexport function createElement(tag: string, props?: any, ...children: DomFragment[]): HTMLElement {\n\tconst isSvg = SVG_TAGS.includes(tag);\n\tconst el = isSvg\n\t\t// This is technically wrong. I do not really care.\n\t\t? document.createElementNS('http://www.w3.org/2000/svg', tag) as unknown as HTMLElement\n\t\t: document.createElement(tag);\n\n\tif ( children.length === 0)\n\t\tchildren = null as any;\n\telse if ( children.length === 1 )\n\t\tchildren = children[0] as any;\n\n\tif ( typeof props === 'string' )\n\t\tel.setAttribute('class', props);\n\telse if ( props )\n\t\tfor(const key in props)\n\t\t\tif ( has(props, key) ) {\n\t\t\t\tconst lk = key.toLowerCase(),\n\t\t\t\t\tprop = props[key];\n\n\t\t\t\tif ( key === 'className' ) {\n\t\t\t\t\tel.setAttribute('class', prop);\n\n\t\t\t\t} else if ( lk === 'style' ) {\n\t\t\t\t\tif ( typeof prop === 'string' )\n\t\t\t\t\t\tel.style.cssText = prop;\n\t\t\t\t\telse if ( prop && typeof prop === 'object' )\n\t\t\t\t\t\tfor(const [key, val] of Object.entries(prop)) {\n\t\t\t\t\t\t\tif ( has(el.style, key) || has(Object.getPrototypeOf(el.style), key) )\n\t\t\t\t\t\t\t\t(el.style as any)[key] = val;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tel.style.setProperty(key, prop[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\telse if ( DEBUG && prop != null )\n\t\t\t\t\t\tconsole.warn('unsupported style value', prop);\n\n\t\t\t\t} else if ( lk === 'dataset' ) {\n\t\t\t\t\tif ( prop && typeof prop === 'object' ) {\n\t\t\t\t\t\tfor(const k in prop)\n\t\t\t\t\t\t\tif ( has(prop, k) )\n\t\t\t\t\t\t\t\tel.dataset[camelCase(k)] = prop[k];\n\t\t\t\t\t} else if ( DEBUG && prop != null )\n\t\t\t\t\t\tconsole.warn('unsupported dataset value', prop);\n\n\t\t\t\t} else if ( key === 'dangerouslySetInnerHTML' ) {\n\t\t\t\t\t// React compatibility is cool. SeemsGood\n\t\t\t\t\tif ( prop && prop.__html )\n\t\t\t\t\t\tel.innerHTML = prop.__html;\n\n\t\t\t\t} else if ( lk.startsWith('on') )\n\t\t\t\t\tel.addEventListener(lk.slice(2), prop);\n\n\t\t\t\telse if ( lk.startsWith('data-') )\n\t\t\t\t\tel.dataset[camelCase(lk.slice(5))] = prop;\n\n\t\t\t\telse if ( BOOLEAN_ATTRS.includes(lk) ) {\n\t\t\t\t\tif ( prop && prop !== 'false' )\n\t\t\t\t\t\tel.setAttribute(key, prop);\n\n\t\t\t\t} else if ( lk.startsWith('aria-') || ATTRS.includes(lk) || SVG_TAGS.includes(tag) )\n\t\t\t\t\tel.setAttribute(key, prop);\n\n\t\t\t\telse\n\t\t\t\t\t(el as any)[key] = prop;\n\t\t\t}\n\n\tif ( children )\n\t\tsetChildren(el, children);\n\n\treturn el;\n}\n\n/**\n * Set the children of a {@link HTMLElement}. This is also used internally by\n * the {@link createElement} method.\n *\n * @param element The element to set the children of.\n * @param children The children to add to the element.\n * @param no_sanitize If this is set to true, any provided string values will\n * be treated as HTML rather than text and will not be sanitized. This is\n * NOT recommended.\n * @param no_empty If this is set to true, the element's previous contents\n * will not be discarded before setting the new children.\n */\nexport function setChildren(\n\telement: HTMLElement,\n\tchildren: DomFragment,\n\tno_sanitize: boolean = false,\n\tno_empty: boolean = false\n) {\n\tif (no_sanitize)\n\t\twindow.FrankerFaceZ.get().log.warn('call to setChildren with no_sanitize set to true -- this is no longer supported');\n\n\tif (children instanceof Node ) {\n\t\tif (! no_empty )\n\t\t\telement.innerHTML = '';\n\n\t\telement.appendChild(children);\n\n\t} else if ( Array.isArray(children) ) {\n\t\tif (! no_empty)\n\t\t\telement.innerHTML = '';\n\n\t\tfor(const child of children)\n\t\t\tif (child instanceof Node)\n\t\t\t\telement.appendChild(child);\n\t\t\telse if (Array.isArray(child))\n\t\t\t\tsetChildren(element, child, no_sanitize, true);\n\t\t\telse if (child) {\n\t\t\t\tconst val = typeof child === 'string' ? child : String(child);\n\n\t\t\t\t// We no longer support no_sanitize\n\t\t\t\t//element.appendChild(no_sanitize ?\n\t\t\t\t//\trange.createContextualFragment(val) : document.createTextNode(val));\n\n\t\t\t\telement.appendChild(document.createTextNode(val));\n\t\t\t}\n\n\t} else if (children) {\n\t\tconst val = typeof children === 'string' ? children : String(children);\n\n\t\t// We no longer support no_sanitize\n\t\t//element.appendChild(no_sanitize ?\n\t\t//\trange.createContextualFragment(val) : document.createTextNode(val));\n\t\telement.appendChild(document.createTextNode(val));\n\t}\n}\n\n/**\n * Determine if the two provided Nodes share a parent.\n *\n * @param element The first node.\n * @param other The second node.\n * @param selector A CSS selector to use. If this is set, only consider parents\n * that match the selector.\n */\nexport function hasSharedParent(element: Node | null, other: Node, selector?: string) {\n\twhile(element) {\n\t\tif ( element.contains(other) )\n\t\t\treturn true;\n\n\t\telement = element.parentElement;\n\t\tif ( selector )\n\t\t\telement = element instanceof Element\n\t\t\t\t? element.closest(selector)\n\t\t\t\t: null;\n\t}\n\n\treturn false;\n}\n\n\n/**\n * Display an Open File dialog to the user and return the selected\n * value. This may never return depending on the user agent's\n * behavior and should be used sparingly and never in a heavy\n * context to avoid excess memory usage.\n *\n * @param contentType The content type to filter by when selecting files.\n * @param multiple Whether or not multiple files should be returned.\n * @returns A file or list of files.\n */\nexport function openFile(contentType: string, multiple: boolean) {\n\treturn new Promise<File | File[] | null>(resolve => {\n\t\tconst input = document.createElement('input');\n\t\tinput.type = 'file';\n\t\tinput.accept = contentType;\n\t\tinput.multiple = multiple;\n\n\t\tlet resolved = false;\n\n\t\t// TODO: Investigate this causing issues\n\t\t// for some users.\n\t\t/*const focuser = () => {\n\t\t\toff(window, 'focus', focuser);\n\t\t\tsetTimeout(() => {\n\t\t\t\tif ( ! resolved ) {\n\t\t\t\t\tresolved = true;\n\t\t\t\t\tresolve(multiple ? [] : null);\n\t\t\t\t}\n\t\t\t}, 5000);\n\t\t};\n\n\t\ton(window, 'focus', focuser);*/\n\n\t\tinput.onchange = () => {\n\t\t\t//off(window, 'focus', focuser);\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tconst files = Array.from(input.files ?? []);\n\t\t\t\tresolve(multiple ? files : files[0])\n\t\t\t}\n\t\t}\n\n\t\tinput.click();\n\t});\n}\n\n/**\n * Read the contents of a {@link File} asynchronously.\n *\n * @param file The file to read\n * @param encoding The character encoding to use. Defaults to UTF-8.\n */\nexport function readFile(file: Blob, encoding = 'utf-8') {\n\treturn new Promise((resolve, reject) => {\n\t\tconst reader = new FileReader();\n\t\treader.readAsText(file, encoding);\n\t\treader.onload = () => resolve(reader.result);\n\t\treader.onerror = e => reject(e);\n\t});\n}\n\n\nconst el = document.createElement('span');\n\n/**\n * Sanitize a string, replacing all special HTML characters\n * with entities.\n *\n * Internally, this uses the browser's native DOM library\n * by setting `textContent` on an Element and returning its\n * `innerHTML`.\n *\n * @param text The text to sanitize.\n */\nexport function sanitize(text: string) {\n\tel.textContent = text;\n\tconst out = el.innerHTML;\n\t// Ensure we're not keeping large strings in memory.\n\tel.textContent = '';\n\treturn out;\n}\n\n\nlet last_id = 0;\n\nexport class ManagedStyle {\n\tid: number;\n\n\tprivate _blocks: Record<string, Text | null>;\n\tprivate _style: HTMLStyleElement;\n\n\tconstructor(id?: number) {\n\t\tthis.id = id || last_id++;\n\n\t\tthis._blocks = {};\n\n\t\tthis._style = createElement('style', {\n\t\t\ttype: 'text/css',\n\t\t\tid: `ffz--managed-style--${this.id}`\n\t\t});\n\n\t\tdocument.head.appendChild(this._style);\n\t}\n\n\tdestroy() {\n\t\tif ( this._style )\n\t\t\tthis._style.remove();\n\n\t\t// This is lazy typing, but I don't really care.\n\t\t// Rather do this than put checks in every other bit of code.\n\t\tthis._blocks = null as any;\n\t\tthis._style = null as any;\n\t}\n\n\tclear() {\n\t\tthis._blocks = {};\n\t\tthis._style.innerHTML = '';\n\t}\n\n\tget(key: string) {\n\t\tconst block = this._blocks[key];\n\t\tif ( block )\n\t\t\treturn block.textContent;\n\t\treturn undefined;\n\t}\n\n\thas(key: string) {\n\t\treturn !! this._blocks[key];\n\t}\n\n\tset(key: string, value: string, force: boolean = false) {\n\t\tconst block = this._blocks[key];\n\t\tif ( block ) {\n\t\t\tif ( ! force && block.textContent === value )\n\t\t\t\treturn;\n\n\t\t\tblock.textContent = value;\n\t\t} else\n\t\t\tthis._style.appendChild(this._blocks[key] = document.createTextNode(value));\n\t}\n\n\tdelete(key: string) {\n\t\tconst block = this._blocks[key];\n\t\tif ( block ) {\n\t\t\tif ( this._style.contains(block) )\n\t\t\t\tthis._style.removeChild(block);\n\n\t\t\tthis._blocks[key] = null;\n\t\t}\n\t}\n}\n\n\nexport class ClickOutside {\n\n\tel: HTMLElement | null;\n\tcb: ((event: MouseEvent) => void) | null;\n\t_fn: ((event: MouseEvent) => void) | null;\n\n\tconstructor(element: HTMLElement, callback: ((event: MouseEvent) => void)) {\n\t\tthis.el = element;\n\t\tthis.cb = callback;\n\n\t\tthis._fn = this.handleClick.bind(this);\n\t\tdocument.documentElement.addEventListener('click', this._fn);\n\t}\n\n\tdestroy() {\n\t\tif ( this._fn )\n\t\t\tdocument.documentElement.removeEventListener('click', this._fn);\n\n\t\tthis.cb = this.el = this._fn = null;\n\t}\n\n\thandleClick(event: MouseEvent) {\n\t\tif ( this.cb && this.el && ! this.el.contains(event.target as Node) )\n\t\t\tthis.cb(event);\n\t}\n\n}\n\n\n/**\n * Take an object that can be expressed as JSON and return a string of HTML\n * that can be used to display the object with highlighting and formatting.\n *\n * TODO: Rewrite this method to not use raw HTML.\n *\n * @deprecated You should not depend on this method, as its signature is expected to change.\n *\n * @param object The object to be formatted\n * @param pretty Whether or not to use indentation when rendering the object\n * @param depth The current rendering depth\n * @param max_depth The maximum depth to render, defaults to 30.\n * @returns A string of HTML.\n */\nexport function highlightJson(object: any, pretty = false, depth = 1, max_depth = 30): string {\n\tlet indent = '', indent_inner = '';\n\tif ( pretty ) {\n\t\tindent = '    '.repeat(depth - 1);\n\t\tindent_inner = '    '.repeat(depth);\n\t}\n\n\tif ( depth > max_depth )\n\t\treturn `<span class=\"ffz-ct--obj-literal\">&lt;nested&gt;</span>`;\n\n\tif (object == null)\n\t\treturn `<span class=\"ffz-ct--literal\" depth=\"${depth}\">null</span>`;\n\n\tif ( typeof object === 'number' || typeof object === 'boolean' )\n\t\treturn `<span class=\"ffz-ct--literal\" depth=\"${depth}\">${object}</span>`;\n\n\tif ( typeof object === 'string' )\n\t\treturn `<span class=ffz-ct--string depth=\"${depth}\">${sanitize(JSON.stringify(object))}</span>`;\n\n\tif ( Array.isArray(object) )\n\t\treturn `<span class=\"ffz-ct--obj-open\" depth=\"${depth}\">[</span>`\n\t\t\t+ (object.length > 0 ? (\n\t\t\t\tobject.map(x => (pretty ? `\\n${indent_inner}` : '') + highlightJson(x, pretty, depth + 1, max_depth)).join(`<span class=\"ffz-ct--obj-sep\" depth=\"${depth}\">, </span>`)\n\t\t\t\t+ (pretty ? `\\n${indent}` : '')\n\t\t\t) : '')\n\t\t\t+ `<span class=\"ffz-ct--obj-close\" depth=\"${depth}\">]</span>`;\n\n\tconst out = [];\n\n\tfor(const [key, val] of Object.entries(object)) {\n\t\tif ( out.length > 0 )\n\t\t\tout.push(`<span class=\"ffz-ct--obj-sep\" depth=\"${depth}\">, </span>`);\n\n\t\tif ( pretty )\n\t\t\tout.push(`\\n${indent_inner}`);\n\t\tout.push(`<span class=\"ffz-ct--obj-key\" depth=\"${depth}\">${sanitize(JSON.stringify(key))}</span><span class=\"ffz-ct--obj-key-sep\" depth=\"${depth}\">: </span>`);\n\t\tout.push(highlightJson(val, pretty, depth + 1, max_depth));\n\t}\n\n\treturn `<span class=\"ffz-ct--obj-open\" depth=\"${depth}\">{</span>${out.join('')}${out.length && pretty ? `\\n${indent}` : ''}<span class=\"ffz-ct--obj-close\" depth=\"${depth}\">}</span>`;\n}\n","// ============================================================================\n// EventEmitter\n// Homegrown for that lean feeling.\n// ============================================================================\n\n/**\n * A special value that, when returned from an event listener, will cause the\n * listener to be removed and no longer receive events.\n */\nexport const Detach = Symbol('Detach');\n\n/**\n * A special value that, when returned from an event listener, will stop\n * iteration and prevent any additional event listeners from receiving the\n * event themselves.\n */\nexport const StopPropagation = Symbol('StopPropagation');\n\ndeclare global {\n\tinterface String {\n\t\ttoSlug(separator: string): string;\n\t\ttoSnakeCase(): string;\n\t}\n}\n\nconst SNAKE_CAPS = /([a-z])([A-Z])/g,\n\tSNAKE_SPACE = /[ \\t\\W]/g,\n\tSNAKE_TRIM = /^_+|_+$/g;\n\nString.prototype.toSlug = function(this: string, separator: string = '-') {\n\tlet result = this;\n\tif (result.normalize)\n\t\tresult = result.normalize('NFD');\n\n\treturn result\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.trim()\n\t\t.toLowerCase()\n\t\t.replace(/[^a-z0-9 ]/g, '')\n\t\t.replace(/\\s+/g, separator);\n}\n\nString.prototype.toSnakeCase = function(this: string) {\n\tlet result = this;\n\tif (result.normalize)\n\t\tresult = result.normalize('NFD');\n\n\treturn result\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.trim()\n\t\t.replace(SNAKE_CAPS, '$1_$2')\n\t\t.replace(SNAKE_SPACE, '_')\n\t\t.replace(SNAKE_TRIM, '')\n\t\t.toLowerCase();\n}\n\n\nexport type ListenerReturnType = void | typeof Detach | typeof StopPropagation | Promise<void>;\n\nexport type EventListener<TArgs extends any[] = any[]> = (...args: TArgs) => ListenerReturnType;\n\nexport type ListenerInfo<TArgs extends any[] = any[]> = [\n\tlistener: EventListener<TArgs>,\n\tcontext: any,\n\tttl: number | false,\n\tpriority: number,\n\tprepend: boolean\n];\n\nexport interface EventMap {\n\t[event: string]: any[];\n};\n\nexport type EventKey<TEvent extends EventMap> = string & keyof TEvent;\n\nexport type AddEventKeyNamespace<\n\tTNamespace extends string,\n\tTKey extends string\n> = TKey extends `:${infer Rest}`\n\t? `${TNamespace}${TKey}`\n\t: TKey;\n\nexport type RemoveEventKeyNamespace<\n\tTNamespace extends string,\n\tTKey extends string\n> = TKey extends `${TNamespace}:${infer Rest}`\n\t? `:${Rest}`\n\t: TKey;\n\n\nexport type NamespacedEvents<TNamespace extends string, TEventMap extends EventMap> = {\n\t[K in keyof TEventMap & string as AddEventKeyNamespace<TNamespace, K>]: TEventMap[K]\n};\n\nexport type NamespacedEventKey<TNamespace extends string, TEventMap extends EventMap> =\n\tstring & keyof TEventMap | RemoveEventKeyNamespace<TNamespace, string & keyof TEventMap>;\n\n\nexport type NamespacedEventArgs<\n\tTKey extends string,\n\tTNamespace extends string,\n\tTEventMap extends EventMap\n> = TKey extends keyof TEventMap\n\t? TEventMap[TKey]\n\t: AddEventKeyNamespace<TNamespace, TKey> extends keyof TEventMap\n\t\t? TEventMap[AddEventKeyNamespace<TNamespace, TKey>]\n\t\t: never;\n\n\n/**\n * A custom event emitter implementation with support for priorities,\n * event listeners that only receive a certain number of events,\n * event listeners that can remove themselves by returning a special\n * symbol, and other useful behaviors.\n *\n * You'll likely not be using this class directly, instead relying\n * on {@link Module}s directly. Modules are subclasses of\n * {@link HierarchicalEventEmitter} which itself is a subclass of\n * this {@link EventEmitter}.\n */\nexport class EventEmitter<\n\tTEventMap extends EventMap = {},\n\tTNamespace extends string = ''\n> {\n\n\tstatic Detach = Detach;\n\tstatic StopPropagation = StopPropagation;\n\n\t/** @private */\n\tprotected __listeners: Record<string, ListenerInfo[] | null>;\n\tprotected __running: Set<string>;\n\tprivate __dead_events: number;\n\n\tconstructor() {\n\t\tthis.__listeners = {};\n\t\tthis.__running = new Set;\n\t\tthis.__dead_events = 0;\n\t}\n\n\tprotected __cleanListeners() {\n\t\tif ( ! this.__dead_events )\n\t\t\treturn [];\n\n\t\tconst new_listeners: Record<string, ListenerInfo[]> = {},\n\t\t\told_listeners = this.__listeners,\n\t\t\tremoved: string[] = [];\n\n\t\tfor(const [key, val] of Object.entries(old_listeners)) {\n\t\t\tif ( val?.length )\n\t\t\t\tnew_listeners[key] = val;\n\t\t\telse\n\t\t\t\tremoved.push(key);\n\t\t}\n\n\t\tthis.__listeners = new_listeners;\n\t\tthis.__dead_events = 0;\n\t\treturn removed;\n\t}\n\n\tprivate __sortListeners(event: string) {\n\t\t// Don't bother sorting while an event is running, since\n\t\t// we'll need to sort it at the end when the lists are\n\t\t// recombined.\n\t\tif ( this.__running.has(event) )\n\t\t\treturn;\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list )\n\t\t\tlist.sort((a, b) => a[3] - b[3]);\n\t}\n\n\n\t/**\n\t * Transfer all the event listeners from this EventEmitter to another\n\t * EventEmitter instance, removing them from this EventEmitter in\n\t * the process.\n\t *\n\t * @param other The EventEmitter to transfer our listeners to.\n\t */\n\ttransferListeners(other: EventEmitter<TEventMap, TNamespace>) {\n\t\tif ( !(other instanceof EventEmitter) )\n\t\t\tthrow new Error('other must also be EventEmitter');\n\n\t\t// If the existing listener has no live topics, we can just go ahead\n\t\t// and copy the listeners object directly.\n\t\tconst live_topics = other.events().length + other.__running.size;\n\t\tif ( ! live_topics ) {\n\t\t\tother.__listeners = this.__listeners;\n\t\t\tother.__dead_events = this.__dead_events;\n\t\t\tthis.__listeners = {};\n\t\t\tthis.__dead_events = 0;\n\t\t\treturn;\n\t\t}\n\n\t\t// Unfortuantely, since we got here, we'll need to do things the\n\t\t// old fashioned way.\n\t\tfor(const [key, val] of Object.entries(this.__listeners)) {\n\t\t\tif ( ! val || ! val.length )\n\t\t\t\tcontinue;\n\n\t\t\tlet other_val = other.__listeners[key];\n\t\t\tif ( Array.isArray(other_val) ) {\n\t\t\t\tother_val.push(...val);\n\t\t\t\tother.__sortListeners(key);\n\n\t\t\t} else\n\t\t\t\tother.__listeners[key] = val;\n\t\t}\n\n\t\t// Reset our state before we leave.\n\t\tthis.__listeners = {};\n\t\tthis.__dead_events = 0;\n\t}\n\n\n\t// ========================================================================\n\t// Public Methods\n\t// ========================================================================\n\n\t/**\n\t * Create a new {@link FFZEvent} instance. This is a convenience method that\n\t * wraps {@link FFZEvent.makeEvent}\n\t */\n\tmakeEvent<TData extends Record<string, any> = {}>(data: TData): TypedFFZEvent<TData> {\n\t\treturn FFZEvent.makeEvent(data);\n\t}\n\n\t/**\n\t * Create a new {@link FFZWaitableEvent} instance. This is a convenience\n\t * method that wraps {@link FFZWaitableEvent.makeEvent}\n\t */\n\tmakeWaitableEvent<TData extends Record<string, any> = {}, TReturn = void>(data: TData): TypedFFZWaitableEvent<TData, TReturn> {\n\t\treturn FFZWaitableEvent.makeEvent(data);\n\t}\n\n\t/**\n\t * Register an event listener for a given event.\n\t *\n\t * @param event The event to listen for.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\ton<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tif ( typeof fn !== 'function' )\n\t\t\tthrow new TypeError('fn must be a function');\n\n\t\tconst info: ListenerInfo = [\n\t\t\tfn as EventListener,\n\t\t\tctx,\n\t\t\tfalse,\n\t\t\tpriority ?? 0,\n\t\t\tprepend\n\t\t];\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list ) {\n\t\t\tif ( prepend )\n\t\t\t\tlist.unshift(info);\n\t\t\telse\n\t\t\t\tlist.push(info);\n\t\t\tthis.__sortListeners(event);\n\t\t} else\n\t\t\tthis.__listeners[event] = [info];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Register an event listener for a given event that will only fire\n\t * once before being automatically removed.\n\t *\n\t * @see {@link many}\n\t *\n\t * @param event The event to listen for.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\tonce<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn this.many(event, 1, fn, ctx, priority, prepend);\n\t}\n\n\t/**\n\t * Register an event listener for a given event that will only fire\n\t * a specific number of times before being automatically removed.\n\t *\n\t * @param event The event to listen for.\n\t * @param ttl The number of times the listener should fire.\n\t * @param fn The event listener function.\n\t * @param ctx A context (aka `this`) to call the function with.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t */\n\tmany<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\tif ( typeof fn !== 'function' )\n\t\t\tthrow new TypeError('fn must be a function');\n\n\t\tif ( typeof ttl !== 'number' || isNaN(ttl) || ! isFinite(ttl) || ttl < 1 )\n\t\t\tthrow new TypeError('ttl must be a positive, finite number');\n\n\t\tconst info: ListenerInfo = [\n\t\t\tfn as EventListener,\n\t\t\tctx,\n\t\t\tttl,\n\t\t\tpriority ?? 0,\n\t\t\tprepend\n\t\t];\n\n\t\tconst list = this.__listeners[event];\n\t\tif ( list ) {\n\t\t\tif ( prepend )\n\t\t\t\tlist.unshift(info);\n\t\t\telse\n\t\t\t\tlist.push(info);\n\t\t\tthis.__sortListeners(event);\n\t\t} else\n\t\t\tthis.__listeners[event] = [info];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Wait for the given event to fire and return its value.\n\t *\n\t * Internally, this works by registering a temporary event listener\n\t * with a `ttl` of `1` that, when called, calls the `resolve` method\n\t * of the promise returned by this function.\n\t *\n\t * @param event The event to listen for.\n\t * @param ctx A context (aka `this`) to associate this with. While the\n\t * context is not used for calling any functions, it's used to track the\n\t * source of this event listener so that it can be removed easily by\n\t * context if necessary.\n\t * @param priority The priority of the event listener. Default is 0.\n\t * @param prepend Whether the listener should be added to the start of the\n\t * list or the end, as a less direct method of establishing priority.\n\t * @returns A {@link Promise} that resolves with the first event of\n\t * this type to fire.\n\t */\n\twaitFor<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn new Promise<NamespacedEventArgs<K, TNamespace, TEventMap>>(resolve => {\n\t\t\tconst info: ListenerInfo = [\n\t\t\t\t((...args: NamespacedEventArgs<K, TNamespace, TEventMap>) => resolve(args)) as EventListener,\n\t\t\t\tctx,\n\t\t\t\t1,\n\t\t\t\tpriority ?? 0,\n\t\t\t\tprepend\n\t\t\t];\n\n\t\t\tconst list = this.__listeners[event];\n\t\t\tif ( list ) {\n\t\t\t\tif ( prepend )\n\t\t\t\t\tlist.unshift(info);\n\t\t\t\telse\n\t\t\t\t\tlist.push(info);\n\t\t\t\tthis.__sortListeners(event);\n\t\t\t} else\n\t\t\t\tthis.__listeners[event] = [info];\n\t\t});\n\t}\n\n\t/**\n\t * Remove one or more event listeners, across one or more events.\n\t * You must provide at least one of `event`, `fn`, and `ctx`. All\n\t * event listeners that match your provided criteria will be removed.\n\t *\n\t * This can be used to remove all event listeners for a given event\n\t * or to remove all event listeners registered by a given context,\n\t * in addition to the obvious ability to remove a specific\n\t * event listener.\n\t *\n\t * @param event Optional. The event to remove listener(s) of.\n\t * @param fn Optional. The event listener function to remove.\n\t * @param ctx Optional. The context to remove listeners of.\n\t */\n\toff<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent?: K,\n\t\tfn?: EventListener,\n\t\tctx?: any\n\t) {\n\t\tif ( event == null ) {\n\t\t\tif ( ! fn && ! ctx )\n\t\t\t\tthrow new Error('you must provide at least one constraint when removing listeners');\n\n\t\t\tfor(const evt in Object.keys(this.__listeners)) {\n\t\t\t\tif ( ! this.__running.has(evt) )\n\t\t\t\t\tthis.off(evt as any, fn, ctx);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif ( this.__running.has(event) )\n\t\t\tthrow new Error(`concurrent modification: tried removing event listener while event is running`);\n\n\t\tlet list = this.__listeners[event];\n\t\tif ( ! list )\n\t\t\treturn this;\n\n\t\t// If fn and ctx were both not provided, then clear the list.\n\t\tif ( ! fn && ! ctx )\n\t\t\tlist = null;\n\t\telse {\n\t\t\t// Remove any entries from the list where:\n\t\t\t// 1. fn and ctx both match if both were provided\n\t\t\t// 2. fn matches if only fn was provided\n\t\t\t// 3. ctx matches if only ctx was provided\n\t\t\tlist = list.filter(([f, c]) => !((! fn || f === fn) && (!ctx || ctx === c)));\n\t\t\tif ( ! list.length )\n\t\t\t\tlist = null;\n\t\t}\n\n\t\tthis.__listeners[event] = list;\n\n\t\t// We don't use delete since that triggers performance issues\n\t\t// when used on objects. Instead, we record that we have a\n\t\t// dead event so we can clean it up later.\n\t\tif ( ! list )\n\t\t\tthis.__dead_events++;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Remove all event listeners registered by a specific context.\n\t * This can now be handled by calling {@link off} directly and\n\t * it should be avoided.\n\t * @deprecated\n\t */\n\toffContext<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K, ctx?: any) {\n\t\treturn this.off(event, undefined, ctx);\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t */\n\tevents() {\n\t\tthis.__cleanListeners();\n\t\treturn Object.keys(this.__listeners);\n\t}\n\n\t/**\n\t * Return a list of all listeners for a given event. This\n\t * includes metadata including the listener's `ttl`.\n\t * @param event\n\t * @returns\n\t */\n\tlisteners<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K)\n\t: ListenerInfo<NamespacedEventArgs<K, TNamespace, TEventMap>> {\n\t\tconst list = this.__listeners[event];\n\t\treturn list ? Array.from(list) as any : [];\n\t}\n\n\t/**\n\t * Determine whether there are currently any listeners for\n\t * the specified event. */\n\thasListeners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn !! this.__listeners[event]\n\t}\n\n\t/**\n\t * Emit an event to all its listeners.\n\t *\n\t * This will call each listener of an event in order, and it handles\n\t * event listener lifetimes with `ttl` and `Detach`. It also supports\n\t * the `StopPropagation` return value or, if the event data is an\n\t * instance of {@link FFZEvent}, the {@link FFZEvent.propagationStopped}\n\t * property.\n\t *\n\t * If the event data is an instance of {@link FFZWaitableEvent} and\n\t * the event listener returns a {@link Promise}, that {@link Promise}\n\t * will automatically be waited for with {@link FFZWaitableEvent.waitFor}.\n\t *\n\t * @param event The event to emit.\n\t * @param data The data for the event. This will vary depending on\n\t * the event being emitted.\n\t */\n\temit<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\t...data: NamespacedEventArgs<K, TNamespace, TEventMap>\n\t) {\n\t\tlet list = this.__listeners[event];\n\t\tif ( ! list )\n\t\t\treturn;\n\n\t\tif ( this.__running.has(event) )\n\t\t\tthrow new Error(`concurrent access: tried to emit event while event is running`);\n\n\t\t// Track removals separately to make iteration over the event list\n\t\t// much, much simpler.\n\t\tconst removed = new Set<ListenerInfo>;\n\n\t\t// Set the current list of listeners to null because we don't want\n\t\t// to enter some kind of loop if a new listener is added as the result\n\t\t// of an existing listener.\n\t\tthis.__listeners[event] = null;\n\t\tthis.__running.add(event);\n\n\t\tfor(const item of list) {\n\t\t\tconst [fn, ctx, ttl] = item;\n\t\t\tlet ret: ListenerReturnType = undefined;\n\t\t\ttry {\n\t\t\t\tret = fn.apply(ctx, data);\n\t\t\t} catch(err) {\n\t\t\t\t// Abusing as any so we can have log as a getter/setter\n\t\t\t\t// on Module without complaint.\n\t\t\t\tif ( (this as any).log ) {\n\t\t\t\t\t(this as any).log.capture(err, {tags: {event}, extra:{args: data}});\n\t\t\t\t\t(this as any).log.error(err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ret === Detach )\n\t\t\t\tremoved.add(item);\n\t\t\telse if ( ttl !== false ) {\n\t\t\t\tif ( ttl <= 1 )\n\t\t\t\t\tremoved.add(item);\n\t\t\t\telse\n\t\t\t\t\titem[2] = ttl - 1;\n\t\t\t}\n\n\t\t\t// Automatically wait for a promise, if the return value is a promise\n\t\t\t// and we're dealing with a waitable event.\n\t\t\tif ( ret instanceof Promise ) {\n\t\t\t\tif ( (data[0] instanceof FFZWaitableEvent) )\n\t\t\t\t\tdata[0].waitFor(ret);\n\t\t\t}\n\n\t\t\tif ( (data[0] instanceof FFZEvent && data[0].propagationStopped) || ret === StopPropagation )\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Remove any dead listeners from the list.\n\t\tif ( removed.size ) {\n\t\t\tfor(const item of removed) {\n\t\t\t\tconst idx = list.indexOf(item);\n\t\t\t\tif ( idx !== -1 )\n\t\t\t\t\tlist.splice(idx, 1);\n\t\t\t}\n\t\t}\n\n\t\tlet need_sort = false;\n\n\t\t// Were more listeners added while we were running? Just combine\n\t\t// the two lists if so.\n\t\tconst new_items = this.__listeners[event];\n\t\tif ( new_items ) {\n\t\t\tlist = list.concat(new_items);\n\t\t\tneed_sort = true;\n\t\t}\n\n\t\t// If we have items, store the list back. Otherwise, mark that we\n\t\t// have a dead listener.\n\t\tif ( list.length )\n\t\t\tthis.__listeners[event] = list;\n\t\telse {\n\t\t\tthis.__listeners[event] = null;\n\t\t\tthis.__dead_events++;\n\t\t}\n\n\t\tthis.__running.delete(event);\n\n\t\t// Finally, now that running is off, sort our listeners if we\n\t\t// have need.\n\t\tif ( need_sort )\n\t\t\tthis.__sortListeners(event);\n\t}\n\n}\n\n\n/**\n * FFZEvent is a convenience class for use when emitting events when you would\n * like to potentially receive feedback from event listeners. The event\n * object may be changed by event listeners, with the emitter checking the\n * event object for changes once the event is done.\n *\n * This also includes support for the standard {@link Event} interfaces of\n * {@link stopPropagation} and {@link preventDefault}.\n *\n * @param TData The custom data type the event should be constructed with.\n */\nexport class FFZEvent<TData> {\n\n\t/**\n\t * Create a new {@link FFZEvent} with proper type inheritence from the\n\t * supplied data. This should always be used to construct an event\n\t * instance, rather than creating the event manually.\n\t */\n\tstatic makeEvent<TData extends Record<string, any> = {}>(data: TData): TypedFFZEvent<TData> {\n\t\treturn new FFZEvent(data) as TypedFFZEvent<TData>;\n\t}\n\n\t/** Whether or not {@link preventDefault} has been called. */\n\tdefaultPrevented: boolean;\n\t/** Whether or not {@link stopPropagation} has been called. */\n\tpropagationStopped: boolean;\n\n\t/** Create a new FFZEvent instance with the provided data. */\n\tconstructor(data: TData) {\n\t\tthis.defaultPrevented = false;\n\t\tthis.propagationStopped = false;\n\n\t\tObject.assign(this, data);\n\t}\n\n\t/**\n\t * Intended for emitter use only.\n\t *\n\t * Reset this FFZEvent instance. This does not reset custom data,\n\t * but only returns {@link defaultPrevented} and {@link propagationStopped}\n\t * to their original values.\n\t *\n\t * Subclasses of FFZEvent may override this method to extend\n\t * its behavior.\n\t */\n\t_reset() {\n\t\tthis.defaultPrevented = false;\n\t\tthis.propagationStopped = false;\n\t}\n\n\t/**\n\t * Stop the propagation of this event, ensuring that no further\n\t * event listeners receive it.\n\t */\n\tstopPropagation() {\n\t\tthis.propagationStopped = true;\n\t}\n\n\t/**\n\t * Prevent whatever default behavior is associated with this event.\n\t */\n\tpreventDefault() {\n\t\tthis.defaultPrevented = true;\n\t}\n}\n\n/**\n * TypedFFZEvent is a convenience type returned by {@link FFZEvent.makeEvent}\n * so that custom data passed to the event can be accessed in a\n * type safe way.\n */\nexport type TypedFFZEvent<TData> = FFZEvent<TData> & {\n\t[K in keyof TData]: TData[K];\n}\n\n/**\n * TypedFFZWaitableEvent is a convenience type returned by {@link FFZWaitableEvent.makeEvent}\n * so that custom data passed to the event can be accessed in a\n * type safe way.\n */\nexport type TypedFFZWaitableEvent<TData, TReturn = void> = FFZWaitableEvent<TData, TReturn> & {\n\t[K in keyof TData]: TData[K];\n}\n\n/**\n * FFZWaitableEvent is a subclass of FFZEvent that adds a system for supporting\n * asynchronous return values.\n *\n * Event listeners may return a {@link Promise} or call {@link waitFor} directly\n * to register their promises, and the emitter is then responsible for calling\n * the {@link _wait} method after the event has been emitted.\n *\n * @param TData The custom data type the event should be constructed with.\n * @param TReturn The expected return type of {@link Promise}s used with\n * {@link waitFor} or by listeners returning {@link Promise}s.\n */\nexport class FFZWaitableEvent<TData, TReturn = void> extends FFZEvent<TData> {\n\n\t/**\n\t * Create a new {@link FFZWaitableEvent} with proper type inheritence from the\n\t * supplied data. This should always be used to construct an event\n\t * instance, rather than creating the event manually.\n\t */\n\tstatic makeEvent<TData extends Record<string, any> = {}, TReturn = void>(data: TData): TypedFFZWaitableEvent<TData, TReturn> {\n\t\treturn new FFZWaitableEvent<TData, TReturn>(data) as TypedFFZWaitableEvent<TData, TReturn>;\n\t}\n\n\tprivate __waiter?: Promise<Awaited<TReturn>[]> | null;\n\tprivate __waiter_results: Awaited<TReturn>[] | null = null;\n\tprivate __promises?: Promise<TReturn>[] | null;\n\n\t/**\n\t * Intended for emitter use only.\n\t *\n\t * Wait for all registered {@link Promise}s to return.\n\t *\n\t * @returns\n\t */\n\t_wait(): Promise<Awaited<TReturn>[]> | null {\n\t\t// If we're already waiting, keep on waiting.\n\t\tif ( this.__waiter )\n\t\t\treturn this.__waiter;\n\n\t\t// If we have no promises, just return\n\t\t// any pending results.\n\t\tif ( ! this.__promises ) {\n\t\t\tconst out = this.__waiter_results;\n\t\t\tthis.__waiter_results = null;\n\n\t\t\t// Make sure to return the results as a promise.\n\t\t\treturn out ? Promise.resolve(out) : null;\n\t\t}\n\n\t\t// We had promises, so we need to wait some more.\n\t\tconst promises = this.__promises;\n\t\tthis.__promises = null;\n\n\t\treturn this.__waiter = Promise.all(promises).then(results => {\n\t\t\t// Store the results for later return.\n\t\t\tif ( this.__waiter_results )\n\t\t\t\tthis.__waiter_results.push(...results);\n\t\t\telse\n\t\t\t\tthis.__waiter_results = results;\n\n\t\t\t// Now call _wait() again.\n\t\t\tthis.__waiter = null;\n\t\t\treturn this._wait() ?? [];\n\n\t\t}).catch(err => {\n\t\t\t// But if there was an error, oh no.\n\t\t\tthis.__waiter = null;\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\t/**\n\t * Reset the FFZWaitableEvent instance. In addition to calling\n\t * the super method {@link FFZEvent._reset}, this also clears\n\t * the Promise-related data stored on the event.\n\t */\n\t_reset() {\n\t\tsuper._reset();\n\t\tthis.__waiter = null;\n\t\tthis.__waiter_results = null;\n\t\tthis.__promises = null;\n\t}\n\n\t/**\n\t * Wait for a {@link Promise} to complete before considering the event\n\t * as completed.\n\t *\n\t * Event listeners should either call this method with their Promise\n\t * if performing asynchronous work, or else return the Promise directly\n\t * from their event listener.\n\t *\n\t * @param promise The Promise to wait for.\n\t */\n\twaitFor(promise: Promise<TReturn>) {\n\t\tif ( ! this.__promises )\n\t\t\tthis.__promises = [promise];\n\t\telse\n\t\t\tthis.__promises.push(promise);\n\t}\n\n}\n\n\n/**\n * HierarchicalEventEmitter is a subclass of {@link EventEmitter} that allows\n * you to create a tree of event emitters that all share the same pool of\n * event listeners.\n *\n * This is useful because the event emitter can then emit events using\n * a simplified name while other emitters can listen to that event using\n * its full name.\n *\n * For example, an emitter with the path `chat.emotes` could call {@link emit}\n * with the event key `:update-default-sets` while other emitters would then\n * have access to listen to that event with the full key\n * `chat.emotes:update-default-sets`.\n *\n * This behavior powers the {@link Module} system.\n */\nexport class HierarchicalEventEmitter<\n\tTNamespace extends string,\n\tTEventMap extends EventMap = {}\n> extends EventEmitter<TEventMap, TNamespace> {\n\t/** The local name of this event emitter, not including the names of its parents. */\n\tname: string;\n\n\t/** @private */\n\tprotected __path?: string;\n\tprivate __path_parts: string[];\n\n\t/** The parent of this event emitter, if it has one. */\n\tparent?: HierarchicalEventEmitter<any, any>;\n\t/** The root event emitter. */\n\troot: HierarchicalEventEmitter<any, any>;\n\n\tconstructor(name?: string, parent?: HierarchicalEventEmitter<any, any>) {\n\t\tsuper();\n\n\t\tthis.name = name || (this.constructor.name || '').toSnakeCase();\n\t\tthis.parent = parent;\n\n\t\tif ( parent ) {\n\t\t\tthis.root = parent.root;\n\t\t\tthis.__listeners = parent.__listeners;\n\t\t\tthis.__running = parent.__running;\n\t\t\tthis.__path = name && parent.__path ? `${parent.__path}.${name}` : name;\n\n\t\t} else {\n\t\t\tthis.root = this as any;\n\t\t\tthis.__path = undefined;\n\t\t}\n\n\t\tthis.__path_parts = this.__path ? this.__path.split('.') : [];\n\t}\n\n\n\t// ========================================================================\n\t// Public Properties\n\t// ========================================================================\n\n\t/**\n\t * The full path of this event emitter, including not just its own name\n\t * but its ancestors' names as well, separated by periods.\n\t */\n\tget path(): TNamespace {\n\t\treturn this.__path as TNamespace;\n\t}\n\n\n\t// ========================================================================\n\t// Public Methods\n\t// ========================================================================\n\n\ttransferListeners(other: EventEmitter<TEventMap, TNamespace>): void {\n\t\tif ( other instanceof HierarchicalEventEmitter && other.root === this.root )\n\t\t\treturn;\n\n\t\tthrow new Error('Transfering listeners from a HierarchicalEventEmitter is not supported.');\n\t}\n\n\t/**\n\t * Take an event path and convert it to an absolute path. For example,\n\t * if this emitter's path is `chat.emotes` and you call this with the\n\t * path `:update-default-sets` it will return `chat.emotes:update-default-sets`.\n\t *\n\t * You can also traverse to specific parents by using periods (`.`) at the\n\t * start of the path. A single period (`.`) is equal to the current emitter's\n\t * path, while each additional period moves up by one ancestor. For example,\n\t * to get this emitter's parent, you could use `..`. This can be combined\n\t * with other strings to access siblings, as well as events on ancestors\n\t * or siblings.\n\t *\n\t * For example, if this emitter's path is `chat.emotes` and you call this\n\t * with the path `..:update-line-tokens` it will return `chat:update-line-tokens`.\n\t *\n\t * As another example, assuming the same emitter path and you call this with\n\t * the path `..emoji:populated` it will return `chat.emoji:populated`.\n\t *\n\t * @param path The path to resolve.\n\t * @returns The resolved path.\n\t */\n\tabs_path(path: string): string {\n\t\tif ( typeof path !== 'string' || ! path.length )\n\t\t\tthrow new TypeError('path must be a non-empty string');\n\n\t\tlet i = 0, chr;\n\t\tconst parts = this.__path_parts,\n\t\t\tdepth = parts.length;\n\n\t\tdo {\n\t\t\tchr = path.charAt(i);\n\t\t\tif ( path.charAt(i) === '.' ) {\n\t\t\t\tif ( i > depth )\n\t\t\t\t\tthrow new Error('invalid path: reached top of stack');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbreak;\n\t\t} while ( ++i < path.length );\n\n\t\tconst event = chr === ':';\n\t\tif ( i === 0 )\n\t\t\treturn event && this.__path ? `${this.__path}${path}` : path;\n\n\t\tconst prefix = parts.slice(0, depth - (i-1)).join('.'),\n\t\t\tremain = path.slice(i);\n\n\t\tif ( ! prefix.length )\n\t\t\treturn remain;\n\n\t\telse if ( ! remain.length )\n\t\t\treturn prefix;\n\n\t\telse if ( event )\n\t\t\treturn prefix + remain;\n\n\t\treturn `${prefix}.${remain}`;\n\t}\n\n\ton<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.on(this.abs_path(event) as K, fn, ctx, priority, prepend);\n\t}\n\n\tonce<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.once(this.abs_path(event) as K, fn, ctx, priority, prepend);\n\t}\n\n\tmany<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TEventMap>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.many(this.abs_path(event) as K, ttl, fn, ctx, priority, prepend);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.waitFor<K>(this.abs_path(event) as K, ctx, priority, prepend);\n\t}\n\n\toff<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent?: K, fn?: EventListener, ctx?: any\n\t) {\n\t\treturn super.off(event && this.abs_path(event) as K, fn, ctx);\n\t}\n\n\tlisteners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn super.listeners(this.abs_path(event) as K);\n\t}\n\n\thasListeners<K extends NamespacedEventKey<TNamespace, TEventMap>>(event: K) {\n\t\treturn super.hasListeners(this.abs_path(event) as K);\n\t}\n\n\temit<K extends NamespacedEventKey<TNamespace, TEventMap>>(\n\t\tevent: K,\n\t\t...args: NamespacedEventArgs<K, TNamespace, TEventMap>\n\t) {\n\t\treturn super.emit(this.abs_path(event) as K, ...args);\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t * This will only return events owned by this emitter, or by\n\t * descendents of this emitter.\n\t */\n\teventsWithChildren() {\n\t\tconst keys = super.events(),\n\t\t\tpath = this.__path || '',\n\t\t\tlen = path.length;\n\n\t\treturn keys.filter(x => {\n\t\t\tconst y = x.charAt(len);\n\t\t\treturn x.startsWith(path) && (y === '' || y === '.' || y === ':');\n\t\t});\n\t}\n\n\t/**\n\t * Return a list of all event keys with at least one listener.\n\t * This will not return any events owned by other emitters.\n\t */\n\tevents() {\n\t\tconst keys = super.events(),\n\t\t\tpath = this.__path || '',\n\t\t\tlen = path.length;\n\n\t\treturn keys.filter(x => {\n\t\t\tconst y = x.charAt(len);\n\t\t\treturn x.startsWith(path) && (y === '' || y === ':');\n\t\t});\n\t}\n}\n\nexport default HierarchicalEventEmitter;\n","'use strict';\n\nimport type { OptionalPromise, OptionallyCallable } from \"./types\";\n\n// ============================================================================\n// Advanced Filter System\n// ============================================================================\n\ntype FilterMethod<TContext = unknown> = (ctx: TContext) => boolean;\n\nexport type FilterType<TConfig, TContext> = {\n\tcreateTest: (config: TConfig, filter_types: FilterTypeMap<TContext>, rebuild?: () => void) => FilterMethod<TContext>\n\n\tdefault: OptionallyCallable<[], TConfig>;\n\n\t// Editor Configuration\n\teditor?: OptionallyCallable<[], OptionalPromise<any>>;\n\n\ttitle: string;\n\ti18n?: string | null;\n\ttall?: boolean;\n\n\tmaxRules?: number;\n\tchildRules?: boolean;\n\n\n}\n\ntype FilterTypeMap<TContext> = {\n\t[key: string]: FilterType<any, TContext>;\n};\n\n\nexport type FilterData = {\n\tid?: string;\n\ttype: string;\n\tdata: any;\n}\n\n\nexport function createTester<TContext, Types extends FilterTypeMap<TContext>>(\n\trules: FilterData[] | null | undefined,\n\tfilter_types: Types,\n\tinverted: boolean = false,\n\tor: boolean = false,\n\trebuild?: () => void\n): (ctx: TContext) => boolean {\n\n\tif ( ! Array.isArray(rules) || ! filter_types )\n\t\treturn inverted ? () => false : () => true;\n\n\tconst tests: FilterMethod<TContext>[] = [],\n\t\tnames = [];\n\n\tlet i = 0;\n\tfor(const rule of rules) {\n\t\tif ( ! rule || ! rule.type )\n\t\t\tcontinue;\n\n\t\tconst type = filter_types[rule.type];\n\t\tif ( ! type ) {\n\t\t\t// Default to false if we cannot find a rule type.\n\t\t\t// Just to be safe.\n\t\t\ti++;\n\t\t\ttests.push(() => false);\n\t\t\tnames.push(`f${i}`);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Construct the test. If no test is returned, we skip this filter.\n\t\t// This can happen depending on configuration rendering a method\n\t\t// pointless.\n\t\tconst test = type.createTest(rule.data, filter_types, rebuild);\n\t\tif ( ! test )\n\t\t\tcontinue;\n\n\t\ti++;\n\t\ttests.push(test);\n\t\tnames.push(`f${i}`);\n\t}\n\n\tif ( ! tests.length )\n\t\treturn inverted ? () => false : () => true;\n\n\tif ( tests.length === 1 )\n\t\treturn inverted ? (ctx: TContext) => ! tests[0](ctx) : tests[0];\n\n\treturn new Function(...names, 'ctx',\n\t\t`return ${inverted ? `!(` : ''}${names.map(name => `${name}(ctx)`).join(or ? ' || ' : ' && ')}${inverted ? ')' : ''};`\n\t).bind(null, ...tests);\n}\n","export default __webpack_public_path__ + \"font-awesome.css\";","'use strict';\n\nimport {createElement} from 'utilities/dom';\n\n// ============================================================================\n// Font Awesome Data\n// ============================================================================\n\n/**\n * A map of aliases for FontAwesome icons. This is used to allow for slightly\n * less annoying search behavior in UIs. These names are all raw icon names\n * and not suitable for direct use.\n */\nexport const ALIASES = {\n\t'ban': ['ban', 'block'],\n\t'ok': ['ok', 'unban', 'untimeout'],\n\t'clock-o': ['clock-o', 'clock', 'timeout'],\n\t'times': ['remove','close','times'],\n\t'cog': ['gear','cog'],\n\t'repeat': ['rotate-right','repeat'],\n\t'outdent': ['dedent','outdent'],\n\t'picture-o': ['photo','image','picture-o'],\n\t'pencil-square-o': ['edit','pencil-square-o'],\n\t'share': ['mail-forward','share'],\n\t'exclamation-triangle': ['warning','exclamation-triangle'],\n\t'bar-chart': ['bar-chart-o','bar-chart'],\n\t'cogs': ['gears','cogs'],\n\t'facebook': ['facebook-f','facebook'],\n\t'rss': ['feed','rss'],\n\t'users': ['group','users'],\n\t'link': ['chain','link'],\n\t'scissors': ['cut','scissors'],\n\t'files-o': ['copy','files-o'],\n\t'floppy-o': ['save','floppy-o'],\n\t'bars': ['navicon','reorder','bars'],\n\t'sort': ['unsorted','sort'],\n\t'sort-desc': ['sort-down','sort-desc'],\n\t'sort-asc': ['sort-up','sort-asc'],\n\t'undo': ['rotate-left','undo'],\n\t'gavel': ['legal','gavel'],\n\t'tachometer': ['dashboard','tachometer'],\n\t'bolt': ['flash','bolt'],\n\t'clipboard': ['paste','clipboard'],\n\t'mobile': ['mobile-phone','mobile'],\n\t'reply': ['mail-reply','reply'],\n\t'reply-all': ['mail-reply-all','reply-all'],\n\t'star-half-o': ['star-half-empty','star-half-full','star-half-o'],\n\t'chain-broken': ['unlink','chain-broken'],\n\t'caret-square-o-down': ['toggle-down','caret-square-o-down'],\n\t'caret-square-o-up': ['toggle-up','caret-square-o-up'],\n\t'caret-square-o-right': ['toggle-right','caret-square-o-right'],\n\t'eur': ['euro','eur'],\n\t'usd': ['dollar','usd'],\n\t'inr': ['rupee','inr'],\n\t'jpy': ['cny','rmb','yen','jpy'],\n\t'rub': ['ruble','rouble','rub'],\n\t'krw': ['won','krw'],\n\t'btc': ['bitcoin','btc'],\n\t'gratipay': ['gittip','gratipay'],\n\t'caret-square-o-left': ['toggle-left','caret-square-o-left'],\n\t'try': ['turkish-lira','try'],\n\t'university': ['institution','bank','university'],\n\t'graduation-cap': ['mortar-board','graduation-cap'],\n\t'car': ['automobile','car'],\n\t'taxi': ['cab','taxi'],\n\t'file-image-o': ['file-photo-o','file-picture-o','file-image-o'],\n\t'file-archive-o': ['file-zip-o','file-archive-o'],\n\t'file-audio-o': ['file-sound-o','file-audio-o'],\n\t'file-video-o': ['file-movie-o','file-video-o'],\n\t'life-ring': ['life-bouy','life-buoy','life-saver','support','life-ring'],\n\t'rebel': ['ra','resistance','rebel'],\n\t'empire': ['ge','empire'],\n\t'hacker-news': ['y-combinator-square','yc-square','hacker-news'],\n\t'weixin': ['wechat','weixin'],\n\t'paper-plane': ['send','paper-plane'],\n\t'paper-plane-o': ['send-o','paper-plane-o'],\n\t'futbol-o': ['soccer-ball-o','futbol-o'],\n\t'ils': ['shekel','sheqel','ils'],\n\t'transgender': ['intersex','transgender'],\n\t'bed': ['hotel','bed'],\n\t'y-combinator': ['yc','y-combinator'],\n\t'battery-full': ['battery-4','battery','battery-full'],\n\t'battery-three-quarters': ['battery-3','battery-three-quarters'],\n\t'battery-half': ['battery-2','battery-half'],\n\t'battery-quarter': ['battery-1','battery-quarter'],\n\t'battery-empty': ['battery-0','battery-empty'],\n\t'hourglass-start': ['hourglass-1','hourglass-start'],\n\t'hourglass-half': ['hourglass-2','hourglass-half'],\n\t'hourglass-end': ['hourglass-3','hourglass-end'],\n\t'hand-rock-o': ['hand-grab-o','hand-rock-o'],\n\t'hand-paper-o': ['hand-stop-o','hand-paper-o'],\n\t'television': ['tv','television'],\n\t'american-sign-language-interpreting': ['asl-interpreting','american-sign-language-interpreting'],\n\t'deaf': ['deafness','hard-of-hearing','deaf'],\n\t'sign-language': ['signing','sign-language'],\n\t'google-plus-official': ['google-plus-circle','google-plus-official'],\n\t'font-awesome': ['fa','font-awesome'],\n\t'address-card': ['vcard','address-card'],\n\t'address-card-o': ['vcard-o','address-card-o'],\n\t'id-card': ['drivers-license','id-card'],\n\t'id-card-o': ['drivers-license-o','id-card-o'],\n\t'thermometer-full': ['thermometer-4','thermometer','thermometer-full'],\n\t'thermometer-three-quarters': ['thermometer-3','thermometer-three-quarters'],\n\t'thermometer-half': ['thermometer-2','thermometer-half'],\n\t'thermometer-quarter': ['thermometer-1','thermometer-quarter'],\n\t'thermometer-empty': ['thermometer-0','thermometer-empty'],\n\t'bath': ['bathtub','s15','bath'],\n\t'window-close': ['times-rectangle','window-close'],\n\t'window-close-o': ['times-rectangle-o','window-close-o']\n} as Record<string, string[]>; // const;\n\n/**\n * A list of all available FontAwesome icon names, for use in populating UIs.\n * These are raw names, and not suitable for direct use.\n */\nexport const ICONS = [\n\t'glass','music','search','envelope-o','heart','star','star-o','user',\n\t'film','th-large','th','th-list','check','times','search-plus',\n\t'search-minus','power-off','signal','cog','trash-o','home','file-o',\n\t'clock-o','road','download','arrow-circle-o-down','arrow-circle-o-up',\n\t'inbox','play-circle-o','repeat','refresh','list-alt','lock','flag',\n\t'headphones','volume-off','volume-down','volume-up','qrcode','barcode',\n\t'tag','tags','book','bookmark','print','camera','font','bold','italic',\n\t'text-height','text-width','align-left','align-center','align-right',\n\t'align-justify','list','outdent','indent','video-camera','picture-o',\n\t'pencil','map-marker','adjust','tint','pencil-square-o','share-square-o',\n\t'check-square-o','arrows','step-backward','fast-backward','backward',\n\t'play','pause','stop','forward','fast-forward','step-forward','eject',\n\t'chevron-left','chevron-right','plus-circle','minus-circle','times-circle',\n\t'check-circle','question-circle','info-circle','crosshairs',\n\t'times-circle-o','check-circle-o','ban','arrow-left','arrow-right',\n\t'arrow-up','arrow-down','share','expand','compress','plus','minus',\n\t'asterisk','exclamation-circle','gift','leaf','fire','eye','eye-slash',\n\t'exclamation-triangle','plane','calendar','random','comment','magnet',\n\t'chevron-up','chevron-down','retweet','shopping-cart','folder','folder-open',\n\t'arrows-v','arrows-h','bar-chart','twitter-square','facebook-square',\n\t'camera-retro','key','cogs','comments','thumbs-o-up','thumbs-o-down',\n\t'star-half','heart-o','sign-out','linkedin-square','thumb-tack','external-link',\n\t'sign-in','trophy','github-square','upload','lemon-o','phone','square-o',\n\t'bookmark-o','phone-square','twitter','facebook','github','unlock',\n\t'credit-card','rss','hdd-o','bullhorn','bell','certificate','hand-o-right',\n\t'hand-o-left','hand-o-up','hand-o-down','arrow-circle-left','arrow-circle-right',\n\t'arrow-circle-up','arrow-circle-down','globe','wrench','tasks','filter',\n\t'briefcase','arrows-alt','users','link','cloud','flask','scissors','files-o',\n\t'paperclip','floppy-o','square','bars','list-ul','list-ol','strikethrough',\n\t'underline','table','magic','truck','pinterest','pinterest-square',\n\t'google-plus-square','google-plus','money','caret-down','caret-up',\n\t'caret-left','caret-right','columns','sort','sort-desc','sort-asc',\n\t'envelope','linkedin','undo','gavel','tachometer','comment-o','comments-o',\n\t'bolt','sitemap','umbrella','clipboard','lightbulb-o','exchange',\n\t'cloud-download','cloud-upload','user-md','stethoscope','suitcase','bell-o',\n\t'coffee','cutlery','file-text-o','building-o','hospital-o','ambulance',\n\t'medkit','fighter-jet','beer','h-square','plus-square','angle-double-left',\n\t'angle-double-right','angle-double-up','angle-double-down','angle-left',\n\t'angle-right','angle-up','angle-down','desktop','laptop','tablet','mobile',\n\t'circle-o','quote-left','quote-right','spinner','circle','reply','github-alt',\n\t'folder-o','folder-open-o','smile-o','frown-o','meh-o','gamepad','keyboard-o',\n\t'flag-o','flag-checkered','terminal','code','reply-all','star-half-o',\n\t'location-arrow','crop','code-fork','chain-broken','question','info',\n\t'exclamation','superscript','subscript','eraser','puzzle-piece','microphone',\n\t'microphone-slash','shield','calendar-o','fire-extinguisher','rocket',\n\t'maxcdn','chevron-circle-left','chevron-circle-right','chevron-circle-up',\n\t'chevron-circle-down','html5','css3','anchor','unlock-alt','bullseye',\n\t'ellipsis-h','ellipsis-v','rss-square','play-circle','ticket','minus-square',\n\t'minus-square-o','level-up','level-down','check-square','pencil-square',\n\t'external-link-square','share-square','compass','caret-square-o-down',\n\t'caret-square-o-up','caret-square-o-right','eur','gbp','usd','inr','jpy','rub',\n\t'krw','btc','file','file-text','sort-alpha-asc','sort-alpha-desc',\n\t'sort-amount-asc','sort-amount-desc','sort-numeric-asc','sort-numeric-desc',\n\t'thumbs-up','thumbs-down','youtube-square','youtube','xing','xing-square',\n\t'youtube-play','dropbox','stack-overflow','instagram','flickr','adn','bitbucket',\n\t'bitbucket-square','tumblr','tumblr-square','long-arrow-down','long-arrow-up',\n\t'long-arrow-left','long-arrow-right','apple','windows','android','linux',\n\t'dribbble','skype','foursquare','trello','female','male','gratipay','sun-o',\n\t'moon-o','archive','bug','vk','weibo','renren','pagelines','stack-exchange',\n\t'arrow-circle-o-right','arrow-circle-o-left','caret-square-o-left','dot-circle-o',\n\t'wheelchair','vimeo-square','try','plus-square-o','space-shuttle','slack',\n\t'envelope-square','wordpress','openid','university','graduation-cap','yahoo',\n\t'google','reddit','reddit-square','stumbleupon-circle','stumbleupon','delicious',\n\t'digg','pied-piper-pp','pied-piper-alt','drupal','joomla','language','fax',\n\t'building','child','paw','spoon','cube','cubes','behance','behance-square',\n\t'steam','steam-square','recycle','car','taxi','tree','spotify','deviantart',\n\t'soundcloud','database','file-pdf-o','file-word-o','file-excel-o',\n\t'file-powerpoint-o','file-image-o','file-archive-o','file-audio-o','file-video-o',\n\t'file-code-o','vine','codepen','jsfiddle','life-ring','circle-o-notch','rebel',\n\t'empire','git-square','git','hacker-news','tencent-weibo','qq','weixin',\n\t'paper-plane','paper-plane-o','history','circle-thin','header','paragraph',\n\t'sliders','share-alt','share-alt-square','bomb','futbol-o','tty','binoculars',\n\t'plug','slideshare','twitch','yelp','newspaper-o','wifi','calculator','paypal',\n\t'google-wallet','cc-visa','cc-mastercard','cc-discover','cc-amex','cc-paypal',\n\t'cc-stripe','bell-slash','bell-slash-o','trash','copyright','at','eyedropper',\n\t'paint-brush','birthday-cake','area-chart','pie-chart','line-chart','lastfm',\n\t'lastfm-square','toggle-off','toggle-on','bicycle','bus','ioxhost','angellist',\n\t'cc','ils','meanpath','buysellads','connectdevelop','dashcube','forumbee',\n\t'leanpub','sellsy','shirtsinbulk','simplybuilt','skyatlas','cart-plus',\n\t'cart-arrow-down','diamond','ship','user-secret','motorcycle','street-view',\n\t'heartbeat','venus','mars','mercury','transgender','transgender-alt','venus-double',\n\t'mars-double','venus-mars','mars-stroke','mars-stroke-v','mars-stroke-h','neuter',\n\t'genderless','facebook-official','pinterest-p','whatsapp','server','user-plus',\n\t'user-times','bed','viacoin','train','subway','medium','y-combinator','optin-monster',\n\t'opencart','expeditedssl','battery-full','battery-three-quarters','battery-half',\n\t'battery-quarter','battery-empty','mouse-pointer','i-cursor','object-group',\n\t'object-ungroup','sticky-note','sticky-note-o','cc-jcb','cc-diners-club','clone',\n\t'balance-scale','hourglass-o','hourglass-start','hourglass-half','hourglass-end',\n\t'hourglass','hand-rock-o','hand-paper-o','hand-scissors-o','hand-lizard-o',\n\t'hand-spock-o','hand-pointer-o','hand-peace-o','trademark','registered',\n\t'creative-commons','gg','gg-circle','tripadvisor','odnoklassniki',\n\t'odnoklassniki-square','get-pocket','wikipedia-w','safari','chrome','firefox',\n\t'opera','internet-explorer','television','contao','500px','amazon',\n\t'calendar-plus-o','calendar-minus-o','calendar-times-o','calendar-check-o',\n\t'industry','map-pin','map-signs','map-o','map','commenting','commenting-o',\n\t'houzz','vimeo','black-tie','fonticons','reddit-alien','edge','credit-card-alt',\n\t'codiepie','modx','fort-awesome','usb','product-hunt','mixcloud','scribd',\n\t'pause-circle','pause-circle-o','stop-circle','stop-circle-o','shopping-bag',\n\t'shopping-basket','hashtag','bluetooth','bluetooth-b','percent','gitlab',\n\t'wpbeginner','wpforms','envira','universal-access','wheelchair-alt',\n\t'question-circle-o','blind','audio-description','volume-control-phone','braille',\n\t'assistive-listening-systems','american-sign-language-interpreting','deaf',\n\t'glide','glide-g','sign-language','low-vision','viadeo','viadeo-square',\n\t'snapchat','snapchat-ghost','snapchat-square','pied-piper','first-order',\n\t'yoast','themeisle','google-plus-official','font-awesome','handshake-o',\n\t'envelope-open','envelope-open-o','linode','address-book','address-book-o',\n\t'address-card','address-card-o','user-circle','user-circle-o','user-o',\n\t'id-badge','id-card','id-card-o','quora','free-code-camp','telegram',\n\t'thermometer-full','thermometer-three-quarters','thermometer-half',\n\t'thermometer-quarter','thermometer-empty','shower','bath','podcast',\n\t'window-maximize','window-minimize','window-restore','window-close',\n\t'window-close-o','bandcamp','grav','etsy','imdb','ravelry','eercast',\n\t'microchip','snowflake-o','superpowers','wpexplorer','meetup'\n] as string[]; // const;\n\nlet loaded = false;\n\nimport FA_URL from 'styles/font-awesome.scss';\n\n/**\n * Load the FontAwesome stylesheet and font files if they have not already\n * been loaded.\n */\nexport const load = () => {\n\tif ( loaded )\n\t\treturn;\n\n\tloaded = true;\n\n\tdocument.head.appendChild(createElement('link', {\n\t\thref: FA_URL,\n\t\trel: 'stylesheet',\n\t\ttype: 'text/css',\n\t\tcrossOrigin: 'anonymous'\n\t}));\n}\n\n/**\n * Potentially load the FontAwesome stylesheet and font files, if the\n * provided icon name requires them. If it does not, do nothing.\n * @param icon An icon's name.\n */\nexport const maybeLoad = (icon: string) => {\n\tif ( loaded || ! String(icon).startsWith('fa-') && ! String(icon).startsWith('ffz-fa') )\n\t\treturn;\n\n\tload();\n}\n","export default __webpack_public_path__ + \"opendyslexic.css\";","import { createElement } from \"./dom\";\n\nconst KNOWN_FONTS = [\n\t'Roobert', // Twitch Default\n\t'Arial',\n\t'Arial Black',\n\t'Verdana',\n\t'Helvetica',\n\t'Tahoma',\n\t'Trebuchet MS',\n\t'Impact',\n\t'Didot',\n\t'American Typewriter',\n\t'Lucida Console',\n\t'Monaco',\n\t'Bradley Hand',\n\t'Times New Roman',\n\t'Georgia',\n\t'Garamond',\n\t'Courier New',\n\t'Brush Script MT',\n\t'Comic Sans MS',\n];\n\nexport const VALID_FONTS = document.fonts?.check\n\t? KNOWN_FONTS.filter(font => document.fonts.check(`16px ${font}`)).sort()\n\t: KNOWN_FONTS.sort();\n\n\n/* Google Font Handling */\n\nconst GOOGLE_FONTS = [\n\t'Roboto',\n\t'Open Sans',\n\t'Noto Sans JP',\n\t'Lato',\n\t'Montserrat',\n\t'Roboto Condensed',\n\t'Source Sans Pro',\n\t'Oswald',\n\t'Poppins',\n\t'Noto Sans',\n\t'Roboto Mono',\n\t'Raleway',\n\t'Ubuntu',\n\t'Merriweather',\n\t'Nunito',\n\t'PT Sans',\n\t'Roboto Slab',\n\t'Playfair Display',\n\t'Lora',\n\t'Rubik',\n\t'Mukta',\n\t'Noto Sans KR',\n\t'Work Sans',\n\t'Nunito Sans',\n\t'Nanum Gothic',\n\t'Inter',\n\t'Quicksand',\n\t'PT Serif',\n\t'Hind Siliguri',\n\t'Titilium Web',\n\t'Fira Sans',\n\t'Noto Serif',\n\t'Noto Sans TC',\n\t'Karla'\n];\n\nconst LOADED_GOOGLE = new Map<string, number>();\nconst LOADED_GOOGLE_LINKS = new Map<string, HTMLLinkElement>();\n\nfunction loadGoogleFont(font: string) {\n\tif ( LOADED_GOOGLE_LINKS.has(font) )\n\t\treturn;\n\n\tconst name = encodeURIComponent(font);\n\n\tconst link = createElement('link', {\n\t\tid: `ffz-font-${name}`,\n\t\trel: 'stylesheet',\n\t\thref: `https://fonts.googleapis.com/css2?family=${name}`\n\t});\n\n\tLOADED_GOOGLE_LINKS.set(font, link);\n\tdocument.head.appendChild(link);\n}\n\nfunction unloadGoogleFont(font: string) {\n\tconst link = LOADED_GOOGLE_LINKS.get(font);\n\tif ( ! link )\n\t\treturn;\n\n\tLOADED_GOOGLE_LINKS.delete(font);\n\tlink.remove();\n}\n\n\n/* OpenDyslexic Font */\n\nconst OD_FONTS = [\n\t'OpenDyslexic',\n\t'OpenDyslexicAlta',\n\t'OpenDyslexicMono'\n];\n\nimport OD_URL from 'styles/opendyslexic.scss';\n\nlet od_count = 0;\nlet od_link: HTMLLinkElement | null = null;\n\nfunction loadOpenDyslexic() {\n\tif ( od_link )\n\t\treturn;\n\n\tod_link = createElement('link', {\n\t\tid: `ffz-font-opendyslexic`,\n\t\trel: 'stylesheet',\n\t\ttype: 'text/css',\n\t\thref: OD_URL\n\t});\n\n\tdocument.head.appendChild(od_link);\n}\n\n\nfunction unloadOpenDyslexic() {\n\tif ( ! od_link )\n\t\treturn;\n\n\tod_link.remove();\n\tod_link = null;\n}\n\n\n/* Using and Listing Fonts */\n\n// TODO: Move this type somewhere more generic.\ntype SettingSelectOption<TValue> = {\n\tvalue: TValue;\n\n\ttitle: string;\n\ti18n_key?: string;\n\n\tseparator?: boolean;\n}\n\ntype SettingSelectSeparator = {\n\tseparator: true;\n\n\ttitle: string;\n\ti18n_key?: string;\n}\n\ntype SettingSelectEntry<TValue> = SettingSelectOption<TValue> | SettingSelectSeparator;\n\n\nexport function getFontsList(): SettingSelectEntry<string>[] {\n\tconst out: SettingSelectEntry<string>[] = [\n\t\t{value: '', i18n_key: 'setting.font.default', title: 'Default'},\n\t\t{separator: true, i18n_key: 'setting.font.builtin', title: 'Built-in Fonts'},\n\t];\n\n\tfor(const font of VALID_FONTS)\n\t\tout.push({value: font, title: font});\n\n\tout.push({\n\t\tseparator: true, i18n_key: 'setting.font.dyslexic', title: 'Dyslexia Fonts'\n\t});\n\n\tfor(const font of OD_FONTS)\n\t\tout.push({value: font, title: font});\n\n\tout.push({\n\t\tseparator: true, i18n_key: 'setting.font.google', title: 'Google Fonts'\n\t});\n\n\tfor(const font of GOOGLE_FONTS)\n\t\tout.push({value: `google:${font}`, title: font});\n\n\treturn out;\n}\n\n\nexport function useFont(font: string): [string, (() => void) | null] {\n\tif ( ! font )\n\t\treturn [font, null];\n\n\tif ( OD_FONTS.includes(font) ) {\n\t\tod_count++;\n\t\tif ( od_count === 1 )\n\t\t\tloadOpenDyslexic();\n\n\t\tlet unloaded = false;\n\t\tconst unloader = () => {\n\t\t\tif ( ! unloaded ) {\n\t\t\t\tunloaded = true;\n\t\t\t\tod_count--;\n\t\t\t\tif ( ! od_count )\n\t\t\t\t\tunloadOpenDyslexic();\n\t\t\t}\n\t\t}\n\n\t\treturn [font, unloader];\n\t}\n\n\tif ( font.startsWith('google:') ) {\n\t\tconst name = font.slice(7),\n\t\t\tcount = (LOADED_GOOGLE.get(name) ?? 0) + 1;\n\n\t\tLOADED_GOOGLE.set(name, count);\n\t\tif ( count === 1 )\n\t\t\tloadGoogleFont(name);\n\n\t\tlet unloaded = false;\n\t\tconst unloader = () => {\n\t\t\tif ( ! unloaded ) {\n\t\t\t\tunloaded = true;\n\t\t\t\tconst count = (LOADED_GOOGLE.get(name) ?? 0) - 1;\n\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\tLOADED_GOOGLE.set(name, count);\n\t\t\t\t} else {\n\t\t\t\t\tLOADED_GOOGLE.delete(name);\n\t\t\t\t\tunloadGoogleFont(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn [name, unloader];\n\t}\n\n\treturn [font, null];\n}","'use strict';\n\nimport type { DefinitionNode, DocumentNode, FieldNode, FragmentDefinitionNode, OperationDefinitionNode, SelectionNode, SelectionSetNode } from 'graphql';\n\n\n// ============================================================================\n// GraphQL Document Manipulation\n// ============================================================================\n\nexport const MERGE_METHODS: Record<string, (a: any, b: any) => any> = {\n\tDocument: (a: DocumentNode, b: DocumentNode) => {\n\t\tif ( a.definitions && b.definitions )\n\t\t\t(a as any).definitions = mergeList(a.definitions as DefinitionNode[], b.definitions as any);\n\t\telse if ( b.definitions )\n\t\t\t(a as any).definitions = b.definitions;\n\n\t\treturn a;\n\t},\n\n\tField: (a: FieldNode, b: FieldNode) => {\n\t\tif ( a.name && (! b.name || b.name.value !== a.name.value) )\n\t\t\treturn a;\n\n\t\t// TODO: arguments\n\t\t// TODO: directives\n\n\t\tif ( a.selectionSet && b.selectionSet )\n\t\t\t(a as any).selectionSet = merge(a.selectionSet, b.selectionSet);\n\t\telse if ( b.selectionSet )\n\t\t\t(a as any).selectionSet = b.selectionSet;\n\n\t\treturn a;\n\t},\n\n\tOperationDefinition: (a: OperationDefinitionNode, b: OperationDefinitionNode) => {\n\t\tif ( a.operation !== b.operation )\n\t\t\treturn a;\n\n\t\t// TODO: variableDefinitions\n\t\t// TODO: directives\n\n\t\tif ( a.selectionSet && b.selectionSet )\n\t\t\t(a as any).selectionSet = merge(a.selectionSet, b.selectionSet);\n\t\telse if ( b.selectionSet )\n\t\t\t(a as any).selectionSet = b.selectionSet;\n\n\t\treturn a;\n\t},\n\n\tFragmentDefinition: (a: FragmentDefinitionNode, b: FragmentDefinitionNode) => {\n\t\tif ( a.typeCondition && b.typeCondition ) {\n\t\t\tif ( a.typeCondition.kind !== b.typeCondition.kind )\n\t\t\t\treturn a;\n\n\t\t\tif ( a.typeCondition.name.value != b.typeCondition.name.value )\n\t\t\t\treturn a;\n\t\t}\n\n\t\t// TODO: directives\n\n\t\tif ( a.selectionSet && b.selectionSet )\n\t\t\t(a as any).selectionSet = merge(a.selectionSet, b.selectionSet);\n\t\telse if ( b.selectionSet )\n\t\t\t(a as any).selectionSet = b.selectionSet;\n\n\t\treturn a;\n\t},\n\n\tSelectionSet: (a: SelectionSetNode, b: SelectionSetNode) => {\n\t\tif ( a.selections && b.selections )\n\t\t\ta.selections = mergeList(a.selections as SelectionNode[], b.selections as any);\n\t\telse if ( b.selections )\n\t\t\ta.selections = b.selections;\n\n\t\treturn a;\n\t}\n}\n\n// TODO: Type safe this\nexport function mergeList(a: any[], b: any[]) {\n\tlet has_operation = false;\n\tconst a_names: Record<string, any> = {};\n\tfor(const item of a) {\n\t\tif ( ! item || ! item.name || item.name.kind !== 'Name' )\n\t\t\tcontinue;\n\n\t\tif ( item.operation )\n\t\t\thas_operation = true;\n\n\t\ta_names[item.name.value] = item;\n\t}\n\n\tfor(const item of b) {\n\t\tif ( ! item || ! item.name || item.name.kind !== 'Name' )\n\t\t\tcontinue;\n\n\t\tconst name = item.name.value,\n\t\t\tidx = a_names[name] ? a.indexOf(a_names[name]) : -1;\n\n\t\tif ( idx !== -1 ) {\n\t\t\tif ( a[idx].operation && item.operation && a[idx].operation !== item.operation )\n\t\t\t\tcontinue;\n\n\t\t\ta[idx] = merge(a[idx], item);\n\t\t\tif ( a[idx].operation )\n\t\t\t\thas_operation = true;\n\n\t\t} else {\n\t\t\tif ( has_operation && item.operation )\n\t\t\t\tcontinue;\n\n\t\t\ta.push(item);\n\t\t}\n\t}\n\n\treturn a;\n}\n\n\nexport default function merge(a: any, b: any) {\n\tif ( a.kind !== b.kind )\n\t\treturn a;\n\n\tif ( MERGE_METHODS[a.kind] )\n\t\treturn MERGE_METHODS[a.kind](a, b);\n\n\treturn a;\n}\n","'use strict';\n\n// ============================================================================\n// Module System\n// Modules are cool.\n// ============================================================================\n\nimport EventEmitter, { EventListener, EventMap, NamespacedEventArgs, NamespacedEventKey, NamespacedEvents } from 'utilities/events';\nimport {has} from 'utilities/object';\nimport type Logger from './logging';\nimport type { AddonInfo, KnownEvents, ModuleKeys, ModuleMap, OptionalPromise } from './types';\nimport type { Addon } from './addon';\n\n\n// ============================================================================\n// Module\n// ============================================================================\n\n/** Represents the loading state of a Module. */\nexport enum LoadState {\n\t/** The module is currently unloaded. */\n\tUnloaded,\n\t/**\n\t * The module is in the process of loading. It may be waiting for its\n\t * load dependencies to become available, or it may be waiting for its\n\t * own {@link Module.onLoad} method to return.\n\t */\n\tLoading,\n\t/** The module is currently loaded. */\n\tLoaded,\n\t/**\n\t * The module is in the process of unloading. It may be waiting for other\n\t * modules that depend on it to be disabled, or it may be waiting for its\n\t * own {@link Module.onUnload} method to return.\n\t */\n\tUnloading\n};\n\nexport enum State {\n\t/** The module is currently disabled. */\n\tDisabled,\n\t/**\n\t * The module is in the process of being enabled. It may be waiting for\n\t * its dependencies to become available, or it may be waiting for its\n\t * own {@link Module.onEnable} method to return.\n\t */\n\tEnabling,\n\t/** The module is currently enabled. */\n\tEnabled,\n\t/**\n\t * The module is in the process of being disabled. It may be waiting for\n\t * other modules that depend on it to be disabled, or it may be waiting\n\t * for its own {@link Module.onDisable} method to return.\n\t */\n\tDisabling\n};\n\nexport type ModuleEvents = {\n\t':registered': [module: GenericModule],\n\t':loaded': [module: GenericModule],\n\t':unloaded': [module: GenericModule],\n\t':enabled': [module: GenericModule],\n\t':disabled': [module: GenericModule]\n};\n\nexport type GenericModule = Module<any, any, any, any>;\n\ntype PendingModule = [\n\tstring[],\n\tstring[],\n\t[string, string][]\n];\n\nconst EXTRACTOR = /^addon\\.([^.]+)(?:\\.|$)/i;\n\nfunction extractAddonId(path: string) {\n\treturn EXTRACTOR.exec(path)?.[1];\n}\n\n\n/**\n * A Module represents a distinct logical component of FrankerFaceZ. Modules\n * can be loaded or unloaded at runtime, and they have a robust event system.\n * Every add-on consists of one or more Module. There are separate modules\n * for every system in FrankerFaceZ, such as localization, emotes, badges,\n * chat rendering, etc.\n *\n * If you are creating an add-on, you might use Module directly if you're\n * using more than one module. If your add-on only has one module, then it\n * should use the {@link Addon} subclass.\n *\n * @param TNamespace The absolute path where this module will be mounted in\n * the module tree. Providing this string allows relative events to be used.\n * @param TEventMap A map of all event types that you're expecting to use.\n * This may include events from other modules that you plan to use. You\n * should import the type objects used by those other modules.\n */\nexport class Module<\n\tTNamespace extends string = '',\n\tTEventMap extends EventMap = {},\n\tTExtraEvents extends EventMap = KnownEvents,\n\tTActualEvents extends EventMap = TExtraEvents & NamespacedEvents<TNamespace, TEventMap> & NamespacedEvents<TNamespace, ModuleEvents>\n> extends EventEmitter<TNamespace, TActualEvents> {\n\n\tstatic buildAddonProxy = buildAddonProxy;\n\n\t/**\n\t * Optional. This method is called when a module belonging to an\n\t * {@link Addon} attempts to {@link resolve} or {@link inject} this\n\t * module. This can be used to return a {@link Proxy} for the purpose\n\t * of adjusting API responses or record keeping.\n\t *\n\t * @param addon_id The ID of the add-on requesting the module.\n\t * @param addon The manifest of the add-on requesting the module.\n\t * @param root The root {@link Addon} module.\n\t * @param caller The specific {@link Module} making the request.\n\t */\n\tgetAddonProxy?(addon_id: string, addon: AddonInfo, root: GenericModule, caller: GenericModule): Module<TNamespace, TEventMap>;\n\n\t/**\n\t * Optional. This method may be called when generating a diagnostic\n\t * log, and it can return a string to be included in the log.\n\t */\n\tgenerateLog?(): OptionalPromise<string>;\n\n\t// Some generic stuff...\n\t/**\n\t * For use in modules that are direct children of \"core\" or \"site\". If this\n\t * is set to true, the module will be enabled when FrankerFaceZ\n\t * is initialized.\n\t */\n\tshould_enable?: boolean;\n\n\t// Tracking module inter-dependency\n\tload_requires?: string[];\n\trequires?: string[];\n\n\t// These are always initialized when a module is being set up, but not\n\t// in the constructor. Just trick the type system.\n\tload_dependents: string[] = null as any;\n\tdependents: string[] = null as any;\n\treferences: [string, string][] = null as any;\n\n\n\tprivate __modules: Record<string, PendingModule | GenericModule>;\n\tprivate __log?: Logger;\n\n\tprivate __proxies?: Record<string, GenericModule>;\n\n\tprivate __load_state: LoadState;\n\tprivate __state: State;\n\n\tprivate __load_promise?: Promise<void> | null;\n\tprivate __state_promise?: Promise<void> | null;\n\n\tchildren: Record<string, GenericModule>;\n\n\t// Addon Metadata\n\tprivate __addon_id?: string;\n\tprivate __addon_root?: GenericModule;\n\n\tconstructor(name?: string, parent?: GenericModule, addon?: boolean) {\n\t\tif ( ! parent && (name as any) instanceof Module ) {\n\t\t\tparent = name as any;\n\t\t\tname = undefined;\n\t\t}\n\n\t\tsuper(name, parent);\n\t\tthis.__modules = parent ? parent.__modules : {};\n\t\tthis.children = {};\n\n\t\tif ( parent?.__addon_id ) {\n\t\t\tthis.__addon_id = parent.__addon_id;\n\t\t\tthis.__addon_root = parent.__addon_root;\n\t\t} else if ( addon ) {\n\t\t\tconst addon_id = extractAddonId(this.__path as string);\n\t\t\tif ( addon_id ) {\n\t\t\t\tthis.__addon_id = addon_id;\n\t\t\t\tthis.__addon_root = this;\n\t\t\t}\n\t\t}\n\n\t\tif ( parent && ! parent.children[this.name] )\n\t\t\tparent.children[this.name] = this;\n\n\t\tif ( this.root === this )\n\t\t\tthis.__modules[this.__path || ''] = this;\n\n\t\tlet is_loadable = !! this.onLoad;\n\t\tif ( ! is_loadable ) {\n\t\t\tconst load_requires = this.__get_load_requires();\n\t\t\tis_loadable = Array.isArray(load_requires) && load_requires.length > 0;\n\t\t}\n\n\t\tthis.__load_state = is_loadable ? LoadState.Unloaded : LoadState.Loaded;\n\t\tthis.__state = is_loadable || this.onEnable ?\n\t\t\tState.Disabled : State.Enabled;\n\n\t\tthis._time('instance');\n\t\t(this as any).emit(':registered', this);\n\t}\n\n\n\t// ========================================================================\n\t// Public Properties\n\t// ========================================================================\n\n\t/** The current {@link State} of this module. */\n\tget state() { return this.__state }\n\n\t/** The current {@link LoadState} of this module. */\n\tget load_state() { return this.__load_state }\n\n\t/** Whether or not the module is {@link LoadState.Loaded}. */\n\tget loaded() { return this.__load_state === LoadState.Loaded }\n\t/** Whether or not the module is {@link LoadState.Loading}. */\n\tget loading() { return this.__load_state === LoadState.Loading }\n\n\t/** Whether or not the module is {@link State.Enabled}. */\n\tget enabled() { return this.__state === State.Enabled }\n\t/** Whether or not the module is {@link State.Enabling}. */\n\tget enabling() { return this.__state === State.Enabling }\n\n\t/** If this module is part of an add-on, the add-on's ID. */\n\tget addon_id() { return this.__addon_id }\n\t/** If this module is part of an add-on, the add-on's root module. */\n\tget addon_root() { return this.__addon_root }\n\t/** If this module is part of an add-on, the add-on's manifest. */\n\tget addon_manifest() {\n\t\tif (this.__addon_id)\n\t\t\treturn this.resolve('addons')?.getAddon(this.__addon_id!) ??\n\t\t\t\t(this.__addon_root?.constructor as typeof Addon)?.info ??\n\t\t\t\tundefined;\n\t}\n\n\t/** A Logger instance for this module. */\n\tget log(): Logger {\n\t\t// In theory, this could be undefined. In practice, we will always\n\t\t// have a Logger set up. Additionally, it would be way too annoying\n\t\t// to need to put conditional checks literally everywhere we use the\n\t\t// logger system. Just no.\n\t\tif ( ! this.__log )\n\t\t\tthis.__log = this.parent && (this.parent as GenericModule).log?.get?.(this.name);\n\t\treturn this.__log as Logger;\n\t}\n\n\tset log(log) {\n\t\tthis.__log = log;\n\t}\n\n\n\t// ========================================================================\n\t// Timing\n\t// ========================================================================\n\n\t/**\n\t * Record a timing event. The timing system is not yet finished.\n\t * @param event The timing event to record.\n\t */\n\tprotected _time(event: string | any) {\n\t\tif ( (this.root as any).timing ) {\n\t\t\tif ( typeof event !== 'object' )\n\t\t\t\tevent = {event};\n\t\t\tevent.module = this.__path || 'core';\n\t\t\t(this.root as any).timing.addEvent(event);\n\t\t}\n\t}\n\n\n\t// ========================================================================\n\t// State! Glorious State\n\t// ========================================================================\n\n\t/**\n\t * Load this module. If the module has no {@link onLoad} method and no\n\t * {@link load_requires} modules listed, then it will be considered\n\t * {@link LoadState.Loaded} immediately.\n\t *\n\t * All of the module's {@link load_requires} dependencies will be\n\t * enabled before the load state updates and this returns.\n\t *\n\t * Modules are automatically loaded before being enabled.\n\t */\n\tload() {\n\t\treturn this.__load(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being loaded. The module will not be set to {@link LoadState.Loaded}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that this module {@link load_requires}\n\t * will already be enabled and injected modules will have been injected.\n\t */\n\tprotected onLoad?(): void | Promise<void>;\n\n\t/**\n\t * Unload this module. If the module has no {@link onUnload} method,\n\t * but it has an {@link onLoad} method, then this will throw an error.\n\t *\n\t * When this is called, if this module is currently enabled, it will\n\t * be disabled first. As part of that, all modules that depend on\n\t * this module will also be disabled first. All modules that depend\n\t * on this module as a load dependency will be unloaded first.\n\t *\n\t * Please note that, if any of those dependencies cannot be unloaded or\n\t * disabled, this will fail.\n\t */\n\tunload() {\n\t\treturn this.__unload(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being unloaded. The module will not be set to {@link LoadState.Unloaded}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that depend on this module will\n\t * already have been disabled.\n\t */\n\tprotected onUnload?(): void | Promise<void>;\n\n\t/**\n\t * Enable this module. If the module has no {@link onEnable} method\n\t * and the module is considered {@link LoadState.Loaded} immediately,\n\t * then the module will be considered {@link State.Enabled} immediately.\n\t *\n\t * All of the module's {@link requires} dependencies will be\n\t * enabled before the state updates and this returns.\n\t *\n\t * Modules are automatically loaded before being enabled.\n\t */\n\tenable() {\n\t\treturn this.__enable(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being enabled. The module will not be set to {@link State.Enabled}\n\t * until after this method returns. Promises are supported.\n\t *\n\t * When this is called, all modules that this module {@link requires}\n\t * will already be enabled and injected modules will have been injected.\n\t */\n\tprotected onEnable?(): void | Promise<void>;\n\n\t/**\n\t * Disable this module. If the module has no {@link onDisable} method,\n\t * but it has an {@link onEnable} method, then this will throw an error.\n\t *\n\t * As part of disabling this module, all modules that depend on this\n\t * module will be disabled first. All modules that depend on this module\n\t * as a load dependency will be unloaded first.\n\t *\n\t * Please note that, if any of those dependencies cannot be unloaded or\n\t * disabled, this will fail.\n\t */\n\tdisable() {\n\t\treturn this.__disable(this.__path, []);\n\t}\n\n\t/**\n\t * Optional. If this method is defined, it will be called when the\n\t * module is being disabled. The module will not be set to {@link State.Disabled}\n\t * until after this method returns. Promises are supported.\n\t */\n\tprotected onDisable?(): void | Promise<void>;\n\n\t/**\n\t * Determine whether or not this module can be unloaded. This checks\n\t * not only this module's state, but the state of all modules that\n\t * depend on this module.\n\t */\n\tcanUnload() {\n\t\treturn this.__canUnload(this.__path, []);\n\t}\n\n\t/**\n\t * Determine whether or not this module can be disabled. This checks\n\t * not only this module's state, but the state of all modules that\n\t * depend on this module.\n\t */\n\tcanDisable() {\n\t\treturn this.__canDisable(this.__path, []);\n\t}\n\n\tprivate __load(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${initial}`, [...chain, this]));\n\t\telse if ( this.load_requires )\n\t\t\tfor(const name of this.load_requires) {\n\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\tif ( (module instanceof Module) && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === LoadState.Loading )\n\t\t\treturn this.__load_promise;\n\n\t\telse if ( state === LoadState.Loaded )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( state === LoadState.Unloading )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to load module ${path} while module is being unloaded`));\n\n\t\tthis._time('load-start');\n\t\tthis.__load_state = LoadState.Loading;\n\t\treturn this.__load_promise = (async () => {\n\t\t\tif ( this.load_requires ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.load_requires) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\tthrow new ModuleError(`cannot find required module ${name} when loading ${path}`);\n\n\t\t\t\t\tpromises.push(module.__enable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tif ( this.onLoad ) {\n\t\t\t\tthis._time('load-self');\n\t\t\t\treturn this.onLoad();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__load_state = LoadState.Loaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('load-end');\n\t\t\t(this as any).emit(':loaded', this);\n\t\t\treturn ret;\n\t\t}).catch(err => {\n\t\t\tthis.__load_state = LoadState.Unloaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('load-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\tprivate __canUnload(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can unload ${initial}`, [...chain, this]);\n\t\telse if ( this.load_dependents ) {\n\t\t\tchain.push(this);\n\n\t\t\tfor(const dep of this.load_dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module ) {\n\t\t\t\t\tif ( chain.includes(module) )\n\t\t\t\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can unload ${initial}`, [...chain, this, module]);\n\n\t\t\t\t\tif ( ! module.__canUnload(initial, Array.from(chain)) )\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( state === LoadState.Unloading )\n\t\t\treturn true;\n\n\t\telse if ( state === LoadState.Unloaded )\n\t\t\treturn true;\n\n\t\telse if ( this.onLoad && ! this.onUnload )\n\t\t\treturn false;\n\n\t\telse if ( state === LoadState.Loading )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate __unload(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__load_state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${initial}`, [...chain, this]));\n\t\telse if ( this.load_dependents )\n\t\t\tfor(const dep of this.load_dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === LoadState.Unloading )\n\t\t\treturn this.__load_promise;\n\n\t\telse if ( state === LoadState.Unloaded )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( this.onLoad && ! this.onUnload )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to unload module ${path} but module cannot be unloaded`));\n\n\t\telse if ( state === LoadState.Loading )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to unload module ${path} while module is being loaded`));\n\n\t\tthis._time('unload-start');\n\t\tthis.__load_state = LoadState.Unloading;\n\t\treturn this.__load_promise = (async () => {\n\t\t\tif ( this.__state !== State.Disabled )\n\t\t\t\tawait this.disable();\n\n\t\t\tif ( this.load_dependents ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.load_dependents) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\t//throw new ModuleError(`cannot find depending module ${name} when unloading ${path}`);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tpromises.push(module.__unload(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tthis._time('unload-self');\n\t\t\tif ( this.onUnload )\n\t\t\t\treturn this.onUnload();\n\n\t\t})().then(ret => {\n\t\t\tthis.__load_state = LoadState.Unloaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('unload-end');\n\t\t\t(this as any).emit(':unloaded', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__load_state = LoadState.Loaded;\n\t\t\tthis.__load_promise = null;\n\t\t\tthis._time('unload-end');\n\t\t\tthrow err;\n\n\t\t});\n\t}\n\n\n\tprivate __enable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${initial}`, [...chain, this]));\n\t\telse if ( this.requires )\n\t\t\tfor(const name of this.requires) {\n\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === State.Enabling )\n\t\t\treturn this.__state_promise;\n\n\t\telse if ( state === State.Enabled )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( state === State.Disabling )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to enable module ${path} while module is being disabled`));\n\n\t\tthis._time('enable-start');\n\t\tthis.__state = State.Enabling;\n\t\treturn this.__state_promise = (async () => {\n\t\t\tconst promises = [],\n\t\t\t\trequires = this.requires,\n\t\t\t\tload_state = this.__load_state;\n\n\t\t\tif ( load_state === LoadState.Unloading )\n\t\t\t\t// We'd abort for this later to, but kill it now before we start\n\t\t\t\t// any unnecessary work.\n\t\t\t\tthrow new ModuleError(`attempted to load module ${path} while module is being unloaded`);\n\n\t\t\telse if ( load_state === LoadState.Loading || load_state === LoadState.Unloaded )\n\t\t\t\tpromises.push(this.load());\n\n\t\t\tif ( requires )\n\t\t\t\tfor(const name of requires) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\tthrow new ModuleError(`cannot find required module ${name} when enabling ${path}`);\n\n\t\t\t\t\tpromises.push(module.__enable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\tawait Promise.all(promises);\n\t\t\tif ( this.onEnable ) {\n\t\t\t\tthis._time('enable-self');\n\t\t\t\treturn this.onEnable();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__state = State.Enabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('enable-end');\n\t\t\t(this as any).emit(':enabled', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__state = State.Disabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('enable-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\tprivate __canDisable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can disable ${initial}`, [...chain, this]);\n\t\telse if ( this.dependents ) {\n\t\t\tchain.push(this);\n\n\t\t\tfor(const dep of this.dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module && (module instanceof Module) ) {\n\t\t\t\t\tif ( chain.includes(module) )\n\t\t\t\t\t\tthrow new CyclicDependencyError(`cyclic load requirements when checking if can disable ${initial}`, [...chain, this, module]);\n\n\t\t\t\t\tif ( ! module.__canDisable(initial, Array.from(chain)) )\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( state === State.Disabling || state === State.Disabled )\n\t\t\treturn true;\n\n\t\telse if ( ! this.onDisable )\n\t\t\treturn false;\n\n\t\telse if ( state === State.Enabling )\n\t\t\treturn false;\n\n\t\treturn true;\n\t}\n\n\n\tprivate __disable(initial: string | undefined, chain: GenericModule[]) {\n\t\tconst path = this.__path || this.name,\n\t\t\tstate = this.__state;\n\n\t\tif ( chain.includes(this) )\n\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${initial}`, [...chain, this]));\n\t\telse if ( this.dependents )\n\t\t\tfor(const dep of this.dependents) {\n\t\t\t\tconst module = this.__resolve(dep);\n\t\t\t\tif ( module instanceof Module && chain.includes(module) )\n\t\t\t\t\treturn Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${initial}`, [...chain, this, module]));\n\t\t\t}\n\n\t\tchain.push(this);\n\n\t\tif ( state === State.Disabling )\n\t\t\treturn this.__state_promise;\n\n\t\telse if ( state === State.Disabled )\n\t\t\treturn Promise.resolve();\n\n\t\telse if ( ! this.onDisable )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to disable module ${path} but module cannot be disabled`));\n\n\t\telse if ( state === State.Enabling )\n\t\t\treturn Promise.reject(new ModuleError(`attempted to disable module ${path} but module is being enabled`));\n\n\t\tthis._time('disable-start');\n\t\tthis.__state = State.Disabling;\n\t\treturn this.__state_promise = (async () => {\n\t\t\tif ( this.__load_state !== LoadState.Loaded )\n\t\t\t\t// We'd abort for this later to, but kill it now before we start\n\t\t\t\t// any unnecessary work.\n\t\t\t\tthrow new ModuleError(`attempted to disable module ${path} but module is unloaded -- weird state`);\n\n\t\t\tif ( this.dependents ) {\n\t\t\t\tconst promises = [];\n\t\t\t\tfor(const name of this.dependents) {\n\t\t\t\t\tconst module = this.__resolve(name);\n\t\t\t\t\tif ( ! module || !(module instanceof Module) )\n\t\t\t\t\t\t// Assume a non-existent module isn't enabled.\n\t\t\t\t\t\t//throw new ModuleError(`cannot find depending module ${name} when disabling ${path}`);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tpromises.push(module.__disable(initial, Array.from(chain)));\n\t\t\t\t}\n\n\t\t\t\tawait Promise.all(promises);\n\t\t\t}\n\n\t\t\tif ( this.onDisable ) {\n\t\t\t\tthis._time('disable-self');\n\t\t\t\treturn this.onDisable();\n\t\t\t}\n\n\t\t})().then(ret => {\n\t\t\tthis.__state = State.Disabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('disable-end');\n\t\t\t(this as any).emit(':disabled', this);\n\t\t\treturn ret;\n\n\t\t}).catch(err => {\n\t\t\tthis.__state = State.Enabled;\n\t\t\tthis.__state_promise = null;\n\t\t\tthis._time('disable-end');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\n\t// ========================================================================\n\t// Slightly Easier Events\n\t// ========================================================================\n\n\ton<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.on(\n\t\t\tevent,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\tonce<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.once(\n\t\t\tevent,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\tmany<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tttl: number,\n\t\tfn: EventListener<NamespacedEventArgs<K, TNamespace, TActualEvents>>,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.many(\n\t\t\tevent,\n\t\t\tttl,\n\t\t\tfn,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\twaitFor<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent: K,\n\t\tctx?: any,\n\t\tpriority?: number,\n\t\tprepend: boolean = false\n\t) {\n\t\treturn super.waitFor<K>(\n\t\t\tevent,\n\t\t\tctx === undefined ? this : ctx,\n\t\t\tpriority,\n\t\t\tprepend\n\t\t);\n\t}\n\n\toff<K extends NamespacedEventKey<TNamespace, TActualEvents>>(\n\t\tevent?: K, fn?: EventListener, ctx?: any\n\t) {\n\t\treturn super.off(event, fn, ctx === undefined ? this : ctx);\n\t}\n\n\n\t// ========================================================================\n\t// Module Management\n\t// ========================================================================\n\n\tprivate __resolve(name: string | Module): Module | PendingModule | undefined {\n\t\tif ( name instanceof Module )\n\t\t\treturn name;\n\n\t\treturn this.__modules[this.abs_path(name)];\n\t}\n\n\tresolve<\n\t\tTPath extends string,\n\t\tTReturn = TPath extends keyof ModuleMap\n\t\t\t? ModuleMap[TPath]\n\t\t\t: GenericModule\n\t>(name: TPath): TReturn | null {\n\t\tlet module = this.__resolve(name);\n\t\tif ( !(module instanceof Module) )\n\t\t\treturn null;\n\n\t\tif ( this.__processModule )\n\t\t\tmodule = this.__processModule(module);\n\n\t\treturn module as TReturn;\n\t}\n\n\n\thasModule(name: string) {\n\t\tconst module = this.__modules[this.abs_path(name)];\n\t\treturn module instanceof Module;\n\t}\n\n\n\tprivate __get_requires() {\n\t\tif ( has(this, 'requires') )\n\t\t\treturn this.requires;\n\t\tif ( has(this.constructor, 'requires') )\n\t\t\treturn (this.constructor as any).requires as string[];\n\t\treturn null;\n\t}\n\n\n\tprivate __get_load_requires() {\n\t\tif ( has(this, 'load_requires') )\n\t\t\treturn this.load_requires;\n\t\tif ( has(this.constructor, 'load_requires') )\n\t\t\treturn (this.constructor as any).load_requires as string[];\n\t\treturn null;\n\t}\n\n\n\tprivate __processModule<TModule extends Module>(module: TModule): TModule {\n\t\tif ( this.__addon_id && module.getAddonProxy ) {\n\t\t\tconst addon_id = this.__addon_id;\n\t\t\tif ( ! module.__proxies )\n\t\t\t\tmodule.__proxies = {};\n\n\t\t\tif ( module.__proxies[addon_id] )\n\t\t\t\treturn module.__proxies[addon_id] as TModule;\n\n\t\t\t// TODO: Typing for the addons module.\n\t\t\tconst addon = (this.__resolve('addons') as any)?.getAddon?.(addon_id),\n\t\t\t\tout = module.getAddonProxy(addon_id, addon, this.__addon_root ?? this, this);\n\n\t\t\tif ( out !== module )\n\t\t\t\tmodule.__proxies[addon_id] = out;\n\n\t\t\treturn out as TModule;\n\t\t}\n\n\t\treturn module;\n\t}\n\n\n\tinject(name: string | Module | null, module?: GenericModule | typeof Module<any, any> | null, require: boolean = true) {\n\t\tif ( name instanceof Module || (name && (name as any).prototype instanceof Module) ) {\n\t\t\trequire = module != null ? module as any : true;\n\t\t\tmodule = name as Module;\n\t\t\tname = null;\n\t\t}\n\n\t\tconst requires = this.requires = this.__get_requires() || [];\n\n\t\tif ( module instanceof Module ) {\n\t\t\t// Existing Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.constructor.name.toSnakeCase();\n\n\t\t} else if ( module && module.prototype instanceof Module ) {\n\t\t\t// New Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.name.toSnakeCase();\n\n\t\t\tmodule = this.register(name, module);\n\n\t\t} else if ( name ) {\n\t\t\t// Just a Name\n\t\t\tconst full_name = name;\n\t\t\tname = name.replace(/^(?:[^.]*\\.)+/, '');\n\t\t\tmodule = this.__resolve(full_name) as Module | undefined;\n\n\t\t\t// Allow injecting a module that doesn't exist yet?\n\n\t\t\tif ( ! module || !(module instanceof Module) ) {\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as PendingModule)[2].push([this.__path as string, name]);\n\t\t\t\telse\n\t\t\t\t\tthis.__modules[this.abs_path(full_name)] = [[], [], [[this.__path as string, name]]]\n\n\t\t\t\trequires.push(this.abs_path(full_name));\n\n\t\t\t\treturn (this as any)[name] = null;\n\t\t\t}\n\n\t\t} else\n\t\t\tthrow new TypeError(`must provide a valid module name or class`);\n\n\t\tif ( ! module )\n\t\t\tthrow new Error(`cannot find module ${name} or no module provided`);\n\n\t\tif ( require )\n\t\t\trequires.push((module as Module).abs_path('.'));\n\n\t\tif ( this.enabled && ! (module as Module).enabled )\n\t\t\t(module as Module).enable();\n\n\t\t(module as Module).references.push([this.__path as string, name]);\n\n\t\tif ( (module instanceof Module) && this.__processModule )\n\t\t\tmodule = this.__processModule(module);\n\n\t\treturn (this as any)[name] = module;\n\t}\n\n\n\tinjectAs(variable: string, name: string | Module | null, module?: GenericModule | typeof Module<any, any> | null, require: boolean = true) {\n\t\tif ( name instanceof Module || (name && (name as any).prototype instanceof Module) ) {\n\t\t\trequire = module != null ? module as any : true;\n\t\t\tmodule = name as Module;\n\t\t\tname = null;\n\t\t}\n\n\t\tconst requires = this.requires = this.__get_requires() || [];\n\n\t\tif ( module instanceof Module ) {\n\t\t\t// Existing Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.constructor.name.toSnakeCase();\n\n\t\t} else if ( module && module.prototype instanceof Module ) {\n\t\t\t// New Instance\n\t\t\tif ( ! name )\n\t\t\t\tname = module.name.toSnakeCase();\n\n\t\t\tmodule = this.register(name, module);\n\n\t\t} else if ( name ) {\n\t\t\t// Just a Name\n\t\t\tconst full_name = name;\n\t\t\tname = name.replace(/^(?:[^.]*\\.)+/, '');\n\t\t\tmodule = this.__resolve(full_name) as Module | undefined;\n\n\t\t\t// Allow injecting a module that doesn't exist yet?\n\n\t\t\tif ( ! module || !(module instanceof Module) ) {\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as PendingModule)[2].push([this.__path as string, variable]);\n\t\t\t\telse\n\t\t\t\t\tthis.__modules[this.abs_path(full_name)] = [[], [], [[this.__path as string, variable]]]\n\n\t\t\t\trequires.push(this.abs_path(full_name));\n\n\t\t\t\treturn (this as any)[variable] = null;\n\t\t\t}\n\n\t\t} else\n\t\t\tthrow new TypeError(`must provide a valid module name or class`);\n\n\t\tif ( ! module )\n\t\t\tthrow new Error(`cannot find module ${name} or no module provided`);\n\n\t\tif ( require )\n\t\t\trequires.push((module as Module).abs_path('.'));\n\n\n\t\tif ( this.enabled && ! (module as Module).enabled )\n\t\t\t(module as Module).enable();\n\n\t\t(module as Module).references.push([this.__path as string, variable]);\n\n\t\tif ( this.__processModule )\n\t\t\tmodule = this.__processModule(module as Module);\n\n\t\treturn (this as any)[variable] = module;\n\t}\n\n\n\tregister(name: string, module: typeof Module<any, any>, inject_reference: boolean = false) {\n\t\tif ( (name as any).prototype instanceof Module ) {\n\t\t\tinject_reference = module as any;\n\t\t\tmodule = name as any;\n\t\t\tname = module.name.toSnakeCase();\n\t\t}\n\n\t\tconst path = this.abs_path(`.${name}`),\n\t\t\tproto = module.prototype,\n\t\t\told_val = this.__modules[path];\n\n\t\tif ( !(proto instanceof Module) )\n\t\t\tthrow new TypeError(`Module ${name} is not subclass of Module.`);\n\n\t\tif ( old_val instanceof Module )\n\t\t\tthrow new ModuleError(`Name Collision for Module ${path}`);\n\n\t\tconst dependents = old_val || [[], [], []];\n\t\tlet inst = this.__modules[path] = new module(name, this);\n\t\tconst requires = inst.requires = inst.__get_requires() || [],\n\t\t\tload_requires = inst.load_requires = inst.__get_load_requires() || [];\n\n\t\tinst.dependents = dependents[0];\n\t\tinst.load_dependents = dependents[1];\n\t\tinst.references = dependents[2];\n\n\t\tfor(const req_name of requires) {\n\t\t\tconst req_path = inst.abs_path(req_name),\n\t\t\t\treq_mod = this.__modules[req_path];\n\n\t\t\tif ( ! req_mod )\n\t\t\t\tthis.__modules[req_path] = [[path],[],[]];\n\t\t\telse if ( Array.isArray(req_mod) )\n\t\t\t\treq_mod[0].push(path);\n\t\t\telse\n\t\t\t\treq_mod.dependents.push(path);\n\t\t}\n\n\t\tfor(const req_name of load_requires) {\n\t\t\tconst req_path = inst.abs_path(req_name),\n\t\t\t\treq_mod = this.__modules[req_path];\n\n\t\t\tif ( ! req_mod )\n\t\t\t\tthis.__modules[req_path] = [[], [path], []];\n\t\t\telse if ( Array.isArray(req_mod) )\n\t\t\t\treq_mod[1].push(path);\n\t\t\telse\n\t\t\t\treq_mod.load_dependents.push(path);\n\t\t}\n\n\t\tfor(const [in_path, in_name] of dependents[2]) {\n\t\t\tconst in_mod = this.__resolve(in_path);\n\t\t\tif ( in_mod && ! Array.isArray(in_mod) )\n\t\t\t\t(in_mod as any)[in_name] = inst;\n\t\t\telse\n\t\t\t\tthis.log.warn(`Unable to find module \"${in_path}\" that wanted \"${in_name}\".`);\n\t\t}\n\n\t\tif ( this.__processModule )\n\t\t\tinst = this.__processModule(inst as GenericModule);\n\n\t\tif ( inject_reference )\n\t\t\t(this as any)[name] = inst;\n\n\t\treturn inst;\n\t}\n\n\n\t/**\n\t * Attempt to load a set of child modules from a {@link require.context}\n\t * object. This searches the default exports, as well as exports named\n\t * `module` specifically. Each discovered module will be registered\n\t * and injected onto this module.\n\t *\n\t * @param ctx The context to load from.\n\t * @param log A logger to use for logging errors. If not provided, this\n\t * will default to this module's default logger.\n\t * @returns A map of all loaded modules.\n\t */\n\tasync loadFromContext(ctx: __WebpackModuleApi.RequireContext, log?: Logger) {\n\t\tlog = log ?? this.log;\n\t\tconst added: Record<string, GenericModule> = {};\n\t\tfor(const raw_path of ctx.keys()) {\n\t\t\tconst raw_module = await ctx(raw_path), // eslint-disable-line no-await-in-loop\n\t\t\t\tmodule = raw_module.module || raw_module.default,\n\t\t\t\tlix = raw_path.lastIndexOf('.'),\n\t\t\t\ttrimmed = lix > 2 ? raw_path.slice(2, lix) : raw_path,\n\t\t\t\tname = trimmed.endsWith('/index') ? trimmed.slice(0, -6) : trimmed;\n\n\t\t\ttry {\n\t\t\t\tadded[name] = this.register(name, module);\n\t\t\t} catch(err) {\n\t\t\t\tif ( log && err instanceof Error ) {\n\t\t\t\t\tlog.capture(err, {\n\t\t\t\t\t\textra: {\n\t\t\t\t\t\t\tmodule: name,\n\t\t\t\t\t\t\tpath: raw_path\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tlog.warn(err, `Skipping ${raw_path}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn added;\n\t}\n\n}\n\nexport default Module;\n\nexport function buildAddonProxy<TObj extends object, TNoProxy extends boolean = false>(\n\taccessor: Module | null,\n\tthing: TObj,\n\tname: string,\n\toverrides: Record<string, any>,\n\taccess_warnings?: Record<string, string | boolean>,\n\tno_proxy?: TNoProxy\n): TNoProxy extends true ? ProxyHandler<TObj> : TObj {\n\n\tconst handler = {\n\t\tget(obj: any, prop: string, receiver: unknown) {\n\t\t\t// First, handle basic overrides behavior.\n\t\t\tlet value = overrides[prop];\n\t\t\tif ( value !== undefined ) {\n\t\t\t\t// Check for functions, and bind their this.\n\t\t\t\tif ( typeof value === 'function' )\n\t\t\t\t\treturn value.bind(obj);\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\t// Next, handle access warnings.\n\t\t\tconst warning = access_warnings && access_warnings[prop];\n\t\t\tif ( accessor?.log && warning )\n\t\t\t\taccessor.log.warn(`[DEV-CHECK] Accessed ${name}.${prop} directly. ${typeof warning === 'string' ? warning : ''}`)\n\n\t\t\t// Check for functions, and bind their this.\n\t\t\tvalue = obj[prop];\n\t\t\tif ( typeof value === 'function' )\n\t\t\t\treturn value.bind(obj);\n\n\t\t\t// Make sure all module access is proxied.\n\t\t\tif ( accessor && (value instanceof Module) )\n\t\t\t\t// TypeScript thinks this doesn't work. It technically does,\n\t\t\t\t// we just don't want to encourage it.\n\t\t\t\treturn accessor.resolve(value as any);\n\n\t\t\t// Return whatever it would be normally.\n\t\t\treturn Reflect.get(obj, prop, receiver);\n\t\t}\n\t};\n\n\treturn no_proxy ? handler : new Proxy<TObj>(thing, handler) as any;\n\n}\n\n\n// ============================================================================\n// Errors\n// ============================================================================\n\n/**\n * A subclass of {@link Error} for errors directly related to {@link Module}\n * state. These may be thrown when attempting to enable, disable, load, or\n * unload a module.\n *\n * @noInheritDoc\n */\nexport class ModuleError extends Error { }\n\n/**\n * A subclass of {@link ModuleError} thrown in specific cases when attempting\n * to enable, disable, load, or unload a {@link Module} results in a cycle.\n * This happens if a module depends on a module that, directly or indirectly,\n * depends on itself.\n */\nexport class CyclicDependencyError extends ModuleError {\n\n\t/** The list of modules encountered, in the order they were encountered. */\n\tmodules: GenericModule[];\n\n\t/**\n\t * Create a new instance of CyclicDependencyError.\n\t *\n\t * @param message The message to display with the error.\n\t * @param modules The list of modules at fault.\n\t */\n\tconstructor(message: string, modules: GenericModule[]) {\n\t\tsuper(`${message} (${modules.map(x => (x as Module).path).join(' => ')})`);\n\t\tthis.modules = modules;\n\t}\n\n}\n","\nimport {BAD_HOTKEYS, TWITCH_EMOTE_V2, WORD_SEPARATORS} from 'utilities/constants';\nimport type { ExtractSegments, ExtractType } from 'utilities/types';\n\nconst HOP = Object.prototype.hasOwnProperty;\n\n/**\n * Get the URL for a Twitch emote.\n *\n * @param id The emote's ID.\n * @param scale The scale.\n * @param animated Whether or not to allow animated images.\n * @param dark Whether or not the image is to be displayed on a dark background.\n * Twitch, continuing to innovate in being behind the times, uses GIFs for\n * their animated emotes so matteing is a concern.\n */\nexport function getTwitchEmoteURL(\n\tid: string,\n\tscale: 1 | 2 | 4,\n\tanimated: boolean = false,\n\tdark: boolean = true\n) {\n\treturn `${TWITCH_EMOTE_V2}/${id}/${animated ? 'default' : 'static'}/${dark ? 'dark' : 'light'}/${scale == 4 ? 3 : scale}.0`\n}\n\n/**\n * Get an `srcset` for a Twitch emote. This is intended for use with\n * an image element's `srcset` attribute.\n *\n * @param id The emote's ID.\n * @param animated Whether or not to allow animated images.\n * @param dark Whether or not the image is to be displayed on a dark background.\n * Twitch, continuing to innovate in being behind the times, uses GIFs for\n * their animated emotes so matteing is a concern.\n * @param big If this is true, the emote's 2x image will be used for 1x\n * size, and its 4x image will be used for 2x size.\n */\nexport function getTwitchEmoteSrcSet(\n\tid: string,\n\tanimated: boolean = false,\n\tdark: boolean = true,\n\tbig: boolean = false\n) {\n\tif ( big )\n\t\treturn `${getTwitchEmoteURL(id, 2, animated, dark)} 1x, ${getTwitchEmoteURL(id, 4, animated, dark)} 2x`;\n\n\treturn `${getTwitchEmoteURL(id, 1, animated, dark)} 1x, ${getTwitchEmoteURL(id, 2, animated, dark)} 2x, ${getTwitchEmoteURL(id, 4, animated, dark)} 4x`;\n}\n\n/** Check if the provided shortkey key is valid. */\nexport function isValidShortcut(key: string) {\n\tif ( ! key )\n\t\treturn false;\n\n\tkey = key.toLowerCase().trim();\n\treturn ! BAD_HOTKEYS.includes(key);\n}\n\n/**\n * Generate a random UUIDv4.\n *\n * This method has a fallback implementation for people using\n * ancient browsers without {@link crypto.randomUUID}.\n */\nexport const generateUUID = crypto.randomUUID\n\t? () => crypto.randomUUID()\n\t: function generateUUID(input?: any): string {\n\t\treturn input           // if the placeholder was passed, return\n\t\t\t? (              // a random number from 0 to 15\n\t\t\t\tinput ^            // unless b is 8,\n\t\t\t\tMath.random()  // in which case\n\t\t\t\t* 16           // a random number from\n\t\t\t\t>> input/4         // 8 to 11\n\t\t\t).toString(16) // in hexadecimal\n\t\t\t: (              // or otherwise a concatenated string:\n\t\t\t\t[1e7] as any +        // 10000000 +\n\t\t\t\t-1e3 +         // -1000 +\n\t\t\t\t-4e3 +         // -4000 +\n\t\t\t\t-8e3 +         // -80000000 +\n\t\t\t\t-1e11          // -100000000000,\n\t\t\t).replace(     // replacing\n\t\t\t\t/[018]/g,    // zeroes, ones, and eights with\n\t\t\t\tgenerateUUID            // random hex digits\n\t\t\t);\n\t};\n\n\n/**\n * An error that can be localized using the i18n module.\n */\nexport class TranslatableError extends Error {\n\n\ti18n_key: string;\n\tdata: any;\n\n\tconstructor(message: string, key: string, data?: any) {\n\t\tsuper(message);\n\t\tthis.i18n_key = key;\n\t\tthis.data = data;\n\t}\n\n\ttoString() {\n\t\tconst ffz = window.FrankerFaceZ?.get(),\n\t\t\ti18n = ffz?.resolve('i18n');\n\n\t\tif ( i18n && this.i18n_key )\n\t\t\treturn i18n.t(this.i18n_key, this.message, this.data);\n\n\t\treturn this.message;\n\t}\n}\n\n\n/**\n * Get a SHA-256 hash of a string. Uses {@link crypto.subtle.digest}\n *\n * @param message The string to hash.\n */\nexport async function sha256(message: string) {\n\t// encode as UTF-8\n\tconst msgBuffer = new TextEncoder().encode(message);\n\n\t// hash the message\n\tconst hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n\n\t// convert ArrayBuffer to Array\n\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\n\t// convert bytes to hex string\n\tconst hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\treturn hashHex;\n}\n\n\nexport type ScreenDimensions = {\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\theight: number;\n\tlabel: string;\n};\n\nexport type ScreenOptions = {\n\tindex?: number;\n\ttop?: number;\n\tleft?: number;\n\twidth?: number;\n\theight?: number;\n\tlabel?: string | null;\n}\n\n/**\n * Determine which screen from the provided array is the closest match to\n * the provided options. This is used by the settings profile rule for\n * Current Monitor.\n *\n * @param screens The screens to choose between.\n * @param options The options to choose with.\n */\nexport function matchScreen(screens: ScreenDimensions[], options: ScreenOptions) {\n\tlet match = undefined;\n\tlet mscore = 0;\n\n\tfor(let i = 0; i < screens.length; i++) {\n\t\tconst mon = screens[i];\n\t\tif ( mon.label !== options.label )\n\t\t\tcontinue;\n\n\t\tlet score = 1;\n\t\tif ( options.left && options.left === mon.left )\n\t\t\tscore += 15;\n\t\tif ( options.top && options.top === mon.top )\n\t\t\tscore += 15;\n\n\t\tif ( options.width && options.width === mon.width )\n\t\t\tscore += 10;\n\n\t\tif ( options.height && options.height === mon.height )\n\t\t\tscore += 10;\n\n\t\tif ( options.index )\n\t\t\tscore -= Math.abs(options.index - i);\n\n\t\tif ( score > mscore ) {\n\t\t\tmatch = mon;\n\t\t\tmscore = score;\n\t\t}\n\t}\n\n\treturn match;\n}\n\n/**\n * Determine if the provided object has a key with the given name.\n *\n * @param object The object to check.\n * @param key The key to search for.\n */\nexport function has<T>(object: T, key: PropertyKey): key is keyof T {\n\treturn object ? HOP.call(object, key) : false;\n}\n\n\n/**\n * Return a {@link Promise} that resolves after a set delay.\n *\n * @param delay The amount of time to wait, in milliseconds.\n */\nexport function sleep(delay: number): Promise<void> {\n\treturn new Promise(resolve => setTimeout(resolve, delay));\n}\n\n\nexport type FakeEnum<T extends string> = {\n\t[K in T | number]: K extends number ? T : number;\n};\n\n/**\n * Create an enum-like object from an array of strings.\n *\n * @deprecated This should no longer be used, as we now have access to\n * TypeScript's enum types.\n */\nexport function make_enum<T extends string>(...input: T[]): FakeEnum<T> {\n\tconst out: any = {};\n\n\tfor(let i = 0, l = input.length; i < l; i++) {\n\t\tconst word = input[i];\n\t\tout[word] = i;\n\t\tout[i] = word;\n\t}\n\n\treturn out;\n}\n\nexport type FakeEnumFlags<T extends string> = FakeEnum<T> & {\n\tNone: 0;\n}\n\n/**\n * Create an enum-like object from an array of strings, such that every\n * value is a power of two so that they can be processed using binary\n * operators.\n *\n * @deprecated This should no longer be used, as we now have access to\n * TypeScript's enum types.\n */\nexport function make_enum_flags<T extends string>(...input: T[]): FakeEnumFlags<T> {\n\tconst out: any = {};\n\n\tout.None = 0;\n\tout[0] = 'None';\n\n\tfor(let i = 0, l = input.length; i < l; i++) {\n\t\tconst word = input[i],\n\t\t\tvalue = Math.pow(2, i);\n\t\tout[word] = value;\n\t\tout[value] = word;\n\t}\n\n\treturn out;\n}\n\n/**\n * A simple {@link Error} subclass thrown from {@link timeout} if and\n * when the Promise times out.\n *\n * @noInheritDoc\n */\nexport class TimeoutError extends Error {\n\tconstructor(message?: string) {\n\t\tsuper(message ?? 'timeout')\n\t}\n}\n\n/**\n * Wrap a {@link Promise} with another Promise that, if the original\n * Promise fails to resolve or reject within the provided delay, will\n * be rejected with a {@link TimeoutError}.\n *\n * @param promise The Promise to wrap\n * @param delay The length of time, in milliseconds, to wait before timing out.\n */\nexport function timeout<TReturn = unknown>(promise: Promise<TReturn>, delay: number) {\n\treturn new Promise<TReturn>((resolve, fail) => {\n\t\tlet resolved = false;\n\t\tconst timer = setTimeout(() => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tfail(new TimeoutError());\n\t\t\t}\n\t\t}, delay);\n\n\t\tpromise.then(result => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tresolve(result);\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tif ( ! resolved ) {\n\t\t\t\tresolved = true;\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tfail(err);\n\t\t\t}\n\t\t});\n\t});\n}\n\n\n/**\n * TicketLock is a simple class that implements a [Ticket Lock](https://en.wikipedia.org/wiki/Ticket_lock)\n * pattern for cooperative waiting. This can be used for, among other things,\n * limiting the number of concurrent API requests to avoid overloading\n * browser or server limits.\n *\n * @example Using TicketLock to limit access to an API.\n * ```typescript\n * // In your constructor.\n * this.api_tickets = new TicketLock(5); // allow up to 5 simultaneous requests\n *\n * // In a method accessing your API\n * const ticket = await this.api_tickets.wait();\n *\n * const request = await fetch(url).finally(ticket);\n * if ( request.ok )\n *     // ...\n * ```\n */\nexport class TicketLock {\n\tlimit: number;\n\n\tprivate __active: number;\n\tprivate __waiting: ((done: () => void) => void)[];\n\n\tconstructor(limit = 1) {\n\t\tthis.limit = limit;\n\t\tthis.__active = 0;\n\t\tthis.__waiting = [];\n\t}\n\n\t/** Whether or not there is a ticket available. */\n\tget available() { return this.__active < this.limit }\n\n\tprivate __done() {\n\t\tthis.__active--;\n\n\t\twhile(this.__active < this.limit && this.__waiting.length > 0) {\n\t\t\tthis.__active++;\n\t\t\tconst waiter = this.__waiting.shift();\n\t\t\tif ( waiter )\n\t\t\t\twaiter(this.__getTicket());\n\t\t}\n\t}\n\n\t/**\n\t * Get a ticket function. This ensures that a bad caller can't call\n\t * its function multiple times to mess up the active tickets count.\n\t */\n\tprivate __getTicket() {\n\t\tlet held = true;\n\t\treturn () => {\n\t\t\tif ( held ) {\n\t\t\t\theld = false;\n\t\t\t\tthis.__done();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Wait for a ticket to become available. Once a ticket is\n\t * available, returns a function that **must** be called\n\t * after you're done with the ticket to return the ticket\n\t * to the pool.\n\t */\n\twait() {\n\t\tif ( this.__active < this.limit) {\n\t\t\tthis.__active++;\n\t\t\treturn Promise.resolve(this.__getTicket());\n\t\t}\n\n\t\treturn new Promise<() => void>(resolve => this.__waiting.push(resolve));\n\t}\n}\n\n/**\n * @deprecated Renamed to TicketLock to be more accurate.\n */\nexport const Mutex = TicketLock;\n\n\ntype AnyFunction = (...args: any[]) => any;\n\n/**\n * Return a wrapper for a function that will only execute the function\n * a period of time after it has stopped being called.\n *\n * Alternatively, by setting `immediate` to true, you can have the\n * function run immediately, but then wait a period of time before\n * being able to run again.\n *\n * By setting immediate to `2`, you can have the function run\n * immediately and, after a period of time, run again as long\n * as it was called again.\n *\n * @param fn The function to wrap.\n * @param delay The time to wait, in milliseconds\n * @param immediate If immediate is true, trigger the function immediately rather than eventually.\n * @returns The wrapped function\n */\nexport function debounce<TFunc extends AnyFunction>(\n\tfn: TFunc,\n\tdelay: number,\n\timmediate: boolean | 2 = false\n) {\n\n\tlet timer: ReturnType<typeof setTimeout> | null;\n\n\tif ( immediate ) {\n\t\tconst later = () => timer = null;\n\t\tif ( immediate === 2 )\n\t\t\t// Special Mode! Run immediately OR later.\n\t\t\treturn function debouncedFunction(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\t\t\tif ( timer ) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\ttimer = null;\n\t\t\t\t\t\tfn.apply(this, args);\n\t\t\t\t\t}, delay);\n\t\t\t\t} else {\n\t\t\t\t\tfn.apply(this, args);\n\t\t\t\t\ttimer = setTimeout(later, delay);\n\t\t\t\t}\n\t\t\t}\n\n\t\treturn function(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\t\tif ( ! timer )\n\t\t\t\tfn.apply(this, args);\n\t\t\telse\n\t\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = setTimeout(later, delay);\n\t\t}\n\t}\n\n\treturn function(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>) {\n\t\tif ( timer )\n\t\t\tclearTimeout(timer);\n\n\t\ttimer = setTimeout(fn.bind(this, ...args), delay) as any;\n\t}\n}\n\n\n/**\n * Make sure that a given asynchronous function is only called once\n * at a time.\n */\nexport function once<TFunc extends AnyFunction, TReturn = Awaited<ReturnType<TFunc>>>(fn: TFunc) {\n\tlet promise: Promise<TReturn> | undefined;\n\n\treturn function onceFunction(this: ThisParameterType<TFunc>, ...args: Parameters<TFunc>): Promise<TReturn> {\n\t\tif ( promise )\n\t\t\treturn promise;\n\n\t\ttry {\n\t\t\tpromise = Promise.resolve<TReturn>(fn.call(this, ...args));\n\t\t} catch(err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\treturn promise.finally(() => promise = undefined);\n\t}\n}\n\n\n/**\n * Check that two arrays are the same length and that each array has the same\n * items in the same indices.\n * @param a The first array\n * @param b The second array\n * @returns Whether or not they match\n */\nexport function array_equals(a?: any[] | null, b?: any[] | null) {\n\tif ( ! Array.isArray(a) || ! Array.isArray(b) || a.length !== b.length )\n\t\treturn false;\n\n\tlet i = a.length;\n\twhile(i--)\n\t\tif ( a[i] !== b[i] )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/**\n * Determine if two objects are equal, deeply comparing their values. This\n * will recurse into the objects as necessary, and has protection against\n * recursive structures.\n *\n * @param first The first object.\n * @param second The second object.\n * @param ignore_undefined Whether or not a missing value on one object\n * should be considered equal to an `undefined` value on the other object.\n * @param first_seen For internal use.\n * @param second_seen For internal use.\n */\nexport function deep_equals(\n\tfirst: any,\n\tsecond: any,\n\tignore_undefined = false,\n\tfirst_seen?: Set<PropertyKey>,\n\tsecond_seen?: Set<PropertyKey>\n) {\n\tif ( first === second )\n\t\treturn true;\n\tif ( typeof first !== typeof second )\n\t\treturn false;\n\tif ( typeof first !== 'object' )\n\t\treturn false;\n\tif ( (first === null) !== (second === null) )\n\t\treturn false;\n\n\tif ( ! first_seen )\n\t\tfirst_seen = new Set;\n\n\tif ( ! second_seen )\n\t\tsecond_seen = new Set;\n\n\tif ( first_seen.has(first) || second_seen.has(second) )\n\t\tthrow new Error('recursive structure detected');\n\n\tfirst_seen.add(first);\n\tsecond_seen.add(second);\n\n\t// TODO: Special logic for Sets and Maps\n\n\tconst source_keys = Object.keys(first),\n\t\tdest_keys = Object.keys(second);\n\n\tif ( ! ignore_undefined && ! set_equals(new Set(source_keys), new Set(dest_keys)) )\n\t\treturn false;\n\n\tfor(const key of source_keys)\n\t\tif ( ! deep_equals(first[key], second[key], ignore_undefined, new Set(first_seen), new Set(second_seen)) )\n\t\t\treturn false;\n\n\tif ( ignore_undefined )\n\t\tfor(const key of dest_keys)\n\t\t\tif ( ! source_keys.includes(key) ) {\n\t\t\t\tif ( ! deep_equals(first[key], second[key], ignore_undefined, new Set(first_seen), new Set(second_seen)) )\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\treturn true;\n}\n\n/**\n * Determine if two objects are equal, shallowly comparing their values.\n *\n * @param first The first object\n * @param second The second object\n */\nexport function shallow_object_equals(first: any, second: any) {\n\tif ( typeof first !== 'object' || typeof second !== 'object' )\n\t\treturn false;\n\n\tconst keys = Object.keys(first);\n\tif ( ! set_equals(new Set(keys), new Set(Object.keys(second))) )\n\t\treturn false;\n\n\tfor(const key of keys)\n\t\tif ( first[key] !== second[key] )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/**\n * Determine if two Maps are equal, shallowly comparing stored values.\n * @param first The first Map\n * @param second The second Map\n */\nexport function map_equals(first: Map<any, any>, second: Map<any, any>) {\n\tif ( !(first instanceof Map) || !(second instanceof Map) || first.size !== second.size )\n\t\treturn false;\n\n\tfor(const [key, val] of first)\n\t\tif ( ! second.has(key) || second.get(key) !== val )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n/**\n * Determine if two Sets are equal, shallowly comparing stored values.\n *\n * @param first The first Set\n * @param second The second Set\n */\nexport function set_equals(first: Set<any>, second: Set<any>) {\n\tif ( !(first instanceof Set) || !(second instanceof Set) || first.size !== second.size )\n\t\treturn false;\n\n\tfor(const v of first)\n\t\tif ( ! second.has(v) )\n\t\t\treturn false;\n\n\treturn true;\n}\n\n\n/* **\n * Special logic to ensure that a target object is matched by a filter.\n * @param {object} filter The filter object\n * @param {object} target The object to check it against\n * @returns {boolean} Whether or not it matches\n /\nexport function filter_match(filter, target) {\n\tfor(const key in filter) {\n\t\tif ( HOP.call(filter, key) ) {\n\t\t\tconst filter_value = filter[key],\n\t\t\t\ttarget_value = target[key],\n\t\t\t\ttype = typeof filter_value;\n\n\t\t\tif ( type === 'function' ) {\n\t\t\t\tif ( ! filter_value(target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( Array.isArray(filter_value) ) {\n\t\t\t\tif ( Array.isArray(target_value) ) {\n\t\t\t\t\tfor(const val of filter_value)\n\t\t\t\t\t\tif ( ! target_value.includes(val) )\n\t\t\t\t\t\t\treturn false;\n\n\t\t\t\t} else if ( ! filter_value.include(target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( typeof target_value !== type )\n\t\t\t\treturn false;\n\n\t\t\telse if ( type === 'object' ) {\n\t\t\t\tif ( ! filter_match(filter_value, target_value) )\n\t\t\t\t\treturn false;\n\n\t\t\t} else if ( filter_value !== target_value )\n\t\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}*/\n\n/**\n * Return the number of times a substring is found within a string.\n * @param str The string to search within.\n * @param needle The substring to search for.\n * @returns The number of matches found.\n */\nexport function substr_count(str: string, needle: string) {\n\tlet i = 0, idx = 0;\n\twhile( idx < str.length ) {\n\t\tconst x = str.indexOf(needle, idx);\n\t\tif ( x === -1 )\n\t\t\tbreak;\n\n\t\ti++;\n\t\tidx = x + 1;\n\t}\n\n\treturn i;\n}\n\n\n// These types are all used by get()\n\n/**\n * Get a value from an object at a path.\n * @param path The path to follow, using periods to go down a level.\n * @param object The starting object.\n * @returns The value at that point in the path, or undefined if part of the path doesn't exist.\n */\nexport function get<TPath extends string, TValue = any, TReturn = ExtractType<TValue, ExtractSegments<TPath>>>(path: TPath, object: TValue): TReturn {\n\tlet segments: string | string[] = path;\n\tif ( typeof segments === 'string' ) {\n\t\tif ( HOP.call(object, segments) )\n\t\t\treturn (object as any)[segments] as TReturn;\n\n\t\tsegments = segments.split('.');\n\t}\n\n\tfor(let i=0, l = segments.length; i < l; i++) {\n\t\tconst part = segments[i];\n\t\tif ( part === '@each' ) {\n\t\t\tconst p = segments.slice(i + 1);\n\t\t\tif ( p.length ) {\n\t\t\t\tif ( Array.isArray(object) )\n\t\t\t\t\tobject = object.map(x => get(p as any, x)) as any;\n\t\t\t\telse {\n\t\t\t\t\tconst new_object: any = {};\n\t\t\t\t\tfor(const key in object)\n\t\t\t\t\t\tif ( HOP.call(object, key) )\n\t\t\t\t\t\t\tnew_object[key] = get(p as any, object[key]);\n\t\t\t\t\tobject = new_object;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\t} else if ( part === '@last' )\n\t\t\tobject = (object as any)[(object as any).length - 1] as any;\n\t\telse\n\t\t\tobject = (object as any)[part] as any;\n\n\t\tif ( ! object )\n\t\t\tbreak;\n\t}\n\n\treturn object as any;\n}\n\n\n/**\n * Copy an object so that it can be safely serialized. If an object\n * is not serializable, such as a promise, returns null.\n *\n * @export\n * @param {*} object The thing to copy.\n * @param {Number} [depth=2] The maximum depth to explore the object.\n * @param {Set} [seen=null] A Set of seen objects. Internal use only.\n * @returns {Object} The copy to safely store or use.\n */\nexport function shallow_copy<T>(object: T, depth: number = 2, seen?: Set<any>): T {\n\tif ( object == null )\n\t\treturn object;\n\n\tif ( object instanceof Promise || typeof object === 'function' )\n\t\treturn null as T;\n\n\tif ( typeof object !== 'object' )\n\t\treturn object;\n\n\tif ( depth === 0 )\n\t\treturn null as T;\n\n\tif ( ! seen )\n\t\tseen = new Set;\n\n\tseen.add(object);\n\n\tif ( Array.isArray(object) ) {\n\t\tconst out = [];\n\t\tfor(const val of object) {\n\t\t\tif ( seen.has(val) )\n\t\t\t\tcontinue;\n\n\t\t\tout.push(shallow_copy(val, depth - 1, new Set(seen)));\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tconst out = {} as Record<string, any>;\n\tfor(const [key, val] of Object.entries(object) ) {\n\t\tif ( seen.has(val) )\n\t\t\tcontinue;\n\n\t\tout[key] = shallow_copy(val, depth - 1, new Set(seen));\n\t}\n\n\treturn out as T;\n}\n\n\n/**\n * Make a clone of an object, recursing into the object to copy its\n * values as well.\n *\n * @deprecated This was written before {@link structuredClone}. We should\n * probably start using that instead for new code.\n *\n * @param object The object to clone.\n * @param seen For internal use only.\n * @returns A clone of the object.\n */\nexport function deep_copy<T>(object: T, seen?: Set<any>): T {\n\tif ( object === null )\n\t\treturn null as T;\n\telse if ( object === undefined )\n\t\treturn undefined as T;\n\n\t// Wrap the promise, just in case.\n\tif ( object instanceof Promise )\n\t\treturn new Promise((resolve, fail) => object.then(resolve).catch(fail)) as T;\n\n\t// Wrap the function, just in case.\n\tif ( typeof object === 'function' )\n\t\treturn function(this: ThisParameterType<T>, ...args: any[]) { return object.apply(this, args); } as T // eslint-disable-line no-invalid-this\n\n\tif ( object instanceof RegExp )\n\t\treturn new RegExp(object.source, object.flags) as T;\n\n\tif ( object instanceof Date )\n\t\treturn new Date(object) as T;\n\n\tif ( typeof object !== 'object' )\n\t\treturn object as T;\n\n\tif ( ! seen )\n\t\tseen = new Set;\n\n\tif ( seen.has(object) )\n\t\tthrow new Error('recursive structure detected');\n\n\tseen.add(object);\n\n\tif ( Array.isArray(object) )\n\t\treturn object.map(x => deep_copy(x, new Set(seen))) as T;\n\n\tif ( object instanceof Set ) {\n\t\tconst out = new Set<any>();\n\t\tfor(const item of object) {\n\t\t\tif ( typeof item === 'object' )\n\t\t\t\tout.add(deep_copy(item));\n\t\t\telse\n\t\t\t\tout.add(item);\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tif ( object instanceof Map ) {\n\t\tconst out = new Map<any, any>();\n\t\tfor(const [key, val] of object.entries()) {\n\t\t\tlet k = typeof key === 'object' ? deep_copy(key) : key,\n\t\t\t\tv = typeof val === 'object' ? deep_copy(val) : val;\n\n\t\t\tout.set(k, v);\n\t\t}\n\n\t\treturn out as T;\n\t}\n\n\tconst out: any = {};\n\tfor(const [key, val] of Object.entries(object)) {\n\t\tif ( typeof val === 'object' )\n\t\t\tout[key] = deep_copy(val, new Set(seen));\n\t\telse\n\t\t\tout[key] = val;\n\t}\n\n\treturn out as T;\n}\n\n\n/**\n * Normalize an add-on ID to make it more suitable for comparison\n * in certain contexts, such as inclusion in emote set IDs as\n * an example.\n */\nexport function normalizeAddonIdForComparison(input: string) {\n\treturn input.toLowerCase().replace(/[\\.\\_\\-]+/, '-');\n}\n\n/**\n * Create a regular expression for detecting the presence of\n * an add-on ID within a string. This uses {@link normalizeAddonIdForComparison}\n * along with a few hard-coded exceptions for current add-ons.\n *\n * @param input The add-on ID to test for.\n */\nexport function makeAddonIdChecker(input: string) {\n\tinput = escape_regex(normalizeAddonIdForComparison(input));\n\tinput = input.replace(/-+/g, '[\\.\\_\\-]+');\n\n\t// Special: ffzap-bttv\n\tinput = input.replace(/\\bbttv\\b/g, '(?:bttv|betterttv)');\n\n\t// Special: which seven tho\n\tinput = input.replace(/\\b7tv\\b/g, '(?:7tv|seventv)');\n\n\t// Special: pronouns (badges)\n\tinput = input.replace(/\\bpronouns\\b/g, '(?:pronouns|addon-pn)');\n\n\treturn new RegExp('\\\\b' + input + '\\\\b', 'i');\n}\n\n\ntype PossibleFunction<TReturn, TThis = unknown, TArgs extends any[] = any[]> =\n\t((this: TThis, ...args: TArgs) => TReturn) | TReturn;\n\n/**\n * Resolve a value that may be either a value, or a function that returns\n * the value.\n *\n * @param input The value to resolve.\n * @param ctx A context (this) to call the potential function with.\n * @param args\n * @returns\n */\nexport function maybe_call<TReturn, TThis, TArgs extends any[]>(\n\tinput: PossibleFunction<TReturn, TThis, TArgs>,\n\tctx: TThis,\n\t...args: TArgs\n): TReturn {\n\tif ( typeof input === 'function' ) {\n\t\tif ( ctx )\n\t\t\treturn (input as any).call(ctx, ...args);\n\t\treturn (input as any)(...args);\n\t}\n\n\treturn input;\n}\n\n\nconst SPLIT_REGEX = /[^\\uD800-\\uDFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDFFF]/g;\n\n/**\n * Split an input string into individual characters. This is used when\n * performing chat message tokenization due to the difference in how\n * JavaScript strings and strings on other platforms handle length and\n * offsets.\n *\n * @param str The string to split.\n */\nexport function split_chars(str: string) {\n\tif ( str === '' )\n\t\treturn [];\n\n\treturn str.match(SPLIT_REGEX);\n}\n\n/**\n * Pick a random value from an object or array and return it.\n *\n * @param obj The object or array to pick from.\n */\nexport function pick_random<T>(obj: T[]): T;\nexport function pick_random<T extends object, K extends keyof T>(obj: T): T[K];\nexport function pick_random(obj: any) {\n\tif ( ! obj )\n\t\treturn null;\n\n\tif ( ! Array.isArray(obj) ) {\n\t\tconst keys = Object.keys(obj);\n\t\treturn obj[pick_random(keys)];\n\t}\n\n\treturn obj[Math.floor(Math.random() * obj.length)];\n}\n\n/**\n * Escape a string for inclusion in a regular expression.\n */\nexport const escape_regex: (str: string) => string = /*(RegExp as any).escape\n\t? (str: string) => ((RegExp as any).escape(` ${str}`) as string).slice(1)\n\t:*/ function escape_regex(str: string) {\n\t\treturn str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\t};\n\n\nexport function addWordSeparators(str: string) {\n\treturn `(^|.*?${WORD_SEPARATORS})(?:${str})(?=$|${WORD_SEPARATORS})`\n}\n\n\nconst CONTROL_CHARS = '/$^+.()=!|';\n\n/**\n * Convert a glob into a regular expression.\n *\n * @param input The glob to convert.\n */\nexport function glob_to_regex(input: string) {\n\tif ( typeof input !== 'string' )\n\t\tthrow new TypeError('input must be a string');\n\n\tlet output = '',\n\t\tgroups = 0;\n\n\tfor(let i=0, l=input.length; i<l; i++) {\n\t\tconst char = input[i];\n\n\t\tif ( CONTROL_CHARS.includes(char) )\n\t\t\toutput += `\\\\${char}`;\n\n\t\telse if ( char === '\\\\' ) {\n\t\t\ti++;\n\t\t\tconst next = input[i];\n\t\t\tif ( next ) {\n\t\t\t\tif ( CONTROL_CHARS.includes(next) )\n\t\t\t\t\toutput += `\\\\${next}`;\n\t\t\t\telse\n\t\t\t\t\toutput += next;\n\t\t\t}\n\n\t\t} else if ( char === '?' )\n\t\t\toutput += '.';\n\n\t\telse if ( char === '[' ) {\n\t\t\toutput += char;\n\t\t\tconst next = input[i + 1];\n\t\t\tif ( next === '!' ) {\n\t\t\t\ti++;\n\t\t\t\toutput += '^';\n\t\t\t}\n\n\t\t} else if ( char === ']' )\n\t\t\toutput += char;\n\n\t\telse if ( char === '{' ) {\n\t\t\toutput += '(?:';\n\t\t\tgroups++;\n\n\t\t} else if ( char === '}' ) {\n\t\t\tif ( groups > 0 ) {\n\t\t\t\toutput += ')';\n\t\t\t\tgroups--;\n\t\t\t}\n\n\t\t} else if ( char === ',' && groups > 0 )\n\t\t\toutput += '|';\n\n\t\telse if ( char === '*' ) {\n\t\t\tlet count = 1;\n\t\t\twhile(input[i+1] === '*') {\n\t\t\t\tcount++;\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\tif ( count > 1 )\n\t\t\t\toutput += '.*?';\n\t\t\telse\n\t\t\t\toutput += '[^\\\\s]*?';\n\n\t\t} else\n\t\t\toutput += char;\n\t}\n\n\t/*while(groups > 0) {\n\t\toutput += ')';\n\t\tgroups--;\n\t}*/\n\n\treturn output;\n}\n\n\n/**\n * Truncate a string. Tries to intelligently break the string in white-space\n * if possible, without back-tracking. The returned string can be up to\n * `ellipsis.length + target + overage` characters long.\n * @param input The string to truncate.\n * @param target The target length for the result\n * @param overage Accept up to this many additional characters for a better result\n * @param ellipsis The string to append when truncating\n * @param break_line If true, attempt to break at the first LF\n * @param trim If true, runs trim() on the string before truncating\n * @returns The truncated string\n */\nexport function truncate(\n\tinput: string,\n\ttarget: number = 100,\n\toverage: number = 15,\n\tellipsis: string = '',\n\tbreak_line: boolean = true,\n\ttrim: boolean = true\n) {\n\tif ( ! input || ! input.length )\n\t\treturn input;\n\n\tif ( trim )\n\t\tinput = input.trim();\n\n\tlet idx = break_line ? input.indexOf('\\n') : -1;\n\tif ( idx === -1 || idx > target )\n\t\tidx = target;\n\n\tif ( input.length <= idx )\n\t\treturn input;\n\n\tlet out = input.slice(0, idx).trimEnd();\n\tif ( overage > 0 && out.length >= idx ) {\n\t\tlet next_space = input.slice(idx).search(/\\s+/);\n\t\tif ( next_space === -1 && overage + idx > input.length )\n\t\t\tnext_space = input.length - idx;\n\n\t\tif ( next_space !== -1 && next_space <= overage ) {\n\t\t\tif ( input.length <= (idx + next_space) )\n\t\t\t\treturn input;\n\n\t\t\tout = input.slice(0, idx + next_space);\n\t\t}\n\t}\n\n\treturn out + ellipsis;\n}\n\n\n/**\n * Convert a number into a hexidecimal string, ensuring that the resulting\n * string is at least two characters.\n *\n * @param input The number to convert.\n */\nfunction decimalToHex(input: number) {\n\treturn input.toString(16).padStart(2, '0')\n}\n\n/**\n * Generate a random hexadecimal string of a given length. This uses\n * {@link crypto.getRandomValues} to generate randomness.\n *\n * @param length The desired string length.\n */\nexport function generateHex(length: number = 40) {\n\tconst arr = new Uint8Array(length / 2);\n\twindow.crypto.getRandomValues(arr);\n\treturn Array.from(arr, decimalToHex).join('')\n}\n\n\nexport type StringSortFn = (first: string, second: string) => number;\n\n/**\n * SourcedSet is similar to a Set, except that entries in the set are kept\n * track of based upon a `source`. This allows entries from a specific source\n * to be modified or removed without affecting entries added by other\n * sources.\n *\n * Note that this does **not** have the same API surface as a normal Set\n * and it should not be treated as such.\n *\n * This is used internally when tracking things like what emote sets or badges\n * are available in user and room contexts, with the `source` values being\n * the add-ons manipulating the data.\n *\n * @param T The type of object to hold.\n */\nexport class SourcedSet<T> {\n\n\tprivate _use_set: boolean;\n\n\t/**\n\t * The internal store used by the SourcedSet to hold its current state.\n\t * Depending on the value of `use_set` when you created the SourcedSet,\n\t * this may be either a Set or an array. This can be accessed directly\n\t * for better performance or iteration, but it should not be\n\t * modified directly.\n\t */\n\t_cache: Set<T> | T[];\n\n\tprivate _sources?: Map<string, T[]>;\n\tprivate _sorted_sources?: T[][] | null;\n\n\tprivate _sourceSortFn?: StringSortFn | null;\n\n\t/**\n\t * Create a new SourcedSet.\n\t *\n\t * @param use_set If this is set to true, use Set instances for holding\n\t * data, otherwise use arrays.\n\t *\n\t * @param T The type of object to hold.\n\t */\n\tconstructor(use_set = false, source_sorter?: StringSortFn) {\n\t\tthis._use_set = use_set;\n\t\tthis._cache = use_set ? new Set<T>() : [];\n\t\tthis._sourceSortFn = source_sorter;\n\t}\n\n\n\tresortSources() {\n\t\tthis._sorted_sources = null;\n\n\t\t// We don't need to rebuild if we have less than 2 sources\n\t\t// since sorting wouldn't change anything.\n\t\tif (this._sources && this._sources.size > 1)\n\t\t\tthis._rebuild();\n\t}\n\n\n\tsetSortFunction(fn: StringSortFn | null) {\n\t\t// If the method isn't changing, then we don't need\n\t\t// to do anything.\n\t\tif (this._sourceSortFn === fn)\n\t\t\treturn;\n\n\t\t// Set the new sort function.\n\t\tthis._sourceSortFn = fn;\n\n\t\t// And re-sort.\n\t\tthis.resortSources();\n\t}\n\n\n\t_sortSources() {\n\t\tif (!this._sources || this._sources.size === 0) {\n\t\t\tthis._sorted_sources = [];\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._sources.size === 1 || !this._sourceSortFn) {\n\t\t\tthis._sorted_sources = [...this._sources.values()];\n\t\t\treturn;\n\t\t}\n\n\t\tconst sources = [...this._sources?.entries()];\n\t\tsources.sort((a, b) => this._sourceSortFn!(a[0], b[0]));\n\n\t\tthis._sorted_sources = sources.map(entry => entry[1]);\n\t}\n\n\t/**\n\t * Trigger a rebuild of the SourcedSet. You should not need to\n\t * call this manually.\n\t */\n\t_rebuild() {\n\t\tif ( ! this._sources )\n\t\t\treturn;\n\n\t\tconst use_set = this._use_set,\n\t\t\tcache = this._cache = use_set ? new Set<T>() : ([] as T[]);\n\n\t\tif (!this._sorted_sources)\n\t\t\tthis._sortSources();\n\n\t\tfor(const items of this._sorted_sources!)\n\t\t\tfor(const i of items)\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t}\n\n\t/** Get the values added by a specific source. */\n\tget(source: string) { return this._sources && this._sources.get(source) }\n\t/** Check to see if a specific source has any values. */\n\thas(source: string) { return this._sources ? this._sources.has(source) : false }\n\n\t*iterateSources() {\n\t\tif ( this._sources )\n\t\t\tfor(const entry of this._sources)\n\t\t\t\tyield entry;\n\t}\n\n\t/** Check to see if a specific source has a specific value. */\n\tsourceIncludes(source: string, value: T) {\n\t\tconst src = this._sources && this._sources.get(source);\n\t\treturn src && src.includes(value);\n\t}\n\n\t/** Check to see if the SourcedSet contains a value. */\n\tincludes(value: T) {\n\t\treturn this._use_set\n\t\t\t? (this._cache as Set<T>).has(value)\n\t\t\t: (this._cache as T[]).includes(value);\n\t}\n\n\t/** Delete a specific source from the set. */\n\tdelete(source: string) {\n\t\tif ( this._sources && this._sources.has(source) ) {\n\t\t\tthis._sources.delete(source);\n\t\t\tthis._sorted_sources = null;\n\t\t\tthis._rebuild();\n\t\t}\n\t}\n\n\t/** Add the provided items to a specific source. */\n\textend(source: string, ...items: T[]) {\n\t\tif ( ! this._sources )\n\t\t\tthis._sources = new Map;\n\n\t\tconst existing = this._sources.get(source);\n\t\tif ( existing ) {\n\t\t\t// If there are existing items, add our new items\n\t\t\t// to the existing array.\n\t\t\tfor(const item of items)\n\t\t\t\tif (! existing.includes(item))\n\t\t\t\t\texisting.push(item);\n\n\t\t} else {\n\t\t\t// If there aren't existing items, just insert our\n\t\t\t// array into the sources list. Also, clear the\n\t\t\t// sorted sources cache.\n\t\t\tthis._sources.set(source, items);\n\t\t\tthis._sorted_sources = null;\n\t\t}\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\t// If we need sorting, do a rebuild, otherwise go ahead\n\t\t// and add the items normally.\n\t\tif ( need_sorting )\n\t\t\tthis._rebuild();\n\t\telse {\n\t\t\tconst use_set = this._use_set,\n\t\t\t\tcache = this._cache;\n\n\t\t\tfor(const i of items) {\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Set a specific source's items to the provided items,\n\t * removing any previous data in the process.\n\t */\n\tset(source: string, items: T | T[]) {\n\t\tif ( ! Array.isArray(items) )\n\t\t\titems = [items];\n\n\t\t// If we have no items, just delete the source instead.\n\t\tif ( ! items.length )\n\t\t\treturn this.delete(source);\n\n\t\tif ( ! this._sources )\n\t\t\tthis._sources = new Map;\n\n\t\tconst existing = this._sources.has(source);\n\t\tthis._sources.set(source, items);\n\t\tthis._sorted_sources = null;\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\t// If we need sorting, or if we replaced an existing source,\n\t\t// then we need a rebuild. Otherwise, go ahead and add the\n\t\t// items normally.\n\t\tif ( existing || need_sorting )\n\t\t\tthis._rebuild();\n\t\telse {\n\t\t\tconst use_set = this._use_set,\n\t\t\t\tcache = this._cache;\n\n\t\t\tfor(const i of items) {\n\t\t\t\tif ( use_set )\n\t\t\t\t\t(cache as Set<T>).add(i);\n\t\t\t\telse if ( ! (cache as T[]).includes(i) )\n\t\t\t\t\t(cache as T[]).push(i);\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Add an item to a specific source. */\n\tpush(source: string, item: T) {\n\t\tif ( ! this._sources )\n\t\t\treturn this.set(source, item);\n\n\t\tconst existing = this._sources.get(source);\n\t\tif ( ! existing?.length )\n\t\t\treturn this.set(source, item);\n\n\t\telse if ( existing.includes(item) )\n\t\t\treturn;\n\n\t\texisting.push(item);\n\n\t\t// If we have a sort function and more than one source, then\n\t\t// we need to do a rebuild when making modifications.\n\t\tconst need_sorting = this._sourceSortFn != null && this._sources.size > 1;\n\n\t\tif ( need_sorting )\n\t\t\tthis._rebuild();\n\t\telse if ( this._use_set )\n\t\t\t(this._cache as Set<T>).add(item);\n\t\telse if ( ! (this._cache as T[]).includes(item) )\n\t\t\t(this._cache as T[]).push(item);\n\t}\n\n\t/** Remove an item from a specific source. */\n\tremove(source: string, item: T) {\n\t\tif ( ! this._sources || ! this._sources.has(source) )\n\t\t\treturn;\n\n\t\tconst existing = this._sources.get(source),\n\t\t\tidx = existing ? existing.indexOf(item) : -1;\n\n\t\tif ( idx === -1 )\n\t\t\treturn;\n\n\t\t(existing as T[]).splice(idx, 1);\n\n\t\t// Removal always requires a rebuild.\n\t\tthis._rebuild();\n\t}\n}\n\n\n/**\n * Decode a base-64 input string into an ArrayBuffer.\n *\n * @param input The string to convert.\n */\nexport function b64ToArrayBuffer(input: string) {\n\tconst bin = atob(input),\n\t\tlen = bin.length,\n\t\tbuffer = new ArrayBuffer(len),\n\t\tview = new Uint8Array(buffer);\n\n\tfor(let i = 0, len = bin.length; i < len; i++)\n\t\tview[i] = bin.charCodeAt(i);\n\n\treturn buffer;\n}\n\n\nconst PEM_HEADER = /-----BEGIN (.+?) KEY-----/,\n\tPEM_FOOTER = /-----END (.+?) KEY-----/;\n\n/**\n * Import an RSA key that is using PEM encoding. This method will determine\n * if the key is a private key or not by searching the PEM header for\n * the string \"PRIVATE\" (case insensitive).\n *\n * If the key is a private key, it will be imported using PKCS8. If it\n * is a public key, it will be imported using SPKI.\n *\n * This uses {@link crypto.subtle.importKey} and is intended for use with\n * the Pub/Sub experiment's message signing feature.\n *\n * @param pem The certificate to import\n * @param uses The uses we will perform with this key\n */\nexport function importRsaKey(pem: string, uses: KeyUsage[] = ['verify']) {\n\tconst start_match = PEM_HEADER.exec(pem),\n\t\tend_match = PEM_FOOTER.exec(pem);\n\n\tif ( ! start_match || ! end_match || start_match[1] !== end_match[1] )\n\t\tthrow new Error('invalid key');\n\n\tconst is_private = /\\bPRIVATE\\b/i.test(start_match[1]),\n\t\tstart = start_match.index + start_match[0].length,\n\t\tend = end_match.index;\n\n\tconst content = pem.slice(start, end).replace(/\\n/g, '').trim();\n\t//console.debug('content', JSON.stringify(content));\n\n\tconst buffer = b64ToArrayBuffer(content);\n\n\treturn crypto.subtle.importKey(\n\t\tis_private ? 'pkcs8' : 'spki',\n\t\tbuffer,\n\t\t{\n\t\t\tname: \"RSA-PSS\",\n\t\t\thash: \"SHA-256\"\n\t\t},\n\t\ttrue,\n\t\tuses\n\t);\n}\n\n/**\n * Perform a {@link fetch} request, and return the response JSON if\n * the request is okay, or else return `null`.\n *\n * @param url The URL to fetch\n * @param init The optional parameters to provide to fetch, if any\n * @param error_value A value to return if an error is caught,\n * defaults to `null`.\n */\nexport function fetchJSON<T>(\n\turl: URL | string,\n\tinit?: RequestInit,\n\terror_value: T | null = null\n) {\n\treturn fetch(url, init)\n\t\t.then(resp => resp.ok ? resp.json() as Promise<T> : null)\n\t\t.catch(() => error_value);\n}\n","'use strict';\n\nexport function parse(path: string) {\n\treturn parseAST({\n\t\tpath,\n\t\ti: 0\n\t});\n}\n\ntype ParseContext = {\n\tpath: string;\n\ti: number;\n}\n\nexport type PathNode = {\n\ttitle: string;\n\tkey: string;\n\tpage?: boolean;\n\ttab?: boolean;\n}\n\nfunction parseAST(ctx: ParseContext) {\n\tconst path = ctx.path,\n\t\tlength = path.length,\n\t\tout = [];\n\n\tlet token: PathNode | null = null,\n\t\traw: string | null = null;\n\n\tlet old_tab = false,\n\t\told_page = false;\n\n\twhile ( ctx.i < length ) {\n\t\tconst start = ctx.i,\n\t\t\tchar = path[start],\n\t\t\tnext = path[start + 1];\n\n\t\tif ( ! token )\n\t\t\ttoken = {} as PathNode;\n\n\t\tif ( ! raw )\n\t\t\traw = '';\n\n\t\t// JSON\n\t\tif ( char === '@' && next === '{') {\n\t\t\tctx.i++;\n\t\t\tconst tag = parseJSON(ctx);\n\t\t\tif ( tag )\n\t\t\t\tObject.assign(token, tag);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Segment End?\n\t\tconst tab = char === `~` && next === '>',\n\t\t\tpage = char === '>' && next === '>',\n\t\t\tsegment = ! page && char === '>';\n\n\t\tif ( ! segment && ! page && ! tab ) {\n\t\t\traw += char;\n\t\t\tctx.i++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// We're at the end of a segment, so push\n\t\t// the token out.\n\t\tif ( tab || page )\n\t\t\tctx.i++;\n\n\t\ttoken.title = raw.trim();\n\t\ttoken.key = token.title.toSnakeCase();\n\n\t\ttoken.page = old_page;\n\t\ttoken.tab = old_tab;\n\n\t\told_page = page;\n\t\told_tab = tab;\n\n\t\tout.push(token);\n\t\ttoken = raw = null;\n\t\tctx.i++;\n\t}\n\n\tif ( token && raw ) {\n\t\ttoken.title = raw.trim();\n\t\ttoken.key = token.title.toSnakeCase();\n\t\ttoken.page = old_page;\n\t\ttoken.tab = old_tab;\n\t\tout.push(token);\n\t}\n\n\treturn out;\n}\n\nfunction parseJSON(ctx: ParseContext) {\n\tconst path = ctx.path,\n\t\tlength = path.length,\n\n\t\tstart = ctx.i;\n\n\tctx.i++;\n\n\tconst stack = ['{'];\n\tlet string: string | boolean = false;\n\n\twhile ( ctx.i < length && stack.length ) {\n\t\tconst start = ctx.i,\n\t\t\tchar = path[start];\n\n\t\tif ( string ) {\n\t\t\tif ( char === '\\\\' ) {\n\t\t\t\tctx.i++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( (char === '\"' || char === \"'\") && char === string ) {\n\t\t\t\tstack.pop();\n\t\t\t\tstring = false;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif ( char === '\"' || char === \"'\" ) {\n\t\t\t\tstring = char;\n\t\t\t\tstack.push(char);\n\t\t\t}\n\n\t\t\tif ( char === '{' || char === '[' )\n\t\t\t\tstack.push(char);\n\n\t\t\tif ( char === ']' ) {\n\t\t\t\tif ( stack.pop() !== '[' )\n\t\t\t\t\tthrow new SyntaxError('Invalid JSON');\n\t\t\t}\n\n\t\t\tif ( char === '}' ) {\n\t\t\t\tif ( stack.pop() !== '{' )\n\t\t\t\t\tthrow new SyntaxError('Invalid JSON');\n\t\t\t}\n\t\t}\n\n\t\tctx.i++;\n\t}\n\n\treturn JSON.parse(path.slice(start, ctx.i));\n}\n","\nexport function getBuster(resolution: number = 5) {\n\tconst now = Math.floor(Date.now() / 1000);\n\treturn now - (now % resolution);\n}\n\nexport function duration_to_string(\n\telapsed: number,\n\tseparate_days?: boolean,\n\tdays_only?: boolean,\n\tno_hours?: boolean,\n\tno_seconds?: boolean\n) {\n\tconst seconds = elapsed % 60;\n\tlet minutes = Math.floor(elapsed / 60),\n\t\thours = Math.floor(minutes / 60),\n\t\tdays = '';\n\n\tminutes = minutes % 60;\n\n\tif ( separate_days ) {\n\t\tconst day_count = Math.floor(hours / 24);\n\t\thours = hours % 24;\n\t\tif ( days_only && day_count > 0 )\n\t\t\treturn `${days} days`;\n\n\t\tdays = day_count > 0 ? `${day_count} days, ` : '';\n\t}\n\n\tconst show_hours = (no_hours === false || days?.length > 0 || hours > 0);\n\n\treturn `${days}${\n\t\tshow_hours ? `${days && hours < 10 ? '0' : ''}${hours}:` : ''\n\t}${show_hours && minutes < 10 ? '0' : ''}${minutes}${\n\t\tno_seconds ? '' : `:${seconds < 10 ? '0' : ''}${seconds}`}`;\n}\n\n\nexport function print_duration(seconds: number) {\n\tlet minutes = Math.floor(seconds / 60);\n\tconst hours = Math.floor(minutes / 60);\n\n\tminutes %= 60;\n\tseconds %= 60;\n\n\treturn `${hours > 0 ? `${hours}:${minutes < 10 ? '0' : ''}` : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;\n}\n\n\nexport function durationForChat(elapsed: number) {\n\tconst seconds = elapsed % 60;\n\tlet minutes = Math.floor(elapsed / 60);\n\tlet hours = Math.floor(minutes / 60);\n\tconst days = Math.floor(hours / 24);\n\n\tminutes = minutes % 60;\n\thours = hours % 24;\n\n\treturn `${days > 0 ? `${days}d` : ''}${hours > 0 ? `${hours}h` : ''}${minutes > 0 ? `${minutes}m` : ''}${seconds > 0 ? `${seconds}s` : ''}`;\n}\n\n\nexport function durationForURL(elapsed: number) {\n\tconst seconds = elapsed % 60;\n\tlet minutes = Math.floor(elapsed / 60);\n\tconst hours = Math.floor(minutes / 60);\n\n\tminutes = minutes % 60;\n\n\treturn `${hours > 0 ? `${hours}h` : ''}${minutes > 0 ? `${minutes}m` : ''}${seconds > 0 ? `${seconds}s` : ''}`;\n}\n","'use strict';\n\n// ============================================================================\n// Dynamic Tooltip Handling\n//\n// Better because you can assign arbitrary content.\n// Better because they are asynchronous with loading indication.\n// Better because they aren't hidden by parents with overflow: hidden;\n// ============================================================================\n\nimport {createElement, setChildren} from 'utilities/dom';\nimport {maybe_call, debounce, has} from 'utilities/object';\n\nimport {Instance, createPopper} from '@popperjs/core';\nimport type Logger from './logging';\nimport type { OptionallyCallable } from './types';\n\n// Extensions to things.\ndeclare global {\n\tinterface HTMLElement {\n\t\t_ffz_tooltip?: TooltipInstance | null;\n\n\t\t_ffz_move_handler?: MouseEventHandler | null;\n\t\t_ffz_over_handler?: MouseEventHandler | null;\n\t\t_ffz_out_handler?: MouseEventHandler | null;\n\t}\n}\n\nlet last_id = 0;\n\nexport const NoContent = Symbol('NoContent');\n\nexport const DefaultOptions = {\n\thtml: false,\n\tdelayShow: 0,\n\tdelayHide: 0,\n\n\tlive: true,\n\n\ttooltipClass: 'ffz__tooltip',\n\tinnerClass: 'ffz__tooltip--inner',\n\tarrowClass: 'ffz__tooltip--arrow'\n}\n\n\ntype TooltipOptional<TReturn> = OptionallyCallable<[target: HTMLElement, tip: TooltipInstance], TReturn>;\n\n\nexport type TooltipOptions = {\n\thtml: boolean;\n\tdelayShow: TooltipOptional<number>;\n\tdelayHide: TooltipOptional<number>;\n\tlive: boolean;\n\tmanual: boolean;\n\tcheck_modifiers: boolean;\n\n\tlogger?: Logger;\n\n\t// TODO: Replace this with proper i18n.\n\ti18n?: {\n\t\tt: (key: string, phrase: string, data: any) => string;\n\t};\n\n\tcontainer?: HTMLElement;\n\n\ttooltipClass: string;\n\tinnerClass: string;\n\tarrowClass: string;\n\tarrowInner?: string;\n\n\tsanitizeChildren: boolean;\n\n\tpopper?: any;\n\tpopperConfig?: TipFunction<any, [any]>;\n\n\tno_update?: boolean;\n\tno_auto_remove?: boolean;\n\n\tcontent: ContentFunction;\n\tinteractive: TooltipOptional<boolean>;\n\thover_events: TooltipOptional<boolean>;\n\n\tonShow: TipFunction<void>;\n\tonHide: TipFunction<void>;\n\n\tonMove: TipFunction<void, [MouseEvent]>;\n\tonHover: TipFunction<void, [MouseEvent]>;\n\tonLeave: TipFunction<void, [MouseEvent]>;\n\n}\n\n\nexport interface TooltipInstance {\n\n\ttarget: HTMLElement;\n\tvisible: boolean;\n\n\telement: HTMLElement | null;\n\touter: HTMLElement | null;\n\n\talign?: string;\n\tadd_class?: string | string[];\n\n\tstate: boolean;\n\t_show_timer?: ReturnType<typeof setTimeout> | null;\n\n\tpopper?: Instance | null;\n\n\t_update: () => void;\n\t_waiter: (() => void) | null;\n\t_wait_promise: Promise<void> | null;\n\n\twaitForDom: () => Promise<void>;\n\tupdate: () => void;\n\tshow: () => void;\n\thide: () => void;\n\trerender: () => void;\n\n}\n\n// TODO: Narrow the return type. Need better types for createElement / setChildren\ntype ContentFunction = TipFunction<any>;\n\ntype TipFunction<TReturn = unknown, TArgs extends any[] = []> = (target: HTMLElement, tip: TooltipInstance, ...extra: TArgs) => TReturn;\n\n\ntype MouseEventHandler = (event: MouseEvent) => void;\ntype KeyboardEventHandler = (event: KeyboardEvent) => void;\n\n// ============================================================================\n// Tooltip Class\n// ============================================================================\n\nexport class Tooltip {\n\n\tcls: Element | Element[] | string;\n\n\toptions: TooltipOptions;\n\tlive: boolean;\n\n\tparent: HTMLElement;\n\tcontainer: HTMLElement;\n\telements: Set<HTMLElement>;\n\n\tprivate _accessor: string;\n\n\tprivate _onMouseOut: MouseEventHandler;\n\tprivate _onMouseOver?: MouseEventHandler;\n\tprivate _keyUpdate?: KeyboardEventHandler | null;\n\n\tshift_state: boolean = false;\n\tctrl_state: boolean = false;\n\n\tprivate _shift_af?: ReturnType<typeof requestAnimationFrame> | null;\n\n\n\tconstructor(parent: HTMLElement | string | null, cls: HTMLElement | HTMLElement[] | string, options: Partial<TooltipOptions>) {\n\t\tif ( typeof parent === 'string' )\n\t\t\tparent = document.querySelector(parent) as HTMLElement;\n\n\t\tif (!( parent instanceof HTMLElement ))\n\t\t\tthrow new TypeError('invalid parent');\n\n\t\tthis.options = Object.assign({}, DefaultOptions, options) as TooltipOptions;\n\t\tthis.live = this.options.live;\n\n\t\tthis.parent = parent;\n\t\tthis.container = this.options.container || this.parent;\n\t\tthis.cls = cls;\n\n\t\tif ( this.options.check_modifiers )\n\t\t\tthis.installModifiers();\n\n\t\tif ( ! this.live ) {\n\t\t\tlet elements;\n\t\t\tif ( typeof cls === 'string' )\n\t\t\t\telements = Array.from(parent.querySelectorAll(cls)) as HTMLElement[];\n\t\t\telse if ( Array.isArray(cls) )\n\t\t\t\telements = cls;\n\t\t\telse if ( cls instanceof HTMLElement )\n\t\t\t\telements = [cls];\n\t\t\telse\n\t\t\t\tthrow new TypeError('invalid elements');\n\n\t\t\tthis.elements = new Set(elements);\n\n\t\t} else {\n\t\t\tthis.cls = cls;\n\t\t\tthis.elements = new Set;\n\t\t}\n\n\t\tthis._accessor = `_ffz_tooltip$${last_id++}`;\n\n\t\tthis._onMouseOut = e => {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif ( target && target.dataset?.forceOpen !== 'true' )\n\t\t\t\treturn this._exit(target);\n\t\t};\n\n\t\tif ( this.options.manual ) {\n\t\t\t// Do nothing~!\n\n\t\t} else if ( this.live ) {\n\t\t\tthis._onMouseOver = e => {\n\t\t\t\tthis.updateShift(e.shiftKey, e.ctrlKey);\n\t\t\t\tconst target = e.target as HTMLElement;\n\t\t\t\tif ( target && target.classList && target.classList.contains(this.cls as string) && target.dataset?.forceOpen !== 'true' ) {\n\t\t\t\t\tthis._enter(target);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tparent.addEventListener('mouseover', this._onMouseOver);\n\t\t\tparent.addEventListener('mouseout', this._onMouseOut);\n\n\t\t} else {\n\t\t\tthis._onMouseOver = e => {\n\t\t\t\tthis.updateShift(e.shiftKey, e.ctrlKey);\n\t\t\t\tconst target = e.target as HTMLElement;\n\t\t\t\tif ( this.elements.has(target) && target.dataset.forceOpen !== 'true' )\n\t\t\t\t\tthis._enter(target);\n\t\t\t}\n\n\t\t\tif ( this.elements.size <= 5 )\n\t\t\t\tfor(const el of this.elements) {\n\t\t\t\t\tel.addEventListener('mouseenter', this._onMouseOver);\n\t\t\t\t\tel.addEventListener('mouseleave', this._onMouseOut);\n\t\t\t\t}\n\n\t\t\telse {\n\t\t\t\tparent.addEventListener('mouseover', this._onMouseOver);\n\t\t\t\tparent.addEventListener('mouseout', this._onMouseOut);\n\t\t\t}\n\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis.removeModifiers();\n\n\t\tif ( this.options.manual ) {\n\t\t\t// Do nothing~!\n\t\t} else if ( this.live || this.elements.size > 5 ) {\n\t\t\tif ( this._onMouseOver )\n\t\t\t\tthis.parent.removeEventListener('mouseover', this._onMouseOver);\n\t\t\tthis.parent.removeEventListener('mouseout', this._onMouseOut);\n\t\t} else\n\t\t\tfor(const el of this.elements) {\n\t\t\t\tif ( this._onMouseOver )\n\t\t\t\t\tel.removeEventListener('mouseenter', this._onMouseOver);\n\t\t\t\tel.removeEventListener('mouseleave', this._onMouseOut);\n\t\t\t}\n\n\t\tfor(const el of this.elements) {\n\t\t\tconst tip = (el as any)[this._accessor] as TooltipInstance;\n\t\t\tif ( tip && tip.visible )\n\t\t\t\tthis.hide(tip);\n\n\t\t\t(el as any)[this._accessor] = null;\n\t\t\tel._ffz_tooltip = null;\n\t\t}\n\n\t\t// Lazy types. We don't care.\n\t\tthis.elements = null as any;\n\t\tthis._onMouseOut = this._onMouseOver = null as any;\n\t\tthis.container = null as any;\n\t\tthis.parent = null as any;\n\t}\n\n\n\tinstallModifiers() {\n\t\tif ( this._keyUpdate )\n\t\t\treturn;\n\n\t\tthis._keyUpdate = e => this.updateShift(e.shiftKey, e.ctrlKey);\n\t\twindow.addEventListener('keydown', this._keyUpdate);\n\t\twindow.addEventListener('keyup', this._keyUpdate);\n\t}\n\n\tremoveModifiers() {\n\t\tif ( ! this._keyUpdate )\n\t\t\treturn;\n\n\t\twindow.removeEventListener('keydown', this._keyUpdate);\n\t\twindow.removeEventListener('keyup', this._keyUpdate);\n\t\tthis._keyUpdate = null;\n\t}\n\n\tupdateShift(state: boolean, ctrl_state: boolean) {\n\t\tif ( state === this.shift_state && ctrl_state === this.ctrl_state )\n\t\t\treturn;\n\n\t\tthis.shift_state = state;\n\t\tthis.ctrl_state = ctrl_state;\n\n\t\tif ( ! this._shift_af )\n\t\t\tthis._shift_af = requestAnimationFrame(() => {\n\t\t\t\tthis._shift_af = null;\n\t\t\t\tif ( this.elements )\n\t\t\t\t\tfor(const el of this.elements) {\n\t\t\t\t\t\tconst tip = (el as any)[this._accessor] as TooltipInstance;\n\t\t\t\t\t\tif ( tip && tip.outer ) {\n\t\t\t\t\t\t\ttip.outer.dataset.shift = `${this.shift_state}`;\n\t\t\t\t\t\t\ttip.outer.dataset.ctrl = `${this.ctrl_state}`;\n\t\t\t\t\t\t\ttip.update();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t});\n\t}\n\n\n\tcleanup() {\n\t\tif ( this.options.manual || ! this.elements )\n\t\t\treturn;\n\n\t\tfor(const el of this.elements) {\n\t\t\tconst tip = (el as any)[this._accessor] as TooltipInstance;\n\t\t\tif ( document.body.contains(el) )\n\t\t\t\tcontinue;\n\n\t\t\tif ( tip && tip.visible )\n\t\t\t\tthis.hide(tip);\n\t\t}\n\t}\n\n\n\t_enter(target: HTMLElement) {\n\t\tlet tip = (target as any)[this._accessor] as TooltipInstance;\n\t\tif ( ! tip )\n\t\t\ttip = (target as any)[this._accessor] = {target} as TooltipInstance;\n\n\t\ttip.state = true;\n\n\t\tif ( tip._show_timer ) {\n\t\t\tclearTimeout(tip._show_timer);\n\t\t\ttip._show_timer = null;\n\t\t}\n\n\t\tif ( tip.visible )\n\t\t\treturn;\n\n\t\tconst delay = maybe_call(this.options.delayShow, null, target, tip);\n\n\t\tif ( delay === 0 )\n\t\t\tthis.show(tip);\n\n\t\telse\n\t\t\ttip._show_timer = setTimeout(() => {\n\t\t\t\ttip._show_timer = null;\n\t\t\t\tif ( tip.state )\n\t\t\t\t\tthis.show(tip);\n\t\t\t}, delay);\n\t}\n\n\t_exit(target: HTMLElement) {\n\t\tconst tip = (target as any)[this._accessor] as TooltipInstance;\n\t\tif ( ! tip )\n\t\t\treturn;\n\n\t\ttip.state = false;\n\n\t\tif ( tip._show_timer ) {\n\t\t\tclearTimeout(tip._show_timer);\n\t\t\ttip._show_timer = null;\n\t\t}\n\n\t\tif ( ! tip.visible )\n\t\t\treturn;\n\n\t\tconst delay = maybe_call(this.options.delayHide, null, target, tip);\n\n\t\tif ( delay === 0 )\n\t\t\tthis.hide(tip);\n\n\t\telse\n\t\t\ttip._show_timer = setTimeout(() => {\n\t\t\t\ttip._show_timer = null;\n\t\t\t\tif ( ! tip.state )\n\t\t\t\t\tthis.hide(tip);\n\n\t\t\t}, delay);\n\t}\n\n\n\tshow(tip: TooltipInstance) {\n\t\tconst opts = this.options,\n\t\t\ttarget = tip.target;\n\n\t\tthis.elements.add(target);\n\t\ttarget._ffz_tooltip = tip;\n\n\t\t// Set this early in case content uses it early.\n\t\ttip._wait_promise = null;\n\t\ttip.waitForDom = () => {\n\t\t\tif ( tip.element )\n\t\t\t\treturn Promise.resolve();\n\t\t\tif ( ! tip._wait_promise )\n\t\t\t\ttip._wait_promise = new Promise(resolve => tip._waiter = resolve);\n\t\t\treturn tip._wait_promise;\n\t\t};\n\t\ttip.update = () => tip._update(); // tip.popper && tip.popper.scheduleUpdate();\n\t\ttip.show = () => {\n\t\t\tlet tip = (target as any)[this._accessor] as TooltipInstance;\n\t\t\tif ( ! tip )\n\t\t\t\ttip = (target as any)[this._accessor] = {target} as TooltipInstance;\n\t\t\tthis.show(tip);\n\t\t};\n\t\ttip.hide = () => this.hide(tip);\n\t\ttip.rerender = () => {\n\t\t\tif ( tip.visible ) {\n\t\t\t\ttip.hide();\n\t\t\t\ttip.show();\n\t\t\t}\n\t\t};\n\n\t\tlet content = maybe_call(opts.content, null, target, tip);\n\t\tif ( content === undefined )\n\t\t\tcontent = tip.target.title;\n\n\t\tif ( tip.visible || content === NoContent || (! content && ! opts.onShow) )\n\t\t\treturn;\n\n\t\t// Build the DOM.\n\t\tconst arrow = createElement('div', {\n\t\t\tclassName: opts.arrowClass,\n\t\t\t'x-arrow': true\n\t\t}),\n\t\t\tinner = tip.element = createElement('div', opts.innerClass),\n\n\t\t\tel = tip.outer = createElement('div', {\n\t\t\t\tclassName: opts.tooltipClass,\n\t\t\t\t'data-shift': this.shift_state,\n\t\t\t\t'data-ctrl': this.ctrl_state\n\t\t\t}, [inner, arrow]);\n\n\t\tif ( opts.arrowInner )\n\t\t\tarrow.appendChild(createElement('div', opts.arrowInner));\n\n\t\tif ( tip.align )\n\t\t\tinner.classList.add(`${opts.innerClass}--align-${tip.align}`);\n\n\t\tif ( tip.add_class ) {\n\t\t\tfor(const cls of Array.isArray(tip.add_class) ? tip.add_class : [tip.add_class])\n\t\t\t\tinner.classList.add(cls);\n\t\t\ttip.add_class = undefined;\n\t\t}\n\n\t\tconst interactive = maybe_call(opts.interactive, null, target, tip),\n\t\t\thover_events = maybe_call(opts.hover_events, null, target, tip);\n\n\t\tel.classList.toggle('interactive', interactive || false);\n\n\t\tif ( ! opts.manual || (hover_events && (opts.onHover || opts.onLeave || opts.onMove)) ) {\n\t\t\tif ( hover_events && opts.onMove )\n\t\t\t\tel.addEventListener('mousemove', el._ffz_move_handler = event => {\n\t\t\t\t\tthis.updateShift(event.shiftKey, event.ctrlKey);\n\t\t\t\t\topts.onMove(target, tip, event);\n\t\t\t\t});\n\n\t\t\tel.addEventListener('mouseover', el._ffz_over_handler = event => {\n\t\t\t\tif ( ! opts.no_auto_remove && ! document.contains(target) )\n\t\t\t\t\tthis.hide(tip);\n\n\t\t\t\tif ( hover_events && opts.onHover )\n\t\t\t\t\topts.onHover(target, tip, event);\n\n\t\t\t\tif ( opts.manual ) {\n\t\t\t\t\t/* no-op */\n\t\t\t\t} else if ( maybe_call(opts.interactive, null, target, tip) )\n\t\t\t\t\tthis._enter(target);\n\t\t\t\telse if ( target.dataset.forceOpen !== 'true' )\n\t\t\t\t\tthis._exit(target);\n\t\t\t});\n\n\t\t\tel.addEventListener('mouseout', el._ffz_out_handler = event => {\n\t\t\t\tif ( hover_events && opts.onLeave )\n\t\t\t\t\topts.onLeave(target, tip, event);\n\n\t\t\t\tif ( ! opts.manual && target.dataset.forceOpen !== 'true' )\n\t\t\t\t\tthis._exit(target);\n\t\t\t});\n\t\t}\n\n\t\t// Assign our content. If there's a Promise, we'll need\n\t\t// to do this weirdly.\n\t\tconst use_html = maybe_call(opts.html, null, target, tip),\n\t\t\tsetter = use_html ? 'innerHTML' : 'textContent';\n\n\t\tconst modifiers = {\n\t\t\tflip: {\n\t\t\t\tbehavior: ['top', 'bottom', 'left', 'right']\n\t\t\t},\n\t\t\toffset: {\n\t\t\t\toffset: [0, 10]\n\t\t\t},\n\t\t\tarrow: {\n\t\t\t\telement: arrow\n\t\t\t}\n\t\t};\n\n\t\tlet pop_opts = Object.assign({\n\t\t\tmodifiers\n\t\t}, opts.popper);\n\n\t\tpop_opts.modifiers = Object.assign(modifiers, pop_opts.modifiers);\n\n\t\tif ( opts.popperConfig )\n\t\t\tpop_opts = opts.popperConfig(target, tip, pop_opts) ?? pop_opts;\n\n\t\tpop_opts.onUpdate = debounce(() => {\n\t\t\tif ( ! opts.no_auto_remove && ! document.contains(tip.target) )\n\t\t\t\tthis.hide(tip);\n\t\t}, 250);\n\n\t\tlet popper_target: any = target;\n\t\tif ( opts.no_update )\n\t\t\tpopper_target = makeReference(target);\n\n\t\ttip._update = () => {\n\t\t\tif ( tip.popper ) {\n\t\t\t\ttip.popper.forceUpdate();\n\t\t\t}\n\t\t}\n\n\t\tif ( tip._waiter )\n\t\t\ttip._waiter();\n\n\t\ttip._waiter = null;\n\t\ttip._wait_promise = null;\n\n\t\tif ( content instanceof Promise ) { //} || (content?.then && content.toString() === '[object Promise]') ) {\n\t\t\tinner.innerHTML = '<div class=\"ffz-i-zreknarf loader\"></div>';\n\t\t\tcontent.then(content => {\n\t\t\t\tif ( ! content )\n\t\t\t\t\treturn this.hide(tip);\n\n\t\t\t\tif ( use_html && (content instanceof Node || Array.isArray(content)) ) {\n\t\t\t\t\tinner.innerHTML = '';\n\t\t\t\t\tsetChildren(inner, content, opts.sanitizeChildren);\n\t\t\t\t} else\n\t\t\t\t\tinner[setter] = content;\n\n\t\t\t\ttip._update();\n\n\t\t\t}).catch(err => {\n\t\t\t\tif ( this.options.logger )\n\t\t\t\t\tthis.options.logger.error('Error rendering tooltip content.', err);\n\n\t\t\t\tif ( this.options.i18n )\n\t\t\t\t\tinner.textContent = this.options.i18n.t('tooltip.render-error', 'There was an error rendering this tooltip.\\n{err}', {err});\n\t\t\t\telse\n\t\t\t\t\tinner.textContent = `There was an error rendering this tooltip.\\n${err}`;\n\t\t\t\ttip._update();\n\t\t\t});\n\n\t\t} else if ( content ) {\n\t\t\tif ( use_html && (content instanceof Node || Array.isArray(content)) )\n\t\t\t\tsetChildren(inner, content, opts.sanitizeChildren);\n\t\t\telse\n\t\t\t\tinner[setter] = content;\n\t\t}\n\n\t\t// Format the modifiers how Popper wants them now.\n\t\tpop_opts.modifiers = normalizeModifiers(pop_opts.modifiers);\n\n\t\t// Add everything to the DOM and create the Popper instance.\n\t\ttip.popper = createPopper(popper_target, el, pop_opts);\n\t\tthis.container.appendChild(el);\n\t\ttip.visible = true;\n\n\t\tif ( opts.onShow )\n\t\t\topts.onShow(target, tip);\n\t}\n\n\n\thide(tip: TooltipInstance) {\n\t\tconst opts = this.options;\n\t\tif ( opts.onHide )\n\t\t\topts.onHide(tip.target, tip);\n\n\t\tif ( tip.popper ) {\n\t\t\ttip.popper.destroy();\n\t\t\ttip.popper = null;\n\t\t}\n\n\t\tif ( tip.outer ) {\n\t\t\tconst el = tip.outer;\n\t\t\tif ( el._ffz_over_handler )\n\t\t\t\tel.removeEventListener('mouseover', el._ffz_over_handler);\n\n\t\t\tif ( el._ffz_out_handler )\n\t\t\t\tel.removeEventListener('mouseout', el._ffz_out_handler);\n\n\t\t\tif ( el._ffz_move_handler )\n\t\t\t\tel.removeEventListener('mousemove', el._ffz_move_handler);\n\n\t\t\tel.remove();\n\t\t\ttip.outer = el._ffz_out_handler = el._ffz_over_handler = null;\n\t\t}\n\n\t\tif ( this.live && this.elements )\n\t\t\tthis.elements.delete(tip.target);\n\n\t\tif ( tip.target._ffz_tooltip === tip )\n\t\t\ttip.target._ffz_tooltip = null;\n\n\t\t(tip.target as any)[this._accessor] = null;\n\t\ttip._update = tip.rerender = tip.update = noop;\n\t\ttip.element = null;\n\t\ttip.visible = false;\n\t}\n}\n\nexport default Tooltip;\n\n\n// Is this gross? Yes.\n// You know what else is gross?\n// Popper's type definitions.\nexport function normalizeModifiers(input: any) {\n\tconst output: any[] = [];\n\n\tfor(const [key, val] of Object.entries(input)) {\n\t\tconst thing: any = {\n\t\t\tname: key\n\t\t};\n\n\t\tif (val && typeof val === 'object' && ! Array.isArray(val)) {\n\t\t\tif (has(val, 'enabled'))\n\t\t\t\tthing.enabled = (val as any).enabled;\n\n\t\t\tconst keys = Object.keys(val);\n\t\t\tif (keys.length > 1 || (keys.length === 1 && keys[0] !== 'enabled'))\n\t\t\t\tthing.options = val;\n\t\t}\n\n\t\toutput.push(thing);\n\t}\n\n\treturn output;\n}\n\n\nexport function makeReference(x: HTMLElement | number, y?: number, height: number = 0, width: number = 0) {\n\tlet _x: number;\n\n\tif ( x instanceof HTMLElement ) {\n\t\tconst rect = x.getBoundingClientRect();\n\t\t_x = rect.x;\n\t\ty = rect.y;\n\t\theight = rect.height;\n\t\twidth = rect.width;\n\t} else\n\t\t_x = x;\n\n\tconst out = {\n\t\tgetBoundingClientRect: () => ({\n\t\t\ttop: y,\n\t\t\tbottom: (y as number) + height,\n\t\t\ty,\n\t\t\tleft: _x,\n\t\t\tright: _x + width,\n\t\t\tx,\n\t\t\theight,\n\t\t\twidth\n\t\t}),\n\t\tclientWidth: width,\n\t\tclientHeight: height\n\t};\n\n\treturn out;\n}\n\n\n// Function Intentionally Left Blank\nfunction noop() { }\n","'use strict';\n\n// ============================================================================\n// Imports\n// ============================================================================\n\nimport dayjs from 'dayjs';\nimport RelativeTime from 'dayjs/plugin/relativeTime';\n\nimport {get} from 'utilities/object';\nimport {duration_to_string} from 'utilities/time';\n\nimport Parser, { MessageAST, MessageNode, MessageVariable, ParserOptions } from '@ffz/icu-msgparser';\n\ndayjs.extend(RelativeTime);\n\nconst DEFAULT_PARSER_OPTIONS = {\n\tallowTags: false,\n\trequireOther: false\n} as Partial<ParserOptions>;\n\n\nexport type TypeFormatter = (this: TranslationCore, val: any, node: MessageVariable, locale: string, out: any[], ast: MessageAST, data: any) => any;\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport const DEFAULT_TYPES: Record<string, TypeFormatter> = {\n\ttostring(val) {\n\t\treturn `${val}`\n\t},\n\n\tselect(val, node, locale, out, ast, data) {\n\t\tconst sub_ast = node.o && (node.o[val] || node.o.other);\n\t\tif ( ! sub_ast )\n\t\t\treturn undefined;\n\n\t\treturn this._processAST(sub_ast, data, locale);\n\t},\n\n\tplural(val, node, locale, out, ast, data) {\n\t\tconst sub_ast = node.o && (node.o[`=${val}`] || node.o[getCardinalName(locale, val)] || node.o.other);\n\t\tif ( ! sub_ast )\n\t\t\treturn undefined;\n\n\t\treturn this._processAST(sub_ast, data, locale);\n\t},\n\n\tselectordinal(val, node, locale, out, ast, data) {\n\t\tconst sub_ast = node.o && (node.o[`=${val}`] || node.o[getOrdinalName(locale, val)] || node.o.other);\n\t\tif ( ! sub_ast )\n\t\t\treturn undefined;\n\n\t\treturn this._processAST(sub_ast, data, locale);\n\t},\n\n\tnumber(val, node) {\n\t\tif ( typeof val !== 'number' ) {\n\t\t\tlet new_val = parseFloat(val);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\tnew_val = parseInt(val, 10);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\treturn val;\n\n\t\t\tval = new_val;\n\t\t}\n\n\t\treturn this.formatNumber(val, node.f as string);\n\t},\n\n\tcurrency(val, node) {\n\t\tif ( typeof val !== 'number' ) {\n\t\t\tlet new_val = parseFloat(val);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\tnew_val = parseInt(val, 10);\n\t\t\tif ( isNaN(new_val) || ! isFinite(new_val) )\n\t\t\t\treturn val;\n\n\t\t\tval = new_val;\n\t\t}\n\n\t\treturn this.formatCurrency(val, node.f as string);\n\t},\n\n\tdate(val, node) {\n\t\treturn this.formatDate(val, node.f as string);\n\t},\n\n\ttime(val, node) {\n\t\treturn this.formatTime(val, node.f as string);\n\t},\n\n\tdatetime(val, node) {\n\t\treturn this.formatDateTime(val, node.f as string);\n\t},\n\n\tduration(val) {\n\t\treturn this.formatDuration(val);\n\t},\n\n\tlocalestring(val) {\n\t\treturn this.toLocaleString(val);\n\t},\n\n\trelativetime(val, node) {\n\t\treturn this.formatRelativeTime(val, node.f as string);\n\t},\n\n\thumantime(val, node) {\n\t\treturn this.formatRelativeTime(val, node.f as string);\n\t},\n\n\ten_plural: (v: number) => v !== 1 ? 's' : ''\n}\n\n\n\n\nexport const DEFAULT_FORMATS = {\n\tnumber: {\n\t\tcurrency: {\n\t\t\tstyle: 'currency'\n\t\t},\n\t\tpercent: {\n\t\t\tstyle: 'percent'\n\t\t},\n\t\tlong_percent: {\n\t\t\tstyle: 'percent',\n\t\t\tminimumFractionDigits: 2\n\t\t}\n\t},\n\n\tdate: {\n\t\tshort: {\n\t\t\tmonth: 'numeric',\n\t\t\tday: 'numeric',\n\t\t\tyear: '2-digit'\n\t\t},\n\n\t\tdefault: {},\n\n\t\tmedium: {\n\t\t\tmonth: 'short',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t},\n\n\t\tlong: {\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t},\n\n\t\tfull: {\n\t\t\tweekday: 'long',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric'\n\t\t}\n\t},\n\n\ttime: {\n\t\tshort: {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric'\n\t\t},\n\n\t\tmedium: {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric'\n\t\t},\n\n\t\tfull: {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric',\n\t\t\ttimeZoneName: 'short'\n\t\t}\n\t},\n\n\tdatetime: {\n\t\tshort: {\n\t\t\tmonth: 'numeric',\n\t\t\tday: 'numeric',\n\t\t\tyear: '2-digit',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric'\n\t\t},\n\n\t\tmedium: {},\n\n\t\tlong: {\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric',\n\t\t\ttimeZoneName: 'short'\n\t\t},\n\n\t\tfull: {\n\t\t\tweekday: 'long',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric',\n\t\t\tyear: 'numeric',\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\tsecond: 'numeric',\n\t\t\ttimeZoneName: 'short'\n\t\t}\n\t}\n} as FormattingOptions;\n\n\n// ============================================================================\n// Options\n// ============================================================================\n\ntype WarningMethod = typeof console.warn;\n\ntype RecursivePhraseMap = {\n\t[key: string]: RecursivePhraseMap | string\n};\n\n\nexport type FormattingOptions = {\n\tnumber: Record<string, Intl.NumberFormatOptions>,\n\tdate: Record<string, Intl.DateTimeFormatOptions>,\n\ttime: Record<string, Intl.DateTimeFormatOptions>,\n\tdatetime: Record<string, Intl.DateTimeFormatOptions>\n};\n\n\nexport type TranslationOptions = {\n\twarn?: WarningMethod;\n\n\tlocale?: string;\n\tdayjsLocale?: string;\n\tdefaultLocale?: string;\n\n\ttypes?: Record<string, TypeFormatter>;\n\tformats?: Partial<FormattingOptions>;\n\tphrases?: RecursivePhraseMap;\n\n\tparserOptions?: Partial<ParserOptions>,\n\n\tdefaultDateFormat: string;\n\tdefaultTimeFormat: string;\n\tdefaultDateTimeFormat: string;\n}\n\nexport type ParseTranslationSettings = {\n\tnoCache?: boolean;\n\tthrowParse?: boolean;\n\tnoWarn?: boolean;\n}\n\n\n\n// ============================================================================\n// TranslationCore\n// ============================================================================\n\nexport class TranslationCore {\n\n\twarn?: WarningMethod;\n\n\tparser: Parser;\n\tphrases: Map<string, string>;\n\tcache: Map<string, MessageAST>;\n\n\ttransformation: ((key: string, ast: MessageAST) => MessageAST) | null;\n\n\ttypes: Record<string, TypeFormatter>;\n\tformats: FormattingOptions;\n\n\tprivate _locale: string;\n\tprivate _dayjs_locale: string;\n\n\tdefaultLocale: string;\n\tdefaultDateFormat: string;\n\tdefaultTimeFormat: string;\n\tdefaultDateTimeFormat: string;\n\n\tnumberFormats: Map<string, Intl.NumberFormat>;\n\tcurrencyFormats: Map<string, Intl.NumberFormat>;\n\n\tconstructor(options?: Partial<TranslationOptions>) {\n\t\toptions = options || {};\n\n\t\tthis.warn = options.warn;\n\t\tthis._locale = options.locale || 'en';\n\t\tthis._dayjs_locale = options.dayjsLocale || 'en';\n\t\tthis.defaultLocale = options.defaultLocale || this._locale;\n\t\tthis.transformation = null;\n\n\t\tthis.defaultDateFormat = options.defaultDateFormat ?? 'default';\n\t\tthis.defaultTimeFormat = options.defaultTimeFormat ?? 'short';\n\t\tthis.defaultDateTimeFormat = options.defaultDateTimeFormat ?? 'medium';\n\n\t\tthis.phrases = new Map;\n\t\tthis.cache = new Map;\n\n\t\tthis.numberFormats = new Map;\n\t\tthis.currencyFormats = new Map;\n\n\t\tthis.formats = Object.assign({}, DEFAULT_FORMATS);\n\t\tif ( options.formats ) {\n\t\t\t// I have no idea why the types are so picky here.\n\t\t\tconst keys = Object.keys(options.formats) as (keyof FormattingOptions)[];\n\t\t\tfor(const key of keys)\n\t\t\t\t(this.formats as any)[key] = Object.assign({}, this.formats[key], options.formats[key]);\n\t\t}\n\n\t\tthis.types = Object.assign({}, DEFAULT_TYPES, options.types || {});\n\t\tthis.parser = new Parser(Object.assign({}, DEFAULT_PARSER_OPTIONS, options.parserOptions));\n\n\t\tif ( options.phrases )\n\t\t\tthis.extend(options.phrases);\n\t}\n\n\tget locale() {\n\t\treturn this._locale;\n\t}\n\n\tset locale(val) {\n\t\tif ( val !== this._locale ) {\n\t\t\tthis._locale = val;\n\t\t\tthis.numberFormats.clear();\n\t\t\tthis.currencyFormats.clear();\n\t\t}\n\t}\n\n\ttoLocaleString(thing: any) {\n\t\tif ( thing?.toLocaleString )\n\t\t\treturn thing.toLocaleString(this._locale) as string;\n\t\telse if ( typeof thing !== 'string' )\n\t\t\treturn `${thing}`;\n\t\treturn thing;\n\t}\n\n\tformatRelativeTime(value: string | number | Date, format?: string) { // eslint-disable-line class-methods-use-this\n\t\tconst d = dayjs(value),\n\t\t\twithout_suffix = format === 'plain';\n\n\t\ttry {\n\t\t\treturn d.locale(this._dayjs_locale).fromNow(without_suffix);\n\t\t} catch(err) {\n\t\t\treturn d.fromNow(without_suffix);\n\t\t}\n\t}\n\n\tformatCurrency(value: number | bigint, currency: string) {\n\t\tlet formatter = this.currencyFormats.get(currency);\n\t\tif ( ! formatter ) {\n\t\t\tformatter = new Intl.NumberFormat(navigator.languages as string[], {\n\t\t\t\tstyle: 'currency',\n\t\t\t\tcurrency\n\t\t\t});\n\n\t\t\tthis.currencyFormats.set(currency, formatter);\n\t\t}\n\n\t\treturn formatter.format(value);\n\t}\n\n\tformatNumber(value: number | bigint, format: string) {\n\t\tlet formatter = this.numberFormats.get(format);\n\t\tif ( ! formatter ) {\n\t\t\tif ( this.formats.number[format] )\n\t\t\t\tformatter = new Intl.NumberFormat(this.locale, this.formats.number[format]);\n\t\t\telse if ( typeof format === 'number' )\n\t\t\t\tformatter = new Intl.NumberFormat(this.locale, {\n\t\t\t\t\tminimumFractionDigits: format,\n\t\t\t\t\tmaximumFractionDigits: format\n\t\t\t\t});\n\t\t\telse\n\t\t\t\tformatter = new Intl.NumberFormat(this.locale);\n\n\t\t\tthis.numberFormats.set(format, formatter);\n\t\t}\n\n\t\treturn formatter.format(value);\n\t}\n\n\tformatDuration(value: number) { // eslint-disable-line class-methods-use-this\n\t\treturn duration_to_string(value);\n\t}\n\n\tformatDate(value: string | number | Date, format?: string) {\n\t\tif ( ! format )\n\t\t\tformat = this.defaultDateFormat;\n\n\t\tif ( format && ! this.formats.date[format] ) {\n\t\t\tconst d = dayjs(value);\n\t\t\ttry {\n\t\t\t\treturn d.locale(this._dayjs_locale).format(format);\n\t\t\t} catch(err) {\n\t\t\t\treturn d.format(format);\n\t\t\t}\n\t\t}\n\n\t\tif ( !(value instanceof Date) )\n\t\t\tvalue = new Date(value);\n\n\t\treturn value.toLocaleDateString(this._locale, this.formats.date[format] || {});\n\t}\n\n\tformatTime(value: string | number | Date, format?: string) {\n\t\tif ( ! format )\n\t\t\tformat = this.defaultTimeFormat;\n\n\t\tif ( format && ! this.formats.time[format] ) {\n\t\t\tconst d = dayjs(value);\n\t\t\ttry {\n\t\t\t\treturn d.locale(this._dayjs_locale).format(format);\n\t\t\t} catch(err) {\n\t\t\t\treturn d.format(format);\n\t\t\t}\n\t\t}\n\n\t\tif ( !(value instanceof Date) )\n\t\t\tvalue = new Date(value);\n\n\t\treturn value.toLocaleTimeString(this._locale, this.formats.time[format] || {});\n\t}\n\n\tformatDateTime(value: string | number | Date, format?: string) {\n\t\tif ( ! format )\n\t\t\tformat = this.defaultDateTimeFormat;\n\n\t\tif ( format && ! this.formats.datetime[format] ) {\n\t\t\tconst d = dayjs(value);\n\t\t\ttry {\n\t\t\t\treturn d.locale(this._dayjs_locale).format(format);\n\t\t\t} catch(err) {\n\t\t\t\treturn d.format(format);\n\t\t\t}\n\t\t}\n\n\t\tif ( !(value instanceof Date) )\n\t\t\tvalue = new Date(value);\n\n\t\treturn value.toLocaleString(this._locale, this.formats.datetime[format] || {});\n\t}\n\n\textend(phrases: RecursivePhraseMap, prefix?: string) {\n\t\tconst added: string[] = [];\n\t\tif ( ! phrases || typeof phrases !== 'object' )\n\t\t\treturn added;\n\n\t\tfor(const key of Object.keys(phrases)) {\n\t\t\tconst full_key = prefix ? key === '_' ? prefix : `${prefix}.${key}` : key,\n\t\t\t\tphrase = phrases[key];\n\n\t\t\tif ( typeof phrase === 'object' )\n\t\t\t\tadded.push(...this.extend(phrase, full_key));\n\t\t\telse {\n\t\t\t\tlet parsed;\n\t\t\t\ttry {\n\t\t\t\t\tparsed = this.parser.parse(phrase);\n\t\t\t\t} catch(err) {\n\t\t\t\t\tif ( this.warn )\n\t\t\t\t\t\tthis.warn(`Error parsing i18n phrase for key \"${full_key}\": ${phrase}`, err);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.phrases.set(full_key, phrase);\n\t\t\t\tthis.cache.set(full_key, parsed);\n\t\t\t\tadded.push(full_key);\n\t\t\t}\n\t\t}\n\n\t\treturn added;\n\t}\n\n\tunset(phrases: string | string[], prefix: string) {\n\t\tif ( typeof phrases === 'string' )\n\t\t\tphrases = [phrases];\n\n\t\tconst keys = Array.isArray(phrases) ? phrases : Object.keys(phrases);\n\t\tfor(const key of keys) {\n\t\t\tconst full_key = prefix ? key === '_' ? prefix : `${prefix}.${key}` : key,\n\t\t\t\tphrase = (phrases as any)[key];\n\n\t\t\tif ( typeof phrase === 'object' )\n\t\t\t\tthis.unset(phrases, full_key);\n\t\t\telse {\n\t\t\t\tthis.phrases.delete(full_key);\n\t\t\t\tthis.cache.delete(full_key);\n\t\t\t}\n\t\t}\n\t}\n\n\thas(key: string) {\n\t\treturn this.phrases.has(key);\n\t}\n\n\tset(key: string, phrase: string) {\n\t\tconst parsed = this.parser.parse(phrase);\n\t\tthis.phrases.set(key, phrase);\n\t\tthis.cache.set(key, parsed);\n\t}\n\n\tclear() {\n\t\tthis.phrases.clear();\n\t\tthis.cache.clear();\n\t}\n\n\treplace(phrases: RecursivePhraseMap) {\n\t\tthis.clear();\n\t\tthis.extend(phrases);\n\t}\n\n\t_preTransform(\n\t\tkey: string,\n\t\tphrase: string,\n\t\toptions: any,\n\t\tsettings: ParseTranslationSettings = {}\n\t): [MessageAST, any, string] {\n\t\tlet ast: MessageAST,\n\t\t\tlocale: string,\n\t\t\tdata = options == null ? {} : options;\n\t\tif ( typeof data === 'number' )\n\t\t\tdata = {count: data};\n\n\t\tif ( ! settings.noCache && this.phrases.has(key) ) {\n\t\t\t// TODO: Remind myself why this exists.\n\t\t\tast = this.cache.get(key) ?? [];\n\t\t\tlocale = this.locale;\n\n\t\t} else if ( ! settings.noCache && this.cache.has(key) ) {\n\t\t\tast = this.cache.get(key) ?? [];\n\t\t\tlocale = this.defaultLocale;\n\n\t\t} else {\n\t\t\tlet parsed: MessageAST | null = null;\n\t\t\ttry {\n\t\t\t\tparsed = this.parser.parse(phrase);\n\t\t\t} catch(err) {\n\t\t\t\tif ( settings.throwParse )\n\t\t\t\t\tthrow err;\n\n\t\t\t\tif ( ! settings.noWarn && this.warn )\n\t\t\t\t\tthis.warn(`Error parsing i18n phrase for key \"${key}\": ${phrase}`, err);\n\n\t\t\t\tast = ['parsing error'];\n\t\t\t\tlocale = this.defaultLocale;\n\t\t\t}\n\n\t\t\tif ( parsed ) {\n\t\t\t\tast = parsed;\n\t\t\t\tlocale = this.locale;\n\n\t\t\t\tif ( ! settings.noCache ) {\n\t\t\t\t\tif ( this.locale === this.defaultLocale )\n\t\t\t\t\t\tthis.phrases.set(key, phrase);\n\n\t\t\t\t\tthis.cache.set(key, parsed);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// This should never happen unless bad data is supplied.\n\t\t\t\tast = [];\n\t\t\t\tlocale = this.defaultLocale;\n\t\t\t}\n\t\t}\n\n\t\tif ( this.transformation )\n\t\t\tast = this.transformation(key, ast);\n\n\t\treturn [ast, data, locale];\n\t}\n\n\tt(key: string, phrase: string, data: any, settings?: ParseTranslationSettings) {\n\t\treturn listToString(this.tList(key, phrase, data, settings));\n\t}\n\n\ttList(key: string, phrase: string, data: any, settings?: ParseTranslationSettings) {\n\t\treturn this._processAST(...this._preTransform(key, phrase, data, settings));\n\t}\n\n\tformatNode(\n\t\tnode: MessageNode,\n\t\tdata: any,\n\t\tlocale: string | null,\n\t\tout: any[],\n\t\tast: MessageAST\n\t) {\n\t\tif ( ! node || typeof node !== 'object' )\n\t\t\treturn node;\n\n\t\tif ( locale == null )\n\t\t\tlocale = this.locale;\n\n\t\tconst val = get(node.v, data);\n\t\tif ( val == null )\n\t\t\treturn null;\n\n\t\tif ( node.t ) {\n\t\t\tconst handler = this.types[node.t];\n\t\t\tif ( handler )\n\t\t\t\treturn handler.call(this, val, node as MessageVariable, locale, out, ast, data);\n\t\t\telse if ( this.warn )\n\t\t\t\tthis.warn(`Encountered unknown type \"${(node as MessageVariable).t}\" when formatting node.`);\n\t\t}\n\n\t\treturn val;\n\t}\n\n\t_processAST(ast: MessageAST, data: any, locale: string) {\n\t\tconst out = [];\n\n\t\tfor(const node of ast) {\n\t\t\tconst val = this.formatNode(node, data, locale, out, ast);\n\t\t\tif( val != null )\n\t\t\t\tout.push(val);\n\t\t}\n\n\t\treturn out;\n\t}\n\n}\n\nexport default TranslationCore;\n\n\nfunction listToString(list: any[]): string {\n\tif ( ! Array.isArray(list) )\n\t\treturn `${list}`;\n\n\treturn list.map(listToString).join('');\n}\n\n\n// ============================================================================\n// Plural Handling\n// ============================================================================\n\nlet cardinal_i18n: Intl.PluralRules | null = null,\n\tcardinal_locale: string | null = null;\n\nexport function getCardinalName(locale: string, input: number) {\n\tif ( ! cardinal_i18n || locale !== cardinal_locale ) {\n\t\tcardinal_i18n = new Intl.PluralRules(locale, {\n\t\t\ttype: 'cardinal'\n\t\t});\n\t\tcardinal_locale = locale;\n\t}\n\n\treturn cardinal_i18n.select(input);\n}\n\nlet ordinal_i18n: Intl.PluralRules | null = null,\n\tordinal_locale: string | null = null;\n\nexport function getOrdinalName(locale: string, input: number) {\n\tif ( ! ordinal_i18n || locale !== ordinal_locale ) {\n\t\tordinal_i18n = new Intl.PluralRules(locale, {\n\t\t\ttype: 'ordinal'\n\t\t});\n\t\tordinal_locale = locale;\n\t}\n\n\treturn ordinal_i18n.select(input);\n}\n","'use strict';\n\n// ============================================================================\n// Twitch Data\n// Get data, from Twitch.\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport {get, debounce, TranslatableError} from 'utilities/object';\nimport type Apollo from './compat/apollo';\nimport type { DocumentNode } from 'graphql';\n\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\n\t}\n\tinterface ModuleMap {\n\t\t'site.twitch_data': TwitchData;\n\t}\n}\n\ntype ID = string | number | null;\ntype LOGIN = string | null;\n\nexport type QueryResult<T> = {\n\tdata: T;\n\tloading: boolean;\n\tnetworkStatus: number;\n}\n\nexport type MutationResult<T> = {\n\tdata: T;\n\textensions: {\n\t\tdurationMilliseconds: number;\n\t\toperationName: string;\n\t\trequestID: string;\n\t}\n}\n\nexport type CategorySearch = {\n\ttotalCount: number;\n\tpageInfo: {\n\t\thasNextPage: boolean;\n\t}\n\tedges: {\n\t\tcursor: string;\n\t\tnode: TwitchCategory\n\t}[];\n}\n\nexport type FollowState = {\n\tdisableNotifications: boolean;\n\tfollowedAt: string;\n} | null;\n\nexport type TwitchBadge = {\n\tid: string;\n\timage1x: string;\n\timage2x: string;\n\timage4x: string;\n\tsetID: string;\n\ttitle: string;\n\tversion: string;\n\tclickURL: string | null;\n\tonClickAction: string | null;\n}\n\nexport type TwitchRecentBroadcast = {\n\tid: string;\n\ttitle: string | null;\n\tcreatedAt: string;\n\tpublishedAt: string | null;\n}\n\nexport type TwitchCategory = {\n\tid: string;\n\tname: string;\n\tdisplayName: string;\n\tboxArtURL: string;\n}\n\nexport type TwitchBasicUser = {\n\tid: string;\n\tlogin: string;\n\tdisplayName: string;\n\tprofileImageURL: string | null;\n\troles: {\n\t\tisPartner: boolean;\n\t}\n}\n\nexport type TwitchUser = {\n\tid: string;\n\tlogin: string;\n\tdisplayName: string;\n\tdescription: string | null;\n\tprofileImageURL: string | null;\n\tprofileViewCount: number;\n\tprimaryColorHex: string | null;\n\tbroadcastSettings: {\n\t\tid: string;\n\t\ttitle: string | null;\n\t\tgame: TwitchCategory | null;\n\t};\n\tstream: {\n\t\tid: string;\n\t\tpreviewImageURL: string\n\t} | null;\n\tfollowers: {\n\t\ttotalCount: number\n\t};\n\troles: {\n\t\tisAffiliate: boolean;\n\t\tisPartner: boolean;\n\t\tisStaff: boolean;\n\t};\n}\n\nexport type TwitchStreamCreatedAt = {\n\tid: string;\n\tcreatedAt: string;\n}\n\nexport type TwitchContentLabel = {\n\tid: string;\n\tlocalizedName: string;\n}\n\n\nexport type StoredPromise<T> = [\n\tPromise<T>,\n\t(value: T) => void,\n\t(reason?: any) => void\n]\n\n\n/**\n * TwitchData is a container for getting different types of Twitch data\n * @class TwitchData\n * @extends Module\n */\nexport default class TwitchData extends Module {\n\n\tapollo: Apollo = null!;\n\tsite: GenericModule = null!;\n\n\tprivate _waiting_user_ids: Map<string, StoredPromise<TwitchBasicUser | null>>;\n\tprivate _waiting_user_logins: Map<string, StoredPromise<TwitchBasicUser | null>>;\n\n\tprivate _waiting_stream_ids: Map<string, StoredPromise<TwitchStreamCreatedAt | null>>;\n\tprivate _waiting_stream_logins: Map<string, StoredPromise<TwitchStreamCreatedAt | null>>;\n\n\tprivate _waiting_flag_ids: Map<string, StoredPromise<TwitchContentLabel[] | null>>;\n\tprivate _waiting_flag_logins: Map<string, StoredPromise<TwitchContentLabel[] | null>>;\n\n\tprivate _loading_streams?: boolean;\n\tprivate _loading_flags?: boolean;\n\tprivate _loading_users?: boolean;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.site = this.parent as GenericModule;\n\n\t\tthis.inject('site.apollo');\n\n\t\tthis._waiting_user_ids = new Map;\n\t\tthis._waiting_user_logins = new Map;\n\n\t\tthis._waiting_stream_ids = new Map;\n\t\tthis._waiting_stream_logins = new Map;\n\n\t\tthis._waiting_flag_ids = new Map;\n\t\tthis._waiting_flag_logins = new Map;\n\n\t\t// Debounce our loading methods. We don't care that the\n\t\t// return types don't match, so just cast to any.\n\t\tthis._loadStreams = debounce(this._loadStreams, 50) as any;\n\t\tthis._loadStreamFlags = debounce(this._loadStreamFlags, 50) as any;\n\t\tthis._loadUsers = debounce(this._loadUsers, 50) as any;\n\t}\n\n\tqueryApollo<T = any>(\n\t\tquery: DocumentNode | {query: DocumentNode, variables: any},\n\t\tvariables?: any,\n\t\toptions?: any\n\t) {\n\t\tlet thing: {query: DocumentNode, variables: any};\n\t\tif ( ! variables && ! options && 'query' in query && query.query )\n\t\t\tthing = query;\n\t\telse {\n\t\t\tthing = {\n\t\t\t\tquery: query as DocumentNode,\n\t\t\t\tvariables\n\t\t\t};\n\n\t\t\tif ( options )\n\t\t\t\tthing = Object.assign(thing, options);\n\t\t}\n\n\t\treturn this.apollo.client.query(thing) as Promise<QueryResult<T>>;\n\t}\n\n\tmutate<T = any>(\n\t\tmutation: DocumentNode | {mutation: DocumentNode, variables: any},\n\t\tvariables?: any,\n\t\toptions?: any\n\t) {\n\t\tlet thing: {mutation: DocumentNode, variables: any};\n\t\tif ( ! variables && ! options && 'mutation' in mutation && mutation.mutation )\n\t\t\tthing = mutation;\n\t\telse {\n\t\t\tthing = {\n\t\t\t\tmutation: mutation as DocumentNode,\n\t\t\t\tvariables\n\t\t\t};\n\n\t\t\tif ( options )\n\t\t\t\tthing = Object.assign(thing, options);\n\t\t}\n\n\t\treturn this.apollo.client.mutate(thing) as Promise<MutationResult<T>>;\n\t}\n\n\tget languageCode(): string {\n\t\tconst session = this.site.getSession();\n\t\treturn session && session.languageCode || 'en'\n\t}\n\n\tget locale(): string {\n\t\tconst session = this.site.getSession();\n\t\treturn session && session.locale || 'en-US'\n\t}\n\n\n\t// ========================================================================\n\t// Badges\n\t// ========================================================================\n\n\t/**\n\t * Fetch all the global chat badges.\n\t */\n\tasync getBadges() {\n\t\tconst data = await this.queryApollo<{\n\t\t\tbadges: TwitchBadge[]\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/global-badges.gql')\n\t\t);\n\n\t\treturn data?.data?.badges;\n\t}\n\n\n\t// ========================================================================\n\t// Categories\n\t// ========================================================================\n\n\t/**\n\t * Find categories matching the search query\n\t *\n\t * @param query The category name to match\n\t * @param first How many results to return\n\t * @param cursor A cursor, to be used in fetching the next page of results.\n\t */\n\tasync getMatchingCategories(\n\t\tquery: string,\n\t\tfirst: number = 15,\n\t\tcursor: string | null = null\n\t) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tsearchCategories: CategorySearch\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/search-category.gql'),\n\t\t\t{\n\t\t\t\tquery,\n\t\t\t\tfirst,\n\t\t\t\tcursor\n\t\t\t}\n\t\t);\n\n\t\tconst items = get('data.searchCategories.edges.@each.node', data) ?? [],\n\t\t\tneedle = query.toLowerCase();\n\n\t\tif ( Array.isArray(items) )\n\t\t\titems.sort((a,b) => {\n\t\t\t\tconst a_match = a && (a.name?.toLowerCase?.() === needle || a?.displayName?.toLowerCase?.() === needle),\n\t\t\t\t\tb_match = a && (b.name?.toLowerCase?.() === needle || b?.displayName?.toLowerCase?.() === needle);\n\n\t\t\t\tif ( a_match && ! b_match ) return -1;\n\t\t\t\tif ( ! a_match && b_match ) return 1;\n\t\t\t\treturn 0;\n\t\t\t});\n\n\t\treturn {\n\t\t\tcursor: get('data.searchCategories.edges.@last.cursor', data),\n\t\t\titems,\n\t\t\tfinished: ! get('data.searchCategories.pageInfo.hasNextPage', data),\n\t\t\tcount: get('data.searchCategories.totalCount', data) || 0\n\t\t};\n\t}\n\n\t/**\n\t * Look up a category.\n\t *\n\t * @param id - the category id\n\t * @param name - the category name\n\t */\n\tasync getCategory(id?: ID, name?: string | null) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tgame: TwitchCategory | null\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/category-fetch.gql'),\n\t\t\t{ id, name }\n\t\t);\n\n\t\treturn data?.data?.game;\n\t}\n\n\n\t// ========================================================================\n\t// Chat\n\t// ========================================================================\n\n\t/**\n\t * Delete a chat message.\n\t *\n\t * @param channel_id The channel to delete it from.\n\t * @param message_id The message ID.\n\t */\n\tasync deleteChatMessage(\n\t\tchannel_id: ID,\n\t\tmessage_id: string\n\t) {\n\t\tchannel_id = String(channel_id);\n\n\t\tconst data = await this.mutate<{\n\t\t\tdeleteChatMessage: {\n\t\t\t\tresponseCode: string;\n\t\t\t}\n\t\t}>({\n\t\t\tmutation: await import(/* webpackChunkName: 'queries' */ './mutations/delete-chat-message.gql'),\n\t\t\tvariables: {\n\t\t\t\tinput: {\n\t\t\t\t\tchannelID: channel_id,\n\t\t\t\t\tmessageID: message_id\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst code = data?.data?.deleteChatMessage?.responseCode;\n\n\t\tif ( code === 'TARGET_IS_BROADCASTER' )\n\t\t\tthrow new TranslatableError(\n\t\t\t\t\"You cannot delete the broadcaster's messages.\",\n\t\t\t\t\"chat.delete.forbidden.broadcaster\"\n\t\t\t);\n\n\t\tif ( code === 'TARGET_IS_MODERATOR' )\n\t\t\tthrow new TranslatableError(\n\t\t\t\t\"You cannot delete messages from moderator {displayName}.\",\n\t\t\t\t\"chat.delete.forbidden.moderator\",\n\t\t\t\tget('data.deleteChatMessage.message.sender', data)\n\t\t\t);\n\n\t\tif ( code !== 'SUCCESS' )\n\t\t\tthrow new TranslatableError(\n\t\t\t\t\"You don't have permission to delete messages.\",\n\t\t\t\t\"chat.delete.forbidden\"\n\t\t\t);\n\n\t\treturn true;\n\t}\n\n\n\t// ========================================================================\n\t// Users\n\t// ========================================================================\n\n\t/**\n\t * Find users matching the search query.\n\t *\n\t * @param query Text to match in the login or display name\n\t * @param first How many results to return\n\t * @param cursor A cursor, to be used in fetching the next page of results.\n\t */\n\tasync getMatchingUsers(query: string, first = 15, cursor: string | null = null) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tsearchUsers: {\n\t\t\t\tedges: {\n\t\t\t\t\tcursor: string;\n\t\t\t\t\tnode: TwitchBasicUser;\n\t\t\t\t}[];\n\t\t\t\ttotalCount: number;\n\t\t\t\tpageInfo: {\n\t\t\t\t\thasNextPage: boolean;\n\t\t\t\t}\n\t\t\t}\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/search-user.gql'),\n\t\t\t{\n\t\t\t\tquery,\n\t\t\t\tfirst,\n\t\t\t\tcursor\n\t\t\t}\n\t\t);\n\n\t\tconst items = get('data.searchUsers.edges.@each.node', data) ?? [],\n\t\t\tneedle = query.toLowerCase();\n\n\t\tif ( Array.isArray(items) )\n\t\t\titems.sort((a,b) => {\n\t\t\t\tconst a_match = a && (a.login?.toLowerCase?.() === needle || a?.displayName?.toLowerCase?.() === needle),\n\t\t\t\t\tb_match = a && (b.login?.toLowerCase?.() === needle || b?.displayName?.toLowerCase?.() === needle);\n\n\t\t\t\tif ( a_match && ! b_match ) return -1;\n\t\t\t\tif ( ! a_match && b_match ) return 1;\n\t\t\t\treturn 0;\n\t\t\t});\n\n\t\treturn {\n\t\t\tcursor: get('data.searchUsers.edges.@last.cursor', data),\n\t\t\titems,\n\t\t\tfinished: ! get('data.searchUsers.pageInfo.hasNextPage', data),\n\t\t\tcount: get('data.searchUsers.totalCount', data) || 0\n\t\t};\n\t}\n\n\t/**\n\t * Fetch information about a user.\n\t *\n\t * @param id The user's ID\n\t * @param login The user's login\n\t */\n\tasync getUser(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tuser: TwitchUser | null\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/user-fetch.gql'),\n\t\t\t{ id, login }\n\t\t);\n\n\t\treturn data?.data?.user;\n\t}\n\n\t/**\n\t * Fetch a user's current game.\n\t *\n\t * @param id The user's ID\n\t * @param login The user's login\n\t */\n\tasync getUserGame(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tuser: {\n\t\t\t\tbroadcastSettings: {\n\t\t\t\t\tgame: TwitchCategory | null;\n\t\t\t\t}\n\t\t\t} | null;\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/user-game.gql'),\n\t\t\t{ id, login }\n\t\t);\n\n\t\treturn data?.data?.user?.broadcastSettings?.game;\n\t}\n\n\t/**\n\t * Look up the current user's moderator and editor status in a channel.\n\t *\n\t * @param id The target channel's ID\n\t * @param login The target channel's login\n\t */\n\tasync getUserSelf(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tuser: {\n\t\t\t\tself: {\n\t\t\t\t\tisEditor: boolean;\n\t\t\t\t\tisModerator: boolean;\n\t\t\t\t}\n\t\t\t} | null;\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/user-self.gql'),\n\t\t\t{ id, login }\n\t\t);\n\n\t\treturn data?.data?.user?.self;\n\t}\n\n\t/**\n\t * Look up if the current user follows a channel.\n\t *\n\t * @param id The target channel's ID\n\t * @param login The target channel's login\n\t */\n\tasync getUserFollowed(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tuser: {\n\t\t\t\tself: {\n\t\t\t\t\tfollower: FollowState;\n\t\t\t\t}\n\t\t\t} | null;\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/user-followed.gql'),\n\t\t\t{ id, login }\n\t\t);\n\n\t\treturn data?.data?.user?.self?.follower;\n\t}\n\n\t/**\n\t * Follow a channel.\n\t *\n\t * @param channel_id The target channel's ID\n\t * @param disable_notifications Whether or not notifications should be disabled.\n\t */\n\tasync followUser(channel_id: ID, disable_notifications = false) {\n\t\tchannel_id = String(channel_id);\n\t\tdisable_notifications = !! disable_notifications;\n\n\t\tconst data = await this.mutate<{\n\t\t\tfollowUser: {\n\t\t\t\tfollow: FollowState;\n\t\t\t\terror: {\n\t\t\t\t\tcode: string;\n\t\t\t\t} | null;\n\t\t\t}\n\t\t}>({\n\t\t\tmutation: await import(/* webpackChunkName: 'queries' */ './data/follow-user.gql'),\n\t\t\tvariables: {\n\t\t\t\tinput: {\n\t\t\t\t\ttargetID: channel_id,\n\t\t\t\t\tdisableNotifications: disable_notifications\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('follow result', data);\n\t\tconst err = data?.data?.followUser?.error;\n\t\tif ( err?.code )\n\t\t\tthrow new Error(err.code);\n\n\t\treturn data?.data?.followUser?.follow;\n\t}\n\n\t/**\n\t * Unfollow a channel.\n\t *\n\t * @param channel_id The target channel's ID\n\t */\n\tasync unfollowUser(channel_id: ID) {\n\t\tchannel_id = String(channel_id);\n\n\t\tconst data = await this.mutate<{\n\t\t\tunfollowUser: {\n\t\t\t\tfollow: FollowState;\n\t\t\t}\n\t\t}>({\n\t\t\tmutation: await import(/* webpackChunkName: 'queries' */ './data/unfollow-user.gql'),\n\t\t\tvariables: {\n\t\t\t\tinput: {\n\t\t\t\t\ttargetID: channel_id\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('unfollow result', data);\n\t\treturn data?.data?.unfollowUser?.follow;\n\t}\n\n\n\t/**\n\t * Fetch basic information about a channel's most recent broadcast.\n\t *\n\t * @param id The channel's ID\n\t * @param login The channel's login\n\t */\n\tasync getLastBroadcast(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tuser: {\n\t\t\t\tvideos: {\n\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\thasNextPage: boolean;\n\t\t\t\t\t}\n\t\t\t\t\tedges: {\n\t\t\t\t\t\tcursor: string;\n\t\t\t\t\t\tnode: TwitchRecentBroadcast;\n\t\t\t\t\t}[];\n\t\t\t\t}\n\t\t\t} | null\n\t\t}>(\n\t\t\tawait import(/* webpackChunkName: 'queries' */ './data/recent-broadcasts.gql'),\n\t\t\t{\n\t\t\t\tid, login,\n\t\t\t\ttype: 'ARCHIVE',\n\t\t\t\tsort: 'TIME',\n\t\t\t\tlimit: 1\n\t\t\t}\n\t\t);\n\n\t\treturn data?.data?.user?.videos?.edges?.[0]?.node;\n\t}\n\n\n\t/**\n\t * Fetch basic information on a user from Twitch. This is automatically batched\n\t * for performance, but not directly cached. Either an id or login must be provided.\n\t *\n\t * @param id The channel's ID\n\t * @param login The channel's login\n\t */\n\tgetUserBasic(id?: ID, login?: LOGIN) {\n\t\tlet store: Map<string, StoredPromise<TwitchBasicUser | null>>;\n\t\tlet retval: Promise<TwitchBasicUser | null>;\n\t\tlet key: string;\n\n\t\tif ( id ) {\n\t\t\tstore = this._waiting_user_ids;\n\t\t\tkey = String(id);\n\t\t} else if ( login ) {\n\t\t\tstore = this._waiting_user_logins;\n\t\t\tkey = login;\n\t\t} else\n\t\t\treturn Promise.reject('id and login cannot both be null');\n\n\t\tlet stored = store.get(key);\n\t\tif (stored)\n\t\t\treturn stored[0];\n\n\t\tlet success: (value: TwitchBasicUser | null) => void,\n\t\t\tfailure: (reason?: any) => void;\n\n\t\tretval = new Promise<TwitchBasicUser | null>((s, f) => {\n\t\t\tsuccess = s;\n\t\t\tfailure = f;\n\t\t});\n\n\t\tstore.set(key, [retval, success!, failure!]);\n\n\t\tif ( ! this._loading_users )\n\t\t\tthis._loadUsers();\n\n\t\treturn retval;\n\t}\n\n\tasync _loadUsers() {\n\t\tif ( this._loading_users )\n\t\t\treturn;\n\n\t\tthis._loading_users = true;\n\n\t\t// Get the first 50... things.\n\t\tconst ids = [...this._waiting_user_ids.keys()].slice(0, 50),\n\t\t\tremaining = 50 - ids.length,\n\t\t\tlogins = remaining > 0 ? [...this._waiting_user_logins.keys()].slice(0, remaining) : [];\n\n\t\tlet nodes: TwitchBasicUser[];\n\n\t\ttry {\n\t\t\tconst data = await this.queryApollo<{\n\t\t\t\tusers: TwitchBasicUser[]\n\t\t\t}>({\n\t\t\t\tquery: await import(/* webpackChunkName: 'queries' */ './data/user-bulk.gql'),\n\t\t\t\tvariables: {\n\t\t\t\t\tids: ids.length ? ids : null,\n\t\t\t\t\tlogins: logins.length ? logins : null\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnodes = data?.data?.users ?? [];\n\n\t\t} catch(err) {\n\t\t\tfor(const id of ids) {\n\t\t\t\tconst stored = this._waiting_user_ids.get(id);\n\t\t\t\tthis._waiting_user_ids.delete(id);\n\t\t\t\tif (stored)\n\t\t\t\t\tstored[2](err);\n\t\t\t}\n\n\t\t\tfor(const login of logins) {\n\t\t\t\tconst stored = this._waiting_user_logins.get(login);\n\t\t\t\tthis._waiting_user_logins.delete(login);\n\t\t\t\tif (stored)\n\t\t\t\t\tstored[2](err);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst id_set = new Set(ids),\n\t\t\tlogin_set = new Set(logins);\n\n\t\tif ( Array.isArray(nodes) )\n\t\t\tfor(const node of nodes) {\n\t\t\t\tif ( ! node || ! node.id )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tid_set.delete(node.id);\n\t\t\t\tlogin_set.delete(node.login);\n\n\t\t\t\tlet stored = this._waiting_user_ids.get(node.id);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_user_ids.delete(node.id);\n\t\t\t\t\tstored[1](node);\n\t\t\t\t}\n\n\t\t\t\tstored = this._waiting_user_logins.get(node.login);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_user_logins.delete(node.login);\n\t\t\t\t\tstored[1](node);\n\t\t\t\t}\n\t\t\t}\n\n\t\tfor(const id of id_set) {\n\t\t\tconst stored = this._waiting_user_ids.get(id);\n\t\t\tif ( stored ) {\n\t\t\t\tthis._waiting_user_ids.delete(id);\n\t\t\t\tstored[1](null);\n\t\t\t}\n\t\t}\n\n\t\tfor(const login of login_set) {\n\t\t\tconst stored = this._waiting_user_logins.get(login);\n\t\t\tif ( stored ) {\n\t\t\t\tthis._waiting_user_logins.delete(login);\n\t\t\t\tstored[1](null);\n\t\t\t}\n\t\t}\n\n\t\tthis._loading_users = false;\n\n\t\tif ( this._waiting_user_ids.size || this._waiting_user_logins.size )\n\t\t\tthis._loadUsers();\n\t}\n\n\n\t// ========================================================================\n\t// Broadcast ID\n\t// ========================================================================\n\n\t/**\n\t * Fetch the id of a channel's most recent broadcast.\n\t *\n\t * @param id The channel's ID\n\t * @param login The channel's login\n\t */\n\tasync getBroadcastID(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.getLastBroadcast(id, login);\n\t\treturn data?.id;\n\t}\n\n\n\tasync getChannelColor(id?: ID, login?: LOGIN) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tuser: {\n\t\t\t\tprimaryColorHex: string | null;\n\t\t\t} | null;\n\t\t}>({\n\t\t\tquery: await import(/* webpackChunkName: 'queries' */ './data/user-color.gql'),\n\t\t\tvariables: {\n\t\t\t\tid,\n\t\t\t\tlogin\n\t\t\t}\n\t\t});\n\n\t\treturn data?.data?.user?.primaryColorHex;\n\t}\n\n\n\t// ========================================================================\n\t// Polls\n\t// ========================================================================\n\n\t/**\n\t * Queries Apollo for information about the specified poll.\n\t * @function getPoll\n\t * @memberof TwitchData\n\t * @async\n\t *\n\t * @param {int|string} poll_id - the poll id number (can be an integer string)\n\t * @returns {Object} information about the specified poll\n\t *\n\t * @example\n\t *\n\t *  console.log(this.twitch_data.getPoll(1337));\n\t */\n\tasync getPoll(poll_id: ID) {\n\t\tconst data = await this.queryApollo({\n\t\t\tquery: await import(/* webpackChunkName: 'queries' */ './data/poll-get.gql'),\n\t\t\tvariables: {\n\t\t\t\tid: poll_id\n\t\t\t}\n\t\t});\n\n\t\treturn get('data.poll', data);\n\t}\n\n\t/**\n\t * Create a new poll\n\t * @function createPoll\n\t * @memberof TwitchData\n\t * @async\n\t *\n\t * @param {int|string} channel_id - the channel id number (can be an integer string)\n\t * @param {string} title - the poll title\n\t * @param {string[]} choices - an array of poll choices\n\t * @param {Object} [options] - an object containing poll options\n\t * @param {int} [options.bits=0] - how many bits it costs to vote\n\t * @param {int} [options.duration=60] - how long the poll will be held for, in seconds\n\t * @param {bool} [options.subscriberMultiplier=false] - whether to activate subsriber 2x multiplier\n\t * @param {bool} [options.subscriberOnly=false] - whether only subscribers may vote\n\t * @returns {Object} poll data\n\t *\n\t * @example\n\t *\n\t *  console.log(this.twitch_data.createPoll(19571641, \"Pick an option:\", [\"One\", \"Two\", \"Three\"], {bits: 10, duration: 120, subscriberMultiplier: false, subscriberOnly: true}));\n\t */\n\tasync createPoll(channel_id, title, choices, options = {}) {\n\t\tif ( typeof title !== 'string' )\n\t\t\tthrow new TypeError('title must be string');\n\n\t\tif ( ! Array.isArray(choices) || choices.some(x => typeof x !== 'string') )\n\t\t\tthrow new TypeError('choices must be array of strings');\n\n\t\tlet bits = options.bits || 0,\n\t\t\tduration = options.duration || 60;\n\t\tif ( typeof bits !== 'number' || bits < 0 )\n\t\t\tbits = 0;\n\t\tif ( typeof duration !== 'number' || duration < 0 )\n\t\t\tduration = 60;\n\n\t\tconst data = await this.mutate({\n\t\t\tmutation: await import(/* webpackChunkName: 'queries' */ './data/poll-create.gql'),\n\t\t\tvariables: {\n\t\t\t\tinput: {\n\t\t\t\t\tbitsCost: bits,\n\t\t\t\t\tbitsVoting: bits > 0,\n\t\t\t\t\tchoices: choices.map(x => ({title: x})),\n\t\t\t\t\tdurationSeconds: duration,\n\t\t\t\t\townedBy: `${channel_id}`,\n\t\t\t\t\tsubscriberMultiplier: options.subscriberMultiplier || false,\n\t\t\t\t\tsubscriberOnly: options.subscriberOnly || false,\n\t\t\t\t\ttitle\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn get('data.createPoll.poll', data);\n\t}\n\n\t/**\n\t * Place specified poll into archive\n\t * @function archivePoll\n\t * @memberof TwitchData\n\t * @async\n\t *\n\t * @param {int|string|null|undefined} poll_id - the poll id number (can be an integer string)\n\t * @returns {Object} information about the specified poll\n\t *\n\t * @example\n\t *\n\t *  console.log(this.twitch_data.archivePoll(1337));\n\t */\n\tasync archivePoll(poll_id) {\n\t\tconst data = await this.mutate({\n\t\t\tmutation: await import(/* webpackChunkName: 'queries' */ './data/poll-archive.gql'),\n\t\t\tvariables: {\n\t\t\t\tid: poll_id\n\t\t\t}\n\t\t});\n\n\t\treturn get('data.archivePoll.poll', data);\n\t}\n\n\t/**\n\t * Terminate specified poll\n\t * @function terminatePoll\n\t * @memberof TwitchData\n\t * @async\n\t *\n\t * @param {int|string|null|undefined} poll_id - the poll id number (can be an integer string)\n\t * @returns {Object} information about the specified poll\n\t *\n\t * @example\n\t *\n\t *  console.log(this.twitch_data.archivePoll(1337));\n\t */\n\tasync terminatePoll(poll_id) {\n\t\tconst data = await this.mutate({\n\t\t\tmutation: await import(/* webpackChunkName: 'queries' */ './data/poll-terminate.gql'),\n\t\t\tvariables: {\n\t\t\t\tid: poll_id\n\t\t\t}\n\t\t});\n\n\t\treturn get('data.terminatePoll.poll', data);\n\t}\n\n\n\t// ========================================================================\n\t// Stream Up-Type (Uptime and Type, for Directory Purposes)\n\t// ========================================================================\n\n\t/**\n\t * Fetch the stream id and creation time for a channel.\n\t *\n\t * @param id The channel's ID\n\t * @param login The channel's login\n\t */\n\tgetStreamMeta(id?: ID, login?: LOGIN) {\n\t\tlet store: Map<string, StoredPromise<TwitchStreamCreatedAt | null>>;\n\t\tlet retval: Promise<TwitchStreamCreatedAt | null>;\n\t\tlet key: string;\n\n\t\tif ( id ) {\n\t\t\tstore = this._waiting_stream_ids;\n\t\t\tkey = String(id);\n\t\t} else if ( login ) {\n\t\t\tstore = this._waiting_stream_logins;\n\t\t\tkey = login;\n\t\t} else\n\t\t\treturn Promise.reject('id and login cannot both be null');\n\n\t\tlet stored = store.get(key);\n\t\tif (stored)\n\t\t\treturn stored[0];\n\n\t\tlet success: (value: TwitchStreamCreatedAt | null) => void,\n\t\t\tfailure: (reason?: any) => void;\n\n\t\tretval = new Promise<TwitchStreamCreatedAt | null>((s, f) => {\n\t\t\tsuccess = s;\n\t\t\tfailure = f;\n\t\t});\n\n\t\tstore.set(key, [retval, success!, failure!]);\n\n\t\tif ( ! this._loading_streams )\n\t\t\tthis._loadStreams();\n\n\t\treturn retval;\n\t}\n\n\tasync _loadStreams() {\n\t\tif ( this._loading_streams )\n\t\t\treturn;\n\n\t\tthis._loading_streams = true;\n\n\t\t// Get the first 50... things.\n\t\tconst ids = [...this._waiting_stream_ids.keys()].slice(0, 50),\n\t\t\tremaining = 50 - ids.length,\n\t\t\tlogins = remaining > 0 ? [...this._waiting_stream_logins.keys()].slice(0, remaining) : [];\n\n\t\tlet nodes: {\n\t\t\tid: string;\n\t\t\tlogin: string;\n\t\t\tstream: TwitchStreamCreatedAt | null;\n\t\t}[];\n\n\t\ttry {\n\t\t\tconst data = await this.queryApollo<{\n\t\t\t\tusers: {\n\t\t\t\t\tid: string;\n\t\t\t\t\tlogin: string;\n\t\t\t\t\tstream: TwitchStreamCreatedAt | null;\n\t\t\t\t}[]\n\t\t\t}>({\n\t\t\t\tquery: await import(/* webpackChunkName: 'queries' */ './data/stream-fetch.gql'),\n\t\t\t\tvariables: {\n\t\t\t\t\tids: ids.length ? ids : null,\n\t\t\t\t\tlogins: logins.length ? logins : null\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnodes = data?.data?.users;\n\n\t\t} catch(err) {\n\t\t\tfor(const id of ids) {\n\t\t\t\tconst stored = this._waiting_stream_ids.get(id);\n\t\t\t\tthis._waiting_stream_ids.delete(id);\n\t\t\t\tif ( stored )\n\t\t\t\t\tstored[2](err);\n\t\t\t}\n\n\t\t\tfor(const login of logins) {\n\t\t\t\tconst stored = this._waiting_stream_logins.get(login);\n\t\t\t\tthis._waiting_stream_logins.delete(login);\n\t\t\t\tif ( stored )\n\t\t\t\t\tstored[2](err);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst id_set = new Set(ids),\n\t\t\tlogin_set = new Set(logins);\n\n\t\tif ( Array.isArray(nodes) )\n\t\t\tfor(const node of nodes) {\n\t\t\t\tif ( ! node || ! node.id )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tid_set.delete(node.id);\n\t\t\t\tlogin_set.delete(node.login);\n\n\t\t\t\tlet stored = this._waiting_stream_ids.get(node.id);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_stream_ids.delete(node.id);\n\t\t\t\t\tstored[1](node.stream);\n\t\t\t\t}\n\n\t\t\t\tstored = this._waiting_stream_logins.get(node.login);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_stream_logins.delete(node.login);\n\t\t\t\t\tstored[1](node.stream);\n\t\t\t\t}\n\t\t\t}\n\n\t\tfor(const id of id_set) {\n\t\t\tconst stored = this._waiting_stream_ids.get(id);\n\t\t\tif ( stored ) {\n\t\t\t\tthis._waiting_stream_ids.delete(id);\n\t\t\t\tstored[1](null);\n\t\t\t}\n\t\t}\n\n\t\tfor(const login of login_set) {\n\t\t\tconst stored = this._waiting_stream_logins.get(login);\n\t\t\tif ( stored ) {\n\t\t\t\tthis._waiting_stream_logins.delete(login);\n\t\t\t\tstored[1](null);\n\t\t\t}\n\t\t}\n\n\t\tthis._loading_streams = false;\n\n\t\tif ( this._waiting_stream_ids.size || this._waiting_stream_logins.size )\n\t\t\tthis._loadStreams();\n\t}\n\n\n\t// ========================================================================\n\t// Stream Content Flags (for Directory Purposes)\n\t// ========================================================================\n\n\t/**\n\t * Queries Apollo for stream content flags. One of (id, login) MUST be specified\n\t *\n\t * @param id - the channel id number (can be an integer string)\n\t * @param login - the channel name\n\t */\n\tgetStreamFlags(id?: ID, login?: LOGIN) {\n\t\tlet store: Map<string, StoredPromise<TwitchContentLabel[] | null>>;\n\t\tlet retval: Promise<TwitchContentLabel[] | null>;\n\t\tlet key: string;\n\n\t\tif ( id ) {\n\t\t\tstore = this._waiting_flag_ids;\n\t\t\tkey = String(id);\n\t\t} else if ( login ) {\n\t\t\tstore = this._waiting_flag_logins;\n\t\t\tkey = login;\n\t\t} else\n\t\t\treturn Promise.reject('id and login cannot both be null');\n\n\t\tlet stored = store.get(key);\n\t\tif (stored)\n\t\t\treturn stored[0];\n\n\t\tlet success: (value: TwitchContentLabel[] | null) => void,\n\t\t\tfailure: (reason?: any) => void;\n\n\t\tretval = new Promise<TwitchContentLabel[] | null>((s, f) => {\n\t\t\tsuccess = s;\n\t\t\tfailure = f;\n\t\t});\n\n\t\tstore.set(key, [retval, success!, failure!]);\n\n\t\tif ( ! this._loading_flags )\n\t\t\tthis._loadStreamFlags();\n\n\t\treturn retval;\n\t}\n\n\tasync _loadStreamFlags() {\n\t\tif ( this._loading_flags )\n\t\t\treturn;\n\n\t\tthis._loading_flags = true;\n\n\t\t// Get the first 50... things.\n\t\tconst ids = [...this._waiting_flag_ids.keys()].slice(0, 50),\n\t\t\tremaining = 50 - ids.length,\n\t\t\tlogins = remaining > 0 ? [...this._waiting_flag_logins.keys()].slice(0, remaining) : [];\n\n\t\tlet nodes: {\n\t\t\tid: string;\n\t\t\tlogin: string;\n\t\t\tstream: {\n\t\t\t\tcontentClassificationLabels: TwitchContentLabel[];\n\t\t\t} | null;\n\t\t}[];\n\n\t\ttry {\n\t\t\tconst data = await this.queryApollo<{\n\t\t\t\tusers: typeof nodes;\n\t\t\t}>({\n\t\t\t\tquery: await import(/* webpackChunkName: 'queries' */ './data/stream-flags.gql'),\n\t\t\t\tvariables: {\n\t\t\t\t\tids: ids.length ? ids : null,\n\t\t\t\t\tlogins: logins.length ? logins : null\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnodes = data?.data?.users;\n\n\t\t} catch(err) {\n\t\t\tfor(const id of ids) {\n\t\t\t\tconst stored = this._waiting_flag_ids.get(id);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_flag_ids.delete(id);\n\t\t\t\t\tstored[2](err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(const login of logins) {\n\t\t\t\tconst stored = this._waiting_flag_logins.get(login);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_flag_logins.delete(login);\n\t\t\t\t\tstored[2](err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst id_set = new Set(ids),\n\t\t\tlogin_set = new Set(logins);\n\n\t\tif ( Array.isArray(nodes) )\n\t\t\tfor(const node of nodes) {\n\t\t\t\tif ( ! node || ! node.id )\n\t\t\t\t\tcontinue;\n\n\t\t\t\tid_set.delete(node.id);\n\t\t\t\tlogin_set.delete(node.login);\n\n\t\t\t\tlet stored = this._waiting_flag_ids.get(node.id);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_flag_ids.delete(node.id);\n\t\t\t\t\tstored[1](node.stream?.contentClassificationLabels ?? null);\n\t\t\t\t}\n\n\t\t\t\tstored = this._waiting_flag_logins.get(node.login);\n\t\t\t\tif ( stored ) {\n\t\t\t\t\tthis._waiting_flag_logins.delete(node.login);\n\t\t\t\t\tstored[1](node.stream?.contentClassificationLabels ?? null);\n\t\t\t\t}\n\t\t\t}\n\n\t\tfor(const id of id_set) {\n\t\t\tconst stored = this._waiting_flag_ids.get(id);\n\t\t\tif ( stored ) {\n\t\t\t\tthis._waiting_flag_ids.delete(id);\n\t\t\t\tstored[1](null);\n\t\t\t}\n\t\t}\n\n\t\tfor(const login of login_set) {\n\t\t\tconst stored = this._waiting_flag_logins.get(login);\n\t\t\tif ( stored ) {\n\t\t\t\tthis._waiting_flag_logins.delete(login);\n\t\t\t\tstored[1](null);\n\t\t\t}\n\t\t}\n\n\t\tthis._loading_flags = false;\n\n\t\tif ( this._waiting_flag_ids.size || this._waiting_flag_logins.size )\n\t\t\tthis._loadStreamFlags();\n\t}\n\n\n\t// ========================================================================\n\t// Tags\n\t// ========================================================================\n\n\t/**\n\t * Fetch a list of matching tags.\n\t *\n\t * @param query The string to search for.\n\t */\n\tasync getMatchingTags(query: string) {\n\t\tconst data = await this.queryApollo<{\n\t\t\tsearchFreeformTags: {\n\t\t\t\tedges: {\n\t\t\t\t\tnode: {\n\t\t\t\t\t\ttagName: string;\n\t\t\t\t\t}\n\t\t\t\t}[];\n\t\t\t}\n\t\t}>({\n\t\t\tquery: await import(/* webpackChunkName: 'queries' */ './data/tag-search.gql'),\n\t\t\tvariables: {\n\t\t\t\tquery,\n\t\t\t\tfirst: 100\n\t\t\t}\n\t\t});\n\n\t\tconst edges = data?.data?.searchFreeformTags?.edges;\n\t\tif ( ! Array.isArray(edges) || ! edges.length )\n\t\t\treturn [];\n\n\t\tconst out: string[] = [];\n\t\tfor(const edge of edges) {\n\t\t\tconst tag = edge?.node?.tagName;\n\t\t\tif ( tag )\n\t\t\t\tout.push(tag);\n\t\t}\n\n\t\treturn out;\n\t}\n}\n","\n    var doc = {\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"FFZ_GetClipInfo\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"slug\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"clip\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"slug\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"slug\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"curator\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"broadcaster\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"game\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"title\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"thumbnailURL\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"width\"},\"value\":{\"kind\":\"IntValue\",\"value\":\"86\"}},{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"height\"},\"value\":{\"kind\":\"IntValue\",\"value\":\"45\"}}],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"viewCount\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":184}};\n    doc.loc.source = {\"body\":\"query FFZ_GetClipInfo($slug:ID!){clip(slug:$slug){id curator{id login displayName}broadcaster{id login displayName}game{id displayName}title thumbnailURL(width:86 height:45)viewCount}}\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}};\n  \n\n    var names = {};\n    function unique(defs) {\n      return defs.filter(\n        function(def) {\n          if (def.kind !== 'FragmentDefinition') return true;\n          var name = def.name.value\n          if (names[name]) {\n            return false;\n          } else {\n            names[name] = true;\n            return true;\n          }\n        }\n      )\n    }\n  \n\n    // Collect any fragment/type references from a node, adding them to the refs Set\n    function collectFragmentReferences(node, refs) {\n      if (node.kind === \"FragmentSpread\") {\n        refs.add(node.name.value);\n      } else if (node.kind === \"VariableDefinition\") {\n        var type = node.type;\n        if (type.kind === \"NamedType\") {\n          refs.add(type.name.value);\n        }\n      }\n\n      if (node.selectionSet) {\n        node.selectionSet.selections.forEach(function(selection) {\n          collectFragmentReferences(selection, refs);\n        });\n      }\n\n      if (node.variableDefinitions) {\n        node.variableDefinitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n\n      if (node.definitions) {\n        node.definitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n    }\n\n    var definitionRefs = {};\n    (function extractReferences() {\n      doc.definitions.forEach(function(def) {\n        if (def.name) {\n          var refs = new Set();\n          collectFragmentReferences(def, refs);\n          definitionRefs[def.name.value] = refs;\n        }\n      });\n    })();\n\n    function findOperation(doc, name) {\n      for (var i = 0; i < doc.definitions.length; i++) {\n        var element = doc.definitions[i];\n        if (element.name && element.name.value == name) {\n          return element;\n        }\n      }\n    }\n\n    function oneQuery(doc, operationName) {\n      // Copy the DocumentNode, but clear out the definitions\n      var newDoc = {\n        kind: doc.kind,\n        definitions: [findOperation(doc, operationName)]\n      };\n      if (doc.hasOwnProperty(\"loc\")) {\n        newDoc.loc = doc.loc;\n      }\n\n      // Now, for the operation we're running, find any fragments referenced by\n      // it or the fragments it references\n      var opRefs = definitionRefs[operationName] || new Set();\n      var allRefs = new Set();\n      var newRefs = new Set();\n\n      // IE 11 doesn't support \"new Set(iterable)\", so we add the members of opRefs to newRefs one by one\n      opRefs.forEach(function(refName) {\n        newRefs.add(refName);\n      });\n\n      while (newRefs.size > 0) {\n        var prevRefs = newRefs;\n        newRefs = new Set();\n\n        prevRefs.forEach(function(refName) {\n          if (!allRefs.has(refName)) {\n            allRefs.add(refName);\n            var childRefs = definitionRefs[refName] || new Set();\n            childRefs.forEach(function(childRef) {\n              newRefs.add(childRef);\n            });\n          }\n        });\n      }\n\n      allRefs.forEach(function(refName) {\n        var op = findOperation(doc, refName);\n        if (op) {\n          newDoc.definitions.push(op);\n        }\n      });\n\n      return newDoc;\n    }\n    \n    module.exports = doc;\n    \n        module.exports[\"FFZ_GetClipInfo\"] = oneQuery(doc, \"FFZ_GetClipInfo\");\n        \n","\n    var doc = {\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"FFZ_GetEmoteInfo\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emote\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"artist\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"owner\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"setID\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionProduct\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"state\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"owner\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}}]}}]}}]}}],\"loc\":{\"start\":0,\"end\":174}};\n    doc.loc.source = {\"body\":\"query FFZ_GetEmoteInfo($id:ID!){emote(id:$id){id artist{id login displayName}owner{id login displayName}setID text subscriptionProduct{id state owner{id login displayName}}}}\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}};\n  \n\n    var names = {};\n    function unique(defs) {\n      return defs.filter(\n        function(def) {\n          if (def.kind !== 'FragmentDefinition') return true;\n          var name = def.name.value\n          if (names[name]) {\n            return false;\n          } else {\n            names[name] = true;\n            return true;\n          }\n        }\n      )\n    }\n  \n\n    // Collect any fragment/type references from a node, adding them to the refs Set\n    function collectFragmentReferences(node, refs) {\n      if (node.kind === \"FragmentSpread\") {\n        refs.add(node.name.value);\n      } else if (node.kind === \"VariableDefinition\") {\n        var type = node.type;\n        if (type.kind === \"NamedType\") {\n          refs.add(type.name.value);\n        }\n      }\n\n      if (node.selectionSet) {\n        node.selectionSet.selections.forEach(function(selection) {\n          collectFragmentReferences(selection, refs);\n        });\n      }\n\n      if (node.variableDefinitions) {\n        node.variableDefinitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n\n      if (node.definitions) {\n        node.definitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n    }\n\n    var definitionRefs = {};\n    (function extractReferences() {\n      doc.definitions.forEach(function(def) {\n        if (def.name) {\n          var refs = new Set();\n          collectFragmentReferences(def, refs);\n          definitionRefs[def.name.value] = refs;\n        }\n      });\n    })();\n\n    function findOperation(doc, name) {\n      for (var i = 0; i < doc.definitions.length; i++) {\n        var element = doc.definitions[i];\n        if (element.name && element.name.value == name) {\n          return element;\n        }\n      }\n    }\n\n    function oneQuery(doc, operationName) {\n      // Copy the DocumentNode, but clear out the definitions\n      var newDoc = {\n        kind: doc.kind,\n        definitions: [findOperation(doc, operationName)]\n      };\n      if (doc.hasOwnProperty(\"loc\")) {\n        newDoc.loc = doc.loc;\n      }\n\n      // Now, for the operation we're running, find any fragments referenced by\n      // it or the fragments it references\n      var opRefs = definitionRefs[operationName] || new Set();\n      var allRefs = new Set();\n      var newRefs = new Set();\n\n      // IE 11 doesn't support \"new Set(iterable)\", so we add the members of opRefs to newRefs one by one\n      opRefs.forEach(function(refName) {\n        newRefs.add(refName);\n      });\n\n      while (newRefs.size > 0) {\n        var prevRefs = newRefs;\n        newRefs = new Set();\n\n        prevRefs.forEach(function(refName) {\n          if (!allRefs.has(refName)) {\n            allRefs.add(refName);\n            var childRefs = definitionRefs[refName] || new Set();\n            childRefs.forEach(function(childRef) {\n              newRefs.add(childRef);\n            });\n          }\n        });\n      }\n\n      allRefs.forEach(function(refName) {\n        var op = findOperation(doc, refName);\n        if (op) {\n          newDoc.definitions.push(op);\n        }\n      });\n\n      return newDoc;\n    }\n    \n    module.exports = doc;\n    \n        module.exports[\"FFZ_GetEmoteInfo\"] = oneQuery(doc, \"FFZ_GetEmoteInfo\");\n        \n","\n    var doc = {\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"FFZ_GetEmoteSetInfo\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emoteSet\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"owner\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionProducts\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emoteSetID\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"state\"},\"arguments\":[],\"directives\":[]}]}}]}}]}}]}}],\"loc\":{\"start\":0,\"end\":126}};\n    doc.loc.source = {\"body\":\"query FFZ_GetEmoteSetInfo($id:ID!){emoteSet(id:$id){id owner{id login displayName subscriptionProducts{id emoteSetID state}}}}\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}};\n  \n\n    var names = {};\n    function unique(defs) {\n      return defs.filter(\n        function(def) {\n          if (def.kind !== 'FragmentDefinition') return true;\n          var name = def.name.value\n          if (names[name]) {\n            return false;\n          } else {\n            names[name] = true;\n            return true;\n          }\n        }\n      )\n    }\n  \n\n    // Collect any fragment/type references from a node, adding them to the refs Set\n    function collectFragmentReferences(node, refs) {\n      if (node.kind === \"FragmentSpread\") {\n        refs.add(node.name.value);\n      } else if (node.kind === \"VariableDefinition\") {\n        var type = node.type;\n        if (type.kind === \"NamedType\") {\n          refs.add(type.name.value);\n        }\n      }\n\n      if (node.selectionSet) {\n        node.selectionSet.selections.forEach(function(selection) {\n          collectFragmentReferences(selection, refs);\n        });\n      }\n\n      if (node.variableDefinitions) {\n        node.variableDefinitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n\n      if (node.definitions) {\n        node.definitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n    }\n\n    var definitionRefs = {};\n    (function extractReferences() {\n      doc.definitions.forEach(function(def) {\n        if (def.name) {\n          var refs = new Set();\n          collectFragmentReferences(def, refs);\n          definitionRefs[def.name.value] = refs;\n        }\n      });\n    })();\n\n    function findOperation(doc, name) {\n      for (var i = 0; i < doc.definitions.length; i++) {\n        var element = doc.definitions[i];\n        if (element.name && element.name.value == name) {\n          return element;\n        }\n      }\n    }\n\n    function oneQuery(doc, operationName) {\n      // Copy the DocumentNode, but clear out the definitions\n      var newDoc = {\n        kind: doc.kind,\n        definitions: [findOperation(doc, operationName)]\n      };\n      if (doc.hasOwnProperty(\"loc\")) {\n        newDoc.loc = doc.loc;\n      }\n\n      // Now, for the operation we're running, find any fragments referenced by\n      // it or the fragments it references\n      var opRefs = definitionRefs[operationName] || new Set();\n      var allRefs = new Set();\n      var newRefs = new Set();\n\n      // IE 11 doesn't support \"new Set(iterable)\", so we add the members of opRefs to newRefs one by one\n      opRefs.forEach(function(refName) {\n        newRefs.add(refName);\n      });\n\n      while (newRefs.size > 0) {\n        var prevRefs = newRefs;\n        newRefs = new Set();\n\n        prevRefs.forEach(function(refName) {\n          if (!allRefs.has(refName)) {\n            allRefs.add(refName);\n            var childRefs = definitionRefs[refName] || new Set();\n            childRefs.forEach(function(childRef) {\n              newRefs.add(childRef);\n            });\n          }\n        });\n      }\n\n      allRefs.forEach(function(refName) {\n        var op = findOperation(doc, refName);\n        if (op) {\n          newDoc.definitions.push(op);\n        }\n      });\n\n      return newDoc;\n    }\n    \n    module.exports = doc;\n    \n        module.exports[\"FFZ_GetEmoteSetInfo\"] = oneQuery(doc, \"FFZ_GetEmoteSetInfo\");\n        \n","\n    var doc = {\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"FFZ_GetVideoInfo\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"video\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"title\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"previewThumbnailURL\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"width\"},\"value\":{\"kind\":\"IntValue\",\"value\":\"320\"}},{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"height\"},\"value\":{\"kind\":\"IntValue\",\"value\":\"180\"}}],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"lengthSeconds\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"publishedAt\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"viewCount\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"game\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"owner\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"profileImageURL\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"width\"},\"value\":{\"kind\":\"IntValue\",\"value\":\"50\"}}],\"directives\":[]}]}}]}}]}}],\"loc\":{\"start\":0,\"end\":207}};\n    doc.loc.source = {\"body\":\"query FFZ_GetVideoInfo($id:ID!){video(id:$id){id title previewThumbnailURL(width:320 height:180)lengthSeconds publishedAt viewCount game{id displayName}owner{id login displayName profileImageURL(width:50)}}}\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}};\n  \n\n    var names = {};\n    function unique(defs) {\n      return defs.filter(\n        function(def) {\n          if (def.kind !== 'FragmentDefinition') return true;\n          var name = def.name.value\n          if (names[name]) {\n            return false;\n          } else {\n            names[name] = true;\n            return true;\n          }\n        }\n      )\n    }\n  \n\n    // Collect any fragment/type references from a node, adding them to the refs Set\n    function collectFragmentReferences(node, refs) {\n      if (node.kind === \"FragmentSpread\") {\n        refs.add(node.name.value);\n      } else if (node.kind === \"VariableDefinition\") {\n        var type = node.type;\n        if (type.kind === \"NamedType\") {\n          refs.add(type.name.value);\n        }\n      }\n\n      if (node.selectionSet) {\n        node.selectionSet.selections.forEach(function(selection) {\n          collectFragmentReferences(selection, refs);\n        });\n      }\n\n      if (node.variableDefinitions) {\n        node.variableDefinitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n\n      if (node.definitions) {\n        node.definitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n    }\n\n    var definitionRefs = {};\n    (function extractReferences() {\n      doc.definitions.forEach(function(def) {\n        if (def.name) {\n          var refs = new Set();\n          collectFragmentReferences(def, refs);\n          definitionRefs[def.name.value] = refs;\n        }\n      });\n    })();\n\n    function findOperation(doc, name) {\n      for (var i = 0; i < doc.definitions.length; i++) {\n        var element = doc.definitions[i];\n        if (element.name && element.name.value == name) {\n          return element;\n        }\n      }\n    }\n\n    function oneQuery(doc, operationName) {\n      // Copy the DocumentNode, but clear out the definitions\n      var newDoc = {\n        kind: doc.kind,\n        definitions: [findOperation(doc, operationName)]\n      };\n      if (doc.hasOwnProperty(\"loc\")) {\n        newDoc.loc = doc.loc;\n      }\n\n      // Now, for the operation we're running, find any fragments referenced by\n      // it or the fragments it references\n      var opRefs = definitionRefs[operationName] || new Set();\n      var allRefs = new Set();\n      var newRefs = new Set();\n\n      // IE 11 doesn't support \"new Set(iterable)\", so we add the members of opRefs to newRefs one by one\n      opRefs.forEach(function(refName) {\n        newRefs.add(refName);\n      });\n\n      while (newRefs.size > 0) {\n        var prevRefs = newRefs;\n        newRefs = new Set();\n\n        prevRefs.forEach(function(refName) {\n          if (!allRefs.has(refName)) {\n            allRefs.add(refName);\n            var childRefs = definitionRefs[refName] || new Set();\n            childRefs.forEach(function(childRef) {\n              newRefs.add(childRef);\n            });\n          }\n        });\n      }\n\n      allRefs.forEach(function(refName) {\n        var op = findOperation(doc, refName);\n        if (op) {\n          newDoc.definitions.push(op);\n        }\n      });\n\n      return newDoc;\n    }\n    \n    module.exports = doc;\n    \n        module.exports[\"FFZ_GetVideoInfo\"] = oneQuery(doc, \"FFZ_GetVideoInfo\");\n        \n","\n    var doc = {\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"FFZ_EmoteCard\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"emoteID\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emote\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"emoteID\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"type\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"token\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"setID\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"artist\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"owner\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"login\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"channel\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"localEmoteSets\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emotes\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"token\"},\"arguments\":[],\"directives\":[]}]}}]}}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"stream\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"type\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"self\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"follower\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"followedAt\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionBenefit\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"tier\"},\"arguments\":[],\"directives\":[]}]}}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionProducts\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"displayName\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"tier\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"url\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emotes\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"token\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"priceInfo\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"currency\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"price\"},\"arguments\":[],\"directives\":[]}]}}]}}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"bitsBadgeTierSummary\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"threshold\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"self\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"isUnlocked\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"numberOfBitsUntilUnlock\"},\"arguments\":[],\"directives\":[]}]}}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"type\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":418}};\n    doc.loc.source = {\"body\":\"query FFZ_EmoteCard($emoteID:ID!){emote(id:$emoteID){id type token setID artist{id login displayName}owner{id login displayName channel{id localEmoteSets{id emotes{id token}}}stream{id type}self{follower{followedAt}subscriptionBenefit{id tier}}subscriptionProducts{id displayName tier name url emotes{id token}priceInfo{id currency price}}}bitsBadgeTierSummary{threshold self{isUnlocked numberOfBitsUntilUnlock}}type}}\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}};\n  \n\n    var names = {};\n    function unique(defs) {\n      return defs.filter(\n        function(def) {\n          if (def.kind !== 'FragmentDefinition') return true;\n          var name = def.name.value\n          if (names[name]) {\n            return false;\n          } else {\n            names[name] = true;\n            return true;\n          }\n        }\n      )\n    }\n  \n\n    // Collect any fragment/type references from a node, adding them to the refs Set\n    function collectFragmentReferences(node, refs) {\n      if (node.kind === \"FragmentSpread\") {\n        refs.add(node.name.value);\n      } else if (node.kind === \"VariableDefinition\") {\n        var type = node.type;\n        if (type.kind === \"NamedType\") {\n          refs.add(type.name.value);\n        }\n      }\n\n      if (node.selectionSet) {\n        node.selectionSet.selections.forEach(function(selection) {\n          collectFragmentReferences(selection, refs);\n        });\n      }\n\n      if (node.variableDefinitions) {\n        node.variableDefinitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n\n      if (node.definitions) {\n        node.definitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n    }\n\n    var definitionRefs = {};\n    (function extractReferences() {\n      doc.definitions.forEach(function(def) {\n        if (def.name) {\n          var refs = new Set();\n          collectFragmentReferences(def, refs);\n          definitionRefs[def.name.value] = refs;\n        }\n      });\n    })();\n\n    function findOperation(doc, name) {\n      for (var i = 0; i < doc.definitions.length; i++) {\n        var element = doc.definitions[i];\n        if (element.name && element.name.value == name) {\n          return element;\n        }\n      }\n    }\n\n    function oneQuery(doc, operationName) {\n      // Copy the DocumentNode, but clear out the definitions\n      var newDoc = {\n        kind: doc.kind,\n        definitions: [findOperation(doc, operationName)]\n      };\n      if (doc.hasOwnProperty(\"loc\")) {\n        newDoc.loc = doc.loc;\n      }\n\n      // Now, for the operation we're running, find any fragments referenced by\n      // it or the fragments it references\n      var opRefs = definitionRefs[operationName] || new Set();\n      var allRefs = new Set();\n      var newRefs = new Set();\n\n      // IE 11 doesn't support \"new Set(iterable)\", so we add the members of opRefs to newRefs one by one\n      opRefs.forEach(function(refName) {\n        newRefs.add(refName);\n      });\n\n      while (newRefs.size > 0) {\n        var prevRefs = newRefs;\n        newRefs = new Set();\n\n        prevRefs.forEach(function(refName) {\n          if (!allRefs.has(refName)) {\n            allRefs.add(refName);\n            var childRefs = definitionRefs[refName] || new Set();\n            childRefs.forEach(function(childRef) {\n              newRefs.add(childRef);\n            });\n          }\n        });\n      }\n\n      allRefs.forEach(function(refName) {\n        var op = findOperation(doc, refName);\n        if (op) {\n          newDoc.definitions.push(op);\n        }\n      });\n\n      return newDoc;\n    }\n    \n    module.exports = doc;\n    \n        module.exports[\"FFZ_EmoteCard\"] = oneQuery(doc, \"FFZ_EmoteCard\");\n        \n","\n    var doc = {\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"name\":{\"kind\":\"Name\",\"value\":\"FFZ_EmoteMenu_SubStatus\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"first\"}},\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Int\"}},\"directives\":[]},{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"after\"}},\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Cursor\"}},\"directives\":[]},{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"criteria\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionBenefitCriteriaInput\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"currentUser\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionBenefits\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"first\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"first\"}}},{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"after\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"after\"}}},{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"criteria\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"criteria\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"pageInfo\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"hasNextPage\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"edges\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"cursor\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"node\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"gift\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"isGift\"},\"arguments\":[],\"directives\":[]}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"purchasedWithPrime\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"endsAt\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"renewsAt\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"product\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"emoteSetID\"},\"arguments\":[],\"directives\":[]}]}}]}}]}}]}}]}}]}}],\"loc\":{\"start\":0,\"end\":296}};\n    doc.loc.source = {\"body\":\"query FFZ_EmoteMenu_SubStatus($first:Int$after:Cursor$criteria:SubscriptionBenefitCriteriaInput!){currentUser{id subscriptionBenefits(first:$first after:$after criteria:$criteria){pageInfo{hasNextPage}edges{cursor node{id gift{isGift}purchasedWithPrime endsAt renewsAt product{id emoteSetID}}}}}}\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}};\n  \n\n    var names = {};\n    function unique(defs) {\n      return defs.filter(\n        function(def) {\n          if (def.kind !== 'FragmentDefinition') return true;\n          var name = def.name.value\n          if (names[name]) {\n            return false;\n          } else {\n            names[name] = true;\n            return true;\n          }\n        }\n      )\n    }\n  \n\n    // Collect any fragment/type references from a node, adding them to the refs Set\n    function collectFragmentReferences(node, refs) {\n      if (node.kind === \"FragmentSpread\") {\n        refs.add(node.name.value);\n      } else if (node.kind === \"VariableDefinition\") {\n        var type = node.type;\n        if (type.kind === \"NamedType\") {\n          refs.add(type.name.value);\n        }\n      }\n\n      if (node.selectionSet) {\n        node.selectionSet.selections.forEach(function(selection) {\n          collectFragmentReferences(selection, refs);\n        });\n      }\n\n      if (node.variableDefinitions) {\n        node.variableDefinitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n\n      if (node.definitions) {\n        node.definitions.forEach(function(def) {\n          collectFragmentReferences(def, refs);\n        });\n      }\n    }\n\n    var definitionRefs = {};\n    (function extractReferences() {\n      doc.definitions.forEach(function(def) {\n        if (def.name) {\n          var refs = new Set();\n          collectFragmentReferences(def, refs);\n          definitionRefs[def.name.value] = refs;\n        }\n      });\n    })();\n\n    function findOperation(doc, name) {\n      for (var i = 0; i < doc.definitions.length; i++) {\n        var element = doc.definitions[i];\n        if (element.name && element.name.value == name) {\n          return element;\n        }\n      }\n    }\n\n    function oneQuery(doc, operationName) {\n      // Copy the DocumentNode, but clear out the definitions\n      var newDoc = {\n        kind: doc.kind,\n        definitions: [findOperation(doc, operationName)]\n      };\n      if (doc.hasOwnProperty(\"loc\")) {\n        newDoc.loc = doc.loc;\n      }\n\n      // Now, for the operation we're running, find any fragments referenced by\n      // it or the fragments it references\n      var opRefs = definitionRefs[operationName] || new Set();\n      var allRefs = new Set();\n      var newRefs = new Set();\n\n      // IE 11 doesn't support \"new Set(iterable)\", so we add the members of opRefs to newRefs one by one\n      opRefs.forEach(function(refName) {\n        newRefs.add(refName);\n      });\n\n      while (newRefs.size > 0) {\n        var prevRefs = newRefs;\n        newRefs = new Set();\n\n        prevRefs.forEach(function(refName) {\n          if (!allRefs.has(refName)) {\n            allRefs.add(refName);\n            var childRefs = definitionRefs[refName] || new Set();\n            childRefs.forEach(function(childRef) {\n              newRefs.add(childRef);\n            });\n          }\n        });\n      }\n\n      allRefs.forEach(function(refName) {\n        var op = findOperation(doc, refName);\n        if (op) {\n          newDoc.definitions.push(op);\n        }\n      });\n\n      return newDoc;\n    }\n    \n    module.exports = doc;\n    \n        module.exports[\"FFZ_EmoteMenu_SubStatus\"] = oneQuery(doc, \"FFZ_EmoteMenu_SubStatus\");\n        \n","/**\n * Mnemonist LRUCache\n * ===================\n *\n * JavaScript implementation of the LRU Cache data structure. To save up\n * memory and allocations this implementation represents its underlying\n * doubly-linked list as static arrays and pointers. Thus, memory is allocated\n * only once at instantiation and JS objects are never created to serve as\n * pointers. This also means this implementation does not trigger too many\n * garbage collections.\n *\n * Note that to save up memory, a LRU Cache can be implemented using a singly\n * linked list by storing predecessors' pointers as hashmap values.\n * However, this means more hashmap lookups and would probably slow the whole\n * thing down. What's more, pointers are not the things taking most space in\n * memory.\n */\nvar Iterator = require('obliterator/iterator'),\n    forEach = require('obliterator/foreach'),\n    typed = require('./utils/typed-arrays.js'),\n    iterables = require('./utils/iterables.js');\n\n/**\n * LRUCache.\n *\n * @constructor\n * @param {function} Keys     - Array class for storing keys.\n * @param {function} Values   - Array class for storing values.\n * @param {number}   capacity - Desired capacity.\n */\nfunction LRUCache(Keys, Values, capacity) {\n  if (arguments.length < 2) {\n    capacity = Keys;\n    Keys = null;\n    Values = null;\n  }\n\n  this.capacity = capacity;\n\n  if (typeof this.capacity !== 'number' || this.capacity <= 0)\n    throw new Error('mnemonist/lru-cache: capacity should be positive number.');\n  else if (!isFinite(this.capacity) || Math.floor(this.capacity) !== this.capacity)\n      throw new Error('mnemonist/lru-cache: capacity should be a finite positive integer.');\n\n  var PointerArray = typed.getPointerArray(capacity);\n\n  this.forward = new PointerArray(capacity);\n  this.backward = new PointerArray(capacity);\n  this.K = typeof Keys === 'function' ? new Keys(capacity) : new Array(capacity);\n  this.V = typeof Values === 'function' ? new Values(capacity) : new Array(capacity);\n\n  // Properties\n  this.size = 0;\n  this.head = 0;\n  this.tail = 0;\n  this.items = {};\n}\n\n/**\n * Method used to clear the structure.\n *\n * @return {undefined}\n */\nLRUCache.prototype.clear = function() {\n  this.size = 0;\n  this.head = 0;\n  this.tail = 0;\n  this.items = {};\n};\n\n/**\n * Method used to splay a value on top.\n *\n * @param  {number}   pointer - Pointer of the value to splay on top.\n * @return {LRUCache}\n */\nLRUCache.prototype.splayOnTop = function(pointer) {\n  var oldHead = this.head;\n\n  if (this.head === pointer)\n    return this;\n\n  var previous = this.backward[pointer],\n      next = this.forward[pointer];\n\n  if (this.tail === pointer) {\n    this.tail = previous;\n  }\n  else {\n    this.backward[next] = previous;\n  }\n\n  this.forward[previous] = next;\n\n  this.backward[oldHead] = pointer;\n  this.head = pointer;\n  this.forward[pointer] = oldHead;\n\n  return this;\n};\n\n/**\n * Method used to set the value for the given key in the cache.\n *\n * @param  {any} key   - Key.\n * @param  {any} value - Value.\n * @return {undefined}\n */\nLRUCache.prototype.set = function(key, value) {\n\n  // The key already exists, we just need to update the value and splay on top\n  var pointer = this.items[key];\n\n  if (typeof pointer !== 'undefined') {\n    this.splayOnTop(pointer);\n    this.V[pointer] = value;\n\n    return;\n  }\n\n  // The cache is not yet full\n  if (this.size < this.capacity) {\n    pointer = this.size++;\n  }\n\n  // Cache is full, we need to drop the last value\n  else {\n    pointer = this.tail;\n    this.tail = this.backward[pointer];\n    delete this.items[this.K[pointer]];\n  }\n\n  // Storing key & value\n  this.items[key] = pointer;\n  this.K[pointer] = key;\n  this.V[pointer] = value;\n\n  // Moving the item at the front of the list\n  this.forward[pointer] = this.head;\n  this.backward[this.head] = pointer;\n  this.head = pointer;\n};\n\n/**\n * Method used to set the value for the given key in the cache\n *\n * @param  {any} key   - Key.\n * @param  {any} value - Value.\n * @return {{evicted: boolean, key: any, value: any}} An object containing the\n * key and value of an item that was overwritten or evicted in the set\n * operation, as well as a boolean indicating whether it was evicted due to\n * limited capacity. Return value is null if nothing was evicted or overwritten\n * during the set operation.\n */\nLRUCache.prototype.setpop = function(key, value) {\n  var oldValue = null;\n  var oldKey = null;\n  // The key already exists, we just need to update the value and splay on top\n  var pointer = this.items[key];\n\n  if (typeof pointer !== 'undefined') {\n    this.splayOnTop(pointer);\n    oldValue = this.V[pointer];\n    this.V[pointer] = value;\n    return {evicted: false, key: key, value: oldValue};\n  }\n\n  // The cache is not yet full\n  if (this.size < this.capacity) {\n    pointer = this.size++;\n  }\n\n  // Cache is full, we need to drop the last value\n  else {\n    pointer = this.tail;\n    this.tail = this.backward[pointer];\n    oldValue = this.V[pointer];\n    oldKey = this.K[pointer];\n    delete this.items[this.K[pointer]];\n  }\n\n  // Storing key & value\n  this.items[key] = pointer;\n  this.K[pointer] = key;\n  this.V[pointer] = value;\n\n  // Moving the item at the front of the list\n  this.forward[pointer] = this.head;\n  this.backward[this.head] = pointer;\n  this.head = pointer;\n\n  // Return object if eviction took place, otherwise return null\n  if (oldKey) {\n    return {evicted: true, key: oldKey, value: oldValue};\n  }\n  else {\n    return null;\n  }\n};\n\n/**\n * Method used to check whether the key exists in the cache.\n *\n * @param  {any} key   - Key.\n * @return {boolean}\n */\nLRUCache.prototype.has = function(key) {\n  return key in this.items;\n};\n\n/**\n * Method used to get the value attached to the given key. Will move the\n * related key to the front of the underlying linked list.\n *\n * @param  {any} key   - Key.\n * @return {any}\n */\nLRUCache.prototype.get = function(key) {\n  var pointer = this.items[key];\n\n  if (typeof pointer === 'undefined')\n    return;\n\n  this.splayOnTop(pointer);\n\n  return this.V[pointer];\n};\n\n/**\n * Method used to get the value attached to the given key. Does not modify\n * the ordering of the underlying linked list.\n *\n * @param  {any} key   - Key.\n * @return {any}\n */\nLRUCache.prototype.peek = function(key) {\n    var pointer = this.items[key];\n\n    if (typeof pointer === 'undefined')\n        return;\n\n    return this.V[pointer];\n};\n\n/**\n * Method used to iterate over the cache's entries using a callback.\n *\n * @param  {function}  callback - Function to call for each item.\n * @param  {object}    scope    - Optional scope.\n * @return {undefined}\n */\nLRUCache.prototype.forEach = function(callback, scope) {\n  scope = arguments.length > 1 ? scope : this;\n\n  var i = 0,\n      l = this.size;\n\n  var pointer = this.head,\n      keys = this.K,\n      values = this.V,\n      forward = this.forward;\n\n  while (i < l) {\n\n    callback.call(scope, values[pointer], keys[pointer], this);\n    pointer = forward[pointer];\n\n    i++;\n  }\n};\n\n/**\n * Method used to create an iterator over the cache's keys from most\n * recently used to least recently used.\n *\n * @return {Iterator}\n */\nLRUCache.prototype.keys = function() {\n  var i = 0,\n      l = this.size;\n\n  var pointer = this.head,\n      keys = this.K,\n      forward = this.forward;\n\n  return new Iterator(function() {\n    if (i >= l)\n      return {done: true};\n\n    var key = keys[pointer];\n\n    i++;\n\n    if (i < l)\n      pointer = forward[pointer];\n\n    return {\n      done: false,\n      value: key\n    };\n  });\n};\n\n/**\n * Method used to create an iterator over the cache's values from most\n * recently used to least recently used.\n *\n * @return {Iterator}\n */\nLRUCache.prototype.values = function() {\n  var i = 0,\n      l = this.size;\n\n  var pointer = this.head,\n      values = this.V,\n      forward = this.forward;\n\n  return new Iterator(function() {\n    if (i >= l)\n      return {done: true};\n\n    var value = values[pointer];\n\n    i++;\n\n    if (i < l)\n      pointer = forward[pointer];\n\n    return {\n      done: false,\n      value: value\n    };\n  });\n};\n\n/**\n * Method used to create an iterator over the cache's entries from most\n * recently used to least recently used.\n *\n * @return {Iterator}\n */\nLRUCache.prototype.entries = function() {\n  var i = 0,\n      l = this.size;\n\n  var pointer = this.head,\n      keys = this.K,\n      values = this.V,\n      forward = this.forward;\n\n  return new Iterator(function() {\n    if (i >= l)\n      return {done: true};\n\n    var key = keys[pointer],\n        value = values[pointer];\n\n    i++;\n\n    if (i < l)\n      pointer = forward[pointer];\n\n    return {\n      done: false,\n      value: [key, value]\n    };\n  });\n};\n\n/**\n * Attaching the #.entries method to Symbol.iterator if possible.\n */\nif (typeof Symbol !== 'undefined')\n  LRUCache.prototype[Symbol.iterator] = LRUCache.prototype.entries;\n\n/**\n * Convenience known methods.\n */\nLRUCache.prototype.inspect = function() {\n  var proxy = new Map();\n\n  var iterator = this.entries(),\n      step;\n\n  while ((step = iterator.next(), !step.done))\n    proxy.set(step.value[0], step.value[1]);\n\n  // Trick so that node displays the name of the constructor\n  Object.defineProperty(proxy, 'constructor', {\n    value: LRUCache,\n    enumerable: false\n  });\n\n  return proxy;\n};\n\nif (typeof Symbol !== 'undefined')\n  LRUCache.prototype[Symbol.for('nodejs.util.inspect.custom')] = LRUCache.prototype.inspect;\n\n/**\n * Static @.from function taking an arbitrary iterable & converting it into\n * a structure.\n *\n * @param  {Iterable} iterable - Target iterable.\n * @param  {function} Keys     - Array class for storing keys.\n * @param  {function} Values   - Array class for storing values.\n * @param  {number}   capacity - Cache's capacity.\n * @return {LRUCache}\n */\nLRUCache.from = function(iterable, Keys, Values, capacity) {\n  if (arguments.length < 2) {\n    capacity = iterables.guessLength(iterable);\n\n    if (typeof capacity !== 'number')\n      throw new Error('mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.');\n  }\n  else if (arguments.length === 2) {\n    capacity = Keys;\n    Keys = null;\n    Values = null;\n  }\n\n  var cache = new LRUCache(Keys, Values, capacity);\n\n  forEach(iterable, function(value, key) {\n    cache.set(key, value);\n  });\n\n  return cache;\n};\n\n/**\n * Exporting.\n */\nmodule.exports = LRUCache;\n","/**\n * Mnemonist Iterable Function\n * ============================\n *\n * Harmonized iteration helpers over mixed iterable targets.\n */\nvar forEach = require('obliterator/foreach');\n\nvar typed = require('./typed-arrays.js');\n\n/**\n * Function used to determine whether the given object supports array-like\n * random access.\n *\n * @param  {any} target - Target object.\n * @return {boolean}\n */\nfunction isArrayLike(target) {\n  return Array.isArray(target) || typed.isTypedArray(target);\n}\n\n/**\n * Function used to guess the length of the structure over which we are going\n * to iterate.\n *\n * @param  {any} target - Target object.\n * @return {number|undefined}\n */\nfunction guessLength(target) {\n  if (typeof target.length === 'number')\n    return target.length;\n\n  if (typeof target.size === 'number')\n    return target.size;\n\n  return;\n}\n\n/**\n * Function used to convert an iterable to an array.\n *\n * @param  {any}   target - Iteration target.\n * @return {array}\n */\nfunction toArray(target) {\n  var l = guessLength(target);\n\n  var array = typeof l === 'number' ? new Array(l) : [];\n\n  var i = 0;\n\n  // TODO: we could optimize when given target is array like\n  forEach(target, function(value) {\n    array[i++] = value;\n  });\n\n  return array;\n}\n\n/**\n * Same as above but returns a supplementary indices array.\n *\n * @param  {any}   target - Iteration target.\n * @return {array}\n */\nfunction toArrayWithIndices(target) {\n  var l = guessLength(target);\n\n  var IndexArray = typeof l === 'number' ?\n    typed.getPointerArray(l) :\n    Array;\n\n  var array = typeof l === 'number' ? new Array(l) : [];\n  var indices = typeof l === 'number' ? new IndexArray(l) : [];\n\n  var i = 0;\n\n  // TODO: we could optimize when given target is array like\n  forEach(target, function(value) {\n    array[i] = value;\n    indices[i] = i++;\n  });\n\n  return [array, indices];\n}\n\n/**\n * Exporting.\n */\nexports.isArrayLike = isArrayLike;\nexports.guessLength = guessLength;\nexports.toArray = toArray;\nexports.toArrayWithIndices = toArrayWithIndices;\n","/**\n * Mnemonist Typed Array Helpers\n * ==============================\n *\n * Miscellaneous helpers related to typed arrays.\n */\n\n/**\n * When using an unsigned integer array to store pointers, one might want to\n * choose the optimal word size in regards to the actual numbers of pointers\n * to store.\n *\n * This helpers does just that.\n *\n * @param  {number} size - Expected size of the array to map.\n * @return {TypedArray}\n */\nvar MAX_8BIT_INTEGER = Math.pow(2, 8) - 1,\n    MAX_16BIT_INTEGER = Math.pow(2, 16) - 1,\n    MAX_32BIT_INTEGER = Math.pow(2, 32) - 1;\n\nvar MAX_SIGNED_8BIT_INTEGER = Math.pow(2, 7) - 1,\n    MAX_SIGNED_16BIT_INTEGER = Math.pow(2, 15) - 1,\n    MAX_SIGNED_32BIT_INTEGER = Math.pow(2, 31) - 1;\n\nexports.getPointerArray = function(size) {\n  var maxIndex = size - 1;\n\n  if (maxIndex <= MAX_8BIT_INTEGER)\n    return Uint8Array;\n\n  if (maxIndex <= MAX_16BIT_INTEGER)\n    return Uint16Array;\n\n  if (maxIndex <= MAX_32BIT_INTEGER)\n    return Uint32Array;\n\n  throw new Error('mnemonist: Pointer Array of size > 4294967295 is not supported.');\n};\n\nexports.getSignedPointerArray = function(size) {\n  var maxIndex = size - 1;\n\n  if (maxIndex <= MAX_SIGNED_8BIT_INTEGER)\n    return Int8Array;\n\n  if (maxIndex <= MAX_SIGNED_16BIT_INTEGER)\n    return Int16Array;\n\n  if (maxIndex <= MAX_SIGNED_32BIT_INTEGER)\n    return Int32Array;\n\n  return Float64Array;\n};\n\n/**\n * Function returning the minimal type able to represent the given number.\n *\n * @param  {number} value - Value to test.\n * @return {TypedArrayClass}\n */\nexports.getNumberType = function(value) {\n\n  // <= 32 bits itnteger?\n  if (value === (value | 0)) {\n\n    // Negative\n    if (Math.sign(value) === -1) {\n      if (value <= 127 && value >= -128)\n        return Int8Array;\n\n      if (value <= 32767 && value >= -32768)\n        return Int16Array;\n\n      return Int32Array;\n    }\n    else {\n\n      if (value <= 255)\n        return Uint8Array;\n\n      if (value <= 65535)\n        return Uint16Array;\n\n      return Uint32Array;\n    }\n  }\n\n  // 53 bits integer & floats\n  // NOTE: it's kinda hard to tell whether we could use 32bits or not...\n  return Float64Array;\n};\n\n/**\n * Function returning the minimal type able to represent the given array\n * of JavaScript numbers.\n *\n * @param  {array}    array  - Array to represent.\n * @param  {function} getter - Optional getter.\n * @return {TypedArrayClass}\n */\nvar TYPE_PRIORITY = {\n  Uint8Array: 1,\n  Int8Array: 2,\n  Uint16Array: 3,\n  Int16Array: 4,\n  Uint32Array: 5,\n  Int32Array: 6,\n  Float32Array: 7,\n  Float64Array: 8\n};\n\n// TODO: make this a one-shot for one value\nexports.getMinimalRepresentation = function(array, getter) {\n  var maxType = null,\n      maxPriority = 0,\n      p,\n      t,\n      v,\n      i,\n      l;\n\n  for (i = 0, l = array.length; i < l; i++) {\n    v = getter ? getter(array[i]) : array[i];\n    t = exports.getNumberType(v);\n    p = TYPE_PRIORITY[t.name];\n\n    if (p > maxPriority) {\n      maxPriority = p;\n      maxType = t;\n    }\n  }\n\n  return maxType;\n};\n\n/**\n * Function returning whether the given value is a typed array.\n *\n * @param  {any} value - Value to test.\n * @return {boolean}\n */\nexports.isTypedArray = function(value) {\n  return typeof ArrayBuffer !== 'undefined' && ArrayBuffer.isView(value);\n};\n\n/**\n * Function used to concat byte arrays.\n *\n * @param  {...ByteArray}\n * @return {ByteArray}\n */\nexports.concat = function() {\n  var length = 0,\n      i,\n      o,\n      l;\n\n  for (i = 0, l = arguments.length; i < l; i++)\n    length += arguments[i].length;\n\n  var array = new (arguments[0].constructor)(length);\n\n  for (i = 0, o = 0; i < l; i++) {\n    array.set(arguments[i], o);\n    o += arguments[i].length;\n  }\n\n  return array;\n};\n\n/**\n * Function used to initialize a byte array of indices.\n *\n * @param  {number}    length - Length of target.\n * @return {ByteArray}\n */\nexports.indices = function(length) {\n  var PointerArray = exports.getPointerArray(length);\n\n  var array = new PointerArray(length);\n\n  for (var i = 0; i < length; i++)\n    array[i] = i;\n\n  return array;\n};\n","/**\n * Obliterator ForEach Function\n * =============================\n *\n * Helper function used to easily iterate over mixed values.\n */\nvar support = require('./support.js');\n\nvar ARRAY_BUFFER_SUPPORT = support.ARRAY_BUFFER_SUPPORT;\nvar SYMBOL_SUPPORT = support.SYMBOL_SUPPORT;\n\n/**\n * Function able to iterate over almost any iterable JS value.\n *\n * @param  {any}      iterable - Iterable value.\n * @param  {function} callback - Callback function.\n */\nmodule.exports = function forEach(iterable, callback) {\n  var iterator, k, i, l, s;\n\n  if (!iterable) throw new Error('obliterator/forEach: invalid iterable.');\n\n  if (typeof callback !== 'function')\n    throw new Error('obliterator/forEach: expecting a callback.');\n\n  // The target is an array or a string or function arguments\n  if (\n    Array.isArray(iterable) ||\n    (ARRAY_BUFFER_SUPPORT && ArrayBuffer.isView(iterable)) ||\n    typeof iterable === 'string' ||\n    iterable.toString() === '[object Arguments]'\n  ) {\n    for (i = 0, l = iterable.length; i < l; i++) callback(iterable[i], i);\n    return;\n  }\n\n  // The target has a #.forEach method\n  if (typeof iterable.forEach === 'function') {\n    iterable.forEach(callback);\n    return;\n  }\n\n  // The target is iterable\n  if (\n    SYMBOL_SUPPORT &&\n    Symbol.iterator in iterable &&\n    typeof iterable.next !== 'function'\n  ) {\n    iterable = iterable[Symbol.iterator]();\n  }\n\n  // The target is an iterator\n  if (typeof iterable.next === 'function') {\n    iterator = iterable;\n    i = 0;\n\n    while (((s = iterator.next()), s.done !== true)) {\n      callback(s.value, i);\n      i++;\n    }\n\n    return;\n  }\n\n  // The target is a plain object\n  for (k in iterable) {\n    if (iterable.hasOwnProperty(k)) {\n      callback(iterable[k], k);\n    }\n  }\n\n  return;\n};\n","/**\n * Obliterator Iterator Class\n * ===========================\n *\n * Simple class representing the library's iterators.\n */\n\n/**\n * Iterator class.\n *\n * @constructor\n * @param {function} next - Next function.\n */\nfunction Iterator(next) {\n  if (typeof next !== 'function')\n    throw new Error('obliterator/iterator: expecting a function!');\n\n  this.next = next;\n}\n\n/**\n * If symbols are supported, we add `next` to `Symbol.iterator`.\n */\nif (typeof Symbol !== 'undefined')\n  Iterator.prototype[Symbol.iterator] = function () {\n    return this;\n  };\n\n/**\n * Returning an iterator of the given values.\n *\n * @param  {any...} values - Values.\n * @return {Iterator}\n */\nIterator.of = function () {\n  var args = arguments,\n    l = args.length,\n    i = 0;\n\n  return new Iterator(function () {\n    if (i >= l) return {done: true};\n\n    return {done: false, value: args[i++]};\n  });\n};\n\n/**\n * Returning an empty iterator.\n *\n * @return {Iterator}\n */\nIterator.empty = function () {\n  var iterator = new Iterator(function () {\n    return {done: true};\n  });\n\n  return iterator;\n};\n\n/**\n * Returning an iterator over the given indexed sequence.\n *\n * @param  {string|Array} sequence - Target sequence.\n * @return {Iterator}\n */\nIterator.fromSequence = function (sequence) {\n  var i = 0,\n    l = sequence.length;\n\n  return new Iterator(function () {\n    if (i >= l) return {done: true};\n\n    return {done: false, value: sequence[i++]};\n  });\n};\n\n/**\n * Returning whether the given value is an iterator.\n *\n * @param  {any} value - Value.\n * @return {boolean}\n */\nIterator.is = function (value) {\n  if (value instanceof Iterator) return true;\n\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    typeof value.next === 'function'\n  );\n};\n\n/**\n * Exporting.\n */\nmodule.exports = Iterator;\n","exports.ARRAY_BUFFER_SUPPORT = typeof ArrayBuffer !== 'undefined';\nexports.SYMBOL_SUPPORT = typeof Symbol !== 'undefined';\n","/**\n * Expose `pathToRegexp`.\n */\nmodule.exports = pathToRegexp\nmodule.exports.match = match\nmodule.exports.regexpToFunction = regexpToFunction\nmodule.exports.parse = parse\nmodule.exports.compile = compile\nmodule.exports.tokensToFunction = tokensToFunction\nmodule.exports.tokensToRegExp = tokensToRegExp\n\n/**\n * Default configs.\n */\nvar DEFAULT_DELIMITER = '/'\n\n/**\n * The main path matching regexp utility.\n *\n * @type {RegExp}\n */\nvar PATH_REGEXP = new RegExp([\n  // Match escaped characters that would otherwise appear in future matches.\n  // This allows the user to escape special characters that won't transform.\n  '(\\\\\\\\.)',\n  // Match Express-style parameters and un-named parameters with a prefix\n  // and optional suffixes. Matches appear as:\n  //\n  // \":test(\\\\d+)?\" => [\"test\", \"\\d+\", undefined, \"?\"]\n  // \"(\\\\d+)\"  => [undefined, undefined, \"\\d+\", undefined]\n  '(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))?|\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))([+*?])?'\n].join('|'), 'g')\n\n/**\n * Parse a string for the raw tokens.\n *\n * @param  {string}  str\n * @param  {Object=} options\n * @return {!Array}\n */\nfunction parse (str, options) {\n  var tokens = []\n  var key = 0\n  var index = 0\n  var path = ''\n  var defaultDelimiter = (options && options.delimiter) || DEFAULT_DELIMITER\n  var whitelist = (options && options.whitelist) || undefined\n  var pathEscaped = false\n  var res\n\n  while ((res = PATH_REGEXP.exec(str)) !== null) {\n    var m = res[0]\n    var escaped = res[1]\n    var offset = res.index\n    path += str.slice(index, offset)\n    index = offset + m.length\n\n    // Ignore already escaped sequences.\n    if (escaped) {\n      path += escaped[1]\n      pathEscaped = true\n      continue\n    }\n\n    var prev = ''\n    var name = res[2]\n    var capture = res[3]\n    var group = res[4]\n    var modifier = res[5]\n\n    if (!pathEscaped && path.length) {\n      var k = path.length - 1\n      var c = path[k]\n      var matches = whitelist ? whitelist.indexOf(c) > -1 : true\n\n      if (matches) {\n        prev = c\n        path = path.slice(0, k)\n      }\n    }\n\n    // Push the current path onto the tokens.\n    if (path) {\n      tokens.push(path)\n      path = ''\n      pathEscaped = false\n    }\n\n    var repeat = modifier === '+' || modifier === '*'\n    var optional = modifier === '?' || modifier === '*'\n    var pattern = capture || group\n    var delimiter = prev || defaultDelimiter\n\n    tokens.push({\n      name: name || key++,\n      prefix: prev,\n      delimiter: delimiter,\n      optional: optional,\n      repeat: repeat,\n      pattern: pattern\n        ? escapeGroup(pattern)\n        : '[^' + escapeString(delimiter === defaultDelimiter ? delimiter : (delimiter + defaultDelimiter)) + ']+?'\n    })\n  }\n\n  // Push any remaining characters.\n  if (path || index < str.length) {\n    tokens.push(path + str.substr(index))\n  }\n\n  return tokens\n}\n\n/**\n * Compile a string to a template function for the path.\n *\n * @param  {string}             str\n * @param  {Object=}            options\n * @return {!function(Object=, Object=)}\n */\nfunction compile (str, options) {\n  return tokensToFunction(parse(str, options), options)\n}\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nfunction match (str, options) {\n  var keys = []\n  var re = pathToRegexp(str, keys, options)\n  return regexpToFunction(re, keys)\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nfunction regexpToFunction (re, keys) {\n  return function (pathname, options) {\n    var m = re.exec(pathname)\n    if (!m) return false\n\n    var path = m[0]\n    var index = m.index\n    var params = {}\n    var decode = (options && options.decode) || decodeURIComponent\n\n    for (var i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue\n\n      var key = keys[i - 1]\n\n      if (key.repeat) {\n        params[key.name] = m[i].split(key.delimiter).map(function (value) {\n          return decode(value, key)\n        })\n      } else {\n        params[key.name] = decode(m[i], key)\n      }\n    }\n\n    return { path: path, index: index, params: params }\n  }\n}\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nfunction tokensToFunction (tokens, options) {\n  // Compile all the tokens into regexps.\n  var matches = new Array(tokens.length)\n\n  // Compile all the patterns before compilation.\n  for (var i = 0; i < tokens.length; i++) {\n    if (typeof tokens[i] === 'object') {\n      matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$', flags(options))\n    }\n  }\n\n  return function (data, options) {\n    var path = ''\n    var encode = (options && options.encode) || encodeURIComponent\n    var validate = options ? options.validate !== false : true\n\n    for (var i = 0; i < tokens.length; i++) {\n      var token = tokens[i]\n\n      if (typeof token === 'string') {\n        path += token\n        continue\n      }\n\n      var value = data ? data[token.name] : undefined\n      var segment\n\n      if (Array.isArray(value)) {\n        if (!token.repeat) {\n          throw new TypeError('Expected \"' + token.name + '\" to not repeat, but got array')\n        }\n\n        if (value.length === 0) {\n          if (token.optional) continue\n\n          throw new TypeError('Expected \"' + token.name + '\" to not be empty')\n        }\n\n        for (var j = 0; j < value.length; j++) {\n          segment = encode(value[j], token)\n\n          if (validate && !matches[i].test(segment)) {\n            throw new TypeError('Expected all \"' + token.name + '\" to match \"' + token.pattern + '\"')\n          }\n\n          path += (j === 0 ? token.prefix : token.delimiter) + segment\n        }\n\n        continue\n      }\n\n      if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n        segment = encode(String(value), token)\n\n        if (validate && !matches[i].test(segment)) {\n          throw new TypeError('Expected \"' + token.name + '\" to match \"' + token.pattern + '\", but got \"' + segment + '\"')\n        }\n\n        path += token.prefix + segment\n        continue\n      }\n\n      if (token.optional) continue\n\n      throw new TypeError('Expected \"' + token.name + '\" to be ' + (token.repeat ? 'an array' : 'a string'))\n    }\n\n    return path\n  }\n}\n\n/**\n * Escape a regular expression string.\n *\n * @param  {string} str\n * @return {string}\n */\nfunction escapeString (str) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, '\\\\$1')\n}\n\n/**\n * Escape the capturing group by escaping special characters and meaning.\n *\n * @param  {string} group\n * @return {string}\n */\nfunction escapeGroup (group) {\n  return group.replace(/([=!:$/()])/g, '\\\\$1')\n}\n\n/**\n * Get the flags for a regexp from the options.\n *\n * @param  {Object} options\n * @return {string}\n */\nfunction flags (options) {\n  return options && options.sensitive ? '' : 'i'\n}\n\n/**\n * Pull out keys from a regexp.\n *\n * @param  {!RegExp} path\n * @param  {Array=}  keys\n * @return {!RegExp}\n */\nfunction regexpToRegexp (path, keys) {\n  if (!keys) return path\n\n  // Use a negative lookahead to match only capturing groups.\n  var groups = path.source.match(/\\((?!\\?)/g)\n\n  if (groups) {\n    for (var i = 0; i < groups.length; i++) {\n      keys.push({\n        name: i,\n        prefix: null,\n        delimiter: null,\n        optional: false,\n        repeat: false,\n        pattern: null\n      })\n    }\n  }\n\n  return path\n}\n\n/**\n * Transform an array into a regexp.\n *\n * @param  {!Array}  path\n * @param  {Array=}  keys\n * @param  {Object=} options\n * @return {!RegExp}\n */\nfunction arrayToRegexp (path, keys, options) {\n  var parts = []\n\n  for (var i = 0; i < path.length; i++) {\n    parts.push(pathToRegexp(path[i], keys, options).source)\n  }\n\n  return new RegExp('(?:' + parts.join('|') + ')', flags(options))\n}\n\n/**\n * Create a path regexp from string input.\n *\n * @param  {string}  path\n * @param  {Array=}  keys\n * @param  {Object=} options\n * @return {!RegExp}\n */\nfunction stringToRegexp (path, keys, options) {\n  return tokensToRegExp(parse(path, options), keys, options)\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n *\n * @param  {!Array}  tokens\n * @param  {Array=}  keys\n * @param  {Object=} options\n * @return {!RegExp}\n */\nfunction tokensToRegExp (tokens, keys, options) {\n  options = options || {}\n\n  var strict = options.strict\n  var start = options.start !== false\n  var end = options.end !== false\n  var delimiter = options.delimiter || DEFAULT_DELIMITER\n  var endsWith = [].concat(options.endsWith || []).map(escapeString).concat('$').join('|')\n  var route = start ? '^' : ''\n\n  // Iterate over the tokens and create our regexp string.\n  for (var i = 0; i < tokens.length; i++) {\n    var token = tokens[i]\n\n    if (typeof token === 'string') {\n      route += escapeString(token)\n    } else {\n      var capture = token.repeat\n        ? '(?:' + token.pattern + ')(?:' + escapeString(token.delimiter) + '(?:' + token.pattern + '))*'\n        : token.pattern\n\n      if (keys) keys.push(token)\n\n      if (token.optional) {\n        if (!token.prefix) {\n          route += '(' + capture + ')?'\n        } else {\n          route += '(?:' + escapeString(token.prefix) + '(' + capture + '))?'\n        }\n      } else {\n        route += escapeString(token.prefix) + '(' + capture + ')'\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += '(?:' + escapeString(delimiter) + ')?'\n\n    route += endsWith === '$' ? '$' : '(?=' + endsWith + ')'\n  } else {\n    var endToken = tokens[tokens.length - 1]\n    var isEndDelimited = typeof endToken === 'string'\n      ? endToken[endToken.length - 1] === delimiter\n      : endToken === undefined\n\n    if (!strict) route += '(?:' + escapeString(delimiter) + '(?=' + endsWith + '))?'\n    if (!isEndDelimited) route += '(?=' + escapeString(delimiter) + '|' + endsWith + ')'\n  }\n\n  return new RegExp(route, flags(options))\n}\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n *\n * @param  {(string|RegExp|Array)} path\n * @param  {Array=}                keys\n * @param  {Object=}               options\n * @return {!RegExp}\n */\nfunction pathToRegexp (path, keys, options) {\n  if (path instanceof RegExp) {\n    return regexpToRegexp(path, keys)\n  }\n\n  if (Array.isArray(path)) {\n    return arrayToRegexp(/** @type {!Array} */ (path), keys, options)\n  }\n\n  return stringToRegexp(/** @type {string} */ (path), keys, options)\n}\n","var map = {\n\t\"./af.js\": [\n\t\t20179,\n\t\t1081\n\t],\n\t\"./am.js\": [\n\t\t61783,\n\t\t5380\n\t],\n\t\"./ar-dz.js\": [\n\t\t98136,\n\t\t5215\n\t],\n\t\"./ar-iq.js\": [\n\t\t82690,\n\t\t789\n\t],\n\t\"./ar-kw.js\": [\n\t\t62009,\n\t\t5151\n\t],\n\t\"./ar-ly.js\": [\n\t\t49408,\n\t\t1722\n\t],\n\t\"./ar-ma.js\": [\n\t\t87330,\n\t\t909\n\t],\n\t\"./ar-sa.js\": [\n\t\t66575,\n\t\t5012\n\t],\n\t\"./ar-tn.js\": [\n\t\t5742,\n\t\t8757\n\t],\n\t\"./ar.js\": [\n\t\t46567,\n\t\t3030\n\t],\n\t\"./az.js\": [\n\t\t14319,\n\t\t8736\n\t],\n\t\"./be.js\": [\n\t\t41737,\n\t\t2244\n\t],\n\t\"./bg.js\": [\n\t\t86835,\n\t\t6757\n\t],\n\t\"./bi.js\": [\n\t\t50045,\n\t\t8111\n\t],\n\t\"./bm.js\": [\n\t\t65561,\n\t\t9082\n\t],\n\t\"./bn.js\": [\n\t\t57602,\n\t\t4667\n\t],\n\t\"./bo.js\": [\n\t\t92594,\n\t\t3134\n\t],\n\t\"./br.js\": [\n\t\t34467,\n\t\t3968\n\t],\n\t\"./bs.js\": [\n\t\t53169,\n\t\t9248\n\t],\n\t\"./ca.js\": [\n\t\t97569,\n\t\t4178\n\t],\n\t\"./cs.js\": [\n\t\t30625,\n\t\t5123\n\t],\n\t\"./cv.js\": [\n\t\t6326,\n\t\t4060\n\t],\n\t\"./cy.js\": [\n\t\t49268,\n\t\t3166\n\t],\n\t\"./da.js\": [\n\t\t11559,\n\t\t4103\n\t],\n\t\"./de-at.js\": [\n\t\t12369,\n\t\t5954\n\t],\n\t\"./de-ch.js\": [\n\t\t71107,\n\t\t7168\n\t],\n\t\"./de.js\": [\n\t\t24569,\n\t\t300\n\t],\n\t\"./dv.js\": [\n\t\t25427,\n\t\t5528\n\t],\n\t\"./el.js\": [\n\t\t90524,\n\t\t1784\n\t],\n\t\"./en-au.js\": [\n\t\t29061,\n\t\t4634\n\t],\n\t\"./en-ca.js\": [\n\t\t31304,\n\t\t2928\n\t],\n\t\"./en-gb.js\": [\n\t\t84252,\n\t\t627\n\t],\n\t\"./en-ie.js\": [\n\t\t48757,\n\t\t2730\n\t],\n\t\"./en-il.js\": [\n\t\t98038,\n\t\t9\n\t],\n\t\"./en-in.js\": [\n\t\t7282,\n\t\t6644\n\t],\n\t\"./en-nz.js\": [\n\t\t97960,\n\t\t485\n\t],\n\t\"./en-sg.js\": [\n\t\t435,\n\t\t3949\n\t],\n\t\"./en-tt.js\": [\n\t\t90954,\n\t\t5818\n\t],\n\t\"./en.js\": [\n\t\t22039,\n\t\t427\n\t],\n\t\"./eo.js\": [\n\t\t39399,\n\t\t3923\n\t],\n\t\"./es-do.js\": [\n\t\t47688,\n\t\t4026\n\t],\n\t\"./es-mx.js\": [\n\t\t81773,\n\t\t2972\n\t],\n\t\"./es-pr.js\": [\n\t\t66106,\n\t\t5624\n\t],\n\t\"./es-us.js\": [\n\t\t18541,\n\t\t187\n\t],\n\t\"./es.js\": [\n\t\t23607,\n\t\t172\n\t],\n\t\"./et.js\": [\n\t\t29776,\n\t\t9040\n\t],\n\t\"./eu.js\": [\n\t\t20166,\n\t\t6960\n\t],\n\t\"./fa.js\": [\n\t\t28288,\n\t\t6633\n\t],\n\t\"./fi.js\": [\n\t\t88189,\n\t\t5928\n\t],\n\t\"./fo.js\": [\n\t\t49697,\n\t\t9627\n\t],\n\t\"./fr-ca.js\": [\n\t\t15296,\n\t\t7007\n\t],\n\t\"./fr-ch.js\": [\n\t\t53415,\n\t\t7063\n\t],\n\t\"./fr.js\": [\n\t\t4938,\n\t\t3674\n\t],\n\t\"./fy.js\": [\n\t\t7811,\n\t\t8733\n\t],\n\t\"./ga.js\": [\n\t\t3368,\n\t\t6020\n\t],\n\t\"./gd.js\": [\n\t\t53560,\n\t\t3017\n\t],\n\t\"./gl.js\": [\n\t\t85222,\n\t\t4466\n\t],\n\t\"./gom-latn.js\": [\n\t\t38546,\n\t\t6099\n\t],\n\t\"./gu.js\": [\n\t\t78309,\n\t\t6993\n\t],\n\t\"./he.js\": [\n\t\t41436,\n\t\t9706\n\t],\n\t\"./hi.js\": [\n\t\t463,\n\t\t7409\n\t],\n\t\"./hr.js\": [\n\t\t27147,\n\t\t3793\n\t],\n\t\"./ht.js\": [\n\t\t95139,\n\t\t3104\n\t],\n\t\"./hu.js\": [\n\t\t18224,\n\t\t6994\n\t],\n\t\"./hy-am.js\": [\n\t\t25976,\n\t\t365\n\t],\n\t\"./id.js\": [\n\t\t74970,\n\t\t2698\n\t],\n\t\"./is.js\": [\n\t\t799,\n\t\t1087\n\t],\n\t\"./it-ch.js\": [\n\t\t6071,\n\t\t8302\n\t],\n\t\"./it.js\": [\n\t\t97727,\n\t\t8744\n\t],\n\t\"./ja.js\": [\n\t\t78117,\n\t\t9418\n\t],\n\t\"./jv.js\": [\n\t\t22281,\n\t\t3496\n\t],\n\t\"./ka.js\": [\n\t\t87931,\n\t\t3099\n\t],\n\t\"./kk.js\": [\n\t\t52334,\n\t\t1494\n\t],\n\t\"./km.js\": [\n\t\t35155,\n\t\t6169\n\t],\n\t\"./kn.js\": [\n\t\t72879,\n\t\t9701\n\t],\n\t\"./ko.js\": [\n\t\t62905,\n\t\t5929\n\t],\n\t\"./ku.js\": [\n\t\t34078,\n\t\t8555\n\t],\n\t\"./ky.js\": [\n\t\t24026,\n\t\t2819\n\t],\n\t\"./lb.js\": [\n\t\t62619,\n\t\t8124\n\t],\n\t\"./lo.js\": [\n\t\t29979,\n\t\t1462\n\t],\n\t\"./lt.js\": [\n\t\t75887,\n\t\t6903\n\t],\n\t\"./lv.js\": [\n\t\t35493,\n\t\t2437\n\t],\n\t\"./me.js\": [\n\t\t50532,\n\t\t4518\n\t],\n\t\"./mi.js\": [\n\t\t73059,\n\t\t3883\n\t],\n\t\"./mk.js\": [\n\t\t17450,\n\t\t3512\n\t],\n\t\"./ml.js\": [\n\t\t66422,\n\t\t8996\n\t],\n\t\"./mn.js\": [\n\t\t16428,\n\t\t8753\n\t],\n\t\"./mr.js\": [\n\t\t35778,\n\t\t3294\n\t],\n\t\"./ms-my.js\": [\n\t\t40583,\n\t\t2593\n\t],\n\t\"./ms.js\": [\n\t\t33650,\n\t\t6881\n\t],\n\t\"./mt.js\": [\n\t\t6045,\n\t\t4863\n\t],\n\t\"./my.js\": [\n\t\t74361,\n\t\t3741\n\t],\n\t\"./nb.js\": [\n\t\t10697,\n\t\t3148\n\t],\n\t\"./ne.js\": [\n\t\t16608,\n\t\t3868\n\t],\n\t\"./nl-be.js\": [\n\t\t11377,\n\t\t7953\n\t],\n\t\"./nl.js\": [\n\t\t6987,\n\t\t9724\n\t],\n\t\"./nn.js\": [\n\t\t8758,\n\t\t9663\n\t],\n\t\"./oc-lnc.js\": [\n\t\t68064,\n\t\t9495\n\t],\n\t\"./pa-in.js\": [\n\t\t16767,\n\t\t838\n\t],\n\t\"./pl.js\": [\n\t\t28012,\n\t\t8705\n\t],\n\t\"./pt-br.js\": [\n\t\t19978,\n\t\t3639\n\t],\n\t\"./pt.js\": [\n\t\t51357,\n\t\t7479\n\t],\n\t\"./ro.js\": [\n\t\t71948,\n\t\t3905\n\t],\n\t\"./ru.js\": [\n\t\t3381,\n\t\t8700\n\t],\n\t\"./rw.js\": [\n\t\t79914,\n\t\t3128\n\t],\n\t\"./sd.js\": [\n\t\t90126,\n\t\t7087\n\t],\n\t\"./se.js\": [\n\t\t46319,\n\t\t8723\n\t],\n\t\"./si.js\": [\n\t\t99008,\n\t\t9797\n\t],\n\t\"./sk.js\": [\n\t\t84600,\n\t\t6512\n\t],\n\t\"./sl.js\": [\n\t\t64955,\n\t\t3951\n\t],\n\t\"./sq.js\": [\n\t\t74716,\n\t\t3392\n\t],\n\t\"./sr-cyrl.js\": [\n\t\t55854,\n\t\t1532\n\t],\n\t\"./sr.js\": [\n\t\t23534,\n\t\t1907\n\t],\n\t\"./ss.js\": [\n\t\t19239,\n\t\t7003\n\t],\n\t\"./sv-fi.js\": [\n\t\t57972,\n\t\t9047\n\t],\n\t\"./sv.js\": [\n\t\t43032,\n\t\t8919\n\t],\n\t\"./sw.js\": [\n\t\t60125,\n\t\t4176\n\t],\n\t\"./ta.js\": [\n\t\t1565,\n\t\t9872\n\t],\n\t\"./te.js\": [\n\t\t92516,\n\t\t5825\n\t],\n\t\"./tet.js\": [\n\t\t26712,\n\t\t4984\n\t],\n\t\"./tg.js\": [\n\t\t39351,\n\t\t4653\n\t],\n\t\"./th.js\": [\n\t\t89225,\n\t\t5389\n\t],\n\t\"./tk.js\": [\n\t\t48485,\n\t\t2355\n\t],\n\t\"./tl-ph.js\": [\n\t\t17517,\n\t\t2343\n\t],\n\t\"./tlh.js\": [\n\t\t35984,\n\t\t3508\n\t],\n\t\"./tr.js\": [\n\t\t33092,\n\t\t2661\n\t],\n\t\"./tzl.js\": [\n\t\t69109,\n\t\t6199\n\t],\n\t\"./tzm-latn.js\": [\n\t\t13637,\n\t\t6782\n\t],\n\t\"./tzm.js\": [\n\t\t38063,\n\t\t1785\n\t],\n\t\"./ug-cn.js\": [\n\t\t98490,\n\t\t8256\n\t],\n\t\"./uk.js\": [\n\t\t65589,\n\t\t6190\n\t],\n\t\"./ur.js\": [\n\t\t85859,\n\t\t3199\n\t],\n\t\"./uz-latn.js\": [\n\t\t96588,\n\t\t3290\n\t],\n\t\"./uz.js\": [\n\t\t45589,\n\t\t9238\n\t],\n\t\"./vi.js\": [\n\t\t41191,\n\t\t357\n\t],\n\t\"./x-pseudo.js\": [\n\t\t59018,\n\t\t6858\n\t],\n\t\"./yo.js\": [\n\t\t14163,\n\t\t8898\n\t],\n\t\"./zh-cn.js\": [\n\t\t9073,\n\t\t5352\n\t],\n\t\"./zh-hk.js\": [\n\t\t74828,\n\t\t8638\n\t],\n\t\"./zh-tw.js\": [\n\t\t78141,\n\t\t4101\n\t],\n\t\"./zh.js\": [\n\t\t42882,\n\t\t5235\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(() => {\n\t\treturn __webpack_require__.t(id, 7 | 16);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 73637;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./chat/index.js\": 89959,\n\t\"./emote_card/index.jsx\": 99733,\n\t\"./link_card/index.jsx\": 88082,\n\t\"./main_menu/index.js\": 5624,\n\t\"./metadata.tsx\": 89817,\n\t\"./tooltips.ts\": 45655,\n\t\"./translation_ui/index.js\": 19745\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 10952;","var map = {\n\t\"./bits_button.js\": 24531,\n\t\"./bttv_compat.js\": 11746,\n\t\"./channel.jsx\": 74756,\n\t\"./chat/index.js\": 6172,\n\t\"./compat_emote_menu.js\": 6325,\n\t\"./css_tweaks/index.js\": 17103,\n\t\"./dashboard.js\": 95778,\n\t\"./directory/index.jsx\": 96432,\n\t\"./layout.js\": 68318,\n\t\"./loadable.tsx\": 34923,\n\t\"./menu_button.jsx\": 29333,\n\t\"./mod-view.jsx\": 94296,\n\t\"./player.jsx\": 63155,\n\t\"./sub_button.tsx\": 70052,\n\t\"./theme/index.js\": 24020,\n\t\"./video_chat/index.jsx\": 4948\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 41152;","module.exports = ffzVue;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"9\":\"i18n-33\",\"172\":\"i18n-44\",\"187\":\"i18n-43\",\"204\":\"menu-md4\",\"208\":\"rich_tokens\",\"300\":\"i18n-26\",\"357\":\"i18n-134\",\"365\":\"i18n-64\",\"427\":\"i18n-38\",\"485\":\"i18n-35\",\"627\":\"i18n-31\",\"789\":\"i18n-3\",\"838\":\"i18n-98\",\"909\":\"i18n-6\",\"935\":\"zip\",\"1081\":\"i18n-0\",\"1087\":\"i18n-66\",\"1462\":\"i18n-79\",\"1494\":\"i18n-72\",\"1532\":\"i18n-111\",\"1722\":\"i18n-5\",\"1784\":\"i18n-28\",\"1785\":\"i18n-128\",\"1871\":\"translation-ui\",\"1907\":\"i18n-112\",\"2009\":\"markdown\",\"2086\":\"main-menu\",\"2244\":\"i18n-11\",\"2343\":\"i18n-123\",\"2348\":\"chat\",\"2355\":\"i18n-122\",\"2437\":\"i18n-81\",\"2593\":\"i18n-88\",\"2597\":\"site-css-tweaks\",\"2661\":\"i18n-125\",\"2698\":\"i18n-65\",\"2730\":\"i18n-32\",\"2819\":\"i18n-77\",\"2928\":\"i18n-30\",\"2972\":\"i18n-41\",\"3017\":\"i18n-55\",\"3030\":\"i18n-9\",\"3099\":\"i18n-71\",\"3104\":\"i18n-62\",\"3128\":\"i18n-104\",\"3134\":\"i18n-16\",\"3148\":\"i18n-92\",\"3166\":\"i18n-22\",\"3199\":\"i18n-131\",\"3224\":\"queries\",\"3290\":\"i18n-132\",\"3294\":\"i18n-87\",\"3392\":\"i18n-110\",\"3496\":\"i18n-70\",\"3508\":\"i18n-124\",\"3512\":\"i18n-84\",\"3639\":\"i18n-100\",\"3674\":\"i18n-52\",\"3741\":\"i18n-91\",\"3793\":\"i18n-61\",\"3868\":\"i18n-93\",\"3883\":\"i18n-83\",\"3905\":\"i18n-102\",\"3923\":\"i18n-39\",\"3949\":\"i18n-36\",\"3951\":\"i18n-109\",\"3968\":\"i18n-17\",\"4026\":\"i18n-40\",\"4060\":\"i18n-21\",\"4101\":\"i18n-139\",\"4103\":\"i18n-23\",\"4164\":\"menu-md1\",\"4176\":\"i18n-116\",\"4178\":\"i18n-19\",\"4466\":\"i18n-56\",\"4518\":\"i18n-82\",\"4634\":\"i18n-29\",\"4653\":\"i18n-120\",\"4667\":\"i18n-15\",\"4863\":\"i18n-90\",\"4984\":\"i18n-119\",\"5012\":\"i18n-7\",\"5123\":\"i18n-20\",\"5151\":\"i18n-4\",\"5215\":\"i18n-2\",\"5235\":\"i18n-140\",\"5352\":\"i18n-137\",\"5380\":\"i18n-1\",\"5389\":\"i18n-121\",\"5528\":\"i18n-27\",\"5624\":\"i18n-42\",\"5818\":\"i18n-37\",\"5825\":\"i18n-118\",\"5928\":\"i18n-48\",\"5929\":\"i18n-75\",\"5954\":\"i18n-24\",\"6020\":\"i18n-54\",\"6099\":\"i18n-57\",\"6115\":\"emote-cards\",\"6169\":\"i18n-73\",\"6190\":\"i18n-130\",\"6199\":\"i18n-126\",\"6512\":\"i18n-108\",\"6530\":\"regex\",\"6633\":\"i18n-47\",\"6644\":\"i18n-34\",\"6757\":\"i18n-12\",\"6782\":\"i18n-127\",\"6858\":\"i18n-135\",\"6881\":\"i18n-89\",\"6903\":\"i18n-80\",\"6960\":\"i18n-46\",\"6993\":\"i18n-58\",\"6994\":\"i18n-63\",\"7003\":\"i18n-113\",\"7007\":\"i18n-50\",\"7063\":\"i18n-51\",\"7087\":\"i18n-105\",\"7168\":\"i18n-25\",\"7409\":\"i18n-60\",\"7479\":\"i18n-101\",\"7485\":\"vue\",\"7629\":\"menu-md0\",\"7953\":\"i18n-94\",\"8111\":\"i18n-13\",\"8124\":\"i18n-78\",\"8163\":\"menu-md5\",\"8256\":\"i18n-129\",\"8302\":\"i18n-67\",\"8555\":\"i18n-76\",\"8586\":\"overrides\",\"8638\":\"i18n-138\",\"8700\":\"i18n-103\",\"8705\":\"i18n-99\",\"8723\":\"i18n-106\",\"8733\":\"i18n-53\",\"8736\":\"i18n-10\",\"8744\":\"i18n-68\",\"8753\":\"i18n-86\",\"8757\":\"i18n-8\",\"8898\":\"i18n-136\",\"8919\":\"i18n-115\",\"8996\":\"i18n-85\",\"9040\":\"i18n-45\",\"9047\":\"i18n-114\",\"9082\":\"i18n-14\",\"9238\":\"i18n-133\",\"9248\":\"i18n-18\",\"9418\":\"i18n-69\",\"9442\":\"vue-chat\",\"9495\":\"i18n-97\",\"9627\":\"i18n-49\",\"9663\":\"i18n-96\",\"9701\":\"i18n-74\",\"9706\":\"i18n-59\",\"9724\":\"i18n-95\",\"9797\":\"i18n-107\",\"9872\":\"i18n-117\"}[chunkId] || chunkId) + \".js\";\n};","__webpack_require__.h = () => (\"76313c69f0d0df3a2768\")","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\nvar dataWebpackPrefix = \"frankerfacez:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t\tif (script.src.indexOf(window.location.origin + '/') !== 0) {\n\t\t\tscript.crossOrigin = \"anonymous\";\n\t\t}\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.j = 8363;","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8363: 0,\n\t2682: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = globalThis[\"ffzWebpackJsonp\"] = globalThis[\"ffzWebpackJsonp\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import type { ClientVersion } from \"./types\";\n\nconst RAVEN_LEVELS: Record<number, string> = {\n\t1: 'debug',\n\t2: 'info',\n\t4: 'warn',\n\t8: 'error'\n};\n\n\nexport enum LogLevel {\n\tVerbose = 0,\n\tDebug = 1,\n\tInfo = 2,\n\tWarning = 4,\n\tError = 8,\n\tOff = 99\n}\n\nfunction readLSLevel(): number | null {\n\tconst level = localStorage.ffzLogLevel;\n\tif ( ! level )\n\t\treturn null;\n\n\tconst upper = level.toUpperCase(),\n\t\tvalue = (Logger as any)[upper];\n\n\tif ( typeof value === 'number' )\n\t\treturn value;\n\n\tif ( /^\\d+$/.test(level) )\n\t\treturn parseInt(level, 10);\n\n\treturn null;\n}\n\n\ninterface Core {\n\n\thost: string;\n\tflavor: string;\n\n};\n\n\ntype InitItem = {\n\ttime: number;\n\tcategory: string | null;\n\tmessage: string;\n\tlevel: string | number;\n}\n\n\nexport class Logger {\n\tpublic static readonly Levels = LogLevel;\n\tpublic static readonly VERBOSE = LogLevel.Verbose;\n\tpublic static readonly DEBUG = LogLevel.Debug;\n\tpublic static readonly INFO = LogLevel.Info;\n\tpublic static readonly WARN = LogLevel.Warning;\n\tpublic static readonly WARNING = LogLevel.Warning;\n\tpublic static readonly ERROR = LogLevel.Error;\n\tpublic static readonly OFF = LogLevel.Off;\n\n\tpublic static readonly DEFAULT_LEVEL = LogLevel.Info;\n\n\tname: string | null;\n\tenabled: boolean;\n\tlevel: LogLevel;\n\n\tlabel?: string;\n\n\tinit?: boolean;\n\tcaptured_init?: InitItem[];\n\n\troot: Logger;\n\tparent: Logger | null;\n\tchildren: Record<string, Logger>;\n\n\traven: any;\n\n\tconstructor(parent: Logger | null, name: string | null, level?: LogLevel | null, raven?: any) {\n\t\tthis.root = parent ? parent.root : this;\n\t\tthis.parent = parent;\n\t\tthis.name = name;\n\n\t\tif ( this.root == this ) {\n\t\t\tthis.init = false;\n\t\t\tthis.captured_init = [];\n\t\t\tthis.label = 'FFZ';\n\t\t}\n\n\t\tthis.enabled = true;\n\t\tthis.level = level ?? (parent && parent.level) ?? readLSLevel() ?? Logger.DEFAULT_LEVEL;\n\t\tthis.raven = raven || (parent && parent.raven);\n\n\t\tthis.children = {};\n\t}\n\n\t/** @internal */\n\thi(core: Core, version?: ClientVersion) {\n\t\tconst VER = version ?? (core.constructor as any)?.version_info;\n\t\tthis.info(`FrankerFaceZ v${VER} (s:${core.host} f:${core.flavor} b:${VER?.build} c:${VER?.commit || 'null'})`);\n\n\t\ttry {\n\t\t\tconst loc = new URL(location.toString());\n\t\t\tloc.search = '';\n\t\t\tthis.info(`Initial URL: ${loc}`);\n\t\t} catch(err) {\n\t\t\tthis.warn(`Unable to read location.`, err);\n\t\t}\n\t}\n\n\tget(name: string, level?: LogLevel) {\n\t\tif ( ! this.children[name] )\n\t\t\tthis.children[name] = new Logger(this, (this.name ? `${this.name}.${name}` : name), level);\n\n\t\treturn this.children[name];\n\t}\n\n\tverbose(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(LogLevel.Verbose, message, optionalParams);\n\t}\n\n\tverboseColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.VERBOSE, message, colors, optionalParams);\n\t}\n\n\tdebug(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.DEBUG, message, optionalParams);\n\t}\n\n\tdebugColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.DEBUG, message, colors, optionalParams);\n\t}\n\n\tinfo(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.INFO, message, optionalParams);\n\t}\n\n\tinfoColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.INFO, message, colors, optionalParams);\n\t}\n\n\twarn(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.WARN, message, optionalParams);\n\t}\n\n\twarnColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.WARN, message, colors, optionalParams);\n\t}\n\n\twarning(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.WARN, message, optionalParams);\n\t}\n\n\twarningColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.WARN, message, colors, optionalParams);\n\t}\n\n\terror(message: any, ...optionalParams: any[]) {\n\t\treturn this.invoke(Logger.ERROR, message, optionalParams);\n\t}\n\n\terrorColor(message: any, colors: string[], ...optionalParams: any[]) {\n\t\treturn this.invokeColor(Logger.ERROR, message, colors, optionalParams);\n\t}\n\n\tcrumb(...args: any[]) {\n\t\tif ( this.raven )\n\t\t\treturn this.raven.captureBreadcrumb(...args);\n\t}\n\n\tcapture(exc: Error, opts?: any, ...args: any[]) {\n\t\tif ( this.raven ) {\n\t\t\topts = opts || {};\n\t\t\tif ( ! opts.logger )\n\t\t\t\topts.logger = this.name;\n\n\t\t\tthis.raven.captureException(exc, opts);\n\t\t}\n\n\t\tif ( args.length ) {\n\t\t\tconst msg = args.shift();\n\t\t\treturn this.error(msg, ...args);\n\t\t}\n\t}\n\n\tinvokeColor(level: number, message: any, colors: string | string[], ...optionalParams: any[]) {\n\t\tif ( ! this.enabled || level < this.level )\n\t\t\treturn;\n\n\t\tif ( ! Array.isArray(colors) )\n\t\t\tcolors = [colors];\n\n\t\t//const message = args ? Array.prototype.slice.call(args) : [];\n\n\t\tif ( level > LogLevel.Verbose ) {\n\t\t\tlet out = message;\n\t\t\tif ( typeof out === 'string' )\n\t\t\t\tout = out.replace(/%c/g, '');\n\n\t\t\tif ( optionalParams.length )\n\t\t\t\tout = `${out} ${optionalParams.join(' ')}`;\n\n\t\t\tif ( this.root.init && this.root.captured_init )\n\t\t\t\tthis.root.captured_init.push({\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tcategory: this.name,\n\t\t\t\t\tmessage: out,\n\t\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t\t});\n\n\t\t\tthis.crumb({\n\t\t\t\tmessage: out,\n\t\t\t\tcategory: this.name,\n\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t});\n\t\t}\n\n\t\tconst default_style = level < LogLevel.Info\n\t\t\t? 'color:#999999'\n\t\t\t: '';\n\n\t\tif ( this.name ) {\n\t\t\tif ( typeof message === 'string' )\n\t\t\t\tmessage = `%c${this.root.label} [%c${this.name}%c]:%c ${message}`;\n\t\t\telse {\n\t\t\t\toptionalParams.unshift(message);\n\t\t\t\tmessage = `%c${this.root.label} [%c${this.name}%c]:%c`;\n\t\t\t}\n\n\t\t\tcolors.unshift('color:#755000; font-weight:bold', default_style, 'color:#755000; font-weight:bold', default_style);\n\n\t\t} else {\n\t\t\tif ( typeof message === 'string' )\n\t\t\t\tmessage = `%c${this.root.label}:%c ${message}`;\n\t\t\telse {\n\t\t\t\toptionalParams.unshift(message);\n\t\t\t\tmessage = `%c${this.root.label}:%c`;\n\t\t\t}\n\n\t\t\tcolors.unshift('color:#755000; font-weight:bold', default_style);\n\t\t}\n\n\t\tif ( level < LogLevel.Info )\n\t\t\tconsole.debug(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Warning )\n\t\t\tconsole.info(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Error )\n\t\t\tconsole.warn(message, ...colors, ...optionalParams);\n\n\t\telse if ( level < LogLevel.Off )\n\t\t\tconsole.error(message, ...colors, ...optionalParams);\n\t}\n\n\t/* eslint no-console: \"off\" */\n\tinvoke(level: number, message: string, optionalParams?: any[]) {\n\t\tif ( ! this.enabled || level < this.level || level >= LogLevel.Off )\n\t\t\treturn;\n\n\t\tconst result = optionalParams ? [\n\t\t\tmessage,\n\t\t\t...optionalParams\n\t\t] : [message];\n\n\t\tif ( level > LogLevel.Verbose ) {\n\t\t\tconst out = result.join(' ');\n\n\t\t\tif ( this.root.init && this.root.captured_init )\n\t\t\t\tthis.root.captured_init.push({\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\tcategory: this.name,\n\t\t\t\t\tmessage: out,\n\t\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t\t});\n\n\t\t\tthis.crumb({\n\t\t\t\tmessage: out,\n\t\t\t\tcategory: this.name,\n\t\t\t\tlevel: RAVEN_LEVELS[level] || level\n\t\t\t});\n\t\t}\n\n\t\t// Chrome removed any sort of special styling from debug\n\t\t// logging, so let's add our own to make them visually distinct.\n\t\tconst default_style = level < LogLevel.Info\n\t\t\t? 'color:#999999'\n\t\t\t: '';\n\n\t\t// If we're adding our own style, we need to grab as many of\n\t\t// the strings as we can.\n\t\tlet strings = '';\n\t\tif ( default_style !== '' ) {\n\t\t\twhile(result.length > 0 && typeof result[0] === 'string') {\n\t\t\t\tstrings += ' ' + result.shift();\n\t\t\t}\n\t\t}\n\n\t\tif ( this.name ) {\n\t\t\tresult.unshift(`%c${this.root.label} [%c${this.name}%c]:%c${strings}`, 'color:#755000; font-weight:bold', default_style, 'color:#755000; font-weight:bold', default_style);\n\t\t} else\n\t\t\tresult.unshift(`%c${this.root.label}:%c${strings}`, 'color:#755000; font-weight:bold', default_style);\n\n\t\tif ( level < LogLevel.Info )\n\t\t\tconsole.debug(...result);\n\n\t\telse if ( level < LogLevel.Warning )\n\t\t\tconsole.info(...result);\n\n\t\telse if ( level < LogLevel.Error )\n\t\t\tconsole.warn(...result);\n\n\t\telse if ( level < LogLevel.Off )\n\t\t\tconsole.error(...result);\n\t}\n}\n\nexport default Logger;\n","'use strict';\n\n// ============================================================================\n// Add-On System\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { EXTENSION, SERVER_OR_EXT } from 'utilities/constants';\nimport { createElement } from 'utilities/dom';\nimport { timeout, has, deep_copy, fetchJSON } from 'utilities/object';\nimport { getBuster } from 'utilities/time';\nimport type SettingsManager from './settings';\nimport type TranslationManager from './i18n';\nimport type LoadTracker from './load_tracker';\nimport type FrankerFaceZ from './main';\nimport type { AddonInfo, BasicAddonInfo } from 'utilities/types';\n\ndeclare global {\n\tinterface Window {\n\t\tffzAddonsWebpackJsonp: unknown;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\taddons: AddonManager;\n\t}\n\tinterface ModuleEventMap {\n\t\taddons: AddonManagerEvents;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'addons.dev.server': boolean;\n\t}\n};\n\ntype AddonManagerEvents = {\n\t':ready': [];\n\t':data-loaded': [];\n\t':reload-required': [];\n\n\t':added': [id: string, info: AddonInfo];\n\t':addon-loaded': [id: string];\n\t':addon-enabled': [id: string];\n\t':addon-disabled': [id: string];\n\t':fully-unload': [id: string];\n};\n\n\ntype FullAddonInfo = AddonInfo & {\n\t_search?: string | null;\n\tsrc: string;\n};\n\n\n// ============================================================================\n// AddonManager\n// ============================================================================\n\nexport default class AddonManager extends Module<'addons'> {\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\tload_tracker: LoadTracker = null as any;\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\thas_dev: boolean;\n\treload_required: boolean;\n\ttarget: string;\n\n\taddons: Record<string, FullAddonInfo | string[]>;\n\tenabled_addons: string[];\n\tversions: Record<string, string>;\n\n\tprivate _loader?: Promise<void>;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\t\tthis.inject('i18n');\n\t\tthis.inject('load_tracker');\n\n\t\tthis.load_requires = ['settings'];\n\n\t\tthis.target = (this.parent as unknown as FrankerFaceZ).flavor || 'unknown';\n\n\t\tthis.has_dev = false;\n\t\tthis.reload_required = false;\n\t\tthis.addons = {};\n\t\tthis.enabled_addons = [];\n\t\tthis.versions = {};\n\n\t\tthis.load_tracker.schedule('chat-data', 'addon-initial');\n\t}\n\n\tonLoad() {\n\t\t// We don't actually *wait* for this, we just start it.\n\t\tthis._loader = this.loadAddonData();\n\t}\n\n\tonEnable() {\n\t\tthis.settings.addUI('add-ons', {\n\t\t\tpath: 'Add-Ons @{\"description\": \"Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.\", \"profile_warning\": false}',\n\t\t\tcomponent: 'addon-list',\n\t\t\ttitle: 'Add-Ons',\n\t\t\tno_filter: true,\n\n\t\t\tgetExtraTerms: () => Object.values(this.addons).map(addon => addon.search_terms),\n\n\t\t\tgetFFZ: () => this,\n\t\t\tisReady: () => this.enabled,\n\t\t\tgetAddons: () => Object.values(this.addons),\n\t\t\tgetVersions: () => deep_copy(this.versions),\n\t\t\thasAddon: (id: string) => this.hasAddon(id),\n\t\t\tgetVersion: (id: string) => this.getVersion(id),\n\t\t\tdoesAddonTarget: (id: string) => this.doesAddonTarget(id),\n\t\t\tisAddonEnabled: (id: string) => this.isAddonEnabled(id),\n\t\t\tisAddonExternal: (id: string) => this.isAddonExternal(id),\n\t\t\tenableAddon: (id: string) => this.enableAddon(id),\n\t\t\tdisableAddon: (id: string) => this.disableAddon(id),\n\t\t\treloadAddon: (id: string) => this.reloadAddon(id),\n\t\t\tcanReloadAddon: (id: string) => this.canReloadAddon(id),\n\t\t\tisReloadRequired: () => this.reload_required,\n\t\t\trefresh: () => window.location.reload(),\n\n\t\t\ton: (...args: Parameters<typeof this.on>) => this.on(...args),\n\t\t\toff: (...args: Parameters<typeof this.off>) => this.off(...args)\n\t\t});\n\n\t\tif ( ! EXTENSION )\n\t\t\tthis.settings.add('addons.dev.server', {\n\t\t\t\tdefault: false,\n\t\t\t\tui: {\n\t\t\t\t\tpath: 'Add-Ons >> Development',\n\t\t\t\t\ttitle: 'Use Local Development Server',\n\t\t\t\t\tdescription: 'Attempt to load add-ons from local development server on port 8001.',\n\t\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.on('i18n:update', this.rebuildAddonSearch, this);\n\n\t\tthis.settings.provider.on('changed', this.onProviderChange, this);\n\n\t\tthis._loader?.then(() => {\n\t\t\tthis.enabled_addons = this.settings.provider.get('addons.enabled', []);\n\n\t\t\t// We do not await enabling add-ons because that would delay the\n\t\t\t// main script's execution.\n\t\t\tfor(const id of this.enabled_addons)\n\t\t\t\tif ( this.hasAddon(id) && this.doesAddonTarget(id) )\n\t\t\t\t\tthis._enableAddon(id).catch(err => {\n\t\t\t\t\t\tthis.log.error(`An error occured while enabling the add-on \"${id}\":` , err);\n\t\t\t\t\t\tthis.log.capture(err);\n\t\t\t\t\t});\n\n\t\t\tthis.load_tracker.notify('chat-data', 'addon-initial');\n\t\t\tthis.emit(':ready');\n\t\t});\n\t}\n\n\n\tdoesAddonTarget(id: string) {\n\t\tconst data = this.getAddon(id);\n\t\tif ( ! data )\n\t\t\treturn false;\n\n\t\tconst targets = data.targets ?? ['main'];\n\t\tif ( ! Array.isArray(targets) )\n\t\t\treturn false;\n\n\t\treturn targets.includes(this.target);\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = ['Known'];\n\t\tfor(const [id, addon] of Object.entries(this.addons)) {\n\t\t\tif ( Array.isArray(addon) )\n\t\t\t\tcontinue;\n\n\t\t\tconst version = this.versions[id];\n\n\t\t\tout.push(`${id} | ${this.isAddonEnabled(id) ? 'enabled' : 'disabled'} | ${version ? `${version} | ` : ''}${addon.dev ? 'dev | ' : ''}${this.isAddonExternal(id) ? 'external | ' : ''}${addon.short_name} v${addon.version}`);\n\t\t}\n\n\t\tout.push('');\n\t\tout.push('Modules');\n\t\tfor(const [key, module] of Object.entries((this as any).__modules as Record<string, GenericModule>)) {\n\t\t\tif ( module )\n\t\t\t\tout.push(`${module.loaded ? 'loaded  ' : module.loading ? 'loading ' : 'unloaded'} | ${module.enabled ? 'enabled ' : module.enabling ? 'enabling' : 'disabled'} | ${key}`)\n\t\t}\n\n\t\treturn out.join('\\n');\n\t}\n\n\tonProviderChange(key: string, value: unknown) {\n\t\tif ( key != 'addons.enabled' )\n\t\t\treturn;\n\n\t\tconst val: string[] = Array.isArray(value) ? value : [],\n\t\t\told_enabled = [...this.enabled_addons];\n\n\t\t// Add-ons to disable\n\t\tfor(const id of old_enabled)\n\t\t\tif ( ! val.includes(id) )\n\t\t\t\tthis.disableAddon(id, false);\n\n\t\t// Add-ons to enable\n\t\tfor(const id of val)\n\t\t\tif ( ! old_enabled.includes(id) )\n\t\t\t\tthis.enableAddon(id, false);\n\t}\n\n\tasync loadAddonData() {\n\t\tconst [cdn_data, local_data] = await Promise.all([\n\t\t\tfetchJSON(`${SERVER_OR_EXT}/addons.json?_=${getBuster(30)}`),\n\n\t\t\t// Do not attempt to load local add-ons if using the extension, as\n\t\t\t// loading external code is against the policy of basically everyone.\n\t\t\t(! EXTENSION && this.settings.get('addons.dev.server'))\n\t\t\t\t? fetchJSON(`https://localhost:8001/script/addons.json?_=${getBuster()}`)\n\t\t\t\t: null\n\t\t]);\n\n\t\tif ( Array.isArray(cdn_data) ) {\n\t\t\t// We need to handle relative URLs for addon logos.\n\t\t\tconst base_path = `${SERVER_OR_EXT}/addons/`;\n\n\t\t\tfor(const addon of cdn_data ) {\n\t\t\t\tif ( addon.icon )\n\t\t\t\taddon.icon = (new URL(addon.icon, base_path)).toString();\n\t\t\t\tthis.addAddon(addon, false);\n\t\t\t}\n\t\t}\n\n\t\tif ( Array.isArray(local_data) ) {\n\t\t\tthis.has_dev = true;\n\t\t\tfor(const addon of local_data)\n\t\t\t\tthis.addAddon(addon, true);\n\t\t}\n\n\t\tthis.settings.updateContext({\n\t\t\taddonDev: this.has_dev\n\t\t});\n\n\t\tthis.rebuildAddonSearch();\n\t\tthis.emit(':data-loaded');\n\t}\n\n\tsetVersion(addon_id: string, version: string) {\n\t\tthis.versions[addon_id] = version;\n\t}\n\n\taddAddon(input: BasicAddonInfo, is_dev: boolean = false) {\n\t\tlet addon = input as FullAddonInfo;\n\n\t\tconst old = this.addons[addon.id];\n\t\tthis.addons[addon.id] = addon;\n\n\t\t/*addon.name_i18n = addon.name_i18n || `addon.${addon.id}.name`;\n\t\taddon.short_name_i18n = addon.short_name_i18n || `addon.${addon.id}.short_name`;\n\t\taddon.author_i18n = addon.author_i18n || `addon.${addon.id}.author`;*/\n\n\t\taddon.name = addon.name ?? addon.id;\n\n\t\taddon.dev = is_dev;\n\t\taddon.requires = addon.requires || [];\n\t\taddon.required_by = Array.isArray(old) ? old : old && old.required_by || [];\n\n\t\tif ( addon.updated )\n\t\t\taddon.updated = new Date(addon.updated);\n\n\t\tif ( addon.created )\n\t\t\taddon.created = new Date(addon.created);\n\n\t\taddon._search = addon.search_terms;\n\n\t\tfor(const id of addon.requires) {\n\t\t\tconst target = this.addons[id];\n\t\t\tif ( Array.isArray(target) )\n\t\t\t\ttarget.push(addon.id);\n\t\t\telse if ( target )\n\t\t\t\ttarget.required_by.push(addon.id);\n\t\t\telse\n\t\t\t\tthis.addons[id] = [addon.id];\n\t\t}\n\n\t\tif ( ! old || Array.isArray(old) )\n\t\t\tthis.settings.addUI(`addon-changelog.${addon.id}`, {\n\t\t\t\tpath: `Add-Ons > Changelog > ${addon.name}`,\n\t\t\t\tcomponent: 'changelog',\n\t\t\t\tforce_seen: true,\n\t\t\t\taddons: true,\n\t\t\t\taddon: deep_copy(addon),\n\t\t\t\tgetFFZ: () => this,\n\t\t\t\tgetVersion: () => this.versions[addon.id]\n\t\t\t});\n\n\t\tthis.emit(':added', addon.id, addon);\n\t}\n\n\trebuildAddonSearch() {\n\t\tfor(const addon of Object.values(this.addons)) {\n\t\t\tif ( Array.isArray(addon) )\n\t\t\t\tcontinue;\n\n\t\t\tconst terms = new Set([\n\t\t\t\taddon._search,\n\t\t\t\taddon.name,\n\t\t\t\taddon.short_name,\n\t\t\t\taddon.author,\n\t\t\t\taddon.description,\n\t\t\t]);\n\n\t\t\tif ( this.i18n.locale !== 'en' ) {\n\t\t\t\tif ( addon.name_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.name_i18n, addon.name));\n\n\t\t\t\tif ( addon.short_name_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.short_name_i18n, addon.short_name));\n\n\t\t\t\tif ( addon.author_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.author_i18n, addon.author));\n\n\t\t\t\tif ( addon.maintainer_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.maintainer_i18n, addon.maintainer));\n\n\t\t\t\tif ( addon.description_i18n )\n\t\t\t\t\tterms.add(this.i18n.t(addon.description_i18n, addon.description));\n\t\t\t}\n\n\t\t\taddon.search_terms = [...terms]\n\t\t\t\t.map(term => term ? term.toLocaleLowerCase() : '').join('\\n');\n\t\t}\n\t}\n\n\tisAddonEnabled(id: string) {\n\t\tif ( this.isAddonExternal(id) )\n\t\t\treturn true;\n\n\t\treturn this.enabled_addons.includes(id);\n\t}\n\n\tgetAddon(id: string) {\n\t\tconst addon = this.addons[id] ?? null;\n\t\treturn Array.isArray(addon) ? null : addon;\n\t}\n\n\thasAddon(id: string) {\n\t\treturn this.getAddon(id) != null;\n\t}\n\n\tgetVersion(id: string) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\tif ( module ) {\n\t\t\tif ( 'version' in module ) // has(module, 'version') )\n\t\t\t\treturn module.version;\n\t\t\telse if ( module.constructor && 'version' in module.constructor ) // has(module.constructor, 'version') )\n\t\t\t\treturn module.constructor.version;\n\t\t}\n\n\t\treturn addon.version;\n\t}\n\n\tisAddonExternal(id: string) {\n\t\tif ( ! this.hasAddon(id) )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\t// If we can't find it, assume it isn't.\n\t\tif ( ! module )\n\t\t\treturn false;\n\n\t\t// Check for one of our script tags. If we didn't load\n\t\t// it ourselves, then it's external.\n\t\tconst script = document.head.querySelector(`script#ffz-loaded-addon-${id}`);\n\t\tif ( ! script )\n\t\t\treturn true;\n\n\t\t// Finally, let the module flag itself as external.\n\t\treturn (module as any).external || (module.constructor as any)?.external;\n\t}\n\n\tcanReloadAddon(id: string) {\n\t\t// Obviously we can't reload it if we don't have it.\n\t\tif ( ! this.hasAddon(id) )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\t// If the module isn't available, we can't reload it.\n\t\tlet module = this.resolve(`addon.${id}`);\n\t\tif ( ! module )\n\t\t\treturn false;\n\n\t\t// If the module cannot be disabled, or it cannot be unloaded, then\n\t\t// we can't reload it.\n\t\tif ( ! module.canDisable() || ! module.canUnload() )\n\t\t\treturn false;\n\n\t\t// Check each child.\n\t\tif ( module.children )\n\t\t\tfor(const child of Object.values(module.children))\n\t\t\t\tif ( ! child.canDisable() || ! child.canUnload() )\n\t\t\t\t\treturn false;\n\n\t\t// If we got here, we might be able to reload it.\n\t\treturn true;\n\t}\n\n\tasync fullyUnloadModule(module: GenericModule) {\n\t\tif ( ! module || ! module.addon_id )\n\t\t\treturn;\n\n\t\tif ( module.children )\n\t\t\tfor(const child of Object.values(module.children))\n\t\t\t\tawait this.fullyUnloadModule(child);\n\n\t\tawait module.disable();\n\t\tawait module.unload();\n\n\t\t// Clean up parent references.\n\t\tif ( module.parent instanceof Module && module.parent.children[module.name] === module )\n\t\t\tdelete module.parent.children[module.name];\n\n\t\t// Clean up all individual references.\n\t\tfor(const entry of module.references) {\n\t\t\tconst other = this.resolve(entry[0]),\n\t\t\t\tname = entry[1];\n\t\t\tif ( (other as any)[name] === module )\n\t\t\t\t(other as any)[name] = null;\n\t\t}\n\n\t\t// Send off a signal for other modules to unload related data.\n\t\tthis.emit(':fully-unload', module.addon_id);\n\n\t\t// Clean up the global reference.\n\t\tif ( (this as any).__modules[(module as any).__path] === module )\n\t\t\tdelete (this as any).__modules[(module as any).__path]; /* = [\n\t\t\t\tmodule.dependents,\n\t\t\t\tmodule.load_dependents,\n\t\t\t\tmodule.references\n\t\t\t];*/\n\n\t\t// Remove any events we didn't unregister.\n\t\tthis.off(undefined, undefined, module);\n\n\t\t// Do the same for settings.\n\t\tfor(const ctx of this.settings.__contexts)\n\t\t\tctx.off(undefined, undefined, module);\n\n\t\t// Clean up all settings.\n\t\tfor(const [key, def] of Array.from(this.settings.definitions.entries())) {\n\t\t\tif ( ! Array.isArray(def) && def?.__source === module.addon_id ) {\n\t\t\t\tthis.settings.remove(key);\n\t\t\t}\n\t\t}\n\n\t\t// Clean up the logger too.\n\t\t(module as any).__log = null;\n\t}\n\n\tasync reloadAddon(id: string) {\n\t\tconst addon = this.getAddon(id),\n\t\t\tbutton = this.resolve('site.menu_button');\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tconst start = performance.now();\n\n\t\t// Yeet the module into the abyss.\n\t\t// This will also yeet all children.\n\t\tlet module = this.resolve(`addon.${id}`);\n\t\tif ( module )\n\t\t\ttry {\n\t\t\t\tawait this.fullyUnloadModule(module);\n\t\t\t} catch(err) {\n\t\t\t\tif ( button )\n\t\t\t\t\tbutton.addToast({\n\t\t\t\t\t\ttitle_i18n: 'addons.reload.toast-error',\n\t\t\t\t\t\ttitle: 'Error Reloading Add-On',\n\t\t\t\t\t\ttext_i18n: 'addons.reload.toast-error.unload',\n\t\t\t\t\t\ttext: 'Unable to unload existing modules for add-on \"{addon_id}\":\\n\\n{error}',\n\t\t\t\t\t\ticon: 'ffz-i-attention',\n\t\t\t\t\t\taddon_id: id,\n\t\t\t\t\t\terror: String(err)\n\t\t\t\t\t});\n\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t// Is there a script tab?\n\t\tlet el = document.querySelector(`script#ffz-loaded-addon-${addon.id}`);\n\t\tif ( el )\n\t\t\tel.remove();\n\n\t\t// Do unnatural things to webpack.\n\t\tif ( window.ffzAddonsWebpackJsonp )\n\t\t\twindow.ffzAddonsWebpackJsonp = undefined;\n\n\t\t// Now, reload it all~\n\t\ttry {\n\t\t\tawait this._enableAddon(id);\n\t\t} catch(err) {\n\t\t\tif ( button )\n\t\t\t\tbutton.addToast({\n\t\t\t\t\ttitle_i18n: 'addons.reload.toast-error',\n\t\t\t\t\ttitle: 'Error Reloading Add-On',\n\t\t\t\t\ttext_i18n: 'addons.reload.toast-error.reload',\n\t\t\t\t\ttext: 'Unable to load new module for add-on \"{addon_id}\":\\n\\n{error}',\n\t\t\t\t\terror: String(err),\n\t\t\t\t\ticon: 'ffz-i-attention',\n\t\t\t\t\taddon_id: id\n\t\t\t\t});\n\t\t\tthrow err;\n\t\t}\n\n\t\tconst end = performance.now();\n\n\t\tif ( button )\n\t\t\tbutton.addToast({\n\t\t\t\ttitle_i18n: 'addons.reload.toast',\n\t\t\t\ttitle: 'Reloaded Add-On',\n\t\t\t\ttext_i18n: 'addons.reload.toast.text',\n\t\t\t\ttext: 'Successfully reloaded add-on \"{addon_id}\" in {duration}ms.',\n\t\t\t\ticon: 'ffz-i-info',\n\t\t\t\taddon_id: id,\n\t\t\t\ttimeout: 5000,\n\t\t\t\tduration: Math.round(100 * (end - start)) / 100\n\t\t\t});\n\t}\n\n\tprivate async _enableAddon(id: string) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tif ( Array.isArray(addon.load_events) )\n\t\t\tfor(const event of addon.load_events)\n\t\t\t\tthis.load_tracker.schedule(event, `addon.${id}`);\n\n\t\tawait this.loadAddon(id);\n\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\tif ( module && ! module.enabled )\n\t\t\tawait module.enable();\n\n\t\tif ( Array.isArray(addon.load_events) )\n\t\tfor(const event of addon.load_events)\n\t\t\tthis.load_tracker.notify(event, `addon.${id}`, false);\n\t}\n\n\tasync loadAddon(id: string) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tawait this.i18n.loadChunk(`addon.${id}`);\n\n\t\tlet module = this.resolve(`addon.${id}`);\n\t\tif ( module ) {\n\t\t\tif ( ! module.loaded )\n\t\t\t\tawait module.load();\n\n\t\t\tthis.emit(':addon-loaded', id);\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.head.appendChild(createElement('script', {\n\t\t\tid: `ffz-loaded-addon-${addon.id}`,\n\t\t\ttype: 'text/javascript',\n\t\t\tsrc: addon.src || `${addon.dev ? 'https://localhost:8001/script' : SERVER_OR_EXT}/addons/${addon.id}/script.js?_=${getBuster(30)}`,\n\t\t\tcrossorigin: 'anonymous'\n\t\t}));\n\n\t\t// Error if this takes more than 60 seconds.\n\t\tawait timeout(this.waitFor(`addon.${id}:registered` as any), 60000);\n\n\t\tmodule = this.resolve(`addon.${id}`);\n\t\tif ( module && ! module.loaded )\n\t\t\tawait module.load();\n\n\t\tthis.emit(':addon-loaded', id);\n\t}\n\n\tunloadAddon(id: string) {\n\t\tconst module = this.resolve(`addon.${id}`);\n\t\tif ( module )\n\t\t\treturn module.unload();\n\t}\n\n\tenableAddon(id: string, save: boolean = true) {\n\t\tconst addon = this.getAddon(id);\n\t\tif( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tif ( this.isAddonEnabled(id) )\n\t\t\treturn;\n\n\t\tif ( Array.isArray(addon.requires) ) {\n\t\t\tfor(const id of addon.requires) {\n\t\t\t\tif ( ! this.hasAddon(id) )\n\t\t\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\t\t\tthis.enableAddon(id);\n\t\t\t}\n\t\t}\n\n\t\tthis.emit(':addon-enabled', id);\n\t\tthis.enabled_addons.push(id);\n\n\t\tif ( save )\n\t\t\tthis.settings.provider.set('addons.enabled', this.enabled_addons);\n\n\t\t// Actually load it.\n\t\tif ( this.doesAddonTarget(id) )\n\t\t\tthis._enableAddon(id).catch(err => {\n\t\t\t\tthis.log.error(`An error occured while enabling the add-on \"${id}\":` , err);\n\t\t\t\tthis.log.capture(err);\n\t\t\t});\n\t}\n\n\tasync disableAddon(id: string, save: boolean = true) {\n\t\tconst addon = this.getAddon(id);\n\t\tif ( ! addon )\n\t\t\tthrow new Error(`Unknown add-on id: ${id}`);\n\n\t\tif ( this.isAddonExternal(id) )\n\t\t\tthrow new Error(`Cannot disable external add-on with id: ${id}`);\n\n\t\tif ( ! this.isAddonEnabled(id) )\n\t\t\treturn;\n\n\t\tif ( Array.isArray(addon.required_by) ) {\n\t\t\tconst promises = [];\n\t\t\tfor(const id of addon.required_by)\n\t\t\t\tpromises.push(this.disableAddon(id));\n\n\t\t\tawait Promise.all(promises);\n\t\t}\n\n\t\tthis.emit(':addon-disabled', id);\n\t\tthis.enabled_addons.splice(this.enabled_addons.indexOf(id), 1);\n\n\t\tif ( save )\n\t\t\tthis.settings.provider.set('addons.enabled', this.enabled_addons);\n\n\t\t// Try disabling loaded modules.\n\t\ttry {\n\t\t\tconst module = this.resolve(`addon.${id}`);\n\t\t\tif ( module )\n\t\t\t\tawait module.disable();\n\t\t} catch(err) {\n\t\t\tthis.reload_required = true;\n\t\t\tthis.emit(':reload-required');\n\t\t}\n\t}\n}\n","/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n","'use strict';\n\n// ============================================================================\n// Experiments\n// ============================================================================\n\nimport {DEBUG, SERVER, SERVER_OR_EXT} from 'utilities/constants';\nimport Module, { GenericModule } from 'utilities/module';\nimport {has, deep_copy, fetchJSON} from 'utilities/object';\nimport { getBuster } from 'utilities/time';\n\nimport Cookie from 'js-cookie';\nimport SHA1 from 'crypto-js/sha1';\n\nimport type SettingsManager from './settings';\nimport type { ExperimentTypeMap } from 'utilities/types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\texperiments: ExperimentManager;\n\t}\n\tinterface ModuleEventMap {\n\t\texperiments: ExperimentEvents;\n\t}\n\tinterface ProviderTypeMap {\n\t\t'experiment-overrides': {\n\t\t\t[K in keyof ExperimentTypeMap]?: ExperimentTypeMap[K];\n\t\t}\n\t}\n\tinterface PubSubCommands {\n\t\treload_experiments: [];\n\t\tupdate_experiment: {\n\t\t\tkey: keyof ExperimentTypeMap,\n\t\t\tdata: FFZExperimentData | ExperimentGroup[]\n\t\t};\n\t}\n}\n\ndeclare global {\n\tinterface Window {\n\t\t__twilightSettings?: {\n\t\t\texperiments?: Record<string, TwitchExperimentData>;\n\t\t}\n\t}\n}\n\n\nconst OVERRIDE_COOKIE = 'experiment_overrides',\n\tCOOKIE_OPTIONS = {\n\t\texpires: 7,\n\t\tdomain: '.twitch.tv'\n\t};\n\n\n// We want to import this so that the file is included in the output.\n// We don't load using this because we might want a newer file from the\n// server. Because of our webpack settings, this is imported as a URL\n// and not an object.\nconst EXPERIMENTS: string = require('./experiments.json');\n\n// ============================================================================\n// Data Types\n// ============================================================================\n\nexport enum TwitchExperimentType {\n\tUnknown = 0,\n\tDevice = 1,\n\tUser = 2,\n\tChannel = 3\n};\n\nexport type ExperimentGroup = {\n\tvalue: unknown;\n\tweight: number;\n};\n\nexport type FFZExperimentData = {\n\tname: string;\n\tseed?: number;\n\tdescription: string;\n\tgroups: ExperimentGroup[];\n}\n\nexport type TwitchExperimentData = {\n\tname: string;\n\tt: TwitchExperimentType;\n\tv: number;\n\tgroups: ExperimentGroup[];\n};\n\nexport type ExperimentData = FFZExperimentData | TwitchExperimentData;\n\n\nexport type OverrideCookie = {\n\texperiments: Record<string, string>;\n\tdisabled: string[];\n};\n\n\ntype ExperimentEvents = {\n\t':changed': [key: string, new_value: any, old_value: any];\n\t':twitch-changed': [key: string, new_value: string | null, old_value: string | null];\n\t[key: `:twitch-changed:${string}`]: [new_value: string | null, old_value: string | null];\n} & {\n\t[K in keyof ExperimentTypeMap as `:changed:${K}`]: [new_value: ExperimentTypeMap[K], old_value: ExperimentTypeMap[K] | null];\n};\n\n\ntype ExperimentLogEntry = {\n\tkey: string;\n\tname: string;\n\tvalue: any;\n\toverride: boolean;\n\trarity: number;\n\ttype?: string;\n}\n\n\n// ============================================================================\n// Helper Methods\n// ============================================================================\n\nexport function isTwitchExperiment(exp: ExperimentData): exp is TwitchExperimentData {\n\treturn 't' in exp;\n}\n\nexport function isFFZExperiment(exp: ExperimentData): exp is FFZExperimentData {\n\treturn 'description' in exp;\n}\n\nfunction sortExperimentLog(a: ExperimentLogEntry, b: ExperimentLogEntry) {\n\tif ( a.rarity < b.rarity )\n\t\treturn -1;\n\telse if ( a.rarity > b.rarity )\n\t\treturn 1;\n\n\tif ( a.name < b.name )\n\t\treturn -1;\n\telse if ( a.name > b.name )\n\t\treturn 1;\n\n\treturn 0;\n}\n\n\n// ============================================================================\n// Experiment Manager\n// ============================================================================\n\nexport default class ExperimentManager extends Module<'experiments', ExperimentEvents> {\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\tunique_id?: string;\n\texperiments: Partial<{\n\t\t[K in keyof ExperimentTypeMap]: FFZExperimentData;\n\t}>;\n\n\tprivate cache: Map<keyof ExperimentTypeMap, unknown>;\n\n\n\t// Helpers\n\tCookie: typeof Cookie;\n\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.get = this.getAssignment;\n\n\t\tthis.inject('settings');\n\n\t\tthis.settings.addUI('experiments', {\n\t\t\tpath: 'Debugging > Experiments',\n\t\t\tcomponent: 'experiments',\n\t\t\tno_filter: true,\n\n\t\t\tgetExtraTerms: () => {\n\t\t\t\tconst values: string[] = [];\n\n\t\t\t\tfor(const [key, val] of Object.entries(this.experiments)) {\n\t\t\t\t\tvalues.push(key);\n\t\t\t\t\tif ( val.name )\n\t\t\t\t\t\tvalues.push(val.name);\n\t\t\t\t\tif ( val.description )\n\t\t\t\t\t\tvalues.push(val.description);\n\t\t\t\t}\n\n\t\t\t\tfor(const [key, val] of Object.entries(this.getTwitchExperiments())) {\n\t\t\t\t\tvalues.push(key);\n\t\t\t\t\tif ( val.name )\n\t\t\t\t\t\tvalues.push(val.name);\n\t\t\t\t}\n\n\t\t\t\treturn values;\n\t\t\t},\n\n\t\t\tis_locked: () => this.getControlsLocked(),\n\t\t\tunlock: () => this.unlockControls(),\n\n\t\t\tunique_id: () => this.unique_id,\n\n\t\t\tffz_data: () => deep_copy(this.experiments),\n\t\t\ttwitch_data: () => deep_copy(this.getTwitchExperiments()),\n\n\t\t\tusingTwitchExperiment: (key: string) => this.usingTwitchExperiment(key),\n\t\t\tgetTwitchAssignment: (key: string) => this.getTwitchAssignment(key),\n\t\t\tgetTwitchType: (type: TwitchExperimentType) => this.getTwitchType(type),\n\t\t\thasTwitchOverride: (key: string) => this.hasTwitchOverride(key),\n\t\t\tsetTwitchOverride: (key: string, val: string) => this.setTwitchOverride(key, val),\n\t\t\tdeleteTwitchOverride: (key: string) => this.deleteTwitchOverride(key),\n\n\t\t\tgetAssignment: <K extends keyof ExperimentTypeMap>(key: K) => this.getAssignment(key),\n\t\t\thasOverride: (key: keyof ExperimentTypeMap) => this.hasOverride(key),\n\t\t\tsetOverride: <K extends keyof ExperimentTypeMap>(key: K, val: ExperimentTypeMap[K]) => this.setOverride(key, val),\n\t\t\tdeleteOverride: (key: keyof ExperimentTypeMap) => this.deleteOverride(key),\n\n\t\t\ton: (...args: Parameters<typeof this.on>) => this.on(...args),\n\t\t\toff: (...args: Parameters<typeof this.off>) => this.off(...args)\n\t\t});\n\n\t\tthis.unique_id = Cookie.get('unique_id');\n\n\t\tthis.Cookie = Cookie;\n\n\t\tthis.experiments = {};\n\t\tthis.cache = new Map;\n\t}\n\n\n\tgetControlsLocked() {\n\t\tif ( DEBUG )\n\t\t\treturn false;\n\n\t\tconst ts = this.settings.provider.get<number>('exp-lock', 0);\n\t\tif ( isNaN(ts) || ! isFinite(ts) )\n\t\t\treturn true;\n\n\t\treturn Date.now() - ts >= 86400000;\n\t}\n\n\tunlockControls() {\n\t\tthis.settings.provider.set('exp-lock', Date.now());\n\t}\n\n\tasync onLoad() {\n\t\tawait this.loadExperiments();\n\t}\n\n\n\tasync loadExperiments() {\n\t\tlet data: Record<keyof ExperimentTypeMap, FFZExperimentData> | null;\n\n\t\ttry {\n\t\t\tdata = await fetchJSON(DEBUG\n\t\t\t\t? EXPERIMENTS\n\t\t\t\t: `${SERVER}/script/experiments.json?_=${getBuster()}`\n\t\t\t);\n\n\t\t} catch(err) {\n\t\t\tthis.log.warn('Unable to load experiment data.', err);\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! data )\n\t\t\treturn;\n\n\t\tthis.experiments = data;\n\n\t\tconst old_cache = this.cache;\n\t\tthis.cache = new Map;\n\n\t\tlet changed = 0;\n\n\t\tfor(const [key, old_val] of old_cache.entries()) {\n\t\t\tconst new_val = this.getAssignment(key);\n\t\t\tif ( old_val !== new_val ) {\n\t\t\t\tchanged++;\n\t\t\t\tthis.emit(':changed', key, new_val, old_val);\n\t\t\t\tthis.emit(`:changed:${key as keyof ExperimentTypeMap}`, new_val as any, old_val as any);\n\t\t\t}\n\t\t}\n\n\t\tthis.log.info(`Loaded information on ${Object.keys(data).length} experiments.${changed > 0 ? ` ${changed} values updated.` : ''}`);\n\t\t//this.emit(':loaded');\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.on('pubsub:command:reload_experiments', this.loadExperiments, this);\n\t\tthis.on('pubsub:command:update_experiment', data => {\n\t\t\tthis.updateExperiment(data.key, data.data);\n\t\t}, this);\n\t}\n\n\n\tupdateExperiment(key: keyof ExperimentTypeMap, data: FFZExperimentData | ExperimentGroup[]) {\n\t\tthis.log.info(`Received updated data for experiment \"${key}\" via PubSub.`, data);\n\n\t\tif ( Array.isArray(data) ) {\n\t\t\tconst existing = this.experiments[key];\n\t\t\tif ( ! existing )\n\t\t\t\treturn;\n\n\t\t\texisting.groups = data;\n\n\t\t} else if ( data?.groups )\n\t\t\tthis.experiments[key] = data;\n\n\t\tthis._rebuildKey(key);\n\t}\n\n\n\tgenerateLog() {\n\t\tconst out = [\n\t\t\t`Unique ID: ${this.unique_id}`,\n\t\t\t''\n\t\t];\n\n\t\tconst ffz_assignments: ExperimentLogEntry[] = [];\n\t\tfor(const [key, value] of Object.entries(this.experiments) as [keyof ExperimentTypeMap, FFZExperimentData][]) {\n\t\t\tconst assignment = this.getAssignment(key),\n\t\t\t\toverride = this.hasOverride(key);\n\n\t\t\tlet weight = 0, total = 0;\n\t\t\tfor(const group of value.groups) {\n\t\t\t\tif ( group.value === assignment )\n\t\t\t\t\tweight = group.weight;\n\t\t\t\ttotal += group.weight;\n\t\t\t}\n\n\t\t\tif ( ! override && weight === total )\n\t\t\t\tcontinue;\n\n\t\t\tffz_assignments.push({\n\t\t\t\tkey,\n\t\t\t\tname: value.name,\n\t\t\t\tvalue: assignment,\n\t\t\t\toverride,\n\t\t\t\trarity: weight / total\n\t\t\t});\n\n\t\t\t//out.push(`FFZ | ${value.name}: ${this.getAssignment(key)}${this.hasOverride(key) ? ' (Overriden)' : ''}`);\n\t\t}\n\n\t\tffz_assignments.sort(sortExperimentLog);\n\n\t\tfor(const entry of ffz_assignments)\n\t\t\tout.push(`FFZ | ${entry.name}: ${entry.value}${entry.override ? ' (Override)' : ''} (r:${entry.rarity})`);\n\n\t\tconst twitch_assignments: ExperimentLogEntry[] = [],\n\t\t\tchannel = this.settings.get('context.channel');\n\n\t\tfor(const [key, value] of Object.entries(this.getTwitchExperiments())) {\n\t\t\tif ( ! this.usingTwitchExperiment(key) )\n\t\t\t\tcontinue;\n\n\t\t\tconst assignment = this.getTwitchAssignment(key),\n\t\t\t\toverride = this.hasTwitchOverride(key);\n\n\t\t\tlet weight = 0, total = 0;\n\t\t\tfor(const group of value.groups) {\n\t\t\t\tif ( group.value === assignment )\n\t\t\t\t\tweight = group.weight;\n\t\t\t\ttotal += group.weight;\n\t\t\t}\n\n\t\t\tif ( ! override && weight === total )\n\t\t\t\tcontinue;\n\n\t\t\ttwitch_assignments.push({\n\t\t\t\tkey,\n\t\t\t\tname: value.name,\n\t\t\t\tvalue: assignment,\n\t\t\t\toverride,\n\t\t\t\ttype: this.getTwitchTypeByKey(key),\n\t\t\t\trarity: weight / total\n\t\t\t});\n\n\t\t\t//out.push(`TWITCH | ${value.name}: ${this.getTwitchAssignment(key)}${this.hasTwitchOverride(key) ? ' (Overriden)' : ''}`)\n\t\t}\n\n\t\ttwitch_assignments.sort(sortExperimentLog);\n\n\t\tfor(const entry of twitch_assignments)\n\t\t\tout.push(`Twitch | ${entry.name}: ${entry.value}${entry.override ? ' (Override)' : ''} (r:${entry.rarity}, t:${entry.type}${entry.type === 'channel_id' ? `, c:${channel}`: ''})`);\n\n\t\treturn out.join('\\n');\n\t}\n\n\n\t// Twitch Experiments\n\n\tgetTwitchType(type: number) {\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\tif ( core?.experiments?.getExperimentType )\n\t\t\treturn core.experiments.getExperimentType(type);\n\n\t\tif ( type === 1 )\n\t\t\treturn 'device_id';\n\t\telse if ( type === 2 )\n\t\t\treturn 'user_id';\n\t\telse if ( type === 3 )\n\t\t\treturn 'channel_id';\n\t\treturn type;\n\t}\n\n\tgetTwitchTypeByKey(key: string) {\n\t\tconst exps = this.getTwitchExperiments(),\n\t\t\texp = exps?.[key];\n\n\t\tif ( exp?.t )\n\t\t\treturn this.getTwitchType(exp.t);\n\n\t\treturn null;\n\t}\n\n\tgetTwitchExperiments(): Record<string, TwitchExperimentData> {\n\t\tif ( window.__twilightSettings )\n\t\t\treturn window.__twilightSettings.experiments ?? {};\n\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\treturn core && core.experiments.experiments || {};\n\t}\n\n\n\tusingTwitchExperiment(key: string) {\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\treturn core && has(core.experiments.assignments, key)\n\t}\n\n\n\tprivate _getOverrideCookie() {\n\t\tconst raw = Cookie.get(OVERRIDE_COOKIE);\n\t\tlet out: OverrideCookie;\n\n\t\ttry {\n\t\t\tout = raw ? JSON.parse(raw) : {};\n\t\t} catch(err) {\n\t\t\tout = {} as OverrideCookie;\n\t\t}\n\n\t\tif ( ! out.experiments )\n\t\t\tout.experiments = {};\n\n\t\tif ( ! out.disabled )\n\t\t\tout.disabled = [];\n\n\t\treturn out;\n\t}\n\n\tprivate _saveOverrideCookie(value?: OverrideCookie) {\n\t\tif ( value ) {\n\t\t\tif ((! value.experiments || ! Object.keys(value.experiments).length) &&\n\t\t\t\t(! value.disabled || ! value.disabled.length)\n\t\t\t)\n\t\t\t\tvalue = undefined;\n\t\t}\n\n\t\tif ( value )\n\t\t\tCookie.set(OVERRIDE_COOKIE, JSON.stringify(value), COOKIE_OPTIONS);\n\t\telse\n\t\t\tCookie.remove(OVERRIDE_COOKIE, COOKIE_OPTIONS);\n\t}\n\n\n\tprivate _checkExternalAccess() {\n\t\tlet stack;\n\t\ttry {\n\t\t\tstack = new Error().stack;\n\t\t} catch(err) {\n\t\t\t/* :thinking: */\n\t\t\ttry {\n\t\t\t\tstack = err.stack;\n\t\t\t} catch(err_again) { /* aww */ }\n\t\t}\n\n\t\tif ( ! stack )\n\t\t\treturn;\n\n\t\tstack = stack.split(/\\s*\\n+\\s*/g).filter(x => x.startsWith('at '));\n\n\t\tlet external = false;\n\n\t\tfor(const line of stack) {\n\t\t\tif ( ! line.includes(SERVER_OR_EXT) ) {\n\t\t\t\texternal = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ( external )\n\t\t\tthis.log.warn('Detected access by external script.');\n\t}\n\n\n\tsetTwitchOverride(key: string, value: string) {\n\t\tconst overrides = this._getOverrideCookie(),\n\t\t\texperiments = overrides.experiments,\n\t\t\tdisabled = overrides.disabled;\n\n\t\tthis._checkExternalAccess();\n\n\t\texperiments[key] = value;\n\n\t\tconst idx = disabled.indexOf(key);\n\t\tif (idx != -1)\n\t\t\tdisabled.splice(idx, 1);\n\n\t\tthis._saveOverrideCookie(overrides);\n\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\tif ( core )\n\t\t\tcore.experiments.overrides[key] = value;\n\n\t\tthis._rebuildTwitchKey(key, true, value);\n\t}\n\n\tdeleteTwitchOverride(key: string) {\n\t\tconst overrides = this._getOverrideCookie(),\n\t\t\texperiments = overrides.experiments;\n\n\t\tthis._checkExternalAccess();\n\n\t\tif ( ! has(experiments, key) )\n\t\t\treturn;\n\n\t\tconst old_val = experiments[key];\n\t\tdelete experiments[key];\n\n\t\tthis._saveOverrideCookie(overrides);\n\n\t\tconst core = this.resolve('site')?.getCore?.();\n\t\tif ( core )\n\t\t\tdelete core.experiments.overrides[key];\n\n\t\tthis._rebuildTwitchKey(key, false, old_val);\n\t}\n\n\thasTwitchOverride(key: string) { // eslint-disable-line class-methods-use-this\n\t\tconst overrides = this._getOverrideCookie(),\n\t\t\texperiments = overrides.experiments;\n\n\t\treturn has(experiments, key);\n\t}\n\n\tgetTwitchAssignment(key: string, channel: string | null = null) {\n\t\tconst core = this.resolve('site')?.getCore?.(),\n\t\t\texps = core && core.experiments;\n\n\t\tif ( ! exps )\n\t\t\treturn null;\n\n\t\tif ( ! exps.hasInitialized && exps.initialize )\n\t\t\ttry {\n\t\t\t\texps.initialize();\n\t\t\t} catch(err) {\n\t\t\t\tthis.log.warn('Error attempting to initialize Twitch experiments tracker.', err);\n\t\t\t}\n\n\t\tif ( exps.overrides && exps.overrides[key] )\n\t\t\treturn exps.overrides[key];\n\n\t\tconst exp_data = exps.experiments[key],\n\t\t\ttype = this.getTwitchType(exp_data?.t ?? 0);\n\n\t\t// channel_id experiments always use getAssignmentById\n\t\tif ( type === 'channel_id' ) {\n\t\t\treturn exps.getAssignmentById(key, {\n\t\t\t\tbucketing: {\n\t\t\t\t\ttype: 1,\n\t\t\t\t\tvalue: channel ?? this.settings.get('context.channelID')\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Otherwise, just use the default assignment?\n\t\tif ( exps.assignments?.[key] )\n\t\t\treturn exps.assignments[key];\n\n\t\t// If there is no default assignment, we should try to figure out\n\t\t// what assignment they *would* get.\n\n\t\tif ( type === 'device_id' )\n\t\t\treturn exps.selectTreatment(key, exp_data, this.unique_id);\n\n\t\telse if ( type === 'user_id' )\n\t\t\t// Technically, some experiments are expecting to get the user's\n\t\t\t// login rather than user ID. But we don't care that much if an\n\t\t\t// inactive legacy experiment is shown wrong. Meh.\n\t\t\treturn exps.selectTreatment(key, exp_data, this.resolve('site')?.getUser?.()?.id);\n\n\t\t// We don't know what kind of experiment this is.\n\t\t// Give up!\n\t\treturn null;\n\t}\n\n\tgetTwitchKeyFromName(name: string) {\n\t\tconst experiments = this.getTwitchExperiments();\n\t\tif ( ! experiments )\n\t\t\treturn;\n\n\t\tname = name.toLowerCase();\n\t\tfor(const key in experiments)\n\t\t\tif ( has(experiments, key) ) {\n\t\t\t\tconst data = experiments[key];\n\t\t\t\tif ( data && data.name && data.name.toLowerCase() === name )\n\t\t\t\t\treturn key;\n\t\t\t}\n\t}\n\n\tgetTwitchAssignmentByName(name: string, channel: string | null = null) {\n\t\tconst key = this.getTwitchKeyFromName(name);\n\t\tif ( ! key )\n\t\t\treturn null;\n\t\treturn this.getTwitchAssignment(key, channel);\n\t}\n\n\tprivate _rebuildTwitchKey(\n\t\tkey: string,\n\t\tis_set: boolean,\n\t\tnew_val: string | null\n\t) {\n\t\tconst core = this.resolve('site')?.getCore?.(),\n\t\t\texps = core.experiments,\n\n\t\t\told_val = has(exps.assignments, key) ?\n\t\t\t\texps.assignments[key] as string :\n\t\t\t\tnull;\n\n\t\tif ( old_val !== new_val ) {\n\t\t\tconst value = is_set ? new_val : old_val;\n\t\t\tthis.emit(':twitch-changed', key, value, old_val);\n\t\t\tthis.emit(`:twitch-changed:${key}`, value, old_val);\n\t\t}\n\t}\n\n\n\t// FFZ Experiments\n\n\tsetOverride<\n\t\tK extends keyof ExperimentTypeMap\n\t>(key: K, value: ExperimentTypeMap[K]) {\n\t\tconst overrides = this.settings.provider.get('experiment-overrides', {});\n\t\toverrides[key] = value;\n\n\t\tthis.settings.provider.set('experiment-overrides', overrides);\n\n\t\tthis._rebuildKey(key);\n\t}\n\n\tdeleteOverride(key: keyof ExperimentTypeMap) {\n\t\tconst overrides = this.settings.provider.get('experiment-overrides');\n\t\tif ( ! overrides || ! has(overrides, key) )\n\t\t\treturn;\n\n\t\tdelete overrides[key];\n\t\tif ( Object.keys(overrides).length )\n\t\t\tthis.settings.provider.set('experiment-overrides', overrides);\n\t\telse\n\t\t\tthis.settings.provider.delete('experiment-overrides');\n\n\t\tthis._rebuildKey(key);\n\t}\n\n\thasOverride(key: keyof ExperimentTypeMap) {\n\t\tconst overrides = this.settings.provider.get('experiment-overrides');\n\t\treturn overrides ? has(overrides, key): false;\n\t}\n\n\tget: <K extends keyof ExperimentTypeMap>(\n\t\tkey: K\n\t) => ExperimentTypeMap[K];\n\n\tgetAssignment<K extends keyof ExperimentTypeMap>(\n\t\tkey: K\n\t): ExperimentTypeMap[K] {\n\t\tif ( this.cache.has(key) )\n\t\t\treturn this.cache.get(key) as ExperimentTypeMap[K];\n\n\t\tconst experiment = this.experiments[key];\n\t\tif ( ! experiment ) {\n\t\t\tthis.log.warn(`Tried to get assignment for experiment \"${key}\" which is not known.`);\n\t\t\treturn null as ExperimentTypeMap[K];\n\t\t}\n\n\t\tconst overrides = this.settings.provider.get('experiment-overrides'),\n\t\t\tout = overrides && has(overrides, key) ?\n\t\t\t\toverrides[key] :\n\t\t\t\tExperimentManager.selectGroup<ExperimentTypeMap[K]>(key, experiment, this.unique_id ?? '');\n\n\t\tthis.cache.set(key, out);\n\t\treturn out as ExperimentTypeMap[K];\n\t}\n\n\tprivate _rebuildKey(key: keyof ExperimentTypeMap) {\n\t\tif ( ! this.cache.has(key) )\n\t\t\treturn;\n\n\t\tconst old_val = this.cache.get(key);\n\t\tthis.cache.delete(key);\n\t\tconst new_val = this.getAssignment(key);\n\n\t\tif ( new_val !== old_val ) {\n\t\t\tthis.emit(':changed', key, new_val, old_val);\n\t\t\tthis.emit(`:changed:${key}`, new_val, old_val);\n\t\t}\n\t}\n\n\n\tstatic selectGroup<T>(\n\t\tkey: string,\n\t\texperiment: FFZExperimentData,\n\t\tunique_id: string\n\t): T | null {\n\t\tconst seed = key + unique_id + (experiment.seed || ''),\n\t\t\ttotal = experiment.groups.reduce((a,b) => a + b.weight, 0);\n\n\t\tlet value = (SHA1(seed).words[0] >>> 0) / Math.pow(2, 32);\n\n\t\tfor(const group of experiment.groups) {\n\t\t\tvalue -= group.weight / total;\n\t\t\tif ( value <= 0 )\n\t\t\t\treturn group.value as T;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Socket Client\n// This connects to the FrankerFaceZ socket servers for PubSub and RPC.\n// ============================================================================\n\nimport Module from 'utilities/module';\nimport {DEBUG, WS_CLUSTERS} from 'utilities/constants';\nimport { on } from 'utilities/dom';\n\n\nexport const State = {\n\tDISCONNECTED: 0,\n\tCONNECTING: 1,\n\tCONNECTED: 2\n}\n\n\nconst ANONYMOUS_ID = '683b45e4-f853-4c45-bf96-7d799cc93e34';\n\n\nexport default class SocketClient extends Module {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('experiments');\n\n\t\tthis.settings.addUI('socket.info', {\n\t\t\tpath: 'Debugging > Socket >> Info @{\"sort\": -1000}',\n\t\t\tforce_seen: true,\n\t\t\tno_filter: true,\n\t\t\tcomponent: 'socket-info',\n\n\t\t\tgetSocket: () => this,\n\t\t});\n\n\t\tthis.settings.add('auth.mode', {\n\t\t\tdefault: 'chat',\n\n\t\t\tui: {\n\t\t\t\tpath: 'Data Management > Authentication >> General',\n\t\t\t\ttitle: 'Authentication Provider',\n\t\t\t\tdescription: 'Which method should the FrankerFaceZ client use to authenticate against the FFZ servers when necessary?',\n\t\t\t\tcomponent: 'setting-select-box',\n\t\t\t\tforce_seen: true,\n\n\t\t\t\tdata: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'chat',\n\t\t\t\t\t\ttitle: 'Twitch Chat'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: false,\n\t\t\t\t\t\ttitle: 'Disabled (No Authentication)'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tchanged: () => this._cached_token = null\n\t\t});\n\n\t\tthis.settings.add('socket.use-cluster', {\n\t\t\tdefault: 'Production',\n\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging @{\"expanded\": false, \"sort\": 9999} > Socket >> General',\n\t\t\t\ttitle: 'Server Cluster',\n\t\t\t\tdescription: 'Which server cluster to connect to. Do not change this unless you are actually doing development work on the socket server backend. Doing so will break all features relying on the socket server, including emote information lookups, link tooltips, and live data updates.',\n\n\t\t\t\tcomponent: 'setting-select-box',\n\n\t\t\t\tdata: [{\n\t\t\t\t\tvalue: null,\n\t\t\t\t\ttitle: 'Disabled'\n\t\t\t\t}].concat(Object.keys(WS_CLUSTERS).map(x => ({\n\t\t\t\t\tvalue: x,\n\t\t\t\t\ttitle: x\n\t\t\t\t})))\n\t\t\t}\n\t\t});\n\n\t\tthis._want_connected = false;\n\n\t\tthis._topics = new Map;\n\t\tthis._pending = [];\n\t\tthis._awaiting = new Map;\n\n\t\tthis._socket = null;\n\t\tthis._state = 0;\n\t\tthis._last_id = 1;\n\n\t\tthis._delay = 0;\n\t\tthis._last_ping = null;\n\t\tthis._time_drift = 0;\n\n\t\tthis._host_idx = -1;\n\t\tthis._host_pool = -1;\n\n\t\tthis.settings.on(':changed:socket.use-cluster', () => {\n\t\t\tthis._host = null;\n\t\t\tif ( this.disconnected )\n\t\t\t\tthis.connect();\n\t\t\telse\n\t\t\t\tthis.reconnect();\n\t\t});\n\n\t\tthis.on(':command:reconnect', this.reconnect, this);\n\n\t\tthis.on(':command:do_authorize', challenge => {\n\t\t\t// this.log.warn('Unimplemented: do_authorize', challenge);\n\t\t\t// We don't have our own IRC connection yet, so the site's chat has to do.\n\n\t\t\tconst _chat = this.resolve('site.chat');\n\t\t\tconst chat = _chat && _chat.ChatService.first;\n\t\t\tconst con = chat.client && chat.client.connection;\n\n\t\t\tif (con && con.send)\n\t\t\t\tcon.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${challenge}`);\n\t\t});\n\n\n\t\tthis.enable();\n\t}\n\n\n\tonEnable() {\n\t\t// We don't connect anymore.\n\t\t// For now, stop connecting to the sockets for people using the\n\t\t// API links experiment.\n\t\t//if ( this.experiments.getAssignment('api_links') )\n\t\t//\treturn;\n\t\t//this.connect();\n\t}\n\tonDisable() { this.disconnect() }\n\n\n\t// ========================================================================\n\t// Properties\n\t// ========================================================================\n\n\tget connected() {\n\t\treturn this._state === State.CONNECTED;\n\t}\n\n\n\tget connecting() {\n\t\treturn this._state === State.CONNECTING;\n\t}\n\n\n\tget disconnected() {\n\t\treturn this._state === State.DISCONNECTED;\n\t}\n\n\n\t// ========================================================================\n\t// FFZ API Helpers\n\t// ========================================================================\n\n\tgetAPIToken() {\n\t\tconst mode = this.settings.get('auth.mode');\n\n\t\tif ( mode === 'chat' )\n\t\t\treturn this._getAPIToken_Chat();\n\n\t\treturn Promise.reject(new Error('The user has disabled authentication.'));\n\t}\n\n\t_getAPIToken_Chat() {\n\t\tif ( this._cached_token ) {\n\t\t\tif ( this._cached_token.expires > (Date.now() + 15000) )\n\t\t\t\treturn Promise.resolve(this._cached_token);\n\t\t}\n\n\t\tif ( this._token_waiters )\n\t\t\treturn new Promise((s, f) => this._token_waiters.push([s, f]));\n\n\t\tthis._token_waiters = [];\n\n\t\treturn new Promise((s, f) => {\n\t\t\tthis._token_waiters.push([s, f]);\n\n\t\t\tlet done = false, timer = null;\n\n\t\t\tconst fail = err => {\n\t\t\t\tif ( done )\n\t\t\t\t\treturn;\n\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tdone = true;\n\t\t\t\tthis.log.error('Unable to get API token.', err);\n\t\t\t\tconst waiters = this._token_waiters;\n\t\t\t\tthis._token_waiters = null;\n\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\t\t\t}\n\n\t\t\tconst user = this.resolve('site')?.getUser?.();\n\t\t\tif ( ! user || ! user.id )\n\t\t\t\treturn fail(new Error('Unable to get current user or not logged in.'));\n\n\t\t\tconst es = new EventSource(`https://api.frankerfacez.com/auth/ext_verify/${user.id}`);\n\n\t\t\ton(es, 'challenge', event => {\n\t\t\t\tconst conn = this.resolve('site.chat')?.ChatService?.first?.client?.connection;\n\t\t\t\tif ( conn && conn.send )\n\t\t\t\t\tconn.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${event.data}`);\n\t\t\t});\n\n\t\t\ton(es, 'token', event => {\n\t\t\t\tif ( done )\n\t\t\t\t\treturn;\n\n\t\t\t\tclearTimeout(timer);\n\n\t\t\t\tlet token = null;\n\t\t\t\ttry {\n\t\t\t\t\ttoken = JSON.parse(event.data);\n\t\t\t\t} catch(err) {\n\t\t\t\t\tfail(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( ! token || ! token.token ) {\n\t\t\t\t\tfail(new Error('Received empty token from server.'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttoken.expires = (new Date(token.expires)).getTime();\n\t\t\t\tthis._cached_token = token;\n\n\t\t\t\tdone = true;\n\n\t\t\t\tconst waiters = this._token_waiters;\n\t\t\t\tthis._token_waiters = null;\n\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[0](token);\n\t\t\t});\n\n\t\t\ton(es, 'error', err => {\n\t\t\t\tfail(err);\n\t\t\t});\n\n\t\t\ton(es, 'close', () => {\n\t\t\t\tes.close();\n\t\t\t\tif ( ! done )\n\t\t\t\t\tfail(new Error('Connection closed unexpectedly.'));\n\t\t\t});\n\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tfail(new Error('timeout'));\n\t\t\t}, 5000);\n\n\t\t\t/*this.call('get_api_token').then(token => {\n\t\t\t\ttoken.expires = (new Date(token.expires)).getTime();\n\t\t\t\tthis._cached_token = token;\n\n\t\t\t\tconst waiters = this._token_waiters;\n\t\t\t\tthis._token_waiters = null;\n\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[0](token);\n\n\t\t\t}).catch(err => {\n\t\t\t\tthis.log.error('Unable to get API token.', err);\n\t\t\t\tconst waiters = this._token_waiters;\n\t\t\t\tthis._token_waiters = null;\n\n\t\t\t\tfor(const pair of waiters)\n\t\t\t\t\tpair[1](err);\n\t\t\t});*/\n\t\t});\n\t}\n\n\tasync getBareAPIToken() {\n\t\treturn (await this.getAPIToken())?.token;\n\t}\n\n\n\t// ========================================================================\n\t// Connection Logic\n\t// ========================================================================\n\n\tselectHost() {\n\t\tconst cluster_id = this.settings.get('socket.use-cluster'),\n\t\t\tcluster = WS_CLUSTERS[cluster_id],\n\t\t\tl = cluster && cluster.length;\n\n\t\tif ( ! l )\n\t\t\treturn null;\n\n\t\tlet total = 0, i = l;\n\t\twhile(i-- > 0)\n\t\t\ttotal += cluster[i][1];\n\n\t\tlet val = Math.random() * total;\n\t\tfor(let i=0; i < l; i++) {\n\t\t\tval -= cluster[i][1];\n\t\t\tif ( val <= 0 )\n\t\t\t\treturn cluster[i][0];\n\t\t}\n\n\t\treturn cluster[l-1][0];\n\t}\n\n\n\t_reconnect() {\n\t\tif ( ! this._reconnect_timer ) {\n\t\t\tif ( this._delay < 60000 )\n\t\t\t\tthis._delay += (Math.floor(Math.random() * 15) + 5) * 1000;\n\t\t\telse\n\t\t\t\tthis._delay = (Math.floor(Math.random() * 60) + 30) * 1000;\n\n\t\t\tthis._reconnect_timer = setTimeout(() => {\n\t\t\t\tthis.connect();\n\t\t\t}, this._delay);\n\t\t}\n\t}\n\n\n\treconnect() {\n\t\tthis.disconnect();\n\t\tthis._reconnect();\n\t}\n\n\n\tconnect() {\n\t\tthis._want_connected = true;\n\n\t\tif ( this._reconnect_timer ) {\n\t\t\tclearTimeout(this._reconnect_timer);\n\t\t\tthis._reconnect_timer = null;\n\t\t}\n\n\t\tif ( ! this.disconnected )\n\t\t\treturn;\n\n\t\tconst host = this._host = this._host || this.selectHost();\n\t\tif ( ! host )\n\t\t\treturn;\n\n\t\tthis._state = State.CONNECTING;\n\t\tthis._last_id = 1;\n\n\t\tthis._delay = 0;\n\t\tthis._last_ping = null;\n\n\t\tthis.log.info(`Using Server: ${host}`);\n\n\t\tlet ws;\n\n\t\ttry {\n\t\t\tws = this._socket = new WebSocket(host);\n\t\t} catch(err) {\n\t\t\tthis._state = State.DISCONNECTED;\n\t\t\tthis._reconnect();\n\t\t\tthis.log.error('Unable to create WebSocket.', err);\n\t\t\treturn;\n\t\t}\n\n\t\tws.onopen = () => {\n\t\t\tif ( this._socket !== ws ) {\n\t\t\t\tthis.log.warn('A socket connected that is not our primary socket.');\n\t\t\t\treturn ws.close();\n\t\t\t}\n\n\t\t\tthis._state = State.CONNECTED;\n\t\t\tthis._sent_user = false;\n\n\t\t\tthis.log.info('Connected.');\n\n\t\t\t// Initial HELLO. Here we get a Client-ID and initial server timestamp.\n\t\t\t// This is handled entirely on the socket server and so should be\n\t\t\t// fast enough to use as a ping.\n\t\t\tthis._ping_time = performance.now();\n\t\t\tthis._send(\n\t\t\t\t'hello',\n\t\t\t\t[`ffz_${window.FrankerFaceZ.version_info}`, ANONYMOUS_ID],\n\t\t\t\t(success, data) => {\n\t\t\t\t\tif ( ! success )\n\t\t\t\t\t\treturn this.log.warn('Error Saying Hello', data);\n\n\t\t\t\t\tthis._on_pong(false, success, data[1]);\n\t\t\t\t\t/*if ( data[0] === ANONYMOUS_ID )\n\t\t\t\t\t\tthis.log.info('Client ID: <Anonymous>');\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.settings.provider.set('client-id', data[0]);\n\t\t\t\t\t\tthis.log.info('Client ID:', data[0]);\n\t\t\t\t\t}*/\n\t\t\t\t});\n\n\n\t\t\t// Grab the current user from the site.\n\t\t\tconst site = this.resolve('site'),\n\t\t\t\tsend_user = () => {\n\t\t\t\t\tif ( this._sent_user || ! this.connected )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tconst user = site.getUser();\n\t\t\t\t\tif ( user && user.login ) {\n\t\t\t\t\t\tthis._sent_user = true;\n\t\t\t\t\t\tthis._send('setuser', user.login);\n\n\t\t\t\t\t} else if ( ! site.enabled )\n\t\t\t\t\t\tthis.once('site:enabled', send_user, this);\n\t\t\t\t}\n\n\t\t\tsend_user();\n\n\n\t\t\t// Subscribe to Topics\n\t\t\tfor(const topic of this._topics.keys())\n\t\t\t\tthis._send('sub', topic);\n\n\n\t\t\t// Send pending commands.\n\t\t\tfor(const [command, args, callback] of this._pending)\n\t\t\t\tthis._send(command, args, callback);\n\n\t\t\tthis._pending = [];\n\n\n\t\t\t// We're ready.\n\t\t\tthis._send('ready', this._offline_time || 0);\n\t\t\tthis._offline_time = null;\n\t\t\tthis.emit(':connected');\n\t\t}\n\n\t\tws.onerror = () => {\n\t\t\tif ( ws !== this._socket )\n\t\t\t\treturn;\n\n\t\t\tif ( ! this._offline_time )\n\t\t\t\tthis._offline_time = Date.now();\n\t\t}\n\n\t\tws.onclose = event => {\n\t\t\tif ( ws !== this._socket )\n\t\t\t\treturn;\n\n\t\t\tconst old_state = this._state;\n\t\t\tthis.log.info(`Disconnected. (${event.code}:${event.reason})`);\n\n\t\t\tthis._state = State.DISCONNECTED;\n\n\t\t\tfor(const [cmd_id, callback] of this._awaiting) {\n\t\t\t\tconst err = new Error('disconnected');\n\t\t\t\ttry {\n\t\t\t\t\tif ( typeof callback === 'function' )\n\t\t\t\t\t\tcallback(false, err);\n\t\t\t\t\telse\n\t\t\t\t\t\tcallback[1](err);\n\n\t\t\t\t} catch(error) {\n\t\t\t\t\tthis.log.warn(`Callback Error #${cmd_id}`, error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._awaiting.clear();\n\n\t\t\tif ( ! this._want_connected )\n\t\t\t\treturn;\n\n\t\t\tif ( ! this._offline_time )\n\t\t\t\tthis._offline_time = Date.now();\n\n\t\t\t// Reset the host if we didn't manage to connect.\n\t\t\tif ( old_state !== State.CONNECTED )\n\t\t\t\tthis._host = null;\n\n\t\t\tthis._reconnect();\n\t\t\tthis.emit(':closed', event.code, event.reason);\n\t\t}\n\n\n\t\tws.onmessage = event => {\n\t\t\tif ( ws !== this._socket )\n\t\t\t\treturn;\n\n\t\t\t// Format:\n\t\t\t//    -1 <cmd_name>[ <json_data>]\n\t\t\t//    <reply-id> <ok/err>[ <json_data>]\n\n\t\t\tconst raw = event.data,\n\t\t\t\tidx = raw.indexOf(' ');\n\n\t\t\tif ( idx === -1 )\n\t\t\t\treturn  this.log.warn('Malformed message from server.', event.data);\n\n\t\t\tconst reply = parseInt(raw.slice(0, idx), 10),\n\t\t\t\tix2 = raw.indexOf(' ', idx + 1),\n\n\t\t\t\tcmd = raw.slice(idx+1, ix2 === -1 ? raw.length : ix2),\n\t\t\t\tdata = ix2 === -1 ? undefined : JSON.parse(raw.slice(ix2+1));\n\n\t\t\tif ( reply === -1 ) {\n\t\t\t\tthis.log.debug(`Received Command: ${cmd}`, data);\n\t\t\t\tthis.emit(`:command:${cmd}`, data);\n\n\t\t\t} else {\n\t\t\t\tconst success = cmd === 'ok',\n\t\t\t\t\tcallback = this._awaiting.get(reply);\n\n\t\t\t\tif ( callback ) {\n\t\t\t\t\tthis._awaiting.delete(reply);\n\t\t\t\t\tif ( typeof callback === 'function' )\n\t\t\t\t\t\tcallback(success, data);\n\t\t\t\t\telse\n\t\t\t\t\t\tcallback[success ? 0 : 1](data);\n\n\t\t\t\t} else if ( ! success || DEBUG )\n\t\t\t\t\tthis.log.info(`Received Reply #${reply}:`, success ? 'OK' : 'Error', data);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tdisconnect() {\n\t\tthis._want_connected = false;\n\n\t\tif ( this._reconnect_timer ) {\n\t\t\tclearTimeout(this._reconnect_timer);\n\t\t\tthis._reconnect_timer = null;\n\t\t}\n\n\t\tif ( this.disconnected )\n\t\t\treturn;\n\n\t\ttry {\n\t\t\tthis._socket.close();\n\t\t} catch(err) { /* if this caused an exception, we don't care -- it's still closed */ }\n\n\t\tthis._socket = null;\n\t\tthis._state = State.DISCONNECTED;\n\t\tthis.emit(':disconnected');\n\t}\n\n\n\t// ========================================================================\n\t// Latency\n\t// ========================================================================\n\n\t_on_pong(skip_log, success, data) {\n\t\tconst now = performance.now();\n\n\t\tif ( ! success ) {\n\t\t\tthis._ping_time = null;\n\t\t\tif ( ! skip_log )\n\t\t\t\tthis.log.warn('Error Pinging Server', data);\n\n\t\t} else if ( this._ping_time ) {\n\t\t\tconst d_now = Date.now(),\n\t\t\t\trtt = now - this._ping_time,\n\t\t\t\tping = this._last_ping = rtt / 2;\n\n\t\t\tthis._ping_time = null;\n\t\t\tconst drift = this._time_drift = d_now - (data + ping);\n\n\t\t\tif ( ! skip_log ) {\n\t\t\t\tthis.log.info('Server Time:', new Date(data).toISOString());\n\t\t\t\tthis.log.info(' Local Time:', new Date(d_now).toISOString());\n\t\t\t\tthis.log.info(`  Est. Ping: ${ping.toFixed(5)}ms`);\n\t\t\t\tthis.log.info(`Time Offset: ${drift / 1000}`);\n\n\t\t\t\tif ( Math.abs(drift) > 300000 )\n\t\t\t\t\tthis.log.warn('Local time differs from server time by more than 5 minutes.');\n\t\t\t}\n\t\t}\n\n\t\tthis.emit(':pong');\n\t}\n\n\n\tping(skip_log) {\n\t\tif ( this._ping_time || ! this.connected )\n\t\t\treturn;\n\n\t\tthis._ping_time = performance.now();\n\t\tthis._send('ping', undefined, (s,d) => this._on_pong(skip_log, s, d));\n\t}\n\n\n\t// ========================================================================\n\t// Communication\n\t// ========================================================================\n\n\t_send(command, args, callback) {\n\t\tif ( ! this.connected )\n\t\t\treturn this.log.warn(`Tried sending command \"${command}\" while disconnected.`);\n\n\t\tconst cmd_id = this._last_id++;\n\t\tif ( callback )\n\t\t\tthis._awaiting.set(cmd_id, callback);\n\n\t\tthis._socket.send(`${cmd_id} ${command}${args !== undefined ? ` ${JSON.stringify(args)}` : ''}`);\n\t}\n\n\n\tsend(command, ...args) {\n\t\tif ( args.length === 1 )\n\t\t\targs = args[0];\n\t\telse if ( ! args.length )\n\t\t\targs = undefined;\n\n\t\tif ( ! this.connected )\n\t\t\tthis._pending.push([command, args]);\n\t\telse\n\t\t\tthis._send(command, args);\n\t}\n\n\n\tcall(command, ...args) {\n\t\tif ( args.length === 1 )\n\t\t\targs = args[0];\n\t\telse if ( ! args.length )\n\t\t\targs = undefined;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif ( ! this.connected )\n\t\t\t\tthis._pending.push([command, args, [resolve, reject]]);\n\t\t\telse\n\t\t\t\tthis._send(command, args, [resolve, reject]);\n\t\t});\n\t}\n\n\n\t// ========================================================================\n\t// Topics\n\t// ========================================================================\n\n\tsubscribe(referrer, ...topics) {\n\t\tconst t = this._topics;\n\t\tlet changed = false;\n\t\tfor(const topic of topics) {\n\t\t\tif ( ! t.has(topic) ) {\n\t\t\t\tif ( this.connected )\n\t\t\t\t\tthis._send('sub', topic);\n\n\t\t\t\tt.set(topic, new Set);\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\t\tconst tp = t.get(topic);\n\t\t\ttp.add(referrer);\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.emit(':sub-change');\n\t}\n\n\n\tunsubscribe(referrer, ...topics) {\n\t\tconst t = this._topics;\n\t\tlet changed = false;\n\t\tfor(const topic of topics) {\n\t\t\tif ( ! t.has(topic) )\n\t\t\t\tcontinue;\n\n\t\t\tconst tp = t.get(topic);\n\t\t\ttp.delete(referrer);\n\n\t\t\tif ( ! tp.size ) {\n\t\t\t\tchanged = true;\n\t\t\t\tt.delete(topic);\n\t\t\t\tif ( this.connected )\n\t\t\t\t\tthis._send('unsub', topic);\n\t\t\t}\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.emit(':sub-change');\n\t}\n\n\n\tget topics() {\n\t\treturn Array.from(this._topics.keys());\n\t}\n\n}\n\n\nSocketClient.State = State;\n","import { EventEmitter } from \"../utilities/events\";\nimport { set_equals, shallow_object_equals } from \"../utilities/object\";\n\nexport type PubSubClientEvents = {\n\tconnect: [event: Event];\n\tdisconnect: [event: Event | null];\n\terror: [event: Event];\n\tmessage: [event: {\n\t\ttopic: string,\n\t\tdata: any\n\t}];\n}\n\nenum State {\n\tDisconnected,\n\tConnecting,\n\tConnected\n}\n\n\nexport function enumerateSubs(topic: string) {\n\t// I initially tried using a generator for this, but\n\t// using an array builder is faster. Less function overhead\n\t// since we're iterating the whole thing anyways, and\n\t// as long as we don't hit our memory limit on the worker\n\t// I really don't care about memory.\n\tlet idx = topic.length;\n\tconst out = [topic];\n\twhile ((idx = topic.lastIndexOf('/', idx - 1)) !== -1)\n\t\tout.push(`${topic.slice(0, idx)}/*`);\n\tout.push('*');\n\treturn out;\n}\n\n\nexport class PubSubClient extends EventEmitter<PubSubClientEvents> {\n\n\t_ws: WebSocket | null = null;\n\t_topics: Set<string> = new Set();\n\t_live_topics: Set<string> = new Set();\n\n\t_want_connection = false;\n\t_state = State.Disconnected;\n\n\t_reconnectTimer: ReturnType<typeof setTimeout> | null = null;\n\t_failedConnections = 0;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis._performReconnect = this._performReconnect.bind(this);\n\n\t}\n\n\t_reconnect(wantDelay: boolean = true) {\n\t\tif ( this._reconnectTimer )\n\t\t\treturn;\n\n\t\tlet delay = 250 + (wantDelay\n\t\t\t? Math.floor(this._failedConnections * (Math.random() * 5000) + 5000)\n\t\t\t: 0);\n\t\tthis._reconnectTimer = setTimeout(this._performReconnect, delay);\n\t}\n\n\t_performReconnect() {\n\n\t\tthis._reconnectTimer = null;\n\n\t\tif (this._ws) {\n\t\t\tthis._ws.close();\n\t\t\tthis._ws = null;\n\t\t\tthis._state = State.Disconnected;\n\t\t}\n\n\t\tthis._live_topics = new Set(this._topics);\n\n\t\tif ( ! this._live_topics.size )\n\t\t\treturn;\n\n\t\tthis._state = State.Connecting;\n\n\t\tconst url = new URL(`wss://pubsub.workers.frankerfacez.com/ws`);\n\t\tif ( this._live_topics.size > 10 )\n\t\t\turl.searchParams.append('t', '*');\n\t\telse\n\t\t\tfor(const topic of this._live_topics)\n\t\t\t\turl.searchParams.append('t', topic);\n\n\t\tconst ws = this._ws = new WebSocket(url.toString());\n\n\t\tws.addEventListener('open', evt => {\n\t\t\tthis._state = State.Connected;\n\t\t\tthis._failedConnections = 0;\n\t\t\tthis.emit('connect', evt);\n\t\t});\n\n\t\tws.addEventListener('error', evt => {\n\t\t\tthis.emit('error', evt);\n\t\t});\n\n\t\tws.addEventListener('close', evt => {\n\t\t\tthis._ws = null;\n\t\t\tthis._state = State.Disconnected;\n\t\t\tthis.emit('disconnect', evt);\n\t\t\tif (this._want_connection)\n\t\t\t\tthis._reconnect();\n\t\t});\n\n\t\tws.addEventListener('message', evt => {\n\t\t\tif (typeof evt.data === 'string') {\n\t\t\t\tlet packet: {topic: string; data: any};\n\t\t\t\ttry {\n\t\t\t\t\tpacket = JSON.parse(evt.data);\n\t\t\t\t} catch(err) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!packet.topic || typeof packet.topic !== 'string')\n\t\t\t\t\treturn;\n\n\t\t\t\t// Validate that we really want this topic.\n\t\t\t\tif (this._live_topics.size > 10 && ! this._live_topics.has(packet.topic)) {\n\t\t\t\t\tlet found = false;\n\t\t\t\t\tfor(const sub of enumerateSubs(packet.topic)) {\n\t\t\t\t\t\tif (this._live_topics.has(sub)) {\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!found)\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.emit('message', packet);\n\t\t\t}\n\t\t});\n\n\t}\n\n\tget connected() {\n\t\treturn this._state === State.Connected;\n\t}\n\n\tget connecting() {\n\t\treturn this._state === State.Connecting;\n\t}\n\n\tget disconnected() {\n\t\treturn this._state === State.Disconnected;\n\t}\n\n\tconnect() {\n\t\tthis._want_connection = true;\n\t\tthis._reconnect(false);\n\t}\n\n\tdisconnect() {\n\t\tthis._want_connection = false;\n\t\tthis._failedConnections = 0;\n\t\tif (this._reconnectTimer) {\n\t\t\tclearTimeout(this._reconnectTimer);\n\t\t\tthis._reconnectTimer = null;\n\t\t}\n\t\tif (this._ws) {\n\t\t\tthis._ws.close();\n\t\t\tthis._ws = null;\n\t\t\tthis._state = State.Disconnected;\n\t\t\tthis.emit('disconnect', null);\n\t\t}\n\t}\n\n\tsubscribe(topics: string | string[]) {\n\t\tif (!Array.isArray(topics))\n\t\t\ttopics = [topics];\n\n\t\tfor(const topic of topics)\n\t\t\tthis._topics.add(topic);\n\n\t\tif (this._want_connection && !set_equals(this._topics, this._live_topics))\n\t\t\tthis._reconnect();\n\t}\n\n\tunsubscribe(topics: string | string[]) {\n\t\tif (!Array.isArray(topics))\n\t\t\ttopics = [topics];\n\n\t\tfor(const topic of topics)\n\t\t\tthis._topics.delete(topic);\n\n\t\tif (this._want_connection && !set_equals(this._topics, this._live_topics))\n\t\t\tthis._reconnect();\n\t}\n\n\n}\n","'use strict';\n\n// ============================================================================\n// PubSub Client\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { PubSubClient } from './client';\nimport type ExperimentManager from '../experiments';\nimport type SettingsManager from '../settings';\nimport type { PubSubCommands } from 'utilities/types';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\tpubsub: PubSub;\n\t}\n\tinterface ModuleEventMap {\n\t\tpubsub: PubSubEvents;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'pubsub.enabled': boolean;\n\t}\n\tinterface ExperimentTypeMap {\n\t\tworker_pubsub: boolean;\n\t}\n}\n\n\ntype PubSubCommandData<K extends keyof PubSubCommands> = {\n\ttopic: string;\n\tcmd: K;\n\tdata: PubSubCommands[K];\n};\n\ntype PubSubCommandKey = `:command:${keyof PubSubCommands}`;\n\ntype PubSubEvents = {\n\t':sub-change': [];\n\t':message': [topic: string, data: unknown];\n} & {\n\t[K in keyof PubSubCommands as `:command:${K}`]: [data: PubSubCommands[K], meta: PubSubCommandData<K>];\n}\n\n\nexport default class PubSub extends Module<'pubsub', PubSubEvents> {\n\n\t// Dependencies\n\texperiments: ExperimentManager = null as any;\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\t_topics: Map<string, Set<unknown>>;\n\t_client: PubSubClient | null;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.inject('settings');\n\t\tthis.inject('experiments');\n\n\t\tthis.settings.add('pubsub.enabled', {\n\t\t\tdefault: () => this.experiments.getAssignment('worker_pubsub') ?? false,\n\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging @{\"expanded\": false, \"sort\": 9999} > PubSub >> General',\n\t\t\t\ttitle: 'Enable PubSub.',\n\t\t\t\tdescription: 'Whether or not you want your client to connect to FrankerFaceZ\\'s PubSub system. This is still in testing and should be left alone unless you know what you\\'re doing.',\n\t\t\t\tforce_seen: true,\n\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t},\n\n\t\t\tchanged: val => val ? this.connect() : this.disconnect()\n\t\t});\n\n\t\tthis._topics = new Map;\n\t\tthis._client = null;\n\t}\n\n\tonEnable() {\n\t\tthis.subscribe(null, 'global');\n\t\tthis.connect();\n\n\t\tthis.on('experiments:changed:worker_pubsub', this._updateSetting, this);\n\t}\n\n\tonDisable() {\n\t\tthis.off('experiments:changed:worker_pubsub', this._updateSetting, this);\n\n\t\tthis.disconnect();\n\t\tthis.unsubscribe(null, 'global');\n\t}\n\n\t_updateSetting() {\n\t\tthis.settings.update('pubsub.enabled');\n\t}\n\n\n\t// ========================================================================\n\t// Properties\n\t// ========================================================================\n\n\tget connected() {\n\t\treturn this._client != null;\n\t}\n\n\n\t// ========================================================================\n\t// Connection Logic\n\t// ========================================================================\n\n\treconnect() {\n\t\tthis.disconnect();\n\t\tthis.connect();\n\t}\n\n\tasync connect() {\n\t\t// If there's already a client, or PubSub is disabled\n\t\t// then we have nothing to do.\n\t\tif ( this._client || ! this.settings.get('pubsub.enabled') )\n\t\t\treturn;\n\n\t\t// Create a new instance of the PubSubClient class.\n\t\tconst client = this._client = new PubSubClient();\n\n\t\t// Connect to the various events.\n\t\tclient.on('connect', () => {\n\t\t\tthis.log.info('Connected to PubSub.');\n\t\t});\n\n\t\tclient.on('disconnect', () => {\n\t\t\tthis.log.info('Disconnected from PubSub.');\n\t\t});\n\n\t\tclient.on('error', err => {\n\t\t\tthis.log.error('Error in PubSub', err);\n\t\t});\n\n\t\tclient.on('message', event => {\n\t\t\tconst topic = event.topic,\n\t\t\t\tdata = event.data as PubSubCommandData<any>;\n\n\t\t\tif ( ! data?.cmd ) {\n\t\t\t\tthis.log.debug(`Received message on topic \"${topic}\":`, data);\n\t\t\t\tthis.emit(`:message`, topic, data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata.topic = topic;\n\n\t\t\tthis.log.debug(`Received command on topic \"${topic}\" for command \"${data.cmd}\":`, data.data);\n\t\t\tthis.emit(`:command:${data.cmd}` as PubSubCommandKey, data.data, data);\n\t\t});\n\n\t\t// Subscribe to our topics.\n\t\tconst topics = [...this._topics.keys()];\n\t\tclient.subscribe(topics);\n\n\t\t// And start the client.\n\t\tawait client.connect();\n\t}\n\n\tdisconnect() {\n\t\tif ( ! this._client )\n\t\t\treturn;\n\n\t\tthis._client.disconnect();\n\t\tthis._client = null;\n\t}\n\n\n\t// ========================================================================\n\t// Topics\n\t// ========================================================================\n\n\tsubscribe(referrer: unknown, ...topics: string[]) {\n\t\tconst topic_map = this._topics;\n\t\tlet changed = false;\n\t\tfor(const topic of topics) {\n\t\t\tlet refs = topic_map.get(topic);\n\t\t\tif ( refs )\n\t\t\t\trefs.add(referrer);\n\t\t\telse {\n\t\t\t\tif ( this._client )\n\t\t\t\t\tthis._client.subscribe(topic);\n\n\t\t\t\trefs = new Set;\n\t\t\t\trefs.add(referrer);\n\n\t\t\t\ttopic_map.set(topic, refs);\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.emit(':sub-change');\n\t}\n\n\n\tunsubscribe(referrer: unknown, ...topics: string[]) {\n\t\tconst topic_map = this._topics;\n\t\tlet changed = false;\n\t\tfor(const topic of topics) {\n\t\t\tconst refs = topic_map.get(topic);\n\t\t\tif ( ! refs )\n\t\t\t\tcontinue;\n\n\t\t\trefs.delete(referrer);\n\n\t\t\tif ( ! refs.size ) {\n\t\t\t\tchanged = true;\n\t\t\t\ttopic_map.delete(topic);\n\t\t\t\tif ( this._client )\n\t\t\t\t\tthis._client.unsubscribe(topic);\n\t\t\t}\n\t\t}\n\n\t\tif ( changed )\n\t\t\tthis.emit(':sub-change');\n\t}\n\n\n\tget topics() {\n\t\treturn Array.from(this._topics.keys());\n\t}\n\n}\n","'use strict';\n\n// ============================================================================\n// Vue Library\n// Loads Vue + Translation Shim\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport {has} from 'utilities/object';\nimport type TranslationManager from '../i18n';\nimport type { VueConstructor } from 'vue';\nimport type Vue from 'vue';\nimport type { CombinedVueInstance } from 'vue/types/vue';\nimport type { MessageNode } from '@ffz/icu-msgparser';\n\ndeclare global {\n\tinterface Window {\n\t\tffzVue: VueConstructor<Vue>;\n\t}\n}\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\n\t}\n\tinterface ModuleMap {\n\t\tvue: VueModule\n\t}\n}\n\n\nexport class VueModule extends Module<'vue'> {\n\n\tprivate _components: Record<string, any> | null;\n\n\tVue: VueConstructor<Vue> | null = null;\n\n\ti18n: TranslationManager = null as any;\n\n\t_vue_i18n?: CombinedVueInstance<any, any, any, any, any> | null;\n\n\tkey: string;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\t\tthis.key = 'ffz-stuff';\n\n\t\tthis._components = {};\n\t\tthis.inject('i18n');\n\t}\n\n\tasync onLoad() {\n\t\tconst Vue = window.ffzVue = this.Vue = (await import(/* webpackChunkName: \"vue\" */ 'vue')).default,\n\t\t\tcomponents = this._components;\n\n\t\tconst [\n\t\t\tObserveVisibility,\n\t\t\tClickaway,\n\t\t\t//RavenVue,\n\t\t\tComponents\n\n\t\t] = await Promise.all([\n\t\t\timport(/* webpackChunkName: \"vue\" */ 'vue-observe-visibility'),\n\t\t\timport(/* webpackChunkName: \"vue\" */ 'vue-clickaway'),\n\t\t\t//import(/* webpackChunkName: \"vue\" */ 'raven-js/plugins/vue'),\n\t\t\timport(/* webpackChunkName: \"vue\" */ 'src/std-components/index.js')\n\t\t]);\n\n\t\tthis.component(Components.default);\n\n\t\tVue.use(ObserveVisibility as any);\n\t\tVue.mixin(Clickaway.mixin);\n\n\t\t/*if ( ! DEBUG && this.root.raven )\n\t\t\tthis.root.raven.addPlugin(RavenVue, Vue);*/\n\n\t\tfor(const key in components)\n\t\t\tif ( has(components, key) )\n\t\t\t\tVue.component(key, components[key]);\n\n\t\tthis._components = null;\n\t\tVue.use(this);\n\t}\n\n\tcomponent(id: string | any, constructor?: any) {\n\t\tif ( typeof id === 'function' ) {\n\t\t\tfor(const key of id.keys())\n\t\t\t\tthis.component(key.slice(2, key.length - 4), id(key).default);\n\n\t\t} else if ( typeof id === 'object' ) {\n\t\t\tfor(const key in id)\n\t\t\t\tif ( has(id, key) )\n\t\t\t\t\tthis.component(key, id[key]);\n\n\t\t} else if ( this.Vue )\n\t\t\tthis.Vue.component(id, constructor);\n\n\t\telse if ( this._components )\n\t\t\tthis._components[id] = constructor;\n\t}\n\n\tinstall(vue: typeof Vue) {\n\t\t// This is a mess. I'm sure there's an easier way to tie the systems\n\t\t// together. However, for now, this works.\n\n\t\tconst t = this;\n\t\tif ( ! this._vue_i18n ) {\n\t\t\tthis._vue_i18n = new vue({\n\t\t\t\tdata() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlocale: t.i18n.locale,\n\t\t\t\t\t\tphrases: {}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tmethods: {\n\t\t\t\t\ttNumber_(val: number, format?: string) {\n\t\t\t\t\t\tthis.locale;\n\t\t\t\t\t\treturn t.i18n.formatNumber(val, format);\n\t\t\t\t\t},\n\n\t\t\t\t\ttDate_(val: string | Date, format?: string) {\n\t\t\t\t\t\tthis.locale;\n\t\t\t\t\t\treturn t.i18n.formatDate(val, format);\n\t\t\t\t\t},\n\n\t\t\t\t\ttTime_(val: string | Date, format?: string) {\n\t\t\t\t\t\tthis.locale;\n\t\t\t\t\t\treturn t.i18n.formatTime(val, format);\n\t\t\t\t\t},\n\n\t\t\t\t\ttDateTime_(val: string | Date, format?: string) {\n\t\t\t\t\t\tthis.locale;\n\t\t\t\t\t\treturn t.i18n.formatDateTime(val, format);\n\t\t\t\t\t},\n\n\t\t\t\t\tt_(key: string, phrase: string, options: any) {\n\t\t\t\t\t\t// Access properties to trigger reactivity.\n\t\t\t\t\t\tthis.locale && (this as any).phrases[key];\n\t\t\t\t\t\treturn t.i18n.t(key, phrase, options);\n\t\t\t\t\t},\n\n\t\t\t\t\ttList_(key: string, phrase: string, options: any) {\n\t\t\t\t\t\t// Access properties to trigger reactivity.\n\t\t\t\t\t\tthis.locale && (this as any).phrases[key];\n\t\t\t\t\t\treturn t.i18n.tList(key, phrase, options);\n\t\t\t\t\t},\n\n\t\t\t\t\ttNode_(node: MessageNode, data: any) {\n\t\t\t\t\t\t// Access properties to trigger reactivity.\n\t\t\t\t\t\tthis.locale;\n\t\t\t\t\t\treturn t.i18n.formatNode(node, data);\n\t\t\t\t\t},\n\n\t\t\t\t\tsetLocale(locale: string) {\n\t\t\t\t\t\tt.i18n.locale = locale;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// On i18n events, update values for reactivity.\n\t\t\tthis.on('i18n:transform', () => {\n\t\t\t\tthis._vue_i18n.locale = this.i18n.locale;\n\t\t\t\tthis._vue_i18n.phrases = {};\n\t\t\t});\n\n\t\t\tthis.on('i18n:changed', () => {\n\t\t\t\tthis._vue_i18n.locale = this.i18n.locale;\n\t\t\t\tthis._vue_i18n.phrases = {};\n\t\t\t});\n\n\t\t\tthis.on('i18n:loaded', keys => {\n\t\t\t\tconst i = this._vue_i18n,\n\t\t\t\t\tp = i.phrases;\n\t\t\t\tfor(const key of keys)\n\t\t\t\t\ti.$set(p, key, (p[key]||0) + 1);\n\t\t\t});\n\n\t\t\tvue.prototype.$i18n = this._vue_i18n;\n\t\t}\n\n\t\tvue.component('t-list', {\n\t\t\tprops: {\n\t\t\t\ttag: {\n\t\t\t\t\trequired: false\n\t\t\t\t},\n\t\t\t\tphrase: {\n\t\t\t\t\ttype: String,\n\t\t\t\t\trequired: true\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttype: String,\n\t\t\t\t\trequired: true\n\t\t\t\t},\n\t\t\t\tdata: {\n\t\t\t\t\ttype: Object,\n\t\t\t\t\trequired: false\n\t\t\t\t}\n\t\t\t},\n\n\t\t\trender(createElement) {\n\t\t\t\treturn createElement(\n\t\t\t\t\tthis.tag || 'span',\n\t\t\t\t\t(this as any).$i18n.tList_(\n\t\t\t\t\t\tthis.phrase,\n\t\t\t\t\t\tthis.default,\n\t\t\t\t\t\tObject.assign({}, this.data, this.$scopedSlots)\n\t\t\t\t\t).map((out: any) => {\n\t\t\t\t\t\tif ( typeof out === 'function' )\n\t\t\t\t\t\t\treturn out();\n\t\t\t\t\t\treturn out;\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tvue.mixin({\n\t\t\tmethods: {\n\t\t\t\treactNavigate(url, event, state) {\n\t\t\t\t\tconst router = t.resolve('site.router');\n\t\t\t\t\tif ( router ) {\n\t\t\t\t\t\tif ( event ) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t}\n\t\t\t\t\t\trouter.push(url, state ?? undefined);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetReactURL(route, data, opts, ...args) {\n\t\t\t\t\tconst router = t.resolve('site.router')!;\n\t\t\t\t\treturn router.getURL(route, data, opts, ...args);\n\t\t\t\t},\n\t\t\t\tgetI18n() {\n\t\t\t\t\treturn t.i18n;\n\t\t\t\t},\n\t\t\t\tt(key, phrase, options) {\n\t\t\t\t\treturn (this as any).$i18n.t_(key, phrase, options);\n\t\t\t\t},\n\t\t\t\ttList(key, phrase, options) {\n\t\t\t\t\treturn (this as any).$i18n.tList_(key, phrase, options);\n\t\t\t\t},\n\t\t\t\ttNode(node, data) {\n\t\t\t\t\treturn (this as any).$i18n.tNode_(node, data);\n\t\t\t\t},\n\t\t\t\ttNumber(val, format) {\n\t\t\t\t\treturn (this as any).$i18n.tNumber_(val, format);\n\t\t\t\t},\n\t\t\t\ttDate(val, format) {\n\t\t\t\t\treturn (this as any).$i18n.tDate_(val, format);\n\t\t\t\t},\n\t\t\t\ttTime(val, format) {\n\t\t\t\t\treturn (this as any).$i18n.tTime_(val, format);\n\t\t\t\t},\n\t\t\t\ttDateTime(val, format) {\n\t\t\t\t\treturn (this as any).$i18n.tDateTime_(val, format);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport default VueModule;\n","'use strict';\n\n// ============================================================================\n// Staging Selector\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport { API_SERVER, SERVER, STAGING_API, STAGING_CDN } from './utilities/constants';\nimport type SettingsManager from './settings';\n\ndeclare module 'utilities/types' {\n\tinterface ModuleMap {\n\t\tstaging: StagingSelector;\n\t}\n\tinterface ModuleEventMap {\n\t\tstaging: StagingEvents;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'data.use-staging': boolean;\n\t}\n}\n\ntype StagingEvents = {\n\t':updated': [api: string, cdn: string];\n}\n\nexport default class StagingSelector extends Module<'staging', StagingEvents> {\n\n\t// Dependencies\n\tsettings: SettingsManager = null as any;\n\n\t// State\n\tapi: string = API_SERVER;\n\tcdn: string = SERVER;\n\tactive: boolean = false;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.inject('settings');\n\n\t\tthis.settings.add('data.use-staging', {\n\t\t\tdefault: false,\n\t\t\tui: {\n\t\t\t\tpath: 'Debugging > Data Sources >> Staging @{\"sort\": -1}',\n\t\t\t\tforce_seen: true,\n\t\t\t\ttitle: 'Use staging as data source.',\n\t\t\t\tcomponent: 'setting-check-box'\n\t\t\t}\n\t\t});\n\n\t\tthis.updateStaging(false);\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.settings.getChanges('data.use-staging', this.updateStaging, this);\n\t}\n\n\tprivate updateStaging(val: boolean) {\n\t\tthis.active = val;\n\n\t\tthis.api = val\n\t\t\t? STAGING_API\n\t\t\t: API_SERVER;\n\n\t\tthis.cdn = val\n\t\t\t? STAGING_CDN\n\t\t\t: SERVER;\n\n\t\tthis.emit(':updated', this.api, this.cdn);\n\t}\n}\n","'use strict';\n\n// ============================================================================\n// Loading Tracker\n// ============================================================================\n\nimport Module, { GenericModule } from 'utilities/module';\nimport type SettingsManager from './settings';\n\n\ndeclare module 'utilities/types' {\n\tinterface ModuleEventMap {\n\t\tload_tracker: LoadEvents;\n\t}\n\tinterface ModuleMap {\n\t\tload_tracker: LoadTracker;\n\t}\n\tinterface SettingsTypeMap {\n\t\t'chat.update-when-loaded': boolean;\n\t}\n}\n\n\ntype PendingLoadData = {\n\tpending: Set<string>;\n\ttimers: Record<string, ReturnType<typeof setTimeout> | null>;\n\tsuccess: boolean\n};\n\n\nexport type LoadEvents = {\n\t':schedule': [type: string, key: string],\n\t[key: `:complete:${string}`]: [keys: string[]]\n};\n\n\n/**\n * LoadTracker is a module used for coordinating loading events between\n * the core of FrankerFaceZ and any present add-ons. This allows for\n * enhanced performance by, for example, only refreshing chat messages\n * once emote data has been loaded by all of a user's add-ons.\n *\n * @example How to use load tracker if you're loading emotes.\n * ```typescript\n * // Inform the load tracker that we're trying to load data.\n * this.load_tracker.schedule('chat-data', 'my-addon--emotes-global');\n *\n * // Load our data.\n * let emotes;\n * try {\n *     emotes = await loadEmotesFromSomewhere();\n * } catch(err) {\n *     // Notify that we failed to load, so it stops waiting.\n *     this.load_tracker.notify('chat-data', 'my-addon--emotes-global', false);\n *     return;\n * }\n *\n * // Load the emote data.\n * this.emotes.addDefaultSet('my-addon', 'my-addon--global-emotes', emotes);\n *\n * // Notify that we succeeded.\n * this.load_tracker.notify('chat-data', 'my-addon--emotes-global', true);\n * ```\n *\n * @noInheritDoc\n */\nexport default class LoadTracker extends Module<'load_tracker', LoadEvents> {\n\n\t/** A map for storing information about pending loadables. */\n\tprivate pending_loads: Map<string, PendingLoadData> = new Map();\n\n\t// Dependencies.\n\tsettings: SettingsManager = null as any;\n\n\t/** @internal */\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent);\n\n\t\tthis.should_enable = true;\n\n\t\tthis.inject('settings');\n\n\t\tthis.settings.add('chat.update-when-loaded', {\n\t\t\tdefault: true,\n\t\t\tui: {\n\t\t\t\tpath: 'Chat > Behavior >> General',\n\t\t\t\ttitle: 'Update existing chat messages when loading new data.',\n\t\t\t\tcomponent: 'setting-check-box',\n\t\t\t\tdescription: 'This may cause elements in chat to move, so you may wish to disable this when performing moderation.'\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @internal */\n\tonEnable() {\n\t\tthis.on(':schedule', this.schedule);\n\t}\n\n\t/**\n\t * Register our intent to perform a load. This lets the system know that\n\t * a load of {@link type} is pending, and it starts a wait of 15 seconds\n\t * for the load to complete.\n\t *\n\t * You must, after using this, call {@link notify} when your load\n\t * completes or fails. That ensures that the system does not wait\n\t * needlessly after your load process has finished.\n\t *\n\t * @param type The load type.\n\t * @param key A unique key for your load, on this load type. If you are\n\t * loading multiple times (for example, global emotes and channel-specific\n\t * emotes), you should use two distinct keys.\n\t */\n\tschedule(type: string, key: string) {\n\t\tlet data = this.pending_loads.get(type);\n\t\tif ( ! data || ! data.pending || ! data.timers ) {\n\t\t\tdata = {\n\t\t\t\tpending: new Set,\n\t\t\t\ttimers: {},\n\t\t\t\tsuccess: false\n\t\t\t};\n\t\t\tthis.pending_loads.set(type, data);\n\t\t}\n\n\t\tif ( data.pending.has(key) )\n\t\t\treturn;\n\n\t\tdata.pending.add(key);\n\t\tdata.timers[key] = setTimeout(() => this.notify(type, key, false), 15000);\n\t}\n\n\t/**\n\t * Notify the load tracker that your load has completed. If all loads\n\t * for the given type have been completed, and any of the loads were\n\t * a success, then a `:complete:${type}` event will be fired.\n\t * @param type The load type.\n\t * @param key A unique key for your load. The same that you use\n\t * with {@link schedule}.\n\t * @param success Whether or not your load was a success.\n\t */\n\tnotify(type: string, key: string, success = true) {\n\t\tconst data = this.pending_loads.get(type);\n\t\tif ( ! data || ! data.pending || ! data.timers )\n\t\t\treturn;\n\n\t\tif ( data.timers[key] ) {\n\t\t\tclearTimeout(data.timers[key] as any);\n\t\t\tdata.timers[key] = null;\n\t\t}\n\n\t\tif ( ! data.pending.has(key) )\n\t\t\treturn;\n\n\t\tdata.pending.delete(key);\n\t\tif ( success )\n\t\t\tdata.success = true;\n\n\t\tif ( ! data.pending.size ) {\n\t\t\tconst keys = Object.keys(data.timers);\n\n\t\t\tthis.log.debug('complete', type, keys);\n\t\t\tif ( data.success )\n\t\t\t\tthis.emit(`:complete:${type}`, keys);\n\t\t\tthis.pending_loads.delete(type);\n\t\t}\n\t}\n\n}\n","import Module, { GenericModule, ModuleEvents } from 'utilities/module';\nimport type { AddonInfo } from './types';\nimport type Logger from './logging';\nimport type TranslationManager from '../i18n';\nimport type SettingsManager from '../settings';\nimport type AddonManager from '../addons';\n\n/**\n * A special sub-class of {@link Module} used for the root module of an add-on.\n *\n * This sub-class has a static {@link register} method that add-ons should call\n * to properly inject themselves into FrankerFaceZ once their scripts have\n * loaded. {@link register} is called automatically by add-ons build from the\n * official add-ons repository.\n */\nexport class Addon<TPath extends string = '', TEventMap extends ModuleEvents = ModuleEvents> extends Module<TPath, TEventMap> {\n\n\tstatic info?: AddonInfo;\n\tstatic version: string;\n\n\t// Dependencies\n\ti18n: TranslationManager = null as any;\n\tsettings: SettingsManager = null as any;\n\n\tconstructor(name?: string, parent?: GenericModule) {\n\t\tsuper(name, parent, true);\n\n\t\tthis.inject('i18n');\n\t\tthis.inject('settings');\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see {@link loadFromContext}\n\t */\n\tpopulate(ctx: __WebpackModuleApi.RequireContext, log?: Logger) {\n\t\tthis.log.warn('[DEV-CHECK] populate() has been renamed to loadFromContext(). The populate() name is deprecated.');\n\t\treturn this.loadFromContext(ctx, log);\n\t}\n\n\t/**\n\t * Register this add-on with the FrankerFaceZ module system. This\n\t * should be called as soon as your add-on class is available and\n\t * ready to be enabled. The {@link AddonManager} class will then\n\t * call {@link enable} on this module (assuming the user wants\n\t * the add-on to be enabled.)\n\t * @param id This add-on's ID, or an {@link AddonInfo} object.\n\t * @param info An optional AddonInfo object if {@link id} was not set to an AddonInfo object.\n\t */\n\tstatic register(id?: string | AddonInfo, info?: AddonInfo, version?: string) {\n\t\tif ( typeof id === 'object' ) {\n\t\t\tinfo = id;\n\t\t\tid = info.id || undefined;\n\t\t}\n\n\t\tif ( ! id ) {\n\t\t\tif ( this.name )\n\t\t\t\tid = this.name.toSnakeCase();\n\t\t\telse\n\t\t\t\tthrow new Error(`Unable to register module without ID.`);\n\t\t}\n\n\t\tif ( ! info && this.info )\n\t\t\tinfo = this.info;\n\n\t\tif ( version )\n\t\t\tthis.version = version;\n\n\t\tconst ffz = window.FrankerFaceZ.get(),\n\t\t\taddons = (ffz as any)?.addons as AddonManager;\n\n\t\tif ( addons ) {\n\t\t\tif ( info ) {\n\t\t\t\tinfo.id = id;\n\t\t\t\taddons.addAddon(info);\n\n\t\t\t} else if ( ! addons.hasAddon(id) )\n\t\t\t\taddons.addAddon({\n\t\t\t\t\tid\n\t\t\t\t});\n\n\t\t\tif ( version )\n\t\t\t\taddons.setVersion(id, version);\n\t\t}\n\n\t\ttry {\n\t\t\tffz.register(`addon.${id}`, this);\n\t\t} catch(err) {\n\t\t\tif ( (err instanceof Error) && err.message && err.message.includes('Name Collision for Module') ) {\n\t\t\t\tconst module = ffz.resolve(`addon.${id}`);\n\t\t\t\tif ( module )\n\t\t\t\t\t(module as any).external = true;\n\t\t\t}\n\n\t\t\tthrow err;\n\t\t}\n\t}\n}\n","'use strict';\n\nimport dayjs from 'dayjs';\n//import RavenLogger from './raven';\n\nimport Logger from 'utilities/logging';\nimport Module, { State } from 'utilities/module';\nimport { timeout } from 'utilities/object';\n\nimport {DEBUG} from 'utilities/constants';\n\nimport SettingsManager from './settings/index';\nimport AddonManager from './addons';\nimport ExperimentManager from './experiments';\nimport TranslationManager from './i18n';\nimport SocketClient from './socket';\nimport PubSubClient from './pubsub';\nimport Site from 'site';\nimport VueModule from 'utilities/vue';\nimport StagingSelector from './staging';\nimport LoadTracker from './load_tracker';\n\nimport type { ClientVersion } from 'utilities/types';\n\nimport * as Utility_Addons from 'utilities/addon';\nimport * as Utility_Blobs from 'utilities/blobs';\nimport * as Utility_Color from 'utilities/color';\nimport * as Utility_Constants from 'utilities/constants';\nimport * as Utility_Dialog from 'utilities/dialog';\nimport * as Utility_DOM from 'utilities/dom';\nimport * as Utility_Events from 'utilities/events';\nimport * as Utility_FontAwesome from 'utilities/font-awesome';\nimport * as Utility_GraphQL from 'utilities/graphql';\nimport * as Utility_Logging from 'utilities/logging';\nimport * as Utility_Module from 'utilities/module';\nimport * as Utility_Object from 'utilities/object';\nimport * as Utility_Time from 'utilities/time';\nimport * as Utility_Tooltip from 'utilities/tooltip';\nimport * as Utility_I18n from 'utilities/translation-core';\nimport * as Utility_Filtering from 'utilities/filtering';\n\nclass FrankerFaceZ extends Module {\n\n\tstatic instance: FrankerFaceZ = null as any;\n\tstatic version_info: ClientVersion = null as any;\n\tstatic Logger = Logger;\n\n\tstatic utilities = {\n\t\taddon: Utility_Addons,\n\t\tblobs: Utility_Blobs,\n\t\tcolor: Utility_Color,\n\t\tconstants: Utility_Constants,\n\t\tdialog: Utility_Dialog,\n\t\tdom: Utility_DOM,\n\t\tevents: Utility_Events,\n\t\tfontAwesome: Utility_FontAwesome,\n\t\tgraphql: Utility_GraphQL,\n\t\tlogging: Utility_Logging,\n\t\tmodule: Utility_Module,\n\t\tobject: Utility_Object,\n\t\ttime: Utility_Time,\n\t\ttooltip: Utility_Tooltip,\n\t\ti18n: Utility_I18n,\n\t\tfiltering: Utility_Filtering\n\t};\n\n\t/*\n\tstatic utilities = {\n\t\taddon: require('utilities/addon'),\n\t\tblobs: require('utilities/blobs'),\n\t\tcolor: require('utilities/color'),\n\t\tconstants: require('utilities/constants'),\n\t\tdialog: require('utilities/dialog'),\n\t\tdom: require('utilities/dom'),\n\t\tevents: require('utilities/events'),\n\t\tfontAwesome: require('utilities/font-awesome'),\n\t\tgraphql: require('utilities/graphql'),\n\t\tlogging: require('utilities/logging'),\n\t\tmodule: require('utilities/module'),\n\t\tobject: require('utilities/object'),\n\t\ttime: require('utilities/time'),\n\t\ttooltip: require('utilities/tooltip'),\n\t\ti18n: require('utilities/translation-core'),\n\t\tdayjs: require('dayjs'),\n\t\tfiltering: require('utilities/filtering'),\n\t\tpopper: require('@popperjs/core')\n\t};\n\t*/\n\n\n\tcore_log: Logger;\n\n\thost: string;\n\tflavor: string;\n\n\tconstructor() {\n\t\tsuper();\n\t\tconst start_time = performance.now();\n\n\t\tFrankerFaceZ.instance = this;\n\n\t\tthis.host = 'twitch';\n\t\tthis.flavor = 'main';\n\t\tthis.name = 'frankerfacez';\n\n\t\t// Evil private member access.\n\t\t(this as any).__state = State.Disabled;\n\t\t(this as any).__modules.core = this;\n\n\t\t// Timing\n\t\t//this.inject('timing', Timing);\n\t\tthis._time('instance');\n\n\t\t// ========================================================================\n\t\t// Error Reporting and Logging\n\t\t// ========================================================================\n\n\t\t//this.inject('raven', RavenLogger);\n\n\t\tthis.log = new Logger(null, null, null); //, this.raven);\n\t\tthis.log.init = true;\n\n\t\tthis.core_log = this.log.get('core');\n\t\tthis.log.hi(this, FrankerFaceZ.version_info);\n\n\n\t\t// ========================================================================\n\t\t// Core Systems\n\t\t// ========================================================================\n\n\t\tthis.inject('settings', SettingsManager);\n\t\tthis.inject('experiments', ExperimentManager);\n\t\tthis.inject('i18n', TranslationManager);\n\t\tthis.inject('staging', StagingSelector);\n\t\tthis.inject('load_tracker', LoadTracker);\n\t\tthis.inject('socket', SocketClient);\n\t\tthis.inject('pubsub', PubSubClient);\n\t\tthis.inject('site', Site);\n\t\tthis.inject('addons', AddonManager);\n\n\t\tthis.register('vue', VueModule);\n\n\n\t\t// ========================================================================\n\t\t// Startup\n\t\t// ========================================================================\n\n\t\tthis.discoverModules()\n\t\t\t.then(() => this.enable())\n\t\t\t.then(() => this.enableInitialModules()).then(() => {\n\t\t\t\tconst duration = performance.now() - start_time;\n\t\t\t\tthis.core_log.info(`Initialization complete in ${duration.toFixed(5)}ms.`);\n\t\t\t\tthis.log.init = false;\n\n\t\t\t}).catch(err => {\n\t\t\t\tthis.core_log.error('An error occurred during initialization.', err);\n\t\t\t\tthis.log.init = false;\n\t\t\t});\n\t}\n\n\tstatic get() {\n\t\treturn FrankerFaceZ.instance;\n\t}\n\n\n\t// ========================================================================\n\t// Generate Log\n\t// ========================================================================\n\n\tasync generateLog() {\n\t\tconst promises = [];\n\t\tfor(const [key, module] of Object.entries((this as any).__modules)) {\n\t\t\tif ( module instanceof Module && module.generateLog && (module as any) != this )\n\t\t\t\tpromises.push((async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tawait timeout(Promise.resolve((module as any).generateLog()), 5000)\n\t\t\t\t\t\t];\n\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t`Error: ${err}`\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t})());\n\t\t}\n\n\t\tconst out = await Promise.all(promises);\n\n\t\tif ( this.log.captured_init && this.log.captured_init.length > 0 ) {\n\t\t\tconst logs = [];\n\t\t\tfor(const msg of this.log.captured_init) {\n\t\t\t\tconst time = dayjs(msg.time).locale('en').format('H:mm:ss');\n\t\t\t\tlogs.push(`[${time}] ${msg.level} | ${msg.category || 'core'}: ${msg.message}`);\n\t\t\t}\n\n\t\t\tout.unshift(['initialization', logs.join('\\n')]);\n\t\t}\n\n\t\treturn out.map(x => `${x[0]}\n-------------------------------------------------------------------------------\n${typeof x[1] === 'string' ? x[1] : JSON.stringify(x[1], null, 4)}`).join('\\n\\n');\n\t}\n\n\n\t// ========================================================================\n\t// Modules\n\t// ========================================================================\n\n\tasync discoverModules() {\n\t\t// TODO: Actually do async modules.\n\t\tconst ctx = await require.context(\n\t\t\t'src/modules',\n\t\t\ttrue,\n\t\t\t/(?:^(?:\\.\\/)?[^/]+|index)\\.[jt]sx?$/\n\t\t\t/*, 'lazy-once' */\n\t\t);\n\n\t\tconst modules = this.loadFromContext(ctx, this.core_log);\n\n\t\tthis.core_log.info(`Loaded descriptions of ${Object.keys(modules).length} modules.`);\n\t}\n\n\n\tasync enableInitialModules() {\n\t\tconst promises = [];\n\t\tfor(const module of Object.values((this as any).__modules)) {\n\t\t\tif ( module instanceof Module && module.should_enable )\n\t\t\t\tpromises.push(module.enable());\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t}\n}\n\n\nconst VER: ClientVersion = FrankerFaceZ.version_info = Object.freeze({\n\tmajor: __version_major__,\n\tminor: __version_minor__,\n\trevision: __version_patch__,\n\textra: __version_prerelease__?.length && __version_prerelease__[0],\n\tcommit: __git_commit__,\n\tbuild: __version_build__,\n\thash: __webpack_hash__,\n\ttoString: () =>\n\t\t`${VER.major}.${VER.minor}.${VER.revision}${VER.build ? `.${VER.build}` : ''}${VER.extra || ''}${DEBUG ? '-dev' : ''}`\n});\n\n\nexport default FrankerFaceZ;\n\ndeclare global {\n\tinterface Window {\n\t\tFrankerFaceZ: typeof FrankerFaceZ;\n\t\tffz: FrankerFaceZ;\n\t}\n}\n\nwindow.FrankerFaceZ = FrankerFaceZ;\nwindow.ffz = new FrankerFaceZ();\n"],"names":["SPACE","SYMBOLS","SUBNUM","SUBMSG","KEYS","CLOSE_TAG","Parser","exports","module","options","key","val","j","k2","p","msg","context","parent","opts","length","special_hash","out","start","char","mergePush","element","unexpected","include_separator","include_space","include_tags","tags","next","closing","skipSpace","name","expected","tag","contents","id","type","offset","submessages","req","format","selector","OFFSET","found","index","list","item","l","getHTMLElementScroll","getNodeScroll","node","getWindow","getWindowScroll","isElementScaled","rect","scaleX","scaleY","getCompositeRect","elementOrVirtualElement","offsetParent","isFixed","isOffsetParentAnElement","offsetParentIsScaled","documentElement","getDocumentElement","getBoundingClientRect","scroll","offsets","getNodeName","isScrollParent","getWindowScrollBarX","order","modifiers","map","visited","result","modifier","sort","requires","dep","depModifier","orderModifiers","orderedModifiers","acc","phase","debounce","fn","pending","resolve","mergeByName","merged","current","existing","DEFAULT_OPTIONS","areValidElements","_len","args","_key","popperGenerator","generatorOptions","_generatorOptions","_generatorOptions$def","defaultModifiers","_generatorOptions$def2","defaultOptions","reference","popper","state","effectCleanupFns","isDestroyed","instance","setOptionsAction","cleanupModifierEffects","listScrollParents","m","runModifierEffects","_state$elements","getOffsetParent","getLayoutRect","_state$orderedModifie","_state$orderedModifie2","_options","_ref","_ref$options","effect","cleanupFn","noopFn","createPopper","contains","child","rootNode","includeScale","isFixedStrategy","clientRect","visualViewport","addVisualOffsets","x","y","width","height","getComputedStyle","isTableElement","getTrueOffsetParent","getContainingBlock","isFirefox","isIE","elementCss","currentNode","getParentNode","css","window","ownerDocument","win","scrollLeft","scrollTop","isElement","OwnElement","isHTMLElement","isShadowRoot","isLayoutViewport","_getComputedStyle","overflow","overflowX","overflowY","getScrollParent","_element$ownerDocumen","scrollParent","isBody","target","updatedList","top","bottom","right","left","auto","basePlacements","end","clippingParents","viewport","variationPlacements","placement","placements","beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite","modifierPhases","applyStyles","style","attributes","value","_ref2","initialStyles","styleProperties","property","attribute","toPaddingObject","padding","arrow","_state$modifiersData$","arrowElement","popperOffsets","basePlacement","axis","isVertical","len","paddingObject","arrowRect","minProp","maxProp","endDiff","startDiff","arrowOffsetParent","clientSize","centerToReference","min","max","center","axisProp","_options$element","unsetSides","roundOffsetsByDPR","dpr","mapToStyles","_Object$assign2","popperRect","variation","position","gpuAcceleration","adaptive","roundOffsets","_offsets$x","_offsets$y","_ref3","hasX","hasY","sideX","sideY","heightProp","widthProp","offsetY","offsetX","commonStyles","_ref4","_Object$assign","computeStyles","_ref5","_options$gpuAccelerat","_options$adaptive","_options$roundOffsets","passive","_options$scroll","_options$resize","resize","scrollParents","hash","getOppositePlacement","matched","getOppositeVariationPlacement","computeAutoPlacement","boundary","rootBoundary","flipVariations","_options$allowedAutoP","allowedAutoPlacements","getVariation","allowedPlacements","overflows","detectOverflow","getBasePlacement","a","b","getExpandedFallbackPlacements","oppositePlacement","flip","_options$mainAxis","checkMainAxis","_options$altAxis","checkAltAxis","specifiedFallbackPlacements","altBoundary","_options$flipVariatio","preferredPlacement","isBasePlacement","fallbackPlacements","referenceRect","checksMap","makeFallbackChecks","firstFittingPlacement","i","_basePlacement","isStartVariation","mainVariationSide","altVariationSide","checks","check","numberOfChecks","_loop","_i","fittingPlacement","_ret","getSideOffsets","preventedOffsets","isAnySideFullyClipped","side","hide","referenceOverflow","popperAltOverflow","referenceClippingOffsets","popperEscapeOffsets","isReferenceHidden","hasPopperEscaped","distanceAndSkiddingToXY","rects","invertDistance","skidding","distance","_options$offset","data","_data$state$placement","getAltAxis","preventOverflow","_options$tether","tether","_options$tetherOffset","tetherOffset","mainAxis","getMainAxisFromPlacement","altAxis","tetherOffsetValue","normalizedTetherOffsetValue","offsetModifierState","_offsetModifierState$","mainSide","altSide","additive","minLen","maxLen","arrowPaddingObject","getFreshSideObject","arrowPaddingMin","arrowPaddingMax","arrowLen","within","minOffset","maxOffset","clientOffset","offsetModifierValue","tetherMin","tetherMax","preventedOffset","math","_offsetModifierState$2","_mainSide","_altSide","_offset","_min","_max","isOriginSide","_offsetModifierValue","_tetherMin","_tetherMax","_preventedOffset","computeOffsets","commonX","commonY","getViewportRect","strategy","html","layoutViewport","getDocumentRect","winScroll","body","rectToClientRect","getInnerBoundingClientRect","getClientRectFromMixedType","clippingParent","getClippingParents","canEscapeClipping","clipperElement","getClippingRect","mainClippingParents","firstClippingParent","clippingRect","accRect","_options$placement","_options$strategy","_options$boundary","_options$rootBoundary","_options$elementConte","elementContext","_options$altBoundary","_options$padding","mergePaddingObject","expandToHashMap","altContext","clippingClientRect","referenceClientRect","popperClientRect","elementClientRect","overflowOffsets","offsetData","multiply","keys","hashMap","round","getUAString","uaData","withinMaxClamp","root","factory","CryptoJS","Math","undefined","crypto","cryptoSecureRandomInt","create","F","obj","subtype","C","C_lib","Base","overrides","properties","propertyName","WordArray","words","sigBytes","encoder","Hex","wordArray","thisWords","thatWords","thisSigBytes","thatSigBytes","thatByte","clone","nBytes","C_enc","hexChars","bite","hexStr","hexStrLength","Latin1","latin1Chars","latin1Str","latin1StrLength","Utf8","utf8Str","BufferedBlockAlgorithm","doFlush","processedWords","dataWords","dataSigBytes","blockSize","blockSizeBytes","nBlocksReady","nWordsReady","nBytesReady","Hasher","cfg","messageUpdate","hasher","message","C_algo","W","SHA1","M","H","c","d","e","n","t","nBitsTotal","nBitsLeft","r","s","u","o","h","$","g","D","v","_","S","w","O","f","fetchJSON","url","STACK_SPLITTER","SOURCE_SPLITTER","MAP_OPTIONS","line","BAD_FRAMES","FACES","transformText","ast","owo","text","TRANSFORMATIONS","ctx","idx","profile","now","fmt","normal_out","joke_out","locale","title","entry","phrases","added","thing","phrase","event","popout","mod","new_locale","ignore_loaded","resp","strings","str","store","stack","err","match","location","file","label","chunk","hashes","promises","chnk","chunks","ignored","old_locale","djs","TranslationManager","DOLLAR_REGEX","REPLACE","FORMAT_REGEX","parseFormatters","token","transformPhrase","substitutions","token_regex","formatters","is_array","expr","arg","fmts","formatted","formatter","VAR_REPLACE","chat","tip","addon_id","removed","def","addon","warnings","is_dev","changed","extra","bits","reasons","reason_elements","room","rules","click_fn","reason","rule","reason_text","definition","content","destroy","fp","user","mod_icons","current_user","current_room","is_above","createElement","lines","ap","disp","act","has_color","disabled","color","multi_line","actions","fine","site","has_replies","can_replies","can_reply","current_level","msg_level","chat_line","handle_click","btn","is_self","had_action","modified","hover","modified_out","ds","pds","action","loaded","Actions","dynamic","emote","icon","combo","image","pin","reply","props","edit_overrides","copy_message","open_url","msg_delete","ban","timeout","unban","untimeout","unmod","whisper","me","id_1","id_2","thread","toggle_profile","ffz","settings","stuff","CSS_BADGES","BADGE_POSITIONS","NO_REPEAT","BASE_IMAGE","CSS_MASK_IMAGE","CSS_TEMPLATES","generateOverrideCSS","urls","image_set","generateBadgeCSS","badge","version","is_dark","badge_version","color_fixer","fg_fixer","scale","clickable","fore","base_image","trans","invert","svg","td","cb","include_addons","callback","twitch","other","owl","tcon","game","specific_addons","vs","cat","addon_badges_by_id","image1x","is_this","addons","addon_chunks","flags","show_previews","source_channel","bd","global_badge","tier","full_badge","id_checker","badge_id","source","container","room_id","room_login","user_id","user_login","badge_idx","mode","click_badge","skip_hide","hidden_badges","badge_style","custom_mod","custom_vip","is_mask","is_colored","has_image","tb","slotted","twitch_badges","dynamic_data","badges","last_slot","slot","is_hidden","bdata","mod_urls","vip_urls","handled_ids","hide_key","old_badge","no_invert","masked","bu","replaces","replaces_type","old","skip_click","global_user","room_user","str_user","users","entries","set","tries","response","generate_css","info","expires","can_click","use_media","retried","versions","sid","bs","getBadgeCategory","fixBadgeData","versioned","twitch_data","Badges","OTHER_BADGES","HIDDEN_CATEGORIES","CATEGORIES","CATEGORY_SORT","SKIN_TONES","enable_replace_joiner","joiner","JOINER_REPLACEMENT","ZWD_REPLACEMENT","EMOJI_JOINER","IMAGE_PATHS","codepoint_to_emoji","cp","code","cats","names","chars","raw","emoji","hydrate_emoji","vars","em","tone","vari","Emoji","HoverRAF","HoverState","MOD_KEY","Flags","MODIFIER_FLAGS","MODIFIER_KEYS","APPEAR_FRAMES","LEAVE_FRAMES","appearLeaveToKeyframes","multi","has_var","pct","vr","tx","ty","sx","sy","EFFECT_STYLES","generateBaseFilterCss","MODIFIERS","setting","filter","provider","set_id","input","favs","emote_set","has_old","processed","emote_id","priorities","first","second","first_priority","second_priority","should_update","emotes","filtered","count","fcount","emote_css","notices","sets","set_changes","notice","changes","emote_list","effects","transformOrigin","transform","animation","animations","enabled","new_sets","emote_sets","providers","hidden","favorites","favorite_only","click_emote","click_sub","apollo","prod","tt","evt","opener","Input","entered","menu","name_map","word","shared_id","shared_room","shared_user","seen","r_id","size","new_size","suppress_log","load_key","login","is_disabled","old_emote","old_css","new_emotes","style_key","em_css","old_set","ems","new_ems","bad_emotes","force","output","margins","m_top","m_right","m_bottom","m_left","channel","need_artist","tes","tsc","tsa","determineEmoteType","promise","determineSetType","Emotes","product","owner","sortPriorityColorTerms","TERM_FLAGS","UNBLOCKABLE_TOKENS","formatTerms","ERROR_IMAGE","EMOTE_CHARS","GIF_TERMS","temp","colors","test","priority","can_highlight","has_highlight","has_non","highlight","sensitive","highlights","non_highlights","had_remove","had_non","ts","default_24","LRUCache","user_proxy","room_proxy","prefix","tokenizer","sc","no_create","no_login","error","include_chat","include_whisper","include_video","messages","is_action","use_null_color","is_null","higher","ext","raw_emote","emotes_only","parts","ret","part","ct","last_type","time","tk","haltable","tokens","new_tokens","want_mid","animated","hover_animated","src","hoverSrc","pair","getBiggestImage","tokenizers","res","no_promises","refresh","reject","handle","success","callbacks","cbs","lp","agreed","rejected","resolvers","declined","service","Chat","CLIP_URL","NEW_CLIP_URL","VIDEO_URL","USER_URL","BAD_USERS","Clip","cd","received","clip","game_display","subtitle","curator","User","stream_id","fragments","full","thumb_url","Video","video","Links","manager","ref","handled_users","rooms","old_room","old_badges","referrer","variants","config","old_keys","new_keys","theme","tt_theme","tiers","images","tt_images","Room","SHRINK_X","SLIDE_X","STRETCH_X","EMOTE_CLASS","NEW_LINK_REGEX","MENTION_REGEX","FilterTester","datasetBool","show_images","show_unsafe","rich_tokens","url_table","flag","url_notice","nix","open","chr","Replies","mention_processAll","color_mentions","can_highlight_user","display","mentionable","segment","recipient","has_at","mentioned","rlower","Mentions","all_mentions","regex","at","UserHighlights","BlockedUsers","regexes","getBadgeIDs","BadgeStuff","details","CustomHighlights","had_match","raw_nix","blocked_process","do_remove","BlockedTerms","AM_DESCRIPTIONS","AutomoddedTerms","flagged","f_length","fix","remove","t_start","t_end","f_start","f_end","fs","CheerEmotes","amount","individuals","matcher","collected","collect","cheer","pref","group","cheers","render_emote","wrapped","big","srcSet","hoverSrcSet","normalSrc","normalSrcSet","mods","ml","AddonEmotes","outerStyle","is_big","as_bg","no_wide","factor","limit","preview","artist","fav_source","original_name","plain_name","hide_source","raw_artist","variant","vcode","category","favorite","anim","had_prefix_mods","had_no_space","last_token","NoSpace","last_emote","had_text","no_space","splitter","replace","TwitchEmotes","use_replacements","e_length","eix","e_id","e_start","e_end","animSrc","animSrcSet","src2","srcSet2","animSrc2","animSrcSet2","can_big","replacement","sizes","getEmoteTypeFromTwitchType","tierToNumber","card_component","web_munch","report_form","products","extras","bene","extier","ptier","card_key","old_card","pos_x","pos_y","card","component","el","EmoteCard","suffix","link","LinkCard","format_term","term","page","categories","path","mb","layout","accepted","vue","pages","wants_old","tree","restored","params","raw_token","started","settings_seen","unseen","new_seen","collapsed","copies","needs_sort","needs_component","have_locale","p_key","setting_key","i18n_key","tok","terms","lk","items","new_collapsed","profiles","Vue","profile_keys","profile_id","currentProfile","_c","new_list","ids","had_seen","tab","has_unseen","included","MainMenu","deleted","validate","process","uses","TranslationUI","last_site","last_call","react","reactDom","munch","observer_name","call_id","timer","observer","selectors","BaseSite","STYLE_VALIDATOR","LEFT_CONTROLS","RIGHT_CONTROLS","HAS_COMPRESSOR","HAS_GAIN","SCROLL_I18N","SCROLL_OPTIONS","getNativeClipButton","wantsRMB","matchesEvent","has_rmb","rotateButton","inst","cls","instances","events","Mousetrap","old_attach","old_active","old_inactive","cont","icons","player","vol_scroll","gain_scroll","click_pause","wants_rmb","muted","no_vol","matches_gain","matches_vol","delta","has_gain","doing_gain","old_volume","volume","pip","immediatePause","font_out","font_size","font_family","unloader","visible_only","outer","gain","tipcont","fill","on_change","core","range","has_comp","comp_active","can_apply","new_vid","vol","vid","compressed","wanted","want_gain","comp","update_gui","pbrate","installProperty","rate","is_fs","has_pip","pip_active","pip_swap","has_clip_button","on_click","native","has_reset","duration","timers","refresh_fn","created","channel_id","cache","waiters","PlayerBase","NodeState","regex_cache","getRequireRegex","NAMES","HARD_MODULES","computeSCC","graph","node_ids","indices","lowlinks","onStack","strongconnect","scc","fns","attempts","possibilities","chunk_ids","modules","builder","require","need_graph","mod_id","name_match","reqs","sccs","eligible","req_id","req_node","ready_ids","predicate","k","cs","chunk_pred","id_list","checked","WebMunch","routes","wrapper","ElementalWrapper","route","watcher","lw","min_timeout","muts","mutations","ensure_live","Elemental","elemental_id","elemental","matches","els","remove_check","do_schedule","PubSubEvent","raw_topic","trail","client","orig_message","orig_on","orig_off","topic","has_topic","Subpump","sb","updates","update_size","update_fullscreen","translation","session","Twilight","CALCULATE_BITS","VEND_CORE","CHAT_CHUNK","old_render","BitsButton","CHAT_EVENTS","waiter","button","BTTVCompat","USER_PAGES","want_links","nvc","vel","report","anchor","watching","make_link","parsed","no_promise","Channel","SCROLL_EVENTS","last_id","old_use","React","old_catch","errs","handler","children","scroller","scrolled_up","old_resume","step","old_time","scroll_content","target_top","difference","smoothAnimation","current_time","current_step","scroll_top","next_top","should_pause","was_outside","keys_updated","since","to_remove","removable","Scroller","to_wait","then","doc","player_state","description","desc","tooltip","RichContent","SUB_TIERS","has_message","digits","is_bits","reward","cost","months","plan","has_multi","sub_msg","mystery","expanded","sub_list","the_list","types","FFZRichContent","action_style","action_italic","action_color","raw_color","override_name","show","old_show","old_render_author","user_block","source_id","in_source","override_mode","mod_mode","deleted_count","is_in_source","source_room","reply_mode","target_user","fe","klass","bg_css","anim_hover","mod_action","show_mode","highlight_tags","hl_position","reply_tokens","is_giant_emote","rich_content","giant_emote","username","user_class","want_source_tip","user_props","timestamp","reply_token","twitch_highlight","is_raw","want_ts","hover_actions","e2","clear_tokens","clear_badges","ChatLine","old_universal","raw_badges","is_intl","after","super_parent","SettingsMenu","TIERS","TONE_EMOJI","scrollIntoView","el_height","el_top","pos","maybe_date","COLLATOR","EMOTE_SORTERS","a_n","b_n","sort_sets","a_sk","b_sk","rebuild","base","emoji_size","sheet_count","sheet_size","sheet_pct","storage","pick","tones","emoji_x","emoji_y","x_pct","y_pct","toned","postfix","is_prefix","visibility","show_heading","calendar","renews","ends","show_sources","lock","locked","emote_lock","sellout","has_modifiers","locks","has_ffz","doClear","clearTooltips","active","intersecting","old_inst","old_state","visibility_control","filtering","hidden_sets","emote_name","emote_lower","term_lower","has_colon","term_trail","emoji_favorites","tone_choices","is_fav","has_tone","all","sorter","sort_tiers","sort_emotes","a_val","b_val","local_sets","is_following","follower_locked","follower_sets","local","emote_map","twitch_favorites","twitch_hidden","twitch_seen","bits_unlocked","grouped_sets","set_ids","int_id","is_follower","is_points","chan","set_data","is_current_bits","sort_key","section","mapped","modes","new_id","new_name","overridden","unlockable_emotes","lock_set","seen_bits","summary","wants_resub_info","wants_plan_info","has_new_effects","unlocked_effects","use_effect_tab","ffz_room","ffz_subs","ffz_global","seen_sets","seen_favorites","global_set_ids","unlocked","host_id","source_name","fav_key","known_favs","known_hidden","seen_favs","pdata","resub","old_props","old_cd","cd_diff","ed","old_ed","ed_diff","loading","no_tabs","is_emoji","is_favs","is_effect","prices","gw_plan","cursor","nodes","curr_nodes","has_next_page","curr_cursor","EmoteMenu","localeCaseInsensitive","NO_MATCH","MATCH_ANY","NON_PREFIX_MATCH","CASE_INSENSITIVE_PREFIX_MATCH","EXACT_PREFIX_MATCH","getNodeText","getNodeOffset","pidx","frag","above","chat_input","mut","raw_id","raw_idx","originalOnKeyDown","originalOnMessageSend","old_resize","old_componentDidUpdate","editor","sel","unknown","commands","sorted","cmd","selection","channel_login","added_emotes","pressedTab","limitResults","results","ffz_emotes","preferFavorites","canBeTriggeredByTab","prioritizePrefixMatches","aStr","bStr","aIsEmoji","bIsEmoji","aStartsWithInput","bStartsWithInput","aStartsWithInputCI","bStartsWithInputCI","has_hidden","hidden_emotes","emoteMatchingType","results_usage","results_starting","results_other","search","match_type","source_line","ViewerCards","MESSAGE_TYPES","MOD_TYPES","AUTOMOD_TYPES","UNBLOCKABLE_TYPES","CHAT_TYPES","NULL_TYPES","INLINE_CALLOUT_TYPES","CALLOUT_TYPES","UNBLOCKABLE_CALLOUTS","MISBEHAVING_EVENTS","type_map","contrast","ic","chat_dark","chat_color","text_dark","chat_text","action_size","hover_action_size","ts_size","emote_alignment","lh","hover_action_icon","hover_action_padding","font","callouts","msg_ids","msg_id","old_aq","old_bits","old_subscribe","old_handle","isRedeemed","isAutomaticReward","rewardID","ctm","blocked","contextMenuProps","onPin","old_handle_join","raid_id","leave","bigger","StackMod","CalloutMod","dispatch","old_clear","old_flush","old_mount","api","mod_types","mat","paused","max_size","buffer","last","raw_delay","delay","see_deleted","has_newer","want_event","buffered","old_handler","old_send","addMessage","sendMessage","subcmd","original","old_announce","old_sub","old_pinned","old_resub","mysteries","old_subgift","old_communityintro","old_anonsubgift","old_submystery","old_anonsubmystery","old_ritual","old_points","old_add","original_msg","clear_mod","new_bits","formatBitsConfig","new_buffer","badges_updated","d2","shared","ocs","obs","ChatHook","tier_colors","new_act","themed","stat","im","ak","doesRewardCostBits","isCustomReward","isHighlightedReward","isGiantEmoteReward","isMessageEffect","getRewardCost","getRewardColor","getRewardTitle","i18n","CompatEmoteMenu","CLASSES","reruns","recs","friends","scope","CSSTweaks","Dashboard","ffz_buttons","buttons","block_btn","block_label","hidden_btn","hidden_label","update_block","blocked_games","update_hidden","hidden_games","update_func","values","Game","CARD_CONTEXTS","CONTENT_FLAGS","DIR_ROUTES","blur","old_should_render","bad_tag","bad_tags","should_hide","hide_container","for_exp","tracking","need_flags","show_flags","blur_flags","block_flags","filter_flags","has_flags","blur_tag","blur_tags","lname","should_blur","should_create","created_at","up_since","uptime","up_text","optionalFn","Directory","PORTRAIT_ROUTES","MINIMAL_ROUTES","cards","stream","rerun","offline","Layout","use_markdown","toast","elapsed","remaining","progress_bar","md","percentage","is_sunlight","toast_el","is_squad","is_mod","user_stuff","toasts","pill","extra_pill","before","live","toggle","desc_key","MenuButton","bcast","ModView","PLAYER_ROUTES","Player","BAD_ROUTES","COLORS","NO_AUTO_DARK","NO_FORCED_COLOR","ACCENT_COLORS","hsla","luma","dark","alpha","accent_out","accent_bits","background","wanted_theme","accent","tooltip_bg","tooltip_dark","tooltip_text","has_tt_text","chat_bits","chat_background","chat_accent","chat_accent_bits","enable","has_forced","ThemeEngine","SUB_REGEX","parseParamInt","param","system_msg","raw_months","cumulative_months","share","prime","user_bits","main_message","hide_timestamps","author","comment","new_badges","new_room_badges","old_room_badges","VideoChatHook","ApolloEvent","GQLError","host","proto","old_qm_get","query","optimistic","prev","raw_name","old_qm_init","ApolloLink","operation","forward","request","has_listeners","qm","id_map","query_map","q","qs","pre","retry_wait","passed","Apollo","MD","MILA","_md","loadMD","waited","SettingsLinks","default_render","env","self","href","attr","awaitMD","getMD","outside","popup","ve","_editor","Overrides","old_user","old_b","socket","permission","broadcast_id","perm","can_copy","copy","sink","stats","videoHeight","videoWidth","displayHeight","displayWidth","tampered","drift","delayed","ff","video_info","desync","ref_fn","old_color","old_icon","border","inherit","listeners","add_close_listener","figure","Metadata","default_type","tip_container","tip_element","align","TooltipProvider","Experiments","HiddenEmotes","FavoriteEmotes","Profiles","Everything","compare_requirements","old_cache","old_value","new_value","contexts","new_profiles","changed_ids","old_meta","meta","new_m","old_m","new_uses","old_uses","initial","new_meta","req_key","raw_type","raw_value","def_default","prof","SettingsContext","safety","loadSafety","NeverMatch","Invert","rule_types","And","Or","If","cond","if_true","if_false","Constant","parseTime","hours","minutes","Time","TheaterMode","Fullscreen","Moderator","Debug","AddonDebug","SquadMode","NativeDarkTheme","Page","router","Category","Title","reload","need_safety","Monitor","FFZ","postMessage","NO_SYNC_KEYS","proxy","captured","has_value","raw_key","has_raw","blob","JSZip","metadata","safe_key","transfer","old_provider","new_provider","s_key","suppress_events","old_profile_ids","old_profile_uuids","old_profiles","profile_ids","profile_uuids","old_ids","new_ids","raw_profiles","need_save","reordered","profile_data","slot_id","old_profile","old_slot_id","new_profile","old_definition","required_by","ui","format_path_tokens","links","i18n_base","processor","validator","SettingsManager","BAD","do_number","default_value","bounds","to_int","to_float","SettingsProfile","DB_VERSION","NOT_WWW_TWITCH","NOT_WWW_YT","SettingsProvider","AdvancedSettingsProvider","fail","RemoteSettingsProvider","LocalStorageProvider","db","r2","this_wait","trx","delreq","release","IndexedDBProvider","frame","CrossOriginStorageBridge","responded","listener","cleanup","ExtensionProvider","Providers","DEFAULT","log","sources","trailing","had_value","profs","is_trailing","process_to_int","process_to_float","cmp","FFZWrapper","th","Loadable","should_show","post","SubButton","isValidBlob","serializeBlob","deserializeBlob","hue2rgb","bit2linear","linear2bit","ignoreAlpha","Color","z","R","G","B","HSVAColor","HSLAColor","XYZAColor","cvd","cvd_a","cvd_b","cvd_c","cvd_d","cvd_e","cvd_f","cvd_g","cvd_h","cvd_i","L","RR","GG","BB","RGBAColor","mid","deltaGammaFactor","uDeltaGamma","vDeltagamma","Y","X","Z","LUVAColor","yGamma","deltaDivider","deltaFactor","uDelta","vDelta","lum","throw_errors","rgb","luv","hsl","ColorAdjuster","nav","letter","spacer","domain","state_fn","score","total","FineRouter","max_depth","traverse_roots","criteria","depth","parent_node","single_class","parents","crit","criterias","crt","FineWrapper","Fine","EVENTS","insts","_instances","o_mount","o_unmount","mount","unmount","prepend","ttl","DEBUG","EXTENSION","SERVER","SERVER_OR_EXT","API_SERVER","STAGING_API","STAGING_CDN","NEW_API","SENTRY_ID","WORD_SEPARATORS","WEIRD_EMOTE_SIZES","BAD_HOTKEYS","RERENDER_SETTINGS","UPDATE_BADGE_SETTINGS","UPDATE_TOKEN_SETTINGS","TWITCH_EMOTE_V2","KNOWN_CODES","REPLACEMENT_BASE","REPLACEMENTS","WS_CLUSTERS","LINK_DATA_HOSTS","PUBSUB_CLUSTERS","EMQX_SERVERS","IS_OSX","IS_WIN","IS_WEBKIT","IS_FIREFOX","WEBKIT_CSS","TWITCH_GLOBAL_SETS","TWITCH_POINTS_SETS","TWITCH_PRIME_SETS","EmoteTypes","RESOLVERS_REQUIRE_TOS","last_z","getDialogNextZ","maximized","visible","old_container","Dialog","ATTRS","SVG_TAGS","BOOLEAN_ATTRS","camelCase","on","off","findReactFragment","prop","setChildren","no_sanitize","no_empty","hasSharedParent","openFile","contentType","multiple","resolved","files","readFile","encoding","reader","sanitize","block","ManagedStyle","ClickOutside","highlightJson","object","pretty","indent","indent_inner","Detach","StopPropagation","SNAKE_CAPS","SNAKE_SPACE","SNAKE_TRIM","separator","new_listeners","old_listeners","other_val","FFZEvent","FFZWaitableEvent","need_sort","new_items","EventEmitter","remain","HierarchicalEventEmitter","createTester","filter_types","inverted","or","tests","ALIASES","ICONS","load","maybeLoad","KNOWN_FONTS","VALID_FONTS","GOOGLE_FONTS","LOADED_GOOGLE","LOADED_GOOGLE_LINKS","loadGoogleFont","unloadGoogleFont","OD_FONTS","od_count","od_link","loadOpenDyslexic","unloadOpenDyslexic","getFontsList","useFont","unloaded","MERGE_METHODS","mergeList","merge","has_operation","a_names","LoadState","State","EXTRACTOR","extractAddonId","is_loadable","load_requires","chain","CyclicDependencyError","ModuleError","load_state","full_name","variable","inject_reference","old_val","dependents","req_name","req_path","req_mod","in_path","in_name","in_mod","raw_path","raw_module","lix","trimmed","buildAddonProxy","Module","accessor","access_warnings","no_proxy","receiver","warning","HOP","getTwitchEmoteURL","getTwitchEmoteSrcSet","isValidShortcut","generateUUID","TranslatableError","sha256","msgBuffer","hashBuffer","matchScreen","screens","mscore","mon","has","sleep","make_enum","make_enum_flags","TimeoutError","held","TicketLock","Mutex","immediate","later","once","array_equals","deep_equals","ignore_undefined","first_seen","second_seen","source_keys","dest_keys","set_equals","shallow_object_equals","map_equals","substr_count","needle","get","segments","new_object","shallow_copy","deep_copy","normalizeAddonIdForComparison","makeAddonIdChecker","escape_regex","maybe_call","SPLIT_REGEX","split_chars","pick_random","addWordSeparators","CONTROL_CHARS","glob_to_regex","groups","truncate","overage","ellipsis","break_line","trim","next_space","decimalToHex","generateHex","arr","use_set","source_sorter","need_sorting","SourcedSet","b64ToArrayBuffer","bin","view","PEM_HEADER","PEM_FOOTER","importRsaKey","pem","start_match","end_match","is_private","init","error_value","parse","parseAST","old_tab","old_page","parseJSON","string","getBuster","resolution","duration_to_string","separate_days","days_only","no_hours","no_seconds","seconds","days","day_count","show_hours","print_duration","durationForChat","durationForURL","NoContent","DefaultOptions","elements","ctrl_state","inner","interactive","hover_events","use_html","setter","pop_opts","popper_target","makeReference","normalizeModifiers","noop","Tooltip","_x","DEFAULT_PARSER_OPTIONS","DEFAULT_TYPES","sub_ast","getCardinalName","getOrdinalName","new_val","DEFAULT_FORMATS","without_suffix","currency","full_key","listToString","TranslationCore","cardinal_i18n","cardinal_locale","ordinal_i18n","ordinal_locale","variables","mutation","a_match","b_match","message_id","disable_notifications","retval","stored","failure","logins","id_set","login_set","poll_id","choices","edges","edge","TwitchData","unique","defs","collectFragmentReferences","refs","definitionRefs","findOperation","oneQuery","operationName","newDoc","opRefs","allRefs","newRefs","refName","prevRefs","childRefs","childRef","op","Iterator","forEach","typed","iterables","Keys","Values","capacity","PointerArray","pointer","oldHead","previous","oldValue","oldKey","iterator","iterable","isArrayLike","guessLength","toArray","array","toArrayWithIndices","IndexArray","MAX_8BIT_INTEGER","MAX_16BIT_INTEGER","MAX_32BIT_INTEGER","MAX_SIGNED_8BIT_INTEGER","MAX_SIGNED_16BIT_INTEGER","MAX_SIGNED_32BIT_INTEGER","maxIndex","TYPE_PRIORITY","getter","maxType","maxPriority","support","ARRAY_BUFFER_SUPPORT","SYMBOL_SUPPORT","sequence","pathToRegexp","regexpToFunction","compile","tokensToFunction","tokensToRegExp","DEFAULT_DELIMITER","PATH_REGEXP","defaultDelimiter","whitelist","pathEscaped","escaped","capture","repeat","optional","pattern","delimiter","escapeGroup","escapeString","re","pathname","decode","encode","regexpToRegexp","arrayToRegexp","stringToRegexp","strict","endsWith","endToken","isEndDelimited","webpackAsyncContext","__webpack_require__","webpackContext","webpackContextResolve","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","getProto","leafPrototypes","ns","chunkId","inProgress","dataWebpackPrefix","done","script","needAttach","scripts","onScriptComplete","doneFns","scriptUrl","document","installedChunks","installedChunkData","loadingEnded","errorType","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","RAVEN_LEVELS","LogLevel","readLSLevel","level","upper","Logger","raven","VER","loc","optionalParams","exc","default_style","targets","old_enabled","cdn_data","local_data","base_path","save","AddonManager","defaultConverter","converter","defaultAttributes","stringifiedAttributes","attributeName","cookies","jar","OVERRIDE_COOKIE","COOKIE_OPTIONS","EXPERIMENTS","TwitchExperimentType","isTwitchExperiment","exp","isFFZExperiment","sortExperimentLog","ffz_assignments","assignment","override","weight","twitch_assignments","exps","external","experiments","exp_data","is_set","experiment","unique_id","seed","ExperimentManager","ANONYMOUS_ID","challenge","_chat","con","es","conn","cluster_id","cluster","ws","send_user","command","cmd_id","ix2","skip_log","d_now","rtt","ping","topics","tp","SocketClient","enumerateSubs","wantDelay","packet","sub","PubSubClient","topic_map","PubSub","components","ObserveVisibility","Clickaway","Components","constructor","VueModule","StagingSelector","LoadTracker","Addon","start_time","logs","blobs","constants","dialog","dom","graphql","FrankerFaceZ"],"sourceRoot":""}