(()=>{var mt=Object.defineProperty;var h=(B,I)=>mt(B,"name",{value:I,configurable:!0});(()=>{var B={6483:w=>{var f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Trubbel_GetUserAccountAge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"login"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"login"},value:{kind:"Variable",name:{kind:"Name",value:"login"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:81}};f.loc.source={body:"query Trubbel_GetUserAccountAge($login:String!){user(login:$login){id createdAt}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function $(r){return r.filter(function(o){if(o.kind!=="FragmentDefinition")return!0;var l=o.name.value;return S[l]?!1:(S[l]=!0,!0)})}h($,"unique");function y(r,o){if(r.kind==="FragmentSpread")o.add(r.name.value);else if(r.kind==="VariableDefinition"){var l=r.type;l.kind==="NamedType"&&o.add(l.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(p){y(p,o)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(p){y(p,o)}),r.definitions&&r.definitions.forEach(function(p){y(p,o)})}h(y,"collectFragmentReferences");var E={};h(function(){f.definitions.forEach(function(o){if(o.name){var l=new Set;y(o,l),E[o.name.value]=l}})},"extractReferences")();function M(r,o){for(var l=0;l<r.definitions.length;l++){var p=r.definitions[l];if(p.name&&p.name.value==o)return p}}h(M,"findOperation");function O(r,o){var l={kind:r.kind,definitions:[M(r,o)]};r.hasOwnProperty("loc")&&(l.loc=r.loc);var p=E[o]||new Set,T=new Set,v=new Set;for(p.forEach(function(b){v.add(b)});v.size>0;){var U=v;v=new Set,U.forEach(function(b){if(!T.has(b)){T.add(b);var k=E[b]||new Set;k.forEach(function(D){v.add(D)})}})}return T.forEach(function(b){var k=M(r,b);k&&l.definitions.push(k)}),l}h(O,"oneQuery"),w.exports=f,w.exports.Trubbel_GetUserAccountAge=O(f,"Trubbel_GetUserAccountAge")},6709:w=>{var f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Trubbel_GetChattersCount"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"chatters"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:86}};f.loc.source={body:"query Trubbel_GetChattersCount($name:String!){channel(name:$name){id chatters{count}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function $(r){return r.filter(function(o){if(o.kind!=="FragmentDefinition")return!0;var l=o.name.value;return S[l]?!1:(S[l]=!0,!0)})}h($,"unique");function y(r,o){if(r.kind==="FragmentSpread")o.add(r.name.value);else if(r.kind==="VariableDefinition"){var l=r.type;l.kind==="NamedType"&&o.add(l.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(p){y(p,o)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(p){y(p,o)}),r.definitions&&r.definitions.forEach(function(p){y(p,o)})}h(y,"collectFragmentReferences");var E={};h(function(){f.definitions.forEach(function(o){if(o.name){var l=new Set;y(o,l),E[o.name.value]=l}})},"extractReferences")();function M(r,o){for(var l=0;l<r.definitions.length;l++){var p=r.definitions[l];if(p.name&&p.name.value==o)return p}}h(M,"findOperation");function O(r,o){var l={kind:r.kind,definitions:[M(r,o)]};r.hasOwnProperty("loc")&&(l.loc=r.loc);var p=E[o]||new Set,T=new Set,v=new Set;for(p.forEach(function(b){v.add(b)});v.size>0;){var U=v;v=new Set,U.forEach(function(b){if(!T.has(b)){T.add(b);var k=E[b]||new Set;k.forEach(function(D){v.add(D)})}})}return T.forEach(function(b){var k=M(r,b);k&&l.definitions.push(k)}),l}h(O,"oneQuery"),w.exports=f,w.exports.Trubbel_GetChattersCount=O(f,"Trubbel_GetChattersCount")},7517:w=>{var f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Trubbel_GetClipDate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:68}};f.loc.source={body:"query Trubbel_GetClipDate($slug:ID!){clip(slug:$slug){id createdAt}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function $(r){return r.filter(function(o){if(o.kind!=="FragmentDefinition")return!0;var l=o.name.value;return S[l]?!1:(S[l]=!0,!0)})}h($,"unique");function y(r,o){if(r.kind==="FragmentSpread")o.add(r.name.value);else if(r.kind==="VariableDefinition"){var l=r.type;l.kind==="NamedType"&&o.add(l.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(p){y(p,o)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(p){y(p,o)}),r.definitions&&r.definitions.forEach(function(p){y(p,o)})}h(y,"collectFragmentReferences");var E={};h(function(){f.definitions.forEach(function(o){if(o.name){var l=new Set;y(o,l),E[o.name.value]=l}})},"extractReferences")();function M(r,o){for(var l=0;l<r.definitions.length;l++){var p=r.definitions[l];if(p.name&&p.name.value==o)return p}}h(M,"findOperation");function O(r,o){var l={kind:r.kind,definitions:[M(r,o)]};r.hasOwnProperty("loc")&&(l.loc=r.loc);var p=E[o]||new Set,T=new Set,v=new Set;for(p.forEach(function(b){v.add(b)});v.size>0;){var U=v;v=new Set,U.forEach(function(b){if(!T.has(b)){T.add(b);var k=E[b]||new Set;k.forEach(function(D){v.add(D)})}})}return T.forEach(function(b){var k=M(r,b);k&&l.definitions.push(k)}),l}h(O,"oneQuery"),w.exports=f,w.exports.Trubbel_GetClipDate=O(f,"Trubbel_GetClipDate")},906:w=>{var f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Trubbel_GetTotalChannelFollowCount"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"follows"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalCount"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:77}};f.loc.source={body:"query Trubbel_GetTotalChannelFollowCount{currentUser{id follows{totalCount}}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function $(r){return r.filter(function(o){if(o.kind!=="FragmentDefinition")return!0;var l=o.name.value;return S[l]?!1:(S[l]=!0,!0)})}h($,"unique");function y(r,o){if(r.kind==="FragmentSpread")o.add(r.name.value);else if(r.kind==="VariableDefinition"){var l=r.type;l.kind==="NamedType"&&o.add(l.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(p){y(p,o)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(p){y(p,o)}),r.definitions&&r.definitions.forEach(function(p){y(p,o)})}h(y,"collectFragmentReferences");var E={};h(function(){f.definitions.forEach(function(o){if(o.name){var l=new Set;y(o,l),E[o.name.value]=l}})},"extractReferences")();function M(r,o){for(var l=0;l<r.definitions.length;l++){var p=r.definitions[l];if(p.name&&p.name.value==o)return p}}h(M,"findOperation");function O(r,o){var l={kind:r.kind,definitions:[M(r,o)]};r.hasOwnProperty("loc")&&(l.loc=r.loc);var p=E[o]||new Set,T=new Set,v=new Set;for(p.forEach(function(b){v.add(b)});v.size>0;){var U=v;v=new Set,U.forEach(function(b){if(!T.has(b)){T.add(b);var k=E[b]||new Set;k.forEach(function(D){v.add(D)})}})}return T.forEach(function(b){var k=M(r,b);k&&l.definitions.push(k)}),l}h(O,"oneQuery"),w.exports=f,w.exports.Trubbel_GetTotalChannelFollowCount=O(f,"Trubbel_GetTotalChannelFollowCount")},6929:w=>{var f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Trubbel_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"muteInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mutedSegmentConnection"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"offset"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"duration"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:120}};f.loc.source={body:"query Trubbel_GetVideoInfo($id:ID!){video(id:$id){id muteInfo{mutedSegmentConnection{nodes{offset duration}}}createdAt}}",name:"GraphQL request",locationOffset:{line:1,column:1}};var S={};function $(r){return r.filter(function(o){if(o.kind!=="FragmentDefinition")return!0;var l=o.name.value;return S[l]?!1:(S[l]=!0,!0)})}h($,"unique");function y(r,o){if(r.kind==="FragmentSpread")o.add(r.name.value);else if(r.kind==="VariableDefinition"){var l=r.type;l.kind==="NamedType"&&o.add(l.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(p){y(p,o)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(p){y(p,o)}),r.definitions&&r.definitions.forEach(function(p){y(p,o)})}h(y,"collectFragmentReferences");var E={};h(function(){f.definitions.forEach(function(o){if(o.name){var l=new Set;y(o,l),E[o.name.value]=l}})},"extractReferences")();function M(r,o){for(var l=0;l<r.definitions.length;l++){var p=r.definitions[l];if(p.name&&p.name.value==o)return p}}h(M,"findOperation");function O(r,o){var l={kind:r.kind,definitions:[M(r,o)]};r.hasOwnProperty("loc")&&(l.loc=r.loc);var p=E[o]||new Set,T=new Set,v=new Set;for(p.forEach(function(b){v.add(b)});v.size>0;){var U=v;v=new Set,U.forEach(function(b){if(!T.has(b)){T.add(b);var k=E[b]||new Set;k.forEach(function(D){v.add(D)})}})}return T.forEach(function(b){var k=M(r,b);k&&l.definitions.push(k)}),l}h(O,"oneQuery"),w.exports=f,w.exports.Trubbel_GetVideoInfo=O(f,"Trubbel_GetVideoInfo")}},I={};function _(w){var f=I[w];if(f!==void 0)return f.exports;var S=I[w]={exports:{}};return B[w](S,S.exports,_),S.exports}h(_,"__webpack_require__"),_.n=w=>{var f=w&&w.__esModule?()=>w.default:()=>w;return _.d(f,{a:f}),f},_.d=(w,f)=>{for(var S in f)_.o(f,S)&&!_.o(w,S)&&Object.defineProperty(w,S,{enumerable:!0,get:f[S]})},_.o=(w,f)=>Object.prototype.hasOwnProperty.call(w,f);var gt={};(()=>{"use strict";var w=_(6483),f=_.n(w);function S(d){const e=new Date,t=new Date(d),i=e-t,s=Math.floor(i/1e3)%60,n=Math.floor(i/(1e3*60))%60,a=Math.floor(i/(1e3*60*60))%24,u=Math.floor(i/(1e3*60*60*24)),c=[];return u>0&&c.push(`${u} day${u>1?"s":""}`),a>0&&c.push(`${a} hour${a>1?"s":""}`),n>0&&c.push(`${n} minute${n>1?"s":""}`),s>0&&c.push(`${s} second${s>1?"s":""}`),`${c.join(", ").replace(/,([^,]*)$/," and$1")}`}h(S,"formatLiveDuration");function $(d){const e=new Date,t=new Date(d),i=e-t,s=Math.floor(i/1e3)%60,n=Math.floor(i/(1e3*60))%60,a=Math.floor(i/(1e3*60*60))%24,u=Math.floor(i/(1e3*60*60*24))%30,c=Math.floor(i/(1e3*60*60*24*30))%12,g=Math.floor(i/(1e3*60*60*24*30*12)),m=[];return g>0&&m.push(`${g} year${g>1?"s":""}`),c>0&&m.push(`${c} month${c>1?"s":""}`),u>0&&m.push(`${u} day${u>1?"s":""}`),a>0&&m.push(`${a} hour${a>1?"s":""}`),n>0&&m.push(`${n} minute${n>1?"s":""}`),s>0&&m.push(`${s} second${s>1?"s":""}`),m.length===0?"just created":m.join(", ").replace(/,([^,]*)$/," and$1")+" ago"}h($,"formatAccountAge");function y(d){const e=new Date,t=new Date(d),i=e-t,s=Math.floor(i/1e3)%60,n=Math.floor(i/(1e3*60))%60,a=Math.floor(i/(1e3*60*60))%24,u=Math.floor(i/(1e3*60*60*24))%30,c=Math.floor(i/(1e3*60*60*24*30))%12,g=Math.floor(i/(1e3*60*60*24*365)),m=[];return g>0&&m.push(`${g} year${g>1?"s":""}`),c>0&&m.push(`${c} month${c>1?"s":""}`),u>0&&m.push(`${u} day${u>1?"s":""}`),a>0&&m.push(`${a} hour${a>1?"s":""}`),n>0&&m.push(`${n} minute${n>1?"s":""}`),s>0&&m.push(`${s} second${s>1?"s":""}`),m.length===0?"just followed":m.join(", ").replace(/,([^,]*)$/," and$1")}h(y,"formatFollowAge");function E(d){const e=Math.floor(d/3600),t=Math.floor(d%3600/60),i=Math.floor(d%60);return e>0?`${e}:${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:t>0?`${t}:${i.toString().padStart(2,"0")}`:`${i}s`}h(E,"formatTime");async function M(d,e){const t=e?.props.currentUserID,i=e?.props.currentUserLogin,s=await d.twitch_data.getUser(t),n=s.displayName,a=s.login,u=n.toLowerCase()===a?n:`${n} (${a})`,c=d.resolve("site.apollo");if(!c)return null;const m=(await c.client.query({query:f(),variables:{login:i}}))?.data?.user?.createdAt;m?e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`${u} created their account ${$(m)}.`}):e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`Unable to get accountage for ${u}.`})}h(M,"getAccountAge");var O=_(6709),r=_.n(O);async function o(d,e){const t=e?.props.channelLogin,i=await d.twitch_data.getUser(null,t),s=i.displayName,n=i.login,a=s.toLowerCase()===n?s:`${s} (${n})`,u=d.resolve("site.apollo");if(!u)return null;const g=(await u.client.query({query:r(),variables:{name:t}}))?.data?.channel?.chatters?.count,m=new Intl.NumberFormat(document.documentElement.getAttribute("lang")).format(g);g?e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`${a} has ${m} chatters.`}):e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`Unable to fetch chatter count for ${a}.`})}h(o,"getChatters");async function l(d,e){const t=e?.props.channelID,i=e?.props.channelLogin,s=e?.props.currentUserID;if(t===s){e.addMessage({type:d.site.children.chat.chat_types.Notice,message:"You cannot follow yourself."});return}const n=await d.twitch_data.getUser(null,i),a=await d.twitch_data.getUser(s),u=n.displayName.toLowerCase()===n.login?n.displayName:`${n.displayName} (${n.login})`,c=a.displayName.toLowerCase()===a.login?a.displayName:`${a.displayName} (${a.login})`,g=await d.twitch_data.getUserFollowed(null,i);if(g){const m=g.followedAt;e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`${c} has been following ${u} for ${y(m)}.`})}else e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`${c} is not following ${u}.`})}h(l,"getFollowAge");async function p(d,e){const t=e?.props.channelLogin,i=await d.twitch_data.getUser(null,t),s=i.displayName,n=i.login,a=s.toLowerCase()===n?s:`${s} (${n})`,u=d?.site?.children?.chat?.ChatContainer?.first?.props?.streamCreatedAt;u?e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`${a} has been live for ${S(u)}.`}):e.addMessage({type:d.site.children.chat.chat_types.Notice,message:`${a} is offline.`})}h(p,"getStreamUptime");const T={VIEWER:0,VIP:1,MODERATOR:2,BROADCASTER:3},v=[{prefix:"/",name:"accountage",description:"Show how long ago you created your account.",permissionLevel:T.VIEWER,ffz_group:"Trubbel\u2019s Utilities",commandArgs:[]},{prefix:"/",name:"chatters",description:"Show the current channels amount of chatters.",permissionLevel:T.VIEWER,ffz_group:"Trubbel\u2019s Utilities",commandArgs:[]},{prefix:"/",name:"followage",description:"Show your followage in the current channel.",permissionLevel:T.VIEWER,ffz_group:"Trubbel\u2019s Utilities",commandArgs:[]},{prefix:"/",name:"uptime",description:"Show the channels current uptime.",permissionLevel:T.VIEWER,ffz_group:"Trubbel\u2019s Utilities",commandArgs:[]},{prefix:"/",name:"shrug",description:"\xAF\\_(\u30C4)_/\xAF",permissionLevel:T.VIEWER,ffz_group:"Trubbel\u2019s Utilities",commandArgs:[{name:"message",isRequired:!1}]}];var U=Object.defineProperty,b=h((d,e,t)=>e in d?U(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,"__defNormalProp"),k=h((d,e,t)=>(b(d,typeof e!="symbol"?e+"":e,t),t),"__publicField");const de=class de extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),k(this,"handleMessage",i=>{const s=i.message,n=i._inst,a=this.getEnabledCommands();for(const u of a)if(new RegExp(`^\\${u.prefix}${u.name}\\s*`,"i").test(s)){switch(i.preventDefault(),u.name.toLowerCase()){case"accountage":M(this,n);break;case"chatters":o(this,n);break;case"followage":l(this,n);break;case"shrug":shrug(this,n,i);break;case"uptime":p(this,n);break;default:n.addMessage({type:this.site.children.chat.chat_types.Notice,message:`Unknown command: ${u.name}`})}return}}),this.inject("settings"),this.inject("chat"),this.inject("site"),this.inject("site.chat"),this.inject("site.apollo"),this.inject("site.fine"),this.inject("site.twitch_data"),this.commandHandlers=new Set,this.settings.add("addon.trubbel.chat.custom-commands",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Chat >> Custom Commands",title:"Enable Custom Chat Commands",component:"setting-check-box"},changed:()=>this.handleCustomCommands()}),Object.entries({accountage:"Show how long ago you created your account.",chatters:"Show the current channels amount of chatters.",followage:"Show your followage in the current channel.",shrug:"Appends `\xAF\\_(\u30C4)_/\xAF` to your message.",uptime:"Show the channels current uptime."}).forEach(([i,s])=>{this.settings.add(`addon.trubbel.chat.custom-command-${i}`,{default:!1,requires:["addon.trubbel.chat.custom-commands"],process(n,a){return n.get("addon.trubbel.chat.custom-commands")?a:!1},ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Chat >> Custom Commands",title:i.charAt(0).toUpperCase()+i.slice(1),description:s,component:"setting-check-box"},changed:()=>this.handleCustomCommands()})})}onEnable(){this.settings.getChanges("addon.trubbel.chat.custom-commands",()=>this.handleCustomCommands()),this.on("chat:pre-send-message",this.handleMessage),this.handleCustomCommands()}onDisable(){this.removeCommandHandlers(),this.off("chat:pre-send-message",this.handleMessage)}removeCommandHandlers(){for(const e of this.commandHandlers)this.off("chat:get-tab-commands",e);this.commandHandlers.clear()}getEnabledCommands(){return v.filter(e=>{const i=`addon.trubbel.chat.custom-command-${e.name.toLowerCase()}`;return this.settings.get(i)})}handleCustomCommands(){if(this.removeCommandHandlers(),this.settings.get("addon.trubbel.chat.custom-commands")){const e=h(t=>{const i=this.getEnabledCommands();t.commands.push(...i)},"commandHandler");this.on("chat:get-tab-commands",e),this.commandHandlers.add(e)}}};h(de,"ChatCommands");let D=de;const{TranslatableError:$e}=FrankerFaceZ.utilities.object,{createElement:F,on:P,off:z}=FrankerFaceZ.utilities.dom,ce=class ce extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.chat"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.twitch_data"),this.action=null,this.messageData=null,this.CUSTOM_TIMEOUT_ID="trubbel-custom-timeout-contain",this.STYLE_ID="trubbel-timeout-styles",this.isEnabled=!1,this.ActionTypes={CANCEL:"cancel",TIMEOUT:"timeout",BAN:"ban",DELETE:"delete"},this.settings.add("addon.trubbel.chat.moderation-bttv",{default:!1,requires:["context.moderator"],process(t,i){return t.get("context.moderator")?i:!1},ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Chat >> Moderation",title:"Enable BTTV-like Mod Action",description:"Gives you the ability to use the right click context menu to ban, timeout, purge and delete messages. With some extra options below.",component:"setting-check-box"},changed:()=>this.handleModerationAction()}),this.settings.add("addon.trubbel.chat.moderation-bttv-option",{default:"usernames",requires:["addon.trubbel.chat.moderation-bttv"],process(t,i){return t.get("addon.trubbel.chat.moderation-bttv")?i:!1},ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Chat >> Moderation",title:"Options",description:"Decide how you want to moderate when right clicking in chat;\n\n`Usernames` -> Only on usernames\n\n`Messages` -> Everywhere in a message\n\n`Messages (except embeds and links)` -> Same as above but this lets you use normal context menu when right clicking rich embeds and links.",component:"setting-select-box",data:[{title:"Usernames",value:"usernames"},{title:"Messages",value:"messages1"},{title:"Messages (except embeds and links)",value:"messages2"}]},changed:()=>this.handleModerationAction()}),this.boundRightClick=t=>this.onRightClick(t),this.boundTimeoutClick=this.handleTimeoutClick.bind(this),this.boundClickOutside=this.handleClickOutside.bind(this),this.boundMouseMove=this.handleMouseMove.bind(this)}onEnable(){this.settings.getChanges("addon.trubbel.chat.moderation-bttv",()=>this.handleModerationAction()),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}init(){this.isEnabled||(this.log.info("[BTTV Mod Action] init()"),P(document,"contextmenu",this.boundRightClick),P(document,"click",this.boundTimeoutClick),P(document,"click",this.boundClickOutside),this.injectStyles(),this.isEnabled=!0)}cleanup(){this.isEnabled&&(this.log.info("[BTTV Mod Action] cleanup()"),z(document,"contextmenu",this.boundRightClick),z(document,"click",this.boundTimeoutClick),z(document,"click",this.boundClickOutside),this.removeCustomTimeout(),this.removeStyles(),this.isEnabled=!1)}checkNavigation(){if(!this.settings.get("addon.trubbel.chat.moderation-bttv"))return;this.site.constructor.CHAT_ROUTES.includes(this.router?.current?.name)?(this.log.info("[BTTV Mod Action] navigated to:",this.router?.current?.name),this.init()):this.cleanup()}injectStyles(){if(document.getElementById(this.STYLE_ID))return;const e=F("style",{id:this.STYLE_ID},`
        #${this.CUSTOM_TIMEOUT_ID} {
          position: fixed;
          top: 0px;
          left: 0px;
          width: 80px;
          height: 224px;
          overflow: hidden;
          background: rgba(90, 90, 90, 0.4);
          z-index: 99999;
          user-select: none;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
        }
        #${this.CUSTOM_TIMEOUT_ID} .text,
        #${this.CUSTOM_TIMEOUT_ID} .cursor {
          position: absolute;
          left: 0px;
          top: 100px;
          width: 80px;
          height: 1px;
          background: #f00;
        }
        #${this.CUSTOM_TIMEOUT_ID} .text {
          top: 85px;
          height: 30px;
          line-height: 30px;
          text-align: center;
          background: rgba(0, 0, 0, 0.6);
          cursor: default;
          display: none;
          color: #d3d3d3;
        }
        #${this.CUSTOM_TIMEOUT_ID}:hover .text {
          display: block;
        }
        #${this.CUSTOM_TIMEOUT_ID}:hover .cursor {
          background: #0f0;
        }
        `);document.head.appendChild(e)}removeStyles(){const e=document.getElementById(this.STYLE_ID);e&&e.remove()}onRightClick(e){const t=h(g=>{try{const m=this.fine.getReactInstance(g);if(!m?.return)return null;const x=m.return.memoizedProps||m.return.pendingProps;return x?.message?x:null}catch(m){return this.log.error("[BTTV Mod Action] Error getting chat message object:",m),null}},"getChatMessageObject"),i=this.settings.get("addon.trubbel.chat.moderation-bttv-option"),s={messages1:".chat-line__message",messages2:".chat-line__message",usernames:".chat-line__message .chat-line__username"},n=e.target.closest(s[i]);if(!n||i==="messages2"&&e.target.closest(".ffz-tooltip.link-fragment, .ffz--chat-card"))return;const a=window.getSelection();if(a.rangeCount>0){const g=a.getRangeAt(0);if(a.toString().trim().length>0&&n.contains(g.startContainer)&&n.contains(g.endContainer))return}const u=e.target.closest(".chat-line__message");if(!u)return;e.preventDefault();const c=t.call(this,u);this.messageData={roomId:c?.channelID||u.dataset.roomId,room:c?.channelLogin||u.dataset.room,userId:c?.message?.user?.userID||u.dataset.userId,user:c?.message?.user?.userLogin||u.dataset.user,messageId:c?.message?.id,messageDeleted:c?.message?.deleted},this.log.info("[Message] Right click data:",e),this.log.info("[Message] Message data:",this.messageData),this.openCustomTimeout(e.target)}createCustomTimeout(){return this.container||(this.container=F("div",{id:this.CUSTOM_TIMEOUT_ID},F("div",{className:"text"}),F("svg",{xmlns:"http://www.w3.org/2000/svg",height:"224",width:"80"},F("g",{fill:"none","fill-rule":"evenodd"},F("path",{fill:"#000","fill-opacity":".304","fill-rule":"nonzero",d:"M.5 0h80v20H.5zM.5 180h80v20H.5zM0 203h80v20H0z"}),F("path",{stroke:"#ACACAC","stroke-opacity":".3",d:"M80.5 19.805C64.51 51.825 70.65 154.184.5 180"}),F("path",{fill:"#FFF","fill-rule":"nonzero",d:"M18.773 218v-10.84h3.603c1.074 0 1.942.12 2.604.359.662.24 1.234.645 1.718 1.216.766.908 1.15 2.104 1.15 3.589 0 1.801-.477 3.198-1.429 4.19-.952.99-2.292 1.486-4.02 1.486h-3.626zm1.538-1.15h1.97c1.406 0 2.402-.378 2.988-1.135.63-.806.945-1.887.945-3.245 0-1.274-.31-2.275-.93-3.003a2.863 2.863 0 0 0-1.348-.912c-.522-.163-1.308-.245-2.358-.245H20.31v8.54zm15.571.894c-.967.293-1.794.44-2.483.44-1.172 0-2.128-.39-2.867-1.17-.74-.778-1.11-1.787-1.11-3.028 0-1.206.326-2.194.978-2.966.652-.771 1.485-1.157 2.501-1.157.962 0 1.705.342 2.23 1.025.525.684.788 1.655.788 2.915l-.008.447h-5.017c.21 1.89 1.136 2.834 2.776 2.834.6 0 1.338-.16 2.212-.483v1.143zm-4.922-4.578h3.509c0-1.48-.552-2.22-1.656-2.22-1.108 0-1.726.74-1.853 2.22zM38.41 218v-11.565h1.443V218h-1.443zm10.166-.256c-.967.293-1.794.44-2.483.44-1.172 0-2.128-.39-2.867-1.17-.74-.778-1.11-1.787-1.11-3.028 0-1.206.326-2.194.978-2.966.652-.771 1.485-1.157 2.501-1.157.962 0 1.705.342 2.23 1.025.525.684.788 1.655.788 2.915l-.008.447h-5.017c.21 1.89 1.135 2.834 2.776 2.834.6 0 1.338-.16 2.212-.483v1.143zm-4.922-4.578h3.508c0-1.48-.551-2.22-1.655-2.22-1.108 0-1.726.74-1.853 2.22zm9.837 5.017c-.733 0-1.304-.21-1.714-.63-.41-.42-.616-1.003-.616-1.75v-4.673h-.996v-1.084h.996v-1.443l1.443-.14v1.583h2.08v1.084h-2.08v4.41c0 1.04.45 1.56 1.348 1.56.19 0 .422-.033.696-.096V218c-.445.122-.83.183-1.157.183zm9.052-.44c-.967.294-1.794.44-2.483.44-1.172 0-2.127-.39-2.867-1.168-.74-.779-1.11-1.788-1.11-3.029 0-1.206.326-2.194.978-2.966.652-.771 1.486-1.157 2.501-1.157.962 0 1.706.342 2.23 1.025.525.684.788 1.655.788 2.915l-.007.447h-5.018c.21 1.89 1.136 2.834 2.776 2.834.6 0 1.338-.16 2.212-.483v1.143zm-4.922-4.577h3.509c0-1.48-.552-2.22-1.656-2.22-1.108 0-1.726.74-1.853 2.22zM26.756 186.292c0 .483-.084.931-.253 1.344a3.22 3.22 0 0 1-.706 1.073c-.376.376-.82.658-1.333.846-.513.188-1.16.282-1.941.282h-1.45v4.065h-1.45v-10.906h2.958c.655 0 1.209.055 1.663.165.454.11.857.282 1.208.516.415.279.736.625.964 1.04.227.415.34.94.34 1.575zm-1.509.037c0-.376-.066-.704-.197-.982a1.645 1.645 0 0 0-.601-.681 2.42 2.42 0 0 0-.802-.326c-.3-.066-.68-.099-1.139-.099h-1.435v4.358h1.223c.586 0 1.062-.052 1.428-.157.366-.105.664-.273.893-.502.23-.234.392-.481.487-.74a2.51 2.51 0 0 0 .143-.871zm10.093 7.573h-1.377v-.908a6.705 6.705 0 0 1-1.333.842 3.326 3.326 0 0 1-1.406.293c-.86 0-1.528-.263-2.007-.787-.478-.525-.718-1.296-.718-2.311v-5.31h1.377v4.658c0 .415.02.77.059 1.066.039.295.122.548.249.758.132.214.303.37.513.468.21.098.515.147.915.147.357 0 .746-.093 1.168-.278a5.455 5.455 0 0 0 1.183-.71v-6.11h1.377v8.182zm7.815-6.68h-.073a5.045 5.045 0 0 0-1.282-.139c-.425 0-.835.094-1.23.282-.396.188-.777.43-1.143.729v5.808H38.05v-8.181h1.377v1.208c.547-.44 1.03-.75 1.447-.934a3.153 3.153 0 0 1 1.278-.274c.239 0 .412.006.52.018.107.012.268.035.483.07v1.413zm7.932 5.75c0 1.386-.315 2.404-.945 3.054-.63.65-1.599.974-2.907.974-.435 0-.859-.03-1.271-.092a9.846 9.846 0 0 1-1.22-.26v-1.406h.074c.224.088.58.197 1.069.326.488.13.977.194 1.465.194.469 0 .857-.056 1.164-.168.308-.113.547-.269.718-.469.171-.19.293-.42.366-.688.074-.269.11-.57.11-.901v-.747c-.415.332-.812.58-1.19.743-.378.164-.86.245-1.447.245-.976 0-1.751-.352-2.325-1.058-.574-.706-.86-1.7-.86-2.985 0-.703.098-1.31.296-1.82.198-.51.468-.95.81-1.322a3.29 3.29 0 0 1 1.157-.809c.454-.193.905-.29 1.355-.29.473 0 .87.048 1.19.143.32.096.658.241 1.014.436l.088-.351h1.29v7.25zm-1.377-1.319v-4.46a5.333 5.333 0 0 0-1.022-.355 4.28 4.28 0 0 0-.94-.107c-.758 0-1.353.254-1.788.762-.434.508-.652 1.245-.652 2.212 0 .918.161 1.614.484 2.087.322.474.857.71 1.604.71.4 0 .802-.076 1.205-.23a4.37 4.37 0 0 0 1.11-.619zm10.935-1.699h-6.028c0 .503.076.941.227 1.315.152.373.36.68.623.919.254.234.555.41.905.527.349.118.733.176 1.153.176a4.56 4.56 0 0 0 1.681-.333c.564-.222.966-.44 1.205-.656h.073v1.502a11.36 11.36 0 0 1-1.42.49 5.765 5.765 0 0 1-1.524.198c-1.358 0-2.417-.367-3.179-1.102-.762-.735-1.142-1.779-1.142-3.131 0-1.338.364-2.4 1.094-3.186.73-.786 1.691-1.18 2.883-1.18 1.103 0 1.954.323 2.552.967.598.645.897 1.56.897 2.747v.747zm-1.34-1.055c-.005-.722-.187-1.281-.546-1.677-.359-.395-.904-.593-1.637-.593-.737 0-1.324.217-1.761.652-.437.434-.685.974-.744 1.618h4.688zM35.065 11.985c0 .542-.102 1.02-.307 1.435a2.9 2.9 0 0 1-.828 1.026c-.41.322-.86.552-1.351.688-.49.137-1.115.205-1.871.205H26.84V4.434h3.23c.796 0 1.392.029 1.787.087.396.06.774.181 1.136.367.4.21.69.48.871.809.18.33.271.724.271 1.183 0 .517-.132.958-.395 1.322a2.847 2.847 0 0 1-1.055.875v.059c.737.151 1.318.475 1.743.97.425.496.637 1.122.637 1.879zM32.626 7.07c0-.263-.043-.486-.131-.666a1.02 1.02 0 0 0-.425-.44 2.06 2.06 0 0 0-.835-.245 12.934 12.934 0 0 0-1.216-.048h-1.728v3.15h1.875c.454 0 .815-.023 1.084-.07.268-.046.517-.143.747-.29.23-.146.391-.335.487-.567.095-.232.142-.506.142-.824zm.93 4.973c0-.439-.065-.788-.197-1.047-.132-.259-.371-.478-.718-.66a2.407 2.407 0 0 0-.853-.237 11.454 11.454 0 0 0-1.22-.055h-2.277v4.058h1.918c.635 0 1.155-.033 1.56-.1.406-.065.738-.186.997-.362a1.84 1.84 0 0 0 .6-.652c.127-.244.19-.559.19-.945zm9.815 3.296h-1.37v-.871a25.28 25.28 0 0 0-.494.348 4.094 4.094 0 0 1-1.395.637 4.284 4.284 0 0 1-1.048.113c-.737 0-1.362-.244-1.875-.732-.512-.488-.769-1.11-.769-1.868 0-.62.133-1.122.4-1.505.266-.383.645-.685 1.138-.904.499-.22 1.097-.369 1.795-.447A36.096 36.096 0 0 1 42 9.934v-.212c0-.313-.054-.572-.164-.777a1.2 1.2 0 0 0-.473-.483 1.954 1.954 0 0 0-.703-.227 6.057 6.057 0 0 0-.857-.059c-.361 0-.764.048-1.208.143a9.395 9.395 0 0 0-1.377.414h-.073V7.334c.268-.073.656-.154 1.164-.242a8.793 8.793 0 0 1 1.502-.132c.576 0 1.077.048 1.505.143.427.095.797.258 1.11.487.307.225.541.515.702.872.162.356.242.798.242 1.326v5.551zm-1.37-2.014v-2.278c-.42.025-.914.061-1.483.11-.569.05-1.019.12-1.351.213-.396.112-.715.286-.96.523-.244.237-.366.563-.366.978 0 .469.142.822.425 1.058.283.237.715.356 1.297.356a3.08 3.08 0 0 0 1.325-.282 5.97 5.97 0 0 0 1.113-.678zm10.862 2.014h-1.377v-4.658a8.02 8.02 0 0 0-.066-1.058c-.044-.33-.124-.587-.241-.773a1.114 1.114 0 0 0-.528-.458c-.23-.1-.527-.15-.893-.15a2.86 2.86 0 0 0-1.18.279c-.41.185-.803.422-1.179.71v6.108h-1.377V7.16H47.4v.907c.43-.356.874-.634 1.333-.835.46-.2.93-.3 1.414-.3.884 0 1.558.266 2.021.798.464.533.696 1.3.696 2.3v5.31z"}))),F("div",{className:"cursor"}))),P(this.container,"mousemove",this.boundMouseMove),this.container}handleMouseMove(e){const t=document.querySelector(`#${this.CUSTOM_TIMEOUT_ID}`);if(!t)return;const i=t.getBoundingClientRect(),s=e.pageY-i.top,n=e.pageX-i.left,a=224-s,u=1209600,c=Math.min(Math.floor(1.5**((a-45)/6.35)*60),u);let g;Math.floor(c/60/60/24)>0?g=`${Math.floor(c/60/60/24)} Day(s)`:Math.floor(c/60/60)>0?g=`${Math.floor(c/60/60)} Hour(s)`:g=`${Math.floor(c/60)} Minute(s)`,a>224||a<0||n>83||n<0?this.action={type:this.ActionTypes.CANCEL,length:0,text:"CANCEL"}:a>45&&a<204?this.action={type:this.ActionTypes.TIMEOUT,length:c,text:g}:a>=204&&a<=224?this.action={type:this.ActionTypes.BAN,length:0,text:"BAN"}:a>22&&a<=45?this.action={type:this.ActionTypes.TIMEOUT,length:1,text:"PURGE"}:a>0&&a<=22&&(this.action={type:this.ActionTypes.DELETE,length:0,text:"DELETE"});const m=t.querySelector(".text");m&&(m.innerText=this.action.text);const x=t.querySelector(".cursor");x&&(x.style.top=`${s}px`)}async handleClickOutside(e){const t=document.querySelector(`#${this.CUSTOM_TIMEOUT_ID}`);t&&(t.contains(e.target)||this.removeCustomTimeout())}async handleTimeoutClick(e){const t=document.querySelector(`#${this.CUSTOM_TIMEOUT_ID}`);if(!t||!t.matches(":hover")||!this.action||!this.messageData)return;let i,s;if(this.action.type===this.ActionTypes.BAN)i="/ban";else if(this.action.type===this.ActionTypes.TIMEOUT)i="/timeout",s=this.action.length;else if(this.action.type===this.ActionTypes.DELETE){if(this.messageData.messageDeleted){this.chat.addNotice(this.messageData.room,"Message is already deleted!");return}try{await this.twitch_data.deleteChatMessage(this.messageData.roomId,this.messageData.messageId)}catch(n){if(n instanceof $e)this.chat.addNotice(this.messageData.room,this.i18n.t(n.i18n_key,n.message,n.data));else throw n}}if(i){const n=e.shiftKey?this.setReason(this.action.type):"";this.chat.sendMessage(this.messageData.room,`${i} ${this.messageData.user}${s?` ${s}`:""}${n?` ${n}`:""}`)}this.removeCustomTimeout()}setReason(e){return prompt(`Enter ${e} reason: (leave blank for none)`)||""}openCustomTimeout(e){this.removeCustomTimeout();const t=document.querySelector(".chat-room__content");if(!t)return;const i=this.createCustomTimeout();document.body.appendChild(i);const s=e.getBoundingClientRect(),n=t.getBoundingClientRect(),a=i.getBoundingClientRect(),u=10;let c=s.top+e.offsetHeight/2-a.height/2,g=n.left-a.width+n.width-20;c=Math.max(u,Math.min(c,window.innerHeight-a.height-u)),g=Math.max(u,Math.min(g,window.innerWidth-a.width-u)),i.style.top=`${c}px`,i.style.left=`${g}px`,this.action={type:this.ActionTypes.CANCEL,length:0,text:"CANCEL"}}removeCustomTimeout(){const e=document.querySelector(`#${this.CUSTOM_TIMEOUT_ID}`);e&&(z(e,"mousemove",this.boundMouseMove),e.remove())}handleModerationAction(){this.settings.get("addon.trubbel.chat.moderation-bttv")?this.checkNavigation():this.cleanup()}};h(ce,"ChatModeration");let W=ce;const{createElement:Le}=FrankerFaceZ.utilities.dom,ue=class ue extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.inject("settings"),this.inject("site.router"),this.inject("site.fine"),this.STYLE_ID="trubbel-mod-vip-usernames",this.isEnabled=!1,this.settings.add("addon.trubbel.chat.viewer-card",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Chat >> Viewer Cards",title:"Enable Viewer Cards for /mods and /vips",description:`This gives you the ability to click on any usernames when using /mods and /vips which then opens up their viewer cards.

**Note:** Might not work for every language.`,component:"setting-check-box"},changed:()=>this.handleViewerCards()}),this.handleModListClick=t=>this.onHandleModListClick(t)}onEnable(){this.settings.getChanges("addon.trubbel.chat.viewer-card",()=>this.handleViewerCards()),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}init(){this.isEnabled||(document.addEventListener("click",this.handleModListClick),this.on("chat:buffer-message",this.onBufferMessage,this),this.injectStyles(),this.isEnabled=!0)}onBufferMessage(e){if(!this.settings.get("addon.trubbel.chat.viewer-card")||e?.message?.type!==this.chat?.chat_types.Info)return;const t=e?.message?.message,i=/:\s*(.+?)\./,s=t.match(i);s&&setTimeout(()=>this.processModList(t,s),50)}cleanup(){this.isEnabled&&(document.removeEventListener("click",this.handleModListClick),this.off("chat:buffer-message",this.onBufferMessage,this),this.removeStyles(),this.isEnabled=!1)}processModList(e,t){const i=this.findStatusMessage(e);if(!i||i.querySelector("ffz-username"))return;const s=t[1].split(",").map(a=>a.trim()).filter(a=>a.length>0);let n=e.substring(0,t.index+1);s.forEach((a,u)=>{u>0&&(n+=","),n+=` <ffz-username>${a}</ffz-username>`}),n+=".",i.innerHTML=n}findStatusMessage(e){const t=Array.from(document.querySelectorAll(".chat-line__status"));for(const i of t.reverse())if(i.textContent.trim()===e.trim())return i;return null}async onHandleModListClick(e){const i=e.target.closest(".chat-line__status");if(!i)return;const n=i.textContent.match(/:\s*(.+?)\./);if(!n)return;const a=n[1].split(",").map(g=>g.trim()).filter(g=>g.length>0),u=this.getClickedUsername(e,a);if(!u){this.log.info("No exact username match found for clicked text");return}const c=this.fine.wrap("chat-container");if(c?.first){const g=c.first;if(g.onUsernameClick){const m=i.getBoundingClientRect();g.onUsernameClick(u,null,null,m.top);return}}}getClickedUsername(e,t){let i;if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(e.clientX,e.clientY);else if(document.caretPositionFromPoint){const c=document.caretPositionFromPoint(e.clientX,e.clientY);c&&(i=document.createRange(),i.setStart(c.offsetNode,c.offset),i.setEnd(c.offsetNode,c.offset))}if(!i)return null;const s=i.startContainer,n=i.startOffset,a=s.textContent||"";let u=0;for(const c of t){const g=a.indexOf(c,u);if(g!==-1){const m=g+c.length;if(n>=g&&n<=m)return c;u=m}}return null}checkNavigation(){if(!this.settings.get("addon.trubbel.chat.viewer-card"))return;this.resolve("site").constructor.CHAT_ROUTES.includes(this.router?.current?.name)?this.init():this.cleanup()}injectStyles(){if(document.getElementById(this.STYLE_ID))return;const e=Le("style",{id:this.STYLE_ID,textContent:`
        ffz-username {
          cursor: pointer;
          display: inline;
          font-weight: bold;
        }
        ffz-username:hover {
          text-decoration: underline;
        }
      `});document.head.appendChild(e)}removeStyles(){const e=document.getElementById(this.STYLE_ID);e&&e.remove()}handleViewerCards(){this.settings.get("addon.trubbel.chat.viewer-card")?this.checkNavigation():this.cleanup()}};h(ue,"ChatViewerCard");let Y=ue;const He='[data-a-target="following-channels-tab"] [class*="ScTitle-sc-"]',Ie='.offline-recommendations-video-card:has([class*="offline-recommendations-video-card-border-"]) :is(.tw-aspect)',Pe=".offline-recommendations-video-card",ze=".timestamp-metadata__bar + p",qe=".whispers-threads-box__scrollable-area";var Ve=_(7517),je=_.n(Ve),Ge=_(6929),Z=_.n(Ge);async function Be(d){if(location.hostname==="clips.twitch.tv"||location.pathname.includes("/clip/")){const t=location.hostname==="clips.twitch.tv"?location.pathname.slice(1):location.pathname.split("/clip/")[1];if(t)return d.settings.get("addon.trubbel.clip-video.timestamps-clip")?{type:"clip",id:t}:void 0}const e=location.pathname.match(/\/videos\/(\d+)/);return e?d.settings.get("addon.trubbel.clip-video.timestamps-video")?{type:"video",id:e[1]}:void 0:null}h(Be,"getIdFromURL");async function We(d,e,t){try{const i=d.resolve("site.apollo");if(!i)return d.log.error("[Set Timestamp] Apollo client not resolved."),null;const s=e==="clip"?je():Z(),n=e==="clip"?{slug:t}:{id:t},a=await i.client.query({query:s,variables:n});return e==="clip"?a?.data?.clip?.createdAt:a?.data?.video?.createdAt}catch(i){return d.log.error(`[Set Timestamp] Error fetching ${e} data:`,i),null}}h(We,"fetchCreationDate");async function Ye(d,e){const t=await e.site.awaitElement(ze,document.documentElement,15e3);if(!t){e.log.error("[Set Timestamp] Timestamp element not found.");return}let i="";e.settings.get("addon.trubbel.clip-video.timestamps-relative")&&(i=`(${e.i18n.toRelativeTime(d)})`);const s=e.i18n.formatDateTime(d,e.settings.get("addon.trubbel.clip-video.timestamps-format"));t.textContent=`${s} ${i}`}h(Ye,"updateTimestamp");async function Ze(d){if(!["clip-page","user-clip","video"].includes(d.router.current_name))return;const t=await Be(d);if(!t||!d.settings.get("addon.trubbel.clip-video.timestamps-clip")&&t.type==="clip"||!d.settings.get("addon.trubbel.clip-video.timestamps-video")&&t.type==="video")return;const i=await We(d,t.type,t.id);i&&await Ye(i,d)}h(Ze,"setTimestamp");const{createElement:xe}=FrankerFaceZ.utilities.dom;let Q=null,q=!1;async function Qe(d){if(d.router.current?.name==="user"||d.router.current?.name==="mod-view"){if(!d.settings.get("addon.trubbel.clip-video.timestamps-most-recent"))return;const e=await d.site.awaitElement(Pe,document.documentElement,15e3);if(e){const t=await d.site.awaitElement(Ie,document.documentElement,15e3);if(t){t&&!document.querySelector(".most_recent_video-overlay")&&(Q=null,q=!1);const i=e?.getAttribute("href").split("/videos/")[1];if(!i)return;if(q){d.log.info("[Most Recent Video Timestamp] Skipping as processing is already in progress.");return}if(i===Q){d.log.info("[Most Recent Video Timestamp] Skipping as this video ID is already processed.");return}q=!0,Q=i;try{const s=d.resolve("site.apollo");if(!s)return d.log.error("[Most Recent Video Timestamp] Apollo client not resolved."),null;const a=(await s.client.query({query:Z(),variables:{id:i}}))?.data?.video?.createdAt;if(a){const u=xe("div",{class:"most_recent_video-overlay",style:"display: block;"}),c=xe("div",{class:"most_recent_video-timestamp",style:"padding: 0px 0.4rem; background: rgba(0, 0, 0, 0.6); color: #fff; font-size: 1.3rem; border-radius: 0.2rem; position: absolute; bottom: 0px; right: 0px; margin: 2px;"});let g="";d.settings.get("addon.trubbel.clip-video.timestamps-relative")&&(g=`(${d.i18n.toRelativeTime(a)})`);const m=d.i18n.formatDateTime(a,d.settings.get("addon.trubbel.clip-video.timestamps-format"));c.textContent=`${m} ${g}`,u.appendChild(c),t.appendChild(u)}}catch(s){d.log.error("[Most Recent Video Timestamp] Error applying video timestamp:",s)}finally{q=!1}}else d.log.warn("[Most Recent Video Timestamp] container not found.")}else d.log.warn("[Most Recent Video Timestamp] element not found.")}}h(Qe,"applyMostRecentVideoTimestamp");const{createElement:K}=FrankerFaceZ.utilities.dom;function V(d="",e,t=6e3){const i=K("div",{className:"dynamic-notification",style:`
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    z-index: 9999;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  `}),s=document.getElementsByClassName("dynamic-notification");if(s.length>0){const a=s.length*50;i.style.bottom=`${20+a}px`}if(d){const a=K("div",{textContent:d,style:"font-size: 16px;"});i.appendChild(a)}const n=K("span",{textContent:e,style:"font-size: 16px;"});i.appendChild(n),document.body.appendChild(i),requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)"}),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(20px)",setTimeout(()=>{i.remove();const a=document.getElementsByClassName("dynamic-notification");Array.from(a).forEach((u,c)=>{u.style.bottom=`${20+c*50}px`})},300)},t)}h(V,"showNotification");const he=class he extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("site.fine"),this.inject("site.player"),this.inject("site.router"),this.settings.add("addon.trubbel.clip-video.timestamps-clip",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> Timestamps",title:"Enable Custom Timestamps for Clips",description:"Show the full timestamp when a clip was created.",component:"setting-check-box"},changed:()=>this.getClipOrVideo()}),this.settings.add("addon.trubbel.clip-video.timestamps-video",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> Timestamps",title:"Enable Custom Timestamps for Videos",description:"Show the full timestamp when a video was created.",component:"setting-check-box"},changed:()=>this.getClipOrVideo()}),this.settings.add("addon.trubbel.clip-video.timestamps-most-recent",{default:!1,ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> Timestamps",title:"Enable Timestamps for Most Recent Videos",description:"Show timestamps on most recent videos when a stream is offline.",component:"setting-check-box"},changed:()=>this.getMostRecentVideo()}),this.settings.add("addon.trubbel.clip-video.timestamps-format",{default:"medium",ui:{sort:3,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> Timestamps",title:"Timestamp Format",description:"The default combined timestamp format. Custom time formats are formatted using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"datetime",component:"format-preview"},data:()=>{const t=[],i=new Date;for(const[s,n]of Object.entries(this.i18n._.formats.datetime))t.push({value:s,title:`${this.i18n.formatDateTime(i,s)} (${s})`});return t}},changed:t=>{this.i18n._.defaultDateTimeFormat=t,this.emit(":update"),this.getClipOrVideo()}}),this.settings.add("addon.trubbel.clip-video.timestamps-relative",{default:!1,ui:{sort:4,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> Timestamps",title:"Enable Relative Timestamp",description:"Include relative timestamp, such as `(2 days ago)`, `(2 months ago)`, `(2 years ago)` at the end.",component:"setting-check-box"},changed:()=>this.getClipOrVideo()}),this.settings.add("addon.trubbel.vods.skip-segments",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> VODs",title:"Enable Auto-Skip Muted Segments",description:`Automatically detects and skips muted segments.

Once you reach the start of a muted segment, this will automatically skip to the end of that muted segment.`,component:"setting-check-box"},changed:()=>this.getMutedSegments()}),this.settings.add("addon.trubbel.vods.skip-segments-notify",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Clips and Videos >> VODs",title:"Enable Auto-Skip Notifications",description:"Show a notification bottom left when a muted segment is skipped.",component:"setting-check-box"}}),this.currentVideoId=null,this.isProcessing=!1,this.pendingFetch=null}onEnable(){this.settings.getChanges("addon.trubbel.vods.skip-segments",()=>this.getMutedSegments()),this.router.on(":route",this.checkNavigation,this),this.checkNavigation(),this.settings.getChanges("addon.trubbel.vods.skip-segments",()=>this.getMostRecentVideo()),this.router.on(":route",(e,t)=>{(e?.name==="clip-page"||e?.name==="user-clip"||e?.name==="video")&&this.getClipOrVideo(),(e?.name==="mod-view"||e?.name==="user")&&this.getMostRecentVideo()})}checkNavigation(){(this.router?.old_name==="video"||this.router?.old_name==="user-home"||this.router?.old_name==="user-videos")&&this.router.current?.name!=="video"&&this.router.current?.name!=="user-home"&&this.router.current?.name!=="user-videos"&&this.cleanupEventListeners(),(this.router.current?.name==="video"||this.router.current?.name==="user-home"||this.router.current?.name==="user-videos")&&this.getMutedSegments()}getClipOrVideo(){Ze(this)}getMostRecentVideo(){this.settings.get("addon.trubbel.clip-video.timestamps-most-recent")?Qe(this):document.querySelector(".most_recent_video-overlay")?.remove()}cleanupEventListeners(){const e=document.querySelector('[data-a-target="video-player"] video');e&&e._mutedSegmentsHandler&&(e.removeEventListener("timeupdate",e._mutedSegmentsHandler),delete e._mutedSegmentsHandler),this.currentVideoId=null,this.isProcessing=!1,this.pendingFetch=null}async waitForVideo(){try{const e=await this.site.awaitElement('[data-a-target="video-player"] video',document.documentElement,15e3);try{const i=await this.site.awaitElement(".seekbar-bar",document.documentElement,15e3),s=Array.from(i.querySelectorAll('[data-test-selector="seekbar-segment__segment"]'));if(this.log.info("[Muted Segments] Found seekbar segments:",s.length),!s.some(a=>window.getComputedStyle(a).backgroundColor==="rgba(212, 73, 73, 0.5)"))return this.log.info("[Muted Segments] No muted segments found in seekbar, stopping process"),!1;this.log.info("[Muted Segments] Found muted segments in seekbar, continuing with processing")}catch(i){return this.log.info("[Muted Segments] Error checking seekbar:",i),!1}const t=this?.site?.children?.player?.PlayerSource?.first?.props?.content?.vodID;return t?{video:e,videoId:t}:!1}catch(e){return this.log.error("[Muted Segments] Error waiting for video:",e),!1}}async getMutedSegments(){if(this.settings.get("addon.trubbel.vods.skip-segments")){this.cleanupEventListeners();const t=await this.waitForVideo();if(t===!1){this.log.info("[Muted Segments] Stopping process - no muted segments found or error occurred");return}const{video:i,videoId:s}=t;if(!s||!i)return;const n=await this.fetchMutedSegments(s);if(n){const a=this.processMutedSegments(n);await this.setupVideoTimeHandler(i,a)}}else{this.cleanupEventListeners();return}}async fetchMutedSegments(e){return this.pendingFetch&&this.currentVideoId===e?this.pendingFetch:e===this.currentVideoId||this.isProcessing?null:(this.isProcessing=!0,this.pendingFetch=new Promise(async t=>{try{const i=this.resolve("site.apollo");if(!i){t(null);return}const n=(await i.client.query({query:Z(),variables:{id:e}})).data?.video?.muteInfo?.mutedSegmentConnection?.nodes;n?.length?(this.log.info("[Muted Segments] Found segments:",n.length),this.currentVideoId=e,t(n)):(this.log.info("[Muted Segments] No muted segments found for this video"),t(null))}catch(i){this.log.error("[Muted Segments] Error fetching segments:",i),t(null)}finally{this.isProcessing=!1}}),this.pendingFetch)}processMutedSegments(e){if(!e)return[];const t=[...e].sort((n,a)=>n.offset-a.offset),i=[];let s={...t[0]};for(let n=1;n<t.length;n++){const a=t[n];a.offset<=s.offset+s.duration+1?s.duration=Math.max(s.duration,a.offset+a.duration-s.offset):(i.push(s),s={...a})}return i.push(s),this.log.info("[Muted Segments] processMutedSegments() combined:",i),i}async setupVideoTimeHandler(e,t){if(!e)return;const i=h(()=>{const s=e.currentTime;for(const n of t)if(!e.paused&&s>=n.offset&&s<n.offset+n.duration){if(e.currentTime=n.offset+n.duration,this.log.info(`[Muted Segments] Skipped segment: ${n.offset} -> ${n.offset+n.duration}`),this.settings.get("addon.trubbel.vods.skip-segments-notify")){const a=E(n.offset),u=E(n.offset+n.duration);V("\u{1F507}",`Skipped muted segment: ${a} \u2192 ${u}`)}break}},"timeUpdateHandler");e._mutedSegmentsHandler&&e.removeEventListener("timeupdate",e._mutedSegmentsHandler),e.addEventListener("timeupdate",i),e._mutedSegmentsHandler=i}};h(he,"ClipsVideos");let X=he;var Ke=_(906),Xe=_.n(Ke);const{createElement:Ee,ManagedStyle:Je}=FrankerFaceZ.utilities.dom,pe=class pe extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.style=new Je,this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.elemental"),this.settings.add("addon.trubbel.directory.show-followage",{default:!1,requires:["context.route.name"],process(t,i){return t.get("context.route.name")==="dir-following"?i:!1},ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Directory >> Following",title:"Show Channel Follow Date",description:"This will display the date you followed a channel in [Followed channels](https://www.twitch.tv/directory/following/channels).",component:"setting-check-box"},changed:()=>{this.updateFollowingCards(),this.updateCSS()}}),this.settings.add("addon.trubbel.directory.total-followed-channels",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Directory >> Following",title:"Show Total Followed Channels",description:"This displays the total number of channels you're following. Which is visible in the [following](https://twitch.tv/directory/following)-pages.",component:"setting-check-box"}}),this.settings.add("addon.trubbel.directory.previews",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Directory >> Thumbnails",title:"Enable Video Previews in Directory",description:"Displays a video preview when hovering over channel thumbnails in directories.\n\n**Note:** For this to work properly, make sure your browser has granted **Autoplay** and **Sound** permissions for `player.twitch.tv`.",component:"setting-check-box"},changed:()=>this.handlePreviews()}),this.settings.add("addon.trubbel.directory.preview-quality",{default:"160p30",requires:["addon.trubbel.directory.previews"],process(t,i){return t.get("addon.trubbel.directory.previews")?i:!1},ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Directory >> Thumbnails",title:"Video Previews Quality",description:"Change the quality for the previews to be shown in.",component:"setting-select-box",data:[{title:"Auto",value:"auto"},{title:"Source",value:"chunked"},{title:"1080p60",value:"1080p60"},{title:"720p60",value:"720p60"},{title:"720p",value:"720p30"},{title:"480p",value:"480p30"},{title:"360p",value:"360p30"},{title:"160p",value:"160p30"}]},changed:()=>this.handlePreviews()}),this.settings.add("addon.trubbel.directory.preview-audio",{default:!1,requires:["addon.trubbel.directory.previews"],process(t,i){return t.get("addon.trubbel.directory.previews")?i:!1},ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > Directory >> Thumbnails",title:"Enable Audio for Previews",description:"Please keep in mind that this is using your default volume for streams. Some streams may be loud.",component:"setting-check-box"},changed:()=>this.handlePreviews()}),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.FollowingCard=this.elemental.define("following-card",".channel-follow-listing--card",["dir-following"],null,0,0)}onEnable(){this.settings.getChanges("addon.trubbel.directory.previews",()=>this.handlePreviews()),this.router.on(":route",this.checkNavigation,this),this.FollowingCard.on("mount",this.updateFollowingCard,this),this.FollowingCard.on("mutate",this.updateFollowingCard,this),this.FollowingCard.each(e=>this.updateFollowingCard(e)),this.updateCSS()}checkNavigation(){const e=this.router?.match?.[0],t=this.router?.old_match?.[0],i=e?.startsWith("/directory/")??!1,s=t?.startsWith("/directory/")??!1;(i||s)&&(s&&!i&&(this.log.info("[Directory Previews] Leaving directory page, cleaning up event listeners"),this.cleanupEventListeners()),i&&this.settings.get("addon.trubbel.directory.previews")&&(this.log.info("[Directory Previews] Entering directory page, setting up event listeners"),this.setupEventListeners())),this.router?.current?.name==="dir-following"&&this.settings.get("addon.trubbel.directory.total-followed-channels")&&this.showTotalFollowedChannels()}async showTotalFollowedChannels(){const e=await this.site.awaitElement(He,document.documentElement,5e3);if(e)if(e.textContent.includes("("))this.log.info("[Show Total Followed Channels] follow count already set");else{const t=this.resolve("site.apollo");if(!t)return null;const s=(await t.client.query({query:Xe(),variables:{}}))?.data?.currentUser?.follows?.totalCount;if(s){const n=this.i18n.formatNumber(s);e.textContent+=` (${n})`}}else this.log.warn("[Show Total Followed Channels] unable to find element:",e)}getVideoPreviewURL(e){const t=this.settings.get("addon.trubbel.directory.preview-quality"),i=!this.settings.get("addon.trubbel.directory.preview-audio");return`https://player.twitch.tv/?${new URLSearchParams({channel:e,enableExtensions:!1,parent:"twitch.tv",player:"popout",quality:t,muted:i,controls:!1,disable_frankerfacez:!0})}`}createVideoPreview(e,t){try{const i=Ee("iframe",{src:this.getVideoPreviewURL(t),style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",border:"none",pointerEvents:"none",backgroundColor:"transparent"}});return e.appendChild(i),i}catch(i){return this.log.error("[Directory Previews] Error creating preview:",i),null}}handleMouseEnter(e){if(!this.settings.get("addon.trubbel.directory.previews")||!e.target||typeof e.target.closest!="function"||e.target.closest(".blurred-preview-card-image"))return;const t=e.target.closest('[data-a-target="preview-card-image-link"]');if(!t)return;const i=t.getAttribute("href");if(!/^\/(?!videos\/\d+$)[^/]+$/.test(i))return;const s=i.substring(1),n=t.querySelector(".tw-aspect");n&&!n.querySelector("iframe")&&this.createVideoPreview(n,s)&&(n.dataset.previewActive="true")}handleMouseLeave(e){if(!e.target||typeof e.target.closest!="function")return;const t=e.target.closest('[data-a-target="preview-card-image-link"]');if(!t||t.contains(e.relatedTarget))return;const i=t.querySelector(".tw-aspect");if(i&&i.dataset.previewActive==="true"){const s=i.querySelector("iframe");s&&(s.remove(),delete i.dataset.previewActive)}}setupEventListeners(){document.addEventListener("mouseenter",this.handleMouseEnter,!0),document.addEventListener("mouseleave",this.handleMouseLeave,!0)}cleanupEventListeners(){document.removeEventListener("mouseenter",this.handleMouseEnter,!0),document.removeEventListener("mouseleave",this.handleMouseLeave,!0)}handlePreviews(){this.settings.get("addon.trubbel.directory.previews")?this.checkNavigation():this.cleanupEventListeners()}updateFollowingCards(){this.FollowingCard.each(e=>this.updateFollowingCard(e)),this.emit(":update-cards")}updateFollowingCard(e){const t=this.fine.searchParentNode(e,s=>s.memoizedProps?.children?.props?.userData?.user);if(!t)return;const i=t.memoizedProps;return this._updateFollowingCard(e,i,i.children.props.trackingProps)}_updateFollowingCard(e,t,i){try{if(!this.settings.get("addon.trubbel.directory.show-followage")){this.clearFollowageDate(e);return}const n=t.children.props.userData?.user;if(!n)return;const a=n.self?.follower?.followedAt;if(!a)return;const u=this.formatDate(a),c=e.querySelector(".user-card p[title]");if(!c)return;e._channel_followage=Ee("div",{className:"channel-followage-date",title:this.i18n.formatDateTime(a,"full")},"Followed ",u),c.parentNode.insertBefore(e._channel_followage,c.nextSibling),n.id&&e.setAttribute("data-room-id",n.id),n.login&&e.setAttribute("data-room",n.login),e.setAttribute("data-followed-at",a)}catch(s){this.log.error("[Show Channel Follow Date] Error in _updateFollowingCard:",s)}}clearFollowageDate(e){e._channel_followage&&(e._channel_followage.remove(),e._channel_followage=null)}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):""}updateCSS(){this.settings.get("addon.trubbel.directory.show-followage")?this.style.set("followage-date",`
        .channel-followage-date {
          text-overflow: ellipsis;
          white-space: nowrap;
          overflow: hidden;
          color: white;
          font-size: 1.3rem;
          line-height: 1.5;
        }
      `):this.style.delete("followage-date")}};h(pe,"Directory");let J=pe;const ee="ffzCollapsibleDrops",j="ffzWhisperDropDownHeight",{createElement:et}=FrankerFaceZ.utilities.dom,me=class me extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.BUTTON_CLASS="drops-collapse-button",this.hasInitialized=!1,this.settings.add("addon.trubbel.drops-rewards.collapsible",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Drops & Rewards >> Inventory",title:"Enable Collapsible Inventory Drops",description:"Allows you to toggle the visibility of Drops, helping you keep the Drops page clean and clutter-free.",component:"setting-check-box"},changed:()=>this.handleCollapsibleDrops()}),this.init=this.init.bind(this)}onEnable(){this.settings.getChanges("addon.trubbel.drops-rewards.collapsible",()=>this.handleCollapsibleDrops()),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}loadCollapsedState(){try{const e=this.settings.provider.get(ee);return e?JSON.parse(e):{}}catch(e){return this.log.error("[Collapsible Drops] Error loading collapsed state:",e),{}}}saveCollapsedState(e){try{this.settings.provider.set(ee,JSON.stringify(e))}catch(t){this.log.error("[Collapsible Drops] Error saving collapsed state:",t)}}cleanupStorage(){const e=document.querySelectorAll(".inventory-campaign-info .tw-link");if(e.length===0)return;const t=this.loadCollapsedState(),i=new Set(Array.from(e).map(n=>n.textContent));let s=!1;Object.keys(t).forEach(n=>{i.has(n)||(delete t[n],s=!0)}),s&&this.saveCollapsedState(t)}createCollapseButton(){const e=et("div",{class:this.BUTTON_CLASS,style:`
        background: none;
        border: none;
        color: var(--color-text-alt-2);
        cursor: pointer;
        padding: 4px 8px;
        margin-left: 8px;
        border-radius: 4px;
        font-size: 14px;
      `});return e.onmouseover=()=>e.style.backgroundColor="var(--color-background-button-text-hover)",e.onmouseout=()=>e.style.backgroundColor="transparent",e}makeCollapsible(e){if(e.dataset.collapsibleProcessed)return;e.dataset.collapsibleProcessed="true";const t=e.querySelector(".tw-link");if(!t)return;const i=t.textContent,s=e.parentElement;s.style.position="relative";const n=27,a=this.createCollapseButton(),u=this.loadCollapsedState();a.style.position="absolute",a.style.top="-1px",a.style.right="0px";const c=u[i]||!1;a.textContent=c?`\u25BC Show: ${i}`:"\u25B2 Hide",c&&(s.style.height=`${n}px`,s.style.overflow="hidden",s.style.marginBottom="10px"),a.onclick=g=>{g.stopPropagation();const m=a.textContent.includes("Hide");m?(s.style.height=`${n}px`,s.style.overflow="hidden",s.style.marginBottom="10px",a.textContent=`\u25BC Show: ${i}`):(s.style.height="",s.style.overflow="",s.style.marginBottom="",a.textContent="\u25B2 Hide");const x=this.loadCollapsedState();x[i]=m,this.saveCollapsedState(x)},s.appendChild(a)}async waitForElements(){let e,t;return new Promise((i,s)=>{e=setTimeout(()=>{cancelAnimationFrame(t),s()},1e4);const n=h(()=>{const a=document.querySelectorAll(".inventory-campaign-info");a.length>0?(clearTimeout(e),i(a)):t=requestAnimationFrame(n)},"checkElements");t=requestAnimationFrame(n)})}checkNavigation(){const e=this.router?.location,t=this.router?.old_location,i=e==="/drops/inventory"||e==="/inventory",s=t==="/drops/inventory"||t==="/inventory";(i||s)&&(s&&!i&&(this.log.info("[Collapsible Drops] Leaving inventory page"),this.hasInitialized=!1),i&&this.settings.get("addon.trubbel.drops-rewards.collapsible")&&(this.log.info("[Collapsible Drops] Entering inventory page"),this.init()))}async init(){const e=this.router?.location;if(!(e!=="/drops/inventory"&&e!=="/inventory")&&!this.hasInitialized)try{const t=await this.waitForElements();this.cleanupStorage(),t.forEach(i=>this.makeCollapsible(i)),this.hasInitialized=!0}catch{this.log.error("[Collapsible Drops] Failed to find inventory elements"),this.hasInitialized=!1}}handleCollapsibleDrops(){this.settings.get("addon.trubbel.drops-rewards.collapsible")?this.init():(this.settings.provider.delete(ee),this.hasInitialized=!1)}};h(me,"DropsRewards");let te=me;const _e=["1000","2000","3000","4000","5000"],Me={1e3:"The video download was cancelled. Please try again.",2e3:"There was a network error. Please try again.",3e3:"Your browser encountered an error while decoding the video.",5e3:"This video is unavailable."},{on:tt}=FrankerFaceZ.utilities.dom,ge=class ge{constructor(e,t){this.maxAttempts=e,this.timeWindowMs=t,this.attempts=[]}canAttempt(){const e=Date.now();return this.attempts=this.attempts.filter(t=>e-t<this.timeWindowMs),this.attempts.length<this.maxAttempts}addAttempt(){this.attempts.push(Date.now())}reset(){this.attempts=[]}};h(ge,"RateLimiter");let ie=ge;const be=class be extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.player"),this.rateLimiter=new ie(3,5*60*1e3),this.settings.add("addon.trubbel.player.player-errors",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Player >> Player Errors",title:"Enable Auto Reset on Player Errors",description:"Automatically detects and resets the player when encountering errors like `#1000`, `#2000`, `#3000`, `#4000` or `#5000`.\n\n**Note:** This will only reset the player three times within five minutes, should you keep getting errors, it's likely something you have to fix yourself.",component:"setting-check-box"}}),this.PlayerSource=this.fine.define("player-source",t=>t.props&&t.props?.playerEvents&&t.props?.mediaPlayerInstance)}onEnable(){this.PlayerSource.ready((e,t)=>{for(const i of t){const s=i.props?.playerEvents;if(s){if(!this.settings.get("addon.trubbel.player.player-errors"))return;tt(s,"PlayerError",h(async()=>{if(!this.rateLimiter.canAttempt()){this.log.warn("[Auto Player Reset] Rate limit exceeded. Please wait before trying again."),V("","[Auto Player Reset] Too many reset attempts. Please try refreshing the page manually.",15e3);return}if(!i?.props?.userTriggeredPause){const a=i?.props?.mediaPlayerInstance,u=a?.core?.state?.state;if(a?.isPaused()&&u==="Idle"&&!(a?.core?.mediaSinkManager?.video).getAttribute("src")){const g=await this.site.awaitElement(".content-overlay-gate");if(g&&_e.some(x=>g.textContent.includes(x))){const x=_e.find(N=>g.textContent.includes(N));this.rateLimiter.addAttempt(),this.site.children.player.resetPlayer(this.site.children.player.current),this.log.info(`[Auto Player Reset] ${Me[x]} (Error #${x})`),V("",`[Auto Player Reset] ${Me[x]} (Error #${x})`,15e3)}}}},"playerErrorHandler"))}}})}};h(be,"Player");let se=be;const{ManagedStyle:it}=FrankerFaceZ.utilities.dom,{has:st}=FrankerFaceZ.utilities.object,Ae={"hide-stream-chat-header":".stream-chat-header,.toggle-visibility__right-column--expanded","hide-side-nav-for-you":'.side-nav--expanded [aria-label] :is(.side-nav__title):has(h2[class*="tw-title"]:first-child)',"hide-side-nav-sort-paragraph":'[data-a-target="side-nav-header-expanded"] p',"hide-side-nav-guest-avatar":".side-nav-card :is(.guest-star-avatar__mini-avatar)","hide-side-nav-guest-number":'.side-nav-card [data-a-target="side-nav-card-metadata"] :is(p):nth-child(2)',"hide-side-nav-hype-train":".side-nav-card-hype-train-bottom","hide-player-live-badge":".video-player .top-bar .tw-channel-status-text-indicator","hide-stream-monthly-recap":'div:first-child article:has(a[href^="/recaps/"])',"hide-stream-sponsored-content-chat-banner":".stream-chat div :is(.channel-skins-banner__interactive)","hide-stream-sponsored-content-within-player":".video-player :is(.channel-skins-overlay__background)","hide-stream-sponsored-content-below-player":".channel-info-content div[style]:has(.channel-skins-ribbon__container)","hide-vod-muted-segment-popup":".video-player .muted-segments-alert__scroll-wrapper"},fe=class fe extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.style=new it,this.inject("settings"),this.inject("site.router"),this.settings.add("addon.trubbel.remove-things.chat-stream-chat-header",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Chat",title:"Remove Stream Chat Header",description:"**Note:** This also hides the collapse and viewer list buttons.",component:"setting-check-box"},changed:t=>this.toggleHide("hide-stream-chat-header",t)}),this.settings.add("addon.trubbel.remove-things.left-nav-for-you",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Left Navigation",title:'Remove the "For You"-text',component:"setting-check-box"},changed:t=>this.toggleHide("hide-side-nav-for-you",t)}),this.settings.add("addon.trubbel.remove-things.left-nav-sort-paragraph",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Left Navigation",title:'Remove the "Viewers (High to Low)"-text',component:"setting-check-box"},changed:t=>this.toggleHide("hide-side-nav-sort-paragraph",t)}),this.settings.add("addon.trubbel.remove-things.left-nav-guest-avatar",{default:!1,ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Left Navigation",title:"Remove the Guest avatars",component:"setting-check-box"},changed:t=>this.toggleHide("hide-side-nav-guest-avatar",t)}),this.settings.add("addon.trubbel.remove-things.left-nav-guest-number",{default:!1,ui:{sort:3,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Left Navigation",title:"Remove the Guest +number text",component:"setting-check-box"},changed:t=>this.toggleHide("hide-side-nav-guest-number",t)}),this.settings.add("addon.trubbel.remove-things.left-nav-hype-train",{default:!1,ui:{sort:4,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Left Navigation",title:"Remove Hype Train",component:"setting-check-box"},changed:t=>this.toggleHide("hide-side-nav-hype-train",t)}),this.settings.add("addon.trubbel.remove-things.player-gradient",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Player",title:"Remove the Gradient from Player",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.remove-things.player-live",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Player",title:'Remove the "LIVE"-badge from Player',component:"setting-check-box"},changed:t=>this.toggleHide("hide-player-live-badge",t)}),this.settings.add("addon.trubbel.remove-things.stories",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stories",title:"Remove Stories",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.remove-things.stream-about-panels",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stream",title:"Remove About Section and Panels",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.remove-things.stream-monthly-recap",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stream",title:"Remove Monthly Recap below Streams",component:"setting-check-box"},changed:t=>this.toggleHide("hide-stream-monthly-recap",t)}),this.settings.add("addon.trubbel.remove-things.stream-power-ups",{default:!1,ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stream",title:"Remove Power-ups within the Rewards popup",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.remove-things.stream-sponsored-content-chat-banner",{default:!1,ui:{sort:3,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stream",title:"Remove Sponsored content above stream chat",component:"setting-check-box"},changed:t=>this.toggleHide("hide-stream-sponsored-content-chat-banner",t)}),this.settings.add("addon.trubbel.remove-things.stream-sponsored-content-within-player",{default:!1,ui:{sort:4,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stream",title:"Remove Sponsored content within the Player",component:"setting-check-box"},changed:t=>this.toggleHide("hide-stream-sponsored-content-within-player",t)}),this.settings.add("addon.trubbel.remove-things.stream-sponsored-content-below-player",{default:!1,ui:{sort:5,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> Stream",title:"Remove Sponsored content below the Player",component:"setting-check-box"},changed:t=>this.toggleHide("hide-stream-sponsored-content-below-player",t)}),this.settings.add("addon.trubbel.remove-things.vod-muted-segment-popup",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Remove/Hide Things >> VODs",title:"Remove Muted Segments Alerts popups",component:"setting-check-box"},changed:t=>this.toggleHide("hide-vod-muted-segment-popup",t)})}onEnable(){this.toggleHide("hide-stream-chat-header",this.settings.get("addon.trubbel.remove-things.chat-stream-chat-header")),this.toggleHide("hide-side-nav-for-you",this.settings.get("addon.trubbel.remove-things.left-nav-for-you")),this.toggleHide("hide-side-nav-sort-paragraph",this.settings.get("addon.trubbel.remove-things.left-nav-sort-paragraph")),this.toggleHide("hide-side-nav-guest-avatar",this.settings.get("addon.trubbel.remove-things.left-nav-guest-avatar")),this.toggleHide("hide-side-nav-guest-number",this.settings.get("addon.trubbel.remove-things.left-nav-guest-number")),this.toggleHide("hide-side-nav-hype-train",this.settings.get("addon.trubbel.remove-things.left-nav-hype-train")),this.toggleHide("hide-player-live-badge",this.settings.get("addon.trubbel.remove-things.player-live")),this.toggleHide("hide-stream-monthly-recap",this.settings.get("addon.trubbel.remove-things.stream-monthly-recap")),this.toggleHide("hide-stream-sponsored-content-chat-banner",this.settings.get("addon.trubbel.remove-things.stream-sponsored-content-chat-banner")),this.toggleHide("hide-stream-sponsored-content-within-player",this.settings.get("addon.trubbel.remove-things.stream-sponsored-content-within-player")),this.toggleHide("hide-stream-sponsored-content-below-player",this.settings.get("addon.trubbel.remove-things.stream-sponsored-content-below-player")),this.toggleHide("hide-vod-muted-segment-popup",this.settings.get("addon.trubbel.remove-things.vod-muted-segment-popup")),this.updateCSS()}toggleHide(e,t){const i=`hide--${e}`;if(!t){this.style.delete(i);return}if(!st(Ae,e))throw new Error(`cannot find class for "${e}"`);this.style.set(i,`${Ae[e]} { display: none !important }`)}updateCSS(){this.settings.get("addon.trubbel.remove-things.player-gradient")?this.style.set("hide-player-gradient",".video-player .top-bar, .video-player .player-controls { background: transparent !important; }"):this.style.delete("hide-player-gradient"),this.settings.get("addon.trubbel.remove-things.stream-about-panels")?(this.style.set("hide-stream-about-panels1",'[id="live-channel-about-panel"], .channel-panels { display: none !important; }'),this.style.set("hide-stream-about-panels2",'.channel-info-content:not(:has(.timestamp-metadata__bar)) :is(div[style^="min-height:"]) { min-height: 0px !important; }'),this.style.set("hide-stream-about-panels3",".channel-info-content:not(:has(.timestamp-metadata__bar)) :is(.tw-tower:has(.tw-placeholder-wrapper)) { display: none !important; }")):(this.style.delete("hide-stream-about-panels1"),this.style.delete("hide-stream-about-panels2"),this.style.delete("hide-stream-about-panels3")),this.settings.get("addon.trubbel.remove-things.stream-power-ups")?(this.style.set("hide-stream-power-ups1",'.rewards-list :is([class*="bitsRewardListItem--"]) { display: none !important; }'),this.style.set("hide-stream-power-ups2",".rewards-list > div:first-child:has(.tw-title:only-child) { display: none !important; }"),this.style.set("hide-stream-power-ups3",".rewards-list > :is(div:has(> div > .tw-title)) { padding: 0rem 0.5rem 1rem !important; }")):(this.style.delete("hide-stream-power-ups1"),this.style.delete("hide-stream-power-ups2"),this.style.delete("hide-stream-power-ups3")),this.settings.get("addon.trubbel.remove-things.stories")?(this.style.set("hide-stories-left-nav-expanded",'#side-nav [class*="storiesLeftNavSection--"] { display: none !important; }'),this.style.set("hide-stories-left-nav-collapsed",'#side-nav :is([style]) :has([class*="storiesLeftNavSectionCollapsedButton--"]) { display: none !important; }'),this.style.set("hide-stories-following-page",'div[class^="Layout-sc-"]:has(> [data-simplebar="init"] > .simplebar-scroll-content > .simplebar-content[style] h2.sr-only) { display: none !important; }')):(this.style.delete("hide-stories-left-nav-expanded"),this.style.delete("hide-stories-left-nav-collapsed"),this.style.delete("hide-stories-following-page"))}};h(fe,"RemoveThings");let ne=fe;const{createElement:A,ManagedStyle:nt}=FrankerFaceZ.utilities.dom,ve=class ve extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.style=new nt,this.inject("settings"),this.inject("site.fine"),this.inject("site.elemental"),this.updateSidebar=this.updateSidebar.bind(this),this.showPreview=this.showPreview.bind(this),this.hidePreview=this.hidePreview.bind(this),this.isSidebarOnRight=this.isSidebarOnRight.bind(this),this.previewContainer=null,this.previewIframe=null,this.previewTitleContainer=null,this.currentHoverCard=null,this.hoverTimeout=null,this.settings.add("addon.trubbel.sidebar.left-nav-preview",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Enable Stream Previews",description:"Show previews when hovering over channels in the sidebar.\n\n**Note:** For this to work properly, make sure your browser has granted **Autoplay** and **Sound** permissions for `player.twitch.tv`.",component:"setting-check-box"},changed:t=>{this.log.info("[Sidebar Preview] Stream Previews setting changed:",t),t||this.hidePreview()}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.delay",{default:500,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Stream Preview Delay",description:"How long to hover before showing the preview (in milliseconds). Use `0` for no delay.",component:"setting-text-box",process(t){const i=t.toString().replace(/[^\d]/g,""),s=parseInt(i,10);return isNaN(s)||s<0||s>5e3?500:s}}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.size",{default:"small",ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Stream Preview Size",description:"Choose the size of the channel preview.",component:"setting-select-box",data:[{value:"small",title:"Small (280x158)"},{value:"medium",title:"Medium (320x180)"},{value:"large",title:"Large (400x225)"},{value:"xlarge",title:"Extra Large (480x270)"}]},changed:t=>{this.log.info("[Sidebar Preview] Stream Preview Size setting changed:",t),this.updatePreviewSize()}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.audio",{default:!1,ui:{sort:3,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Enable Audio for Stream Previews",description:"Please keep in mind that this is using your default volume for streams. Some streams may be loud.",component:"setting-check-box"}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.quality",{default:"160p30",requires:["addon.trubbel.sidebar.left-nav-preview"],process(t,i){return t.get("addon.trubbel.sidebar.left-nav-preview")?i:!1},ui:{sort:4,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Stream Preview Quality",component:"setting-select-box",data:[{title:"Auto",value:"auto"},{title:"Source",value:"chunked"},{title:"1080p60",value:"1080p60"},{title:"720p60",value:"720p60"},{title:"720p",value:"720p30"},{title:"480p",value:"480p30"},{title:"360p",value:"360p30"},{title:"160p",value:"160p30"}]}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.show-title",{default:!1,ui:{sort:5,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Show Stream Title",component:"setting-check-box"},changed:t=>{this.log.info("[Sidebar Preview] Show Stream Title setting changed:",t),this.previewContainer&&this.previewTitleContainer&&(this.previewTitleContainer.style.display=t?"block":"none")}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.show-category",{default:!1,ui:{sort:6,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Show Stream Category",component:"setting-check-box"},changed:t=>{this.log.info("[Sidebar Preview] Show Stream Category setting changed:",t),this.previewContainer&&this.previewCategoryContainer&&(this.previewCategoryContainer.style.display=t?"block":"none")}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.show-viewers",{default:!1,ui:{sort:7,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Show Viewer Count",component:"setting-check-box"},changed:t=>{this.log.info("[Sidebar Preview] Show Viewer Count setting changed:",t),this.previewContainer&&this.previewViewerContainer&&(this.previewViewerContainer.style.display=t?"block":"none")}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.show-hypetrain",{default:!1,ui:{sort:8,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Show Hype Train",component:"setting-check-box"},changed:t=>{this.log.info("[Sidebar Preview] Show Hype Train setting changed:",t),this.previewContainer&&this.previewHypeTrainContainer&&(this.previewHypeTrainContainer.style.display=t?"block":"none")}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.show-guests",{default:!1,ui:{sort:9,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Show Stream Guests",component:"setting-check-box"},changed:t=>{this.log.info("[Sidebar Preview] Show Stream Guests setting changed:",t),this.previewContainer&&this.previewGuestsContainer&&(this.previewGuestsContainer.style.display=t?"block":"none")}}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.tooltip-background",{default:"#1f1f23",ui:{sort:10,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Tooltip Background",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.tooltip-text1",{default:"#dedee3",ui:{sort:11,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Tooltip Title",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.tooltip-text2",{default:"#adadb8",ui:{sort:12,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Tooltip Category",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.tooltip-text3",{default:"#adadb8",ui:{sort:13,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Tooltip Viewer Count",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.tooltip-text4",{default:"#adadb8",ui:{sort:14,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Tooltip Hype Train",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.tooltip-text5",{default:"#adadb8",ui:{sort:15,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Tooltip Guests",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.border",{default:"#26262c",ui:{sort:16,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Border",component:"setting-color-box",openUp:!0},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.sidebar.left-nav-preview.hide-native-tooltip",{default:!1,ui:{sort:17,path:"Add-Ons > Trubbel\u2019s Utilities > Sidebar >> Left Navigation",title:"Hide Native Tooltip",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.SideBar=this.elemental.define("sidebar",".side-bar-contents",null,null,0)}onEnable(){this.SideBar.on("mount",this.updateSidebar,this),this.SideBar.on("mutate",this.updateSidebar,this),this.SideBar.each(e=>this.updateSidebar(e)),this.createPreviewContainer(),this.updateCSS()}updateSidebar(e){if(this.settings.get("addon.trubbel.sidebar.left-nav-preview"))try{const t=e.querySelectorAll(".side-nav-card");if(t.length>0)for(const i of t)i.querySelector(".tw-channel-status-indicator")&&(i._stream_processed||(i._stream_processed=!0,i.addEventListener("mouseenter",()=>{if(!this.settings.get("addon.trubbel.sidebar.left-nav-preview")){this.log.info("[Sidebar Preview] Stream Previews disabled in settings");return}this.hoverTimeout&&clearTimeout(this.hoverTimeout);const s=this.settings.get("addon.trubbel.sidebar.left-nav-preview.delay");s>0?this.hoverTimeout=setTimeout(()=>{this.showPreview(i)},s):this.showPreview(i)}),i.addEventListener("mouseleave",()=>{this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null),this.hidePreview()})));return!0}catch(t){return this.log.error("[Sidebar Preview] Error in updateSidebar:",t),!1}}isSidebarOnRight(){const e=document.querySelector(".side-bar-contents, .side-nav");if(!e)return this.log.warn("[Sidebar Preview] Could not find sidebar element"),!1;const t=e.getBoundingClientRect();return window.innerWidth-t.right<t.left}createPreviewContainer(){if(!this.settings.get("addon.trubbel.sidebar.left-nav-preview")||this.previewContainer)return;this.previewContainer=A("div",{className:"trubbel-sidebar-preview"});const e=A("div",{className:"trubbel-sidebar-preview-wrapper"});this.previewContainer.appendChild(e),this.previewIframe=A("iframe"),e.appendChild(this.previewIframe),this.previewTitleContainer=A("div",{className:"trubbel-sidebar-preview-title"}),this.previewContainer.appendChild(this.previewTitleContainer),this.previewCategoryContainer=A("div",{className:"trubbel-sidebar-preview-category"}),this.previewContainer.appendChild(this.previewCategoryContainer),this.previewViewerContainer=A("div",{className:"trubbel-sidebar-preview-viewers"}),this.previewContainer.appendChild(this.previewViewerContainer),this.previewHypeTrainContainer=A("div",{className:"trubbel-sidebar-preview-hypetrain"}),this.previewContainer.appendChild(this.previewHypeTrainContainer),this.previewGuestsContainer=A("div",{className:"trubbel-sidebar-preview-guests"}),this.previewContainer.appendChild(this.previewGuestsContainer),this.updatePreviewSize();const t=this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-title");this.previewTitleContainer.style.display=t?"block":"none";const i=this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-category");this.previewCategoryContainer.style.display=i?"block":"none";const s=this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-viewers");this.previewViewerContainer.style.display=s?"block":"none";const n=this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-hypetrain");this.previewHypeTrainContainer.style.display=n?"block":"none";const a=this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-guests");this.previewGuestsContainer.style.display=a?"block":"none",document.body.appendChild(this.previewContainer)}updatePreviewSize(){if(!this.settings.get("addon.trubbel.sidebar.left-nav-preview")||!this.previewContainer)return;this.previewContainer.classList.remove("trubbel-sidebar-preview--small","trubbel-sidebar-preview--medium","trubbel-sidebar-preview--large","trubbel-sidebar-preview--xlarge");const e=this.settings.get("addon.trubbel.sidebar.left-nav-preview.size");this.previewContainer.classList.add(`trubbel-sidebar-preview--${e}`)}showPreview(e){if(!e||!this.previewContainer||!this.previewIframe){this.log.error("[Sidebar Preview] Missing elements for preview");return}this.currentHoverCard&&this.currentHoverCard!==e&&this.hidePreview(),this.currentHoverCard=e;const i=this.fine.getReactInstance(e)?.return?.return?.memoizedProps;if(!i||!i.userLogin){this.log.error("[Sidebar Preview] Could not find userLogin in props:",i);return}const s=this.settings.get("addon.trubbel.sidebar.left-nav-preview.quality"),n=!this.settings.get("addon.trubbel.sidebar.left-nav-preview.audio"),u=`https://player.twitch.tv/?${new URLSearchParams({channel:i.userLogin,enableExtensions:!1,parent:"twitch.tv",player:"site",quality:s,muted:n,volume:localStorage.getItem("volume"),controls:!1,disable_frankerfacez:!0})}`;if(this.previewIframe.src=u,this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-title")){let C="";i.metadataRight?.props?.stream?.broadcaster?.broadcastSettings?.title?C=i.metadataRight?.props?.stream?.broadcaster?.broadcastSettings?.title:i.tooltipContent?.props?.stream?.content?.broadcaster?.broadcastSettings?.title?C=i.tooltipContent?.props?.stream?.content?.broadcaster?.broadcastSettings?.title:i.tooltipContent?.props?.stream?.user?.broadcastSettings?.title&&(C=i.tooltipContent?.props?.stream?.user?.broadcastSettings?.title),C?(this.previewTitleContainer.textContent=C,this.previewTitleContainer.style.display="block"):(this.previewTitleContainer.textContent=`${i.avatarAlt}'s Stream`,this.previewTitleContainer.style.display="block")}else this.previewTitleContainer.style.display="none";if(this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-category")){let C="";i?.metadataLeft?C=i?.metadataLeft:i.metadataRight?.props?.stream?.game?.displayName?C=i.metadataRight?.props?.stream?.game?.displayName:i.tooltipContent?.props?.stream?.content?.game?.displayName&&(C=i.tooltipContent?.props?.stream?.content?.game?.displayName),C?(this.previewCategoryContainer.textContent=C,this.previewCategoryContainer.style.display="block"):(this.previewCategoryContainer.textContent="",this.previewCategoryContainer.style.display="none")}else this.previewCategoryContainer.style.display="none";if(this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-viewers")){let C="";i?.viewerCount?C=i?.viewerCount:i.metadataRight?.props?.stream?.viewersCount?C=i.metadataRight?.props?.stream?.viewersCount:i.tooltipContent?.props?.stream?.content?.viewersCount&&(C=i.tooltipContent?.props?.stream?.content?.viewersCount),C?(this.previewViewerContainer.textContent=this.resolve("i18n").formatNumber(C)+" viewers",this.previewViewerContainer.style.display="block"):(this.previewViewerContainer.textContent="",this.previewViewerContainer.style.display="none")}else this.previewViewerContainer.style.display="none";if(this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-hypetrain"))if(i?.activeHypeTrain?.hypeTrainSideNavChannel){const C=i.activeHypeTrain.hypeTrainSideNavChannel;if(C){const L=C.level||1;for(;this.previewHypeTrainContainer.firstChild;)this.previewHypeTrainContainer.removeChild(this.previewHypeTrainContainer.firstChild);const R=A("span",{className:"trubbel-hype-train-icon"});C.isGoldenKappaTrain?(R.classList.add("trubbel-hype-train-golden"),this.previewHypeTrainContainer.appendChild(R),this.previewHypeTrainContainer.appendChild(document.createTextNode(`Golden Kappa Train \u2022 Level ${L}`))):C.isAllTimeHighTrain?(R.classList.add("trubbel-hype-train-alltime"),this.previewHypeTrainContainer.appendChild(R),this.previewHypeTrainContainer.appendChild(document.createTextNode(`All-Time High Train \u2022 Level ${L}`))):(R.classList.add("trubbel-hype-train-regular"),this.previewHypeTrainContainer.appendChild(R),this.previewHypeTrainContainer.appendChild(document.createTextNode(`Hype Train \u2022 Level ${L}`))),this.previewHypeTrainContainer.style.display="block"}else{for(;this.previewHypeTrainContainer.firstChild;)this.previewHypeTrainContainer.removeChild(this.previewHypeTrainContainer.firstChild);this.previewHypeTrainContainer.style.display="none"}}else{for(;this.previewHypeTrainContainer.firstChild;)this.previewHypeTrainContainer.removeChild(this.previewHypeTrainContainer.firstChild);this.previewHypeTrainContainer.style.display="none"}else this.previewHypeTrainContainer.style.display="none";if(this.settings.get("addon.trubbel.sidebar.left-nav-preview.show-guests")){for(;this.previewGuestsContainer.firstChild;)this.previewGuestsContainer.removeChild(this.previewGuestsContainer.firstChild);const C=i?.tooltipContent?.props?.guests||[];if(C&&C.length>0){const L=A("div",{className:"trubbel-sidebar-preview-guests-list"});C.forEach(R=>{const G=A("div",{className:"trubbel-sidebar-preview-guest-item"}),Se=A("div",{className:"trubbel-sidebar-preview-guest-avatar"}),dt=R.primaryColorHex?`#${R.primaryColorHex}`:"#9147ff";Se.style.setProperty("--avatar-border-color",dt);const ct=A("img",{src:R.profileImageURL,alt:R.displayName});Se.appendChild(ct);const Ue=A("div",{className:"trubbel-sidebar-preview-guest-name"}),Te=R.displayName,Fe=R.login,ut=Te.toLowerCase()!==Fe?`${Te} (${Fe})`:Te;Ue.textContent=ut;const H=A("div",{className:"trubbel-sidebar-preview-guest-viewers"});if(R.stream&&R.stream.viewersCount){const ht=this.resolve("i18n").formatNumber(R.stream.viewersCount);H.textContent=ht;const pt=A("span",{className:"trubbel-sidebar-preview-guest-online-indicator"});H.insertBefore(pt,H.firstChild)}else H.textContent="offline";G.appendChild(Se),G.appendChild(Ue),G.appendChild(H),L.appendChild(G)}),this.previewGuestsContainer.appendChild(L),this.previewGuestsContainer.style.display="block"}else this.previewGuestsContainer.style.display="none"}else this.previewGuestsContainer.style.display="none";const c=e.getBoundingClientRect(),m=this.previewContainer.getBoundingClientRect().height,x=this.isSidebarOnRight();let N=c.top+c.height/2-m/2;const De=document.querySelector(".side-bar-contents, .side-nav").getBoundingClientRect();x?(this.previewContainer.style.left="auto",this.previewContainer.style.right=`${window.innerWidth-De.left+10}px`):(this.previewContainer.style.right="auto",this.previewContainer.style.left=`${De.right+10}px`);const Oe=window.innerHeight;N<10&&(N=10),N+m>Oe-10&&(N=Oe-m-10),this.previewContainer.style.top=`${N}px`,this.previewContainer.classList.add("active")}hidePreview(){this.previewContainer&&(this.previewContainer.classList.remove("active"),this.previewIframe&&(this.previewIframe.src="about:blank"),this.currentHoverCard=null)}updateCSS(){this.settings.get("addon.trubbel.sidebar.left-nav-preview")?this.style.set("left-nav-preview",`
        .trubbel-sidebar-preview {
          position: fixed;
          z-index: 9999;
          background-color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-background")};
          border-radius: 6px;
          overflow: hidden;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.15s ease-out;
          pointer-events: none;
          display: flex;
          flex-direction: column;
          width: auto;
        }
        .trubbel-sidebar-preview.active {
          opacity: 1;
          visibility: visible;
          pointer-events: auto;
        }
        .trubbel-sidebar-preview-wrapper {
          width: 100%;
          position: relative;
        }
        .trubbel-sidebar-preview iframe {
          width: 100%;
          height: 100%;
          border: 0;
          display: block;
          background-color: black;
        }
        .trubbel-sidebar-preview-title {
          padding: 6px 8px;
          font-size: 1.3rem;
          font-weight: 600;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text1")};
          word-break: break-word;
          overflow-wrap: break-word;
          word-wrap: break-word;
          white-space: pre-wrap;
          text-overflow: ellipsis;
          max-height: none;
          overflow-y: visible;
          width: 100%;
          box-sizing: border-box;
          line-height: 1.5;
          max-width: 100%;
        }
        .trubbel-sidebar-preview-category {
          padding: 4px 8px;
          font-size: 1.2rem;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text2")};
          word-break: break-word;
          overflow-wrap: break-word;
          word-wrap: break-word;
          white-space: pre-wrap;
          max-height: none;
          overflow-y: visible;
          border-top: 1px solid ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.border")};
          width: 100%;
          box-sizing: border-box;
          line-height: 1.3;
          max-width: 100%;
        }
        .trubbel-sidebar-preview-viewers {
          padding: 4px 8px;
          font-size: 1.2rem;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text3")};
          word-break: break-word;
          overflow-wrap: break-word;
          word-wrap: break-word;
          white-space: pre-wrap;
          max-height: none;
          overflow-y: visible;
          border-top: 1px solid ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.border")};
          width: 100%;
          box-sizing: border-box;
          line-height: 1.3;
          max-width: 100%;
        }
        .trubbel-sidebar-preview-hypetrain {
          padding: 4px 8px;
          font-size: 1.2rem;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text4")};
          word-break: break-word;
          overflow-wrap: break-word;
          word-wrap: break-word;
          white-space: pre-wrap;
          max-height: none;
          overflow-y: visible;
          border-top: 1px solid ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.border")};
          width: 100%;
          box-sizing: border-box;
          line-height: 1.3;
          max-width: 100%;
        }
        /* Preview size variations */
        .trubbel-sidebar-preview--small .trubbel-sidebar-preview-wrapper {
          width: 280px;
          height: 158px;
        }
        .trubbel-sidebar-preview--medium .trubbel-sidebar-preview-wrapper {
          width: 320px;
          height: 180px;
        }
        .trubbel-sidebar-preview--large .trubbel-sidebar-preview-wrapper {
          width: 400px;
          height: 225px;
        }
        .trubbel-sidebar-preview--xlarge .trubbel-sidebar-preview-wrapper {
          width: 480px;
          height: 270px;
        }
        /* Make sure the width of the preview containers matches the iframe width */
        .trubbel-sidebar-preview--small .trubbel-sidebar-preview-title,
        .trubbel-sidebar-preview--small .trubbel-sidebar-preview-category,
        .trubbel-sidebar-preview--small .trubbel-sidebar-preview-viewers,
        .trubbel-sidebar-preview--small .trubbel-sidebar-preview-hypetrain,
        .trubbel-sidebar-preview--small .trubbel-sidebar-preview-guests {
          max-width: 280px;
        }
        .trubbel-sidebar-preview--medium .trubbel-sidebar-preview-title,
        .trubbel-sidebar-preview--medium .trubbel-sidebar-preview-category,
        .trubbel-sidebar-preview--medium .trubbel-sidebar-preview-viewers,
        .trubbel-sidebar-preview--medium .trubbel-sidebar-preview-hypetrain,
        .trubbel-sidebar-preview--medium .trubbel-sidebar-preview-guests {
          max-width: 320px;
        }
        .trubbel-sidebar-preview--large .trubbel-sidebar-preview-title,
        .trubbel-sidebar-preview--large .trubbel-sidebar-preview-category,
        .trubbel-sidebar-preview--large .trubbel-sidebar-preview-viewers,
        .trubbel-sidebar-preview--large .trubbel-sidebar-preview-hypetrain,
        .trubbel-sidebar-preview--large .trubbel-sidebar-preview-guests {
          max-width: 400px;
        }
        .trubbel-sidebar-preview--xlarge .trubbel-sidebar-preview-title,
        .trubbel-sidebar-preview--xlarge .trubbel-sidebar-preview-category,
        .trubbel-sidebar-preview--xlarge .trubbel-sidebar-preview-viewers,
        .trubbel-sidebar-preview--xlarge .trubbel-sidebar-preview-hypetrain,
        .trubbel-sidebar-preview--xlarge .trubbel-sidebar-preview-guests {
          max-width: 480px;
        }
        /* Hype Train Styles */
        .trubbel-hype-train-icon {
          display: inline-block;
          vertical-align: middle;
          margin-right: 4px;
          height: 1.3rem;
          width: 1.3rem;
        }
        .trubbel-hype-train-regular {
          background: #bf94ff;
          -webkit-mask-image: url(https://static-cdn.jtvnw.net/c3-vg/leftnav/hype-train.svg);
          mask-image: url(https://static-cdn.jtvnw.net/c3-vg/leftnav/hype-train.svg);
          -webkit-mask-repeat: no-repeat;
          mask-repeat: no-repeat;
          -webkit-mask-size: 100%;
          mask-size: 100%;
        }
        .trubbel-hype-train-golden {
          background: linear-gradient(180deg, #ffb31a 1.19%, #e0e000);
          -webkit-mask-image: url(https://static-cdn.jtvnw.net/c3-vg/leftnav/hype-train.svg);
          mask-image: url(https://static-cdn.jtvnw.net/c3-vg/leftnav/hype-train.svg);
          -webkit-mask-repeat: no-repeat;
          mask-repeat: no-repeat;
          -webkit-mask-size: 100%;
          mask-size: 100%;
        }
        .trubbel-hype-train-alltime {
          background: linear-gradient(#9147ff, #ff75e6);
          -webkit-mask-image: url(https://static-cdn.jtvnw.net/c3-vg/leftnav/trophy.svg);
          mask-image: url(https://static-cdn.jtvnw.net/c3-vg/leftnav/trophy.svg);
          -webkit-mask-repeat: no-repeat;
          mask-repeat: no-repeat;
          -webkit-mask-size: 100%;
          mask-size: 100%;
        }
        /* Guests Container */
        .trubbel-sidebar-preview-guests {
          padding: 4px 8px;
          font-size: 1.2rem;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text5")};
          word-break: break-word;
          overflow-wrap: break-word;
          word-wrap: break-word;
          white-space: pre-wrap;
          max-height: none;
          overflow-y: visible;
          border-top: 1px solid ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.border")};
          width: 100%;
          box-sizing: border-box;
          line-height: 1.3;
          max-width: 100%;
        }
        /* Guests List */
        .trubbel-sidebar-preview-guests-list {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }
        /* Individual Guest Item */
        .trubbel-sidebar-preview-guest-item {
          display: flex;
          align-items: center;
          gap: 8px;
        }
        /* Guest Avatar */
        .trubbel-sidebar-preview-guest-avatar {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          flex-shrink: 0;
          position: relative;
          box-sizing: content-box;
        }
        .trubbel-sidebar-preview-guest-avatar::after {
          content: "";
          position: absolute;
          top: -3px;
          left: -3px;
          right: -3px;
          bottom: -3px;
          border-radius: 50%;
          pointer-events: none;
          z-index: 1;
          border: 0.2rem solid var(--avatar-border-color, #9147ff); /* Use CSS variable with fallback */
        }
        .trubbel-sidebar-preview-guest-avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          border-radius: 50%;
          position: relative;
          z-index: 0;
        }
        /* Guest Name */
        .trubbel-sidebar-preview-guest-name {
          flex-grow: 1;
          font-size: 1.1rem;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text5")};
        }
        /* Guest Viewer Count */
        .trubbel-sidebar-preview-guest-viewers {
          font-size: 1.1rem;
          color: ${this.settings.get("addon.trubbel.sidebar.left-nav-preview.tooltip-text5")};
          display: flex;
          align-items: center;
          gap: 4px;
        }
        /* Online Indicator */
        .trubbel-sidebar-preview-guest-online-indicator {
          display: inline-block;
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background-color: #eb0400;
          margin-right: 4px;
        }
      `):this.style.delete("left-nav-preview"),this.settings.get("addon.trubbel.sidebar.left-nav-preview.hide-native-tooltip")?(this.style.set("hide-native-tooltip1","div :is(.tw-balloon) :has(.online-side-nav-channel-tooltip__body) { display: none !important; }"),this.style.set("hide-native-tooltip2","div :is(.tw-balloon) :has(.side-nav-guest-star-tooltip__body) { display: none !important; }")):(this.style.delete("hide-native-tooltip1"),this.style.delete("hide-native-tooltip2"))}};h(ve,"SideBarPreview");let ae=ve;function at(d){if(!d.settings.get("addon.trubbel.ui-tweaks.system-theme"))return;const e={LIGHT:0,DARK:1};function t(){const n=h((m,x)=>{if(!m)return null;if(x(m))return m;if(m.child){let N=m.child;for(;N;){const Ce=n(N,x);if(Ce)return Ce;N=N.sibling}}return null},"searchReactChildren"),a=h(m=>{const x=Object.keys(m).find(N=>N.startsWith("__reactContainer$")||N.startsWith("__reactFiber$"));return m[x]},"getReactRoot"),u=document.querySelector("#root"),c=a(u);return n(c._internalRoot?.current??c,m=>m.pendingProps?.value?.store)?.pendingProps?.value?.store}h(t,"findReduxStore");function i(n,a){n&&(n.dispatch({type:"core.ui.THEME_CHANGED",theme:a?e.DARK:e.LIGHT}),V(a?"\u{1F319}":"\u2600\uFE0F",`[AUTO THEME] Theme set to ${a?"Dark":"Light"} Mode`))}h(i,"setTheme");function s(){const n=t();if(!n){setTimeout(s,1e3);return}const a=window.matchMedia("(prefers-color-scheme: dark)").matches,c=n.getState().ui.theme===e.DARK;a!==c&&i(n,a),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",g=>i(n,g.matches))}h(s,"initialize"),setTimeout(s,1e3)}h(at,"autoChangeTheme");const{ManagedStyle:rt}=FrankerFaceZ.utilities.dom,we=class we extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),this.style=new rt,this.inject("settings"),this.inject("site.router"),this.settings.add("addon.trubbel.ui-tweaks.chat-viewer-list-padding",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Chat",title:"Reduce padding in Viewer List",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.chat-show-full-message",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Chat",title:"Show Full Messages /w Expanded Replies",description:`Allows you to see the entire message someone is replying to in chat, instead of it being cut off.

**Note:** Twitch settings needs to be "**Expanded**" in \`Chat Settings > Chat Appearance > Replies in Chat > Expanded\`,

& FFZ settings needs to be "**Twitch (Default)**" in [Chat > Appearance > Replies](~chat.appearance.replies).`,component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.system-theme",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> System Theme",title:"Enable System Theme",description:"Automatically sets Twitch theme based on system preferences.",component:"setting-check-box"},changed:()=>this.getCurrentTheme()}),this.settings.add("addon.trubbel.ui-tweaks.full-side-nav-tooltip",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Titles",title:"Show full titles for Stream Tooltips",description:"Show the full title tooltip when hovering over a stream in the left side navigation.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.titles-full-stream",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Titles",title:"Show full titles in Stream Previews",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.titles-full-clip",{default:!1,ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Titles",title:"Show full titles in Clip Previews",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.titles-full-vod",{default:!1,ui:{sort:3,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Titles",title:"Show full titles in VOD Previews",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.titles-full-game",{default:!1,ui:{sort:4,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Titles",title:"Show full titles for Games in Directory",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.titles-most-recent-video",{default:!1,ui:{sort:5,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Titles",title:"Show full titles for Most Recent Videos",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.unban-requests-hide",{default:!1,ui:{sort:1,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Unban Requests",title:"Hide Mod Actions in Unban Requests",description:"Hide all mod actions taken in the **Unban Requests popout window**.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.unban-requests-deleted-message",{default:!1,ui:{sort:2,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> Unban Requests",title:"Remove line-through text in Unban Requests & User Cards",description:"Remove the line-through text in Unban Requests and within user cards moderated messages.",component:"setting-check-box"},changed:()=>this.updateCSS()}),this.settings.add("addon.trubbel.ui-tweaks.vod-time-background",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > UI Tweaks >> VOD",title:"Show black background behind current and duration time",description:"Show a black background behind VODs seekbar, for current time and duration. Making it easier to see the white text.",component:"setting-check-box"},changed:()=>this.updateCSS()})}onEnable(){this.settings.getChanges("addon.trubbel.ui-tweaks.system-theme",()=>this.getCurrentTheme()),this.router.on(":route",()=>{this.getCurrentTheme()}),this.getCurrentTheme(),this.updateCSS()}getCurrentTheme(){this.settings.get("addon.trubbel.ui-tweaks.system-theme")&&at(this)}updateCSS(){this.settings.get("addon.trubbel.ui-tweaks.chat-viewer-list-padding")?(this.style.set("viewer-list-padding1","#community-tab-content > div {padding: 1rem !important;}"),this.style.set("viewer-list-padding2",".chatter-list-item {padding: .2rem 0!important;}")):(this.style.delete("viewer-list-padding1"),this.style.delete("viewer-list-padding2")),this.settings.get("addon.trubbel.ui-tweaks.chat-show-full-message")?(this.style.set("show-full-message",'.chat-line__message-container p[title*="@"] {white-space: break-spaces !important;}'),this.style.set("show-full-message-mentioned",".chat-line__message-container p:has(.reply-line--mentioned) {white-space: break-spaces !important;}")):(this.style.delete("show-full-message"),this.style.delete("show-full-message-mentioned")),this.settings.get("addon.trubbel.ui-tweaks.full-side-nav-tooltip")?(this.style.set("show-full-side-nav-tooltip1",".tw-balloon :has(.online-side-nav-channel-tooltip__body) { max-width: none !important; }"),this.style.set("show-full-side-nav-tooltip2",".online-side-nav-channel-tooltip__body :is(p) { display: block !important; -webkit-line-clamp: unset !important; -webkit-box-orient: unset !important; overflow: visible !important; text-overflow: unset !important; }"),this.style.set("show-full-side-nav-tooltip3",".tw-balloon :has(.side-nav-guest-star-tooltip__body) { max-width: none !important; }"),this.style.set("show-full-side-nav-tooltip4",".side-nav-guest-star-tooltip__body :is(p) { display: block !important; -webkit-line-clamp: unset !important; -webkit-box-orient: unset !important; overflow: visible !important; text-overflow: unset !important; }")):(this.style.delete("show-full-side-nav-tooltip1"),this.style.delete("show-full-side-nav-tooltip2"),this.style.delete("show-full-side-nav-tooltip3"),this.style.delete("show-full-side-nav-tooltip4")),this.settings.get("addon.trubbel.ui-tweaks.titles-full-clip")?this.style.set("titles-full-clip",'article [href*="/clip/"] :is(h3[title]) {white-space: unset;}'):this.style.delete("titles-full-clip"),this.settings.get("addon.trubbel.ui-tweaks.titles-full-stream")?this.style.set("titles-full-stream",'[data-a-target="preview-card-channel-link"] :is(h3[title]) {white-space: unset;}'):this.style.delete("titles-full-stream"),this.settings.get("addon.trubbel.ui-tweaks.titles-full-vod")?this.style.set("titles-full-vod",'article [href^="/videos/"] :is(h3[title]) {white-space: unset;}'):this.style.delete("titles-full-vod"),this.settings.get("addon.trubbel.ui-tweaks.titles-full-game")?this.style.set("titles-full-game",'.game-card .tw-card-body :is([data-a-target="tw-card-title"]) {white-space: unset;}.game-card .tw-card-body :is(h2[title]) {white-space: unset;}'):this.style.delete("titles-full-game"),this.settings.get("addon.trubbel.ui-tweaks.titles-most-recent-video")?this.style.set("titles-most-recent-video",".player-overlay-background p[title] {white-space: unset;}"):this.style.delete("titles-most-recent-video"),this.settings.get("addon.trubbel.ui-tweaks.unban-requests-hide")?(this.style.set("unban-requests-hide1",`
        .tw-root--theme-dark .mod-view-widget-popout .unban-requests-item-header-tab__banned-by-item button {
          color: transparent !important;
          background-color: #adadb8 !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          pointer-events: none !important;
          padding: 0 90px !important;
        }
        .tw-root--theme-light .mod-view-widget-popout .unban-requests-item-header-tab__banned-by-item button {
          color: transparent !important;
          background-color: black !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          pointer-events: none !important;
          padding: 0 90px !important;
        }
        `),this.style.set("unban-requests-hide2",".mod-view-widget-popout .chat-line__message--deleted span+span {display: none !important;}"),this.style.set("unban-requests-hide3",`
        .tw-root--theme-dark .mod-view-widget-popout .targeted-mod-action .message__timestamp+span {
          color: transparent !important;
          background-color: #adadb8 !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 90px !important;
        }
        .tw-root--theme-light .mod-view-widget-popout .targeted-mod-action .message__timestamp+span {
          color: transparent !important;
          background-color: black !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 90px !important;
        }
        `),this.style.set("unban-requests-hide4",`
        .tw-root--theme-dark .mod-view-widget-popout .viewer-card-mod-logs-comment-line a span {
          color: transparent !important;
          background-color: #adadb8 !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 90px !important;
        }
        .tw-root--theme-light .mod-view-widget-popout .viewer-card-mod-logs-comment-line a span {
          color: transparent !important;
          background-color: black !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 90px !important;
        }
        `),this.style.set("unban-requests-hide5",".mod-view-widget-popout .viewer-card-mod-logs-comment-line a {pointer-events: none !important;}"),this.style.set("unban-requests-hide6","#root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .chat-line__message--deleted span+span {display: none !important;}"),this.style.set("unban-requests-hide7",`
        .tw-root--theme-dark #root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .targeted-mod-action div>span.message__timestamp+span {
          color: transparent !important;
          background-color: #adadb8 !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 50px !important;
        }
        .tw-root--theme-light #root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .targeted-mod-action div>span.message__timestamp+span {
          color: transparent !important;
          background-color: black !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 50px !important;
        }
        `),this.style.set("unban-requests-hide8",`
        .tw-root--theme-dark #root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .viewer-card-mod-logs>div:not([style]):not(.viewer-card-mod-logs-page) span+span>span {
          color: transparent !important;
          background-color: #adadb8 !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 50px !important;
        }
        .tw-root--theme-light #root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .viewer-card-mod-logs>div:not([style]):not(.viewer-card-mod-logs-page) span+span>span {
          color: transparent !important;
          background-color: black !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 50px !important;
        }
        `),this.style.set("unban-requests-hide9",`
        .tw-root--theme-dark #root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .viewer-card-mod-logs-comment-line a span {
          color: transparent !important;
          background-color: #adadb8 !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 50px !important;
        }
        .tw-root--theme-light #root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .viewer-card-mod-logs-comment-line a span {
          color: transparent !important;
          background-color: black !important;
          -webkit-user-select: none !important;
          user-select: none !important;
          padding: 0 50px !important;
        }
        `),this.style.set("unban-requests-hide10","#root :has(.mod-view-widget-popout)+.popout-widget__viewer-card-layer .viewer-card-mod-logs-comment-line a {pointer-events: none !important;}")):(this.style.delete("unban-requests-hide1"),this.style.delete("unban-requests-hide2"),this.style.delete("unban-requests-hide3"),this.style.delete("unban-requests-hide4"),this.style.delete("unban-requests-hide5"),this.style.delete("unban-requests-hide6"),this.style.delete("unban-requests-hide7"),this.style.delete("unban-requests-hide8"),this.style.delete("unban-requests-hide9"),this.style.delete("unban-requests-hide10")),this.settings.get("addon.trubbel.ui-tweaks.unban-requests-deleted-message")?this.style.set("unban-requests-deleted-message",".vcml-message .chat-line__message--deleted-detailed {text-decoration: none;}"):this.style.delete("unban-requests-deleted-message"),this.settings.get("addon.trubbel.ui-tweaks.vod-time-background")?this.style.set("vod-time-background",'[data-a-target="player-seekbar-current-time"],[data-a-target="player-seekbar-duration"] {background-color: black;padding: 0px 0.4rem;border-radius: 0.2rem;}'):this.style.delete("vod-time-background")}};h(we,"UITweaks");let re=we;var ot=Object.defineProperty,lt=h((d,e,t)=>e in d?ot(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,"whispers_defNormalProp"),Re=h((d,e,t)=>(lt(d,typeof e!="symbol"?e+"":e,t),t),"whispers_publicField");const{createElement:Ne}=FrankerFaceZ.utilities.dom,ye=class ye extends FrankerFaceZ.utilities.module.Module{constructor(...e){super(...e),Re(this,"handleMouseMove",t=>{if(!this.isResizing||!this.currentArea)return;const i=t.clientY-this.startY,s=this.currentArea.getBoundingClientRect(),n=window.innerHeight,a=Math.min(n-s.top-20,this.startHeight+i),u=Math.max(67,a);this.currentArea.style.height=`${u}px`,this.settings.provider.set(j,`${u}px`)}),Re(this,"handleMouseUp",()=>{this.isResizing=!1,this.currentArea=null}),this.inject("settings"),this.observer=null,this.styleElement=null,this.boundMouseMove=null,this.boundMouseUp=null,this.isResizing=!1,this.currentArea=null,this.startHeight=0,this.startY=0,this.settings.add("addon.trubbel.whispers.resizable",{default:!1,ui:{sort:0,path:"Add-Ons > Trubbel\u2019s Utilities > Whispers >> Resizable",title:"Enable Resizable Drop Down",description:"Gives the ability to adjust the height of the whisper window drop down.",component:"setting-check-box"},changed:()=>this.getWhisperWindow()})}onEnable(){this.settings.getChanges("addon.trubbel.whispers.resizable",()=>this.getWhisperWindow()),this.getWhisperWindow()}cleanup(){this.styleElement&&(this.styleElement.remove(),this.styleElement=null),this.boundMouseMove&&(document.removeEventListener("mousemove",this.boundMouseMove),this.boundMouseMove=null),this.boundMouseUp&&(document.removeEventListener("mouseup",this.boundMouseUp),this.boundMouseUp=null),this.observer&&(this.observer.disconnect(),this.observer=null),this.isResizing=!1,this.currentArea=null,this.startHeight=0,this.startY=0}initializeResize(e){if(e.dataset.heightAdjustable)return;e.dataset.heightAdjustable="true";const t=this.settings.provider.get(j);t&&(e.style.height=t),e.appendChild(Ne("div",{class:"resize-handle"})),e.addEventListener("mousedown",i=>{const s=e.getBoundingClientRect();i.clientY>=s.bottom-6&&(this.isResizing=!0,this.currentArea=e,this.startHeight=s.height,this.startY=i.clientY,i.preventDefault())})}setupStyles(){const e=`
      .whispers-threads-box__scrollable-area {
        position: relative !important;
      }
      .whispers-threads-box__scrollable-area::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: #6441a5;
        cursor: ns-resize;
        opacity: 0;
        transition: opacity 0.2s;
        border-top-width: 2px;
        border-top-style: dotted;
        border-top-color: inherit;
      }
      .whispers-threads-box__scrollable-area:hover::after {
        opacity: 0.5;
      }
    `;this.styleElement=Ne("style",{textContent:e}),document.head.appendChild(this.styleElement)}setupObserver(){this.observer=new MutationObserver(e=>{for(const t of e)for(const i of t.addedNodes)if(i.nodeType===Node.ELEMENT_NODE){const s=i.querySelector(qe);s&&this.initializeResize(s)}}),this.observer.observe(document.body,{childList:!0,subtree:!0})}getWhisperWindow(){this.settings.get("addon.trubbel.whispers.resizable")?(this.setupStyles(),this.boundMouseMove=this.handleMouseMove.bind(this),this.boundMouseUp=this.handleMouseUp.bind(this),document.addEventListener("mousemove",this.boundMouseMove),document.addEventListener("mouseup",this.boundMouseUp),this.setupObserver()):(this.cleanup(),this.settings.provider.has(j)&&this.settings.provider.delete(j))}};h(ye,"Whispers");let oe=ye;const ke=class ke extends FrankerFaceZ.utilities.addon.Addon{constructor(...e){super(...e),this.inject(D),this.inject(W),this.inject(Y),this.inject(X),this.inject(J),this.inject(te),this.inject(se),this.inject(ne),this.inject(ae),this.inject(re),this.inject(oe),this.inject("chat"),this.inject("chat.badges"),this.loadDevBadge()}async loadDevBadge(){this.badges.loadBadgeData("addon.trubbel-devbadge",{addon:"trubbel",id:"addon.trubbel-devbadge",base_id:"addon.trubbel-devbadge",title:`Trubbel\u2019s Utilities
Developer`,slot:666,color:"transparent",image:"https://i.imgur.com/8TRjfOx.png",urls:{1:"https://i.imgur.com/8TRjfOx.png",2:"https://i.imgur.com/vu08acF.png",4:"https://i.imgur.com/s8TIgUg.png"},click_url:"https://twitch.tv/trubbel"}),this.chat.getUser(39172973,"trubbel").addBadge("addon.trubbel","addon.trubbel-devbadge")}};h(ke,"Trubbel");let le=ke;le.register("trubbel",null,"2.8.5")})()})();})();

//# sourceMappingURL=script.js.map