{"version":3,"file":"rich_tokens.js","mappings":"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","sources":["webpack://frankerfacez/./src/utilities/rich_tokens.js"],"sourcesContent":["'use strict';\n\n// ============================================================================\n// Rich Content Tokens\n// ============================================================================\n\nimport {has} from 'utilities/object';\nimport Markdown from 'markdown-it';\nimport MILA from 'markdown-it-link-attributes';\nimport { FFZEvent } from './events';\n\nexport const VERSION = 9;\n\nexport const TOKEN_TYPES = {};\n\nconst validate = (input, valid) => valid.includes(input) ? input : null;\n\nconst VALID_WEIGHTS = ['regular', 'bold', 'semibold'],\n\tVALID_COLORS = ['base', 'alt', 'alt-2', 'link'],\n\tVALID_COLORS_TWO = ['youtube'],\n\tVALID_SIZES = ['1', '2', '3', '4', '5', '6', '7', '8'],\n\tVALID_WRAPS = ['nowrap', 'pre-wrap'],\n\n\tVALID_PADDING = {\n\t\tsmall: '05',\n\t\tnormal: '1',\n\t\tlarge: '2',\n\t\thuge: '3'\n\t};\n\n\n// ============================================================================\n// Markdown\n// ============================================================================\n\nconst md = new Markdown({\n\thtml: false,\n\tlinkify: true\n}).disable('image');\n\nmd.use(MILA, {\n\tattrs: {\n\t\tclass: 'ffz-tooltip',\n\t\ttarget: '_blank',\n\t\trel: 'noopener',\n\t\t'data-tooltip-type': 'link'\n\t}\n});\n\n\n// ============================================================================\n// Render Tokens\n// ============================================================================\n\nfunction applySpacing(term, token, classes, styles) {\n\tfor(const mode of ['', '-x','-y','-t','-r','-b','-l']) {\n\t\tconst key = `${term}${mode}`,\n\t\t\tvalue = token[key];\n\t\tif ( value ) {\n\t\t\tif ( VALID_PADDING[value] )\n\t\t\t\tclasses.push(`tw-${term}${mode}-${VALID_PADDING[value]}`);\n\t\t\telse if ( styles ) {\n\t\t\t\tconst thing = term === 'pd' ? 'padding' : 'margin';\n\t\t\t\tif ( mode === '' )\n\t\t\t\t\tstyles[thing] = value;\n\t\t\t\tif ( mode === '-x' || mode === '-l' )\n\t\t\t\t\tstyles[`${thing}-left`] = value;\n\n\t\t\t\tif ( mode === '-x' || mode === '-r' )\n\t\t\t\t\tstyles[`${thing}-right`] = value;\n\n\t\t\t\tif ( mode === '-y' || mode === '-t' )\n\t\t\t\t\tstyles[`${thing}-top`] = value;\n\n\t\t\t\tif ( mode === '-y' || mode === '-b' )\n\t\t\t\t\tstyles[`${thing}-bottom`] = value;\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nexport function getRoundClass(value) {\n\tlet klass;\n\tif ( value === -1 )\n\t\tklass = 'rounded';\n\telse if ( value === 1 )\n\t\tklass = 'small';\n\telse if ( value === 2 )\n\t\tklass = 'medium';\n\telse if ( value === 3 )\n\t\tklass = 'large';\n\treturn klass ? `tw-border-radius-${klass}` : '';\n}\n\n\n// TODO: Mess with this more.\n// (It's a function for wrapping React's createElement in a function\n// that accepts the same input as Vue's createElement, letting us\n// deduplicate a ton of code in here.)\n/*export function wrapReactCreate(createElement) {\n\treturn (tag, opts, children) => {\n\t\tif ( typeof tag !== 'string' )\n\t\t\tthrow new Error('invalid tag');\n\n\t\tif ( opts ) {\n\t\t\tif ( opts.class ) {\n\t\t\t\tif ( typeof opts.class === 'string' )\n\t\t\t\t\topts.className = opts.class;\n\t\t\t\telse if ( Array.isArray(opts.class) )\n\t\t\t\t\topts.className = opts.class.join(' ');\n\t\t\t\telse if ( typeof opts.class === 'object' ) {\n\t\t\t\t\tconst bits = [];\n\t\t\t\t\tfor(const [key, val] of Object.entries(opts.class))\n\t\t\t\t\t\tif ( val )\n\t\t\t\t\t\t\tbits.push(key);\n\n\t\t\t\t\topts.className = bits.join(' ');\n\t\t\t\t}\n\n\t\t\t\topts.class = undefined;\n\t\t\t}\n\n\t\t\tif ( opts.attrs ) {\n\t\t\t\tfor(const [key, val] of Object.entries(opts.attrs) )\n\t\t\t\t\topts[key] = val;\n\n\t\t\t\topts.attrs = undefined;\n\t\t\t}\n\n\t\t\tif ( opts.props )\n\t\t\t\tthrow new Error('props unsupported');\n\n\t\t\tif ( opts.domProps )\n\t\t\t\tthrow new Error('domProps unsupported');\n\n\t\t\tif ( opts.nativeOn )\n\t\t\t\tthrow new Error('nativeOn unsupported');\n\n\t\t\tif ( opts.on ) {\n\t\t\t\tfor(const [key, val] of Object.entries(opts.on) )\n\t\t\t\t\topts[`on${key.charAt(0).toUpperCase()}${key.slice(1)}`] = val;\n\n\t\t\t\topts.on = undefined;\n\t\t\t}\n\n\t\t\tif ( opts.style && typeof opts.style !== 'object' )\n\t\t\t\topts.style = undefined;\n\t\t}\n\n\t\treturn createElement(tag, opts, children);\n\t}\n}*/\n\n\nexport function renderWithCapture(tokens, createElement, ctx, markdown) {\n\tconst old_capture = ctx.text_capture, old_markdown = ctx.markdown;\n\tctx.text_capture = [];\n\n\tif ( markdown )\n\t\tctx.markdown = true;\n\n\tconst content = renderTokens(tokens, createElement, ctx);\n\n\tlet title = ctx.text_capture.join('').trim();\n\tif ( ! title.length )\n\t\ttitle = null;\n\n\tctx.text_capture = old_capture;\n\tctx.markdown = old_markdown;\n\n\treturn {\n\t\tcontent,\n\t\ttitle\n\t}\n}\n\nexport function renderTokens(tokens, createElement, ctx, markdown) {\n\tif ( tokens == null )\n\t\treturn null;\n\n\tconst old_markdown = ctx.markdown;\n\tif ( markdown )\n\t\tctx.markdown = true;\n\n\tlet out = [];\n\tif ( ! Array.isArray(tokens) )\n\t\ttokens = [tokens];\n\n\tfor(const token of tokens) {\n\t\tif ( token == null )\n\t\t\tcontinue;\n\n\t\telse if ( Array.isArray(token) )\n\t\t\tout = out.concat(renderTokens(token, createElement, ctx));\n\n\t\telse if ( typeof token !== 'object' ) {\n\t\t\tconst val = String(token);\n\t\t\tif ( ctx.text_capture )\n\t\t\t\tctx.text_capture.push(val);\n\n\t\t\tif ( ctx.markdown ) {\n\t\t\t\tconst content = md.render(val);\n\t\t\t\tif ( content === val )\n\t\t\t\t\tout.push(val);\n\t\t\t\telse if ( ctx.vue )\n\t\t\t\t\tout.push(createElement('span', {\n\t\t\t\t\t\tdomProps: {\n\t\t\t\t\t\t\tinnerHTML: content\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\telse\n\t\t\t\t\tout.push(createElement('span', {\n\t\t\t\t\t\tdangerouslySetInnerHTML: {\n\t\t\t\t\t\t\t__html: content\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\n\t\t\t} else\n\t\t\t\tout.push(val);\n\t\t}\n\n\t\telse {\n\t\t\tconst type = token.type,\n\t\t\t\thandler = TOKEN_TYPES[type];\n\n\t\t\tif ( ! handler ) {\n\t\t\t\tconsole.warn('Skipping unknown token type', type, token);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst result = handler(token, createElement, ctx);\n\t\t\tif ( Array.isArray(result) )\n\t\t\t\tout = out.concat(result);\n\t\t\telse if ( result )\n\t\t\t\tout.push(result);\n\t\t}\n\t}\n\n\tctx.markdown = old_markdown;\n\tif ( ! out.length )\n\t\treturn null;\n\n\treturn out;\n}\n\nexport default renderTokens;\n\n\n// ============================================================================\n// Token Type: Reference\n// ============================================================================\n\nfunction resolveToken(token, ctx) {\n\tif ( token?.type === 'ref' ) {\n\t\treturn ctx.fragments?.[token.name] ?? null;\n\t}\n\n\treturn token;\n}\n\nTOKEN_TYPES.ref = function(token, createElement, ctx) {\n\tconst frag = ctx.fragments?.[token.name];\n\tif ( frag )\n\t\treturn renderTokens(frag, createElement, ctx);\n}\n\n\n// ============================================================================\n// Token Type: Box\n// ============================================================================\n\nTOKEN_TYPES.box = function(token, createElement, ctx) {\n\tconst classes = [], style = {};\n\n\tif ( VALID_WRAPS.includes(token.wrap) )\n\t\tclasses.push(`tw-white-space-${token.wrap}`);\n\n\tif ( token.ellipsis )\n\t\tclasses.push('tw-ellipsis');\n\n\tif ( token.lines ) {\n\t\tclasses.push('ffz--line-clamp');\n\t\tstyle['--ffz-lines'] = token.lines;\n\t}\n\n\tif ( token.border )\n\t\tclasses.push('tw-border');\n\n\tif ( token.rounding ) {\n\t\tconst round = getRoundClass(token.rounding);\n\t\tif ( round )\n\t\t\tclasses.push(round);\n\t}\n\n\tif ( token.background ) {\n\t\tif ( token.background === 'text' )\n\t\t\tstyle.backgroundColor = `var(--color-text-base)`;\n\t\telse if ( token.background === 'text-alt' )\n\t\t\tstyle.backgroundColor = `var(--color-text-alt)`;\n\t\telse if ( token.background === 'text-alt-2' )\n\t\t\tstyle.backgroundColor = `var(--color-text-alt-2)`;\n\t\telse if ( VALID_COLORS.includes(token.background) )\n\t\t\tclasses.push(`tw-c-background-${token.background}`);\n\t\telse\n\t\t\tstyle.backgroundColor = token.background;\n\t}\n\n\tif ( token.width )\n\t\tstyle.width = token.width;\n\n\tif ( token.height )\n\t\tstyle.height = token.height;\n\n\tapplySpacing('pd', token, classes, style);\n\tapplySpacing('mg', token, classes, style);\n\n\tconst capture = token.ellipsis || token.lines,\n\t\tmarkdown = token.markdown;\n\tlet content, title = null;\n\n\tif ( capture ) {\n\t\tconst out = renderWithCapture(token.content, createElement, ctx, markdown);\n\t\tcontent = out.content; title = out.title;\n\t} else\n\t\tcontent = renderTokens(token.content, createElement, ctx, markdown);\n\n\tif ( ctx.vue )\n\t\treturn createElement('div', {class: classes, style, attrs: {title}}, content);\n\n\treturn createElement('div', {className: classes.join(' '), style, title}, content);\n}\n\n\n// ============================================================================\n// Token Type: open_settings\n// ============================================================================\n\nTOKEN_TYPES.open_settings = function(token, createElement, ctx) {\n\n\tconst handler = event => {\n\t\tevent.preventDefault();\n\n\t\tconst evt = new FFZEvent({\n\t\t\titem: token.item,\n\t\t\tevent,\n\t\t\terrored: false\n\t\t});\n\n\t\twindow.FrankerFaceZ.get().emit('main_menu:open', evt);\n\t}\n\n\tconst markdown = token.markdown,\n\t\tcontent = renderTokens(token.content, createElement, ctx, markdown);\n\n\tif ( ctx.vue )\n\t\treturn createElement('a', {\n\t\t\tclass: 'tw-link',\n\t\t\thref: '#',\n\t\t\ton: {\n\t\t\t\tclick: handler\n\t\t\t}\n\t\t}, content);\n\n\treturn createElement('a', {\n\t\tclass: 'tw-link',\n\t\thref: '#',\n\t\tonClick: handler\n\t}, content);\n\n}\n\n\n// ============================================================================\n// Token Type: Conditional\n// ============================================================================\n\nTOKEN_TYPES.conditional = function(token, createElement, ctx) {\n\tlet passed = true;\n\n\tif ( has(token, 'media') && token.media != ctx.allow_media )\n\t\tpassed = false;\n\n\tif ( token.nsfw && ! ctx.allow_unsafe )\n\t\tpassed = false;\n\n\tif ( token.skip_nsfw && ctx.allow_unsafe )\n\t\tpassed = false;\n\n\tif ( token.tooltip && ! ctx.tooltip )\n\t\tpassed = false;\n\telse if ( token.tooltip === false && ctx.tooltip )\n\t\tpassed = false;\n\n\tif ( passed )\n\t\treturn renderTokens(token.content, createElement, ctx);\n\n\treturn renderTokens(token.alternative, createElement, ctx);\n}\n\n\n// ============================================================================\n// Token Type: Fieldset\n// ============================================================================\n\nTOKEN_TYPES.fieldset = function(token, createElement, ctx) {\n\tif ( ! Array.isArray(token.fields) )\n\t\treturn null;\n\n\tconst fields = [];\n\tfor(const field of token.fields) {\n\t\tif ( ! field )\n\t\t\tcontinue;\n\n\n\t\tconst name = renderTokens(field.name, createElement, ctx, token.markdown),\n\t\t\tvalue = renderTokens(field.value, createElement, ctx, token.markdown),\n\t\t\ticon = renderTokens(field.icon, createElement, ctx, token.markdown);\n\n\t\tif ( name == null || value == null )\n\t\t\tcontinue;\n\n\t\tif ( ctx.vue )\n\t\t\tfields.push(createElement('div', {\n\t\t\t\tclass: [\n\t\t\t\t\t'ffz--field',\n\t\t\t\t\tfield.inline ? 'ffz--field-inline' : false,\n\t\t\t\t\ticon ? 'ffz--field-icon' : false\n\t\t\t\t]\n\t\t\t}, [\n\t\t\t\tcreateElement('div', {class: 'ffz--field__icon'}, icon),\n\t\t\t\tcreateElement('div', {class: 'ffz--field__name tw-semibold'}, name),\n\t\t\t\tcreateElement('div', {class: 'ffz--field__value tw-c-text-alt'}, value)\n\t\t\t]));\n\t\telse\n\t\t\tfields.push(createElement('div', {\n\t\t\t\tclassName: `ffz--field ${field.inline ? 'ffz--field-inline' : ''} ${icon ? 'ffz--field-icon' : ''}`\n\t\t\t}, [\n\t\t\t\tcreateElement('div', {className: 'ffz--field__icon'}, icon),\n\t\t\t\tcreateElement('div', {className: 'ffz--field__name tw-semibold'}, name),\n\t\t\t\tcreateElement('div', {className: 'ffz--field__value tw-c-text-alt'}, value)\n\t\t\t]));\n\t}\n\n\tif ( ! fields.length )\n\t\treturn null;\n\n\tif ( ctx.vue )\n\t\treturn createElement('div', {\n\t\t\tclass: 'ffz--fields'\n\t\t}, fields);\n\n\treturn createElement('div', {\n\t\tclassName: 'ffz--fields'\n\t}, fields);\n}\n\n\n// ============================================================================\n// Token Type: Flex\n// ============================================================================\n\nconst ALIGNMENTS = ['start', 'end', 'center', 'between', 'around'];\n\nTOKEN_TYPES.flex = function(token, createElement, ctx) {\n\tconst classes = [], style = {};\n\n\tif ( token.inline )\n\t\tclasses.push('tw-flex-inline');\n\telse\n\t\tclasses.push('tw-flex');\n\n\tconst overflow = validate(token.overflow, ['hidden', 'auto']);\n\tif ( overflow )\n\t\tclasses.push(`tw-overflow-${overflow}`);\n\n\tconst direction = validate(token.direction, ['column', 'row', 'column-reverse', 'row-reverse']);\n\tif ( direction )\n\t\tclasses.push(`tw-flex-${direction}`);\n\n\tconst wrap = validate(token.wrap, ['wrap', 'nowrap', 'wrap-reverse']);\n\tif ( wrap )\n\t\tclasses.push(`tw-flex-${wrap}`);\n\n\tlet align = validate(token['align-content'], ALIGNMENTS)\n\tif ( align )\n\t\tclasses.push(`tw-align-content-${align}`);\n\n\talign = validate(token['justify-content'], ALIGNMENTS);\n\tif ( align )\n\t\tclasses.push(`tw-justify-content-${align}`);\n\n\talign = validate(token['align-items'], ALIGNMENTS)\n\tif ( align )\n\t\tclasses.push(`tw-align-items-${align}`);\n\n\talign = validate(token['align-self'], ALIGNMENTS)\n\tif ( align )\n\t\tclasses.push(`tw-align-self-${align}`);\n\n\tapplySpacing('pd', token, classes, style);\n\tapplySpacing('mg', token, classes, style);\n\n\tconst content = renderTokens(token.content, createElement, ctx, token.markdown);\n\tif ( ctx.vue )\n\t\treturn createElement('div', {class: classes, style}, content);\n\n\treturn createElement('div', {className: classes.join(' '), style}, content);\n}\n\n// ============================================================================\n// Token Type: Format\n// ============================================================================\n\nTOKEN_TYPES.format = function(token, createElement, ctx) {\n\tconst type = token.format, val = token.value, opt = token.options;\n\n\tlet out;\n\n\tif ( type === 'date' )\n\t\tout = ctx.i18n.formatDate(val, opt);\n\telse if ( type === 'time' )\n\t\tout = ctx.i18n.formatTime(val, opt);\n\telse if ( type === 'datetime' )\n\t\tout = ctx.i18n.formatDateTime(val, opt)\n\telse if ( type === 'relative' )\n\t\tout = ctx.i18n.toRelativeTime(val, opt);\n\telse if ( type === 'duration' )\n\t\tout = ctx.i18n.formatDuration(val, opt);\n\telse if ( type === 'number' )\n\t\tout = ctx.i18n.formatNumber(val, opt);\n\telse {\n\t\tconsole.warn('Unknown format type:', type);\n\t\tout = String(val);\n\t}\n\n\tif ( ctx.text_capture )\n\t\tctx.text_capture.push(out);\n\n\treturn out;\n}\n\n\n// ============================================================================\n// Token Type: Gallery\n// ============================================================================\n\nTOKEN_TYPES.gallery = function(token, createElement, ctx) {\n\n\tif ( ! Array.isArray(token.items) || ! token.items.length )\n\t\treturn null;\n\n\tlet first_column = [],\n\t\tsecond_column = [],\n\t\tfirst = true,\n\t\ti = 0;\n\n\tfor(const item of token.items) {\n\t\tconst content = renderTokens(item, createElement, ctx);\n\t\tif ( content ) {\n\t\t\t(first ? first_column : second_column).push(content);\n\t\t\tfirst = ! first;\n\t\t\ti++;\n\t\t\tif ( i >= 4 )\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif ( second_column.length && first_column.length > second_column.length )\n\t\tsecond_column.push(first_column.pop());\n\n\tif ( ! i )\n\t\treturn null\n\n\tconst columns = [];\n\n\tcolumns.push(ctx.vue ?\n\t\tcreateElement('div', {\n\t\t\tclass: 'ffz--gallery-column',\n\t\t\tattrs: {\n\t\t\t\t'data-items': first_column.length\n\t\t\t}\n\t\t}, first_column) :\n\t\tcreateElement('div', {\n\t\t\tclassName: 'ffz--gallery-column',\n\t\t\t'data-items': first_column.length\n\t\t}, first_column)\n\t);\n\n\tif ( second_column.length )\n\t\tcolumns.push(ctx.vue ?\n\t\t\tcreateElement('div', {\n\t\t\t\tclass: 'ffz--gallery-column',\n\t\t\t\tattrs: {\n\t\t\t\t\t'data-items': second_column.length\n\t\t\t\t}\n\t\t\t}, second_column) :\n\t\t\tcreateElement('div', {\n\t\t\t\tclassName: 'ffz--gallery-column',\n\t\t\t\t'data-items': second_column.length\n\t\t\t}, second_column)\n\t\t);\n\n\tif ( ctx.vue )\n\t\treturn createElement('div', {\n\t\t\tclass: 'ffz--rich-gallery',\n\t\t\tattrs: {\n\t\t\t\t'data-items': first_column.length + second_column.length\n\t\t\t}\n\t\t}, columns);\n\n\treturn createElement('div', {\n\t\tclassName: 'ffz--rich-gallery',\n\t\t'data-items': first_column.length + second_column.length\n\t}, columns);\n}\n\n\n// ============================================================================\n// Token Type: Heading\n// ============================================================================\n\nfunction header_vue(token, h, ctx) {\n\tlet content = [];\n\tlet background;\n\n\tif ( token.title ) {\n\t\tconst out = renderWithCapture(token.title, h, ctx, token.markdown);\n\t\tcontent.push(h('div', {\n\t\t\tclass: 'tw-ellipsis tw-semibold tw-mg-x-05',\n\t\t\tattrs: {\n\t\t\t\ttitle: out.title\n\t\t\t}\n\t\t}, out.content));\n\t}\n\n\tif ( token.subtitle ) {\n\t\tconst out = renderWithCapture(token.subtitle, h, ctx, token.markdown);\n\t\tcontent.push(h('div', {\n\t\t\tclass: 'tw-ellipsis tw-c-text-alt-2 tw-mg-x-05',\n\t\t\tattrs: {\n\t\t\t\ttitle: out.title\n\t\t\t}\n\t\t}, out.content));\n\t}\n\n\tif ( token.extra ) {\n\t\tconst out = renderWithCapture(token.extra, h, ctx, token.markdown);\n\t\tcontent.push(h('div', {\n\t\t\tclass: 'tw-ellipsis tw-c-text-alt-2 tw-mg-x-05',\n\t\t\tattrs: {\n\t\t\t\ttitle: out.title\n\t\t\t}\n\t\t}, out.content));\n\t}\n\n\tlet bgtoken = resolveToken(token.sfw_background, ctx);\n\tconst nsfw_bg_token = resolveToken(token.background, ctx);\n\tif ( nsfw_bg_token && canShowImage(nsfw_bg_token, ctx) )\n\t\tbgtoken = nsfw_bg_token;\n\n\tif ( bgtoken ) {\n\t\tif ( bgtoken.type === 'image' )\n\t\t\tbackground = render_image({\n\t\t\t\t...bgtoken,\n\t\t\t\taspect: undefined\n\t\t\t}, h, ctx);\n\t\telse if ( bgtoken.type === 'icon' )\n\t\t\tbackground = h('figure', {\n\t\t\t\tclass: `ffz-i-${bgtoken.name}`\n\t\t\t});\n\t\telse\n\t\t\tbackground = renderWithCapture(token.background, h, ctx, token.markdown).content;\n\t}\n\n\tlet subtok = resolveToken(token.sub_logo, ctx);\n\tif ( ! token.compact && subtok && canShowImage(subtok, ctx) ) {\n\t\tconst aspect = subtok.aspect;\n\n\t\tlet image;\n\n\t\tif ( subtok.type === 'image' )\n\t\t\timage = render_image({\n\t\t\t\t...subtok,\n\t\t\t\taspect: undefined\n\t\t\t}, h, ctx);\n\n\t\tif ( subtok.type === 'icon' )\n\t\t\timage = h('figure', {\n\t\t\t\tclass: `ffz-i-${subtok.name}`\n\t\t\t});\n\n\t\tif ( image ) {\n\t\t\timage = h('div', {\n\t\t\t\tclass: `ffz--header-sublogo tw-flex-shrink-0 ${subtok.extra_pad ? 'tw-mg-l-05 tw-mg-r-1' : 'tw-mg-r-05'}${aspect ? ' ffz--header-aspect' : ''}`,\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: aspect ? `${aspect * 2}rem` : null\n\t\t\t\t}\n\t\t\t}, [image]);\n\n\t\t\tconst title = content.shift();\n\n\t\t\tcontent = [\n\t\t\t\ttitle,\n\t\t\t\th('div', {\n\t\t\t\t\tclass: 'tw-flex tw-full-width tw-align-items-center'\n\t\t\t\t}, [\n\t\t\t\t\timage,\n\t\t\t\t\th('div', {\n\t\t\t\t\t\tclass: `tw-flex tw-full-width tw-overflow-hidden tw-justify-content-center tw-flex-column tw-flex-grow-1`\n\t\t\t\t\t}, content)\n\t\t\t\t])\n\t\t\t];\n\t\t}\n\t}\n\n\tcontent = h('div', {\n\t\tclass: [\n\t\t\t'tw-flex tw-full-width tw-overflow-hidden',\n\t\t\ttoken.compact ? 'ffz--rich-header ffz--compact-header tw-align-items-center' : 'tw-justify-content-center tw-flex-column tw-flex-grow-1'\n\t\t]\n\t}, content);\n\n\tlet imtok = resolveToken(token.sfw_image, ctx);\n\tconst nsfw_token = resolveToken(token.image, ctx);\n\tif ( nsfw_token && canShowImage(nsfw_token, ctx) )\n\t\timtok = nsfw_token;\n\n\tif ( imtok ) {\n\t\tconst aspect = imtok.aspect;\n\t\tlet image;\n\n\t\tif ( imtok.type === 'image' )\n\t\t\timage = render_image({\n\t\t\t\t...imtok,\n\t\t\t\taspect: undefined\n\t\t\t}, h, ctx);\n\n\t\tif ( imtok.type === 'icon' )\n\t\t\timage = h('figure', {\n\t\t\t\tclass: `ffz-i-${imtok.name}`\n\t\t\t});\n\n\t\tconst right = token.image_side === 'right';\n\n\t\tif ( image ) {\n\t\t\timage = h('div', {\n\t\t\t\tclass: [\n\t\t\t\t\t'ffz--header-image tw-flex-shrink-0 tw-mg-x-05',\n\t\t\t\t\taspect ? 'ffz--header-aspect' : null\n\t\t\t\t],\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: aspect ? `${aspect * (token.compact ? 2.4 : 4.8)}rem` : null\n\t\t\t\t}\n\t\t\t}, [image]);\n\n\t\t\tif ( token.compact ) {\n\t\t\t\tif ( right )\n\t\t\t\t\tcontent.children.push(image);\n\t\t\t\telse\n\t\t\t\t\tcontent.children.unshift(image);\n\n\t\t\t} else {\n\t\t\t\tcontent = h('div', {\n\t\t\t\t\tclass: 'tw-flex ffz--rich-header'\n\t\t\t\t}, [\n\t\t\t\t\tright ? content : null,\n\t\t\t\t\timage,\n\t\t\t\t\tright ? null : content\n\t\t\t\t])\n\t\t\t}\n\n\t\t} else if ( ! token.compact )\n\t\t\tcontent = h('div', {\n\t\t\t\tclass: 'tw-flex ffz--rich-header'\n\t\t\t}, [\n\t\t\t\th('div', {class: 'ffz--header-image tw-mg-x-05'}),\n\t\t\t\tcontent\n\t\t\t]);\n\n\t} else if ( ! token.compact )\n\t\tcontent = h('div', {\n\t\t\tclass: 'tw-flex ffz--rich-header'\n\t\t}, [\n\t\t\th('div', {class: 'ffz--header-image tw-mg-x-05'}),\n\t\t\tcontent\n\t\t]);\n\n\tif ( background )\n\t\tcontent = h('div', {\n\t\t\tclass: 'ffz--rich-header--background'\n\t\t}, [\n\t\t\th('div', {\n\t\t\t\tclass: 'ffz--rich-header__background'\n\t\t\t}, [\n\t\t\t\tbackground\n\t\t\t]),\n\t\t\tcontent\n\t\t]);\n\n\treturn content;\n}\n\nfunction header_normal(token, createElement, ctx) {\n\tlet content = [];\n\tlet background;\n\n\tif ( token.title ) {\n\t\tconst out = renderWithCapture(token.title, createElement, ctx, token.markdown);\n\t\tcontent.push(createElement('div', {\n\t\t\tclassName: `tw-ellipsis tw-semibold ${token.compact ? 'tw-mg-r-1' : ''}`,\n\t\t\ttitle: out.title\n\t\t}, out.content));\n\t}\n\n\tif ( token.subtitle ) {\n\t\tconst out = renderWithCapture(token.subtitle, createElement, ctx, token.markdown);\n\t\tcontent.push(createElement('div', {\n\t\t\tclassName: `tw-ellipsis tw-c-text-alt-2`,\n\t\t\ttitle: out.title\n\t\t}, out.content));\n\t}\n\n\tif ( token.extra ) {\n\t\tconst out = renderWithCapture(token.extra, createElement, ctx, token.markdown);\n\t\tcontent.push(createElement('div', {\n\t\t\tclassName: 'tw-ellipsis tw-c-text-alt-2',\n\t\t\ttitle: out.title\n\t\t}, out.content));\n\t}\n\n\tlet bgtoken = resolveToken(token.sfw_background, ctx);\n\tconst nsfw_bg_token = resolveToken(token.background, ctx);\n\tif ( nsfw_bg_token && canShowImage(nsfw_bg_token, ctx) )\n\t\tbgtoken = nsfw_bg_token;\n\n\tif ( bgtoken ) {\n\t\tif ( bgtoken.type === 'image' )\n\t\t\tbackground = render_image({\n\t\t\t\t...bgtoken,\n\t\t\t\taspect: undefined\n\t\t\t}, createElement, ctx);\n\t\telse if ( bgtoken.type === 'icon' )\n\t\t\tbackground = createElement('figure', {\n\t\t\t\tclassName: `ffz-i-${bgtoken.name}`\n\t\t\t});\n\t\telse\n\t\t\tbackground = renderWithCapture(token.background, createElement, ctx, token.markdown).content;\n\t}\n\n\tlet subtok = resolveToken(token.sub_logo, ctx);\n\tif ( ! token.compact && subtok && canShowImage(subtok, ctx) ) {\n\t\tconst aspect = subtok.aspect;\n\n\t\tlet image;\n\n\t\tif ( subtok.type === 'image' )\n\t\t\timage = render_image({\n\t\t\t\t...subtok,\n\t\t\t\taspect: undefined\n\t\t\t}, createElement, ctx);\n\n\t\tif ( subtok.type === 'icon' )\n\t\t\timage = createElement('figure', {\n\t\t\t\tclassName: `ffz-i-${subtok.name}`\n\t\t\t});\n\n\t\tif ( image ) {\n\t\t\timage = createElement('div', {\n\t\t\t\tclassName: `ffz--header-sublogo tw-flex-shrink-0 ${subtok.youtube_dumb ? 'tw-mg-l-05 tw-mg-r-1' : 'tw-mg-r-05'}${aspect ? ' ffz--header-aspect' : ''}`,\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: aspect ? `${aspect * 2}rem` : null\n\t\t\t\t}\n\t\t\t}, image);\n\n\t\t\tconst title = content.shift();\n\n\t\t\tcontent = [\n\t\t\t\ttitle,\n\t\t\t\tcreateElement('div', {\n\t\t\t\t\tclassName: 'tw-flex tw-full-width tw-align-items-center'\n\t\t\t\t}, [\n\t\t\t\t\timage,\n\t\t\t\t\tcreateElement('div', {\n\t\t\t\t\t\tclassName: `tw-flex tw-full-width tw-overflow-hidden tw-justify-content-center tw-flex-column tw-flex-grow-1`\n\t\t\t\t\t}, content)\n\t\t\t\t])\n\t\t\t];\n\t\t}\n\t}\n\n\tcontent = createElement('div', {\n\t\tclassName: `tw-flex tw-full-width tw-overflow-hidden ${token.compact ? 'ffz--rich-header ffz--compact-header tw-align-items-center' : 'tw-justify-content-center tw-flex-column tw-flex-grow-1'}`\n\t}, content);\n\n\tlet imtok = resolveToken(token.sfw_image, ctx);\n\tconst nsfw_token = resolveToken(token.image, ctx);\n\tif ( nsfw_token && canShowImage(nsfw_token, ctx) )\n\t\timtok = nsfw_token;\n\n\tif ( imtok ) {\n\t\tconst aspect = imtok.aspect;\n\n\t\tlet image;\n\n\t\tif ( imtok.type === 'image' )\n\t\t\timage = render_image({\n\t\t\t\t...imtok,\n\t\t\t\taspect: undefined\n\t\t\t}, createElement, ctx);\n\n\t\tif ( imtok.type === 'icon' )\n\t\t\timage = createElement('figure', {\n\t\t\t\tclassName: `ffz-i-${imtok.name}`\n\t\t\t});\n\n\t\tconst right = token.image_side === 'right';\n\n\t\tif ( image ) {\n\t\t\timage = createElement('div', {\n\t\t\t\tclassName: `ffz--header-image tw-flex-shrink-0 tw-mg-x-05${aspect ? ' ffz--header-aspect' : ''}`,\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: aspect ? `${aspect * (token.compact ? 2.4 : 4.8)}rem` : null\n\t\t\t\t}\n\t\t\t}, image);\n\n\t\t\tif ( token.compact ) {\n\t\t\t\t// We need to do some weird pushy stuff~\n\t\t\t\t// This varies if we're running with React or native.\n\t\t\t\tif ( content instanceof Node ) {\n\t\t\t\t\tif ( right )\n\t\t\t\t\t\tcontent.appendChild(image);\n\t\t\t\t\telse\n\t\t\t\t\t\tcontent.insertBefore(image, content.firstChild);\n\t\t\t\t} else if ( Array.isArray(content?.props?.children) ) {\n\t\t\t\t\tif ( right )\n\t\t\t\t\t\tcontent.props.children.push(image);\n\t\t\t\t\telse\n\t\t\t\t\t\tcontent.props.children.unshift(image);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tcontent = createElement('div', {\n\t\t\t\t\tclassName: 'tw-flex ffz--rich-header'\n\t\t\t\t}, [right ? content : null, image, right ? null : content])\n\t\t\t}\n\t\t} else if ( ! token.compact )\n\t\t\tcontent = createElement('div', {\n\t\t\t\tclassName: 'tw-flex ffz--rich-header'\n\t\t\t}, [\n\t\t\t\tcreateElement('div', {className: 'ffz--header-image tw-mg-x-05'}),\n\t\t\t\tcontent\n\t\t\t]);\n\n\t} else if ( ! token.compact )\n\t\tcontent = createElement('div', {\n\t\t\tclassName: 'tw-flex ffz--rich-header'\n\t\t}, [\n\t\t\tcreateElement('div', {className: 'ffz--header-image tw-mg-x-05'}),\n\t\t\tcontent\n\t\t]);\n\n\tif ( background )\n\t\tcontent = createElement('div', {\n\t\t\tclassName: 'ffz--rich-header--background'\n\t\t}, [\n\t\t\tcreateElement('div', {\n\t\t\t\tclassName: 'ffz--rich-header__background'\n\t\t\t}, background),\n\t\t\tcontent\n\t\t]);\n\n\treturn content;\n\n}\n\nTOKEN_TYPES.header = function(token, createElement, ctx) {\n\tif ( ! token.title && ! token.subtitle && ! token.image && ! token.extra )\n\t\treturn null;\n\n\treturn ctx.vue ?\n\t\theader_vue(token, createElement, ctx) :\n\t\theader_normal(token, createElement, ctx);\n}\n\n\n// ============================================================================\n// Token Type: Icon\n// ============================================================================\n\nTOKEN_TYPES.icon = function(token, createElement, ctx) {\n\tif ( ! token.name )\n\t\treturn null;\n\n\treturn ctx.vue ?\n\t\tcreateElement('span', {class: `ffz-i-${token.name}`}) :\n\t\tcreateElement('span', {className: `ffz-i-${token.name}`});\n}\n\n\n// ============================================================================\n// Token Type: Image\n// ============================================================================\n\nfunction canShowImage(token, ctx) {\n\treturn !(has(token, 'sfw') && ! token.sfw && ! ctx.allow_unsafe);\n}\n\nfunction render_image(token, createElement, ctx) {\n\tif ( ! token.url || ! canShowImage(token, ctx) )\n\t\treturn null;\n\n\tconst round = getRoundClass(token.rounding);\n\tlet aspect;\n\tif ( token.aspect )\n\t\taspect = token.aspect\n\telse if ( token.height > 0 && token.width > 0 )\n\t\taspect = token.width / token.height;\n\n\tif ( ctx.vue ) {\n\t\tconst stuff = {\n\t\t\tclass: [\n\t\t\t\ttoken.class,\n\t\t\t\tround\n\t\t\t],\n\n\t\t\tstyle: {\n\t\t\t\twidth: token.width,\n\t\t\t\theight: token.height\n\t\t\t},\n\n\t\t\tattrs: {\n\t\t\t\tsrc: token.url,\n\t\t\t\ttitle: token.title\n\t\t\t}\n\t\t};\n\n\t\tif ( token.contain )\n\t\t\tstuff.style.objectFit = 'contain';\n\n\t\tif ( ctx.onload )\n\t\t\tstuff.on = {load: ctx.onload};\n\n\t\tconst image = createElement('img', stuff);\n\n\t\tif ( ! aspect )\n\t\t\treturn image;\n\n\t\treturn createElement('aspect', {\n\t\t\tprops: {\n\t\t\t\tratio: aspect,\n\t\t\t\talign: 'center'\n\t\t\t}\n\t\t}, [image]);\n\t}\n\n\tconst image = createElement('img', {\n\t\tclassName: `${token.class || ''} ${round}`,\n\t\tsrc: token.url,\n\t\talt: token.alt || token.title || '',\n\t\ttitle: token.title || '',\n\t\tonLoad: ctx.onload,\n\t\tstyle: {\n\t\t\twidth: token.width,\n\t\t\theight: token.height\n\t\t}\n\t});\n\n\tif ( token.contain )\n\t\timage.style.objectFit = 'contain';\n\n\tif ( ! aspect )\n\t\treturn image;\n\n\treturn createElement('div', {\n\t\tclassName: 'ffz-aspect ffz-aspect--align-center'\n\t}, [\n\t\tcreateElement('div', {\n\t\t\tclassName: 'ffz-aspect__spacer',\n\t\t\tstyle: {\n\t\t\t\tpaddingTop: `${100 * (1 / (aspect || 1))}%`\n\t\t\t}\n\t\t}),\n\t\timage\n\t]);\n}\n\nTOKEN_TYPES.image = render_image;\n\n\n// ============================================================================\n// Token Type: I18n\n// ============================================================================\n\nTOKEN_TYPES.i18n = function(token, createElement, ctx) {\n\tif ( ! token.phrase ) {\n\t\tconsole.warn('Skipping i18n tag with no phrase');\n\t\treturn null;\n\t}\n\n\tlet key = token.key;\n\tif ( ctx.i18n_prefix )\n\t\tkey = `${ctx.i18n_prefix}.${key}`;\n\n\treturn renderTokens(\n\t\tctx.i18n.tList(key, token.phrase, token.content),\n\t\tcreateElement,\n\t\tctx,\n\t\ttoken.markdown\n\t);\n}\n\n\n// ============================================================================\n// Token Type: I18n Select\n// ============================================================================\n\nfunction findMatchingLocale(locale, list) {\n\n\t// Is the locale present exactly?\n\tfor(const item of list) {\n\t\tif ( item.localeCompare(locale, undefined, {sensitivity: 'accent'}) === 0 )\n\t\t\treturn locale;\n\t}\n\n\t// What about partials?\n\tlet prefixed = `${locale.toLowerCase()}-`;\n\tfor(const item of list) {\n\t\tif ( item.toLowerCase().startsWith(prefixed) )\n\t\t\treturn item;\n\t}\n\n\t// Last resort, do we have a - in the locale?\n\tconst idx = locale.indexOf('-');\n\tif ( idx !== -1 )\n\t\treturn findMatchingLocale(locale.slice(0, idx), list);\n\n}\n\nTOKEN_TYPES.i18n_select = function(token, createElement, ctx) {\n\n\t// What locale and choices do we have.\n\tconst choices = token.choices || {};\n\tlet locale = ctx.i18n?.locale ?? 'en';\n\n\t// Try to find a valid match, or use the default.\n\tlet selected = findMatchingLocale(locale, Object.keys(choices));\n\tif ( ! selected )\n\t\tselected = token.default;\n\n\t// Render it.\n\treturn renderTokens(\n\t\tchoices[selected],\n\t\tcreateElement,\n\t\tctx,\n\t\ttoken.markdown\n\t);\n}\n\n\n// ============================================================================\n// Token Type: Link\n// ============================================================================\n\nTOKEN_TYPES.link = function(token, createElement, ctx) {\n\tif ( token.content === undefined )\n\t\ttoken.content = token.url;\n\n\tconst content = renderTokens(token.content, createElement, ctx, token.markdown);\n\n\tconst klass = [];\n\tif ( token.interactive )\n\t\tklass.push(`ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive`);\n\n\tif ( token.tooltip !== false )\n\t\tklass.push('ffz-tooltip');\n\n\tif ( token.embed )\n\t\tklass.push(`tw-block tw-border tw-border-radius-large tw-mg-y-05 tw-pd-05`);\n\n\tif ( token.no_color )\n\t\tklass.push(`ffz-link--inherit`);\n\n\tif ( ctx.vue ) {\n\t\tlet on = {};\n\t\tif ( ctx.link_click_handler )\n\t\t\ton.click = ctx.link_click_handler;\n\n\t\treturn createElement('a', {\n\t\t\tclass: klass,\n\t\t\tattrs: {\n\t\t\t\trel: 'noopener noreferrer',\n\t\t\t\ttarget: '_blank',\n\t\t\t\t'data-tooltip-type': 'link',\n\t\t\t\thref: token.url\n\t\t\t},\n\t\t\ton\n\t\t}, content);\n\t}\n\n\treturn createElement('a', {\n\t\tclassName: klass.join(' '),\n\t\trel: 'noopener noreferrer',\n\t\ttarget: '_blank',\n\t\t'data-tooltip-type': 'link',\n\t\thref: token.url,\n\t\tonClick: ctx.link_click_handler\n\t}, content);\n}\n\n\n// ============================================================================\n// Token Type: Overlay\n// ============================================================================\n\nTOKEN_TYPES.overlay = function(token, createElement, ctx) {\n\tconst content = renderTokens(token.content, createElement, ctx, token.markdown);\n\tif ( ! content )\n\t\treturn null;\n\n\tconst corners = [];\n\tfor(const corner of ['top-left', 'top', 'top-right', 'left', 'center', 'right', 'bottom-left', 'bottom', 'bottom-right']) {\n\t\tconst stuff = renderTokens(token[corner], createElement, ctx, token.markdown);\n\t\tif ( stuff )\n\t\t\tcorners.push(ctx.vue ?\n\t\t\t\tcreateElement('div', {class: `ffz--overlay__bit`, attrs:{'data-side':corner}}, stuff) :\n\t\t\t\tcreateElement('div', {className: `ffz--overlay__bit`, 'data-side':corner}, stuff)\n\t\t\t);\n\t}\n\n\tconst classes = ['ffz--overlay'];\n\tconst style = {};\n\n\tif ( token.background ) {\n\t\tif ( VALID_COLORS.includes(token.background) )\n\t\t\tclasses.push(`tw-c-background-${token.background}`);\n\t\telse\n\t\t\tstyle.backgroundColor = token.background;\n\t}\n\n\tif ( token.color ) {\n\t\tif ( VALID_COLORS.includes(token.color) )\n\t\t\tclasses.push(`tw-c-text-${token.color}`);\n\t\telse\n\t\t\tstyle.color = token.color;\n\t}\n\n\tif ( ctx.vue )\n\t\treturn createElement('div', {\n\t\t\tclass: classes,\n\t\t\tstyle\n\t\t}, [\n\t\t\tcreateElement('div', {class: 'ffz--overlay__content'}, content),\n\t\t\t...corners\n\t\t]);\n\n\treturn createElement('div', {\n\t\tclassName: classes.join(' '),\n\t\tstyle\n\t}, [\n\t\tcreateElement('div', {className: 'ffz--overlay__content'}, content),\n\t\t...corners\n\t]);\n}\n\n\n// ============================================================================\n// Token Type: Player\n// ============================================================================\n\nfunction handlePlayerClick(token, id, ctx, event) {\n\t//console.log('clicked player', token, id, ctx, event);\n\tconst target = event.currentTarget,\n\t\tis_av = target instanceof HTMLVideoElement || target instanceof HTMLAudioElement;\n\n\tif ( is_av || ctx.togglePlayer ) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t}\n\n\tif ( is_av ) {\n\t\tif ( target.paused )\n\t\t\ttarget.play();\n\t\telse\n\t\t\ttarget.pause();\n\n\t\treturn;\n\t}\n\n\tif ( ctx.togglePlayer )\n\t\tctx.togglePlayer(id);\n}\n\nTOKEN_TYPES.player = function(token, createElement, ctx) {\n\n\t// Make a unique ID for this player, within the context.\n\tconst id = ctx.last_player = (ctx.last_player || 0) + 1,\n\t\tactive = ctx.player_state?.[id];\n\n\tconst handler = handlePlayerClick.bind(this, token, id, ctx);\n\n\tif ( ! active && (token.content || token.iframe) )\n\t\treturn render_player_content(id, handler, token, createElement, ctx);\n\n\tif ( token.iframe )\n\t\treturn render_player_iframe(id, active ?? false, handler, token, createElement, ctx);\n\n\tif ( ! token.sources )\n\t\treturn null;\n\n\tconst autoplay = token.autoplay ?? false,\n\t\tloop = token.loop ?? false,\n\t\tplaying = active ?? autoplay,\n\t\tcontrols = ! token.silent || ! autoplay;\n\n\tconst muted = token.silent ? true : (active == null && autoplay);\n\tconst style = {};\n\n\tconst aspect = token.active_aspect ?? token.aspect;\n\t\tif ( aspect )\n\t\t\tstyle.aspectRatio = aspect;\n\n\tif ( ctx.vue )\n\t\treturn createElement(token.audio ? 'audio' : 'video', {\n\t\t\tstyle,\n\t\t\tattrs: {\n\t\t\t\tautoplay: playing,\n\t\t\t\tloop,\n\t\t\t\tcontrols,\n\t\t\t\tposter: token.poster\n\t\t\t},\n\t\t\tdomProps: {\n\t\t\t\tmuted\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tclick: handler\n\t\t\t}\n\t\t}, token.sources.map(source => createElement('source', {\n\t\t\tattrs: {\n\t\t\t\ttype: source.type,\n\t\t\t\tsrc: source.src\n\t\t\t}\n\t\t})));\n\n\treturn createElement(token.audio ? 'audio' : 'video', {\n\t\tstyle,\n\t\tmuted,\n\t\tautoplay: playing,\n\t\tloop,\n\t\tposter: token.poster,\n\t\tcontrols,\n\t\tonClick: handler\n\t}, token.sources.map(source => createElement('source', {\n\t\ttype: source.type,\n\t\tsrc: source.src\n\t})));\n}\n\nfunction render_player_content(id, handler, token, createElement, ctx) {\n\tconst content = renderTokens(token.content, createElement, ctx, token.markdown),\n\t\tclasses = ['ffz--rich-player'],\n\t\tstyle = {};\n\n\tif ( token.aspect )\n\t\tstyle.aspectRatio = token.aspect;\n\n\tif ( ctx.vue )\n\t\treturn createElement('div', {\n\t\t\tclass: classes,\n\t\t\tstyle,\n\t\t\ton: {\n\t\t\t\tclick: handler\n\t\t\t}\n\t\t}, content);\n\n\treturn createElement('div', {\n\t\tclassName: classes.join(' '),\n\t\tonClick: handler,\n\t\tstyle\n\t}, content);\n}\n\nfunction render_player_iframe(id, active, handler, token, createElement, ctx) {\n\n\tconst style = {},\n\t\tattrs = {\n\t\t\tsrc: token.iframe,\n\t\t\tframeborder: 0,\n\t\t\tallow: 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share',\n\t\t\tallowfullscreen: true\n\t\t};\n\n\tconst aspect = token.active_aspect ?? token.aspect;\n\tif ( aspect )\n\t\tstyle.aspectRatio = aspect;\n\n\tif ( ctx.vue )\n\t\treturn createElement('iframe', {\n\t\t\tstyle,\n\t\t\tattrs\n\t\t});\n\n\treturn createElement('iframe', {\n\t\tstyle,\n\t\t...attrs\n\t});\n\n}\n\n\n// ============================================================================\n// Token Type: Style\n// ============================================================================\n\nTOKEN_TYPES.style = function(token, createElement, ctx) {\n\tconst classes = [], style = {};\n\n\tif ( token.weight ) {\n\t\tif ( VALID_WEIGHTS.includes(token.weight) )\n\t\t\tclasses.push(`tw-${token.weight}`);\n\t\telse\n\t\t\tstyle.weight = token.weight;\n\t}\n\n\tif ( token.italic )\n\t\tclasses.push('tw-italic');\n\n\tif ( token.strike )\n\t\tclasses.push('tw-strikethrough');\n\n\tif ( token.underline )\n\t\tclasses.push('tw-underline');\n\n\tif ( token.tabular )\n\t\tclasses.push('tw-tabular-nums');\n\n\tif ( token.size ) {\n\t\tif ( typeof token.size === 'string' ) {\n\t\t\tif ( VALID_SIZES.includes(token.size) )\n\t\t\t\tclasses.push(`tw-font-size-${token.size}`);\n\t\t\telse\n\t\t\t\tstyle.fontSize = token.size;\n\t\t} else\n\t\t\tstyle.fontSize = `${token.size}px`;\n\t}\n\n\tif ( token.color ) {\n\t\tif ( VALID_COLORS.includes(token.color) )\n\t\t\tclasses.push(`tw-c-text-${token.color}`);\n\t\telse if ( VALID_COLORS_TWO.includes(token.color) )\n\t\t\tclasses.push(`ffz-c-text-${token.color}`);\n\t\telse\n\t\t\tstyle.color = token.color;\n\t}\n\n\tif ( VALID_WRAPS.includes(token.wrap) )\n\t\tclasses.push(`tw-white-space-${token.wrap}`);\n\n\tif ( token.ellipsis )\n\t\tclasses.push('tw-ellipsis');\n\n\tapplySpacing('pd', token, classes, style);\n\tapplySpacing('mg', token, classes, style);\n\n\tconst capture = token.ellipsis;\n\tlet content, title = null;\n\n\tif ( capture ) {\n\t\tconst out = renderWithCapture(token.content, createElement, ctx, token.markdown);\n\t\tcontent = out.content; title = out.title;\n\t} else\n\t\tcontent = renderTokens(token.content, createElement, ctx, token.markdown);\n\n\tif ( ctx.vue )\n\t\treturn createElement('span', {class: classes, style, attrs: {title}}, content);\n\n\treturn createElement('span', {className: classes.join(' '), style, title}, content);\n}\n\n\n// ============================================================================\n// Token Type: Tag (Deprecated)\n// ============================================================================\n\nexport const ALLOWED_TAGS = [\n\t'a', 'abbr', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'blockquote', 'br',\n\t'caption', 'code', 'col', 'colgroup', 'data', 'dd', 'div', 'dl', 'dt', 'em',\n\t'figcaption', 'figure', 'footer', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header',\n\t'hr', 'i', 'img', 'li', 'main', 'nav', 'ol', 'p', 'picture', 'pre', 's', 'section',\n\t'source', 'span', 'strong', 'sub', 'sup', 'table', 'tbody', 'td', 'tfoot',\n\t'th', 'thead', 'time', 'tr', 'track', 'u', 'ul', 'video', 'wbr'\n];\n\nexport const ALLOWED_ATTRS = {\n\ta: ['href'],\n\taudio: ['autoplay', 'controls', 'loop', 'muted', 'preload', 'src'],\n\tbdo: ['dir'],\n\tcol: ['span'],\n\tcolgroup: ['span'],\n\tdata: ['value'],\n\timg: ['alt', 'height', 'sizes', 'src', 'srcset', 'width'],\n\tsource: ['src', 'srcset', 'type', 'media', 'sizes'],\n\ttd: ['colspan', 'headers', 'rowspan'],\n\tth: ['abbr', 'colspan', 'headers', 'rowspan', 'scope'],\n\ttime: ['datetime'],\n\ttrack: ['default', 'kind', 'label', 'src', 'srclang'],\n\tvideo: ['autoplay', 'controls', 'height', 'loop', 'muted', 'poster', 'preload', 'src', 'width'],\n};\n\nexport const PROPS = [\n\t'muted'\n];\n\nexport const GLOBAL_ATTRS = ['style', 'title'];\n\n\nTOKEN_TYPES.tag = function(token, createElement, ctx) {\n\tconst tag = String(token.tag || 'span').toLowerCase();\n\tif ( ! ALLOWED_TAGS.includes(tag) ) {\n\t\tconsole.warn('Skipping disallowed tag:', tag);\n\t\treturn null;\n\t}\n\n\tconst attrs = {}, props = {};\n\tif ( token.attrs ) {\n\t\tconst allowed = ALLOWED_ATTRS[tag] || [];\n\t\tfor(const [key, val] of Object.entries(token.attrs)) {\n\t\t\tif ( ! allowed.includes(key) && ! key.startsWith('data-') && ! GLOBAL_ATTRS.includes(key) )\n\t\t\t\tconsole.warn(`Skipping disallowed attribute for tag ${tag}:`, key);\n\t\t\telse if ( ctx.vue && PROPS.includes(key) )\n\t\t\t\tprops[key] = val;\n\t\t\telse\n\t\t\t\tattrs[key] = val;\n\t\t}\n\t}\n\n\tif ( tag === 'img' || tag === 'picture' )\n\t\tattrs.onload = ctx.onload;\n\n\tif ( tag === 'video' || tag === 'audio' )\n\t\tattrs.loadedmetadata = ctx.onload;\n\n\tconst content = renderTokens(token.content, createElement, ctx, token.markdown);\n\n\tif ( ctx.vue )\n\t\treturn createElement(tag, {\n\t\t\tclass: token.class || '',\n\t\t\tdomProps: props,\n\t\t\tattrs\n\t\t}, content);\n\n\treturn createElement(tag, {\n\t\t...attrs,\n\t\tclassName: token.class || ''\n\t}, content);\n}\n"],"names":["VERSION","TOKEN_TYPES","validate","input","valid","VALID_WEIGHTS","VALID_COLORS","VALID_COLORS_TWO","VALID_SIZES","VALID_WRAPS","VALID_PADDING","md","applySpacing","term","token","classes","styles","mode","key","value","thing","getRoundClass","klass","renderWithCapture","tokens","createElement","ctx","markdown","old_capture","old_markdown","content","renderTokens","title","out","val","type","handler","result","resolveToken","frag","style","round","capture","event","evt","passed","fields","field","name","icon","ALIGNMENTS","overflow","direction","wrap","align","opt","first_column","second_column","first","i","item","columns","header_vue","h","background","bgtoken","nsfw_bg_token","canShowImage","render_image","subtok","aspect","image","imtok","nsfw_token","right","header_normal","stuff","findMatchingLocale","locale","list","prefixed","idx","choices","selected","on","corners","corner","handlePlayerClick","id","target","is_av","active","render_player_content","render_player_iframe","autoplay","loop","playing","controls","muted","source","attrs","ALLOWED_TAGS","ALLOWED_ATTRS","PROPS","GLOBAL_ATTRS","tag","props","allowed"],"sourceRoot":""}